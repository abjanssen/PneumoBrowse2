{"version":3,"file":"static/js/5813.0f1a0b6f.chunk.js","mappings":"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","sources":["../../../plugins/grid-bookmark/src/GridBookmarkWidget/sessionSharing.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/dialogs/ShareBookmarksDialog.tsx"],"sourcesContent":["// duplicated from products/jbrowse-web/src/sessionSharing.ts ; could possibly be moved into a higher directory and shared between the two\nimport { toUrlSafeB64 } from './utils.ts'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      [...window.crypto.getRandomValues(new Uint8Array(length * 2))]\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replaceAll(/[+/]/g, '')\n    .slice(0, length)\n}\n\nconst encrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  return AES.encrypt(text, password).toString()\n}\n\nconst decrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  const Utf8 = await import('crypto-js/enc-utf8')\n  const bytes = AES.decrypt(text, password)\n  return bytes.toString(Utf8)\n}\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: unknown,\n  url: string,\n  referer: string,\n) {\n  const sess = await toUrlSafeB64(JSON.stringify(session))\n  const password = generateUID(5)\n  const encryptedSession = await encrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]!\n  const url = `${baseUrl}?sessionId=${encodeURIComponent(sessionId)}`\n  const response = await fetch(url)\n  if (!response.ok) {\n    throw new Error(getErrorMsg(await response.text()))\n  }\n\n  const json = await response.json()\n  return decrypt(json.session, password)\n}\n","import { useEffect, useState } from 'react'\n\nimport { Dialog, ErrorMessage } from '@jbrowse/core/ui'\nimport { getSession, isSessionWithShareURL } from '@jbrowse/core/util'\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { getSnapshot } from '@jbrowse/mobx-state-tree'\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy'\nimport {\n  Alert,\n  Button,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { shareSessionToDynamo } from '../../sessionSharing.ts'\n\nimport type { GridBookmarkModel } from '../../model.ts'\n\nconst useStyles = makeStyles()(() => ({\n  flexItem: {\n    margin: 5,\n  },\n  content: {\n    display: 'flex',\n    flexFlow: 'column',\n    gap: '5px',\n  },\n}))\n\nconst ShareBookmarksDialog = observer(function ShareBookmarksDialog({\n  onClose,\n  model,\n}: {\n  onClose: () => void\n  model: GridBookmarkModel\n}) {\n  const { classes } = useStyles()\n  const [url, setUrl] = useState('')\n  const [error, setError] = useState<unknown>()\n  const [loading, setLoading] = useState(true)\n  const session = getSession(model)\n  const { selectedBookmarks } = model\n  const shareAll = selectedBookmarks.length === 0\n  const bookmarksToShare =\n    selectedBookmarks.length === 0\n      ? model.allBookmarksModel\n      : model.sharedBookmarksModel\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        if (!isSessionWithShareURL(session)) {\n          throw new Error('No shareURL configured')\n        }\n        setLoading(true)\n        const snap = getSnapshot(bookmarksToShare)\n        const locationUrl = new URL(window.location.href)\n        const result = await shareSessionToDynamo(\n          snap,\n          session.shareURL,\n          locationUrl.href,\n        )\n        const params = new URLSearchParams(locationUrl.search)\n        params.set('bookmarks', `share-${result.json.sessionId}`)\n        params.set('password', result.password)\n        locationUrl.search = params.toString()\n        setUrl(locationUrl.href)\n        setLoading(false)\n      } catch (e) {\n        setError(e)\n      } finally {\n        setLoading(false)\n      }\n    })()\n  }, [bookmarksToShare, session])\n  return (\n    <Dialog open onClose={onClose} title=\"Share bookmarks\">\n      <DialogContent className={classes.content}>\n        <Alert severity=\"info\">\n          {shareAll ? (\n            <>\n              <span>All bookmarks will be shared.</span>\n              <br />\n              <span>\n                Use the checkboxes to select individual bookmarks to share.\n              </span>\n            </>\n          ) : (\n            'Only selected bookmarks will be shared.'\n          )}\n        </Alert>\n        <DialogContentText>\n          Copy the URL below to share your bookmarks.\n        </DialogContentText>\n        {error ? (\n          <ErrorMessage error={error} />\n        ) : loading ? (\n          <Typography>Generating short URL...</Typography>\n        ) : (\n          <TextField\n            label=\"URL\"\n            value={url}\n            slotProps={{\n              input: {\n                readOnly: true,\n              },\n            }}\n            variant=\"filled\"\n            fullWidth\n            onClick={event => {\n              const target = event.target as HTMLTextAreaElement\n              target.select()\n            }}\n          />\n        )}\n        <DialogContentText>\n          The URL should be pasted into the \"Import from share link\" field in\n          the \"Import\" form found in the \"Bookmarked regions\" drawer.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          className={classes.flexItem}\n          data-testid=\"dialogShare\"\n          variant=\"contained\"\n          color=\"primary\"\n          disabled={loading}\n          startIcon={<ContentCopyIcon />}\n          onClick={async () => {\n            const { default: copy } = await import('copy-to-clipboard')\n            copy(url)\n            session.notify('Copied to clipboard', 'success')\n            onClose()\n          }}\n        >\n          Copy share link\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default ShareBookmarksDialog\n"],"names":["getErrorMsg","err","JSON","parse","message","e","async","shareSessionToDynamo","session","url","referer","sess","toUrlSafeB64","stringify","password","window","btoa","crypto","getRandomValues","Uint8Array","length","map","b","String","fromCharCode","join","replaceAll","slice","encryptedSession","text","encrypt","toString","data","FormData","append","Date","now","response","fetch","method","mode","body","ok","Error","json","readSessionFromDynamo","baseUrl","sessionQueryParam","sessionId","split","encodeURIComponent","AES","Utf8","decrypt","useStyles","makeStyles","flexItem","margin","content","display","flexFlow","gap","observer","onClose","model","classes","setUrl","useState","error","setError","loading","setLoading","getSession","selectedBookmarks","shareAll","bookmarksToShare","allBookmarksModel","sharedBookmarksModel","useEffect","isSessionWithShareURL","snap","getSnapshot","locationUrl","URL","location","href","result","shareURL","params","URLSearchParams","search","set","_jsxs","Dialog","open","title","children","DialogContent","className","_jsx","Alert","severity","_Fragment","DialogContentText","ErrorMessage","Typography","TextField","label","value","slotProps","input","readOnly","variant","fullWidth","onClick","event","target","select","DialogActions","Button","color","disabled","startIcon","ContentCopyIcon","default","copy","notify"],"ignoreList":[],"sourceRoot":""}