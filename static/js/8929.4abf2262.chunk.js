"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5904,8929],{18340:(t,e,n)=>{n.d(e,{P:()=>s});var a=n(99546);function s(t,e,n=()=>{}){const s=new TextDecoder("utf8");let r=0,c=0;for(;r<t.length;){const o=t.indexOf(10,r),i=-1===o?t.length:o,l=t.subarray(r,i),u=s.decode(l).trim();if(u&&!1===e(u,c))break;c++%1e4==0&&n(`Loading ${(0,a.getProgressDisplayStr)(r,t.length)}`),r=i+1}}},35904:(t,e,n)=>{n.d(e,{default:()=>p});var a=n(46377),s=n(99546),r=n(99834),c=n(18340),o=n(32595),i=n(66885),l=n(16062),u=n(72147),m=n(78054);function f(t){const[e,n]=t.reduce(([t,e],[n,a])=>[t+n*a,e+a],[0,0]);return e/n}const{parseCigar:h}=l.aF;class p extends a.BaseFeatureDataAdapter{static capabilities=["getFeatures","getRefNames"];async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(t=>{throw this.setupP=void 0,t})),this.setupP}async setupPre(t){const e=[];return(0,c.P)(await(0,s.fetchAndMaybeUnzip)((0,r.openLocation)(this.getConf("pafLocation"),this.pluginManager),t),t=>(e.push((0,m.xI)(t)),!0),t?.statusCallback),e}async hasDataForRefName(){return!0}getAssemblyNames(){const t=this.getConf("assemblyNames");return 0===t.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:t}async getRefNames(t={}){const e=t.regions?.[0].assemblyName,n=await this.setup(t),a=this.getAssemblyNames().indexOf(e);if(-1!==a){const t=new Set;for(const e of n)t.add(0===a?e.qname:e.tname);return[...t]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(t,e={}){return(0,i.ObservableCreate)(async n=>{const a=function(t){const e={};for(const n of t){const t=`${n.qname}-${n.tname}`;e[t]||(e[t]={quals:[],len:[]}),e[t].quals.push(n.extra.mappingQual||1),e[t].len.push(n.extra.blockLen||1)}const n=Object.fromEntries(Object.entries(e).map(([t,e])=>[t,f((0,m.yU)(e.quals,e.len))]));for(const e of t){const t=`${e.qname}-${e.tname}`;e.extra.meanScore=n[t]}let a=1e4,s=0;for(const e of t)a=Math.min(e.extra.meanScore||0,a),s=Math.max(e.extra.meanScore||0,s);for(const e of t){const t=e.extra.meanScore||0;e.extra.meanScore=(t-a)/(s-a)}return t}(await this.setup(e)),s=this.getAssemblyNames(),{start:r,end:c,refName:i,assemblyName:l}=t,p=s.indexOf(l),d=0===p;-1===p&&(console.warn(`${l} not found in this adapter`),n.complete());for(let t=0;t<a.length;t++){const e=a[t];let f=0,p=0,g="",b="",y=0,x=0;d?(f=e.qstart,p=e.qend,g=e.qname,b=e.tname,y=e.tstart,x=e.tend):(f=e.tstart,p=e.tend,g=e.tname,b=e.qname,y=e.qstart,x=e.qend);const{extra:q,strand:w}=e;if(g===i&&(0,o.R6)(r,c,f,p)){const{numMatches:e=0,blockLen:a=1,cg:r,...c}=q;let o=q.cg;q.cg&&(d&&-1===w?o=(0,m.qm)(h(q.cg)).join(""):d&&(o=(0,m.gJ)(q.cg))),n.next(new u.A({uniqueId:t+l,assemblyName:l,start:f,end:p,type:"match",refName:g,strand:w,...c,CIGAR:o,syntenyId:t,identity:e/a,numMatches:e,blockLen:a,mate:{start:y,end:x,refName:b,assemblyName:s[+d]}}))}}n.complete()})}}},72147:(t,e,n)=>{n.d(e,{A:()=>c});var a=n(99546),s=n(16062);const{getMismatches:r}=s.aF;class c extends a.SimpleFeature{get(t){return"mismatches"===t?r(this.get("CIGAR")):super.get(t)}}},78054:(t,e,n)=>{n.d(e,{TA:()=>r,fY:()=>s,gJ:()=>l,qm:()=>i,xI:()=>o,yU:()=>c});var a=n(99546);function s(t){return new Map(t.split(/\n|\r\n|\r/).filter(t=>!!t||t.startsWith("#")).map(t=>{const[e,n,a,s,r,c]=t.split("\t");return[s,{refName:e,start:+n,end:+a,score:+r,name:s,strand:"-"===c?-1:1}]}))}async function r(t,e){return(0,a.fetchAndMaybeUnzipText)(t,e)}function c(t,e){return t.map((t,n)=>[t,e[n]])}function o(t){const e=t.split("\t"),n=e.slice(12),a={numMatches:+e[9],blockLen:+e[10],mappingQual:+e[11]};if(n.length)for(const t of n){const e=t.indexOf(":");a[t.slice(0,e)]=t.slice(e+3)}return{tname:e[5],tstart:+e[7],tend:+e[8],qname:e[0],qstart:+e[2],qend:+e[3],strand:"-"===e[4]?-1:1,extra:a}}function i(t){const e=[];for(let n=t.length-2;n>=0;n-=2){e.push(t[n]);const a=t[n+1];"D"===a?e.push("I"):"I"===a?e.push("D"):e.push(a)}return e}function l(t){return t.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}},98929:(t,e,n)=>{n.d(e,{default:()=>i});var a=n(99546),s=n(99834),r=n(18340);function c(t,e,n,a,s,r,c,o,i){return{qname:t,qstart:e,qend:n,tname:s,tstart:r,tend:c,strand:"-"===a?-1:1,extra:{numMatches:i,blockLen:Math.max(n-e,c-r),mappingQual:0,cg:o}}}var o=n(35904);class i extends o.default{async setupPre(t){return function(t,e){const{statusCallback:n=()=>{}}=e||{};let a="",s=0,o=0,i="",l="",u="",m=0,f=0,h=0,p="";const d=[];return(0,r.P)(t,t=>{if(!t||t.startsWith("#"))return!0;const e=t.split(/[ \t]+/);if("chain"===e[0]){if(p&&d.push(c(i,m,f,u,a,s,o,p,h)),a=e[2],s=+e[5],o=+e[6],i=e[7],l=e[8],u=e[9],m=+e[10],f=+e[11],"-"===u){const t=m;m=+l-f,f=+l-t}h=0,p=""}else{const t=+e[0]||0,n=e.length>1?+e[1]:0,a=e.length>2?+e[2]:0;0!==t&&(h+=t,p+=`${t}M`),0!==a&&(p+=`${a}I`),0!==n&&(p+=`${n}D`)}return!0},e?.statusCallback),p&&c(i,m,f,u,a,s,o,p,h),n(""),d}(await(0,a.fetchAndMaybeUnzip)((0,s.openLocation)(this.getConf("chainLocation"),this.pluginManager),t),t)}}}}]);
//# sourceMappingURL=8929.4abf2262.chunk.js.map