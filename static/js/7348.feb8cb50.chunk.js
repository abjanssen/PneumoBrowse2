"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7348],{67348:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var r=n(7552),a=n(68446),o=n(36422),s=n(75785),i=n(35723);const l=(0,s.n9)()({overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}}}),c=(0,a.observer)((function({model:e}){const{classes:t}=l(),{matchedTracks:n,interactToggled:a}=e,o=(0,r.useRef)(null);return r.createElement("div",{className:t.overlay},r.createElement("svg",{ref:o,style:{width:"100%",zIndex:10,pointerEvents:a?void 0:"none"}},n.map((t=>r.createElement(i.A,{parentRef:o,key:t.configuration.trackId,model:e,trackId:t.configuration.trackId})))))})),u=(0,s.n9)()((e=>({viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},content:{gridArea:"1/1"}}))),d=(0,a.observer)((function({model:e}){const{classes:t}=u(),{views:n}=e,{pluginManager:a}=(0,o.getEnv)(e);return r.createElement("div",{className:t.content},r.createElement("div",{style:{position:"relative"}},n.map(((e,o)=>{const{ReactComponent:s}=a.getViewType(e.type),i=r.createElement(s,{key:e.id,model:e});return o===n.length-1?i:[i,r.createElement("div",{key:`${e.id}-divider`,className:t.viewDivider})]}))))})),g=(0,a.observer)((function({model:e}){const{classes:t}=u();return r.createElement("div",null,r.createElement("div",{className:t.container},r.createElement(d,{model:e}),r.createElement(c,{model:e})))}))},35723:(e,t,n)=>{n.d(t,{A:()=>w});var r=n(7552),a=n(68446),o=n(36422),s=n(48231),i=n(99546),l=n(9502);function c(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function u(e,t){const n=e.get("ALT");if(n)return new Map(n.map((e=>(0,l.h)(e))).filter(i.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var d=n(49473);function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},g.apply(null,arguments)}const[f,,p]=[0,1,2,3],m=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:l,showIntraviewLinks:u}=e,m=(0,s.A)(),v=(0,i.getSession)(e),h=(0,o.getSnapshot)(e),{assemblyManager:k}=v,y=k.get(l[0].assemblyNames[0]);(0,d.E6)(h);const E=e.getTrackFeatures(t),w=(0,r.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(E)),[E]),T=(0,r.useMemo)((()=>{const n=e.getMatchedFeaturesInLayout(t,w?function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.get("flags"),a=r.id(),o=4&e,s=2&e;if(!n.has(a)&&!s&&!o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(E):function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.id(),a=4&r.get("flags"),o=!!c(r,"SA");if(!n.has(e)&&!a&&o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(E));return w||n.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),n}),[E,t,w,e]),[b,N]=(0,r.useState)();let M=0;if(n.current){const e=n.current.getBoundingClientRect();M=e.top}return y?r.createElement("g",g({fill:"none"},(0,i.getStrokeProps)(m.palette.text.disabled),{"data-testid":T.length?`${t}-loaded`:t}),T.map((e=>{const n=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:i,level:c}=e[o],{layout:g,feature:m,level:h}=e[o+1];if(!s||!g)return console.warn("received null layout for a overlay feature"),null;if(!u&&c===h)return null;const k=y.getCanonicalRefName(i.get("refName")),T=y.getCanonicalRefName(m.get("refName"));if(!k||!T)throw new Error(`unable to find ref for ${k||T}`);const S=i.get("strand"),O=m.get("strand"),R=s[-1===S?f:p],A=-1===O,C=w?g[A?f:p]:g[A?p:f],L=(0,d.Tp)(l[c],k,R),W=(0,d.Tp)(l[h],T,C),I=l[c].pxToBp(L).reversed,$=l[h].pxToBp(W).reversed,F=l.map((e=>e.getTrack(t))),B=(0,d.Ec)(t,c,l,F,s,a)-M,J=(0,d.Ec)(t,h,l,F,g,a)-M,x=["M",L,B,"C",L+200*i.get("strand")*(I?-1:1),B,W-200*m.get("strand")*($?-1:1)*(w?-1:1),J,W,J].join(" "),P=`${i.id()}-${m.id()}`;n.push(r.createElement("path",{d:x,key:P,"data-testid":"r1",strokeWidth:b===P?5:1,onClick:()=>{const e=v.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(E.get(i.id())||{toJSON:()=>{}}).toJSON(),feature2:(E.get(m.id())||{toJSON:()=>{}}).toJSON()}});v.showWidget?.(e)},onMouseOver:()=>{N(P)},onMouseOut:()=>{N(void 0)}}))}return n}))):null})),[v]=[0,1,2,3],h=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,c=(0,i.getSession)(e),{assemblyManager:g}=c,f=e.getTrackFeatures(t),p=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,n=new Set;for(const r of e.values()){if(!n.has(r.id())&&"breakend"===r.get("type")){const e=r.get("ALT");e?.forEach((e=>{const n=`${r.get("refName")}:${r.get("start")+1}`,a=(0,l.h)(e);if(a){const e=t.get(n);e?e.push(r):t.set(a.MatePosition||"none",[r])}}))}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(f))),[f,t,e]),[m,h]=(0,r.useState)(),k=(0,o.getSnapshot)(e);(0,d.E6)(k);const y=g.get(s[0].assemblyNames[0]);if(!y)return null;let E=0;if(n.current){const e=n.current.getBoundingClientRect();E=e.top}return r.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":p.length?`${t}-loaded`:t},p.map((e=>{const n=[];for(let o=0;o<e.length-1;o+=1){const{layout:i,feature:l,level:g}=e[o],{layout:p,feature:k,level:w}=e[o+1],T=l.id(),b=u(l,k);if(!i||!p)return null;const N=l.get("refName"),M=k.get("refName"),S=y.getCanonicalRefName(N),O=y.getCanonicalRefName(M);if(!S||!O)throw new Error(`unable to find ref for ${S||O}`);const R=(0,d.Tp)(s[g],S,i[v]),A=(0,d.Tp)(s[w],O,p[v]),C=s[g].pxToBp(R).reversed,L=s[w].pxToBp(A).reversed,W=s.map((e=>e.getTrack(t))),I=(0,d.Ec)(t,g,s,W,i,a)-E,$=(0,d.Ec)(t,w,s,W,p,a)-E;if(b){const e=["M",R-20*("left"===b.Join?-1:1)*(C?-1:1),I,"L",R,I,"L",A,$,"L",A-20*("left"===b.MateDirection?1:-1)*(L?-1:1),$].join(" ");n.push(r.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:T===m?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:f.get(T)?.toJSON()});c.showWidget?.(e)},onMouseOver:()=>{h(T)},onMouseOut:()=>{h(void 0)}}))}else console.warn("the relevant ALT allele was not found, cannot render")}return n})))})),[k]=[0,1,2,3];function y(e){return"+"===e?1:"-"===e?-1:0}const E=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,l=(0,i.getSession)(e),{assemblyManager:c}=l,u=e.getTrackFeatures(t),g=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],n=new Set;for(const r of e.values())n.has(r.id())||"<TRA>"!==r.get("ALT")[0]||t.push([r]),n.add(r.id());return t}(u))),[u,t,e]),[f,p]=(0,r.useState)(),m=(0,o.getSnapshot)(e);if((0,d.E6)(m),!c.get(s[0].assemblyNames[0]))return null;let v=0;if(n.current){const e=n.current.getBoundingClientRect();v=e.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":g.length?`${t}-loaded`:t},g.map((e=>{const n=[];for(const{layout:o,feature:i,level:c}of e){const e=0===c?1:0,g=i.id();if(!o)return null;const m=i.get("INFO"),h=m.CHR2[0],E=m.END[0],w=m.STRANDS?.[0]?.split(""),[T,b]=w??[".","."],N=(0,d.Tp)(s[e],h,E);if(N){const m=[N,0,N+1,0],h=(0,d.Tp)(s[c],i.get("refName"),o[k]),E=N,w=s[c].pxToBp(h).reversed,M=s[e].pxToBp(E).reversed,S=s.map((e=>e.getTrack(t))),O=(0,d.Ec)(t,c,s,S,o,a)-v,R=(0,d.Ec)(t,e,s,S,m,a)-v,A=["M",h-20*y(T)*(w?-1:1),O,"L",h,O,"L",E,R,"L",E-20*y(b)*(M?-1:1),R].join(" ");n.push(r.createElement("path",{d:A,key:JSON.stringify(A),strokeWidth:g===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(u.get(g)||{toJSON:()=>{}}).toJSON()});l.showWidget?.(e)},onMouseOver:()=>{p(g)},onMouseOut:()=>{p(void 0)}}))}}return n})))})),w=(0,a.observer)((function(e){const{model:t,trackId:n}=e,a=t.getMatchedTracks(n);return"AlignmentsTrack"===a[0]?.type?r.createElement(m,e):"VariantTrack"===a[0]?.type?t.hasTranslocations(n)?r.createElement(E,e):r.createElement(h,e):null}))}}]);
//# sourceMappingURL=7348.feb8cb50.chunk.js.map