"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1890],{1890(e,t,l){l.d(t,{makeImageData:()=>c});var s=l(23886),o=l(29458),n=l(24154),i=l(1449),f=l(81164),a=l(44732);async function c({ctx:e,canvasWidth:t,canvasHeight:l,renderArgs:c}){const{renderingMode:r,minorAlleleFrequencyFilter:h,sources:u,features:p,stopTokenCheck:g,lengthCutoffFilter:T,rowHeight:m,scrollTop:d,statusCallback:b=()=>{}}=c,C=m,w=Math.floor(d/C),P=Math.min(u.length,Math.ceil((d+l)/C)),k=new Map,v={},y=await(0,s.updateStatus)("Calculating stats",b,()=>(0,a.Cg)({stopTokenCheck:g,features:p.values(),minorAlleleFrequencyFilter:h,lengthCutoffFilter:T,genotypesCache:k,splitCache:v})),R={ctx:e,sources:u,startRow:w,endRow:P,h:C,w:t/y.length,scrollTop:d,splitCache:v,colorCache:{},genotypesCache:k,stopTokenCheck:g},M=await(0,s.updateStatus)("Drawing variant matrix",b,()=>"phased"===r?function(e,t){const{ctx:l,sources:s,startRow:i,endRow:a,h:c,w:r,scrollTop:h,splitCache:u,genotypesCache:p,stopTokenCheck:g}=e,T=[];for(let e=0,m=t.length;e<m;e++){const{feature:m}=t[e],d=[],b=m.get("FORMAT")?.includes("PS"),C=e*r;if(b){const e=m.get("samples");for(let t=i;t<a;t++){const o=t*c-h,i=s[t],{name:a,HP:p,baseName:g}=i,T=e[g??a];if(T){const e=T.GT?.[0];if(e)if(d.push(e),e.includes("|")){const t=T.PS?.[0],s=u[e]??(u[e]=e.split("|"));(0,f.E)(s,l,C,o,r,c,p,t)}else l.fillStyle="black",l.fillRect(C-n.f2,o-n.f2,r+n.f2,c+n.f2)}}}else{const e=m.id();let t=p.get(e);t||(t=m.get("genotypes"),p.set(e,t));for(let e=i;e<a;e++){const o=e*c-h,i=s[e],{name:a,HP:p,baseName:g}=i,T=t[g??a];if(T)if(d.push(T),T.includes("|")){const e=u[T]??(u[T]=T.split("|"));(0,f.E)(e,l,C,o,r,c,p)}else l.fillStyle="black",l.fillRect(C-n.f2,o-n.f2,r+n.f2,c+n.f2)}}T.push(d),(0,o.As)(g)}return T}(R,y):function(e,t){const{ctx:l,sources:s,startRow:n,endRow:f,h:a,w:c,scrollTop:r,splitCache:h,stopTokenCheck:u,colorCache:p,genotypesCache:g}=e,T=[];for(let e=0,m=t.length;e<m;e++){const{feature:m,mostFrequentAlt:d}=t[e],b=[],C=m.get("FORMAT")?.includes("PS"),w=e*c;if(C){const e=m.get("samples");for(let t=n;t<f;t++){const o=t*a-r,n=s[t],f=e[n.baseName??n.name];if(f){const e=f.GT?.[0];if(e){b.push(e);const t=(0,i.Bs)(e,d,p,h,!0);t&&(0,i.KP)(t,l,w,o,c,a)}}}}else{const e=m.id();let t=g.get(e);t||(t=m.get("genotypes"),g.set(e,t));for(let e=n;e<f;e++){const o=e*a-r,n=s[e],f=t[n.baseName??n.name];if(f){b.push(f);const e=(0,i.Bs)(f,d,p,h,!0);e&&(0,i.KP)(e,l,w,o,c,a)}}}T.push(b),(0,o.As)(u)}return T}(R,y)),F=y.map(({feature:e})=>({alt:e.get("ALT"),ref:e.get("REF"),name:e.get("name"),description:e.get("description"),length:e.get("end")-e.get("start")}));return{mafs:y,arr:M,featureData:F}}},1449(e,t,l){l.d(t,{Bs:()=>n,KP:()=>i});var s=l(53121),o=l(24154);function n(e,t,l,n,i){const f=`${e}:${t}`;let a=l[f];if(void 0===a){let c=0,r=0,h=0,u=0;const p=n[e]??(n[e]=e.split(/[/|]/)),g=p.length;for(let e=0;e<g;e++){const l=p[e];l===t?c++:"0"===l?u++:"."===l?r++:h++}a=function(e,t,l,n,i,f=!0){if(e===i)return f?o.Us:"";if(!(t||l||n))return"";let a;if(t){const e=80-t/i*50;a=(0,s.M)(`hsl(${o.Lp},${o.V4}%,${e}%)`)}if(l){const e=`hsla(0,100%,20%,${l/i})`;a=a?a.mix(e):(0,s.M)(e)}if(n){const e=n/i,t=o.FX.replace(")",`,${e})`).replace("hsl","hsla");a=a?a.mix(t):(0,s.M)(t)}return a?.toHex()||"black"}(u,c,h,r,g,i),l[f]=a}return a}function i(e,t,l,n,i,f,a="",c,r=1){if(t.fillStyle=1!==r?(0,s.M)(e).alpha(r).toHex():e,"inversion"===a)1===c?(t.beginPath(),t.moveTo(l-o.f2,n-o.f2),t.lineTo(l-o.f2,n+f+o.f2),t.lineTo(l+i+o.f2,n+f/2),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(l+i+o.f2,n-o.f2),t.lineTo(l+i+o.f2,n+f+o.f2),t.lineTo(l-o.f2,n+f/2),t.closePath(),t.fill());else if("insertion"===a){const e=3;t.beginPath(),t.moveTo(l-o.f2-e,n-o.f2),t.lineTo(l+i+o.f2+e,n-o.f2),t.lineTo(l+i/2,n+f+o.f2),t.closePath(),t.fill()}else t.fillRect(l-o.f2,n-o.f2,i+o.f2,f+o.f2)}},81164(e,t,l){l.d(t,{E:()=>i});var s=l(92558),o=l(53121),n=l(24154);function i(e,t,l,i,f,a,c,r,h=!0,u=1,p="",g){const T=+e[c],m=T?void 0!==r?`hsl(${+r%255}, 50%, 50%)`||n.lh:s.set1[T-1]||n.lh:h?n.Us:void 0;if(m)if(t.fillStyle=1!==u?(0,o.M)(m).alpha(u).toHex():m,"inversion"===p)1===g?(t.beginPath(),t.moveTo(l-n.f2,i-n.f2),t.lineTo(l-n.f2,i+a+n.f2),t.lineTo(l+f+n.f2,i+a/2),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(l+f+n.f2,i-n.f2),t.lineTo(l+f+n.f2,i+a+n.f2),t.lineTo(l-n.f2,i+a/2),t.closePath(),t.fill());else if("insertion"===p){const e=3;t.beginPath(),t.moveTo(l-n.f2-e,i-n.f2),t.lineTo(l+f+n.f2+e,i-n.f2),t.lineTo(l+f/2,i+a+n.f2),t.closePath(),t.fill()}else t.fillRect(l-n.f2,i-n.f2,f+n.f2,a+n.f2);return m}}}]);
//# sourceMappingURL=1890.5d2ceed3.chunk.js.map