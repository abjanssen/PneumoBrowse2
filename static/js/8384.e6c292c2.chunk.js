"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8384],{30385:(e,t,n)=>{n.d(t,{C4:()=>d,OX:()=>f,Ww:()=>u,xx:()=>s});var o=n(99546),a=n(79610);const s=16581375;function r(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const i={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},l=3,c=1600;function f(e,t,n,o){return Math.floor((255*e*255+255*t+n-1)/o)}function u(e,t,n){const f=(0,o.getContainingView)(e),u=f.drawCurves,d=f.drawCIGAR,g=f.drawCIGARMatchesOnly,{level:h,height:v,featPositions:m}=e,b=f.width,p=f.views.map(e=>e.bpPerPx);n&&(n.imageSmoothingEnabled=!1),t.beginPath();const x=f.views.map(e=>e.offsetPx),C=Math.floor(s/m.length);t.fillStyle=i.M,t.strokeStyle=i.M;for(const{p11:e,p12:n,p21:o,p22:a}of m){const s=e.offsetPx-x[h],r=n.offsetPx-x[h],i=o.offsetPx-x[h+1],f=a.offsetPx-x[h+1],d=Math.abs(r-s),g=Math.abs(f-i),m=0,p=v,C=(p-m)/2;d<=l&&g<=l&&i<b+c&&i>-c&&(t.moveTo(s,m),u?t.bezierCurveTo(s,C,i,C,i,p):t.lineTo(i,p))}t.stroke(),t.fillStyle=i.M,t.strokeStyle=i.M;for(const{p11:e,p12:C,p21:M,p22:w,f:k,cigar:S}of m){const m=e.offsetPx-x[h],P=C.offsetPx-x[h],$=M.offsetPx-x[h+1],T=w.offsetPx-x[h+1],y=Math.abs(P-m),I=Math.abs(T-$),L=Math.min($,T),R=Math.max($,T),X=0,j=v,E=(j-X)/2;if(!(y<=l&&I<=l)&&(0,o.doesIntersect2)(L,R,-c,f.width+c)){const e=k.get("strand"),o=-1===e?P:m,l=o<(-1===e?m:P)?1:-1,c=($<T?1:-1)*e;let f=o,v=-1===e?T:$;if(S.length&&d){let e=!1,o=0,d=0;const m=Math.floor(s/S.length);for(let s=0;s<S.length;s+=2){const x=s*m+1,C=+S[s],M=S[s+1];e||(o=f,d=v);const w=C/p[h],k=C/p[h+1];if("M"===M||"="===M||"X"===M?(f+=w*l,v+=k*c):"D"===M||"N"===M?f+=w*l:"I"===M&&(v+=k*c),!(Math.max(o,d,f,v)<0||Math.min(o,d,f,v)>b)){const l=s<S.length-2;if(Math.abs(f-o)<=1&&Math.abs(v-d)<=1&&l)e=!0;else{const s=e&&w>1||k>1?M:"M";t.fillStyle=i[s],e=!1,g?"M"===s&&((0,a.$2)(t,o,f,X,v,d,j,E,u),t.fill()):((0,a.$2)(t,o,f,X,v,d,j,E,u),t.fill()),n&&(n.fillStyle=r(x),(0,a.$2)(n,o,f,X,v,d,j,E,u),n.fill())}}}}else(0,a.$2)(t,m,P,X,T,$,j,E,u),t.fill()}}const M=e.clickMapCanvas?.getContext("2d");if(M){M.imageSmoothingEnabled=!1,M.clearRect(0,0,b,v);for(let e=0;e<m.length;e++){const t=m[e],n=e*C+1;M.fillStyle=r(n),(0,a.mr)({cb:e=>{e.fill()},feature:t,ctx:M,drawCurves:u,level:h,offsets:x,oobLimit:c,viewWidth:f.width,hideTiny:!0,height:v})}}}function d(e){const{level:t,clickId:n,mouseoverId:s}=e,r=(0,o.getContainingView)(e),i=r.drawCurves,l=e.height,f=r.width,u=e.mouseoverCanvas?.getContext("2d"),d=r.views.map(e=>e.offsetPx);if(!u)return;u.resetTransform(),u.scale(1,1),u.clearRect(0,0,f,l),u.strokeStyle="rgba(0, 0, 0, 0.9)",u.fillStyle="rgba(0, 0, 0, 0.1)";const g=e.featMap[s||""];g&&(0,a.mr)({cb:e=>{e.fill()},feature:g,level:t,ctx:u,oobLimit:c,viewWidth:r.width,drawCurves:i,offsets:d,height:l});const h=e.featMap[n||""];h&&(0,a.mr)({cb:e=>{e.stroke()},feature:h,ctx:u,level:t,oobLimit:c,viewWidth:r.width,drawCurves:i,offsets:d,height:l})}},79610:(e,t,n)=>{n.d(t,{$2:()=>r,Eg:()=>c,WT:()=>i,f0:()=>l,mr:()=>s});var o=n(99546),a=n(30385);function s({feature:e,ctx:t,offsets:n,level:a,cb:s,height:i,drawCurves:l,oobLimit:c,viewWidth:f,hideTiny:u}){const{p11:d,p12:g,p21:h,p22:v}=e,m=d.offsetPx-n[a],b=g.offsetPx-n[a],p=h.offsetPx-n[a+1],x=v.offsetPx-n[a+1],C=Math.abs(b-m),M=Math.abs(x-p),w=i,k=(w-0)/2,S=Math.min(p,x),P=Math.max(p,x);(0,o.doesIntersect2)(S,P,-c,f+c)&&(C<=1&&M<=1?u||(t.beginPath(),t.moveTo(m,0),l?t.bezierCurveTo(m,k,p,k,p,w):t.lineTo(p,w),t.stroke()):(r(t,m,b,0,x,p,w,k,l),s(t)))}function r(e,t,n,o,a,s,r,i,l){l?function(e,t,n,o,a,s,r,i){const l=Math.abs(t-n),c=Math.abs(t-n);if(l<5&&c<5&&n<t&&Math.abs(t-a)>100){const e=t;t=n,n=e}e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.bezierCurveTo(n,i,a,i,a,r),e.lineTo(s,r),e.bezierCurveTo(s,i,t,i,t,o),e.closePath()}(e,t,n,o,a,s,r,i):function(e,t,n,o,a,s,r){e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.lineTo(a,r),e.lineTo(s,r),e.closePath()}(e,t,n,o,a,s,r)}function i(e,t){const n=(0,o.getContainingView)(t),s=(0,o.getContainingTrack)(t),{featPositions:r,numFeats:i,clickMapCanvas:l,cigarClickMapCanvas:c,level:f}=t;if(!l||!c)return;const u=l.getBoundingClientRect(),d=l.getContext("2d"),g=c.getContext("2d");if(!d||!g)return;const h=e.clientX-u.left,v=e.clientY-u.top,[m,b,p]=d.getImageData(h,v,1,1).data,x=Math.floor(a.xx/i),C=r[(0,a.OX)(m,b,p,x)];if(C){const{f:e}=C;t.setClickId(e.id());const a=(0,o.getSession)(t);(0,o.isSessionModelWithWidgets)(a)&&a.showWidget(a.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:n,track:s,featureData:e.toJSON(),level:f}))}return C}function l(e,t,n){e.preventDefault();const o=t.clickMapCanvas,s=t.cigarClickMapCanvas;if(!o||!s)return;const r=o.getBoundingClientRect(),i=o.getContext("2d"),l=s.getContext("2d");if(!i||!l)return;const{clientX:c,clientY:f}=e,u=c-r.left,d=f-r.top,[g,h,v]=i.getImageData(u,d,1,1).data,m=Math.floor(a.xx/t.numFeats),b=(0,a.OX)(g,h,v,m),p=t.featPositions[b];p&&(t.setClickId(p.f.id()),n({clientX:c,clientY:f,feature:p}))}function c({feature:e,cigarOp:t,cigarOpLen:n}){const a=e.toJSON(),s=a.mate,r=a.end-a.start,i=s.end-s.start,l=a.identity,c=a.name,f=s.name;return[`Loc1: ${(0,o.assembleLocString)(a)}`,`Loc2: ${(0,o.assembleLocString)(s)}`,`Inverted: ${-1===a.strand}`,`Query len: ${r.toLocaleString("en-US")}`,`Target len: ${i.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${n}`:"",c?`Name 1: ${c}`:"",f?`Name 2: ${f}`:""].filter(e=>!!e).join("<br/>")}},88384:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var o=n(68446),a=n(67758),s=n(75785),r=n(69500);const i=(0,s.n9)()({blockError:{background:"#f1f1f1",padding:10,color:"red"}});function l(e){const t=(0,a.c)(3),{error:n}=e,{classes:o}=i(),s=`${n}`;let l;return t[0]!==o.blockError||t[1]!==s?(l=(0,r.jsx)("div",{className:o.blockError,children:s}),t[0]=o.blockError,t[1]=s,t[2]=l):l=t[2],l}const c=(0,s.n9)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10}}});function f(e){const t=(0,a.c)(3),{messageText:n}=e,{classes:o}=c();let s;return t[0]!==o.blockMessage||t[1]!==n?(s=(0,r.jsx)("div",{className:o.blockMessage,children:n}),t[0]=o.blockMessage,t[1]=n,t[2]=s):s=t[2],s}var u=n(7552),d=n(99546),g=n(42489),h=n(30385),v=n(67112);function m(e){const t=(0,a.c)(17),{model:n,onClose:o,anchorEl:s}=e;let i;t[0]!==n?(i=(0,d.getContainingView)(n),t[0]=n,t[1]=i):i=t[1];const l=i,{clientX:c,clientY:f,feature:u}=s;let g,h;t[2]!==o?(g=(e,t)=>{t(e),o()},t[2]=o,t[3]=g):g=t[3],t[4]!==c||t[5]!==f?(h={nodeType:1,getBoundingClientRect:()=>({top:f,left:c,bottom:f,right:c,width:0,height:0,x:c,y:f,toJSON(){}})},t[4]=c,t[5]=f,t[6]=h):h=t[6];const m=Boolean(s);let b,p;return t[7]!==u||t[8]!==n||t[9]!==l?(b=[{label:"Center on feature",onClick:()=>{const{f:e}=u,t=e.get("start"),o=e.get("end"),a=e.get("refName"),s=e.get("mate"),r=l.views[n.level],i=l.views[n.level+1],c=r.assemblyNames[0],f=i.assemblyNames[0];r.navToLocString(`${a}:${t}-${o}`).catch(e=>{const t=`${c}:${e}`;console.error(c,t),(0,d.getSession)(n).notifyError(t,e)}),i.navToLocString(`${s.refName}:${s.start}-${s.end}`).catch(e=>{const t=`${f}:${e}`;console.error(f,t),(0,d.getSession)(n).notifyError(t,e)})}}],t[7]=u,t[8]=n,t[9]=l,t[10]=b):b=t[10],t[11]!==o||t[12]!==g||t[13]!==h||t[14]!==m||t[15]!==b?(p=(0,r.jsx)(v.Menu,{onMenuItemClick:g,anchorEl:h,onClose:o,open:m,menuItems:b}),t[11]=o,t[12]=g,t[13]=h,t[14]=m,t[15]=b,t[16]=p):p=t[16],p}var b=n(79610);const p=(0,u.lazy)(()=>n.e(7831).then(n.bind(n,47831))),x=(0,s.n9)()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},mouseoverCanvas:{position:"absolute",pointEvents:"none"},mainCanvas:{position:"absolute"}}),C=(0,o.observer)(function({model:e}){const{classes:t}=x(),{mouseoverId:n,height:o}=e,a=(0,u.useRef)(0),s=(0,d.getContainingView)(e),i=s.width,l=(0,u.useRef)(0),c=(0,u.useRef)(!1),f=(0,u.useRef)(null),[v,C]=(0,u.useState)(),[M,w]=(0,u.useState)(""),[k,S]=(0,u.useState)(),[P,$]=(0,u.useState)(),[T,y]=(0,u.useState)(),[I,L]=(0,u.useState)(),R=(0,u.useRef)(null),X=(0,u.useCallback)(t=>{e.setMouseoverCanvasRef(t)},[e,o,i]),j=(0,u.useCallback)(t=>{e.setMainCanvasRef(t),R.current=t},[e,o,i]);(0,u.useEffect)(()=>{function e(e){if(e.preventDefault(),e.ctrlKey){l.current+=e.deltaY/500;for(const e of s.views)e.setScaleFactor(l.current<0?1-l.current:1/(1+l.current));f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{for(const t of s.views)t.setScaleFactor(1),t.zoomTo(l.current>0?t.bpPerPx*(1+l.current):t.bpPerPx/(1-l.current),e.clientX-(R.current?.getBoundingClientRect().left||0));l.current=0},300)}else Math.abs(e.deltaY)<Math.abs(e.deltaX)&&(a.current+=e.deltaX/2),c.current||(c.current=!0,window.requestAnimationFrame(()=>{(0,g.transaction)(()=>{for(const e of s.views)e.horizontalScroll(a.current);a.current=0,c.current=!1})}))}return R.current?.addEventListener("wheel",e),()=>{R.current?.removeEventListener("wheel",e)}},[e,o,i]);const E=(0,u.useCallback)(t=>{e.setClickMapCanvasRef(t)},[e,o,i]),N=(0,u.useCallback)(t=>{e.setCigarClickMapCanvasRef(t)},[e,o,i]);return(0,r.jsxs)("div",{className:t.rel,children:[(0,r.jsx)("canvas",{ref:X,width:i,height:o,className:t.mouseoverCanvas}),(0,r.jsx)("canvas",{ref:j,onMouseMove:t=>{if(void 0!==P)a.current+=P-t.clientX,$(t.clientX),c.current||(c.current=!0,window.requestAnimationFrame(()=>{(0,g.transaction)(()=>{for(const e of s.views)e.horizontalScroll(a.current);a.current=0,c.current=!1})}));else{const n=e.clickMapCanvas,o=e.cigarClickMapCanvas;if(!n||!o)return;const a=n.getBoundingClientRect(),s=n.getContext("2d"),r=o.getContext("2d");if(!s||!r)return;const{clientX:i,clientY:l}=t,c=i-a.left,f=l-a.top;S(i),L(l);const[u,d,g]=s.getImageData(c,f,1,1).data,[v,m,p]=r.getImageData(c,f,1,1).data,x=Math.floor(h.xx/e.numFeats),C=(0,h.OX)(u,d,g,x);if(e.setMouseoverId(e.featPositions[C]?.f.id()),-1===C)w("");else if(e.featPositions[C]){const{f:t,cigar:n}=e.featPositions[C],o=Math.floor(h.xx/n.length),a=(0,h.OX)(v,m,p,o);w((0,b.Eg)({feature:t,cigarOp:n[a],cigarOpLen:n[a+1]}))}}},onMouseLeave:()=>{e.setMouseoverId(void 0),y(void 0),$(void 0)},onMouseDown:e=>{$(e.clientX),y(e.clientX)},onMouseUp:t=>{$(void 0),void 0!==T&&Math.abs(t.clientX-T)<5&&(0,b.WT)(t,e)},onContextMenu:t=>{(0,b.f0)(t,e,C)},"data-testid":"synteny_canvas",className:t.mainCanvas,width:i,height:o}),(0,r.jsx)("canvas",{ref:E,className:t.pix,width:i,height:o}),(0,r.jsx)("canvas",{ref:N,className:t.pix,width:i,height:o}),n&&M&&k&&I?(0,r.jsx)(p,{title:M}):null,v?(0,r.jsx)(m,{model:e,anchorEl:v,onClose:()=>{C(void 0)}}):null]})}),M=(0,s.n9)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}});function w(e){const t=(0,a.c)(5),{message:n}=e,{classes:o}=M();let s,i;return t[0]!==n?(s=(0,r.jsx)(v.LoadingEllipses,{message:n}),t[0]=n,t[1]=s):s=t[1],t[2]!==o.loading||t[3]!==s?(i=(0,r.jsx)("div",{className:o.loading,children:s}),t[2]=o.loading,t[3]=s,t[4]=i):i=t[4],i}const k=(0,o.observer)(function({model:e}){return e.error?(0,r.jsx)(l,{error:e.error}):e.message?(0,r.jsx)(f,{messageText:e.message}):e.features?(0,r.jsx)(C,{model:e}):(0,r.jsx)(w,{message:e.loadingStatus})})}}]);
//# sourceMappingURL=8384.e6c292c2.chunk.js.map