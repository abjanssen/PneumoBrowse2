"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2786],{82786:(e,t,a)=>{a.d(t,{drawDotplot:()=>$});var o=a(68584),r=a(67112),n=a(40898),s=a(95095),f=a(87485),c=a(16062),l=a(36422);const i="fell outside of range due to CIGAR string",d="(less than min coordinate of feature)",g="(greater than max coordinate of feature)",h=1;function u(e,t,a,o,r){const n=o.get("strand")||1;if(-1===n&&([a,t]=[t,a]),e<t-h){let e=o.get("start"),a=o.get("end");const s=o.get("refName");return-1===n&&([a,e]=[e,a]),r.push({message:`feature at (X ${s}:${e}-${a}) ${i} ${d}`,effect:"clipped the feature"}),t}if(e>a+h){const e=o.get("strand")||1,t=1===e?o.get("start"):o.get("end"),n=1===e?o.get("end"):o.get("start"),s=o.get("refName");return r.push({message:`feature at (X ${s}:${t}-${n}) ${i} ${g}`,effect:"clipped the feature"}),a}return e}function p(e,t,a,o,r){if(e<t-h){const e=o.get("mate"),{refName:a,start:n,end:s}=e;return r.push({message:`feature at (Y ${a}:${n}-${s}) ${i} ${d}`,effect:"clipped the feature"}),t}if(e>a+h){const e=o.get("mate"),{refName:t,start:n,end:s}=e;return r.push({message:`feature at (Y ${t}:${n}-${s}) ${i} ${g}`,effect:"clipped the feature"}),a}return e}const{parseCigar:m}=c.aF;function b(e,t){return 1===t?e:(0,f.M)(e).alpha(t).toRgbString()}async function $(e,t){const{config:a,views:f,height:c,drawCigar:i,theme:d,alpha:g=1,minAlignmentLength:h=0,colorBy:$}=t,k=(0,o.readConfObject)(a,"color"),C=(0,o.readConfObject)(a,"posColor"),w=(0,o.readConfObject)(a,"negColor"),y=$??(0,o.readConfObject)(a,"colorBy"),B=(0,o.readConfObject)(a,"lineWidth"),P=(0,o.readConfObject)(a,"thresholds"),N=(0,o.readConfObject)(a,"thresholdsPalette"),j=a.color.isCallback,v=f[0],x=f[1],M=v.dynamicBlocks.contentBlocks[0]?.offsetPx,O=x.dynamicBlocks.contentBlocks[0]?.offsetPx,T=[];e.lineWidth=B;const{bpPerPx:S}=v,{bpPerPx:I}=x,A={...(0,l.getSnapshot)(v),staticBlocks:v.staticBlocks,width:v.width},X={...(0,l.getSnapshot)(x),staticBlocks:x.staticBlocks,width:x.width},_=(0,r.createJBrowseTheme)(d),Q=v.features||[];let R,Y,D;const G=new Map,W=e=>{if(!G.has(e)){const t=function(e){const t=function(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return Math.abs(t)}(e);return n.category10[t%n.category10.length]}(e);G.set(e,b(t,g))}return G.get(e)};"strand"===y?(R=b(C,g),Y=b(w,g)):"default"!==y||j||(D=b("#f0f"===k?_.palette.text.primary:k,g));for(const t of Q){const r=t.get("strand")||1,n=t.get("start"),f=t.get("end");if(h>0&&Math.abs(f-n)<h)continue;const l=t.get("refName"),d=t.get("mate"),$=d.refName,k=1===r?n:f,C=1===r?f:n;let w;if("strand"===y)w=-1===r?Y:R;else if("query"===y)w=W(l);else if("default"!==y||j){let e="black";if("identity"===y){const a=t.get("identity");for(let t=0;t<P.length;t++)if(a>+P[t]){e=N[t]||"black";break}}else"meanQueryIdentity"===y?e=`hsl(${200*t.get("meanScore")},100%,40%)`:"mappingQuality"===y?e=`hsl(${t.get("mappingQual")},100%,40%)`:"default"===y&&j&&(e=(0,o.readConfObject)(a,"color",{feature:t}));w=b(e,g)}else w=D;e.fillStyle=w,e.strokeStyle=w;const v=(0,s.eB)({self:A,refName:l,coord:k}),x=(0,s.eB)({self:A,refName:l,coord:C}),_=(0,s.eB)({self:X,refName:$,coord:d.start}),Q=(0,s.eB)({self:X,refName:$,coord:d.end});if(void 0!==v&&void 0!==x&&void 0!==_&&void 0!==Q){const a=v.offsetPx-M,o=x.offsetPx-M,n=_.offsetPx-O,s=Q.offsetPx-O;if(Math.abs(a-o)<=4&&Math.abs(n-s)<=4)e.beginPath(),e.arc(a,c-n,B/2,0,2*Math.PI),e.fill();else{let f=a,l=n;const d=t.get("CIGAR");if(i&&d){const i=m(d);e.beginPath(),e.moveTo(f,c-l);let g=f,h=f;for(let d=0;d<i.length;d+=2){const m=+i[d],b=i[d+1];"M"===b||"="===b||"X"===b?(f+=m/S*r,l+=m/I):"D"===b||"N"===b?f+=m/S*r:"I"===b&&(l+=m/I),f=u(f,a,o,t,T),l=p(l,n,s,t,T),(Math.abs(f-g)>.5||Math.abs(l-h)>.5)&&(e.lineTo(f,c-l),g=f,h=l)}e.stroke()}else e.beginPath(),e.moveTo(a,c-n),e.lineTo(o,c-s),e.stroke()}}else T.length<=5&&(void 0===v||void 0===x?T.push({message:`feature at (X-coord: ${l}:${k}-${C}) not plotted, fell outside of range`,effect:"feature not rendered"}):T.push({message:`feature at (Y-coord: ${$}:${d.start}-${d.end}) not plotted, fell outside of range`,effect:"feature not rendered"}))}return{warnings:T}}}}]);
//# sourceMappingURL=2786.95515af0.chunk.js.map