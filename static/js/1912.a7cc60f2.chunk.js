"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1912],{71320(e,t,n){n.d(t,{BK:()=>c,kO:()=>l,rV:()=>d});var r=n(10533),a=n(44934),i=n(23886);function o(e,t){(0,i.localStorageSetItem)(e,JSON.stringify(t))}const s="sequenceFeatureDetails";function l(){return r.types.model("SequenceFeatureDetails").volatile(()=>({showCoordinatesSetting:(0,i.localStorageGetItem)(`${s}-showCoordinatesSetting`)||"none",intronBp:(0,i.localStorageGetNumber)(`${s}-intronBp`,10),upDownBp:(0,i.localStorageGetNumber)(`${s}-upDownBp`,100),upperCaseCDS:(0,i.localStorageGetBoolean)(`${s}-upperCaseCDS`,!0),charactersPerRow:100,feature:void 0,mode:""})).actions(e=>({setFeature(t){e.feature=t},setUpDownBp(t){e.upDownBp=t},setIntronBp(t){e.intronBp=t},setUpperCaseCDS(t){e.upperCaseCDS=t},setShowCoordinates(t){e.showCoordinatesSetting=t},setMode(t){e.mode=t}})).views(e=>({get showCoordinates(){return"none"!==e.showCoordinatesSetting},get showGenomicCoordsOption(){return"gene"===e.mode||"gene_updownstream"===e.mode||"genomic"===e.mode||"genomic_sequence_updownstream"===e.mode},get hasCDS(){const t=e.feature?.type?.toLowerCase();return"mature_protein_region_of_cds"===t||e.feature?.subfeatures?.some(e=>{const t=e.type?.toLowerCase();return"cds"===t||"mature_protein_region_of_cds"===t})},get hasExon(){return e.feature?.subfeatures?.some(e=>"exon"===e.type)},get hasExonOrCDS(){return this.hasExon||this.hasCDS}})).actions(e=>({afterCreate(){(0,r.addDisposer)(e,(0,a.autorun)(function(){var t,n;o(`${s}-upDownBp`,e.upDownBp),o(`${s}-intronBp`,e.intronBp),t=`${s}-upperCaseCDS`,n=e.upperCaseCDS,(0,i.localStorageSetItem)(t,JSON.stringify(n)),(0,i.localStorageSetItem)(`${s}-showCoordinatesSetting`,e.showCoordinatesSetting)},{name:"SequenceFeatureLocalStorage"})),(0,r.addDisposer)(e,(0,a.autorun)(function(){e.setMode(e.hasCDS?"cds":e.hasExon?"cdna":"genomic")},{name:"SequenceFeatureMode"}))}}))}function c(){return l().create({})}function d(e){(0,r.destroy)(e)}},17975(e,t,n){n.d(t,{n:()=>d});var r=n(10533),a=n(44934),i=n(17378),o=n(23886),s=n(71320),l=n(39953),c=n(38817);function d(e){return r.types.model("BaseFeatureWidget",{id:c.K,type:r.types.literal("BaseFeatureWidget"),featureData:r.types.frozen(),formattedFields:r.types.frozen(),unformattedFeatureData:r.types.frozen(),view:r.types.safeReference(e.pluggableMstType("view","stateModel")),track:r.types.safeReference(e.pluggableMstType("track","stateModel")),trackId:r.types.maybe(r.types.string),trackType:r.types.maybe(r.types.string),maxDepth:r.types.maybe(r.types.number),sequenceFeatureDetails:r.types.optional((0,s.kO)(),{}),descriptions:r.types.frozen()}).volatile(()=>({error:void 0})).actions(e=>({setFeatureData(t){e.unformattedFeatureData=t},clearFeatureData(){e.featureData=void 0},setFormattedData(t){e.featureData=t},setExtra(t,n,r){e.trackId=n,e.trackType=t,e.maxDepth=r},setError(t){e.error=t}})).actions(e=>({afterCreate(){(0,r.addDisposer)(e,(0,a.autorun)(function(){try{const{unformattedFeatureData:t,track:n}=e,r=(0,o.getSession)(e);if(n&&e.setExtra(n.type,n.configuration.trackId,(0,i.FI)(n,["formatDetails","maxDepth"])),t){const a=structuredClone(t),o=(e,t)=>({...(0,i.FI)(r,["formatDetails",e],{feature:t}),...(0,i.FI)(n,["formatDetails",e],{feature:t})});n&&(a.__jbrowsefmt=o("feature",a),(0,l.fq)(a,(0,i.FI)(n,["formatDetails","depth"]),e=>{e.__jbrowsefmt=o("subfeatures",e)})),e.setFormattedData(a)}}catch(t){console.error(t),e.setError(t)}},{name:"FeatureWidget"}))}})).preProcessSnapshot(e=>{const{featureData:t,finalizedFeatureData:n,...r}=e;return{unformattedFeatureData:t,featureData:n,...r}}).postProcessSnapshot(e=>{const{unformattedFeatureData:t,featureData:n,...r}=e,a=JSON.stringify(n,(e,t)=>void 0===t?null:t);return{finalizedFeatureData:!a||a.length>2e6?void 0:JSON.parse(a),...r}})}},39953(e,t,n){function r(e,t){return e.map(e=>t.slice(e.start,e.end)).join("")}function a(e){return`${e.start}-${e.end}`}function i(e){return e.filter((e,t,n)=>!t||a(e)!==a(n[t-1]))}function o(e,t){return e.map(e=>({...e,start:t-e.end,end:t-e.start})).sort((e,t)=>e.start-t.start)}function s(e,t){if(!e.length)return[];if(t.length<e.length)return console.warn("exons.length less than cds.length, cant calculate UTR properly",{exons:t,cds:e}),[];const n=e.at(0),r=e.at(-1),a=t.findIndex(e=>e.end>=n.start&&e.start<=n.start),i=t.findIndex(e=>e.end>=r.end&&e.start<=r.end),o=t[i],s=t[a];return[...[...t.slice(0,a),{start:s.start,end:n.start}].map(e=>({...e,type:"five_prime_UTR"})),...[{start:r.end,end:o.end},...t.slice(i+1)].map(e=>({...e,type:"three_prime_UTR"}))]}function l(e,t){if(!e.length)return[];const n=e.at(0),r=e.at(-1);return[...[{start:t.start,end:n.start}].map(e=>({...e,type:"five_prime_UTR"})),...[{start:r.end,end:t.end}].map(e=>({...e,type:"three_prime_UTR"}))]}function c(e){return e.length>20?`${e.slice(0,20)}...`:e}function d(e){return JSON.parse(JSON.stringify(e,(e,t)=>void 0===t?null:t))}function u(e,t,n,r=0,a={}){t<=r||e.subfeatures?.map(e=>{u(e,t,n,r+1,a),n(e)})}n.d(t,{Il:()=>d,SC:()=>i,SX:()=>c,V4:()=>l,YC:()=>o,fq:()=>u,h8:()=>s,o9:()=>r})},36082(e,t,n){n.d(t,{A:()=>r});class r{install(e){}configure(e){}}},26994(e,t,n){n.d(t,{A:()=>J});var r={};n.r(r),n.d(r,{CoreFreeResources:()=>P,CoreGetExportData:()=>F,CoreGetFeatureDensityStats:()=>L,CoreGetFeatureDetails:()=>b,CoreGetFeatures:()=>C,CoreGetFileInfo:()=>v,CoreGetMetadata:()=>w,CoreGetRefNames:()=>m,CoreGetRegions:()=>R,CoreGetSequence:()=>T,CoreRender:()=>I});var a=n(10533),i=n(30128),o=n(60459);const s=(0,o.S7)("BaseFeatureWidget",{});var l=n(17975),c=n(36082);const d=(0,o.S7)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,cytobandLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var u=n(61941),p=n(52188),h=n(89674),g=n(95548),f=n(40507);class m extends f.A{name="CoreGetRefNames";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:i,sequenceAdapter:o}=r,{dataAdapter:s}=await(0,g.cK)(n,a,i);return(0,h.c7)(s)?(o&&!s.sequenceAdapterConfig&&s.setSequenceAdapterConfig(o),s.getRefNames(r)):[]}}var y=n(23886);class b extends f.A{name="CoreGetFeatureDetails";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,y.renameRegionsIfNeeded)(r,e),i=await super.serializeArguments(a,t),{rendererType:o}=e;return this.pluginManager.getRendererType(o).serializeArgsInClient(i)}async execute(e,t){const n=await this.deserializeArguments(e,t),{rendererType:r,featureId:a}=n,i=this.pluginManager.getRendererType(r);return{feature:i.getLayoutSession(e)?.cachedLayout.layout.getDataByID(a)?.toJSON()}}}class w extends f.A{name="CoreGetMetadata";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:i}=r,{dataAdapter:o}=await(0,g.cK)(n,a,i);return(0,h.c7)(o)?o.getMetadata(r):null}}class v extends f.A{name="CoreGetInfo";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:i}=r,{dataAdapter:o}=await(0,g.cK)(n,a,i);return(0,h.c7)(o)?o.getHeader(r):null}}var S=n(88068),x=n(90013),k=n(43102);class C extends f.A{name="CoreGetFeatures";async deserializeReturn(e,t,n){return(await super.deserializeReturn(e,t,n)).map(e=>new k.A(e))}async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,y.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}async execute(e,t){const{stopToken:n,statusCallback:r,sessionId:a,adapterConfig:i,regions:o,opts:s}=await this.deserializeArguments(e,t),l=(await(0,g.cK)(this.pluginManager,a,i)).dataAdapter;return(await(0,S._)(l.getFeaturesInMultipleRegions(o,{...s,statusCallback:r,stopToken:n}).pipe((0,x.$)()))).map(e=>e.toJSON())}}class T extends f.A{name="CoreGetSequence";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,y.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}async execute(e,t){const{stopToken:n,sessionId:r,adapterConfig:a,region:i}=await this.deserializeArguments(e,t);return(await(0,g.cK)(this.pluginManager,r,a)).dataAdapter.getSequence(i,{stopToken:n})}}function A(e,t){if(!t.ReactComponent)throw new Error(`renderer ${e} has no ReactComponent, it may not be completely implemented yet`);return t}var M=n(19608);class I extends f.A{name="CoreRender";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,y.renameRegionsIfNeeded)(r,e),i=await super.serializeArguments(a,t);return A(e.rendererType,this.pluginManager.getRendererType(e.rendererType)).serializeArgsInClient(i)}async executeDirect(e){const{rootModel:t}=this.pluginManager,n=t.session.assemblyManager,r=await(0,y.renameRegionsIfNeeded)(n,e),{sessionId:a,rendererType:i}=r;if(!a)throw new Error("must pass a unique session id");const{renderingProps:o,...s}=r,l=(0,M.getBlobMap)();return(0,f.W)(s,l),(0,M.setBlobMap)(l),A(i,this.pluginManager.getRendererType(i)).renderDirect({...s,renderingProps:o})}async execute(e,t){const n=await this.deserializeArguments(e,t),{sessionId:r,rendererType:a}=n;if(!r)throw new Error("must pass a unique session id");return A(a,this.pluginManager.getRendererType(a)).renderInWorker(n)}async deserializeReturn(e,t,n){const r=await super.deserializeReturn(e,t,n);return A(t.rendererType,this.pluginManager.getRendererType(t.rendererType)).deserializeResultsInClient(r,t)}}class P extends f.A{name="CoreFreeResources";async execute(e){await(0,g.pZ)(e);for(const t of this.pluginManager.getRendererTypes())t.freeResources(e)}async serializeArguments(e,t){return e}}class L extends f.A{name="CoreGetFeatureDensityStats";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,y.renameRegionsIfNeeded)(r,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(a,t)}async execute(e,t){const n=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:a,regions:i}=n,{dataAdapter:o}=await(0,g.cK)(this.pluginManager,a,r);if(!(0,h.c7)(o))throw new Error("Adapter does not support retrieving features");return o.getMultiRegionFeatureDensityStats(i,n)}}class R extends f.A{name="CoreGetRegions";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:i}=r,{dataAdapter:o}=await(0,g.cK)(n,a,i);return(0,h.DD)(o)?o.getRegions(r):[]}}class F extends f.A{name="CoreGetExportData";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,y.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}async execute(e,t){const{sessionId:n,adapterConfig:r,regions:a,formatType:i,opts:o}=await this.deserializeArguments(e,t),s=(await(0,g.cK)(this.pluginManager,n,r)).dataAdapter;return await s.getExportData(a,i,o)||""}}class D extends c.A{name="CorePlugin";install(e){for(const t of Object.values(r))e.addRpcMethod(()=>new t(e));!function(e){e.addAdapterType(()=>new u.A({name:"CytobandAdapter",configSchema:d,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(32).then(n.bind(n,10032)).then(e=>e.default)}))}(e),e.addWidgetType(()=>new p.A({name:"BaseFeatureWidget",heading:"Feature details",configSchema:s,stateModel:(0,l.n)(e),ReactComponent:(0,i.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8705),n.e(5043),n.e(6569),n.e(2943),n.e(9024)]).then(n.bind(n,89024)))}))}}class N{phaseCallbacks=new Map;phaseOrder=[];constructor(...e){this.phaseOrder=e}add(e,t){if(!this.phaseOrder.includes(e))throw new Error(`unknown phase ${e}`);let n=this.phaseCallbacks.get(e);n||(n=[],this.phaseCallbacks.set(e,n)),n.push(t)}run(){for(const e of this.phaseOrder)for(const t of this.phaseCallbacks.get(e)||[])t()}}var B=n(22669),V=n(17378),E=n(91667),z=n(78544),j=n(50492),H=n(26636),_=n(90106),$=n(73876),O=n(88237),G=n(97849),W=n(64458),U=n(72769);class q{registeredTypes={};constructor(e,t){this.typeName=e,this.baseClass=t}add(e,t){this.registeredTypes[e]=t}has(e){return e in this.registeredTypes}get(e){if(!this.has(e))throw new Error(`${this.typeName} '${e}' not found, perhaps its plugin is not loaded or its plugin has not added it.`);return this.registeredTypes[e]}all(){return Object.values(this.registeredTypes)}}class J{plugins=[];jexl=(0,U.A)();pluginMetadata={};runtimePluginDefinitions=[];elementCreationSchedule=new N("glyph","renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account","add track workflow");glyphTypes=new q("GlyphType",H.A);rendererTypes=new q("RendererType",W.default);adapterTypes=new q("AdapterType",u.A);textSearchAdapterTypes=new q("TextSearchAdapterType",$.A);trackTypes=new q("TrackType",O.A);displayTypes=new q("DisplayType",j.A);connectionTypes=new q("ConnectionType",z.A);viewTypes=new q("ViewType",G.A);widgetTypes=new q("WidgetType",p.A);rpcMethods=new q("RpcMethodType",f.A);addTrackWidgets=new q("AddTrackWorkflow",E.A);internetAccountTypes=new q("InternetAccountType",_.A);configured=!1;extensionPoints=new Map;constructor(e=[]){this.addPlugin({plugin:new D,metadata:{isCore:!0}});for(const t of e)this.addPlugin(t)}pluginConfigurationNamespacedSchemas(){const e={};for(const t of this.plugins)t.configurationSchema&&(e[t.name]=t.configurationSchema);return e}pluginConfigurationUnnamespacedSchemas(){let e={};for(const t of this.plugins)t.configurationSchemaUnnamespaced&&(e={...e,...t.configurationSchemaUnnamespaced});return e}pluginConfigurationRootSchemas(){let e={};for(const t of this.plugins)t.rootConfigurationSchema&&(e={...e,...t.rootConfigurationSchema(this)});return e}addPlugin(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");const[t,n={}]="install"in e&&"configure"in e?[e,{}]:[e.plugin,e.metadata];if(this.plugins.includes(t))throw new Error("plugin already installed");return this.pluginMetadata[t.name]=n,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),t.install(this),this.plugins.push(t),this}getPlugin(e){return this.plugins.find(t=>t.name===e)}hasPlugin(e){return void 0!==this.getPlugin(e)}createPluggableElements(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),this.elementCreationSchedule=void 0),this}setRootModel(e){return this.rootModel=e,this}configure(){if(this.configured)throw new Error("already configured");for(const e of this.plugins)e.configure(this);return this.configured=!0,this}getElementTypeRecord(e){switch(e){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;case"add track workflow":return this.addTrackWidgets;case"glyph":return this.glyphTypes;default:throw new Error(`invalid element type '${e}'`)}}addElementType(e,t){if("function"!=typeof t)throw new Error("must provide a callback function that returns the new type object");const n=this.getElementTypeRecord(e);return this.elementCreationSchedule?.add(e,()=>{const r=t(this);if(!r.name)throw new Error(`cannot add a ${e} with no name`);n.has(r.name)?console.warn(`${e} ${r.name} already registered, cannot register it again`):n.add(r.name,this.evaluateExtensionPoint("Core-extendPluggableElement",r))}),this}getElementType(e,t){return this.getElementTypeRecord(e).get(t)}getElementTypesInGroup(e){return this.getElementTypeRecord(e).all()}getViewElements(){return this.getElementTypesInGroup("view")}getTrackElements(){return this.getElementTypesInGroup("track")}getConnectionElements(){return this.getElementTypesInGroup("connection")}getAddTrackWorkflowElements(){return this.getElementTypesInGroup("add track workflow")}getRpcElements(){return this.getElementTypesInGroup("rpc method")}getDisplayElements(){return this.getElementTypesInGroup("display")}getAdapterElements(){return this.getElementTypesInGroup("adapter")}pluggableMstType(e,t,n=a.types.maybe(a.types.null)){const r=this.getElementTypeRecord(e).all().map(e=>e[t]).filter(e=>(0,a.isType)(e)&&(0,a.isModelType)(e));return 0===r.length&&"undefined"==typeof jest?(console.warn(`No pluggable types found matching ('${e}','${t}')`),n):a.types.union(...r)}pluggableConfigSchemaType(e,t="configSchema"){const n=this.getElementTypeRecord(e).all().map(e=>e[t]).filter(e=>(0,V.C$)(e));return 0===n.length&&n.push((0,o.S7)("Null",{})),a.types.union(...n)}jbrequireCache=new Map;lib=B.A;load=e=>(this.jbrequireCache.has(e)||this.jbrequireCache.set(e,e(this)),this.jbrequireCache.get(e));jbrequire=e=>{if("string"==typeof e){const t=this.lib[e];if(!t)throw new TypeError(`No jbrequire re-export defined for package '${e}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`);return t}if("function"==typeof e)return this.load(e);if(e.default)return console.warn("initiated jbrequire on a {default:Function}"),this.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")};getRendererType(e){return this.rendererTypes.get(e)}getRendererTypes(){return this.rendererTypes.all()}getAdapterType(e){return this.adapterTypes.get(e)}getTextSearchAdapterType(e){return this.textSearchAdapterTypes.get(e)}getTrackType(e){return this.trackTypes.get(e)}getDisplayType(e){return this.displayTypes.get(e)}getViewType(e){return this.viewTypes.get(e)}getAddTrackWorkflow(e){return this.addTrackWidgets.get(e)}getWidgetType(e){return this.widgetTypes.get(e)}getConnectionType(e){return this.connectionTypes.get(e)}getRpcMethodType(e){return this.rpcMethods.get(e)}getInternetAccountType(e){return this.internetAccountTypes.get(e)}addRendererType(e){return this.addElementType("renderer",e)}addAdapterType(e){return this.addElementType("adapter",e)}addTextSearchAdapterType(e){return this.addElementType("text search adapter",e)}addTrackType(e){return this.addElementType("track",()=>{const t=e(this),n=this.getElementTypesInGroup("display");for(const e of n)e.trackType!==t.name||t.displayTypes.includes(e)||t.addDisplayType(e);return t})}addDisplayType(e){return this.addElementType("display",e)}addViewType(e){return this.addElementType("view",()=>{const t=e(this),n=this.getElementTypesInGroup("display");for(const e of n)e.viewType!==t.name&&e.viewType!==t.extendedName||t.displayTypes.includes(e)||t.addDisplayType(e);return t})}addWidgetType(e){return this.addElementType("widget",e)}addConnectionType(e){return this.addElementType("connection",e)}addRpcMethod(e){return this.addElementType("rpc method",e)}addInternetAccountType(e){return this.addElementType("internet account",e)}addAddTrackWorkflowType(e){return this.addElementType("add track workflow",e)}addGlyphType(e){return this.addElementType("glyph",e)}getGlyphType(e){return this.glyphTypes.get(e)}getGlyphTypes(){return this.glyphTypes.all()}addToExtensionPoint(e,t){let n=this.extensionPoints.get(e);n||(n=[],this.extensionPoints.set(e,n)),n.push(t)}evaluateExtensionPoint(e,t,n){const r=this.extensionPoints.get(e);let a=t;if(r)for(const e of r)try{a=e(a,n)}catch(e){console.error(e)}return a}async evaluateAsyncExtensionPoint(e,t,n){const r=this.extensionPoints.get(e);let a=t;if(r)for(const e of r)try{a=await e(a,n)}catch(e){console.error(e)}return a}}},22669(e,t,n){n.d(t,{A:()=>Fe});var r={};n.r(r),n.d(r,{ConfigurationReference:()=>N.AK,ConfigurationSchema:()=>N.S7,getConf:()=>B.FI,getTypeNamesFromExplicitlyTypedUnion:()=>B.JC,isBareConfigurationSchemaType:()=>B.C$,isConfigurationModel:()=>B.wo,isConfigurationSchemaType:()=>B.oG,isConfigurationSlotType:()=>B.Rg,readConfObject:()=>B.QZ});var a={};n.r(a),n.d(a,{BaseAdapter:()=>E.D,BaseFeatureDataAdapter:()=>z.L,BaseSequenceAdapter:()=>j.Q,isFeatureAdapter:()=>V.c7,isRefNameAliasAdapter:()=>V.iD,isRegionsAdapter:()=>V.DD,isSequenceAdapter:()=>V.z_,isTextSearchAdapter:()=>V.V0});var i={};n.r(i),n.d(i,{BaseConnectionModelFactory:()=>K.A,BaseDisplay:()=>Z.q,BaseInternetAccountConfig:()=>ee.y,BaseViewModel:()=>Q.A,InternetAccount:()=>Y.X,baseConnectionConfig:()=>X.A,createBaseTrackConfig:()=>ne.J,createBaseTrackModel:()=>te.E});var o={};n.r(o),n.d(o,{AdapterType:()=>H.A,AddTrackWorkflowType:()=>le.A,BaseConnectionModelFactory:()=>K.A,BaseDisplay:()=>Z.q,BaseInternetAccountConfig:()=>ee.y,BaseViewModel:()=>Q.A,BoxRendererType:()=>W.default,CircularChordRendererType:()=>U.A,ConnectionType:()=>ae.A,DisplayType:()=>_.A,FeatureRendererType:()=>q.default,GlyphType:()=>oe.A,InternetAccount:()=>Y.X,InternetAccountType:()=>ie.A,RendererType:()=>re.default,RpcMethodType:()=>se.A,ServerSideRendererType:()=>J.default,TextSearchAdapterType:()=>ce.A,TrackType:()=>$.A,ViewType:()=>O.A,WidgetType:()=>G.A,baseConnectionConfig:()=>X.A,createBaseTrackConfig:()=>ne.J,createBaseTrackModel:()=>te.E});var s={};n.r(s),n.d(s,{GranularRectLayout:()=>me.A,MultiLayout:()=>ye.A,PileupLayout:()=>be.A,PrecomputedLayout:()=>we.A,SceneGraph:()=>ve});var l=n(30128),c=n.t(l,2),d=n(10533),u=n(87377),p=n(7201),h=n(33560),g=n(34442),f=n(29884),m=n(52874),y=n(4380),b=n(93395),w=n(44934),v=n(69566),S=n(44460),x=n.t(S,2),k=n(23772),C=n.t(k,2),T=n(67845),A=n.t(T,2),M=n(36082),I=n(55614);function P(e,t=""){return Object.fromEntries(Object.entries(e).map(([e,n])=>function(e,t){const n=(0,l.forwardRef)((e,n)=>{const r=(0,I.c)(3);let a;return r[0]!==e||r[1]!==n?(a=(0,S.jsx)(l.Suspense,{fallback:null,children:(0,S.jsx)(t,{...e,ref:n})}),r[0]=e,r[1]=n,r[2]=a):a=r[2],a});return n.displayName=e,[e,n]}(`${t}${e}`,n)))}const L=P({Attributes:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(5043),n.e(6569),n.e(6537)]).then(n.bind(n,16569))),FeatureDetails:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8705),n.e(5043),n.e(6569),n.e(2943)]).then(n.bind(n,63935))),BaseCard:(0,l.lazy)(()=>Promise.all([n.e(8705),n.e(6551)]).then(n.bind(n,86551))),BaseAttributes:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8705),n.e(5043),n.e(6569),n.e(1494)]).then(n.bind(n,83558))),BaseCoreDetails:(0,l.lazy)(()=>Promise.all([n.e(8705),n.e(6960)]).then(n.bind(n,66960)))},"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail/"),R={DataGrid:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.DataGrid}))),GridActionsCellItem:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridActionsCellItem}))),GridAddIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridAddIcon}))),GridArrowDownwardIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridArrowDownwardIcon}))),GridArrowUpwardIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridArrowUpwardIcon}))),GridCellCheckboxForwardRef:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridCellCheckboxForwardRef}))),GridCellCheckboxRenderer:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridCellCheckboxRenderer}))),GridCheckCircleIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridCheckCircleIcon}))),GridCheckIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridCheckIcon}))),GridCloseIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridCloseIcon}))),GridColumnHeaderSeparator:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridColumnHeaderSeparator}))),GridColumnHeaderSortIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridColumnHeaderSortIcon}))),GridColumnIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridColumnIcon}))),GridColumnMenu:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridColumnMenu}))),GridColumnMenuContainer:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridColumnMenuContainer}))),GridDragIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridDragIcon}))),GridExpandMoreIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridExpandMoreIcon}))),GridFilterAltIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridFilterAltIcon}))),GridFilterForm:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridFilterForm}))),GridFilterListIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridFilterListIcon}))),GridFilterPanel:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridFilterPanel}))),GridFooter:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridFooter}))),GridFooterContainer:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridFooterContainer}))),GridHeader:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridHeader}))),GridHeaderCheckbox:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridHeaderCheckbox}))),GridKeyboardArrowRight:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridKeyboardArrowRight}))),GridLoadIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridLoadIcon}))),GridLoadingOverlay:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridLoadingOverlay}))),GridMenuIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridMenuIcon}))),GridMoreVertIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridMoreVertIcon}))),GridNoRowsOverlay:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridNoRowsOverlay}))),GridOverlay:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridOverlay}))),GridPagination:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridPagination}))),GridPanel:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridPanel}))),GridPanelWrapper:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridPanelWrapper}))),GridRemoveIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridRemoveIcon}))),GridRoot:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridRoot}))),GridRowCount:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridRowCount}))),GridSearchIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridSearchIcon}))),GridSelectedRowCount:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridSelectedRowCount}))),GridSeparatorIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridSeparatorIcon}))),GridTableRowsIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridTableRowsIcon}))),GridToolbarExportContainer:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridToolbarExportContainer}))),GridTripleDotsVerticalIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridTripleDotsVerticalIcon}))),GridViewHeadlineIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridViewHeadlineIcon}))),GridViewStreamIcon:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8055)]).then(n.bind(n,72353)).then(e=>({default:e.GridViewStreamIcon})))},F={Accordion:(0,l.lazy)(()=>Promise.all([n.e(8705),n.e(1623)]).then(n.bind(n,31623))),AccordionActions:(0,l.lazy)(()=>n.e(1676).then(n.bind(n,31676))),AccordionDetails:(0,l.lazy)(()=>n.e(4159).then(n.bind(n,14159))),AccordionSummary:(0,l.lazy)(()=>n.e(2533).then(n.bind(n,12533))),Alert:(0,l.lazy)(()=>n.e(5240).then(n.bind(n,92859))),AlertTitle:(0,l.lazy)(()=>n.e(828).then(n.bind(n,80828))),Autocomplete:(0,l.lazy)(()=>n.e(219).then(n.bind(n,50219))),Avatar:(0,l.lazy)(()=>n.e(7782).then(n.bind(n,17782))),AvatarGroup:(0,l.lazy)(()=>n.e(1689).then(n.bind(n,81689))),Backdrop:(0,l.lazy)(()=>n.e(5585).then(n.bind(n,85585))),Badge:(0,l.lazy)(()=>n.e(2078).then(n.bind(n,42078))),Box:(0,l.lazy)(()=>n.e(3876).then(n.bind(n,33876))),Breadcrumbs:(0,l.lazy)(()=>n.e(4037).then(n.bind(n,6418))),Button:(0,l.lazy)(()=>n.e(591).then(n.bind(n,70591))),ButtonGroup:(0,l.lazy)(()=>n.e(2210).then(n.bind(n,72210))),Card:(0,l.lazy)(()=>n.e(9165).then(n.bind(n,99165))),CardActions:(0,l.lazy)(()=>n.e(908).then(n.bind(n,20908))),CardActionArea:(0,l.lazy)(()=>n.e(5311).then(n.bind(n,65311))),CardContent:(0,l.lazy)(()=>n.e(1086).then(n.bind(n,71086))),CardHeader:(0,l.lazy)(()=>n.e(1528).then(n.bind(n,71528))),CardMedia:(0,l.lazy)(()=>n.e(1674).then(n.bind(n,11674))),CircularProgress:(0,l.lazy)(()=>n.e(9017).then(n.bind(n,59017))),Collapse:(0,l.lazy)(()=>n.e(5568).then(n.bind(n,95568))),ClickAwayListener:(0,l.lazy)(()=>n.e(3087).then(n.bind(n,73087))),Chip:(0,l.lazy)(()=>n.e(4913).then(n.bind(n,44913))),Checkbox:(0,l.lazy)(()=>n.e(2734).then(n.bind(n,62734))),Container:(0,l.lazy)(()=>n.e(1401).then(n.bind(n,51401))),Dialog:(0,l.lazy)(()=>n.e(4307).then(n.bind(n,4307))),DialogActions:(0,l.lazy)(()=>n.e(5902).then(n.bind(n,75902))),DialogTitle:(0,l.lazy)(()=>n.e(6835).then(n.bind(n,66835))),DialogContent:(0,l.lazy)(()=>n.e(7768).then(n.bind(n,37768))),DialogContentText:(0,l.lazy)(()=>n.e(2819).then(n.bind(n,52819))),Divider:(0,l.lazy)(()=>n.e(1816).then(n.bind(n,21816))),Drawer:(0,l.lazy)(()=>n.e(8856).then(n.bind(n,8856))),Fab:(0,l.lazy)(()=>n.e(4224).then(n.bind(n,44224))),Fade:(0,l.lazy)(()=>n.e(6469).then(n.bind(n,26469))),FilledInput:(0,l.lazy)(()=>n.e(4289).then(n.bind(n,64289))),FormLabel:(0,l.lazy)(()=>n.e(1193).then(n.bind(n,91193))),FormControl:(0,l.lazy)(()=>n.e(7198).then(n.bind(n,97198))),FormControlLabel:(0,l.lazy)(()=>n.e(4576).then(n.bind(n,14576))),FormHelperText:(0,l.lazy)(()=>n.e(2198).then(n.bind(n,52198))),FormGroup:(0,l.lazy)(()=>n.e(2424).then(n.bind(n,52424))),Grid:(0,l.lazy)(()=>Promise.all([n.e(9186),n.e(7006)]).then(n.bind(n,17006))),Grid2:(0,l.lazy)(()=>Promise.all([n.e(9186),n.e(7006)]).then(n.bind(n,17006))),Grow:(0,l.lazy)(()=>n.e(9896).then(n.bind(n,69896))),Icon:(0,l.lazy)(()=>n.e(8186).then(n.bind(n,48186))),IconButton:(0,l.lazy)(()=>n.e(3006).then(n.bind(n,83006))),Input:(0,l.lazy)(()=>n.e(4985).then(n.bind(n,94985))),InputBase:(0,l.lazy)(()=>n.e(356).then(n.bind(n,50356))),InputLabel:(0,l.lazy)(()=>n.e(3953).then(n.bind(n,23953))),InputAdornment:(0,l.lazy)(()=>n.e(8357).then(n.bind(n,58357))),Link:(0,l.lazy)(()=>n.e(4683).then(n.bind(n,94683))),LinearProgress:(0,l.lazy)(()=>n.e(4169).then(n.bind(n,44169))),List:(0,l.lazy)(()=>n.e(7751).then(n.bind(n,77751))),ListItem:(0,l.lazy)(()=>n.e(372).then(n.bind(n,20372))),ListItemAvatar:(0,l.lazy)(()=>n.e(3200).then(n.bind(n,73200))),ListItemButton:(0,l.lazy)(()=>n.e(1936).then(n.bind(n,61936))),ListItemSecondaryAction:(0,l.lazy)(()=>n.e(8244).then(n.bind(n,58244))),ListItemIcon:(0,l.lazy)(()=>n.e(4309).then(n.bind(n,94309))),ListSubheader:(0,l.lazy)(()=>n.e(9538).then(n.bind(n,9538))),ListItemText:(0,l.lazy)(()=>n.e(3671).then(n.bind(n,13671))),Menu:(0,l.lazy)(()=>n.e(7716).then(n.bind(n,67716))),MenuItem:(0,l.lazy)(()=>n.e(6575).then(n.bind(n,46575))),MenuList:(0,l.lazy)(()=>n.e(6831).then(n.bind(n,79212))),Modal:(0,l.lazy)(()=>n.e(1852).then(n.bind(n,31852))),NativeSelect:(0,l.lazy)(()=>n.e(9899).then(n.bind(n,39899))),OutlinedInput:(0,l.lazy)(()=>n.e(6683).then(n.bind(n,56683))),Pagination:(0,l.lazy)(()=>n.e(2426).then(n.bind(n,22426))),PaginationItem:(0,l.lazy)(()=>n.e(5688).then(n.bind(n,85688))),Paper:(0,l.lazy)(()=>n.e(9763).then(n.bind(n,29763))),Popover:(0,l.lazy)(()=>n.e(708).then(n.bind(n,10708))),Popper:(0,l.lazy)(()=>n.e(4293).then(n.bind(n,14293))),Portal:(0,l.lazy)(()=>n.e(1313).then(n.bind(n,81313))),Radio:(0,l.lazy)(()=>n.e(1906).then(n.bind(n,11906))),RadioGroup:(0,l.lazy)(()=>n.e(1353).then(n.bind(n,71353))),Rating:(0,l.lazy)(()=>n.e(6298).then(n.bind(n,26298))),ScopedCssBaseline:(0,l.lazy)(()=>n.e(6197).then(n.bind(n,46197))),Select:(0,l.lazy)(()=>n.e(367).then(n.bind(n,90367))),Skeleton:(0,l.lazy)(()=>n.e(4412).then(n.bind(n,34412))),Slider:(0,l.lazy)(()=>n.e(742).then(n.bind(n,742))),Snackbar:(0,l.lazy)(()=>Promise.all([n.e(7120),n.e(1720)]).then(n.bind(n,1720))),SnackbarContent:(0,l.lazy)(()=>n.e(5309).then(n.bind(n,95309))),SpeedDial:(0,l.lazy)(()=>n.e(4826).then(n.bind(n,54826))),SpeedDialAction:(0,l.lazy)(()=>n.e(1884).then(n.bind(n,81884))),SpeedDialIcon:(0,l.lazy)(()=>n.e(6656).then(n.bind(n,96656))),Stack:(0,l.lazy)(()=>n.e(3058).then(n.bind(n,23058))),Step:(0,l.lazy)(()=>n.e(7737).then(n.bind(n,77737))),StepButton:(0,l.lazy)(()=>n.e(7033).then(n.bind(n,37033))),StepConnector:(0,l.lazy)(()=>n.e(5340).then(n.bind(n,65340))),StepLabel:(0,l.lazy)(()=>n.e(33).then(n.bind(n,70033))),StepIcon:(0,l.lazy)(()=>n.e(300).then(n.bind(n,90300))),Stepper:(0,l.lazy)(()=>n.e(6680).then(n.bind(n,86680))),SvgIcon:(0,l.lazy)(()=>n.e(858).then(n.bind(n,40858))),Switch:(0,l.lazy)(()=>n.e(1583).then(n.bind(n,81583))),Tab:(0,l.lazy)(()=>n.e(1766).then(n.bind(n,81766))),Table:(0,l.lazy)(()=>n.e(3333).then(n.bind(n,53333))),TableBody:(0,l.lazy)(()=>n.e(5349).then(n.bind(n,85349))),TableCell:(0,l.lazy)(()=>n.e(4717).then(n.bind(n,64717))),TableContainer:(0,l.lazy)(()=>n.e(7632).then(n.bind(n,7632))),TableFooter:(0,l.lazy)(()=>n.e(5853).then(n.bind(n,75853))),TableHead:(0,l.lazy)(()=>n.e(3775).then(n.bind(n,13775))),TablePagination:(0,l.lazy)(()=>Promise.all([n.e(7993),n.e(224)]).then(n.bind(n,51193))),TableRow:(0,l.lazy)(()=>n.e(4911).then(n.bind(n,34911))),TableSortLabel:(0,l.lazy)(()=>n.e(6413).then(n.bind(n,6413))),Tabs:(0,l.lazy)(()=>Promise.all([n.e(5754),n.e(9839)]).then(n.bind(n,69839))),TextField:(0,l.lazy)(()=>n.e(64).then(n.bind(n,80064))),TextareaAutosize:(0,l.lazy)(()=>n.e(75).then(n.bind(n,50075))),ToggleButton:(0,l.lazy)(()=>n.e(7187).then(n.bind(n,97187))),ToggleButtonGroup:(0,l.lazy)(()=>n.e(330).then(n.bind(n,80330))),Toolbar:(0,l.lazy)(()=>n.e(6278).then(n.bind(n,6278))),Tooltip:(0,l.lazy)(()=>n.e(878).then(n.bind(n,40878))),Typography:(0,l.lazy)(()=>n.e(6642).then(n.bind(n,76642)))},D=["mobx","@jbrowse/mobx-state-tree","mobx-state-tree","react","react/jsx-runtime","react-dom","react-dom/client","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react","tss-react/mui","@material-ui/core","@mui/material","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/AccordionSummary","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grid2","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemButton","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/AccordionSummary","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grid2","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemButton","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/ui/theme","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"];var N=n(60459),B=n(17378),V=n(89674),E=n(32560),z=n(90946),j=n(60339),H=n(61941),_=n(50492),$=n(88237),O=n(97849),G=n(52188),W=n(49783),U=n(67965),q=n(7332),J=n(10678),X=n(26710),K=n(67781),Q=n(7328),Z=n(9789),Y=n(7380),ee=n(48716),te=n(5431),ne=n(8175),re=n(64458),ae=n(78544),ie=n(90106),oe=n(26636),se=n(40507),le=n(91667),ce=n(73876),de=n(10732),ue=n(56993),pe=n(64152),he=n(18846),ge=n(23886),fe=n(11931),me=n(46624),ye=n(81709),be=n(8655),we=n(58846);class ve{constructor(e,t,n,r,a,i){this.name=e,this.left=t,this.top=n,this.width=r,this.height=a,this.data=i,this.children=new Map,this.absoluteCache={dirty:!0}}addChild(e,t,n,r,a,i){const o=e instanceof ve?e:new ve(e,t,n,r,a,i);if(!(o instanceof ve))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(o.name))throw new Error(`child named "${o.name}" already exists`);o.parent=this;const{left:s,right:l,top:c,bottom:d}=o.absolute;return void 0!==s&&void 0!==l&&void 0!==c&&void 0!==d&&(this.expand(s,l,c,d),this.children.set(o.name,o)),o}getSubRecord(e){return this.children.get(e)}expand(e,t,n,r){const{left:a,right:i,top:o,bottom:s}=this.absolute;if(void 0!==a&&e<a){const t=a-e;this.width+=t,this.left-=t}if(void 0!==i&&t>i&&(this.width+=t-i),void 0!==o&&n<o){const e=o-n;this.height+=e,this.top-=e}void 0!==s&&r>s&&(this.height+=r-s),this.parent&&this.parent.expand(e,t,n,r),this.absoluteCache.dirty=!0}get bottom(){return this.top+this.height}get right(){return this.left+this.width}walkParents(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}walkChildren(e){for(const t of this.children.values())e(t),t.walkChildren(e)}get absolute(){if(this.absoluteCache.dirty){let e=0,t=0;this.walkParents(n=>{e+=n.left,t+=n.top}),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}move(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren(e=>{e.absoluteCache.dirty=!0});const{left:n,right:r,top:a,bottom:i}=this.absolute;void 0!==n&&void 0!==r&&void 0!==a&&void 0!==i&&this.expand(n,r,a,i)}}var Se=n(322),xe=n(25529),ke=n(19608),Ce=n(64261),Te=n(81285),Ae=n(46625),Me=n(7220);const Ie={mobx:w,"@jbrowse/mobx-state-tree":d,"mobx-state-tree":d,react:c,"react/jsx-runtime":x,"react-dom":C,"react-dom/client":A,"mobx-react":v,"@mui/x-data-grid":{useGridApiContext:m.h,useGridApiRef:y.b,useGridRootProps:b.A,...P(R)},"@mui/material/utils":f,"@material-ui/core/utils":f,"tss-react":{cx:Ce.cx,keyframes:Te.i7,makeStyles:Ae.n},"tss-react/mui":{cx:Ce.cx,keyframes:Te.i7,makeStyles:Ae.n},"@material-ui/core":{...P(F),useTheme:u.A,alpha:p.X4,makeStyles:e=>{const t=(0,Ae.n)()(e);return()=>t().classes}},"@mui/material":{...P(F),alpha:p.X4,useTheme:u.A,createTheme:h.A},...P(F,"@mui/material/"),...P(F,"@material-ui/core/"),"@mui/material/styles":{...g,makeStyles:e=>{const t=(0,Ae.n)()(e);return()=>t().classes}},"@material-ui/core/styles":{...g,makeStyles:e=>{const t=(0,Ae.n)()(e);return()=>t().classes}},"@material-ui/lab/ToggleButton":F.ToggleButton,"@material-ui/lab/ToggleButtonGroup":F.ToggleButtonGroup,"@material-ui/lab/Autocomplete":F.Autocomplete,"@material-ui/lab/Alert":F.Alert,"@material-ui/lab":{Alert:F.Alert,Autocomplete:F.Autocomplete,ToggleButton:F.ToggleButton,ToggleButtonGroup:F.ToggleButtonGroup},"@jbrowse/core/Plugin":M.A,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":re,"@jbrowse/core/configuration":r,"@jbrowse/core/util/types/mst":Me,"@jbrowse/core/ui":de,"@jbrowse/core/ui/theme":ue,"@jbrowse/core/util":ge,"@jbrowse/core/util/color":he,"@jbrowse/core/util/layouts":s,"@jbrowse/core/util/tracks":ke,"@jbrowse/core/util/Base1DViewModel":pe.A,"@jbrowse/core/util/io":fe,"@jbrowse/core/util/mst-reflection":Se,"@jbrowse/core/util/rxjs":xe,"@jbrowse/core/pluggableElementTypes":o,"@jbrowse/core/pluggableElementTypes/ViewType":O.A,"@jbrowse/core/pluggableElementTypes/AdapterType":H.A,"@jbrowse/core/pluggableElementTypes/DisplayType":_.A,"@jbrowse/core/pluggableElementTypes/TrackType":$.A,"@jbrowse/core/pluggableElementTypes/WidgetType":G.A,"@jbrowse/core/pluggableElementTypes/models":i,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":J,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":U.A,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":W,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":q,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":L,"@jbrowse/core/data_adapters/BaseAdapter":a},Pe=Object.keys(Ie),Le=Pe.filter(e=>!D.includes(e));if(Le.length>0)throw new Error(`The following modules are in the modules libs, but not the re-exports list: ${Le.join(", ")}`);const Re=D.filter(e=>!Pe.includes(e));if(Re.length)throw new Error(`The following modules are in the re-exports list, but not the modules libs: ${Re.join(", ")}`);const Fe=Ie},34732(e,t,n){n.d(t,{A:()=>r,S:()=>a});class r{constructor(e){this.label=e.label,this.locString=e.locString,this.renderingComponent=e.renderingComponent,this.displayString=e.displayString,this.matchedAttribute=e.matchedAttribute,this.matchedObject=e.matchedObject,this.textSearchAdapter=e.textSearchAdapter,this.relevance=e.relevance,this.trackId=e.trackId,this.score=e.score||1,this.results=e.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(e){return this.score=e,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}class a extends r{constructor(e){super(e),this.refName=e.refName??""}getLocation(){return this.refName}}},75335(e,t,n){n.d(t,{A:()=>o});var r=n(31565),a=n(17378),i=n(47664);class o{adapterCache=new i.A({maxSize:15});constructor(e){this.pluginManager=e}loadTextSearchAdapters(e){return Promise.all(this.relevantAdapters(e).map(async e=>{const t=(0,a.QZ)(e,"textSearchAdapterId"),n=this.adapterCache.get(t);if(n)return n;{const n=this.pluginManager.getTextSearchAdapterType(e.type),r=new(await n.getAdapterClass())(e,void 0,this.pluginManager);return this.adapterCache.set(t,r),r}}))}relevantAdapters(e){const t=this.pluginManager.rootModel,{aggregateTextSearchAdapters:n}=t?.jbrowse,{tracks:r}=t?.session,{assemblyName:a}=e;return[...this.getAdaptersWithAssembly(a,n),...this.getTrackAdaptersWithAssembly(a,r)]}getAdaptersWithAssembly(e,t){return t.filter(t=>(0,a.QZ)(t,"assemblyNames")?.includes(e))}getTrackAdaptersWithAssembly(e,t){return t.filter(t=>(0,a.QZ)(t,["textSearching","textSearchAdapter","assemblyNames"])?.includes(e)).map(e=>e.textSearching.textSearchAdapter)}async search(e,t,n){return this.search2({args:e,searchScope:t,rankFn:n})}async search2({args:e,searchScope:t,rankFn:n}){const r=await this.loadTextSearchAdapters(t),a=await Promise.all(r.map(t=>t.searchIndex(e)));return this.sortResults2({args:e,results:a.flat(),rankFn:n})}sortResults2({results:e,rankFn:t,args:n}){const a=new r.A({}),i=e.map(e=>e.getDisplayString()),o=n.queryString,s=a.filter(i,o),l=[];if(null!=s&&s.length>0){const t=a.info(s,i,o),n=a.sort(t,i,o);for(const r of n)l.push(e[t.idx[r]])}return t(l)}}},60459(e,t,n){n.d(t,{AK:()=>w,S7:()=>b});var r=n(10533),a=n(23886),i=n(8567),o=n(7220);const s={stringArray:r.types.array(r.types.string),stringArrayMap:r.types.map(r.types.array(r.types.string)),numberMap:r.types.map(r.types.number),boolean:r.types.boolean,color:r.types.refinement("Color",r.types.string,function(e){return!0}),integer:r.types.integer,number:r.types.number,string:r.types.string,text:r.types.string,fileLocation:o.FileLocation,frozen:r.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},c=e=>({views:{get valueJSON(){return e.value}}}),d=e=>({views:{get valueJSON(){return JSON.stringify(e.value)}}}),u={fileLocation:d,number:c,integer:c,boolean:c,frozen:d,stringArray:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t){e.value.push(t)},removeAtIndex(t){e.value.splice(t,1)},setAtIndex(t,n){e.value[t]=n}}}),stringArrayMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)},addToKey(t,n){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.push(n)},removeAtKeyIndex(t,n){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.splice(n,1)},setAtKeyIndex(t,n,r){const a=e.value.get(t);if(!a)throw new Error(`${t} not found`);a[n]=r}}}),numberMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)}}})},p=r.types.refinement("JexlString",r.types.string,e=>e.startsWith("jexl:"));function h(e,{description:t="",model:n,type:o,defaultValue:c,contextVariable:d=[]}){if(!o)throw new Error("type name required");if(n||(n=s[o]),!n)throw new Error(`no builtin config slot type "${o}", and no 'model' param provided`);if(void 0===c)throw new Error("no 'defaultValue' provided");const h=`${e.charAt(0).toUpperCase()}${e.slice(1)}ConfigSlot`;let g=r.types.model(h,{name:r.types.literal(e),description:r.types.literal(t),type:r.types.literal(o),value:r.types.optional(r.types.union(p,n),c)}).volatile(()=>({contextVariable:d})).views(e=>({get isCallback(){return String(e.value).startsWith("jexl:")}})).views(e=>({get expr(){return e.isCallback?(0,i.A)(String(e.value),(0,a.getEnv)(e).pluginManager.jexl):{eval:()=>e.value}},get valueJSON(){return e.isCallback?void 0:(t=e.value,t?.toJSON?t.toJSON():`"${t}"`);var t}})).views(e=>({getValue(t={}){const n=e.value;return"string"==typeof n&&n.startsWith("jexl:")?e.expr.eval(t):n}})).preProcessSnapshot(n=>"object"==typeof n&&n.name===e?n:{name:e,description:t,type:o,value:n}).postProcessSnapshot(e=>"object"==typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0).actions(e=>({set(t){e.value=t},reset(){e.value=c},convertToCallback(){e.isCallback||(e.value=`jexl:${e.valueJSON||"''"}`)},convertToValue(){if(e.isCallback){try{const t=e.expr.eval();if(void 0!==t)return void(e.value=t)}catch(e){}if(e.value=c,!(o in l))throw new Error(`no fallbackDefault defined for type ${o}`);e.value=l[o]}}}));u[o]&&(g=g.extend(u[o]));const f=r.types.optional(g,{name:e,type:o,description:t,value:c});return Object.defineProperty(f,"isJBrowseConfigurationSlot",{value:!0}),f}var g=n(17378),f=n(38817);function m(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e&&0===Object.keys(e).length}function y(e){return Array.isArray(e)&&0===e.length}function b(e,t,n){const{schemaDefinition:a,options:i}=function(e,t,n={}){if("string"!=typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");let r=t,a=n;return n.baseConfiguration?.jbrowseSchemaDefinition&&(r={...n.baseConfiguration.jbrowseSchemaDefinition,...r},a={...n.baseConfiguration.jbrowseSchemaOptions,...n,baseConfiguration:void 0}),{schemaDefinition:r,options:a}}(e,t,n),o=function(e,t,n){const a={};let i;if(n.explicitlyTyped&&(a.type=r.types.optional(r.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error(`Cannot have both explicit and implicit identifiers in ${e}`);n.explicitIdentifier?"string"==typeof n.explicitIdentifier?(a[n.explicitIdentifier]=r.types.identifier,i=n.explicitIdentifier):(a.id=r.types.identifier,i="id"):n.implicitIdentifier&&("string"==typeof n.implicitIdentifier?(a[n.implicitIdentifier]=f.K,i=n.implicitIdentifier):(a.id=f.K,i="id"));const o={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};for(const[n,i]of Object.entries(t))if((0,r.isType)(i)&&(0,r.isLateType)(i)||(0,g.oG)(i))a[n]=i;else if("string"==typeof i||"number"==typeof i)o[n]=i;else{if("object"!=typeof i)throw new Error(`invalid configuration schema definition, "${n}" must be either a valid configuration slot definition, a constant, or a nested configuration schema`);if(!i.type)throw new Error(`no type set for config slot ${e}.${n}`);try{a[n]=h(n,i)}catch(t){throw new Error(`invalid config slot definition for ${e}.${n}: ${t}`)}}let s=r.types.model(`${e}ConfigurationSchema`,a).actions(e=>({setSubschema(t,n){if(!(0,g.oG)(a[t]))throw new Error(`${t} is not a subschema, cannot replace`);const i=(0,r.isStateTreeNode)(n)?n:a[t].create(n);return e[t]=i,i}}));Object.keys(o).length&&(s=s.volatile(()=>o)),n.actions&&(s=s.actions(n.actions)),n.views&&(s=s.views(n.views)),n.extend&&(s=s.extend(n.extend));const l=i?{[i]:"placeholderId"}:{},c=n.explicitlyTyped?{type:e,...l}:l,d=(0,r.getSnapshot)(s.create(c));return s=s.postProcessSnapshot(e=>{const t={};let n=!0;for(const[r,a]of Object.entries(e))n&&("object"==typeof d[r]&&"object"==typeof a?JSON.stringify(d[r])!==JSON.stringify(a)&&(n=!1):d[r]!==a&&(n=!1)),void 0===a||void 0!==o[r]||m(a)||y(a)||(t[r]=a);return n?{}:t}),n.preProcessSnapshot&&(s=s.preProcessSnapshot(n.preProcessSnapshot)),r.types.optional(s,c)}(e,a,i);return o.isJBrowseConfigurationSchema=!0,o.jbrowseSchemaDefinition=a,o.jbrowseSchemaOptions=i,o}function w(e){const t=e.name;return t.includes("TrackConfigurationSchema")&&!t.includes("DisplayConfigurationSchema")?function(e){const t=r.types.reference(e,{get(t,n){let i=(0,a.getSession)(n).getTracksById()[t];if(i||(i=(0,r.resolveIdentifier)(e,(0,r.getRoot)(n),t)),!i)throw new Error(`Could not resolve identifier "${t}"`);return(0,r.isStateTreeNode)(i)?i:e.create(i,(0,r.getEnv)(n))},set:e=>e.trackId});return r.types.snapshotProcessor(r.types.union({dispatcher:n=>"string"==typeof n?t:e},t,e),{postProcessor:e=>"object"==typeof e&&null!==e&&"trackId"in e?e.trackId:e})}(e):t.includes("DisplayConfigurationSchema")?function(e){const t=r.types.reference(e,{get(t,n){let i=((0,a.getContainingTrack)(n).configuration.displays||[]).find(e=>e.displayId===t);if(!i){const e=`${t}`.split("-").slice(1).join("-");e&&(i={displayId:`${t}`,type:e})}if(!i)throw new Error(`Display configuration "${t}" not found`);return(0,r.isStateTreeNode)(i)?i:e.create(i,(0,r.getEnv)(n))},set:e=>e.displayId});return r.types.union({dispatcher:n=>"string"==typeof n?t:e},t,e)}(e):r.types.union(r.types.reference(e),e)}},17378(e,t,n){n.d(t,{C$:()=>l,FI:()=>o,JC:()=>s,QZ:()=>i,Rg:()=>p,oG:()=>c,wo:()=>u});var r=n(10533),a=n(322);function i(e,t,n={}){if(!t)return(0,r.isStateTreeNode)(e)?structuredClone((0,r.getSnapshot)(e)):structuredClone(e);if("string"==typeof t){let a=e[t];if(!a&&((0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(a=e.get(t)),!a))return;const i=function(e){return"function"==typeof e?.getValue}(a)?a.getValue(n):a;return null===i||"object"!=typeof i?i:(0,r.isStateTreeNode)(i)?structuredClone((0,r.getSnapshot)(i)):i}if(Array.isArray(t)){const a=t[0];if(t.length>1){const o=t.slice(1);let s=e[a];return!s&&(0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(s=e.get(a)),s?i(s,o,n):void 0}return i(e,a,n)}throw new TypeError("slotPath must be a string or array")}function o(e,t,n){return i(e.configuration,t,n)}function s(e){if((0,r.isType)(e)&&(e=(0,a.resolveLateType)(e),(0,r.isUnionType)(e))){const t=[];for(let n of(0,a.getUnionSubTypes)(e)){n=(0,a.resolveLateType)(n);let e=s(n);if(e.length||(e=[(0,a.getDefaultValue)(n).type]),!e[0])throw new Error(`invalid config schema type ${n}`);t.push(...e)}return t}return[]}function l(e){if((0,r.isType)(e)){if((0,r.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,r.isLateType)(e))return!0}return!1}function c(e){return!!(0,r.isType)(e)&&(!!l(e)||((0,r.isUnionType)(e)?(0,a.getUnionSubTypes)(e).every(e=>c(e)||"undefined"===e.name):!(!(0,r.isOptionalType)(e)||!c((0,a.getSubType)(e)))||!(!(0,r.isArrayType)(e)||!c((0,a.getSubType)(e)))||!(!(0,r.isMapType)(e)||!c((0,a.getSubType)(e)))))}const d=new WeakMap;function u(e){if(!e||"object"!=typeof e)return!1;let t=d.get(e);return void 0===t&&(t=(0,r.isStateTreeNode)(e)&&c((0,r.getType)(e)),d.set(e,t)),t}function p(e){return"object"==typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},32560(e,t,n){n.d(t,{D:()=>l});var r=n(10533),a=n(60459),i=n(17378),o=n(32725);const s=(0,a.S7)("empty",{});class l{static capabilities=[];constructor(e=s.create(),t,n){if(this.config=e,this.getSubAdapter=t,this.pluginManager=n,"undefined"==typeof jest){const t=(0,r.isStateTreeNode)(e)?(0,r.getSnapshot)(e):e;this.id=`${(0,o.A)(t)}`}else this.id="test"}setSequenceAdapterConfig(e){this.sequenceAdapterConfig=e}getConf(e){return(0,i.QZ)(this.config,e)}freeResources(e){}}},90946(e,t,n){n.d(t,{L:()=>d});var r=n(88068),a=n(55774),i=n(90013),o=n(32560),s=n(57379),l=n(25529),c=n(43921);class d extends o.D{async getHeader(e){return null}async getMetadata(e){return null}getFeaturesInRegion(e,t={}){return(0,l.ObservableCreate)(async n=>{await this.hasDataForRefName(e.refName,t)?this.getFeatures(e,t).subscribe(n):n.complete()})}getFeaturesInMultipleRegions(e,t={}){return(0,a.h)(...e.map(e=>this.getFeaturesInRegion(e,t)))}async hasDataForRefName(e,t={}){return(await this.getRefNames(t)).includes(e)}async getRegionQuantitativeStats(e,t){const n=this.getFeatures(e,{...t,statsEstimationMode:!0});return(0,c.qn)(e,n)}async getMultiRegionQuantitativeStats(e=[],t){if(!e.length)return(0,c.Yv)();const n=await Promise.all(e.map(e=>this.getRegionQuantitativeStats(e,t)));return(0,s.iz)(n)}getRegionFeatureDensityStats(e,t){return(0,s.GY)(e,(e,t)=>this.getFeatures(e,t),t)}async getMultiRegionFeatureDensityStats(e,t){if(!e.length)throw new Error("No regions supplied");return this.getRegionFeatureDensityStats(e[0],t)}async getSources(e){const t=await(0,r._)(this.getFeaturesInMultipleRegions(e).pipe((0,i.$)())),n=new Set;for(const e of t)n.add(e.get("source"));return[...n].map(e=>({name:e}))}async getExportData(e,t,n){}}},60339(e,t,n){n.d(t,{Q:()=>o});var r=n(88068),a=n(90013),i=n(90946);class o extends i.L{async getMultiRegionFeatureDensityStats(){return{featureDensity:0}}async getSequence(e,t){const n=await(0,r._)(this.getFeatures({...e,assemblyName:""},t).pipe((0,a.$)()));return n[0]?.get("seq")}}},57379(e,t,n){n.d(t,{GY:()=>c,iz:()=>s});var r=n(88068),a=n(90013),i=n(23886),o=n(43921);function s(e){const t=e.map(e=>e.scoreMeanMin).filter(e=>void 0!==e),n=e.map(e=>e.scoreMeanMax).filter(e=>void 0!==e);return(0,o.WD)({scoreMax:(0,i.max)(e.map(e=>e.scoreMax)),scoreMin:(0,i.min)(e.map(e=>e.scoreMin)),scoreSum:(0,i.sum)(e.map(e=>e.scoreSum)),scoreSumSquares:(0,i.sum)(e.map(e=>e.scoreSumSquares)),featureCount:(0,i.sum)(e.map(e=>e.featureCount)),basesCovered:(0,i.sum)(e.map(e=>e.basesCovered)),...t.length>0?{scoreMeanMin:(0,i.min)(t)}:{},...n.length>0?{scoreMeanMax:(0,i.max)(n)}:{}})}function l(e,t,n,i){const{start:o,end:s}=e,l=.75*o+.25*s;return(0,r._)(n({...e,start:Math.max(0,Math.round(l-t/2)),end:Math.min(Math.round(l+t/2),s)},i).pipe((0,a.$)()))}async function c(e,t,n){const r=e.end-e.start;let a=1e3,i=0,o=performance.now();for(;;){const s=(await l(e,a,t,n)).length;if(s>=70||2*a>r)return{featureDensity:s/a};if(i>5e3)return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:Number.POSITIVE_INFINITY};const c=performance.now();i+=c-o,o=c,a*=2}}},89674(e,t,n){function r(e){return"getRegions"in e&&"getFeatures"in e}function a(e){return"getRegions"in e}function i(e){return"getFeatures"in e}function o(e){return"getRefNameAliases"in e}function s(e){return"searchIndex"in e}n.d(t,{DD:()=>a,V0:()=>s,c7:()=>i,iD:()=>o,z_:()=>r})},95548(e,t,n){n.d(t,{cK:()=>i,pZ:()=>o});var r=n(21115);let a={};async function i(e,t,n){const o=(0,r.L)(n);a[o]??=async function(e,t,n){const r=n?.type;if(!r)throw new Error(`could not determine adapter type from adapter config snapshot ${JSON.stringify(n)}`);const a=e.getAdapterType(r);if(!a)throw new Error(`unknown data adapter type ${r}`);const o=a.configSchema.create(n,{pluginManager:e}),s=i.bind(null,e,t);return{dataAdapter:new(await a.getAdapterClass())(o,s,e),sessionIds:new Set([t])}}(e,t,n);const s=await a[o];return s.sessionIds.add(t),s}async function o(e){const t=Object.keys(e);if(1===t.length&&"sessionId"===t[0]){const{sessionId:t}=e;for(const[e,n]of Object.entries(a)){const r=await n;r.sessionIds.delete(t),0===r.sessionIds.size&&delete a[e]}}else for(const t of Object.values(a)){const n=await t,r=e.regions||(e.region?[e.region]:[]);for(const e of r)void 0!==e.refName&&n.dataAdapter.freeResources(e)}}},21115(e,t,n){n.d(t,{L:()=>a});var r=n(32725);function a(e={}){return e.type&&e.adapterId?`${e.type}-${e.adapterId}`:`${(0,r.A)(e)}`}},61941(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.getAdapterClass="AdapterClass"in e?async()=>e.AdapterClass:e.getAdapterClass,this.configSchema=e.configSchema,this.adapterCapabilities=e.adapterCapabilities||[],this.adapterMetadata=e.adapterMetadata}}},91667(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel}}},78544(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema,this.description=e.description,this.url=e.url,this.configEditorComponent=e.configEditorComponent}}},50492(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.subDisplay=e.subDisplay,this.configSchema=e.configSchema,this.ReactComponent=e.ReactComponent,this.trackType=e.trackType,this.viewType=e.viewType,this.helpText=e.helpText}}},26636(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.draw=e.draw,this.getChildFeatures=e.getChildFeatures,this.getHeightMultiplier=e.getHeightMultiplier,this.getSubfeatureMouseover=e.getSubfeatureMouseover,this.match=e.match,this.priority=e.priority??0}}},90106(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}}},23658(e,t,n){n.d(t,{A:()=>r});class r{constructor(e){this.name=e?.name||"UNKNOWN",this.maybeDisplayName=e?.displayName}get displayName(){return this.maybeDisplayName||this.name}}},40507(e,t,n){n.d(t,{W:()=>u,A:()=>p});var r=n(23658);const a=Symbol("mapObjectSkip"),i=e=>"object"==typeof e&&null!==e,o=e=>{if(!i(e))return!1;if(e instanceof RegExp||e instanceof Error||e instanceof Date||e instanceof Map||e instanceof Set||e instanceof WeakMap||e instanceof WeakSet||e instanceof Promise||e instanceof ArrayBuffer||e instanceof DataView||ArrayBuffer.isView(e)||globalThis.Blob&&e instanceof globalThis.Blob)return!1;const t=e;return"symbol"!=typeof t.$$typeof&&"function"!=typeof t.asymmetricMatch},s=(e,t,n,r=new WeakMap)=>{const{target:i={},deep:l=!1,includeSymbols:c=!1}=n??{},d={deep:l,includeSymbols:c};if(r.has(e))return r.get(e);r.set(e,i);const u=e=>e.map(e=>o(e)?s(e,t,d,r):e);if(Array.isArray(e))return u(e);for(const n of((e,t)=>t?[...Object.keys(e),...Object.getOwnPropertySymbols(e).filter(t=>Object.getOwnPropertyDescriptor(e,t)?.enumerable)]:Object.keys(e))(e,d.includeSymbols)){const l=e[n],c=t(n,l,e);if(c===a)continue;if(!Array.isArray(c))throw new TypeError("Mapper must return an array or mapObjectSkip, got "+(null===c?"null":typeof c));if(c.length<2)throw new TypeError(`Mapper must return an array with at least 2 elements [key, value], got ${c.length} elements`);let[p,h,{shouldRecurse:g=!0}={}]=c;if("__proto__"!==p){d.deep&&g&&o(h)&&(h=Array.isArray(h)?u(h):s(h,t,d,r));try{i[p]=h}catch(e){if(e instanceof TypeError&&e.message.includes("read only"))continue;throw e}}}return i};var l=n(7353),c=n(19608),d=n(16640);function u(e,t,n=new WeakSet){const r=e=>{const n=(0,c.getFileFromCache)(e.handleId);if(!n)throw new Error(`File not in cache for handleId: ${e.handleId}. The file "${e.name}" may need to be reopened.`);const r=`fh-blob-${e.handleId}`;return t[r]=n,{locationType:"BlobLocation",name:e.name,blobId:r}},a=e=>{if(e&&"object"==typeof e&&!n.has(e))if(n.add(e),Array.isArray(e))for(let t=0;t<e.length;t++){const n=e[t];(0,d.Qm)(n)?e[t]=r(n):a(n)}else{const t=e;for(const e of Object.keys(t)){const n=t[e];(0,d.Qm)(n)?t[e]=r(n):a(n)}}};a(e)}class p extends r.A{constructor(e){super(),this.pluginManager=e}async serializeArguments(e,t){return await this.augmentLocationObjects(e,t),{...e,blobMap:(0,c.getBlobMap)()}}async serializeNewAuthArguments(e,t){const n=this.pluginManager.rootModel;if(!(0,d.bV)(n)||e.internetAccountPreAuthorization)return e;const r=n.findAppropriateInternetAccount(e);return r&&(e.internetAccountPreAuthorization=await r.getPreAuthorizationInformation(e)),e}async deserializeArguments(e,t){return e.blobMap&&(0,c.setBlobMap)(e.blobMap),e}async executeDirect(e){}supportsDirectExecution(){return this.executeDirect!==p.prototype.executeDirect}async serializeReturn(e,t,n){return e}async deserializeReturn(e,t,n){let r;try{r=await e}catch(e){if((0,d.ZL)(e)){const t=this.pluginManager.rootModel?.createEphemeralInternetAccount(`HTTPBasicInternetAccount-${new URL(e.url).origin}`,{},e.url);throw new d.J_("Retrying with created internet account",t.internetAccountId)}throw e}return(0,l.N)(r)?r.value:r}async augmentLocationObjects(e,t){const n=this.pluginManager.rootModel,r=[],a=(0,c.getBlobMap)(),{renderingProps:o,...l}=e;if(u(l,a),function(e){if(!i(e))throw new TypeError(`Expected an object, got \`${e}\` (${typeof e})`);if(Array.isArray(e))throw new TypeError("Expected an object, got an array");s(e,(e,t)=>((e,t)=>{if((0,d.C1)(t)&&r.push(t),Array.isArray(t))for(const e of t)(0,d.C1)(e)&&r.push(e);return[e,t]})(e,t),{deep:!0})}(l),(0,d.bV)(n)&&0===n.internetAccounts.length)return e;for(const e of r)await this.serializeNewAuthArguments(e,t);return e}}},8709(e,t,n){n.d(t,{A:()=>o});var r=n(40507),a=n(23886),i=n(71392);class o extends r.A{async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new i.A({filters:e.filters,jexl:this.pluginManager.jexl}):void 0}}async serializeArguments(e,t){const n=this.pluginManager,r=n.rootModel?.session?.assemblyManager;if(!r)throw new Error("no assembly manager");const i=await(0,a.renameRegionsIfNeeded)(r,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(i,t)}}},73876(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.description=e.description,this.configSchema=e.configSchema,this.getAdapterClass="getAdapterClass"in e?e.getAdapterClass:async()=>e.AdapterClass}}},88237(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{displayTypes=[];constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}addDisplayType(e){this.displayTypes.push(e)}}},97849(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{displayTypes=[];viewMetadata={};constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.viewMetadata=e.viewMetadata||{},this.stateModel=e.stateModel,this.extendedName=e.extendedName}addDisplayType(e){this.displayTypes.push(e)}}},52188(e,t,n){n.d(t,{A:()=>a});var r=n(23658);class a extends r.A{constructor(e){super(e),this.heading=e.heading,this.HeadingComponent=e.HeadingComponent,this.configSchema=e.configSchema,this.stateModel=e.stateModel,this.ReactComponent=e.ReactComponent,this.helpText=e.helpText}}},67781(e,t,n){n.d(t,{A:()=>o});var r=n(10533),a=n(26710),i=n(60459);const o=function(e){return r.types.model("Connection",{name:r.types.identifier,tracks:r.types.array(e.pluggableConfigSchemaType("track")),configuration:(0,i.AK)(a.A)}).actions(()=>({connect(e){}})).actions(e=>({afterAttach(){0===e.tracks.length&&e.connect(e.configuration)},addTrackConf(t){const n=e.tracks.push(t);return e.tracks[n-1]},addTrackConfs(t){for(const n of t)e.tracks.push(n)},setTrackConfs(t){e.tracks=(0,r.cast)(t)},clear(){}}))}},9789(e,t,n){n.d(t,{q:()=>l});var r=n(10533),a=n(17378),i=n(23886),o=n(19608),s=n(38817);const l=r.types.model("BaseDisplay",{id:s.K,type:r.types.string,rpcDriverName:r.types.maybe(r.types.string)}).volatile(()=>({rendererTypeName:"",error:void 0,statusMessage:void 0})).views(e=>({get RenderingComponent(){const{pluginManager:t}=(0,i.getEnv)(e);return t.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,a.FI)(this.parentTrack,"adapter")},get parentTrack(){return(0,i.getContainingTrack)(e)},get isMinimized(){return this.parentTrack.minimized},get parentDisplay(){try{const t=(0,r.getParent)(e),n=t?.type;if("string"==typeof n&&n.endsWith("Display"))return t}catch{}},get effectiveRpcDriverName(){if(e.rpcDriverName)return e.rpcDriverName;if(this.parentDisplay?.effectiveRpcDriverName)return this.parentDisplay.effectiveRpcDriverName;try{return(0,a.FI)(this.parentTrack,"rpcDriverName")||void 0}catch{return}}})).views(e=>({renderProps:()=>({...(0,o.getParentRenderProps)(e),notReady:e.isMinimized||(0,i.getContainingView)(e).minimized,rpcDriverName:e.effectiveRpcDriverName}),renderingProps:()=>({displayModel:e}),get rendererType(){const{pluginManager:t}=(0,i.getEnv)(e);return t.getRendererType(e.rendererTypeName)},get DisplayMessageComponent(){},trackMenuItems:()=>[],get viewMenuActions(){return[]},regionCannotBeRendered:()=>null})).actions(e=>({setStatusMessage(t){e.statusMessage=t},setError(t){e.error=t},setRpcDriverName(t){e.rpcDriverName=t},reload(){}}))},5431(e,t,n){n.d(t,{E:()=>R});var r=n(30128),a=n(10533),i=n(57460);function o({features:e}){if(0===e.length)return"";const t=["refName","start","end","name","score","strand"];return`${e.map(e=>t.map(t=>e.get(t)??".").join("\t").trim()).join("\n")}\n`}var s=n(17378),l=n(23886);const c=new Set(["uniqueId","id","refName","source","type","start","end","strand","parent","parentId","score","subfeatures","phase"]),d="                     ",u={name:"Name"};function p(e){if(null!=e){if(Array.isArray(e)){const t=e.map(e=>p(e)).filter(e=>void 0!==e);return t.length>0?t.join(","):void 0}return"object"==typeof e?JSON.stringify(e):`${e}`}}function h(e,t,n){const r=[];t&&n&&r.push(`${d}/${n}="${t}"`);const a=e.get("id");a&&r.push(`${d}/name="${a}"`);for(const t of Object.keys(e.toJSON()))if(!c.has(t)&&t!==n){const n=p(e.get(t));n&&r.push(`${d}/${u[t]||t}="${n}"`)}return r}function g(e,t){return`${function(e,t){return e.get("start")-t+1}(e,t)}..${function(e,t){return e.get("end")-t}(e,t)}`}function f(e,t,n,r){const a=function(e,t,n,r){const a=`${e.get("type")}`.slice(0,16),i=g(e,t),o=-1===e.get("strand")?`complement(${i})`:i;return[`     ${a.padEnd(16)}${o}`,...h(e,n,r)]}(e,t,n,r),i=e.get("subfeatures")||[],o=i.filter(e=>"CDS"===e.get("type")).sort((e,t)=>e.get("start")-t.get("start")),s=i.filter(e=>"CDS"!==e.get("type")&&"exon"!==e.get("type")),l=e.get("id"),c=e.get("type"),u=e.get("strand"),p=o.length>0&&l&&c?function(e,t,n,r,a){if(0===e.length)return[];const i=e.map(e=>g(e,a)),o=1===i.length?i[0]:`join(${i.join(",")})`,s=-1===r?`complement(${o})`:o;return[`     ${"CDS".padEnd(16)}${s}`,`${d}/${n}="${t}"`]}(o,l,c,u,t):[];return[...a,...p,...s.flatMap(e=>f(e,t,l,c))].join("\n")}function m(e){const t=["ORIGIN"];for(let n=0;n<e.length;n+=60){const r=String(n+1).padStart(9),a=e.slice(n,n+60).toLowerCase().match(/.{1,10}/g)||[];t.push(`${r} ${a.join(" ")}`)}return t.push("//"),t}async function y({features:e,assemblyName:t,session:n}){if(!e.length)return"";const r=(0,l.min)(e.map(e=>e.get("start"))),a=(0,l.max)(e.map(e=>e.get("end"))),i=a-r,o=e[0].get("refName")||"",c=["LOCUS".padEnd(12),`${o}:${r+1}..${a}`.padEnd(20),` ${i} bp`.padEnd(15),` ${"DNA".padEnd(10)}`,"linear".padEnd(10),"UNK 10-JAN-1970"].join(""),d=await async function({session:e,region:t}){const{rpcManager:n,assemblyManager:r}=e,a=r.get(t.assemblyName);if(!a)throw new Error(`assembly ${t.assemblyName} not found`);const i="getSequence";return n.call(i,"CoreGetSequence",{adapterConfig:(0,s.FI)(a,["sequence","adapter"]),region:{...t,refName:a.getCanonicalRefName(t.refName)},sessionId:i})}({session:n,region:{assemblyName:t,start:r,end:a,refName:o}})??"";return`${[c,"FEATURES             Location/Qualifiers",...e.map(e=>f(e,r)),...m(d)].join("\n")}\n`}const b=new Set(["uniqueId","id","refName","source","type","start","end","strand","parent","parentId","score","subfeatures","phase","_lineHash"]),w={name:"Name",alias:"Alias",target:"Target",gap:"Gap",derives_from:"Derives_from",note:"Note",description:"Note",dbxref:"Dbxref",ontology_term:"Ontology_term",is_circular:"Is_circular"};function v(e){return e.replace(/%/g,"%25").replace(/;/g,"%3B").replace(/=/g,"%3D").replace(/&/g,"%26").replace(/,/g,"%2C").replace(/\t/g,"%09").replace(/\n/g,"%0A").replace(/\r/g,"%0D")}function S(e){if(null!=e){if(Array.isArray(e)){const t=e.map(e=>S(e)).filter(e=>void 0!==e);return t.length>0?t.join(","):void 0}return v("object"==typeof e?JSON.stringify(e):String(e))}}function x(e,t){const n=[],r=e.get("id");r&&n.push(`ID=${v(String(r))}`),t&&n.push(`Parent=${v(String(t))}`);const a=Object.keys(e.toJSON()).filter(e=>!b.has(e)),i=a.includes("description"),o=a.includes("note");for(const t of a){const r=S(e.get(t));if(r){let e=w[t]||t;"note"===t&&i&&o&&(e="note2"),n.push(`${e}=${r}`)}}return n.join(";")}function k(e,t,n){const r=n||e.get("refName"),a=e.get("id"),i=function(e,t,n){const r=e.get("strand"),a=e.get("score"),i=e.get("phase");return[e.get("refName")||n,e.get("source")||".",e.get("type")||".",e.get("start")+1,e.get("end"),null!=a?a:".",1===r?"+":-1===r?"-":".",null!=i?i:".",x(e,t)].join("\t")}(e,t,r);return[i,...e.get("subfeatures")?.map(e=>k(e,a,r))||[]].join("\n")}function C({features:e}){return`${["##gff-version 3",...e.map(e=>k(e))].join("\n")}\n`}var T=n(60459),A=n(21115),M=n(16640),I=n(38817);const P=(0,r.lazy)(()=>n.e(5338).then(n.bind(n,45338)));function L(e,t){const n=e.find(e=>e.displayId===t);if(!n)throw new Error(`could not find display config ${t}`);return n}function R(e,t,n){return a.types.model(t,{id:I.K,type:a.types.literal(t),configuration:(0,T.AK)(n),minimized:!1,pinned:!1,displays:a.types.array(e.pluggableMstType("display","stateModel"))}).views(e=>({get trackId(){return e.configuration.trackId},get rpcSessionId(){const t=(0,s.FI)(e,"adapter");return t?(0,A.L)(t):this.trackId},get name(){return(0,s.FI)(e,"name")},get textSearchAdapter(){return(0,s.FI)(e,"textSearchAdapter")},get adapterConfig(){return(0,s.FI)(e,"adapter")},get viewMenuActions(){return e.displays.flatMap(e=>e.viewMenuActions)},get canConfigure(){const t=(0,l.getSession)(e),{sessionTracks:n,adminMode:r}=t;return(0,M.u3)(t)&&(r||n?.find(e=>e.trackId===this.trackId))}})).views(t=>({get adapterType(){const{adapterConfig:n}=t;if(!n)throw new Error(`no adapter configuration provided for ${t.type}`);const r=e.getAdapterType(n.type);if(!r)throw new Error(`unknown adapter type ${n.type}`);return r}})).actions(t=>({setPinned(e){t.pinned=e},setMinimized(e){t.minimized=e},showDisplay(n,r={}){const a=L(t.configuration.displays,n),i=e.getDisplayType(a.type);if(!i)throw new Error(`unknown display type ${a.type}`);t.displays.push(i.stateModel.create({...r,type:a.type,configuration:n}))},hideDisplay(e){const n=t.displays.filter(t=>t.configuration.displayId===e);for(const e of n)t.displays.remove(e);return n.length},replaceDisplay(n,r,a={}){const i=t.displays.findIndex(e=>e.configuration.displayId===n);if(-1===i)throw new Error(`could not find display id ${n} to replace`);const o=L(t.configuration.displays,r);if(!e.getDisplayType(o.type))throw new Error(`unknown display type ${o.type}`);t.displays.splice(i,1,{...a,type:o.type,configuration:r})}})).views(()=>({saveTrackFileFormatOptions:()=>({gff3:{name:"GFF3",extension:"gff3",callback:C},genbank:{name:"GenBank",extension:"gbk",callback:y,helpText:"Note: GenBank format export is experimental. The generated output may not fully conform to the GenBank specification and should be validated before use in production workflows."},bed:{name:"BED",extension:"bed",callback:o}})})).views(t=>({trackMenuItems(){const n=t.displays.flatMap(e=>e.trackMenuItems()),r=t.displays[0].configuration.displayId,a=function(e){const{pluginManager:t}=(0,l.getEnv)(e),n=(0,l.getContainingView)(e),r=t.getViewType(n.type),a=new Set(r.displayTypes.map(e=>e.name));return e.configuration.displays.filter(e=>a.has(e.type))}(t);return[...n,{label:"Save track data",icon:i.A,priority:998,onClick:()=>{(0,l.getSession)(t).queueDialog(e=>[P,{model:t,handleClose:e}])}},...a.length>1?[{type:"subMenu",label:"Display types",priority:-1e3,subMenu:a.map(n=>{const a=e.getDisplayType(n.type);return{type:"radio",label:a.displayName,helpText:a.helpText,checked:n.displayId===r,onClick:()=>{n.displayId!==r&&t.replaceDisplay(r,n.displayId,t.displays[0].getPortableSettings?.()??{})}}})}]:[]]}})).postProcessSnapshot(e=>{if(!e)return e;const{minimized:t,pinned:n,...r}=e;return{...r,...t?{minimized:t}:{},...n?{pinned:n}:{}}})}},7328(e,t,n){n.d(t,{A:()=>s});var r=n(10533),a=n(7220),i=n(38817);const o=r.types.model("BaseView",{id:i.K,displayName:r.types.maybe(r.types.string),minimized:!1}).volatile(()=>({width:800})).views(()=>({menuItems:()=>[]})).actions(e=>({setDisplayName(t){e.displayName=t},setWidth(t){e.width=t},setMinimized(t){e.minimized=t}})).postProcessSnapshot(e=>{if(!e)return e;const{minimized:t,...n}=e;return{...n,...t?{minimized:t}:{}}}),s=o;o.props({displayedRegions:r.types.array(a.Region)})},7380(e,t,n){n.d(t,{X:()=>d});var r=n(10533),a=n(48716),i=n(60459),o=n(17378),s=n(206),l=n(38817);const c="undefined"==typeof sessionStorage,d=r.types.model("InternetAccount",{id:l.K,type:r.types.string,configuration:(0,i.AK)(a.y)}).views(e=>({get name(){return(0,o.FI)(e,"name")},get description(){return(0,o.FI)(e,"description")},get internetAccountId(){return(0,o.FI)(e,"internetAccountId")},get authHeader(){return(0,o.FI)(e,"authHeader")},get tokenType(){return(0,o.FI)(e,"tokenType")},get domains(){return(0,o.FI)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}})).views(e=>({handlesLocation:t=>e.domains.some(e=>t.uri.includes(e)),get tokenKey(){return`${e.internetAccountId}-token`}})).actions(e=>({getTokenFromUser(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken(t){sessionStorage.setItem(e.tokenKey,t)},removeToken(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:()=>sessionStorage.getItem(e.tokenKey),validateToken:async(e,t)=>e})).actions(e=>{let t;return{async getToken(n){if(t)return t;let r=n?.internetAccountPreAuthorization?.authInfo?.token;if(r)return t=Promise.resolve(r),t;if(c)throw new Error("Did not get internet account pre-authorization info in worker");return r=e.retrieveToken(),r?(t=Promise.resolve(r),t):(t=new Promise((t,n)=>{e.getTokenFromUser(n=>{e.storeToken(n),t(n)},t=>{e.removeToken(),n(t)})}),t)}}}).actions(e=>({addAuthHeaderToInit:(t,n)=>({...t,headers:new Headers({...t?.headers,...n?{[e.authHeader]:e.tokenType?`${e.tokenType} ${n}`:n}:{}})}),async getPreAuthorizationInformation(t){const n=await e.getToken(t);let r;try{r=await e.validateToken(n,t)}catch(t){throw e.removeToken(),t}return{internetAccountType:e.type,authInfo:{token:r,configuration:(0,o.FI)(e)}}}})).actions(e=>({getFetcher:t=>async(n,r)=>{const a=await e.getToken(t),i=e.addAuthHeaderToInit(r,a);return fetch(n,i)}})).actions(e=>({openLocation:t=>new s.g(t.uri,{fetch:e.getFetcher(t)})}))},26710(e,t,n){n.d(t,{A:()=>r});const r=(0,n(60459).S7)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"})},48716(e,t,n){n.d(t,{y:()=>r});const r=(0,n(60459).S7)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0})},8175(e,t,n){n.d(t,{J:()=>i});var r=n(10533),a=n(60459);function i(e){return(0,a.S7)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},rpcDriverName:{type:"string",description:"RPC driver to use for this track. Leave empty to use the display-level or global default.",defaultValue:""},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,a.S7)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:r.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,a.S7)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2"},maxDepth:{type:"number",defaultValue:99999,description:"Maximum depth to render subfeatures"}}),formatAbout:(0,a.S7)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const n=e.evaluateExtensionPoint("Core-preProcessTrackConfig",structuredClone(t)),{displays:r=[]}=n;if("placeholderId"!==n.trackId)try{const t=new Set(r.map(e=>e.type));for(const a of e.getTrackType(n.type).displayTypes)t.has(a.name)||r.push({displayId:`${n.trackId}-${a.name}`,type:a.name})}catch(e){throw new Error(`Unknown track type "${n.type}" in ${JSON.stringify(n)}`,{cause:e})}return{...n,displays:r.map(e=>({...e,displayId:e.displayId??`${n.trackId}-${e.type}`}))}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:n}=t;if(!n)throw new Error(`unknown display type ${n}`);const r=e.displays.find(e=>e?.displayId===t.displayId);if(r)return r;const a=e.displays.push(t);return e.displays[a-1]}})})}},49783(e,t,n){n.r(t),n.d(t,{default:()=>h});var r=n(7332),a=n(59665),i=n.n(a),o=n(17378),s=n(46624),l=n(81709);class c{constructor(e){this.props=e}update(e){return this.props=e,this}makeLayout(){return new l.A(s.A,{maxHeight:(0,o.QZ)(this.props.config,"maxHeight"),displayMode:(0,o.QZ)(this.props.config,"displayMode"),pitchX:this.props.bpPerPx,pitchY:(0,o.QZ)(this.props.config,"noSpacing")?1:3})}cachedLayoutIsValid(e){const t=e.props.bpPerPx===this.props.bpPerPx,n=(0,o.QZ)(this.props.config),r=(0,o.QZ)(e.props.config),a=i()(n,r),s=i()(this.props.filters,e.props.filters);return t&&a&&s}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),props:this.props}),this.cachedLayout.layout}}var d=n(26861),u=n(23886),p=n(58846);class h extends r.default{layoutSessions={};createLayoutSession(e){return new c(e)}getLayoutSession(e){return this.layoutSessions[(0,u.getLayoutId)(e)]}getWorkerSession(e){const t=(0,u.getLayoutId)(e);return this.layoutSessions[t]||(this.layoutSessions[t]=this.createLayoutSession(e)),this.layoutSessions[t].update(e)}getExpandedRegion(e,t){const{bpPerPx:n,config:r}=t,a=(0,o.QZ)(r,"maxFeatureGlyphExpansion")||0,i=Math.round(a*n);return(0,d.T)(e,i)}freeResources(e){const t=(0,u.getLayoutId)(e),n=this.layoutSessions[t];if(n){const t=e.regions[0];n.layout.discardRange(t.refName,t.start,t.end)}}async freeResourcesInClient(e,t){return this.freeResources(t),super.freeResourcesInClient(e,t)}deserializeLayoutInClient(e){return new p.A(e)}deserializeResultsInClient(e,t){const n=this.deserializeLayoutInClient(e.layout);return super.deserializeResultsInClient({...e,layout:n},t)}createLayoutInWorker(e){const{regions:t}=e,{layout:n}=this.getWorkerSession(e);return n.getSublayout(t[0].refName)}serializeLayout(e,t){const n=t.regions[0];return e.serializeRegion(this.getExpandedRegion(n,t))}async render(e){return{features:await this.getFeatures(e),layout:this.createLayoutInWorker(e)}}serializeResultsInWorker(e,t){const{features:n,...r}=super.serializeResultsInWorker(e,t),a=t.regions[0],i=e.layout,o=i&&"serializeRegion"in i?i.serializeRegion(this.getExpandedRegion(a,t)):i;return{...r,layout:o,maxHeightReached:o.maxHeightReached,features:n?.filter(e=>!!o.rectangles[e.uniqueId])}}}},67965(e,t,n){n.d(t,{A:()=>a});var r=n(7332);class a extends r.default{supportsSVG=!0}},7332(e,t,n){n.r(t),n.d(t,{default:()=>u});var r=n(88068),a=n(90013),i=n(10678),o=n(26861),s=n(89674),l=n(95548),c=n(23886),d=n(43102);class u extends i.default{async renderDirect(e){return{...await super.renderDirect(e),blockKey:e.blockKey}}serializeArgsInClient(e){return super.serializeArgsInClient({...e,displayModel:void 0,regions:structuredClone(e.regions)})}deserializeResultsInClient(e,t){const n=new Map(e.features?.map(e=>d.A.fromJSON(e)).map(e=>[e.id(),e]));return{...super.deserializeResultsInClient({...e,features:n},t),blockKey:t.blockKey,features:n}}serializeResultsInWorker(e,t){const n=super.serializeResultsInWorker(e,t),{features:r}=e;return{...n,features:r instanceof Map?(0,c.iterMap)(r.values(),e=>e.toJSON(),r.size):void 0}}getExpandedRegion(e,t){return e}async getFeatures(e){const t=this.pluginManager,{regions:n,sessionId:i,adapterConfig:c}=e,{dataAdapter:d}=await(0,l.cK)(t,i,c);if(!(0,s.c7)(d))throw new Error("Adapter does not support retrieving features");const u=n.map(e=>(0,o.w)(e)),p=1===u.length?d.getFeatures(this.getExpandedRegion(u[0],e),e):d.getFeaturesInMultipleRegions(u,e),h=await(0,r._)(p.pipe((0,a.$)()));return new Map(h.filter(t=>this.featurePassesFilters(e,t)).map(e=>[e.id(),e]))}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async render(e){const t=await this.getFeatures(e);return{...await super.render({...e,features:t}),features:t}}}},64458(e,t,n){n.r(t),n.d(t,{default:()=>i});var r=n(23658),a=n(44460);class i extends r.A{supportsSVG=!0;constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.configSchema=e.configSchema,this.pluginManager=e.pluginManager}async render(e){return{reactElement:(0,a.jsx)(this.ReactComponent,{...e})}}freeResources(e){}}},10678(e,t,n){n.r(t),n.d(t,{default:()=>u});var r=n(30128),a=n(10533),i=n(64458),o=n(71392),s=n(23886),l=n(63110),c=n(7353),d=n(29458);class u extends i.default{createReactElement(e,t){if(t.exportSVG){if(e.html)return;return this.supportsSVG?(0,r.createElement)(this.ReactComponent,{...t,...e}):(0,r.createElement)("text",{y:"12",fill:"black"},"SVG export not supported for this track")}return(0,r.createElement)(this.ReactComponent,{...t,...e,...t.renderingProps})}async renderDirect(e){const{renderingProps:t,...n}=e,r=(0,a.isStateTreeNode)(e.config)?e.config:this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),i=await this.render({...n,config:r});if((0,c.N)(i))return this.deserializeResultsInClient(i.value,e);const{reactElement:o,...s}=i;return{...s,reactElement:this.createReactElement(s,e)}}serializeArgsInClient(e){const{renderingProps:t,...n}=e;return{...n,config:(0,a.isStateTreeNode)(e.config)?(0,a.getSnapshot)(e.config):e.config,filters:e.filters?.toJSON().filters}}deserializeResultsInClient(e,t){return{...e,reactElement:this.createReactElement(e,t)}}deserializeArgsInWorker(e){return{...e,config:this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),filters:e.filters?new o.A({filters:e.filters,jexl:this.pluginManager.jexl}):void 0}}serializeResultsInWorker(e,t){const{reactElement:n,...r}=e;return r}async renderInClient(e,t){const n=await e.call(t.sessionId,"CoreRender",t);if("canvasRecordedData"in n){const{reactElement:e,...t}=n;return{...t,html:await(0,l.getSerializedSvg)(n)}}return n}async renderInWorker(e){const{stopToken:t,statusCallback:n=()=>{}}=e,r=(0,d.jL)(t),a={...this.deserializeArgsInWorker(e),stopTokenCheck:r},i=await(0,s.updateStatus)("Rendering plot",n,()=>this.render(a));return(0,d.As)(r),(0,c.N)(i)?i:(0,s.updateStatus)("Serializing results",n,()=>this.serializeResultsInWorker(i,a))}async freeResourcesInClient(e,t){await e.call(t.sessionId,"CoreFreeResources",this.serializeArgsInClient(t))}}},26861(e,t,n){function r(e){return{...e,start:Math.floor(e.start),end:Math.ceil(e.end)}}function a(e,t){return{...e,start:Math.floor(Math.max(e.start-t,0)),end:Math.ceil(e.end+t)}}n.d(t,{T:()=>a,w:()=>r})},71392(e,t,n){n.d(t,{A:()=>a});var r=n(8567);class a{constructor({filters:e,jexl:t}){this.filterChain=e.map(e=>e.trim()).filter(e=>!!e).map(e=>{if("string"==typeof e)return{expr:(0,r.A)(e,t),string:e};throw new Error(`invalid inputFilter string "${e}"`)})}passes(...e){for(const t of this.filterChain)if(!t.expr.eval({feature:e[0]}))return!1;return!0}toJSON(){return{filters:this.filterChain.map(e=>e.string)}}static fromJSON(e){return new a(e)}}},27305(e,t,n){n.d(t,{A:()=>u});var r=n(30128),a=n(23149),i=n(79291),o=n(69566),s=n(23886),l=n(46625),c=n(44460);const d=(0,l.n)()({importFormEntry:{minWidth:180}}),u=(0,o.observer)(function({session:e,onChange:t,label:n="Assembly",selected:o,InputProps:l,TextFieldProps:u,localStorageKey:p,helperText:h="Select assembly to view"}){const{classes:g}=d(),{assemblyNames:f,assemblyManager:m}=e,y=new URLSearchParams(window.location.search).get("config"),[b,w]=(0,s.useLocalStorage)(`lastAssembly-${[window.location.host+window.location.pathname,y,p].join("-")}`,o,"undefined"==typeof jest&&Boolean(p)),v=f.includes(b||"")?b:o;(0,r.useEffect)(()=>{v&&v!==o&&t(v)},[v,t,o]);const S=f.length?"":"No configured assemblies";return(0,c.jsx)(a.A,{select:!0,"data-testid":"assembly-selector-textfield",label:n,variant:"outlined",helperText:S||h,value:v||"",onChange:e=>{w(e.target.value)},error:!!S,disabled:!!S,className:g.importFormEntry,...u,slotProps:{input:l,htmlInput:{"data-testid":"assembly-selector"}},children:f.map(e=>(0,c.jsx)(i.A,{value:e,children:m.get(e)?.displayName||e},e))})})},62456(e,t,n){n.d(t,{A:()=>u});var r=n(73312),a=n(55495),i=n(7201),o=n(49583),s=n(87377),l=n(46625),c=n(44460);const d=(0,l.n)()(e=>({tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,i.X4)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.fontSize,lineHeight:Math.round(14e4)/1e5+"em",maxWidth:300,wordWrap:"break-word"}}));function u({clientPoint:e,children:t,placement:n="right"}){const i=(0,s.A)(),l=i.components?.MuiPopper,{classes:u}=d(),{refs:p,floatingStyles:h,context:g}=(0,r.we)({placement:n,strategy:"fixed",middleware:[(0,a.cY)(5)]}),f=(0,r.ju)(g,e),{getFloatingProps:m}=(0,r.bv)([f]);return(0,c.jsx)(o.A,{container:l?.defaultProps?.container,children:(0,c.jsx)("div",{className:u.tooltip,ref:p.setFloating,style:{...h,zIndex:1e5,visibility:"translate(0px, 0px)"===h.transform?"hidden":void 0,pointerEvents:"none"},...m(),children:t})})}},53458(e,t,n){n.d(t,{A:()=>B});var r=n(55614),a=n(30128),i=n(47398),o=n(68411),s=n(10451),l=n(79291),c=n(48993),d=n(9929),u=n(68673),p=n(32094),h=n(59705),g=n(63209),f=n(28910),m=n(44460);function y(e){const t=(0,r.c)(8),{onClose:n,helpText:a,label:i}=e;let o,s,l;return t[0]!==i?(o=i?(0,m.jsxs)(m.Fragment,{children:["Help: ",i]}):void 0,t[0]=i,t[1]=o):o=t[1],t[2]!==a?(s=(0,m.jsx)(g.A,{children:a}),t[2]=a,t[3]=s):s=t[3],t[4]!==n||t[5]!==o||t[6]!==s?(l=(0,m.jsx)(f.A,{open:!0,onClose:n,title:"Help",titleNode:o,onClick:w,onMouseDown:b,children:s}),t[4]=n,t[5]=o,t[6]=s,t[7]=l):l=t[7],l}function b(e){e.stopPropagation()}function w(e){e.stopPropagation()}function v(e){const t=(0,r.c)(7),{helpText:n,label:i}=e,[o,s]=(0,a.useState)(!1);let l,c,d;return t[0]===Symbol.for("react.memo_cache_sentinel")?(l=(0,m.jsx)(h.A,{size:"small",onClick:e=>{e.stopPropagation(),s(!0)},style:{marginLeft:4,padding:4},children:(0,m.jsx)(p.A,{fontSize:"small"})}),t[0]=l):l=t[0],t[1]!==o||t[2]!==n||t[3]!==i?(c=o?(0,m.jsxs)(a.Suspense,{fallback:null,children:[(0,m.jsx)(y,{helpText:n,label:i,onClose:e=>{e.stopPropagation(),s(!1)}})," "]}):null,t[1]=o,t[2]=n,t[3]=i,t[4]=c):c=t[4],t[5]!==c?(d=(0,m.jsxs)(m.Fragment,{children:[l,c]}),t[5]=c,t[6]=d):d=t[6],d}const S=a.forwardRef(function(e,t){const n=(0,r.c)(10);let a,i,o,s;return n[0]!==e.style?(a={pointerEvents:"none",...e.style},n[0]=e.style,n[1]=a):a=n[1],n[2]===Symbol.for("react.memo_cache_sentinel")?(i={style:{pointerEvents:"auto"}},n[2]=i):i=n[2],n[3]!==e.slotProps?(o={...e.slotProps,paper:i},n[3]=e.slotProps,n[4]=o):o=n[4],n[5]!==e||n[6]!==t||n[7]!==a||n[8]!==o?(s=(0,m.jsx)(u.A,{...e,ref:t,style:a,slotProps:o}),n[5]=e,n[6]=t,n[7]=a,n[8]=o,n[9]=s):s=n[9],s});var x=n(23992),k=n(91556),C=n(35484),T=n(44649),A=n(89800);const M=(0,n(46625).n)()({menuItemEndDecoration:{padding:0,margin:0,height:16}});function I(e){const t=(0,r.c)(10),{classes:n}=M(),{type:a}=e;let i,o,s,l;"checked"in e&&({checked:i,disabled:o}=e);e:switch(a){case"subMenu":{let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,m.jsx)(x.A,{color:"action"}),t[0]=e):e=t[0],s=e;break e}case"checkbox":if(i){const e=o?"inherit":void 0;let n;t[1]!==e?(n=(0,m.jsx)(k.A,{color:e}),t[1]=e,t[2]=n):n=t[2],s=n}else{let e;t[3]===Symbol.for("react.memo_cache_sentinel")?(e=(0,m.jsx)(C.A,{color:"action"}),t[3]=e):e=t[3],s=e}break e;case"radio":if(i){const e=o?"inherit":void 0;let n;t[4]!==e?(n=(0,m.jsx)(T.A,{color:e}),t[4]=e,t[5]=n):n=t[5],s=n}else{let e;t[6]===Symbol.for("react.memo_cache_sentinel")?(e=(0,m.jsx)(A.A,{color:"action"}),t[6]=e):e=t[6],s=e}}return t[7]!==n.menuItemEndDecoration||t[8]!==s?(l=(0,m.jsx)("div",{className:n.menuItemEndDecoration,children:s}),t[7]=n.menuItemEndDecoration,t[8]=s,t[9]=l):l=t[9],l}function P(e){if("string"==typeof e)return e.toLowerCase().replace(/\s+/g,"_")}function L(e){const t=(0,r.c)(28),{title:n,Icon:c,inset:d,menuItems:u,onMenuItemClick:p,closeAfterItemClick:h,onCloseRoot:g,isOpen:f,onOpen:y,onClose:b}=e,[w,v]=(0,a.useState)(null);let x;t[0]!==n?(x=P(n),t[0]=n,t[1]=x):x=t[1];const k=x?`cascading-submenu-${x}`:void 0;let C,T,A,M,I,L,F,D,N;return t[2]!==c?(C=c?(0,m.jsx)(o.A,{children:(0,m.jsx)(c,{})}):null,t[2]=c,t[3]=C):C=t[3],t[4]!==d||t[5]!==n?(T=(0,m.jsx)(s.A,{primary:n,inset:d}),t[4]=d,t[5]=n,t[6]=T):T=t[6],t[7]===Symbol.for("react.memo_cache_sentinel")?(A=(0,m.jsx)(i.A,{}),t[7]=A):A=t[7],t[8]!==y||t[9]!==k||t[10]!==C||t[11]!==T?(M=(0,m.jsxs)(l.A,{ref:v,"data-testid":k,onMouseOver:y,onFocus:y,onClick:y,children:[C,T,A]}),t[8]=y,t[9]=k,t[10]=C,t[11]=T,t[12]=M):M=t[12],t[13]===Symbol.for("react.memo_cache_sentinel")?(I={vertical:"top",horizontal:"right"},L={vertical:"top",horizontal:"left"},t[13]=I,t[14]=L):(I=t[13],L=t[14]),t[15]!==h||t[16]!==u||t[17]!==g||t[18]!==p?(F=(0,m.jsx)(R,{closeAfterItemClick:h,onMenuItemClick:p,menuItems:u,onCloseRoot:g}),t[15]=h,t[16]=u,t[17]=g,t[18]=p,t[19]=F):F=t[19],t[20]!==w||t[21]!==f||t[22]!==b||t[23]!==F?(D=(0,m.jsx)(S,{open:f,anchorEl:w,onClose:b,anchorOrigin:I,transformOrigin:L,children:F}),t[20]=w,t[21]=f,t[22]=b,t[23]=F,t[24]=D):D=t[24],t[25]!==D||t[26]!==M?(N=(0,m.jsxs)(m.Fragment,{children:[M,D]}),t[25]=D,t[26]=M,t[27]=N):N=t[27],N}function R(e){const t=(0,r.c)(22),{onMenuItemClick:n,closeAfterItemClick:i,menuItems:u,onCloseRoot:p}=e,[h,g]=(0,a.useState)();let f;t[0]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{g(void 0)},t[0]=f):f=t[0];const y=f;let b;t[1]!==u?(b=u.some(N),t[1]=u,t[2]=b):b=t[2];const w=b;let S;t[3]!==u?(S=u.some(D),t[3]=u,t[4]=S):S=t[4];const x=S;let k,C;if(t[5]!==i||t[6]!==x||t[7]!==w||t[8]!==u||t[9]!==p||t[10]!==n||t[11]!==h){const e=u.toSorted(F);let r;t[13]!==i||t[14]!==x||t[15]!==w||t[16]!==p||t[17]!==n||t[18]!==h?(r=(e,t)=>{if("subMenu"in e)return(0,m.jsx)(L,{title:e.label,Icon:e.icon,inset:w&&!e.icon,onMenuItemClick:n,menuItems:e.subMenu,closeAfterItemClick:i,onCloseRoot:p,isOpen:h===t,onOpen:()=>{g(t)},onClose:y},`subMenu-${e.label}-${t}`);if("divider"===e.type)return(0,m.jsx)(c.A,{component:"li"},`divider-${t}`);if("subHeader"===e.type)return(0,m.jsx)(d.A,{children:e.label},`subHeader-${e.label}-${t}`);const r=e,a=r.helpText,u="checkbox"===r.type||"radio"===r.type,f=P(r.label);return(0,m.jsxs)(l.A,{"data-testid":f?`cascading-menuitem-${f}`:void 0,disabled:Boolean(r.disabled),onClick:e=>{i&&p(),n(e,r.onClick)},onMouseOver:y,children:[r.icon?(0,m.jsx)(o.A,{children:(0,m.jsx)(r.icon,{})}):null,(0,m.jsx)(s.A,{primary:r.label,secondary:r.subLabel,inset:w&&!r.icon}),(0,m.jsx)("div",{style:{flexGrow:1,minWidth:10}}),u?(0,m.jsx)(I,{type:r.type,checked:r.checked,disabled:r.disabled}):null,a?(0,m.jsx)(v,{helpText:a,label:r.label}):u&&x?(0,m.jsx)("div",{style:{marginLeft:4,padding:4,width:28,height:28}}):null]},`${r.label}-${t}`)},t[13]=i,t[14]=x,t[15]=w,t[16]=p,t[17]=n,t[18]=h,t[19]=r):r=t[19],k=e.map(r),t[5]=i,t[6]=x,t[7]=w,t[8]=u,t[9]=p,t[10]=n,t[11]=h,t[12]=k}else k=t[12];return t[20]!==k?(C=(0,m.jsx)(m.Fragment,{children:k}),t[20]=k,t[21]=C):C=t[21],C}function F(e,t){return(t.priority||0)-(e.priority||0)}function D(e){return("checkbox"===e.type||"radio"===e.type)&&"helpText"in e&&e.helpText}function N(e){return"icon"in e&&e.icon}function B(e){const t=(0,r.c)(19),{onMenuItemClick:n,closeAfterItemClick:a,menuItems:i,open:o,onClose:s,anchorEl:l,anchorOrigin:c,transformOrigin:d,anchorReference:p,anchorPosition:h,slotProps:g,marginThreshold:f,style:y}=e,b=void 0===a||a;let w;t[0]!==i?(w=Array.isArray(i)?i:i(),t[0]=i,t[1]=w):w=t[1];const v=w,S=f??void 0;let x,k;return t[2]!==b||t[3]!==v||t[4]!==s||t[5]!==n?(x=(0,m.jsx)(R,{menuItems:v,closeAfterItemClick:b,onMenuItemClick:n,onCloseRoot:s}),t[2]=b,t[3]=v,t[4]=s,t[5]=n,t[6]=x):x=t[6],t[7]!==l||t[8]!==c||t[9]!==h||t[10]!==p||t[11]!==s||t[12]!==o||t[13]!==g||t[14]!==y||t[15]!==S||t[16]!==x||t[17]!==d?(k=(0,m.jsx)(u.A,{anchorEl:l,open:o,onClose:s,anchorOrigin:c,transformOrigin:d,anchorReference:p,anchorPosition:h,slotProps:g,marginThreshold:S,style:y,children:x}),t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=s,t[12]=o,t[13]=g,t[14]=y,t[15]=S,t[16]=x,t[17]=d,t[18]=k):k=t[18],k}},9378(e,t,n){n.d(t,{A:()=>c});var r=n(55614),a=n(30128),i=n(59705),o=n(53458),s=n(44460);function l(e,t){t()}const c=function(e){const t=(0,r.c)(37);let n,c,d,u,p,h,g,f,m,y,b,w;t[0]!==e?(({children:c,menuItems:p,closeAfterItemClick:y,stopPropagation:m,disabled:d,setOpen:f,ButtonComponent:b,onClick:h,anchorOrigin:n,transformOrigin:w,marginThreshold:u,...g}=e),t[0]=e,t[1]=n,t[2]=c,t[3]=d,t[4]=u,t[5]=p,t[6]=h,t[7]=g,t[8]=f,t[9]=m,t[10]=y,t[11]=b,t[12]=w):(n=t[1],c=t[2],d=t[3],u=t[4],p=t[5],h=t[6],g=t[7],f=t[8],m=t[9],y=t[10],b=t[11],w=t[12]);const v=void 0===y||y,S=void 0===b?i.A:b,[x,k]=(0,a.useState)(null),C=Boolean(x);let T,A;t[13]!==C||t[14]!==f?(T=()=>{f?.(C)},A=[C,f],t[13]=C,t[14]=f,t[15]=T,t[16]=A):(T=t[15],A=t[16]),(0,a.useEffect)(T,A);const M=d??(Array.isArray(p)&&0===p.length);let I,P,L,R;return t[17]!==h||t[18]!==m?(I=e=>{m&&e.stopPropagation(),k(e.currentTarget),h?.(e)},t[17]=h,t[18]=m,t[19]=I):I=t[19],t[20]!==S||t[21]!==c||t[22]!==M||t[23]!==g||t[24]!==I?(P=(0,s.jsx)(S,{onClick:I,...g,disabled:M,children:c}),t[20]=S,t[21]=c,t[22]=M,t[23]=g,t[24]=I,t[25]=P):P=t[25],t[26]!==x||t[27]!==n||t[28]!==v||t[29]!==u||t[30]!==p||t[31]!==C||t[32]!==w?(L=C?(0,s.jsx)(o.A,{open:C,onClose:()=>{k(null)},anchorEl:x,anchorOrigin:n,transformOrigin:w,marginThreshold:u,menuItems:p,closeAfterItemClick:v,onMenuItemClick:l}):null,t[26]=x,t[27]=n,t[28]=v,t[29]=u,t[30]=p,t[31]=C,t[32]=w,t[33]=L):L=t[33],t[34]!==P||t[35]!==L?(R=(0,s.jsxs)(s.Fragment,{children:[P,L]}),t[34]=P,t[35]=L,t[36]=R):R=t[36],R}},28910(e,t,n){n.d(t,{A:()=>x});var r=n(55614),a=n(30128),i=n(20449),o=n(64975),s=n(16457),l=n(62633),c=n(59705),d=n(48993),u=n(33560),p=n(87377),h=n(88015),g=n(69566),f=n(95360),m=n(62088),y=n(37472),b=n(46625),w=n(44460);const v=(0,b.n)()(e=>({closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},errorBox:{width:800,margin:40}}));function S(e){const t=(0,r.c)(5),{error:n}=e,{classes:a}=v();let i,o;return t[0]!==n?(i=(0,w.jsx)(m.A,{error:n}),t[0]=n,t[1]=i):i=t[1],t[2]!==a.errorBox||t[3]!==i?(o=(0,w.jsx)("div",{className:a.errorBox,children:i}),t[2]=a.errorBox,t[3]=i,t[4]=o):o=t[4],o}const x=(0,g.observer)(function(e){const{classes:t}=v(),{titleNode:n,...r}=e,{title:g,header:m,children:b,onClose:x}=r,k=(0,p.A)();return(0,w.jsx)(o.A,{...r,children:(0,w.jsxs)(s.A,{children:[(0,a.isValidElement)(m)?m:(0,w.jsxs)(l.A,{children:[n||(0,w.jsx)(y.A,{html:g||""}),x?(0,w.jsx)(c.A,{className:t.closeButton,onClick:e=>{x(e,"backdropClick")},children:(0,w.jsx)(i.A,{})}):null]}),(0,w.jsx)(d.A,{}),(0,w.jsx)(f.t,{FallbackComponent:S,children:(0,w.jsx)(h.A,{theme:(0,u.A)(k,{components:{MuiInputBase:{styleOverrides:{input:{boxSizing:"content-box!important"}}}}}),children:b})})]})})})},10897(e,t,n){n.d(t,{A:()=>p});var r=n(55614),a=n(30128),i=n(87529),o=n(54825),s=n(14421),l=n(87377),c=n(46625),d=n(44460);const u=(0,c.n)()(e=>({input:{},inputBase:{},typography:{top:6,left:2,position:"absolute",whiteSpace:"nowrap",visibility:"hidden"},inputRoot:{padding:e.spacing(.5)},inputFocused:{borderStyle:"solid",borderWidth:2}})),p=(0,a.forwardRef)(function(e,t){const n=(0,r.c)(43);let c,p,h,g;n[0]!==e?(({value:h,setValue:p,variant:g,...c}=e),n[0]=e,n[1]=c,n[2]=p,n[3]=h,n[4]=g):(c=n[1],p=n[2],h=n[3],g=n[4]);const[f,m]=(0,i.A)(),{width:y}=m,[b,w]=(0,a.useState)(),[v,S]=(0,a.useState)(null);let x;n[5]!==e?(x={props:e},n[5]=e,n[6]=x):x=n[6];const{classes:k}=u(e,x),C=(0,l.A)(),T=void 0===b?h:b;let A,M,I,P,L,R,F,D,N,B,V;return n[7]===Symbol.for("react.memo_cache_sentinel")?(A={position:"relative"},n[7]=A):A=n[7],n[8]!==k.typography||n[9]!==f||n[10]!==T||n[11]!==g?(M=(0,d.jsx)("div",{style:A,children:(0,d.jsx)(o.A,{ref:f,component:"span",variant:g,className:k.typography,children:T})}),n[8]=k.typography,n[9]=f,n[10]=T,n[11]=g,n[12]=M):M=n[12],n[13]===Symbol.for("react.memo_cache_sentinel")?(I=e=>{S(e)},n[13]=I):I=n[13],n[14]!==C||n[15]!==g?(P=g&&"inherit"!==g?C.typography[g]:{},n[14]=C,n[15]=g,n[16]=P):P=n[16],n[17]!==P||n[18]!==y?(L={style:{width:y,...P}},n[17]=P,n[18]=y,n[19]=L):L=n[19],n[20]!==k.input||n[21]!==k.inputFocused||n[22]!==k.inputRoot?(R={input:k.input,root:k.inputRoot,focused:k.inputFocused},n[20]=k.input,n[21]=k.inputFocused,n[22]=k.inputRoot,n[23]=R):R=n[23],n[24]===Symbol.for("react.memo_cache_sentinel")?(F=e=>{w(e.target.value)},n[24]=F):F=n[24],n[25]!==v?(D=e=>{"Enter"===e.key?v?.blur():"Escape"===e.key&&(w(void 0),v?.blur())},n[25]=v,n[26]=D):D=n[26],n[27]!==b||n[28]!==p||n[29]!==h?(N=()=>{p(b||h||""),w(void 0)},n[27]=b,n[28]=p,n[29]=h,n[30]=N):N=n[30],n[31]!==k.inputBase||n[32]!==N||n[33]!==L||n[34]!==R||n[35]!==D||n[36]!==T?(B=(0,d.jsx)(s.Ay,{inputRef:I,className:k.inputBase,inputProps:L,classes:R,value:T,onChange:F,onKeyDown:D,onBlur:N}),n[31]=k.inputBase,n[32]=N,n[33]=L,n[34]=R,n[35]=D,n[36]=T,n[37]=B):B=n[37],n[38]!==c||n[39]!==t||n[40]!==B||n[41]!==M?(V=(0,d.jsxs)("div",{...c,ref:t,children:[M,B]}),n[38]=c,n[39]=t,n[40]=B,n[41]=M,n[42]=V):V=n[42],V})},95360(e,t,n){n.d(t,{t:()=>i});var r=n(30128),a=n(44460);class i extends r.Component{constructor(e){super(e),this.state={error:void 0}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e})}render(){return this.state.error?(0,a.jsx)(this.props.FallbackComponent,{error:this.state.error}):this.props.children}}},62088(e,t,n){n.d(t,{A:()=>m});var r=n(55614),a=n(30128),i=n(51850),o=n(12551),s=n(30097),l=n(59705),c=n(46625),d=n(44460);const u=(0,c.n)()(e=>({bg:{padding:4,margin:4,overflow:"auto",maxHeight:200,background:"dark"===e.palette.mode?"#833":"#f88",border:`1px solid ${e.palette.divider}`}}));function p(e){const t=(0,r.c)(3),{children:n}=e,{classes:a}=u();let i;return t[0]!==n||t[1]!==a.bg?(i=(0,d.jsx)("div",{className:a.bg,children:n}),t[0]=n,t[1]=a.bg,t[2]=i):i=t[2],i}const h=(0,a.lazy)(()=>Promise.all([n.e(9490),n.e(7985)]).then(n.bind(n,7985))),g=(0,c.n)()(e=>({bg:{background:e.palette.divider,border:"1px solid black",margin:20},iconFloat:{float:"right",marginLeft:100}}));function f(e){const t=(0,r.c)(12),{error:n,onReset:c}=e,{classes:u}=g(),[p,f]=(0,a.useState)(!1);let m,y,b,w;return t[0]!==n?(m="object"==typeof n&&n&&"stack"in n?(0,d.jsx)(s.A,{title:"Get stack trace",children:(0,d.jsx)(l.A,{onClick:()=>{f(!0)},color:"primary",children:(0,d.jsx)(o.A,{})})}):null,t[0]=n,t[1]=m):m=t[1],t[2]!==c?(y=c?(0,d.jsx)(s.A,{title:"Retry",children:(0,d.jsx)(l.A,{onClick:c,color:"primary",children:(0,d.jsx)(i.A,{})})}):null,t[2]=c,t[3]=y):y=t[3],t[4]!==n||t[5]!==p?(b=p?(0,d.jsx)(a.Suspense,{fallback:null,children:(0,d.jsx)(h,{error:n,onClose:()=>{f(!1)}})}):null,t[4]=n,t[5]=p,t[6]=b):b=t[6],t[7]!==u.iconFloat||t[8]!==m||t[9]!==y||t[10]!==b?(w=(0,d.jsxs)("div",{className:u.iconFloat,children:[m,y,b]}),t[7]=u.iconFloat,t[8]=m,t[9]=y,t[10]=b,t[11]=w):w=t[11],w}const m=function(e){const t=(0,r.c)(8),{error:n,onReset:a}=e,{classes:i}=g(),o=`${n}`;let s;if(t[0]!==i||t[1]!==n||t[2]!==a||t[3]!==o){const e=o.indexOf("expected an instance of"),r=-1!==e?o.slice(0,e):o,l=function(e){let t="";const n=e.indexOf("is not assignable");if(-1!==n){const r=e.slice(0,n+17),a=/.*at path "(.*)" snapshot `(.*)` is not assignable/m.exec(r);a&&(e=`Failed to load element at ${a[1]}...Failed element had snapshot`,t=a[2]);const i=/.*snapshot `(.*)` is not assignable/.exec(r);i&&(e="Failed to load element...Failed element had snapshot",t=i[1])}return t}(o);let c;t[5]!==n||t[6]!==a?(c=(0,d.jsx)(f,{error:n,onReset:a}),t[5]=n,t[6]=a,t[7]=c):c=t[7],s=(0,d.jsxs)(p,{children:[r.slice(0,1e4),c,l?(0,d.jsx)("pre",{className:i.bg,children:JSON.stringify(JSON.parse(l),null,2)}):null]}),t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=s}else s=t[4];return s}},12919(e,t,n){n.d(t,{A:()=>s});var r=n(55614),a=n(90066),i=n(15731),o=n(44460);function s(e){const t=(0,r.c)(7);let n,s,l,c;return t[0]!==e?(({children:n,...s}=e),t[0]=e,t[1]=n,t[2]=s):(n=t[1],s=t[2]),t[3]===Symbol.for("react.memo_cache_sentinel")?(l=(0,o.jsx)(a.A,{fontSize:"small"}),t[3]=l):l=t[3],t[4]!==n||t[5]!==s?(c=(0,o.jsxs)(i.A,{...s,target:"_blank",rel:"noopener noreferrer",children:[n," ",l]}),t[4]=n,t[5]=s,t[6]=c):c=t[6],c}},11173(e,t,n){n.d(t,{A:()=>m});var r=n(55614),a=n(30128),i=n(35703),o=n(62633),s=n(63209),l=n(44641),c=n(64975),d=n(62088),u=n(57081),p=n(28910),h=n(44460);function g(e){const t=(0,r.c)(17),{onClose:n,open:a,onFactoryReset:o}=e;let c;t[0]!==n||t[1]!==o?(c=function(e){"reset"===e&&o(),n()},t[0]=n,t[1]=o,t[2]=c):c=t[2];const d=c;let g,f,m,y,b,w;return t[3]!==d?(g=()=>{d()},t[3]=d,t[4]=g):g=t[4],t[5]===Symbol.for("react.memo_cache_sentinel")?(f=(0,h.jsx)(s.A,{children:(0,h.jsx)(u.A,{children:"Are you sure you want to reset? This will restore the default configuration."})}),t[5]=f):f=t[5],t[6]!==d?(m=(0,h.jsx)(i.A,{onClick:()=>{d()},color:"primary",children:"Cancel"}),t[6]=d,t[7]=m):m=t[7],t[8]!==d?(y=(0,h.jsx)(i.A,{onClick:()=>{d("reset")},color:"primary",variant:"contained",children:"OK"}),t[8]=d,t[9]=y):y=t[9],t[10]!==m||t[11]!==y?(b=(0,h.jsxs)(l.A,{children:[m,y]}),t[10]=m,t[11]=y,t[12]=b):b=t[12],t[13]!==a||t[14]!==g||t[15]!==b?(w=(0,h.jsxs)(p.A,{title:"Reset",onClose:g,open:a,children:[f,b]}),t[13]=a,t[14]=g,t[15]=b,t[16]=w):w=t[16],w}const f=e=>{const t=(0,r.c)(10),{onFactoryReset:n,resetButtonText:o}=e,[s,l]=(0,a.useState)(!1);let c,d,u,p,f;return t[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{l(!0)},t[0]=c):c=t[0],t[1]!==o?(d=(0,h.jsx)(i.A,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:c,children:o}),t[1]=o,t[2]=d):d=t[2],t[3]===Symbol.for("react.memo_cache_sentinel")?(u=()=>{l(!1)},t[3]=u):u=t[3],t[4]!==s||t[5]!==n?(p=(0,h.jsx)(g,{onClose:u,open:s,onFactoryReset:n}),t[4]=s,t[5]=n,t[6]=p):p=t[6],t[7]!==d||t[8]!==p?(f=(0,h.jsxs)(h.Fragment,{children:[d,p]}),t[7]=d,t[8]=p,t[9]=f):f=t[9],f};function m(e){const t=(0,r.c)(15),{componentStack:n,error:a,onFactoryReset:u,resetButtonText:p}=e,g=void 0===a?"No error message provided":a,m=void 0===p?"Factory Reset":p;let b,w,v,S,x,k,C;return t[0]===Symbol.for("react.memo_cache_sentinel")?(b=(0,h.jsx)(o.A,{children:"Fatal error"}),t[0]=b):b=t[0],t[1]!==g?(w=(0,h.jsx)(d.A,{error:g}),t[1]=g,t[2]=w):w=t[2],t[3]!==n?(v=(0,h.jsx)("pre",{children:n}),t[3]=n,t[4]=v):v=t[4],t[5]!==w||t[6]!==v?(S=(0,h.jsxs)(s.A,{children:[w,v]}),t[5]=w,t[6]=v,t[7]=S):S=t[7],t[8]===Symbol.for("react.memo_cache_sentinel")?(x=(0,h.jsx)(i.A,{color:"secondary",variant:"contained",onClick:y,children:"Refresh"}),t[8]=x):x=t[8],t[9]!==u||t[10]!==m?(k=(0,h.jsxs)(l.A,{children:[x,(0,h.jsx)(f,{onFactoryReset:u,resetButtonText:m})]}),t[9]=u,t[10]=m,t[11]=k):k=t[11],t[12]!==S||t[13]!==k?(C=(0,h.jsxs)(c.A,{maxWidth:"xl",open:!0,children:[b,S,k]}),t[12]=S,t[13]=k,t[14]=C):C=t[14],C}function y(){window.location.reload()}},72484(e,t,n){n.d(t,{A:()=>_});var r=n(30128),a=n(75281),i=n(53203),o=n(88793),s=n(29145),l=n(69566),c=n(55614),d=n(35703),u=n(54825),p=n(1241),h=n(3787),g=n(23886),f=n(19608),m=n(46625),y=n(16640),b=n(44460);const w=(0,m.n)()(e=>({filename:{marginLeft:e.spacing(1)}})),v=(0,h.mV)()&&!g.isElectron;async function S(){const[e]=await window.showOpenFilePicker();return(0,f.storeFileHandleLocation)(e)}function x(e){const t=(0,c.c)(4),{setLocation:n}=e;if(v){let e;return t[0]!==n?(e=(0,b.jsx)(d.A,{variant:"outlined",onClick:async()=>{try{n(await S())}catch(e){const t=e;if("AbortError"!==t.name)throw t}},children:"Choose File"}),t[0]=n,t[1]=e):e=t[1],e}let r;return t[2]!==n?(r=(0,b.jsxs)(d.A,{variant:"outlined",component:"label",children:["Choose File",(0,b.jsx)("input",{type:"file",hidden:!0,onChange:e=>{const{target:t}=e,r=t.files?.[0];if(r)if(g.isElectron){const{webUtils:e}=window.require("electron");n({localPath:e.getPathForFile(r),locationType:"LocalPathLocation"})}else{const e=(0,f.storeBlobLocation)({blob:r});"blobId"in e&&n(e)}}})]}),t[2]=n,t[3]=r):r=t[3],r}function k(e){const t=(0,c.c)(9),{location:n,setLocation:r}=e;let i;t[0]!==n||t[1]!==r?(i=async()=>{if((0,y.Qm)(n))try{await(0,f.ensureFileHandleReady)(n.handleId,!0),r({...n})}catch{try{r(await S())}catch(e){const t=e;if("AbortError"!==t.name)throw t}}},t[0]=n,t[1]=r,t[2]=i):i=t[2];const o=i;let s,l,p;return t[3]===Symbol.for("react.memo_cache_sentinel")?(s=(0,b.jsx)(u.A,{color:"error",children:"(need to reload)"}),t[3]=s):s=t[3],t[4]!==o||t[5]!==n?(l=(0,y.Qm)(n)&&(0,b.jsx)(d.A,{size:"small",variant:"text",color:"primary",onClick:o,children:"Reopen"}),t[4]=o,t[5]=n,t[6]=l):l=t[6],t[7]!==l?(p=(0,b.jsxs)(a.A,{display:"flex",alignItems:"center",gap:1,children:[s,l]}),t[7]=l,t[8]=p):p=t[8],p}const C=function(e){const t=(0,c.c)(17),{location:n,setLocation:r}=e,{classes:i}=w();let o;t[0]!==n?(o=function(e){if(e)return(0,y.rF)(e)?e.name:(0,y.EV)(e)?e.localPath:(0,y.Qm)(e)?e.name:void 0}(n),t[0]=n,t[1]=o):o=t[1];const s=o;let l;t[2]!==r?(l=(0,b.jsx)(a.A,{children:(0,b.jsx)(p.A,{fullWidth:!0,children:(0,b.jsx)(x,{setLocation:r})})}),t[2]=r,t[3]=l):l=t[3];const d=s?"initial":"textSecondary",h=s||"No file chosen";let g,m,v,S;return t[4]!==i.filename||t[5]!==d||t[6]!==h?(g=(0,b.jsx)(u.A,{component:"span",className:i.filename,color:d,children:h}),t[4]=i.filename,t[5]=d,t[6]=h,t[7]=g):g=t[7],t[8]!==n||t[9]!==r?(m=n&&function(e){return!(!e||((0,y.rF)(e)?(0,f.getBlob)(e.blobId):!(0,y.Qm)(e)||(0,f.getFileFromCache)(e.handleId)))}(n)&&(0,b.jsx)(k,{location:n,setLocation:r}),t[8]=n,t[9]=r,t[10]=m):m=t[10],t[11]!==g||t[12]!==m?(v=(0,b.jsxs)(a.A,{children:[g,m]}),t[11]=g,t[12]=m,t[13]=v):v=t[13],t[14]!==l||t[15]!==v?(S=(0,b.jsxs)(a.A,{display:"flex",flexDirection:"row",alignItems:"center",children:[l,v]}),t[14]=l,t[15]=v,t[16]=S):S=t[16],S};var T=n(23149);const A=(0,l.observer)(function({location:e,label:t,style:n,setLocation:r}){return(0,b.jsx)(T.A,{variant:"outlined",fullWidth:!0,defaultValue:e&&(0,y.C1)(e)?e.uri:"",label:t||"Enter URL",style:n,onChange:e=>{r({uri:e.target.value.trim(),locationType:"UriLocation"})},slotProps:{htmlInput:{"data-testid":"urlInput"}}})});function M(e){const t=(0,c.c)(13),{toggleButtonValue:n,selectedAccount:r,location:a,inline:i,setLocation:o}=e;if(r?.SelectorComponent){let e;return t[0]!==r||t[1]!==o?(e=(0,b.jsx)(r.SelectorComponent,{setLocation:o,selectedAccount:r}),t[0]=r,t[1]=o,t[2]=e):e=t[2],e}if("url"===n){const e=r?.selectorLabel;let n,s;return t[3]!==i?(n=i?{margin:0}:void 0,t[3]=i,t[4]=n):n=t[4],t[5]!==a||t[6]!==o||t[7]!==e||t[8]!==n?(s=(0,b.jsx)(A,{location:a,setLocation:o,label:e,style:n}),t[5]=a,t[6]=o,t[7]=e,t[8]=n,t[9]=s):s=t[9],s}if("file"===n){let e;return t[10]!==a||t[11]!==o?(e=(0,b.jsx)(C,{location:a,setLocation:o}),t[10]=a,t[11]=o,t[12]=e):e=t[12],e}return null}var I=n(77065),P=n(78125),L=n(30097),R=n(31961),F=n(9378);function D(e){return e.length>5?`${e.slice(0,5)}`:e}function N(e){const t=(0,c.c)(8),{account:n}=e,r=n.name,a=n.internetAccountId;let i,o,s;return t[0]!==n?(i=function(e){const{toggleContents:t,name:n}=e;return t?"string"==typeof t?D(t):t:D(n)}(n),t[0]=n,t[1]=i):i=t[1],t[2]!==n.internetAccountId||t[3]!==i?(o=(0,b.jsx)(P.A,{value:a,children:i}),t[2]=n.internetAccountId,t[3]=i,t[4]=o):o=t[4],t[5]!==n.name||t[6]!==o?(s=(0,b.jsx)(L.A,{title:r,children:o}),t[5]=n.name,t[6]=o,t[7]=s):s=t[7],s}function B(e){const t=(0,c.c)(6),{onClick:n,disabled:r,children:a}=e;let i,o;return t[0]!==n?(i=e=>{n(e)},t[0]=n,t[1]=i):i=t[1],t[2]!==a||t[3]!==r||t[4]!==i?(o=(0,b.jsx)(P.A,{value:"more",selected:!1,disabled:r,onClick:i,children:a}),t[2]=a,t[3]=r,t[4]=i,t[5]=o):o=t[5],o}function V(e){const t=(0,c.c)(13),{value:n,shownAccountIds:r,hiddenAccountIds:a,accountMap:i,onChange:o,onHiddenAccountSelect:s}=e;let l;if(t[0]!==i||t[1]!==a||t[2]!==o||t[3]!==s||t[4]!==r||t[5]!==n){let e;t[7]!==i?(e=e=>i[e],t[7]=i,t[8]=e):e=t[8];const c=r.map(e);let d;t[9]!==i?(d=e=>i[e],t[9]=i,t[10]=d):d=t[10];const u=a.map(d);let p,h;t[11]===Symbol.for("react.memo_cache_sentinel")?(p=!("undefined"!=typeof window&&null!==new URLSearchParams(window.location.search).get("adminKey"))&&(0,b.jsx)(P.A,{value:"file","aria-label":"local file",children:"File"}),h=(0,b.jsx)(P.A,{value:"url","aria-label":"url",children:"URL"}),t[11]=p,t[12]=h):(p=t[11],h=t[12]),l=(0,b.jsxs)(R.A,{value:n,exclusive:!0,size:"small",onChange:o,"aria-label":"file, url, or account picker",children:[p,h,c.map(E),u.length>0&&(0,b.jsxs)(F.A,{menuItems:u.map(e=>({label:e.name,onClick:()=>{s(e.internetAccountId)}})),ButtonComponent:B,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:["More",(0,b.jsx)(I.A,{})]})]}),t[0]=i,t[1]=a,t[2]=o,t[3]=s,t[4]=r,t[5]=n,t[6]=l}else l=t[6];return l}function E(e){return(0,b.jsx)(N,{account:e},e.internetAccountId)}function z(e){return e.internetAccountId}function j(e){return[e.internetAccountId,e]}function H(e){return"HTTPBasicInternetAccount"!==e.type}const _=(0,l.observer)(function({inline:e,location:t,name:n,description:l,rootModel:d,setLocation:u}){const[p,h]=(0,r.useState)(()=>function(e){return e&&"internetAccountId"in e&&e.internetAccountId?e.internetAccountId:!e||(0,y.C1)(e)?"url":"file"}(t)),{accountMap:f,shownAccountIds:m,hiddenAccountIds:w,recentlyUsed:v,setRecentlyUsed:S}=function(e){const t=(0,c.c)(14);let n;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=[],t[0]=n):n=t[0];const[r,a]=(0,g.useLocalStorage)("fileSelector-recentlyUsedInternetAccounts",n);let i,o,s,l;if(t[1]!==r||t[2]!==e){const n=(0,y.bV)(e)?e.internetAccounts.filter(H):[],a=Object.fromEntries(n.map(j));let l;t[6]!==r?(l=(e,t)=>r.indexOf(e)-r.indexOf(t),t[6]=r,t[7]=l):l=t[7];const c=[...new Set(n.map(z))].sort(l);i=a,o=c.slice(0,2),s=c.slice(2),t[1]=r,t[2]=e,t[3]=i,t[4]=o,t[5]=s}else i=t[3],o=t[4],s=t[5];return t[8]!==r||t[9]!==a||t[10]!==i||t[11]!==o||t[12]!==s?(l={accountMap:i,shownAccountIds:o,hiddenAccountIds:s,recentlyUsed:r,setRecentlyUsed:a},t[8]=r,t[9]=a,t[10]=i,t[11]=o,t[12]=s,t[13]=l):l=t[13],l}(d),x=f[p],k=(0,r.useCallback)(e=>{u(function(e,t){return t&&(0,y.C1)(e)?{...e,internetAccountId:t.internetAccountId}:e}(e,x))},[u,x]);(0,r.useEffect)(()=>{x&&(0,y.C1)(t)&&t.internetAccountId!==x.internetAccountId&&k(t)},[t,x,k]);const C=(0,r.useCallback)(e=>{e&&(S([...new Set([e,...v].filter(g.notEmpty))]),h(e),(0,y.C1)(t)&&k(t))},[t,v,S,k]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a.A,{display:"flex",children:(0,b.jsx)(i.A,{shrink:!0,children:n})}),(0,b.jsx)(o.A,{children:(0,b.jsxs)(a.A,{display:"flex",flexDirection:e?"row":"column",gap:.5,children:[(0,b.jsx)(V,{value:p,shownAccountIds:m,hiddenAccountIds:w,accountMap:f,onChange:(e,t)=>{C(t)},onHiddenAccountSelect:C}),(0,b.jsx)(M,{toggleButtonValue:p,selectedAccount:x,location:t,inline:e,setLocation:k})]})}),(0,b.jsx)(s.A,{children:l})]})})},51049(e,t,n){n.d(t,{A:()=>d});var r=n(55614),a=n(54825),i=n(64261),o=n(46625),s=n(81285),l=n(44460);const c=(0,o.n)()({dots:{"&::after":{display:"inline-block",content:'""',width:"1em",textAlign:"left",animation:`${s.i7`
      0% {
        content: '';
      }
      25% {
          content: '.';
      }
      50% {
        content: '..';
      }
      75% {
        content: '...';
      }
      `} 1.2s infinite ease-in-out`}}});function d(e){const t=(0,r.c)(6),{message:n,children:o,variant:s,...d}=e,u=void 0===s?"body2":s,{classes:p}=c(),h=a.A,g=(0,i.cx)(p.dots,d.className),f=n||"Loading";let m;return t[0]!==h||t[1]!==d||t[2]!==g||t[3]!==f||t[4]!==u?(m=(0,l.jsx)(h,{className:g,...d,variant:u,children:f}),t[0]=h,t[1]=d,t[2]=g,t[3]=f,t[4]=u,t[5]=m):m=t[5],m}},79659(e,t,n){n.d(t,{P:()=>s,R:()=>o});var r=n(55614),a=n(44460);function i(e){return"black"===e?{midnight:"#808080",forrest:"#666666",grape:"#4d4d4d",mandarin:"#333333",gray:"#1a1a1a"}:"white"===e?{midnight:"#ffffff",forrest:"#e6e6e6",grape:"#cccccc",mandarin:"#b3b3b3",gray:"#999999"}:{midnight:"#0d233f",forrest:"#135560",grape:"#721e63",mandarin:"#ffb11d",gray:"#dadada"}}function o(e){const t=(0,r.c)(2),{variant:n}=e;let i;return t[0]!==n?(i=(0,a.jsx)("svg",{viewBox:"0 0 175 175",children:(0,a.jsx)(l,{variant:n})}),t[0]=n,t[1]=i):i=t[1],i}function s(e){const t=(0,r.c)(2),{variant:n}=e;let i;return t[0]!==n?(i=(0,a.jsxs)("svg",{viewBox:"0 0 641 175",children:[(0,a.jsx)(c,{variant:n}),(0,a.jsx)(l,{variant:n})]}),t[0]=n,t[1]=i):i=t[1],i}function l(e){const t=(0,r.c)(18),{variant:n}=e;let o;t[0]!==n?(o=i(n),t[0]=n,t[1]=o):o=t[1];const s=o;let l,c,d,u,p,h;return t[2]!==s.midnight?(l=(0,a.jsx)("path",{style:{fill:s.midnight},d:"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z"}),t[2]=s.midnight,t[3]=l):l=t[3],t[4]!==s.forrest?(c=(0,a.jsx)("path",{style:{fill:s.forrest},d:"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z"}),t[4]=s.forrest,t[5]=c):c=t[5],t[6]!==s.grape?(d=(0,a.jsx)("path",{style:{fill:s.grape},d:"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z"}),t[6]=s.grape,t[7]=d):d=t[7],t[8]!==s.mandarin?(u=(0,a.jsx)("path",{style:{fill:s.mandarin},d:"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z"}),t[8]=s.mandarin,t[9]=u):u=t[9],t[10]!==s.gray?(p=(0,a.jsx)("path",{style:{fill:s.gray},d:"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z"}),t[10]=s.gray,t[11]=p):p=t[11],t[12]!==l||t[13]!==c||t[14]!==d||t[15]!==u||t[16]!==p?(h=(0,a.jsxs)(a.Fragment,{children:[l,c,d,u,p]}),t[12]=l,t[13]=c,t[14]=d,t[15]=u,t[16]=p,t[17]=h):h=t[17],h}function c(e){const t=(0,r.c)(13),{variant:n}=e;let o;t[0]!==n?(o=i(n),t[0]=n,t[1]=o):o=t[1];const s=o;let l,c,d,u,p,h,g,f,m;return t[2]!==s.midnight?(l={fill:s.midnight},t[2]=s.midnight,t[3]=l):l=t[3],t[4]===Symbol.for("react.memo_cache_sentinel")?(c=(0,a.jsx)("path",{d:"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z"}),d=(0,a.jsx)("path",{d:"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z"}),u=(0,a.jsx)("path",{d:"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z"}),p=(0,a.jsx)("path",{d:"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z"}),h=(0,a.jsx)("path",{d:"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z"}),g=(0,a.jsx)("path",{d:"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z"}),f=(0,a.jsx)("path",{d:"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z"}),t[4]=c,t[5]=d,t[6]=u,t[7]=p,t[8]=h,t[9]=g,t[10]=f):(c=t[4],d=t[5],u=t[6],p=t[7],h=t[8],g=t[9],f=t[10]),t[11]!==l?(m=(0,a.jsxs)("g",{"aria-label":"JBrowse",transform:"translate(213.084 144.241)",style:l,children:[c,d,u,p,h,g,f]}),t[11]=l,t[12]=m):m=t[12],m}},45084(e,t,n){n.d(t,{A:()=>l});var r=n(55614),a=n(30128),i=n(39926),o=n(44460);function s(e){return!!e}const l=function(e){const t=(0,r.c)(18),{width:n,height:l,highResolutionScaling:c,style:d,imageData:u,blockKey:p,showSoftClip:h}=e,g=void 0===c?1:c;let f;t[0]!==d?(f=void 0===d?{}:d,t[0]=d,t[1]=f):f=t[1];const m=f,[y,b]=(0,a.useState)(!1),w=(0,a.useRef)(null);let v,S;t[2]!==u?(v=()=>{if(!u)return;const e=w.current;if(!e)return;const t=e.getContext("2d");t&&(t.clearRect(0,0,e.width,e.height),(0,i.pv)(u,t),b(!0))},S=[u],t[2]=u,t[3]=v,t[4]=S):(v=t[3],S=t[4]),(0,a.useEffect)(v,S);const x=h?"softclipped":"",k=y?"done":"";let C;t[5]!==p||t[6]!==x||t[7]!==k?(C=["prerendered_canvas",x,p,k].filter(s),t[5]=p,t[6]=x,t[7]=k,t[8]=C):C=t[8];const T=C.join("_"),A=n*g,M=l*g;let I,P;return t[9]!==l||t[10]!==m||t[11]!==n?(I={width:n,height:l,...m},t[9]=l,t[10]=m,t[11]=n,t[12]=I):I=t[12],t[13]!==M||t[14]!==I||t[15]!==T||t[16]!==A?(P=(0,o.jsx)("canvas",{"data-testid":T,ref:w,width:A,height:M,style:I}),t[13]=M,t[14]=I,t[15]=T,t[16]=A,t[17]=P):P=t[17],P}},35864(e,t,n){n.d(t,{A:()=>c});var r=n(55614),a=n(30128),i=n(64261),o=n(46625),s=n(44460);const l=(0,o.n)()({horizontalHandle:{cursor:"row-resize",width:"100%"},verticalHandle:{cursor:"col-resize",height:"100%"},flexbox_verticalHandle:{cursor:"col-resize",alignSelf:"stretch"},flexbox_horizontalHandle:{cursor:"row-resize",alignSelf:"stretch"}}),c=function(e){const t=(0,r.c)(24);let n,o,c,d,u,p;t[0]!==e?(({onDrag:n,vertical:u,flexbox:p,className:c,onMouseDown:o,...d}=e),t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=d,t[5]=u,t[6]=p):(n=t[1],o=t[2],c=t[3],d=t[4],u=t[5],p=t[6]);const h=void 0!==u&&u,g=void 0!==p&&p,[f,m]=(0,a.useState)(!1),y=(0,a.useRef)(0),b=(0,a.useRef)(0),{classes:w}=l();let v;t[7]!==h?(v=e=>h?e.clientX:e.clientY,t[7]=h,t[8]=v):v=t[8];const S=v;let x,k,C;t[9]!==S||t[10]!==f||t[11]!==n?(x=()=>{if(!f)return;const e=function(e){e.preventDefault();const t=S(e),r=y.current-t,a=t-b.current;b.current=t,n(a,r)},t=function(){m(!1)};return window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",t,!0),()=>{window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",t,!0)}},k=[f,n,S],t[9]=S,t[10]=f,t[11]=n,t[12]=x,t[13]=k):(x=t[12],k=t[13]),(0,a.useEffect)(x,k),t[14]!==S||t[15]!==o?(C=e=>{e.preventDefault();const t=S(e);y.current=t,b.current=t,m(!0),o?.(e)},t[14]=S,t[15]=o,t[16]=C):C=t[16];const T=C,A=g?h?w.flexbox_verticalHandle:w.flexbox_horizontalHandle:h?w.verticalHandle:w.horizontalHandle;let M,I;return t[17]!==A||t[18]!==c?(M=(0,i.cx)(c,A),t[17]=A,t[18]=c,t[19]=M):M=t[19],t[20]!==T||t[21]!==d||t[22]!==M?(I=(0,s.jsx)("div",{"data-resizer":"true",onMouseDown:T,className:M,...d}),t[20]=T,t[21]=d,t[22]=M,t[23]=I):I=t[23],I}},37472(e,t,n){n.d(t,{A:()=>p});var r=n(55614),a=n(30128),i=n(90697),o=n(93972),s=n.n(o),l=n(23886),c=n(44460);let d=!1;const u=new RegExp(["a","b","br","code","div","em","h1","h2","h3","h4","h5","h6","i","img","li","p","pre","span","small","strong","table","tbody","sup","sub","td","tfoot","th","thead","tr","u","ul"].map(e=>String.raw`<${e}\b[^>]*>`).join("|"),"i");function p(e){const t=(0,r.c)(6),{html:n,className:o}=e,d=(0,l.linkify)(`${n}`),p=(g=d,u.test(g)?d:s()(d));var g;let f;t[0]===Symbol.for("react.memo_cache_sentinel")?(f=[],t[0]=f):f=t[0],(0,a.useEffect)(h,f);const m=i.A.sanitize(p);let y,b;return t[1]!==m?(y={__html:m},t[1]=m,t[2]=y):y=t[2],t[3]!==o||t[4]!==y?(b=(0,c.jsx)("span",{className:o,dangerouslySetInnerHTML:y}),t[3]=o,t[4]=y,t[5]=b):b=t[5],b}function h(){d||(d=!0,i.A.addHook("afterSanitizeAttributes",g))}function g(e){"A"===e.tagName&&(e.setAttribute("rel","noopener noreferrer"),e.setAttribute("target","_blank"))}},92558(e,t,n){n.r(t),n.d(t,{category10:()=>r,dark2:()=>a,ggplot2Colors3:()=>u,ggplot2Colors4:()=>d,ggplot2Colors5:()=>c,ggplot2Colors6:()=>l,set1:()=>i,set2:()=>o,tableau10:()=>s});const r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],i=["#377eb8","#e41a1c","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],o=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],s=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],l=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"],c=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"],d=["#F8766D","#7CAE00","#00BFC4","#C77CFF"],u=["#F8766D","#00BA38","#619CFF"]},10732(e,t,n){n.r(t),n.d(t,{AssemblySelector:()=>i.A,BaseTooltip:()=>b.A,CascadingMenu:()=>o.A,CascadingMenuButton:()=>s.A,Dialog:()=>l.A,EditableTypography:()=>c.A,ErrorMessage:()=>d.A,ExternalLink:()=>m.A,FatalErrorDialog:()=>u.A,FileSelector:()=>p.A,LoadingEllipses:()=>h.A,LogoFull:()=>a.P,Logomark:()=>a.R,Menu:()=>o.A,PrerenderedCanvas:()=>g.A,ResizeHandle:()=>f.A,SanitizedHTML:()=>y.A,VIEW_HEADER_HEIGHT:()=>w,createJBrowseBaseTheme:()=>r.createJBrowseBaseTheme,createJBrowseTheme:()=>r.createJBrowseTheme,defaultThemes:()=>r.defaultThemes});var r=n(56993),a=n(79659),i=n(27305),o=n(53458),s=n(9378),l=n(28910),c=n(10897),d=n(62088),u=n(11173),p=n(72484),h=n(51049),g=n(45084),f=n(35864),m=n(12919),y=n(37472),b=n(62456);const w=28},56993(e,t,n){n.r(t),n.d(t,{createJBrowseBaseTheme:()=>R,createJBrowseTheme:()=>D,defaultThemes:()=>P});var r=n(33560),a=n(25560),i=n(26407),o=n(43164),s=n(67873),l=n(5444),c=n(17361),d=n.n(c);const u=(0,r.A)(),p=u.palette.augmentColor({color:{main:"#0D233F"}}),h=u.palette.augmentColor({color:{main:"#721E63"}}),g=u.palette.augmentColor({color:{main:"#135560"}}),f=u.palette.augmentColor({color:{main:"#FFB11D"}}),m=u.palette.augmentColor({color:{main:"#aaa"}}),y={A:u.palette.augmentColor({color:o.A}),C:u.palette.augmentColor({color:i.A}),G:u.palette.augmentColor({color:s.A}),T:u.palette.augmentColor({color:a.A})},b=[null,u.palette.augmentColor({color:{main:"#FF8080"}}),u.palette.augmentColor({color:{main:"#80FF80"}}),u.palette.augmentColor({color:{main:"#8080FF"}}),u.palette.augmentColor({color:{main:"#8080FF"}}),u.palette.augmentColor({color:{main:"#80FF80"}}),u.palette.augmentColor({color:{main:"#FF8080"}})],w=[null,u.palette.augmentColor({color:{main:"#8f8f8f"}}),u.palette.augmentColor({color:{main:"#adadad"}}),u.palette.augmentColor({color:{main:"#d8d8d8"}}),u.palette.augmentColor({color:{main:"#d8d8d8"}}),u.palette.augmentColor({color:{main:"#adadad"}}),u.palette.augmentColor({color:{main:"#8f8f8f"}})],v="#e22",S="#3e3",x="#800080",k="#808080",C="#f00",T="#00f",A="#97b8c9",M={primary:p,secondary:h,tertiary:g,quaternary:f,highlight:f,stopCodon:v,startCodon:S,insertion:x,deletion:k,softclip:T,hardclip:C,bases:y,frames:w,framesCDS:b,skip:A};function I(){return{palette:{...M,mode:void 0},components:{MuiLink:{styleOverrides:{root:({theme:e})=>({color:e.palette.tertiary.main})}}}}}const P={default:{...I(),name:"Default (from config)"},lightStock:{...I(),name:"Light (stock)"},lightMinimal:{name:"Light (minimal)",palette:{...M,primary:{main:l.A[900]},secondary:{main:l.A[800]},tertiary:u.palette.augmentColor({color:{main:l.A[900]}})}},darkMinimal:{name:"Dark (minimal)",palette:{...M,mode:"dark",primary:{main:l.A[700]},secondary:{main:l.A[800]},tertiary:u.palette.augmentColor({color:{main:l.A[900]}})}},darkStock:{name:"Dark (stock)",palette:{...M,mode:"dark"},components:{MuiAppBar:{defaultProps:{enableColorOnDark:!0},styleOverrides:{root:({theme:e})=>e.palette.primary.main}}}}};function L(e,t){return t}function R(e){const t={palette:e?.palette,typography:{fontSize:12},spacing:4,components:{MuiTooltip:{styleOverrides:{tooltip:{fontSize:12}}},MuiButton:{defaultProps:{size:"small"},styleOverrides:{root:({theme:e})=>"dark"===e.palette.mode?{color:e.palette.text.primary}:void 0}},MuiAccordion:{defaultProps:{disableGutters:!0,slotProps:{transition:{timeout:150,unmountOnExit:!0}}}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense"}},MuiAutocomplete:{defaultProps:{size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiToolbar:{defaultProps:{variant:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"},styleOverrides:{secondary:{backgroundColor:e?.palette?.quaternary?.main}}},MuiTable:{defaultProps:{size:"small"}},MuiPopover:{defaultProps:{transitionDuration:0}},MuiMenu:{defaultProps:{transitionDuration:0}},MuiMenuItem:{defaultProps:{dense:!0}},MuiTextField:{defaultProps:{margin:"dense",variant:"standard"}},MuiLink:{styleOverrides:{root:({theme:e})=>({color:e.palette.text.secondary})}},MuiCheckbox:{styleOverrides:{root:({theme:e})=>"dark"===e.palette.mode?{color:e.palette.text.secondary,"&.Mui-checked":{color:e.palette.text.secondary}}:void 0}},MuiRadio:{styleOverrides:{root:({theme:e})=>"dark"===e.palette.mode?{color:e.palette.text.secondary,"&.Mui-checked":{color:e.palette.text.secondary}}:void 0}},MuiFormLabel:{styleOverrides:{root:({theme:e})=>"dark"===e.palette.mode?{color:e.palette.text.secondary,"&.Mui-focused":{color:e.palette.text.secondary}}:void 0}},MuiAccordionSummary:{styleOverrides:{root:{backgroundColor:e?.palette?.tertiary?.main},content:{color:e?.palette?.tertiary?.contrastText}}},MuiToggleButtonGroup:{defaultProps:{size:"small"}},MuiButtonBase:{styleOverrides:{root:{"& .MuiTouchRipple-ripple":{animationDuration:"50ms !important"},"& .MuiTouchRipple-child":{animationDuration:"50ms !important"}}}}}};return d()(t,e||{},{arrayMerge:L})}const F=new Map;function D(e={},t=P,n="default"){const a=function(e,t){return JSON.stringify({configTheme:e,themeName:t})}(e,n),i=F.get(a);if(i)return i;const o=(0,r.A)(R("default"===n?d()(t.default,N(e),{arrayMerge:L}):function(e={}){const{palette:t}=e;return N(d()(e,{palette:{quaternary:t?.quaternary||m,tertiary:t?.tertiary||m,highlight:t?.highlight||f,insertion:t?.insertion||x,softclip:t?.softclip||T,skip:t?.skip||A,hardclip:t?.hardclip||C,deletion:t?.deletion||k,startCodon:t?.startCodon||S,stopCodon:t?.stopCodon||v}}))}(t[n])));return F.set(a,o),o}function N(e={}){const t=Object.create(null);for(const n of["primary","secondary","tertiary","quaternary","highlight"]){const r=e.palette?.[n];r&&(t[n]=u.palette.augmentColor("color"in r?r:{color:r}))}return Object.keys(t).length>0?d()(e,{palette:t}):e}},89147(e,t,n){function r(e,t,n){if(!t||!n)return;const{width:r,interRegionPaddingWidth:a,displayedRegions:i,bpPerPx:o,minimumBlockWidth:s}=e,l=function(e,t,n){let r=0;const{displayedRegions:a}=e;if(t.index===n.index)r+=n.offset-t.offset;else{const e=a[t.index];if(r+=e.end-e.start-t.offset,n.index-t.index>=2)for(let e=t.index+1,i=n.index;e<i;e++){const t=a[e];r+=t.end-t.start}r+=n.offset}return r}(e,t,n);let c=0;for(let e=t.index,r=n.index;e<r;e++){const t=i[e];(t.end-t.start)/o>s&&c++}const d=l/(r-a*c),u=e.zoomTo(d);let p=0;d<u&&(p=(u-d)*e.width/2);let h=-p;for(let e=0,n=i.length;e<n;e++){const n=i[e];if(t.index===e){h+=t.offset;break}h+=n.end-n.start}const g=Math.round(h/e.bpPerPx);e.scrollTo(g)}function a(e,t){return Math.floor(e.reversed?e.end-t:e.start+t)+1}function i(e,t){let n=0;const{bpPerPx:r,offsetPx:i,displayedRegions:o,interRegionPaddingWidth:s,staticBlocks:l}=e,c=l.contentBlocks,d=(i+t)*r;if(d<0){const e=o[0];return{...e,oob:!0,coord:a(e,d),offset:d,index:0}}const u=s*r;let p=0;for(let e=0,t=o.length;e<t;e++){const t=o[e],r=t.end-t.start,i=d-n;if(r+n>d&&n<=d)return{...t,oob:!1,offset:i,coord:a(t,i),index:e};if(c[p]?.regionNumber===e){const t=n+r;if(d>=t&&d<t+u&&e+1<o.length){const t=o[e+1];return{...t,oob:!1,offset:0,coord:a(t,0),index:e+1}}n+=r+u,p++}else n+=r}if(d>=n&&o.length>0){const e=o.at(-1),t=d-n+(e.end-e.start);return{...e,oob:!0,offset:t,coord:a(e,t),index:o.length-1}}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}function o({refName:e,coord:t,regionNumber:n,self:r}){let a=0;const{interRegionPaddingWidth:i,bpPerPx:o,displayedRegions:s,staticBlocks:l}=r,c=l.contentBlocks,d=i*o;let u=0,p=0;for(let r=s.length;p<r;p++){const r=s[p],i=r.end-r.start;if(e===r.refName&&t>=r.start&&t<=r.end&&(!n||n===p)){a+=r.reversed?r.end-t:t-r.start;break}c[u]?.regionNumber===p?(a+=i+d,u++):a+=i}if(s[p])return{index:p,offsetPx:Math.round(a/o)}}n.d(t,{Ii:()=>i,eB:()=>o,tw:()=>r})},64152(e,t,n){n.d(t,{A:()=>c});var r=n(10533),a=n(89147),i=n(94095),o=n(40790),s=n(23886),l=n(38817);const c=r.types.model("Base1DView",{id:l.K,displayedRegions:r.types.optional(r.types.frozen(),[]),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:r.types.optional(r.types.number,0),minimumBlockWidth:r.types.optional(r.types.number,0)}).volatile(()=>({features:void 0,volatileWidth:0})).actions(e=>({setDisplayedRegions(t){e.displayedRegions=(0,r.cast)(t)},setBpPerPx(t){e.bpPerPx=t},setVolatileWidth(t){e.volatileWidth=t}})).views(e=>({get width(){return e.volatileWidth},get assemblyNames(){return[...new Set(e.displayedRegions.map(e=>e.assemblyName))]},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return(0,s.sum)(e.displayedRegions.map(e=>e.end-e.start))}})).views(e=>({get dynamicBlocks(){return(0,i.A)(e)},get staticBlocks(){return(0,o.A)(e)},get currBp(){return(0,s.sum)(this.dynamicBlocks.map(e=>e.end-e.start))}})).views(e=>({pxToBp:t=>(0,a.Ii)(e,t),bpToPx:({refName:t,coord:n,regionNumber:r})=>(0,a.eB)({refName:t,coord:n,regionNumber:r,self:e})?.offsetPx})).actions(e=>({setFeatures(t){e.features=t},showAllRegions(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut(){this.zoomTo(2*e.bpPerPx)},zoomIn(){this.zoomTo(e.bpPerPx/2)},zoomTo(t,n=e.width/2){const r=(0,s.clamp)(t,"minBpPerPx"in e?e.minBpPerPx:0,"maxBpPerPx"in e?e.maxBpPerPx:Number.POSITIVE_INFINITY),a=e.bpPerPx;return Math.abs(a-r)<1e-6?a:(e.bpPerPx=r,e.offsetPx=(0,s.clamp)(Math.round((e.offsetPx+n)*a/r-n),e.minOffset,e.maxOffset),e.bpPerPx)},scrollTo(t){const n=(0,s.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},centerAt(t,n,r){if(!n)return;const a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&this.scrollTo(Math.round(a-e.width/2))},scroll(t){const n=e.offsetPx,r=(0,s.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}})).actions(e=>({moveTo(t,n){(0,a.tw)(e,t,n)}}))},27725(e,t,n){n.d(t,{M:()=>i});class r{constructor(e,t){this.low=e,this.high=t}lessThan(e){return this.low<e.low||this.low===e.low&&this.high<e.high}equalTo(e){return this.low===e.low&&this.high===e.high}intersects(e){return!(this.high<e.low||e.high<this.low)}merge(e){return new r(Math.min(this.low,e.low),Math.max(this.high,e.high))}}class a{left=null;right=null;parent=null;color=0;values=[];constructor(e,t,n,a,i,o){if(void 0!==n&&(this.left=n),void 0!==a&&(this.right=a),void 0!==i&&(this.parent=i),void 0!==o&&(this.color=o),void 0!==t&&this.values.push(t),void 0!==e){if(Array.isArray(e)){const[t,n]=e;this.key=t<=n?new r(t,n):new r(n,t)}else this.key=e;this.max=this.key}}lessThan(e){return this.key.lessThan(e.key)}equalTo(e){return this.key.equalTo(e.key)}intersects(e){return this.key.intersects(e.key)}updateMax(){this.max=this.key,this.right?.max&&this.max&&(this.max=this.max.merge(this.right.max)),this.left?.max&&this.max&&(this.max=this.max.merge(this.left.max))}notIntersectLeftSubtree(e){return!this.left||(this.left.max?.high??this.left.key.high)<e.key.low}notIntersectRightSubtree(e){if(!this.right)return!0;const t=this.right.max?.low??this.right.key.low;return e.key.high<t}}class i{root=null;nilNode=new a;insert(e,t){const n=this.treeSearch(this.root,new a(e));if(n)return n.values.push(t),n;const r=new a(e,t,this.nilNode,this.nilNode,null,1);return this.treeInsert(r),this.recalcMax(r),r}search(e){const t=new a(e),n=[];this.treeSearchInterval(this.root,t,n);const r=[];for(const e of n)for(const t of e.values)r.push(t);return r}recalcMax(e){let t=e;for(;null!=t.parent;)t.parent.updateMax(),t=t.parent}treeInsert(e){let t=this.root,n=null;if(null==this.root||this.root===this.nilNode)this.root=e;else{for(;t!==this.nilNode;)n=t,t=e.lessThan(t)?t.left:t.right;e.parent=n,e.lessThan(n)?n.left=e:n.right=e}this.insertFixup(e)}insertFixup(e){let t=e;for(;t!==this.root&&1===t.parent.color;)if(t.parent===t.parent.parent.left){const e=t.parent.parent.right;1===e.color?(t.parent.color=0,e.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.right&&(t=t.parent,this.rotateLeft(t)),t.parent.color=0,t.parent.parent.color=1,this.rotateRight(t.parent.parent))}else{const e=t.parent.parent.left;1===e.color?(t.parent.color=0,e.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.left&&(t=t.parent,this.rotateRight(t)),t.parent.color=0,t.parent.parent.color=1,this.rotateLeft(t.parent.parent))}this.root.color=0}treeSearch(e,t){if(null!=e&&e!==this.nilNode)return t.equalTo(e)?e:t.lessThan(e)?this.treeSearch(e.left,t):this.treeSearch(e.right,t)}treeSearchInterval(e,t,n){null!=e&&e!==this.nilNode&&(e.left===this.nilNode||e.notIntersectLeftSubtree(t)||this.treeSearchInterval(e.left,t,n),e.intersects(t)&&n.push(e),e.right===this.nilNode||e.notIntersectRightSubtree(t)||this.treeSearchInterval(e.right,t,n))}rotateLeft(e){const t=e.right;e.right=t.left,t.left!==this.nilNode&&(t.left.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,e.updateMax(),t.updateMax()}rotateRight(e){const t=e.left;e.left=t.right,t.right!==this.nilNode&&(t.right.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,e.updateMax(),t.updateMax()}}},15146(e,t,n){n.d(t,{Kp:()=>d,R1:()=>c,Yo:()=>s,pB:()=>o,zm:()=>l});var r=n(14562),a=n(80186);class i extends Error{}function o(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw l()}}async function s(e){await new Promise(e=>setTimeout(e,1)),o(e)}function l(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");const e=new i("aborted");return e.code="ERR_ABORTED",e}function c(e){return e?(0,a.R)(e,"abort"):new r.c}function d(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||/\b(aborted|aborterror)\b/i.test(e.message))}},78357(e,t,n){function r(e){const t=new FileReader;return new Promise((n,r)=>{t.onload=e=>{e.target?n(e.target.result):r(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)})}n.d(t,{y:()=>r})},62070(e,t,n){n.d(t,{$G:()=>i,Db:()=>o,fK:()=>s,mh:()=>r});class r{constructor(e=[]){this.blocks=e}*[Symbol.iterator](){yield*this.blocks}push(e){if("ElidedBlock"===e.type&&this.blocks.length>0){const t=this.blocks.at(-1);if("ElidedBlock"===t?.type)return void t.push(e)}this.blocks.push(e)}getBlocks(){return this.blocks}getRegions(){return this.blocks.map(e=>e.toRegion())}map(e,t){return this.blocks.map(e,t)}forEach(e,t){this.blocks.forEach(e,t)}get length(){return this.blocks.length}get totalWidthPx(){let e=0;for(let t=0,n=this.blocks.length;t<n;t++)e+=this.blocks[t].widthPx;return e}get totalWidthPxWithoutBorders(){let e=0;for(let t=0,n=this.blocks.length;t<n;t++)"boundary"!==this.blocks[t].variant&&(e+=this.blocks[t].widthPx);return e}get offsetPx(){return this.blocks.length>0?this.blocks[0].offsetPx:0}get contentBlocks(){return this.blocks.filter(e=>"ContentBlock"===e.type)}get totalBp(){let e=0;for(let t=0,n=this.contentBlocks.length;t<n;t++){const n=this.contentBlocks[t];e+=n.end-n.start}return e}}class a{type="BaseBlock";widthPx=0;constructor(e){Object.assign(this,e),this.assemblyName=e.assemblyName,this.refName=e.refName,this.start=e.start,this.end=e.end,this.key=e.key,this.offsetPx=e.offsetPx}toRegion(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}class i extends a{type="ContentBlock"}class o extends a{type="ElidedBlock";elidedBlockCount=0;constructor(e){super(e),this.widthPx=e.widthPx}push(e){this.elidedBlockCount+=1,this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx}}class s extends a{type="InterRegionPaddingBlock"}},94095(e,t,n){n.d(t,{A:()=>s});var r=n(10533),a=n(62070),i=n(23886),o=n(49303);function s(e,t=!0,n=!0){const{offsetPx:s,displayedRegions:l,bpPerPx:c,width:d,minimumBlockWidth:u,interRegionPaddingWidth:p}=e;if(!d)throw new Error("view has no width, cannot calculate displayed blocks");const h=1/c,g=new a.mh;let f=0;const m=s,y=m+d;for(let e=0;e<l.length;e++){const b=l[e],{assemblyName:w,refName:v,start:S,end:x,reversed:k}=b,C=f+(x-S)*h,T=(x-S)*h,A=(0,r.isStateTreeNode)(b)?(0,r.getSnapshot)(b):b,[M,I]=(0,o.ky)(m,y,f,C);if(void 0!==M&&void 0!==I){let r,o,m,y,b;k?(r=Math.max(S,x-(I-f)*c),o=x-(M-f)*c,m=o===x,y=r===S,b=f+(x-o)*h):(r=(M-f)*c+S,o=Math.min(x,(I-f)*c+S),m=r===S,y=o===x,b=f+(r-S)*h);const C={assemblyName:w,refName:v,start:r,end:o,reversed:k,offsetPx:b,parentRegion:A,regionNumber:e,widthPx:(o-r)*h,isLeftEndOfDisplayedRegion:m,isRightEndOfDisplayedRegion:y,key:`${(0,i.assembleLocStringFast)({assemblyName:w,refName:v,start:r,end:o,reversed:k})}-${e}${k?"-reversed":""}`};t&&0===g.length&&m&&g.push(new a.fK({key:`${C.key}-beforeFirstRegion`,widthPx:-s,offsetPx:C.offsetPx+s,variant:"boundary"})),n&&T<u?g.push(new a.Db(C)):g.push(new a.$G(C)),t&&(T>=u&&C.isRightEndOfDisplayedRegion&&e<l.length-1&&(g.push(new a.fK({key:`${C.key}-rightpad`,widthPx:p,offsetPx:C.offsetPx+C.widthPx})),f+=p),e===l.length-1&&C.isRightEndOfDisplayedRegion&&(b=C.offsetPx+C.widthPx,g.push(new a.fK({key:`${C.key}-afterLastRegion`,widthPx:d-b+s,offsetPx:b,variant:"boundary"}))))}f+=(x-S)*h}return g}},40790(e,t,n){n.d(t,{A:()=>o});var r=n(10533),a=n(62070),i=n(23886);function o(e,t=!0,n=!0,o=0,s=800){const{offsetPx:l,displayedRegions:c,bpPerPx:d,minimumBlockWidth:u,interRegionPaddingWidth:p,width:h}=e,g=l*d,f=(l+h)*d,m=s,y=Math.ceil(m*d),b=1/d,w=1/y;let v=0;const S=new a.mh;for(let e=0;e<c.length;e++){const l=c[e],{assemblyName:h,refName:m,start:x,end:k,reversed:C}=l,T=Math.ceil((k-x)*w),A=(0,r.isStateTreeNode)(l)?(0,r.getSnapshot)(l):l;let M=Math.floor((f-v)*w)+o;M>=T&&(M=T-1);let I=Math.floor((g-v)*w)-o;I<0&&(I=0);const P=(k-x)*b;for(let r=I;r<=M;r+=1){let o,l,g,f;C?(o=Math.max(x,k-(r+1)*y),l=k-r*y,g=l===k,f=o===x):(o=x+r*y,l=Math.min(k,x+(r+1)*y),g=o===x,f=l===k);const w={assemblyName:h,refName:m,start:o,end:l,reversed:C,offsetPx:(v+r*y)*b,parentRegion:A,regionNumber:e,widthPx:(l-o)*b,isLeftEndOfDisplayedRegion:g,isRightEndOfDisplayedRegion:f,key:`${(0,i.assembleLocStringFast)({assemblyName:h,refName:m,start:o,end:l,reversed:C})}-${e}${C?"-reversed":""}`};t&&0===e&&0===r&&S.push(new a.fK({key:`${w.key}-beforeFirstRegion`,widthPx:s,offsetPx:w.offsetPx-s,variant:"boundary"})),n&&P<u?S.push(new a.Db(w)):S.push(new a.$G(w)),t&&(P>=u&&w.isRightEndOfDisplayedRegion&&e<c.length-1&&(v+=p*d,S.push(new a.fK({key:`${w.key}-rightpad`,widthPx:p,offsetPx:w.offsetPx+w.widthPx}))),e===c.length-1&&w.isRightEndOfDisplayedRegion&&(v+=p*d,S.push(new a.fK({key:`${w.key}-afterLastRegion`,widthPx:s,offsetPx:w.offsetPx+w.widthPx,variant:"boundary"}))))}v+=k-x}return S}},89570(e,t,n){function r(e){let t="",n=!1;for(let r=0,a=e.length;r<a;r++){const a=e[r];"<"===a?n=!0:">"===a?n=!1:n||(t+=a)}return t}n.d(t,{Z:()=>r})},97479(e,t,n){n.d(t,{T:()=>a,V:()=>i});const r={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function a(e){return r[e]}function i(e){return!!r[e]}},18846(e,t,n){n.r(t),n.d(t,{contrastingTextColor:()=>i,emphasize:()=>s,isNamedColor:()=>a.V,makeContrasting:()=>l,namedColorToHex:()=>a.T,randomColor:()=>c});var r=n(7201),a=n(97479);function i(e){return o(e)>.5?"black":"white"}function o(e){const t=(0,a.T)(e);return(0,r.J1)(t||e)}function s(e,t=.15){const n=(0,a.T)(e);return(0,r.tL)(n||e,t)}function l(e,t="white",n=3){let i=(0,a.T)(e)||e;const s=(0,a.T)(t)||t,l=o(s);let c=(0,r.eM)(i,s);const d=i;let u=.05;for(;c<n;)i=l>.5?(0,r.e$)(d,u):(0,r.a)(d,u),u+=.05,c=(0,r.eM)(i,s);return i}function c(e){let t=0;for(let n=0;n<e.length;n++)t+=e.charCodeAt(n);return`hsl(${10*t}, 50%, 50%)`}},53121(e,t,n){n.d(t,{M:()=>p});var r=n(97479);function a(e,t,n){return Math.max(t,Math.min(n,e))}function i(e,t=0){const n=10**t;return Math.round(e*n)/n}function o(e){const t=/^#([0-9a-f]{3,8})$/i.exec(e);if(!t)return null;const n=t[1];return 3===n.length?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:1}:4===n.length?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:parseInt(n[3]+n[3],16)/255}:6===n.length?{r:parseInt(n.slice(0,2),16),g:parseInt(n.slice(2,4),16),b:parseInt(n.slice(4,6),16),a:1}:8===n.length?{r:parseInt(n.slice(0,2),16),g:parseInt(n.slice(2,4),16),b:parseInt(n.slice(4,6),16),a:parseInt(n.slice(6,8),16)/255}:null}function s(e,t,n){e=(e%360+360)%360;const r=(1-Math.abs(2*n-1))*t,a=r*(1-Math.abs(e/60%2-1)),i=n-r/2;let o=0,s=0,l=0;return e<60?(o=r,s=a):e<120?(o=a,s=r):e<180?(s=r,l=a):e<240?(s=a,l=r):e<300?(o=a,l=r):(o=r,l=a),{r:Math.round(255*(o+i)),g:Math.round(255*(s+i)),b:Math.round(255*(l+i))}}function l(e,t,n){e/=255,t/=255,n/=255;const r=Math.max(e,t,n),a=Math.min(e,t,n),i=(r+a)/2;if(r===a)return{h:0,s:0,l:i};const o=r-a;let s=0;return s=r===e?((t-n)/o+(t<n?6:0))/6:r===t?((n-e)/o+2)/6:((e-t)/o+4)/6,{h:360*s,s:i>.5?o/(2-r-a):o/(r+a),l:i}}function c(e){if("object"==typeof e){const{h:t,s:n,l:r}=e;return{...s(t,n/100,r/100),a:1}}const t=e.trim().toLowerCase(),n=(0,r.T)(t);if(n)return o(n);if("transparent"===t)return{r:0,g:0,b:0,a:0};const a=o(t);if(a)return a;const i=function(e){const t=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)$/i.exec(e);return t?{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10),a:t[4]?parseFloat(t[4]):1}:null}(t);if(i)return i;const l=function(e){const t=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%\s*(?:,\s*([\d.]+)\s*)?\)$/i.exec(e);if(t){const e=parseFloat(t[1]),n=parseFloat(t[2])/100,r=parseFloat(t[3])/100,a=t[4]?parseFloat(t[4]):1;return{...s(e,n,r),a}}return null}(t);return l||{r:0,g:0,b:0,a:1}}function d(e){return Math.round(a(e,0,255)).toString(16).padStart(2,"0")}function u(e){return{alpha:t=>void 0===t?e.a:u({...e,a:a(t,0,1)}),toHex(){const{r:t,g:n,b:r,a}=e;return a<1?`#${d(t)}${d(n)}${d(r)}${d(255*a)}`:`#${d(t)}${d(n)}${d(r)}`},toRgbString(){const{r:t,g:n,b:r,a}=e;return a<1?`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(r)}, ${i(a,3)})`:`rgb(${Math.round(t)}, ${Math.round(n)}, ${Math.round(r)})`},toHsl(){const{h:t,s:n,l:r}=l(e.r,e.g,e.b);return{h:i(t,1),s:i(100*n,1),l:i(100*r,1),a:e.a}},toHslString(){const{h:t,s:n,l:r}=l(e.r,e.g,e.b);return e.a<1?`hsla(${i(t,1)}, ${i(100*n,1)}%, ${i(100*r,1)}%, ${i(e.a,3)})`:`hsl(${i(t,1)}, ${i(100*n,1)}%, ${i(100*r,1)}%)`},mix(t,n=.5){const r=c("string"==typeof t?t:t.toHex());return u({r:e.r+(r.r-e.r)*n,g:e.g+(r.g-e.g)*n,b:e.b+(r.b-e.b)*n,a:e.a+(r.a-e.a)*n})},darken(t=.1){const{h:n,s:r,l:i}=l(e.r,e.g,e.b);return u({...s(n,r,a(i-t,0,1)),a:e.a})},lighten(t=.1){const{h:n,s:r,l:i}=l(e.r,e.g,e.b);return u({...s(n,r,a(i+t,0,1)),a:e.a})}}}function p(e){return u(c(e))}},34895(e,t,n){n.d(t,{A:()=>r});class r{constructor(e){this.submaps=e}has(e){for(const t of this.submaps.values())if(t.has(e))return!0;return!1}get(e){for(const t of this.submaps.values())if(t.has(e))return t.get(e)}*values(){for(const e of this.keys())yield this.get(e)}*keys(){const e=new Set;for(const t of this.submaps.values())for(const n of t.keys())e.add(n);for(const t of e)yield t}find(e){for(const t of this.submaps.values())for(const n of t.values())if(e(n))return n}*[Symbol.iterator](){for(const e of this.keys())yield[e,this.get(e)]}*entries(){for(const e of this.keys())yield[e,this.get(e)]}}},84769(e,t,n){n.d(t,{E:()=>a});var r=n(39953);function a({cds:e,sequence:t,codonTable:n}){const a=(0,r.o9)(e,t);let i="";for(let e=0;e<a.length;e+=3)i+=n[a.slice(e,e+3)]||"&";return i}},15773(e,t,n){n.d(t,{F6:()=>w,TZ:()=>k,_e:()=>x,ff:()=>b,gg:()=>C,nk:()=>S,sc:()=>v});const r="Salted__";function a(){return"undefined"!=typeof crypto&&void 0!==crypto.subtle}const i=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),o=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),s=new Uint8Array([1,2,4,8,16,32,64,128,27,54]);function l(e,t){let n=0;for(let r=0;r<8;r++){1&t&&(n^=e);const r=128&e;e=e<<1&255,r&&(e^=27),t>>=1}return n}function c(e){const t=new Uint8Array(240);t.set(e);for(let e=8;e<60;e++){const n=t.slice(4*(e-1),4*e);if(e%8==0){const t=n[0];n[0]=i[n[1]]^s[e/8-1],n[1]=i[n[2]],n[2]=i[n[3]],n[3]=i[t]}else if(e%8==4)for(let e=0;e<4;e++)n[e]=i[n[e]];for(let r=0;r<4;r++)t[4*e+r]=t[4*(e-8)+r]^n[r]}return t}function d(e,t){const n=new Uint8Array(16);n.set(e);for(let e=0;e<16;e++)n[e]^=t[e];for(let e=1;e<=14;e++){for(let e=0;e<16;e++)n[e]=i[n[e]];const r=n[1];n[1]=n[5],n[5]=n[9],n[9]=n[13],n[13]=r;const a=n[2],o=n[6];n[2]=n[10],n[6]=n[14],n[10]=a,n[14]=o;const s=n[15];if(n[15]=n[11],n[11]=n[7],n[7]=n[3],n[3]=s,e<14)for(let e=0;e<4;e++){const t=4*e,r=n[t],a=n[t+1],i=n[t+2],o=n[t+3];n[t]=l(r,2)^l(a,3)^i^o,n[t+1]=r^l(a,2)^l(i,3)^o,n[t+2]=r^a^l(i,2)^l(o,3),n[t+3]=l(r,3)^a^i^l(o,2)}const c=t.subarray(16*e,16*(e+1));for(let e=0;e<16;e++)n[e]^=c[e]}return n}function u(e,t){const n=new Uint8Array(16);n.set(e);for(let e=0;e<16;e++)n[e]^=t[224+e];for(let e=13;e>=0;e--){const r=n[13];n[13]=n[9],n[9]=n[5],n[5]=n[1],n[1]=r;const a=n[10],i=n[14];n[10]=n[2],n[14]=n[6],n[2]=a,n[6]=i;const s=n[3];n[3]=n[7],n[7]=n[11],n[11]=n[15],n[15]=s;for(let e=0;e<16;e++)n[e]=o[n[e]];const c=t.subarray(16*e,16*(e+1));for(let e=0;e<16;e++)n[e]^=c[e];if(e>0)for(let e=0;e<4;e++){const t=4*e,r=n[t],a=n[t+1],i=n[t+2],o=n[t+3];n[t]=l(r,14)^l(a,11)^l(i,13)^l(o,9),n[t+1]=l(r,9)^l(a,14)^l(i,11)^l(o,13),n[t+2]=l(r,13)^l(a,9)^l(i,14)^l(o,11),n[t+3]=l(r,11)^l(a,13)^l(i,9)^l(o,14)}}return n}const p=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function h(e){const t=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],n=[3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745];function r(e,t){return e<<t|e>>>32-t}const a=e.length,i=8*a,o=new Uint8Array(a+1+(56-(a+1)%64+64)%64+8);o.set(e),o[a]=128;const s=new DataView(o.buffer);s.setUint32(o.length-8,i>>>0,!0),s.setUint32(o.length-4,Math.floor(i/4294967296),!0);let l=1732584193,c=4023233417,d=2562383102,u=271733878;for(let e=0;e<o.length;e+=64){const a=new Uint32Array(16);for(let t=0;t<16;t++)a[t]=s.getUint32(e+4*t,!0);let i=l,o=c,p=d,h=u;for(let e=0;e<64;e++){let s,l;e<16?(s=o&p|~o&h,l=e):e<32?(s=h&o|~h&p,l=(5*e+1)%16):e<48?(s=o^p^h,l=(3*e+5)%16):(s=p^(o|~h),l=7*e%16),s=s+i+n[e]+a[l]>>>0,i=h,h=p,p=o,o=o+r(s,t[e])>>>0}l=l+i>>>0,c=c+o>>>0,d=d+p>>>0,u=u+h>>>0}const p=new Uint8Array(16),h=new DataView(p.buffer);return h.setUint32(0,l,!0),h.setUint32(4,c,!0),h.setUint32(8,d,!0),h.setUint32(12,u,!0),p}function g(e,t,n,r){const a=new Uint8Array(n+r);let i=0,o=new Uint8Array(0);for(;i<n+r;){const s=new Uint8Array(o.length+e.length+t.length);s.set(o),s.set(e,o.length),s.set(t,o.length+e.length),o=h(s),a.set(o.subarray(0,Math.min(16,n+r-i)),i),i+=16}return{key:a.slice(0,n),iv:a.slice(n,n+r)}}function f(e){return(new TextEncoder).encode(e).slice()}function m(e){return(new TextDecoder).decode(e)}function y(e){let t="";for(const n of e)t+=String.fromCharCode(n);return btoa(t)}async function b(e,t){const n=function(){if("undefined"!=typeof crypto&&crypto.getRandomValues)return crypto.getRandomValues(new Uint8Array(8));const e=new Uint8Array(8);for(let t=0;t<8;t++)e[t]=Math.floor(256*Math.random());return e}(),{key:i,iv:o}=g(f(t),n,32,16);let s;if(a()){const t=await crypto.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt"]),n=await crypto.subtle.encrypt({name:"AES-CBC",iv:o},t,f(e));s=new Uint8Array(n)}else s=function(e,t,n){const r=c(t),a=function(e){const t=16-e.length%16,n=new Uint8Array(e.length+t);return n.set(e),n.fill(t,e.length),n}(e),i=new Uint8Array(a.length);let o=n;for(let e=0;e<a.length;e+=16){const t=a.slice(e,e+16);for(let e=0;e<16;e++)t[e]^=o[e];const n=d(t,r);i.set(n,e),o=n}return i}(f(e),i,o);const l=f(r),u=new Uint8Array(l.length+n.length+s.byteLength);return u.set(l),u.set(n,l.length),u.set(s,l.length+n.length),y(u)}async function w(e,t){const n=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),i=f(r);if(!(n.length>i.length&&m(n.subarray(0,i.length))===r))throw new Error("Invalid encrypted data format");const o=n.slice(i.length,i.length+8),s=n.slice(i.length+8),{key:l,iv:d}=g(f(t),o,32,16);let p;if(a()){const e=await crypto.subtle.importKey("raw",l,{name:"AES-CBC"},!1,["decrypt"]),t=await crypto.subtle.decrypt({name:"AES-CBC",iv:d},e,s);p=new Uint8Array(t)}else p=function(e,t,n){const r=c(t),a=new Uint8Array(e.length);let i=n;for(let t=0;t<e.length;t+=16){const n=e.slice(t,t+16),o=u(n,r);for(let e=0;e<16;e++)o[e]^=i[e];a.set(o,t),i=n}return function(e){const t=e[e.length-1];if(t>16||0===t)throw new Error("Invalid padding");for(let n=e.length-t;n<e.length;n++)if(e[n]!==t)throw new Error("Invalid padding");return e.subarray(0,e.length-t)}(a)}(s,l,d);return m(p)}async function v(e){const t=f(e);if(a()){const e=await crypto.subtle.digest("SHA-256",t);return new Uint8Array(e)}return function(e){function t(e,t){return e>>>t|e<<32-t}function n(e,t,n){return e&t^~e&n}function r(e,t,n){return e&t^e&n^t&n}function a(e){return t(e,2)^t(e,13)^t(e,22)}function i(e){return t(e,6)^t(e,11)^t(e,25)}function o(e){return t(e,7)^t(e,18)^e>>>3}function s(e){return t(e,17)^t(e,19)^e>>>10}const l=e.length,c=8*l,d=new Uint8Array(l+1+(64-(l+9)%64)%64+8);d.set(e),d[l]=128;const u=new DataView(d.buffer);u.setUint32(d.length-4,c>>>0,!1),u.setUint32(d.length-8,Math.floor(c/4294967296),!1);let h=1779033703,g=3144134277,f=1013904242,m=2773480762,y=1359893119,b=2600822924,w=528734635,v=1541459225;const S=new Uint32Array(64);for(let e=0;e<d.length;e+=64){for(let t=0;t<16;t++)S[t]=u.getUint32(e+4*t,!1);for(let e=16;e<64;e++)S[e]=s(S[e-2])+S[e-7]+o(S[e-15])+S[e-16]>>>0;let t=h,l=g,c=f,d=m,x=y,k=b,C=w,T=v;for(let e=0;e<64;e++){const o=T+i(x)+n(x,k,C)+p[e]+S[e]>>>0,s=a(t)+r(t,l,c)>>>0;T=C,C=k,k=x,x=d+o>>>0,d=c,c=l,l=t,t=o+s>>>0}h=h+t>>>0,g=g+l>>>0,f=f+c>>>0,m=m+d>>>0,y=y+x>>>0,b=b+k>>>0,w=w+C>>>0,v=v+T>>>0}const x=new Uint8Array(32),k=new DataView(x.buffer);return k.setUint32(0,h,!1),k.setUint32(4,g,!1),k.setUint32(8,f,!1),k.setUint32(12,m,!1),k.setUint32(16,y,!1),k.setUint32(20,b,!1),k.setUint32(24,w,!1),k.setUint32(28,v,!1),x}(t)}function S(e){return y(e)}function x(e){return y(e).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}async function k(e){return S(await v(e))}async function C(e){return x(await v(e))}},1259(e,t,n){function r(e,t=JSON.stringify){const n=[],r=new Set;for(const a of e){const e=t(a);r.has(e)||(n.push(a),r.add(e))}return n}n.d(t,{Q:()=>r})},3787(e,t,n){n.d(t,{D0:()=>d,N7:()=>h,gw:()=>c,mV:()=>s,pZ:()=>p,pu:()=>u});var r=n(86625);const a="handles";let i;function o(){return i||(i=(0,r.P2)("jbrowse-file-handles",1,{upgrade(e){e.objectStoreNames.contains(a)||e.createObjectStore(a)}})),i}function s(){return"undefined"!=typeof window&&"showOpenFilePicker"in window}let l=0;async function c(e){const t=`fh${Date.now()}-${l++}`,n=await o();return await n.put(a,{handle:e,name:e.name,createdAt:Date.now()},t),t}async function d(e){const t=await o(),n=await t.get(a,e);return n?.handle}async function u(e){const t=await o();await t.delete(a,e)}async function p(e,t=!1){const n={mode:"read"};return"granted"===await e.queryPermission(n)||!(!t||"granted"!==await e.requestPermission(n))}async function h(e){const t=await o(),n=Date.now(),r=t.transaction(a,"readwrite"),i=r.objectStore(a);let s=await i.openCursor();for(;s;)n-s.value.createdAt>e&&await s.delete(),s=await s.continue();await r.done}},61425(e,t,n){n.d(t,{A:()=>i});class r{ids=[];values=[];length=0;clear(){this.length=0}push(e,t){let n=this.length++;for(;n>0;){const e=n-1>>1,r=this.values[e];if(t>=r)break;this.ids[n]=this.ids[e],this.values[n]=r,n=e}this.ids[n]=e,this.values[n]=t}pop(){if(0===this.length)return;const e=this.ids,t=this.values,n=e[0],r=--this.length;if(r>0){const n=e[r],a=t[r];let i=0;const o=r>>1;for(;i<o;){const n=1+(i<<1),o=n+1,s=n+(+(o<r)&+(t[o]<t[n]));if(t[s]>=a)break;e[i]=e[s],t[i]=t[s],i=s}e[i]=n,t[i]=a}return n}peek(){return this.length>0?this.ids[0]:void 0}peekValue(){return this.length>0?this.values[0]:void 0}shrink(){this.ids.length=this.values.length=this.length}}const a=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class i{static from(e,t=0){if(t%8!=0)throw new Error("byteOffset must be 8-byte aligned.");if(0===e.byteLength)throw new Error("Flatbush data buffer is detached (byteLength=0). This usually means the buffer was transferred and is no longer usable.");const[n,r]=new Uint8Array(e,t+0,2);if(251!==n)throw new Error("Data does not appear to be in a Flatbush format.");const o=r>>4;if(3!==o)throw new Error(`Got v${o} data when expected v3.`);const s=a[15&r];if(!s)throw new Error("Unrecognized array type.");const[l]=new Uint16Array(e,t+2,1),[c]=new Uint32Array(e,t+4,1);return new i(c,l,s,void 0,e,t)}constructor(e,t=16,n=Float64Array,i=ArrayBuffer,o,s=0){if(isNaN(e)||e<=0)throw new Error(`Unexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.byteOffset=s;let l=e,c=l;this._levelBounds=[4*l];do{l=Math.ceil(l/this.nodeSize),c+=l,this._levelBounds.push(4*c)}while(1!==l);this.ArrayType=n,this.IndexArrayType=c<16384?Uint16Array:Uint32Array;const d=a.indexOf(n),u=4*c*n.BYTES_PER_ELEMENT;if(-1===d)throw new Error(`Unexpected typed array class: ${n}.`);if(o)this.data=o,this._boxes=new n(o,s+8,4*c),this._indices=new this.IndexArrayType(o,s+8+u,c),this._pos=4*c,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1];else{const r=this.data=new i(8+u+c*this.IndexArrayType.BYTES_PER_ELEMENT);this._boxes=new n(r,8,4*c),this._indices=new this.IndexArrayType(r,8+u,c),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(r,0,2).set([251,48+d]),new Uint16Array(r,2,1)[0]=t,new Uint32Array(r,4,1)[0]=e}this._queue=new r}add(e,t,n=e,r=t){const a=this._pos>>2,i=this._boxes;return this._indices[a]=a,i[this._pos++]=e,i[this._pos++]=t,i[this._pos++]=n,i[this._pos++]=r,e<this.minX&&(this.minX=e),t<this.minY&&(this.minY=t),n>this.maxX&&(this.maxX=n),r>this.maxY&&(this.maxY=r),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const e=this._boxes;if(this.numItems<=this.nodeSize)return e[this._pos++]=this.minX,e[this._pos++]=this.minY,e[this._pos++]=this.maxX,void(e[this._pos++]=this.maxY);const t=this.maxX-this.minX||1,n=this.maxY-this.minY||1,r=new Uint32Array(this.numItems),a=65535/t,i=65535/n,o=this.minX,d=this.minY;for(let t=0,n=0;t<this.numItems;t++){const s=e[n++],l=e[n++],u=e[n++],p=e[n++],h=Math.floor((.5*(s+u)-o)*a),g=Math.floor((.5*(l+p)-d)*i);r[t]=c(h,g)}!function(e,t,n,r,a,i){const o=[0,a];for(;o.length>0;){const r=o.pop(),a=o.pop();if(Math.floor(a/i)>=Math.floor(r/i))continue;if(r-a<10){s(e,t,n,a,r);continue}const c=e[a],d=e[a+r>>1],u=e[r];let p=u;const h=Math.max(c,d);u>h?p=h:h===c?p=Math.max(d,u):h===d&&(p=Math.max(c,u));let g=a-1,f=r+1;for(;;){do{g++}while(e[g]<p);do{f--}while(e[f]>p);if(g>=f)break;l(e,t,n,g,f)}o.push(a,f,f+1,r)}}(r,e,this._indices,0,this.numItems-1,this.nodeSize);for(let t=0,n=0;t<this._levelBounds.length-1;t++){const r=this._levelBounds[t];for(;n<r;){const t=n;let a=e[n++],i=e[n++],o=e[n++],s=e[n++];for(let t=1;t<this.nodeSize&&n<r;t++){const t=e[n++],r=e[n++],l=e[n++],c=e[n++];t<a&&(a=t),r<i&&(i=r),l>o&&(o=l),c>s&&(s=c)}this._indices[this._pos>>2]=t,e[this._pos++]=a,e[this._pos++]=i,e[this._pos++]=o,e[this._pos++]=s}}}search(e,t,n,r,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const s=[],l=[];for(;void 0!==i;){const c=Math.min(i+4*this.nodeSize,o(i,this._levelBounds));for(let o=i;o<c;o+=4){const c=this._boxes[o];if(n<c)continue;const d=this._boxes[o+1];if(r<d)continue;const u=this._boxes[o+2];if(e>u)continue;const p=this._boxes[o+3];if(t>p)continue;const h=0|this._indices[o>>2];i>=4*this.numItems?s.push(h):(void 0===a||a(h,c,d,u,p))&&l.push(h)}i=s.pop()}return l}neighbors(e,t,n=1/0,r=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const s=this._queue,l=[],c=r*r;e:for(;void 0!==i;){const r=Math.min(i+4*this.nodeSize,o(i,this._levelBounds));for(let n=i;n<r;n+=4){const r=0|this._indices[n>>2],o=this._boxes[n],l=this._boxes[n+1],d=this._boxes[n+2],u=this._boxes[n+3],p=e<o?o-e:e>d?e-d:0,h=t<l?l-t:t>u?t-u:0,g=p*p+h*h;g>c||(i>=4*this.numItems?s.push(r<<1,g):(void 0===a||a(r))&&s.push(1+(r<<1),g))}for(;s.length&&1&s.peek();){if(s.peekValue()>c)break e;if(l.push(s.pop()>>1),l.length===n)break e}i=s.length?s.pop()>>1:void 0}return s.clear(),l}}function o(e,t){let n=0,r=t.length-1;for(;n<r;){const a=n+r>>1;t[a]>e?r=a:n=a+1}return t[n]}function s(e,t,n,r,a){for(let i=r+1;i<=a;i++){const a=e[i],o=n[i],s=4*i,l=t[s],c=t[s+1],d=t[s+2],u=t[s+3];let p=i-1;for(;p>=r&&e[p]>a;){e[p+1]=e[p],n[p+1]=n[p];const r=4*p,a=4*(p+1);t[a]=t[r],t[a+1]=t[r+1],t[a+2]=t[r+2],t[a+3]=t[r+3],p--}e[p+1]=a,n[p+1]=o;const h=4*(p+1);t[h]=l,t[h+1]=c,t[h+2]=d,t[h+3]=u}}function l(e,t,n,r,a){const i=e[r];e[r]=e[a],e[a]=i;const o=4*r,s=4*a,l=t[o],c=t[o+1],d=t[o+2],u=t[o+3];t[o]=t[s],t[o+1]=t[s+1],t[o+2]=t[s+2],t[o+3]=t[s+3],t[s]=l,t[s+1]=c,t[s+2]=d,t[s+3]=u;const p=n[r];n[r]=n[a],n[a]=p}function c(e,t){let n=e^t,r=65535^n,a=65535^(e|t),i=e&(65535^t),o=n|r>>1,s=n>>1^n,l=a>>1^r&i>>1^a,c=n&a>>1^i>>1^i;n=o,r=s,a=l,i=c,o=n&n>>2^r&r>>2,s=n&r>>2^r&(n^r)>>2,l^=n&a>>2^r&i>>2,c^=r&a>>2^(n^r)&i>>2,n=o,r=s,a=l,i=c,o=n&n>>4^r&r>>4,s=n&r>>4^r&(n^r)>>4,l^=n&a>>4^r&i>>4,c^=r&a>>4^(n^r)&i>>4,n=o,r=s,a=l,i=c,l^=n&a>>8^r&i>>8,c^=r&a>>8^(n^r)&i>>8,n=l^l>>1,r=c^c>>1;let d=e^t,u=r|65535^(d|n);return d=16711935&(d|d<<8),d=252645135&(d|d<<4),d=858993459&(d|d<<2),d=1431655765&(d|d<<1),u=16711935&(u|u<<8),u=252645135&(u|u<<4),u=858993459&(u|u<<2),u=1431655765&(u|u<<1),(u<<1|d)>>>0}},32725(e,t,n){n.d(t,{A:()=>a});var r=n(23886);function a(e,t="",n=5e3){const a=[e];for(;a.length;){const e=a.pop();for(const[i,o]of Object.entries(e)){if(t.length>n)return(0,r.hashCode)(t);"object"==typeof o&&null!==o?a.push(o):t+="locationType"===i&&"FileHandleLocation"===o?`${i}-BlobLocation`:"handleId"===i?`blobId-fh-blob-${o}`:`${i}-${o}`}}return`adp-${(0,r.hashCode)(t)}`}},206(e,t,n){n.d(t,{g:()=>s});var r=n(86199),a=n(6794);const i={},o=new r.j({fetch:function(e,t,n,r={}){const a=i[e];if(!a)throw new Error(`fetch not registered for ${e}`);return a(e,t,n,r)},size:524288e3,chunkSize:131072,maxFetchSize:104857600,minimumTTL:864e5});class s extends a.A{async fetch(e,t){const n=String(e);i[n]||(i[n]=this.fetchBinaryRange.bind(this));const r=new Headers(t?.headers).get("range");if(r){const t=/bytes=(\d+)-(\d+)/.exec(r);if(t){const[,n,r]=t,a=Number.parseInt(n,10),i=Number.parseInt(r,10)-a,{buffer:s,headers:l}=await o.getRange(`${e}`,a,i+1);return new Response(s,{status:206,headers:l})}}return super.fetch(e,t)}async fetchBinaryRange(e,t,n,r={}){const a=new Date,i=await super.fetch(e,{...r,headers:{...r.headers,range:`bytes=${t}-${n}`}}),o=new Date;if(!i.ok){const r=`HTTP ${i.status} fetching ${e} bytes ${t}-${n}`,a=" (should be 206 for range requests)";throw new Error(`${r}${200===i.status?a:""}`)}const s={};for(const[e,t]of i.headers.entries())s[e]=t;const l=await i.arrayBuffer();return{headers:s,requestDate:a,responseDate:o,buffer:new Uint8Array(l)}}}},11931(e,t,n){n.r(t),n.d(t,{RemoteFileWithRangeCache:()=>s.g,getFetcher:()=>h,openLocation:()=>p,resolveUriLocation:()=>u});var r=n(75631),a=n.n(r),i=n(99496),o=n(19887),s=n(206),l=n(23886),c=n(19608),d=n(16640);function u(e){return e.baseUri?{...e,uri:new URL(e.uri,e.baseUri).href}:e}function p(e,t){if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(a()||l.isElectron)return new i.EY(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){const t=(0,c.getBlob)(e.blobId);if(!t)throw new Error(`file ("${e.name}") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);return new o.A(t)}if(function(e){return"handleId"in e}(e)){const t=(0,c.getFileFromCache)(e.handleId);if(!t)throw new Error(`file ("${e.name}") requires permission. Please reopen the file from track settings`);return new o.A(t)}if((0,d.C1)(e)){if(!e.uri)throw new Error("No URI provided");const n=u(e);if(t){const r=g(e,t);if(r)return r.openLocation(n)}return new s.g(n.uri,{fetch:f})}throw new Error("invalid fileLocation")}function h(e,t){if(!(0,d.C1)(e))throw new Error(`Not a valid UriLocation: ${JSON.stringify(e)}`);if(t){const n=g(e,t);if(n)return n.getFetcher(e)}return f}function g(e,t){const{rootModel:n}=t;if(n&&(0,d.lL)(n))return n.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}async function f(e,t){const n=await fetch(e,t);if(401===n.status&&n.headers.get("WWW-Authenticate")?.includes("Basic"))throw new d._u("Accessing HTTPBasic resource without authentication",e.toString());return n}},72769(e,t,n){n.d(t,{A:()=>a});var r=n(11600);function a(){const e=new r.kJ;return e.addFunction("get",(e,t)=>e.get(t)),e.addFunction("parent",e=>e.parent?.()),e.addFunction("id",e=>e.id()),e.addFunction("cast",e=>e),e.addFunction("log",e=>(console.log(e),e)),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",(e,t)=>e.split(t)),e.addFunction("join",(e,...t)=>[...t].filter(e=>!!e).join(e)),e.addFunction("charAt",(e,t)=>e.charAt(t)),e.addFunction("charCodeAt",(e,t)=>e.charCodeAt(t)),e.addFunction("codePointAt",(e,t)=>e.codePointAt(t)),e.addFunction("includes",(e,t)=>e.includes(t)),e.addFunction("startsWith",(e,t,n)=>e.startsWith(t,n)),e.addFunction("endsWith",(e,t,n)=>e.endsWith(t,n)),e.addFunction("padEnd",(e,t,n)=>e.padEnd(t,n)),e.addFunction("padStart",(e,t,n)=>e.padStart(t,n)),e.addFunction("repeat",(e,t)=>e.repeat(t)),e.addFunction("replace",(e,t,n)=>e.replace(t,n)),e.addFunction("replaceAll",(e,t,n)=>e.replaceAll(t,n)),e.addFunction("slice",(e,t,n)=>e.slice(t,n)),e.addFunction("startsWith",(e,t,n)=>e.startsWith(t,n)),e.addFunction("substring",(e,t,n)=>e.substring(t,n)),e.addFunction("toLowerCase",e=>e.toLowerCase()),e.addFunction("toUpperCase",e=>e.toUpperCase()),e.addFunction("jsonParse",e=>JSON.parse(e)),e.addFunction("trim",e=>e.trim()),e.addFunction("trimEnd",e=>e.trimEnd()),e.addFunction("trimStart",e=>e.trimStart()),e.addFunction("getTag",(e,t)=>{const n=e.get("tags");return n?n[t]:e.get(t)}),e.addBinaryOp("&",15,(e,t)=>e&t),e}},8567(e,t,n){n.d(t,{A:()=>i});var r=n(72769);const a={};function i(e,t){const n=`nosig|${e}`;if(!a[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");const i=e.split("jexl:")[1],o=t?t.compile(i):(0,r.A)().compile(i);a[n]=o}return a[n]}},46624(e,t,n){n.d(t,{A:()=>a});class r{padding=1;intervals=[];data=[];setAllFilled(e){this.allFilled=e}getIntervals(){return this.intervals}getItemAt(e){if(this.allFilled)return this.allFilled;const t=this.intervals,n=t.length;if(0===n)return;if(n<40){for(let r=0;r<n;r+=2)if(e>=t[r]&&e<t[r+1])return this.data[r>>1];return}let r=0,a=n>>1;for(;r<a;){const n=r+a>>>1;t[1+(n<<1)]<=e?r=n+1:a=n}const i=r<<1;return i<n&&e>=t[i]&&e<t[i+1]?this.data[r]:void 0}isRangeClear(e,t){if(this.allFilled)return!1;const n=this.intervals,r=n.length;if(0===r)return!0;if(r<40){for(let a=0;a<r;a+=2){const r=n[a];if(n[a+1]>e&&r<t)return!1}return!0}let a=0,i=r>>1;for(;a<i;){const t=a+i>>>1;n[1+(t<<1)]<=e?a=t+1:i=t}const o=a<<1;return o>=r||n[o]>=t}addRect(e,t){const n=e.l,r=e.r+this.padding,a=this.intervals,i=a.length;if(i<40){let e=i;for(let t=0;t<i;t+=2)if(n<a[t]){e=t;break}a.splice(e,0,n,r),this.data.splice(e>>1,0,t)}else{let e=0,o=i>>1;for(;e<o;){const t=e+o>>>1;a[t<<1]<n?e=t+1:o=t}a.splice(e<<1,0,n,r),this.data.splice(e,0,t)}}discardRange(e,t){if(this.allFilled)return;const n=this.intervals,r=this.data,a=n.length,i=[],o=[];for(let s=0;s<a;s+=2){const a=n[s],l=n[s+1],c=r[s>>1];a>=e&&l<=t||(l<=e||a>=t?(i.push(a,l),o.push(c)):a<e&&l>e?l<=t?(i.push(a,e),o.push(c)):(i.push(a,e,t,l),o.push(c,c)):a<t&&l>t&&(i.push(t,l),o.push(c)))}this.intervals=i,this.data=o}}class a{constructor({pitchX:e=10,pitchY:t=10,maxHeight:n=1e4,hardRowLimit:r=1e4,displayMode:a="normal"}={}){this.pitchX=e,this.pitchY=t,this.hardRowLimit=r,this.maxHeightReached=!1,this.displayMode=a,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(n/this.pitchY),this.pTotalHeight=0}addRect(e,t,n,r,a,i,o){const s=this.pitchX,l=this.pitchY,c=this.rectangles.get(e);if(c)return void 0!==i&&(c.serializableData=i),null===c.top?null:(this.addRectToBitmap(c),c.top*l);const d=Math.trunc(t/s),u=Math.trunc(n/s),p=Math.ceil(r/l),h={id:e,l:d,r:u,top:null,h:p,originalHeight:r,data:a,serializableData:i},g=this.maxHeight;let f=void 0!==o?Math.min(Math.floor(o/l),g):0;if("collapse"!==this.displayMode){const t=this.bitmap;e:for(;f<=g;f+=1){const e=f+p;for(let n=f;n<e;n+=1){const e=t[n];if(!e)continue;if(e.allFilled)continue e;const r=e.getIntervals(),a=r.length;if(a>0)if(a<40)for(let e=0;e<a;e+=2){const t=r[e];if(r[e+1]>d&&t<u)continue e}else{let e=0,t=a>>1;for(;e<t;){const n=e+t>>>1;r[1+(n<<1)]<=d?e=n+1:t=n}const n=e<<1;if(n<a&&r[n]<u)continue e}}break}if(f>g)return h.top=null,this.rectangles.set(e,h),this.maxHeightReached=!0,null}return h.top=f,this.addRectToBitmap(h),this.rectangles.set(e,h),this.pTotalHeight=Math.max(this.pTotalHeight||0,f+p),f*l}collides(e,t){const{bitmap:n}=this,r=t+e.h;for(let a=t;a<r;a+=1){const t=n[a];if(void 0!==t&&!t.isRangeClear(e.l,e.r))return!0}return!1}addRectToBitmap(e){if(null===e.top)return;const t=e.id,n=e.top+e.h,a=this.bitmap,i=this.hardRowLimit,o=this.pitchY;if(e.r-e.l>2e4)for(let s=e.top;s<n;s+=1){let e=a[s];if(!e){if(s>i)throw new Error(`layout hard limit (${i*o}px) exceeded, aborting layout`);e=new r,a[s]=e}e.setAllFilled(t)}else for(let s=e.top;s<n;s+=1){let n=a[s];if(!n){if(s>i)throw new Error(`layout hard limit (${i*o}px) exceeded, aborting layout`);n=new r,a[s]=n}n.addRect(e,t)}}discardRange(e,t){const n=Math.trunc(e/this.pitchX),r=Math.trunc(t/this.pitchX),{bitmap:a}=this;for(const e of a)e.discardRange(n,r)}hasSeen(e){return this.rectangles.has(e)}getByCoord(e,t){const n=Math.trunc(t/this.pitchY),r=this.bitmap[n];if(!r)return;const a=Math.trunc(e/this.pitchX);return r.getItemAt(a)}getByID(e){const t=this.rectangles.get(e);if(t){const e=t.top*this.pitchY;return[t.l*this.pitchX,e,t.r*this.pitchX,e+t.originalHeight]}}getDataByID(e){return this.rectangles.get(e)?.data}getSerializableDataByID(e){return this.rectangles.get(e)?.serializableData}cleanup(){}getTotalHeight(){return this.pTotalHeight*this.pitchY}get totalHeight(){return this.getTotalHeight()}getRectangles(){const e=this.pitchX,t=this.pitchY;return new Map([...this.rectangles.entries()].map(([n,r])=>{const{l:a,r:i,originalHeight:o,top:s,serializableData:l}=r,c=(s||0)*t;return[n,[a*e,c,i*e,c+o,l]]}))}serializeRegion(e){const t=this.pitchX,n=this.pitchY,r=e.start,a=e.end,i={};let o=!1;for(const[e,s]of this.rectangles.entries()){const{l,r:c,originalHeight:d,top:u}=s;if(null===u)o=!0;else{const o=u*n,p=o+d,h=l*t,g=c*t;a>=h-t&&g+t>=r&&(i[e]=[h,o,g,p,s.serializableData])}}return{rectangles:i,totalHeight:this.getTotalHeight(),maxHeightReached:o}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}},81709(e,t,n){n.d(t,{A:()=>r});class r{subLayouts=new Map;constructor(e,t={}){this.SubLayoutClass=e,this.subLayoutConstructorArgs=t}getDataByID(e){for(const t of this.subLayouts.values()){const n=t.getDataByID(e);if(n)return n}}getSublayout(e){let t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}addRect(e,t,n,r,a,i={},o){return this.getSublayout(e).addRect(t,n,r,a,i,o)}discardRange(e,t,n){return this.subLayouts.get(e)?.discardRange(t,n)}toJSON(){const e={};for(const[t,n]of this.subLayouts.entries())e[t]=n.toJSON();return e}}},8655(e,t,n){function r(e,t,n){const r=e.length;if(0===r)return!0;if(r<40){for(let a=0;a<r;a+=2)if(e[a+1]>t&&e[a]<n)return!1;return!0}let a=0,i=r>>1;for(;a<i;){const n=a+i>>>1;e[1+(n<<1)]<=t?a=n+1:i=n}const o=a<<1;return o>=r||e[o]>=n}n.d(t,{A:()=>a});class a{rows=[];rowMaxEnd=[];rectangles=new Map;lastLeft=-1/0;lastRow=0;maxHeightReached=!1;constructor(e={}){this.featureHeight=e.featureHeight??7,this.spacing=e.spacing??0,this.rowHeight=this.featureHeight+this.spacing,this.padding=e.padding??1,this.maxRows=e.maxHeight?Math.floor(e.maxHeight/this.rowHeight):1e5}addRect(e,t,n,r,a,i){const o=this.rectangles.get(e);if(o)return null===o.top?null:o.top*this.rowHeight;let s=0;t===this.lastLeft&&(s=this.lastRow+1);const l=n+this.padding,c=this.findFreeRow(t,l,s);if(null===c){const r={id:e,l:t,r:n,top:null,h:1,originalHeight:this.featureHeight,data:a,serializableData:i};return this.rectangles.set(e,r),this.maxHeightReached=!0,null}this.addToRow(c,t,l);const d={id:e,l:t,r:n,top:c,h:1,originalHeight:this.featureHeight,data:a,serializableData:i};return this.rectangles.set(e,d),this.lastLeft=t,this.lastRow=c,c*this.rowHeight}findFreeRow(e,t,n){const a=this.rows,i=this.rowMaxEnd;for(let o=n;o<this.maxRows;o++){const n=a[o];if(!n)return o;if(e>=i[o])return o;if(r(n,e,t))return o}return null}addToRow(e,t,n){let r=this.rows[e];r||(r=[],this.rows[e]=r,this.rowMaxEnd[e]=0);const a=r.length;if(0===a||t>=r[a-2])r.push(t,n);else{const e=function(e,t){const n=e.length;if(n<40){for(let r=0;r<n;r+=2)if(t<e[r])return r;return n}let r=0,a=n>>1;for(;r<a;){const n=r+a>>>1;e[n<<1]<t?r=n+1:a=n}return r<<1}(r,t);!function(e,t,n,r){const a=e.length;e.push(0,0);for(let n=a+1;n>t+1;n--)e[n]=e[n-2];e[t]=n,e[t+1]=r}(r,e,t,n)}n>this.rowMaxEnd[e]&&(this.rowMaxEnd[e]=n)}collides(e,t){return!1}addRectToBitmap(e){}getTotalHeight(){let e=0;for(let t=this.rows.length-1;t>=0;t--)if(this.rows[t]){e=t+1;break}return e*this.rowHeight}getRectangles(){const e=new Map,t=this.rowHeight,n=this.featureHeight;for(const[r,a]of this.rectangles)if(null!==a.top){const i=a.top*t;e.set(r,[a.l,i,a.r,i+n])}return e}discardRange(e,t){for(let n=0;n<this.rows.length;n++){const r=this.rows[n];if(!r)continue;const a=[];let i=0;for(let n=0;n<r.length;n+=2){const o=r[n],s=r[n+1];s<=e||o>=t?(a.push(o,s),s>i&&(i=s)):o<e&&s>e&&s<=t?(a.push(o,e),e>i&&(i=e)):o>=e&&o<t&&s>t?(a.push(t,s),s>i&&(i=s)):o<e&&s>t&&(a.push(o,e,t,s),s>i&&(i=s))}this.rows[n]=a,this.rowMaxEnd[n]=i}this.lastLeft=-1/0,this.lastRow=0}getDataByID(e){return this.rectangles.get(e)?.data}serializeRegion(e){const{start:t,end:n}=e,r={};for(const[e,a]of this.rectangles.entries()){if(null===a.top)continue;const{l:i,r:o,top:s}=a;if(n>=i&&o>=t){const t=s*this.rowHeight;r[e]=[i,t,o,t+this.featureHeight]}}return{rectangles:r,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}},58846(e,t,n){n.d(t,{A:()=>a});var r=n(61425);class a{indexData=[];constructor({rectangles:e,totalHeight:t,maxHeightReached:n}){this.rectangles=new Map(Object.entries(e)),this.totalHeight=t,this.maxHeightReached=n,this.buildIndex()}buildIndex(){if(0!==this.rectangles.size){this.index=new r.A(this.rectangles.size),this.indexData=[];for(const[e,t]of this.rectangles)this.index.add(t[0],t[1],t[2],t[3]),this.indexData.push({name:e,rect:t});this.index.finish()}}addRect(e){const t=this.rectangles.get(e);if(!t)throw new Error(`id ${e} not found in precomputed feature layout`);return t[1]}getRectangles(){return this.rectangles}getTotalHeight(){return this.totalHeight}collides(e,t){throw new Error("Method not implemented.")}getByCoord(e,t){if(!this.index)return;const n=this.index.search(e,t,e+1,t+1);return n.length>0?this.indexData[n[0]]?.name:void 0}getByID(e){return this.rectangles.get(e)}addRectToBitmap(e,t){throw new Error("Method not implemented.")}discardRange(e,t){throw new Error("Method not implemented.")}serializeRegion(e){throw new Error("Method not implemented.")}toJSON(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1}}}},93949(e,t,n){n.d(t,{f:()=>o,m:()=>i});const r=/^(-?\d+)(?:(?:\.\.|[-])(-?\d+))?(\.\.|[-])?$/,a=/^(?:\{([^}]+)\})?(.+)/;function i(e,t){if(!e)throw new Error("no location string provided, could not parse");let n=!1;e.endsWith("[rev]")&&(n=!0,e=e.slice(0,-5)),e=e.replaceAll(/\s/g,"");const i=a.exec(e);if(!i)throw new Error(`invalid location string: "${e}"`);const[,o,s]=i;if(!o&&s.startsWith("{}"))throw new Error(`no assembly name was provided in location "${s}"`);const l=s.lastIndexOf(":");if(-1===l){if(t(s,o))return{assemblyName:o,refName:s,reversed:n};throw new Error(`Unknown feature or sequence "${s}"`)}const c=s.slice(0,l),d=s.slice(l+1),u=t(c,o),p=t(s,o);if(u&&p)throw new Error(`ambiguous location string: "${e}"`);if(p)return{assemblyName:o,refName:s,reversed:n};if(u){if(!d)return{assemblyName:o,refName:c,reversed:n};const t=function(e,t){const n=r.exec(e.replaceAll(",",""));if(!n)throw new Error(`could not parse range "${e}" on location "${t}"`);const[,a,i,o]=n,s=+a;return{start:s,end:i?+i:o?void 0:s}}(d,e);return{assemblyName:o,refName:c,reversed:n,...t}}throw new Error(`unknown reference sequence name in location "${e}"`)}function o(e,t){const n=i(e,t);return"number"==typeof n.start&&(n.start-=1),n}},67665(e,t,n){n.d(t,{I:()=>s});var r=n(10533),a=n(44934),i=n(15146),o=n(29458);function s(e,t,n,s,l,c,d){let u;function p(t){(0,i.Kp)(t)||(0,r.isAlive)(e)&&(console.error(t),d(t))}(0,r.addDisposer)(e,(0,a.reaction)(()=>{try{return t(e)}catch(e){return void p(e)}},async(t,a)=>{if(u&&(0,o.CF)(u),(0,r.isAlive)(e)){u=(0,o.y5)(),l(u);try{const i=await n(t,u,e,a);(0,r.isAlive)(e)&&c(i)}catch(e){p(e)}}},s)),(0,r.addDisposer)(e,()=>{u&&(0,o.CF)(u)})}},322(e,t,n){n.r(t),n.d(t,{getDefaultValue:()=>s,getEnumerationValues:()=>l,getPropertyType:()=>o,getSubType:()=>a,getUnionSubTypes:()=>i,resolveLateType:()=>c});var r=n(10533);function a(e){let t;if((0,r.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,r.isArrayType)(e)&&!(0,r.isMapType)(e)){if("function"==typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function i(e){if(!(0,r.isUnionType)(e))throw new TypeError("not an MST union type");const t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function o(e,t){return e.properties[t]}function s(e){if(!(0,r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function l(e){return i(e).map(e=>e.value)}function c(e){return(0,r.isUnionType)(e)||(0,r.isArrayType)(e)||!(0,r.isLateType)(e)?e:e.getSubType()}},95783(e,t,n){n.d(t,{Ak:()=>r});const r=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"")},63110(e,t,n){n.d(t,{getSerializedSvg:()=>a});var r=n(70386);async function a(e){const{width:t,height:a,canvasRecordedData:i}=e,o=new((await n.e(3660).then(n.t.bind(n,33660,23))).default)(t,a);return new r.w(i).execute(o),o.getSvg().innerHTML}},39926(e,t,n){n.d(t,{Fw:()=>s,Nw:()=>c,T9:()=>d,XY:()=>o.X,pc:()=>o.p,pv:()=>l});var r=n(70386),a=n(75631),i=n.n(a),o=n(23638);function s(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function l(e,t){e.serializedCommands?new r.w(e.serializedCommands).execute(t):t.drawImage(e,0,0)}function c(e,t){if("function"==typeof OffscreenCanvas)return new OffscreenCanvas(e,t);if(i())return nodeCreateCanvas(e,t);{const n=new r.w;return{width:e,height:t,getContext:()=>n}}}async function d(e){if("function"==typeof OffscreenCanvas)return e.transferToImageBitmap();if(i()){const t=e.toDataURL(),n=new nodeImage;return new Promise((e,r)=>{n.onload=()=>{e(n)},n.onerror=r,n.src=t})}{const t=e.getContext("2d");return{height:e.height,width:e.width,serializedCommands:t.toJSON()}}}},27518(e,t,n){n.d(t,{Jy:()=>s.getSerializedSvg,MD:()=>c,aE:()=>l,u1:()=>o.u});var r=n(55614),a=n(30128),i=n(44460),o=n(40907),s=n(63110);function l(e){const t=(0,r.c)(3),{rendering:n}=e;let o;return t[0]!==n.html||t[1]!==n.reactElement?(o=(0,a.isValidElement)(n.reactElement)?n.reactElement:(0,i.jsx)("g",{dangerouslySetInnerHTML:{__html:n.html||""}}),t[0]=n.html,t[1]=n.reactElement,t[2]=o):o=t[2],o}async function c(e,t,r){if(e.canvasRecordedData&&!e.html){const{getSerializedSvg:a}=await Promise.resolve().then(n.bind(n,63110)),i=await a({width:t,height:r,canvasRecordedData:e.canvasRecordedData});return{...e,html:i}}return e}},49303(e,t,n){function r(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}function a(e,t,n,r){return t>n&&e<r}function i(e,t,n,r){return n<=e&&r>=t}n.d(t,{R6:()=>a,Xx:()=>i,ky:()=>r})},40907(e,t,n){n.d(t,{u:()=>o});var r=n(70386),a=n(78357),i=n(39926);async function o(e,t,n,o){const{exportSVG:s,highResolutionScaling:l=1}=n,c=Math.max(1,e),d=Math.max(1,t);if(s){if(s.rasterizeLayers){const n=s.scale||l,r=(0,i.Nw)(Math.ceil(c*n),Math.ceil(d*n)),u=r.getContext("2d");if(!u)throw new Error("2d canvas rendering not supported on this platform");return 1!==n&&u.scale(n,n),{...await o(u),html:`<image width="${e}" height="${t}" href="${"convertToBlob"in r?await(0,a.y)(await r.convertToBlob({type:"image/png"})):r.toDataURL("image/png")}" />`}}{const e=new r.w;return{...await o(e),canvasRecordedData:e.toJSON()}}}{const e=(0,i.Nw)(Math.ceil(c*l),Math.ceil(d*l)),t=e.getContext("2d");if(!t)throw new Error("2d canvas rendering not supported on this platform");return 1!==l&&t.scale(l,l),{...await o(t),imageData:await(0,i.T9)(e)}}}},7353(e,t,n){function r(e){return"object"==typeof e&&null!==e&&"__rpcResult"in e&&e.__rpcResult}n.d(t,{N:()=>r})},25529(e,t,n){n.r(t),n.d(t,{ObservableCreate:()=>a});var r=n(14562);function a(e,t){return new r.c(t=>{try{const n=e(t);n?.catch&&n.catch(e=>{t.error(e)})}catch(e){t.error(e)}})}},43102(e,t,n){function r(e){return"object"==typeof e&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id}function a(e){return"uniqueId"in e&&"object"!=typeof e.data}n.d(t,{A:()=>i,l:()=>r});class i{constructor(e){a(e)?this.data=e:(this.data=e.data,this.parentHandle=e.parent);const t=a(e)?e.uniqueId:e.id;if(null==t)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(t),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error(`invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`);this.data.subfeatures&&(this.subfeatures=this.data.subfeatures?.map((e,n)=>"function"!=typeof e.get?new i({id:e.uniqueId||`${t}-${n}`,data:{strand:this.data.strand,...e},parent:this}):e))}get(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}set(e,t){this.data[e]=t}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={...this.data,uniqueId:this.id()},t=this.parent();t&&(e.parentId=t.id());const n=this.children();return n&&(e.subfeatures=n.map(e=>e.toJSON())),e}static fromJSON(e){return new i({...e})}}},43921(e,t,n){n.d(t,{WD:()=>o,Yv:()=>l,qn:()=>s});var r=n(88068),a=n(45227);function i(e,t,n,r=!1){if(0===n)return 0;let a;return r?a=t/n-e*e/(n*n):(a=t-e*e/n,n>1&&(a/=n-1)),a<0?0:Math.sqrt(a)}function o(e){return{...e,scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:i(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered}}async function s(e,t){const{start:n,end:i}=e,s={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreMeanMin:Number.MAX_VALUE,scoreMeanMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0};let l=!1;const{scoreMin:c,scoreMax:d,scoreMeanMin:u,scoreMeanMax:p,scoreSum:h,scoreSumSquares:g,featureCount:f}=await(0,r._)(t.pipe((0,a.T)((e,t)=>{const n=t.get("score"),r=t.get("summary"),{scoreMax:a,scoreMin:i}=e;return e.scoreMax=Math.max(a,r?t.get("maxScore"):n),e.scoreMin=Math.min(i,r?t.get("minScore"):n),e.scoreMeanMin=Math.min(e.scoreMeanMin,n),e.scoreMeanMax=Math.max(e.scoreMeanMax,n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,l=!0,e},s)));return l?o({scoreMax:d,scoreMin:c,scoreMeanMin:u,scoreMeanMax:p,scoreSum:h,scoreSumSquares:g,featureCount:f,basesCovered:i-n+1}):{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}function l(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},29458(e,t,n){function r(e){return{time:Date.now(),iters:0,stopToken:e}}function a(){return URL.createObjectURL?.(new Blob)||`${Math.random()}`}function i(e){try{return"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}catch{return!1}}function o(e){void 0!==e&&(i(e)?Atomics.store(new Int32Array(e),0,1):URL.revokeObjectURL?.(e))}function s(e){if(void 0!==e)if(i(e)){if(1===Atomics.load(new Int32Array(e),0))throw new Error("aborted")}else if("undefined"==typeof jest&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){const t=new XMLHttpRequest;t.open("GET",e,!1);try{t.send(null)}catch{throw new Error("aborted")}}}function l(e){if(!e)return;const{stopToken:t,backoff:n=!0,checkInterval:r=50,checkIters:a=100}=e;if(e.iters++,void 0===t)return;if(e.iters%a!==0)return;i(t)&&s(t);const o=Date.now();o-e.time>r&&(e.time=o,s(t),n&&(e.checkInterval??=r,e.checkInterval+=r))}function c(e,t,n,r=400,a=100,i=!0){const o={time:Date.now(),iters:0,checkInterval:r,backoff:i,checkIters:a,stopToken:t};let s=0;for(const t of e)n(t,s++),l(o)}n.d(t,{SW:()=>s,As:()=>l,y5:()=>a,jL:()=>r,ib:()=>c,CF:()=>o})},19608(e,t,n){n.r(t),n.d(t,{UNKNOWN:()=>p,UNSUPPORTED:()=>h,clearFileFromCache:()=>k,clearPendingFileHandleIds:()=>N,ensureFileHandleReady:()=>A,findFileHandleIds:()=>P,generateUnknownTrackConf:()=>$,generateUnsupportedTrackConf:()=>_,getBlob:()=>f,getBlobMap:()=>m,getConfAssemblyNames:()=>c,getFileFromCache:()=>S,getFileHandleCache:()=>C,getFileName:()=>z,getParentRenderProps:()=>u,getPendingFileHandleIds:()=>F,getRpcSessionId:()=>d,getTrackAssemblyNames:()=>l,getTrackName:()=>O,guessAdapter:()=>j,guessTrackType:()=>H,hideTrackGeneric:()=>W,makeIndex:()=>V,makeIndexType:()=>E,restoreFileHandles:()=>I,restoreFileHandlesFromSnapshot:()=>L,restorePendingFileHandles:()=>B,setBlobMap:()=>y,setFileHandleCache:()=>T,setFileInCache:()=>x,setPendingFileHandleIds:()=>D,showTrackGeneric:()=>G,storeBlobLocation:()=>w,storeFileHandleLocation:()=>M,toggleTrackGeneric:()=>U});var r=n(10533),a=n(3787),i=n(23886),o=n(17378);const s=new WeakMap;function l(e){let t=s.get(e);return t||(t=c(e.configuration),s.set(e,t)),t}function c(e){const t=(0,o.QZ)(e,"assemblyNames");if(!t){const t=(0,r.getParent)(e);if("sequence"in t)return[(0,o.QZ)(t,"name")];throw new Error("unknown assembly names")}return t}function d(e){let t;for(let n=e;!(0,r.isRoot)(n);n=(0,r.getParent)(n))"rpcSessionId"in n&&(t=n.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function u(e){for(let t=(0,r.getParent)(e);!(0,r.isRoot)(t);t=(0,r.getParent)(t))if("renderProps"in t)return t.renderProps();return{}}const p="UNKNOWN",h="UNSUPPORTED";let g={};function f(e){return g[e]}function m(){return g}function y(e){g=e}let b=0;function w(e){if("blob"in e){const t=`b${Date.now()}-${b++}`;return g[t]=e.blob,{name:e.blob.name,blobId:t,locationType:"BlobLocation"}}return e}let v={};function S(e){return v[e]}function x(e,t){v[e]=t}function k(e){delete v[e]}function C(){return v}function T(e){v=e}async function A(e,t=!0){const n=v[e];if(n)return n;const r=await(0,a.D0)(e);if(!r)throw new Error(`File handle not found for handleId: ${e}. The file may have been opened in a different browser or the IndexedDB was cleared.`);if(!await(0,a.pZ)(r,t))throw new Error(`Permission denied for file "${r.name}". Click "Restore access" to grant permission.`);const i=await r.getFile();return v[e]=i,i}async function M(e){const t=await(0,a.gw)(e),n=await e.getFile();return v[t]=n,{locationType:"FileHandleLocation",name:e.name,handleId:t}}async function I(e,t=!1){const n=[];for(const r of e)try{await A(r,t),n.push({handleId:r,success:!0})}catch(e){n.push({handleId:r,success:!1,error:e})}return n}function P(e,t=new Set,n=new WeakSet){if(!e||"object"!=typeof e)return t;if(n.has(e))return t;if(n.add(e),Array.isArray(e))for(const r of e)P(r,t,n);else{const r=e;"FileHandleLocation"===r.locationType&&"string"==typeof r.handleId&&t.add(r.handleId);for(const e of Object.values(r))P(e,t,n)}return t}async function L(e,t=!1){const n=P(e);return n.size>0?I([...n],t):[]}let R=[];function F(){return R}function D(e){R=e}function N(){R=[]}async function B(){if(0===R.length)return[];const e=await I(R,!0),t=e.filter(e=>!e.success).map(e=>e.handleId);return R=t,e}function V(e,t){return"uri"in e?{uri:e.uri+t,locationType:"UriLocation"}:"localPath"in e?{localPath:e.localPath+t,locationType:"LocalPathLocation"}:e}function E(e,t,n){return e?.toUpperCase().endsWith(t)?t:n}function z(e){const t="uri"in e?e.uri:void 0,n="localPath"in e?e.localPath:void 0,r="blobId"in e?e:void 0,a="handleId"in e?e:void 0;if(r?.name)return r.name;if(a?.name)return a.name;if(t){const e=t.replace(/\\/g,"/");return e.slice(e.lastIndexOf("/")+1)}if(n){const e=n.replace(/\\/g,"/");return e.slice(e.lastIndexOf("/")+1)}return""}function j(e,t,n,r){if(r){const{pluginManager:a}=(0,i.getEnv)(r),o=a.evaluateExtensionPoint("Core-guessAdapterForLocation",(e,t,n)=>{})(e,t,n);if(o)return o}return{type:p}}function H(e,t){if(t){const n=(0,i.getSession)(t),r=(0,i.getEnv)(n).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",e=>{})(e);if(r)return r}return"FeatureTrack"}function _(e,t,n){const r={type:"FeatureTrack",name:`${e} (Unsupported)`,description:`Support not yet implemented for "${t}"`,category:n,trackId:""};return r.trackId=(0,i.objectHash)(r),r}function $(e,t,n){const r={type:"FeatureTrack",name:`${e} (Unknown)`,description:`Could not determine track type for "${t}"`,category:n,trackId:""};return r.trackId=(0,i.objectHash)(r),r}function O(e,t){const n=(0,r.isStateTreeNode)(e)?(0,o.QZ)(e,"name"):e.name??"",a=(0,r.isStateTreeNode)(e)?(0,o.QZ)(e,"type"):e.type;if(!n&&"ReferenceSequenceTrack"===a){const n=t.assemblies.find(t=>t.sequence===e);return n?`Reference sequence (${(0,o.QZ)(n,"displayName")||(0,o.QZ)(n,"name")})`:"Reference sequence"}return n}function G(e,t,n={},a={}){const{pluginManager:o}=(0,i.getEnv)(e),s=(0,i.getSession)(e),l=e.tracks.find(e=>e.configuration.trackId===t);if(l)return l;const c=s.getTracksById()[t];if(!c)throw new Error(`Could not resolve identifier "${t}"`);const d=(0,r.isStateTreeNode)(c)?(0,r.getSnapshot)(c):structuredClone(c),u=o.evaluateExtensionPoint("Core-preProcessTrackConfig",d),p=o.getTrackType(u.type);if(!p)throw new Error(`Unknown track type ${u.type}`);const h=o.getViewType(e.type),g=new Set(h.displayTypes.map(e=>e.name)),f=(u.displays??[]).find(e=>g.has(e.type)),m=a.type,y=f?.type??p.displayTypes.find(e=>g.has(e.name))?.name,b=m??y;if(!b)throw new Error(`Could not find a compatible display for view type ${e.type}`);const w=f?.displayId??`${t}-${b}`,{type:v,displayId:S,...x}=f??{},k=p.stateModel.create({...n,type:u.type,configuration:t,displays:[{type:b,configuration:w,...x,...a}]});return e.tracks.push(k),k}function W(e,t){const n=e.tracks.find(e=>e.configuration.trackId===t);return n?(e.tracks.remove(n),1):0}function U(e,t){W(e,t)||G(e,t)}},23638(e,t,n){function r(e){return 0===e.byteLength}function a(e){return null!==e&&"object"==typeof e&&"number"==typeof e.byteLength}function i(e){const t=[],{imageData:n,flatbush:i,subfeatureFlatbush:o}=e;return"undefined"!=typeof ImageBitmap&&n instanceof ImageBitmap&&t.push(n),a(i)&&(r(i)?console.warn("flatbush buffer is already detached, cannot transfer"):t.push(i)),a(o)&&(r(o)?console.warn("subfeatureFlatbush buffer is already detached, cannot transfer"):t.push(o)),t}n.d(t,{X:()=>i,p:()=>r})},64261(e,t,n){n.d(t,{cx:()=>a});var r=n(32285);function a(...e){return(0,r.p)(e)}},46625(e,t,n){n.d(t,{n:()=>h});var r=n(87377),a=n(30128),i=n(56612),o=n(55614),s=n(71277),l=n(56740),c=n(32285);const{createCssAndCx:d}={createCssAndCx:function(e){const{cache:t}=e,n=(...e)=>{const n=(0,s.J)(e,t.registered);(0,l.sk)(t,n,!1);const r=`${t.key}-${n.name}`;{const n=e[0];(function(e){return e instanceof Object&&!("styles"in e)&&!("length"in e)&&!("__emotion_styles"in e)})(n)&&u.saveClassNameCSSObjectMapping(t,r,n)}return r};return{css:n,cx:(...e)=>{const r=(0,c.p)(e),a=u.fixClassName(t,r,n);return function(e,t,n){const r=[],a=(0,l.Rk)(e,r,n);return r.length<2?n:a+t(r)}(t.registered,n,a)}}}},u=(()=>{const e=new WeakMap;return{saveClassNameCSSObjectMapping:(t,n,r)=>{let a=e.get(t);void 0===a&&(a=new Map,e.set(t,a)),a.set(n,r)},fixClassName:(t,n,r)=>{if(!n.includes(" "))return n;const a=e.get(t);return(0,c.p)(function(e){let t=!1;return e.map(([e,n])=>{if(void 0===n)return e;let r;if(t)r={"&&":n};else{r=e;for(const e in n)if(e.startsWith("@media")){t=!0;break}}return r})}(n.split(" ").map(e=>[e,a?.get(e)])).map(e=>"string"==typeof e?e:r(e)))}}})(),p=i._,{makeStyles:h}=function(e){const{useTheme:t}=e,{useCssAndCx:n}=function(e){const{useCache:t}=e;return{useCssAndCx:function(){const e=(0,o.c)(5),n=t();let r;e[0]!==n?(r=d({cache:n}),e[0]=n,e[1]=r):r=e[1];const{css:a,cx:i}=r;let s;return e[2]!==a||e[3]!==i?(s={css:a,cx:i},e[2]=a,e[3]=i,e[4]=s):s=e[4],s}}}({useCache:p});return{makeStyles:function(){return function(e){const r="function"==typeof e?e:()=>e;return function(e,i){const o=t(),{css:s,cx:l}=n(),c=(0,a.useMemo)(()=>{const e=r(o),t={};for(const n of Object.keys(e)){const r=e[n];t[n]=s(r)}return t},[s,o]),d=i?.props.classes,u=function(e){if(!(e instanceof Object)||"function"==typeof e)return e;const t=[];for(const n in e){const r=e[n],a=typeof r;if("string"!==a&&("number"!==a||isNaN(r))&&"boolean"!==a&&null!=r)return e;t.push(`${n}:${a}_${r}`)}return`xSqLiJdLMd9s${t.join("|")}`}(d),p=(0,a.useMemo)(()=>d?function(e,t,n){if(!(t instanceof Object))return e;const r=Object.keys(t);if(0===r.length)return e;const a={};for(const r of Object.keys(e))a[r]=n(e[r],t[r]);for(const n of r){if(n in e)continue;const r=t[n];"string"==typeof r&&(a[n]=r)}return a}(c,d,l):c,[c,u,l]);return{classes:p,theme:o,css:s,cx:l}}}}}}({useTheme:r.A})},32285(e,t,n){n.d(t,{p:()=>r});const r=e=>{const t=e.length;let n=0,a="";for(;n<t;n++){const t=e[n];if(null==t)continue;let i;switch(typeof t){case"boolean":break;case"object":if(Array.isArray(t))i=r(t);else{const e=t;i="";for(const t in e)e[t]&&t&&(i&&(i+=" "),i+=t)}break;default:i=t}i&&(a&&(a+=" "),a+=i)}return a}},38817(e,t,n){n.d(t,{K:()=>o,w:()=>i});var r=n(10533),a=n(95783);function i(){return(0,a.Ak)(10)}const o=r.types.optional(r.types.identifier,i)},16640(e,t,n){n.d(t,{BY:()=>u,C1:()=>x,DW:()=>i,EO:()=>b,EV:()=>k,J_:()=>M,Nh:()=>S,QW:()=>l,Qm:()=>T,Tl:()=>f,Uy:()=>y,Y$:()=>o,ZL:()=>I,_u:()=>A,bV:()=>w,gx:()=>p,lL:()=>v,lO:()=>d,mY:()=>g,rF:()=>C,rz:()=>a.A,u3:()=>s,xU:()=>m,xv:()=>c,yH:()=>P,zA:()=>h});var r=n(10533),a=n(75335);function i(e){return(0,r.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function o(e){return"object"==typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function s(e){return o(e)&&"editConfiguration"in e}function l(e){return o(e)&&"addTrackConf"in e&&!e.disableAddTracks}function c(e){return o(e)&&"shareURL"in e&&!!e.shareURL}function d(e){return o(e)&&"widgets"in e}function u(e){return o(e)&&"makeConnection"in e}function p(e){return o(e)&&"addConnectionConf"in e}function h(e){return o(e)&&"sessionPlugins"in e}function g(e){return"object"==typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function f(e){return"object"==typeof e&&null!==e&&"width"in e&&"setWidth"in e}function m(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function y(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function b(e){return"object"==typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function w(e){return"object"==typeof e&&null!==e&&"findAppropriateInternetAccount"in e}function v(e){return"object"==typeof e&&null!==e&&"internetAccounts"in e&&"findAppropriateInternetAccount"in e}function S(e){return"object"==typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}function x(e){return"object"==typeof e&&null!==e&&"uri"in e&&!!e.uri}function k(e){return"object"==typeof e&&null!==e&&"localPath"in e&&!!e.localPath}function C(e){return"object"==typeof e&&null!==e&&"blobId"in e&&!!e.blobId}function T(e){return"object"==typeof e&&null!==e&&"handleId"in e&&!!e.handleId}class A extends Error{constructor(e,t){super(e),this.message=e,this.url=t,this.name="AuthNeededError",Object.setPrototypeOf(this,A.prototype)}}class M extends Error{constructor(e,t){super(e),this.message=e,this.internetAccountId=t,this.name="RetryError"}}function I(e){return e instanceof Error&&("AuthNeededError"===e.name||void 0!==e.url)}function P(e){return"RetryError"===e.name||void 0!==e.internetAccountId}},7220(e,t,n){n.r(t),n.d(t,{BlobLocation:()=>l,ElementId:()=>a.K,FileHandleLocation:()=>c,FileLocation:()=>p,LocalPathLocation:()=>s,NoAssemblyRegion:()=>i,Region:()=>o,UriLocation:()=>u,UriLocationRaw:()=>d,createElementId:()=>a.w});var r=n(10533),a=n(38817);const i=r.types.model("NoAssemblyRegion",{refName:r.types.string,start:r.types.number,end:r.types.number,reversed:r.types.optional(r.types.boolean,!1)}).actions(e=>({setRefName(t){e.refName=t}})),o=r.types.compose("Region",i,r.types.model({assemblyName:r.types.string})),s=r.types.model("LocalPathLocation",{locationType:r.types.literal("LocalPathLocation"),localPath:r.types.string}),l=r.types.model("BlobLocation",{locationType:r.types.literal("BlobLocation"),name:r.types.string,blobId:r.types.string}),c=r.types.model("FileHandleLocation",{locationType:r.types.literal("FileHandleLocation"),name:r.types.string,handleId:r.types.string}),d=r.types.model("UriLocation",{locationType:r.types.literal("UriLocation"),uri:r.types.string,baseUri:r.types.maybe(r.types.string),internetAccountId:r.types.maybe(r.types.string),internetAccountPreAuthorization:r.types.maybe(r.types.model("InternetAccountPreAuthorization",{internetAccountType:r.types.string,authInfo:r.types.frozen()}))}),u=r.types.snapshotProcessor(d,{postProcessor:e=>{const{baseUri:t,...n}=e;return t?e:n}}),p=r.types.snapshotProcessor(r.types.union(s,u,l,c),{preProcessor(e){if(!e)return;const{locationType:t,...n}=e;if(!t){const{uri:e,localPath:t,blob:r,handleId:a}=n;let i="";return void 0!==e?i="UriLocation":void 0!==t?i="LocalPathLocation":void 0!==r?i="BlobLocation":void 0!==a&&(i="FileHandleLocation"),{...n,locationType:i}}return e}})},87529(e,t,n){n.d(t,{A:()=>i});var r=n(55614),a=n(30128);function i(){const e=(0,r.c)(5),t=(0,a.useRef)(null);let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={width:void 0,height:void 0},e[0]=n):n=e[0];const[i,o]=(0,a.useState)(n);let s,l,c;return e[1]===Symbol.for("react.memo_cache_sentinel")?(s=()=>{if(!t.current)return;const e="undefined"!=typeof window&&"ResizeObserver"in window?window.ResizeObserver:void 0;if(!e)return;const n=new e(e=>{o({width:e[0].contentRect.width,height:e[0].contentRect.height})});return n.observe(t.current),()=>{n.disconnect()}},l=[],e[1]=s,e[2]=l):(s=e[1],l=e[2]),(0,a.useEffect)(s,l),e[3]!==i?(c=[t,i],e[3]=i,e[4]=c):c=e[4],c}},19236(e,t,n){n.d(t,{z:()=>r.when});var r=n(44934)},153(e,t,n){n.d(t,{Cu:()=>g,NI:()=>p,R3:()=>d,PC:()=>c,Gl:()=>u,DQ:()=>l,bH:()=>h,eL:()=>i,YJ:()=>s});const r=new RegExp(/(\d+)[SH]$/),a=new RegExp(/^(\d+)([SH])/);function i(e=""){let t="";const n=[];for(let r=0,a=e.length;r<a;r++){const a=e[r];a>="0"&&a<="9"?t+=a:(n.push(t,a),t="")}return n}const o={77:0,73:1,68:2,78:3,83:4,72:5,80:6,61:7,88:8};function s(e=""){let t=0;const n=[];for(let r=0,a=e.length;r<a;r++){const a=e.charCodeAt(r);if(a>=48&&a<=57)t=10*t+(a-48);else{const e=o[a];n.push(t<<4|e),t=0}}return new Uint32Array(n)}function l(e,t,n,r,a){let o=[];const s=i(e);return e&&(o=o.concat(function(e,t,n,r){let a=0,i=0;const o=[],s=n&&t;for(let l=0;l<e.length;l+=2){const c=+e[l],d=e[l+1];if("M"===d||"="===d||"E"===d){if(s)for(let e=0;e<c;e++)(32|t.charCodeAt(i+e))!=(32|n.charCodeAt(a+e))&&o.push({start:a+e,type:"mismatch",base:t[i+e],altbase:n[a+e],length:1});i+=c}if("I"===d)o.push({start:a,type:"insertion",insertlen:c,insertedBases:t?.slice(i,i+c),length:0}),i+=c;else if("D"===d)o.push({start:a,type:"deletion",length:c});else if("N"===d)o.push({start:a,type:"skip",length:c});else if("X"===d){const e=t?.slice(i,i+c)||[],n=r?.subarray(i,i+c)||[];for(let t=0;t<c;t++)o.push({start:a+t,type:"mismatch",base:e[t]||"X",qual:n[t],length:1});i+=c}else"H"===d?o.push({start:a,type:"hardclip",cliplen:c,length:1}):"S"===d&&(o.push({start:a,type:"softclip",cliplen:c,length:1}),i+=c);"I"!==d&&"S"!==d&&"H"!==d&&(a+=c)}return o}(s,n,r,a))),t&&n&&(o=o.concat(function(e,t,n,r,a){const i=[],o=t.length,s=r.length,l=void 0!==a,c=n.length;let d=!1;for(let e=0;e<c;e++)if("skip"===n[e].type){d=!0;break}let u=0,p=0,h=0,g=0,f=0,m=0;const y=e.length;for(;m<y;){const b=e.charCodeAt(m);if(b>=48&&b<=57){let t=0;for(;m<y;){const n=e.charCodeAt(m);if(!(n>=48&&n<=57))break;t=10*t+(n-48),m++}u+=t}else if(94===b){m++;let t=0;for(;m<y;){const n=e.charCodeAt(m);if(!(n>=65&&n<=90))break;t++,m++}u+=t}else if(b>=65&&b<=90){const y=e[m];if(m++,d)for(;f<c;){const e=n[f];if("skip"===e.type&&u>=e.start)u+=e.length,f++;else{if("skip"===e.type)break;f++}}let b=h,w=g;for(let e=p;e<o&&w<=u;e+=2,p=e){const n=+t[e],r=t[e+1];"S"===r||"I"===r?b+=n:"D"===r||"P"===r||"N"===r?w+=n:"H"!==r&&(b+=n,w+=n)}h=b,g=w;const v=b-(w-u),S=v<s?r[v]:"X";i.push({start:u,base:S,qual:l?a[v]:void 0,altbase:y,length:1,type:"mismatch"}),u++}else m++}return i}(t,s,o,n,a))),o}function c(e){const t=i(e);let n=0;for(let e=0;e<t.length;e+=2){const r=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"I"!==a&&(n+=r)}return n}function d(e){const t=i(e);let n=0;for(let e=0;e<t.length;e+=2){const r=+t[e],a=t[e+1];"D"!==a&&"N"!==a&&(n+=r)}return n}function u(e){const t=i(e);let n=0;for(let e=0;e<t.length;e+=2){const r=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"D"!==a&&"N"!==a&&(n+=r)}return n}function p(e,t){return-1===t?+(r.exec(e)||[])[1]||0:+(a.exec(e)||[])[1]||0}function h(e,t){return e.get("tags")[t]}function g(e,t,n,r,a){return e?.split(";").filter(e=>!!e).map((e,i)=>{const o=e.split(","),s=o[0],l=o[1],h=o[2],g=o[3],f=c(g),m=d(g),y=u(g),b="-"===h?-1:1,w=p(g,(a?n:1)*b),v=+l-1;return{refName:s,start:v,end:v+f,seqLength:m,clipLengthAtStartOfRead:w,CIGAR:g,strand:(a?n:1)*b,uniqueId:`${t}_SA${i}`,mate:{start:w,end:w+y,refName:r}}})||[]}},2165(e,t,n){n.d(t,{k:()=>r});const r=new RegExp(/([A-Z])([-+])([a-z]+|[0-9]+)([.?]?)/)},64833(e,t,n){n.d(t,{VY:()=>o,og:()=>i});var r=n(84405);function a(e,t){return(0,r.A)().base(2).domain([1,Math.max(2,e)]).range([0,t-20]).clamp(!0)}function i(e,t){const n=a(e,t);return{ticks:n.ticks(6).map(e=>({value:e,y:n(e)})),height:t,maxDistance:e}}function o(e,t){const n=new Map;let r=Number.MIN_VALUE;for(const{distance:t}of e)t>0&&(r=Math.max(r,t));r===Number.MIN_VALUE&&(r=1e3);const i=a(r,t);for(const{id:t,distance:r}of e){const e=r>0?i(r):0;n.set(t,e)}return{chainYOffsets:n,cloudMaxDistance:r}}},32272(e,t,n){n.d(t,{DW:()=>u,J8:()=>a,L9:()=>c,PJ:()=>g,Pq:()=>h,en:()=>l,pf:()=>i,sY:()=>p,w7:()=>o});var r=n(52301);const a={PROPER_PAIR:0,LONG_INSERT:1,SHORT_INSERT:2,INTER_CHROM:3,ABNORMAL_ORIENTATION:4,UNMAPPED_MATE:5},i={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"lightgrey",color_pair_rr:"#3a3a9d",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unmapped_mate:"#8B4513",color_unknown:"grey",color_longread_rev_fwd:"navy",color_longread_fwd_rev:"green",color_longread_same:"grey",color_supplementary:"#f0b878"},o={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00002A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unmapped_mate:"#5D2E0D",color_unknown:"#444",color_longread_rev_fwd:"#00004D",color_longread_fwd_rev:"#005A00",color_longread_same:"#444",color_supplementary:"#c88030"},s=[i.color_pair_lr,o.color_pair_lr];function l({type:e,f:t,stats:n}){if(void 0!==t.flags&&8&t.flags)return a.UNMAPPED_MATE;if("insertSizeAndOrientation"===e||"orientation"===e){const e=r.il.fr[t.pair_orientation||""];if(e&&"LR"!==e)return a.ABNORMAL_ORIENTATION}if("insertSizeAndOrientation"===e||"insertSize"===e){const e=t.refName===t.next_ref,r=Math.abs(t.tlen||0);if(!e)return a.INTER_CHROM;if(n){if(r>n.upper)return a.LONG_INSERT;if(r<n.lower)return a.SHORT_INSERT}}return a.PROPER_PAIR}function c(e,t){switch(l({type:"insertSize",f:e,stats:t})){case a.UNMAPPED_MATE:return[i.color_unmapped_mate,o.color_unmapped_mate];case a.LONG_INSERT:return[i.color_longinsert,o.color_longinsert];case a.SHORT_INSERT:return[i.color_shortinsert,o.color_shortinsert];case a.INTER_CHROM:return[i.color_interchrom,o.color_interchrom];case a.PROPER_PAIR:default:return}}function d(e){if(void 0!==e.flags&&8&e.flags)return[i.color_unmapped_mate,o.color_unmapped_mate];const t=r.il.fr[e.pair_orientation||""];if(!t||"LR"===t)return;const n=r.rr[t];return[i[n],o[n]]}function u(e){return d(e)||s}function p(e,t){return d(e)||c(e,t)||s}function h(e,t){const n=Math.abs(e.tlen||0);return t&&n>t.upper?[i.color_fwd_missing_mate,o.color_fwd_missing_mate]:s}function g({type:e,v0:t,stats:n}){const r={refName:t.get("refName"),next_ref:t.get("next_ref"),pair_orientation:t.get("pair_orientation"),tlen:t.get("template_length"),flags:t.get("flags")};return"insertSizeAndOrientation"===e?p(r,n):"orientation"===e?u(r):"insertSize"===e?c(r,n):void 0}},63692(e,t,n){n.d(t,{D:()=>o,Q6:()=>d,YX:()=>i,bU:()=>l,eC:()=>s,i2:()=>u,iz:()=>p,jm:()=>a,oq:()=>r,xi:()=>c});const r=0,a=1,i=2,o=3,s=4,l=5,c=50,d=12,u=["mismatch","insertion","deletion","skip","softclip","hardclip"],p={mismatch:0,insertion:1,deletion:2,skip:3,softclip:4,hardclip:5}},22315(e,t,n){n.d(t,{D:()=>o});var r=n(23886),a=n(19608),i=n(10533);async function o({model:e,adapterConfig:t,blocks:n,opts:o}){const{rpcManager:s}=(0,r.getSession)(e),l=(0,a.getRpcSessionId)(e);return await s.call(l,"PileupGetVisibleModifications",{adapterConfig:t,sessionId:l,regions:n.contentBlocks,rpcDriverName:e.effectiveRpcDriverName,statusCallback:t=>{(0,i.isAlive)(e)&&e.setStatusMessage(t)},...o})}},11231(e,t,n){n.d(t,{R:()=>r,y:()=>a});const r={m:{color:"rgb(255,0,0)",name:"5mC"},h:{color:"rgb(255,0,255)",name:"5hmC"},o:{color:"rgb(111, 78, 129)",name:"8oxoG"},f:{color:"rgb(246, 200, 95)",name:"5fC"},c:{color:"rgb(157, 216, 102)",name:"5cac"},g:{color:"rgb(255, 160, 86)",name:"5hmu"},e:{color:"rgb(141, 221, 208)",name:"5fU"},b:{color:"rgb(0,100,47)",name:"5caU"},a:{color:"rgb(51,0,111)",name:"6mA"},17082:{color:"rgb(51,153,255)",name:"pseU"},17596:{color:"rgb(102,153,0)",name:"inosine"},21839:{color:"rgb(153,0,153)",name:"4mC"}};function a(e){return r[e]?.name||e}},2381(e,t,n){n.d(t,{KS:()=>i,Xx:()=>r,ap:()=>o,fs:()=>s,q3:()=>a});const r=1,a=8,i=32,o=256,s=2048},89579(e,t,n){n.d(t,{$Q:()=>d,Ar:()=>p,B$:()=>S,CQ:()=>u,Fz:()=>y,Hh:()=>k,JD:()=>c,Kl:()=>f,Kt:()=>h,LI:()=>w,P9:()=>x,SP:()=>m,Sr:()=>C,_7:()=>v,cY:()=>b,ce:()=>A,dv:()=>s,hn:()=>M,lE:()=>g,yr:()=>l});var r=n(23886),a=n(53121),i=n(63692),o=n(2381);function s(e){for(const t of e.chains.values())if(t[0].get("flags")&o.Xx)return!0;return!1}function l(e,t){return 1!==t?(0,a.M)(e).alpha(Math.min(1,t*t+.1)).toHslString():e}const c={flagInclude:0,flagExclude:1540};function d(e){return!e||0===e.flagInclude&&1540===e.flagExclude&&!e.readName&&!e.tagFilter}const u={flagInclude:16,flagExclude:1540},p={flagInclude:0,flagExclude:1556};function h(e,t){const n=Object.getOwnPropertyDescriptor(e.prototype,t).get;Object.defineProperty(e.prototype,t,{get(){const e=n.call(this);return Object.defineProperty(this,t,{value:e}),e}})}function g(e,t,n){return(e&t)!==t||!!(e&n)}function f(e,t){return"*"===t?void 0===e:`${e}`!=`${t}`}function m(e,t){return e<50&&t>=3}const y=5;function b(e){const t=[],n={},r=[];let a=0,i=0;for(const o of e){const e=o;if("SQ"===e.tag){const r=e.data;for(const e of r){const r=e;if("SN"===r.tag){const e=r.value;n[e]=a,t[a]=e;break}}a++}else if("RG"===e.tag){const t=e.data;for(const e of t){const t=e;if("ID"===t.tag){r[i]=t.value;break}}i++}}return{idToName:t,nameToId:n,readGroups:r}}function w(e){const{skip:t,deletion:n,insertion:r,hardclip:a,softclip:i,bases:o}=e.palette;return{A:o.A.main,C:o.C.main,G:o.G.main,T:o.T.main,deletion:n,insertion:r,hardclip:a,softclip:i,skip:t}}function v(e){return Object.fromEntries(Object.entries(w(e)).map(([t,n])=>[t,e.palette.getContrastText(n)]))}function S(e){return["methylation","modifications"].includes(e||"")}function x(){return!0}function k(e){e.font="bold 10px Courier New,monospace"}function C(){return{charWidth:(0,r.measureText)("A"),charHeight:(0,r.measureText)("M")-2}}function T(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function A(e){const t={};for(const[n,r]of Object.entries(e))t[n]=T(r)?[...r]:r;return t}function M(e,t){const n=new Map;return"forEachMismatch"in e&&e.forEachMismatch((e,r,a,o)=>{e===i.oq&&n.set(t+r,o)}),n}new Map,new Map},52301(e,t,n){n.d(t,{Iw:()=>u,c$:()=>l,il:()=>c,rT:()=>h,rr:()=>d,vi:()=>p});var r=n(10533),a=n(44934),i=n(88068),o=n(90013),s=n(11231);function l(e,t,n){const r=e.get("tags");return r[t]??r[n]}const c={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}},d={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"};async function u(e,t){const{start:n,end:r,originalRefName:a,refName:s}=e,l=await(0,i._)(t.getFeatures({...e,refName:a||s,end:r,start:n}).pipe((0,o.$)()));return l[0]?.get("seq")}function p(e,t,n){(0,r.addDisposer)(e,(0,a.autorun)(async function(){try{await t()}catch(t){(0,r.isAlive)(e)&&e.setError?.(t)}},n))}function h(e){return s.R[e]?.color||function(e){let t=0;for(let n=0;n<e.length;n++)t+=e.charCodeAt(n);return`hsl(${10*t}, 20%, 50%)`}(e)}},66878(e,t,n){n.d(t,{E6:()=>h,Ec:()=>p,JV:()=>m,Tp:()=>u,_u:()=>f,eW:()=>d,y$:()=>g});var r=n(55614),a=n(30128),i=n(17378),o=n(23886),s=n(19608);const[,l,,c]=[0,1,2,3];function d(e,t,n,r){return r?r(t,n):e[n].trackRefs[t]?.getBoundingClientRect().top||0}function u(e,t,n){return(e.bpToPx({refName:t,coord:n})?.offsetPx||0)-e.offsetPx}function p(e,t,n,r,a,i){const s=r[t].displays[0],u=s.height,p=s.SNPCoverageDisplay?.height??0,h=i?0:s.scrollTop;return(0,o.clamp)(a[l]-h+((g=a)[c]-g[l])/2+p,p,u)+d(n,e,t,i);var g}const h=e=>{const t=(0,r.c)(5),[,n]=(0,a.useState)();let i,o;t[0]!==n||t[1]!==e?(i=()=>{n(e)},t[0]=n,t[1]=e,t[2]=i):i=t[2],t[3]!==e?(o=[e],t[3]=e,t[4]=o):o=t[4],(0,a.useEffect)(i,o)};function g(e,t=[],n=[],...r){const a=new Set(n.map(t=>e(t))),i=t.filter(t=>a.has(e(t)));return 0===r.length?i:g(e,i,...r)}function f(e,t){return e.displays[0].searchFeatureByID?.(t.id())}async function m(e,t){const{views:n}=e,{rpcManager:r}=(0,o.getSession)(e),a=(0,s.getRpcSessionId)(t);return Promise.all(n.flatMap(async e=>await r.call(a,"BreakpointGetFeatures",{adapterConfig:(0,i.FI)(t,["adapter"]),sessionId:a,regions:e.staticBlocks.contentBlocks})))}},9090(e,t,n){n.d(t,{S:()=>x,A:()=>k});var r=n(30128),a=n(36082),i=n(60459),o=n(52188),s=n(10533),l=n(69566),c=n(44460);const d=(0,l.observer)(function({model:e}){const t=e?.target;if(t){if(t.type)return`${t.type} settings`;if((0,s.isStateTreeNode)(t)){const e=(0,s.getType)(t);if(e.name)return`${e.name.replace("ConfigurationSchema","")} settings`}}return(0,c.jsx)(c.Fragment,{children:"Settings"})});var u=n(23886),p=n(38817),h=n(44934);const g=(0,i.S7)("ConfigurationEditorWidget",{}),f=(0,r.lazy)(()=>Promise.all([n.e(8705),n.e(2729),n.e(7689),n.e(9292)]).then(n.bind(n,79292)));var m=n(61941);const y=(0,i.S7)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),b=(0,i.S7)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),w=(0,i.S7)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),v=(0,i.S7)("NcbiSequenceReportAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/sequence_report.tsv",locationType:"UriLocation"}},useNameOverride:{type:"boolean",defaultValue:!0,description:"forces usage of the UCSC names over the NCBI style names from a FASTA"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,location:{uri:e.uri,baseUri:e.baseUri}}:e}),S=(0,i.S7)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0},refNameColumnHeaderName:{type:"string",description:"alternative to refNameColumn, instead looks at header (starts with # and finds column name)",defaultValue:""}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,location:{uri:e.uri,baseUri:e.baseUri}}:e}),x=(0,r.lazy)(()=>Promise.all([n.e(8705),n.e(2729),n.e(7689),n.e(9292)]).then(n.bind(n,79292)));class k extends a.A{name="ConfigurationPlugin";install(e){!function(e){e.addAdapterType(()=>new m.A({name:"FromConfigAdapter",configSchema:y,getAdapterClass:()=>n.e(7190).then(n.bind(n,57190)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addAdapterType(()=>new m.A({name:"FromConfigRegionsAdapter",configSchema:b,getAdapterClass:()=>n.e(7432).then(n.bind(n,37432)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addAdapterType(()=>new m.A({name:"FromConfigSequenceAdapter",configSchema:w,getAdapterClass:()=>n.e(5346).then(n.bind(n,85346)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addAdapterType(()=>new m.A({name:"RefNameAliasAdapter",configSchema:S,getAdapterClass:()=>n.e(8329).then(n.bind(n,70710)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addWidgetType(()=>new o.A({name:"ConfigurationEditorWidget",HeadingComponent:d,configSchema:g,stateModel:s.types.model("ConfigurationEditorWidget",{id:p.K,type:s.types.literal("ConfigurationEditorWidget")}).volatile(()=>({target:void 0})).actions(e=>({setTarget(t){e.target=t},afterCreate(){let t;(0,s.addDisposer)(e,(0,h.autorun)(()=>{if(e.target){const n=(0,s.getSnapshot)(e.target);clearTimeout(t),t=setTimeout(()=>{(0,u.getSession)(e).jbrowse.updateTrackConf(n)},400)}}))}})),ReactComponent:f}))}(e),function(e){e.addAdapterType(()=>new m.A({name:"NcbiSequenceReportAliasAdapter",configSchema:v,getAdapterClass:()=>n.e(8416).then(n.bind(n,48416)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e)}}},27976(e,t,n){n.d(t,{A:()=>d});var r=n(30128),a=n(60459),i=n(52188),o=n(38817),s=n(10533);const l=s.types.model("AddConnectionModel",{id:o.K,type:s.types.literal("AddConnectionWidget")}),c=(0,a.S7)("AddConnectionWidget",{});function d(e){e.addWidgetType(()=>new i.A({name:"AddConnectionWidget",heading:"Add a connection",configSchema:c,stateModel:l,ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(5791),n.e(3030)]).then(n.bind(n,33030)))}))}},92155(e,t,n){n.d(t,{A:()=>b});var r=n(30128),a=n(60459),i=n(52188),o=n(16640),s=n(23886),l=n(19608),c=n(38817),d=n(10533),u=n(17361),p=n.n(u);function h(e){return(0,o.C1)(e)?e.uri:void 0}function g(e=""){try{return new URL(e),!1}catch{return!e.startsWith("/")}}const f={trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0,mixinData:{}};function m(e){return d.types.model("AddTrackModel",{id:c.K,type:d.types.literal("AddTrackWidget"),view:d.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile(()=>({...f})).actions(e=>({setMixinData(t){e.mixinData=t},setAdapterHint(t){e.adapterHint=t},setTextIndexingConf(t){e.textIndexingConf=t},setTextIndexTrack(t){e.textIndexTrack=t},setTrackData(t){e.trackData=t,e.adapterHint=""},setIndexTrackData(t){e.indexTrackData=t,e.adapterHint=""},setAssembly(t){e.altAssemblyName=t},setTrackName(t){e.altTrackName=t},setTrackType(t){e.altTrackType=t},clearData(){e.altTrackName=f.altTrackName,e.altTrackType=f.altTrackType,e.altAssemblyName=f.altAssemblyName,e.adapterHint=f.adapterHint,e.indexTrackData=f.indexTrackData,e.trackData=f.trackData,e.textIndexingConf=f.textIndexingConf,e.textIndexTrack=f.textIndexTrack,e.mixinData={}}})).views(e=>({get trackAdapter(){const{trackData:t,indexTrackData:n,adapterHint:r}=e;return t?(0,l.guessAdapter)(t,n,r,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,l.getFileName)(e.trackData):"")},get isFtp(){const t=h(e.trackData),n=h(e.indexTrackData);return!(!n?.startsWith("ftp://")&&!t?.startsWith("ftp://"))},get isRelativeTrackUrl(){const t=h(e.trackData);return!!t&&g(t)},get isRelativeIndexUrl(){const t=h(e.indexTrackData);return!!t&&g(t)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){return h(e.trackData)?.startsWith("http://")},get indexHttp(){return h(e.indexTrackData)?.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){return this.trackAdapter?.type===l.UNSUPPORTED},get adapterHintNotConfigurable(){const{adapterHint:t}=e,n=this.trackAdapter?.type;return!(!t||n&&"UNKNOWN"!==n&&n===t)},get assembly(){return e.altAssemblyName||e.view?.assemblyNames?.[0]},get trackAdapterType(){return this.trackAdapter?.type},get trackType(){return e.altTrackType||(this.trackAdapterType?(0,l.guessTrackType)(this.trackAdapterType,e):"")}})).views(e=>({getTrackConfig(t){const n=(0,s.getSession)(e);return n.assemblyManager.get(e.assembly)&&e.trackAdapter&&"UNKNOWN"!==e.trackAdapter.type?p()({trackId:[`${e.trackName.toLowerCase().replaceAll(" ","_")}-${t}`,n.adminMode?"":"-sessionTrack"].join(""),type:e.trackType,name:e.trackName,assemblyNames:[e.assembly],adapter:e.trackAdapter},e.mixinData):void 0},get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}}))}const y=(0,a.S7)("AddTrackWidget",{});function b(e){e.addWidgetType(()=>new i.A({name:"AddTrackWidget",heading:"Add a track",configSchema:y,stateModel:m(e),ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(5791),n.e(2859),n.e(8869)]).then(n.bind(n,98869)))}))}},89919(e,t,n){function r(e,t){return`${(e.startsWith("metadata.")?t.metadata?.[e.replace("metadata.","")]:t[e])||""}`}n.d(t,{a:()=>r})},8631(e,t,n){n.d(t,{Ay:()=>s});var r=n(30128),a=n(52188);const i=(0,n(60459).S7)("HierarchicalTrackSelectorWidget",{});var o=n(34036);function s(e){e.addWidgetType(()=>new a.A({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:i,stateModel:(0,o.A)(e),ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(337),n.e(8946)]).then(n.bind(n,48946)))}))}},34036(e,t,n){n.d(t,{A:()=>T,L:()=>w});var r=n(17378),a=n(23886),i=n(1259),o=n(38817),s=n(10533),l=n(44934),c=n(19608),d=n(89919);function u(e,t,n){return e.filter(e=>t.filter(t=>n(t,e)).length>5)}function p(e,t,n){const a=(0,r.QZ)(t,"category")||[],i=e.toLowerCase();return(0,c.getTrackName)(t,n).toLowerCase().includes(i)||a.some(e=>e.toLowerCase().includes(i))}function h(e,t,n=0){let r=!1;for(const a of e)a.children.length?h(a.children,t,n+1)&&n>0&&t.push(a.id):r=!0;return r}function g(e,t){for(const n of e)n.children.length&&t.push(n.id)}const f=["category","adapter","description"];function m(e,t){const{assemblyManager:n}=(0,a.getSession)(t),{pluginManager:i}=(0,a.getEnv)(t),{view:o}=t;if(!o)return[];const s=t.assemblyNames.map(e=>n.getCanonicalAssemblyName(e)).filter(a.notEmpty),{displayTypes:l}=i.getViewType(o.type),c=new Set(l.map(e=>e.name));return e.filter(e=>{const t=(0,r.QZ)(e,"assemblyNames"),l=t?.map(e=>n.getCanonicalAssemblyName(e)).filter(a.notEmpty);return!!(o.trackSelectorAnyOverlap?function(e=[],t=[]){if(e[0]===t[0])return!0;{const n=new Set(e);return t.some(e=>n.has(e))}}(l,s):function(e=[],t=[]){const n=new Set(e);return t.every(e=>n.has(e))}(l,s))&&i.getTrackType(e.type).displayTypes.some(e=>c.has(e.name))})}function y({model:e,trackConfs:t,extra:n,noCategories:i,menuItems:o}){const s={children:[]},{filterText:l,activeSortTrackNames:d,activeSortCategories:u}=e,h=(0,a.getSession)(e),g=t.filter(e=>p(l,e,h)),f=new Map,m=new Map;for(const e of function(e,t,n){const a=e.map(e=>[e,(0,r.QZ)(e,"name"),(0,r.QZ)(e,"category")?.[0]||"",(0,r.QZ)(e,"category")?.[1]||"",(0,r.QZ)(e,"category")?.[2]||""]);return t&&a.sort((e,t)=>e[1].localeCompare(t[1])),n&&a.sort((e,t)=>e[2]!==t[2]?e[2].localeCompare(t[2]):e[3]!==t[3]?e[3].localeCompare(t[3]):e[4]!==t[4]?e[4].localeCompare(t[4]):0),a.map(e=>e[0])}(g,d,u)){const t=e.trackId.endsWith("sessionTrack"),a=(0,r.QZ)(e,"category")??[],l=t?[" Session tracks",...a]:a;let d=s,u=0;if(!i){let e="";for(const[t,r]of l.entries()){const a=r;e=e?`${e},${a}`:a;let i=m.get(d);i||(i=new Map,m.set(d,i));let s=i.get(a);s||(s={children:[],name:a,id:n?`${n}-${e}`:e,nestingLevel:t+1,menuItems:o,type:"category"},d.children.push(s),i.set(a,s)),d=s,u=t+1}}const p=f.get(d)??0;d.children.splice(p,0,{id:n?`${n},${e.trackId}`:e.trackId,trackId:e.trackId,name:(0,c.getTrackName)(e,h),conf:e,children:[],nestingLevel:u+1,type:"track"}),f.set(d,p+1)}return s.children}function b(){return"undefined"!=typeof window?[window.location.pathname,new URLSearchParams(window.location.search).get("config")].filter(Boolean).join("-"):"empty"}function w(e){return"category"===e.type?40:22}function v(e){return["recentlyUsedTracks",b(),e.join(",")].filter(Boolean).join("-")}function S(){return`favoriteTracks-${b()}}`}function x(e,t){return["collapsedCategories",b(),e.join(","),t].join("-")}function k(e,t){const n=(0,a.localStorageGetItem)(e);return null!=n&&n?JSON.parse(n):t}function C(e,t){null!=t&&(0,a.localStorageSetItem)(e,JSON.stringify(t))}function T(e){return s.types.model("HierarchicalTrackSelectorWidget",{id:o.K,type:s.types.literal("HierarchicalTrackSelectorWidget"),view:s.types.safeReference(e.pluggableMstType("view","stateModel")),faceted:s.types.optional(s.types.model("FacetedModel",{filterText:s.types.optional(s.types.string,""),showSparse:s.types.optional(s.types.boolean,()=>(0,a.localStorageGetBoolean)("facet-showSparse",!1)),showFilters:s.types.optional(s.types.boolean,()=>(0,a.localStorageGetBoolean)("facet-showFilters",!0)),showOptions:s.types.optional(s.types.boolean,()=>(0,a.localStorageGetBoolean)("facet-showTableOptions",!1)),panelWidth:s.types.optional(s.types.number,()=>(0,a.localStorageGetNumber)("facet-panelWidth",400))}).volatile(()=>({visible:{},useShoppingCart:!1,filters:l.observable.map()})).actions(e=>({setFilter(t,n){e.filters.set(t,n)},setPanelWidth:t=>(e.panelWidth=t,e.panelWidth),setUseShoppingCart(t){e.useShoppingCart=t},setFilterText(t){e.filterText=t},setShowSparse(t){e.showSparse=t},setShowOptions(t){e.showOptions=t},setShowFilters(t){e.showFilters=t},setVisible(t){e.visible=t}})).views(e=>({get allTrackConfigurations(){return(0,s.getParent)(e).allTrackConfigurations}})).views(e=>({get rows(){const t=(0,a.getSession)(e),{allTrackConfigurations:n,filterText:i}=e;return n.filter(e=>p(i,e,t)||function(e,t){const n=e.toLowerCase(),a=(0,r.QZ)(t,"description")||"",i=t.metadata||{};return a.toLowerCase().includes(n)||Object.values(i).some(e=>"string"==typeof e&&e.toLowerCase().includes(n))}(i,e)).map(e=>({id:e.trackId,conf:e,name:(0,c.getTrackName)(e,t),category:(0,r.QZ)(e,"category")?.join(", "),adapter:(0,r.QZ)(e,"adapter")?.type,description:(0,r.QZ)(e,"description"),metadata:e.metadata||{}}))}})).views(e=>({get filteredNonMetadataKeys(){return e.showSparse?f:u(f,e.rows,(e,t)=>e[t])},get metadataKeys(){return[...new Set(e.rows.flatMap(e=>{return t=e.metadata,Object.entries(t).map(([e,t])=>"string"==typeof t?e:"").filter(e=>!!e);var t}))]},get filteredMetadataKeys(){return e.showSparse?this.metadataKeys:u(this.metadataKeys,e.rows,(e,t)=>e.metadata[t])},get fields(){return["name",...this.filteredNonMetadataKeys,...this.filteredMetadataKeys.map(e=>`metadata.${e}`)]},get filteredRows(){const t=[...e.filters.entries()].filter(e=>e[1].length>0).map(([e,t])=>[e,new Set(t)]);return e.rows.filter(e=>t.every(([t,n])=>n.has((0,d.a)(t,e))))}})).actions(e=>({afterAttach(){(0,s.addDisposer)(e,(0,l.autorun)(function(){e.setVisible(Object.fromEntries(e.fields.map(e=>[e,!0])))},{name:"FacetedVisible"}))}})).postProcessSnapshot(e=>{if(!e)return e;const{filterText:t,showSparse:n,showFilters:r,showOptions:a,panelWidth:i,...o}=e;return{...o,...t?{filterText:t}:{},...n?{showSparse:n}:{},...r?{}:{showFilters:r},...a?{showOptions:a}:{},...400!==i?{panelWidth:i}:{}}}),{})}).volatile(()=>({favorites:k(S(),[]),recentlyUsed:[],selection:[],sortTrackNames:k("sortTrackNames",void 0),sortCategories:k("sortCategories",void 0),collapsed:l.observable.map(),filterText:"",recentlyUsedCounter:0,favoritesCounter:0})).views(e=>({get shownTrackIds(){return new Set(e.view?.tracks?.map(e=>e.configuration.trackId))},get selectionSet(){return new Set(e.selection)},get favoritesSet(){return new Set(e.favorites)},get recentlyUsedSet(){return new Set(e.recentlyUsed)},get assemblyNames(){return e.view?.assemblyNames||[]}})).actions(e=>({setSortTrackNames(t){e.sortTrackNames=t},setSortCategories(t){e.sortCategories=t},setSelection(t){e.selection=t},addToSelection(t){e.selection=(0,i.Q)([...e.selection,...t],e=>e.trackId)},removeFromSelection(t){const n=new Set(t);e.selection=e.selection.filter(e=>!n.has(e))},clearSelection(){e.selection=[]},addToFavorites(t){e.favoritesCounter+=1,e.favorites=[...e.favorites,t]},removeFromFavorites(t){e.favorites=e.favorites.filter(e=>e!==t)},clearFavorites(){e.favorites=[]},setRecentlyUsedCounter(t){e.recentlyUsedCounter=t},setRecentlyUsed(t){e.recentlyUsed=t},setFavorites(t){e.favorites=t},setFavoritesCounter(t){e.favoritesCounter=t},addToRecentlyUsed(t){e.recentlyUsed.includes(t)||(e.recentlyUsedCounter=Math.min(e.recentlyUsedCounter+1,10),e.recentlyUsed=e.recentlyUsed.length>=10?[...e.recentlyUsed.slice(1),t]:[...e.recentlyUsed,t])},clearRecentlyUsed(){e.recentlyUsed=[]},setView(t){e.view=t},toggleCategory(t){e.collapsed.set(t,!e.collapsed.get(t))},setCategoryCollapsed(t,n){e.collapsed.set(t,n)},expandAllCategories(){e.collapsed.clear()},setCollapsedCategories(t){e.collapsed.replace(t)},clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}})).views(t=>({isSelected:e=>t.selectionSet.has(e),isFavorite:e=>t.favoritesSet.has(e),isRecentlyUsed:e=>t.recentlyUsedSet.has(e),getRefSeqTrackConf(n){const{assemblyManager:r}=(0,a.getSession)(t),i=r.get(n),o=i?.configuration.sequence,s=e.getViewType(t.view.type);if(o)for(const e of o.displays)if(s.displayTypes.some(t=>t.name===e.type))return o}})).views(e=>({get activeSortTrackNames(){return e.sortTrackNames??(0,r.FI)((0,a.getSession)(e),["hierarchical","sort","trackNames"])},get activeSortCategories(){return e.sortCategories??(0,r.FI)((0,a.getSession)(e),["hierarchical","sort","categories"])},get configAndSessionTrackConfigurations(){return[...e.assemblyNames.map(t=>e.getRefSeqTrackConf(t)),...m((0,a.getSession)(e).tracks,e)].filter(a.notEmpty)},get allTrackConfigurations(){const{connectionInstances:t=[]}=(0,a.getSession)(e);return[...this.configAndSessionTrackConfigurations,...t.flatMap(e=>e.tracks)]},get allTrackConfigurationTrackIdSet(){return new Map(this.allTrackConfigurations.map(e=>[e.trackId,e]))}})).views(e=>({get favoriteTracks(){return e.favorites.filter(t=>e.allTrackConfigurationTrackIdSet.has(t)).map(t=>e.allTrackConfigurationTrackIdSet.get(t))},get recentlyUsedTracks(){return e.recentlyUsed.filter(t=>e.allTrackConfigurationTrackIdSet.has(t)).map(t=>e.allTrackConfigurationTrackIdSet.get(t))}})).views(e=>({get allTracks(){const{connectionInstances:t=[]}=(0,a.getSession)(e);return[{group:"Tracks",tracks:e.configAndSessionTrackConfigurations,noCategories:!1,menuItems:[]},...t.flatMap(t=>({group:(0,r.FI)(t,"name"),tracks:m(t.tracks,e),noCategories:!1,menuItems:[]}))]}})).views(e=>({get hierarchy(){return{name:"Root",id:"Root",type:"category",children:e.allTracks.map(t=>({name:t.group,id:t.group,type:"category",menuItems:t.menuItems,nestingLevel:0,children:y({model:e,trackConfs:t.tracks,extra:t.group,noCategories:t.noCategories})}))}}})).views(e=>({get flattenedItems(){const t=(n,r=[])=>{for(const a of n)r.push(a),a.children.length>0&&!e.collapsed.get(a.id)&&t(a.children,r);return r};return t(e.hierarchy.children)},get flattenedItemOffsets(){const e=[];let t=0;for(let n=0,r=this.flattenedItems.length;n<r;n++)e.push(t),t+=w(this.flattenedItems[n]);return{cumulativeHeight:t,offsets:e}}})).views(e=>({itemOffsets(t,n){const{flattenedItemOffsets:r}=e,{cumulativeHeight:a,offsets:i}=r;if(0===i.length)return{startIndex:0,endIndex:0,totalHeight:0,itemOffsets:i};const o=e=>{let t=0,n=i.length-1;for(;t<=n;){const r=Math.floor((t+n)/2);if(i[r]<=e&&(r===i.length-1||i[r+1]>e))return r;i[r]<e?t=r+1:n=r-1}return 0},s=n+t+440;return{startIndex:Math.max(0,o(n)-20),endIndex:Math.min(i.length-1,o(s)+20),totalHeight:a,itemOffsets:i}}})).actions(e=>({collapseSubCategories(){const t=[];h(e.hierarchy.children,t);for(const n of t)e.setCategoryCollapsed(n,!0)},collapseTopLevelCategories(){const t=[];for(const n of e.hierarchy.children)n.children.length&&g(n.children,t);for(const n of t)e.setCategoryCollapsed(n,!0)}})).views(e=>({get hasAnySubcategories(){return e.allTracks.some(e=>e.tracks.some(e=>(0,r.QZ)(e,"category")?.length>1))}})).actions(e=>({afterAttach(){(0,s.addDisposer)(e,(0,l.autorun)(function(){const{assemblyNames:t,view:n}=e;if(e.setRecentlyUsed(k(v(t),[])),n){const i=k(x(t,n.type),void 0),o=["hierarchical","defaultCollapsed"],s=(0,a.getSession)(e);if(i)e.setCollapsedCategories(i);else{e.expandAllCategories(),(0,r.FI)(s,[...o,"topLevelCategories"])&&e.collapseTopLevelCategories(),(0,r.FI)(s,[...o,"subCategories"])&&e.collapseSubCategories();for(const t of(0,r.FI)(s,[...o,"categoryNames"]))e.setCategoryCollapsed(`Tracks-${t}`,!0)}}},{name:"TrackSelectorInit"})),(0,s.addDisposer)(e,(0,l.autorun)(function(){const{sortTrackNames:t,sortCategories:n,favorites:r,recentlyUsed:a,assemblyNames:i,collapsed:o,view:s}=e;C(v(i),a),C(S(),r),C("sortTrackNames",t),C("sortCategories",n),s&&C(x(i,s.type),o)},{name:"TrackSelectorLocalStorage"}))}}))}},64444(e,t,n){n.d(t,{A:()=>d});var r=n(78544),a=n(60459),i=n(26710);const o=(0,a.S7)("JB2TrackHubConnection",{configJsonLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/config.json",locationType:"UriLocation"},description:"location of the jb2 config file (usually called config.json)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this config.json, if empty all genomes will be imported"}},{baseConfiguration:i.A,preProcessSnapshot:e=>e.uri?{...e,configJsonLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=n(67781),l=n(10533);function c(e){return l.types.compose("JB2TrackHubConnection",(0,s.A)(e),l.types.model({configuration:(0,a.AK)(o),type:l.types.literal("JB2TrackHubConnection")})).actions(e=>({async connect(){const{doConnect:t}=await n.e(2769).then(n.bind(n,82769));t(e)}}))}function d(e){e.addConnectionType(()=>new r.A({name:"JB2TrackHubConnection",configSchema:o,stateModel:c(e),displayName:"JB2 Track Hub",description:"A JBrowse 2 config file based trackhub",url:"https://jbrowse.org/jb2/"}))}},39417(e,t,n){n.d(t,{A:()=>d});var r=n(30128),a=n(60459),i=n(52188),o=n(38817),s=n(10533);function l(e){return s.types.model("PluginStoreModel",{id:o.K,type:s.types.literal("PluginStoreWidget"),filterText:"",view:s.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions(e=>({clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}}))}const c=(0,a.S7)("PluginStoreWidget",{});function d(e){e.addWidgetType(()=>new i.A({name:"PluginStoreWidget",heading:"Plugin store",configSchema:c,stateModel:l(e),ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(8705),n.e(941)]).then(n.bind(n,20941)))}))}},91848(e,t,n){n.d(t,{A:()=>d});var r=n(78544),a=n(60459),i=n(26710);const o=(0,a.S7)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:i.A,preProcessSnapshot:e=>e.uri?{...e,hubTxtLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=n(67781),l=n(10533);function c(e){return l.types.compose("UCSCTrackHubConnection",(0,s.A)(e),l.types.model({configuration:(0,a.AK)(o),type:l.types.literal("UCSCTrackHubConnection")})).actions(e=>({async connect(){const{doConnect:t}=await n.e(3498).then(n.bind(n,93498));t(e)}}))}function d(e){e.addConnectionType(()=>new r.A({name:"UCSCTrackHubConnection",configSchema:o,stateModel:c(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"https://genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"}))}},83078(e,t,n){n.d(t,{H2:()=>o,rQ:()=>i,wJ:()=>a});var r=n(23886);function a(e,t,n=!0){const{assemblyName:a,refName:i,start:o,offset:s,oob:l}=t.pxToBp(e),c=Math.floor(o+s);return l?"out of bounds":`${n?`{${a}}`:""}${i}:${(0,r.toLocale)(c)}`}function i(e,t,n){const r=new Set,a=[...e].sort((e,t)=>{const n=e.end-e.start;return t.end-t.start-n}),i=new Set;for(const{key:e,offsetPx:o}of a){const a=Math.round(t-o+n),s=Math.max(a-12,0);let l=0===a;if(!l)for(let e=s;e<a;e++)if(i.has(e)){l=!0;break}if(l)r.add(e);else for(let e=s;e<a;e++)i.add(e)}return r}function o(e,t,n=!0,r=!0){const a=[],i=function(e){const t=60*(e=Math.abs(e));let n=10**+t.toExponential().split(/e/i)[1];for(;n<t&&(n*=2,!(n>=t));)n*=2.5;n=Math.max(n,5);const r=n/e;let a=0;return!(n%10)&&r/10>=15?a=n/10:!(n%5)&&r/5>=15?a=n/5:!(n%2)&&r/2>=15&&(a=n/2),{majorPitch:n,minorPitch:a}}(t),o=i.minorPitch||i.majorPitch;for(const{start:t,end:s,refName:l}of e){let e=0;const c=t,d=s;for(let s=Math.floor(c/o)*o;s<Math.ceil(d/o)*o+1;s+=o)r&&s%i.majorPitch?(a.push({type:"minor",base:s-1,index:e,refName:l}),e+=1):n&&Math.abs(s-t)>i.minorPitch&&(a.push({type:"major",base:s-1,index:e,refName:l}),e+=1)}return a}},2433(e,t,n){n.d(t,{OX:()=>c,Th:()=>h,_b:()=>l,i0:()=>d,m$:()=>o,u5:()=>s,xx:()=>i,yM:()=>p});var r=n(92558),a=n(53121);const i=16581375,o=3,s=1600;function l(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}function c(e,t,n,r){return Math.floor((255*e*255+255*t+n-1)/r)}function d(e){const t=function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return Math.abs(t)}(e);return r.category10[t%r.category10.length]}const u={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},p={default:{cigarColors:u},strand:{posColor:"red",negColor:"blue",cigarColors:{I:"#ff03",N:"#a020f0",D:"#a020f0",X:"brown",M:"#f003","=":"#f003"}},query:{cigarColors:u}};function h(e,t){return 1===t?e:(0,a.M)(e).alpha(t).toHex()}},16150(e,t,n){n.d(t,{S:()=>a});var r=n(23886);function a(e){return 0===e.length?0:20+Math.max(...e.map(e=>(0,r.measureText)(e.label,10)))+6+20}},83826(e,t,n){n.d(t,{Ay:()=>S});var r=n(30128),a=n(17378),i=n(46625),o=n(87377),s=n(69566),l=n(82111),c=n(23886),d=n(24155),u=n(55614),p=n(44460);const h=(0,i.n)()({heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:999,boxSizing:"border-box"}}),g=(0,r.memo)(function(e){const t=(0,u.c)(5),{top:n}=e,{classes:r}=h();let a,i;return t[0]!==n?(a={top:n,pointerEvents:"none",height:16},t[0]=n,t[1]=a):a=t[1],t[2]!==r.heightOverflowed||t[3]!==a?(i=(0,p.jsx)("div",{className:r.heightOverflowed,style:a,children:"Max height reached"}),t[2]=r.heightOverflowed,t[3]=a,t[4]=i):i=t[4],i}),f=(0,s.observer)(function({model:e}){const{blockDefinitions:t,blockState:n}=e;return t.map(t=>{const r=`${e.id}-${t.key}`;if("ContentBlock"===t.type){const e=n.get(t.key);return(0,p.jsxs)(d.$G,{block:t,children:[e?.ReactComponent?(0,p.jsx)(e.ReactComponent,{model:e}):null,e?.maxHeightReached?(0,p.jsx)(g,{top:e.layout.getTotalHeight()-16}):null]},r)}if("ElidedBlock"===t.type)return(0,p.jsx)(d.Db,{width:t.widthPx},r);if("InterRegionPaddingBlock"===t.type)return(0,p.jsx)(d.fK,{width:t.widthPx,style:{background:"none"},boundary:"boundary"===t.variant},r);throw new Error(`invalid block type ${JSON.stringify(t)}`)})}),m=(0,i.n)()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"}}),y=(0,s.observer)(function({model:e}){const{classes:t}=m(),{blockDefinitions:n}=e,r=(0,c.getContainingView)(e);return(0,p.jsx)("div",{className:t.linearBlocks,style:{left:n.offsetPx-r.offsetPx},children:(0,p.jsx)(f,{model:e})})});var b=n(53458);const w=(0,s.observer)(function({onClose:e,contextCoord:t,model:n}){const r=n.contextMenuItems();return(0,p.jsx)(b.A,{open:r.length>0,onMenuItemClick:(t,n)=>{n(),e()},onClose:()=>{e(),n.setContextMenuFeature(void 0)},slotProps:{transition:{onExit:()=>{e(),n.setContextMenuFeature(void 0)}}},anchorReference:"anchorPosition",anchorPosition:{top:t[1],left:t[0]},menuItems:r})}),v=(0,i.n)()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),S=(0,s.observer)(function(e){const{classes:t}=v(),n=(0,r.useRef)(null),[i,s]=(0,r.useState)(),[c,d]=(0,r.useState)([0,0]),[u,h]=(0,r.useState)([0,0]),[g,f]=(0,r.useState)(),{model:m,children:b}=e,{TooltipComponent:S,DisplayMessageComponent:x,height:k,showLegend:C,showTooltipsEnabled:T}=m,A=(0,o.A)(),M=m.legendItems(A);return(0,p.jsxs)("div",{ref:n,"data-testid":`display-${(0,a.FI)(m,"displayId")}`,className:t.display,onContextMenu:e=>{e.preventDefault(),g?f(void 0):n.current&&f([e.clientX,e.clientY])},onMouseMove:e=>{if(!n.current)return;const t=n.current.getBoundingClientRect(),{left:r,top:a}=t;d([e.clientX-r,e.clientY-a]),h([e.clientX,e.clientY]),s(t)},children:[x?(0,p.jsx)(x,{model:m}):(0,p.jsx)(y,{...e}),b,C&&M.length>0?(0,p.jsx)(l.A,{items:M}):null,T?(0,p.jsx)(r.Suspense,{fallback:null,children:(0,p.jsx)(S,{model:m,height:k,offsetMouseCoord:c,clientMouseCoord:u,clientRect:i,mouseCoord:c})}):null,g?(0,p.jsx)(w,{contextCoord:g,model:m,onClose:()=>{f(void 0)}}):null]})})},24155(e,t,n){n.d(t,{$G:()=>l,Db:()=>c,fK:()=>d});var r=n(55614),a=n(46625),i=n(69566),o=n(44460);const s=(0,a.n)()(e=>({contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.disabled},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}})),l=(0,i.observer)(function({block:e,children:t}){const{classes:n}=s(),{widthPx:r}=e;return(0,o.jsx)("div",{style:{width:r},className:n.contentBlock,children:t})});function c(e){const t=(0,r.c)(5),{width:n}=e,{classes:a}=s();let i,l;return t[0]!==n?(i={width:n},t[0]=n,t[1]=i):i=t[1],t[2]!==a.elidedBlock||t[3]!==i?(l=(0,o.jsx)("div",{className:a.elidedBlock,style:i}),t[2]=a.elidedBlock,t[3]=i,t[4]=l):l=t[4],l}function d(e){const t=(0,r.c)(8),{boundary:n,width:a,style:i}=e;let l;t[0]!==i?(l=void 0===i?{}:i,t[0]=i,t[1]=l):l=t[1];const c=l,{classes:d}=s();let u;t[2]!==c||t[3]!==a?(u={...c,width:a},t[2]=c,t[3]=a,t[4]=u):u=t[4];const p=n?d.boundaryPaddingBlock:d.interRegionPaddingBlock;let h;return t[5]!==u||t[6]!==p?(h=(0,o.jsx)("div",{style:u,className:p}),t[5]=u,t[6]=p,t[7]=h):h=t[7],h}},8944(e,t,n){n.d(t,{A:()=>c});var r=n(55614),a=n(46625),i=n(30097),o=n(43754),s=n(44460);const l=(0,a.n)()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"},content:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"80%",textAlign:"center"}});function c(e){const t=(0,r.c)(13),{message:n,severity:a,action:c}=e,{classes:p}=l();let h,g,f,m;return t[0]!==p.ellipses?(h={message:p.ellipses},t[0]=p.ellipses,t[1]=h):h=t[1],t[2]!==p.content||t[3]!==n?(g=(0,s.jsx)("div",{className:p.content,children:n}),t[2]=p.content,t[3]=n,t[4]=g):g=t[4],t[5]!==n||t[6]!==g?(f=(0,s.jsx)(i.A,{title:n,children:g}),t[5]=n,t[6]=g,t[7]=f):f=t[7],t[8]!==c||t[9]!==a||t[10]!==h||t[11]!==f?(m=(0,s.jsx)(o.A,{severity:a,action:c,classes:h,onMouseDown:u,onClick:d,children:f}),t[8]=c,t[9]=a,t[10]=h,t[11]=f,t[12]=m):m=t[12],m}function d(e){e.stopPropagation()}function u(e){e.stopPropagation()}},82111(e,t,n){n.d(t,{A:()=>s});var r=n(46625),a=n(69566),i=n(44460);const o=(0,r.n)()(e=>({legend:{position:"absolute",right:10,top:10,background:e.palette.background.paper,padding:3,fontSize:10,pointerEvents:"none",zIndex:100,maxWidth:200},item:{display:"flex",alignItems:"center",marginBottom:1,"&:last-child":{marginBottom:0}},colorBox:{width:12,height:12,marginRight:6,flexShrink:0},label:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}})),s=(0,a.observer)(function({items:e}){const{classes:t}=o();return 0===e.length?null:(0,i.jsx)("div",{className:t.legend,children:e.map((e,n)=>(0,i.jsxs)("div",{className:t.item,children:[(0,i.jsx)("div",{className:t.colorBox,style:{backgroundColor:e.color}}),(0,i.jsx)("span",{className:t.label,children:e.label})]},`${e.label}-${n}`))})})},92130(e,t,n){n.d(t,{HV:()=>a,OM:()=>o,mJ:()=>s});var r=n(23886);function a(e){const t=[];for(const[,n]of e)n.layout?.getRectangles&&t.push(n.layout.getRectangles());return t}function i(e,t,n,r,a,i){return function(e,t,n,r,a,i){const o=t?.getCanonicalRefName(n)||n,s=e.bpToPx({refName:o,coord:r})?.offsetPx,l=e.bpToPx({refName:o,coord:a})?.offsetPx;if(void 0!==s){const e=void 0!==l?l:s+(a-r)/i;return Math.min(s,e)}if(void 0!==l){const e=l-(a-r)/i;return Math.min(e,l)}}(e,t,n,r,a,i)??function(e,t,n,r,a){const i=t?.getCanonicalRefName(n)||n,o=e.displayedRegions.filter(e=>e.refName===i&&e.start<a&&e.end>r);if(0===o.length)return;let s=1/0;for(const t of o){const n=Math.max(r,t.start),o=Math.min(a,t.end),l=e.bpToPx({refName:i,coord:n})?.offsetPx,c=e.bpToPx({refName:i,coord:o})?.offsetPx;void 0!==l&&void 0!==c&&(s=Math.min(s,l,c))}return s!==1/0?s:void 0}(e,t,n,r,a)}function o(e,t,n,r){const a=new Map;for(const[o,s]of e.entries()){if(!s?.[4])continue;const[,e,,,l]=s,{refName:c,floatingLabels:d,totalFeatureHeight:u,actualTopPx:p,featureWidth:h,featureStartBp:g,featureEndBp:f}=l,m=p??e;if(!d||0===d.length||!u||void 0===h||void 0===g||void 0===f)continue;const y=i(t,n,c,g,f,r);if(void 0===y)continue;const b=a.get(o);(!b||y<b.leftPx)&&a.set(o,{leftPx:y,topPx:m,totalFeatureHeight:u,floatingLabels:d,featureWidth:h})}return a}function s(e,t,n,a){if(n>t-e)return e-a;const i=Math.max(0,a),o=Math.max(e,i)-a,s=t-a-n;return(0,r.clamp)(o,0,s)}},89346(e,t,n){n.d(t,{L:()=>M});var r=n(30128),a=n(60459),i=n(17378),o=n(9789),s=n(23886),l=n(16640),c=n(43102),d=n(34895),u=n(19608),p=n(10533),h=n(78657),g=n(21984),f=n(1373),m=n(38018),y=n(44934),b=n(16150),w=n(92130),v=n(85170),S=n(4615),x=n(77529),k=n(56028),C=n(73539);const T=(0,r.lazy)(()=>n.e(6989).then(n.bind(n,36989))),A=(0,r.lazy)(()=>n.e(9465).then(n.bind(n,39465))),M=p.types.compose("BaseLinearDisplay",o.q,(0,S.A)(),(0,v.A)(),p.types.model({blockState:p.types.map(k.A),configuration:(0,a.AK)(x.A),showLegend:p.types.maybe(p.types.boolean),showTooltips:p.types.maybe(p.types.boolean)})).volatile(()=>({mouseoverExtraInformation:void 0,featureIdUnderMouse:void 0,subfeatureIdUnderMouse:void 0,contextMenuFeature:void 0})).views(e=>({get DisplayMessageComponent(){},get blockType(){return"staticBlocks"},get blockDefinitions(){const t=(0,s.getContainingView)(e);if(!t.initialized)throw new Error("view not initialized yet");return t[this.blockType]}})).views(e=>({get renderDelay(){return 50},get TooltipComponent(){return T},legendItems:e=>[],svgLegendWidth(t){return e.showLegend?(0,b.S)(this.legendItems(t)):0},get selectedFeatureId(){if((0,p.isAlive)(e)){const{selection:t}=(0,s.getSession)(e);if((0,c.l)(t))return t.id()}},get featureWidgetType(){return{type:"BaseFeatureWidget",id:"baseFeature"}}})).views(e=>({get showTooltipsEnabled(){return e.showTooltips??!0},get features(){const t=[];for(const n of e.blockState.values())n.features&&t.push(n.features);return new d.A(t)},get featureUnderMouse(){const t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureById(e,t){const n=this.features.get(e);if(n)return n;if(t){const n=this.features.get(t);if(n)return(0,C.IU)(n,e)}},get layoutFeatures(){const t=[];for(const n of e.blockState.values())n.layout?.getRectangles&&t.push(n.layout.getRectangles());return new d.A(t)},getFeatureOverlapping:(t,n,r)=>e.blockState.get(t)?.layout?.getByCoord(n,r),getFeatureByID:(t,n)=>e.blockState.get(t)?.layout?.getByID(n),searchFeatureByID(t){for(const n of e.blockState.values()){const e=n.layout?.getByID(t);if(e)return e}},get floatingLabelData(){const t=(0,s.getContainingView)(e),{assemblyManager:n}=(0,s.getSession)(e),r=t.assemblyNames[0],a=r?n.get(r):void 0;return(0,w.OM)(this.layoutFeatures,t,a,t.bpPerPx)}})).actions(e=>({addBlock(t,n){const r=k.A.create({key:t,region:n.toRegion()});r.setCachedDisplay(e),e.blockState.set(t,r)},deleteBlock(t){e.blockState.delete(t)},selectFeature(t){const n=(0,s.getSession)(e);if((0,l.mY)(n)&&n.setSelection(t),(0,l.lO)(n)){const{rpcManager:r}=n,a=(0,u.getRpcSessionId)(e),o=(0,s.getContainingTrack)(e),l=(0,s.getContainingView)(e),c=(0,i.FI)(o,"adapter"),{type:d,id:h}=e.featureWidgetType;r.call(a,"CoreGetMetadata",{adapterConfig:c}).then(r=>{(0,p.isAlive)(e)&&n.showWidget(n.addWidget(d,h,{featureData:t.toJSON(),view:l,track:o,descriptions:r}))}).catch(t=>{console.error(t),(0,s.getSession)(e).notifyError(`${t}`,t)})}},navToFeature(t){(0,s.getContainingView)(e).navTo({refName:t.get("refName"),start:t.get("start"),end:t.get("end")})},clearFeatureSelection(){(0,s.getSession)(e).clearSelection()},setFeatureIdUnderMouse(t){e.featureIdUnderMouse=t},setSubfeatureIdUnderMouse(t){e.subfeatureIdUnderMouse=t},setContextMenuFeature(t){e.contextMenuFeature=t},setMouseoverExtraInformation(t){e.mouseoverExtraInformation=t},setShowLegend(t){e.showLegend=t},setShowTooltips(t){e.showTooltips=t}})).actions(e=>{const{reload:t}=e;return{async reload(){e.setError(),e.setCurrStatsBpPerPx(0),e.clearFeatureDensityStats();for(const t of e.blockState.values())t.doReload();t()}}}).actions(e=>({selectFeatureById:(0,p.flow)(function*(t,n,r){const a=e.getFeatureById(t,n);if(a)return void e.selectFeature(a);const i=r&&r!==t?r:n;try{const n=(0,s.getSession)(e),r=yield(0,C.Ac)({rpcManager:n.rpcManager,sessionId:(0,u.getRpcSessionId)(e),trackId:(0,s.getContainingTrack)(e).id,rendererType:e.rendererTypeName,featureId:t,parentFeatureId:i});r&&(0,p.isAlive)(e)&&e.selectFeature(r)}catch(t){console.error(t),(0,s.getSession)(e).notifyError(`${t}`,t)}}),setContextMenuFeatureById:(0,p.flow)(function*(t,n,r){const a=e.getFeatureById(t,n);if(a)return void e.setContextMenuFeature(a);const i=r&&r!==t?r:n;try{const n=(0,s.getSession)(e),r=yield(0,C.Ac)({rpcManager:n.rpcManager,sessionId:(0,u.getRpcSessionId)(e),trackId:(0,s.getContainingTrack)(e).id,rendererType:e.rendererTypeName,featureId:t,parentFeatureId:i});r&&(0,p.isAlive)(e)&&e.setContextMenuFeature(r)}catch(t){console.error(t),(0,s.getSession)(e).notifyError(`${t}`,t)}})})).views(e=>({trackMenuItems:()=>[],contextMenuItems(){const t=e.contextMenuFeature,r=(0,C._1)(t);return t?[{label:"Open feature details",icon:m.A,onClick:()=>{e.selectFeature(t)}},{label:"Zoom to feature",icon:h.A,onClick:()=>{e.navToFeature(t)}},{label:"Copy info to clipboard",icon:f.A,onClick:async()=>{const{uniqueId:r,...a}=t.toJSON(),i=(0,s.getSession)(e),{default:o}=await n.e(2899).then(n.t.bind(n,72899,23));o(JSON.stringify(a,null,4)),i.notify("Copied to clipboard","success")}},...(0,C.Ud)(r)?[{label:"Collapse introns",icon:g.A,onClick:()=>{const t=(0,s.getContainingView)(e),{assemblyManager:n}=(0,s.getSession)(e),a=n.get(t.assemblyNames[0]);a&&(0,s.getSession)(e).queueDialog(e=>[A,{view:t,transcripts:r,handleClose:e,assembly:a}])}}]:[]]:[]},renderingProps:()=>({displayModel:e,onMouseMove(t,n){e.setFeatureIdUnderMouse(n)},onMouseLeave(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu(t){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}}),renderProps:()=>({...(0,u.getParentRenderProps)(e),notReady:!e.featureDensityStatsReady,rpcDriverName:e.effectiveRpcDriverName})})).actions(e=>({async renderSvg(t){const{renderBaseLinearDisplaySvg:r}=await n.e(1792).then(n.bind(n,71792));return r(e,t)},afterAttach(){(0,p.addDisposer)(e,(0,y.autorun)(function(){try{if(!(0,p.isAlive)(e)||e.isMinimized)return;if(!(0,s.getContainingView)(e).initialized)return;const t=e.blockDefinitions.contentBlocks,n=new Set(t.map(e=>e.key));for(const n of t)e.blockState.has(n.key)||e.addBlock(n.key,n);for(const t of e.blockState.keys())n.has(t)||e.deleteBlock(t)}catch(e){}},{name:"BaseLinearDisplayBlockDefinitions",delay:60}))}})).preProcessSnapshot(e=>{if(!e)return e;const{height:t,...n}=e;return{heightPreConfig:t,...n}}).postProcessSnapshot(e=>{const t=e,{blockState:n,...r}=t;return r})},85170(e,t,n){n.d(t,{A:()=>g});var r=n(17378),a=n(23886),i=n(10533),o=n(44934),s=n(15146),l=n(8576),c=n(35703),d=n(69566),u=n(8944),p=n(44460);const h=(0,d.observer)(function({model:e}){const{regionTooLargeReason:t}=e;return(0,p.jsx)(u.A,{severity:"warning",action:(0,p.jsx)(c.A,{onClick:()=>{(0,i.isAlive)(e)&&(e.setFeatureDensityStatsLimit(e.featureDensityStats),e.reload())},children:"Force load"}),message:[t,"Zoom in to see features or force load (may be slow)"].filter(e=>!!e).join(". ")})});function g(){return i.types.model({userBpPerPxLimit:i.types.maybe(i.types.number),userByteSizeLimit:i.types.maybe(i.types.number)}).volatile(()=>({featureDensityStatsP:void 0,featureDensityStats:void 0,currStatsBpPerPx:0})).views(e=>({get currentBytesRequested(){return e.featureDensityStats?.bytes||0},get currentFeatureScreenDensity(){const t=(0,a.getContainingView)(e);return(e.featureDensityStats?.featureDensity||0)*t.bpPerPx},get maxFeatureScreenDensity(){return(0,r.FI)(e,"maxFeatureScreenDensity")},get featureDensityStatsReady(){const t=(0,a.getContainingView)(e);return!(e.currStatsBpPerPx!==t.bpPerPx||!e.featureDensityStats&&!e.userBpPerPxLimit)},get maxAllowableBytes(){return e.userByteSizeLimit||e.featureDensityStats?.fetchSizeLimit||(0,r.FI)(e,"fetchSizeLimit")}})).actions(e=>({afterAttach(){(0,i.addDisposer)(e,(0,o.autorun)(()=>async function(e){try{const t=(0,a.getContainingView)(e);if(!t.initialized||!t.staticBlocks.contentBlocks.length||t.bpPerPx===e.currStatsBpPerPx||e.error)return;if(void 0!==e.featureDensityStats?.featureDensity)return void e.setCurrStatsBpPerPx(t.bpPerPx);e.clearFeatureDensityStats(),e.setCurrStatsBpPerPx(t.bpPerPx);const n=await e.getFeatureDensityStats();(0,i.isAlive)(e)&&e.setFeatureDensityStats(n)}catch(t){console.error(t),(0,i.isAlive)(e)&&!(0,s.Kp)(t)&&e.setError(t)}}(e)))}})).actions(e=>({setCurrStatsBpPerPx(t){e.currStatsBpPerPx=t},setFeatureDensityStatsLimit(t){const n=(0,a.getContainingView)(e);t?.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=n.bpPerPx},getFeatureDensityStats(){return e.featureDensityStatsP||(e.featureDensityStatsP=(0,l.bf)(e).catch(t=>{throw(0,i.isAlive)(e)&&this.setFeatureDensityStatsP(void 0),t})),e.featureDensityStatsP},setFeatureDensityStatsP(t){e.featureDensityStatsP=t},setFeatureDensityStats(t){e.featureDensityStats=t},clearFeatureDensityStats(){e.featureDensityStatsP=void 0,e.featureDensityStats=void 0}})).views(e=>({get regionTooLarge(){const t=(0,a.getContainingView)(e);return!(!e.featureDensityStatsReady||t.dynamicBlocks.totalBp<2e4)&&(e.currentBytesRequested>e.maxAllowableBytes||(e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity))},get regionTooLargeReason(){const t=e.currentBytesRequested,n=e.maxAllowableBytes;return t&&t>n?`Requested too much data (${(0,l.W7)(t)})`:""}})).views(e=>({get featureDensityStatsReadyAndRegionNotTooLarge(){return e.featureDensityStatsReady&&!e.regionTooLarge},regionCannotBeRenderedText:t=>e.regionTooLarge?"Force load to see features":"",regionCannotBeRendered:t=>e.regionTooLarge?(0,p.jsx)(h,{model:e}):null}))}},4615(e,t,n){n.d(t,{A:()=>i});var r=n(17378),a=n(10533);function i(){return a.types.model({heightPreConfig:a.types.maybe(a.types.refinement("displayHeight",a.types.number,e=>e>=20))}).volatile(()=>({scrollTop:0})).views(e=>({get height(){return e.heightPreConfig??(0,r.FI)(e,"height")}})).actions(e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n}}))}},77529(e,t,n){n.d(t,{A:()=>r});const r=(0,n(60459).S7)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"},height:{type:"number",defaultValue:100,description:"default height for the track"},mouseover:{type:"string",description:"text to display when the cursor hovers over a feature",defaultValue:"jexl:mouseoverExtraInformation||get(feature,'_mouseOver')||get(feature,'name')||get(feature,'id')",contextVariable:["feature","mouseoverExtraInformation"]},jexlFilters:{type:"stringArray",description:"default set of jexl filters to apply to a track. note: these do not use the jexl prefix because they have a deferred evaluation system",defaultValue:[]}},{explicitIdentifier:"displayId"})},56028(e,t,n){n.d(t,{A:()=>x,s:()=>k});var r=n(17378),a=n(23886),i=n(67665),o=n(29458),s=n(19608),l=n(16640),c=n(10533),d=n(30128),u=n(69566),p=n(8944),h=n(55614),g=n(46625),f=n(81285),m=n(64261),y=n(44460);const b=(0,g.n)()({container:{position:"relative",width:"100%",height:"100%",minHeight:20},overlay:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.15)",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(0, 0, 0, 0.05) 8px, rgba(0, 0, 0, 0.05) 16px)",pointerEvents:"none",zIndex:1,display:"flex",justifyContent:"center",alignItems:"center",opacity:0},visible:{opacity:1},dots:{fontSize:"0.8rem",fontWeight:300,"&::after":{display:"inline-block",content:'""',width:"1em",textAlign:"left",animation:`${f.i7`
        0% { content: ''; }
        25% { content: '.'; }
        50% { content: '..'; }
        75% { content: '...'; }
      `} 1.2s infinite ease-in-out`}}});function w(e){const t=(0,h.c)(17),{statusMessage:n,children:r,height:a}=e,{classes:i}=b(),o=!!n,s=i.container;let l;t[0]!==a?(l=a?{height:a}:void 0,t[0]=a,t[1]=l):l=t[1];const c=o&&i.visible;let d;t[2]!==i.overlay||t[3]!==c?(d=(0,m.cx)(i.overlay,c),t[2]=i.overlay,t[3]=c,t[4]=d):d=t[4];const u=o?"loading-overlay":void 0,p=n||"Loading";let g,f,w;return t[5]!==i.dots||t[6]!==p?(g=(0,y.jsx)("span",{className:i.dots,children:p}),t[5]=i.dots,t[6]=p,t[7]=g):g=t[7],t[8]!==d||t[9]!==u||t[10]!==g?(f=(0,y.jsx)("span",{className:d,"data-testid":u,children:g}),t[8]=d,t[9]=u,t[10]=g,t[11]=f):f=t[11],t[12]!==r||t[13]!==i.container||t[14]!==l||t[15]!==f?(w=(0,y.jsxs)("div",{className:s,style:l,children:[r,f]}),t[12]=r,t[13]=i.container,t[14]=l,t[15]=f,t[16]=w):w=t[16],w}const v=(0,d.lazy)(()=>Promise.all([n.e(9490),n.e(5692)]).then(n.bind(n,95692))),S=(0,u.observer)(function({model:e}){return e.error?(0,y.jsx)(d.Suspense,{fallback:null,children:(0,y.jsx)(v,{model:e})}):e.message?(0,d.isValidElement)(e.message)?e.message:(0,y.jsx)(p.A,{message:`${e.message}`,severity:"info"}):(0,y.jsx)(w,{statusMessage:e.statusMessage,height:e.displayHeight,children:e.reactElement})}),x=c.types.model("BlockState",{key:c.types.string,region:c.types.frozen(),reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile(()=>({stopToken:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,blockStatusMessage:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:S,renderProps:void 0,renderArgs:void 0,isRenderingPending:!0,cachedDisplay:void 0})).actions(e=>{function t(){void 0!==e.stopToken&&((0,o.CF)(e.stopToken),e.stopToken=void 0)}function n(){e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.renderProps=void 0,e.renderArgs=void 0}return{doReload(){e.reloadFlag=e.reloadFlag+1},setStatusMessage(t){e.blockStatusMessage=t},setLoading(n){t(),e.isRenderingPending=!0,e.error=void 0,e.message=void 0,e.stopToken=n},setMessage(r){t(),e.isRenderingPending=!1,e.message=r,e.error=void 0,n()},setRendered(t){if(!t)return;const{reactElement:n,features:r,layout:a,maxHeightReached:i,renderProps:o,renderArgs:s}=t;e.filled=!0,e.isRenderingPending=!1,e.message=void 0,e.reactElement=n,e.features=r,e.layout=a,e.error=void 0,e.maxHeightReached=i,e.renderProps=o,e.renderArgs=s,e.stopToken=void 0},setError(r){console.error(r),t(),e.isRenderingPending=!1,e.message=void 0,e.error=r,n(),(0,l.yH)(r)&&this.reload()},reload(){e.stopToken=void 0,e.isRenderingPending=!1,e.error=void 0,e.message=void 0,e.ReactComponent=S,n(),(0,c.getParent)(e,2).reload()},setCachedDisplay(t){e.cachedDisplay=t},beforeDestroy(){(async()=>{try{if(t(),e.renderArgs&&e.cachedDisplay){const{rpcManager:t}=(0,a.getSession)(e),{rendererType:n}=e.cachedDisplay;await n.freeResourcesInClient(t,JSON.parse(JSON.stringify(e.renderArgs)))}}catch(e){console.error("Error while destroying block",e)}})()}}}).views(e=>({get statusMessage(){return e.isRenderingPending?e.blockStatusMessage||e.cachedDisplay?.statusMessage||"Loading":void 0},get displayHeight(){return e.cachedDisplay?.height}})).actions(e=>({afterAttach(){const t=e.cachedDisplay||(0,a.getContainingDisplay)(e);setTimeout(()=>{(0,c.isAlive)(e)&&(0,i.I)(e,k,C,{name:`${t.id}/${(0,a.assembleLocString)(e.region)} rendering`,delay:t.renderDelay,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)},t.renderDelay)}}));function k(e,t){try{const n=t||e.cachedDisplay||(0,a.getContainingDisplay)(e),{assemblyManager:i,rpcManager:o}=(0,a.getSession)(n),{adapterConfig:l,rendererType:d,error:u,parentTrack:p}=n,h=(0,s.getTrackAssemblyNames)(p),g=e.region.assemblyName;if(!h.includes(g)&&!h.some(e=>i.get(e)?.hasName(g)))throw new Error(`region assembly (${g}) does not match track assemblies (${h})`);const f=n.renderProps(),m=n.renderingProps?.(),{config:y}=f;(0,r.QZ)(y);const b=(0,s.getRpcSessionId)(n),w=p.id,v=n.regionCannotBeRendered(e.region),S=i.get(e.region.assemblyName),x=S?.getSeqAdapterRefName(e.region.refName);return{rendererType:d,rpcManager:o,renderProps:f,renderingProps:m,cannotBeRenderedReason:v,displayError:u,renderArgs:{statusCallback:t=>{(0,c.isAlive)(e)&&e.setStatusMessage(t)},assemblyName:e.region.assemblyName,regions:[{...e.region,seqAdapterRefName:x}],adapterConfig:l,rendererType:d.name,sessionId:b,trackInstanceId:w,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(e){return{displayError:e}}}async function C(e,t,n){if(!e||!(0,c.isAlive)(n))return;const{rendererType:r,renderProps:a,renderingProps:i,rpcManager:o,renderArgs:s,cannotBeRenderedReason:l,displayError:d}=e;if(d)return void n.setError(d);if(l)return void n.setMessage(l);if(a.notReady||!s)return;const{reactElement:u,features:p,layout:h,maxHeightReached:g}=await r.renderInClient(o,{...s,...a,renderingProps:i,stopToken:t});return{reactElement:u,features:p,layout:h,maxHeightReached:g,renderProps:a,renderArgs:s}}},8576(e,t,n){n.d(t,{OX:()=>s,W7:()=>o,bf:()=>l});var r=n(23886),a=n(19608),i=n(10533);function o(e){return Math.floor(e/1e6)>0?`${Number.parseFloat((e/1e6).toPrecision(3))} Mb`:Math.floor(e/1e3)>0?`${Number.parseFloat((e/1e3).toPrecision(3))} Kb`:`${Math.floor(e)} bytes`}function s(e,t){const n="undefined"==typeof jest;return["clip",n?e:"jest",t,n?Math.random():""].filter(e=>!!e).join("-")}async function l(e){const t=(0,r.getContainingView)(e).staticBlocks.contentBlocks,{rpcManager:n}=(0,r.getSession)(e),{adapterConfig:o,effectiveRpcDriverName:s}=e;if(o){const r=(0,a.getRpcSessionId)(e);return n.call(r,"CoreGetFeatureDensityStats",{sessionId:r,regions:t,adapterConfig:o,rpcDriverName:s,statusCallback:t=>{(0,i.isAlive)(e)&&e.setStatusMessage(t)}})}return{}}},73539(e,t,n){n.d(t,{Ac:()=>i,IU:()=>o,Ud:()=>s,_1:()=>l,y6:()=>c});var r=n(23886),a=n(43102);async function i({rpcManager:e,sessionId:t,trackId:n,rendererType:r,featureId:i,parentFeatureId:s}){const l=s||i,{feature:c}=await e.call(t,"CoreGetFeatureDetails",{featureId:l,sessionId:t,trackInstanceId:n,rendererType:r});if(!c)return;const d=new a.A(c);return s?o(d,i):d}function o(e,t){const n=e.get("subfeatures");if(n)for(const e of n){if(e.id()===t)return e;const n=o(e,t);if(n)return n}}function s(e){const t=e.flatMap(e=>e.get("subfeatures")?.filter(e=>"exon"===e.get("type")||"CDS"===e.get("type"))??[]);return!(t.length<2)&&(0,r.mergeIntervals)(t.map(e=>({start:e.get("start"),end:e.get("end")})),0).length>1}function l(e){return e?function(e){return(e.get("subfeatures")??[]).some(e=>"exon"===e.get("type")||"CDS"===e.get("type"))}(e)?[e]:e.get("subfeatures")??[]:[]}function c(e,t){if(!e||!t)return!1;const n=e.getContext("2d");return!!n&&(n.resetTransform(),n.clearRect(0,0,e.width,e.height),n.drawImage(t,0,0),!0)}},98077(e,t,n){n.d(t,{n:()=>l});var r=n(60459),a=n(17378),i=n(19608),o=n(10533),s=n(89346);function l(e){return o.types.compose("LinearBareDisplay",s.L,o.types.model({type:o.types.literal("LinearBareDisplay"),configuration:(0,r.AK)(e)})).views(e=>({get rendererConfig(){return(0,a.FI)(e,["renderer"])||{}},get rendererTypeName(){return(0,a.FI)(e,["renderer","type"])}})).views(e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),...(0,i.getParentRenderProps)(e),config:e.rendererConfig})}})}},63332(e,t,n){n.r(t),n.d(t,{default:()=>f});var r=n(69566),a=n(55614),i=n(30128),o=n(23886),s=n(46625),l=n(92130),c=n(44460);const d=(0,s.n)()({container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:5},label:{position:"absolute",fontSize:11,cursor:"default",pointerEvents:"auto"},overlay:{backgroundColor:"rgba(255, 255, 255, 0.8)",lineHeight:1}}),u=(0,i.memo)(function(e){const t=(0,a.c)(10),{text:n,color:r,isOverlay:i,featureLeftPx:o,featureId:s,subfeatureId:l,y:d,tooltip:u,labelClass:p,overlayClass:h}=e,g=i?`${p} ${h}`:p,f=`translate(calc(${o}px - var(--offset-px)), ${d}px)`;let m,y;return t[0]!==r||t[1]!==f?(m={color:r,transform:f},t[0]=r,t[1]=f,t[2]=m):m=t[2],t[3]!==s||t[4]!==l||t[5]!==g||t[6]!==m||t[7]!==n||t[8]!==u?(y=(0,c.jsx)("div",{"data-feature-id":s,"data-subfeature-id":l,"data-tooltip":u,className:g,style:m,children:n}),t[3]=s,t[4]=l,t[5]=g,t[6]=m,t[7]=n,t[8]=u,t[9]=y):y=t[9],y});function p(e){const t=(0,a.c)(15),{text:n,color:r,isOverlay:i,featureLeftPx:o,featureRightPx:s,featureId:d,subfeatureId:u,labelWidth:p,y:h,offsetPx:g,tooltip:f,labelClass:m,overlayClass:y}=e;let b;t[0]!==o||t[1]!==s||t[2]!==p||t[3]!==g?(b=(0,l.mJ)(o,s,p,g),t[0]=o,t[1]=s,t[2]=p,t[3]=g,t[4]=b):b=t[4];const w=i?`${m} ${y}`:m,v=`translate(${b}px,${h}px)`;let S,x;return t[5]!==r||t[6]!==v?(S={color:r,transform:v},t[5]=r,t[6]=v,t[7]=S):S=t[7],t[8]!==d||t[9]!==u||t[10]!==w||t[11]!==S||t[12]!==n||t[13]!==f?(x=(0,c.jsx)("div",{"data-feature-id":d,"data-subfeature-id":u,"data-tooltip":f,className:w,style:S,children:n}),t[8]=d,t[9]=u,t[10]=w,t[11]=S,t[12]=n,t[13]=f,t[14]=x):x=t[14],x}const h=(0,r.observer)(function({model:e}){const{classes:t}=d(),n=(0,o.getContainingView)(e),{offsetPx:r}=n,a=e.floatingLabelData,{onFeatureClick:i,onFeatureContextMenu:s,onMouseMove:l}=e.renderingProps(),h=[],g=[];for(const[e,{leftPx:n,topPx:i,totalFeatureHeight:o,floatingLabels:s,featureWidth:l}]of a.entries()){const a=i+o,d=n+l;for(let i=0,o=s.length;i<o;i++){const o=s[i],{text:f,relativeY:m,color:y,isOverlay:b,textWidth:w,parentFeatureId:v,subfeatureId:S,tooltip:x}=o,k=a+m,C=`${e}-${i}`,T=v??e;w>l?h.push((0,c.jsx)(u,{text:f,color:y,isOverlay:b??!1,featureLeftPx:n,featureId:T,subfeatureId:S,y:k,tooltip:x,labelClass:t.label,overlayClass:t.overlay},C)):g.push((0,c.jsx)(p,{text:f,color:y,isOverlay:b??!1,featureLeftPx:n,featureRightPx:d,featureId:T,subfeatureId:S,labelWidth:w,y:k,offsetPx:r,tooltip:x,labelClass:t.label,overlayClass:t.overlay},C))}}return(0,c.jsxs)("div",{className:t.container,style:{"--offset-px":`${r}px`},onClick:e=>{const t=e.target,n=t.dataset.subfeatureId??t.dataset.featureId;n&&i?.(e,n)},onContextMenu:e=>{const t=e.target,n=t.dataset.subfeatureId??t.dataset.featureId;n&&s?.(e,n)},onMouseOver:t=>{const n=t.target,r=n.dataset.featureId;if(r){const a=n.dataset.tooltip,i=n.dataset.subfeatureId;l?.(t,r,a),e.setSubfeatureIdUnderMouse(i)}},children:[h,g]})});var g=n(83826);const f=(0,r.observer)(function(e){const{model:t}=e;return(0,c.jsx)(g.Ay,{model:t,children:(0,c.jsx)(h,{model:t})})})},90705(e,t,n){n.d(t,{A:()=>i});var r=n(60459),a=n(77529);const i=function(e){return(0,r.S7)("LinearBasicDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:a.A,explicitlyTyped:!0})}},31707(e,t,n){n.d(t,{A:()=>y});var r=n(30128),a=n(60459),i=n(17378),o=n(71392),s=n(23886),l=n(43102),c=n(19608),d=n(10533),u=n(56721),p=n(78749),h=n(44934),g=n(89346);const f=(0,r.lazy)(()=>n.e(4286).then(n.bind(n,54286))),m=(0,r.lazy)(()=>n.e(187).then(n.bind(n,10187))),y=function(e){return d.types.compose("LinearFeatureDisplay",g.L,d.types.model({type:d.types.literal("LinearFeatureDisplay"),trackShowLabels:d.types.maybe(d.types.boolean),trackShowDescriptions:d.types.maybe(d.types.boolean),trackDisplayMode:d.types.maybe(d.types.string),trackMaxHeight:d.types.maybe(d.types.number),configuration:(0,a.AK)(e),jexlFiltersSetting:d.types.maybe(d.types.array(d.types.string))})).volatile(()=>({featureUnderMouseVolatile:void 0})).views(e=>({activeFilters:()=>(0,h.toJS)(e.jexlFiltersSetting)??(0,i.FI)(e,"jexlFilters").map(e=>`jexl:${e}`),get rendererTypeName(){return(0,i.FI)(e,["renderer","type"])},get sequenceAdapter(){const{assemblyManager:t}=(0,s.getSession)(e),n=(0,d.getParent)(e,2),r=(0,i.QZ)(n.configuration,"assemblyNames"),a=t.get(r[0]);return a?(0,i.FI)(a,["sequence","adapter"]):void 0},get showLabels(){return e.trackShowLabels??(0,i.FI)(e,["renderer","showLabels"])},get showDescriptions(){return e.trackShowDescriptions??(0,i.FI)(e,["renderer","showDescriptions"])},get maxHeight(){return e.trackMaxHeight??(0,i.FI)(e,["renderer","maxHeight"])},get displayMode(){return e.trackDisplayMode??(0,i.FI)(e,["renderer","displayMode"])}})).views(e=>({get rendererConfig(){const t=(0,i.FI)(e,["renderer"])||{};return{...t,showLabels:e.trackShowLabels??t.showLabels,showDescriptions:e.trackShowDescriptions??t.showDescriptions,displayMode:e.trackDisplayMode??t.displayMode,maxHeight:e.trackMaxHeight??t.maxHeight}}})).actions(e=>({setJexlFilters(t){e.jexlFiltersSetting=(0,d.cast)(t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},toggleShowLabels(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode(t){e.trackDisplayMode=t},setMaxHeight(t){e.trackMaxHeight=t}})).views(e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile}})).views(e=>{const{renderProps:t,renderingProps:n}=e;return{renderProps:()=>({...t(),config:e.rendererConfig,filters:new o.A({filters:e.activeFilters()}),sequenceAdapter:e.sequenceAdapter}),renderingProps(){const t=n(),r=(0,s.getSession)(e);return{...t,async onFeatureClick(t,n){const{rpcManager:a}=r,{parentTrack:i}=e;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,c.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,trackInstanceId:i.id,rendererType:e.rendererTypeName});(0,d.isAlive)(e)&&r&&e.selectFeature(new l.A(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notifyError(`${e}`,e)}},async onFeatureContextMenu(t,n){const{rpcManager:a}=r,{parentTrack:i}=e;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,c.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,trackInstanceId:i.id,rendererType:e.rendererTypeName});(0,d.isAlive)(e)&&r&&e.setContextMenuFeature(new l.A(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notifyError(`${e}`,e)}}}},filterMenuItems:()=>[{label:"Edit filters...",onClick:()=>{(0,s.getSession)(e).queueDialog(t=>[m,{model:e,handleClose:t}])}}]}}).views(e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Show...",icon:p.A,subMenu:[{label:"Show tooltips",type:"checkbox",checked:e.showTooltipsEnabled,onClick:()=>{e.setShowTooltips(!e.showTooltipsEnabled)}},{label:"Show labels",type:"checkbox",checked:e.showLabels,onClick:()=>{e.toggleShowLabels()}},{label:"Show descriptions",type:"checkbox",checked:e.showDescriptions,onClick:()=>{e.toggleShowDescriptions()}}]},{label:"Display mode",icon:p.A,subMenu:["normal","compact","reducedRepresentation","collapse"].map(t=>({label:t,type:"radio",checked:e.displayMode===t,onClick:()=>{e.setDisplayMode(t)}}))},{label:"Set max track height",onClick:()=>{(0,s.getSession)(e).queueDialog(t=>[f,{model:e,handleClose:t}])}},{label:"Filter by...",icon:u.A,subMenu:e.filterMenuItems()}]}}).actions(e=>({afterAttach(){(0,d.addDisposer)(e,(0,h.reaction)(()=>e.featureIdUnderMouse,async t=>{if(!t)return void e.setFeatureUnderMouse(void 0);const n=(0,s.getSession)(e),{rpcManager:r}=n,{parentTrack:a}=e;try{const n=(0,c.getRpcSessionId)(e),{feature:i}=await r.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,trackInstanceId:a.id,rendererType:e.rendererTypeName});(0,d.isAlive)(e)&&i&&e.featureIdUnderMouse===t&&e.setFeatureUnderMouse(new l.A(i))}catch(e){}},{delay:50,name:"LinearFeatureDisplayMouseoverReaction"}))}})).postProcessSnapshot(e=>{if(!e)return e;const{trackShowLabels:t,trackShowDescriptions:n,trackDisplayMode:r,trackMaxHeight:a,jexlFiltersSetting:i,...o}=e;return{...o,...void 0!==t?{trackShowLabels:t}:{},...void 0!==n?{trackShowDescriptions:n}:{},...void 0!==r?{trackDisplayMode:r}:{},...void 0!==a?{trackMaxHeight:a}:{},...i?.length?{jexlFiltersSetting:i}:{}}})}},75516(e,t,n){n.d(t,{A:()=>p});var r=n(23886),a=n(69566),i=n(9439),o=n(3948),s=n(44460);function l(e,t,n,r,a){return`M${e},${t}h${n-a}a${a},${a} 0 0 1 ${a},${a}v${r-2*a}a${a},${a} 0 0 1 ${-a},${a}h${a-n}z`}function c(e,t,n,r){return[[e,0],[e+n,r/2],[e,r]].toString()}function d(e,t,n,r){return[[e,r/2],[e+n,0],[e+n,r]].toString()}const u={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos33:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos66:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},p=(0,a.observer)(function({overview:e,block:t,assembly:n}){const{offsetPx:a,reversed:p}=t,h=(0,i.S5)(n,t.refName),g=p?h.length-1:0,f=p?0:h.length-1,m=o.Gu;let y=!1,b="",w=0;return(0,s.jsx)("g",{transform:`translate(-${a})`,children:h.map((t,n)=>{const a=JSON.stringify(t),{refName:i,name:o,type:h,start:v,end:S}=t,x=e.bpToPx({refName:i,coord:v})||0,k=e.bpToPx({refName:i,coord:S})||0,C=Math.min(x,k),T=Math.abs(k-x);if("n/a"===h){const e=o?.match(/^(\d+)([A-Za-z])/),t=e[1]+e[2];t&&t!==b&&(b=t,w++)}const A="n/a"===h?w%2?"black":"#a77":u[h]||"black";return"acen"!==h||y?"acen"===h&&y?(0,s.jsx)("polygon",{points:p?c(x-T,0,T,m):d(x,0,T,m),...(0,r.getFillProps)(A)},a):g===n?(0,s.jsx)("path",{d:(M=C,I=T,P=m,`M${M+8},0h${I-8}v${P}h${8-I}a8,8 0 0 1 -8,-8v${16-P}a8,8 0 0 1 8,-8z`),...(0,r.getFillProps)(A)},a):f===n?(0,s.jsx)("path",{d:l(C,0,T,m,8),...(0,r.getFillProps)(A)},a):(0,s.jsx)("rect",{x:C,y:0,width:T,height:m,...(0,r.getFillProps)(A)},a):(y=!0,(0,s.jsx)("polygon",{points:p?d(x-T,0,T,m):c(x,0,T,m),...(0,r.getFillProps)(A)},a));var M,I,P})})})},24570(e,t,n){n.r(t),n.d(t,{default:()=>Le});var r=n(30128),a=n(51049),i=n(69566),o=n(10732),s=n(23886),l=n(46625),c=n(69301),d=n(62088),u=n(35864),p=n(95360),h=n(64261),g=n(10533),f=n(55614),m=n(24155),y=n(5456),b=n(44460);const w=(0,l.n)()(e=>({verticalGuidesZoomContainer:{position:"absolute",top:0,height:"100%",width:"100%",pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.action.disabled},minorTick:{background:e.palette.divider}}));function v(e){const t=(0,f.c)(22),{block:n,bpPerPx:r}=e,{classes:a}=w(),{start:i,end:o,reversed:s}=n;let l,c,d,u;if(t[0]!==n||t[1]!==r||t[2]!==a.majorTick||t[3]!==a.minorTick||t[4]!==a.tick||t[5]!==o||t[6]!==s||t[7]!==i){const e=(0,y.H2)(i,o,r),u=`${a.tick} ${a.majorTick}`,p=`${a.tick} ${a.minorTick}`;let h;l=m.$G,c=n,t[11]!==r||t[12]!==o||t[13]!==u||t[14]!==p||t[15]!==s||t[16]!==i?(h=e=>{const{type:t,base:n}=e,a=(s?o-n:n-i)/r;return(0,b.jsx)("div",{className:"major"===t||"labeledMajor"===t?u:p,style:{left:a}},n)},t[11]=r,t[12]=o,t[13]=u,t[14]=p,t[15]=s,t[16]=i,t[17]=h):h=t[17],d=e.map(h),t[0]=n,t[1]=r,t[2]=a.majorTick,t[3]=a.minorTick,t[4]=a.tick,t[5]=o,t[6]=s,t[7]=i,t[8]=l,t[9]=c,t[10]=d}else l=t[8],c=t[9],d=t[10];return t[18]!==l||t[19]!==c||t[20]!==d?(u=(0,b.jsx)(l,{block:c,children:d}),t[18]=l,t[19]=c,t[20]=d,t[21]=u):u=t[21],u}const S=(0,i.observer)(function({model:e}){const{staticBlocks:t,bpPerPx:n}=e;return(0,b.jsx)(b.Fragment,{children:t.map((e,t)=>{const r=`${e.key}-${t}`;return"ContentBlock"===e.type?(0,b.jsx)(v,{block:e,bpPerPx:n},r):"ElidedBlock"===e.type?(0,b.jsx)(m.Db,{width:e.widthPx},r):"InterRegionPaddingBlock"===e.type?(0,b.jsx)(m.fK,{width:e.widthPx,boundary:"boundary"===e.variant},r):null})})}),x=(0,i.observer)(function({model:e,offset:t=0}){const{classes:n}=w(),{staticBlocks:r,scaleFactor:a,offsetPx:i}=e,o=r.offsetPx-i;return(0,b.jsx)("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==a?`scaleX(${a})`:void 0},children:(0,b.jsx)("div",{className:n.verticalGuidesContainer,style:{left:o-t,width:r.totalWidthPx},children:(0,b.jsx)(S,{model:e})})})});var k=n(37472),C=n(19608),T=n(20449),A=n(7201),M=n(59705),I=n(54825),P=n(26038);const L=(0,l.n)()({dragHandle:{cursor:"grab"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"}}),R=function(e){const t=(0,f.c)(13),{trackId:n,view:r,track:a}=e,{classes:i}=L();let o,s;t[0]!==a||t[1]!==r?(o=e=>{const t=e.currentTarget;if(t.parentNode){const n=t.parentNode;e.dataTransfer.setDragImage(n,20,20),r.setDraggingTrackId(a.id)}},t[0]=a,t[1]=r,t[2]=o):o=t[2],t[3]!==r?(s=()=>{r.setDraggingTrackId(void 0)},t[3]=r,t[4]=s):s=t[4];const l=`dragHandle-${r.id}-${n}`;let c,d;return t[5]!==i.dragHandleIcon?(c=(0,b.jsx)(P.A,{className:i.dragHandleIcon,fontSize:"small"}),t[5]=i.dragHandleIcon,t[6]=c):c=t[6],t[7]!==i.dragHandle||t[8]!==o||t[9]!==s||t[10]!==l||t[11]!==c?(d=(0,b.jsx)("span",{draggable:!0,className:i.dragHandle,onDragStart:o,onDragEnd:s,"data-testid":l,children:c}),t[7]=i.dragHandle,t[8]=o,t[9]=s,t[10]=l,t[11]=c,t[12]=d):d=t[12],d};var F=n(9378),D=n(11218),N=n(94759),B=n(52642),V=n(90632),E=n(4237),z=n(86631),j=n(52189),H=n(66143),_=n(59490);const $=(0,i.observer)(function({track:e}){const t=(0,s.getContainingView)(e),n=(0,s.getSession)(e),a=(0,r.useCallback)(()=>{const r=e.configuration,a=e.minimized,i=e.pinned,{isTopLevelView:o}=t,s=e.trackMenuItems(),l=s.find(e=>"label"in e&&"Save track data"===e.label),c=s.filter(e=>!("label"in e)||"Save track data"!==e.label),d=n.getTrackActionMenuItems?.(r,l?[l]:[])||[];return[{label:"Track order",icon:z.A,type:"subMenu",priority:1e3,subMenu:[...o?[{label:i?"Unpin track":"Pin track",icon:_.A,onClick:()=>{e.setPinned(!i)}}]:[],{label:a?"Restore track":"Minimize track",icon:a?D.A:j.A,onClick:()=>{e.setMinimized(!a)}},...t.tracks.length>2?[{label:"Move track to top",icon:E.A,onClick:()=>{t.moveTrackToTop(e.id)}}]:[],...t.tracks.length>1?[{label:"Move track up",icon:B.A,onClick:()=>{t.moveTrackUp(e.id)}},{label:"Move track down",icon:N.A,onClick:()=>{t.moveTrackDown(e.id)}}]:[],...t.tracks.length>2?[{label:"Move track to bottom",icon:V.A,onClick:()=>{t.moveTrackToBottom(e.id)}}]:[]]},...d,...c].sort((e,t)=>(t.priority||0)-(e.priority||0))},[e,t,n]);return(0,b.jsx)(F.A,{menuItems:a,"data-testid":"track_menu_icon",children:(0,b.jsx)(H.A,{fontSize:"small"})})}),O=(0,l.n)()(e=>({root:{zIndex:200,background:(0,A.X4)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper}},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}})),G=(0,i.observer)(function({track:e,className:t}){const{classes:n}=O(),r=(0,s.getContainingView)(e),a=(0,s.getSession)(e),{minimized:i}=e,o=e.trackId,l=(0,C.getTrackName)(e.configuration,a);return(0,b.jsxs)(c.A,{className:(0,h.cx)(t,n.root),onClick:e=>{e.stopPropagation()},children:[(0,b.jsx)(R,{track:e,trackId:o,view:r}),(0,b.jsx)(M.A,{onClick:()=>r.hideTrack(o),className:n.iconButton,title:"close this track",children:(0,b.jsx)(T.A,{fontSize:"small"})}),(0,b.jsx)(I.A,{variant:"body1",component:"span",className:n.trackName,children:(0,b.jsx)(k.A,{html:[l,i?"(minimized)":""].filter(e=>!!e).join(" ")})}),(0,b.jsx)($,{track:e})]})}),W=(0,l.n)()({trackLabel:{zIndex:2},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"}}),U=(0,i.observer)(function({track:e,view:t}){const{classes:n}=W(),r=e.displays[0],a="overlapping"!==t.trackLabelsSetting||r.prefersOffset?n.trackLabelOffset:n.trackLabelOverlap;return"hidden"!==t.trackLabelsSetting?(0,b.jsx)(G,{track:e,className:(0,h.cx)(n.trackLabel,a)}):null}),q=(0,l.n)()({renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",contain:"strict"}}),J=(0,i.observer)(function({model:e,track:t}){const{classes:n}=q(),i=t.displays[0],{height:o,RenderingComponent:s,DisplayBlurb:l}=i,{trackRefs:c,id:d,scaleFactor:u}=e,p=t.trackId,h=(0,r.useRef)(null),g=t.minimized;return(0,r.useEffect)(()=>(h.current&&(c[p]=h.current),()=>{delete c[p]}),[c,p]),(0,b.jsx)("div",{className:n.trackRenderingContainer,style:{height:g?20:o},onScroll:e=>i.setScrollTop(e.currentTarget.scrollTop),"data-testid":`trackRenderingContainer-${d}-${p}`,children:g?null:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{ref:h,className:n.renderingComponentContainer,style:{transform:1!==u?`scaleX(${u})`:void 0},children:(0,b.jsx)(r.Suspense,{fallback:(0,b.jsx)(a.A,{}),children:(0,b.jsx)(s,{model:i,onHorizontalScroll:e.horizontalScroll})})}),l?(0,b.jsx)("div",{style:{position:"absolute",left:0,top:i.height-20},children:(0,b.jsx)(l,{model:i})}):null]})})});var X=n(9439);const K=(0,l.n)()(e=>({root:{marginTop:2,overflow:"hidden",position:"relative",contain:"layout style paint"},unpinnedTrack:{background:"none"},resizeHandle:{height:4,boxSizing:"border-box",position:"relative",background:"transparent","&:hover":{background:e.palette.divider}}})),Q=(0,i.observer)(function({model:e,track:t}){const{classes:n}=K(),a=t.displays[0],{draggingTrackId:i,showTrackOutlines:o}=e,s=(0,r.useRef)(null);return(0,b.jsxs)(c.A,{ref:s,className:(0,h.cx)(n.root,t.pinned?null:n.unpinnedTrack),variant:o?"outlined":void 0,elevation:o?void 0:0,onClick:t=>{if(2===t.detail&&!a.featureIdUnderMouse){const n=s.current?.getBoundingClientRect().left||0;e.zoomTo(e.bpPerPx/2,t.clientX-n,!0)}},onDragOver:n=>{if((0,g.isAlive)(a)&&void 0!==i&&i!==a.id){const r=e.tracks.findIndex(e=>e.id===i),a=e.tracks.findIndex(e=>e.id===t.id)>r,o=n.clientY;(0,X.D7)(e.lastTrackDragY,o,a)&&(e.setLastTrackDragY(o),e.moveTrack(i,t.id))}},children:[t.pinned?(0,b.jsx)(x,{model:e,offset:1}):null,(0,b.jsx)(U,{track:t,view:e}),(0,b.jsx)(p.t,{FallbackComponent:e=>(0,b.jsx)(d.A,{error:e.error}),children:(0,b.jsx)(J,{model:e,track:t})}),(0,b.jsx)(u.A,{onDrag:a.resizeHeight,className:n.resizeHandle})]})});var Z=n(53458),Y=n(68885),ee=n(30097);const te=(0,l.n)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",left:0,background:"red",zIndex:1001},tooltipTarget:{position:"sticky",left:0,width:1}}),ne=(0,i.observer)(function({model:e,coordX:t}){const{classes:n}=te(),{stickyViewHeaders:r,rubberbandTop:a}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ee.A,{open:!0,placement:"top",title:(0,s.stringify)(e.pxToBp(t)),arrow:!0,children:(0,b.jsx)("div",{className:n.tooltipTarget,style:{transform:`translateX(${t+6}px)`,top:a,position:r?"sticky":void 0}})}),(0,b.jsx)("div",{className:n.guide,style:{transform:`translateX(${t}px)`}})]})});function re(e,t,n){const a=(0,f.c)(54),[i,o]=(0,r.useState)(),[s,l]=(0,r.useState)(),[c,d]=(0,r.useState)(),[u,p]=(0,r.useState)(),h=void 0!==i&&void 0===c;let g;a[0]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{d(void 0),o(void 0),l(void 0),p(void 0)},a[0]=g):g=a[0];const m=g;let y,b,w;a[1]!==t||a[2]!==h||a[3]!==e||a[4]!==i?(y=()=>{const n=function(t){if(e.current&&h){const n=(0,X.Pn)(t,e.current);l(n)}},r=function(n){if(void 0!==i&&e.current){const{clientX:r,clientY:a}=n,s=(0,X.Pn)(n,e.current),c=Math.abs(s-i)<=3;if(c&&t.scalebarRefNameClickPending)return o(void 0),void l(void 0);if(!c&&t.scalebarRefNameClickPending&&t.setScalebarRefNameClickPending(!1),d({offsetX:s,clientX:r,clientY:a,isClick:c}),c)p(s);else{const e=function(e){if(void 0===i)return;const n=Math.min(i,e),r=Math.max(i,e);return{leftOffset:t.pxToBp(n),rightOffset:t.pxToBp(r)}}(s);e&&t.setOffsets(e.leftOffset,e.rightOffset),p(void 0)}}};return h?(window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)}):ae},b=[i,h,t,e,m],a[1]=t,a[2]=h,a[3]=e,a[4]=i,a[5]=y,a[6]=b):(y=a[5],b=a[6]),(0,r.useEffect)(y,b),a[7]!==t||a[8]!==e||a[9]!==n?(w=function(r){if(n&&!r.shiftKey)return;if(t.isScalebarRefNameMenuOpen)return;r.preventDefault(),r.stopPropagation();const a=(0,X.Pn)(r,e.current);o(a),l(a)},a[7]=t,a[8]=e,a[9]=n,a[10]=w):w=a[10];const v=w;let S;a[11]!==c?.isClick||a[12]!==h||a[13]!==e||a[14]!==n?(S=function(t){!1!==c?.isClick&&(h?p(void 0):n?t.shiftKey?p((0,X.Pn)(t,e.current)):p(void 0):p((0,X.Pn)(t,e.current)))},a[11]=c?.isClick,a[12]=h,a[13]=e,a[14]=n,a[15]=S):S=a[15];const x=S;let k;a[16]!==c?.isClick?(k=function(){c?.isClick||p(void 0)},a[16]=c?.isClick,a[17]=k):k=a[17];const C=k;let T;a[18]===Symbol.for("react.memo_cache_sentinel")?(T=function(e,t){t(),m()},a[18]=T):T=a[18];const A=T,M=Boolean(c),I=c?.isClick;let P;a[19]!==c||a[20]!==I||a[21]!==t?(P=I?t.pxToBp(c.offsetX):void 0,a[19]=c,a[20]=I,a[21]=t,a[22]=P):P=a[22];const L=P;if(void 0===i){let e;return a[23]!==c||a[24]!==L||a[25]!==u||a[26]!==I||a[27]!==v||a[28]!==x||a[29]!==C||a[30]!==M?(e={open:M,isClick:I,clickBpOffset:L,guideX:u,mouseDown:v,mouseMove:x,mouseOut:C,handleClose:m,handleMenuItemClick:A,anchorPosition:c},a[23]=c,a[24]=L,a[25]=u,a[26]=I,a[27]=v,a[28]=x,a[29]=C,a[30]=M,a[31]=e):e=a[31],e}const R=c?c.offsetX:s||0,F=Math.min(R,i),D=Math.abs(R-i);let N;a[32]!==F||a[33]!==t?(N=t.pxToBp(F),a[32]=F,a[33]=t,a[34]=N):N=a[34];const B=N;let V;a[35]!==F||a[36]!==t||a[37]!==D?(V=t.pxToBp(F+D),a[35]=F,a[36]=t,a[37]=D,a[38]=V):V=a[38];const E=V,z=Math.ceil(D*t.bpPerPx),j=!I;let H;return a[39]!==c||a[40]!==L||a[41]!==u||a[42]!==I||a[43]!==F||a[44]!==B||a[45]!==v||a[46]!==x||a[47]!==C||a[48]!==z||a[49]!==M||a[50]!==E||a[51]!==j||a[52]!==D?(H={open:M,isClick:I,clickBpOffset:L,guideX:u,rubberbandOn:j,mouseDown:v,mouseMove:x,mouseOut:C,handleClose:m,handleMenuItemClick:A,leftBpOffset:B,rightBpOffset:E,anchorPosition:c,numOfBpSelected:z,width:D,left:F},a[39]=c,a[40]=L,a[41]=u,a[42]=I,a[43]=F,a[44]=B,a[45]=v,a[46]=x,a[47]=C,a[48]=z,a[49]=M,a[50]=E,a[51]=j,a[52]=D,a[53]=H):H=a[53],H}function ae(){}const ie=(0,l.n)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8,zIndex:825}}),oe=(0,i.observer)(function({model:e,ControlComponent:t=(0,b.jsx)("div",{})}){const n=(0,r.useRef)(null),{classes:a}=ie(),{stickyViewHeaders:i,rubberbandTop:o,isScalebarRefNameMenuOpen:s}=e,{guideX:l,rubberbandOn:c,leftBpOffset:d,rightBpOffset:u,numOfBpSelected:p,width:h,left:g,anchorPosition:f,open:m,isClick:y,clickBpOffset:w,handleMenuItemClick:v,handleClose:S,mouseMove:x,mouseDown:k,mouseOut:C}=re(n,e);return(0,b.jsxs)(b.Fragment,{children:[void 0===l||s?c?(0,b.jsx)(Y.default,{leftBpOffset:d,rightBpOffset:u,numOfBpSelected:p,width:h,left:g,top:o,sticky:i}):null:(0,b.jsx)(ne,{model:e,coordX:l}),f?(0,b.jsx)(Z.A,{anchorReference:"anchorPosition",anchorPosition:{left:f.clientX+10,top:f.clientY},onMenuItemClick:v,open:m,onClose:S,menuItems:y&&w?e.rubberbandClickMenuItems(w):e.rubberBandMenuItems()}):null,(0,b.jsx)("div",{"data-testid":"rubberband_controls",className:a.rubberbandControl,style:{top:o,position:i?"sticky":void 0},ref:n,onMouseDown:k,onMouseMove:x,onMouseOut:C,children:t})]})}),se=(0,l.n)()(e=>({block:{position:"relative",flexShrink:0,overflow:"hidden",height:13},elidedBlock:{backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},label:{fontSize:11,zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"}}));function le(e){const t=(0,f.c)(18),{block:n,bpPerPx:r}=e,{classes:a}=se();let i;if(t[0]!==n.end||t[1]!==n.reversed||t[2]!==n.start||t[3]!==n.widthPx||t[4]!==r||t[5]!==a.block||t[6]!==a.label||t[7]!==a.tick){const e=(0,y.H2)(n.start,n.end,r,!0,!1);let o,l;t[9]!==n.widthPx?(o={width:n.widthPx},t[9]=n.widthPx,t[10]=o):o=t[10],t[11]!==n.end||t[12]!==n.reversed||t[13]!==n.start||t[14]!==r||t[15]!==a.label||t[16]!==a.tick?(l=e=>{const{type:t,base:i}=e;if("major"!==t)return null;const o=(n.reversed?n.end-i:i-n.start)/r;return(0,b.jsx)("div",{className:a.tick,style:{left:o},children:(0,b.jsx)("div",{className:a.label,children:(0,s.getTickDisplayStr)(i+1,r)})},i)},t[11]=n.end,t[12]=n.reversed,t[13]=n.start,t[14]=r,t[15]=a.label,t[16]=a.tick,t[17]=l):l=t[17],i=(0,b.jsx)("div",{className:a.block,style:o,children:e.map(l)}),t[0]=n.end,t[1]=n.reversed,t[2]=n.start,t[3]=n.widthPx,t[4]=r,t[5]=a.block,t[6]=a.label,t[7]=a.tick,t[8]=i}else i=t[8];return i}const ce=(0,i.observer)(function({model:e}){const{classes:t,cx:n}=se(),{staticBlocks:r,bpPerPx:a}=e;return(0,b.jsx)("div",{style:{display:"flex"},children:r.map((e,r)=>{const i=`${e.key}-${r}`;return"ContentBlock"===e.type?(0,b.jsx)(le,{block:e,bpPerPx:a},i):"ElidedBlock"===e.type?(0,b.jsx)("div",{className:n(t.block,t.elidedBlock),style:{width:e.widthPx}},i):(0,b.jsx)("div",{className:t.block,style:{width:e.widthPx}},i)})})}),de=(0,l.n)()(e=>({refLabel:{fontSize:11,position:"absolute",left:2,top:-1,fontWeight:"bold",lineHeight:"normal",zIndex:1,background:e.palette.background.paper,cursor:"pointer",overflow:"hidden",whiteSpace:"nowrap","&:hover":{background:e.palette.grey[300]}},b0:{left:0,zIndex:100}}));function ue(e){const t=(0,f.c)(43),{model:n,menuState:r,onClose:a}=e,{displayedRegions:i}=n,{refName:o,regionNumber:s}=r,l=i.length;let c;t[0]!==i||t[1]!==n?(c=function(e,t){const r=[...i],[a]=r.splice(e,1);r.splice(t,0,a),n.setDisplayedRegions(r)},t[0]=i,t[1]=n,t[2]=c):c=t[2];const d=c;let u;t[3]!==i||t[4]!==n?(u=function(e){const t=i.filter((t,n)=>n!==e);n.setDisplayedRegions(t)},t[3]=i,t[4]=n,t[5]=u):u=t[5];const p=u;let h,g,m,y,w,v;t[6]!==d||t[7]!==s?(h=s>0?[{label:"Move left",onClick:()=>{d(s,s-1)}}]:[],t[6]=d,t[7]=s,t[8]=h):h=t[8],t[9]!==d||t[10]!==l||t[11]!==s?(g=s<l-1?[{label:"Move right",onClick:()=>{d(s,s+1)}}]:[],m=l>2&&s>0?[{label:"Move to far left",onClick:()=>{d(s,0)}}]:[],y=l>2&&s<l-1?[{label:"Move to far right",onClick:()=>{d(s,l-1)}}]:[],t[9]=d,t[10]=l,t[11]=s,t[12]=g,t[13]=m,t[14]=y):(g=t[12],m=t[13],y=t[14]),t[15]!==s||t[16]!==p?(w={label:"Remove this region from view",onClick:()=>{p(s)}},t[15]=s,t[16]=p,t[17]=w):w=t[17],t[18]!==h||t[19]!==g||t[20]!==m||t[21]!==y||t[22]!==w?(v=[...h,...g,...m,...y,w],t[18]=h,t[19]=g,t[20]=m,t[21]=y,t[22]=w,t[23]=v):v=t[23];const S=v;let x;t[24]!==a?(x=(e,t)=>{t(),a()},t[24]=a,t[25]=x):x=t[25];const k=`Focus on ${o}`;let C,T,A,M,I;return t[26]!==n||t[27]!==o?(C=()=>{n.navTo({refName:o})},t[26]=n,t[27]=o,t[28]=C):C=t[28],t[29]!==k||t[30]!==C?(T={label:k,onClick:C},t[29]=k,t[30]=C,t[31]=T):T=t[31],t[32]!==S||t[33]!==l?(A=l>1?[{label:"Actions",subMenu:S}]:[],t[32]=S,t[33]=l,t[34]=A):A=t[34],t[35]!==T||t[36]!==A?(M=[T,...A],t[35]=T,t[36]=A,t[37]=M):M=t[37],t[38]!==r.anchorEl||t[39]!==a||t[40]!==M||t[41]!==x?(I=(0,b.jsx)(Z.A,{anchorEl:r.anchorEl,open:!0,onClose:a,onMenuItemClick:x,menuItems:M}),t[38]=r.anchorEl,t[39]=a,t[40]=M,t[41]=x,t[42]=I):I=t[42],I}const pe=(0,i.observer)(function({model:e}){const{classes:t,cx:n}=de(),{staticBlocks:a,offsetPx:i,scalebarDisplayPrefix:o}=e,[s,l]=(0,r.useState)();(0,r.useEffect)(()=>{e.setIsScalebarRefNameMenuOpen(!!s)},[e,s]);let c=a.blocks.findIndex(e=>"ContentBlock"===e.type);c<0&&(c=0),a.forEach((e,t)=>{"ContentBlock"===e.type&&e.offsetPx-i<0&&(c=t)});const d=o(),u=a.blocks[0],p=new Map;for(const e of a.blocks)if("ContentBlock"===e.type&&void 0!==e.regionNumber){const t=e.offsetPx+e.widthPx,n=p.get(e.regionNumber);(void 0===n||t>n)&&p.set(e.regionNumber,t)}return(0,b.jsxs)(b.Fragment,{children:["ContentBlock"!==u?.type&&d?(0,b.jsx)("span",{className:n(t.b0,t.refLabel),children:d}):null,a.map((n,r)=>{const{offsetPx:a,isLeftEndOfDisplayedRegion:o,key:s,type:u,refName:h,regionNumber:g}=n,f=r===c,m=void 0!==g?p.get(g):void 0,y=void 0!==m?m-(f?i:a)-2:void 0;return"ContentBlock"===u&&(o||f)&&(void 0===y||y>=20)?(0,b.jsxs)("span",{style:{left:f?Math.max(0,-i):a-i-1,paddingLeft:f?0:1,maxWidth:void 0!==y&&y>0?y:void 0},className:t.refLabel,"data-testid":`refLabel-${h}`,onMouseDown:()=>{e.setScalebarRefNameClickPending(!0)},onClick:t=>{e.setScalebarRefNameClickPending(!1),l({anchorEl:t.currentTarget,refName:h,regionNumber:g})},children:[f&&d?`${d}:`:"",h]},`refLabel-${s}-${r}`):null}),s?(0,b.jsx)(ue,{model:e,menuState:s,onClose:()=>{l(void 0)}}):null]})}),he=(0,l.n)()({container:{overflow:"hidden",position:"relative"},zoomContainer:{position:"relative"},scalebar:{position:"absolute",display:"flex",pointerEvents:"none"}}),ge=(0,i.observer)(function({model:e,style:t,className:n,...r}){const{classes:a}=he(),{scaleFactor:i,staticBlocks:o,offsetPx:s}=e,l=Math.round(o.offsetPx-s);return(0,b.jsxs)(c.A,{"data-resizer":"true",className:(0,h.cx)(a.container,n),variant:"outlined",style:t,...r,children:[(0,b.jsx)(x,{model:e,offset:1}),(0,b.jsx)("div",{className:a.zoomContainer,style:{transform:1!==i?`scaleX(${i})`:void 0},children:(0,b.jsx)("div",{className:a.scalebar,style:{transform:`translateX(${l-1}px)`,width:o.totalWidthPx},children:(0,b.jsx)(ce,{model:e})})}),(0,b.jsx)(pe,{model:e})]})});var fe=n(3948);function me(){}function ye(){}const be=(0,r.lazy)(()=>n.e(4348).then(n.bind(n,64348))),we=(0,r.lazy)(()=>n.e(5581).then(n.bind(n,45581))),ve=(0,r.lazy)(()=>Promise.resolve().then(n.bind(n,68885))),Se=(0,l.n)()({tracksContainer:{position:"relative",contain:"layout style"}}),xe=(0,i.observer)(function({children:e,model:t}){const{classes:n}=Se(),{pluginManager:a}=(0,s.getEnv)(t),{mouseDown:i,mouseUp:o}=function(e){const t=(0,f.c)(6),[n,a]=(0,r.useState)(!1),i=(0,r.useRef)(!1),o=(0,r.useRef)(0);let s,l,c;t[0]!==e||t[1]!==n?(s=()=>{let t=me;const r=function(t){t.preventDefault();const n=t.clientX-o.current;n&&(i.current||(i.current=!0,window.requestAnimationFrame(()=>{e.horizontalScroll(-n),i.current=!1,o.current=t.clientX})))},s=function(){o.current=0,n&&a(!1)};return n&&(window.addEventListener("mousemove",r,!0),window.addEventListener("mouseup",s,!0),t=()=>{window.removeEventListener("mousemove",r,!0),window.removeEventListener("mouseup",s,!0)}),t},l=[e,n],t[0]=e,t[1]=n,t[2]=s,t[3]=l):(s=t[2],l=t[3]),(0,r.useEffect)(s,l),t[4]===Symbol.for("react.memo_cache_sentinel")?(c=function(e){if(e.shiftKey)return;const t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(o.current=e.clientX,a(!0))},t[4]=c):c=t[4];const d=c;let u;return t[5]===Symbol.for("react.memo_cache_sentinel")?(u={mouseDown:d,mouseUp:function(e){e.preventDefault(),a(!1)}},t[5]=u):u=t[5],u}(t),{stickyViewHeaders:l,rubberbandTop:c,showGridlines:d,showCenterLine:u,isScalebarRefNameMenuOpen:p}=t,h=(0,r.useRef)(null),{guideX:g,rubberbandOn:m,leftBpOffset:y,rightBpOffset:w,numOfBpSelected:v,width:S,left:k,anchorPosition:C,open:T,isClick:A,clickBpOffset:M,handleMenuItemClick:I,handleClose:P,mouseMove:L,mouseDown:R}=re(h,t,!0);!function(e,t){const n=(0,f.c)(4),a=(0,r.useRef)(0),i=(0,r.useRef)(0),o=(0,r.useRef)(null),l=(0,r.useRef)(0),c=(0,r.useRef)(!1);let d,u;n[0]!==t||n[1]!==e?(d=()=>{let n=[];const r=e.current,d=function(e){if(e.ctrlKey){e.preventDefault(),n.push(e.deltaY);const i=Math.abs((0,s.sum)(n))/n.length,l=i<6?25:i>30?i>150?500:150:75;a.current=a.current+e.deltaY/l,t.setScaleFactor(a.current<0?1-a.current:1/(1+a.current)),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{t.setScaleFactor(1),t.zoomTo(a.current>0?t.bpPerPx*(1+a.current):t.bpPerPx/(1-a.current),e.clientX-(r?.getBoundingClientRect().left||0)),a.current=0,n=[]},300)}else Math.abs(e.deltaX)>Math.abs(2*e.deltaY)&&e.preventDefault(),i.current=i.current+e.deltaX,c.current||(c.current=!0,l.current=window.requestAnimationFrame(()=>{t.horizontalScroll(i.current),i.current=0,c.current=!1}))};return r?(r.addEventListener("wheel",d,{passive:!1}),()=>{r.removeEventListener("wheel",d),o.current&&clearTimeout(o.current),l.current&&cancelAnimationFrame(l.current)}):ye},u=[t,e],n[0]=t,n[1]=e,n[2]=d,n[3]=u):(d=n[2],u=n[3]),(0,r.useEffect)(d,u)}(h,t);const F=a.evaluateExtensionPoint("LinearGenomeView-TracksContainerComponent",void 0,{model:t});return(0,b.jsxs)("div",{ref:h,"data-testid":"tracksContainer",className:n.tracksContainer,onMouseDown:e=>{i(e),R(e)},onMouseMove:L,onMouseUp:o,children:[d?(0,b.jsx)(x,{model:t}):null,(0,b.jsx)(r.Suspense,{fallback:null,children:u?(0,b.jsx)(be,{model:t}):null}),void 0===g||p?m?(0,b.jsx)(r.Suspense,{fallback:null,children:(0,b.jsx)(ve,{leftBpOffset:y,rightBpOffset:w,numOfBpSelected:v,width:S,left:k,top:c,sticky:l})}):null:(0,b.jsx)(ne,{model:t,coordX:g}),t.volatileGuides.map((e,n)=>(0,b.jsx)(ne,{model:t,coordX:e.xPos},n)),C?(0,b.jsx)(Z.A,{anchorReference:"anchorPosition",anchorPosition:{left:C.clientX,top:C.clientY},onMenuItemClick:I,open:T,onClose:P,menuItems:A&&M?t.rubberbandClickMenuItems(M):t.rubberBandMenuItems()}):null,(0,b.jsx)(oe,{model:t,ControlComponent:(0,b.jsx)(ge,{model:t,style:{height:fe.jE,boxSizing:"border-box"}})}),(0,b.jsx)(ke,{model:t}),F,e]})}),ke=(0,i.observer)(function({model:e}){return e.highlight.length?(0,b.jsx)(r.Suspense,{fallback:null,children:e.highlight.map((t,n)=>(0,b.jsx)(we,{model:e,highlight:t},`${JSON.stringify(t)}-${n}`))}):null}),Ce=xe,Te=(0,r.lazy)(()=>n.e(7582).then(n.bind(n,77582))),Ae=(0,l.n)()(e=>({header:{background:e.palette.background.paper,top:o.VIEW_HEADER_HEIGHT,zIndex:850},pinnedTracks:{position:"sticky",zIndex:3},rel:{position:"relative"}})),Me=(0,i.observer)(function({model:e}){const{pinnedTracks:t,stickyViewHeaders:n,pinnedTracksTop:a,tracks:i,unpinnedTracks:o}=e,{classes:l}=Ae(),d=(0,s.getSession)(e),u=(0,r.useRef)(null),p=e.MiniControlsComponent(),h=e.HeaderComponent();return(0,r.useEffect)(()=>{function t(t){t.target instanceof Element&&u.current?.contains(t.target)&&d.setFocusedViewId?.(e.id)}return document.addEventListener("mousedown",t),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",t)}},[d,e]),(0,b.jsxs)("div",{className:l.rel,ref:u,onMouseLeave:()=>{d.setHovered(void 0)},onMouseMove:t=>{const n=u.current;if(!n)return;const{tracks:r}=e,a=t.clientX-n.getBoundingClientRect().left,i=e.pxToBp(a),o=r.find(e=>e.displays[0].featureUnderMouse);d.setHovered({hoverPosition:i,hoverFeature:o})},children:[(0,b.jsxs)("div",{className:l.header,style:{position:n?"sticky":void 0},children:[(0,b.jsx)(h,{model:e}),(0,b.jsx)(p,{model:e})]}),(0,b.jsx)(Ce,{model:e,children:i.length?(0,b.jsxs)(b.Fragment,{children:[t.length?(0,b.jsx)(c.A,{elevation:6,className:l.pinnedTracks,style:{top:a},children:t.map(t=>(0,b.jsx)(Q,{model:e,track:t},t.id))}):null,o.map(t=>(0,b.jsx)(Q,{model:e,track:t},t.id))]}):(0,b.jsx)(r.Suspense,{fallback:null,children:(0,b.jsx)(Te,{model:e})})})]})}),Ie=Me,Pe=(0,r.lazy)(()=>Promise.all([n.e(9186),n.e(399)]).then(n.bind(n,40399))),Le=(0,i.observer)(function({model:e}){const{showLoading:t,showImportForm:n,loadingMessage:r}=e;return t?(0,b.jsx)(a.A,{variant:"h6",message:r}):n?(0,b.jsx)(Pe,{model:e}):(0,b.jsx)(Ie,{model:e})})},7663(e,t,n){n.d(t,{A:()=>c});var r=n(23886),a=n(7201),i=n(87377),o=n(69566),s=n(3948),l=n(44460);const c=(0,o.observer)(function({model:e,overview:t,useOffset:n=!0}){const o=(0,i.A)().palette.tertiary.light,c=Number(n),{interRegionPaddingWidth:d,offsetPx:u,dynamicBlocks:p,cytobandOffset:h}=e,{contentBlocks:g,totalWidthPxWithoutBorders:f}=p;if(!g.length)return null;const m=g.at(0),y=g.at(-1),b=(t.bpToPx({refName:m.refName,coord:m.reversed?m.end:m.start})||0)+h*c,w=(t.bpToPx({refName:y.refName,coord:y.reversed?y.start:y.end})||0)+h*c,v=Math.max(0,-u),S=v+f+g.length*d/2,x=[[v,s.Ij],[S,s.Ij],[w,0],[b,0]];return(0,l.jsx)("polygon",{points:x.toString(),...(0,r.getFillProps)((0,a.X4)(o,.3)),...(0,r.getStrokeProps)((0,a.X4)(o,.8))})})},34870(e,t,n){n.d(t,{A:()=>p});var r=n(30128),a=n(34732),i=n(23886),o=n(92811),s=n(69566),l=n(55614),c=n(23149),d=n(44460);function u(e){const t=(0,l.c)(23),{TextFieldProps:n,inputBoxVal:r,params:a,setInputValue:i,setCurrentSearch:o}=e,{helperText:s,slotProps:u}=n;let p;t[0]!==u?(p=void 0===u?{}:u,t[0]=u,t[1]=p):p=t[1];const h=p;let g,f,m,y,b,w,v;if(t[2]!==a.InputProps?(({ref:g,...f}=a.InputProps),t[2]=a.InputProps,t[3]=g,t[4]=f):(g=t[3],f=t[4]),t[5]!==a){const{InputProps:e,...n}=a;m=n,t[5]=a,t[6]=m}else m=t[6];return t[7]!==r||t[8]!==i?(y=()=>{i(r)},t[7]=r,t[8]=i,t[9]=y):y=t[9],t[10]!==f||t[11]!==h.input?(b={input:{...f,...h.input}},t[10]=f,t[11]=h.input,t[12]=b):b=t[12],t[13]!==o?(w=e=>{o(e.target.value)},t[13]=o,t[14]=w):w=t[14],t[15]!==n||t[16]!==s||t[17]!==g||t[18]!==m||t[19]!==y||t[20]!==b||t[21]!==w?(v=(0,d.jsx)(c.A,{onBlur:y,...m,...n,inputRef:g,size:"small",helperText:s,slotProps:b,placeholder:"Search for location",onChange:w}),t[15]=n,t[16]=s,t[17]=g,t[18]=m,t[19]=y,t[20]=b,t[21]=w,t[22]=v):v=t[22],v}const p=(0,s.observer)(function({model:e,onSelect:t,assemblyName:n,style:s,fetchResults:l,onChange:c,value:p,minWidth:h=200,maxWidth:g=550,TextFieldProps:f={}}){const m=(0,i.getSession)(e),{assemblyManager:y}=m,[b,w]=(0,r.useState)(!1),[v,S]=(0,r.useState)(!0),[x,k]=(0,r.useState)(""),[C,T]=(0,r.useState)(""),[A,M]=(0,r.useState)(),I=(0,i.useDebounce)(x,50),P=n?y.get(n):void 0,{coarseVisibleLocStrings:L,hasDisplayedRegions:R}=e;(0,r.useEffect)(()=>{const e={cancelled:!1};return(async()=>{try{if(""===I||!n)return;S(!1);const t=await l(I);e.cancelled||M(function(e){return Object.entries(function(e){const t={};for(const n of e){const e=n.getDisplayString();t[e]||(t[e]=[]),t[e].push(n)}return t}(e)).map(([e,t])=>1===t.length?{result:t[0]}:{result:new a.A({displayString:e,results:t,label:e})})}(t))}catch(t){console.error(t),e.cancelled||m.notifyError(`${t}`,t)}finally{e.cancelled||S(!0)}})(),()=>{e.cancelled=!0}},[n,l,I,m]);const F=L||p||"",D=P?.regions,N=(0,r.useMemo)(()=>D?.map(e=>({result:new a.S({refName:e.refName,label:e.refName,displayString:e.refName,matchedAttribute:"refName"})}))||[],[D]);return(0,d.jsx)(o.A,{"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!n,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:{...s,width:Math.min(Math.max((0,i.measureText)(F,14)+100,h),g)},value:F,loading:!v,inputValue:C,onInputChange:(e,t)=>{T(t),c?.(t)},loadingText:"loading results",open:b,onOpen:()=>{w(!0)},onClose:()=>{w(!1),S(!0),R&&(k(""),M(void 0))},onChange:(e,r)=>{r&&n&&(t?.("string"==typeof r?new a.A({label:r}):r.result),T(F))},options:A?.length?A:N,getOptionDisabled:e=>"limitOption"===e.group,filterOptions:(e,{inputValue:t})=>function(e,t){const n=(r=e,i=t.toLocaleLowerCase(),r.filter(({result:e})=>e.getLabel().toLowerCase().includes(i)||e.matchedObject));var r,i;return[...n.slice(0,100),...n.length>100?[{group:"limitOption",result:new a.A({label:"keep typing for more results"})}]:[]]}(e,t),renderInput:e=>(0,d.jsx)(u,{params:e,inputBoxVal:F,TextFieldProps:f,setCurrentSearch:k,setInputValue:T}),getOptionLabel:e=>"string"==typeof e?e:e.result.getDisplayString()})})},68885(e,t,n){n.r(t),n.d(t,{default:()=>h});var r=n(55614),a=n(30128),i=n(23886),o=n(46625),s=n(7201),l=n(54825),c=n(30097),d=n(44460);function u(e){const t=(0,r.c)(8),{anchorEl:n,side:a,text:i}=e,o="left"===a?"left-start":"right-start";let s,l,u,p;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s=[{name:"offset",options:{offset:[-30,-10]}}],t[0]=s):s=t[0],t[1]!==n?(l={popper:{anchorEl:n,modifiers:s}},t[1]=n,t[2]=l):l=t[2],t[3]===Symbol.for("react.memo_cache_sentinel")?(u=(0,d.jsx)("span",{}),t[3]=u):u=t[3],t[4]!==o||t[5]!==l||t[6]!==i?(p=(0,d.jsx)(c.A,{title:i,open:!0,placement:o,slotProps:l,children:u}),t[4]=o,t[5]=l,t[6]=i,t[7]=p):p=t[7],p}const p=(0,o.n)()(e=>{const{tertiary:t}=e.palette;return{rubberband:{height:"100%",background:(0,s.X4)(t.light,.7),position:"absolute",left:0,zIndex:830,textAlign:"center",cursor:"crosshair"},rubberbandText:{color:e.palette.tertiary.contrastText}}});function h(e){const t=(0,r.c)(19),{leftBpOffset:n,rightBpOffset:o,numOfBpSelected:s,left:c,width:h,top:g,sticky:f}=e,m=void 0===g?0:g,y=void 0!==f&&f,{classes:b}=p(),[w,v]=(0,a.useState)(null);let S;t[0]!==w||t[1]!==n||t[2]!==o?(S=w?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{side:"left",anchorEl:w,text:(0,i.stringify)(n)}),(0,d.jsx)(u,{side:"right",anchorEl:w,text:(0,i.stringify)(o)})]}):null,t[0]=w,t[1]=n,t[2]=o,t[3]=S):S=t[3];const x=`translateX(${c}px)`;let k,C,T,A;return t[4]!==x||t[5]!==h?(k={transform:x,width:h},t[4]=x,t[5]=h,t[6]=k):k=t[6],t[7]!==b.rubberbandText||t[8]!==s||t[9]!==y||t[10]!==m?(C=s?(0,d.jsx)(l.A,{ref:v,variant:"h6",className:b.rubberbandText,style:{top:m,position:y?"sticky":void 0},children:(0,i.getBpDisplayStr)(s)}):null,t[7]=b.rubberbandText,t[8]=s,t[9]=y,t[10]=m,t[11]=C):C=t[11],t[12]!==b.rubberband||t[13]!==k||t[14]!==C?(T=(0,d.jsx)("div",{className:b.rubberband,style:k,children:C}),t[12]=b.rubberband,t[13]=k,t[14]=C,t[15]=T):T=t[15],t[16]!==S||t[17]!==T?(A=(0,d.jsxs)(d.Fragment,{children:[S,T]}),t[16]=S,t[17]=T,t[18]=A):A=t[18],A}},35573(e,t,n){n.d(t,{A:()=>x});var r=n(23886),a=n(46625),i=n(87377),o=n(7201),s=n(69566),l=n(55614),c=n(30128),d=n(28318),u=n(88653),p=n(59705),h=n(77819),g=n(44460);const f=(0,c.lazy)(()=>n.e(3381).then(n.bind(n,53381)));function m(){const e=(0,l.c)(6),[t,n]=(0,c.useState)(!1);let r,a,i,o;return e[0]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{n(!0)},e[0]=r):r=e[0],e[1]===Symbol.for("react.memo_cache_sentinel")?(a=(0,g.jsx)(p.A,{onClick:r,size:"small",children:(0,g.jsx)(d.A,{fontSize:"small"})}),e[1]=a):a=e[1],e[2]!==t?(i=t?(0,g.jsx)(c.Suspense,{fallback:null,children:(0,g.jsx)(f,{handleClose:()=>{n(!1)}})}):null,e[2]=t,e[3]=i):i=e[3],e[4]!==i?(o=(0,g.jsxs)(g.Fragment,{children:[a,i]}),e[4]=i,e[5]=o):o=e[5],o}function y(e){const t=(0,l.c)(6),{showHelp:n}=e;let r,a,i,o;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r={marginRight:7},a=(0,g.jsx)(u.A,{fontSize:"small"}),t[0]=r,t[1]=a):(r=t[0],a=t[1]),t[2]!==n?(i=n?(0,g.jsx)(m,{}):null,t[2]=n,t[3]=i):i=t[3],t[4]!==i?(o=(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(h.A,{position:"end",style:r,children:[a,i]})}),t[4]=i,t[5]=o):o=t[5],o}var b=n(34870),w=n(43463),v=n(3948);const S=(0,a.n)()({headerRefName:{minWidth:100}}),x=(0,s.observer)(function({model:e,showHelp:t=!0}){const{classes:n}=S(),a=(0,i.A)(),s=(0,r.getSession)(e),{textSearchManager:l,assemblyManager:c}=s,{assemblyNames:d,rankSearchResults:u}=e,p=d[0],h=c.get(p),f=e.searchScope(p);return(0,g.jsx)(b.A,{onSelect:async t=>{try{await async function({option:e,model:t,assemblyName:n}){const{assemblyManager:a}=(0,r.getSession)(t),i=a.get(n);e.hasLocation()?await(0,w.Kd)({option:e,model:t,assemblyName:n}):e.results?.length?t.setSearchResults(e.results,e.getLabel()):i&&await(0,w.cm)({input:e.getLabel(),assembly:i,model:t})}({model:e,assemblyName:p,option:t})}catch(t){console.error(t),(0,r.getSession)(e).notify(`${t}`,"warning")}},assemblyName:p,fetchResults:e=>(0,w.Jf)({queryString:e,searchScope:f,rankSearchResults:u,textSearchManager:l,assembly:h}),model:e,minWidth:175,TextFieldProps:{variant:"outlined",className:n.headerRefName,style:{margin:v.Es},slotProps:{input:{style:{padding:0,height:v.P5,background:(0,o.X4)(a.palette.background.paper,.8)},endAdornment:(0,g.jsx)(y,{showHelp:t})}}}})})},9439(e,t,n){function r(e,t){return e.clientX-(t?.getBoundingClientRect().left||0)}function a(e,t){return e?.cytobands?.map(t=>({refName:e.getCanonicalRefName(t.get("refName"))||t.get("refName"),start:t.get("start"),end:t.get("end"),type:t.get("gieStain"),name:t.get("name")})).filter(e=>e.refName===t)||[]}function i(e,t,n){return void 0===e||n&&t>e+30||!n&&t<e-30}n.d(t,{D7:()=>i,Pn:()=>r,S5:()=>a})},3948(e,t,n){n.d(t,{Es:()=>l,Gu:()=>a,Ij:()=>r,P5:()=>c,Rd:()=>s,i3:()=>o,jE:()=>i});const r=48,a=20,i=17,o=3,s=2,l=7,c=32},5456(e,t,n){n.d(t,{CU:()=>c,Cz:()=>l,H2:()=>s,H4:()=>d,Tn:()=>i,i3:()=>o});var r=n(23886),a=n(93949);function i(e,t,n,r=0,a=1/0){const i=(t-e)*n;return{start:Math.max(r,e-i),end:Math.min(a,t+i)}}function o(e,t,n){const r=t*(e=Math.abs(e));let a=10**+r.toExponential().split(/e/i)[1];for(;a<r&&(a*=2,!(a>=r));)a*=2.5;a=Math.max(a,5);const i=a/e;let o=0;return!(a%10)&&i/10>=n?o=a/10:!(a%5)&&i/5>=n?o=a/5:!(a%2)&&i/2>=n&&(o=a/2),{majorPitch:a,minorPitch:o}}function s(e,t,n,r=!0,a=!0){const i=o(n,60,15);let s=e,l=t;n<0&&([s,l]=[l,s]),s-=Math.abs(20*n)-1,l+=Math.abs(20*n)+1;const c=i.minorPitch||i.majorPitch;let d=0;const u=[];for(let e=Math.floor(s/c)*c;e<Math.ceil(l/c)*c+1;e+=c)a&&e%(2*i.majorPitch)?(u.push({type:"minor",base:e-1,index:d}),d+=1):!r||e%(2*i.majorPitch)||(u.push({type:"major",base:e-1,index:d}),d+=1);return u}async function l({regions:e,assemblyManager:t,assemblyName:n,grow:r}){return Promise.all(e.map(async e=>{const a=e.assemblyName||n;if(!a)throw new Error("no assembly provided");const o=await t.waitForAssembly(a),{refName:s}=e;if(!o)throw new Error(`assembly ${a} not found`);const{regions:l}=o;if(!l)throw new Error(`regions not loaded yet for ${a}`);const c=o.getCanonicalRefName(e.refName);if(!c)throw new Error(`Could not find refName ${s} in ${o.name}`);const d=l.find(e=>e.refName===c);if(!d)throw new Error(`Could not find refName ${s} in ${a}`);const{start:u,end:p}=e,h=r&&void 0!==u&&void 0!==p?i(u,p,r):void 0;return{...e,...h?{start:h.start,end:h.end}:{},assemblyName:a,parentRegion:d}}))}function c(e,t,n){const r=e.split(/(\s+)/).map(e=>e.trim()).filter(e=>!!e);try{return r.map(e=>(0,a.f)(e,e=>n(e,t)))}catch(e){const[i,o,s]=r;if(/Unknown feature or sequence/.exec(`${e}`)&&Number.isInteger(+o)&&Number.isInteger(+s))return[(0,a.f)(`${i}:${o}..${s}`,e=>n(e,t))];throw e}}function d(e){if(e.length){const t=e.every(t=>t.assemblyName===e[0].assemblyName);return e.map(e=>(0,r.assembleLocString)({refName:e.refName,start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName,reversed:e.reversed})).join(" ")}return""}},36832(e,t,n){n.d(t,{LinearBasicDisplayComponent:()=>mt.default,Ay:()=>yt});var r=n(36082),a=n(60459),i=n(16640),o=n(10533),s=n(36246),l=n(83826),c=n(89346),d=n(77529),u=n(88237),p=n(5431),h=n(8175);var g=n(50492);function f(e){return(0,a.S7)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:d.A,explicitlyTyped:!0})}var m=n(98077),y=n(30128),b=n(90705),w=n(17378),v=n(31707);const S=function(e){return o.types.compose("LinearBasicDisplay",(0,v.A)(e),o.types.model({type:o.types.literal("LinearBasicDisplay"),trackGeneGlyphMode:o.types.maybe(o.types.string),trackSubfeatureLabels:o.types.maybe(o.types.string),trackDisplayDirectionalChevrons:o.types.maybe(o.types.boolean),configuration:(0,a.AK)(e)})).views(e=>({get geneGlyphMode(){return e.trackGeneGlyphMode??(0,w.FI)(e,["renderer","geneGlyphMode"])},get subfeatureLabels(){return e.trackSubfeatureLabels??(0,w.FI)(e,["renderer","subfeatureLabels"])},get displayDirectionalChevrons(){return e.trackDisplayDirectionalChevrons??(0,w.FI)(e,["renderer","displayDirectionalChevrons"])}})).views(e=>({get rendererConfig(){const t=(0,w.FI)(e,["renderer"])||{};return{...t,showLabels:e.trackShowLabels??t.showLabels,showDescriptions:e.trackShowDescriptions??t.showDescriptions,subfeatureLabels:e.trackSubfeatureLabels??t.subfeatureLabels,displayMode:e.trackDisplayMode??t.displayMode,maxHeight:e.trackMaxHeight??t.maxHeight,geneGlyphMode:e.trackGeneGlyphMode??t.geneGlyphMode,displayDirectionalChevrons:e.trackDisplayDirectionalChevrons??t.displayDirectionalChevrons}}})).actions(e=>({setGeneGlyphMode(t){e.trackGeneGlyphMode=t},setSubfeatureLabels(t){e.trackSubfeatureLabels=t},toggleDisplayDirectionalChevrons(){e.trackDisplayDirectionalChevrons=!e.displayDirectionalChevrons}})).views(e=>{const{filterMenuItems:t}=e;return{filterMenuItems(){const n=e.activeFilters();return[{label:"Show only genes",type:"checkbox",checked:n.includes("jexl:get(feature,'type')=='gene'"),onClick:()=>{const t="jexl:get(feature,'type')=='gene'";n.includes(t)?e.setJexlFilters(n.filter(e=>e!==t)):e.setJexlFilters([...n,t])}},...t()]}}}).views(e=>{const{trackMenuItems:t}=e;return{trackMenuItems(){const n=t(),r=function(e){return e.find(e=>"label"in e&&"Show..."===e.label)}(n);return r&&(r.subMenu=[...r.subMenu,{label:"Show chevrons",type:"checkbox",checked:e.displayDirectionalChevrons,onClick:()=>{e.toggleDisplayDirectionalChevrons()}},{label:"Subfeature labels",subMenu:["none","below","overlay"].map(t=>({label:t,type:"radio",checked:e.subfeatureLabels===t,onClick:()=>{e.setSubfeatureLabels(t)}}))},{label:"Gene glyph",subMenu:[{value:"all",label:"All transcripts"},{value:"longest",label:"Longest transcript"},{value:"longestCoding",label:"Longest coding transcript"}].map(({value:t,label:n})=>({label:n,type:"radio",checked:e.geneGlyphMode===t,onClick:()=>{e.setGeneGlyphMode(t)}}))}]),n}}}).postProcessSnapshot(e=>{if(!e)return e;const{trackGeneGlyphMode:t,trackSubfeatureLabels:n,trackDisplayDirectionalChevrons:r,...a}=e;return{...a,...void 0!==t?{trackGeneGlyphMode:t}:{},...void 0!==n?{trackSubfeatureLabels:n}:{},...void 0!==r?{trackDisplayDirectionalChevrons:r}:{}}})};var x=n(55614),k=n(9378),C=n(23886),T=n(46625),A=n(66143),M=n(68325),I=n(88216),P=n(30097),L=n(59705),R=n(3511),F=n(69566),D=n(44460);const N=(0,y.lazy)(()=>n.e(4594).then(n.bind(n,74594))),B=(0,T.n)()(e=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:100,color:e.palette.text.secondary}}));function V(e){const t=(0,x.c)(4),{children:n,open:r,value:a}=e;let i;return t[0]!==n||t[1]!==r||t[2]!==a?(i=(0,D.jsx)(P.A,{open:r,enterTouchDelay:0,placement:"top",title:a,arrow:!0,children:n}),t[0]=n,t[1]=r,t[2]=a,t[3]=i):i=t[3],i}const E=(0,F.observer)(function({model:e}){const{classes:t}=B(),{width:n,maxBpPerPx:r,minBpPerPx:a,bpPerPx:i,effectiveBpPerPx:o}=e,[s,l]=(0,y.useState)(100*-Math.log2(i));(0,y.useEffect)(()=>{l(100*-Math.log2(o))},[o]);const c=o<=a+1e-4,d=o>=r-1e-4;return(0,D.jsxs)("div",{className:t.container,children:[(0,D.jsx)(P.A,{title:"Zoom out 2x",children:(0,D.jsx)("span",{children:(0,D.jsx)(L.A,{"data-testid":"zoom_out",disabled:d,onClick:()=>{e.zoom(2*i)},children:(0,D.jsx)(I.A,{})})})}),(0,D.jsx)(R.Ay,{size:"small",className:t.slider,value:s,min:100*-Math.log2(r),max:100*-Math.log2(a),onChangeCommitted:()=>e.zoomTo(2**(-s/100)),valueLabelDisplay:"auto",valueLabelFormat:e=>`Window size: ${(0,C.getBpDisplayStr)(2**(-e/100)*n)}`,slots:{valueLabel:V},onChange:(e,t)=>{l(t)}}),(0,D.jsx)(P.A,{title:"Zoom in 2x",children:(0,D.jsx)("span",{children:(0,D.jsx)(L.A,{"data-testid":"zoom_in",disabled:c,onClick:()=>{e.zoom(e.bpPerPx/2)},children:(0,D.jsx)(M.A,{})})})}),(0,D.jsx)(k.A,{menuItems:[...[100,50,10].map(t=>({label:`Zoom in ${t}x`,onClick:()=>{e.zoom(e.bpPerPx/t)}})),...[10,50,100].map(t=>({label:`Zoom out ${t}x`,onClick:()=>{e.zoom(e.bpPerPx*t)}})),{label:"Custom zoom",onClick:()=>{(0,C.getSession)(e).queueDialog(t=>[N,{model:e,handleClose:t}])}}],children:(0,D.jsx)(A.A,{})})]})}),z=E;var j=n(35573),H=n(24570),_=n(97849),$=n(7328),O=n(10732),G=n(89147),W=n(64152),U=n(94095),q=n(40790),J=n(19608),X=n(38817),K=n(78770),Q=n(44934),Z=n(43463),Y=n(93949);var ee=n(88793),te=n(66311),ne=n(86875),re=n(7201),ae=n(35703),ie=n(3948);const oe=(0,T.n)()(e=>({panButton:{background:(0,re.X4)(e.palette.background.paper,.8),color:e.palette.text.primary,margin:ie.Es}}));function se(e){const t=(0,x.c)(15),{model:n}=e,{classes:r}=oe();let a,i,o,s,l,c,d;return t[0]!==n?(a=()=>{n.slide(-.9)},t[0]=n,t[1]=a):a=t[1],t[2]===Symbol.for("react.memo_cache_sentinel")?(i=(0,D.jsx)(te.A,{}),t[2]=i):i=t[2],t[3]!==r.panButton||t[4]!==a?(o=(0,D.jsx)(ae.A,{variant:"outlined",className:r.panButton,onClick:a,children:i}),t[3]=r.panButton,t[4]=a,t[5]=o):o=t[5],t[6]!==n?(s=()=>{n.slide(.9)},t[6]=n,t[7]=s):s=t[7],t[8]===Symbol.for("react.memo_cache_sentinel")?(l=(0,D.jsx)(ne.A,{}),t[8]=l):l=t[8],t[9]!==r.panButton||t[10]!==s?(c=(0,D.jsx)(ae.A,{variant:"outlined",className:r.panButton,onClick:s,children:l}),t[9]=r.panButton,t[10]=s,t[11]=c):c=t[11],t[12]!==o||t[13]!==c?(d=(0,D.jsxs)(D.Fragment,{children:[o,c]}),t[12]=o,t[13]=c,t[14]=d):d=t[14],d}var le=n(54825);const ce=(0,T.n)()({bp:{display:"flex",alignItems:"center",marginLeft:5,cursor:"pointer"}}),de=(0,F.observer)(function({model:e}){const{classes:t}=ce(),{effectiveTotalBpDisplayStr:n}=e;return(0,D.jsx)(le.A,{variant:"body2",color:"textSecondary",className:t.bp,children:n})}),ue=de;var pe=n(72242);const he=(0,T.n)()(e=>({toggleButton:{height:44,border:"none",marginLeft:e.spacing(4)}})),ge=(0,F.observer)(function({model:e}){const{classes:t}=he();return(0,D.jsx)(L.A,{onClick:e.activateTrackSelector,className:t.toggleButton,title:"Open track selector",value:"track_select",children:(0,D.jsx)(pe.xU,{})})}),fe=ge;var me=n(64261),ye=n(87377),be=n(75516),we=n(53121);const ve=(0,T.n)()(e=>({highlight:{height:"100%",position:"absolute",left:0,background:(0,we.M)(e.palette.highlight.main).alpha(.35).toRgbString(),borderLeft:`1px solid ${e.palette.highlight.main}`,borderRight:`1px solid ${e.palette.highlight.main}`}})),Se=(0,F.observer)(function({model:e,overview:t}){const{classes:n}=ve(),{highlight:r,cytobandOffset:a}=e,i=(0,C.getSession)(e),{assemblyManager:o}=i;return r.map(e=>{const n=o.get(e.assemblyName),r=n?.getCanonicalRefName(e.refName)??e.refName,i=t.bpToPx({...e,refName:r,coord:e.start}),s=t.bpToPx({...e,refName:r,coord:e.end});return void 0!==i&&void 0!==s?{width:Math.abs(s-i),left:i+a}:void 0}).filter(C.notEmpty).map(({left:e,width:t},r)=>(0,D.jsx)("div",{className:n.highlight,style:{width:t,transform:`translateX(${e}px)`}},`${e}_${t}_${r}`))}),xe=Se,ke=(0,T.n)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",left:0}}),Ce=(0,F.observer)(function({model:e,open:t,guideX:n,overview:r}){const{classes:a}=ke(),{cytobandOffset:i}=e,{assemblyManager:o}=(0,C.getSession)(e),s=r.pxToBp(n-i),l=o.get(s.assemblyName),c=l?.cytobands?.find(e=>s.coord>e.get("start")&&s.coord<e.get("end")&&s.refName===l.getCanonicalRefName(e.get("refName")));return(0,D.jsx)(P.A,{open:t,placement:"top",title:[(0,C.stringify)(s),c?.get("name"),c?.get("type")].join(" "),arrow:!0,children:(0,D.jsx)("div",{className:a.guide,style:{transform:`translateX(${n}px)`}})})}),Te=Ce;var Ae=n(68885),Me=n(9439);const Ie=(0,T.n)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rel:{position:"relative"}}),Pe=(0,F.observer)(function({model:e,overview:t,ControlComponent:n=(0,D.jsx)("div",{})}){const{cytobandOffset:r}=e,[a,i]=(0,y.useState)(),[o,s]=(0,y.useState)(),[l,c]=(0,y.useState)(),d=(0,y.useRef)(null),{classes:u}=Ie(),p=void 0!==a;function h(e){e.preventDefault(),e.stopPropagation(),i((0,Me.Pn)(e,d.current))}function g(e){c((0,Me.Pn)(e,d.current))}function f(){c(void 0)}if((0,y.useEffect)(()=>{function n(e){const t=d.current;t&&p&&s((0,Me.Pn)(e,t))}function l(){if(void 0!==a&&void 0!==o&&Math.abs(o-a)>3){const n=Math.min(a,o),i=Math.max(a,o);e.moveTo(t.pxToBp(n-r),t.pxToBp(i-r))}if(void 0!==a&&void 0===o){const n=t.pxToBp(a-r);n.refName?e.centerAt(Math.round(n.coord),n.refName,n.index):((0,C.getSession)(e).notify("unknown position clicked"),console.error("unknown position clicked",n))}i(void 0),s(void 0),void 0!==a&&c(void 0)}function u(e){"Escape"===e.key&&(i(void 0),s(void 0))}return p?(window.addEventListener("mousemove",n,!0),window.addEventListener("mouseup",l,!0),window.addEventListener("keydown",u,!0),()=>{window.removeEventListener("mousemove",n,!0),window.removeEventListener("mouseup",l,!0),window.removeEventListener("keydown",u,!0)}):()=>{}},[p,o,a,e,t,r]),void 0===a)return(0,D.jsxs)("div",{className:u.rel,children:[void 0!==l?(0,D.jsx)(Te,{model:e,open:!p,overview:t,guideX:l}):null,(0,D.jsx)("div",{className:u.rubberbandControl,ref:d,onMouseDown:h,onMouseOut:f,onMouseMove:g,children:n})]});let m,b,w=a||0,v=0;return void 0!==o&&(w=Math.min(o,a),v=o-a),a&&(m=t.pxToBp(a-r),b=t.pxToBp(a+v-r),void 0!==o&&o<a&&([m,b]=[b,m])),(0,D.jsxs)("div",{className:u.rel,children:[m&&b?(0,D.jsx)(Ae.default,{leftBpOffset:m,rightBpOffset:b,width:Math.abs(v),left:w}):null,(0,D.jsx)("div",{"data-testid":"rubberband_controls",className:u.rubberbandControl,ref:d,onMouseDown:h,onMouseOut:f,onMouseMove:g,children:n})]})}),Le=Pe;var Re=n(7663),Fe=n(5456);const De=(0,T.n)()({scalebarLabel:{height:ie.Gu,position:"absolute",left:0,display:"flex",justifyContent:"center",pointerEvents:"none"}}),Ne=(0,F.observer)(function({block:e,scale:t,overview:n,model:r}){const{classes:a}=De(),{start:i,end:o,reversed:s,refName:l,assemblyName:c}=e,{majorPitch:d}=(0,Fe.i3)(t,120,15),{assemblyManager:u}=(0,C.getSession)(r),p=u.get(c),h=p?.getRefNameColor(l),g=[];for(let e=0;e<Math.floor((o-i)/d);e++){const t=(e+1)*d;g.push(s?o-t:i+t)}return g.map((r,i)=>(0,D.jsx)(le.A,{className:a.scalebarLabel,variant:"body2",style:{transform:`translateX(${(i+1)*d/t}px)`,color:h},children:(0,C.getTickDisplayStr)(r,n.bpPerPx)},`${JSON.stringify(e)}-${r}-${i}`))}),Be=Ne,Ve=(0,T.n)()(e=>({scalebar:{height:ie.Gu,contain:"layout style"},scalebarBorder:{border:"1px solid"},scalebarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,left:0,height:ie.Gu,overflow:"hidden"},scalebarContigForward:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarContigReverse:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarRefName:{position:"absolute",left:0,fontWeight:"bold",pointerEvents:"none",zIndex:100},scalebarVisibleRegion:{position:"absolute",height:ie.Gu,pointerEvents:"none",zIndex:100,border:"1px solid",left:0},overview:{height:ie.Ij,position:"relative"},overviewSvg:{pointerEvents:"none",width:"100%",position:"absolute"}})),Ee=(0,F.observer)(function({scale:e,model:t,block:n,overview:r}){const{classes:a}=Ve(),i=(0,ye.A)(),{cytobandOffset:o,showCytobands:s}=t,{reversed:l,refName:c,assemblyName:d}=n,{assemblyManager:u}=(0,C.getSession)(t),p=u.get(d),h=p?.getRefNameColor(c),g=s&&(0,Me.S5)(p,n.refName).length;return(0,D.jsxs)("div",{children:[(0,D.jsx)(le.A,{style:{transform:`translateX(${n.offsetPx+3}px)`,color:g?i.palette.text.primary:h},className:a.scalebarRefName,children:c}),(0,D.jsx)("div",{className:(0,me.cx)(a.scalebarContig,g?void 0:l?a.scalebarContigReverse:a.scalebarContigForward,g?void 0:a.scalebarBorder),style:{transform:`translateX(${n.offsetPx+o}px)`,width:n.widthPx,borderColor:h},children:g?(0,D.jsx)("svg",{style:{width:"100%"},children:(0,D.jsx)(be.A,{overview:r,assembly:p,block:n})}):(0,D.jsx)(Be,{model:t,overview:r,scale:e,block:n})})]})}),ze=(0,F.observer)(function({model:e,overview:t,className:n}){const r=(0,ye.A)().palette.tertiary.light,{dynamicBlocks:a,showCytobands:i,cytobandOffset:o}=e,s=a.contentBlocks;if(!s.length)return null;const l=s.at(0),c=s.at(-1),d=t.bpToPx({refName:l.refName,coord:l.reversed?l.end:l.start})||0,u=t.bpToPx({refName:c.refName,coord:c.reversed?c.start:c.end})||0,p=i?"#f00":r,h=i?.1:.3,g=d+o;return(0,D.jsx)("div",{className:n,style:{width:u-d,transform:`translateX(${g}px)`,background:(0,re.X4)(p,h),borderColor:p}})}),je=(0,F.observer)(function({model:e,scale:t,overview:n}){const{classes:r}=Ve(),{pluginManager:a}=(0,C.getEnv)(e),i=n.dynamicBlocks,o=a.evaluateExtensionPoint("LinearGenomeView-OverviewScalebarComponent",void 0,{model:e,overview:n});return(0,D.jsxs)("div",{className:r.scalebar,children:[(0,D.jsx)(ze,{model:e,overview:n,className:r.scalebarVisibleRegion}),i.map((a,i)=>"ContentBlock"!==a.type?(0,D.jsx)("div",{className:r.scalebarContig,style:{width:a.widthPx,transform:`translateX(${a.offsetPx}px)`,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}},`${JSON.stringify(a)}-${i}`):(0,D.jsx)(Ee,{scale:t,block:a,model:e,overview:n},`${JSON.stringify(a)}-${i}`)),(0,D.jsx)(xe,{model:e,overview:n}),o]})}),He=(0,F.observer)(function({model:e,children:t}){const{classes:n}=Ve(),{minimumBlockWidth:r,totalBp:a,width:i,cytobandOffset:o,displayedRegions:s}=e,l=i-o,c=JSON.stringify(s),d=(0,y.useMemo)(()=>{const e=W.A.create({displayedRegions:JSON.parse(c),interRegionPaddingWidth:0,minimumBlockWidth:r});return e.setVolatileWidth(l),e.showAllRegions(),e},[c,r,l]),u=a/(l-2*(s.length-1));return(0,D.jsxs)("div",{children:[(0,D.jsx)(Le,{model:e,overview:d,ControlComponent:(0,D.jsx)(je,{model:e,overview:d,scale:u})}),(0,D.jsxs)("div",{className:n.overview,children:[(0,D.jsx)("svg",{height:ie.Ij,className:n.overviewSvg,children:(0,D.jsx)(Re.A,{model:e,overview:d})}),t]})]})}),_e=He,$e=(0,T.n)()({headerBar:{display:"flex",height:ie.Ij},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1}}),Oe=function(e){const t=(0,x.c)(24),{model:n}=e,{classes:r}=$e();let a,i,o,s,l,c,d,u,p;return t[0]!==n?(a=(0,D.jsx)(fe,{model:n}),t[0]=n,t[1]=a):a=t[1],t[2]!==r.spacer?(i=(0,D.jsx)("div",{className:r.spacer}),t[2]=r.spacer,t[3]=i):i=t[3],t[4]!==n?(o=(0,D.jsx)(se,{model:n}),s=(0,D.jsx)(j.A,{model:n}),t[4]=n,t[5]=o,t[6]=s):(o=t[5],s=t[6]),t[7]!==r.headerForm||t[8]!==o||t[9]!==s?(l=(0,D.jsxs)(ee.A,{row:!0,className:r.headerForm,children:[o,s]}),t[7]=r.headerForm,t[8]=o,t[9]=s,t[10]=l):l=t[10],t[11]!==n?(c=(0,D.jsx)(ue,{model:n}),d=(0,D.jsx)(z,{model:n}),t[11]=n,t[12]=c,t[13]=d):(c=t[12],d=t[13]),t[14]!==r.spacer?(u=(0,D.jsx)("div",{className:r.spacer}),t[14]=r.spacer,t[15]=u):u=t[15],t[16]!==r.headerBar||t[17]!==a||t[18]!==i||t[19]!==l||t[20]!==c||t[21]!==d||t[22]!==u?(p=(0,D.jsxs)("div",{className:r.headerBar,children:[a,i,l,c,d,u]}),t[16]=r.headerBar,t[17]=a,t[18]=i,t[19]=l,t[20]=c,t[21]=d,t[22]=u,t[23]=p):p=t[23],p},Ge=(0,F.observer)(function({model:e}){const{hideHeader:t,hideHeaderOverview:n}=e;return t?null:n?(0,D.jsx)(Oe,{model:e}):(0,D.jsx)(_e,{model:e,children:(0,D.jsx)(Oe,{model:e})})}),We=Ge;var Ue=n(94759),qe=n(69301);const Je=(0,T.n)()(e=>({background:{position:"absolute",right:0,background:e.palette.background.paper,zIndex:2},focusedBackground:{background:(0,re.X4)(e.palette.secondary.light,.2)}})),Xe=(0,F.observer)(function({model:e}){const{classes:t}=Je(),{id:n,bpPerPx:r,maxBpPerPx:a,minBpPerPx:i,hideHeader:o,effectiveBpPerPx:s}=e,{focusedViewId:l}=(0,C.getSession)(e);return o?(0,D.jsx)(qe.A,{className:t.background,children:(0,D.jsxs)(qe.A,{className:l===n?t.focusedBackground:void 0,children:[(0,D.jsx)(k.A,{menuItems:()=>e.menuItems(),children:(0,D.jsx)(Ue.A,{fontSize:"small"})}),(0,D.jsx)(L.A,{"data-testid":"zoom_out",onClick:()=>{e.zoom(2*r)},disabled:s>=a-1e-4,children:(0,D.jsx)(I.A,{fontSize:"small"})}),(0,D.jsx)(L.A,{"data-testid":"zoom_in",onClick:()=>{e.zoom(r/2)},disabled:s<=i+1e-4,children:(0,D.jsx)(M.A,{fontSize:"small"})})]})}):null}),Ke=Xe;var Qe=n(78657),Ze=n(1373),Ye=n(89693),et=n(47535),tt=n(38018),nt=n(63830),rt=n(59962),at=n(88653),it=n(27199),ot=n(78749);const st=(0,y.lazy)(()=>n.e(6226).then(n.bind(n,66226))),lt=(0,y.lazy)(()=>n.e(6810).then(n.bind(n,76810))),ct=(0,y.lazy)(()=>n.e(29).then(n.bind(n,60029))),dt=(0,y.lazy)(()=>n.e(5764).then(n.bind(n,25764)));function ut(e){return(0,C.toLocale)(Math.round(e))}function pt(e,t,n){for(const r of n)if("subMenu"in r&&pt(e,t,r.subMenu),"onClick"in r){const n=r.onClick;r.onClick=(...r)=>{for(const a of e.tracks)a.type===t&&n.apply(a,[a,...r])}}}const ht=(0,y.lazy)(()=>n.e(6719).then(n.bind(n,46719)));function gt(e,t){return Math.round(e/2-t/2)}function ft(e){return o.types.compose("LinearGenomeView",$.A,o.types.model({id:X.K,type:o.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:o.types.optional(o.types.frozen(),[]),tracks:o.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:o.types.optional(o.types.enumeration(["hierarchical"]),"hierarchical"),showCenterLine:o.types.optional(o.types.boolean,()=>(0,C.localStorageGetBoolean)("lgv-showCenterLine",!1)),showCytobandsSetting:o.types.optional(o.types.boolean,()=>(0,C.localStorageGetBoolean)("lgv-showCytobands",!0)),trackLabels:o.types.optional(o.types.string,()=>(0,C.localStorageGetItem)("lgv-trackLabels")||""),showGridlines:!0,highlight:o.types.optional(o.types.array(o.types.frozen()),[]),colorByCDS:o.types.optional(o.types.boolean,()=>(0,C.localStorageGetBoolean)("lgv-colorByCDS",!1)),showTrackOutlines:o.types.optional(o.types.boolean,()=>(0,C.localStorageGetBoolean)("lgv-showTrackOutlines",!0)),init:o.types.frozen()})).volatile(()=>({volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,lastTrackDragY:void 0,volatileError:void 0,scaleFactor:1,targetBpPerPx:void 0,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0,isScalebarRefNameMenuOpen:!1,scalebarRefNameClickPending:!1,volatileGuides:[]})).views(e=>({get pinnedTracks(){return e.tracks.filter(e=>e.pinned)},get unpinnedTracks(){return e.tracks.filter(e=>!e.pinned)},get trackLabelsSetting(){const t=(0,w.FI)((0,C.getSession)(e),["LinearGenomeViewPlugin","trackLabels"]);return e.trackLabels||t},get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return ie.Rd},get assemblyNames(){return[...new Set(e.displayedRegions.map(e=>e.assemblyName))]},get assemblyDisplayNames(){const{assemblyManager:t}=(0,C.getSession)(e);return this.assemblyNames.map(e=>t.get(e)?.displayName??e)},get isTopLevelView(){return(0,C.getSession)(e).views.some(t=>t.id===e.id)},get stickyViewHeaders(){const t=(0,C.getSession)(e);return!!(0,K.X)(t)&&this.isTopLevelView&&t.stickyViewHeaders},get rubberbandTop(){let t=0;return this.stickyViewHeaders&&(t=O.VIEW_HEADER_HEIGHT,e.hideHeader||(t+=ie.Ij,e.hideHeaderOverview||(t+=ie.Gu))),t},get pinnedTracksTop(){return this.rubberbandTop+ie.jE}})).views(e=>({scalebarDisplayPrefix:()=>"LinearSyntenyView"===(0,o.getParent)(e,2).type?e.assemblyDisplayNames[0]:"",MiniControlsComponent:()=>Ke,HeaderComponent:()=>We,get assembliesNotFound(){const{assemblyManager:t}=(0,C.getSession)(e),n=e.assemblyNames.map(e=>t.get(e)?void 0:e).filter(e=>!!e).join(",");return n?`Assemblies ${n} not found`:void 0},get assemblyErrors(){const{assemblyManager:t}=(0,C.getSession)(e);return e.assemblyNames.map(e=>t.get(e)?.error).filter(e=>!!e).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,C.getSession)(e);return e.assemblyNames.every(e=>t.get(e)?.initialized)},get initialized(){if(void 0===e.volatileWidth)return!1;if(e.init){const{assemblyManager:t}=(0,C.getSession)(e),n=t.get(e.init.assembly);return!(!n?.initialized||!n.regions)}return this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get loadingMessage(){return this.showLoading?"Loading":void 0},get hasSomethingToShow(){return this.hasDisplayedRegions||!!e.init},get showLoading(){return!this.initialized&&!this.error&&this.hasSomethingToShow},get showImportForm(){return!this.hasSomethingToShow||!!this.error},get scalebarHeight(){return ie.jE+ie.i3},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?ie.Ij:ie.Ij+ie.Gu},get trackHeights(){return(0,C.sum)(e.tracks.map(e=>e.displays[0].height))},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*ie.i3},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scalebarHeight},get totalBp(){return(0,C.sum)(e.displayedRegions.map(e=>e.end-e.start))},getNonElidedRegionCount:t=>t<=0?e.displayedRegions.length:e.displayedRegions.filter(n=>(n.end-n.start)/t>=e.minimumBlockWidth).length,getInterRegionPaddingPx(t){const n=this.getNonElidedRegionCount(t);return Math.max(0,n-1)*e.interRegionPaddingWidth},get maxBpPerPx(){if(0===this.totalBp||0===e.width)return 1;const t=this.totalBp/(.9*e.width),n=this.getInterRegionPaddingPx(t),r=.9*e.width-n;return r<=0?t:this.totalBp/r},get minBpPerPx(){return.02},get error(){if(e.volatileError)return e.volatileError;if(this.assemblyErrors)return this.assemblyErrors;if(this.assembliesNotFound)return this.assembliesNotFound;if(e.init){const{assemblyManager:t}=(0,C.getSession)(e),n=t.get(e.init.assembly);if(n?.error)return n.error;if(!n)return`Assembly ${e.init.assembly} not found`}},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){if(0===e.bpPerPx)return 0;const t=this.getInterRegionPaddingPx(e.bpPerPx);return this.totalBp/e.bpPerPx+t},renderProps:()=>({...(0,J.getParentRenderProps)(e),bpPerPx:e.bpPerPx,colorByCDS:e.colorByCDS}),searchScope:t=>({assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}),get trackMap(){const t=new Map;for(const n of e.tracks)t.set(n.configuration.trackId,n);return t},getTrack(e){return this.trackMap.get(e)},rankSearchResults:e=>e,get trackTypeActions(){const t=new Map;for(const n of e.tracks)if(!t.get(n.type)){const r=structuredClone(n.viewMenuActions);pt(e,n.type,r),t.set(n.type,r)}return t}})).actions(e=>({setShowTrackOutlines(t){e.showTrackOutlines=t},setColorByCDS(t){e.colorByCDS=t},setShowCytobands(t){e.showCytobandsSetting=t},setWidth(t){e.volatileWidth=t},setError(t){e.volatileError=t},setIsScalebarRefNameMenuOpen(t){e.isScalebarRefNameMenuOpen=t},setScalebarRefNameClickPending(t){e.scalebarRefNameClickPending=t},setHideHeader(t){e.hideHeader=t},setHideHeaderOverview(t){e.hideHeaderOverview=t},setHideNoTracksActive(t){e.hideNoTracksActive=t},setShowGridlines(t){e.showGridlines=t},addToHighlights(t){e.highlight.push(t)},setHighlight(t){e.highlight=(0,o.cast)(t)},removeHighlight(t){e.highlight.remove(t)},setVolatileGuides(t){e.volatileGuides=t},scrollTo(t){const n=(0,C.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},zoomTo(t,n=e.width/2,r=!1){const a=(0,C.clamp)(t,e.minBpPerPx,e.maxBpPerPx);if(a===e.bpPerPx)return a;const i=e.bpPerPx;if(Math.abs(i-a)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),i;e.bpPerPx=a;const o=Math.round((e.offsetPx+n)*i/a-(r?e.width/2:n));return this.scrollTo(o),a},setOffsets(t,n){e.leftOffset=t,e.rightOffset=n},setSearchResults(t,n,r){(0,C.getSession)(e).queueDialog(a=>[ht,{model:e,searchResults:t,searchQuery:n,handleClose:a,assemblyName:r}])},setNewView(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip(){e.displayedRegions=(0,o.cast)([...e.displayedRegions].reverse().map(e=>({...e,reversed:!e.reversed}))),this.scrollTo(e.totalBp/e.bpPerPx-e.offsetPx-e.width)},showTrack:(t,n={},r={})=>(0,J.showTrackGeneric)(e,t,n,r),hideTrack:t=>(0,J.hideTrackGeneric)(e,t)})).actions(e=>({moveTrackDown(t){const n=e.tracks.findIndex(e=>e.id===t);-1!==n&&n<e.tracks.length-1&&e.tracks.splice(n,2,e.tracks[n+1],e.tracks[n])},moveTrackUp(t){const n=e.tracks.findIndex(e=>e.id===t);n>0&&e.tracks.splice(n-1,2,e.tracks[n],e.tracks[n-1])},moveTrackToTop(t){const n=e.tracks.find(e=>e.id===t);n&&(e.tracks=(0,o.cast)([n,...e.tracks.filter(e=>e.id!==t)]))},moveTrackToBottom(t){const n=e.tracks.find(e=>e.id===t);n&&(e.tracks=(0,o.cast)([...e.tracks.filter(e=>e.id!==t),n]))},moveTrack(t,n){const r=e.tracks.findIndex(e=>e.id===t);if(-1===r)throw new Error(`Track ID ${t} not found`);const a=e.tracks.findIndex(e=>e.id===n);if(-1===a)throw new Error(`Track ID ${n} not found`);const i=e.tracks.filter((e,t)=>t!==r);i.splice(a,0,e.tracks[r]),e.tracks=(0,o.cast)(i)},toggleTrack(t){(0,J.toggleTrackGeneric)(e,t)},setTrackLabels(t){e.trackLabels=t},setShowCenterLine(t){e.showCenterLine=t},setDisplayedRegions(t){e.displayedRegions=(0,o.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,C.getSession)(e);if((0,i.lO)(t)){const n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},getSelectedRegions(t,n){const r=(0,o.getSnapshot)(e),a=W.A.create({...r,interRegionPaddingWidth:e.interRegionPaddingWidth});return a.setVolatileWidth(e.width),a.moveTo(t,n),a.dynamicBlocks.contentBlocks.map(e=>({assemblyName:e.assemblyName,refName:e.refName,start:Math.floor(e.start),end:Math.ceil(e.end)}))},horizontalScroll(t){const n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},showAllRegions(){e.bpPerPx=(0,C.clamp)(e.maxBpPerPx,e.minBpPerPx,e.maxBpPerPx),e.scrollTo(gt(e.displayedRegionsTotalPx,e.width))},showAllRegionsInAssembly(t){const n=(0,C.getSession)(e),{assemblyManager:r}=n;if(!t){const r=new Set(e.displayedRegions.map(e=>e.assemblyName));if(r.size>1)return void n.notify("Can't perform operation with multiple assemblies currently");[t]=[...r]}const a=r.get(t)?.regions;a&&(this.setDisplayedRegions(a),e.zoomTo(e.maxBpPerPx),e.scrollTo(gt(e.displayedRegionsTotalPx,e.width)))},setDraggingTrackId(t){e.draggingTrackId=t,void 0===t&&(e.lastTrackDragY=void 0)},setLastTrackDragY(t){e.lastTrackDragY=t},setScaleFactor(t){e.scaleFactor=t},setTargetBpPerPx(t){e.targetBpPerPx=t},clearView(){this.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setInit(t){e.init=t},async exportSvg(t={}){const{renderToSvg:r}=await n.e(3556).then(n.bind(n,83556)),a=await r(e,t),{saveAs:i}=await n.e(1611).then(n.bind(n,91611));if("png"===t.format){const e=new Image,n=new Blob([a],{type:"image/svg+xml"}),r=URL.createObjectURL(n);await new Promise((n,a)=>{e.onload=()=>{const o=document.createElement("canvas");o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(e,0,0),URL.revokeObjectURL(r),o.toBlob(r=>{r?(i(r,t.filename||"image.png"),n()):a(new Error(`Failed to create PNG. The image may be too large (${e.width}x${e.height}). Try reducing the view size or use SVG format.`))},"image/png")},e.onerror=()=>{URL.revokeObjectURL(r),a(new Error("Failed to load SVG for PNG conversion"))},e.src=r})}else i(new Blob([a],{type:"image/svg+xml"}),t.filename||"image.svg")}})).actions(e=>{let t=()=>{};return{slide:function(n){const[r,a]=(0,C.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo,void 0,void 0,200);t(),t=a,r()}}}).actions(e=>{let t=()=>{};return{zoom:function(n){t();const r=n/e.bpPerPx;let a=(e.targetBpPerPx??e.bpPerPx)*r;a=Math.max(e.minBpPerPx,Math.min(e.maxBpPerPx,a));const i=e.targetBpPerPx??e.bpPerPx;if(a===i)return;e.setTargetBpPerPx(a);const o=e.bpPerPx/a,[s,l]=(0,C.springAnimate)(e.scaleFactor,o,e.setScaleFactor,()=>{e.zoomTo(a),e.setScaleFactor(1),e.setTargetBpPerPx(void 0)},0,1e3,50);t=l,s()}}}).views(e=>({get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){const{assemblyManager:t}=(0,C.getSession)(e);return e.assemblyNames.some(e=>t.get(e)?.cytobands?.length)},get cytobandOffset(){return this.showCytobands?(0,C.measureText)(e.displayedRegions[0]?.refName||"",12)+15:0}})).views(e=>({menuItems:()=>function(e){if(!e.hasDisplayedRegions)return[];const{canShowCytobands:t,showCytobands:n}=e,r=(0,C.getSession)(e),a=[{label:"Return to import form",onClick:()=>{r.queueDialog(t=>[st,{model:e,handleClose:t}])},icon:Ye.A},...(0,i.QW)(r)?[{label:"Sequence search",icon:at.A,onClick:()=>{r.queueDialog(t=>[lt,{model:e,handleClose:t}])}}]:[],{label:"Export SVG",icon:rt.A,onClick:()=>{r.queueDialog(t=>[ct,{model:e,handleClose:t}])}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:pe.xU},{label:"Horizontally flip",icon:it.A,onClick:e.horizontallyFlip},{label:"Color by CDS and draw amino acids",type:"checkbox",checked:e.colorByCDS,icon:nt.A,onClick:()=>{e.setColorByCDS(!e.colorByCDS)}},{label:"Show...",icon:ot.A,subMenu:[{label:"Show all regions in assembly",onClick:e.showAllRegionsInAssembly},{label:"Show center line",type:"checkbox",checked:e.showCenterLine,onClick:()=>{e.setShowCenterLine(!e.showCenterLine)}},{label:"Show header",type:"checkbox",checked:!e.hideHeader,onClick:()=>{e.setHideHeader(!e.hideHeader)}},{label:"Show track outlines",type:"checkbox",checked:e.showTrackOutlines,onClick:()=>{e.setShowTrackOutlines(!e.showTrackOutlines)}},{label:"Show header overview",type:"checkbox",checked:!e.hideHeaderOverview,onClick:()=>{e.setHideHeaderOverview(!e.hideHeaderOverview)},disabled:e.hideHeader},{label:"Show no tracks active button",type:"checkbox",checked:!e.hideNoTracksActive,onClick:()=>{e.setHideNoTracksActive(!e.hideNoTracksActive)}},{label:"Show guidelines",type:"checkbox",checked:e.showGridlines,onClick:()=>{e.setShowGridlines(!e.showGridlines)}},...t?[{label:"Show ideogram",type:"checkbox",checked:e.showCytobands,onClick:()=>{e.setShowCytobands(!n)}}]:[]]},{label:"Track labels",icon:et.A,subMenu:[{label:"Overlapping",icon:ot.A,type:"radio",checked:"overlapping"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("overlapping")}},{label:"Offset",icon:ot.A,type:"radio",checked:"offset"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("offset")}},{label:"Hidden",icon:ot.A,type:"radio",checked:"hidden"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("hidden")}}]}];for(const[t,n]of e.trackTypeActions.entries())if(n.length){a.push({type:"divider"},{type:"subHeader",label:t});for(const e of n)a.push(e)}return a}(e)})).views(e=>{let t,n;return{get staticBlocks(){const r=(0,q.A)(e),a=r.blocks.map(e=>e.key).join(",");return void 0===t||n!==a?(t=r,n=a,t):t},get dynamicBlocks(){return(0,U.A)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map(e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)}))},get visibleLocStrings(){return(0,Fe.H4)(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return(0,Fe.H4)(e.coarseDynamicBlocks)},get coarseTotalBpDisplayStr(){return(0,C.getBpDisplayStr)(e.coarseTotalBp)},get effectiveBpPerPx(){return e.targetBpPerPx??e.bpPerPx},get effectiveTotalBp(){return this.effectiveBpPerPx*e.width},get effectiveTotalBpDisplayStr(){return(0,C.getBpDisplayStr)(this.effectiveTotalBp)}}}).actions(e=>({setCoarseDynamicBlocks(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp}})).actions(e=>({moveTo(t,n){(0,G.tw)(e,t,n)},async navToLocString(t,n,r){const{assemblyNames:a}=e,{assemblyManager:i}=(0,C.getSession)(e),o=n||a[0];return o&&await i.waitForAssembly(o),this.navToLocations((0,Fe.CU)(t,o,(e,t)=>i.isValidRefName(e,t)),o,r)},async navToSearchString({input:t,assembly:n}){await(0,Z.cm)({input:t,assembly:n,model:e})},async navToLocation(e,t,n){return this.navToLocations([e],t,n)},async navToLocations(t,n,r){const{assemblyManager:a}=(0,C.getSession)(e);await(0,Q.when)(()=>void 0!==e.volatileWidth);const i=await(0,Fe.Cz)({regions:t,assemblyManager:a,assemblyName:n,grow:r});if(1===i.length){const t=i[0],{reversed:n,parentRegion:r,start:a,end:o}=t;e.setDisplayedRegions([{reversed:n,...r}]),this.navTo({...t,start:(0,C.clamp)(a??0,0,r.end),end:(0,C.clamp)(o??r.end,0,r.end)})}else e.setDisplayedRegions(i.map(e=>{const{start:t,end:n}=e;return void 0===t||void 0===n?e.parentRegion:{...e,start:t,end:n}})),e.showAllRegions()},navTo(e,t){this.navToMultiple([e],t)},navToMultiple(t,n){if(t.some(e=>void 0!==e.start&&void 0!==e.end&&e.start>e.end))throw new Error("found start greater than end");const r=t.at(0),a=t.at(-1);if(!r||!a)return;const i=e.assemblyNames[0],{assemblyManager:o}=(0,C.getSession)(e),s=o.get(r.assemblyName||i),l=s?.getCanonicalRefName(r.refName)||r.refName,c=e.displayedRegions.find(e=>e.refName===l),d=o.get(a.assemblyName||i),u=d?.getCanonicalRefName(a.refName)||a.refName,p=(0,C.findLast)(e.displayedRegions,e=>e.refName===u);if(!c)throw new Error(`could not find a region with refName "${l}"`);if(!p)throw new Error(`could not find a region with refName "${u}"`);let h=void 0===r.start?c.start:r.start,g=void 0===r.end?c.end:r.end,f=void 0===a.start?p.start:a.start,m=void 0===a.end?p.end:a.end;if(n){const e=(0,Fe.Tn)(h,m,n,c.start,p.end);h=e.start,g=e.end,f=e.start,m=e.end}const y=e.displayedRegions.findIndex(e=>l===e.refName&&h>=e.start&&h<=e.end&&g<=e.end&&g>=e.start),b=e.displayedRegions.findIndex(e=>u===e.refName&&f>=e.start&&f<=e.end&&m<=e.end&&m>=e.start);if(-1===y||-1===b)throw new Error(`could not find a region that contained "${t.map(e=>(0,C.assembleLocString)(e))}"`);const w=e.displayedRegions[y],v=e.displayedRegions[b],S=w.reversed?w.end-g:h-w.start,x=v.reversed?v.end-f:m-v.start;this.moveTo({index:y,offset:S},{index:b,offset:x})}})).views(e=>({rubberBandMenuItems:()=>function(e){const{leftOffset:t,rightOffset:r}=e,a=t?.refName??"",i=r?.refName??"",o=ut((t?.coord??0)+1),s=ut(r?.coord??0),l=a===i?`${a}:${o}-${s}`:`${a}:${o}..${i}:${s}`;return[{label:"Zoom to region",icon:M.A,onClick:()=>{e.moveTo(e.leftOffset,e.rightOffset)}},{label:"Get sequence",icon:tt.A,onClick:()=>{(0,C.getSession)(e).queueDialog(t=>[dt,{model:e,handleClose:t}])}},{label:"Copy range",icon:Ze.A,onClick:async()=>{const{default:e}=await n.e(2899).then(n.t.bind(n,72899,23));e(l)}}]}(e),bpToPx:({refName:t,coord:n,regionNumber:r})=>(0,G.eB)({refName:t,coord:n,regionNumber:r,self:e}),centerAt(t,n,r){const a=this.bpToPx({refName:n,coord:t,regionNumber:r});void 0!==a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},pxToBp:t=>(0,G.Ii)(e,t),get centerLineInfo(){return e.displayedRegions.length>0?this.pxToBp(e.width/2):void 0},get visibleRegions(){return e.dynamicBlocks.contentBlocks}})).views(e=>({rubberbandClickMenuItems:t=>function(e,t){const{coord:r,refName:a}=t;if(void 0===r||void 0===a)return[];const i=`${a}:${ut(r+1)}`;return[{label:"Center view here",icon:Qe.A,onClick:()=>{e.centerAt(r,a)}},{label:"Zoom to base level",icon:M.A,onClick:()=>{e.centerAt(r,a),e.zoomTo(e.minBpPerPx)}},{label:`Copy coordinate (${i})`,icon:Ze.A,onClick:async()=>{const{default:e}=await n.e(2899).then(n.t.bind(n,72899,23));e(i)}}]}(e,t)})).actions(e=>({afterCreate(){!function(e){function t(t){(0,C.getSession)(e).focusedViewId===e.id&&(t.ctrlKey||t.metaKey)&&("ArrowLeft"===t.code?(t.preventDefault(),e.slide(-.9)):"ArrowRight"===t.code?(t.preventDefault(),e.slide(.9)):"ArrowUp"===t.code?(t.preventDefault(),e.zoom(e.bpPerPx/2)):"ArrowDown"===t.code&&(t.preventDefault(),e.zoom(2*e.bpPerPx)))}document.addEventListener("keydown",t),(0,o.addDisposer)(e,()=>{document.removeEventListener("keydown",t)})}(e)},afterAttach(){!function(e){!function(e){(0,o.addDisposer)(e,(0,Q.autorun)(async function(){const{init:t,initialized:n}=e;if(n&&t){const n=(0,C.getSession)(e),{assemblyManager:r}=n;if(t.tracklist){e.activateTrackSelector();const t=e.volatileWidth;await(0,Q.when)(()=>e.volatileWidth!==t,{timeout:500}).catch(()=>{})}try{t.loc?await e.navToLocString(t.loc,t.assembly):e.showAllRegionsInAssembly(t.assembly)}catch(e){console.error(t,e),n.notifyError(`${e}`,e)}if(t.tracks){const r=[];for(const n of t.tracks)try{"string"==typeof n?e.showTrack(n):e.showTrack(n.trackId,n.trackSnapshot??{},n.displaySnapshot??{})}catch(e){const t="string"==typeof n?n:n.trackId;if(!/Could not resolve identifier/.exec(`${e}`))throw e;r.push(t)}r.length&&n.notifyError(`Could not resolve identifiers: ${r.join(",")}`,new Error(`Could not resolve identifiers: ${r.join(",")}`))}if(void 0!==t.nav&&e.setHideHeader(!t.nav),t.highlight)for(const n of t.highlight){const a=(0,Y.f)(n,e=>r.isValidRefName(e,t.assembly)),{start:i,end:o}=a;void 0!==i&&void 0!==o&&e.addToHighlights({...a,start:i,end:o,assemblyName:t.assembly})}e.setInit(void 0)}},{name:"LGVInit"}))}(e),function(e){(0,o.addDisposer)(e,(0,Q.autorun)(function(){e.initialized&&e.setCoarseDynamicBlocks(e.dynamicBlocks)},{delay:500,name:"LGVCoarseDynamicBlocks"}))}(e),function(e){(0,o.addDisposer)(e,(0,Q.autorun)(function(){const t=e=>JSON.stringify(e),{showCytobandsSetting:n,showCenterLine:r,colorByCDS:a,showTrackOutlines:i,trackLabels:o}=e;(0,C.localStorageSetItem)("lgv-showCytobands",t(n)),(0,C.localStorageSetItem)("lgv-showCenterLine",t(r)),(0,C.localStorageSetItem)("lgv-colorByCDS",t(a)),(0,C.localStorageSetItem)("lgv-showTrackOutlines",t(i)),(0,C.localStorageSetItem)("lgv-trackLabels",o)},{name:"LGVLocalStorage"}))}(e)}(e)}})).preProcessSnapshot(e=>{if(!e)return e;const{highlight:t,...n}=e;return{highlight:Array.isArray(t)||void 0===t?t:[t],...n}}).postProcessSnapshot(e=>{if(!e)return e;const{init:t,offsetPx:n,bpPerPx:r,hideHeader:a,hideHeaderOverview:i,hideNoTracksActive:o,showGridlines:s,trackSelectorType:l,displayedRegions:c,highlight:d,showCenterLine:u,showCytobandsSetting:p,trackLabels:h,colorByCDS:g,showTrackOutlines:f,...m}=e;return{...m,...n?{offsetPx:n}:{},...1!==r?{bpPerPx:r}:{},...a?{hideHeader:a}:{},...i?{hideHeaderOverview:i}:{},...o?{hideNoTracksActive:o}:{},...s?{}:{showGridlines:s},..."hierarchical"!==l?{trackSelectorType:l}:{},...c.length?{displayedRegions:c}:{},...d.length?{highlight:d}:{},...u?{showCenterLine:u}:{},...p?{}:{showCytobandsSetting:p},...h?{trackLabels:h}:{},...g?{colorByCDS:g}:{},...f?{}:{showTrackOutlines:f}}})}var mt=n(63332);class yt extends r.A{name="LinearGenomeViewPlugin";exports={BaseLinearDisplayComponent:l.Ay,BaseLinearDisplay:c.L,baseLinearDisplayConfigSchema:d.A,SearchBox:j.A,ZoomControls:z,LinearGenomeView:H.default};configurationSchema=(0,a.S7)("LinearGenomeViewConfigSchema",{trackLabels:{type:"string",defaultValue:"overlapping",model:o.types.enumeration("trackLabelOptions",["offset","overlapping","hidden"])}});install(e){var t;(t=e).addTrackType(()=>{const e=(e=>(0,a.S7)("FeatureTrack",{},{baseConfiguration:(0,h.J)(e),explicitIdentifier:"trackId"}))(t);return new u.A({name:"FeatureTrack",displayName:"Feature track",configSchema:e,stateModel:(0,p.E)(t,"FeatureTrack",e)})}),function(e){e.addTrackType(()=>{const t=(e=>(0,a.S7)("BasicTrack",{},{baseConfiguration:(0,h.J)(e),explicitIdentifier:"trackId"}))(e);return new u.A({name:"BasicTrack",configSchema:t,stateModel:(0,p.E)(e,"BasicTrack",t)})})}(e),function(e){e.addDisplayType(()=>{const t=(0,b.A)(e);return new g.A({name:"LinearBasicDisplay",displayName:"Basic feature display",configSchema:t,stateModel:S(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:(0,y.lazy)(()=>Promise.resolve().then(n.bind(n,63332)))})})}(e),function(e){e.addViewType(()=>new _.A({name:"LinearGenomeView",displayName:"Linear genome view",stateModel:ft(e),ReactComponent:(0,y.lazy)(()=>Promise.resolve().then(n.bind(n,24570)))}))}(e),function(e){e.addDisplayType(()=>{const t=f(e);return new g.A({name:"LinearBareDisplay",configSchema:t,displayName:"Bare feature display",stateModel:(0,m.n)(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:l.Ay})})}(e),function(e){e.addToExtensionPoint("LaunchView-LinearGenomeView",async({session:e,assembly:t,loc:n,tracks:r=[],tracklist:a,nav:i,highlight:o})=>{if(!t)throw new Error("No assembly provided when launching linear genome view");e.addView("LinearGenomeView",{init:{assembly:t,loc:n,tracks:r,tracklist:a,nav:i,highlight:o}})})}(e)}configure(e){(0,i.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:s.A,onClick:e=>{e.addView("LinearGenomeView",{})}})}}},43463(e,t,n){n.d(t,{Jf:()=>l,Kd:()=>o,cm:()=>s});var r=n(34732),a=n(23886),i=n(1259);async function o({option:e,model:t,assemblyName:n}){const r=e.getLocation(),i=e.getTrackId();r&&(await t.navToLocString(r,n,.2),i&&t.showTrack(i));const o=(0,a.getSession)(t),{pluginManager:s}=(0,a.getEnv)(o);await s.evaluateAsyncExtensionPoint("LinearGenomeView-searchResultSelected",void 0,{session:o,result:e,model:t,assemblyName:n})}async function s({input:e,model:t,assembly:n}){const r=n.allRefNamesWithLowerCase||[],i=n.name;if(e.split(" ").every(e=>function(e,t){const[n,r]=function(e){const t=e.lastIndexOf(":");if(-1===t)return[e,""];return[e.slice(0,t),e.slice(t+1)]}(e);return t.includes(e)||t.includes(n)&&!Number.isNaN(Number.parseInt(r,10))}(e,r)))await t.navToLocString(e,n.name);else{const r=t.searchScope(i),{textSearchManager:s}=(0,a.getSession)(t),c=await l({queryString:e,searchType:"exact",searchScope:r,rankSearchResults:t.rankSearchResults,textSearchManager:s,assembly:n});c.length>1?t.setSearchResults(c,e.toLowerCase(),i):1===c.length?await o({option:c[0],model:t,assemblyName:i}):await t.navToLocString(e,i)}}async function l({queryString:e,searchType:t,searchScope:n,rankSearchResults:a,textSearchManager:o,assembly:s}){o||console.warn("No text search manager");const l=await(o?.search({queryString:e,searchType:t},n,a)),c=s?.allRefNames?.filter(t=>t.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(e=>new r.A({label:e}));return(0,i.Q)([...c||[],...l||[]],e=>e.getId())}},69073(e,t,n){n.d(t,{$:()=>o,I:()=>i});var r=n(23886),a=n(19608);function i(e){const t=(0,r.getContainingView)(e),{rendererType:n}=e,{rpcManager:i}=(0,r.getSession)(t);return{rendererType:n,rpcManager:i,renderProps:e.renderProps(),renderingProps:e.renderingProps?.(),renderArgs:{assemblyName:t.displayedRegions[0].assemblyName,adapterConfig:structuredClone(e.adapterConfig),rendererType:n.name,regions:structuredClone(t.displayedRegions),blockDefinitions:e.blockDefinitions,sessionId:(0,a.getRpcSessionId)(e),trackInstanceId:(0,r.getContainingTrack)(e).id,timeout:1e6}}}async function o(e,t){if(!e)throw new Error("cannot render with no props");const{rendererType:n,rpcManager:r,cannotBeRenderedReason:a,renderArgs:i,renderProps:o,renderingProps:s,exportSVG:l}=e;if(a)return{message:a};if(!o.radius||!i.regions?.length)return{message:"Skipping render"};const{html:c,...d}=await n.renderInClient(r,{...i,...o,renderingProps:s,exportSVG:l,stopToken:t});return{html:c,data:d,reactElement:d.reactElement,renderingComponent:n.ReactComponent}}},19520(e,t,n){n.d(t,{v:()=>c});var r=n(95548),a=n(29458),i=n(88068),o=n(90013),s=n(44732);const l=/[/|]/;async function c({pluginManager:e,args:t}){const{sources:n,minorAlleleFrequencyFilter:c,regions:d,adapterConfig:u,sessionId:p,lengthCutoffFilter:h,stopTokenCheck:g}=t,f=(await(0,r.cK)(e,p,u)).dataAdapter,m=Object.fromEntries(n.map(e=>[e.name,[]])),y={},b=(0,s.Cg)({minorAlleleFrequencyFilter:c,lengthCutoffFilter:h,stopTokenCheck:g,splitCache:y,features:await(0,i._)(f.getFeaturesInMultipleRegions(d,t).pipe((0,o.$)()))});for(const{feature:e}of b){const t=e.get("genotypes");for(const{name:e}of n){const n=t[e],r=y[n]??(y[n]=n.split(l));let a=0,i=0;for(let e=0,t=r.length;e<t;e++){const t=r[e];"."===t?i++:"0"!==t&&a++}const o=i===r.length?-1:0===a?0:a===r.length?2:1;m[e].push(o)}(0,a.As)(g)}return m}},2908(e,t,n){n.r(t),n.d(t,{default:()=>f});var r=n(30128),a=n(28910),i=n(8567),o=n(46625),s=n(63209),l=n(23149),c=n(44641),d=n(35703),u=n(69566),p=n(44460);const h=(0,o.n)()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},error:{color:"red",fontSize:"0.8em"}});function g(e){(0,i.A)(e)}const f=(0,u.observer)(function({model:e,handleClose:t}){const{classes:n}=h(),{jexlFilters:i}=e,[o,u]=(0,r.useState)((i??[]).join("\n")),[f,m]=(0,r.useState)();return(0,r.useEffect)(()=>{try{for(const e of o.split("\n").map(e=>e.trim()).filter(e=>!!e))g(e);m(void 0)}catch(e){console.error(e),m(e)}},[o]),(0,p.jsxs)(a.A,{maxWidth:"xl",open:!0,onClose:t,title:"Add track filters",children:[(0,p.jsxs)(s.A,{children:[(0,p.jsxs)("div",{children:["Add filters, in jexl format, one per line, starting with the string jexl:. Examples:"," ",(0,p.jsxs)("ul",{children:[(0,p.jsxs)("li",{children:[(0,p.jsx)("code",{children:"jexl:get(feature,'name')=='BRCA1'"})," - show only feature where the name attribute is BRCA1"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("code",{children:"jexl:startsWith(get(feature,'name'),'PREFIX')"})," - show only feature where the string 'PREFIX' is the prefix of feature name. endsWith also works"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("code",{children:"jexl:includes(get(feature,'name'),'PREFIX')"})," - show only feature where the string 'PREFIX' is the prefix of feature name"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("code",{children:"jexl:get(feature,'type')=='gene'"})," - show only gene type features in a GFF that has many other feature types"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("code",{children:"jexl:get(feature,'score') > 400"})," - show only features that have a score greater than 400"]}),(0,p.jsxs)("li",{children:[(0,p.jsx)("code",{children:"jexl:get(feature,'end') - get(feature,'start') < 1000000"})," ","- show only features with length less than 1Mbp"]})]}),(0,p.jsxs)("p",{children:["Please see"," ",(0,p.jsx)("a",{href:"https://jbrowse.org/jb2/docs/config_guides/jexl/",children:"Jexl"})," ","documentation for more information"]})]}),f?(0,p.jsx)("p",{className:n.error,children:`${f}`}):null,(0,p.jsx)(l.A,{variant:"outlined",multiline:!0,minRows:5,maxRows:10,className:n.dialogContent,fullWidth:!0,value:o,onChange:e=>{u(e.target.value)},slotProps:{input:{classes:{input:n.textAreaFont}}}})]}),(0,p.jsxs)(c.A,{children:[(0,p.jsx)(d.A,{variant:"contained",color:"primary",type:"submit",autoFocus:!0,disabled:!!f,onClick:()=>{e.setJexlFilters(o.split("\n")),t()},children:"Submit"}),(0,p.jsx)(d.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})})},24154(e,t,n){n.d(t,{FX:()=>o,Lp:()=>l,U0:()=>a,Us:()=>i,V4:()=>c,Vg:()=>d,f2:()=>r,fb:()=>u,lh:()=>s});const r=.3,a=.8,i="#ccc",o="hsl(50,50%,50%)",s="black",l=200,c=50,d="hsl(0,100%,20%)";function u(e){return`hsl(${l},${c}%,${80-50*e}%)`}},11265(e,t,n){function r(e,t){const n=[];for(let r=0;r<t;r++){const t=`${e.name} HP${r}`;n.push({...e,name:t,baseName:e.name,HP:r})}return n}function a({sources:e,sampleInfo:t}){return e.flatMap(e=>r(e,t[e.name]?.maxPloidy??2))}function i({sources:e,layout:t=e,renderingMode:n,sampleInfo:a}){const i=Object.fromEntries(e.map(e=>[e.name,e]));return t.flatMap(e=>{const t=e.baseName??e.name,o=i[t];if(!o)return[];const s={...o,...e};if("phased"===n){if(void 0!==e.HP)return[{...s,baseName:t}];const n=a?.[e.name]?.maxPloidy;return n?r(s,n):[]}return[s]})}n.d(t,{X:()=>i,d:()=>a})},44732(e,t,n){n.d(t,{Cg:()=>c,li:()=>s,s8:()=>o});var r=n(29458);const a=/[/|]/;function i(e){let t=0,n=0,r=0,i=0,o=0;const s={};e.processGenotypes((e,l,c)=>{const d=c-l;if(3===d){const a=e.charCodeAt(l+1);if(47===a||124===a){const a=e.charCodeAt(l),c=e.charCodeAt(l+2);if(48===a)t++;else if(49===a)n++;else if(50===a)r++;else if(51===a)i++;else if(46===a)o++;else{const t=e[l];s[t]=(s[t]||0)+1}if(48===c)t++;else if(49===c)n++;else if(50===c)r++;else if(51===c)i++;else if(46===c)o++;else{const t=e[l+2];s[t]=(s[t]||0)+1}return}}if(1===d){const a=e.charCodeAt(l);if(48===a)t++;else if(49===a)n++;else if(50===a)r++;else if(51===a)i++;else if(46===a)o++;else{const t=e[l];s[t]=(s[t]||0)+1}return}const u=e.slice(l,c).split(a);for(const e of u)"0"===e?t++:"1"===e?n++:"2"===e?r++:"3"===e?i++:"."===e?o++:s[e]=(s[e]||0)+1});const l={};t>0&&(l[0]=t),n>0&&(l[1]=n),r>0&&(l[2]=r),i>0&&(l[3]=i),o>0&&(l["."]=o);for(const e in s)l[e]=s[e];return l}function o(e,t){let n=0,r=0,i=0,o=0,s=0;const l={};for(const c in e){const d=e[c],u=d.length;if(3===u){const e=d[1];if("/"===e||"|"===e){const e=d[0],t=d[2];"0"===e?n++:"1"===e?r++:"2"===e?i++:"3"===e?o++:"."===e?s++:l[e]=(l[e]||0)+1,"0"===t?n++:"1"===t?r++:"2"===t?i++:"3"===t?o++:"."===t?s++:l[t]=(l[t]||0)+1;continue}}if(1===u){"0"===d?n++:"1"===d?r++:"2"===d?i++:"3"===d?o++:"."===d?s++:l[d]=(l[d]||0)+1;continue}let p=t[d];p||(p=d.split(a),t[d]=p);for(const e of p)"0"===e?n++:"1"===e?r++:"2"===e?i++:"3"===e?o++:"."===e?s++:l[e]=(l[e]||0)+1}const c={};n>0&&(c[0]=n),r>0&&(c[1]=r),i>0&&(c[2]=i),o>0&&(c[3]=o),s>0&&(c["."]=s);for(const e in l)c[e]=l[e];return c}function s(e){let t=0,n=0,r=0;for(const a in e){const i=e[a];r+=i,i>t?(n=t,t=i):i>n&&(n=i)}return n/(r||1)}function l(e){let t,n=0;for(const r in e){const a=e[r];"."!==r&&"0"!==r&&a>n&&(t=r,n=a)}return t}function c({features:e,minorAlleleFrequencyFilter:t,lengthCutoffFilter:n,stopTokenCheck:a,genotypesCache:c,splitCache:d={}}){const u=[];for(const p of e){if(p.get("end")-p.get("start")<=n){let e;if("processGenotypes"in p)e=i(p);else{const t=p.id();let n=c?.get(t);n||(n=p.get("genotypes"),c?.set(t,n)),e=o(n,d)}s(e)>=t&&u.push({feature:p,mostFrequentAlt:l(e),alleleCounts:e})}(0,r.As)(a)}return u}},96870(e,t,n){n.r(t),n.d(t,{default:()=>c});var r=n(17378),a=n(23886),i=n(83826),o=n(69566),s=n(20702),l=n(44460);const c=(0,o.observer)(function(e){const{model:t}=e,{stats:n,height:o,graphType:c}=t,{trackLabels:d}=(0,a.getContainingView)(t),u=(0,a.getContainingTrack)(t);return(0,l.jsxs)("div",{children:[(0,l.jsx)(i.Ay,{...e}),n&&c?(0,l.jsx)("svg",{style:{position:"absolute",top:0,left:"overlapping"===d?(0,a.measureText)((0,r.FI)(u,"name"),12.8)+100:50,pointerEvents:"none",height:o,width:50},children:(0,l.jsx)(s.A,{model:t})}):null]})})},88642(e,t,n){n.d(t,{A:()=>m});var r=n(30128),a=n(17378),i=n(23886),o=n(10533),s=n(34993),l=n(63830),c=n(78749),d=n(84571),u=n(14926),p=n(91520);const h=(0,r.lazy)(()=>n.e(7805).then(n.bind(n,87805))),g=(0,r.lazy)(()=>Promise.all([n.e(7689),n.e(3795)]).then(n.bind(n,83795))),f=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),m=function(e,t){return o.types.compose("LinearWiggleDisplay",(0,d.A)(t),o.types.model({type:o.types.literal("LinearWiggleDisplay"),invertedSetting:o.types.maybe(o.types.boolean)})).actions(e=>({setInverted(t){e.invertedSetting=t}})).views(e=>({get TooltipComponent(){return h},get rendererTypeName(){const t=e.rendererTypeNameSimple,n=f.get(t);if(!n)throw new Error(`unknown renderer ${t}`);return n},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,i.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx},get graphType(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get inverted(){return e.invertedSetting??(0,a.FI)(e,"inverted")}})).views(e=>{const{renderProps:t}=e;return{adapterProps(){const n=t(),{filters:r,resolution:a,scaleOpts:i}=e;return{...n,rpcDriverName:e.effectiveRpcDriverName,config:e.rendererConfig,displayCrossHatches:e.displayCrossHatchesSetting,scaleOpts:i,resolution:a,filters:r}},get ticks(){const{inverted:t,scaleType:n,domain:r,height:i}=e,o=(0,a.FI)(e,"minimalTicks");if(r){const e=(0,u.A)((0,p.getScale)({scaleType:n,domain:r,range:[i-p.YSCALEBAR_LABEL_OFFSET,p.YSCALEBAR_LABEL_OFFSET],inverted:t}),4);return i<100||o?{...e,values:r}:e}}}}).views(e=>({renderProps(){const{inverted:t,ticks:n,height:r,domain:a}=e,o=e.adapterProps(),s=(0,i.getContainingView)(e),l=JSON.stringify(s.dynamicBlocks);return{...e.adapterProps(),notReady:o.notReady||!a||e.stats?.statsRegion!==l,height:r,ticks:n,inverted:t,offset:p.YSCALEBAR_LABEL_OFFSET}},get fillSetting(){return e.filled?0:1===e.minSize?1:2},get quantitativeStatsReady(){return(0,i.getContainingView)(e).initialized&&e.featureDensityStatsReadyAndRegionNotTooLarge&&!e.error}})).views(e=>{const{trackMenuItems:t}=e,n=(0,a.FI)(e,"defaultRendering");return{wiggleBaseTrackMenuItems:()=>[...t(),{label:"Score",icon:s.A,subMenu:e.scoreTrackMenuItems()}],wiggleOnlyTrackMenuItems:()=>[...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((t,n)=>({label:t,type:"radio",checked:e.fillSetting===n,onClick:()=>{e.setFill(n)}}))}]:[],...n?[{label:"Renderer type",subMenu:["xyplot","density","line"].map(t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}}))}]:[],{label:"Color",icon:l.A,onClick:()=>{(0,i.getSession)(e).queueDialog(t=>[g,{model:e,handleClose:t}])}}]}}).views(e=>({trackMenuItems:()=>[...e.wiggleBaseTrackMenuItems(),{label:"Show...",icon:c.A,subMenu:[{label:"Show tooltips",type:"checkbox",checked:e.showTooltipsEnabled,onClick:()=>{e.setShowTooltips(!e.showTooltipsEnabled)}},...e.graphType?[{label:"Show inverted",type:"checkbox",checked:e.inverted,onClick:()=>{e.setInverted(!e.inverted)}},{label:"Show cross hatches",type:"checkbox",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[]]},...e.wiggleOnlyTrackMenuItems()]})).actions(e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{const{getQuantitativeStatsAutorun:t}=await n.e(2319).then(n.bind(n,82319));t(e)})()},async renderSvg(r){const{renderSvg:a}=await n.e(483).then(n.bind(n,70483));return a(e,r,t)}}}).postProcessSnapshot(e=>{if(!e)return e;const{invertedSetting:t,...n}=e;return{...n,...void 0!==t?{invertedSetting:t}:{}}})}},95542(e,t,n){n.d(t,{G:()=>s});var r=n(95548),a=n(23886),i=n(88068),o=n(90013);async function s({pluginManager:e,args:t}){const{sources:n,regions:s,adapterConfig:l,sessionId:c,bpPerPx:d}=t,u=(await(0,r.cK)(e,c,l)).dataAdapter,p=s[0],h=p.end-p.start,g=Math.floor(h/d),f=await(0,i._)(u.getFeatures(p,t).pipe((0,o.$)())),m=(0,a.groupBy)(f,e=>e.get("source")),y={},b=p.start,w=1/d;for(const e of n){const{name:t}=e,n=m[t]||[],r=new Float32Array(g);for(const e of n){const t=e.get("start"),n=e.get("end"),a=e.get("score"),i=Math.max(0,(t-b)*w|0),o=Math.min(g,(n-b)*w|0);for(let e=i;e<o;e++)0===r[e]&&(r[e]=a)}y[t]=Array.from(r)}return y}},80691(e,t,n){n.r(t),n.d(t,{default:()=>l});var r=n(30128),a=n(45084),i=n(23886),o=n(69566),s=n(44460);const l=(0,o.observer)(function(e){const{regions:t,features:n,bpPerPx:o,width:l,height:c,displayModel:d}=e,u=t[0],p=(0,r.useRef)(null);function h(e){let t=0;p.current&&(t=p.current.getBoundingClientRect().left);const r=e-t,a=u.reversed?l-r:r,i=u.start+o*a;let s;for(const e of n.values())if(i<=e.get("end")+o&&i>=e.get("start")){s=e;break}return s}return(0,s.jsx)("div",{ref:p,"data-testid":"wiggle-rendering-test",onMouseMove:e=>{d.setFeatureIdUnderMouse(h(e.clientX)?.id())},onClick:e=>{const t=h(e.clientX)?.id();t&&d.selectFeatureById(t).catch(e=>{console.error(e),(0,i.getSession)(d).notifyError(`${e}`,e)})},onMouseLeave:()=>{d.setFeatureIdUnderMouse(void 0)},style:{overflow:"visible",position:"relative",height:c},children:(0,s.jsx)(a.A,{...e})})})},59083(e,t,n){n.d(t,{LinearWiggleDisplayReactComponent:()=>C.default,Ay:()=>Te});var r=n(36082),a=n(61941),i=n(60459);const o=(0,i.S7)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier, <1 is higher resolution, >1 is lower resolution"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bigWigLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=n(30128),l=n(17378),c=n(23886),d=n(16640);const u=(0,s.lazy)(()=>n.e(186).then(n.bind(n,20186)));var p=n(7332);class h extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(4841).then(n.bind(n,24841));return t(e,this.pluginManager)}}var g=n(10533);const f=(0,i.S7)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue",contextVariable:["feature"]},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red",contextVariable:["feature"]},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:g.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0}),m=(0,i.S7)("DensityRenderer",{},{baseConfiguration:f,explicitlyTyped:!0});var y=n(19608);class b extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(8878).then(n.bind(n,38878));return t(e,this.pluginManager)}}const w=(0,i.S7)("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:f,explicitlyTyped:!0});var v=n(50492),S=n(77529);function x(){return(0,i.S7)("SharedWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:g.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:g.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:S.A,explicitlyTyped:!0})}var k=n(88642);var C=n(96870);class T extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(3232).then(n.bind(n,13232));return t(e,this.pluginManager)}}const A=(0,i.S7)("MultiDensityRenderer",{},{baseConfiguration:f,explicitlyTyped:!0});class M extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(6966).then(n.bind(n,46966));return t(e,this.pluginManager)}}const I=(0,i.S7)("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:f,explicitlyTyped:!0});var P=n(8297),L=n(92558),R=n(29458),F=n(34993),D=n(78749),N=n(759),B=n(59665),V=n.n(B);function E(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function z(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=H)):void 0===t&&(t=j);for(var n,r,a,i,o,s=new O(e),l=[s];n=l.pop();)if((a=t(n.data))&&(o=(a=Array.from(a)).length))for(n.children=a,i=o-1;i>=0;--i)l.push(r=a[i]=new O(a[i])),r.parent=n,r.depth=n.depth+1;return s.eachBefore($)}function j(e){return e.children}function H(e){return Array.isArray(e)?e[1]:null}function _(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function $(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function O(e){this.data=e,this.depth=this.height=0,this.parent=null}function G(e,t){return e.parent===t.parent?1:2}function W(e,t){return e+t.x}function U(e,t){return Math.max(e,t.y)}O.prototype=z.prototype={constructor:O,count:function(){return this.eachAfter(E)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,a,i=this,o=[i],s=[],l=-1;i=o.pop();)if(s.push(i),n=i.children)for(r=0,a=n.length;r<a;++r)o.push(n[r]);for(;i=s.pop();)e.call(t,i,++l,this);return this},eachBefore:function(e,t){for(var n,r,a=this,i=[a],o=-1;a=i.pop();)if(e.call(t,a,++o,this),n=a.children)for(r=n.length-1;r>=0;--r)i.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,a=r&&r.length;--a>=0;)n+=r[a].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),a=null;for(e=n.pop(),t=r.pop();e===t;)a=e,e=n.pop(),t=r.pop();return a}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var a=r.length;e!==n;)r.splice(a,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return z(this).eachBefore(_)},[Symbol.iterator]:function*(){var e,t,n,r,a=this,i=[a];do{for(e=i.reverse(),i=[];a=e.pop();)if(yield a,t=a.children)for(n=0,r=t.length;n<r;++n)i.push(t[n])}while(i.length)}};var q=n(84571),J=n(14926),X=n(91520);const K=()=>"#000000".replaceAll("0",()=>(~~(16*Math.random())).toString(16)),Q=(0,s.lazy)(()=>n.e(2104).then(n.bind(n,72104))),Z=(0,s.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(6167),n.e(7689),n.e(3892)]).then(n.bind(n,33892))),Y=(0,s.lazy)(()=>n.e(3433).then(n.bind(n,53433))),ee=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]),te=function(e,t){return g.types.compose("MultiLinearWiggleDisplay",(0,q.A)(t),g.types.model({type:g.types.literal("MultiLinearWiggleDisplay"),layout:g.types.optional(g.types.frozen(),[]),showSidebar:!0,clusterTree:g.types.maybe(g.types.string),treeAreaWidth:g.types.optional(g.types.number,80),showTreeSetting:g.types.maybe(g.types.boolean),subtreeFilter:g.types.maybe(g.types.array(g.types.string))})).volatile(()=>({sourcesLoadingStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0,hoveredTreeNode:void 0,treeCanvas:void 0,mouseoverCanvas:void 0})).actions(e=>({setShowSidebar(t){e.showSidebar=t},setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,R.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setLayout(t,n=!0){const r=n&&e.clusterTree&&e.layout.length===t.length&&e.layout.some((e,n)=>e.name!==t[n]?.name);e.layout=t,r&&(e.clusterTree=void 0)},clearLayout(){e.layout=[],e.clusterTree=void 0},setClusterTree(t){e.clusterTree=t},setTreeAreaWidth(t){e.treeAreaWidth=t},setShowTree(t){e.showTreeSetting=t},setSubtreeFilter(t){e.subtreeFilter=t?(0,g.cast)(t):void 0},setHoveredTreeNode(t){e.hoveredTreeNode=t},setTreeCanvasRef(t){e.treeCanvas=t||void 0},setMouseoverCanvasRef(t){e.mouseoverCanvas=t||void 0},setSources(t){V()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t}})).views(e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return Q},get rendererTypeName(){const t=e.rendererTypeNameSimple,n=ee.get(t);if(!n)throw new Error(`unknown renderer ${t}`);return n}})).views(e=>({get graphType(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName},get needsFullHeightScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName},get isMultiRow(){return"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName||"MultiDensityRenderer"===e.rendererTypeName},get canHaveFill(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName},get needsCustomLegend(){return"MultiDensityRenderer"===e.rendererTypeName},get renderColorBoxes(){return!("MultiRowLineRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName)},get prefersOffset(){return this.isMultiRow},get sourcesWithoutLayout(){const t=Object.fromEntries(e.sourcesVolatile?.map(e=>[e.name,e])||[]),n=e.sourcesVolatile;return n?.map(e=>({...t[e.name],...e})).map((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":L.set1[t]||K())}))},get sources(){const t=Object.fromEntries(e.sourcesVolatile?.map(e=>[e.name,e])||[]),n=e.layout.length?e.layout:e.sourcesVolatile;let r=n?.map(e=>({...t[e.name],...e})).map((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":L.set1[t]||K())}));if(r&&e.subtreeFilter?.length){const t=new Set(e.subtreeFilter);r=r.filter(e=>t.has(e.name))}return r},get quantitativeStatsReady(){return(0,c.getContainingView)(e).initialized&&e.featureDensityStatsReadyAndRegionNotTooLarge&&!e.error}})).views(e=>({get showTree(){return e.showTreeSetting??!0},get rowHeight(){const{sources:t,height:n,isMultiRow:r}=e;return r?n/(t?.length||1):n},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return(0,l.FI)(e,"minimalTicks")||this.rowHeightTooSmallForScalebar},get root(){const t=e.clusterTree;if(!t)return;let n=z((0,P.Od)(t),e=>e.children).sum(e=>e.children?0:1).sort((e,t)=>(0,N.A)(e.data.height||1,t.data.height||1));if(e.subtreeFilter?.length){const t=new Set(e.subtreeFilter),r=e=>e.children?.length?e.children.flatMap(e=>r(e)):[e.data.name],a=e=>{const n=r(e);if(n.length===t.size&&n.every(e=>t.has(e)))return e;if(e.children)for(const t of e.children){const e=a(t);if(e)return e}},i=a(n);i&&(n=i)}return n}})).views(e=>({get totalHeight(){return e.rowHeight*(e.sources?.length||1)},get hierarchy(){const t=e.root;if(!t||!e.sources?.length)return;const n=function(){var e=G,t=1,n=1,r=!1;function a(a){var i,o=0;a.eachAfter(function(t){var n=t.children;n?(t.x=function(e){return e.reduce(W,0)/e.length}(n),t.y=function(e){return 1+e.reduce(U,0)}(n)):(t.x=i?o+=e(t,i):0,t.y=0,i=t)});var s=function(e){for(var t;t=e.children;)e=t[0];return e}(a),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(a),c=s.x-e(s,l)/2,d=l.x+e(l,s)/2;return a.eachAfter(r?function(e){e.x=(e.x-a.x)*t,e.y=(a.y-e.y)*n}:function(e){e.x=(e.x-c)/(d-c)*t,e.y=(1-(a.y?e.y/a.y:1))*n})}return a.separation=function(t){return arguments.length?(e=t,a):e},a.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],a):r?null:[t,n]},a.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],a):r?[t,n]:null},a}();return n.size([e.rowHeight*e.sources.length,e.treeAreaWidth]),n.separation(()=>1),n(t),t}})).views(e=>{const{renderProps:t}=e;return{adapterProps:()=>({...t(),config:e.rendererConfig,filters:e.filters,resolution:e.resolution,sources:e.sources}),get ticks(){const{scaleType:t,domain:n,isMultiRow:r,rowHeight:a,useMinimalTicks:i}=e;if(!n)return;const o=r?0:X.YSCALEBAR_LABEL_OFFSET,s=(0,J.A)((0,X.getScale)({scaleType:t,domain:n,range:[a-o,o],inverted:(0,l.FI)(e,"inverted")}),4);return i?{...s,values:n}:s},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,c.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx}}}).views(e=>({get legendFontSize(){return Math.min(e.rowHeight,8)},get canDisplayLegendLabels(){return e.rowHeight>7},get labelWidth(){return(0,c.max)(e.sources?.map(e=>(0,c.measureText)(e.name,this.legendFontSize)).map(e=>this.canDisplayLegendLabels?e:20)||[])},renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.stats,displayCrossHatches:e.displayCrossHatches,height:e.height,ticks:e.ticks,stats:e.stats,scaleOpts:e.scaleOpts,offset:e.isMultiRow?0:X.YSCALEBAR_LABEL_OFFSET}},renderingProps:()=>({displayModel:e}),get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:1===e.minSize?1:2}})).views(e=>{const{trackMenuItems:t}=e,n=(0,l.FI)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Show...",icon:D.A,subMenu:[{label:"Show tooltips",type:"checkbox",checked:e.showTooltipsEnabled,onClick:()=>{e.setShowTooltips(!e.showTooltipsEnabled)}},{label:"Show sidebar",type:"checkbox",checked:e.showSidebar,onClick:()=>{e.setShowSidebar(!e.showSidebar)}},...e.isMultiRow?[{label:"Show tree"+(e.clusterTree?"":" (run clustering first)"),type:"checkbox",checked:e.showTree,disabled:!e.clusterTree,onClick:()=>{e.setShowTree(!e.showTree)}},...e.subtreeFilter?.length?[{label:"Clear subtree filter",onClick:()=>{e.setSubtreeFilter(void 0)}}]:[]]:[],...e.graphType?[{type:"checkbox",label:"Show cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[]]},{label:"Score",icon:F.A,subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((t,n)=>({label:t,type:"radio",checked:e.fillSetting===n,onClick:()=>{e.setFill(n)}}))}]:[],...n?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map(t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}}))}]:[],...e.isMultiRow?[{label:"Cluster rows by score",onClick:()=>{(0,c.getSession)(e).queueDialog(t=>[Y,{model:e,handleClose:t}])}}]:[],{label:"Edit colors/arrangement...",onClick:()=>{(0,c.getSession)(e).queueDialog(t=>[Z,{model:e,handleClose:t}])}}]}}).actions(e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const[{getMultiWiggleSourcesAutorun:t},{getQuantitativeStatsAutorun:r},{setupTreeDrawingAutorun:a}]=await Promise.all([n.e(1042).then(n.bind(n,61042)),n.e(2319).then(n.bind(n,82319)),n.e(5782).then(n.bind(n,65782))]);r(e),t(e),a(e)}catch(t){(0,g.isAlive)(e)&&(console.error(t),(0,c.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(r){const{renderSvg:a}=await n.e(4775).then(n.bind(n,94775));return a(e,r,t)}}}).postProcessSnapshot(e=>{if(!e)return e;const{layout:t,showSidebar:n,clusterTree:r,treeAreaWidth:a,showTreeSetting:i,subtreeFilter:o,...s}=e;return{...s,...t?.length?{layout:t}:{},...n?{}:{showSidebar:n},...void 0!==r?{clusterTree:r}:{},...80!==a?{treeAreaWidth:a}:{},...void 0!==i?{showTreeSetting:i}:{},...o?.length?{subtreeFilter:o}:{}}})};var ne=n(88237),re=n(5431),ae=n(8175);function ie({features:e}){return e.map(e=>`${e.get("refName")}\t${e.get("start")}\t${e.get("end")}\t${e.get("score")??0}`).join("\n")}class oe extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(8482).then(n.bind(n,78482));return t(e,this.pluginManager)}}const se=(0,i.S7)("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:f,explicitlyTyped:!0});class le extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(4096).then(n.bind(n,14096));return t(e,this.pluginManager)}}const ce=(0,i.S7)("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:f,explicitlyTyped:!0}),de=(0,i.S7)("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[],description:"array of subadapter JSON objects"},bigWigs:{type:"frozen",description:"array of bigwig filenames, alternative to the subadapters slot",defaultValue:[]}},{explicitlyTyped:!0});var ue=n(91667);class pe extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(7684).then(n.bind(n,37684));return t(e,this.pluginManager)}}const he=(0,i.S7)("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:f,explicitlyTyped:!0});var ge=n(95548),fe=n(8709);class me extends fe.A{name="WiggleGetGlobalQuantitativeStats";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:i}=r,{dataAdapter:o}=await(0,ge.cK)(n,i,a);return o.getGlobalStats(r)}}class ye extends fe.A{name="WiggleGetMultiRegionQuantitativeStats";async serializeArguments(e,t){const n=this.pluginManager,r=n.rootModel?.session?.assemblyManager;if(!r)throw new Error("no assembly manager");let a=e.staticBlocks;return e.staticBlocks?.length&&(a=(await(0,c.renameRegionsIfNeeded)(r,{...e,regions:e.staticBlocks})).regions),{...await super.serializeArguments(e,t),staticBlocks:a}}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:a,staticBlocks:i,adapterConfig:o,sessionId:s}=r,{dataAdapter:l}=await(0,ge.cK)(n,s,o);return l.getMultiRegionQuantitativeStats(a,{...r,staticBlocks:i})}}class be extends fe.A{name="MultiWiggleGetSources";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:a,adapterConfig:i,sessionId:o}=r,{dataAdapter:s}=await(0,ge.cK)(n,o,i);return s.getSources(a,r)}}var we=n(95542);class ve extends fe.A{name="MultiWiggleGetScoreMatrix";async execute(e,t){const n=await this.deserializeArguments(e,t);return(0,we.G)({args:n,pluginManager:this.pluginManager})}}class Se extends fe.A{name="MultiWiggleClusterScoreMatrix";async execute(e,t){const r=await this.deserializeArguments(e,t),{executeClusterScoreMatrix:a}=await Promise.all([n.e(6567),n.e(1251)]).then(n.bind(n,11251));return a({pluginManager:this.pluginManager,args:r})}}class xe extends p.default{supportsSVG=!0;async render(e){const{makeImageData:t}=await n.e(3895).then(n.bind(n,13895));return t(e,this.pluginManager)}}const ke=(0,i.S7)("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:f,explicitlyTyped:!0});var Ce=n(80691);class Te extends r.A{name="WigglePlugin";install(e){e.addAdapterType(()=>new a.A({name:"MultiWiggleAdapter",displayName:"Multi-wiggle adapter",configSchema:de,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(4933).then(n.bind(n,44933)).then(e=>e.default)})),e.addAdapterType(()=>new a.A({name:"BigWigAdapter",displayName:"BigWig adapter",configSchema:o,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>Promise.all([n.e(8113),n.e(8789)]).then(n.bind(n,98789)).then(e=>e.default)})),function(e){e.addTrackType(()=>{const t=function(e){return(0,i.S7)("QuantitativeTrack",{},{baseConfiguration:(0,ae.J)(e)})}(e);return new ne.A({name:"QuantitativeTrack",displayName:"Quantitative track",configSchema:t,stateModel:(0,re.E)(e,"QuantitativeTrack",t).views(()=>({saveTrackFileFormatOptions:()=>({bedGraph:{name:"BedGraph",extension:"bedgraph",callback:ie}})}))})})}(e),function(e){e.addTrackType(()=>{const t=(e=>(0,i.S7)("MultiQuantitativeTrack",{},{baseConfiguration:(0,ae.J)(e)}))(e);return new ne.A({name:"MultiQuantitativeTrack",displayName:"Multi-quantitative track",configSchema:t,stateModel:(0,re.E)(e,"MultiQuantitativeTrack",t).views(()=>({saveTrackFileFormatOptions:()=>({bedGraph:{name:"BedGraph",extension:"bedgraph",callback:ie}})}))})})}(e),function(e){e.addDisplayType(()=>{const t=function(e){const t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return(0,i.S7)("LinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:g.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,i.S7)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:x(),explicitlyTyped:!0})}(e),r=(0,k.A)(e,t);return new v.A({name:"LinearWiggleDisplay",displayName:"Wiggle display",configSchema:t,stateModel:r,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,s.lazy)(()=>Promise.resolve().then(n.bind(n,96870)))})})}(e),function(e){e.addDisplayType(()=>{const t=function(e){const t=e.getRendererType("MultiXYPlotRenderer").configSchema,n=e.getRendererType("MultiDensityRenderer").configSchema,r=e.getRendererType("MultiRowXYPlotRenderer").configSchema,a=e.getRendererType("MultiLineRenderer").configSchema,o=e.getRendererType("MultiRowLineRenderer").configSchema;return(0,i.S7)("MultiLinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:g.types.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:(0,i.S7)("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:n,MultiRowXYPlotRenderer:r,MultiLineRenderer:a,MultiRowLineRenderer:o}),height:{type:"number",defaultValue:200}},{baseConfiguration:x(),explicitlyTyped:!0})}(e);return new v.A({name:"MultiLinearWiggleDisplay",displayName:"Multi-wiggle display",configSchema:t,stateModel:te(0,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,s.lazy)(()=>n.e(8211).then(n.bind(n,68211)))})})}(e),function(e){e.addRendererType(()=>new b({name:"LinePlotRenderer",ReactComponent:(0,s.lazy)(()=>Promise.resolve().then(n.bind(n,80691))),configSchema:w,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new xe({name:"XYPlotRenderer",ReactComponent:(0,s.lazy)(()=>Promise.resolve().then(n.bind(n,80691))),configSchema:ke,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new h({name:"DensityRenderer",ReactComponent:(0,s.lazy)(()=>Promise.resolve().then(n.bind(n,80691))),configSchema:m,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new pe({name:"MultiXYPlotRenderer",ReactComponent:(0,s.lazy)(()=>n.e(3944).then(n.bind(n,63944))),configSchema:he,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new le({name:"MultiRowXYPlotRenderer",ReactComponent:(0,s.lazy)(()=>n.e(3944).then(n.bind(n,63944))),configSchema:ce,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new T({name:"MultiDensityRenderer",ReactComponent:(0,s.lazy)(()=>n.e(3944).then(n.bind(n,63944))),configSchema:A,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new M({name:"MultiLineRenderer",ReactComponent:(0,s.lazy)(()=>n.e(3944).then(n.bind(n,63944))),configSchema:I,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new oe({name:"MultiRowLineRenderer",ReactComponent:(0,s.lazy)(()=>n.e(3944).then(n.bind(n,63944))),configSchema:se,pluginManager:e}))}(e),function(e){e.addAddTrackWorkflowType(()=>new ue.A({name:"Multi-wiggle track",ReactComponent:(0,s.lazy)(()=>n.e(9297).then(n.bind(n,69297))),stateModel:g.types.model({})}))}(e),function(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",(e,t)=>{const{session:n}=t;return[...e,...(0,d.QW)(n)?[{label:"Create multi-wiggle track",onClick:e=>{const t=e.selection;(0,c.getSession)(e).queueDialog(n=>[u,{tracks:t,onClose:(t,r)=>{t&&r&&function({model:e,arg:t}){const n=e.selection,r=n.map(e=>(0,l.QZ)(e,"name")),a=n.map(e=>(0,l.QZ)(e,"adapter")).map((e,t)=>({...e,source:r[t]})),i=`multitrack-${Date.now()}-sessionTrack`,o=(0,c.getSession)(e);(0,d.QW)(o)&&(o.addTrackConf({type:"MultiQuantitativeTrack",trackId:i,name:t.name,assemblyNames:[...new Set(n.flatMap(e=>(0,l.QZ)(e,"assemblyNames")))],adapter:{type:"MultiWiggleAdapter",subadapters:a}}),e.view.showTrack(i))}({model:e,arg:r}),n()}}])}}]:[]]})}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,y.getFileName)(t);return(0,c.testAdapter)(a,/\.(bw|bigwig)$/i,r,"BigWigAdapter")?{type:"BigWigAdapter",bigWigLocation:t}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"BigWigAdapter"===t?"QuantitativeTrack":e(t))}(e),e.addRpcMethod(()=>new me(e)),e.addRpcMethod(()=>new ye(e)),e.addRpcMethod(()=>new be(e)),e.addRpcMethod(()=>new ve(e)),e.addRpcMethod(()=>new Se(e))}exports={LinearWiggleDisplayReactComponent:C.default,XYPlotRendererReactComponent:Ce.default,XYPlotRenderer:xe,linearWiggleDisplayModelFactory:k.A,xyPlotRendererConfigSchema:ke,utils:X}}},84571(e,t,n){n.d(t,{A:()=>h});var r=n(30128),a=n(60459),i=n(17378),o=n(23886),s=n(16640),l=n(29458),c=n(10533),d=n(89346),u=n(91520);const p=(0,r.lazy)(()=>n.e(4408).then(n.bind(n,74408)));function h(e){return c.types.compose(d.L,c.types.model({selectedRendering:c.types.optional(c.types.string,""),resolution:c.types.optional(c.types.number,1),fill:c.types.maybe(c.types.boolean),minSize:c.types.maybe(c.types.number),color:c.types.maybe(c.types.string),posColor:c.types.maybe(c.types.string),negColor:c.types.maybe(c.types.string),summaryScoreMode:c.types.maybe(c.types.string),rendererTypeNameState:c.types.maybe(c.types.string),scale:c.types.maybe(c.types.string),autoscale:c.types.maybe(c.types.string),displayCrossHatches:c.types.maybe(c.types.boolean),constraints:c.types.optional(c.types.model({max:c.types.maybe(c.types.number),min:c.types.maybe(c.types.number)}),{}),configuration:(0,a.AK)(e)})).volatile(()=>({message:void 0,stats:void 0,statsFetchInProgress:void 0})).actions(e=>({updateQuantitativeStats(t,n){const{currStatsBpPerPx:r,scoreMin:a,scoreMax:i,scoreMeanMin:o,scoreMeanMax:s}=t,l=1e-6;(!e.stats||Math.abs(e.stats.scoreMax-i)>l||Math.abs(e.stats.scoreMin-a)>l||e.stats.statsRegion!==n)&&(e.stats={currStatsBpPerPx:r,scoreMin:a,scoreMax:i,scoreMeanMin:o,scoreMeanMax:s,statsRegion:n})},setColor(t){e.color=t},setPosColor(t){e.posColor=t},setNegColor(t){e.negColor=t},setStatsLoading(t){e.statsFetchInProgress&&(0,l.CF)(e.statsFetchInProgress),e.statsFetchInProgress=t},selectFeature(t){const n=(0,o.getSession)(e);(0,s.mY)(n)&&n.setSelection(t)},setResolution(t){e.resolution=t},setFill(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale(){e.scale="log"===e.scale?"linear":"log"},setScaleType(t){e.scale=t},setSummaryScoreMode(t){e.summaryScoreMode=t},setAutoscale(t){e.autoscale=t},setMaxScore(t){e.constraints.max=t},setRendererType(t){e.rendererTypeNameState=t},setMinScore(t){e.constraints.min=t},toggleCrossHatches(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches(t){e.displayCrossHatches=t}})).views(e=>({get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){return e.rendererTypeNameState??(0,i.FI)(e,"defaultRendering")},get filters(){},get scaleType(){return e.scale??(0,i.FI)(e,"scaleType")},get maxScore(){return e.constraints.max??(0,i.FI)(e,"maxScore")},get minScore(){return e.constraints.min??(0,i.FI)(e,"minScore")}})).views(e=>({get adapterCapabilities(){const t=e.adapterTypeName,{pluginManager:n}=(0,o.getEnv)(e);return n.getAdapterType(t).adapterCapabilities},get rendererConfig(){const{color:t,displayCrossHatches:n,fill:r,minSize:a,negColor:o,posColor:s,summaryScoreMode:l,scaleType:c,rendererTypeName:d}=e,u=e.configuration.renderers?.[d];return{scaleType:c??(0,i.QZ)(u,"scaleType"),filled:r??(0,i.QZ)(u,"filled"),displayCrossHatches:n??(0,i.QZ)(u,"displayCrossHatches"),summaryScoreMode:l??(0,i.QZ)(u,"summaryScoreMode"),color:t??(0,i.QZ)(u,"color"),negColor:o??(0,i.QZ)(u,"negColor"),posColor:s??(0,i.QZ)(u,"posColor"),minSize:a??(0,i.QZ)(u,"minSize")}},get autoscaleType(){return e.autoscale??(0,i.FI)(e,"autoscale")}})).views(e=>{let t=[0,0];return{get domain(){const{stats:n,scaleType:r,minScore:a,maxScore:i,rendererConfig:o}=e;if(!n)return;const{summaryScoreMode:s}=o,l="mean"===s||"avg"===s,c=l?n.scoreMeanMin??n.scoreMin:n.scoreMin,d=l?n.scoreMeanMax??n.scoreMax:n.scoreMax,p=(0,u.getNiceDomain)({domain:[c,d],bounds:[a,i],scaleType:r});return"log"===r&&p[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(p)&&(t=p),t)}}}).views(e=>({get filled(){return e.rendererConfig.filled},get summaryScoreModeSetting(){return e.rendererConfig.summaryScoreMode},get scaleOpts(){return{domain:e.domain,stats:e.stats,autoscaleType:e.autoscaleType,scaleType:e.scaleType,inverted:(0,i.FI)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get displayCrossHatchesSetting(){return e.rendererConfig.displayCrossHatches},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")}})).views(e=>({scoreTrackMenuItems:()=>[...e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map(t=>({label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:()=>{e.setSummaryScoreMode(t)}}))}]:[],{label:"Scale type",subMenu:[{label:"Linear scale",type:"radio",checked:"linear"===e.scaleType,onClick:()=>{e.setScaleType("linear")}},{label:"Log scale",type:"radio",checked:"log"===e.scaleType,onClick:()=>{e.setScaleType("log")}}]},{label:"Autoscale type",subMenu:[["local","Local"],...e.hasGlobalStats?[["global","Global"],["globalsd","Global  3"]]:[],["localsd","Local  3"]].map(([t,n])=>({label:n,type:"radio",checked:e.autoscaleType===t,onClick:()=>{e.setAutoscale(t)}}))},{label:"Set min/max score",onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[p,{model:e,handleClose:t}])}}]})).actions(e=>{const{reload:t}=e;return{async reload(){e.setError(),t()}}}).postProcessSnapshot(e=>{if(!e)return e;const{selectedRendering:t,resolution:n,fill:r,minSize:a,color:i,posColor:o,negColor:s,summaryScoreMode:l,rendererTypeNameState:c,scale:d,autoscale:u,displayCrossHatches:p,constraints:h,...g}=e;return{...g,...t?{selectedRendering:t}:{},...1!==n?{resolution:n}:{},...void 0!==r?{fill:r}:{},...void 0!==a?{minSize:a}:{},...void 0!==i?{color:i}:{},...void 0!==o?{posColor:o}:{},...void 0!==s?{negColor:s}:{},...void 0!==l?{summaryScoreMode:l}:{},...void 0!==c?{rendererTypeNameState:c}:{},...void 0!==d?{scale:d}:{},...void 0!==u?{autoscale:u}:{},...void 0!==p?{displayCrossHatches:p}:{},...void 0!==h.min||void 0!==h.max?{constraints:h}:{}}})}},20702(e,t,n){n.d(t,{A:()=>o});var r=n(87377),a=n(69566),i=n(44460);const o=(0,a.observer)(function({model:e,orientation:t}){const{ticks:n}=e,a=(0,r.A)();if(!n)return null;const{range:o,values:s,position:l}=n,c=a.palette.background.default,d=a.palette.text.primary,u="left"===t,p=u?-1:1,h=o[0]+.5,g=o[1]+.5;return(0,i.jsxs)("g",{fill:"none",fontSize:10,fontFamily:"sans-serif",textAnchor:u?"end":"start",strokeWidth:1,children:[(0,i.jsx)("path",{stroke:d,d:`M${6*p},${h}H0.5V${g}H${6*p}`}),s.map((e,t)=>{const n=l(e);return(0,i.jsxs)("g",{transform:`translate(0,${Number.isFinite(n)?n:0})`,children:[(0,i.jsx)("line",{stroke:d,x2:6*p,y1:.5,y2:.5}),(0,i.jsx)("text",{stroke:c,strokeWidth:2.5,paintOrder:"stroke",fill:d,dy:"0.32em",x:9*p,y:.5,children:e})]},t)})]})})},14926(e,t,n){function r(e,t){return{range:e.range(),values:e.ticks(t),format:e.tickFormat(t),position:e.copy()}}n.d(t,{A:()=>r})},91520(e,t,n){n.r(t),n.d(t,{WIGGLE_CLIP_HEIGHT:()=>y,WIGGLE_COLOR_DEFAULT:()=>l,WIGGLE_FUDGE_FACTOR:()=>m,YSCALEBAR_LABEL_OFFSET:()=>s,fillRectCtx:()=>w,getColorCallback:()=>c,getNiceDomain:()=>p,getOrigin:()=>u,getScale:()=>d,getScaleValues:()=>b,round:()=>f,serializeWiggleFeature:()=>g,toP:()=>h});var r=n(17378),a=n(91121),i=n(84405),o=n(70809);const s=5,l="#f0f";function c(e,t){const n=(0,r.QZ)(e,"color"),a=e.color?.isCallback;if(a)return t=>(0,r.QZ)(e,"color",{feature:t});if(n!==l)return()=>n;if(t?.defaultColor)return()=>t.defaultColor;const i=(0,r.QZ)(e,"bicolorPivotValue"),o=(0,r.QZ)(e,"negColor"),s=(0,r.QZ)(e,"posColor");return(e,t)=>t<i?o:s}function d({domain:e,range:t,scaleType:n,pivotValue:r,inverted:s}){let l;const[c,d]=e;if(void 0===c||void 0===d)throw new Error("invalid domain");if("linear"===n)l=(0,a.A)();else if("log"===n)l=(0,i.A)().base(2);else{if("quantize"!==n)throw new Error("undefined scaleType");l=(0,o.A)()}l.domain(void 0!==r?[c,r,d]:[c,d]),l.nice();const[u,p]=t;if(void 0===u||void 0===p)throw new Error("invalid range");return l.range(s?t.slice().reverse():t),l}function u(e){return"log"===e?1:0}function p({scaleType:e,domain:t,bounds:n}){const[r,s]=n;let[l,c]=t;"linear"===e&&(c<0&&(c=0),l>0&&(l=0)),"log"===e&&l>=0&&c>1&&(l=1),void 0!==r&&r!==Number.MIN_VALUE&&(l=r),void 0!==s&&s!==Number.MAX_VALUE&&(c=s);const d=(e=>{if("linear"===e)return(0,a.A)();if("log"===e){const e=(0,i.A)();return e.base(2),e}if("quantize"===e)return(0,o.A)();throw new Error(`undefined scaleType ${e}`)})(e);return d.domain([l,c]),d.nice(),d.domain()}function h(e=0){return+e.toPrecision(6)}function g(e){return{uniqueId:e.id(),start:e.get("start"),end:e.get("end"),score:e.get("score"),source:e.get("source"),refName:e.get("refName"),maxScore:e.get("maxScore"),minScore:e.get("minScore"),summary:e.get("summary")}}function f(e){return Math.round(1e5*e)/1e5}const m=.3,y=2;function b(e,t){const n=d({...e,range:[0,t]}).domain(),r=n[0],a=n[1],i=a-r,o="log"===e.scaleType,s=0!==i?t/i:0,l=Math.log(2),c=Math.log(r)/l,u=Math.log(a)/l-c;return{niceMin:r,niceMax:a,height:t,linearRatio:s,log2:l,logMin:c,logRatio:0!==u?t/u:0,isLog:o}}function w(e,t,n,r,a,i){n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),i&&(a.fillStyle=i),a.fillRect(e,t,n,r)}},56246(e,t,n){n.d(t,{A:()=>Xl});var r=n(36082),a=n(30128),i=n(52188),o=n(60459);const s=(0,o.S7)("AlignmentsFeatureWidget",{});var l=n(17975),c=n(10533);function d(e){return c.types.compose((0,l.n)(e),c.types.model("AlignmentsFeatureWidget",{type:c.types.literal("AlignmentsFeatureWidget")}))}function u(e){e.addWidgetType(()=>new i.A({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:s,stateModel:d(e),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8705),n.e(5043),n.e(6569),n.e(2943),n.e(1120)]).then(n.bind(n,71120)))}))}var p=n(88237),h=n(5431),g=n(8175);function f(e){return e?e.split(" ").map(e=>String.fromCharCode(+e+33)).join(""):"*"}function m({features:e,session:t,assemblyName:n}){const r=["@HD\tVN:1.6\tSO:unsorted"],{assemblyManager:a}=t,i=a.get(n);if(i){const e=i.regions;if(e)for(const t of e){const e=t.end-t.start;r.push(`@SQ\tSN:${t.refName}\tLN:${e}`)}}r.push("@PG\tID:jbrowse\tPN:JBrowse\tVN:2");for(const t of e){const e=t.get("start"),n=[t.get("name")||t.get("id")||"*",t.get("flag")??"0",t.get("refName")||"*",String(e+1),t.get("mapq")??"255",t.get("CIGAR")||"*",t.get("next_ref")||"*",t.get("next_pos")??"0",t.get("template_len")??"0",t.get("seq")||"*",f(t.get("qual"))];r.push(n.join("\t"))}return r.join("\n")}function y(e){e.addTrackType(()=>{const t=(n=e,(0,o.S7)("AlignmentsTrack",{},{baseConfiguration:(0,g.J)(n)}));var n;const r=new p.A({name:"AlignmentsTrack",displayName:"Alignments track",configSchema:t,stateModel:(0,h.E)(e,"AlignmentsTrack",t).views(()=>({saveTrackFileFormatOptions:()=>({sam:{name:"SAM",extension:"sam",callback:m,helpText:"Note: SAM format export is experimental and does not currently output optional tags. The output may not fully conform to the SAM specification and should be validated before use in production workflows."}})}))}),a=e.getDisplayType("LinearAlignmentsDisplay");return r.addDisplayType(a),r})}var b=n(61941);const w=(0,o.S7)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,o.S7)("BamIndex",{indexType:{model:c.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",description:"size to fetch in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:5e6}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bamLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.bai`,baseUri:e.baseUri}}}:e});function v(e){e.addAdapterType(()=>new b.A({name:"BamAdapter",displayName:"BAM adapter",configSchema:w,getAdapterClass:()=>Promise.all([n.e(5920),n.e(710)]).then(n.bind(n,10710)).then(e=>e.default)}))}const S=(0,o.S7)("CramAdapter",{fetchSizeLimit:{type:"number",description:"size in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,cramLocation:{uri:e.uri,baseUri:e.baseUri},craiLocation:{uri:`${e.uri}.crai`,baseUri:e.baseUri}}:e});function x(e){e.addAdapterType(()=>new b.A({name:"CramAdapter",displayName:"CRAM adapter",configSchema:S,getAdapterClass:()=>Promise.all([n.e(5522),n.e(8708)]).then(n.bind(n,48708)).then(e=>e.default)}))}var k=n(23886),C=n(19608);function T(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t),i=n&&(0,C.getFileName)(n);return(0,k.testAdapter)(a,/\.bam$/i,r,"BamAdapter")?{type:"BamAdapter",bamLocation:t,index:{location:n||(0,C.makeIndex)(t,".bai"),indexType:(0,C.makeIndexType)(i,"CSI","BAI")}}:(0,k.testAdapter)(a,/\.cram$/i,r,"CramAdapter")?{type:"CramAdapter",cramLocation:t,craiLocation:n||(0,C.makeIndex)(t,".crai")}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t))}const A=(0,o.S7)("HtsgetBamAdapter",{htsgetBase:{type:"string",description:"the base URL to fetch from",defaultValue:""},htsgetTrackId:{type:"string",description:"the trackId, which is appended to the base URL",defaultValue:""}},{explicitlyTyped:!0});function M(e){e.addAdapterType(()=>new b.A({name:"HtsgetBamAdapter",displayName:"Htsget BAM adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:A,getAdapterClass:()=>Promise.all([n.e(5920),n.e(4036)]).then(n.bind(n,44036)).then(e=>e.default)}))}var I=n(50492),P=n(77529),L=n(17378),R=n(9789),F=n(59665),D=n.n(F),N=n(44934);function B(e){return e.getDisplayElements().filter(e=>"LinearAlignmentsDisplay"===e.subDisplay?.type).filter(e=>e.subDisplay?.lowerPanel)}const V=function(e,t){return c.types.compose("LinearAlignmentsDisplay",R.q,function(e,t){return c.types.model({PileupDisplay:c.types.maybe(c.types.union(...B(e).map(e=>e.stateModel))),SNPCoverageDisplay:c.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:c.types.literal("LinearAlignmentsDisplay"),configuration:(0,o.AK)(t),heightPreConfig:c.types.maybe(c.types.number),userFeatureScreenDensity:c.types.maybe(c.types.number),lowerPanelType:"LinearPileupDisplay"})}(e,t)).volatile(()=>({scrollTop:0})).actions(e=>({setScrollTop(t){e.scrollTop=t},setSNPCoverageHeight(t){e.snpCovHeight=t},setShowLegend(t){e.PileupDisplay?.setShowLegend(t)}})).views(e=>({get height(){return e.heightPreConfig??(0,L.FI)(e,"height")},get featureIdUnderMouse(){return e.PileupDisplay.featureIdUnderMouse||e.SNPCoverageDisplay.featureIdUnderMouse},get showLegend(){return e.PileupDisplay?.showLegend},svgLegendWidth(t){const n=e.PileupDisplay?.svgLegendWidth?.(t)??0,r=e.SNPCoverageDisplay?.svgLegendWidth?.(t)??0;return Math.max(n,r)}})).views(e=>({get pileupConf(){return{...(0,L.FI)(e,"pileupDisplay"),type:e.lowerPanelType,displayId:`${e.configuration.displayId}_${e.lowerPanelType}_xyz`}},getFeatureByID:(t,n)=>e.PileupDisplay.getFeatureByID(t,n),searchFeatureByID:t=>e.PileupDisplay.searchFeatureByID?.(t),get features(){return e.PileupDisplay.features},get DisplayBlurb(){return e.PileupDisplay?.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get coverageConf(){return{...(0,L.FI)(e,"snpCoverageDisplay"),displayId:`${e.configuration.displayId}_snpcoverage_xyz`}},notReady:()=>e.PileupDisplay?.renderProps().notReady||e.SNPCoverageDisplay?.renderProps().notReady})).actions(e=>({setSNPCoverageDisplay(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setFeatureDensityStatsLimit(t){e.PileupDisplay.setFeatureDensityStatsLimit(t),e.SNPCoverageDisplay.setFeatureDensityStatsLimit(t)},setPileupDisplay(t){e.PileupDisplay={type:t.type||"LinearPileupDisplay",configuration:t}},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.heightPreConfig),setLowerPanelType(t){e.lowerPanelType=t},resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n}})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(function(){const{SNPCoverageDisplay:t,PileupDisplay:n,coverageConf:r,pileupConf:a}=e;t?D()(r,(0,c.getSnapshot)(t.configuration))||(t.setHeight(e.snpCovHeight),t.setConfig(e.coverageConf)):e.setSNPCoverageDisplay(r),e.lowerPanelType!==n?.type?e.setPileupDisplay(a):D()(a,(0,c.getSnapshot)(n.configuration))||n.setConfig(e.pileupConf)},{name:"AlignmentsDisplayConfig"})),(0,c.addDisposer)(e,(0,N.autorun)(function(){e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)},{name:"SNPCoverageHeight"})),(0,c.addDisposer)(e,(0,N.autorun)(function(){e.PileupDisplay.setHeight(e.height-e.SNPCoverageDisplay.height)},{name:"PileupHeight"})),(0,c.addDisposer)(e,(0,N.autorun)(function(){const t=e.PileupDisplay.colorBy;"modifications"===t?.type||"methylation"===t?.type?e.SNPCoverageDisplay.setColorScheme(t):e.SNPCoverageDisplay.colorBy&&e.SNPCoverageDisplay.setColorScheme(void 0)},{name:"SyncColorBy"})),(0,c.addDisposer)(e,(0,N.autorun)(function(){const t=e.PileupDisplay.filterBy;e.SNPCoverageDisplay.setFilterBy(t)},{name:"SyncFilterBy"}))},async renderSvg(t){const{renderSvg:r}=await n.e(1814).then(n.bind(n,31814));return r(e,t)}})).views(t=>{const{trackMenuItems:n}=t;return{trackMenuItems(){if(!t.PileupDisplay)return[];const r=B(e).map(e=>({type:"radio",label:e.displayName,checked:e.name===t.PileupDisplay.type,onClick:()=>{t.setLowerPanelType(e.name)}}));return[...n(),{type:"subMenu",label:"Pileup settings",subMenu:t.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:t.SNPCoverageDisplay.trackMenuItems()},{type:"subMenu",label:"Replace lower panel with...",subMenu:r}]}}}).preProcessSnapshot(e=>{if(!e)return e;const{height:t,...n}=e;return{heightPreConfig:t,...n}}).postProcessSnapshot(e=>{if(!e)return e;const{heightPreConfig:t,lowerPanelType:n,snpCovHeight:r,...a}=e;return{...a,...void 0!==t&&250!==t?{height:t}:{},..."LinearPileupDisplay"!==n?{lowerPanelType:n}:{},...45!==r?{snpCovHeight:r}:{}}})};function E(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearAlignmentsDisplay",{pileupDisplay:e.getDisplayType("LinearPileupDisplay").configSchema,snpCoverageDisplay:e.getDisplayType("LinearSNPCoverageDisplay").configSchema,height:{type:"number",defaultValue:250}},{baseConfiguration:P.A,explicitlyTyped:!0})}(e);return new I.A({name:"LinearAlignmentsDisplay",displayName:"Alignments display (combination)",configSchema:t,stateModel:V(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:(0,a.lazy)(()=>n.e(8322).then(n.bind(n,58322)))})})}var z=n(83826),j=n(90705),H=n(89579);const _=function(e){return(0,o.S7)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:c.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,o.S7)("RenderersConfiguration",{PileupRenderer:e.getRendererType("PileupRenderer").configSchema}),maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:H.JD}},{baseConfiguration:(0,j.A)(e),explicitlyTyped:!0})};var $=n(74334),O=n(50717),G=n(35615),W=n(71392),U=n(16640),q=n(43102),J=n(89346),X=n(56721),K=n(1373),Q=n(38018),Z=n(78749),Y=n(54825),ee=n(69566),te=n(44460);const ne=(0,ee.observer)(function({model:e}){const{sortedBy:t}=e;return t?(0,te.jsx)("div",{"data-testid":`blurb-${t}`,children:(0,te.jsx)(Y.A,{color:"secondary",variant:"caption",children:`Sorted by ${t.tag??t.type} at ${t.refName}:${t.pos}`})}):null}),re=ne;var ae=n(32272);const ie={color:ae.pf.color_supplementary,label:"Supplementary/split"},oe={color:ae.pf.color_unmapped_mate,label:"Unmapped mate"},se=[{color:ae.pf.color_pair_lr,label:"Normal pair orientation"},{color:ae.pf.color_pair_rr,label:"Both mates reverse strand"},{color:ae.pf.color_pair_rl,label:"Both mates point outward"},{color:ae.pf.color_pair_ll,label:"Both mates forward strand"}],le=[{color:ae.pf.color_longinsert,label:"Long insert"},{color:ae.pf.color_shortinsert,label:"Short insert"},{color:ae.pf.color_interchrom,label:"Inter-chromosomal"}],ce={color:ae.pf.color_pair_lr,label:"Normal"},de=[...se,oe,ie],ue=[ce,...le,oe,ie],pe=[...se,...le,oe,ie];function he(e){const{bases:t,insertion:n,deletion:r,hardclip:a,softclip:i}=e.palette;return[{color:t.A.main,label:"A"},{color:t.C.main,label:"C"},{color:t.G.main,label:"G"},{color:t.T.main,label:"T"},{color:n,label:"Insertion"},{color:r,label:"Deletion"},{color:a,label:"Hard clip"},{color:i,label:"Soft clip"}]}function ge(e,t){const n=e?.type;if("modifications"===n&&t){const e=[];for(const[n,r]of t.entries())e.push({color:r.color,label:n});return e.push(ie),e}return"insertSizeAndOrientation"===n?pe:"insertSize"===n?ue:"orientation"===n?de:[ie]}var fe=n(63830),me=n(11231);const ye=(0,a.lazy)(()=>n.e(6427).then(n.bind(n,86427))),be=(0,a.lazy)(()=>n.e(9395).then(n.bind(n,89395)));function we(e,t={}){const{includeMethylation:n=!1}=t,{modificationThreshold:r,modificationsReady:a,visibleModificationTypes:i}=e;return a?i.length?[{label:`All modifications (>= ${r}% prob)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{threshold:r}})}},...e.visibleModificationTypes.map(t=>({label:`Show only ${me.R[t]?.name||t} (>= ${r}% prob)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t,threshold:r}})}})),{type:"divider"},{label:"All modifications (<50% prob colored blue)",onClick:()=>{e.setColorScheme({type:"modifications",modifications:{twoColor:!0,threshold:r}})}},...e.visibleModificationTypes.map(t=>({label:`Show only ${me.R[t]?.name||t} (<50% prob colored blue)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t,twoColor:!0,threshold:r}})}})),...n?[{type:"divider"},{label:"All reference CpGs",onClick:()=>{e.setColorScheme({type:"methylation",modifications:{threshold:r}})}}]:[],{type:"divider"},{label:`Adjust threshold (${r}%)`,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[be,{model:e,handleClose:t}])}}]:[{label:"No modifications currently visible"}]:[{label:"Loading modifications...",onClick:()=>{}}]}function ve(e,t={}){return{label:"Modifications",type:"subMenu",subMenu:we(e,t)}}function Se(e){const t=[{label:"Insert size  3 and orientation",onClick:()=>{e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size  3",onClick:()=>{e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:()=>{e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:()=>{e.setColorScheme({type:"gradient"})}}],n=function(e){return"modificationsReady"in e&&"visibleModificationTypes"in e}(e)&&e.visibleModificationTypes.length>0?[ve(e)]:[];return{label:"Color scheme",icon:fe.A,subMenu:[...t,...n]}}function xe(e){return{label:"Filter by",icon:X.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[ye,{model:e,handleClose:t}])}}}function ke(e){return{label:"Edit filters",icon:X.A,type:"subMenu",subMenu:[{label:"Show singletons",type:"checkbox",checked:e.drawSingletons,onClick:()=>{e.setDrawSingletons(!e.drawSingletons)}},{label:"Show proper pairs",type:"checkbox",checked:e.drawProperPairs,onClick:()=>{e.setDrawProperPairs(!e.drawProperPairs)}},{type:"divider"},{label:"Edit filters...",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[ye,{model:e,handleClose:t}])}}]}}function Ce(e){return{label:"Mismatch/indel display",type:"subMenu",subMenu:[{label:"Show all mismatches",type:"radio",checked:!e.hideMismatches&&!e.hideSmallIndels&&!e.hideLargeIndels,onClick:()=>{e.setHideMismatches(!1),e.setHideSmallIndels(!1),e.setHideLargeIndels(!1)}},{label:"Show mismatches and large indels+clipping",type:"radio",checked:!e.hideMismatches&&e.hideSmallIndels&&!e.hideLargeIndels,onClick:()=>{e.setHideMismatches(!1),e.setHideSmallIndels(!0),e.setHideLargeIndels(!1)}},{label:"Show just large indels",type:"radio",checked:e.hideMismatches&&e.hideSmallIndels&&!e.hideLargeIndels,onClick:()=>{e.setHideMismatches(!0),e.setHideSmallIndels(!0),e.setHideLargeIndels(!1)}},{label:"Show none",type:"radio",checked:e.hideMismatches&&e.hideSmallIndels&&e.hideLargeIndels,onClick:()=>{e.setHideMismatches(!0),e.setHideSmallIndels(!0),e.setHideLargeIndels(!0)}}]}}const Te=(0,a.lazy)(()=>n.e(6427).then(n.bind(n,86427))),Ae=(0,a.lazy)(()=>n.e(125).then(n.bind(n,60125))),Me=(0,a.lazy)(()=>n.e(7977).then(n.bind(n,7977))),Ie=(0,a.lazy)(()=>n.e(4725).then(n.bind(n,64725))),Pe=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]);function Le(e){return c.types.compose(J.L,c.types.model({configuration:(0,o.AK)(e),featureHeight:c.types.maybe(c.types.number),noSpacing:c.types.maybe(c.types.boolean),fadeLikelihood:c.types.maybe(c.types.boolean),trackMaxHeight:c.types.maybe(c.types.number),colorBySetting:c.types.frozen(),filterBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[]),hideSmallIndelsSetting:c.types.maybe(c.types.boolean),hideMismatchesSetting:c.types.maybe(c.types.boolean),hideLargeIndelsSetting:c.types.maybe(c.types.boolean)})).volatile(()=>({colorTagMap:N.observable.map({}),featureUnderMouseVolatile:void 0,tagsReady:!1})).views(e=>({get colorBy(){return e.colorBySetting??(0,L.FI)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,L.FI)(e,"filterBy")}})).views(e=>({get autorunReady(){return!e.isMinimized&&((0,k.getContainingView)(e).initialized&&e.featureDensityStatsReadyAndRegionNotTooLarge)},get hideSmallIndels(){return e.hideSmallIndelsSetting},get hideMismatches(){return e.hideMismatchesSetting},get hideLargeIndels(){return e.hideLargeIndelsSetting}})).actions(e=>({setTagsReady(t){e.tagsReady=t},setMaxHeight(t){e.trackMaxHeight=t},setFeatureHeight(t){e.featureHeight=t},setNoSpacing(t){e.noSpacing=t},setColorScheme(t){e.colorTagMap=N.observable.map({}),e.colorBySetting={...t},t.tag&&(e.tagsReady=!1)},updateColorTagMap(t){const n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];for(const r of t)if(!e.colorTagMap.has(r)){const t=[...e.colorTagMap.keys()].length;e.colorTagMap.set(r,n[t])}},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},selectFeature(t){const n=(0,k.getSession)(e);if((0,U.lO)(n)){const r=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,k.getContainingView)(e),track:(0,k.getContainingTrack)(e)});n.showWidget(r)}n.setSelection(t)},setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)},setHideSmallIndels(t){e.hideSmallIndelsSetting=t},setHideMismatches(t){e.hideMismatchesSetting=t},setHideLargeIndels(t){e.hideLargeIndelsSetting=t}})).views(e=>({async copyFeatureToClipboard(t){const{uniqueId:r,...a}=t.toJSON(),i=(0,k.getSession)(e),{default:o}=await n.e(2899).then(n.t.bind(n,72899,23));o(JSON.stringify(a,null,4)),i.notify("Copied to clipboard","success")},get rendererConfig(){const{featureHeight:t,noSpacing:n,hideSmallIndels:r,hideMismatches:a,hideLargeIndels:i,trackMaxHeight:o,rendererTypeName:s}=e,l=e.configuration.renderers?.[s];return{height:t??(0,L.QZ)(l,"height"),noSpacing:n??(0,L.QZ)(l,"noSpacing"),maxHeight:o??(0,L.QZ)(l,"maxHeight"),hideSmallIndels:r??(0,L.QZ)(l,"hideSmallIndels"),hideMismatches:a??(0,L.QZ)(l,"hideMismatches"),hideLargeIndels:i??(0,L.QZ)(l,"hideLargeIndels")}}})).views(e=>({get maxHeight(){return e.rendererConfig.maxHeight},get featureHeightSetting(){return e.rendererConfig.height},get noSpacingSetting(){return e.rendererConfig.noSpacing},get featureUnderMouse(){return e.featureUnderMouseVolatile},renderReady:()=>e.tagsReady,get filters(){return new W.A({filters:e.jexlFilters})},legendItems:t=>function(e,t){const n=e?.type;return"strand"===n?[{color:ae.pf.color_fwd_strand,label:"Forward strand"},{color:ae.pf.color_rev_strand,label:"Reverse strand"},ie]:"stranded"===n?[{color:ae.pf.color_fwd_strand,label:"First-of-pair forward"},{color:ae.pf.color_rev_strand,label:"First-of-pair reverse"},ie]:"insertSize"===n?ue:"pairOrientation"===n?de:"insertSizeAndPairOrientation"===n?pe:he(t)}(e.colorBy,t),showSubMenuItems:()=>[{label:"Show tooltips",type:"checkbox",checked:e.showTooltipsEnabled,onClick:()=>{e.setShowTooltips(!e.showTooltipsEnabled)}},{label:"Show legend",type:"checkbox",checked:e.showLegend,onClick:()=>{e.setShowLegend(!e.showLegend)}},Ce(e)]})).views(e=>{const{trackMenuItems:t,renderProps:n,renderingProps:r}=e;return{get rendererTypeName(){const t=(0,L.FI)(e,"defaultRendering"),n=Pe.get(t);if(!n)throw new Error(`unknown alignments view name ${t}`);return n},contextMenuItems(){const t=e.contextMenuFeature;return t?[{label:"Open feature details",icon:Q.A,onClick:()=>{e.clearFeatureSelection(),e.selectFeature(t)}},{label:"Copy info to clipboard",icon:K.A,onClick:()=>{e.copyFeatureToClipboard(t)}}]:[]},get DisplayBlurb(){return re},adapterRenderProps(){const{colorTagMap:t,colorBy:r,filterBy:a}=e,i=n();return{...i,notReady:i.notReady||!e.renderReady(),colorBy:r,filterBy:a,filters:e.filters,colorTagMap:Object.fromEntries(t.toJSON()),config:e.rendererConfig}},renderingProps:()=>({...r(),async onFeatureClick(t,n){const r=(0,k.getSession)(e),{rpcManager:a}=r;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,C.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,trackInstanceId:(0,k.getContainingTrack)(e).id,rendererType:"PileupRenderer",rpcDriverName:e.effectiveRpcDriverName});(0,c.isAlive)(e)&&r&&e.selectFeature(new q.A(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notifyError(`${e}`,e)}},onClick(){e.clearFeatureSelection()},async onFeatureContextMenu(t,n){const r=(0,k.getSession)(e),{rpcManager:a}=r;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,C.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,trackInstanceId:(0,k.getContainingTrack)(e).id,rendererType:"PileupRenderer",rpcDriverName:e.effectiveRpcDriverName});r&&e.setContextMenuFeature(new q.A(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notifyError(`${e}`,e)}}}),colorSchemeSubMenuItems:()=>[{label:"Normal",onClick:()=>{e.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:()=>{e.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:()=>{e.setColorScheme({type:"strand"})}},{label:"Per-base quality",onClick:()=>{e.setColorScheme({type:"perBaseQuality"})}},{label:"Per-base lettering",onClick:()=>{e.setColorScheme({type:"perBaseLettering"})}},{label:"First-of-pair strand",onClick:()=>{e.setColorScheme({type:"stranded"})}},{label:"Color by tag...",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Ae,{model:e,handleClose:t}])}}],trackMenuItems:()=>[...t(),{label:"Set feature height...",priority:0,subMenu:[{label:"Normal",type:"radio",checked:7===e.featureHeightSetting&&!1===e.noSpacingSetting,onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",type:"radio",checked:2===e.featureHeightSetting&&!0===e.noSpacingSetting,onClick:()=>{e.setFeatureHeight(2),e.setNoSpacing(!0)}},{label:"Super-compact",type:"radio",checked:1===e.featureHeightSetting&&!0===e.noSpacingSetting,onClick:()=>{e.setFeatureHeight(1),e.setNoSpacing(!0)}},{label:"Custom",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Me,{model:e,handleClose:t}])}}]},{label:"Show...",icon:Z.A,priority:-1,type:"subMenu",subMenu:e.showSubMenuItems()},{label:"Set max track height...",priority:-1,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Ie,{model:e,handleClose:t}])}},{label:"Filter by...",icon:X.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Te,{model:e,handleClose:t}])}}]}}).views(e=>({renderProps:()=>e.adapterRenderProps()})).actions(e=>({afterAttach(){(async()=>{const{sharedDoAfterAttach:t}=await n.e(5959).then(n.bind(n,75959));t(e)})()}})).preProcessSnapshot(e=>{if(e){const{colorBy:t,colorBySetting:n,filterBySetting:r,filterBy:a,...i}=e;return{...i,filterBySetting:r||a,colorBySetting:n||t}}return e}).postProcessSnapshot(e=>{if(!e)return e;const{trackMaxHeight:t,colorBySetting:n,filterBySetting:r,jexlFilters:a,hideSmallIndelsSetting:i,hideMismatchesSetting:o,hideLargeIndelsSetting:s,...l}=e;return{...l,...void 0!==t?{trackMaxHeight:t}:{},...void 0!==n?{colorBySetting:n}:{},...(0,H.$Q)(r)?{}:{filterBySetting:r},...a?.length?{jexlFilters:a}:{},...void 0!==i?{hideSmallIndelsSetting:i}:{},...void 0!==o?{hideMismatchesSetting:o}:{},...void 0!==s?{hideLargeIndelsSetting:s}:{}}})}var Re=n(52301);function Fe(){return c.types.model({}).volatile(()=>({visibleModifications:N.observable.map({}),simplexModifications:new Set,modificationsReady:!1})).views(e=>({get visibleModificationTypes(){return[...e.visibleModifications.keys()]}})).actions(e=>({updateVisibleModifications(t){for(const n of t)e.visibleModifications.has(n.type)||e.visibleModifications.set(n.type,{...n,color:(0,Re.rT)(n.type)})},setSimplexModifications(t){const n=e.simplexModifications;t.length===n.size&&t.every(e=>n.has(e))||(e.simplexModifications=new Set(t))},setModificationsReady(t){e.modificationsReady=t}}))}const De=(0,a.lazy)(()=>n.e(4762).then(n.bind(n,94762))),Ne=(0,a.lazy)(()=>n.e(2577).then(n.bind(n,12577))),Be=function(e){return c.types.compose("LinearPileupDisplay",Le(e),Fe(),c.types.model({type:c.types.literal("LinearPileupDisplay"),configuration:(0,o.AK)(e),showSoftClipping:!1,mismatchAlpha:c.types.maybe(c.types.boolean),sortedBy:c.types.frozen()})).volatile(()=>({sortReady:!1,currSortBpPerPx:0})).actions(e=>({setCurrSortBpPerPx(t){e.currSortBpPerPx=t},setSortReady(t){e.sortReady=t},clearSelected(){e.sortedBy=void 0},toggleSoftClipping(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha(){e.mismatchAlpha=!e.mismatchAlpha},setSortedBy(t,n){const{centerLineInfo:r}=(0,k.getContainingView)(e);if(!r)return;const{refName:a,assemblyName:i,offset:o}=r,s=Math.round(o)+1;s<0||!a||(e.sortReady=!1,e.sortedBy={type:t,pos:s,refName:a,assemblyName:i,tag:n})},setSortedByAtPosition(t,n,r){const a=(0,k.getContainingView)(e).assemblyNames[0];a&&(e.sortReady=!1,e.sortedBy={type:t,pos:n+1,refName:r,assemblyName:a})},setFeatureHeight(t){e.sortReady=!1,e.featureHeight=t}})).actions(e=>{const t=e.reload;return{reload(){e.clearSelected(),t()}}}).views(e=>({get modificationThreshold(){return e.colorBy?.modifications?.threshold??10},get rendererConfig(){const{featureHeight:t,noSpacing:n,trackMaxHeight:r,mismatchAlpha:a,hideSmallIndels:i,hideMismatches:o,hideLargeIndels:s}=e,l=e.configuration.renderers?.PileupRenderer;return{height:t??(0,L.QZ)(l,"height"),noSpacing:n??(0,L.QZ)(l,"noSpacing"),maxHeight:r??(0,L.QZ)(l,"maxHeight"),mismatchAlpha:a??(0,L.QZ)(l,"mismatchAlpha"),hideSmallIndels:i??(0,L.QZ)(l,"hideSmallIndels"),hideMismatches:o??(0,L.QZ)(l,"hideMismatches"),hideLargeIndels:s??(0,L.QZ)(l,"hideLargeIndels")}}})).views(e=>{const{renderReady:t}=e;return{get mismatchAlphaSetting(){return e.rendererConfig.mismatchAlpha},renderReady(){const n=(0,k.getContainingView)(e);return e.modificationsReady&&e.currSortBpPerPx===n.bpPerPx&&t()}}}).views(e=>{const{trackMenuItems:t,adapterRenderProps:n,renderProps:r,colorSchemeSubMenuItems:a,showSubMenuItems:i}=e;return{adapterRenderProps(){const{sortedBy:t,showSoftClipping:r,visibleModifications:a,simplexModifications:i}=e;return{...n(),showSoftClip:r,sortedBy:t,visibleModifications:Object.fromEntries(a.toJSON()),simplexModifications:[...i]}},renderProps(){const{sortReady:t}=e,n=r();return{...n,notReady:n.notReady||!t}},showSubMenuItems:()=>[...i(),{label:"Show soft clipping",type:"checkbox",checked:e.showSoftClipping,onClick:()=>{e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Show mismatches faded by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:()=>{e.toggleMismatchAlpha()}}],trackMenuItems:()=>[...t(),{label:"Sort by...",icon:O.A,disabled:e.showSoftClipping,subMenu:[...["Start location","Read strand","Base pair"].map(t=>({label:t,onClick:()=>{e.setSortedBy(t)}})),{label:"Sort by tag...",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[De,{model:e,handleClose:t}])}},{label:"Clear sort",onClick:()=>{e.clearSelected()}}]},{label:"Color by...",icon:$.A,subMenu:[{label:"Pair orientation",onClick:()=>{e.setColorScheme({type:"pairOrientation"})}},{label:"Modifications",type:"subMenu",subMenu:we(e,{includeMethylation:!0})},{label:"Insert size",onClick:()=>{e.setColorScheme({type:"insertSize"})}},...a()]},{label:"Group by...",icon:G.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Ne,{model:e,handleClose:t}])}}]}}).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(1020).then(n.bind(n,31020));t(e)}catch(t){(0,k.getSession)(e).notifyError(`${t}`,t),console.error(t)}})()}})).postProcessSnapshot(e=>{if(!e)return e;const{showSoftClipping:t,mismatchAlpha:n,sortedBy:r,...a}=e;return{...a,...t?{showSoftClipping:t}:{},...void 0!==n?{mismatchAlpha:n}:{},...void 0!==r?{sortedBy:r}:{}}})};function Ve(e){e.addDisplayType(()=>{const t=_(e);return new I.A({name:"LinearPileupDisplay",displayName:"Pileup display",helpText:"Display stacked aligned reads showing exact placement and sequences relative to the reference genome",configSchema:t,stateModel:Be(t),subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:z.Ay})})}const Ee=function(e){return(0,o.S7)("LinearReadArcsDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},lineWidth:{type:"number",description:"set arc line width",defaultValue:1},jitter:{type:"number",description:"jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them",defaultValue:0},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}},filterBy:{type:"frozen",defaultValue:H.JD}},{baseConfiguration:(0,j.A)(e),explicitlyTyped:!0})};var ze=n(4615),je=n(85170),He=n(29458);function _e(){return c.types.model("NonBlockCanvasDisplayMixin",{}).volatile(()=>({loading:!1,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:void 0,ref:null,renderingImageData:void 0,renderingStopToken:void 0,statusMessage:void 0,canvasDrawn:!1})).views(e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx},get fullyDrawn(){return this.drawn&&!e.loading&&e.canvasDrawn}})).actions(e=>({setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},setRef(t){e.ref=t},setRenderingImageData(t){e.renderingImageData=t},setRenderingStopToken(t){e.renderingStopToken=t},setStatusMessage(t){e.statusMessage=t},setCanvasDrawn(t){e.canvasDrawn=t}})).actions(e=>({beforeDestroy(){e.renderingStopToken&&(0,He.CF)(e.renderingStopToken)}}))}function $e(){return c.types.compose("LinearReadDisplayBaseMixin",_e(),c.types.model({filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen()}).volatile(()=>({chainData:void 0,lastDrawnBpPerPx:0})).actions(e=>({setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setColorScheme(t){e.colorBySetting={...t}},setChainData(t){e.chainData=t},setFilterBy(t){e.filterBySetting={...t}}})))}var Oe=n(16150);const Ge=function(e){return c.types.compose("LinearReadArcsDisplay",R.q,(0,ze.A)(),(0,je.A)(),$e(),c.types.model("LinearReadArcsDisplaySettingsMixin",{lineWidth:c.types.maybe(c.types.number),jitter:c.types.maybe(c.types.number),drawInter:!0,drawLongRange:!0}).actions(e=>({setDrawInter(t){e.drawInter=t},setDrawLongRange(t){e.drawLongRange=t},setLineWidth(t){e.lineWidth=t},setJitter(t){e.jitter=t}})).views(e=>({get lineWidthSetting(){return e.lineWidth??(0,L.FI)(e,"lineWidth")},get jitterVal(){return e.jitter??(0,L.FI)(e,"jitter")}})),c.types.model({type:c.types.literal("LinearReadArcsDisplay"),configuration:(0,o.AK)(e),showLegend:c.types.maybe(c.types.boolean)})).views(e=>({get colorBy(){return e.colorBySetting??(0,L.FI)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,L.FI)(e,"filterBy")}})).actions(e=>({setShowLegend(t){e.showLegend=t},reload(){e.error=void 0}})).views(e=>({legendItems:()=>ge(e.colorBy),svgLegendWidth(){return e.showLegend?(0,Oe.S)(this.legendItems()):0}})).views(e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),notReady:!1,filterBy:e.filterBy,colorBy:e.colorBy,drawInter:e.drawInter,drawLongRange:e.drawLongRange,lineWidth:e.lineWidthSetting,jitter:e.jitterVal,height:e.height}),trackMenuItems:()=>[...t(),xe(e),{label:"Line width",subMenu:[{label:"Thin",onClick:()=>{e.setLineWidth(1)}},{label:"Bold",onClick:()=>{e.setLineWidth(2)}},{label:"Extra bold",onClick:()=>{e.setLineWidth(5)}}]},{label:"Jitter x-positions",subMenu:[{type:"checkbox",checked:0===e.jitterVal,label:"None",onClick:()=>{e.setJitter(0)}},{type:"checkbox",checked:2===e.jitterVal,label:"Small",onClick:()=>{e.setJitter(2)}},{type:"checkbox",checked:10===e.jitterVal,label:"Large",onClick:()=>{e.setJitter(10)}}]},{label:"Show...",type:"subMenu",subMenu:[{label:"Show legend",type:"checkbox",checked:e.showLegend,onClick:()=>{e.setShowLegend(!e.showLegend)}},{label:"Inter-chromosomal connections (purple vertical lines)",type:"checkbox",checked:e.drawInter,onClick:()=>{e.setDrawInter(!e.drawInter)}},{label:"Long range connections (red vertical lines)",type:"checkbox",checked:e.drawLongRange,onClick:()=>{e.setDrawLongRange(!e.drawLongRange)}}]},Se(e)],async renderSvg(t){const{renderSvg:r}=await n.e(7586).then(n.bind(n,17586));return r(e,t)}}}).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttachRPC:t}=await n.e(7408).then(n.bind(n,47408));t(e)}catch(t){console.error(t),e.setError(t)}})()}})).postProcessSnapshot(e=>{if(!e)return e;const{lineWidth:t,jitter:n,drawInter:r,drawLongRange:a,showLegend:i,...o}=e;return{...o,...void 0!==t?{lineWidth:t}:{},...void 0!==n?{jitter:n}:{},...r?{}:{drawInter:r},...a?{}:{drawLongRange:a},...void 0!==i?{showLegend:i}:{}}})};function We(e){e.addDisplayType(()=>{const t=Ee(e);return new I.A({name:"LinearReadArcsDisplay",displayName:"Read arc display",helpText:"Connect paired end reads and long split reads using arcs",configSchema:t,stateModel:Ge(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(9490),n.e(6649)]).then(n.bind(n,46649)))})})}const Ue=function(e){return(0,o.S7)("LinearReadCloudDisplay",{minSubfeatureWidth:{type:"number",defaultValue:1},maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},featureHeight:{type:"number",defaultValue:7},hideSmallIndels:{type:"boolean",defaultValue:!1},hideMismatches:{type:"boolean",defaultValue:!1},hideLargeIndels:{type:"boolean",defaultValue:!1},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}},filterBy:{type:"frozen",defaultValue:H.JD}},{baseConfiguration:(0,j.A)(e),explicitlyTyped:!0})};var qe=n(64833);const Je=(0,a.lazy)(()=>n.e(3486).then(n.bind(n,13486))),Xe=function(e){return c.types.compose("LinearReadCloudDisplay",R.q,(0,ze.A)(),(0,je.A)(),$e(),c.types.model("LinearReadDisplayWithLayoutMixin",{}).volatile(()=>({featureLayout:void 0,mouseoverRef:null,featuresForFlatbush:[],mismatchLayout:void 0,mismatchItems:[]})).actions(e=>({setFeatureLayout(t){e.featureLayout=t},setMouseoverRef(t){e.mouseoverRef=t},setFeaturesForFlatbush(t){e.featuresForFlatbush=t},setMismatchLayout(t){e.mismatchLayout=t},setMismatchItems(t){e.mismatchItems=t}})),c.types.model("LinearReadDisplayWithPairFiltersMixin",{drawSingletons:!0,drawProperPairs:!0,flipStrandLongReadChains:!0,featureHeight:c.types.maybe(c.types.number)}).actions(e=>({setDrawSingletons(t){e.drawSingletons=t},setDrawProperPairs(t){e.drawProperPairs=t},setFlipStrandLongReadChains(t){e.flipStrandLongReadChains=t},setFeatureHeight(t){e.featureHeight=t}})),Fe(),c.types.model({type:c.types.literal("LinearReadCloudDisplay"),configuration:(0,o.AK)(e),drawCloud:!1,noSpacing:c.types.maybe(c.types.boolean),trackMaxHeight:c.types.maybe(c.types.number),hideSmallIndelsSetting:c.types.maybe(c.types.boolean),hideMismatchesSetting:c.types.maybe(c.types.boolean),hideLargeIndelsSetting:c.types.maybe(c.types.boolean),showLegend:c.types.maybe(c.types.boolean),showYScalebar:c.types.optional(c.types.boolean,!0),showOutline:c.types.optional(c.types.boolean,!0)})).volatile(()=>({layoutHeight:0,selectedFeatureId:void 0,cloudMaxDistance:void 0})).views(e=>({get colorBy(){return e.colorBySetting??(0,L.FI)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,L.FI)(e,"filterBy")}})).actions(e=>({reload(){e.error=void 0}})).views(e=>({get dataTestId(){return e.drawCloud?"cloud-canvas":"stack-canvas"},get featureHeightSetting(){return e.featureHeight??(0,L.FI)(e,"featureHeight")},get hideSmallIndels(){return e.hideSmallIndelsSetting??(0,L.FI)(e,"hideSmallIndels")},get hideMismatches(){return e.hideMismatchesSetting??(0,L.FI)(e,"hideMismatches")},get hideLargeIndels(){return e.hideLargeIndelsSetting??(0,L.FI)(e,"hideLargeIndels")}})).views(e=>({get modificationThreshold(){return e.colorBy?.modifications?.threshold??10},get cloudTicks(){if(e.drawCloud&&void 0!==e.cloudMaxDistance&&e.showYScalebar)return(0,qe.og)(e.cloudMaxDistance,e.height)}})).actions(e=>({setNoSpacing(t){e.noSpacing=t},setMaxHeight(t){e.trackMaxHeight=t},setLayoutHeight(t){e.layoutHeight=t},setCloudMaxDistance(t){(void 0===e.cloudMaxDistance||Math.abs(e.cloudMaxDistance-t)>1e-6)&&(e.cloudMaxDistance=t)},setShowYScalebar(t){e.showYScalebar=t},setShowOutline(t){e.showOutline=t},selectFeature(t){const n=(0,k.getSession)(e),r=function(e){if(0===e.length)throw new Error("Chain cannot be empty");const t=e[0];return new q.A({uniqueId:t.id,id:t.id,name:t.name,refName:t.refName,start:Math.min(...e.map(e=>e.start)),end:Math.max(...e.map(e=>e.end)),strand:t.strand,flags:t.flags,tlen:t.tlen,pair_orientation:t.pair_orientation,clipLengthAtStartOfRead:t.clipLengthAtStartOfRead,...t.next_ref&&{next_ref:t.next_ref},...void 0!==t.next_pos&&{next_pos:t.next_pos},...t.SA&&{SA:t.SA},subfeatures:e.map((e,t)=>({uniqueId:`${e.id}_${t}`,id:`${e.id}_${t}`,name:e.name,refName:e.refName,start:e.start,end:e.end,strand:e.strand,type:"alignment_part",flags:e.flags,tlen:e.tlen,pair_orientation:e.pair_orientation,clipLengthAtStartOfRead:e.clipLengthAtStartOfRead,...e.next_ref&&{next_ref:e.next_ref},...void 0!==e.next_pos&&{next_pos:e.next_pos},...e.SA&&{SA:e.SA}}))})}(t);if((0,U.lO)(n)){const t=n.addWidget("BaseFeatureWidget","baseFeature",{featureData:r.toJSON(),view:(0,k.getContainingView)(e),track:(0,k.getContainingTrack)(e)});n.showWidget(t)}n.setSelection(r)},setDrawCloud(t){e.drawCloud=t},setSelectedFeatureId(t){e.selectedFeatureId=t},setHideSmallIndels(t){e.hideSmallIndelsSetting=t},setHideMismatches(t){e.hideMismatchesSetting=t},setHideLargeIndels(t){e.hideLargeIndelsSetting=t},setShowLegend(t){e.showLegend=t}})).views(e=>({legendItems:()=>ge(e.colorBy,e.visibleModifications),svgLegendWidth(){return e.showLegend?(0,Oe.S)(this.legendItems()):0}})).views(e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),notReady:!1,filterBy:e.filterBy,colorBy:e.colorBy,featureHeight:e.featureHeightSetting,noSpacing:e.noSpacing??!1,drawCloud:e.drawCloud,drawSingletons:e.drawSingletons,drawProperPairs:e.drawProperPairs,flipStrandLongReadChains:e.flipStrandLongReadChains,trackMaxHeight:e.trackMaxHeight,hideSmallIndels:e.hideSmallIndels,hideMismatches:e.hideMismatches,hideLargeIndels:e.hideLargeIndels,showOutline:e.showOutline,visibleModifications:Object.fromEntries(e.visibleModifications.toJSON())}),trackMenuItems:()=>[...t(),{label:"Set feature height...",subMenu:[{label:"Normal",type:"radio",checked:7===e.featureHeightSetting&&!0!==e.noSpacing,onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",type:"radio",checked:3===e.featureHeightSetting&&!0===e.noSpacing,onClick:()=>{e.setFeatureHeight(3),e.setNoSpacing(!0)}},{label:"Super-compact",type:"radio",checked:1===e.featureHeightSetting&&!0===e.noSpacing,onClick:()=>{e.setFeatureHeight(1),e.setNoSpacing(!0)}},{label:"Manually set height...",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Je,{model:e,handleClose:t}])}}]},{label:"Show...",icon:Z.A,type:"subMenu",subMenu:[{label:"Show legend",type:"checkbox",checked:e.showLegend,onClick:()=>{e.setShowLegend(!e.showLegend)}},{label:"Show as 'read cloud' (paired-end reads)",type:"checkbox",helpText:"In read cloud mode, the y-coordinate of paired-end reads is proportional to insert size (TLEN). This mode is designed for paired-end short reads; long reads will appear at y=0.",checked:e.drawCloud,onClick:()=>{e.setDrawCloud(!e.drawCloud)}},{label:"Show y-scalebar",type:"checkbox",helpText:"Show insert size scale on the y-axis (only visible in cloud mode)",checked:e.showYScalebar,onClick:()=>{e.setShowYScalebar(!e.showYScalebar)}},{label:"Show read strand relative to primary",helpText:"This makes all the reads draw their strand relative to the primary alignment, which can be helpful in seeing patterns of flipping orientation in split long-read alignments",type:"checkbox",checked:e.flipStrandLongReadChains,onClick:()=>{e.setFlipStrandLongReadChains(!e.flipStrandLongReadChains)}},{label:"Show outline",helpText:"Draw an outline around each read",type:"checkbox",checked:e.showOutline,onClick:()=>{e.setShowOutline(!e.showOutline)}},Ce(e)]},ke(e),Se(e)],async renderSvg(t){const{renderSvg:r}=await n.e(704).then(n.bind(n,704));return r(e,t)}}}).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttachRPC:t}=await Promise.all([n.e(555),n.e(7385),n.e(9862)]).then(n.bind(n,49862));t(e)}catch(t){console.error(t),e.setError(t)}})()}})).postProcessSnapshot(e=>{if(!e)return e;const{drawCloud:t,noSpacing:n,trackMaxHeight:r,showLegend:a,showOutline:i,hideSmallIndelsSetting:o,hideMismatchesSetting:s,hideLargeIndelsSetting:l,...c}=e;return{...c,...t?{drawCloud:t}:{},...void 0!==n?{noSpacing:n}:{},...void 0!==r?{trackMaxHeight:r}:{},...void 0!==a?{showLegend:a}:{},...i?{}:{showOutline:i},...void 0!==o?{hideSmallIndelsSetting:o}:{},...void 0!==s?{hideMismatchesSetting:s}:{},...void 0!==l?{hideLargeIndelsSetting:l}:{}}})};function Ke(e){e.addDisplayType(()=>{const t=Ue(e);return new I.A({name:"LinearReadCloudDisplay",displayName:"Linked reads display",helpText:'Display paired-end and split read (supplementary read) alignments as linked entities. Note that the concept of "linked reads" is not specifically referring to Chromium 10x linked reads, this is just the general idea of linking paired-end, and split (supplementary) alignments',configSchema:t,stateModel:Xe(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(9490),n.e(5837)]).then(n.bind(n,45837)))})})}var Qe=n(88642),Ze=n(22315);const Ye=(0,a.lazy)(()=>n.e(6393).then(n.bind(n,66393))),et=(0,a.lazy)(()=>n.e(9845).then(n.bind(n,99845))),tt=new Map([["snpcoverage","SNPCoverageRenderer"]]),nt=function(e,t){return c.types.compose("LinearSNPCoverageDisplay",(0,Qe.A)(e,t),Fe(),c.types.model({type:c.types.literal("LinearSNPCoverageDisplay"),showInterbaseCounts:c.types.maybe(c.types.boolean),showInterbaseIndicators:c.types.maybe(c.types.boolean),showArcs:c.types.maybe(c.types.boolean),minArcScore:c.types.optional(c.types.number,0),filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[])})).views(e=>({get colorBy(){return e.colorBySetting??(0,L.FI)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,L.FI)(e,"filterBy")}})).actions(e=>({setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setColorScheme(t){e.colorBySetting=t?{...t}:void 0},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)}})).views(e=>{const{adapterProps:t}=e;return{get modificationThreshold(){return e.colorBy?.modifications?.threshold??10},get rendererConfig(){const{showArcs:t,showInterbaseCounts:n,showInterbaseIndicators:r}=e,a=e.configuration.renderers?.[e.rendererTypeName];return{showInterbaseCounts:n??(0,L.QZ)(a,"showInterbaseCounts"),showInterbaseIndicators:r??(0,L.QZ)(a,"showInterbaseIndicators"),showArcs:t??(0,L.QZ)(a,"showArcs")}},get showArcsSetting(){return this.rendererConfig.showArcs},get skipFeatures(){if(!this.showArcsSetting)return[];const{minArcScore:t}=e,n=new Map;for(const r of e.blockState.values())if(r.features)for(const e of r.features.values())"skip"===e.get("type")&&(e.get("score")??1)>=t&&n.set(e.id(),e);return[...n.values()]},get showInterbaseCountsSetting(){return this.rendererConfig.showInterbaseCounts},get showInterbaseIndicatorsSetting(){return this.rendererConfig.showInterbaseIndicators},get autorunReady(){return(0,k.getContainingView)(e).initialized&&e.featureDensityStatsReadyAndRegionNotTooLarge&&!e.error},adapterProps(){const n=t(),{filters:r,filterBy:a}=e;return{...n,filters:r,filterBy:a,modificationThreshold:this.modificationThreshold}}}}).actions(e=>({setShowInterbaseIndicators(t){e.showInterbaseIndicators=t},setShowInterbaseCounts(t){e.showInterbaseCounts=t},setShowArcs(t){e.showArcs=t},setMinArcScore(t){e.minArcScore=t}})).actions(e=>({afterAttach(){(0,Re.vi)(e,async()=>{if(e.setModificationsReady(!1),!e.autorunReady)return;const t=(0,k.getContainingView)(e),{staticBlocks:n}=t,{colorBy:r}=e;if("modifications"===r?.type){const{modifications:t,simplexModifications:r}=await(0,Ze.D)({model:e,adapterConfig:(0,L.FI)(e.parentTrack,"adapter"),blocks:n});(0,c.isAlive)(e)&&(e.updateVisibleModifications(t),e.setSimplexModifications(r),e.setModificationsReady(!0))}else e.setModificationsReady(!0)},{delay:1e3})}})).views(e=>{const{renderProps:t,renderingProps:r,renderSvg:a,wiggleBaseTrackMenuItems:i}=e;return{renderReady:()=>!t().notReady&&e.modificationsReady,renderProps(){const{colorBy:n,visibleModifications:r,simplexModifications:a}=e;return{...t(),notReady:!this.renderReady(),colorBy:n,visibleModifications:Object.fromEntries(r.toJSON()),simplexModifications:[...a]}},renderingProps:()=>({...r(),displayModel:e}),async renderSvg(t){const{renderSNPCoverageSvg:r}=await n.e(8303).then(n.bind(n,58303));return r(e,t,a)},get TooltipComponent(){return Ye},get adapterConfig(){const t=(0,L.FI)(e.parentTrack,"adapter"),n=(0,k.getContainingView)(e),r=(0,k.getSession)(e),{assemblyManager:a}=r,i=n.assemblyNames[0],o=i?a.get(i):void 0,s=o?.configuration?.sequence?.adapter;return{type:"SNPCoverageAdapter",subadapter:t,sequenceAdapter:s?(0,c.getSnapshot)(s):void 0}},get rendererTypeName(){return tt.get("snpcoverage")},get graphType(){return!0},contextMenuItems:()=>[],trackMenuItems:()=>[...i(),{label:"Show...",icon:Z.A,type:"subMenu",subMenu:[{label:"Show tooltips",type:"checkbox",checked:e.showTooltipsEnabled,onClick:()=>{e.setShowTooltips(!e.showTooltipsEnabled)}},{label:"Show legend",type:"checkbox",checked:e.showLegend,onClick:()=>{e.setShowLegend(!e.showLegend)}},{label:"Insertion/clipping indicators",type:"checkbox",checked:e.showInterbaseIndicatorsSetting,onClick:()=>{e.setShowInterbaseIndicators(!e.showInterbaseIndicatorsSetting)}},{label:"Insertion/clipping counts",type:"checkbox",checked:e.showInterbaseCountsSetting,onClick:()=>{e.setShowInterbaseCounts(!e.showInterbaseCountsSetting)}},{label:"Sashimi arcs",type:"checkbox",checked:e.showArcsSetting,onClick:()=>{e.setShowArcs(!e.showArcsSetting)}}]},{label:"Filter arcs by score...",icon:X.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[et,{model:e,handleClose:t}])}}],get filters(){return new W.A({filters:e.jexlFilters})},legendItems:t=>function(e,t,n){if("methylation"===e?.type)return[{color:"red",label:"CpG methylated"},{color:"blue",label:"CpG unmethylated"}];if("modifications"===e?.type){const e=[];for(const[n,r]of t.entries())e.push({color:r.color,label:n});return e}return he(n)}(e.colorBy,e.visibleModifications,t)}}).preProcessSnapshot(e=>{if(e){const{colorBy:t,colorBySetting:n,filterBySetting:r,filterBy:a,...i}=e;return{...i,filterBySetting:r||a,colorBySetting:n||t}}return e}).postProcessSnapshot(e=>{if(!e)return e;const{showInterbaseCounts:t,showInterbaseIndicators:n,showArcs:r,minArcScore:a,filterBySetting:i,colorBySetting:o,jexlFilters:s,...l}=e;return{...l,...void 0!==t?{showInterbaseCounts:t}:{},...void 0!==n?{showInterbaseIndicators:n}:{},...void 0!==r?{showArcs:r}:{},...a?{minArcScore:a}:{},...(0,H.$Q)(i)?{}:{filterBySetting:i},...void 0!==o?{colorBySetting:o}:{},...s?.length?{jexlFilters:s}:{}}})};function rt(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:c.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:c.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,o.S7)("RenderersConfiguration",{SNPCoverageRenderer:e.getRendererType("SNPCoverageRenderer").configSchema}),colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:H.JD}},{baseConfiguration:P.A,explicitlyTyped:!0})}(e);return new I.A({name:"LinearSNPCoverageDisplay",displayName:"SNPCoverage display",helpText:"Display coverage histogram and SNP composition for each genomic position",configSchema:t,stateModel:nt(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:(0,a.lazy)(()=>n.e(2898).then(n.bind(n,32898)))})})}var at=n(95548),it=n(88068),ot=n(90013),st=n(40507);class lt extends st.A{async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n?.session?.assemblyManager;if(!r)throw new Error("no assembly manager available");const a=await(0,k.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}}class ct extends lt{name="PileupGetGlobalValueForTag";async execute(e,t){const n=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:a,regions:i,tag:o}=n,s=(await(0,at.cK)(this.pluginManager,a,r)).dataAdapter.getFeaturesInMultipleRegions(i,n),l=await(0,it._)(s.pipe((0,ot.$)()));return[...new Set(l.map(e=>e.get("tags")?.[o]).filter(e=>void 0!==e).map(e=>`${e}`))]}}var dt=n(2165);function ut(e){const t=[],n=e.split(";");for(let e=0,r=n.length;e<r;e++){const r=n[e];if(""===r)continue;const a=r.split(",")[0],i=dt.k.exec(a);if(!i)throw new Error(`bad format for MM tag: "${r}"`);const o=i[1],s=i[2],l=i[3].split(/(\d+|.)/);for(let e=0,n=l.length;e<n;e++){const n=l[e];""!==n&&t.push({type:n,base:o,strand:s})}}return t}class pt extends lt{name="PileupGetVisibleModifications";async execute(e,t){const n=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:a,regions:i}=n,o=(await(0,at.cK)(this.pluginManager,a,r)).dataAdapter,s=await(0,it._)(o.getFeaturesInMultipleRegions(i,n).pipe((0,ot.$)())),l=new Map;for(const e of s){const t=(0,Re.c$)(e,"MM","Mm");for(const e of ut("string"==typeof t?t:"")){const t=`${e.base}${e.strand}${e.type}`;l.has(t)||l.set(t,e)}}const c=[...l.values()],d=function(e){const t=new Set,n=new Set;for(const n of e){const e=n;"-"===e.strand&&t.add(e.type)}for(const r of e){const e=r;"+"!==e.strand||t.has(e.type)||n.add(e.type)}return n}(c),u=new Map;for(const e of c)u.has(e.type)||u.set(e.type,e);return{modifications:[...u.values()],simplexModifications:[...d]}}}function ht(e){e.addRpcMethod(()=>new ct(e)),e.addRpcMethod(()=>new pt(e))}var gt=n(49783),ft=n(26861),mt=n(31508),yt=n(23638),bt=n(81709),wt=n(8655);class vt{constructor(e){this.props=e}update(e){return this.props=e,this}makeLayout(){const e=(0,L.QZ)(this.props.config,"noSpacing"),t=(0,L.QZ)(this.props.config,"height"),n=(0,L.QZ)(this.props.config,"maxHeight");return new bt.A(wt.A,{featureHeight:t,spacing:e?0:2,maxHeight:n})}cachedLayoutIsValid(e){return e.props.bpPerPx===this.props.bpPerPx&&D()((0,L.QZ)(this.props.config),(0,L.QZ)(e.props.config))&&D()(this.props.filters,e.props.filters)&&this.props.showSoftClip===e.props.showSoftClip&&D()(this.props.sortedBy,e.props.sortedBy)&&D()(this.props.filterBy,e.props.filterBy)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),props:this.props}),this.cachedLayout.layout}}class St extends gt.default{supportsSVG=!0;getExpandedRegion(e,t){const{config:n,showSoftClip:r}=t,a=(0,L.QZ)(n,"maxClippingSize"),i=r?Math.round(a):0;return(0,ft.T)(e,i)}async render(e){const{statusCallback:t=()=>{},regions:r,bpPerPx:a}=e,i=r[0],o=(i.end-i.start)/a,s=await this.getFeatures(e),l=this.createLayoutInWorker(e),{makeImageData:c}=await Promise.all([n.e(555),n.e(4364)]).then(n.bind(n,74364)),{result:d,height:u,featureNames:p}=await(0,k.updateStatus)("Rendering alignments",t,()=>c({width:o,renderArgs:{...e,layout:l,features:s},pluginManager:this.pluginManager})),h=this.serializeLayout(l,e);return(0,mt.lk)({...d,featureNames:p,layout:h,height:u,width:o,maxHeightReached:l.maxHeightReached},(0,yt.X)(d))}createLayoutSession(e){return new vt(e)}}const xt=(0,o.S7)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:c.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orientation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:c.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:1},hideSmallIndels:{type:"boolean",description:"Hides small indels, sometimes occurring in long read sequencing",defaultValue:!1},hideMismatches:{type:"boolean",description:"Hides SNP mismatches",defaultValue:!1},hideLargeIndels:{type:"boolean",description:"Hides large indels (>=10bp)",defaultValue:!1},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function kt(e){e.addRendererType(()=>new St({name:"PileupRenderer",displayName:"Pileup renderer",ReactComponent:(0,a.lazy)(()=>n.e(9943).then(n.bind(n,19943))),configSchema:xt,pluginManager:e}))}class Ct extends st.A{name="RenderLinearReadArcsDisplay";deserializeArguments(e,t){return{...e,config:Ee(this.pluginManager).create(e.config,{pluginManager:this.pluginManager})}}async renameRegionsIfNeeded(e){const t=this.pluginManager.rootModel?.session?.assemblyManager;if(!t)throw new Error("no assembly manager");const{view:n,sessionId:r,adapterConfig:a}=e,{displayedRegions:i}=n;if(!i.length)return e;const o=await(0,k.renameRegionsIfNeeded)(t,{sessionId:r,adapterConfig:a,regions:i});return{...e,view:{...n,displayedRegions:o.regions}}}async serializeArguments(e,t){const n=await this.renameRegionsIfNeeded(e);return super.serializeArguments(n,t)}async execute(e,t){const r=await this.deserializeArguments(e,t),{executeRenderLinearReadArcsDisplay:a}=await n.e(1217).then(n.bind(n,41217));return a({pluginManager:this.pluginManager,args:r})}}function Tt(e){e.addRpcMethod(()=>new Ct(e))}class At extends st.A{name="RenderLinearReadCloudDisplay";async renameRegionsIfNeeded(e){const t=this.pluginManager.rootModel?.session?.assemblyManager;if(!t)throw new Error("no assembly manager");const{view:n,sessionId:r,adapterConfig:a}=e,{displayedRegions:i}=n;if(!i.length)return e;const o=await(0,k.renameRegionsIfNeeded)(t,{sessionId:r,adapterConfig:a,regions:i});return{...e,view:{...n,displayedRegions:o.regions}}}deserializeArguments(e,t){return{...e,config:Ue(this.pluginManager).create(e.config,{pluginManager:this.pluginManager})}}async serializeArguments(e,t){const n=await this.renameRegionsIfNeeded(e);return super.serializeArguments(n,t)}async execute(e,t){const r=await this.deserializeArguments(e,t),{executeRenderLinearReadCloudDisplay:a}=await Promise.all([n.e(555),n.e(7385),n.e(8982)]).then(n.bind(n,8982));return a({pluginManager:this.pluginManager,args:r})}}function Mt(e){e.addRpcMethod(()=>new At(e))}const It=(0,o.S7)("SNPCoverageAdapter",{subadapter:{type:"frozen",defaultValue:null},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0});function Pt(e){e.addAdapterType(()=>new b.A({name:"SNPCoverageAdapter",displayName:"SNPCoverage adapter",adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(5354).then(n.bind(n,45354)).then(e=>e.default),configSchema:It}))}var Lt=n(7332);class Rt extends Lt.default{supportsSVG=!0;deserializeResultsInClient(e,t){const n=super.deserializeResultsInClient(e,t),r=(e.skipFeatures??[]).map(e=>q.A.fromJSON(e));for(const e of r)n.features.set(e.id(),e);return{...n,skipFeatures:r}}async render(e){const{sessionId:t,adapterConfig:r,regions:a}=e,i=this.pluginManager,{dataAdapter:o}=await(0,at.cK)(i,t,r),s=a[0],l=await(0,it._)(o.getFeatures(s,e).pipe((0,ot.$)())),c=new Map(l.map(e=>[e.id(),e])),{renderSNPCoverageToCanvas:d}=await n.e(5403).then(n.bind(n,95403));return d({...e,features:c})}}const Ft=(0,o.S7)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},showArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},showInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},showInterbaseIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0},color:{type:"color",description:"Background color for the SNPCoverage renderer",defaultValue:"#d3d3d3"}},{explicitlyTyped:!0});function Dt(e){e.addRendererType(()=>new Rt({name:"SNPCoverageRenderer",ReactComponent:(0,a.lazy)(()=>n.e(1038).then(n.bind(n,11038))),configSchema:Ft,pluginManager:e}))}class Nt extends r.A{name="AlignmentsPlugin";install(e){[v,x,Ve,rt,y,Pt,M,kt,ht,Tt,Mt,Dt,We,Ke,E,u,T].map(t=>{t(e)})}}var Bt=n(92558);class Vt extends Lt.default{}const Et=(0,o.S7)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue",contextVariable:["feature"]},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')",contextVariable:["feature"]},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50",contextVariable:["feature"]},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},displayMode:{type:"enum",defaultValue:"arcs",model:c.types.enumeration("DisplayMode",["arcs","semicircles"]),description:"render semi-circles instead of arcs"}},{explicitlyTyped:!0});function zt(e){return c.types.compose("LinearArcDisplay",J.L,c.types.model({type:c.types.literal("LinearArcDisplay"),configuration:(0,o.AK)(e),displayMode:c.types.maybe(c.types.string)})).views(e=>({get blockType(){return"staticBlocks"},get renderDelay(){return 500},get rendererTypeName(){return e.configuration.renderer.type}})).views(e=>({get displayModeSetting(){return e.displayMode??(0,L.FI)(e,["renderer","displayMode"])}})).views(e=>({get rendererConfig(){return{...(0,L.FI)(e,["renderer"])||{},displayMode:e.displayModeSetting}}})).views(e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),config:e.rendererConfig,height:e.height})}}).actions(e=>({setDisplayMode(t){e.displayMode=t}})).views(e=>{const t=e.trackMenuItems;return{trackMenuItems:()=>[...t(),{label:"Display mode",subMenu:[{type:"radio",label:"Arcs",onClick:()=>{e.setDisplayMode("arcs")},checked:"arcs"===e.displayMode},{type:"radio",label:"Semi-circles",onClick:()=>{e.setDisplayMode("semicircles")},checked:"semicircles"===e.displayMode}]}]}})}function jt(e){return c.types.compose("LinearPairedArcDisplay",R.q,(0,ze.A)(),(0,je.A)(),c.types.model({type:c.types.literal("LinearPairedArcDisplay"),configuration:(0,o.AK)(e),displayMode:c.types.maybe(c.types.string)})).volatile(()=>({lastDrawnOffsetPx:0,features:void 0,loading:!1,drawn:!0})).views(e=>({get displayModeSetting(){return e.displayMode??(0,L.FI)(e,["renderer","displayMode"])}})).actions(e=>({selectFeature(t){const n=(0,k.getSession)(e);if((0,U.lO)(n)){const r=n.addWidget("VariantFeatureWidget","variantFeature",{view:(0,k.getContainingView)(e),track:(0,k.getContainingTrack)(e),featureData:t.toJSON()});n.showWidget(r)}(0,U.mY)(n)&&n.setSelection(t)},setLoading(t){e.loading=t},setFeatures(t){e.features=t},setDisplayMode(t){e.displayMode=t}})).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(2583).then(n.bind(n,2583));t(e)}catch(t){console.error(t),e.setError(t)}})()},async renderSvg(t){const{renderArcSvg:r}=await Promise.all([n.e(208),n.e(1176)]).then(n.bind(n,91176));return r(e,t)}}))}class Ht extends r.A{name="ArcRenderer";install(e){!function(e){e.addRendererType(()=>new Vt({name:"ArcRenderer",ReactComponent:(0,a.lazy)(()=>n.e(3477).then(n.bind(n,63477))),configSchema:Et,pluginManager:e}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearArcDisplay",{renderer:c.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:P.A,explicitlyTyped:!0})}(e);return new I.A({name:"LinearArcDisplay",displayName:"Arc display",configSchema:t,stateModel:zt(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:z.Ay})})}(e),function(e){e.addDisplayType(()=>{const e=(0,o.S7)("LinearPairedArcDisplay",{color:{type:"color",description:"the color of the arcs",defaultValue:"jexl:defaultPairedArcColor(feature,alt)",contextVariable:["feature","alt"]}},{baseConfiguration:P.A,explicitlyTyped:!0});return new I.A({name:"LinearPairedArcDisplay",displayName:"Variant display arcs",helpText:"Can display arcs connecting SVs and breakends in VCF format or BEDPE pairs",configSchema:e,stateModel:jt(e),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(208),n.e(8954)]).then(n.bind(n,28954)))})})}(e),e.jexl.addFunction("logThickness",(e,t)=>Math.log(e.get(t)+1)),e.jexl.addFunction("defaultPairedArcColor",(e,t)=>t?.startsWith("<DEL")?Bt.set1[0]:t?.startsWith("<DUP")?Bt.set1[1]:t?.startsWith("<INV")?Bt.set1[2]:t?.startsWith("<TRA")?Bt.set1[3]:t?.startsWith("<CNV")?Bt.set1[4]:Bt.set1[6])}}var _t=n(90106),$t=n(48716);const Ot=(0,o.S7)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},state:{description:"optional state for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint. can be 'token' or 'code'",type:"string",defaultValue:"code"}},{baseConfiguration:$t.y,explicitlyTyped:!0}),Gt=(0,o.S7)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]}},{baseConfiguration:Ot,explicitlyTyped:!0});var Wt=n(55614),Ut=n(7929);function qt(e){const t=(0,Wt.c)(3);let n,r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,te.jsx)("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"}),t[0]=n):n=t[0],t[1]!==e?(r=(0,te.jsx)(Ut.A,{...e,children:n}),t[1]=e,t[2]=r):r=t[2],r}async function Jt({response:e,reason:t,statusText:n}){return[`HTTP ${e.status}`,t,n??await Xt(e)].filter(e=>!!e).join(" - ")}async function Xt(e){try{return await e.text()}catch(t){return e.statusText}}const Kt={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};async function Qt(e,t){let n="";try{const t=JSON.parse(await e.text()).error[".tag"];n=Kt[t]||t}catch(e){}return Jt({response:e,reason:t,statusText:n})}var Zt=n(7380),Yt=n(15773);function en(e,t){try{const n=JSON.parse(e);return"invalid_grant"===n.error&&t(),n?.error_description??e}catch(e){}return e}function tn(e,t){return e.refresh_token&&t(e.refresh_token),e.access_token}const nn=e=>Zt.X.named("OAuthInternetAccount").props({type:c.types.literal("OAuthInternetAccount"),configuration:(0,o.AK)(e)}).views(()=>{let e;return{get codeVerifierPKCE(){if(!e){const t=new Uint8Array(32);globalThis.crypto.getRandomValues(t),e=(0,Yt._e)(t)}return e}}}).views(e=>({get authEndpoint(){return(0,L.FI)(e,"authEndpoint")},get tokenEndpoint(){return(0,L.FI)(e,"tokenEndpoint")},get needsPKCE(){return(0,L.FI)(e,"needsPKCE")},get clientId(){return(0,L.FI)(e,"clientId")},get scopes(){return(0,L.FI)(e,"scopes")},state:()=>(0,L.FI)(e,"state"),get responseType(){return(0,L.FI)(e,"responseType")},get refreshTokenKey(){return`${e.internetAccountId}-refreshToken`}})).actions(e=>({storeRefreshToken(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:()=>localStorage.getItem(e.refreshTokenKey),async exchangeAuthorizationForAccessToken(t,n){const r=new URLSearchParams(Object.entries({code:t,grant_type:"authorization_code",client_id:e.clientId,redirect_uri:n,...e.needsPKCE?{code_verifier:e.codeVerifierPKCE}:{}})),a=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(!a.ok)throw new Error(await Jt({response:a,reason:"Failed to obtain token"}));return tn(await a.json(),e=>{this.storeRefreshToken(e)})},async exchangeRefreshForAccessToken(t){const n=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Object.entries({grant_type:"refresh_token",refresh_token:t,client_id:e.clientId})).toString()});if(!n.ok){e.removeToken();const t=await n.text();throw new Error(await Jt({response:n,statusText:en(t,()=>{this.removeRefreshToken()})}))}return tn(await n.json(),e=>{this.storeRefreshToken(e)})}})).actions(e=>{let t,n;return{addMessageChannel(e,n){t=t=>{this.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},async finishOAuthWindow(t,n,r){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return void this.deleteMessageChannel();const a=t.data.redirectUri,i=a.replace("#","?"),o=new URL(i),s=o.search,l=new URLSearchParams(s);if(l.has("access_token")){const t=l.get("access_token");return t?(e.storeToken(t),void n(t)):void r(new Error("Error with token endpoint"))}if(l.has("code")){const t=l.get("code");if(!t)return void r(new Error("Error with authorization endpoint"));try{const r=await e.exchangeAuthorizationForAccessToken(t,o.origin+o.pathname);return e.storeToken(r),void n(r)}catch(e){return void(e instanceof Error?r(e):r(new Error(String(e))))}}a.includes("access_denied")?r(new Error("OAuth flow was cancelled")):a.includes("error")?r(new Error(`OAuth flow error: ${s}`)):this.deleteMessageChannel()},async useEndpointForAuthorization(t,n){const r=k.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,a={client_id:e.clientId,redirect_uri:r,response_type:e.responseType,token_access_type:"offline"};e.state()&&(a.state=e.state()),e.scopes&&(a.scope=e.scopes),e.needsPKCE&&(a.code_challenge=await async function(e){return(0,Yt.gg)(e)}(e.codeVerifierPKCE),a.code_challenge_method="S256");const i=new URLSearchParams(Object.entries(a)),o=new URL(e.authEndpoint);o.search=i.toString();const s=`JBrowseAuthWindow-${e.internetAccountId}`;if(k.isElectron){const{ipcRenderer:r}=window.require("electron"),i=await r.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:a,url:o.toString()}),l=new MessageEvent("message",{data:{name:s,redirectUri:i}});this.finishOAuthWindow(l,t,n)}else window.open(o,s,"width=500,height=600,left=0,top=0")},async getTokenFromUser(t,n){const r=e.retrieveRefreshToken();let a=!0;if(r)try{t(await e.exchangeRefreshForAccessToken(r)),a=!1}catch(t){console.error(t),e.removeRefreshToken()}a&&(this.addMessageChannel(t,n),this.useEndpointForAuthorization(t,n))},async validateToken(t,r){const a=e.addAuthHeaderToInit({method:"HEAD"},t),i=await fetch(r.uri,a);if(!i.ok){e.removeToken();const t=e.retrieveRefreshToken();if(t)try{n||(n=e.exchangeRefreshForAccessToken(t));const r=await n;return n=void 0,r}catch(e){console.error("Token could not be refreshed",e)}throw new Error(await Jt({response:i,reason:"Error validating token"}))}return t}}}).actions(e=>{const t=e.getFetcher;return{getFetcher(n){const r=t(n);return async(t,a)=>(n&&await e.validateToken(await e.getToken(n),n),r(t,a))}}}),rn=e=>nn(Ot).named("DropboxOAuthInternetAccount").props({type:c.types.literal("DropboxOAuthInternetAccount"),configuration:(0,o.AK)(e)}).views(()=>({get toggleContents(){return(0,te.jsx)(qt,{})},get selectorLabel(){return"Enter Dropbox share link"}})).actions(e=>({getFetcher:t=>async(n,r)=>{const a=await e.getToken(t),i=e.addAuthHeaderToInit({...r,method:"POST"},a);i.headers.append("Dropbox-API-Arg",JSON.stringify({url:n}));const o=await fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",i);if(!o.ok)throw new Error(await Qt(o));return o},async validateToken(t,n){const r=await fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({url:n.uri})});if(!r.ok){const t=e.retrieveRefreshToken();if(t){e.removeRefreshToken();const r=await e.exchangeRefreshForAccessToken(t);return this.validateToken(r,n)}throw new Error(await Qt(r,"Token could not be validated"))}return t}})),an=(0,o.S7)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:$t.y,explicitlyTyped:!0});var on=n(28910),sn=n(63209),ln=n(23149),cn=n(35703),dn=n(44641);const un=e=>{const t=(0,Wt.c)(20),{internetAccountId:n,handleClose:r}=e,[i,o]=(0,a.useState)("");let s;t[0]!==r?(s=()=>{r()},t[0]=r,t[1]=s):s=t[1];const l=`Enter token for ${n}`;let c,d,u;t[2]===Symbol.for("react.memo_cache_sentinel")?(c={display:"flex",flexDirection:"column"},t[2]=c):c=t[2],t[3]===Symbol.for("react.memo_cache_sentinel")?(d=e=>{o(e.target.value)},t[3]=d):d=t[3],t[4]===Symbol.for("react.memo_cache_sentinel")?(u=(0,te.jsx)(sn.A,{style:c,children:(0,te.jsx)(ln.A,{required:!0,label:"Enter Token",variant:"outlined",onChange:d,margin:"dense",slotProps:{htmlInput:{"data-testid":"entry-externalToken"}}})}),t[4]=u):u=t[4];const p=!i;let h,g,f,m,y;return t[5]!==r||t[6]!==i?(h=()=>{i&&r(i)},t[5]=r,t[6]=i,t[7]=h):h=t[7],t[8]!==p||t[9]!==h?(g=(0,te.jsx)(cn.A,{variant:"contained",color:"primary",type:"submit",disabled:p,onClick:h,children:"Add"}),t[8]=p,t[9]=h,t[10]=g):g=t[10],t[11]!==r?(f=(0,te.jsx)(cn.A,{variant:"contained",color:"secondary",onClick:()=>{r()},children:"Cancel"}),t[11]=r,t[12]=f):f=t[12],t[13]!==g||t[14]!==f?(m=(0,te.jsxs)(dn.A,{children:[g,f]}),t[13]=g,t[14]=f,t[15]=m):m=t[15],t[16]!==s||t[17]!==m||t[18]!==l?(y=(0,te.jsxs)(on.A,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",onClose:s,title:l,children:[u,m]}),t[16]=s,t[17]=m,t[18]=l,t[19]=y):y=t[19],y},pn=e=>Zt.X.named("ExternalTokenInternetAccount").props({type:c.types.literal("ExternalTokenInternetAccount"),configuration:(0,o.AK)(e)}).views(e=>({get validateWithHEAD(){return(0,L.FI)(e,"validateWithHEAD")}})).actions(e=>({getTokenFromUser(t,n){const{session:r}=(0,c.getRoot)(e);r.queueDialog(r=>[un,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):n(new Error("user cancelled entry")),r()}}])},async validateToken(t,n){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(n.uri,r);if(!a.ok){let e;try{e=await a.text()}catch(t){e=""}throw new Error(`Token could not be validated  ${a.status} ${e?` (${e})`:""}`)}return t}})),hn=(0,o.S7)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:Ot,explicitlyTyped:!0});var gn=n(206);class fn extends gn.g{constructor(e,t){super(e,t),this.statsPromise=this.fetch(e,{metadataOnly:!0}).then(e=>e.json())}async fetch(e,t){return super.fetch(e,t)}async stat(){return this.statsPromise}}function mn(e){const t=(0,Wt.c)(3);let n,r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,te.jsx)("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"}),t[0]=n):n=t[0],t[1]!==e?(r=(0,te.jsx)(Ut.A,{...e,children:n}),t[1]=e,t[2]=r):r=t[2],r}async function yn(e,t){let n="";try{n=JSON.parse(await e.text()).error.message}catch(e){}return Jt({response:e,reason:t,statusText:n})}function bn(e){return`https://www.googleapis.com/drive/v3/files/${/[-\w]{25,}/.exec(e)}`}function wn(e){return nn(Ot).named("GoogleDriveOAuthInternetAccount").props({type:c.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,o.AK)(e)}).views(()=>({get toggleContents(){return(0,te.jsx)(mn,{})},get selectorLabel(){return"Enter Google Drive share link"}})).actions(e=>({getFetcher:t=>async(n,r)=>{const a=new URL(bn(String(n))),i=new URLSearchParams;r?.metadataOnly?i.append("fields","size"):i.append("alt","media"),a.search=i.toString();const o=await e.getToken(t),s=await fetch(a,e.addAuthHeaderToInit({...r,method:"GET",credentials:"same-origin"},o));if(!s.ok)throw new Error(await yn(s));return s},openLocation(e){return new fn(e.uri,{fetch:this.getFetcher(e)})},async validateToken(e,t){const n=await fetch(bn(t.uri),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"}});if(!n.ok)throw new Error(await yn(n,"Token could not be validated"));return e}}))}const vn=(0,o.S7)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:$t.y,explicitlyTyped:!0});function Sn(e){const t=(0,Wt.c)(21),{internetAccountId:n,handleClose:r}=e,[i,o]=(0,a.useState)(""),[s,l]=(0,a.useState)(""),c=`Log in for ${n}`;let d,u,p,h,g,f,m,y,b,w,v;return t[0]!==r?(d=()=>{r()},t[0]=r,t[1]=d):d=t[1],t[2]!==r||t[3]!==s||t[4]!==i?(u=e=>{i&&s?r(btoa(`${i}:${s}`)):r(),e.preventDefault()},t[2]=r,t[3]=s,t[4]=i,t[5]=u):u=t[5],t[6]===Symbol.for("react.memo_cache_sentinel")?(p={display:"flex",flexDirection:"column"},t[6]=p):p=t[6],t[7]===Symbol.for("react.memo_cache_sentinel")?(h=e=>{o(e.target.value)},t[7]=h):h=t[7],t[8]===Symbol.for("react.memo_cache_sentinel")?(g=(0,te.jsx)(ln.A,{required:!0,label:"Username",variant:"outlined",onChange:h,margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-username"}}}),t[8]=g):g=t[8],t[9]===Symbol.for("react.memo_cache_sentinel")?(f=e=>{l(e.target.value)},t[9]=f):f=t[9],t[10]===Symbol.for("react.memo_cache_sentinel")?(m=(0,te.jsxs)(sn.A,{style:p,children:[g,(0,te.jsx)(ln.A,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",onChange:f,margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-password"}}})]}),t[10]=m):m=t[10],t[11]===Symbol.for("react.memo_cache_sentinel")?(y=(0,te.jsx)(cn.A,{variant:"contained",color:"primary",type:"submit",children:"Submit"}),t[11]=y):y=t[11],t[12]!==r?(b=(0,te.jsxs)(dn.A,{children:[y,(0,te.jsx)(cn.A,{variant:"contained",color:"secondary",type:"submit",onClick:()=>{r()},children:"Cancel"})]}),t[12]=r,t[13]=b):b=t[13],t[14]!==b||t[15]!==u?(w=(0,te.jsxs)("form",{onSubmit:u,children:[m,b]}),t[14]=b,t[15]=u,t[16]=w):w=t[16],t[17]!==c||t[18]!==w||t[19]!==d?(v=(0,te.jsx)(on.A,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",title:c,onClose:d,children:w}),t[17]=c,t[18]=w,t[19]=d,t[20]=v):v=t[20],v}const xn=e=>Zt.X.named("HTTPBasicInternetAccount").props({type:c.types.literal("HTTPBasicInternetAccount"),configuration:(0,o.AK)(e)}).views(e=>({get validateWithHEAD(){return(0,L.FI)(e,"validateWithHEAD")}})).actions(e=>({getTokenFromUser(t,n){const{session:r}=(0,c.getRoot)(e);r.queueDialog(r=>[Sn,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):n(new Error("User cancelled entry")),r()}}])},async validateToken(t,n){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(n.uri,r);if(!a.ok)throw new Error(await Jt({response:a,reason:"Error validating token"}));return t}}));class kn extends r.A{name="AuthenticationPlugin";exports={OAuthConfigSchema:Ot,OAuthInternetAccountModelFactory:nn,ExternalTokenConfigSchema:an,ExternalTokenInternetAccountModelFactory:pn,HTTPBasicConfigSchema:vn,HTTPBasicInternetAccountModelFactory:xn,DropboxOAuthConfigSchema:Gt,DropboxOAuthInternetAccountModelFactory:rn,GoogleDriveOAuthConfigSchema:hn,GoogleDriveOAuthInternetAccountModelFactory:wn};install(e){e.addInternetAccountType(()=>new _t.A({name:"OAuthInternetAccount",configSchema:Ot,stateModel:nn(Ot)})),e.addInternetAccountType(()=>new _t.A({name:"ExternalTokenInternetAccount",configSchema:an,stateModel:pn(an)})),e.addInternetAccountType(()=>new _t.A({name:"HTTPBasicInternetAccount",configSchema:vn,stateModel:xn(vn)})),e.addInternetAccountType(()=>new _t.A({name:"DropboxOAuthInternetAccount",configSchema:Gt,stateModel:rn(Gt)})),e.addInternetAccountType(()=>new _t.A({name:"GoogleDriveOAuthInternetAccount",configSchema:hn,stateModel:wn(hn)}))}}const Cn=(0,o.S7)("BedAdapter",{bedLocation:{type:"fileLocation",description:"path to bed file, also allows gzipped bed",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Tn=(0,o.S7)("BedGraphAdapter",{bedGraphLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGraphLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),An=(0,o.S7)("BedGraphTabixAdapter",{bedGraphGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},index:(0,o.S7)("VcfIndex",{indexType:{model:c.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGraphGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e}),Mn=(0,o.S7)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,o.S7)("TabixIndex",{indexType:{model:c.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e}),In=(0,o.S7)("BedpeAdapter",{bedpeLocation:{type:"fileLocation",description:"can be plaintext or gzipped, not indexed so loaded into memory on startup",defaultValue:{uri:"/path/to/my.bedpe.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedpeLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Pn=(0,o.S7)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},aggregateField:{type:"string",description:"An attribute to aggregate features with",defaultValue:"geneName2"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bigBedLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class Ln extends r.A{name="BedPlugin";install(e){!function(e){e.addAdapterType(()=>new b.A({name:"BigBedAdapter",displayName:"BigBed adapter",configSchema:Pn,getAdapterClass:()=>Promise.all([n.e(1448),n.e(8113),n.e(2087)]).then(n.bind(n,92087)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"BedAdapter",displayName:"BED adapter",configSchema:Cn,getAdapterClass:()=>Promise.all([n.e(1448),n.e(5501)]).then(n.bind(n,45501)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"BedpeAdapter",displayName:"BEDPE adapter",configSchema:In,getAdapterClass:()=>n.e(1977).then(n.bind(n,21977)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"BedTabixAdapter",displayName:"BED tabix adapter",configSchema:Mn,getAdapterClass:()=>Promise.all([n.e(5188),n.e(1448),n.e(499)]).then(n.bind(n,60499)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"BedGraphAdapter",displayName:"BedGraph adapter",configSchema:Tn,getAdapterClass:()=>n.e(5479).then(n.bind(n,95479)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"BedGraphTabixAdapter",displayName:"BedGraphTabix adapter",configSchema:An,getAdapterClass:()=>Promise.all([n.e(5188),n.e(2649)]).then(n.bind(n,22649)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t),i=n&&(0,C.getFileName)(n);return(0,k.testAdapter)(a,/\.bedpe(\.gz)?$/i,r,"BedpeAdapter")?{type:"BedpeAdapter",bedpeLocation:t}:(0,k.testAdapter)(a,/\.bb$/i,r,"BigBedAdapter")||(0,k.testAdapter)(a,/\.bigBed?$/i,r,"BigBedAdapter")?{type:"BigBedAdapter",bigBedLocation:t}:(0,k.testAdapter)(a,/\.bed$/i,r,"BedAdapter")?{type:"BedAdapter",bedLocation:t}:(0,k.testAdapter)(a,/\.bg$/i,r,"BedGraphAdapter")?{type:"BedGraphAdapter",bedGraphLocation:t}:(0,k.testAdapter)(a,/\.bg(\.gz)?$/i,r,"BedGraphTabixAdapter")?{type:"BedGraphTabixAdapter",bedGraphGzLocation:t,index:{location:n||(0,C.makeIndex)(t,".tbi"),indexType:(0,C.makeIndexType)(i,"CSI","TBI")}}:(0,k.testAdapter)(a,/\.bed\.gz$/i,r,"BedTabixAdapter")?{type:"BedTabixAdapter",bedGzLocation:t,index:{location:n||(0,C.makeIndex)(t,".tbi"),indexType:(0,C.makeIndexType)(i,"CSI","TBI")}}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>({BedpeAdapter:"VariantTrack",BedGraphAdapter:"QuantitativeTrack",BedGraphTabixAdapter:"QuantitativeTrack"}[t]||e(t)))}(e)}}var Rn=n(38817);const Fn=(0,o.S7)("BreakpointAlignmentsWidget",{}),Dn=c.types.model("BreakpointAlignmentsWidget",{id:Rn.K,type:c.types.literal("BreakpointAlignmentsWidget"),featureData:c.types.frozen()}).actions(e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}})),Nn=/(\d+)[SH]$/,Bn=/^(\d+)([SH])/;function Vn(e,t){return-1===t?+(Nn.exec(e)?.[1]??0):+(Bn.exec(e)?.[1]??0)}class En extends st.A{name="BreakpointGetFeatures";async deserializeReturn(e,t,n){return(await super.deserializeReturn(e,t,n)).map(e=>new q.A(e))}async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,k.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}async execute(e,t){const{stopToken:n,statusCallback:r,sessionId:a,adapterConfig:i,regions:o,opts:s}=await this.deserializeArguments(e,t),l=(await(0,at.cK)(this.pluginManager,a,i)).dataAdapter;return(await(0,it._)(l.getFeaturesInMultipleRegions(o,{...s,statusCallback:r,stopToken:n}).pipe((0,ot.$)()))).map(e=>{const t=e.get("CIGAR"),n=e.get("strand");return{uniqueId:e.id(),start:e.get("start"),end:e.get("end"),refName:e.get("refName"),strand:n,flags:e.get("flags"),name:e.get("name"),id:e.get("id"),tags:e.get("tags"),pair_orientation:e.get("pair_orientation"),type:e.get("type"),ALT:e.get("ALT"),INFO:e.get("INFO"),clipLengthAtStartOfRead:t&&void 0!==n?Vn(t,n):void 0}})}}var zn=n(97849),jn=n(7328),Hn=n(10693),_n=n(59962),$n=n(66878);const On=(0,a.lazy)(()=>n.e(7631).then(n.bind(n,67631)));function Gn(e){return c.types.compose("BreakpointSplitView",jn.A,c.types.model({type:c.types.literal("BreakpointSplitView"),height:c.types.optional(c.types.number,400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactiveOverlay:!0,showHeader:!1,views:c.types.array(e.getViewType("LinearGenomeView").stateModel),init:c.types.frozen()})).volatile(()=>({width:800,matchedTrackFeatures:{}})).views(e=>({get hasSomethingToShow(){return e.views.length>0||!!e.init},get initialized(){return e.views.length>0&&e.views.every(e=>e.initialized)},get showImportForm(){return!this.hasSomethingToShow}})).views(e=>({async exportSvg(t={}){const{renderToSvg:r}=await Promise.all([n.e(208),n.e(3917),n.e(6069)]).then(n.bind(n,36069)),a=await r(e,t),{saveAs:i}=await n.e(1611).then(n.bind(n,91611));if("png"===t.format){const e=new Image,n=new Blob([a],{type:"image/svg+xml"}),r=URL.createObjectURL(n);await new Promise((n,a)=>{e.onload=()=>{const o=document.createElement("canvas");o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(e,0,0),URL.revokeObjectURL(r),o.toBlob(r=>{r?(i(r,t.filename||"image.png"),n()):a(new Error(`Failed to create PNG. The image may be too large (${e.width}x${e.height}). Try reducing the view size or use SVG format.`))},"image/png")},e.onerror=()=>{URL.revokeObjectURL(r),a(new Error("Failed to load SVG for PNG conversion"))},e.src=r})}else i(new Blob([a],{type:"image/svg+xml"}),t.filename||"image.svg")}})).views(e=>({get matchedTracks(){return 1===e.views.length?e.views[0].tracks:(0,$n.y$)(e=>e.configuration.trackId,...e.views.map(e=>e.tracks))},getMatchedTracks:t=>e.views.map(e=>e.getTrack(t)).filter(k.notEmpty),hasTranslocations(e){return[...this.getTrackFeatures(e).values()].some(e=>"translocation"===e.get("type"))},hasPairedFeatures(e){return[...this.getTrackFeatures(e).values()].some(e=>"paired_feature"===e.get("type"))},getTrackFeatures:t=>new Map(e.matchedTrackFeatures[t]?.flat().map(e=>[e.id(),e])),getMatchedFeaturesInLayout(e,t){const n=this.getMatchedTracks(e);return t.map(e=>e.map(e=>{for(const[t,r]of n.entries()){const n=(0,$n._u)(r,e);if(n)return{feature:e,layout:n,level:t,clipLengthAtStartOfRead:e.get("clipLengthAtStartOfRead")??0}}}).filter(k.notEmpty))}})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,c.addMiddleware)(e,(t,n)=>{if("action"===t.type&&t.id===t.rootId){const r=["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"];if(e.linkViews&&r.includes(t.name)){const r=(0,c.getPath)(t.context);n(t);for(const n of e.views)(0,c.getPath)(n)!==r&&n[t.name](t.args[0]);return}}n(t)}))},setWidth(t){e.width=t;for(const n of e.views)n.setWidth(t)},setInteractiveOverlay(t){e.interactiveOverlay=t},setShowIntraviewLinks(t){e.showIntraviewLinks=t},setLinkViews(t){e.linkViews=t},setShowHeader(t){e.showHeader=t},setMatchedTrackFeatures(t){e.matchedTrackFeatures=t},reverseViewOrder(){e.views.reverse()},setInit(t){e.init=t},setViews(t){e.views=(0,c.cast)(t.map(e=>({type:"LinearGenomeView",hideHeader:!0,init:e})))}})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(function(){const{init:t,width:n}=e;n&&t&&(e.setViews(t.views),e.setInit(void 0))},{name:"BreakpointSplitViewInit"})),(0,c.addDisposer)(e,(0,N.autorun)(async()=>{try{if(!e.views.every(e=>e.initialized))return;if(e.matchedTracks.some(e=>e.displays[0].notReady?.()))return;e.setMatchedTrackFeatures(Object.fromEntries(await Promise.all(e.matchedTracks.map(async t=>[t.configuration.trackId,await(0,$n.JV)(e,t)]))))}catch(t){console.error(t),(0,k.getSession)(e).notifyError(`${t}`,t)}},{name:"BreakpointFeatureFetcher",delay:1e3}))},menuItems:()=>[...e.views.map((e,t)=>({label:`Row ${t+1} view menu`,subMenu:e.menuItems()})),...e.views.length>1?[{label:"Reverse view order",onClick:()=>{e.reverseViewOrder()}}]:[],{label:"Show header",type:"checkbox",checked:e.showHeader,onClick:()=>{e.setShowHeader(!e.showHeader)}},{label:"Show intra-view links",type:"checkbox",checked:e.showIntraviewLinks,onClick:()=>{e.setShowIntraviewLinks(!e.showIntraviewLinks)}},{label:"Allow clicking alignment squiggles?",type:"checkbox",checked:e.interactiveOverlay,onClick:()=>{e.setInteractiveOverlay(!e.interactiveOverlay)}},{label:"Link views",type:"checkbox",icon:Hn.A,checked:e.linkViews,onClick:()=>{e.setLinkViews(!e.linkViews)}},{label:"Export SVG",icon:_n.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[On,{model:e,handleClose:t}])}}],rubberBandMenuItems:()=>[{label:"Zoom to region(s)",onClick:()=>{for(const t of e.views){const{leftOffset:e,rightOffset:n}=t;e&&n&&t.moveTo(e,n)}}}]})).postProcessSnapshot(e=>{if(!e)return e;const{init:t,height:n,trackSelectorType:r,showIntraviewLinks:a,linkViews:i,interactiveOverlay:o,showHeader:s,...l}=e;return{...l,...400!==n?{height:n}:{},..."hierarchical"!==r?{trackSelectorType:r}:{},...a?{}:{showIntraviewLinks:a},...i?{linkViews:i}:{},...o?{}:{interactiveOverlay:o},...s?{showHeader:s}:{}}})}class Wn extends r.A{name="BreakpointSplitViewPlugin";install(e){!function(e){e.addViewType(()=>new zn.A({name:"BreakpointSplitView",displayName:"Breakpoint split view",stateModel:Gn(e),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(208),n.e(3917),n.e(9376)]).then(n.bind(n,49376)))}))}(e),function(e){e.addWidgetType(()=>new i.A({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:Fn,stateModel:Dn,ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8705),n.e(5043),n.e(6569),n.e(4928)]).then(n.bind(n,10200)))}))}(e),function(e){e.addToExtensionPoint("LaunchView-BreakpointSplitView",async({session:e,views:t})=>{if(t.length<2)throw new Error("BreakpointSplitView requires at least 2 views to be specified");e.addView("BreakpointSplitView",{init:{views:t}})})}(e),function(e){e.addRpcMethod(()=>new En(e))}(e)}configure(){}}var Un=n(40907);function qn(e,t,n,r){return e.isCallback?(0,L.QZ)(t,n,{feature:r}):e.value}function Jn(e,t,n){const r=Array.isArray(t)?t.reduce((e,t)=>e?.[t],e):e[t],a=r?.isCallback??!1;return{value:a?n:(0,L.QZ)(e,t),isCallback:a}}function Xn(e){return"compact"===e?.5:1}const Kn=/(\bUTR|_UTR|untranslated[_\s]region)\b/i;function Qn(e,t){return e*(t?-1:1)}function Zn(e,t,n,r,a){return-1===a?e+t-r*n:e+r*n}function Yn(e,t=50){return e.length>t?`${e.slice(0,t-1)}`:e}function er(e,t,n){return e+t<0||e>n}function tr(e){return Kn.test(e.get("type")||"")}function nr({feature:e,config:t,configContext:n,colorByCDS:r,theme:a}){const{color1:i,color3:o}=n;let s;s=tr(e)?qn(o,t,"color3",e):qn(i,t,"color1",e);const l=e.get("type"),c=e.get("strand"),d=e.get("phase");if(r&&"CDS"===l&&void 0!==c&&void 0!==d){const t=e.get("start"),n=e.get("end"),r=(0,k.getFrame)(t,n,c,d),i=a.palette.framesCDS.at(r)?.main;i&&(s=i)}return s}function rr({feature:e,config:t,configContext:n,theme:r}){const{color2:a}=n,i=qn(a,t,"color2",e);return"#f0f"===i?(0,k.stripAlpha)(r.palette.text.secondary):i}function ar({feature:e,config:t,configContext:n,nameColor:r,descriptionColor:a,name:i,description:o}){const{showLabels:s,showDescriptions:l,fontHeight:c}=n,d=Yn(i),u=Yn(o),p=/\S/.test(d)&&s,h=/\S/.test(u)&&l,g=[];let f=0;return p&&(g.push({text:d,relativeY:f,color:r,textWidth:(0,k.measureText)(d,11)}),f+=qn(c,t,["labels","fontSize"],e)),h&&g.push({text:u,relativeY:f,color:a,textWidth:(0,k.measureText)(u,11)}),g}function ir({displayLabel:e,featureHeight:t,subfeatureLabels:n,color:r,parentFeatureId:a,subfeatureId:i,tooltip:o}){if(!e)return null;const s=Yn(e),l="overlay"===n;return{text:s,relativeY:l?2-t:0,color:r,textWidth:(0,k.measureText)(s,11),isOverlay:l,parentFeatureId:a,subfeatureId:i,tooltip:o}}function or(e,t){const n=e*(t?-1:1);return{left:-1===n?8:0,right:1===n?8:0,visualSide:-1===n?"left":1===n?"right":null,width:e?8:0}}function sr(e,t,n,r="Box"){const{bpPerPx:a,reversed:i,configContext:o}=n,{config:s,featureHeight:l,heightMultiplier:c}=o,d=qn(l,s,"height",e)*c,u=e.get("start"),p=e.get("end"),h=t.get("start"),g=t.get("end"),f=(p-u)/a;return{feature:e,glyphType:r,x:(i?g-p:u-h)/a,y:0,width:f,height:d,totalLayoutHeight:d,totalLayoutWidth:f,leftPadding:0,children:[]}}function lr(e,t,n,r,a,i){const o=n+a/2;e.strokeStyle=i,e.lineWidth=1,e.beginPath(),e.moveTo(t,o),e.lineTo(t+r,o),e.stroke()}function cr(e,t,n,r,a,i,o){const s=i?-1:1,l=7*a*s,c=a*s===-1?t:a*s===1?t+r:null;null!==c&&(e.strokeStyle=o,e.lineWidth=1,e.beginPath(),e.moveTo(c,n),e.lineTo(c+l,n),e.stroke(),e.fillStyle=o,e.beginPath(),e.moveTo(c+l/2,n-2.5),e.lineTo(c+l/2,n+2.5),e.lineTo(c+l,n),e.closePath(),e.fill())}function dr(e,t,n,r){const{feature:a}=t,{region:i,canvasWidth:o}=n,s=i.reversed??!1,l=t.x,c=t.width;if(er(l,c,o))return;const d=a.get("strand");d&&cr(e,l,t.y+t.height/2,c,d,s,r)}function ur(e,t,n,r,a){const{feature:i,children:o}=t,{region:s,configContext:l,theme:c,canvasWidth:d}=n,{config:u,displayDirectionalChevrons:p}=l,h=s.reversed??!1,g=t.x,f=t.width,m=t.y,y=t.height;if(er(g,f,d))return;const b=rr({feature:i,config:u,configContext:l,theme:c});if(lr(e,g,m,f,y,b),p){const t=i.get("strand");t&&function(e,t,n,r,a,i,o,s=40,l=4){if(0===a||r<s)return;e.strokeStyle=i,e.lineWidth=.5,e.beginPath();const c=l/2,d=Math.floor(r/s),u=(r-d*s)/2+s/2;for(let r=0;r<d;r++){const i=t+u+r*s;i+c<0||i-c>o||(1===a?(e.moveTo(i-c,n-c),e.lineTo(i+c,n),e.lineTo(i-c,n+c)):(e.moveTo(i+c,n-c),e.lineTo(i-c,n),e.lineTo(i+c,n+c)))}e.stroke()}(e,g,m+y/2,f,h?-t:t,b,d)}for(const t of o)"CDS"===t.glyphType?a.draw(e,t,n):r.draw(e,t,n);dr(e,t,n,b)}const pr={type:"Box",match(e){if("CDS"===e.get("type"))return!1;const t=e.get("subfeatures");return!t?.length},layout(e){const{feature:t,bpPerPx:n,reversed:r,configContext:a}=e,{config:i,featureHeight:o,heightMultiplier:s}=a,l=qn(o,i,"height",t)*s,c=(t.get("end")-t.get("start"))/n,d=!t.parent?.(),u=t.get("strand"),p=d?or(u,r):{left:0,right:0};return{feature:t,glyphType:"Box",x:0,y:0,width:c,height:l,totalLayoutHeight:l,totalLayoutWidth:c+p.left+p.right,leftPadding:p.left,children:[]}},draw(e,t,n){const{feature:r}=t,{region:a,bpPerPx:i,configContext:o,theme:s,canvasWidth:l}=n,{config:c}=o,d=n.colorByCDS??!1,{start:u,end:p}=a,h=Math.ceil((p-u)/i),g=t.width,f=t.x;if(er(f,g,l)||r.parent?.()&&"intron"===r.get("type"))return;let m=t.y,y=t.height;tr(r)&&(m+=.175*y,y*=.65);const b=Math.max(f,0),w=b-f,v=Math.max(2,Math.min(g-w,h)),S=nr({feature:r,config:c,configContext:o,colorByCDS:d,theme:s}),x=qn(o.outline,c,"outline",r);e.fillStyle=S,e.fillRect(b,m,v,y),x&&(e.strokeStyle=x,e.lineWidth=1,e.strokeRect(b,m,v,y)),r.parent?.()||dr(e,t,n,rr({feature:r,config:c,configContext:o,theme:s}))}};var hr=n(53121),gr=n(7201),fr=n(69033);function mr(e){return 1/e>=1}const yr={type:"CDS",match:e=>"CDS"===e.get("type"),layout(e){const{feature:t,bpPerPx:n,configContext:r}=e,{config:a,featureHeight:i,heightMultiplier:o}=r,s=qn(i,a,"height",t)*o,l=(t.get("end")-t.get("start"))/n;return{feature:t,glyphType:"CDS",x:0,y:0,width:l,height:s,totalLayoutHeight:s,totalLayoutWidth:l,leftPadding:0,children:[]}},draw(e,t,n){const{feature:r}=t,{region:a,bpPerPx:i,configContext:o,theme:s,canvasWidth:l,peptideDataMap:c}=n,{config:d}=o,u=n.colorByCDS??!1,p=a.reversed??!1,h=r.get("start"),g=r.get("end"),f=r.get("strand"),m=t.width,y=t.x,b=t.y,w=t.height;if(er(y,m,l))return;const v=r.parent?.()??r,S=c?.get(v.id()),x=S?.protein;if(mr(i)&&u&&x){const t=function(e,t,n,r,a){return function(e,t,n,r,a){const i=[],o=r-n;let s,l=null,c=0,d=0;for(let u=0;u<o;u++){const o=-1===a?r-u:n+u,p=t[o];if(void 0===p){console.warn(`No g2p mapping for position ${o}`);continue}const h=e[p]??"&";void 0===s?(s=p,l=h,c=d):s!==p&&(i.push({aminoAcid:l,startIndex:c,endIndex:d-1,length:d-c,proteinIndex:s}),s=p,l=h,c=d),d++}return null!==l&&i.push({aminoAcid:l,startIndex:c,endIndex:d-1,length:d-c,proteinIndex:s}),i}(t,(0,fr.W)(e.toJSON()).g2p,n,r,a)}(v,x,h,g,f);!function(e){const{ctx:t,aggregatedAminoAcids:n,baseColor:r,left:a,top:i,width:o,height:s,bpPerPx:l,strand:c,reversed:d,canvasWidth:u}=e,p=Qn(c,d),h=1/l,g=(0,hr.M)(r).toHex(),f=(0,gr.a)(g,.2),m=(0,gr.e$)(g,.1);for(let e=0,r=n.length;e<r;e++){const r=n[e],l=e%2==1?m:f,c=Zn(a,o,r.startIndex,h,p),d=Zn(a,o,r.endIndex+1,h,p),g=Math.min(c,d),y=Math.abs(c-d);g+y<0||g>u||(t.fillStyle=l,t.fillRect(g,i,y,s))}}({ctx:e,aggregatedAminoAcids:t,baseColor:nr({feature:r,config:d,configContext:o,colorByCDS:u,theme:s}),left:y,top:b,width:m,height:w,bpPerPx:i,strand:f,reversed:p,canvasWidth:l}),function(e){return 1/e>=8}(i)&&function(e){const{ctx:t,aggregatedAminoAcids:n,left:r,top:a,width:i,height:o,bpPerPx:s,strand:l,reversed:c,canvasWidth:d}=e;if(o<8)return;const u=Qn(l,c),p=1/s,h=o;t.font=`${h}px sans-serif`,t.textAlign="center",t.textBaseline="middle";const g=a+o/2;for(const e of n){const n=(Zn(r,i,e.startIndex,p,u)+Zn(r,i,e.endIndex+1,p,u))/2;if(n<0||n>d)continue;const a=e.length%3!=0||"&"===e.aminoAcid;t.fillStyle=a?"red":"black";const o=a||"*"===e.aminoAcid||"&"===e.aminoAcid?e.aminoAcid:`${e.aminoAcid}${e.proteinIndex+1}`;t.fillText(o,n,g)}}({ctx:e,aggregatedAminoAcids:t,left:y,top:b,width:m,height:w,bpPerPx:i,strand:f,reversed:p,canvasWidth:l})}else pr.draw(e,{...t,glyphType:"Box"},n)}},br=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78"],wr=new Set(["mature_protein_region_of_CDS","mature_protein_region"]);function vr(e){const t=e.get("subfeatures");return t?.filter(e=>wr.has(e.get("type")))??[]}const Sr={type:"MatureProteinRegion",hasIndexableChildren:!0,match:e=>"CDS"===e.get("type")&&vr(e).length>0,getSubfeatureMouseover(e){const t=e.get("product"),n=e.get("protein_id"),r=[];return t&&r.push(t),n&&r.push(`(${n})`),r.length>0?r.join(" "):void 0},layout(e){const{feature:t,bpPerPx:n,configContext:r}=e,{config:a,featureHeight:i,heightMultiplier:o,subfeatureLabels:s}=r,l=t.get("start"),c=t.get("end"),d=qn(i,a,"height",t)*o,u=(c-l)/n,p=(m=vr(t).map(n=>sr(n,t,e)),[...m].sort((e,t)=>{const n=e.feature.get("start"),r=t.feature.get("start");return n!==r?n-r:t.feature.get("end")-e.feature.get("end")})),h=d*("below"===s?2:1),g=h*Math.max(1,p.length),f="below"===s?Math.floor(h/2)-1:h-2;var m;for(const[e,t]of p.entries()){const n=t;n.y=e*h+1,n.height=f,n.totalLayoutHeight=h}return{feature:t,glyphType:"MatureProteinRegion",x:0,y:0,width:u,height:g,totalLayoutHeight:g,totalLayoutWidth:u,leftPadding:0,children:p}},draw(e,t,n){const{children:r}=t,{region:a,theme:i,canvasWidth:o}=n,s=a.reversed??!1,l=i.palette.text.secondary;for(const[t,n]of r.entries())xr(e,n,o,br[t%br.length],s,l)}};function xr(e,t,n,r,a,i){const{x:o,y:s,width:l,height:c,feature:d}=t;if(er(o,l,n))return;e.fillStyle=r,e.fillRect(o,s,l,c),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.strokeRect(o,s,l,c);const u=d.get("strand");u&&cr(e,o,s+c/2,l,u,a,i)}function kr(e,t){let n=e.get("subfeatures");if(!n||0===n.length)return[];const r=n.some(e=>tr(e)),a=["mRNA","transcript"].includes(e.get("type"));(!r&&a||(0,L.QZ)(t,"impliedUTRs"))&&(n=function(e,t){const n=[...t];let r,a,i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=[];for(const t of n){const n=t.get("type");/^cds/i.test(n)?(i>t.get("start")&&(i=t.get("start")),o<t.get("end")&&(o=t.get("end"))):/exon/i.test(n)?s.push(t):tr(t)&&(r=t.get("start")===e.get("start"),a=t.get("end")===e.get("end"))}if(!(s.length&&i<Number.POSITIVE_INFINITY&&o>Number.NEGATIVE_INFINITY))return n;s.sort((e,t)=>e.get("start")-t.get("start"));const l=e.get("strand");let c,d;if(!r)for(const[t,r]of s.entries()){if(c=r.get("start"),c>=i)break;d=Math.min(i,r.get("end"));const a=l>=0?"five_prime_UTR":"three_prime_UTR";n.unshift(new q.A({parent:e,id:`${e.id()}_${a}_${t}`,data:{start:c,end:d,strand:l,type:a}}))}if(!a)for(let t=s.length-1;t>=0&&(d=s[t].get("end"),!(d<=o));t--){c=Math.max(o,s[t].get("start"));const r=l>=0?"three_prime_UTR":"five_prime_UTR";n.push(new q.A({parent:e,id:`${e.id()}_${r}_${t}`,data:{start:c,end:d,strand:l,type:r}}))}return n}(e,n));const i=function(e,t){const n=(0,L.QZ)(t,e),r="string"==typeof n?n.split(/\s*,\s*/):n,a=new Set(r.map(e=>e.toLowerCase()));return e=>a.has(e.get("type").toLowerCase())}("subParts",t);return n.filter(i)}const Cr={type:"ProcessedTranscript",match(e,t){const n=e.get("type"),r=e.get("subfeatures");if(!r?.length)return!1;const{transcriptTypes:a}=t;if(!a.includes(n))return!1;return r.some(e=>"CDS"===e.get("type"))},layout(e){const{feature:t,bpPerPx:n,reversed:r,configContext:a}=e,{config:i,featureHeight:o,heightMultiplier:s}=a,l=t.get("start"),c=t.get("end"),d=qn(o,i,"height",t)*s,u=(c-l)/n,p=or(t.get("strand"),r),h=kr(t,i).map(n=>{const r=n.get("type");return sr(n,t,e,"CDS"===r?"CDS":"Box")});return{feature:t,glyphType:"ProcessedTranscript",x:0,y:0,width:u,height:d,totalLayoutHeight:d,totalLayoutWidth:u+p.left+p.right,leftPadding:p.left,children:h}},draw(e,t,n){ur(e,t,n,pr,yr)}},Tr={CACTA_TIR_transposon:"#e6194b",centromeric_repeat:"#3cb44b",Copia_LTR_retrotransposon:"#118119",Gypsy_LTR_retrotransposon:"#4363d8",hAT_TIR_transposon:"#f58231",helitron:"#911eb4",knob:"#46f0f0",L1_LINE_retrotransposon:"#f032e6",LINE_element:"#bcf60c",long_terminal_repeat:"#fb0",low_complexity:"#008080",LTR_retrotransposon:"#e6beff",Mutator_TIR_transposon:"#9a6324",PIF_Harbinger_TIR_transposon:"#fffac8",rDNA_intergenic_spacer_element:"#800000",repeat_region:"#aaffc3",RTE_LINE_retrotransposon:"#808000",subtelomere:"#ffd8b1",target_site_duplication:"#000075",Tc1_Mariner_TIR_transposon:"#808080"},Ar={type:"RepeatRegion",match(e){const t=e.get("type"),n=e.get("subfeatures");return"repeat_region"===t&&!!n?.length},layout(e){const{feature:t,bpPerPx:n,reversed:r,configContext:a}=e,{config:i,featureHeight:o,heightMultiplier:s}=a,l=t.get("start"),c=t.get("end"),d=qn(o,i,"height",t)*s,u=(c-l)/n,p=or(t.get("strand"),r),h=(t.get("subfeatures")||[]).map(n=>sr(n,t,e));return{feature:t,glyphType:"RepeatRegion",x:0,y:0,width:u,height:d,totalLayoutHeight:d,totalLayoutWidth:u+p.left+p.right,leftPadding:p.left,children:h}},draw(e,t,n){const{children:r}=t,{theme:a,canvasWidth:i}=n,o=t.x,s=t.width,l=t.y,c=t.height;if(er(o,s,i))return;const d=a.palette.text.secondary;lr(e,o,l,s,c,d);const u=[...r].sort((e,t)=>{const n=e.feature.get("type"),r=t.feature.get("type");return n.endsWith("_retrotransposon")?-1:r.endsWith("_retrotransposon")?1:0});for(const t of u){const n=t.feature.get("type");Mr(e,t,i,Tr[n]||"#000",n.endsWith("_retrotransposon"))}dr(e,t,n,d)}};function Mr(e,t,n,r,a){const{x:i,width:o,y:s,height:l}=t;if(er(i,o,n))return;let c=s,d=l;a&&(c+=.175*d,d*=.65),e.fillStyle=r,e.fillRect(i,c,o,d)}const Ir={type:"Segments",match(e,t){const n=e.get("type");if("CDS"===n)return!1;const r=e.get("subfeatures");if(!r?.length)return!1;const{transcriptTypes:a,containerTypes:i}=t;if(a.includes(n)){if(r.some(e=>"CDS"===e.get("type")))return!1}if(i.includes(n))return!1;const o=!e.parent?.(),s=r.some(e=>e.get("subfeatures")?.length);return!o||!s},layout(e){const{feature:t,bpPerPx:n,reversed:r,configContext:a}=e,{config:i,featureHeight:o,heightMultiplier:s}=a,l=t.get("start"),c=t.get("end"),d=qn(o,i,"height",t)*s,u=(c-l)/n,p=or(t.get("strand"),r),h=(t.get("subfeatures")||[]).map(n=>{const r=n.get("type");return sr(n,t,e,"CDS"===r?"CDS":"Box")});return{feature:t,glyphType:"Segments",x:0,y:0,width:u,height:d,totalLayoutHeight:d,totalLayoutWidth:u+p.left+p.right,leftPadding:p.left,children:h}},draw(e,t,n){ur(e,t,n,pr,yr)}};function Pr(e,t){const{feature:n,configContext:r,isNested:a,isTranscriptChild:i}=t,{config:o,showLabels:s,showDescriptions:l,subfeatureLabels:c,fontHeight:d,labelAllowed:u}=r;if(!u||a&&(!i||"none"===c))return;const p=!!i||s,h=!i&&l,g=Yn(String((0,L.QZ)(o,["labels","name"],{feature:n})||"")),f=/\S/.test(g)&&p,m=Yn(String((0,L.QZ)(o,["labels","description"],{feature:n})||"")),y=/\S/.test(m)&&h,b=qn(d,o,["labels","fontSize"],n);let w=0,v=0;f&&(w+=b,v=Math.max(v,(0,k.measureText)(g,b))),y&&(w+=b,v=Math.max(v,(0,k.measureText)(m,b))),i&&"overlay"===c||(e.totalLayoutHeight=e.height+w),e.totalLayoutWidth=Math.max(e.totalLayoutWidth,v)}const Lr=[Sr,Ar,yr,Cr,Ir,pr];function Rr(e,t){return Br(e,t,Lr)}const Fr=new Set(["CDS","cds"]);function Dr(e){return(e.get("subfeatures")||[]).some(e=>Fr.has(e.get("type"))||Dr(e))}const Nr=[Sr,Ar,yr,Cr,{type:"Subfeatures",match(e,t){const n=e.get("type"),r=e.get("subfeatures");if(!r?.length)return!1;const{containerTypes:a}=t;if(a.includes(n))return!0;const i=!e.parent?.(),o=r.some(e=>e.get("subfeatures")?.length);return i&&o},layout(e){const{feature:t,bpPerPx:n,reversed:r,configContext:a}=e,{config:i,featureHeight:o,heightMultiplier:s,geneGlyphMode:l,transcriptTypes:c}=a,d=t.get("start"),u=t.get("end"),p=qn(o,i,"height",t)*s,h=(u-d)/n;let g=[...t.get("subfeatures")||[]];const f=new Map(g.map(e=>[e.id(),Dr(e)]));g.sort((e,t)=>{const n=f.get(e.id()),r=f.get(t.id());return n&&!r?-1:!n&&r?1:0}),"longest"!==l&&"longestCoding"!==l||(g=function(e,t,n){if(e.length<=1)return e;const r=e.filter(e=>t.includes(e.get("type")));let a=r.length>0?r:e;if("longestCoding"===n){const e=a.filter(Dr);e.length>0&&(a=e)}return[a.reduce((e,t)=>e.get("end")-e.get("start")>t.get("end")-t.get("start")?e:t)]}(g,c,l));const m=[];let y=0;const{subfeatureLabels:b}=a;for(let i=0;i<g.length;i++){const o=g[i],s=o.get("type"),l=c.includes(s),p=Rr(o,a).layout({...e,feature:o,parentFeature:t});Pr(p,{feature:o,configContext:a,isNested:!0,isTranscriptChild:l});const h={start:o.get("start"),end:o.get("end")},f=(r?u-h.end:h.start-d)/n;p.x=f,p.y=y,m.push(p),y+="below"===b&&l?p.totalLayoutHeight:p.height,i<g.length-1&&(y+=2)}const w=y>0?y:p;return{feature:t,glyphType:"Subfeatures",x:0,y:0,width:h,height:w,totalLayoutHeight:w,totalLayoutWidth:h,leftPadding:0,children:m}},draw(e,t,n){const{children:r}=t;if(0!==r.length)for(const t of r)Rr(t.feature,n.configContext).draw(e,t,n);else pr.draw(e,{...t,glyphType:"Box"},n)}},Ir,pr];function Br(e,t,n=Nr){return n.find(n=>n.match(e,t))??pr}function Vr(e,t){if(t)return[...t.getGlyphTypes()].sort((e,t)=>t.priority-e.priority).find(t=>t.match?.(e))}function Er(e){const{feature:t,bpPerPx:n,reversed:r,configContext:a,pluginManager:i,isNested:o=!1,isTranscriptChild:s=!1}=e,l=Vr(t,i);let c;if(l){const e=l.getHeightMultiplier?.(t,a.config)??1,o={feature:t,bpPerPx:n,reversed:r,configContext:a,pluginManager:i};c=Br(t,a,Nr).layout(o),c.height*=e,c.totalLayoutHeight*=e}else{const e={feature:t,bpPerPx:n,reversed:r,configContext:a,pluginManager:i};c=Br(t,a,Nr).layout(e)}return Pr(c,{feature:t,configContext:a,isNested:o,isTranscriptChild:s}),c}var zr=n(56993),jr=n(61425);const Hr=Object.fromEntries(Nr.map(e=>[e.type,e]));function _r(e,t,n,r){const a=Vr(t.feature,r);if(a)return void a.draw({ctx:e,feature:t.feature,featureLayout:t,region:n.region,bpPerPx:n.bpPerPx,config:n.configContext.config,theme:n.theme,reversed:n.region.reversed??!1,topLevel:!0,canvasWidth:n.canvasWidth});const i=Hr[t.glyphType];i?i.draw(e,t,n):pr.draw(e,t,n)}function $r(e){return{...e}}function Or(e,t,n){const r=t+e.x,a=n+e.y;return{...e,x:r,y:a,children:e.children.map(e=>Or(e,r,a))}}function Gr({layout:e,featureLayout:t,subfeatureCoords:n,subfeatureInfos:r,config:a,configContext:i,pluginManager:o,subfeatureLabels:s,transcriptTypes:l,labelColor:c,parentTooltip:d}){Wr({layout:e,featureLayout:t,subfeatureCoords:n,subfeatureInfos:r,config:a,configContext:i,pluginManager:o,subfeatureLabels:s,transcriptTypes:l,labelColor:c,parentTooltip:d})}function Wr({layout:e,featureLayout:t,subfeatureCoords:n,subfeatureInfos:r,config:a,configContext:i,pluginManager:o,subfeatureLabels:s,transcriptTypes:l,labelColor:c,parentTooltip:d}){const u=t.feature,p="gene"===u.get("type"),h=function(e,t,n){const r=Nr.find(n=>n.hasIndexableChildren&&n.match(e,t));if(r)return r;if(n){const t=[...n.getGlyphTypes()].sort((e,t)=>t.priority-e.priority).find(t=>t.match?.(e)&&t.getChildFeatures);if(t)return t}}(u,i,o),g=p&&t.children.some(e=>l.includes(e.feature.get("type"))),f="none"!==s;if(h||g)for(const i of t.children){const o=i.feature,u=o.get("type");if(g&&!h&&!l.includes(u))continue;const p=i.x,m=i.x+i.totalLayoutWidth,y=i.y,b=i.y+i.totalLayoutHeight;n.push(p,y,m,b);const w=h?.getSubfeatureMouseover?.(o),v=w??String((0,L.QZ)(a,"subfeatureMouseover",{feature:o})||"");r.push({featureId:o.id(),parentFeatureId:t.feature.id(),displayLabel:v,type:u,leftPx:p,topPx:y,rightPx:m,bottomPx:b});const S=[];if(f&&v){const e=ir({displayLabel:v,featureHeight:i.height,subfeatureLabels:s,color:c,parentFeatureId:t.feature.id(),subfeatureId:o.id(),tooltip:h?v:d});e&&S.push(e)}const x=o.get("start"),k=o.get("end");e.addRect(o.id(),x,k,b-y,o,f&&S.length>0?$r({refName:o.get("refName"),floatingLabels:S,totalFeatureHeight:i.height,actualTopPx:y,featureWidth:i.width,featureStartBp:x,featureEndBp:k}):{refName:o.get("refName")})}for(const u of t.children)Wr({layout:e,featureLayout:u,subfeatureCoords:n,subfeatureInfos:r,config:a,configContext:i,pluginManager:o,subfeatureLabels:s,transcriptTypes:l,labelColor:c,parentTooltip:d})}function Ur(e,t){const n=new jr.A(Math.max(t,1));if(e.length)for(let t=0;t<e.length;t+=4)n.add(e[t],e[t+1],e[t+2],e[t+3]);else n.add(0,0,0,0);return n.finish(),n}var qr=n(84769);const Jr=["mRNA","transcript","primary_transcript","protein_coding_primary_transcript"];function Xr(e,t=Jr){return t.includes(e)}function Kr(e){const t=e.get("subfeatures");return t?.some(e=>"CDS"===e.get("type"))??!1}async function Qr(e,t,n){try{const r={...t.regions[0],start:n.get("start"),end:n.get("end")};let a=await async function(e,t,n){const{sessionId:r,sequenceAdapter:a}=t;if(a)try{const{dataAdapter:t}=await(0,at.cK)(e,r,a),i=await(0,it._)(t.getFeatures({...n,refName:n.seqAdapterRefName??n.refName,start:Math.max(0,n.start)}).pipe((0,ot.$)()));return i[0]?.get("seq")}catch(e){return void console.warn("[fetchSequence] Failed to fetch sequence:",e)}}(e,t,r);if(!a)return;const i=n.get("strand");let o=function(e){const t=e.get("subfeatures")||[],n=e.get("start");return t.filter(e=>"CDS"===e.get("type")).sort((e,t)=>e.get("start")-t.get("start")).map(e=>({start:e.get("start")-n,end:e.get("end")-n}))}(n);if(0===o.length)return;if(-1===i){a=(0,k.revcom)(a);const e=a.length;o=o.map(t=>({start:e-t.end,end:e-t.start})).reverse()}const s={seq:a,cds:o};try{return{sequenceData:s,protein:(0,qr.E)({cds:o,sequence:a,codonTable:(0,k.generateCodonTable)(k.defaultCodonTable)})}}catch(e){return console.warn(`[fetchTranscriptPeptides] Failed to convert sequence to peptides for ${n.id()}:`,e),{sequenceData:s}}}catch(e){return void console.warn(`[fetchTranscriptPeptides] Failed to fetch sequence for transcript ${n.id()}:`,e)}}async function Zr({layout:e,features:t,renderProps:n,pluginManager:r}){const{statusCallback:a=()=>{},regions:i,bpPerPx:o,config:s}=n,l=i[0],c=Math.max(1,(l.end-l.start)/o),d=function(e){const t=(0,L.QZ)(e,"displayMode");return{config:e,displayMode:t,showLabels:(0,L.QZ)(e,"showLabels"),showDescriptions:(0,L.QZ)(e,"showDescriptions"),subfeatureLabels:(0,L.QZ)(e,"subfeatureLabels"),transcriptTypes:(0,L.QZ)(e,"transcriptTypes"),containerTypes:(0,L.QZ)(e,"containerTypes"),geneGlyphMode:(0,L.QZ)(e,"geneGlyphMode"),displayDirectionalChevrons:(0,L.QZ)(e,"displayDirectionalChevrons"),color1:Jn(e,"color1","goldenrod"),color2:Jn(e,"color2","#f0f"),color3:Jn(e,"color3","#357089"),outline:Jn(e,"outline",""),featureHeight:Jn(e,"height",10),fontHeight:Jn(e,["labels","fontSize"],12),nameColor:Jn(e,["labels","nameColor"],"black"),descriptionColor:Jn(e,["labels","descriptionColor"],"blue"),labelAllowed:"collapse"!==t,heightMultiplier:Xn(t)}}(s),u=await(0,k.updateStatus)("Computing feature layout",a,async()=>function({features:e,bpPerPx:t,region:n,configContext:r,layout:a,pluginManager:i}){const o=n.reversed||!1,s=[],{config:l}=r;for(const n of e.values()){const e=Er({feature:n,bpPerPx:t,reversed:o,configContext:r,pluginManager:i}),c=e.totalLayoutWidth,d=e.totalLayoutHeight,u=String((0,L.QZ)(l,["labels","name"],{feature:n})||""),p=String((0,L.QZ)(l,["labels","description"],{feature:n})||""),{nameColor:h,descriptionColor:g}=r,f=qn(h,l,["labels","nameColor"],n),m=ar({feature:n,config:l,configContext:r,nameColor:"#f0f"===f?"black":f,descriptionColor:qn(g,l,["labels","descriptionColor"],n),name:u,description:p}),y=n.get("start"),b=n.get("end"),w=e.leftPadding*t,v=(c-e.width-e.leftPadding)*t;let S,x;o?(S=y-v,x=b+w):(S=y-w,x=b+v);const k=a.addRect(n.id(),S,x,d+5,n,{refName:n.get("refName"),floatingLabels:m,totalFeatureHeight:e.height,featureWidth:e.width,featureStartBp:y,featureEndBp:b});null!==k&&s.push({feature:n,layout:e,topPx:k})}return s}({features:t,bpPerPx:o,region:l,configContext:d,layout:e,pluginManager:r})),p=Math.max(1,e.getTotalHeight()),h=await(0,k.updateStatus)("Fetching peptide data",a,async()=>async function(e,t,n){const{colorByCDS:r,bpPerPx:a}=t,i=new Map;if(!r||!mr(a))return i;for(const r of function(e){const t=[];for(const n of e.values()){const e=n.get("type"),r=n.get("subfeatures");if("gene"===e&&r?.length){let e=!1;for(const n of r)Xr(n.get("type"))&&Kr(n)&&(t.push(n),e=!0);!e&&Kr(n)&&t.push(n)}else Xr(e)&&Kr(n)&&t.push(n)}return t}(n)){const n=await Qr(e,t,r);n&&i.set(r.id(),n)}return i}(r,n,t));return(0,k.updateStatus)("Rendering features",a,async()=>(0,Un.u)(c,p,n,a=>function({ctx:e,layoutRecords:t,canvasWidth:n,renderArgs:r,configContext:a}){const{bpPerPx:i,regions:o,theme:s,stopTokenCheck:l,layout:c,peptideDataMap:d,colorByCDS:u,pluginManager:p}=r,h=o[0],g=(0,zr.createJBrowseTheme)(s),f={region:h,bpPerPx:i,configContext:a,theme:g,canvasWidth:n,peptideDataMap:d,colorByCDS:u},m=[],y=[],b=[],w=[];e.textBaseline="top",e.textAlign="left";const{subfeatureLabels:v,transcriptTypes:S,config:x}=a;for(const n of t){const{feature:t,layout:r,topPx:o}=n,s=t.get(h.reversed?"end":"start"),d=Or(r,(0,k.bpToPx)(s,h,i),o);_r(e,d,f,p);const u={left:d.x,right:d.x+d.totalLayoutWidth,top:d.y,bottom:d.y+d.totalLayoutHeight},C=String((0,L.QZ)(x,["labels","name"],{feature:t})||""),T=String((0,L.QZ)(x,["labels","description"],{feature:t})||""),A=String((0,L.QZ)(x,"mouseover",{feature:t,label:C,description:T})||"");m.push(u.left,u.top,u.right,u.bottom),y.push({featureId:t.id(),type:"box",startBp:t.get("start"),endBp:t.get("end"),leftPx:u.left,rightPx:u.right,topPx:u.top,bottomPx:u.bottom,tooltip:A}),Gr({layout:c,featureLayout:d,subfeatureCoords:b,subfeatureInfos:w,config:x,configContext:a,pluginManager:p,subfeatureLabels:v,transcriptTypes:S,labelColor:g.palette.text.primary,parentTooltip:A}),(0,He.As)(l)}return{flatbush:Ur(m,y.length).data,items:y,subfeatureFlatbush:Ur(b,w.length).data,subfeatureInfos:w}}({ctx:a,layoutRecords:u,canvasWidth:c,renderArgs:{...n,features:t,layout:e,displayMode:d.displayMode,peptideDataMap:h,colorByCDS:n.colorByCDS,pluginManager:r},configContext:d})))}class Yr extends gt.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),n=this.createLayoutInWorker(e),{regions:r,bpPerPx:a}=e,i=r[0],o=Math.max(1,(i.end-i.start)/a),s=await Zr({pluginManager:this.pluginManager,renderProps:e,layout:n,features:t}),l=Math.max(1,n.getTotalHeight()),c=this.serializeLayout(n,e),d={...s,layout:c,height:l,width:o,maxHeightReached:n.maxHeightReached};return(0,mt.lk)(d,(0,yt.X)(s))}}const ea=(0,o.S7)("CanvasFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"#f0f",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},subfeatureLabels:{type:"stringEnum",model:c.types.enumeration("subfeatureLabels",["none","below","overlay"]),description:'subfeature label display: "none" hides labels, "below" reserves extra space, "overlay" draws on top of feature',defaultValue:"none"},mouseover:{type:"string",description:"the mouseover tooltip label for features. Available variables: feature (the feature object), label (evaluated name), description (evaluated description)",defaultValue:"jexl:get(feature,'_mouseover') || get(feature,'_mouseOver') || (label && description ? label + '<br/>' + description : (label || description || ''))",contextVariable:["feature","label","description"]},subfeatureMouseover:{type:"string",description:"the mouseover tooltip label for subfeatures (e.g. transcripts). Available variables: feature (the subfeature object)",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},labels:(0,o.S7)("CanvasFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"#f0f",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:12,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:c.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a rendering",defaultValue:5e3},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1},transcriptTypes:{type:"stringArray",defaultValue:["mRNA","transcript","primary_transcript"]},containerTypes:{type:"stringArray",defaultValue:["proteoform_orf"]},geneGlyphMode:{type:"stringEnum",model:c.types.enumeration("geneGlyphMode",["all","longest","longestCoding"]),description:'Gene glyph display mode: "all" shows all transcripts, "longest" shows only the longest transcript, "longestCoding" shows only the longest coding transcript',defaultValue:"all"},displayDirectionalChevrons:{type:"boolean",description:"Display directional chevrons on intron lines to indicate strand direction",defaultValue:!0}},{explicitlyTyped:!0}),ta=(0,o.S7)("SvgFeatureRenderer",{},{explicitlyTyped:!0,baseConfiguration:ea});class na extends r.A{name="CanvasPlugin";install(e){!function(e){e.addRendererType(()=>new Yr({name:"CanvasFeatureRenderer",ReactComponent:(0,a.lazy)(()=>n.e(1569).then(n.bind(n,1569))),configSchema:ea,pluginManager:e})),e.addRendererType(()=>new Yr({name:"SvgFeatureRenderer",ReactComponent:(0,a.lazy)(()=>n.e(1569).then(n.bind(n,1569))),configSchema:ta,pluginManager:e}))}(e)}}var ra=n(68390),aa=n(72242),ia=n(89693);function oa(e,t,n,r,a){const i=Math.abs(e-n);if(i>r)return;i===r&&a.push([t,e]);const o=Math.sqrt(r*r-i*i);a.push([t-o,e],[t+o,e])}function sa(e,t,n,r,a){const i=Math.abs(e-t);if(i>r)return;i===r&&a.push([e,n]);const o=Math.sqrt(r*r-i*i);a.push([e,n-o],[e,n+o])}function la(e,t){const n=Math.sqrt(e*e+t*t);if(0===n)return[0,0];const r=function(e,t){let n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t);return[n,r]}const ca=2*Math.PI;class da{constructor(e,t,n,r){this.region=t,this.offsetRadians=n,this.radianWidth=r;const{bpPerRadian:a}=e;this.key="regions"in t?JSON.stringify(t.regions):(0,k.assembleLocString)(t),this.bpPerRadian=a,this.flipped=!1,this.startRadians=n,this.endRadians=t.widthBp/this.bpPerRadian+n,Object.freeze(this)}bpToXY(e,t){let n;n=this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start;const r=n/this.bpPerRadian+this.offsetRadians;return(0,k.polarToCartesian)(t,r)}toJSON(){return Object.fromEntries(Object.entries(this))}}const ua=(0,a.lazy)(()=>n.e(1348).then(n.bind(n,71348))),pa=function(e){const t=-Math.PI/2;return c.types.compose("CircularView",jn.A,c.types.model({type:c.types.literal("CircularView"),offsetRadians:t,bpPerPx:200,tracks:c.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:c.types.optional(c.types.number,400),displayedRegions:c.types.optional(c.types.frozen(),[]),scrollX:0,scrollY:0,minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,trackSelectorType:"hierarchical",init:c.types.frozen()})).volatile(()=>({volatileWidth:void 0,volatileError:void 0})).views(e=>({get width(){if(void 0===e.volatileWidth)throw new Error("wait for view to be initialized first before accessing width");return e.volatileWidth},get visibleSection(){const{scrollX:t,scrollY:n,width:r,height:a}=e;return function(e,t,n){let[r,a,i,o]=e;const[s,l]=t;if(r-=s,a-=s,i-=l,o-=l,r<0&&a>0&&i<0&&o>0){const e=[[r,i],[a,i],[r,o],[a,o]];let t=Number.NEGATIVE_INFINITY;for(const[n,r]of e){const e=Math.sqrt(n*n+r*r);e>t&&(t=e)}return{rho:[0,Math.min(n,t)],theta:[0,2*Math.PI]}}const c=[[r,i],[a,i],[r,o],[a,o]];sa(r,0,0,n,c),sa(a,0,0,n,c),oa(i,0,0,n,c),oa(o,0,0,n,c),-r<n&&c.push([r,0]),a<n&&c.push([a,0]),-i<n&&c.push([0,i]),o<n&&c.push([0,o]);const d=r>=0?-1:1;let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(const[e,t]of c)if(e>=r&&e<=a&&t>=i&&t<=o){const[r,a]=la(e*d,t*d);r<=n+.001&&(a<h&&r>1e-4&&(h=a),a>g&&r>1e-4&&(g=a),r<u&&(u=r),r>p&&(p=r))}return-1===d&&(h+=Math.PI,g+=Math.PI),h>2*Math.PI&&g>2*Math.PI&&(h-=2*Math.PI,g-=2*Math.PI),{rho:[u,Math.min(n,p)],theta:[h,g]}}([t,t+r,n,n+a],this.centerXY,this.radiusPx)},get circumferencePx(){let t=0;for(const e of this.elidedRegions)t+=e.widthBp;return t/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){let t=0;for(const n of e.displayedRegions)t+=n.end-n.start;return t},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){const t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){const e=2*Math.PI*this.maximumRadiusPx;return(0,k.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){const t=[];for(const n of e.displayedRegions){const r=n.end-n.start;if(r/e.bpPerPx<e.minVisibleWidth){const e=t.at(-1);e?.elided?(e.regions.push({...n}),e.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[{...n}]})}else t.push({...n,widthBp:r,elided:!1})}for(let e=0;e<t.length;e+=1){const n=t[e];n.elided&&1===n.regions.length&&(t[e]={...n,...n.regions[0],elided:!1})}return t},get assemblyNames(){const t=[];for(const n of e.displayedRegions)t.includes(n.assemblyName)||t.push(n.assemblyName);return t},get initialized(){if(void 0===e.volatileWidth)return!1;const{assemblyManager:t}=(0,k.getSession)(e);if(e.init){const n=t.get(e.init.assembly);return!(!n?.initialized||!n.regions)}return this.assemblyNames.every(e=>t.get(e)?.initialized)},get assemblyErrors(){const{assemblyManager:t}=(0,k.getSession)(e);return this.assemblyNames.map(e=>t.get(e)?.error).filter(e=>!!e).join(", ")},get error(){if(e.volatileError)return e.volatileError;if(this.assemblyErrors)return this.assemblyErrors;if(e.init){const{assemblyManager:t}=(0,k.getSession)(e),n=t.get(e.init.assembly);if(n?.error)return n.error;if(!n)return`Assembly ${e.init.assembly} not found`}},get loadingMessage(){return this.showLoading?"Loading":void 0},get hasSomethingToShow(){return e.displayedRegions.length>0||!!e.init},get showLoading(){return!this.initialized&&!this.error&&this.hasSomethingToShow},get showView(){return!!e.displayedRegions.length&&!!this.figureWidth&&!!this.figureHeight&&this.initialized},get showImportForm(){return!this.hasSomethingToShow&&!e.disableImportForm||!!this.error}})).views(e=>({get staticSlices(){return function(e){const t=[];let n=0;const{bpPerRadian:r,spacingPx:a,pxPerRadian:i}=e;for(const o of e.elidedRegions){const s=o.widthBp/r+a/i;t.push(new da(e,o,n,s)),n+=s}return t}(e)}})).views(e=>({get visibleStaticSlices(){return e.staticSlices.filter(t=>function(e,t){const{theta:[n,r]}=e.visibleSection;return a=t.offsetRadians+e.offsetRadians,o=n,s=r-n,!((i=t.radianWidth)<=0||s<=0)&&(i+1e-4>=ca||s+1e-4>=ca||(a=(a%ca+ca)%ca+ca)<(o=(o%ca+ca)%ca+ca)+s&&a+i>o||a<(o-=ca)+s&&a+i>o||a<(o+=ca+ca)+s&&a+i>o);var a,i,o,s}(e,t))}})).actions(t=>({setWidth:e=>(t.volatileWidth=Math.max(e,100),t.volatileWidth),setHeight:e=>(t.height=Math.max(e,40),t.height),resizeHeight(e){const n=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},resizeWidth(e){const n=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},rotateClockwiseButton(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise(e=.17){t.offsetRadians+=e},rotateCounterClockwise(e=.17){t.offsetRadians-=e},zoomInButton(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx(e){t.bpPerPx=(0,k.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},setDisplayedRegions(e){const n=0===t.displayedRegions.length;t.displayedRegions=(0,c.cast)(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector(){if("hierarchical"===t.trackSelectorType){const e=(0,k.getSession)(t);if((0,U.lO)(e)){const n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error(`invalid track selector type ${t.trackSelectorType}`)},toggleTrack(e){(0,C.toggleTrackGeneric)(t,e)},setError(e){t.volatileError=e},setInit(e){t.init=e},showTrack(e,n={}){(0,C.showTrackGeneric)(t,e,n)},addTrackConf(n,r={}){const{type:a}=n,i=(0,L.QZ)(n,"name"),o=e.getTrackType(a);if(!o)throw new Error(`unknown track type ${a}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map(e=>e.name)),c=n.displays.find(e=>l.has(e.type));t.tracks.push(o.stateModel.create({...r,name:i,type:a,configuration:n,displays:[{type:c.type,configuration:c}]}))},hideTrack(e){(0,C.hideTrackGeneric)(t,e)},toggleFitToWindowLock(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow},async exportSvg(e={}){const{renderToSvg:r}=await n.e(8137).then(n.bind(n,58137)),a=await r(t,e),{saveAs:i}=await n.e(1611).then(n.bind(n,91611));if("png"===e.format){const t=new Image,n=new Blob([a],{type:"image/svg+xml"}),r=URL.createObjectURL(n);await new Promise((n,a)=>{t.onload=()=>{const o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").drawImage(t,0,0),URL.revokeObjectURL(r),o.toBlob(r=>{r?(i(r,e.filename||"image.png"),n()):a(new Error(`Failed to create PNG. The image may be too large (${t.width}x${t.height}). Try reducing the view size or use SVG format.`))},"image/png")},t.onerror=()=>{URL.revokeObjectURL(r),a(new Error("Failed to load SVG for PNG conversion"))},t.src=r})}else i(new Blob([a],{type:"image/svg+xml"}),e.filename||"image.svg")}})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(function(){const{init:t,initialized:n}=e;if(n&&t){const n=(0,k.getSession)(e),{assemblyManager:r}=n,a=r.get(t.assembly)?.regions;if(a&&e.setDisplayedRegions(a),t.tracks)for(const n of t.tracks)e.showTrack(n);e.setInit(void 0)}},{name:"CircularViewInit"}))}})).views(e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{e.setDisplayedRegions([])},icon:ia.A},{label:"Export SVG",icon:_n.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[ua,{model:e,handleClose:t}])}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:aa.xU}]})).postProcessSnapshot(e=>{if(!e)return e;const{init:n,offsetRadians:r,bpPerPx:a,hideVerticalResizeHandle:i,hideTrackSelectorButton:o,lockedFitToWindow:s,disableImportForm:l,height:c,displayedRegions:d,scrollX:u,scrollY:p,minimumRadiusPx:h,spacingPx:g,paddingPx:f,lockedPaddingPx:m,minVisibleWidth:y,minimumBlockWidth:b,trackSelectorType:w,...v}=e;return{...v,...r!==t?{offsetRadians:r}:{},...200!==a?{bpPerPx:a}:{},...i?{hideVerticalResizeHandle:i}:{},...o?{hideTrackSelectorButton:o}:{},...s?{}:{lockedFitToWindow:s},...l?{disableImportForm:l}:{},...400!==c?{height:c}:{},...d.length?{displayedRegions:d}:{},...u?{scrollX:u}:{},...p?{scrollY:p}:{},...25!==h?{minimumRadiusPx:h}:{},...10!==g?{spacingPx:g}:{},...80!==f?{paddingPx:f}:{},...100!==m?{lockedPaddingPx:m}:{},...6!==y?{minVisibleWidth:y}:{},...20!==b?{minimumBlockWidth:b}:{},..."hierarchical"!==w?{trackSelectorType:w}:{}}})};class ha extends r.A{name="CircularViewPlugin";install(e){!function(e){e.addViewType(()=>new zn.A({ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(9186),n.e(4768),n.e(6232)]).then(n.bind(n,76232))),stateModel:pa(e),name:"CircularView",displayName:"Circular view"}))}(e),function(e){e.addToExtensionPoint("LaunchView-CircularView",async({session:e,assembly:t,tracks:n=[]})=>{if(!t)throw new Error("No assembly provided when launching circular genome view");e.addView("CircularView",{init:{assembly:t,tracks:n}})})}(e)}configure(e){(0,U.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:ra.A,onClick:e=>{e.addView("CircularView",{})}})}}const ga=(0,o.S7)("BlastTabularAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Query assembly is the first value in the array, target assembly is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},blastTableLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/blastTable.tsv",locationType:"UriLocation"}},columns:{type:"string",description:"Optional space-separated column name list. If custom columns were used in outfmt, enter them here exactly as specified in the command. At least qseqid, sseqid, qstart, qend, sstart, and send are required",defaultValue:"qseqid sseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore"}},{explicitlyTyped:!0}),fa=(0,o.S7)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,chainLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),ma=["PAFAdapter","ChainAdapter","DeltaAdapter","BlastTabularAdapter","MashMapAdapter","MCScanAnchorsAdapter","MCScanSimpleAnchorsAdapter","PairwiseIndexedPAFAdapter"],ya=["PAFAdapter","ChainAdapter","DeltaAdapter","MashMapAdapter","BlastTabularAdapter","PairwiseIndexedPAFAdapter"],ba=["MCScanAnchorsAdapter","MCScanSimpleAnchorsAdapter"],wa=(0,a.lazy)(()=>n.e(1010).then(n.bind(n,11010))),va=(0,o.S7)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,deltaLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Sa=(0,a.lazy)(()=>n.e(3852).then(n.bind(n,43852))),xa=(0,o.S7)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri&&e.bed1&&e.bed2?{...e,mcscanAnchorsLocation:{uri:e.uri,baseUri:e.baseUri},bed1Location:{uri:e.bed1,baseUri:e.baseUri},bed2Location:{uri:e.bed2,baseUri:e.baseUri}}:e}),ka=(0,o.S7)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri&&e.bed1&&e.bed2?{...e,mcscanSimpleAnchorsLocation:{uri:e.uri,baseUri:e.baseUri},bed1Location:{uri:e.bed1,baseUri:e.baseUri},bed2Location:{uri:e.bed2,baseUri:e.baseUri}}:e}),Ca=(0,o.S7)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,outLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Ta=(0,o.S7)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,pafLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Aa=(0,o.S7)("PairwiseIndexedPAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pifGzLocation:{type:"fileLocation",description:"location of pairwise tabix indexed PAF (pif)",defaultValue:{uri:"/path/to/data/file.pif.gz",locationType:"UriLocation"}},index:(0,o.S7)("TabixIndex",{indexType:{model:c.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.paf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,pifGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});class Ma extends r.A{name="ComparativeAdaptersPlugin";install(e){!function(e){e.addAdapterType(()=>new b.A({name:"PAFAdapter",displayName:"PAF adapter",configSchema:Ta,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(9326).then(n.bind(n,79326)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"PairwiseIndexedPAFAdapter",displayName:"Pairwise indexed PAF adapter",configSchema:Aa,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>Promise.all([n.e(5188),n.e(5172)]).then(n.bind(n,75172)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"DeltaAdapter",displayName:"MUMmer delta adapter",configSchema:va,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(2172).then(n.bind(n,2172)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"ChainAdapter",displayName:"Liftover chain adapter",configSchema:fa,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(8177).then(n.bind(n,78177)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"MCScanAnchorsAdapter",displayName:"MCScan anchors adapter",configSchema:xa,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(6890).then(n.bind(n,86890)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"MCScanSimpleAnchorsAdapter",displayName:"MCScan anchors.simple adapter",configSchema:ka,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(1306).then(n.bind(n,41306)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"MashMapAdapter",displayName:"MashMap adapter",configSchema:Ca,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(5054).then(n.bind(n,5054)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"BlastTabularAdapter",displayName:"Tabular BLAST output adapter",configSchema:ga,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(5252).then(n.bind(n,55252)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-addTrackComponent",(e,{model:t})=>ya.includes(t.trackAdapterType)?wa:e)}(e),function(e){e.addToExtensionPoint("Core-addTrackComponent",(e,{model:t})=>ba.includes(t.trackAdapterType)?Sa:e)}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t),i=n&&(0,C.getFileName)(n);return(0,k.testAdapter)(a,/\.paf(.gz)?/i,r,"PAFAdapter")?{type:"PAFAdapter",pafLocation:t}:"BlastTabularAdapter"===r?{type:"BlastTabularAdapter",blastTableLocation:t}:(0,k.testAdapter)(a,/\.anchors.simple(.gz)?/i,r,"MCScanSimpleAnchorsAdapter")?{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:t}:(0,k.testAdapter)(a,/\.anchors(.gz)?/i,r,"MCScanAnchorsAdapter")?{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:t}:(0,k.testAdapter)(a,/\.delta(.gz)?/i,r,"DeltaAdapter")?{type:"DeltaAdapter",deltaLocation:t}:(0,k.testAdapter)(a,/\.chain(.gz)?/i,r,"ChainAdapter")?{type:"ChainAdapter",chainLocation:t}:(0,k.testAdapter)(a,/\.out(.gz)?/i,r,"MashMapAdapter")?{type:"MashMapAdapter",outLocation:t}:(0,k.testAdapter)(a,/\.pif\.gz/i,r,"PairwiseIndexedPAFAdapter")?{type:"PairwiseIndexedPAFAdapter",pifGzLocation:t,index:{location:n||(0,C.makeIndex)(t,".tbi"),indexType:(0,C.makeIndexType)(i,"CSI","TBI")}}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>ma.includes(t)?"SyntenyTrack":e(t))}(e)}}var Ia=n(9090),Pa=n(56591),La=n(69274);class Ra extends st.A{name="ComparativeRender";async renameRegionsIfNeeded(e,t){return t.renameRegionsIfNeeded(e)}getRenderer(e){return this.pluginManager.getRendererType(e)}async serializeArguments(e,t){const{rendererType:n}=e,r=this.getRenderer(n),a=await super.serializeArguments(e,t),i=await this.renameRegionsIfNeeded(a,r);return r.serializeArgsInClient(i)}async execute(e,t){const n=await this.deserializeArguments(e,t),{sessionId:r,rendererType:a,stopToken:i}=n;if(!r)throw new Error("must pass a unique session id");return(0,He.SW)(i),this.getRenderer(a).renderInWorker(n)}async deserializeReturn(e,t,n){const r=await super.deserializeReturn(e,t,n);return this.getRenderer(t.rendererType).deserializeResultsInClient(r,t)}}var Fa=n(8709),Da=n(64152),Na=n(94095);const Ba=Da.A.extend(e=>{const t=N.observable.box(1);return{views:{get dynamicBlocks(){return(0,Na.A)(e,!1,!1)},get scaleFactor(){return t.get()},get maxBpPerPx(){return e.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get maxOffset(){const t=e.displayedRegionsTotalPx,n=e.width;return t<=n?(t-n)/2:t-10},get minOffset(){const t=e.displayedRegionsTotalPx,n=e.width;return t<=n?(t-n)/2:30-n}},actions:{setScaleFactor(e){t.set(e)},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(t-e.width/2)}}}}),Va=Ba.extend(e=>({views:{get width(){return(0,c.getParent)(e).viewWidth}}})),Ea=Ba.extend(e=>({views:{get width(){return(0,c.getParent)(e).viewHeight}}}));class za extends Fa.A{name="DiagonalizeDotplot";async execute(e,t){const n=await this.deserializeArguments(e,t),{view:r,sessionId:a,adapterConfig:i,stopToken:o,statusCallback:s}=n;if(!a)throw new Error("must pass a unique session id");s?.("Initializing diagonalization...");const l=[800,800],c=[r.hview,r.vview].map((e,t)=>{const n=Ba.create(e);return n.setVolatileWidth(l[t]),n})[0];(0,He.SW)(o),s?.("Getting renderer...");const d=this.pluginManager.getRendererType("DotplotRenderer");if(!d)throw new Error("DotplotRenderer not found");(0,He.SW)(o),s?.("Fetching features...");const u=await d.getFeatures({regions:c.dynamicBlocks.contentBlocks,adapterConfig:i,sessionId:a});(0,He.SW)(o),s?.("Extracting alignment data...");const p=[];for(const e of u.values()){const t=e.get("mate");t&&p.push({queryRefName:e.get("refName"),refRefName:t.refName,queryStart:e.get("start"),queryEnd:e.get("end"),refStart:t.start,refEnd:t.end,strand:e.get("strand")||1})}if(0===p.length)throw new Error("No alignments found to diagonalize");s?.(`Running diagonalization on ${p.length} alignments...`);const h=await async function(e,t,n){const r=(e,t)=>{n&&n(0,t)};r(0,`Grouping ${e.length} alignments...`);const a=new Map;for(const t of e){const e=t.refRefName;a.has(e)||a.set(e,{refAlignments:new Map,strandWeightedSum:0});const n=a.get(e),r=Math.abs(t.queryEnd-t.queryStart);n.refAlignments.has(t.queryRefName)||n.refAlignments.set(t.queryRefName,{bases:0,positions:[]});const i=n.refAlignments.get(t.queryRefName);i.bases+=r,i.positions.push((t.queryStart+t.queryEnd)/2);const o=t.strand>=0?1:-1;n.strandWeightedSum+=o*r}r(0,"Determining optimal ordering and orientation...");const i=[];for(const[e,t]of a){let n="",r=0,a=[];for(const[e,i]of t.refAlignments)i.bases>r&&(r=i.bases,n=e,a=i.positions);const o=a.reduce((e,t)=>e+t,0)/a.length,s=t.strandWeightedSum<0;i.push({refName:e,bestRefName:n,bestRefPos:o,shouldReverse:s})}r(0,`Sorting ${i.length} query regions...`),i.sort((e,t)=>e.bestRefName!==t.bestRefName?e.bestRefName.localeCompare(t.bestRefName):e.bestRefPos-t.bestRefPos),r(0,"Building new region layout...");const o=[];let s=0;for(const{refName:e,shouldReverse:n}of i){const r=t.find(t=>t.refName===e);r&&(o.push({...r,reversed:n}),n!==r.reversed&&s++)}const l=t.filter(e=>!o.some(t=>t.refName===e.refName));return r(0,"Diagonalization complete!"),{newRegions:[...o,...l],stats:{totalAlignments:e.length,regionsProcessed:i.length,regionsReordered:o.length,regionsReversed:s}}}(p,r.vview.displayedRegions,(e,t)=>{(0,He.SW)(o),s?.(t)});return s?.("Diagonalization complete!"),h}}var ja=n(27518),Ha=n(67665),_a=n(51049),$a=n(62088),Oa=n(46625);const Ga=(0,Oa.n)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}});function Wa(){const e=(0,Wt.c)(3),{classes:t}=Ga();let n,r;return e[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,te.jsx)(_a.A,{}),e[0]=n):n=e[0],e[1]!==t.loading?(r=(0,te.jsx)("div",{className:t.loading,children:n}),e[1]=t.loading,e[2]=r):r=e[2],r}function Ua(e){const t=(0,Wt.c)(5),{messageText:n}=e,{classes:r}=Ga();let a,i;return t[0]!==n?(a=(0,te.jsx)(_a.A,{message:n}),t[0]=n,t[1]=a):a=t[1],t[2]!==r.loading||t[3]!==a?(i=(0,te.jsx)("div",{className:r.loading,children:a}),t[2]=r.loading,t[3]=a,t[4]=i):i=t[4],i}function qa(e){const t=(0,Wt.c)(2),{error:n}=e;let r;return t[0]!==n?(r=(0,te.jsx)($a.A,{error:n}),t[0]=n,t[1]=r):r=t[1],r}const Ja=(0,ee.observer)(function({model:e,style:t}){return e.error?(0,te.jsx)(qa,{error:e.error,"data-testid":"reload_button"}):e.message?(0,te.jsx)(Ua,{messageText:e.message}):e.filled?e.shouldDisplay?(0,te.jsx)("div",{style:t,children:e.reactElement}):null:(0,te.jsx)(Wa,{})}),Xa=Ja;function Ka(e){const{rpcManager:t}=(0,k.getSession)(e),{rendererType:n}=e,{adapterConfig:r}=e,a=(0,k.getContainingView)(e);if((0,L.QZ)(e.configuration),(0,c.getSnapshot)(a),a.initialized){const{viewWidth:i,viewHeight:o,borderSize:s,borderX:l,borderY:d}=a;return{rendererType:n,rpcManager:t,renderProps:{...e.renderProps(),view:structuredClone((0,c.getSnapshot)(a)),width:i,height:o,borderSize:s,borderX:l,borderY:d,adapterConfig:r,rendererType:n.name,sessionId:(0,C.getRpcSessionId)(e),trackInstanceId:(0,k.getContainingTrack)(e).id,timeout:1e6,alpha:e.alpha,minAlignmentLength:e.minAlignmentLength,colorBy:e.colorBy},renderingProps:e.renderingProps?.()}}}function Qa(e){return c.types.compose("DotplotDisplay",R.q,c.types.model({type:c.types.literal("DotplotDisplay"),configuration:(0,o.AK)(e),colorBy:c.types.optional(c.types.string,"default")}).volatile(()=>({stopToken:void 0,warnings:[],filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:Xa,alpha:1,minAlignmentLength:0}))).views(e=>({get shouldDisplay(){const{vview:t,hview:n}=(0,k.getContainingView)(e);return t.bpPerPx===e.data.bpPerPxY&&n.bpPerPx===e.data.bpPerPxX},get rendererTypeName(){return(0,L.FI)(e,["renderer","type"])},renderProps:()=>({...(0,C.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})})).views(e=>({async renderSvg(t){const n=Ka(e);if(!n)return null;const{rendererType:r,rpcManager:a,renderProps:i,renderingProps:o}=n,s=await r.renderInClient(a,{...i,renderingProps:o,exportSVG:t,theme:t.theme||i.theme}),{hview:l,vview:c}=(0,k.getContainingView)(e),d=-l.offsetPx+s.offsetX,u=-c.offsetPx+s.offsetY;return(0,te.jsx)("g",{transform:`translate(${d} ${-u})`,children:(0,te.jsx)(ja.aE,{rendering:s})})}})).actions(e=>({afterAttach(){(0,Ha.I)(e,()=>Ka(e),e=>async function(e){if(!e)return;const{rendererType:t,rpcManager:n,renderProps:r,renderingProps:a}=e,{reactElement:i,...o}=await t.renderInClient(n,{...r,renderingProps:a});return{reactElement:i,data:o,renderingComponent:t.ReactComponent}}(e),{name:`${e.type} ${e.id} rendering`,delay:500,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading(t){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,e.stopToken=t},setMessage(t){e.message=t},setRendered(t){if(void 0===t)return;const{data:n,reactElement:r,renderingComponent:a}=t;e.warnings=n.warnings,e.filled=!0,e.message=void 0,e.reactElement=r,e.data=n,e.error=void 0,e.renderingComponent=a,e.stopToken=void 0},setError(t){console.error(t),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0,e.stopToken=void 0},setAlpha(t){e.alpha=t},setMinAlignmentLength(t){e.minAlignmentLength=t},setColorBy(t){e.colorBy=t}}))}var Za=n(11218),Ya=n(153);const{Cu:ei,NI:ti,R3:ni,Gl:ri}=Ya;var ai=n(10678),ii=n(63110),oi=n(1259),si=n(48581);class li extends ai.default{supportsSVG=!0;async renameRegionsIfNeeded(e){const t=this.pluginManager,n=t.rootModel?.session?.assemblyManager,{view:r,sessionId:a,adapterConfig:i}=e;async function o(e){if(!n)throw new Error("No assembly manager provided");return(await(0,k.renameRegionsIfNeeded)(n,{sessionId:a,adapterConfig:i,regions:e})).regions}return r.hview.displayedRegions=await o(r.hview.displayedRegions),r.vview.displayedRegions=await o(r.vview.displayedRegions),e}serializeArgsInClient(e){const{displayModel:t,...n}=e;return super.serializeArgsInClient(n)}deserializeResultsInClient(e,t){return{...super.deserializeResultsInClient(e,t),blockKey:t.blockKey}}async renderInClient(e,t){const n=await e.call(t.sessionId,"ComparativeRender",t);if("canvasRecordedData"in n){const{reactElement:e,...t}=n;return{...t,html:await(0,ii.getSerializedSvg)(n)}}return n}async getFeatures(e){const{regions:t,sessionId:n,adapterConfig:r,filters:a}=e,{dataAdapter:i}=await(0,at.cK)(this.pluginManager,n,r),o=await(0,it._)(i.getFeaturesInMultipleRegions(t.map(e=>function(e){return{...e,start:Math.floor(e.start),end:Math.ceil(e.end)}}(e)),e).pipe((0,si.p)(t=>!a||a.passes(t,e)),(0,ot.$)()));return(0,oi.Q)(o,e=>e.id())}async render(e){const{width:t,height:r,view:{hview:a,vview:i}}=e,o=[t,r],s=[a,i].map((e,t)=>{const n=Ba.create(e);return n.setVolatileWidth(o[t]),n}),l=s[0],c=await this.getFeatures({...e,regions:l.dynamicBlocks.contentBlocks});l.setFeatures(c);const{drawDotplot:d}=await n.e(2113).then(n.bind(n,62113)),u=await(0,Un.u)(t,r,e,t=>d(t,{...e,views:s})),p={...u,height:r,width:t,offsetX:s[0].dynamicBlocks.blocks[0]?.offsetPx||0,offsetY:s[1].dynamicBlocks.blocks[0]?.offsetPx||0,bpPerPxX:s[0].bpPerPx,bpPerPxY:s[1].bpPerPx};return(0,mt.lk)(p,(0,yt.X)(u))}}const ci=(0,o.S7)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"blue"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:c.types.enumeration("colorBy",["identity","meanQueryIdentity","mappingQuality","strand","default"]),description:'Color by options:<br/>\n<ul>\n  <li>"identity" - the identity of the particular hit, similar to D-GENIES, use the other config slots \'thresholds\' and \'thresholdsPalette\' to define colors for this setting</li>\n  <li>"meanQueryIdentity" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>"mappingQuality" - uses mapping quality from PAF, some adapters don\'t have this setting</li>\n  <li>"strand" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>"default" - uses the \'color\' config slot</li>\n</ul>',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0});var di=n(83078);const ui=(0,a.lazy)(()=>n.e(7688).then(n.bind(n,37688))),pi=(0,a.lazy)(()=>n.e(6226).then(n.bind(n,66226)));function hi(e){return(0,k.measureText)(e.slice(0,30))}function gi(e,t,n){return(0,k.max)([...e.filter(e=>!n.has(e.key)).map(e=>hi(e.refName)),...e.filter(e=>!n.has(e.key)).map(e=>hi((0,k.getTickDisplayStr)(e.end,t)))])}class fi extends r.A{name="DotplotPlugin";install(e){var t;!function(e){e.addViewType(()=>{return new zn.A({name:"DotplotView",displayName:"Dotplot view",stateModel:(t=e,c.types.compose("DotplotView",jn.A,c.types.model({id:Rn.K,type:c.types.literal("DotplotView"),height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:c.types.array(c.types.string),drawCigar:!0,hview:c.types.optional(Va,{}),vview:c.types.optional(Ea,{}),tracks:c.types.array(t.pluggableMstType("track","stateModel")),viewTrackConfigs:c.types.array(t.pluggableConfigSchemaType("track")),init:c.types.frozen()})).volatile(()=>({volatileWidth:void 0,volatileError:void 0,cursorMode:(0,k.localStorageGetItem)("dotplot-cursorMode")||"crosshair",showPanButtons:(0,k.localStorageGetBoolean)("dotplot-showPanbuttons",!0),wheelMode:(0,k.localStorageGetItem)("dotplot-wheelMode")||"zoom",borderX:100,borderY:100,importFormSyntenyTrackSelections:N.observable.array()})).actions(e=>({importFormRemoveRow(t){e.importFormSyntenyTrackSelections.splice(t,1)},clearImportFormSyntenyTracks(){e.importFormSyntenyTrackSelections.clear()},setImportFormSyntenyTrack(t,n){e.importFormSyntenyTrackSelections[t]=n}})).views(e=>({get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}})).views(e=>({get assemblyErrors(){const{assemblyManager:t}=(0,k.getSession)(e);return e.assemblyNames.map(e=>t.get(e)?.error).filter(e=>!!e).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,k.getSession)(e);return e.assemblyNames.every(e=>t.get(e)?.initialized??!0)}})).views(e=>({get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){const{hview:t}=e,{dynamicBlocks:n,staticBlocks:r,bpPerPx:a}=t;return n.contentBlocks.length>5?[]:(0,di.H2)(r.contentBlocks,a)},get vticks(){const{vview:t}=e,{dynamicBlocks:n,staticBlocks:r,bpPerPx:a}=t;return n.contentBlocks.length>5?[]:(0,di.H2)(r.contentBlocks,a)},get hasSomethingToShow(){return e.assemblyNames.length>0||!!e.init},get showLoading(){return this.hasSomethingToShow&&!this.initialized&&!e.volatileError&&!e.assemblyErrors},get showImportForm(){return!this.hasSomethingToShow||!!e.volatileError},get loadingMessage(){return this.showLoading?"Loading":void 0},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps(){const t=(0,k.getSession)(e);return{...(0,C.getParentRenderProps)(e),drawCigar:e.drawCigar,highResolutionScaling:(0,L.FI)(t,"highResolutionScaling")}}})).actions(e=>({setShowPanButtons(t){e.showPanButtons=t},setWheelMode(t){e.wheelMode=t},setCursorMode(t){e.cursorMode=t},setDrawCigar(t){e.drawCigar=t},clearView(){e.hview.setDisplayedRegions([]),e.vview.setDisplayedRegions([]),e.assemblyNames=(0,c.cast)([]),e.tracks.clear()},setBorderX(t){e.borderX=t},setBorderY(t){e.borderY=t},setWidth:t=>(e.volatileWidth=t,e.volatileWidth),setHeight:t=>(e.height=t,e.height),setError(t){e.volatileError=t},setInit(t){e.init=t},zoomOut(){e.hview.zoomOut(),e.vview.zoomOut(),e.hview.bpPerPx>=.99*e.hview.maxBpPerPx&&e.hview.center(),e.vview.bpPerPx>=.99*e.vview.maxBpPerPx&&e.vview.center()},zoomIn(){e.hview.zoomIn(),e.vview.zoomIn()}})).actions(e=>({activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,k.getSession)(e);if((0,U.lO)(t)){const n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},showTrack:(t,n={})=>(0,C.showTrackGeneric)(e,t,n),hideTrack:t=>(0,C.hideTrackGeneric)(e,t),toggleTrack(t){(0,C.toggleTrackGeneric)(e,t)},setAssemblyNames(t,n){e.assemblyNames=(0,c.cast)([t,n]),e.hview.setDisplayedRegions([]),e.vview.setDisplayedRegions([])},setViews(t){e.hview=(0,c.cast)(t[0]),e.vview=(0,c.cast)(t[1])},getCoords(t,n){const[r,a]=(0,k.minmax)(n[0],t[0]),[i,o]=(0,k.minmax)(n[1],t[1]);return Math.abs(a-r)>3&&Math.abs(o-i)>3?[e.hview.pxToBp(r),e.hview.pxToBp(a),e.vview.pxToBp(e.viewHeight-i),e.vview.pxToBp(e.viewHeight-o)]:void 0},zoomInToMouseCoords(t,n){const r=this.getCoords(t,n);if(r){const[t,n,a,i]=r;e.hview.moveTo(t,n),e.vview.moveTo(i,a)}},calculateBorders(){if(void 0===e.volatileWidth)return{borderX:e.borderX,borderY:e.borderY};const{vview:t,hview:n,viewHeight:r,viewWidth:a}=e,i=t.dynamicBlocks.contentBlocks,o=n.dynamicBlocks.contentBlocks,s=n.offsetPx,l=t.offsetPx,c=(0,di.rQ)(i,r,l),d=(0,di.rQ)(o,a,s),u=gi(o,t.bpPerPx,d),p=gi(i,n.bpPerPx,c);return{borderX:Math.max(p+40,50),borderY:Math.max(u+40,50)}},showAllRegions(){e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx);const{borderX:t,borderY:n}=this.calculateBorders();e.setBorderX(t),e.setBorderY(n),e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx),e.vview.center(),e.hview.center()},initializeDisplayedRegions(){const{hview:t,vview:n,assemblyNames:r}=e;if(t.displayedRegions.length&&n.displayedRegions.length)return;const{assemblyManager:a}=(0,k.getSession)(e);t.setDisplayedRegions(a.get(r[0])?.regions||[]),n.setDisplayedRegions(a.get(r[1])?.regions||[]),this.showAllRegions()},onDotplotView(t,n){const r=this.getCoords(t,n);if(r){const[t,n,a,i]=r,o=(0,k.getSession)(e),s=Ba.create({...(0,c.getSnapshot)(e.hview),minimumBlockWidth:0,interRegionPaddingWidth:0}),l=Ba.create({...(0,c.getSnapshot)(e.vview),minimumBlockWidth:0,interRegionPaddingWidth:0});s.setVolatileWidth(e.hview.width),l.setVolatileWidth(e.vview.width),s.moveTo(t,n),l.moveTo(i,a),s.zoomTo(s.bpPerPx/(e.width/e.hview.width),0),l.zoomTo(l.bpPerPx/(e.width/e.vview.width),0);const d=e.tracks.map(e=>e.configuration.displays.find(e=>"LinearSyntenyDisplay"===e.type)).filter(e=>!!e).map(e=>{const t=(0,c.getParent)(e,2);return{type:t.type,configuration:(0,c.getSnapshot)(t),displays:[{type:e.type,configuration:(0,c.getSnapshot)(e)}]}}),{id:u,...p}=(0,c.getSnapshot)(s),{id:h,...g}=(0,c.getSnapshot)(l),f={type:"LinearSyntenyView",views:[{type:"LinearGenomeView",tracks:[],hideHeader:!0,...p},{type:"LinearGenomeView",tracks:[],hideHeader:!0,...g}],tracks:d};o.addView("LinearSyntenyView",f)}}})).actions(e=>({async exportSvg(t={}){const{renderToSvg:r}=await n.e(6922).then(n.bind(n,6922)),a=await r(e,t),{saveAs:i}=await n.e(1611).then(n.bind(n,91611));if("png"===t.format){const e=new Image,n=new Blob([a],{type:"image/svg+xml"}),r=URL.createObjectURL(n);await new Promise((n,a)=>{e.onload=()=>{const o=document.createElement("canvas");o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(e,0,0),URL.revokeObjectURL(r),o.toBlob(r=>{r?(i(r,t.filename||"image.png"),n()):a(new Error(`Failed to create PNG. The image may be too large (${e.width}x${e.height}). Try reducing the view size or use SVG format.`))},"image/png")},e.onerror=()=>{URL.revokeObjectURL(r),a(new Error("Failed to load SVG for PNG conversion"))},e.src=r})}else i(new Blob([a],{type:"image/svg+xml"}),t.filename||"image.svg")},beforeDestroy(){const t=(0,k.getSession)(e);for(const n of e.assemblyNames)t.removeTemporaryAssembly?.(n)},afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(function(){const{init:t,volatileWidth:n}=e;if(!n||!t)return;const r=(0,k.getSession)(e),a=t.views.map(e=>e.assembly);if(e.setAssemblyNames(a[0],a[1]),t.tracks)for(const n of t.tracks)try{e.showTrack(n)}catch(e){console.error(e),r.notifyError(`${e}`,e)}e.setInit(void 0)},{name:"DotplotInit"})),(0,c.addDisposer)(e,(0,N.autorun)(function(){const{showPanButtons:t,wheelMode:n,cursorMode:r}=e;var a;"undefined"!=typeof localStorage&&(localStorage.setItem("dotplot-showPanbuttons",(a=t,JSON.stringify(a))),localStorage.setItem("dotplot-cursorMode",r),localStorage.setItem("dotplot-wheelMode",n))},{name:"DotplotLocalStorage"})),(0,c.addDisposer)(e,(0,N.autorun)(function(){e.assemblyNames.slice(),void 0!==e.volatileWidth&&e.assembliesInitialized&&e.initializeDisplayedRegions()},{delay:1e3,name:"DotplotRegions"})),(0,c.addDisposer)(e,(0,N.autorun)(function(){if(void 0===e.volatileWidth)return;const{borderX:t,borderY:n}=e.calculateBorders();e.setBorderX(t),e.setBorderY(n)},{name:"DotplotBorder"}))},squareView(){const{hview:t,vview:n}=e,r=(t.bpPerPx+n.bpPerPx)/2,a=t.pxToBp(t.width/2),i=n.pxToBp(n.width/2);t.setBpPerPx(r),t.centerAt(a.coord,a.refName,a.index),n.setBpPerPx(r),n.centerAt(i.coord,i.refName,i.index)},squareViewProportional(){const{hview:t,vview:n}=e,r=t.width/n.width,a=(t.bpPerPx+n.bpPerPx)/2,i=t.pxToBp(t.width/2),o=n.pxToBp(n.width/2);t.setBpPerPx(a/r),t.centerAt(i.coord,i.refName,i.index),n.setBpPerPx(a),n.centerAt(o.coord,o.refName,o.index)}})).views(e=>({menuItems(){const t=(0,k.getSession)(e);return[{label:"Return to import form",icon:ia.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[pi,{model:e,handleClose:t}])}},{label:"Export SVG",icon:_n.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[ui,{model:e,handleClose:t}])}},...(0,U.lO)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:aa.xU}]:[]]},get error(){return e.volatileError||e.assemblyErrors}})).postProcessSnapshot(e=>{if(!e)return e;const{init:t,height:n,borderSize:r,tickSize:a,vtextRotation:i,htextRotation:o,fontSize:s,trackSelectorType:l,drawCigar:c,assemblyNames:d,viewTrackConfigs:u,...p}=e;return{...p,...600!==n?{height:n}:{},...20!==r?{borderSize:r}:{},...5!==a?{tickSize:a}:{},...i?{vtextRotation:i}:{},...-90!==o?{htextRotation:o}:{},...15!==s?{fontSize:s}:{},..."hierarchical"!==l?{trackSelectorType:l}:{},...c?{}:{drawCigar:c},...d.length?{assemblyNames:d}:{},...u.length?{viewTrackConfigs:u}:{}}})),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(9186),n.e(402),n.e(1420)]).then(n.bind(n,81420)))});var t})}(e),(t=e).addDisplayType(()=>{const e=function(e){return(0,o.S7)("DotplotDisplay",{renderer:c.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(t);return new I.A({name:"DotplotDisplay",displayName:"Dotplot display",configSchema:e,stateModel:Qa(e),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:(0,a.lazy)(()=>n.e(549).then(n.bind(n,10549)))})}),function(e){e.addRendererType(()=>new li({name:"DotplotRenderer",configSchema:ci,ReactComponent:(0,a.lazy)(()=>n.e(1872).then(n.bind(n,81872))),pluginManager:e}))}(e),function(e){e.addToExtensionPoint("LaunchView-DotplotView",async({session:e,views:t,tracks:n=[]})=>{e.addView("DotplotView",{init:{views:t.map(e=>({assembly:e.assembly})),tracks:n}})})}(e),function(e){e.addToExtensionPoint("Core-extendPluggableElement",e=>{if("LinearPileupDisplay"===e.name){const{stateModel:t}=e,n=t.extend(e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const n=e.contextMenuFeature;return[...t(),...n?[{label:"Dotplot of read vs ref",icon:Za.A,onClick:()=>{!function(e,t){const n=(0,k.getSession)(t);try{const r=e.get("CIGAR"),a=ti(r,1),i=e.get("flags"),o=e.get("strand"),s=e.get("name"),l=`${s}_assembly_${Date.now()}`,{parentTrack:c}=t,[d]=(0,L.FI)(c,"assemblyNames"),u=[d,l],p=`track-${Date.now()}`,h=`${s}_vs_${d}`,g=e.get("tags")?.SA,f=ei(g,e.id(),o,s,!0),m=ni(2048&i?f[0].CIGAR:r),y=[{...e.toJSON(),strand:1,mate:{refName:s,start:a,end:a+ri(r)}},...f].sort((e,t)=>e.clipLengthAtStartOfRead-t.clipLengthAtStartOfRead);n.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:(0,k.sum)(y.map(e=>e.end-e.start))/800,displayedRegions:(0,k.gatherOverlaps)(y.map((e,t)=>{const{start:n,end:r,refName:a}=e;return{start:n,end:r,refName:a,index:t,assemblyName:d}}))},vview:{offsetPx:0,bpPerPx:m/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:l,start:0,end:m,refName:s}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:u,adapter:{type:"FromConfigAdapter",features:y},trackId:p,name:h}],assemblyNames:u,tracks:[{configuration:p,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:`${p}-DotplotDisplay`}]}],displayName:`${s} vs ${d}`})}catch(e){console.error(e),n.notifyError(`${e}`,e)}}(n,e)}}]:[]]}}}});e.stateModel=n}return e})}(e),e.addRpcMethod(()=>new Ra(e)),e.addRpcMethod(()=>new za(e))}configure(e){(0,U.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:La.A,onClick:e=>{e.addView("DotplotView",{})}})}}function mi({features:e}){return e.map(e=>`${e.get("refName")}\t${e.get("start")}\t${e.get("end")}\t${e.get("score")??0}`).join("\n")}const yi=(0,a.lazy)(()=>n.e(2643).then(n.bind(n,42643)));function bi(e,t){return c.types.compose("SharedGCContentModel",(0,Qe.A)(e,t),c.types.model({windowSize:c.types.maybe(c.types.number),windowDelta:c.types.maybe(c.types.number)})).actions(e=>({setGCContentParams({windowSize:t,windowDelta:n}){e.windowSize=t,e.windowDelta=n}})).views(e=>({get windowSizeSetting(){return e.windowSize??(0,L.FI)(e,"windowSize")},get windowDeltaSetting(){return e.windowDelta??(0,L.FI)(e,"windowDelta")}})).views(e=>{const{trackMenuItems:t,adapterProps:n}=e;return{trackMenuItems:()=>[...t(),{label:"Change GC parameters",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[yi,{model:e,handleClose:t}])}}],adapterProps(){const t=(0,L.FI)(e.parentTrack,"adapter");return{...n(),adapterConfig:{type:"GCContentAdapter",sequenceAdapter:t,windowSize:e.windowSizeSetting,windowDelta:e.windowDeltaSetting}}}}})}const wi=(0,a.lazy)(()=>Promise.resolve().then(n.bind(n,59083)).then(e=>({default:e.LinearWiggleDisplayReactComponent})));class vi extends r.A{name="GCContentPlugin";install(e){var t;!function(e){e.addAdapterType(()=>new b.A({name:"GCContentAdapter",displayName:"GC content adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:(0,o.S7)("GCContentAdapter",{sequenceAdapter:{type:"frozen",defaultValue:null},windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{explicitlyTyped:!0}),getAdapterClass:()=>n.e(9865).then(n.bind(n,19865)).then(e=>e.default)}))}(e),(t=e).addTrackType(()=>{const e=(e=>(0,o.S7)("GCContentTrack",{},{baseConfiguration:(0,g.J)(e)}))(t);return new p.A({name:"GCContentTrack",displayName:"GCContent track",configSchema:e,stateModel:(0,h.E)(t,"GCContentTrack",e).views(()=>({saveTrackFileFormatOptions:()=>({bedGraph:{name:"BedGraph",extension:"bedgraph",callback:mi}})}))})}),function(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearGCContentDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),n=function(e,t){return c.types.compose("LinearGCContentDisplay",bi(e,t),c.types.model({type:c.types.literal("LinearGCContentDisplay")}))}(e,t);return new I.A({name:"LinearGCContentDisplay",configSchema:t,stateModel:n,displayName:"GC content display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:wi})}),e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearGCContentTrackDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),n=function(e,t){return c.types.compose("LinearGCContentTrackDisplay",bi(e,t),c.types.model({type:c.types.literal("LinearGCContentTrackDisplay")}))}(e,t);return new I.A({name:"LinearGCContentTrackDisplay",configSchema:t,stateModel:n,displayName:"GC content display",trackType:"GCContentTrack",viewType:"LinearGenomeView",ReactComponent:wi})})}(e)}}const Si=(0,o.S7)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gffLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),xi=(0,o.S7)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,o.S7)("Gff3TabixIndex",{indexType:{model:c.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region","contig"]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gffGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});class ki extends r.A{name="GFF3Plugin";install(e){!function(e){e.addAdapterType(()=>new b.A({name:"Gff3TabixAdapter",displayName:"GFF3 tabix adapter",configSchema:xi,getAdapterClass:()=>Promise.all([n.e(5188),n.e(5534)]).then(n.bind(n,25534)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"Gff3Adapter",displayName:"GFF3 adapter",configSchema:Si,getAdapterClass:()=>n.e(6067).then(n.bind(n,66067)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t),i=n&&(0,C.getFileName)(n);return(0,k.testAdapter)(a,/\.gff3?\.b?gz$/i,r,"Gff3TabixAdapter")?{type:"Gff3TabixAdapter",bamLocation:t,gffGzLocation:t,index:{location:n||(0,C.makeIndex)(t,".tbi"),indexType:(0,C.makeIndexType)(i,"CSI","TBI")}}:(0,k.testAdapter)(a,/\.gff3?$/i,r,"Gff3Adapter")?{type:"Gff3Adapter",gffLocation:t}:e(t,n,r)})}(e)}}var Ci=n(90021),Ti=n(42832),Ai=n(11833),Mi=n(47535),Ii=n(9378),Pi=n(30097);const Li=(0,Oa.n)()({bookmarkButton:{overflow:"hidden",position:"absolute",zIndex:800},highlight:{overflow:"hidden",height:"100%",position:"absolute"}}),Ri=(0,ee.observer)(function({model:e}){const{classes:t}=Li(),n=(0,k.getSession)(e),{assemblyManager:r}=n,{bookmarkHighlightsVisible:i,bookmarkLabelsVisible:o}=e,s=n.widgets.get("GridBookmark");(0,a.useEffect)(()=>{s||n.addWidget("GridBookmarkWidget","GridBookmark")},[n,s]);const l=new Set(e.assemblyNames);return i&&s?.bookmarks?s.bookmarks.filter(e=>l.has(e.assemblyName)).map(t=>{const n=r.get(t.assemblyName),a=n?.getCanonicalRefName(t.refName)??t.refName,i=e.bpToPx({refName:a,coord:t.start}),o=e.bpToPx({refName:a,coord:t.end});return i&&o?{width:Math.max(Math.abs(o.offsetPx-i.offsetPx),3),left:Math.min(i.offsetPx,o.offsetPx)-e.offsetPx,highlight:t.highlight,label:t.label,bookmark:t}:void 0}).filter(k.notEmpty).map(({left:e,width:r,highlight:i,label:l,bookmark:c},d)=>(0,te.jsxs)(a.Fragment,{children:[(0,te.jsx)("div",{className:t.highlight,id:"highlight",style:{left:e,width:r,background:i}}),o&&r>20?(0,te.jsx)("div",{className:t.bookmarkButton,style:{left:e},children:(0,te.jsx)(Ii.A,{menuItems:[{label:"Open bookmark widget",onClick:()=>{n.showWidget(s)}},{label:"Turn off highlights",onClick:()=>{s.setBookmarkHighlightsVisible(!1)}},{label:"Remove bookmark",onClick:()=>{s.removeBookmarkObject(c)}}],children:(0,te.jsx)(Pi.A,{title:l,arrow:!0,children:(0,te.jsx)(Ci.A,{fontSize:"small",sx:{color:0!==(0,hr.M)(i).alpha()?(0,hr.M)(i).alpha(.8).toRgbString():(0,hr.M)(i).alpha(0).toRgbString()}})})})}):null]},`${e}_${r}_${d}`)):null}),Fi=Ri,Di=(0,Oa.n)()({highlight:{height:"100%",position:"absolute",left:0}}),Ni=(0,ee.observer)(function({model:e,overview:t}){const{cytobandOffset:n}=e,r=(0,k.getSession)(e),{classes:i}=Di(),{assemblyManager:o}=r,{bookmarkHighlightsVisible:s,bookmarkLabelsVisible:l}=e,c=r.widgets.get("GridBookmark");(0,a.useEffect)(()=>{c||r.addWidget("GridBookmarkWidget","GridBookmark")},[r,c]);const d=new Set(e.assemblyNames);return s&&c?.bookmarks?c.bookmarks.filter(e=>d.has(e.assemblyName)).map(e=>{const r=o.get(e.assemblyName),a=r?.getCanonicalRefName(e.refName)??e.refName,i=e.reversed,s=t.bpToPx({refName:a,coord:i?e.end:e.start}),l=t.bpToPx({refName:a,coord:i?e.start:e.end});return void 0!==s&&void 0!==l?{width:Math.abs(l-s),left:s+n,highlight:e.highlight,label:e.label}:void 0}).filter(k.notEmpty).map((e,t)=>{const{left:n,width:r,highlight:a,label:o}=e;return(0,te.jsx)(Pi.A,{title:l?o:"",arrow:!0,children:(0,te.jsx)("div",{className:i.highlight,style:{transform:`translateX(${n}px)`,width:r,background:a,borderLeft:`1px solid ${a}`,borderRight:`1px solid ${a}`}})},`${JSON.stringify(e)}-${t}`)}):null}),Bi=Ni;var Vi=n(7220);const Ei=c.types.compose(Vi.Region,c.types.model("Label",{label:c.types.optional(c.types.string,""),highlight:c.types.optional(c.types.string,"rgba(247, 129, 192, 0.35)")})).actions(e=>({setLabel(t){e.label=t},setHighlight(t){e.highlight=t}})),zi=c.types.model("SharedBookmarksModel",{sharedBookmarks:c.types.maybe(c.types.array(Ei))}),ji=()=>"undefined"!=typeof window?`bookmarks-${[window.location.host+window.location.pathname].join("-")}`:"empty",Hi=(0,o.S7)("GridBookmarkWidget",{});class _i extends r.A{name="GridBookmarkPlugin";install(e){(function(e){e.addWidgetType(()=>new i.A({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:Hi,stateModel:c.types.model("GridBookmarkModel",{id:Rn.K,type:c.types.literal("GridBookmarkWidget"),bookmarks:c.types.optional(c.types.array(Ei),()=>JSON.parse((0,k.localStorageGetItem)(ji())||"[]"))}).volatile(()=>({selectedBookmarks:[],selectedAssembliesPre:void 0})).views(e=>({get bookmarkAssemblies(){return[...new Set(e.bookmarks.map(e=>e.assemblyName))]},get validAssemblies(){const{assemblyManager:t}=(0,k.getSession)(e);return new Set(this.bookmarkAssemblies.filter(e=>t.get(e)))},get areBookmarksHighlightedOnAllOpenViews(){const{views:t}=(0,k.getSession)(e);return t.every(e=>!("bookmarkHighlightsVisible"in e)||e.bookmarkHighlightsVisible)},get areBookmarksHighlightLabelsOnAllOpenViews(){const{views:t}=(0,k.getSession)(e);return t.every(e=>!("bookmarkLabelsVisible"in e)||e.bookmarkLabelsVisible)}})).views(e=>({get bookmarksWithValidAssemblies(){return e.bookmarks.filter(t=>e.validAssemblies.has(t.assemblyName))}})).views(e=>({get sharedBookmarksModel(){return zi.create({sharedBookmarks:JSON.parse(JSON.stringify(e.selectedBookmarks))})},get allBookmarksModel(){return zi.create({sharedBookmarks:JSON.parse(JSON.stringify(e.bookmarksWithValidAssemblies))})}})).actions(e=>({setSelectedAssemblies(t){e.selectedAssembliesPre=t}})).views(e=>({get selectedAssemblies(){return e.selectedAssembliesPre?.filter(t=>e.validAssemblies.has(t))??[...e.validAssemblies]}})).actions(e=>({importBookmarks(t){e.bookmarks=(0,c.cast)([...e.bookmarks,...t])},addBookmark(t){e.bookmarks.push(t)},removeBookmark(t){e.bookmarks.splice(t,1)},updateBookmarkLabel(e,t){e.correspondingObj.setLabel(t)},updateBookmarkHighlight(e,t){e.correspondingObj.setHighlight(t)},updateBulkBookmarkHighlights(t){for(const n of e.selectedBookmarks)this.updateBookmarkHighlight(n,t)},setSelectedBookmarks(t){e.selectedBookmarks=t},setBookmarkedRegions(t){e.bookmarks=(0,c.cast)(t)},setBookmarkHighlightsVisible(t){const{views:n}=(0,k.getSession)(e);for(const e of n)e.setBookmarkHighlightsVisible?.(t),e.views?.map(e=>{e.setBookmarkHighlightsVisible?.(t)})},setBookmarkLabelsVisible(t){const{views:n}=(0,k.getSession)(e);for(const e of n)e.setBookmarkLabelsVisible?.(t),e.views?.map(e=>{e.setBookmarkHighlightsVisible?.(t)})}})).actions(e=>({clearAllBookmarks(){e.setBookmarkedRegions(e.bookmarks.filter(t=>!e.validAssemblies.has(t.assemblyName)))},clearSelectedBookmarks(){for(const t of e.selectedBookmarks)e.bookmarks.remove(t.correspondingObj);e.selectedBookmarks=[]},removeBookmarkObject(t){e.bookmarks.remove(t)}})).actions(e=>({afterAttach(){const t=ji();function n(n){if(n.key===t){const n=JSON.parse((0,k.localStorageGetItem)(t)||"[]");e.setBookmarkedRegions(n)}}window.addEventListener("storage",n),(0,c.addDisposer)(e,()=>{window.removeEventListener("storage",n)}),(0,c.addDisposer)(e,(0,N.autorun)(function(){(0,k.localStorageSetItem)(t,JSON.stringify(e.bookmarks))},{name:"BookmarkLocalStorage"}))}})).postProcessSnapshot(e=>{const{bookmarks:t,...n}=e;return n}),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(5043),n.e(7689),n.e(3469)]).then(n.bind(n,35485)))})),function(e){e.addToExtensionPoint("LinearGenomeView-TracksContainerComponent",(e,{model:t})=>[...e||[],(0,te.jsx)(Fi,{model:t},"highlight_grid_bookmark")]),e.addToExtensionPoint("LinearGenomeView-OverviewScalebarComponent",(e,{model:t,overview:n})=>[...e||[],(0,te.jsx)(Bi,{model:t,overview:n},"overview_highlight_grid_bookmark")])}(e)})(e),e.addToExtensionPoint("Core-extendPluggableElement",e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,n=t.props({bookmarkHighlightsVisible:!0,bookmarkLabelsVisible:!0}).actions(e=>({setBookmarkHighlightsVisible(t){e.bookmarkHighlightsVisible=t},setBookmarkLabelsVisible(t){e.bookmarkLabelsVisible=t},activateBookmarkWidget(){const t=(0,k.getSession)(e);if((0,U.lO)(t)){let e=t.widgets.get("GridBookmark");return e||(e=t.addWidget("GridBookmarkWidget","GridBookmark")),t.showWidget(e),t.widgets.get("GridBookmark")}throw new Error("Could not open bookmark widget")}})).actions(e=>({navigateNewestBookmark(){const t=(0,k.getSession)(e),n=e.activateBookmarkWidget();n.bookmarks.length?e.navTo(n.bookmarks.at(-1)):t.notify("There are no recent bookmarks to navigate to.","info")},bookmarkCurrentRegion(){if(e.id===(0,k.getSession)(e).focusedViewId){const t=e.getSelectedRegions(void 0,void 0),n=e.activateBookmarkWidget();if(!t.length)throw new Error("no region selected");n.addBookmark(t[0])}}})).views(e=>{const t=e.menuItems,n=e.rubberBandMenuItems;return{menuItems:()=>[...t(),{label:"Bookmarks",icon:Ti.A,subMenu:[{label:"Open bookmark widget",icon:Ti.A,onClick:()=>e.activateBookmarkWidget()},{label:"Bookmark current region",icon:Ci.A,onClick:()=>{e.bookmarkCurrentRegion()}},{label:"Toggle bookmark highlights",icon:Ai.A,type:"checkbox",checked:e.bookmarkHighlightsVisible,onClick:()=>{e.setBookmarkHighlightsVisible(!e.bookmarkHighlightsVisible)}},{label:"Toggle bookmark labels",icon:Mi.A,type:"checkbox",checked:e.bookmarkLabelsVisible,onClick:()=>{e.setBookmarkLabelsVisible(!e.bookmarkLabelsVisible)}}]}],rubberBandMenuItems:()=>[...n(),{label:"Bookmark region",icon:Ci.A,onClick:()=>{const{leftOffset:t,rightOffset:n}=e,r=e.getSelectedRegions(t,n),a=e.activateBookmarkWidget();if(!r.length)throw new Error("no regions selected");a.addBookmark(r[0])}}]}}).actions(e=>{const t=t=>{const n=(t.ctrlKey||t.metaKey)&&t.shiftKey;n&&"KeyD"===t.code&&(t.preventDefault(),e.activateBookmarkWidget(),e.bookmarkCurrentRegion(),(0,k.getSession)(e).notify("Bookmark created.","success")),n&&"KeyM"===t.code&&(t.preventDefault(),e.navigateNewestBookmark())};return{afterCreate(){document.addEventListener("keydown",t)},beforeDestroy(){document.removeEventListener("keydown",t)}}}).postProcessSnapshot(e=>{if(!e)return e;const{bookmarkHighlightsVisible:t,bookmarkLabelsVisible:n,...r}=e;return{...r,...!1===t?{bookmarkHighlightsVisible:t}:{},...!1===n?{bookmarkLabelsVisible:n}:{}}});e.stateModel=n}return e})}configure(e){(0,U.Nh)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Bookmarks",icon:Ti.A,onClick:e=>{let t=e.widgets.get("GridBookmark");t||(t=e.addWidget("GridBookmarkWidget","GridBookmark")),e.showWidget(t)}})}}const $i=(0,o.S7)("GtfAdapter",{gtfLocation:{type:"fileLocation",description:"path to gtf file, also allows for gzipped gtf",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}},aggregateField:{type:"string",description:"field used to aggregate multiple transcripts into a single parent gene feature",defaultValue:"gene_name"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gtfLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class Oi extends r.A{name="GTFPlugin";install(e){!function(e){e.addAdapterType(()=>new b.A({name:"GtfAdapter",displayName:"GTF adapter",configSchema:$i,getAdapterClass:()=>n.e(8510).then(n.bind(n,8510)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t);return(0,k.testAdapter)(a,/\.gtf(\.gz)?$/i,r,"GtfAdapter")?{type:"GtfAdapter",gtfLocation:t}:e(t,n,r)})}(e)}}const Gi=(0,o.S7)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,hicLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class Wi extends ai.default{supportsSVG=!0;async render(e){const{displayHeight:t,regions:r,bpPerPx:a,colorScheme:i,useLogScale:o}=e;let s=0;for(const e of r)s+=e.end-e.start;const l=s/a,c=l/2,d=t??c,u=await this.getFeatures(e),p=d/Math.max(d,c),{makeImageData:h}=await n.e(8333).then(n.bind(n,88333)),g={...await(0,Un.u)(l,d,e,t=>h(t,{...e,yScalar:p,features:u,pluginManager:this.pluginManager})),height:d,width:l,yScalar:p,colorScheme:i,useLogScale:o};return(0,mt.lk)(g,(0,yt.X)(g))}async getFeatures(e){const{regions:t,sessionId:n,adapterConfig:r}=e,{dataAdapter:a}=await(0,at.cK)(this.pluginManager,n,r);return a.getMultiRegionContactRecords(t,e)}}const Ui=(0,o.S7)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:interpolate(count,scale)",contextVariable:["count","maxScore","baseColor","scale"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0});function qi(e){return c.types.compose("LinearHicDisplay",R.q,(0,ze.A)(),(0,je.A)(),_e(),c.types.model({type:c.types.literal("LinearHicDisplay"),configuration:(0,o.AK)(e),resolution:c.types.optional(c.types.number,1),useLogScale:!1,colorScheme:c.types.maybe(c.types.string),activeNormalization:"KR",mode:"triangular",showLegend:c.types.maybe(c.types.boolean)})).volatile(()=>({availableNormalizations:void 0,flatbush:void 0,flatbushItems:[],maxScore:0,yScalar:1})).views(e=>({get rendererTypeName(){return"HicRenderer"},get rendererConfig(){return{...(0,L.FI)(e,"renderer"),...e.colorScheme?{color:"jexl:interpolate(count,scale)"}:{}}}})).views(e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),config:e.rendererConfig,resolution:e.resolution,useLogScale:e.useLogScale,colorScheme:e.colorScheme,normalization:e.activeNormalization,displayHeight:"adjust"===e.mode?e.height:void 0}),legendItems(){const t=e.colorScheme??"juicebox",n=e.useLogScale?e.maxScore:Math.round(e.maxScore/20);return[{label:`${e.useLogScale?"1":"0"} - ${n.toLocaleString()}${e.useLogScale?" (log)":""} (${t})`}]},svgLegendWidth:()=>e.showLegend&&e.maxScore>0?140:0}}).actions(e=>({setFlatbushData(t,n,r,a){e.flatbush=t,e.flatbushItems=n,e.maxScore=r,e.yScalar=a},reload(){e.error=void 0},setResolution(t){e.resolution=t},setUseLogScale(t){e.useLogScale=t},setColorScheme(t){e.colorScheme=t},setActiveNormalization(t){e.activeNormalization=t},setAvailableNormalizations(t){e.availableNormalizations=t},setMode(t){e.mode=t},setShowLegend(t){e.showLegend=t}})).views(e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Use log scale",type:"checkbox",checked:e.useLogScale,onClick:()=>{e.setUseLogScale(!e.useLogScale)}},{label:"Show legend",type:"checkbox",checked:e.showLegend,onClick:()=>{e.setShowLegend(!e.showLegend)}},{label:"Rendering mode",type:"subMenu",subMenu:[{label:"Triangular",type:"radio",checked:"triangular"===e.mode,onClick:()=>{e.setMode("triangular")}},{label:"Adjust to height of display",type:"radio",checked:"adjust"===e.mode,onClick:()=>{e.setMode("adjust")}}]},{label:"Color scheme",type:"subMenu",subMenu:[{label:"Fall",type:"radio",checked:"fall"===e.colorScheme,onClick:()=>{e.setColorScheme("fall")}},{label:"Viridis",type:"radio",checked:"viridis"===e.colorScheme,onClick:()=>{e.setColorScheme("viridis")}},{label:"Juicebox",type:"radio",checked:"juicebox"===e.colorScheme,onClick:()=>{e.setColorScheme("juicebox")}},{label:"Default",type:"radio",checked:void 0===e.colorScheme,onClick:()=>{e.setColorScheme(void 0)}}]},{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/2)}}]},...e.availableNormalizations?[{label:"Normalization scheme",subMenu:e.availableNormalizations.map(t=>({label:t,type:"radio",checked:t===e.activeNormalization,onClick:()=>{e.setActiveNormalization(t)}}))}]:[]],async renderSvg(t){const{renderSvg:r}=await n.e(9261).then(n.bind(n,81642));return r(e,t)}}}).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(2264).then(n.bind(n,42264));t(e)}catch(t){console.error(t),e.setError(t)}})()}}))}class Ji extends r.A{name="HicPlugin";install(e){!function(e){e.addAdapterType(()=>new b.A({name:"HicAdapter",displayName:"Hi-C adapter",configSchema:Gi,getAdapterClass:()=>Promise.all([n.e(7362),n.e(6800)]).then(n.bind(n,86800)).then(e=>e.default)}))}(e),function(e){e.addRendererType(()=>new Wi({name:"HicRenderer",ReactComponent:(0,a.lazy)(()=>n.e(6558).then(n.bind(n,96558))),configSchema:Ui,pluginManager:e}))}(e),function(e){e.addTrackType(()=>{const t=(e=>(0,o.S7)("HicTrack",{},{baseConfiguration:(0,g.J)(e)}))(e);return new p.A({name:"HicTrack",displayName:"Hi-C track",configSchema:t,stateModel:(0,h.E)(e,"HicTrack",t)})})}(e),function(e){e.addDisplayType(()=>{const t=(e=>(0,o.S7)("LinearHicDisplay",{renderer:e.getRendererType("HicRenderer").configSchema,height:{type:"number",defaultValue:300,description:"default height for the Hi-C track"}},{baseConfiguration:P.A,explicitlyTyped:!0}))(e);return new I.A({name:"LinearHicDisplay",displayName:"Hi-C contact matrix display",configSchema:t,stateModel:qi(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:(0,a.lazy)(()=>n.e(2297).then(n.bind(n,72297)))})})}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t);return/\.hic$/i.test(a)&&!r||"HicAdapter"===r?{type:"HicAdapter",hicLocation:t}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"HicAdapter"===t?"HicTrack":e(t))}(e)}configure(e){const{jexl:t}=e;t.addFunction("alpha",(e,t)=>e.alpha(t)),t.addFunction("hsl",e=>(0,hr.M)(e.toHsl())),t.addFunction("colorString",e=>e.toHex()),t.addFunction("interpolate",(e,t)=>t(e))}}const Xi=c.types.model("Job",{name:c.types.string,statusMessage:c.types.maybe(c.types.string),progressPct:c.types.number}).volatile(()=>({cancelCallback(){}})).actions(e=>({setCancelCallback(t){e.cancelCallback=t},setStatusMessage(t){e.statusMessage=t},setProgressPct(t){e.progressPct=t}})),Ki=(0,o.S7)("JobsListWidget",{});class Qi extends r.A{name="JobsManagementPlugin";install(e){!function(e){e.addWidgetType(()=>new i.A({name:"JobsListWidget",heading:"Jobs list",configSchema:Ki,stateModel:c.types.model("JobsListModel",{id:Rn.K,type:c.types.literal("JobsListWidget"),jobs:c.types.array(Xi),finished:c.types.array(Xi),queued:c.types.array(Xi),aborted:c.types.array(Xi)}).actions(e=>({addJob(t){const{cancelCallback:n,name:r}=t,a=e.jobs.find(e=>e.name===r);if(a)return a;const i=e.jobs.push(t),o=e.jobs[i-1];return o.setCancelCallback(n),o},removeJob(t){const n=e.jobs.findIndex(e=>e.name===t);if(-1!==n)return e.jobs.splice(n,1)[0]},addFinishedJob(t){const n=e.finished.find(e=>e.name===t.name);if(n)return n;const r=e.finished.push(t);return e.finished[r-1]},addQueuedJob(t){const n=e.queued.find(e=>e.name===t.name);if(n)return n;const r=e.queued.push(t);return e.queued[r-1]},addAbortedJob(t){const n=e.aborted.find(e=>e.name===t.name);if(n)return n;const r=e.aborted.push(t);return e.aborted[r-1]},removeQueuedJob(t){const n=e.queued.findIndex(e=>e.name===t);if(-1!==n)return e.queued.splice(n,1)[0]},updateJobStatusMessage(t,n){const r=e.jobs.find(e=>e.name===t);if(!r)throw new Error(`No job found with name ${t}`);r.setStatusMessage(n)},updateJobProgressPct(t,n){const r=e.jobs.find(e=>e.name===t);if(!r)throw new Error(`No job found with name ${t}`);r.setProgressPct(n)}})),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(8705),n.e(6487)]).then(n.bind(n,66487)))}))}(e)}configure(e){(0,U.Nh)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Jobs list",icon:aa.jT,onClick:e=>{if((0,U.lO)(e)){const{widgets:t}=e;let n=t.get("JobsList");n||(n=e.addWidget("JobsListWidget","JobsList")),e.showWidget(n)}}})}}var Zi=n(78544),Yi=n(26710);const eo=(0,o.S7)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:Yi.A});var to=n(67781);function no(e){return c.types.compose("JBrowse1Connection",(0,to.A)(e),c.types.model({configuration:(0,o.AK)(eo),type:c.types.literal("JBrowse1Connection")})).actions(e=>({async connect(){const t=(0,k.getSession)(e);try{const t=(0,L.FI)(e,"dataDirLocation"),{fetchJb1:r}=await n.e(2651).then(n.bind(n,2651)),{convertTrackConfig:a}=await n.e(145).then(n.bind(n,145)),i=await r(t),o=(0,L.FI)(e,"assemblyNames")[0];if(!o)throw new Error("assembly name required for JBrowse 1 connection");const s=i.tracks?.map(e=>({...a(e,i.dataRoot||""),assemblyNames:[o]}));e.setTrackConfs(s)}catch(n){console.error(n),t.notifyError(`There was a problem connecting to the JBrowse 1 data directory "${e.name}". Please make sure you have entered a valid location. The error that was thrown is: "${n}"`,n),t.breakConnection?.(e.configuration)}}}))}var ro=n(73876);const ao=(0,o.S7)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),io=(0,o.S7)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0});class oo extends r.A{name="LegacyJBrowsePlugin";install(e){!function(e){e.addAdapterType(()=>new b.A({name:"NCListAdapter",displayName:"NCList adapter",configSchema:io,adapterMetadata:{category:"Uncommon"},getAdapterClass:()=>n.e(9068).then(n.bind(n,56687)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t);return/trackData.jsonz?$/i.test(a)&&!r||"NCListAdapter"===r?{type:"NCListAdapter",rootUrlTemplate:t}:e(t,n,r)})}(e),function(e){e.addTextSearchAdapterType(()=>new ro.A({name:"JBrowse1TextSearchAdapter",configSchema:ao,description:"A JBrowse 1 text search adapter",getAdapterClass:()=>n.e(9561).then(n.bind(n,69561)).then(e=>e.default)}))}(e),function(e){e.addConnectionType(()=>new Zi.A({name:"JBrowse1Connection",configSchema:eo,stateModel:no(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"}))}(e)}}var so=n(43542);const lo=(0,a.lazy)(()=>n.e(1139).then(n.bind(n,11139))),co=function(e){return(0,o.S7)("LinearComparativeDisplay",{},{explicitlyTyped:!0,explicitIdentifier:"displayId"})};function uo(e){const{rpcManager:t}=(0,k.getSession)(e),n=e;(0,L.QZ)(e.configuration);const{level:r,adapterConfig:a}=e,i=(0,k.getContainingView)(e),o=(0,C.getRpcSessionId)(e);return(0,c.getSnapshot)(i),i.initialized?{rpcManager:t,renderProps:{...n.renderProps(),model:n,level:r,view:i,adapterConfig:a,sessionId:o,timeout:1e6,self:e}}:void 0}async function po(e){if(!e)return;const{rpcManager:t,renderProps:n}=e,{model:r,sessionId:a,adapterConfig:i,level:o}=n,s=n.view.views[o];return{features:(0,oi.Q)(await t.call(a,"CoreGetFeatures",{regions:s.staticBlocks.contentBlocks,sessionId:a,adapterConfig:i,statusCallback:e=>{r.setLoadingStatus(e)}}),e=>e.id())}}const ho=function(e){return c.types.compose("LinearComparativeDisplay",R.q,c.types.model({type:c.types.literal("LinearComparativeDisplay"),configuration:(0,o.AK)(e)})).volatile(()=>({renderInProgress:void 0,features:void 0,message:void 0,loadingStatus:void 0})).views(e=>{const{renderProps:t}=e;return{get level(){return(0,c.getParent)(e,4).level},get height(){return(0,c.getParent)(e,4).height},renderProps:()=>({...t()})}}).actions(e=>{let t;return{setLoading(n){e.message=void 0,e.error=void 0,t=n},setMessage(n){e.message=n,e.error=void 0,t=void 0},setLoadingStatus(t){e.loadingStatus=t},setRendered(n){if(!n)return;const{features:r}=n,a=e.features||[],i=new Set(a.map(e=>e.id())),o=new Set(r.map(e=>e.id()));let s=!1,l=!1;for(const e of r)if(!i.has(e.id())){s=!0;break}for(const e of a)if(!o.has(e.id())){l=!0;break}e.message=void 0,e.error=void 0,t=void 0,(s||l||!e.features)&&(e.features=r)},setError(n){console.error(n),void 0!==t&&(0,He.CF)(t),e.message=void 0,e.error=n,t=void 0}}}).actions(e=>({afterAttach(){(0,Ha.I)(e,uo,po,{name:`${e.type} ${e.id} rendering`,delay:1e3,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)}}))},go=(0,a.lazy)(()=>n.e(6226).then(n.bind(n,66226))),fo=function(e){const t=e.getViewType("LinearSyntenyViewHelper")?.stateModel;return c.types.compose("LinearComparativeView",jn.A,c.types.model({id:Rn.K,type:c.types.literal("LinearComparativeView"),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactiveOverlay:!1,showDynamicControls:!0,levels:c.types.array(t),views:c.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:c.types.array(e.pluggableConfigSchemaType("track"))})).volatile(()=>({width:void 0,isLoading:!1})).views(e=>({get initialized(){return void 0!==e.width&&e.views.length>0&&e.views.every(e=>e.initialized)},get refNames(){return e.views.map(e=>[...new Set(e.staticBlocks.map(e=>e.refName))])},get assemblyNames(){return[...new Set(e.views.flatMap(e=>e.assemblyNames))]},get loadingMessage(){return this.showLoading?"Loading":void 0},get showLoading(){return e.isLoading||!this.initialized&&e.views.length>0}})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,c.addMiddleware)(e,(t,n)=>{if("action"===t.type&&t.id===t.rootId){const r=["horizontalScroll","zoomTo","setScaleFactor"];if(e.linkViews&&r.includes(t.name)){const r=(0,c.getPath)(t.context);n(t);for(const n of e.views)(0,c.getPath)(n)!==r&&n[t.name](t.args[0]);return}}n(t)}))},beforeDestroy(){const t=(0,k.getSession)(e);for(const n of e.assemblyNames)t.removeTemporaryAssembly?.(n)},setWidth(t){e.width=t},setIsLoading(t){e.isLoading=t},setViews(t){e.views=(0,c.cast)(t);const n=[];for(let e=0;e<t.length-1;e++)n.push({level:e});e.levels=(0,c.cast)(n)},removeView(t){e.views.remove(t)},setLevelHeight(t,n=0){const r=e.levels[n];return r.setHeight(t),r.height},setLinkViews(t){e.linkViews=t},setShowDynamicControls(t){e.showDynamicControls=t},activateTrackSelector(t){if("hierarchical"===e.trackSelectorType){const n=(0,k.getSession)(e);if((0,U.lO)(n)){const r=n.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e.levels[t]});return n.showWidget(r),r}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},toggleTrack(t,n=0){e.levels[n]?.toggleTrack(t)},showTrack(t,n=0,r={}){e.levels[n]||(e.levels[n]=(0,c.cast)({level:n})),e.levels[n].showTrack(t,r)},hideTrack(t,n=0){e.levels[n]?.hideTrack(t)},squareView(){const t=(0,k.avg)(e.views.map(e=>e.bpPerPx));for(const n of e.views){const e=n.pxToBp(n.width/2);n.setNewView(t,n.offsetPx),e.refName&&n.centerAt(e.coord,e.refName,e.index)}},clearView(){e.views=(0,c.cast)([]),e.levels=(0,c.cast)([])}})).views(()=>({headerMenuItems:()=>[]})).views(e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[go,{model:e,handleClose:t}])},icon:ia.A}],rubberBandMenuItems:()=>[{label:"Zoom to region(s)",onClick:()=>{for(const t of e.views){const{leftOffset:e,rightOffset:n}=t;e&&n&&t.moveTo(e,n)}}}]})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(function(){if(e.width)for(const t of e.views)t.setWidth(e.width)},{name:"ComparativeViewWidth"}))}})).preProcessSnapshot(e=>{const{tracks:t,levels:n=[{tracks:t,level:0}],...r}=e||{};return{...r,levels:n}}).postProcessSnapshot(e=>{if(!e)return e;const{trackSelectorType:t,showIntraviewLinks:n,linkViews:r,interactiveOverlay:a,showDynamicControls:i,viewTrackConfigs:o,...s}=e;return{...s,..."hierarchical"!==t?{trackSelectorType:t}:{},...n?{}:{showIntraviewLinks:n},...r?{linkViews:r}:{},...a?{interactiveOverlay:a}:{},...i?{}:{showDynamicControls:i},...o.length?{viewTrackConfigs:o}:{}}})},mo=(0,a.lazy)(()=>n.e(8956).then(n.bind(n,76575)));var yo=n(2433);const bo=function(e){return c.types.compose("LinearSyntenyDisplay",ho(e),c.types.model({type:c.types.literal("LinearSyntenyDisplay"),configuration:(0,o.AK)(e),colorBy:c.types.optional(c.types.string,"default"),alpha:c.types.optional(c.types.number,.2),minAlignmentLength:c.types.optional(c.types.number,0)})).volatile(()=>({mainCanvas:null,clickMapCanvas:null,cigarClickMapCanvas:null,mouseoverCanvas:null,featPositions:[],mouseoverId:void 0,clickId:void 0,cigarMouseoverId:-1})).actions(e=>({setFeatPositions(t){e.featPositions=t},setMainCanvasRef(t){e.mainCanvas=t},setClickMapCanvasRef(t){e.clickMapCanvas=t},setCigarClickMapCanvasRef(t){e.cigarClickMapCanvas=t},setMouseoverCanvasRef(t){e.mouseoverCanvas=t},setMouseoverId(t){e.mouseoverId=t},setCigarMouseoverId(t){e.cigarMouseoverId=t},setClickId(t){e.clickId=t},setAlpha(t){e.alpha=t},setMinAlignmentLength(t){e.minAlignmentLength=t},setColorBy(t){e.colorBy=t}})).views(e=>({get adapterConfig(){return{name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,L.FI)(e,"assemblyNames"),...(0,L.FI)(e.parentTrack,"adapter")}},get trackIds(){return(0,L.FI)(e,"trackIds")},get numFeats(){return e.featPositions.length},get ready(){return this.numFeats>0},get featMap(){return Object.fromEntries(e.featPositions.map(e=>[e.f.id(),e]))},get colorSchemeConfig(){return yo.yM[e.colorBy]||yo.yM.default},get colorMapWithAlpha(){const{alpha:t}=e,n=this.colorSchemeConfig.cigarColors;return{I:(0,yo.Th)(n.I,t),N:(0,yo.Th)(n.N,t),D:(0,yo.Th)(n.D,t),X:(0,yo.Th)(n.X,t),M:(0,yo.Th)(n.M,t),"=":(0,yo.Th)(n["="],t)}},get posColorWithAlpha(){const t="strand"===e.colorBy?yo.yM.strand.posColor:"red";return(0,yo.Th)(t,e.alpha)},get negColorWithAlpha(){const t="strand"===e.colorBy?yo.yM.strand.negColor:"blue";return(0,yo.Th)(t,e.alpha)},get queryColorWithAlphaMap(){const{alpha:t}=e,n=new Map;return e=>{if(!n.has(e)){const r=(0,yo.i0)(e);n.set(e,(0,yo.Th)(r,t))}return n.get(e)}},get queryTotalLengths(){if(e.minAlignmentLength<=0)return;const t=new Map;for(const{f:n}of e.featPositions){const e=n.get("name")||n.get("id")||n.id(),r=Math.abs(n.get("end")-n.get("start")),a=t.get(e)||0;t.set(e,a+r)}return t}})).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(4613).then(n.bind(n,14613));t(e)}catch(t){console.error(t),e.setError(t)}})()}}))};var wo=n(87037),vo=n(1656);function So(e){const t=(0,Wt.c)(3);let n,r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,te.jsx)("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"}),t[0]=n):n=t[0],t[1]!==e?(r=(0,te.jsx)(Ut.A,{...e,children:n}),t[1]=e,t[2]=r):r=t[2],r}const xo=(0,a.lazy)(()=>n.e(3637).then(n.bind(n,33637))),ko=(0,a.lazy)(()=>n.e(4610).then(n.bind(n,94610)));function Co(e){return c.types.compose("LinearSyntenyView",fo(e),c.types.model({type:c.types.literal("LinearSyntenyView"),drawCIGAR:!0,drawCIGARMatchesOnly:!1,drawCurves:!1,drawLocationMarkers:!1,init:c.types.frozen()})).volatile(()=>({importFormSyntenyTrackSelections:N.observable.array()})).views(e=>({get hasSomethingToShow(){return e.views.length>0||!!e.init}})).views(e=>({get showLoading(){return e.isLoading||!e.initialized&&e.hasSomethingToShow},get showImportForm(){return!e.hasSomethingToShow}})).actions(e=>({importFormRemoveRow(t){e.importFormSyntenyTrackSelections.splice(t,1)},clearImportFormSyntenyTracks(){e.importFormSyntenyTrackSelections.clear()},setImportFormSyntenyTrack(t,n){e.importFormSyntenyTrackSelections[t]=n},setDrawCurves(t){e.drawCurves=t},setDrawCIGAR(t){e.drawCIGAR=t},setDrawCIGARMatchesOnly(t){e.drawCIGARMatchesOnly=t},setDrawLocationMarkers(t){e.drawLocationMarkers=t},showAllRegions(){for(const t of e.views)t.showAllRegionsInAssembly()},setInit(t){e.init=t}})).actions(e=>({async exportSvg(t){const{renderToSvg:r}=await n.e(544).then(n.bind(n,70544)),a=await r(e,t),{saveAs:i}=await n.e(1611).then(n.bind(n,91611));if("png"===t.format){const e=new Image,n=new Blob([a],{type:"image/svg+xml"}),r=URL.createObjectURL(n);await new Promise((n,a)=>{e.onload=()=>{const o=document.createElement("canvas");o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(e,0,0),URL.revokeObjectURL(r),o.toBlob(r=>{r?(i(r,t.filename||"image.png"),n()):a(new Error(`Failed to create PNG. The image may be too large (${e.width}x${e.height}). Try reducing the view size or use SVG format.`))},"image/png")},e.onerror=()=>{URL.revokeObjectURL(r),a(new Error("Failed to load SVG for PNG conversion"))},e.src=r})}else i(new Blob([a],{type:"image/svg+xml"}),t.filename||"image.svg")}})).views(e=>{const t=e.headerMenuItems,n=e.menuItems;return{headerMenuItems:()=>[...t(),{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:wo.A,helpText:"Square view synchronizes the zoom levels of both genome views by calculating the average zoom level and applying it to both panels. This helps ensure features are displayed at comparable scales, making it easier to compare syntenic regions visually."},{label:"Re-order chromosomes",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[ko,{handleClose:t,model:e}])},icon:vo.A,description:"Reorder and reorient query regions to minimize crossing lines, also known as 'diagonalizing'",helpText:"This operation 'diagonalizes' the data which algorithmically reorders and reorients chromosomes to minimize crossing synteny lines, creating a more diagonal pattern. This makes it easier to identify large-scale genomic rearrangements, inversions, and translocations. The process may take a few moments for large genomes."},{label:"Show...",subMenu:[{label:"Show all regions",onClick:e.showAllRegions,description:"Show entire genome assemblies",icon:Z.A,helpText:"This command will zoom out all views to display the entire genome assemblies. This is useful when you want to get a high-level overview of syntenic relationships across whole genomes or when you need to reset the view after zooming into specific regions."},{label:"Show dynamic controls",type:"checkbox",checked:e.showDynamicControls,onClick:()=>{e.setShowDynamicControls(!e.showDynamicControls)},helpText:"Toggle visibility of dynamic controls like opacity and minimum length sliders. These controls allow you to adjust synteny visualization parameters in real-time."},{label:"Show CIGAR insertions/deletions",checked:e.drawCIGAR,type:"checkbox",description:"If disabled, only shows the broad scale CIGAR match",onClick:()=>{e.setDrawCIGAR(!e.drawCIGAR)},helpText:"CIGAR strings encode detailed alignment information including matches, insertions, and deletions. When enabled, this option visualizes the fine-scale variations in syntenic alignments. Disable this for a cleaner view that shows only broad syntenic blocks."},{label:"Show CIGAR matches only",checked:e.drawCIGARMatchesOnly,type:"checkbox",description:"If enabled, hides the insertions and deletions in the CIGAR strings",onClick:()=>{e.setDrawCIGARMatchesOnly(!e.drawCIGARMatchesOnly)},helpText:"When comparing divergent genomes, showing all insertions and deletions can clutter the view. This option filters the CIGAR visualization to show only the matching regions, providing a cleaner view of conserved syntenic blocks while hiding small-scale indels."},{label:"Show curved lines",type:"checkbox",checked:e.drawCurves,icon:So,onClick:()=>{e.setDrawCurves(!e.drawCurves)},helpText:"Toggle between straight lines and smooth bezier curves for synteny connections. Curved lines can make the visualization more aesthetically pleasing and may help reduce visual clutter when many syntenic regions are displayed. Straight lines provide a more direct representation."},{label:"Show location markers",type:"checkbox",checked:e.drawLocationMarkers,description:"Draw periodic markers to show location within large matches",onClick:()=>{e.setDrawLocationMarkers(!e.drawLocationMarkers)},helpText:"Location markers add periodic visual indicators along long syntenic blocks, helping you track position and scale within large conserved regions. This is particularly useful when examining very long syntenic matches where it can be difficult to gauge relative position."}]},{label:"Link views",type:"checkbox",checked:e.linkViews,icon:Hn.A,onClick:()=>{e.setLinkViews(!e.linkViews)},helpText:"When linked, panning and zooming in one genome view will automatically adjust the other view to maintain the correspondence shown by synteny lines. This makes it easier to explore syntenic regions interactively. Unlink views to navigate each genome independently."},{label:"Export SVG",icon:_n.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[xo,{model:e,handleClose:t}])}}],menuItems:()=>[...n(),{label:"Export SVG",icon:_n.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[xo,{model:e,handleClose:t}])}}]}}).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(async function(){const{init:t,width:n}=e;if(!n||!t)return;const r=(0,k.getSession)(e),{assemblyManager:a}=r;try{const n=await Promise.all(t.views.map(async e=>{const t=await a.waitForAssembly(e.assembly);if(!t)throw new Error(`Assembly ${e.assembly} failed to load`);return t}));if(e.setViews(n.map(e=>({type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:e.regions}))),await Promise.all(e.views.map(e=>(0,N.when)(()=>e.initialized))),await Promise.all(t.views.map(async(t,n)=>{const r=e.views[n];if(r&&(t.loc?await r.navToLocString(t.loc,t.assembly):r.showAllRegionsInAssembly(t.assembly),t.tracks))for(const e of t.tracks)r.showTrack(e)})),t.tracks)for(const n of t.tracks)e.showTrack(n);e.setInit(void 0)}catch(t){console.error(t),r.notifyError(`${t}`,t),e.setInit(void 0)}},{name:"LinearSyntenyViewInit"}))}})).postProcessSnapshot(e=>{if(!e)return e;const{init:t,drawCIGAR:n,drawCIGARMatchesOnly:r,drawCurves:a,drawLocationMarkers:i,...o}=e;return{...o,...n?{}:{drawCIGAR:n},...r?{drawCIGARMatchesOnly:r}:{},...a?{drawCurves:a}:{},...i?{drawLocationMarkers:i}:{}}})}function To(e){return c.types.model("LinearSyntenyViewHelper",{id:Rn.K,type:"LinearSyntenyViewHelper",tracks:c.types.array(e.pluggableMstType("track","stateModel")),height:100,level:c.types.number}).actions(e=>({setHeight:t=>(e.height=t,e.height),showTrack:(t,n={})=>(0,C.showTrackGeneric)(e,t,n),hideTrack:t=>(0,C.hideTrackGeneric)(e,t),toggleTrack(t){(0,C.toggleTrackGeneric)(e,t)}})).views(e=>({get assemblyNames(){const t=(0,c.getParent)(e,2);return[t.views[e.level].assemblyNames[0],t.views[e.level+1].assemblyNames[0]]}}))}function Ao(){const e=(0,Wt.c)(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,te.jsx)("div",{}),e[0]=t):t=e[0],t}const Mo=(0,o.S7)("SyntenyFeatureWidget",{});function Io(e){return c.types.compose((0,l.n)(e),c.types.model("SyntenyFeatureWidget",{type:c.types.literal("SyntenyFeatureWidget"),level:c.types.maybe(c.types.number)}))}class Po extends r.A{name="LinearComparativeViewPlugin";install(e){!function(e){e.addViewType(()=>new zn.A({name:"LinearSyntenyViewHelper",displayName:"Linear synteny view (helper)",viewMetadata:{hiddenFromGUI:!0},stateModel:To(e),ReactComponent:Ao}))}(e),function(e){e.addViewType(()=>new zn.A({name:"LinearComparativeView",viewMetadata:{hiddenFromGUI:!0},displayName:"Linear comparative view",stateModel:fo(e),ReactComponent:(0,a.lazy)(()=>n.e(5643).then(n.bind(n,15643)))}))}(e),function(e){e.addViewType(()=>new zn.A({name:"LinearSyntenyView",displayName:"Linear synteny view",stateModel:Co(e),ReactComponent:(0,a.lazy)(()=>n.e(566).then(n.bind(n,30566)))}))}(e),function(e){e.addDisplayType(()=>{const e=co();return new I.A({name:"LinearComparativeDisplay",configSchema:e,stateModel:ho(e),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:()=>null})})}(e),function(e){e.addDisplayType(()=>{const e=(0,o.S7)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:co(),explicitlyTyped:!0});return new I.A({name:"LinearSyntenyDisplay",configSchema:e,stateModel:bo(e),trackType:"SyntenyTrack",viewType:"LinearSyntenyViewHelper",ReactComponent:(0,a.lazy)(()=>n.e(2885).then(n.bind(n,62885)))})})}(e),function(e){e.addWidgetType(()=>new i.A({name:"SyntenyFeatureWidget",heading:"Synteny feature details",configSchema:Mo,stateModel:Io(e),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(8705),n.e(5043),n.e(6569),n.e(2943),n.e(6450)]).then(n.bind(n,26450)))}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return e.jexl.addFunction("lgvSyntenyTooltip",e=>{const t=e.get("mate"),n=e.get("name")||e.get("id"),r=t?.name||t?.id;return[n?`Name1: ${n}`:"",r?`Name2: ${r}`:"",`Loc1: ${(0,k.assembleLocString)({refName:e.get("refName"),start:e.get("start"),end:e.get("end")})} (${(0,k.toLocale)(e.get("end")-e.get("start"))}bp)`,`Loc2: ${(0,k.assembleLocString)({refName:t.refName,start:t.start,end:t.end})} (${(0,k.toLocale)(t.end-t.start)}bp)`].filter(e=>!!e).join("<br/>")}),(0,o.S7)("LGVSyntenyDisplay",{mouseover:{type:"string",defaultValue:"jexl:lgvSyntenyTooltip(feature)"}},{baseConfiguration:_(e),explicitlyTyped:!0})}(e),n=(r=t,c.types.compose("LGVSyntenyDisplay",Le(r),c.types.model({type:c.types.literal("LGVSyntenyDisplay"),configuration:(0,o.AK)(r)})).views(e=>{const t=e.contextMenuItems;return{contextMenuItems(){const n=e.contextMenuFeature;return[...t(),...n?[{label:"Launch synteny view for this position",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[lo,{view:(0,k.getContainingView)(e),trackId:(0,L.FI)((0,k.getContainingTrack)(e),"trackId"),handleClose:t,session:(0,k.getSession)(e),feature:n}])}}]:[]]}}}).views(e=>{const{trackMenuItems:t,colorSchemeSubMenuItems:n}=e;return{trackMenuItems:()=>[...t(),{label:"Color scheme",subMenu:[...n()]}]}}).actions(e=>({selectFeature(t){const n=(0,k.getSession)(e);if((0,U.lO)(n)){let r=(0,k.getContainingView)(e);try{r=(0,k.getContainingView)(r)}catch(e){}const a=n.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:t.toJSON(),view:r,track:(0,k.getContainingTrack)(e)});n.showWidget(a)}n.setSelection(t)},afterCreate(){e.colorBySetting||"normal"!==e.colorBy.type||e.setColorScheme({type:"strand"})}})));var r;return new I.A({name:"LGVSyntenyDisplay",configSchema:t,stateModel:n,trackType:"SyntenyTrack",viewType:"LinearGenomeView",ReactComponent:z.Ay})})}(e),function(e){e.addToExtensionPoint("LaunchView-LinearSyntenyView",async({session:e,views:t,tracks:n=[]})=>{const r=Array.isArray(n[0])?n.flat():n;e.addView("LinearSyntenyView",{init:{views:t.map(e=>({loc:e.loc,assembly:e.assembly,tracks:e.tracks})),tracks:r}})})}(e),function(e){e.addTrackType(()=>{const t=(e=>(0,o.S7)("SyntenyTrack",{},{baseConfiguration:(0,g.J)(e)}))(e);return new p.A({name:"SyntenyTrack",configSchema:t,stateModel:(0,h.E)(e,"SyntenyTrack",t)})})}(e),e.addToExtensionPoint("Core-extendPluggableElement",e=>("LinearPileupDisplay"!==e.name||(e.stateModel=e.stateModel.extend(e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const n=e.contextMenuFeature,r=(0,k.getContainingTrack)(e);return[...t(),...n?[{label:"Linear read vs ref",icon:Za.A,onClick:()=>{(0,k.getSession)(e).queueDialog(e=>[mo,{track:r,feature:n,handleClose:e}])}}]:[]]}}}})),e))}configure(e){(0,U.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:so.A,onClick:e=>{e.addView("LinearSyntenyView",{})}})}}var Lo=n(36832);function Ro(e){return c.types.compose("LinearLollipopDisplay",J.L,c.types.model({type:c.types.literal("LinearLollipopDisplay"),configuration:(0,o.AK)(e)})).views(e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:()=>({...t(),config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}})}class Fo extends Lt.default{}const Do=(0,o.S7)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0});class No extends r.A{name="LollipopPlugin";install(e){!function(e){e.addRendererType(()=>new Fo({name:"LollipopRenderer",ReactComponent:(0,a.lazy)(()=>n.e(8934).then(n.bind(n,58934))),configSchema:Do,pluginManager:e}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:P.A,explicitlyTyped:!0})}(e);return new I.A({name:"LinearLollipopDisplay",configSchema:t,stateModel:Ro(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:z.Ay})})}(e)}}var Bo=n(28318),Vo=n(25053);const Eo=(0,o.S7)("AboutWidget",{}),zo=c.types.model("AboutWidget",{id:Rn.K,type:c.types.literal("AboutWidget")}),jo=(0,o.S7)("HelpWidget",{}),Ho=c.types.model("HelpWidget",{id:Rn.K,type:c.types.literal("HelpWidget")}),_o=(0,o.S7)("ImportSessionWidget",{}),$o=c.types.model("ImportSessionWidget",{id:Rn.K,type:c.types.literal("ImportSessionWidget")}),Oo=(0,o.S7)("SessionManager",{}),Go=c.types.model("SessionManager",{id:Rn.K,type:c.types.literal("SessionManager")});class Wo extends r.A{name="MenusPlugin";install(e){!function(e){e.addWidgetType(()=>new i.A({name:"AboutWidget",heading:"About",configSchema:Eo,stateModel:zo,ReactComponent:(0,a.lazy)(()=>n.e(7481).then(n.bind(n,97481)))}))}(e),function(e){e.addWidgetType(()=>new i.A({name:"HelpWidget",heading:"Help",configSchema:jo,stateModel:Ho,ReactComponent:(0,a.lazy)(()=>n.e(8139).then(n.bind(n,88139)))}))}(e),function(e){e.addWidgetType(()=>new i.A({name:"ImportSessionWidget",heading:"Import session",configSchema:_o,stateModel:$o,ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(471),n.e(2530)]).then(n.bind(n,32530)))}))}(e),function(e){e.addWidgetType(()=>new i.A({name:"SessionManager",heading:"Recent sessions",configSchema:Oo,stateModel:Go,ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(5043),n.e(1154),n.e(5560)]).then(n.bind(n,75560)))}))}(e)}configure(e){(0,U.Nh)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:Vo.A,onClick:e=>{const t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:Bo.A,onClick:e=>{const t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}}const Uo=(0,o.S7)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0});class qo extends r.A{name="RdfPlugin";install(e){!function(e){e.addAdapterType(()=>new b.A({name:"SPARQLAdapter",displayName:"SPARQL adapter",configSchema:Uo,adapterMetadata:{category:"Uncommon"},getAdapterClass:()=>n.e(1684).then(n.bind(n,61684)).then(e=>e.default)}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="SPARQLAdapter",i=(0,C.getFileName)(t);return/\/sparql$/i.test(i)||r===a?{type:a,endpoint:t}:e(t,n,r)})}}const Jo=(0,o.S7)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri},faiLocation:{uri:`${e.uri}.fai`,baseUri:e.baseUri},gziLocation:{uri:`${e.uri}.gzi`,baseUri:e.baseUri}}:e}),Xo=(0,o.S7)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,chromSizesLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Ko=(0,o.S7)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0});class Qo extends Lt.default{supportsSVG=!0;getExpandedRegion(e){return(0,ft.T)(e,3)}}const Zo=(0,o.S7)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri},faiLocation:{uri:`${e.uri}.fai`,baseUri:e.baseUri}}:e}),Yo=(0,o.S7)("LinearReferenceSequenceDisplay",{renderer:Ko},{explicitIdentifier:"displayId",explicitlyTyped:!0});function es({features:e}){return e.map(e=>{const t=e.get("refName"),n=Math.floor(e.get("start")),r=Math.floor(e.get("end")),a=e.get("seq")??"";return`>${t}:${n+1}-${r}\n${a.match(/.{1,80}/g)?.join("\n")??""}`}).join("\n")}const ts=(0,o.S7)("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0}),ns=(0,o.S7)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,twoBitLocation:{uri:e.uri,baseUri:e.baseUri},...e.chromSizes?{chromSizesLocation:{uri:e.chromSizes,baseUri:e.baseUri}}:{}}:e}),rs=(0,o.S7)("UnindexedFastaAdapter",{rewriteRefNames:{type:"string",defaultValue:"",contextVariable:["refName"]},fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class as extends r.A{name="SequencePlugin";install(e){!function(e){e.addRendererType(()=>new Qo({name:"DivSequenceRenderer",ReactComponent:(0,a.lazy)(()=>n.e(6589).then(n.bind(n,86589))),configSchema:Ko,pluginManager:e}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"TwoBitAdapter",displayName:"TwoBit adapter",configSchema:ns,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(5390).then(n.bind(n,55390)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"BgzipFastaAdapter",displayName:"Bgzip-indexed FASTA adapter",configSchema:Jo,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(1265).then(n.bind(n,41265)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"ChromSizesAdapter",displayName:"Chrom sizes adapter",configSchema:Xo,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(2685).then(n.bind(n,62685)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"IndexedFastaAdapter",displayName:"Indexed FASTA adapter",configSchema:Zo,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(5609).then(n.bind(n,35609)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"UnindexedFastaAdapter",displayName:"Unindexed FASTA adapter",configSchema:rs,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(6581).then(n.bind(n,46581)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"SequenceSearchAdapter",displayName:"Sequence search adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:ts,getAdapterClass:()=>n.e(6085).then(n.bind(n,76085)).then(e=>e.default)}))}(e),function(e){e.addTrackType(()=>{const t=function(e){return(0,o.S7)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:c.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:'optional track name, otherwise uses the "Reference sequence (assemblyName)"',defaultValue:""},sequenceType:{type:"string",description:"either dna or pep",defaultValue:"dna"},description:{description:"a description of the track",type:"string",defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},formatAbout:(0,o.S7)("FormatAbout",{config:{type:"frozen",description:"formats configuration in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const n=JSON.parse(JSON.stringify(t)),r=new Set,{displays:a=[]}=n;if("placeholderId"!==n.trackId){for(const e of a)e&&r.add(e.type);const t=e.getTrackType(n.type);for(const e of t?.displayTypes||[])r.has(e.name)||a.push({displayId:`${n.trackId}-${e.name}`,type:e.name})}return{...n,displays:a}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:n}=t;if(!n)throw new Error(`unknown display type ${n}`);const r=e.displays.find(e=>e?.displayId===t.displayId);if(r)return r;const a=e.displays.push(t);return e.displays[a-1]}})})}(e);return new p.A({name:"ReferenceSequenceTrack",displayName:"Reference sequence track",configSchema:t,stateModel:(0,h.E)(e,"ReferenceSequenceTrack",t).views(()=>({saveTrackFileFormatOptions:()=>({fasta:{name:"FASTA",extension:"fa",callback:es}})}))})})}(e),function(e){e.addDisplayType(()=>{const e=function(e){return c.types.compose("LinearReferenceSequenceDisplay",J.L,c.types.model({type:c.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,o.AK)(e),showForward:!0,showReverse:!0,showTranslation:!0})).volatile(()=>({rowHeight:15})).views(e=>({get sequenceType(){return(0,L.FI)((0,k.getContainingTrack)(e),"sequenceType")},get showForwardActual(){return e.showForward},get showReverseActual(){return"dna"===this.sequenceType&&e.showReverse},get showTranslationActual(){return"dna"===this.sequenceType&&e.showTranslation}})).views(e=>({get sequenceHeight(){const{rowHeight:t,showTranslationActual:n,showReverseActual:r,showForwardActual:a}=e;return(r&&n?3*t:0)+(a&&n?3*t:0)+(r?t:0)+(a?t:0)}})).views(e=>{const{renderProps:t}=e;return{renderProps(){const{rpcDriverName:n,showForwardActual:r,showReverseActual:a,showTranslationActual:i,rowHeight:o,sequenceHeight:s,sequenceType:l}=e;return{...t(),...(0,C.getParentRenderProps)(e),config:e.configuration.renderer,rpcDriverName:n,showForward:r,showReverse:a,showTranslation:i,sequenceType:l,rowHeight:o,sequenceHeight:s}}}}).views(e=>({regionCannotBeRendered:()=>(0,k.getContainingView)(e).bpPerPx>3?"Zoom in to see sequence":void 0,get rendererTypeName(){return e.configuration.renderer.type}})).actions(e=>({toggleShowForward(){e.showForward=!e.showForward},toggleShowReverse(){e.showReverse=!e.showReverse},toggleShowTranslation(){e.showTranslation=!e.showTranslation},afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(function(){(0,k.getContainingView)(e).bpPerPx>3?e.setHeight(50):e.setHeight(e.sequenceHeight)},{name:"SequenceHeight"}))}})).views(e=>({trackMenuItems:()=>[..."dna"===e.sequenceType?[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:()=>{e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:()=>{e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:()=>{e.toggleShowTranslation()}}]:[]]})).postProcessSnapshot(e=>{if(!e)return e;const{showForward:t,showReverse:n,showTranslation:r,...a}=e;return{...a,...t?{}:{showForward:t},...n?{}:{showReverse:n},...r?{}:{showTranslation:r}}})}(Yo);return new I.A({name:"LinearReferenceSequenceDisplay",configSchema:Yo,stateModel:e,displayName:"Reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:z.Ay})})}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="TwoBitAdapter",i=(0,C.getFileName)(t),o={type:a,twoBitLocation:t};return/\.2bit$/i.test(i)&&!r||r===a?o:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t)),e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="IndexedFastaAdapter",i=(0,C.getFileName)(t),o={type:a,fastaLocation:t,faiLocation:n||(0,C.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(i)&&!r||r===a?o:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t)),e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="BgzipFastaAdapter",i=(0,C.getFileName)(t),o={type:a,faiLocation:(0,C.makeIndex)(t,".fai"),gziLocation:(0,C.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(i)&&!r||r===a?o:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t))}(e)}}var is=n(42274),os=n(11931);const ss=["VCF","BED","BEDPE","STAR-Fusion"],ls={VCF:()=>Promise.all([n.e(208),n.e(4583)]).then(n.bind(n,24583)).then(e=>e.parseVcfBuffer),BED:()=>n.e(3439).then(n.bind(n,73439)).then(e=>e.parseBedBuffer),BEDPE:()=>n.e(7412).then(n.bind(n,7412)).then(e=>e.parseBedPEBuffer),"STAR-Fusion":()=>n.e(7528).then(n.bind(n,17528)).then(e=>e.parseSTARFusionBuffer)},cs={VcfAdapter:{fileType:"VCF",locationKey:"vcfLocation"},VcfTabixAdapter:{fileType:"VCF",locationKey:"vcfGzLocation"},BedAdapter:{fileType:"BED",locationKey:"bedLocation"},BedTabixAdapter:{fileType:"BED",locationKey:"bedGzLocation"},BedpeAdapter:{fileType:"BEDPE",locationKey:"bedpeLocation"}},ds=new RegExp(String.raw`\.(${ss.join("|")})(\.gz)?$`,"i");var us=n(15731);function ps({assemblyName:e,session:t,locString:n,spreadsheetViewId:r}){const a=`${r}_${e}`;let i=t.views.find(e=>e.id===a);return i||(i=t.addView("LinearGenomeView",{id:a})),i.navToLocString(n,e)}var hs=n(77065);const gs=(0,a.lazy)(()=>Promise.all([n.e(208),n.e(6740),n.e(8754)]).then(n.bind(n,55081)));function fs(e){const t=(0,Wt.c)(16),{assemblyName:n,session:r,spreadsheetViewId:a,feature:i}=e;let o,s,l,c,d;return t[0]!==n||t[1]!==i||t[2]!==r||t[3]!==a?(o={label:"Open in linear genome view",onClick:async()=>{try{await ps({spreadsheetViewId:a,assemblyName:n,session:r,locString:(0,k.assembleLocStringFast)(i)})}catch(e){const t=e;console.error(t),r.notifyError(`${t}`,t)}}},t[0]=n,t[1]=i,t[2]=r,t[3]=a,t[4]=o):o=t[4],t[5]!==n||t[6]!==i||t[7]!==r||t[8]!==a?(s={label:"Open in breakpoint split view",onClick:()=>{r.queueDialog(e=>[gs,{handleClose:e,session:r,stableViewId:`${a}_${n}_breakpointsplitview`,feature:new q.A(i),assemblyName:n}])}},t[5]=n,t[6]=i,t[7]=r,t[8]=a,t[9]=s):s=t[9],t[10]!==o||t[11]!==s?(l=[o,s],t[10]=o,t[11]=s,t[12]=l):l=t[12],t[13]===Symbol.for("react.memo_cache_sentinel")?(c=(0,te.jsx)(hs.A,{}),t[13]=c):c=t[13],t[14]!==l?(d=(0,te.jsx)(Ii.A,{menuItems:l,children:c}),t[14]=l,t[15]=d):d=t[15],d}function ms(e){const t=(0,Wt.c)(20),{model:n,feature:r}=e;let a,i,o,s,l,d,u;return t[0]!==n?(a=(0,k.getSession)(n),t[0]=n,t[1]=a):a=t[1],t[2]!==n?(i=(0,c.getParent)(n),t[2]=n,t[3]=i):i=t[3],t[4]!==r||t[5]!==n.assemblyName||t[6]!==a||t[7]!==i.id?(o=(0,te.jsx)(fs,{session:a,spreadsheetViewId:i.id,assemblyName:n.assemblyName,feature:r}),t[4]=r,t[5]=n.assemblyName,t[6]=a,t[7]=i.id,t[8]=o):o=t[8],t[9]!==r||t[10]!==n?(s=async e=>{try{e.preventDefault(),await ps({spreadsheetViewId:(0,c.getParent)(n).id,session:(0,k.getSession)(n),locString:(0,k.assembleLocString)(r),assemblyName:n.assemblyName})}catch(e){const t=e;console.error(t),(0,k.getSession)(n).notifyError(`${t}`,t)}},t[9]=r,t[10]=n,t[11]=s):s=t[11],t[12]!==r?(l=(0,k.assembleLocString)(r),t[12]=r,t[13]=l):l=t[13],t[14]!==s||t[15]!==l?(d=(0,te.jsx)(us.A,{href:"#",onClick:s,children:l}),t[14]=s,t[15]=l,t[16]=d):d=t[16],t[17]!==o||t[18]!==d?(u=(0,te.jsxs)(te.Fragment,{children:[o,d]}),t[17]=o,t[18]=d,t[19]=u):u=t[19],u}function ys(){const e=c.types.model("SpreadsheetImportWizard",{fileType:c.types.optional(c.types.enumeration(ss),"VCF"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:c.types.maybe(c.types.string),cachedFileLocation:c.types.frozen()}).volatile(()=>({fileTypes:ss,fileSource:void 0,error:void 0,loading:!1})).views(e=>({get isReadyToOpen(){return e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName(t,n){const{assemblyManager:r}=(0,k.getSession)(e);return!!n&&r.isValidRefName(t,n)},tracksForAssembly(t){const n=(0,k.getSession)(e),{tracks:r,sessionTracks:a=[]}=n;return[...r,...a].flatMap(e=>{const r=(0,L.QZ)(e,"assemblyNames")??[];if(!r.includes(t))return[];const a=function(e){const t=cs[e.type];if(!t)return;const n=e[t.locationKey]??e;return{fileType:t.fileType,loc:n}}((0,L.QZ)(e,"adapter"));if(!a)return[];const i=((0,L.QZ)(e,"category")??[]).join(",");return{track:e,label:[i?`[${i}]`:"",(0,C.getTrackName)(e,n)].filter(e=>!!e).join(" "),assemblyNames:r,type:a.fileType,loc:a.loc}}).sort((e,t)=>e.label.localeCompare(t.label))}})).actions(e=>({setSelectedAssemblyName(t){e.selectedAssemblyName=t},setFileSource(t){if(e.fileSource=t,e.error=void 0,e.fileSource){const t=e.fileName;if(t){const n=ds.exec(t)?.[1];n&&(e.fileType="tsv"===n&&t.includes("star-fusion")?"STAR-Fusion":n.toUpperCase())}}},setColumnNameLineNumber(t){t>0&&(e.columnNameLineNumber=t)},setFileType(t){e.fileType=t},setError(t){e.error=t},setLoading(t){e.loading=t},cancelButton(){e.error=void 0,(0,c.getParent)(e).setDisplayMode()},setCachedFileHandle(t){e.cachedFileLocation=t}})).actions(e=>({async import(t){if(!e.fileSource)return;e.selectedAssemblyName=t;const r=e.fileType,a=await ls[r](),{fetchAndMaybeUnzip:i}=await Promise.resolve().then(n.bind(n,23886)),{pluginManager:o}=(0,k.getEnv)(e),s=(0,os.openLocation)(e.fileSource,o);e.setLoading(!0);try{if((await s.stat()).size>1e8)return void e.setError(`File is too big. Tabular files are limited to at most ${1e5.toLocaleString()}kb.`)}catch(e){console.warn(e)}finally{e.setLoading(!1)}e.setLoading(!0);try{e.fileSource.uri&&e.setCachedFileHandle({uri:e.fileSource.uri,baseUri:e.fileSource.baseUri,locationType:"UriLocation"});const n=await i(s);(0,c.getParent)(e).displaySpreadsheet({...a(n),assemblyName:t})}catch(t){console.error(t),e.setError(t)}finally{e.setLoading(!1)}}})).actions(e=>({afterAttach(){(async()=>{try{e.cachedFileLocation&&e.selectedAssemblyName&&(e.setFileSource(e.cachedFileLocation),await e.import(e.selectedAssemblyName))}catch(t){console.error(t),(0,k.getSession)(e).notifyError(`${t}`,t)}})()}}));return c.types.compose(jn.A,c.types.model("SpreadsheetView",{type:c.types.literal("SpreadsheetView"),offsetPx:0,height:c.types.optional(c.types.number,440),hideVerticalResizeHandle:!1,hideFilterControls:!1,importWizard:c.types.optional(e,()=>e.create()),spreadsheet:c.types.maybe(c.types.model("Spreadsheet",{rowSet:c.types.frozen(),columns:c.types.frozen(),assemblyName:c.types.maybe(c.types.string),visibleColumns:c.types.frozen()}).volatile(()=>({visibleRowFlags:void 0})).views(e=>({get rows(){return e.rowSet?.rows.map((t,n)=>({id:n,feature:t.feature,...Object.fromEntries(e.columns.map((e,n)=>[e.name,t.cellData?.[e.name]??t.cells?.[n]?.text]))}))},get initialized(){const t=(0,k.getSession)(e),n=e.assemblyName;return e.rowSet&&!!n&&t.assemblyManager.get(n)?.initialized}})).views(e=>({get dataGridColumns(){const{rows:t}=e;return t?[{field:"Location",width:(0,k.measureGridWidth)(t.map(e=>e.feature?(0,k.assembleLocStringFast)(e.feature):0))+40,renderCell:({row:t})=>{const{feature:n}=t;return n?(0,te.jsx)(ms,{model:e,feature:n}):"N/A"}},{field:"Length",type:"number",width:(0,k.measureGridWidth)(t.map(e=>{const{feature:t}=e;return t?t.end-t.start:0})),valueGetter:(e,t)=>{const{feature:n}=t;return n?n.end-n.start:void 0},valueFormatter:e=>(0,k.toLocale)(e)},...e.columns.map(e=>({field:e.name,width:(0,k.measureGridWidth)([...t.map(t=>t[e.name]),e.name],{minWidth:20}),type:"number"==typeof t[0][e.name]?"number":void 0}))]:void 0}})).views(e=>({get visibleRows(){const{visibleRowFlags:t}=e;return t?e.rows?.filter((e,n)=>!1!==t[n]):e.rows}})).actions(e=>({setVisibleRows(t){e.visibleRowFlags=t},setVisibleColumns(t){e.visibleColumns=t}})).preProcessSnapshot(e=>e?{...e,columns:e.columns.filter(e=>!e.isDerived),rowSet:e.rowSet?{...e.rowSet,rows:e.rowSet.rows.map(e=>({...e,feature:e.feature??e.extendedData?.vcfFeature}))}:void 0}:e)),init:c.types.frozen()}).volatile(()=>({width:400,rowMenuItems:[]})).views(e=>({get assembly(){const t=e.spreadsheet?.assemblyName;return t?(0,k.getSession)(e).assemblyManager.get(t)?.configuration:void 0}})).actions(e=>({setRowMenuItems(t){e.rowMenuItems=t},setWidth:t=>(e.width=t,e.width),setHeight:t=>(e.height=Math.max(t,40),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},resizeWidth(t){const n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet(t){e.spreadsheet=(0,c.cast)(t)},setInit(t){e.init=t}})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(async function(){const{init:t,width:n}=e;if(!n||!t)return;const r=(0,k.getSession)(e);try{const n=t.uri.split(".");let r=n.pop()?.toUpperCase();"GZ"===r&&(r=n.pop()?.toUpperCase()),e.importWizard.setFileType(t.fileType||r||""),e.importWizard.setSelectedAssemblyName(t.assembly),e.importWizard.setFileSource({uri:t.uri,locationType:"UriLocation"}),await e.importWizard.import(t.assembly)}catch(e){console.error(e),r.notifyError(`${e}`,e)}finally{e.setInit(void 0)}},{name:"SpreadsheetViewInit"}))}})).views(e=>({menuItems:()=>[{label:"Return to import form",icon:ia.A,onClick:()=>{e.displaySpreadsheet(void 0)}}]}))).postProcessSnapshot(e=>{const{init:t,importWizard:n,spreadsheet:r,...a}=e;if(n.cachedFileLocation&&r){const{rowSet:e,...t}=r;return{...a,importWizard:n,spreadsheet:t}}if(r){const{rowSet:e,...t}=r;return e&&JSON.stringify(e).length>1e6?{...a,importWizard:n,spreadsheet:t}:{...a,importWizard:n,spreadsheet:r}}return{...a,importWizard:n}})}class bs extends r.A{name="SpreadsheetViewPlugin";install(e){!function(e){e.addViewType(()=>new zn.A({name:"SpreadsheetView",displayName:"Spreadsheet view",stateModel:ys(),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(231)]).then(n.bind(n,59437)))}))}(e),function(e){e.addToExtensionPoint("LaunchView-SpreadsheetView",async({session:e,assembly:t,uri:n,fileType:r})=>{e.addView("SpreadsheetView",{init:{assembly:t,uri:n,fileType:r}})})}(e)}configure(e){const{rootModel:t}=e;(0,U.Nh)(t)&&t.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:is.A,onClick:e=>{e.addView("SpreadsheetView",{})}})}}var ws=n(7461);const vs=(0,a.lazy)(()=>Promise.all([n.e(208),n.e(6740),n.e(7648)]).then(n.bind(n,96995)));function Ss(e,t){const n=(0,k.getSession)(t);try{n.setSelection(e);const r=(0,k.getContainingView)(t),a=`${(0,c.getParent)(r).id}_spawned`,i=r.assemblyNames[0];n.queueDialog(t=>[vs,{handleClose:t,session:n,feature:e,stableViewId:a,assemblyName:i}])}catch(e){console.error(e),n.notifyError(`${e}`,e)}}class xs extends r.A{name="SvInspectorViewPlugin";install(e){!function(e){e.jexl.addFunction("defaultOnChordClick",Ss),e.addViewType(()=>{const t=function(e){const t=e.getViewType("SpreadsheetView"),n=e.getViewType("CircularView"),r=t.stateModel,a=n.stateModel;return c.types.compose("SvInspectorView",jn.A,c.types.model({id:Rn.K,type:c.types.literal("SvInspectorView"),height:c.types.optional(c.types.number,550),onlyDisplayRelevantRegionsInCircularView:!1,spreadsheetView:c.types.optional(r,()=>r.create({type:"SpreadsheetView",hideVerticalResizeHandle:!0})),circularView:c.types.optional(a,()=>a.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})),init:c.types.frozen()})).volatile(()=>({width:800,SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:n.ReactComponent,circularViewOptionsBarHeight:52})).views(e=>({get assemblyName(){const{assembly:t}=e.spreadsheetView;return t?(0,L.QZ)(t,"name"):void 0},get showCircularView(){return!!e.spreadsheetView.spreadsheet?.rowSet},get features(){return structuredClone(e.spreadsheetView.spreadsheet?.visibleRows)?.map(e=>e.feature).filter(e=>!!e)||[]},get featuresAdapterConfigSnapshot(){return{type:"FromConfigAdapter",features:this.features}},get featureRefNames(){return[...new Set([...this.features.map(e=>e.refName),...this.features.flatMap(e=>e.INFO?.CHR2),...this.features.flatMap(e=>e.mate?.refName)].filter(e=>!!e))]},get currentAssembly(){const{assemblyManager:t}=(0,k.getSession)(e);return this.assemblyName?t.get(this.assemblyName):void 0},get canonicalFeatureRefNameSet(){const e=this.currentAssembly;return new Set(e?.initialized?this.featureRefNames.map(t=>e.getCanonicalRefName(t)||t):[])},get featuresCircularTrackConfiguration(){return{type:"VariantTrack",trackId:`sv-inspector-variant-track-${e.id}`,name:"features from tabular data",adapter:this.featuresAdapterConfigSnapshot,assemblyNames:[this.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:`sv-inspector-variant-track-chord-display-${e.id}`,onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}})).actions(e=>({setWidth(t){e.width=t},setHeight:t=>(e.height=Math.max(t,400),e.height),setDisplayedRegions(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView(t){e.onlyDisplayRelevantRegionsInCircularView=t},setInit(t){e.init=t}})).views(e=>({menuItems:()=>[{label:"Return to import form",icon:ia.A,onClick:()=>{e.spreadsheetView.displaySpreadsheet(void 0)}}]})).actions(e=>({resizeHeight(t){const n=e.height;return e.setHeight(e.height+t)-n},afterAttach(){(0,c.addDisposer)(e,(0,N.autorun)(async function(){const{init:t,width:n}=e;if(!n||!t)return;const r=(0,k.getSession)(e);try{const n=t.uri.split(".");let r=n.pop()?.toUpperCase();"GZ"===r&&(r=n.pop()?.toUpperCase()),e.spreadsheetView.importWizard.setFileType(t.fileType||r||""),e.spreadsheetView.importWizard.setSelectedAssemblyName(t.assembly),e.spreadsheetView.importWizard.setFileSource({uri:t.uri,locationType:"UriLocation"}),await e.spreadsheetView.importWizard.import(t.assembly),e.setInit(void 0)}catch(t){console.error(t),r.notifyError(`${t}`,t),e.setInit(void 0)}},{name:"SvInspectorViewInit"})),(0,c.addDisposer)(e,(0,N.autorun)(()=>{if(e.showCircularView){const t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)},{name:"SvInspectorView width binding"})),(0,c.addDisposer)(e,(0,N.autorun)(()=>{e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)},{name:"SvInspectorView height binding"})),(0,c.addDisposer)(e,(0,N.autorun)(async()=>{const{onlyDisplayRelevantRegionsInCircularView:t,circularView:n,canonicalFeatureRefNameSet:r,currentAssembly:a}=e;if(n.initialized&&a?.regions)if(t){if(1===n.tracks.length)try{n.setDisplayedRegions(structuredClone(a.regions.filter(e=>r.has(e.refName))))}catch(t){console.error(t),(0,k.getSession)(e).notifyError(`${t}`,t)}}else n.setDisplayedRegions(a.regions)},{name:"SvInspectorView displayed regions bind"})),(0,c.addDisposer)(e,(0,N.reaction)(()=>({generatedTrackConf:e.featuresCircularTrackConfiguration,assemblyName:e.assemblyName}),t=>{if(!t)return;const{assemblyName:n,generatedTrackConf:r}=t,{circularView:a}=e;for(const e of a.tracks)a.hideTrack(e.configuration.trackId);n&&a.addTrackConf(r,{assemblyName:n})},{name:"SvInspectorView track configuration binding",fireImmediately:!0}))}})).postProcessSnapshot(e=>{const{init:t,circularView:n,...r}=e;return r})}(e);return new zn.A({name:"SvInspectorView",displayName:"SV inspector",stateModel:t,ReactComponent:(0,a.lazy)(()=>n.e(5932).then(n.bind(n,55932)))})})}(e),function(e){e.addToExtensionPoint("LaunchView-SvInspectorView",async({session:e,assembly:t,uri:n,fileType:r})=>{e.addView("SvInspectorView",{init:{assembly:t,uri:n,fileType:r}})})}(e)}configure(e){(0,U.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:ws.A,onClick:e=>{e.addView("SvInspectorView",{})}})}}const ks=(0,o.S7)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"}},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"}},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"}},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId",preProcessSnapshot:e=>e.uri?{...e,ixFilePath:{uri:e.uri,baseUri:e.baseUri},ixxFilePath:{uri:`${e.uri}x`,baseUri:e.baseUri}}:e});class Cs extends r.A{name="TrixPlugin";install(e){e.addTextSearchAdapterType(()=>new ro.A({name:"TrixTextSearchAdapter",displayName:"Trix text search adapter",configSchema:ks,description:"Trix text search adapter",getAdapterClass:()=>n.e(9258).then(n.bind(n,29258)).then(e=>e.default)}))}}var Ts=n(69073);const As=e=>c.types.compose("ChordVariantDisplay",R.q,c.types.model({type:c.types.literal("ChordVariantDisplay"),bezierRadiusRatio:.1,assemblyName:c.types.maybe(c.types.string),configuration:(0,o.AK)(e)})).volatile(()=>({filled:!1,reactElement:void 0,data:void 0,html:void 0,message:"",renderingComponent:void 0,refNameMap:void 0})).actions(e=>{const{pluginManager:t}=(0,k.getEnv)(e),n=e;return{onChordClick(r){(0,L.FI)(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}}).views(e=>({get blockDefinitions(){const t=(0,k.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;const n=structuredClone(t);for(const t of n){const n=t.region.elided?t.region.regions:[t.region];for(const t of n){const n=e.refNameMap[t.refName];n&&t.refName!==n&&(t.refName=n)}}return n},get rendererTypeName(){return e.configuration.renderer.type},get rendererType(){return(0,k.getEnv)(e).pluginManager.getRendererType(this.rendererTypeName)},get selectedFeatureId(){if(!(0,c.isAlive)(e))return;const{selection:t}=(0,k.getSession)(e);return(0,q.l)(t)?t.id():void 0},renderProps(){const t=(0,k.getContainingView)(e);return{...(0,C.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,config:e.configuration.renderer,onChordClick:e.onChordClick}},renderingProps:()=>({displayModel:e,onChordClick:t=>{e.onChordClick(t)}})})).actions(e=>({renderStarted(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess({message:t,data:n,reactElement:r,html:a,renderingComponent:i}){t?(e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=r,e.data=n,e.html=a,e.error=void 0,e.renderingComponent=i)},renderError(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.html=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap(t){e.refNameMap=t}})).actions(e=>({afterAttach(){(0,Ha.I)(e,Ts.I,Ts.$,{name:`${e.type} ${e.id} rendering`,fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,Ha.I)(e,()=>({assemblyNames:(0,C.getTrackAssemblyNames)(e.parentTrack),adapter:(0,L.FI)((0,c.getParent)(e,2),"adapter"),assemblyManager:(0,k.getSession)(e).assemblyManager}),async(t,n)=>t?t.assemblyManager.getRefNameMapForAdapter(t.adapter,t.assemblyNames[0],{stopToken:n,sessionId:(0,C.getRpcSessionId)(e)}):void 0,{name:`${e.type} ${e.id} getting refNames`,fireImmediately:!0},()=>{},t=>{t&&e.setRefNameMap(t)},t=>{console.error(t),e.setError(t)})}})).views(e=>({async renderSvg(t){const{renderSvg:r}=await n.e(8925).then(n.bind(n,91306));return r(e,t)}}));function Ms(){return(0,o.S7)("SharedLDDisplay",{minorAlleleFrequencyFilter:{type:"number",defaultValue:.1},lengthCutoffFilter:{type:"number",defaultValue:Number.MAX_SAFE_INTEGER},lineZoneHeight:{type:"number",defaultValue:100},ldMetric:{type:"stringEnum",model:c.types.enumeration("LDMetric",["r2","dprime"]),defaultValue:"r2"},colorScheme:{type:"string",defaultValue:""},showLegend:{type:"boolean",defaultValue:!1},showLDTriangle:{type:"boolean",defaultValue:!0},showRecombination:{type:"boolean",defaultValue:!1},recombinationZoneHeight:{type:"number",defaultValue:50},fitToHeight:{type:"boolean",defaultValue:!1},hweFilterThreshold:{type:"number",defaultValue:0},callRateFilter:{type:"number",defaultValue:0},showVerticalGuides:{type:"boolean",defaultValue:!0},showLabels:{type:"boolean",defaultValue:!1},tickHeight:{type:"number",defaultValue:6},useGenomicPositions:{type:"boolean",defaultValue:!1},signedLD:{type:"boolean",defaultValue:!1},jexlFilters:{type:"stringArray",defaultValue:[]}},{baseConfiguration:P.A,explicitlyTyped:!0})}const Is=(0,o.S7)("LDRenderer",{maxHeight:{type:"integer",description:"the maximum height to be used in LD rendering",defaultValue:600}},{explicitlyTyped:!0});var Ps=n(2908),Ls=n(43754),Rs=n(75281),Fs=n(78921),Ds=n(50879);function Ns(e){const t=(0,Wt.c)(59),{model:n,handleClose:r}=e,{minorAlleleFrequencyFilter:i,hweFilterThreshold:o,callRateFilter:s,filterStats:l}=n,[c,d]=(0,a.useState)(`${i}`),[u,p]=(0,a.useState)(o>0),[h,g]=(0,a.useState)(o>0?`${o}`:"0.001"),[f,m]=(0,a.useState)(s>0),[y,b]=(0,a.useState)(s>0?`${s}`:"0.95"),[w,v]=(0,a.useState)(),[S,x]=(0,a.useState)(),[k,C]=(0,a.useState)();let T;t[0]===Symbol.for("react.memo_cache_sentinel")?(T=e=>{const t=Number.parseFloat(e);return Number.isNaN(t)?(v("Please enter a valid number"),!1):t<0||t>.5?(v("MAF must be between 0 and 0.5"),!1):(v(void 0),!0)},t[0]=T):T=t[0];const A=T;let M;t[1]===Symbol.for("react.memo_cache_sentinel")?(M=e=>{const t=Number.parseFloat(e);return Number.isNaN(t)?(x("Please enter a valid number"),!1):t<=0||t>1?(x("P-value must be between 0 and 1"),!1):(x(void 0),!0)},t[1]=M):M=t[1];const I=M;let P;t[2]===Symbol.for("react.memo_cache_sentinel")?(P=e=>{const t=Number.parseFloat(e);return Number.isNaN(t)?(C("Please enter a valid number"),!1):t<0||t>1?(C("Call rate must be between 0 and 1"),!1):(C(void 0),!0)},t[2]=P):P=t[2];const L=P,R=!!w||u&&!!S||f&&!!k;let F,D,N,B;t[3]===Symbol.for("react.memo_cache_sentinel")?(F={width:500},t[3]=F):F=t[3],t[4]!==l?(D=l?(0,te.jsxs)(Ls.A,{severity:"info",style:{marginBottom:16},children:[(0,te.jsx)(Y.A,{variant:"subtitle2",gutterBottom:!0,children:"Filter Statistics"}),(0,te.jsxs)(Rs.A,{component:"ul",sx:{margin:0,paddingLeft:2},children:[(0,te.jsxs)("li",{children:["Total variants in region: ",l.totalVariants]}),(0,te.jsxs)("li",{children:["Passed all filters: ",l.passedVariants]}),l.filteredByMaf>0&&(0,te.jsxs)("li",{children:["Filtered by MAF: ",l.filteredByMaf]}),l.filteredByLength>0&&(0,te.jsxs)("li",{children:["Filtered by length: ",l.filteredByLength]}),l.filteredByMultiallelic>0&&(0,te.jsxs)("li",{children:["Filtered by multiallelic: ",l.filteredByMultiallelic]}),l.filteredByHwe>0&&(0,te.jsxs)("li",{children:["Filtered by HWE: ",l.filteredByHwe]}),l.filteredByCallRate>0&&(0,te.jsxs)("li",{children:["Filtered by call rate: ",l.filteredByCallRate]})]})]}):null,t[4]=l,t[5]=D):D=t[5],t[6]===Symbol.for("react.memo_cache_sentinel")?(N=(0,te.jsx)(Y.A,{variant:"subtitle1",gutterBottom:!0,children:"Minor Allele Frequency (MAF) Filter"}),B=(0,te.jsx)(Y.A,{variant:"body2",color:"textSecondary",component:"p",children:"Exclude variants with minor allele frequency below this threshold."}),t[6]=N,t[7]=B):(N=t[6],B=t[7]);const V=!!w;let E,z,j,H,_,$,O,G,W,U,q,J,X,K,Q,Z,ee,ne,re;return t[8]===Symbol.for("react.memo_cache_sentinel")?(z=e=>{const t=e.target.value;d(t),A(t)},E={marginBottom:24},t[8]=E,t[9]=z):(E=t[8],z=t[9]),t[10]!==c||t[11]!==w||t[12]!==V?(j=(0,te.jsx)(ln.A,{value:c,fullWidth:!0,size:"small",label:"MAF threshold (0-0.5)",error:V,helperText:w,onChange:z,style:E}),t[10]=c,t[11]=w,t[12]=V,t[13]=j):j=t[13],t[14]===Symbol.for("react.memo_cache_sentinel")?(H=(0,te.jsx)(Y.A,{variant:"subtitle1",gutterBottom:!0,children:"Hardy-Weinberg Equilibrium (HWE) Filter"}),_=(0,te.jsx)(Y.A,{variant:"body2",color:"textSecondary",component:"p",children:"Exclude variants that deviate significantly from HWE, which may indicate genotyping errors or population stratification. This follows Haploview's approach."}),t[14]=H,t[15]=_):(H=t[14],_=t[15]),t[16]===Symbol.for("react.memo_cache_sentinel")?($=e=>{p(e.target.checked)},t[16]=$):$=t[16],t[17]!==u?(O=(0,te.jsx)(Fs.A,{control:(0,te.jsx)(Ds.A,{checked:u,onChange:$}),label:"Enable HWE filter"}),t[17]=u,t[18]=O):O=t[18],t[19]!==u||t[20]!==S||t[21]!==h?(G=u?(0,te.jsx)(ln.A,{value:h,fullWidth:!0,size:"small",label:"P-value threshold",error:!!S,helperText:S||"Variants with HWE p-value below this threshold are excluded (default: 0.001)",onChange:e=>{const t=e.target.value;g(t),I(t)},style:{marginTop:8,marginBottom:24}}):(0,te.jsx)("div",{style:{marginBottom:24}}),t[19]=u,t[20]=S,t[21]=h,t[22]=G):G=t[22],t[23]===Symbol.for("react.memo_cache_sentinel")?(W=(0,te.jsx)(Y.A,{variant:"subtitle1",gutterBottom:!0,children:"Call Rate Filter"}),U=(0,te.jsx)(Y.A,{variant:"body2",color:"textSecondary",component:"p",children:"Exclude variants with too many missing genotypes. Call rate is the proportion of samples with non-missing genotype calls."}),t[23]=W,t[24]=U):(W=t[23],U=t[24]),t[25]===Symbol.for("react.memo_cache_sentinel")?(q=e=>{m(e.target.checked)},t[25]=q):q=t[25],t[26]!==f?(J=(0,te.jsx)(Fs.A,{control:(0,te.jsx)(Ds.A,{checked:f,onChange:q}),label:"Enable call rate filter"}),t[26]=f,t[27]=J):J=t[27],t[28]!==y||t[29]!==f||t[30]!==k?(X=f?(0,te.jsx)(ln.A,{value:y,fullWidth:!0,size:"small",label:"Minimum call rate (0-1)",error:!!k,helperText:k||"Variants with call rate below this threshold are excluded (default: 0.95 = 95%)",onChange:e=>{const t=e.target.value;b(t),L(t)},style:{marginTop:8}}):null,t[28]=y,t[29]=f,t[30]=k,t[31]=X):X=t[31],t[32]!==j||t[33]!==O||t[34]!==G||t[35]!==J||t[36]!==X||t[37]!==D?(K=(0,te.jsxs)(sn.A,{style:F,children:[D,N,B,j,H,_,O,G,W,U,J,X]}),t[32]=j,t[33]=O,t[34]=G,t[35]=J,t[36]=X,t[37]=D,t[38]=K):K=t[38],t[39]!==r?(Q=(0,te.jsx)(cn.A,{onClick:r,color:"primary",children:"Cancel"}),t[39]=r,t[40]=Q):Q=t[40],t[41]!==y||t[42]!==f||t[43]!==r||t[44]!==u||t[45]!==h||t[46]!==c||t[47]!==n?(Z=()=>{const e=Number.parseFloat(c);if(!Number.isNaN(e)&&e>=0&&e<=.5&&n.setMafFilter(e),u){const e=Number.parseFloat(h);!Number.isNaN(e)&&e>0&&e<=1&&n.setHweFilter(e)}else n.setHweFilter(0);if(f){const e=Number.parseFloat(y);!Number.isNaN(e)&&e>=0&&e<=1&&n.setCallRateFilter(e)}else n.setCallRateFilter(0);r()},t[41]=y,t[42]=f,t[43]=r,t[44]=u,t[45]=h,t[46]=c,t[47]=n,t[48]=Z):Z=t[48],t[49]!==R||t[50]!==Z?(ee=(0,te.jsx)(cn.A,{onClick:Z,color:"primary",variant:"contained",disabled:R,children:"Apply"}),t[49]=R,t[50]=Z,t[51]=ee):ee=t[51],t[52]!==Q||t[53]!==ee?(ne=(0,te.jsxs)(dn.A,{children:[Q,ee]}),t[52]=Q,t[53]=ee,t[54]=ne):ne=t[54],t[55]!==r||t[56]!==K||t[57]!==ne?(re=(0,te.jsxs)(on.A,{open:!0,onClose:r,title:"LD Filter Settings",children:[K,ne]}),t[55]=r,t[56]=K,t[57]=ne,t[58]=re):re=t[58],re}function Bs(e){return c.types.compose("SharedLDModel",R.q,(0,ze.A)(),_e(),c.types.model({configuration:(0,o.AK)(e),minorAlleleFrequencyFilterSetting:c.types.maybe(c.types.number),lengthCutoffFilterSetting:c.types.maybe(c.types.number),lineZoneHeightSetting:c.types.maybe(c.types.number),ldMetricSetting:c.types.maybe(c.types.string),colorSchemeSetting:c.types.maybe(c.types.string),showLegendSetting:c.types.maybe(c.types.boolean),showLDTriangleSetting:c.types.maybe(c.types.boolean),showRecombinationSetting:c.types.maybe(c.types.boolean),recombinationZoneHeightSetting:c.types.maybe(c.types.number),fitToHeightSetting:c.types.maybe(c.types.boolean),hweFilterThresholdSetting:c.types.maybe(c.types.number),callRateFilterSetting:c.types.maybe(c.types.number),showVerticalGuidesSetting:c.types.maybe(c.types.boolean),showLabelsSetting:c.types.maybe(c.types.boolean),tickHeightSetting:c.types.maybe(c.types.number),useGenomicPositionsSetting:c.types.maybe(c.types.boolean),signedLDSetting:c.types.maybe(c.types.boolean),jexlFiltersSetting:c.types.maybe(c.types.array(c.types.string))})).volatile(()=>({flatbush:void 0,flatbushItems:[],snps:[],maxScore:1,yScalar:1,cellWidth:0,error:void 0,filterStats:void 0,recombination:void 0})).actions(e=>({setFlatbushData(t,n,r,a,i,o){e.flatbush=t,e.flatbushItems=n,e.snps=r,e.maxScore=a,e.yScalar=i,e.cellWidth=o},setLineZoneHeight(t){e.lineZoneHeightSetting=Math.max(0,t)},setError(t){e.error=t},reload(){e.error=void 0},setMafFilter(t){e.minorAlleleFrequencyFilterSetting=t},setLengthCutoffFilter(t){e.lengthCutoffFilterSetting=t},setLDMetric(t){e.ldMetricSetting=t},setColorScheme(t){e.colorSchemeSetting=t},setShowLegend(t){e.showLegendSetting=t},setShowLDTriangle(t){e.showLDTriangleSetting=t},setShowRecombination(t){e.showRecombinationSetting=t},setRecombinationZoneHeight(t){e.recombinationZoneHeightSetting=Math.max(20,t)},setFitToHeight(t){e.fitToHeightSetting=t},setHweFilter(t){e.hweFilterThresholdSetting=t},setCallRateFilter(t){e.callRateFilterSetting=t},setFilterStats(t){e.filterStats=t},setRecombination(t){e.recombination=t},setShowVerticalGuides(t){e.showVerticalGuidesSetting=t},setShowLabels(t){e.showLabelsSetting=t},setTickHeight(t){e.tickHeightSetting=Math.max(0,t)},setUseGenomicPositions(t){e.useGenomicPositionsSetting=t},setSignedLD(t){e.signedLDSetting=t},setJexlFilters(t){e.jexlFiltersSetting=(0,c.cast)(t)}})).views(e=>({get blockType(){return"dynamicBlocks"},get prefersOffset(){return!0},get rendererTypeName(){return"LDRenderer"},get rendererConfig(){return(0,L.FI)(e,"renderer")},get regionTooLarge(){return!1},get minorAlleleFrequencyFilter(){return e.minorAlleleFrequencyFilterSetting??(0,L.FI)(e,"minorAlleleFrequencyFilter")},get lengthCutoffFilter(){return e.lengthCutoffFilterSetting??(0,L.FI)(e,"lengthCutoffFilter")},get lineZoneHeight(){return e.lineZoneHeightSetting??(0,L.FI)(e,"lineZoneHeight")},get ldMetric(){return e.ldMetricSetting??(0,L.FI)(e,"ldMetric")},get colorScheme(){const t=e.colorSchemeSetting;return void 0!==t?t||void 0:(0,L.FI)(e,"colorScheme")||void 0},get showLegend(){return e.showLegendSetting??(0,L.FI)(e,"showLegend")},get showLDTriangle(){return e.showLDTriangleSetting??(0,L.FI)(e,"showLDTriangle")},get showRecombination(){return e.showRecombinationSetting??(0,L.FI)(e,"showRecombination")},get recombinationZoneHeight(){return e.recombinationZoneHeightSetting??(0,L.FI)(e,"recombinationZoneHeight")},get fitToHeight(){return e.fitToHeightSetting??(0,L.FI)(e,"fitToHeight")},get hweFilterThreshold(){return e.hweFilterThresholdSetting??(0,L.FI)(e,"hweFilterThreshold")},get callRateFilter(){return e.callRateFilterSetting??(0,L.FI)(e,"callRateFilter")},get showVerticalGuides(){return e.showVerticalGuidesSetting??(0,L.FI)(e,"showVerticalGuides")},get showLabels(){return e.showLabelsSetting??(0,L.FI)(e,"showLabels")},get tickHeight(){return e.tickHeightSetting??(0,L.FI)(e,"tickHeight")},get useGenomicPositions(){return e.useGenomicPositionsSetting??(0,L.FI)(e,"useGenomicPositions")},get signedLD(){return e.signedLDSetting??(0,L.FI)(e,"signedLD")},get jexlFilters(){return e.jexlFiltersSetting??(0,L.FI)(e,"jexlFilters")},get isPrecomputedLD(){const t=e.adapterConfig?.type;return"PlinkLDAdapter"===t||"PlinkLDTabixAdapter"===t||"LdmatAdapter"===t},regionCannotBeRendered:()=>null})).views(e=>({get ldCanvasHeight(){return Math.max(50,e.height-e.lineZoneHeight)}})).views(e=>{const{renderProps:t}=e;return{filterMenuItems:()=>e.isPrecomputedLD?[]:[{label:"LD-specific filters...",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Ns,{model:e,handleClose:t}])}},{label:"General JEXL filters...",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Ps.default,{model:e,handleClose:t}])}}],renderProps:()=>({...t(),config:e.rendererConfig,...e.fitToHeight?{displayHeight:e.ldCanvasHeight}:{},minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,lengthCutoffFilter:e.lengthCutoffFilter,hweFilterThreshold:e.hweFilterThreshold,callRateFilter:e.callRateFilter,jexlFilters:e.jexlFilters,ldMetric:e.ldMetric,colorScheme:e.colorScheme,fitToHeight:e.fitToHeight,useGenomicPositions:e.useGenomicPositions,signedLD:e.signedLD})}}).views(e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"LD metric",type:"subMenu",subMenu:[{label:"R (squared correlation)",type:"radio",checked:"r2"===e.ldMetric,onClick:()=>{e.setLDMetric("r2")}},{label:"D' (normalized D)",type:"radio",checked:"dprime"===e.ldMetric,onClick:()=>{e.setLDMetric("dprime")}}]},{label:"Show...",type:"subMenu",subMenu:[{label:"Show LD triangle",type:"checkbox",checked:e.showLDTriangle,onClick:()=>{e.setShowLDTriangle(!e.showLDTriangle)}},{label:"Show recombination track",helpText:"Displays 1-r between neighboring SNPs only (not all pairwise comparisons). Peaks indicate haplotype block boundaries where historical recombination has broken down LD between adjacent variants.",type:"checkbox",checked:e.showRecombination,onClick:()=>{e.setShowRecombination(!e.showRecombination)}},{label:"Show legend",type:"checkbox",checked:e.showLegend,onClick:()=>{e.setShowLegend(!e.showLegend)}},{label:"LD triangle adjusted to display height",type:"checkbox",checked:e.fitToHeight,onClick:()=>{e.setFitToHeight(!e.fitToHeight)}},{label:"Vertical guides on hover",type:"checkbox",checked:e.showVerticalGuides,onClick:()=>{e.setShowVerticalGuides(!e.showVerticalGuides)}},{label:"Variant labels",type:"checkbox",checked:e.showLabels,onClick:()=>{e.setShowLabels(!e.showLabels)}},{label:"Use genomic positions for cell sizes",type:"checkbox",checked:e.useGenomicPositions,onClick:()=>{e.setUseGenomicPositions(!e.useGenomicPositions)}},...e.isPrecomputedLD?[]:[{label:"Show signed LD values (-1 to 1)",helpText:"When enabled, shows R (correlation) instead of R, and preserves the sign of D'. Positive values indicate alleles tend to co-occur (coupling), negative values indicate alleles tend to be on different haplotypes (repulsion).",type:"checkbox",checked:e.signedLD,onClick:()=>{e.setSignedLD(!e.signedLD)}}]]},...e.isPrecomputedLD?[]:[{label:"Filter by...",type:"subMenu",subMenu:e.filterMenuItems()}]],async renderSvg(t){const{renderSvg:r}=await Promise.all([n.e(8080),n.e(6386)]).then(n.bind(n,66386));return r(e,t)}}}).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(9427).then(n.bind(n,19427));t(e)}catch(t){console.error(t),(0,k.getSession)(e).notifyError(`${t}`,t)}})()}})).postProcessSnapshot(e=>{if(!e)return e;const{minorAlleleFrequencyFilterSetting:t,lengthCutoffFilterSetting:n,lineZoneHeightSetting:r,ldMetricSetting:a,colorSchemeSetting:i,showLegendSetting:o,showLDTriangleSetting:s,showRecombinationSetting:l,recombinationZoneHeightSetting:c,fitToHeightSetting:d,hweFilterThresholdSetting:u,callRateFilterSetting:p,showVerticalGuidesSetting:h,showLabelsSetting:g,tickHeightSetting:f,useGenomicPositionsSetting:m,signedLDSetting:y,jexlFiltersSetting:b,...w}=e;return{...w,...void 0!==t&&.1!==t?{minorAlleleFrequencyFilterSetting:t}:{},...void 0!==n&&n!==Number.MAX_SAFE_INTEGER?{lengthCutoffFilterSetting:n}:{},...void 0!==r&&100!==r?{lineZoneHeightSetting:r}:{},...void 0!==a&&"r2"!==a?{ldMetricSetting:a}:{},...void 0!==i&&""!==i?{colorSchemeSetting:i}:{},...void 0!==o&&o?{showLegendSetting:o}:{},...void 0===s||s?{}:{showLDTriangleSetting:s},...void 0!==l&&l?{showRecombinationSetting:l}:{},...void 0!==c&&50!==c?{recombinationZoneHeightSetting:c}:{},...void 0!==d&&d?{fitToHeightSetting:d}:{},...void 0!==u&&.001!==u?{hweFilterThresholdSetting:u}:{},...void 0!==p&&0!==p?{callRateFilterSetting:p}:{},...void 0===h||h?{}:{showVerticalGuidesSetting:h},...void 0!==g&&g?{showLabelsSetting:g}:{},...void 0!==f&&6!==f?{tickHeightSetting:f}:{},...void 0!==m&&m?{useGenomicPositionsSetting:m}:{},...void 0!==y&&y?{signedLDSetting:y}:{},...b?.length?{jexlFiltersSetting:b}:{}}})}function Vs(e){return Bs(e).named("LDDisplay").props({type:c.types.literal("LDDisplay")})}function Es(e){return Bs(e).named("LDTrackDisplay").props({type:c.types.literal("LDTrackDisplay")})}const zs=(0,a.lazy)(()=>Promise.all([n.e(8080),n.e(8519)]).then(n.bind(n,88519)));var js=n(44732);const Hs=/[/|]/;function _s(e,t,n,r){const a=1-t,i=1-n;if(e>0){const r=Math.min(t*i,a*n);if(r>0)return Math.min(1,e/r)}else if(e<0){const o=Math.min(t*n,a*i);if(o>0)return r?Math.max(-1,e/o):Math.min(1,Math.abs(e)/o)}return 0}function $s(e,t,n){const r=new Int8Array(t.length);for(const[a,i]of t.entries()){const t=e[i],o=n[t]??(n[t]=t.split(Hs));let s=0,l=0;for(const e of o)"."===e?l++:"0"!==e&&s++;l===o.length?r[a]=-1:0===s?r[a]=0:s===o.length?r[a]=2:r[a]=1}return r}function Os(e,t){const n=new Int8Array(t.length),r=new Int8Array(t.length);for(const[a,i]of t.entries()){const t=e[i].split("|");2===t.length?("."===t[0]?n[a]=-1:n[a]="0"===t[0]?0:1,"."===t[1]?r[a]=-1:r[a]="0"===t[1]?0:1):(n[a]=-1,r[a]=-1)}return{hap1:n,hap2:r}}function Gs(e,t,n=!1){let r=0,a=0,i=0,o=0;const s=e.hap1.length;for(let n=0;n<s;n++){const s=e.hap1[n],l=t.hap1[n];s>=0&&l>=0&&(0===s&&1===l?r++:1===s&&0===l?a++:1===s&&1===l&&i++,o++)}for(let n=0;n<s;n++){const s=e.hap2[n],l=t.hap2[n];s>=0&&l>=0&&(0===s&&1===l?r++:1===s&&0===l?a++:1===s&&1===l&&i++,o++)}if(o<4)return{r2:0,dprime:0};const l=i/o,c=a/o+l,d=r/o+l;if(c<=0||c>=1||d<=0||d>=1)return{r2:0,dprime:0};const u=l-c*d,p=c*(1-c)*d*(1-d),h=p>0?u/Math.sqrt(p):0,g=Math.min(1,Math.max(0,h*h));return{r2:n?h:g,dprime:_s(u,c,d,n)}}function Ws(e,t,n=!1){let r=0,a=0,i=0,o=0,s=0,l=0;for(const[n,c]of e.entries()){const e=c,d=t[n];e>=0&&d>=0&&(r++,a+=e,i+=d,o+=e*e,s+=d*d,l+=e*d)}if(r<2)return{r2:0,dprime:0};const c=a/(2*r),d=i/(2*r);if(c<=0||c>=1||d<=0||d>=1)return{r2:0,dprime:0};const u=a/r,p=i/r,h=o/r-u*u,g=s/r-p*p;let f=0,m=0;return h>0&&g>0&&(f=(l/r-u*p)/Math.sqrt(h*g),m=Math.min(1,Math.max(0,f*f))),{r2:n?f:m,dprime:_s((l/r-u*p)/2,c,d,n)}}class Us extends ai.default{supportsSVG=!0;async render(e){const{displayHeight:t,regions:r,bpPerPx:a,ldMetric:i="r2",fitToHeight:o=!1,useGenomicPositions:s=!1,signedLD:l=!1}=e;let c=0;for(const e of r)c+=e.end-e.start;const d=c/a,u=d/2,p=o?t??u:u,h=p,g=await this.getLDData(e);if(!g||0===g.snps.length){const t=await(0,Un.u)(d,p,e,e=>{e.fillStyle="#666",e.font="12px sans-serif",e.textAlign="center",e.fillText("No variants in view (try adjusting MAF filter or zooming in)",d/2,p/2)});return(0,mt.lk)({...t,height:p,width:d,ldData:null,filterStats:g?.filterStats},(0,yt.X)(t))}const f=o?h/u:1,{makeImageData:m}=await n.e(3050).then(n.bind(n,23050)),y={...await(0,Un.u)(d,p,e,t=>m(t,{ldData:g,regions:r,bpPerPx:a,stopTokenCheck:e.stopTokenCheck,yScalar:f,useGenomicPositions:s,signedLD:l})),height:p,width:d,yScalar:f,ldMetric:i,signedLD:l,ldData:{snps:g.snps,metric:g.metric,numValues:g.ldValues.length},filterStats:g.filterStats,recombination:{values:Array.from(g.recombination.values),positions:g.recombination.positions}};return(0,mt.lk)(y,(0,yt.X)(y))}async getLDData(e){const{regions:t,sessionId:n,adapterConfig:r,bpPerPx:a,ldMetric:i="r2",minorAlleleFrequencyFilter:o=.01,lengthCutoffFilter:s=Number.MAX_SAFE_INTEGER,hweFilterThreshold:l=.001,callRateFilter:c=0,jexlFilters:d=[],signedLD:u=!1,stopTokenCheck:p}=e;try{const e=r.type;return"PlinkLDAdapter"===e||"PlinkLDTabixAdapter"===e||"LdmatAdapter"===e?await async function({pluginManager:e,args:t}){const{regions:n,adapterConfig:r,sessionId:a,ldMetric:i="r2"}=t,o=(await(0,at.cK)(e,a,r)).dataAdapter,s=[];for(const e of n){const t=await o.getLDRecordsInRegion({refName:e.refName,start:e.start,end:e.end});for(const e of t)s.push(e)}const l=new Map;for(const e of s){const t=`${e.chrA}:${e.bpA}`;l.has(t)||l.set(t,{id:e.snpA,refName:e.chrA,start:e.bpA,end:e.bpA+1});const n=`${e.chrB}:${e.bpB}`;l.has(n)||l.set(n,{id:e.snpB,refName:e.chrB,start:e.bpB,end:e.bpB+1})}const c=[...l.values()].sort((e,t)=>e.refName!==t.refName?e.refName.localeCompare(t.refName):e.start-t.start),d=new Map;for(const[e,t]of c.entries())d.set(`${t.refName}:${t.start}`,e);const u=c.length,p=new Float32Array(u*(u-1)/2);p.fill(Number.NaN);const h=(e,t)=>(e<=t&&([e,t]=[t,e]),e*(e-1)/2+t);for(const e of s){const t=`${e.chrA}:${e.bpA}`,n=`${e.chrB}:${e.bpB}`,r=d.get(t),a=d.get(n);if(void 0!==r&&void 0!==a&&r!==a){const t=h(r,a),n="dprime"===i?e.dprime??e.r2:e.r2;p[t]=n}}for(let e=0;e<p.length;e++)Number.isNaN(p[e])&&(p[e]=0);const g=new Float32Array(Math.max(0,u-1)),f=[];for(let e=0;e<u-1;e++){const t=c[e],n=c[e+1],r=p[h(e+1,e)]??0;g[e]=1-r,f.push((t.start+n.start)/2)}const m={values:g,positions:f};return{snps:c,ldValues:p,metric:i,filterStats:{filteredByCallRate:0,totalVariants:c.length,passedVariants:c.length,filteredByMaf:0,filteredByLength:0,filteredByMultiallelic:0,filteredByHwe:0},recombination:m}}({pluginManager:this.pluginManager,args:{regions:t,sessionId:n,adapterConfig:r,ldMetric:i}}):await async function({pluginManager:e,args:t}){const{minorAlleleFrequencyFilter:n,regions:r,adapterConfig:a,sessionId:i,lengthCutoffFilter:o,hweFilterThreshold:s=.001,callRateFilter:l=0,jexlFilters:c=[],stopTokenCheck:d,ldMetric:u="r2",signedLD:p=!1}=t,h=(await(0,at.cK)(e,i,a)).dataAdapter,g=(await h.getSources(r)).map(e=>e.name);if(0===g.length)return{snps:[],ldValues:new Float32Array(0),metric:u,filterStats:{totalVariants:0,passedVariants:0,filteredByMaf:0,filteredByLength:0,filteredByMultiallelic:0,filteredByHwe:0,filteredByCallRate:0},recombination:{values:new Float32Array(0),positions:[]}};const f={},m=await(0,it._)(h.getFeaturesInMultipleRegions(r,t).pipe((0,ot.$)())),y=m.length,b=(0,js.Cg)({minorAlleleFrequencyFilter:n,lengthCutoffFilter:o,stopTokenCheck:d,splitCache:f,features:m});let w=0,v=0;for(const e of m)if(e.get("end")-e.get("start")>o)w++;else{const t=e.id();b.some(e=>e.feature.id()===t)||v++}let S=b;if(c.length>0){const e=new W.A({filters:c});S=b.filter(({feature:t})=>e.passes(t,void 0,void 0))}const x=[],k=[],C=[];let T=0,A=0,M=0;const I=l>0;let P=!1;S.length>0&&(P=function(e){const t=Object.values(e)[0];return t?.includes("|")??!1}(S[0].feature.get("genotypes")));const L=(R=s)<=0?Number.POSITIVE_INFINITY:R>=1?0:.05===R?3.841:.01===R?6.635:.001===R?10.828:1e-4===R?15.137:-2*Math.log(R);var R;const F=s>0;for(const{feature:e}of S){const t=e.get("ALT");if(t&&t.length>1){T++;continue}const n=e.get("genotypes"),r=$s(n,g,f);let a=0,i=0,o=0,s=0;for(const e of r)0===e?(a++,s++):1===e?(i++,s++):2===e&&(o++,s++);if(I&&s/g.length<l)M++;else{if(F&&s>0){const e=(2*a+i)/(2*s),t=1-e,n=e*e*s,r=2*e*t*s,l=t*t*s;let c=0;if(n>0&&(c+=(a-n)**2/n),r>0&&(c+=(i-r)**2/r),l>0&&(c+=(o-l)**2/l),c>L){A++;continue}}x.push({id:e.get("name")||e.id(),refName:e.get("refName"),start:e.get("start"),end:e.get("end")}),k.push(r),P&&C.push(Os(n,g)),(0,He.As)(d)}}const D=x.length,N=new Float32Array(D*(D-1)/2);let B=0;for(let e=1;e<D;e++){for(let t=0;t<e;t++){const n=P?Gs(C[e],C[t],p):Ws(k[e],k[t],p);N[B++]="dprime"===u?n.dprime:n.r2}(0,He.As)(d)}const V={totalVariants:y,passedVariants:x.length,filteredByMaf:v,filteredByLength:w,filteredByMultiallelic:T,filteredByHwe:A,filteredByCallRate:M},E=new Float32Array(Math.max(0,D-1)),z=[];for(let e=0;e<D-1;e++){let t;t=P?Gs(C[e],C[e+1]).r2:Ws(k[e],k[e+1]).r2,E[e]=1-t;const n=x[e].start,r=x[e+1].start;z.push((n+r)/2)}return{snps:x,ldValues:N,metric:u,filterStats:V,recombination:{values:E,positions:z}}}({pluginManager:this.pluginManager,args:{regions:t,sessionId:n,adapterConfig:r,bpPerPx:a,ldMetric:i,minorAlleleFrequencyFilter:o,lengthCutoffFilter:s,hweFilterThreshold:l,callRateFilter:c,jexlFilters:d,signedLD:u,stopTokenCheck:p}})}catch(e){throw console.error("Error computing LD matrix:",e),e}}}const qs=function(e){return(0,o.S7)("LinearFeatureDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:P.A,explicitlyTyped:!0})};var Js=n(31707);const Xs=(0,a.lazy)(()=>n.e(8158).then(n.bind(n,18158)));function Ks(e){return{label:"Minor allele frequency",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[Xs,{model:e,handleClose:t}])}}}function Qs(e){return c.types.compose("LinearVariantDisplay",(0,Js.A)(e),c.types.model({type:c.types.literal("LinearVariantDisplay"),configuration:(0,o.AK)(e),minorAlleleFrequencyFilterSetting:c.types.maybe(c.types.number)})).views(e=>({get minorAlleleFrequencyFilter(){return e.minorAlleleFrequencyFilterSetting??(0,L.FI)(e,"minorAlleleFrequencyFilter")}})).actions(e=>({setMafFilter(t){e.minorAlleleFrequencyFilterSetting=t}})).views(e=>{const{activeFilters:t,filterMenuItems:n}=e;return{get featureWidgetType(){return{type:"VariantFeatureWidget",id:"variantFeature"}},activeFilters(){const n=[...t()];return e.minorAlleleFrequencyFilter>0&&n.push(`jexl:maf(feature) >= ${e.minorAlleleFrequencyFilter}`),n},filterMenuItems:()=>[...n(),Ks(e)]}}).postProcessSnapshot(e=>{if(!e)return e;const{minorAlleleFrequencyFilterSetting:t,...n}=e;return{...n,...t?{minorAlleleFrequencyFilterSetting:t}:{}}})}var Zs=n(8297),Ys=n(98077),el=n(26821),tl=n(21162),nl=n(1185),rl=n(759),al=n(24154),il=n(11265);function ol(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function sl(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=cl)):void 0===t&&(t=ll);for(var n,r,a,i,o,s=new pl(e),l=[s];n=l.pop();)if((a=t(n.data))&&(o=(a=Array.from(a)).length))for(n.children=a,i=o-1;i>=0;--i)l.push(r=a[i]=new pl(a[i])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(ul)}function ll(e){return e.children}function cl(e){return Array.isArray(e)?e[1]:null}function dl(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function ul(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function pl(e){this.data=e,this.depth=this.height=0,this.parent=null}function hl(e,t){return e.parent===t.parent?1:2}function gl(e,t){return e+t.x}function fl(e,t){return Math.max(e,t.y)}pl.prototype=sl.prototype={constructor:pl,count:function(){return this.eachAfter(ol)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,a,i=this,o=[i],s=[],l=-1;i=o.pop();)if(s.push(i),n=i.children)for(r=0,a=n.length;r<a;++r)o.push(n[r]);for(;i=s.pop();)e.call(t,i,++l,this);return this},eachBefore:function(e,t){for(var n,r,a=this,i=[a],o=-1;a=i.pop();)if(e.call(t,a,++o,this),n=a.children)for(r=n.length-1;r>=0;--r)i.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,a=r&&r.length;--a>=0;)n+=r[a].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),a=null;for(e=n.pop(),t=r.pop();e===t;)a=e,e=n.pop(),t=r.pop();return a}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var a=r.length;e!==n;)r.splice(a,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return sl(this).eachBefore(dl)},[Symbol.iterator]:function*(){var e,t,n,r,a=this,i=[a];do{for(e=i.reverse(),i=[];a=e.pop();)if(yield a,t=a.children)for(n=0,r=t.length;n<r;++n)i.push(t[n])}while(i.length)}};const ml=(0,a.lazy)(()=>Promise.resolve().then(n.bind(n,2908))),yl=(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(6167),n.e(7689),n.e(2650)]).then(n.bind(n,2650))),bl=(0,a.lazy)(()=>n.e(6725).then(n.bind(n,26725))),wl=(0,a.lazy)(()=>n.e(3059).then(n.bind(n,23059)));function vl(e){return c.types.compose("LinearVariantMatrixDisplay",(0,Ys.n)(e),c.types.model({type:c.types.literal("LinearVariantMatrixDisplay"),layout:c.types.optional(c.types.frozen(),[]),configuration:(0,o.AK)(e),minorAlleleFrequencyFilterSetting:c.types.maybe(c.types.number),showSidebarLabelsSetting:c.types.maybe(c.types.boolean),showTreeSetting:c.types.maybe(c.types.boolean),renderingModeSetting:c.types.maybe(c.types.string),rowHeightMode:c.types.optional(c.types.union(c.types.literal("auto"),c.types.number),"auto"),lengthCutoffFilter:c.types.optional(c.types.number,Number.MAX_SAFE_INTEGER),jexlFilters:c.types.maybe(c.types.array(c.types.string)),referenceDrawingModeSetting:c.types.maybe(c.types.string),clusterTree:c.types.maybe(c.types.string),treeAreaWidth:c.types.optional(c.types.number,80),lineZoneHeight:c.types.optional(c.types.number,0),subtreeFilter:c.types.maybe(c.types.array(c.types.string))})).volatile(()=>({sourcesLoadingStopToken:void 0,simplifiedFeaturesStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0,colorByApplied:!1,featuresVolatile:void 0,hasPhased:!1,sampleInfo:void 0,hoveredGenotype:void 0,hoveredTreeNode:void 0,treeCanvas:void 0,mouseoverCanvas:void 0})).views(e=>({get renderingMode(){return e.renderingModeSetting??(0,L.FI)(e,"renderingMode")}})).actions(e=>({setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)},setRowHeight(t){e.rowHeightMode=t},setHoveredGenotype(t){e.hoveredGenotype=t},setHoveredTreeNode(t){e.hoveredTreeNode=t},setTreeCanvasRef(t){e.treeCanvas=t||void 0},setMouseoverCanvasRef(t){e.mouseoverCanvas=t||void 0},setTreeAreaWidth(t){e.treeAreaWidth=t},setFeatures(t){e.featuresVolatile=t},setColorByApplied(t){e.colorByApplied=t},setLayout(t,n=!0){const r=n&&e.clusterTree&&e.layout.length===t.length&&e.layout.some((e,n)=>e.name!==t[n]?.name);e.layout=t,r&&(e.clusterTree=void 0)},clearLayout(){e.layout=[],e.clusterTree=void 0},setClusterTree(t){e.clusterTree=t},setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,He.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setSimplifiedFeaturesLoading(t){e.simplifiedFeaturesStopToken&&(0,He.CF)(e.simplifiedFeaturesStopToken),e.simplifiedFeaturesStopToken=t},setSources(t){D()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setMafFilter(t){e.minorAlleleFrequencyFilterSetting=t},setShowSidebarLabels(t){e.showSidebarLabelsSetting=t},setShowTree(t){e.showTreeSetting=t},setSubtreeFilter(t){e.subtreeFilter=t?(0,c.cast)(t):void 0},setPhasedMode(t){(e.renderingModeSetting??(0,L.FI)(e,"renderingMode"))!==t&&(e.layout=[],e.clusterTree=void 0),e.renderingModeSetting=t},setAutoHeight(t){e.rowHeightMode=t?"auto":10},setHasPhased(t){e.hasPhased=t},setSampleInfo(t){D()(t,e.sampleInfo)||(e.sampleInfo=t)},setReferenceDrawingMode(t){e.referenceDrawingModeSetting=t}})).views(e=>({get autoHeight(){return"auto"===e.rowHeightMode},get minorAlleleFrequencyFilter(){return e.minorAlleleFrequencyFilterSetting??(0,L.FI)(e,"minorAlleleFrequencyFilter")},get showSidebarLabels(){return e.showSidebarLabelsSetting??(0,L.FI)(e,"showSidebarLabels")},get showTree(){return e.showTreeSetting??(0,L.FI)(e,"showTree")},get referenceDrawingMode(){return void 0!==e.referenceDrawingModeSetting?e.referenceDrawingModeSetting:(0,L.FI)(e,"showReferenceAlleles")?"draw":"skip"},activeFilters:()=>e.jexlFilters??(0,L.FI)(e,"jexlFilters").map(e=>`jexl:${e}`),get sourcesWithoutLayout(){return e.sourcesVolatile?(0,il.X)({sources:e.sourcesVolatile,renderingMode:e.renderingMode,sampleInfo:e.sampleInfo}):void 0},get sources(){let t=e.sourcesVolatile?(0,il.X)({sources:e.sourcesVolatile,layout:e.layout.length?e.layout:void 0,renderingMode:e.renderingMode,sampleInfo:e.sampleInfo}):void 0;if(t&&e.subtreeFilter?.length){const n=new Set(e.subtreeFilter);t=t.filter(e=>n.has(e.baseName??e.name))}return t},get root(){const t=e.clusterTree;if(!t)return;let n=sl((0,Zs.Od)(t),e=>e.children).sum(e=>e.children?0:1).sort((e,t)=>(0,rl.A)(e.data.height||1,t.data.height||1));if(e.subtreeFilter?.length){const t=new Set(e.subtreeFilter),r=e=>e.children?.length?e.children.flatMap(e=>r(e)):[e.data.name],a=e=>{const n=r(e);if(n.length===t.size&&n.every(e=>t.has(e)))return e;if(e.children)for(const t of e.children){const e=a(t);if(e)return e}},i=a(n);i&&(n=i)}return n}})).views(e=>{const{renderProps:t}=e;return{get sourceMap(){return e.sources?Object.fromEntries(e.sources.map(e=>[e.name,e])):void 0},get availableHeight(){return e.height-e.lineZoneHeight},get nrow(){return e.sources?.length||1},get rowHeight(){return"auto"===e.rowHeightMode?this.availableHeight/this.nrow:e.rowHeightMode},get hierarchy(){const t=e.root;if(!t||!e.sources?.length)return;const n=function(){var e=hl,t=1,n=1,r=!1;function a(a){var i,o=0;a.eachAfter(function(t){var n=t.children;n?(t.x=function(e){return e.reduce(gl,0)/e.length}(n),t.y=function(e){return 1+e.reduce(fl,0)}(n)):(t.x=i?o+=e(t,i):0,t.y=0,i=t)});var s=function(e){for(var t;t=e.children;)e=t[0];return e}(a),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(a),c=s.x-e(s,l)/2,d=l.x+e(l,s)/2;return a.eachAfter(r?function(e){e.x=(e.x-a.x)*t,e.y=(a.y-e.y)*n}:function(e){e.x=(e.x-c)/(d-c)*t,e.y=(1-(a.y?e.y/a.y:1))*n})}return a.separation=function(t){return arguments.length?(e=t,a):e},a.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],a):r?null:[t,n]},a.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],a):r?[t,n]:null},a}();return n.size([this.rowHeight*this.nrow,e.treeAreaWidth]),n.separation(()=>1),n(t),t},adapterProps:()=>({...t(),config:e.rendererConfig})}}).views(e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Show...",icon:Z.A,type:"subMenu",subMenu:[{label:"Show sidebar labels",type:"checkbox",checked:e.showSidebarLabels,onClick:()=>{e.setShowSidebarLabels(!e.showSidebarLabels)}},{label:"Show tree"+(e.clusterTree?"":" (run clustering first)"),type:"checkbox",checked:e.showTree,disabled:!e.clusterTree,onClick:()=>{e.setShowTree(!e.showTree)}},...e.subtreeFilter?.length?[{label:"Clear subtree filter",onClick:()=>{e.setSubtreeFilter(void 0)}}]:[],{label:"Show reference alleles",helpText:"When this setting is off, the background is colored solid grey and only ALT alleles are colored on top of it. This makes it easier to see potentially overlapping structural variants",type:"checkbox",checked:"skip"!==e.referenceDrawingMode,onClick:()=>{e.setReferenceDrawingMode("skip"===e.referenceDrawingMode?"draw":"skip")}},{label:"Show legend",type:"checkbox",checked:e.showLegend,onClick:()=>{e.setShowLegend(!e.showLegend)}}]},{label:"Row height",icon:tl.A,subMenu:[{label:"Manually set row height",disabled:e.autoHeight,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[wl,{model:e,handleClose:t}])}},{label:"Auto-adjust to display height",type:"checkbox",checked:e.autoHeight,onClick:()=>{e.setAutoHeight(!e.autoHeight)}}]},{label:"Rendering mode",icon:nl.A,subMenu:[{label:"Allele count (dosage)",helpText:"Draws the color darker the more times this allele exists, so homozygous variants are darker than heterozygous. Works on polyploid also",type:"radio",checked:"alleleCount"===e.renderingMode,onClick:()=>{e.setPhasedMode("alleleCount")}},{label:"Phased"+(e.hasPhased?"":e.featuresVolatile?" (disabled, no phased variants found)":" (checking for phased variants...)"),helpText:"Phased mode splits each sample into multiple rows representing each haplotype, and the phasing of the variants is used to color the variant in the individual haplotype rows. For example, a diploid sample SAMPLE1 will generate two rows SAMPLE1-HP0 and SAMPLE1 HP1 and a variant 1|0 will draw a box in the top row but not the bottom row",disabled:!e.hasPhased,checked:"phased"===e.renderingMode,type:"radio",onClick:()=>{e.setPhasedMode("phased")}}]},{label:"Filter by",icon:X.A,subMenu:[Ks(e),{label:"Edit filters",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[ml,{model:e,handleClose:t}])}}]},{label:"Cluster by genotype",icon:el.A,onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[bl,{model:e,handleClose:t}])}},{label:"Edit group colors/arrangement...",onClick:()=>{(0,k.getSession)(e).queueDialog(t=>[yl,{model:e,handleClose:t}])}}]}}).views(e=>({get canDisplayLabels(){return e.rowHeight>=6&&e.showSidebarLabels},get totalHeight(){return e.rowHeight*(e.sources?.length||1)},get featuresReady(){return!!e.featuresVolatile},getPortableSettings:()=>({minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,showSidebarLabelsSetting:e.showSidebarLabelsSetting,showTree:e.showTree,renderingMode:e.renderingMode,lengthCutoffFilter:e.lengthCutoffFilter,jexlFilters:e.jexlFilters,referenceDrawingMode:e.referenceDrawingMode,clusterTree:e.clusterTree,treeAreaWidth:e.treeAreaWidth,layout:e.layout,height:e.height})})).views(e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.featuresReady,height:e.height,totalHeight:e.totalHeight,renderingMode:e.renderingMode,minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,lengthCutoffFilter:e.lengthCutoffFilter,rowHeight:e.rowHeight,sources:e.sources,scrollTop:e.scrollTop,referenceDrawingMode:e.referenceDrawingMode,filters:new W.A({filters:e.activeFilters()})}},renderingProps:()=>({displayModel:e,async onFeatureClick(t,n){const r=(0,k.getSession)(e),{rpcManager:a}=r;try{const t=(0,C.getRpcSessionId)(e),r=(0,k.getContainingTrack)(e),{feature:i}=await a.call(t,"MultiVariantGetFeatureDetails",{featureId:n,sessionId:t,trackInstanceId:r.id,rendererType:e.rendererTypeName});(0,c.isAlive)(e)&&i&&e.selectFeature(new q.A(i))}catch(e){console.error(e),r.notifyError(`${e}`,e)}}}),legendItems(){if("phased"===e.renderingMode){let t=1;const n=e.featuresVolatile;if(n)for(const e of n){const n=e.get("ALT");n&&n.length>t&&(t=n.length)}const r=[{color:al.Us,label:"Reference"},{color:Bt.set1[0],label:"Alt allele 1"}];return t>=2&&r.push({color:Bt.set1[1],label:"Alt allele 2"}),t>=3&&r.push({color:Bt.set1[2],label:"Alt allele 3"}),r.push({color:al.lh,label:"Unphased"}),r}return[{color:al.Us,label:"Homozygous reference"},{color:(0,al.fb)(.5),label:"Heterozygous alt"},{color:(0,al.fb)(1),label:"Homozygous alt"},{color:al.Vg,label:"Other alt allele"},{color:al.FX,label:"No call"}]}})).actions(e=>({afterAttach(){(async()=>{try{const{setupMultiVariantAutoruns:t}=await n.e(419).then(n.bind(n,70419));t(e)}catch(t){(0,c.isAlive)(e)&&(console.error(t),(0,k.getSession)(e).notifyError(`${t}`,t))}})()}})).postProcessSnapshot(e=>{if(!e)return e;const{layout:t,minorAlleleFrequencyFilterSetting:n,showSidebarLabelsSetting:r,showTreeSetting:a,renderingModeSetting:i,rowHeightMode:o,lengthCutoffFilter:s,jexlFilters:l,referenceDrawingModeSetting:c,clusterTree:d,treeAreaWidth:u,lineZoneHeight:p,subtreeFilter:h,...g}=e;return{...g,...t.length?{layout:t}:{},...void 0!==n?{minorAlleleFrequencyFilterSetting:n}:{},...void 0!==r?{showSidebarLabelsSetting:r}:{},...void 0!==a?{showTreeSetting:a}:{},...void 0!==i?{renderingModeSetting:i}:{},..."auto"!==o?{rowHeightMode:o}:{},...s!==Number.MAX_SAFE_INTEGER?{lengthCutoffFilter:s}:{},...l?.length?{jexlFilters:l}:{},...void 0!==c?{referenceDrawingModeSetting:c}:{},...void 0!==d?{clusterTree:d}:{},...80!==u?{treeAreaWidth:u}:{},...p?{lineZoneHeight:p}:{},...h?.length?{subtreeFilter:h}:{}}})}const Sl=function(e){return c.types.compose("MultiLinearVariantDisplay",vl(e),c.types.model({type:c.types.literal("MultiLinearVariantDisplay")})).views(()=>({get rendererTypeName(){return"MultiVariantRenderer"},get featureWidgetType(){return{type:"VariantFeatureWidget",id:"variantFeature"}}})).actions(e=>{const{renderSvg:t}=e;return{async renderSvg(r){const{renderSvg:a}=await n.e(2155).then(n.bind(n,14536));return a(e,r,t)}}})};const xl=(0,o.S7)("LinearVariantMatrixRenderer",{},{explicitlyTyped:!0});function kl(e){return c.types.compose("LinearVariantMatrixDisplay",vl(e),c.types.model({type:c.types.literal("LinearVariantMatrixDisplay"),lineZoneHeight:c.types.optional(c.types.number,20)})).views(()=>({get blockType(){return"dynamicBlocks"},get prefersOffset(){return!0},get featureWidgetType(){return{type:"VariantFeatureWidget",id:"variantFeature"}}})).views(e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.featuresReady,renderingMode:e.renderingMode,minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,lengthCutoffFilter:e.lengthCutoffFilter,height:e.autoHeight?e.totalHeight:e.availableHeight,totalHeight:e.totalHeight,rowHeight:e.rowHeight,scrollTop:e.scrollTop,sources:e.sources}}})).actions(e=>({setLineZoneHeight:t=>(e.lineZoneHeight=(0,k.clamp)(t,10,1e3),e.lineZoneHeight)})).actions(e=>{const{renderSvg:t}=e;return{async renderSvg(r){const{renderSvg:a}=await n.e(8746).then(n.bind(n,68746));return a(e,r,t)}}}).postProcessSnapshot(e=>{if(!e)return e;const{lineZoneHeight:t,...n}=e;return{...n,...20!==t?{lineZoneHeight:t}:{}}})}class Cl{features=new Map;addFeatures(e,t){for(const[e,n]of t)this.features.set(e,n)}getDataByID(e){return this.features.get(e)}discardRange(e,t,n){for(const[r,a]of this.features){const i=a.get("refName"),o=a.get("start"),s=a.get("end");i===e&&o<n&&s>t&&this.features.delete(r)}}}function Tl(e){return`${e.sessionId}-${e.trackInstanceId}`}class Al{sessions={};getSession(e){const t=Tl(e);return this.sessions[t]||(this.sessions[t]=new Cl),this.sessions[t]}freeResources(e){const t=Tl(e),n=this.sessions[t];if(n){const t=e.regions[0];t&&n.discardRange(t.refName,t.start,t.end)}}deleteSession(e){const t=Tl(e);delete this.sessions[t]}}class Ml extends Lt.default{featureCacheManager=new Al;getFeatureById(e,t){return this.featureCacheManager.getSession(t).getDataByID(e)}freeResources(e){this.featureCacheManager.freeResources(e)}cacheFeatures(e,t,n){this.featureCacheManager.getSession(e).addFeatures(t,n)}}class Il extends Ml{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:r,regions:a,bpPerPx:i,scrollTop:o,rowHeight:s,sessionId:l,trackInstanceId:c}=e,d=a[0],u=(d.end-d.start)/i;this.cacheFeatures({sessionId:l,trackInstanceId:c},d.refName,t);const{makeImageData:p}=await n.e(1890).then(n.bind(n,1890)),{mafs:h,...g}=await(0,Un.u)(u,r,e,n=>p({ctx:n,canvasWidth:u,canvasHeight:r,renderArgs:{...e,features:t}})),f=h.map(({feature:e})=>({uniqueId:e.id(),start:e.get("start"),end:e.get("end"),refName:e.get("refName")})),m={...g,simplifiedFeatures:f,height:r,width:u,origScrollTop:o,rowHeight:s};return(0,mt.lk)(m,(0,yt.X)(g))}}class Pl extends Ml{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:r,referenceDrawingMode:a,regions:i,bpPerPx:o,scrollTop:s,sessionId:l,trackInstanceId:c}=e,d=i[0],u=(d.end-d.start)/o;this.cacheFeatures({sessionId:l,trackInstanceId:c},d.refName,t);const{makeImageData:p}=await n.e(6695).then(n.bind(n,36695)),h=await(0,Un.u)(u,r,e,n=>("skip"===a&&(n.fillStyle="#ccc",n.fillRect(0,0,u,r)),p(n,{...e,features:t}))),g={...h,height:r,width:u,origScrollTop:s};return(0,mt.lk)(g,(0,yt.X)(h))}}const Ll=(0,o.S7)("MultiVariantRenderer",{},{explicitlyTyped:!0}),Rl=(0,o.S7)("PlinkLDAdapter",{ldLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/plink.ld",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,ldLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Fl=(0,o.S7)("PlinkLDTabixAdapter",{ldLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/plink.ld.gz",locationType:"UriLocation"}},index:(0,o.S7)("PlinkLDTabixIndex",{indexType:{model:c.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/plink.ld.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,ldLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e}),Dl=(0,o.S7)("SplitVcfTabixAdapter",{vcfGzLocationMap:{type:"frozen",defaultValue:{}},indexLocationMap:{type:"frozen",defaultValue:{}},indexType:{type:"string",defaultValue:"TBI"},samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:'tsv with header like "name\tpopulation\tetc" where the first column is required, and corresponds to the sample names in the VCF files',locationType:"UriLocation"}}},{explicitlyTyped:!0});var Nl=n(67965);const Bl=(0,o.S7)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0}),Vl=(0,o.S7)("VariantFeatureWidget",{});function El(e){const t=(0,l.n)(e);return c.types.compose(t,c.types.model("VariantFeatureWidget",{type:c.types.literal("VariantFeatureWidget"),descriptions:c.types.frozen()}))}class zl extends Fa.A{name="MultiVariantClusterGenotypeMatrix";async execute(e,t){const r=await this.deserializeArguments(e,t),{executeClusterGenotypeMatrix:a}=await Promise.all([n.e(6567),n.e(6929)]).then(n.bind(n,76929));return a({pluginManager:this.pluginManager,args:r})}}class jl extends st.A{name="MultiVariantGetFeatureDetails";async execute(e){const{featureId:t,sessionId:n,trackInstanceId:r,rendererType:a}=e,i=this.pluginManager.getRendererType(a).getFeatureById(t,{sessionId:n,trackInstanceId:r});return{feature:i?.toJSON()}}}var Hl=n(19520);class _l extends Fa.A{name="MultiVariantGetGenotypeMatrix";async execute(e,t){const n=await this.deserializeArguments(e,t),r=(0,He.jL)(n.stopToken);return(0,Hl.v)({pluginManager:this.pluginManager,args:{...n,stopTokenCheck:r}})}}class $l extends Fa.A{name="MultiVariantGetSimplifiedFeatures";async execute(e,t){const n=await this.deserializeArguments(e,t),{lengthCutoffFilter:r,minorAlleleFrequencyFilter:a,regions:i,adapterConfig:o,stopToken:s,sessionId:l}=n,c=(0,He.jL)(s),{dataAdapter:d}=await(0,at.cK)(this.pluginManager,l,o),u=await(0,it._)(d.getFeaturesInMultipleRegions(i,n).pipe((0,ot.$)())),p={},h=new Map;let g=!1;const f=(0,js.Cg)({minorAlleleFrequencyFilter:a,lengthCutoffFilter:r,stopTokenCheck:c,features:u,genotypesCache:h});for(const{feature:e}of f){const t=e.id();let n=h.get(t);n||(n=e.get("genotypes"),h.set(t,n));for(const[e,t]of Object.entries(n)){const n=t.includes("|");g||=n;let r=1;if(n)for(const e of t)"|"===e&&r++;const a=p[e];p[e]={maxPloidy:Math.max(a?.maxPloidy??0,r),isPhased:a?.isPhased||n}}(0,He.As)(c)}return{hasPhased:g,sampleInfo:p,features:f.map(({feature:e})=>({id:e.id(),data:{start:e.get("start"),end:e.get("end"),refName:e.get("refName"),name:e.get("name")}}))}}}class Ol extends Fa.A{name="MultiVariantGetSources";async execute(e,t){const n=await this.deserializeArguments(e,t),{regions:r,adapterConfig:a,sessionId:i}=n,{dataAdapter:o}=await(0,at.cK)(this.pluginManager,i,a);return o.getSources(r,n)}}function Gl({features:e}){const t=["refName","start","name","REF","ALT","QUAL","FILTER"];return e.map(e=>`${t.map(t=>e.get(t)||".").join("\t")}\t${function(e){return Object.entries(e.get("INFO")).map(([e,t])=>`${e}=${t}`).join(";")}(e)}`).join("\n")}const Wl=(0,o.S7)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}},samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:"tsv with header like name\tpopulation\tetc. where the first column is required, and is the sample names",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,vcfLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Ul=(0,o.S7)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,o.S7)("VcfIndex",{indexType:{model:c.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}}),samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:"tsv with header like name\tpopulation\tetc. where the first column is required, and is the sample names",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,vcfGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});class ql extends r.A{name="VariantsPlugin";install(e){var t;!function(e){e.addAdapterType(()=>new b.A({name:"VcfAdapter",displayName:"VCF adapter",configSchema:Wl,adapterCapabilities:["exportData"],getAdapterClass:()=>Promise.all([n.e(208),n.e(8939)]).then(n.bind(n,88939)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"VcfTabixAdapter",displayName:"VCF tabix adapter",configSchema:Ul,adapterCapabilities:["exportData"],getAdapterClass:()=>Promise.all([n.e(208),n.e(5188),n.e(5222)]).then(n.bind(n,65222)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"SplitVcfTabixAdapter",displayName:"VCF tabix adapter (split across multiple files)",configSchema:Dl,getAdapterClass:()=>Promise.all([n.e(208),n.e(5188),n.e(4092)]).then(n.bind(n,84092)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new b.A({name:"PlinkLDAdapter",displayName:"PLINK LD adapter",configSchema:Rl,adapterMetadata:{category:"Linkage disequilibrium",description:"Adapter for pre-computed LD data from PLINK --r2 output (loads into memory)"},getAdapterClass:()=>n.e(4290).then(n.bind(n,54290)).then(e=>e.default)})),e.addAdapterType(()=>new b.A({name:"PlinkLDTabixAdapter",displayName:"PLINK LD tabix adapter",configSchema:Fl,adapterMetadata:{category:"Linkage disequilibrium",description:"Adapter for pre-computed LD data from PLINK --r2 output (tabix-indexed)"},getAdapterClass:()=>Promise.all([n.e(5188),n.e(4984)]).then(n.bind(n,74984)).then(e=>e.default)}))}(e),function(e){e.addWidgetType(()=>new i.A({name:"VariantFeatureWidget",heading:"Feature details",configSchema:Vl,stateModel:El(e),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(5754),n.e(7993),n.e(7529),n.e(208),n.e(8705),n.e(5043),n.e(6569),n.e(2943),n.e(3451)]).then(n.bind(n,33451)))}))}(e),function(e){e.addTrackType(()=>{const t=(n=e,(0,o.S7)("VariantTrack",{},{baseConfiguration:(0,g.J)(n)}));var n;return new p.A({name:"VariantTrack",displayName:"Variant track",configSchema:t,stateModel:(0,h.E)(e,"VariantTrack",t).views(()=>({saveTrackFileFormatOptions:()=>({vcf:{name:"VCF",extension:"vcf",callback:Gl}})}))})})}(e),(t=e).addTrackType(()=>{const e=(e=>(0,o.S7)("LDTrack",{},{baseConfiguration:(0,g.J)(e)}))(t);return new p.A({name:"LDTrack",displayName:"LD track",configSchema:e,stateModel:(0,h.E)(t,"LDTrack",e)})}),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,C.getFileName)(t),i=n&&(0,C.getFileName)(n);return(0,k.testAdapter)(a,/\.vcf\.b?gz$/i,r,"VcfTabixAdapter")?{type:"VcfTabixAdapter",vcfGzLocation:t,index:{location:n||(0,C.makeIndex)(t,".tbi"),indexType:(0,C.makeIndexType)(i,"CSI","TBI")}}:(0,k.testAdapter)(a,/\.vcf(\.gz)?$/i,r,"VcfAdapter")?{type:"VcfAdapter",vcfLocation:t}:(0,k.testAdapter)(a,/\.ld\.b?gz$/i,r,"PlinkLDTabixAdapter")?{type:"PlinkLDTabixAdapter",ldLocation:t,index:{location:n||(0,C.makeIndex)(t,".tbi"),indexType:(0,C.makeIndexType)(i,"CSI","TBI")}}:(0,k.testAdapter)(a,/\.ld$/i,r,"PlinkLDAdapter")?{type:"PlinkLDAdapter",ldLocation:t}:(0,k.testAdapter)(a,/\.h5$/i,r,"LdmatAdapter")?{type:"LdmatAdapter",ldmatLocation:t}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>["VcfTabixAdapter","VcfAdapter"].includes(t)?"VariantTrack":["PlinkLDAdapter","PlinkLDTabixAdapter","LdmatAdapter"].includes(t)?"LDTrack":e(t))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearVariantDisplay",{},{baseConfiguration:qs(e),explicitlyTyped:!0})}(e);return new I.A({name:"LinearVariantDisplay",displayName:"Variant display",configSchema:t,stateModel:Qs(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,a.lazy)(()=>Promise.resolve().then(n.bind(n,36832)).then(e=>({default:e.LinearBasicDisplayComponent})))})})}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("LinearVariantMatrixDisplay",{renderer:xl,height:{type:"number",defaultValue:250},showReferenceAlleles:{type:"boolean",defaultValue:!1},showSidebarLabels:{type:"boolean",defaultValue:!0},showTree:{type:"boolean",defaultValue:!0},renderingMode:{type:"stringEnum",model:c.types.enumeration("RenderingMode",["alleleCount","phased"]),defaultValue:"alleleCount"},minorAlleleFrequencyFilter:{type:"number",defaultValue:0},colorBy:{type:"string",defaultValue:""}},{baseConfiguration:(0,j.A)(e),explicitlyTyped:!0})}(e);return new I.A({name:"LinearVariantMatrixDisplay",displayName:"Multi-sample variant display (matrix)",helpText:'Draws multi-sample variant using a "matrix" where the visualization does not correspond to actual base pair coordinates, but uses lines to connect the columns of the matrix to their base pair coordinates',configSchema:t,stateModel:kl(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(2143),n.e(4547)]).then(n.bind(n,64547)))})})}(e),function(e){e.addDisplayType(()=>{const t=function(e){const t=e.getRendererType("MultiVariantRenderer").configSchema;return(0,o.S7)("MultiLinearVariantDisplay",{defaultRendering:{type:"stringEnum",model:c.types.enumeration("Rendering",["multivariant"]),defaultValue:"multivariant"},renderers:(0,o.S7)("RenderersConfiguration",{MultiVariantRenderer:t}),height:{type:"number",defaultValue:200}},{baseConfiguration:(0,o.S7)("SharedVariantDisplay",{showReferenceAlleles:{type:"boolean",defaultValue:!1},showSidebarLabels:{type:"boolean",defaultValue:!0},showTree:{type:"boolean",defaultValue:!0},renderingMode:{type:"stringEnum",model:c.types.enumeration("RenderingMode",["alleleCount","phased"]),defaultValue:"alleleCount"},minorAlleleFrequencyFilter:{type:"number",defaultValue:0},colorBy:{type:"string",defaultValue:""}},{baseConfiguration:P.A,explicitlyTyped:!0}),explicitlyTyped:!0})}(e);return new I.A({name:"MultiLinearVariantDisplay",displayName:"Multi-sample variant display (regular)",helpText:'Draws multi-sample variant data using a row for each sample in your dataset. The term "regular" is unfortunately vague but it just means drawing the variants at their actual base pair coordinates. The "regular" mode is notable for also being able to draw structural variants (SVs), including overlapping SVs. It will specifically skip drawing the "reference" alleles by default, allowing overlapping SVs to not cover each other up',configSchema:t,stateModel:Sl(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(2143),n.e(9580)]).then(n.bind(n,19580)))})})}(e),function(e){e.addDisplayType(()=>{const e=(0,o.S7)("LDDisplay",{renderer:Is,height:{type:"number",defaultValue:400}},{baseConfiguration:Ms(),explicitlyTyped:!0});return new I.A({name:"LDDisplay",displayName:"LD heatmap display",helpText:"Displays a linkage disequilibrium (LD) heatmap showing pairwise R values between variants computed directly from VCF genotypes",configSchema:e,stateModel:Vs(e),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:zs})}),e.addDisplayType(()=>{const e=(0,o.S7)("LDTrackDisplay",{renderer:Is,height:{type:"number",defaultValue:400}},{baseConfiguration:Ms(),explicitlyTyped:!0});return new I.A({name:"LDTrackDisplay",displayName:"LD heatmap display",helpText:"Displays a linkage disequilibrium (LD) heatmap from pre-computed LD data (e.g., PLINK --r2 output)",configSchema:e,stateModel:Es(e),trackType:"LDTrack",viewType:"LinearGenomeView",ReactComponent:zs})})}(e),function(e){e.addRendererType(()=>new Us({name:"LDRenderer",ReactComponent:(0,a.lazy)(()=>n.e(9374).then(n.bind(n,59374))),configSchema:Is,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new Pl({name:"MultiVariantRenderer",ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(208),n.e(7)]).then(n.bind(n,50007))),configSchema:Ll,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new Il({name:"LinearVariantMatrixRenderer",displayName:"Linear variant matrix renderer",ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(208),n.e(4902)]).then(n.bind(n,14902))),configSchema:xl,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new Nl.A({name:"StructuralVariantChordRenderer",displayName:"SV chord renderer",ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(208),n.e(2352)]).then(n.bind(n,72352))),configSchema:Bl,pluginManager:e}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,o.S7)("ChordVariantDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]},renderer:c.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(e),r=As(t);return new I.A({name:"ChordVariantDisplay",displayName:"Chord variant display",configSchema:t,stateModel:r,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:(0,a.lazy)(()=>n.e(5218).then(n.bind(n,45218)))})})}(e),e.addRpcMethod(()=>new Ol(e)),e.addRpcMethod(()=>new _l(e)),e.addRpcMethod(()=>new zl(e)),e.addRpcMethod(()=>new $l(e)),e.addRpcMethod(()=>new jl(e))}configure(e){const{jexl:t}=e,n={};t.addFunction("maf",e=>{const t=e.get("genotypes");if(!t)return 0;const r=(0,js.s8)(t,n);return(0,js.li)(r)})}}var Jl=n(59083);const Xl=[na,Lo.Ay,Nt,kn,Ln,ha,Ia.A,Pa.A,fi,Oi,ki,Qi,oo,Po,No,Wo,qo,as,ql,Jl.Ay,vi,bs,xs,Wn,Ji,Cs,_i,Ma,Ht]}}]);
//# sourceMappingURL=1912.a7cc60f2.chunk.js.map