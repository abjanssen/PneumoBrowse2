"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2577],{12577(e,a,t){t.r(a),t.d(a,{default:()=>x});var n=t(55614),i=t(30128),s=t(28910),r=t(62088),l=t(51049),o=t(23886),c=t(10533),d=t(54825),p=t(63209),g=t(23149),u=t(79291),y=t(44641),f=t(35703),h=t(69566),v=t(86217),m=t(89579),k=t(44460);const C=/^[A-Za-z][A-Za-z0-9]$/;function A(e){const a=(0,n.c)(11),{tag:t,tagSet:i}=e;if(0===i.length){let e;return a[0]!==t?(e=(0,k.jsxs)(d.A,{color:"warning.main",children:["No values found for tag ",t," in the current region"]}),a[0]=t,a[1]=e):e=a[1],e}let s,r,l,o;return a[2]!==t?(s=(0,k.jsxs)("div",{children:["Found unique ",t," values:"]}),a[2]=t,a[3]=s):s=a[3],a[4]!==i?(r=i.join(", "),a[4]=i,a[5]=r):r=a[5],a[6]!==r?(l=(0,k.jsx)("div",{children:r}),a[6]=r,a[7]=l):l=a[7],a[8]!==s||a[9]!==l?(o=(0,k.jsxs)("div",{children:[s,l]}),a[8]=s,a[9]=l,a[10]=o):o=a[10],o}function D(e,a){return`${e}-${a}-${Date.now()}-sessionTrack`}const x=(0,h.observer)(function(e){const{model:a,handleClose:t}=e,[n,h]=(0,i.useState)(""),[x,j]=(0,i.useState)(),[w,S]=(0,i.useState)(!1),[L,b]=(0,i.useState)(),$=C.exec(n),I=2===n.length&&!$,T=(0,o.useDebounce)(n,1e3),[P,N]=(0,i.useState)("");return(0,i.useEffect)(()=>{(async()=>{const e=C.test(T);if("tag"===P&&e)try{b(void 0),S(!0);const e=await(0,v.X)({self:a,tag:T,blocks:(0,o.getContainingView)(a).staticBlocks});j(e)}catch(e){console.error(e),b(e)}finally{S(!1)}})()},[a,P,T]),(0,i.useEffect)(()=>{"tag"!==P&&(j(void 0),b(void 0),S(!1))},[P]),(0,k.jsxs)(s.A,{open:!0,onClose:t,title:"Group by",children:[(0,k.jsxs)(p.A,{children:[(0,k.jsx)(d.A,{children:'NOTE: this will create new session tracks with the "filter by" set to the values chosen here rather than affecting the current track state'}),(0,k.jsxs)(g.A,{fullWidth:!0,value:P,onChange:e=>{N(e.target.value)},label:"Group by...",select:!0,children:[(0,k.jsx)(u.A,{value:"strand",children:"Strand"}),(0,k.jsx)(u.A,{value:"tag",children:"Tag"})]}),"tag"===P?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(d.A,{color:"textSecondary",children:"Examples: HP for haplotype, RG for read group, etc."}),(0,k.jsx)(g.A,{value:n,onChange:e=>{h(e.target.value)},placeholder:"Enter tag name",error:I,helperText:I?"Not a valid tag":"",autoComplete:"off","data-testid":"group-tag-name",slotProps:{htmlInput:{maxLength:2,"data-testid":"group-tag-name-input"}}}),L?(0,k.jsx)(r.A,{error:L}):w?(0,k.jsx)(l.A,{message:"Loading unique tags"}):x?(0,k.jsx)(A,{tag:n,tagSet:x}):null]}):null]}),(0,k.jsxs)(y.A,{children:[(0,k.jsx)(f.A,{variant:"contained",color:"primary",type:"submit",disabled:!P||w||"tag"===P&&(!x||0===x.length),autoFocus:!0,onClick:()=>{const e=(0,o.getContainingTrack)(a),i=(0,c.isStateTreeNode)(e.configuration)?structuredClone((0,c.getSnapshot)(e.configuration)):e.configuration,s=(0,o.getSession)(a),r=(0,o.getContainingView)(a);"tag"===P&&x?function({trackConf:e,tag:a,tagSet:t,session:n,view:i}){const s=[...t,void 0];for(const t of s){const s=D(e.trackId,`${a}:${t}`);n.addTrackConf({...e,trackId:s,name:`${e.name} (${a}:${t})`,displays:[{displayId:`${s}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${s}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:{...m.JD,tagFilter:{tag:a,value:t}}}}]}),i.showTrack(s)}}({trackConf:i,tag:n,tagSet:x,session:s,view:r}):"strand"===P&&function({trackConf:e,session:a,view:t}){const n=D(e.trackId,"strand:(-)"),i=D(e.trackId,"strand:(+)");a.addTrackConf({...e,trackId:n,name:`${e.name} (-)`,displays:[{displayId:`${n}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${n}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:m.CQ}},{displayId:`${n}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:m.CQ}]}),a.addTrackConf({...e,trackId:i,name:`${e.name} (+)`,displays:[{displayId:`${i}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${i}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:m.Ar}},{displayId:`${i}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:m.Ar}]}),t.showTrack(n),t.showTrack(i)}({trackConf:i,session:s,view:r}),t()},children:"Submit"}),(0,k.jsx)(f.A,{variant:"contained",color:"secondary",onClick:t,children:"Cancel"})]})]})})},86217(e,a,t){t.d(a,{X:()=>s});var n=t(23886),i=t(19608);async function s({self:e,tag:a,blocks:t,opts:s}){const{rpcManager:r}=(0,n.getSession)(e),{adapterConfig:l,effectiveRpcDriverName:o}=e,c=(0,i.getRpcSessionId)(e);return await r.call((0,i.getRpcSessionId)(e),"PileupGetGlobalValueForTag",{adapterConfig:l,tag:a,sessionId:c,rpcDriverName:o,regions:t.contentBlocks,...s})}}}]);
//# sourceMappingURL=2577.27c8af9d.chunk.js.map