{"version":3,"file":"static/js/704.b081cfa7.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../plugins/alignments/src/LinearReadCloudDisplay/components/CloudYScaleBar.tsx","webpack://@jbrowse/web/../../plugins/alignments/src/LinearReadCloudDisplay/renderSvg.tsx","webpack://@jbrowse/web/../../plugins/linear-genome-view/src/BaseLinearDisplay/SVGLegend.tsx"],"sourcesContent":["import { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { CloudTicks } from '../../RenderLinearReadCloudDisplayRPC/drawFeatsCloud.ts'\n\nfunction formatTickValue(value: number): string {\n  if (value >= 1000000) {\n    return `${(value / 1000000).toFixed(1)}M`\n  }\n  if (value >= 1000) {\n    return `${(value / 1000).toFixed(0)}k`\n  }\n  return `${value}`\n}\n\nconst CloudYScaleBar = observer(function CloudYScaleBar({\n  model,\n  orientation,\n}: {\n  model: { cloudTicks?: CloudTicks }\n  orientation?: 'left' | 'right'\n}) {\n  const theme = useTheme()\n  const cloudTicks = model.cloudTicks\n\n  if (!cloudTicks) {\n    return null\n  }\n\n  const { ticks, height } = cloudTicks\n  const bg = theme.palette.background.default\n  const fg = theme.palette.text.primary\n  const isLeft = orientation === 'left'\n  const k = isLeft ? -1 : 1\n  const tickLength = 6\n\n  return (\n    <g\n      fill=\"none\"\n      fontSize={10}\n      fontFamily=\"sans-serif\"\n      textAnchor={isLeft ? 'end' : 'start'}\n      strokeWidth={1}\n    >\n      {/* Axis line */}\n      <path\n        stroke={fg}\n        d={`M${k * tickLength},0H0.5V${height}H${k * tickLength}`}\n      />\n      {/* Ticks and labels */}\n      {ticks.map(({ value, y }) => (\n        <g key={value} transform={`translate(0,${y})`}>\n          <line stroke={fg} x2={k * tickLength} y1={0.5} y2={0.5} />\n          <text\n            stroke={bg}\n            strokeWidth={2.5}\n            paintOrder=\"stroke\"\n            fill={fg}\n            dy=\"0.32em\"\n            x={k * 9}\n            y={0.5}\n          >\n            {formatTickValue(value)}\n          </text>\n        </g>\n      ))}\n      {/* Axis label */}\n      <text\n        stroke={bg}\n        strokeWidth={2.5}\n        paintOrder=\"stroke\"\n        fill={fg}\n        fontSize={10}\n        textAnchor=\"middle\"\n        transform={`translate(${isLeft ? -30 : 30}, ${height / 2}) rotate(-90)`}\n      >\n        Insert size (bp)\n      </text>\n    </g>\n  )\n})\n\nexport default CloudYScaleBar\n","import type React from 'react'\n\nimport {\n  getContainingView,\n  getRpcSessionId,\n  getSession,\n} from '@jbrowse/core/util'\nimport {\n  ReactRendering,\n  renderingToSvg,\n} from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { getSnapshot } from '@jbrowse/mobx-state-tree'\nimport { SVGLegend } from '@jbrowse/plugin-linear-genome-view'\n\nimport { calculateCloudTicks } from '../RenderLinearReadCloudDisplayRPC/drawFeatsCloud.ts'\nimport CloudYScaleBar from './components/CloudYScaleBar.tsx'\n\nimport type { LinearReadCloudDisplayModel } from './model.ts'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface RenderingResult {\n  reactElement?: React.ReactNode\n  html?: string\n  canvasRecordedData?: unknown\n  layoutHeight?: number\n  featuresForFlatbush?: unknown\n  cloudMaxDistance?: number\n}\n\nexport async function renderSvg(\n  self: LinearReadCloudDisplayModel,\n  opts: ExportSvgDisplayOptions,\n) {\n  const view = getContainingView(self) as LGV\n  const session = getSession(self)\n  const { rpcManager, assemblyManager } = session\n  const height = opts.overrideHeight ?? self.height\n\n  const assemblyName = view.assemblyNames[0]\n  const assembly = assemblyName ? assemblyManager.get(assemblyName) : undefined\n  const sequenceAdapterConfig = assembly?.configuration?.sequence?.adapter\n  const sequenceAdapter = sequenceAdapterConfig\n    ? getSnapshot(sequenceAdapterConfig)\n    : undefined\n\n  // Serialize the full view snapshot for RPC\n  // Include staticBlocks and width which are not part of the regular snapshot\n  const viewSnapshot = structuredClone({\n    ...getSnapshot(view),\n    staticBlocks: view.staticBlocks,\n    width: view.width,\n  })\n\n  // Call RPC method with exportSVG options\n  // Use getRpcSessionId to ensure we use the same worker as normal rendering\n  const rpcSessionId = getRpcSessionId(self)\n  const rendering = (await rpcManager.call(\n    rpcSessionId,\n    'RenderLinearReadCloudDisplay',\n    {\n      sessionId: rpcSessionId,\n      view: viewSnapshot,\n      adapterConfig: self.adapterConfig,\n      sequenceAdapter,\n      config: getSnapshot(self.configuration),\n      ...self.renderProps(),\n      cloudModeHeight: height,\n      exportSVG: opts,\n      theme: opts.theme,\n    },\n  )) as RenderingResult\n\n  const finalRendering = await renderingToSvg(\n    rendering,\n    view.staticBlocks.totalWidthPx,\n    height,\n  )\n\n  // Clip to the visible region (view width), not the full staticBlocks width\n  const visibleWidth = view.width\n\n  // Create a clip path to clip to the visible region\n  const clipId = `clip-${self.id}-svg`\n\n  // Get legend items if legend is enabled\n  const legendItems = self.showLegend ? self.legendItems() : []\n\n  // Compute cloudTicks for SVG export if in cloud mode\n  const cloudTicks =\n    rendering.cloudMaxDistance !== undefined &&\n    self.drawCloud &&\n    self.showYScalebar\n      ? calculateCloudTicks(rendering.cloudMaxDistance, height)\n      : null\n\n  return (\n    <>\n      <defs>\n        <clipPath id={clipId}>\n          <rect x={0} y={0} width={visibleWidth} height={height} />\n        </clipPath>\n      </defs>\n      <g clipPath={`url(#${clipId})`}>\n        <g transform={`translate(${Math.max(0, -view.offsetPx)} 0)`}>\n          <ReactRendering rendering={finalRendering} />\n        </g>\n      </g>\n      {cloudTicks ? (\n        <g transform={`translate(${Math.max(-view.offsetPx, 0)})`}>\n          <CloudYScaleBar model={{ cloudTicks }} orientation=\"left\" />\n        </g>\n      ) : null}\n      {legendItems.length > 0 ? (\n        <SVGLegend\n          items={legendItems}\n          width={visibleWidth}\n          legendAreaWidth={opts.legendWidth}\n        />\n      ) : null}\n    </>\n  )\n}\n","import { measureText } from '@jbrowse/core/util'\n\nimport type { LegendItem } from './components/FloatingLegend.tsx'\n\nconst LEGEND_FONT_SIZE = 10\nconst LEGEND_BOX_SIZE = 12\nconst LEGEND_PADDING = 3\n\nexport default function SVGLegend({\n  items,\n  width,\n  legendAreaWidth,\n}: {\n  items: LegendItem[]\n  width: number\n  legendAreaWidth?: number\n}) {\n  if (items.length === 0) {\n    return null\n  }\n\n  const itemHeight = LEGEND_BOX_SIZE + 2\n  const legendHeight = items.length * itemHeight + LEGEND_PADDING * 2\n\n  // Calculate legend width based on longest label\n  const maxLabelWidth = Math.max(\n    ...items.map(item => measureText(item.label, LEGEND_FONT_SIZE)),\n  )\n  const legendWidth = LEGEND_BOX_SIZE + 8 + maxLabelWidth + LEGEND_PADDING * 2\n\n  // If legendAreaWidth is provided, position legend to the right of the figure\n  // Otherwise, position it inside the figure area (top-right corner)\n  const x = legendAreaWidth ? width + 10 : width - legendWidth - 10\n  const y = 10\n\n  return (\n    <g transform={`translate(${x}, ${y})`}>\n      <rect\n        x={0}\n        y={0}\n        width={legendWidth}\n        height={legendHeight}\n        fill=\"rgba(255,255,255,0.9)\"\n        stroke=\"#ccc\"\n        strokeWidth={1}\n        rx={4}\n      />\n      {items.map((item, idx) => (\n        <g\n          key={`legend-${idx}`}\n          transform={`translate(${LEGEND_PADDING}, ${LEGEND_PADDING + idx * itemHeight})`}\n        >\n          {item.color ? (\n            <rect\n              x={0}\n              y={0}\n              width={LEGEND_BOX_SIZE}\n              height={LEGEND_BOX_SIZE}\n              fill={item.color}\n            />\n          ) : null}\n          <text\n            x={LEGEND_BOX_SIZE + 6}\n            y={LEGEND_BOX_SIZE - 2}\n            fontSize={LEGEND_FONT_SIZE}\n            fill=\"black\"\n          >\n            {item.label}\n          </text>\n        </g>\n      ))}\n    </g>\n  )\n}\n"],"names":["formatTickValue","value","toFixed","observer","model","orientation","theme","useTheme","cloudTicks","ticks","height","bg","palette","background","default","fg","text","primary","isLeft","k","_jsxs","fill","fontSize","fontFamily","textAnchor","strokeWidth","children","_jsx","stroke","d","map","y","transform","x2","y1","y2","paintOrder","dy","x","async","renderSvg","self","opts","view","getContainingView","session","getSession","rpcManager","assemblyManager","overrideHeight","assemblyName","assemblyNames","assembly","get","undefined","sequenceAdapterConfig","configuration","sequence","adapter","sequenceAdapter","getSnapshot","viewSnapshot","structuredClone","staticBlocks","width","rpcSessionId","getRpcSessionId","rendering","call","sessionId","adapterConfig","config","renderProps","cloudModeHeight","exportSVG","finalRendering","renderingToSvg","totalWidthPx","visibleWidth","clipId","id","legendItems","showLegend","cloudMaxDistance","drawCloud","showYScalebar","calculateCloudTicks","_Fragment","clipPath","Math","max","offsetPx","ReactRendering","CloudYScaleBar","length","SVGLegend","items","legendAreaWidth","legendWidth","t0","$","_c","legendHeight","LEGEND_BOX_SIZE","LEGEND_PADDING","t1","_temp","t2","t3","t4","t5","rx","Symbol","for","item_0","idx","item","color","LEGEND_FONT_SIZE","label","measureText"],"sourceRoot":""}