"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2724],{72724:(e,t,a)=>{a.r(t),a.d(t,{default:()=>se});var s=a(7552),n=a(99546),r=a(91818),o=a(21049),c=a(10240),i=a(29654),l=a(68446),d=a(61282),p=a(39901),u=a(61180),m=a(6986),h=a(8846),g=a(69092),x=a(75785),f=a(67112),k=a(91468),j=a(93062),b=a(7946),y=a(22762),A=a(67758),v=a(69500);const w=(0,x.n9)()(e=>({spacing:{marginBottom:e.spacing(3)}}));function S(e){const t=(0,A.c)(5),{trackAdapter:a,trackType:s}=e,{classes:n}=w(),{type:r,subadapter:o}=a;let c;return t[0]!==n.spacing||t[1]!==o?.type||t[2]!==s||t[3]!==r?(c="SNPCoverageAdapter"===r?(0,v.jsxs)(d.A,{className:n.spacing,children:["Selected ",(0,v.jsx)("code",{children:s}),". Using adapter ",(0,v.jsx)("code",{children:r})," with subadapter ",(0,v.jsx)("code",{children:o?.type}),". Please enter a track name and, if necessary, update the track type."]}):(0,v.jsxs)(d.A,{className:n.spacing,children:["Using adapter ",(0,v.jsx)("code",{children:r})," and guessing track type"," ",(0,v.jsx)("code",{children:s}),". Please enter a track name and, if necessary, update the track type."]}),t[0]=n.spacing,t[1]=o?.type,t[2]=s,t[3]=r,t[4]=c):c=t[4],c}var T=a(70330);function N(e){const t={};for(const a of e){const e=a.adapterMetadata?.category||"Default";t[e]||(t[e]=[]),t[e].push(a)}return t}const C=(0,l.observer)(({model:e})=>{const{trackAdapter:t}=e,{pluginManager:a}=(0,n.getEnv)(e);return(0,v.jsx)(j.A,{value:"UNKNOWN"!==t?.type?t?.type:"",label:"Adapter type",variant:"outlined",select:!0,fullWidth:!0,onChange:t=>{e.setAdapterHint(t.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},children:Object.entries(N(a.getAdapterElements().filter(e=>!e.adapterMetadata?.hiddenFromGUI))).map(([e,t])=>[(0,v.jsx)(T.A,{children:e},e),t.map(e=>(0,v.jsx)(c.A,{value:e.name,children:e.displayName},e.name))])})}),D=(0,x.n9)()(e=>({spacing:{marginBottom:e.spacing(3)}}));function E(e){const t=(0,A.c)(9),{model:a}=e,{classes:s}=D();let n,r,o,c,i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,v.jsx)(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"}),t[0]=n):n=t[0],t[1]===Symbol.for("react.memo_cache_sentinel")?(r=(0,v.jsx)(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"}),t[1]=r):r=t[1],t[2]!==s.spacing?(o=(0,v.jsxs)(d.A,{className:s.spacing,children:["JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",n," ","of JBrowse to see if they support this data type or"," ",r," ","and add a feature request for this data type."]}),t[2]=s.spacing,t[3]=o):o=t[3],t[4]!==a?(c=(0,v.jsx)(C,{model:a}),t[4]=a,t[5]=c):c=t[5],t[6]!==o||t[7]!==c?(i=(0,v.jsxs)(v.Fragment,{children:[o,c]}),t[6]=o,t[7]=c,t[8]=i):i=t[8],i}var I=a(18423),M=a(74281),P=a(95054),W=a(52348),B=a(74900),O=a(5026),_=a(91464),F=a(36144),J=a(33896),L=a(89870);const U=(0,x.n9)()(e=>({paper:{display:"flex",flexDirection:"column",padding:e.spacing(1)},card:{marginTop:e.spacing(1)}})),G=(0,l.observer)(function({model:e}){const{classes:t}=U(),[a,n]=(0,s.useState)(""),[r,o]=(0,s.useState)(""),[c,i]=(0,s.useState)(["Name","ID"]),[l,d]=(0,s.useState)(["CDS","exon"]),p=[{label:"Indexing attributes",values:c},{label:"Feature types to exclude",values:l}];return(0,s.useEffect)(()=>{e.setTextIndexingConf({attributes:c,exclude:l})},[e,c,l]),(0,v.jsxs)(P.A,{className:t.paper,children:[(0,v.jsx)(W.A,{children:"Indexing configuration"}),p.map((e,s)=>(0,v.jsx)(B.A,{raised:!0,className:t.card,children:(0,v.jsxs)(O.A,{children:[(0,v.jsx)(W.A,{children:e.label}),(0,v.jsxs)(_.A,{disablePadding:!0,children:[e.values.map((t,a)=>(0,v.jsx)(F.Ay,{disableGutters:!0,children:(0,v.jsx)(j.A,{value:t,slotProps:{input:{endAdornment:(0,v.jsx)(J.A,{position:"end",children:(0,v.jsx)(L.A,{onClick:()=>{const t=e.values.filter((e,t)=>t!==a);0===s?i(t):d(t)},children:(0,v.jsx)(M.A,{})})})}}})},`${t}-${a}`)),(0,v.jsx)(F.Ay,{disableGutters:!0,children:(0,v.jsx)(j.A,{value:0===s?a:r,placeholder:"add new",onChange:e=>{0===s?n(e.target.value):o(e.target.value)},slotProps:{input:{endAdornment:(0,v.jsx)(J.A,{position:"end",children:(0,v.jsx)(L.A,{onClick:()=>{0===s?(i([...c,a]),n("")):(d([...l,r]),o(""))},disabled:0===s?""===a:""===r,"data-testid":"stringArrayAdd-Feat",children:(0,v.jsx)(I.A,{})})})}}})})]})]})},e.label))]})}),R=(0,l.observer)(function({model:e}){const{pluginManager:t}=(0,n.getEnv)(e),{trackType:a}=e,s=t.getTrackElements();return(0,v.jsx)(j.A,{value:a,variant:"outlined",label:"Track type",select:!0,fullWidth:!0,onChange:t=>{e.setTrackType(t.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},children:s.map(({name:e,displayName:t})=>(0,v.jsx)(c.A,{value:e,children:t},e))})}),$=(0,x.n9)()(e=>({spacing:{marginBottom:e.spacing(3)}}));function q(){const e=(0,A.c)(4),{classes:t}=$();let a,s,n;return e[0]===Symbol.for("react.memo_cache_sentinel")?(a=(0,v.jsx)(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"}),e[0]=a):a=e[0],e[1]===Symbol.for("react.memo_cache_sentinel")?(s=(0,v.jsx)(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"}),e[1]=s):s=e[1],e[2]!==t.spacing?(n=(0,v.jsxs)(d.A,{className:t.spacing,children:["This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",a," ","of JBrowse or"," ",s," ","and add a feature request for this data type."]}),e[2]=t.spacing,e[3]=n):n=e[3],n}const H=(0,x.n9)()(e=>({spacing:{marginBottom:e.spacing(3)}})),K=(0,l.observer)(function({model:e}){const{classes:t}=H(),[a,o]=(0,s.useState)(!0),c=(0,n.getSession)(e),{trackName:i,unsupported:l,trackAdapter:p,trackType:u,warningMessage:m,adapterHint:h}=e;if((0,s.useEffect)(()=>{""===h&&p&&e.setAdapterHint(p.type)},[h,p,p?.type,e]),l)return(0,v.jsx)(q,{});if(p?.type===k.UNKNOWN)return(0,v.jsx)(E,{model:e});if(p?.type){const l=(0,n.isSupportedIndexingAdapter)(p.type),{pluginManager:h}=(0,n.getEnv)(e),g=h.evaluateExtensionPoint("Core-addTrackComponent",({model:e})=>(0,v.jsx)(f.AssemblySelector,{session:c,helperText:"Select assembly to add track to",selected:e.assembly,onChange:t=>{e.setAssembly(t)},TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),{model:e});return(0,v.jsxs)("div",{children:[(0,v.jsx)(S,{trackAdapter:p,trackType:u}),m?(0,v.jsx)(d.A,{color:"warning",children:m}):null,(0,v.jsx)(j.A,{className:t.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:i,onChange:t=>{e.setTrackName(t.target.value)},slotProps:{htmlInput:{"data-testid":"trackNameInput"}}}),(0,v.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,v.jsx)(C,{model:e}),(0,v.jsx)(R,{model:e}),(0,v.jsx)(s.Suspense,{fallback:null,children:(0,v.jsx)(g,{model:e})})]}),n.isElectron&&l&&(0,v.jsx)(r.A,{children:(0,v.jsx)(b.A,{label:"Index track for text searching?",control:(0,v.jsx)(y.A,{checked:a,onChange:t=>{o(t.target.checked),e.setTextIndexTrack(t.target.checked)}})})}),n.isElectron&&a&&l?(0,v.jsx)(G,{model:e}):null]})}return(0,v.jsx)(d.A,{children:"Could not recognize this data type."})});var z=a(36422);const Y=(0,x.n9)()(e=>({paper:{padding:e.spacing(2)},spacer:{height:e.spacing(8)}})),Q=(0,l.observer)(function({model:e}){const{classes:t}=Y(),a=(0,z.getRoot)(e);return(0,v.jsxs)(P.A,{className:t.paper,children:[(0,v.jsx)(f.FileSelector,{name:"Main file",description:"",location:e.trackData,setLocation:e.setTrackData,setName:e.setTrackName,rootModel:a}),(0,v.jsx)("div",{className:t.spacer}),(0,v.jsx)(f.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:e.indexTrackData,setLocation:e.setIndexTrackData,setName:e.setTrackName,rootModel:a})]})});const V=(0,x.n9)()(e=>({root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginRight:e.spacing(1)},actionsContainer:{marginTop:e.spacing(10),marginBottom:e.spacing(2)},alertContainer:{padding:`${e.spacing(2)}px 0px ${e.spacing(2)}px 0px`}})),X=["Enter track data","Confirm track type"],Z=(0,l.observer)(function({model:e}){const[t,a]=(0,s.useState)(0),{classes:r}=V(),{assembly:o,trackAdapter:c,trackData:i,trackName:l,trackType:x}=e;function f(t){switch(t){case 0:return(0,v.jsx)(Q,{model:e});case 1:return(0,v.jsx)(K,{model:e});default:return(0,v.jsx)(d.A,{children:"Unknown step"})}}function k(){switch(t){case 0:return!i;case 1:return!(l&&x&&c?.type&&o);default:return!0}}return(0,v.jsx)("div",{className:r.root,children:(0,v.jsx)(p.A,{className:r.stepper,activeStep:t,orientation:"vertical",children:X.map((s,o)=>(0,v.jsxs)(u.A,{children:[(0,v.jsx)(m.A,{children:s}),(0,v.jsxs)(h.A,{children:[f(o),(0,v.jsxs)("div",{className:r.actionsContainer,children:[(0,v.jsx)(g.A,{disabled:0===t,className:r.button,onClick:()=>{a(t-1)},"data-testid":"addTrackBackButton",children:"Back"}),(0,v.jsx)(g.A,{disabled:k(),variant:"contained",color:"primary",onClick:()=>{if(t!==X.length-1)a(t+1);else try{!function({model:e}){const{textIndexTrack:t,trackAdapter:a,view:s}=e,r=(0,n.getSession)(e),o=e.getTrackConfig(Date.now());if(!(0,n.isSessionWithAddTracks)(r))throw new Error("Can't add tracks to this session");if(!o||!a)throw new Error("Failed to add track.\nThe configuration of this file is not currently supported.");{const{trackId:c}=o;r.addTrackConf(o),s?.showTrack?.(c),n.isElectron&&t&&(0,n.isSupportedIndexingAdapter)(a.type)&&function({trackId:e,model:t}){const{textIndexingConf:a,trackName:s,assembly:n}=t,{jobsManager:r}=(0,z.getRoot)(t),o=a||{attributes:["Name","ID"],exclude:["CDS","exon"]},c=`${s}-index`;r.queueJob({indexingParams:{...o,assemblies:[n],tracks:[e],indexType:"perTrack",name:c,timestamp:(new Date).toISOString()},name:c,cancelCallback:()=>r.abortJob()})}({model:e,trackId:c}),e.clearData(),(0,n.isSessionModelWithWidgets)(r)&&r.hideWidget(e)}}({model:e})}catch(t){(0,n.getSession)(e).notifyError(`${t}`,t)}},className:r.button,"data-testid":"addTrackNextButton",children:t===X.length-1?"Add":"Next"})]})]})]},s))})})});var ee=a(42489);const te=(0,x.n9)()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),ae=(0,l.observer)(function({model:e}){const{classes:t}=te(),[a,r]=(0,s.useState)(""),[o,c]=(0,s.useState)();return(0,v.jsxs)("div",{children:[o?(0,v.jsx)(f.ErrorMessage,{error:o}):null,(0,v.jsx)(j.A,{multiline:!0,rows:10,value:a,placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:t.textbox,onChange:e=>{r(e.target.value)}}),(0,v.jsx)(g.A,{variant:"contained",className:t.submit,onClick:()=>{try{c(void 0);const t=(0,n.getSession)(e),s=JSON.parse(a),r=Array.isArray(s)?s:[s];(0,n.isSessionWithAddTracks)(t)&&(0,n.isSessionModelWithWidgets)(t)&&((0,ee.transaction)(()=>{for(const e of r)t.addTrackConf(e);for(const t of r)e.view.showTrack(t.trackId);e.clearData()}),t.hideWidget(e))}catch(e){console.error(e),c(e)}},children:"Submit"})]})}),se=(0,l.observer)(function({model:e}){const[t,a]=(0,s.useState)("Default add track workflow"),l={"Default add track workflow":Z,"Add track JSON":ae,...Object.fromEntries((0,n.getEnv)(e).pluginManager.getAddTrackWorkflowElements().map(e=>[e.name,e.ReactComponent]))},d=l[t]?t:"Default add track workflow",p=l[d];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(r.A,{children:[(0,v.jsx)(o.A,{value:d,onChange:e=>{a(e.target.value)},children:Object.keys(l).map(e=>(0,v.jsx)(c.A,{value:e,children:e},e))}),(0,v.jsx)(i.A,{children:"Type of add track workflow"})]}),(0,v.jsx)(s.Suspense,{fallback:null,children:(0,v.jsx)(p,{model:e})})]})})}}]);
//# sourceMappingURL=2724.d896aa72.chunk.js.map