"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2429],{62429(e,t,i){i.d(t,{setupMultiVariantAutoruns:()=>u});var s=i(77251),n=i(53155),o=i(8201),r=i(52901),a=i(70203),l=i(99226),c=i(38567);function u(e){!function(e){(0,l.addDisposer)(e,(0,c.autorun)(async()=>{try{if(!(0,l.isAlive)(e)||e.isMinimized)return;if(!(0,s.getContainingView)(e).initialized)return;const{rpcManager:t}=(0,s.getSession)(e),{adapterConfig:i}=e,n=(0,r.y5)();e.setSourcesLoading(n);const o=(0,a.getRpcSessionId)(e),c=await t.call(o,"MultiVariantGetSources",{sessionId:o,adapterConfig:i,stopToken:n,statusCallback:t=>{(0,l.isAlive)(e)&&e.setStatusMessage(t)}});(0,l.isAlive)(e)&&e.setSources(c)}catch(t){!(0,o.Kp)(t)&&(0,l.isAlive)(e)&&(console.error(t),(0,s.getSession)(e).notifyError(`${t}`,t))}},{delay:1e3,name:"GetMultiVariantSources"}))}(e),function(e){(0,l.addDisposer)(e,(0,c.autorun)(async()=>{try{if(!(0,l.isAlive)(e)||e.isMinimized)return;const t=(0,s.getContainingView)(e);if(!t.initialized||!e.featureDensityStatsReadyAndRegionNotTooLarge)return;const i=(0,r.y5)();e.setSimplifiedFeaturesLoading(i);const{rpcManager:o}=(0,s.getSession)(e),{lengthCutoffFilter:c,sources:u,minorAlleleFrequencyFilter:d,adapterConfig:f}=e;if(u){const s=(0,a.getRpcSessionId)(e),{sampleInfo:r,hasPhased:g,features:h}=await o.call(s,"MultiVariantGetSimplifiedFeatures",{regions:t.dynamicBlocks.contentBlocks,sources:u,minorAlleleFrequencyFilter:d,lengthCutoffFilter:c,sessionId:s,adapterConfig:f,stopToken:i,statusCallback:t=>{(0,l.isAlive)(e)&&e.setStatusMessage(t)}});(0,l.isAlive)(e)&&(e.setHasPhased(g),e.setSampleInfo(r),e.setFeatures(h.map(e=>new n.A(e))))}}catch(t){console.error(t),!(0,o.Kp)(t)&&(0,l.isAlive)(e)&&(0,s.getSession)(e).notifyError(`${t}`,t)}},{delay:1e3,name:"MultiVariantFeatures"}))}(e),function(e){(0,l.addDisposer)(e,(0,c.autorun)(function(){if(!(0,l.isAlive)(e)||e.isMinimized)return;const{treeCanvas:t,hierarchy:i,treeAreaWidth:s,height:n,scrollTop:o,totalHeight:r}=e;if(!t||!i)return;const a=t.getContext("2d");if(a){a.resetTransform(),a.scale(2,2),a.clearRect(0,0,s,n),a.translate(0,-o),a.strokeStyle="#0008",a.lineWidth=1,a.beginPath();for(const e of i.links()){const{source:t,target:i}=e,s=t.x,n=i.x,o=i.y,r=t.y;a.moveTo(r,s),a.lineTo(r,n),a.moveTo(r,n),a.lineTo(o,n)}a.stroke()}},{name:"TreeDraw"})),(0,l.addDisposer)(e,(0,c.autorun)(function(){if(!(0,l.isAlive)(e)||e.isMinimized)return;const{mouseoverCanvas:t,hierarchy:i,rowHeight:n,hoveredTreeNode:o,height:r,scrollTop:a,sources:c,totalHeight:u}=e;if(!t)return;const d=t.getContext("2d");if(!d)return;const f=(0,s.getContainingView)(e).width;if(d.clearRect(0,0,f,r),i&&o&&c){d.save(),d.translate(0,-a),d.fillStyle="rgba(255,165,0,0.2)";const e=new Set(o.descendantNames);for(let t=0,i=c.length;t<i;t++){const i=c[t];if(e.has(i.name)){const e=(t+.5)*n;d.fillRect(0,e-n/2,f,n)}}const{node:t}=o;d.fillStyle="rgba(255,165,0,0.8)",d.beginPath(),d.arc(t.y,t.x,4,0,2*Math.PI),d.fill(),d.strokeStyle="rgba(255,140,0,1)",d.lineWidth=1,d.stroke(),d.restore()}},{name:"TreeHover"}))}(e)}}}]);
//# sourceMappingURL=2429.8eb6d827.chunk.js.map