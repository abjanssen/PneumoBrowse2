"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5727],{95727:(e,t,r)=>{r.d(t,{A:()=>O});var n=r(68446),o=r(7552),a=r(99546),s=r(48231),i=r(36422),l=r(6854);function c(e,t){const r=e.get("ALT");if(r)return new Map(r.map((e=>(0,l.h)(e))).filter(a.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var u=r(49473),d=r(963);const g={F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},f={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"},p={color_fwd_strand_not_proper:(0,d.X4)("#CA6767",.8),color_rev_strand_not_proper:(0,d.X4)("#7272AA",.8),color_fwd_strand:(0,d.X4)("#DC2A2A",.8),color_rev_strand:(0,d.X4)("#4141BA",.8),color_fwd_missing_mate:(0,d.X4)("#921111",.8),color_rev_missing_mate:(0,d.X4)("#111192",.8),color_fwd_diff_chr:(0,d.X4)("#000000",.8),color_rev_diff_chr:(0,d.X4)("#696969",.8),color_pair_lr:(0,d.X4)("#8C8C8C",.8),color_pair_rr:(0,d.X4)("#00005A",.8),color_pair_rl:(0,d.X4)("#005A5A",.8),color_pair_ll:(0,d.X4)("#005A00",.8),color_nostrand:(0,d.X4)("#8C8C8C",.8),color_interchrom:(0,d.X4)("#5A005A",.8),color_longinsert:(0,d.X4)("#B30000",.8),color_shortinsert:(0,d.X4)("#FF3A5C",.8),color_unknown:(0,d.X4)("#555",.8)},h=p.color_unknown;function v(e,t){return-1===e&&1===t?p.color_pair_rr:1===e&&-1===t?p.color_pair_ll:p.color_unknown}function m(e,t){return-1===e&&1===t||1===e&&-1===t}var _=r(69500);const[k,,w]=[0,1,2,3],R=(0,n.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:l,views:c,showIntraviewLinks:d}=e,R=(0,s.A)(),T=(0,a.getSession)(e),M=(0,i.getSnapshot)(e),{assemblyManager:N}=T,S=c[0],y=S?N.get(S.assemblyNames[0]):void 0;(0,u.E6)(M);const L=e.getTrackFeatures(t),b=(0,o.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(L)),[L]),O=(0,o.useMemo)((()=>{const r=e.getMatchedFeaturesInLayout(t,b?function(e){const t=new Map,r=new Set,n=new Set;for(const o of e.values()){const e=o.get("flags"),s=o.id(),i=(0,a.assembleLocStringFast)({refName:o.get("refName"),start:o.get("start"),end:o.get("end")}),l=4&e,c=2&e;if(!(r.has(s)||n.has(i)||c||l)){const e=o.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(o)}r.add(o.id()),n.add(i)}return[...t.values()].filter((e=>e.length>1))}(L):function(e){const t=new Map,r=new Set;for(const n of e.values()){const e=n.id(),o=4&n.get("flags"),a=!!n.get("tags")?.SA;if(!r.has(e)&&!o&&a){const e=n.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(L));if(!b)for(const e of r)e.sort(((e,t)=>e.clipPos-t.clipPos));return r}),[L,t,b,e]),[C,F]=(0,o.useState)();let A=0;if(r.current){const e=r.current.getBoundingClientRect();A=e.top}return y?(0,_.jsx)("g",{fill:"none","data-testid":O.length?`${t}-loaded`:t,children:O.map((e=>{const r=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:i,level:M}=e[o],{layout:N,feature:S,level:O}=e[o+1];if(!s||!N)return console.warn("received null layout for a overlay feature"),null;if(!d&&M===O)return null;const E=y.getCanonicalRefName(i.get("refName")),W=y.getCanonicalRefName(S.get("refName"));if(!E||!W)throw new Error(`unable to find ref for ${E||W}`);const x={pair_orientation:i.get("pair_orientation")},j=i.get("strand"),X=S.get("strand");let B="",$=!1;E===W&&(b?(B=function(e){const t=g[e.pair_orientation||""];return"LR"===t?void 0:p[f[t]]}(x)||h,$="LR"!==g[x.pair_orientation||""]):(B=v(j,X),$=m(j,X)));const J=s[-1===j?k:w],I=-1===X,P=b?N[I?k:w]:N[I?w:k],D=(0,u.Tp)(c[M],E,J),V=(0,u.Tp)(c[O],W,P),Y=c[M].pxToBp(D).reversed?-1:1,H=c[O].pxToBp(V).reversed?-1:1,q=c.map((e=>e.getTrack(t))),z=(0,u.Ec)(t,M,c,q,s,n)-A,G=(0,u.Ec)(t,O,c,q,N,n)-A,K=M===O&&$,Q=K?q[M].displays[0].height:0,U=b?-1:1,Z=(0,u.eW)(c,t,M,n),ee=["M",D,z,"C",D+200*i.get("strand")*Y,K?Math.min(Z-A+Q,z+Q):z,V-200*S.get("strand")*H*U,K?Math.min(Z-A+Q,G+Q):G,V,G].join(" "),te=`${i.id()}-${S.id()}`;r.push((0,_.jsx)("path",{d:ee,"data-testid":"r1",pointerEvents:l?"auto":void 0,strokeWidth:C===te?5:1,...(0,a.getStrokeProps)(B||R.palette.text.disabled),onClick:()=>{const e=T.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(L.get(i.id())||{toJSON:()=>{}}).toJSON(),feature2:(L.get(S.id())||{toJSON:()=>{}}).toJSON()}});T.showWidget?.(e)},onMouseOver:()=>{F(te)},onMouseOut:()=>{F(void 0)}},te))}return r}))}):null})),[T]=[0,1,2,3],M=(0,n.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:s,views:d}=e,g=(0,a.getSession)(e),{assemblyManager:f}=g,p=e.getTrackFeatures(t),h=(0,o.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"breakend"===n.get("type")){const e=n.get("ALT");e?.forEach((e=>{const r=`${n.get("refName")}:${n.get("start")+1}`,o=(0,l.h)(e);if(o){const e=t.get(r);e?e.push(n):t.set(o.MatePosition||"none",[n])}}))}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(p))),[p,t,e]),[v,m]=(0,o.useState)(),k=(0,i.getSnapshot)(e);(0,u.E6)(k);const w=f.get(d[0].assemblyNames[0]);if(!w)return null;let R=0;if(r.current){const e=r.current.getBoundingClientRect();R=e.top}return(0,_.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":h.length?`${t}-loaded`:t,children:h.map((e=>{const r=[];for(let o=0;o<e.length-1;o+=1){const{layout:a,feature:i,level:l}=e[o],{layout:f,feature:h,level:k}=e[o+1],M=i.id(),N=c(i,h);if(!a||!f)return null;const S=i.get("refName"),y=h.get("refName"),L=w.getCanonicalRefName(S),b=w.getCanonicalRefName(y);if(!L||!b)throw new Error(`unable to find ref for ${L||b}`);const O=(0,u.Tp)(d[l],L,a[T]),C=(0,u.Tp)(d[k],b,f[T]),F=d[l].pxToBp(O).reversed,A=d[k].pxToBp(C).reversed,E=d.map((e=>e.getTrack(t))),W=(0,u.Ec)(t,l,d,E,a,n)-R,x=(0,u.Ec)(t,k,d,E,f,n)-R;if(N){const e=["M",O-20*("left"===N.Join?-1:1)*(F?-1:1),W,"L",O,W,"L",C,x,"L",C-20*("left"===N.MateDirection?1:-1)*(A?-1:1),x].join(" ");r.push((0,_.jsx)("path",{d:e,"data-testid":"r2",pointerEvents:s?"auto":void 0,strokeWidth:M===v?10:5,onClick:()=>{const e=g.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:p.get(M)?.toJSON()});g.showWidget?.(e)},onMouseOver:()=>{m(M)},onMouseOut:()=>{m(void 0)}},JSON.stringify(e)))}else console.warn("the relevant ALT allele was not found, cannot render")}return r}))})})),[N]=[0,1,2,3],S=(0,n.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:s,views:l}=e,c=(0,a.getSession)(e),{assemblyManager:d}=c,g=e.getTrackFeatures(t),f=(0,o.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"paired_feature"===n.get("type")){const e=n.id().replace("-r1",""),r=n.id().replace("-r2","");n.id().endsWith("-r1")?(t.get(e)||t.set(e,[]),t.get(e).push(n)):n.id().endsWith("-r2")&&(t.get(r)||t.set(r,[]),t.get(r).push(n))}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(g))),[g,t,e]),[p,h]=(0,o.useState)(),v=(0,i.getSnapshot)(e);(0,u.E6)(v);const m=d.get(l[0].assemblyNames[0]);if(!m)return null;let k=0;if(r.current){const e=r.current.getBoundingClientRect();k=e.top}return(0,_.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":f.length?`${t}-loaded`:t,children:f.map((e=>{const r=[];for(let o=0;o<e.length-1;o+=1){const{layout:a,feature:i,level:d}=e[o],{layout:f,feature:v,level:w}=e[o+1],R=i.id();if(!a||!f)return null;const T=i.get("refName"),M=v.get("refName"),S=m.getCanonicalRefName(T),y=m.getCanonicalRefName(M);if(!S||!y)throw new Error(`unable to find ref for ${S||y}`);const L=(0,u.Tp)(l[d],S,a[N]),b=(0,u.Tp)(l[w],y,f[N]),O=l.map((e=>e.getTrack(t))),C=["M",L,(0,u.Ec)(t,d,l,O,a,n)-k,"L",b,(0,u.Ec)(t,w,l,O,f,n)-k].join(" ");r.push((0,_.jsx)("path",{d:C,"data-testid":"r2",pointerEvents:s?"auto":void 0,strokeWidth:R===p?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:g.get(R)?.toJSON()});c.showWidget?.(e)},onMouseOver:()=>{h(R)},onMouseOut:()=>{h(void 0)}},JSON.stringify(C)))}return r}))})})),[y]=[0,1,2,3];function L(e){return"+"===e?1:"-"===e?-1:0}const b=(0,n.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:s,views:l}=e,c=(0,a.getSession)(e),{assemblyManager:d}=c,g=e.getTrackFeatures(t),f=(0,o.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],r=new Set;for(const n of e.values())r.has(n.id())||"<TRA>"!==n.get("ALT")[0]||t.push([n]),r.add(n.id());return t}(g))),[g,t,e]),[p,h]=(0,o.useState)(),v=(0,i.getSnapshot)(e);if((0,u.E6)(v),!d.get(l[0].assemblyNames[0]))return null;let m=0;if(r.current){const e=r.current.getBoundingClientRect();m=e.top}return l.length<2?null:(0,_.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":f.length?`${t}-loaded`:t,children:f.map((e=>{const r=[];for(const{layout:o,feature:a,level:i}of e){const e=0===i?1:0,d=a.id();if(!o)return null;const f=a.get("INFO"),v=f.CHR2[0],k=f.END[0],w=f.STRANDS?.[0]?.split(""),[R,T]=w??[".","."],M=(0,u.Tp)(l[e],v,k);if(M){const f=[M,0,M+1,0],v=(0,u.Tp)(l[i],a.get("refName"),o[y]),k=M,w=l[i].pxToBp(v).reversed,N=l[e].pxToBp(k).reversed,S=l.map((e=>e.getTrack(t))),b=(0,u.Ec)(t,i,l,S,o,n)-m,O=(0,u.Ec)(t,e,l,S,f,n)-m,C=["M",v-20*L(R)*(w?-1:1),b,"L",v,b,"L",k,O,"L",k-20*L(T)*(N?-1:1),O].join(" ");r.push((0,_.jsx)("path",{d:C,pointerEvents:s?"auto":void 0,strokeWidth:d===p?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(g.get(d)||{toJSON:()=>{}}).toJSON()});c.showWidget?.(e)},onMouseOver:()=>{h(d)},onMouseOut:()=>{h(void 0)}},JSON.stringify(C)))}}return r}))})})),O=(0,n.observer)((function(e){const{model:t,trackId:r}=e,n=t.getMatchedTracks(r),o=n[0]?.type;return"AlignmentsTrack"===o?(0,_.jsx)(R,{...e}):"VariantTrack"===o?t.hasTranslocations(r)?(0,_.jsx)(b,{...e}):t.hasPairedFeatures(r)?(0,_.jsx)(S,{...e}):(0,_.jsx)(M,{...e}):null}))}}]);
//# sourceMappingURL=5727.4a8c7e1b.chunk.js.map