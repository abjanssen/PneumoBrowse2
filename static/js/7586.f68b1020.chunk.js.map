{"version":3,"file":"static/js/7586.f68b1020.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../plugins/alignments/src/LinearReadArcsDisplay/renderSvg.tsx","webpack://@jbrowse/web/../../plugins/linear-genome-view/src/BaseLinearDisplay/SVGLegend.tsx"],"sourcesContent":["import type React from 'react'\n\nimport {\n  getContainingView,\n  getRpcSessionId,\n  getSession,\n} from '@jbrowse/core/util'\nimport {\n  ReactRendering,\n  renderingToSvg,\n} from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { getSnapshot } from '@jbrowse/mobx-state-tree'\nimport { SVGLegend } from '@jbrowse/plugin-linear-genome-view'\n\nimport type { LinearReadArcsDisplayModel } from './model.ts'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface RenderingResult {\n  reactElement?: React.ReactNode\n  html?: string\n  canvasRecordedData?: unknown\n}\n\nexport async function renderSvg(\n  self: LinearReadArcsDisplayModel,\n  opts: ExportSvgDisplayOptions,\n) {\n  const view = getContainingView(self) as LGV\n  const session = getSession(self)\n  const { rpcManager, assemblyManager } = session\n  const height = opts.overrideHeight ?? self.height\n\n  const assemblyName = view.assemblyNames[0]\n  const assembly = assemblyName ? assemblyManager.get(assemblyName) : undefined\n  const sequenceAdapterConfig = assembly?.configuration?.sequence?.adapter\n  const sequenceAdapter = sequenceAdapterConfig\n    ? getSnapshot(sequenceAdapterConfig)\n    : undefined\n\n  // Serialize the full view snapshot for RPC\n  // Include staticBlocks and width which are not part of the regular snapshot\n  const viewSnapshot = structuredClone({\n    ...getSnapshot(view),\n    staticBlocks: view.staticBlocks,\n    width: view.width,\n  })\n\n  // Call RPC method with exportSVG options\n  // Use getRpcSessionId to ensure we use the same worker as normal rendering\n  const rpcSessionId = getRpcSessionId(self)\n  const rendering = (await rpcManager.call(\n    rpcSessionId,\n    'RenderLinearReadArcsDisplay',\n    {\n      sessionId: rpcSessionId,\n      view: viewSnapshot,\n      adapterConfig: self.adapterConfig,\n      sequenceAdapter,\n      config: getSnapshot(self.configuration),\n      ...self.renderProps(),\n      height,\n      exportSVG: opts,\n      theme: opts.theme,\n    },\n  )) as RenderingResult\n\n  const finalRendering = await renderingToSvg(\n    rendering,\n    view.staticBlocks.totalWidthPx,\n    height,\n  )\n\n  // Clip to the visible region (view width), not the full staticBlocks width\n  const visibleWidth = view.width\n\n  // Create a clip path to clip to the visible region\n  // Apply clipping BEFORE transform, at the view level\n  const clipId = `clip-${self.id}-svg`\n\n  // Get legend items if legend is enabled\n  const legendItems = self.showLegend ? self.legendItems() : []\n\n  return (\n    <>\n      <defs>\n        <clipPath id={clipId}>\n          <rect x={0} y={0} width={visibleWidth} height={height} />\n        </clipPath>\n      </defs>\n      <g clipPath={`url(#${clipId})`}>\n        <g transform={`translate(${Math.max(0, -view.offsetPx)} 0)`}>\n          <ReactRendering rendering={finalRendering} />\n        </g>\n      </g>\n      {legendItems.length > 0 ? (\n        <SVGLegend\n          items={legendItems}\n          width={visibleWidth}\n          legendAreaWidth={opts.legendWidth}\n        />\n      ) : null}\n    </>\n  )\n}\n","import { measureText } from '@jbrowse/core/util'\n\nimport type { LegendItem } from './components/FloatingLegend.tsx'\n\nconst LEGEND_FONT_SIZE = 10\nconst LEGEND_BOX_SIZE = 12\nconst LEGEND_PADDING = 3\n\nexport default function SVGLegend({\n  items,\n  width,\n  legendAreaWidth,\n}: {\n  items: LegendItem[]\n  width: number\n  legendAreaWidth?: number\n}) {\n  if (items.length === 0) {\n    return null\n  }\n\n  const itemHeight = LEGEND_BOX_SIZE + 2\n  const legendHeight = items.length * itemHeight + LEGEND_PADDING * 2\n\n  // Calculate legend width based on longest label\n  const maxLabelWidth = Math.max(\n    ...items.map(item => measureText(item.label, LEGEND_FONT_SIZE)),\n  )\n  const legendWidth = LEGEND_BOX_SIZE + 8 + maxLabelWidth + LEGEND_PADDING * 2\n\n  // If legendAreaWidth is provided, position legend to the right of the figure\n  // Otherwise, position it inside the figure area (top-right corner)\n  const x = legendAreaWidth ? width + 10 : width - legendWidth - 10\n  const y = 10\n\n  return (\n    <g transform={`translate(${x}, ${y})`}>\n      <rect\n        x={0}\n        y={0}\n        width={legendWidth}\n        height={legendHeight}\n        fill=\"rgba(255,255,255,0.9)\"\n        stroke=\"#ccc\"\n        strokeWidth={1}\n        rx={4}\n      />\n      {items.map((item, idx) => (\n        <g\n          key={`legend-${idx}`}\n          transform={`translate(${LEGEND_PADDING}, ${LEGEND_PADDING + idx * itemHeight})`}\n        >\n          {item.color ? (\n            <rect\n              x={0}\n              y={0}\n              width={LEGEND_BOX_SIZE}\n              height={LEGEND_BOX_SIZE}\n              fill={item.color}\n            />\n          ) : null}\n          <text\n            x={LEGEND_BOX_SIZE + 6}\n            y={LEGEND_BOX_SIZE - 2}\n            fontSize={LEGEND_FONT_SIZE}\n            fill=\"black\"\n          >\n            {item.label}\n          </text>\n        </g>\n      ))}\n    </g>\n  )\n}\n"],"names":["async","renderSvg","self","opts","view","getContainingView","session","getSession","rpcManager","assemblyManager","height","overrideHeight","assemblyName","assemblyNames","assembly","get","undefined","sequenceAdapterConfig","configuration","sequence","adapter","sequenceAdapter","getSnapshot","viewSnapshot","structuredClone","staticBlocks","width","rpcSessionId","getRpcSessionId","rendering","call","sessionId","adapterConfig","config","renderProps","exportSVG","theme","finalRendering","renderingToSvg","totalWidthPx","visibleWidth","clipId","id","legendItems","showLegend","_jsxs","_Fragment","children","_jsx","x","y","clipPath","transform","Math","max","offsetPx","ReactRendering","length","SVGLegend","items","legendAreaWidth","legendWidth","t0","$","_c","legendHeight","LEGEND_BOX_SIZE","LEGEND_PADDING","t1","map","_temp","t2","t3","t4","t5","fill","stroke","strokeWidth","rx","Symbol","for","item_0","idx","item","color","LEGEND_FONT_SIZE","label","measureText"],"sourceRoot":""}