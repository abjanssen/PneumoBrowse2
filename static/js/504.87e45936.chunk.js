"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[504],{40504(e,t,a){a.d(t,{default:()=>h});var s=a(48455),r=a(77251),n=a(53155),i=a(37974),o=a(33624),l=a(94645),c=a(86618);class h extends s.L{intervalTrees={};async getNames(){const{header:e,columnNames:t}=await this.loadData();if(t.length)return t;const a=e.split(/\n|\r\n|\r/).filter(e=>!!e).at(-1);return a?.includes("\t")?a.slice(1).split("\t").map(e=>e.trim()):void 0}async loadFeatureIntervalTreeHelper(e){const{features:t}=await this.loadData(),a=t[e];if(!a)return;const s=(await this.getNames())?.slice(3)||[],r=new i.M;for(let e=0,t=a.length;e<t;e++){const t=a[e],[i,o,l,...c]=t.split("\t");for(let t=0,a=c.length;t<a;t++){const a=`${this.id}-${i}-${e}-${t}`,h=+o,u=+l,d=+c[t],f=s[t]||`col${t}`;d&&r.insert([h,u],new n.A({id:a,data:{refName:i,start:h,end:u,score:d,source:f}}))}}return r}async getRefNames(e={}){const{features:t}=await this.loadData(e);return Object.keys(t)}async loadDataP(e={}){const t=this.pluginManager,a=this.getConf("bedGraphLocation"),s=await(0,r.fetchAndMaybeUnzip)((0,o.openLocation)(a,t),e),n={},i=[];(0,l.P)(s,e=>{if(e.startsWith("#"))i.push(e);else{const t=e.indexOf("\t"),a=e.slice(0,t);n[a]||(n[a]=[]),n[a].push(e)}return!0},e.statusCallback);const c=this.getConf("columnNames");return{header:i.join("\n"),features:n,columnNames:c}}async loadFeatureIntervalTree(e){return this.intervalTrees[e]||(this.intervalTrees[e]=this.loadFeatureIntervalTreeHelper(e).catch(t=>{throw this.intervalTrees[e]=void 0,t})),this.intervalTrees[e]}async loadData(e={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(e).catch(e=>{throw this.bedFeatures=void 0,e})),this.bedFeatures}getFeatures(e,t={}){return(0,c.ObservableCreate)(async t=>{const{start:a,end:s,refName:r}=e,n=await this.loadFeatureIntervalTree(r);for(const e of n?.search([a,s])||[])t.next(e);t.complete()})}}},94645(e,t,a){a.d(t,{P:()=>r});var s=a(77251);function r(e,t,a=()=>{}){const r=new TextDecoder("utf8");let n=0,i=0;for(;n<e.length;){const o=e.indexOf(10,n),l=-1===o?e.length:o,c=e.subarray(n,l),h=r.decode(c).trim();if(h&&!1===t(h,i))break;i++%1e4==0&&a(`Loading ${(0,s.getProgressDisplayStr)(n,e.length)}`),n=l+1}}}}]);
//# sourceMappingURL=504.87e45936.chunk.js.map