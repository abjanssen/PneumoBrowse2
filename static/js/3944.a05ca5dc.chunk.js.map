{"version":3,"file":"static/js/3944.a05ca5dc.chunk.js","mappings":"+MAgBA,MAwGA,GAxG6BA,EAAAA,EAAAA,UAAS,SAA8BC,GAUlE,MAAM,QAAEC,EAAO,SAAEC,EAAQ,QAAEC,EAAO,MAAEC,EAAK,OAAEC,EAAM,QAAEC,EAAO,aAAEC,GAC1DP,EACIQ,EAASP,EAAQ,GACjBQ,GAAMC,EAAAA,EAAAA,QAAuB,OAC7B,WAAEC,GAAeJ,EAEvB,SAASK,EAAqBC,EAAsBC,GAClD,IAAKL,EAAIM,QACP,OAEF,MAAMC,EAAOP,EAAIM,QAAQE,wBACnBC,EAAUL,EAAeG,EAAKG,KAC9BC,EAAUN,EAAeE,EAAKK,IAC9BC,EAAShB,EAAQiB,KAAKC,MAAOJ,EAAUf,EAAUC,EAAQmB,SAC/D,IAAKH,EACH,OAEF,MAAMI,EAAKlB,EAAOmB,SAAWvB,EAAQc,EAAUA,EACzCU,EAAcpB,EAAOqB,MAAQ1B,EAAUuB,EAC7C,IAAII,EACJ,GAAInB,GACF,IAAK,MAAMoB,KAAW7B,EAAS8B,SAC7B,GAAID,EAAQE,IAAI,YAAcX,EAAOY,MAInCN,GAAeG,EAAQE,IAAI,OAAS9B,GACpCyB,GAAeG,EAAQE,IAAI,SAC3B,CACAH,EAAoBC,EACpB,KACF,MAEG,CACL,MAAMI,EAAqB,GAC3B,IAAK,MAAMJ,KAAW7B,EAAS8B,SAE3BJ,GAAeG,EAAQE,IAAI,OAAS9B,GACpCyB,GAAeG,EAAQE,IAAI,UAE3BE,EAAmBC,KAAKL,GAI5B,GAAII,EAAmBV,OAAQ,CAC7B,MAAMY,EAAMd,KAAKC,MAAMI,GACvBE,EAAoB,IAAIQ,EAAAA,EAAc,CACpCC,SAAU,gBACVjC,QAASkC,OAAOC,YACdN,EACGO,IAAIC,GAAKA,EAAEC,UACXF,IAAIC,IACH,MAAM,QAAEE,EAAO,MAAEhB,EAAK,IAAEiB,EAAG,OAAExB,KAAWyB,GAASJ,EACjD,MAAO,CAACrB,EAAQyB,SAGnBvC,EACHqB,MAAOQ,EACPS,IAAKT,EAAM,GAEf,CACF,CACA,OAAOP,CACT,CAEA,OACEkB,EAAAA,EAAAA,KAAA,OACEvC,IAAKA,EACLwC,YAAaC,IACX,MAAM,QAAEC,EAAO,QAAEC,GAAYF,EACvBpB,EAAoBlB,EAAqBuC,EAASC,GACxD7C,EAAa8C,qBAAqBvB,IAEpCwB,QAASJ,IACP,MAAM,QAAEC,EAAO,QAAEC,GAAYF,EACvBpB,EAAoBlB,EAAqBuC,EAASC,GACpDtB,GACFvB,EAAagD,cAAczB,IAG/B0B,aAAcA,KACZjD,EAAa8C,0BAAqBI,IAEpCC,MAAO,CACLC,SAAU,UACVC,SAAU,WACVvD,UACAwD,UAEFb,EAAAA,EAAAA,KAACc,EAAAA,EAAiB,IAAK9D,KAG7B,E","sources":["webpack://@jbrowse/web/../../plugins/wiggle/src/MultiWiggleRendering.tsx"],"sourcesContent":["import { useRef } from 'react'\n\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { SimpleFeature } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { Source } from './util.ts'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Region } from '@jbrowse/core/util/types'\n\ninterface MultiWiggleDisplayModel {\n  isMultiRow: boolean\n  setFeatureUnderMouse: (f?: Feature) => void\n  selectFeature: (f: Feature) => void\n}\n\nconst MultiWiggleRendering = observer(function MultiWiggleRendering(props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  blockKey: string\n  sources: Source[]\n  displayModel: MultiWiggleDisplayModel\n}) {\n  const { regions, features, bpPerPx, width, height, sources, displayModel } =\n    props\n  const region = regions[0]!\n  const ref = useRef<HTMLDivElement>(null)\n  const { isMultiRow } = displayModel\n\n  function getFeatureUnderMouse(eventClientX: number, eventClientY: number) {\n    if (!ref.current) {\n      return\n    }\n    const rect = ref.current.getBoundingClientRect()\n    const offsetX = eventClientX - rect.left\n    const offsetY = eventClientY - rect.top\n    const source = sources[Math.floor((offsetY / height) * sources.length)]\n    if (!source) {\n      return\n    }\n    const px = region.reversed ? width - offsetX : offsetX\n    const mouseoverBp = region.start + bpPerPx * px\n    let featureUnderMouse: Feature | undefined\n    if (isMultiRow) {\n      for (const feature of features.values()) {\n        if (feature.get('source') !== source.name) {\n          continue\n        }\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featureUnderMouse = feature\n          break\n        }\n      }\n    } else {\n      const featuresUnderMouse = []\n      for (const feature of features.values()) {\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featuresUnderMouse.push(feature)\n        }\n      }\n\n      if (featuresUnderMouse.length) {\n        const pos = Math.floor(mouseoverBp)\n        featureUnderMouse = new SimpleFeature({\n          uniqueId: 'mouseoverfeat',\n          sources: Object.fromEntries(\n            featuresUnderMouse\n              .map(f => f.toJSON())\n              .map(f => {\n                const { refName, start, end, source, ...rest } = f\n                return [source, rest]\n              }),\n          ),\n          ...region,\n          start: pos,\n          end: pos + 1,\n        })\n      }\n    }\n    return featureUnderMouse\n  }\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={event => {\n        const { clientX, clientY } = event\n        const featureUnderMouse = getFeatureUnderMouse(clientX, clientY)\n        displayModel.setFeatureUnderMouse(featureUnderMouse)\n      }}\n      onClick={event => {\n        const { clientX, clientY } = event\n        const featureUnderMouse = getFeatureUnderMouse(clientX, clientY)\n        if (featureUnderMouse) {\n          displayModel.selectFeature(featureUnderMouse)\n        }\n      }}\n      onMouseLeave={() => {\n        displayModel.setFeatureUnderMouse(undefined)\n      }}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n})\n\nexport default MultiWiggleRendering\n"],"names":["observer","props","regions","features","bpPerPx","width","height","sources","displayModel","region","ref","useRef","isMultiRow","getFeatureUnderMouse","eventClientX","eventClientY","current","rect","getBoundingClientRect","offsetX","left","offsetY","top","source","Math","floor","length","px","reversed","mouseoverBp","start","featureUnderMouse","feature","values","get","name","featuresUnderMouse","push","pos","SimpleFeature","uniqueId","Object","fromEntries","map","f","toJSON","refName","end","rest","_jsx","onMouseMove","event","clientX","clientY","setFeatureUnderMouse","onClick","selectFeature","onMouseLeave","undefined","style","overflow","position","children","PrerenderedCanvas"],"sourceRoot":""}