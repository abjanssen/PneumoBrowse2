{"version":3,"file":"static/js/419.94c9c0a7.chunk.js","mappings":"gKAcO,SAASA,EAAkBC,EAAmBC,GACnD,IAAKA,GAAgC,IAAnBD,EAAQE,OACxB,OAAOF,EAKT,IADqBA,EAAQG,KAAKC,GAAUH,KAAaG,GAEvD,OAAOJ,EAIT,MAAMK,EAAS,IAAIC,IACnB,IAAK,MAAMF,KAAUJ,EAAS,CAC5B,MAAMO,EAAMC,OAAOJ,EAAOH,IAAc,IACxCI,EAAOI,IAAIF,GAAMF,EAAOK,IAAIH,IAAQ,GAAK,EAC3C,CAGA,MAAMI,EAAWC,OAAOC,YACtB,IAAIR,EAAOS,WACRC,KAAK,CAACC,EAAGC,IAAMD,EAAE,GAAKC,EAAE,IACxBC,IAAI,EAAEX,GAAMY,IAAQ,CAACZ,EAAKa,EAAAA,KAAKD,KAAQE,EAAAA,EAAAA,aAAYd,MAIxD,OAAOP,EAAQkB,IAAId,IAAU,IACxBA,EACHkB,MAAOX,EAASH,OAAOJ,EAAOH,IAAc,OAEhD,C,+JCjCO,SAASsB,EAA0BC,ICCnC,SAAuCA,IAU5CC,EAAAA,EAAAA,aACED,GACAE,EAAAA,EAAAA,SACEC,UACE,IAEE,KAAKC,EAAAA,EAAAA,SAAQJ,IAASA,EAAKK,YACzB,OAGF,KADaC,EAAAA,EAAAA,mBAAkBN,GACrBO,YACR,OAEF,MAAM,WAAEC,IAAeC,EAAAA,EAAAA,YAAWT,IAC5B,cAAEU,GAAkBV,EACpBW,GAAYC,EAAAA,EAAAA,MAClBZ,EAAKa,kBAAkBF,GACvB,MAAMG,GAAYC,EAAAA,EAAAA,iBAAgBf,GAC5BxB,QAAiBgC,EAAWQ,KAChCF,EACA,yBACA,CACEA,YACAJ,gBACAC,YACAM,eAAiBC,KACXd,EAAAA,EAAAA,SAAQJ,IACVA,EAAKmB,iBAAiBD,OAK1Bd,EAAAA,EAAAA,SAAQJ,IACVA,EAAKoB,WAAW5C,EAEpB,CAAE,MAAO6C,KACFC,EAAAA,EAAAA,IAAiBD,KAAMjB,EAAAA,EAAAA,SAAQJ,KAClCuB,QAAQC,MAAMH,IACdZ,EAAAA,EAAAA,YAAWT,GAAMyB,YAAY,GAAGJ,IAAKA,GAEzC,GAEF,CACEK,MAAO,IACPC,KAAM,2BAId,CD1DEC,CAA8B5B,GEKzB,SAAwCA,IAgB7CC,EAAAA,EAAAA,aACED,GACAE,EAAAA,EAAAA,SACEC,UACE,IAEE,KAAKC,EAAAA,EAAAA,SAAQJ,IAASA,EAAKK,YACzB,OAEF,MAAMwB,GAAOvB,EAAAA,EAAAA,mBAAkBN,GAC/B,IACG6B,EAAKtB,cACLP,EAAK8B,6CAEN,OAGF,MAAMnB,GAAYC,EAAAA,EAAAA,MAClBZ,EAAK+B,6BAA6BpB,GAClC,MAAM,WAAEH,IAAeC,EAAAA,EAAAA,YAAWT,IAC5B,mBACJgC,EAAkB,QAClBxD,EAAO,2BACPyD,EAA0B,cAC1BvB,GACEV,EACJ,GAAIxB,EAAS,CACX,MAAMsC,GAAYC,EAAAA,EAAAA,iBAAgBf,IAC5B,WAAEkC,EAAU,UAAEC,EAAS,SAAEC,SAAoB5B,EAAWQ,KAC5DF,EACA,oCACA,CACEuB,QAASR,EAAKS,cAAcC,cAC5B/D,UACAyD,6BACAD,qBACAlB,YACAJ,gBACAC,YACAM,eAAiBC,KACXd,EAAAA,EAAAA,SAAQJ,IACVA,EAAKmB,iBAAiBD,OAS1Bd,EAAAA,EAAAA,SAAQJ,KACVA,EAAKwC,aAAaL,GAClBnC,EAAKyC,cAAcP,GACnBlC,EAAK0C,YAAYN,EAAS1C,IAAIiD,GAAK,IAAIC,EAAAA,EAAcD,KAEzD,CACF,CAAE,MAAOtB,GACPE,QAAQC,MAAMH,KACTC,EAAAA,EAAAA,IAAiBD,KAAMjB,EAAAA,EAAAA,SAAQJ,KAClCS,EAAAA,EAAAA,YAAWT,GAAMyB,YAAY,GAAGJ,IAAKA,EAEzC,GAEF,CACEK,MAAO,IACPC,KAAM,yBAId,CFzFEkB,CAA+B7C,GGY1B,SAAiCA,IAEtCC,EAAAA,EAAAA,aACED,GACAE,EAAAA,EAAAA,SACE,WAEE,KAAKE,EAAAA,EAAAA,SAAQJ,IAASA,EAAKK,YACzB,OAEF,MAAM,WACJyC,EAAU,UACVC,EAAS,cACTC,EAAa,OACbC,EAAM,UACNC,EAKAC,YAAaC,GACXpD,EAEJ,IAAK8C,IAAeC,EAClB,OAGF,MAAMM,EAAMP,EAAWQ,WAAW,MAClC,GAAKD,EAAL,CAKAA,EAAIE,iBACJF,EAAIG,MAAM,EAAG,GACbH,EAAII,UAAU,EAAG,EAAGT,EAAeC,GAGnCI,EAAIK,UAAU,GAAIR,GAClBG,EAAIM,YAAc,QAClBN,EAAIO,UAAY,EAGhBP,EAAIQ,YACJ,IAAK,MAAMC,KAAQf,EAAUgB,QAAS,CACpC,MAAM,OAAEnF,EAAM,OAAEoF,GAAWF,EACrBG,EAAKrF,EAAOsF,EACZC,EAAKH,EAAOE,EACZE,EAAKJ,EAAOK,EACZC,EAAK1F,EAAOyF,EAGlBhB,EAAIkB,OAAOD,EAAIL,GACfZ,EAAImB,OAAOF,EAAIH,GAGfd,EAAIkB,OAAOD,EAAIH,GACfd,EAAImB,OAAOJ,EAAID,EACjB,CACAd,EAAIoB,QA7BJ,CA8BF,EACA,CACE9C,KAAM,eAMZ1B,EAAAA,EAAAA,aACED,GACAE,EAAAA,EAAAA,SACE,WAEE,KAAKE,EAAAA,EAAAA,SAAQJ,IAASA,EAAKK,YACzB,OAEF,MAAM,gBACJqE,EAAe,UACf3B,EAAS,UACT4B,EAAS,gBACTC,EAAe,OACf3B,EAAM,UACNC,EAAS,QACT1E,EAAO,YAKP2E,GACEnD,EACJ,IAAK0E,EACH,OAGF,MAAMrB,EAAMqB,EAAgBpB,WAAW,MACvC,IAAKD,EACH,OAGF,MACMwB,GADOvE,EAAAA,EAAAA,mBAAkBN,GACR8E,MAIvB,GAFAzB,EAAII,UAAU,EAAG,EAAGoB,EAAW5B,GAE3BF,GAAa6B,GAAmBpG,EAAS,CAE3C6E,EAAI0B,OAGJ1B,EAAIK,UAAU,GAAIR,GAKlBG,EAAI2B,UAAY,sBAChB,MAAMC,EAAgB,IAAIC,IAAIN,EAAgBO,iBAC9C,IAAK,IAAIC,EAAI,EAAGC,EAAI7G,EAAQE,OAAQ0G,EAAIC,EAAGD,IAAK,CAC9C,MAAMxG,EAASJ,EAAQ4G,GACvB,GAAIH,EAAcK,IAAI1G,EAAO+C,MAAO,CAClC,MAAM0C,GAAKe,EAAI,IAAOT,EACtBtB,EAAIkC,SAAS,EAAGlB,EAAIM,EAAY,EAAGE,EAAWF,EAChD,CACF,CAGA,MAAM,KAAEa,GAASZ,EACjBvB,EAAI2B,UAAY,sBAChB3B,EAAIQ,YACJR,EAAIoC,IAAID,EAAKnB,EAAImB,EAAKtB,EAAI,EAAG,EAAG,EAAIwB,KAAKC,IACzCtC,EAAIuC,OAGJvC,EAAIM,YAAc,oBAClBN,EAAIO,UAAY,EAChBP,EAAIoB,SAGJpB,EAAIwC,SACN,CACF,EACA,CAAElE,KAAM,cAGd,CH1JEmE,CAAwB9F,GIDnB,SAA6BA,IAQlCC,EAAAA,EAAAA,aACED,GACAE,EAAAA,EAAAA,SACE,KACE,KAAKE,EAAAA,EAAAA,SAAQJ,GACX,OAIF,GAAIA,EAAK+F,eACP,OAIF,MAAMvH,EAAUwB,EAAKgG,gBACrB,IAAKxH,GAA8B,IAAnBA,EAAQE,OACtB,OAIF,GAAIsB,EAAKiG,OAAOvH,OAAS,EAEvB,YADAsB,EAAKkG,mBAAkB,GAKzB,MAAMC,GAAUC,EAAAA,EAAAA,IAAQpG,EAAM,WAC9B,IAAKmG,EAEH,YADAnG,EAAKkG,mBAAkB,GAMzB,IADqB1H,EAAQG,KAAKC,GAAUuH,KAAWvH,GAOrD,OALA2C,QAAQ8E,KACN,sBAAsBF,0DACK/G,OAAOkH,KAAK9H,EAAQ,IAAM,CAAC,GAAG+H,KAAK,cAEhEvG,EAAKkG,mBAAkB,GAKzB,MAAMM,GAAiBjI,EAAAA,EAAAA,GAAkBC,EAAS2H,GAClDnG,EAAKyG,UAAUD,GAAgB,GAC/BxG,EAAKkG,mBAAkB,IAEzB,CACEvE,KAAM,mBAId,CJ3DE+E,CAAoB1G,EACtB,C","sources":["webpack://@jbrowse/web/../../plugins/variants/src/shared/applyColorPalette.ts","webpack://@jbrowse/web/../../plugins/variants/src/shared/setupMultiVariantAutoruns.ts","webpack://@jbrowse/web/../../plugins/variants/src/shared/getMultiVariantSourcesAutorun.ts","webpack://@jbrowse/web/../../plugins/variants/src/shared/getMultiVariantFeaturesAutorun.ts","webpack://@jbrowse/web/../../plugins/variants/src/shared/treeDrawingAutorun.ts","webpack://@jbrowse/web/../../plugins/variants/src/shared/colorByAutorun.ts"],"sourcesContent":["import { set1 } from '@jbrowse/core/ui/colors'\nimport { randomColor } from '@jbrowse/core/util/color'\n\nimport type { Source } from './types.ts'\n\n/**\n * Applies a color palette to sources based on a metadata attribute.\n * Colors are assigned based on the frequency of values, with less common\n * values getting colors first from the set1 palette.\n *\n * @param sources - The source array to apply colors to\n * @param attribute - The metadata attribute to color by\n * @returns A new array of sources with colors applied\n */\nexport function applyColorPalette(sources: Source[], attribute: string) {\n  if (!attribute || sources.length === 0) {\n    return sources\n  }\n\n  // Check if any source has the attribute\n  const hasAttribute = sources.some(source => attribute in source)\n  if (!hasAttribute) {\n    return sources\n  }\n\n  // Count occurrences of each value\n  const counts = new Map<string, number>()\n  for (const source of sources) {\n    const key = String(source[attribute] ?? '')\n    counts.set(key, (counts.get(key) || 0) + 1)\n  }\n\n  // Create color map, sorting by frequency (least common first gets colors first)\n  const colorMap = Object.fromEntries(\n    [...counts.entries()]\n      .sort((a, b) => a[1] - b[1])\n      .map(([key], idx) => [key, set1[idx] || randomColor(key)]),\n  )\n\n  // Apply colors to sources\n  return sources.map(source => ({\n    ...source,\n    color: colorMap[String(source[attribute] ?? '')],\n  }))\n}\n","import { setupColorByAutorun } from './colorByAutorun.ts'\nimport { getMultiVariantFeaturesAutorun } from './getMultiVariantFeaturesAutorun.ts'\nimport { getMultiVariantSourcesAutorun } from './getMultiVariantSourcesAutorun.ts'\nimport { setupTreeDrawingAutorun } from './treeDrawingAutorun.ts'\n\nimport type { MultiVariantBaseModel } from './MultiVariantBaseModel.ts'\n\n/**\n * Sets up the autoruns for multi-variant displays.\n * This is shared between MultiLinearVariantDisplay and LinearVariantMatrixDisplay.\n */\nexport function setupMultiVariantAutoruns(self: MultiVariantBaseModel) {\n  getMultiVariantSourcesAutorun(self)\n  getMultiVariantFeaturesAutorun(self)\n  setupTreeDrawingAutorun(self)\n  setupColorByAutorun(self)\n}\n","import { getContainingView, getSession } from '@jbrowse/core/util'\nimport { isAbortException } from '@jbrowse/core/util/aborting'\nimport { createStopToken } from '@jbrowse/core/util/stopToken'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type { Source } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { StopToken } from '@jbrowse/core/util/stopToken'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function getMultiVariantSourcesAutorun(self: {\n  configuration: AnyConfigurationModel\n  adapterConfig: AnyConfigurationModel\n  isMinimized: boolean\n  adapterProps: () => Record<string, unknown>\n  setSourcesLoading: (aborter: StopToken) => void\n  setError: (error: unknown) => void\n  setStatusMessage: (str: string) => void\n  setSources: (sources: Source[]) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      async () => {\n        try {\n          // isAlive check guards against display being destroyed during async import\n          if (!isAlive(self) || self.isMinimized) {\n            return\n          }\n          const view = getContainingView(self) as LinearGenomeViewModel\n          if (!view.initialized) {\n            return\n          }\n          const { rpcManager } = getSession(self)\n          const { adapterConfig } = self\n          const stopToken = createStopToken()\n          self.setSourcesLoading(stopToken)\n          const sessionId = getRpcSessionId(self)\n          const sources = (await rpcManager.call(\n            sessionId,\n            'MultiVariantGetSources',\n            {\n              sessionId,\n              adapterConfig,\n              stopToken,\n              statusCallback: (arg: string) => {\n                if (isAlive(self)) {\n                  self.setStatusMessage(arg)\n                }\n              },\n            },\n          )) as Source[]\n          if (isAlive(self)) {\n            self.setSources(sources)\n          }\n        } catch (e) {\n          if (!isAbortException(e) && isAlive(self)) {\n            console.error(e)\n            getSession(self).notifyError(`${e}`, e)\n          }\n        }\n      },\n      {\n        delay: 1000,\n        name: 'GetMultiVariantSources',\n      },\n    ),\n  )\n}\n","import {\n  SimpleFeature,\n  getContainingView,\n  getSession,\n} from '@jbrowse/core/util'\nimport { isAbortException } from '@jbrowse/core/util/aborting'\nimport { createStopToken } from '@jbrowse/core/util/stopToken'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type { SampleInfo, Source } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, SimpleFeatureSerialized } from '@jbrowse/core/util'\nimport type { StopToken } from '@jbrowse/core/util/stopToken'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function getMultiVariantFeaturesAutorun(self: {\n  configuration: AnyConfigurationModel\n  adapterConfig: AnyConfigurationModel\n  sources?: Source[]\n  minorAlleleFrequencyFilter: number\n  lengthCutoffFilter: number\n  featureDensityStatsReadyAndRegionNotTooLarge: boolean\n  isMinimized: boolean\n  adapterProps: () => Record<string, unknown>\n  setError: (error: unknown) => void\n  setFeatures: (f: Feature[]) => void\n  setStatusMessage: (str: string) => void\n  setHasPhased: (arg: boolean) => void\n  setSampleInfo: (arg: Record<string, SampleInfo>) => void\n  setSimplifiedFeaturesLoading: (arg: StopToken) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      async () => {\n        try {\n          // isAlive check guards against display being destroyed during async import\n          if (!isAlive(self) || self.isMinimized) {\n            return\n          }\n          const view = getContainingView(self) as LinearGenomeViewModel\n          if (\n            !view.initialized ||\n            !self.featureDensityStatsReadyAndRegionNotTooLarge\n          ) {\n            return\n          }\n\n          const stopToken = createStopToken()\n          self.setSimplifiedFeaturesLoading(stopToken)\n          const { rpcManager } = getSession(self)\n          const {\n            lengthCutoffFilter,\n            sources,\n            minorAlleleFrequencyFilter,\n            adapterConfig,\n          } = self\n          if (sources) {\n            const sessionId = getRpcSessionId(self)\n            const { sampleInfo, hasPhased, features } = (await rpcManager.call(\n              sessionId,\n              'MultiVariantGetSimplifiedFeatures',\n              {\n                regions: view.dynamicBlocks.contentBlocks,\n                sources,\n                minorAlleleFrequencyFilter,\n                lengthCutoffFilter,\n                sessionId,\n                adapterConfig,\n                stopToken,\n                statusCallback: (arg: string) => {\n                  if (isAlive(self)) {\n                    self.setStatusMessage(arg)\n                  }\n                },\n              },\n            )) as {\n              sampleInfo: Record<string, SampleInfo>\n              hasPhased: boolean\n              features: SimpleFeatureSerialized[]\n            }\n            if (isAlive(self)) {\n              self.setHasPhased(hasPhased)\n              self.setSampleInfo(sampleInfo)\n              self.setFeatures(features.map(f => new SimpleFeature(f)))\n            }\n          }\n        } catch (e) {\n          console.error(e)\n          if (!isAbortException(e) && isAlive(self)) {\n            getSession(self).notifyError(`${e}`, e)\n          }\n        }\n      },\n      {\n        delay: 1000,\n        name: 'MultiVariantFeatures',\n      },\n    ),\n  )\n}\n","import { getContainingView } from '@jbrowse/core/util'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type {\n  ClusterHierarchyNode,\n  HoveredTreeNode,\n} from './components/types.ts'\nimport type { Source } from './types.ts'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ninterface TreeDrawingModel {\n  treeCanvas?: HTMLCanvasElement\n  mouseoverCanvas?: HTMLCanvasElement\n  hierarchy?: ClusterHierarchyNode\n  treeAreaWidth: number\n  height: number\n  scrollTop: number\n  rowHeight: number\n  totalHeight: number\n  hoveredTreeNode?: HoveredTreeNode\n  sources?: Source[]\n  isMinimized: boolean\n}\n\nexport function setupTreeDrawingAutorun(self: TreeDrawingModel) {\n  // Draw tree structure\n  addDisposer(\n    self,\n    autorun(\n      function treeDrawAutorun() {\n        // isAlive check guards against display being destroyed during async import\n        if (!isAlive(self) || self.isMinimized) {\n          return\n        }\n        const {\n          treeCanvas,\n          hierarchy,\n          treeAreaWidth,\n          height,\n          scrollTop,\n          // IMPORTANT: We must access totalHeight for MobX to track it as a dependency.\n          // Without this, the autorun won't re-run when row height changes.\n          // Do not remove - this ensures the tree redraws when row height changes.\n          // eslint-disable-next-line  @typescript-eslint/no-unused-vars\n          totalHeight: _totalHeight,\n        } = self\n\n        if (!treeCanvas || !hierarchy) {\n          return\n        }\n\n        const ctx = treeCanvas.getContext('2d')\n        if (!ctx) {\n          return\n        }\n\n        // Clear the entire canvas\n        ctx.resetTransform()\n        ctx.scale(2, 2)\n        ctx.clearRect(0, 0, treeAreaWidth, height)\n\n        // Translate to simulate scrolling\n        ctx.translate(0, -scrollTop)\n        ctx.strokeStyle = '#0008'\n        ctx.lineWidth = 1\n\n        // Use single path for all tree lines for better performance\n        ctx.beginPath()\n        for (const link of hierarchy.links()) {\n          const { source, target } = link\n          const sy = source.x!\n          const ty = target.x!\n          const tx = target.y!\n          const sx = source.y!\n\n          // Vertical line\n          ctx.moveTo(sx, sy)\n          ctx.lineTo(sx, ty)\n\n          // Horizontal line\n          ctx.moveTo(sx, ty)\n          ctx.lineTo(tx, ty)\n        }\n        ctx.stroke()\n      },\n      {\n        name: 'TreeDraw',\n      },\n    ),\n  )\n\n  // Draw hover highlights\n  addDisposer(\n    self,\n    autorun(\n      function treeHoverAutorun() {\n        // isAlive check guards against display being destroyed during async import\n        if (!isAlive(self) || self.isMinimized) {\n          return\n        }\n        const {\n          mouseoverCanvas,\n          hierarchy,\n          rowHeight,\n          hoveredTreeNode,\n          height,\n          scrollTop,\n          sources,\n          // IMPORTANT: We must access totalHeight for MobX to track it as a dependency.\n          // Without this, the autorun won't re-run when row height changes.\n          // Do not remove - this ensures highlights redraw when row height changes.\n          // eslint-disable-next-line  @typescript-eslint/no-unused-vars\n          totalHeight,\n        } = self\n        if (!mouseoverCanvas) {\n          return\n        }\n\n        const ctx = mouseoverCanvas.getContext('2d')\n        if (!ctx) {\n          return\n        }\n\n        const view = getContainingView(self) as LinearGenomeViewModel\n        const viewWidth = view.width\n\n        ctx.clearRect(0, 0, viewWidth, height)\n\n        if (hierarchy && hoveredTreeNode && sources) {\n          // Save the context state\n          ctx.save()\n\n          // Translate to simulate scrolling\n          ctx.translate(0, -scrollTop)\n\n          // Draw highlight rectangles for descendant leaf rows\n          // In phased mode, each sample name may correspond to multiple rows\n          // (e.g., SAMPLE1 -> SAMPLE1 HP0, SAMPLE1 HP1)\n          ctx.fillStyle = 'rgba(255,165,0,0.2)'\n          const descendantSet = new Set(hoveredTreeNode.descendantNames)\n          for (let i = 0, l = sources.length; i < l; i++) {\n            const source = sources[i]!\n            if (descendantSet.has(source.name)) {\n              const y = (i + 0.5) * rowHeight\n              ctx.fillRect(0, y - rowHeight / 2, viewWidth, rowHeight)\n            }\n          }\n\n          // Draw circle at the hovered node\n          const { node } = hoveredTreeNode\n          ctx.fillStyle = 'rgba(255,165,0,0.8)'\n          ctx.beginPath()\n          ctx.arc(node.y!, node.x!, 4, 0, 2 * Math.PI)\n          ctx.fill()\n\n          // Add a border to the circle\n          ctx.strokeStyle = 'rgba(255,140,0,1)'\n          ctx.lineWidth = 1\n          ctx.stroke()\n\n          // Restore the context state\n          ctx.restore()\n        }\n      },\n      { name: 'TreeHover' },\n    ),\n  )\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport { applyColorPalette } from './applyColorPalette.ts'\n\nimport type { Source } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\n/**\n * Sets up an autorun that applies a color palette to sources based on the\n * colorBy config option when sources are first loaded.\n */\nexport function setupColorByAutorun(self: {\n  configuration: AnyConfigurationModel\n  sourcesVolatile: Source[] | undefined\n  layout: Source[]\n  colorByApplied: boolean\n  setLayout: (layout: Source[], clearTree?: boolean) => void\n  setColorByApplied: (value: boolean) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      () => {\n        if (!isAlive(self)) {\n          return\n        }\n\n        // Only apply once\n        if (self.colorByApplied) {\n          return\n        }\n\n        // Wait for sources to be loaded\n        const sources = self.sourcesVolatile\n        if (!sources || sources.length === 0) {\n          return\n        }\n\n        // Don't override existing layout (user customization)\n        if (self.layout.length > 0) {\n          self.setColorByApplied(true)\n          return\n        }\n\n        // Check if colorBy config is set\n        const colorBy = getConf(self, 'colorBy') as string\n        if (!colorBy) {\n          self.setColorByApplied(true)\n          return\n        }\n\n        // Check if the attribute exists in the sources\n        const hasAttribute = sources.some(source => colorBy in source)\n        if (!hasAttribute) {\n          console.warn(\n            `colorBy attribute \"${colorBy}\" not found in sample metadata. ` +\n              `Available attributes: ${Object.keys(sources[0] || {}).join(', ')}`,\n          )\n          self.setColorByApplied(true)\n          return\n        }\n\n        // Apply the color palette\n        const coloredSources = applyColorPalette(sources, colorBy)\n        self.setLayout(coloredSources, false)\n        self.setColorByApplied(true)\n      },\n      {\n        name: 'ColorByAutorun',\n      },\n    ),\n  )\n}\n"],"names":["applyColorPalette","sources","attribute","length","some","source","counts","Map","key","String","set","get","colorMap","Object","fromEntries","entries","sort","a","b","map","idx","set1","randomColor","color","setupMultiVariantAutoruns","self","addDisposer","autorun","async","isAlive","isMinimized","getContainingView","initialized","rpcManager","getSession","adapterConfig","stopToken","createStopToken","setSourcesLoading","sessionId","getRpcSessionId","call","statusCallback","arg","setStatusMessage","setSources","e","isAbortException","console","error","notifyError","delay","name","getMultiVariantSourcesAutorun","view","featureDensityStatsReadyAndRegionNotTooLarge","setSimplifiedFeaturesLoading","lengthCutoffFilter","minorAlleleFrequencyFilter","sampleInfo","hasPhased","features","regions","dynamicBlocks","contentBlocks","setHasPhased","setSampleInfo","setFeatures","f","SimpleFeature","getMultiVariantFeaturesAutorun","treeCanvas","hierarchy","treeAreaWidth","height","scrollTop","totalHeight","_totalHeight","ctx","getContext","resetTransform","scale","clearRect","translate","strokeStyle","lineWidth","beginPath","link","links","target","sy","x","ty","tx","y","sx","moveTo","lineTo","stroke","mouseoverCanvas","rowHeight","hoveredTreeNode","viewWidth","width","save","fillStyle","descendantSet","Set","descendantNames","i","l","has","fillRect","node","arc","Math","PI","fill","restore","setupTreeDrawingAutorun","colorByApplied","sourcesVolatile","layout","setColorByApplied","colorBy","getConf","warn","keys","join","coloredSources","setLayout","setupColorByAutorun"],"sourceRoot":""}