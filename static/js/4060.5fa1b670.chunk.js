"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4060],{24060:(e,t,r)=>{r.d(t,{makeImageData:()=>P});var o=r(68584),n=r(49823),a=r(99546);function i(e,t,r,o,n,a,i){t+o<0||t>a||(i&&(e.fillStyle=i),e.fillRect(t,r,o,n))}function c(e){const{bases:t}=e.palette;return{A:t.A.main,C:t.C.main,G:t.G.main,T:t.T.main,deletion:"#808080"}}function s(){return{charWidth:(0,a.measureText)("A"),charHeight:(0,a.measureText)("M")-2}}var l=r(36917),f=r(86576);function p({colorType:e,tag:t,feature:r,config:n,defaultColor:a,colorTagMap:i}){switch(e){case"insertSize":return function(e){return e.get("is_paired")&&e.get("refName")!==e.get("next_ref")?"#555":`hsl(${Math.abs(e.get("template_length"))/10},50%,50%)`}(r);case"strand":return function(e){return-1===e.get("strand")?"#8F8FD8":"#EC8B8B"}(r);case"mappingQuality":return function(e){return`hsl(${e.get("score")},50%,50%)`}(r);case"pairOrientation":return function(e,t){return l.pf[function(e,t){const r=(0,o.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[f.il[r][e.get("pair_orientation")]]}(e,t)||"color_nostrand"]}(r,n);case"stranded":return function(e){return l.pf[function(e){const t=e.get("flags"),r=e.get("strand");if(1&t){const o=64&t?-1:1;return 2&t?r*o==1?"color_rev_strand":"color_fwd_strand":8&t?r*o==1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("refName")===e.get("next_ref")?r*o==1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(e)]}(r);case"xs":case"tag":{const e=r.get("tags"),o=e?e[t]:r.get(t);return"XS"===t||"TS"===t?"-"===o?l.pf.color_rev_strand:"+"===o?l.pf.color_fwd_strand:l.pf.color_nostrand:"ts"===t?"-"===o?-1===r.get("strand")?l.pf.color_fwd_strand:l.pf.color_rev_strand:"+"===o?-1===r.get("strand")?l.pf.color_rev_strand:l.pf.color_fwd_strand:l.pf.color_nostrand:i[o]||l.pf.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return a?"lightgrey":(0,o.readConfObject)(n,"color",{feature:r})}}var h=r(95805),g=r(91476),d=r(59509),_=r(87485),u=r(93092);function b({ctx:e,feat:t,renderArgs:r,colorForBase:o,contrastForBase:n,charWidth:c,charHeight:s,defaultColor:l,canvasWidth:f}){const{config:b,bpPerPx:m,regions:x,colorBy:P,colorTagMap:v={}}=r,{tag:C="",type:y=""}=P||{},{feature:T}=t,w=x[0];switch(e.fillStyle=p({feature:T,config:b,tag:C,defaultColor:l,colorType:y,colorTagMap:v}),function({ctx:e,feat:t,renderArgs:r}){const{regions:o,bpPerPx:n}=r,{heightPx:i,topPx:c,feature:s}=t,l=o[0],f=s.get("start"),p=s.get("end"),g=s.get("CIGAR"),d=l.reversed?-1:1,_=s.get("strand")*d,u=n<10&&i>5;if(g.includes("N")){const t=(0,h.parseCigar)(g);if(1===_){let r=0,o=f;for(let s=0;s<t.length;s+=2){const f=+t[s],p=t[s+1];if("M"===p||"X"===p||"="===p||"D"===p)r+=f;else if("N"===p){if(o!==r){const[t,s]=(0,a.bpSpanPx)(o,o+r,l,n),f=s-t;e.fillRect(t,c,f,i)}o+=r+f,r=0}}if(o!==r){const[t,s]=(0,a.bpSpanPx)(o,o+r,l,n),f=s-t;u?(e.beginPath(),e.moveTo(t,c),e.lineTo(t,c+i),e.lineTo(s,c+i),e.lineTo(s+5,c+i/2),e.lineTo(s,c),e.closePath(),e.fill()):e.fillRect(t,c,f,i)}}else if(-1===_){let r=0,o=p;for(let s=t.length-2;s>=0;s-=2){const f=+t[s],p=t[s+1];if("M"===p||"X"===p||"="===p||"D"===p)r+=f;else if("N"===p){if(0!==r){const[t,s]=(0,a.bpSpanPx)(o-r,o,l,n);e.fillRect(t,c,s-t,i)}o-=r+f,r=0}}if(0!==r){const[t,s]=(0,a.bpSpanPx)(o-r,o,l,n),f=s-t;u?(e.beginPath(),e.moveTo(t-5,c+i/2),e.lineTo(t,c+i),e.lineTo(s,c+i),e.lineTo(s,c),e.lineTo(t,c),e.closePath(),e.fill()):e.fillRect(t,c,f,i)}}}else{const[t,r]=(0,a.bpSpanPx)(f,p,l,n);n<10&&i>5?-1===_?(e.beginPath(),e.moveTo(t-5,c+i/2),e.lineTo(t,c+i),e.lineTo(r,c+i),e.lineTo(r,c),e.lineTo(t,c),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(t,c),e.lineTo(t,c+i),e.lineTo(r,c+i),e.lineTo(r+5,c+i/2),e.lineTo(r,c),e.closePath(),e.fill()):e.fillRect(t,c,r-t,i)}}({ctx:e,feat:t,renderArgs:r}),y){case"perBaseQuality":!function({ctx:e,feat:t,region:r,bpPerPx:o,canvasWidth:n,cigarOps:c}){const{feature:s,topPx:l,heightPx:f}=t,p=(s.get("qual")||"").split(" ").map((e=>+e)),h=1/o,g=s.get("start");let d=0,_=0;for(let t=0;t<c.length;t+=2){const s=+c[t],u=c[t+1];if("S"===u||"I"===u)d+=s;else if("D"===u||"N"===u)_+=s;else if("M"===u||"X"===u||"="===u){for(let t=0;t<s;t++){const c=p[d+t],s=g+_+t;i(e,(0,a.bpSpanPx)(s,s+1,r,o)[0],l,h+.5,f,n,`hsl(${255===c?150:1.5*c},55%,50%)`)}d+=s,_+=s}}}({ctx:e,feat:t,region:w,bpPerPx:m,canvasWidth:f,cigarOps:(0,h.parseCigar)(T.get("CIGAR"))});break;case"perBaseLettering":!function({ctx:e,feat:t,region:r,bpPerPx:o,colorForBase:n,contrastForBase:c,charWidth:s,charHeight:l,canvasWidth:f,cigarOps:p}){const h=l-2,{feature:g,topPx:d,heightPx:_}=t,u=g.get("seq"),b=1/o,m=g.get("start");let x=0,P=0;if(u)for(let t=0;t<p.length;t+=2){const l=+p[t],g=p[t+1];if("S"===g||"I"===g)x+=l;else if("D"===g||"N"===g)P+=l;else if("M"===g||"X"===g||"="===g){for(let t=0;t<l;t++){const l=u[x+t],p=m+P+t,[g]=(0,a.bpSpanPx)(p,p+1,r,o);i(e,g,d,b+.5,_,f,n[l]),b>=s&&_>=h&&(e.fillStyle=c[l],e.fillText(l,g+(b-s)/2+1,d+_))}x+=l,P+=l}}}({ctx:e,feat:t,region:w,bpPerPx:m,colorForBase:o,contrastForBase:n,charWidth:c,charHeight:s,canvasWidth:f,cigarOps:(0,h.parseCigar)(T.get("CIGAR"))});break;case"modifications":!function({ctx:e,feat:t,region:r,bpPerPx:o,renderArgs:n,canvasWidth:c,cigarOps:s}){const{feature:l,topPx:f,heightPx:p}=t,{colorBy:h,visibleModifications:_={}}=n;if(!l.get("seq"))return;const u=l.get("start"),b=h?.modifications?.isolatedModification,m=h?.modifications?.twoColor;(0,d.r)(l,s)?.forEach((({allProbs:t,prob:n,type:s},l)=>{const h=u+l,[d,x]=(0,a.bpSpanPx)(h,h+1,r,o),P=_[s];if(!P)return void console.warn(`${s} not known yet`);if(b&&P.type!==b)return;const v=P.color||"black",C=1-(0,a.sum)(t);if(m&&C>(0,a.max)(t)){const t=(0,g.yr)("blue",C);i(e,d,f,x-d+.5,p,c,t)}else{const t=(0,g.yr)(v,n);i(e,d,f,x-d+.5,p,c,t)}}))}({ctx:e,feat:t,region:w,bpPerPx:m,renderArgs:r,canvasWidth:f,cigarOps:(0,h.parseCigar)(T.get("CIGAR"))});break;case"methylation":!function({ctx:e,feat:t,region:r,bpPerPx:o,renderArgs:n,canvasWidth:c,cigarOps:s}){const{regionSequence:l}=n,{feature:f,topPx:p,heightPx:h}=t;if(!l)throw new Error("region sequence required for methylation");if(!f.get("seq"))return;const g=f.get("start"),d=f.get("end"),{methBins:b,methProbs:m,hydroxyMethBins:x,hydroxyMethProbs:P}=(0,u.Ps)(f,s);function v(e){if(b[e]){const t=m[e]||0;return(t>.5?(0,_.M)("red").alpha(2*(t-.5)):(0,_.M)("blue").alpha(1-2*t)).toHslString()}if(x[e]){const t=P[e]||0;return(t>.5?(0,_.M)("pink").alpha(2*(t-.5)):(0,_.M)("purple").alpha(1-2*t)).toHslString()}}const C=l.toLowerCase();for(let t=0;t<d-g;t++){const n=t+g,s=C[n-r.start+1],l=C[n-r.start+2];if("c"===s&&"g"===l)if(o>2){const[s,l]=(0,a.bpSpanPx)(n,n+2,r,o);i(e,s,p,l-s+.5,h,c,v(t)||v(t+1)||"blue")}else{const[s,l]=(0,a.bpSpanPx)(n,n+1,r,o);i(e,s,p,l-s+.5,h,c,v(t)||"blue");const[f,g]=(0,a.bpSpanPx)(n+1,n+2,r,o);i(e,f,p,g-f+.5,h,c,v(t+1)||"blue")}}}({ctx:e,feat:t,region:w,bpPerPx:m,renderArgs:r,canvasWidth:f,cigarOps:(0,h.parseCigar)(T.get("CIGAR"))})}}function m({ctx:e,feat:t,renderArgs:r,minSubfeatureWidth:o,largeInsertionIndicatorScale:n,mismatchAlpha:c,charWidth:s,charHeight:l,colorForBase:f,contrastForBase:p,canvasWidth:h,drawSNPsMuted:g,drawIndels:d=!0}){const{bpPerPx:u,regions:b}=r,{heightPx:m,topPx:x,feature:P}=t,v=b[0],C=P.get("start"),y=Math.min(1/u,2),T=P.get("mismatches"),w=l-2,S=v.reversed?1/u+1:-1;if(T){for(const t of T){const r=C+t.start,n=t.length,l=t.base,[b,P]=(0,a.bpSpanPx)(r,r+n,v,u),T=Math.max(o,P-b);if("mismatch"===t.type){if(!g){const r=f[t.base]||"#888",o=c&&void 0!==t.qual?(0,_.M)(r).alpha(Math.min(1,t.qual/50)).toHslString():r;i(e,Math.round(b),x,T,m,h,o)}if(T>=s&&m>=w){const r=g?"black":p[t.base]||"black";e.fillStyle=c&&void 0!==t.qual?(0,_.M)(r).alpha(Math.min(1,t.qual/50)).toHslString():r,e.fillText(l,b+(T-s)/2+1,x+m)}}else if("deletion"===t.type&&d){i(e,b,x,Math.abs(b-P),m,h,f.deletion);const r=`${t.length}`,o=(0,a.measureText)(r,10);T>=o&&m>=w&&(e.fillStyle=p.deletion,e.fillText(r,(b+P)/2-o/2,x+m))}else if("insertion"===t.type&&d){const r=b+S,o=+t.base||t.length,n=Math.max(0,Math.min(1.2,1/u));if(o<10&&(i(e,r,x,n,m,h,"purple"),1/u>=s&&m>=w)){const o=r-n;i(e,o,x,3*n,1,h),i(e,o,x+m-1,3*n,1,h),e.fillText(`(${t.base})`,r+3,x+m)}}else if("hardclip"===t.type||"softclip"===t.type){const r=b+S,n="hardclip"===t.type?"red":"blue",a=Math.max(o,y);if(i(e,r,x,a,m,h,n),1/u>=s&&m>=w){const o=r-a;i(e,o,x,3*a,1,h),i(e,o,x+m-1,3*a,1,h),e.fillText(`(${t.base})`,r+3,x+m)}}else if("skip"===t.type&&b+T>0){const t=T-(u>10?1.5:0);i(e,Math.max(0,b),x+m/2-1,t+Math.min(b,0),1,h,"rgb(151,184,201)")}}if(d)for(const t of T){const r=C+t.start,o=t.length,c=+t.base||t.length;if("insertion"===t.type&&c>=10){const[t]=(0,a.bpSpanPx)(r,r+o,v,u),s=`${c}`;if(u>n)i(e,t-1,x,2,m,h,"purple");else if(m>l){const r=(0,a.measureText)(s),o=5;i(e,t-r/2-o,x,r+2*o,m,h,"purple"),e.fillStyle="white",e.fillText(s,t-r/2,x+m)}else{const r=2;i(e,t-r,x,2*r,m,h,"purple")}}}}}function x({ctx:e,feat:t,renderArgs:r,config:n,theme:c,colorForBase:l,canvasWidth:f}){const{feature:p,topPx:g,heightPx:d}=t,{regions:_,bpPerPx:u}=r,b=_[0],m=(0,o.readConfObject)(n,"minSubfeatureWidth"),x=p.get("mismatches"),P=p.get("seq"),{charWidth:v,charHeight:C}=s();if(!P||!x)return;const y=C-2;let T=0,w=0;const S=p.get("CIGAR"),A=(0,h.parseCigar)(S);for(let t=0;t<A.length;t+=2){const r=A[t+1],o=+A[t];if("S"===r){for(let r=0;r<o;r++){const n=P[T+r],s=p.get("start")-(0===t?o:0)+w+r,[h,_]=(0,a.bpSpanPx)(s,s+1,b,u),x=Math.max(m,_-h),C=l[n]||"#000000";e.fillStyle=C,i(e,h,g,x,d,f),x>=v&&d>=y&&(e.fillStyle=c.palette.getContrastText(C),e.fillText(n,h+(x-v)/2+1,g+d))}T+=o}"N"===r&&(w+=o),"M"!==r&&"="!==r&&"X"!==r||(w+=o,T+=o),"D"===r&&(w+=o),"I"===r&&(T+=o)}}function P({ctx:e,layoutRecords:t,canvasWidth:r,renderArgs:a}){const{config:i,showSoftClip:l,colorBy:f,theme:p}=a,h=(0,o.readConfObject)(i,"mismatchAlpha"),g=(0,o.readConfObject)(i,"minSubfeatureWidth"),d=(0,o.readConfObject)(i,"largeInsertionIndicatorScale"),_="#f0f"===(0,o.readConfObject)(i,"color"),u=(0,n.createJBrowseTheme)(p),P=c(u),v=function(e){return Object.fromEntries(Object.entries(c(e)).map((([t,r])=>[t,e.palette.getContrastText(r)])))}(u);e.font="bold 10px Courier New,monospace";const{charWidth:C,charHeight:y}=s(),T=(w=f?.type,["methylation","modifications"].includes(w||""));var w;for(const o of t)b({ctx:e,feat:o,renderArgs:a,defaultColor:_,colorForBase:P,contrastForBase:v,charWidth:C,charHeight:y,canvasWidth:r}),m({ctx:e,feat:o,renderArgs:a,mismatchAlpha:h,drawSNPsMuted:T,drawIndels:!0,largeInsertionIndicatorScale:d,minSubfeatureWidth:g,charWidth:C,charHeight:y,colorForBase:P,contrastForBase:v,canvasWidth:r}),l&&x({ctx:e,feat:o,renderArgs:a,colorForBase:P,config:i,theme:u,canvasWidth:r})}},36917:(e,t,r)=>{r.d(t,{DW:()=>f,L9:()=>i,pf:()=>n,sY:()=>s,w7:()=>a});var o=r(86576);const n={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unknown:"grey"},a={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00005A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unknown:"grey"};function i(e,t,r){const o=e.refName===t.refName,i=Math.abs(e.tlen||0);return o&&i>(r?.upper||0)?[n.color_longinsert,a.color_longinsert]:o&&i<(r?.lower||0)?[n.color_shortinsert,a.color_shortinsert]:o?void 0:[n.color_interchrom,a.color_interchrom]}const c=[n.color_unknown,n.color_unknown];function s(e,t,r){return l(e)||i(e,t,r)||c}function l(e){const t=o.il.fr[e.pair_orientation||""],r=o.rr[t];return"LR"===t?void 0:[n[r],a[r]]}function f(e){return l(e)||c}},59509:(e,t,r)=>{r.d(t,{r:()=>c});var o=r(93092),n=r(95805),a=r(49256),i=r(86576);function c(e,t){const r=e.get("strand"),c=e.get("seq"),s=(0,i.c$)(e,"MM","Mm")||"",l=t||(0,n.parseCigar)(e.get("CIGAR"));if(c){const t=(0,o.Z1)(s,c,r),n=(0,o.Yj)(e),i=[];let f=0;for(const{type:e,positions:o}of t){for(const{ref:t,idx:c}of(0,a.h)(l,o)){const a=n?.[f+(-1===r?o.length-1-c:c)]||0;if(i[t]){const r=i[t];i[t]={allProbs:[...r.allProbs,a],prob:Math.max(r.prob,a),type:r.prob>a?r.type:e}}else i[t]={type:e,prob:a,allProbs:[a]}}f+=o.length}return i}}}}]);
//# sourceMappingURL=4060.5fa1b670.chunk.js.map