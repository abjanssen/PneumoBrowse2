"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9943],{19943(e,t,n){n.r(t),n.d(t,{default:()=>v});var i=n(30128),s=n(45084),o=n(23886),r=n(16640),a=n(61425),c=n(68673),l=n(79291),u=n(69566),d=n(17601),h=n(55614),p=n(62456),f=n(44460);function g(e){const t=(0,h.c)(14),{item:n,featureName:i,refName:s,mousePosition:r}=e,a=r.y+20;let c,l,u,g,m;return t[0]!==r.x||t[1]!==a?(c={x:r.x,y:a},t[0]=r.x,t[1]=a,t[2]=c):c=t[2],t[3]!==i?(l=(0,f.jsx)("div",{children:i}),t[3]=i,t[4]=l):l=t[4],t[5]!==n||t[6]!==s?(u=n?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{whiteSpace:"pre-line"},children:(0,d.F)(n)}),(0,f.jsxs)("div",{children:["Position: ",s,":",(0,o.toLocale)(n.start+1)]})]}):null,t[5]=n,t[6]=s,t[7]=u):u=t[7],t[8]!==l||t[9]!==u?(g=(0,f.jsxs)("div",{children:[l,u]}),t[8]=l,t[9]=u,t[10]=g):g=t[10],t[11]!==c||t[12]!==g?(m=(0,f.jsx)(p.A,{placement:"bottom-start",clientPoint:c,children:g}),t[11]=c,t[12]=g,t[13]=m):m=t[13],m}function m(e,t,n,i){const[s,o,r,a]=e,c=n.reversed?(n.end-r)/i:(s-n.start)/i,l=n.reversed?(n.end-s)/i:(r-n.start)/i;return{left:c-t,top:Math.round(o)-t,width:l-c,height:Math.round(a-o)}}const v=(0,u.observer)(function(e){const{blockKey:t,displayModel:n,width:u,height:h,regions:p,bpPerPx:v,sortedBy:b,colorBy:y,filterBy:x,flatbush:w,items:F,featureNames:M={}}=e,{refName:j}=p[0],S=(0,i.useMemo)(()=>a.A.from(w),[w]),{selectedFeatureId:C,featureIdUnderMouse:k,contextMenuFeature:B}=n,I=p[0],$=(0,i.useRef)(null),[P,q]=(0,i.useState)(!1),[A,D]=(0,i.useState)(!1),[N,T]=(0,i.useState)(),[W,X]=(0,i.useState)(),[Y,E]=(0,i.useState)(),[L,R]=(0,i.useState)(null),U=C?n.getFeatureByID(t,C):void 0,_=k||B?.id(),O=_?n.getFeatureByID(t,_):void 0,V=U?m(U,2,I,v):void 0,z=O?m(O,0,I,v):void 0,H=Math.ceil(u),K=N||k;return(0,f.jsxs)("div",{ref:$,"data-testid":["pileup-overlay",b?.type,y?.type,y?.tag,x?.tagFilter?.tag].filter(e=>!!e).join("-"),style:{position:"relative",width:H,height:h,cursor:K?"pointer":"default"},onMouseLeave:()=>{T(void 0),X(void 0),E(void 0),n.setFeatureIdUnderMouse(void 0)},onMouseDown:e=>{q(!0),D(!1)},onMouseUp:()=>{q(!1)},onMouseMove:e=>{if(!$.current)return;P&&D(!0);const i=$.current.getBoundingClientRect(),s=e.clientX-i.left,o=e.clientY-i.top,r=I.reversed?u-s:s,a=I.start+v*r,c=S.search(s,o,s+1,o+1),l=c.length?F[c[0]]:void 0;T(l);const d=n.getFeatureOverlapping(t,a,o),h=d?M[d]:void 0;X(h),E(l||h?{x:e.clientX,y:e.clientY}:void 0),n.setFeatureIdUnderMouse(d)},onClick:()=>{if(!A)if(N){const e=(0,o.getSession)(n),t=(0,o.getContainingView)(n),i=k?M[k]:void 0,s=(0,d.u)(N,j,i);if((0,r.lO)(e)){const i=e.addWidget("BaseFeatureWidget","baseFeature",{featureData:s,view:t,track:(0,o.getContainingTrack)(n)});e.showWidget(i)}}else k&&n.selectFeatureById(k).catch(e=>{console.error(e),(0,o.getSession)(n).notifyError(`${e}`,e)})},onContextMenu:e=>{N?(e.preventDefault(),R({mouseX:e.clientX,mouseY:e.clientY,item:N})):k?n.setContextMenuFeatureById(k).catch(e=>{console.error(e),(0,o.getSession)(n).notifyError(`${e}`,e)}):(n.setContextMenuFeature(void 0),n.clearFeatureSelection())},children:[(0,f.jsx)(s.A,{...e,style:{position:"absolute",left:0,top:0}}),z?(0,f.jsx)("div",{style:{position:"absolute",backgroundColor:"#0003",pointerEvents:"none",...z}}):null,V?(0,f.jsx)("div",{style:{position:"absolute",border:"2px solid #00b8ff",boxSizing:"content-box",pointerEvents:"none",...V}}):null,(N||W)&&Y&&!L?(0,f.jsx)(g,{item:N,featureName:W,refName:j,mousePosition:Y}):null,(0,f.jsxs)(c.A,{open:null!==L,onClose:()=>{R(null)},anchorReference:"anchorPosition",anchorPosition:L?{top:L.mouseY,left:L.mouseX}:void 0,children:[(0,f.jsx)(l.A,{onClick:()=>{if(L){const e=(0,o.getSession)(n),t=(0,o.getContainingView)(n),i=k?M[k]:void 0,s=(0,d.u)(L.item,j,i);if((0,r.lO)(e)){const i=e.addWidget("BaseFeatureWidget","baseFeature",{featureData:s,view:t,track:(0,o.getContainingTrack)(n)});e.showWidget(i)}}R(null)},children:"Show details"}),"mismatch"===L?.item.type?(0,f.jsx)(l.A,{onClick:()=>{const{item:e}=L;n.setSortedByAtPosition?.("Base pair",e.start,j),R(null)},children:"Sort by base pair"}):null]})]})})},17601(e,t,n){function i(e){switch(e.type){case"insertion":return e.sequence&&e.sequence.length<=10?`Insertion: ${e.sequence}`:`Insertion: ${e.length}bp`;case"deletion":return`Deletion: ${e.length}bp`;case"softclip":return`Soft clip: ${e.length}bp`;case"hardclip":return`Hard clip: ${e.length}bp`;case"modification":{const t=e.mismatch?`\nMismatch: ${e.mismatch}`:"";return e.info+t}case"mismatch":return`Mismatch: ${e.base}`}}function s(e,t,n){const i={uniqueId:`${e.type}-${e.start}`,type:e.type,refName:t,sourceRead:n};switch(e.type){case"insertion":return{...i,start:e.start,end:e.start+1,...e.sequence?{sequence:e.sequence}:{},insertionLength:e.length};case"deletion":return{...i,start:e.start,end:e.start+e.length};case"softclip":case"hardclip":return{...i,start:e.start,end:e.start+1,clipLength:e.length};case"modification":return{...i,start:e.start,end:e.start+1,info:e.info,modType:e.modType,probability:e.probability.toFixed(3),...e.mismatch?{mismatch:e.mismatch}:{}};case"mismatch":return{...i,start:e.start,end:e.start+1,base:e.base}}}n.d(t,{F:()=>i,u:()=>s})}}]);
//# sourceMappingURL=9943.af9a2124.chunk.js.map