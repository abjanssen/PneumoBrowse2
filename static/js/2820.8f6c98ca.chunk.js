"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2820,5904],{12820:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var s=n(99546),a=n(99834),r=n(35904);class o extends r.default{async setupPre(e){const t=(0,a.openLocation)(this.getConf("deltaLocation"),this.pluginManager);return function(e){const{statusCallback:t=()=>{}}={};let n="",s="",a=0,r=0,o=0,c=0,i=0,l=0,u=[],f=0,h=0,m=!1;const p=[],g=new RegExp(/^>(\S+)\s+(\S+)\s+(\d+)\s+(\d+)/);let d=0,b=0,y=0;const x=new TextDecoder("utf8");for(;d<e.length;){y++%1e4==0&&t(`Loading ${Math.floor(d/1e6).toLocaleString("en-US")}/${Math.floor(e.length/1e6).toLocaleString("en-US")} MB`);const M=e.indexOf(10,d);if(-1===M)break;const q=e.subarray(d,M),w=x.decode(q).trim();if(d=M+1,b++,w){const e=g.exec(w);if(null!==e){n=e[1],s=e[2],m=!0;continue}if(!m)continue;const t=w.split(" ");if(7===t.length){const e=+t[0],n=+t[1],s=+t[2],m=+t[3],p=+t[4];i=e<n&&s<m||e>n&&s>m?1:-1,o=+Math.min(e,n)-1,c=+Math.max(n,e),a=+Math.min(s,m)-1,r=+Math.max(m,s),f=h=0,l=p,u=[]}else if(1===t.length){const e=+t[0];if(0===e){let e=0;const t=[];if(c-o-f!=r-a-h)throw new Error(`inconsistent alignment on line ${b}`);u.push(c-o-f<<4);for(const n of u){const s=n>>4;e+=s,t.push(s+"MID".charAt(15&u[b]))}p.push({qname:s,qstart:a,qend:r,tname:n,tstart:o,tend:c,strand:i,extra:{numMatches:e-l,blockLen:e,mappingQual:0,NM:l,cg:t.join("")}})}else if(e>0){const t=e-1;f+=t+1,h+=t,t>0&&u.push(t<<4),u.length>0&&2==(15&u[u.length-1])?u[u.length-1]+=16:u.push(18)}else{const t=-e-1;f+=t,h+=t+1,t>0&&u.push(t<<4),u.length>0&&1==(15&u[u.length-1])?u[u.length-1]+=16:u.push(17)}}}}return p}(await(0,s.fetchAndMaybeUnzip)(t,e))}}},35904:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var s=n(68584),a=n(46377),r=n(99546),o=n(99834),c=n(32595),i=n(66885),l=n(27087),u=n(72147),f=n(78054);function h(e){const[t,n]=e.reduce((([e,t],[n,s])=>[e+n*s,t+s]),[0,0]);return t/n}const{parseCigar:m}=l.aF;class p extends a.BaseFeatureDataAdapter{static capabilities=["getFeatures","getRefNames"];async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch((e=>{throw this.setupP=void 0,e}))),this.setupP}async setupPre(e){const t=this.pluginManager,n=(0,o.openLocation)(this.getConf("pafLocation"),t),s=await(0,r.fetchAndMaybeUnzip)(n,e);return(0,f.PX)(s,f.xI,e)}async hasDataForRefName(){return!0}getAssemblyNames(){const e=this.getConf("assemblyNames");return 0===e.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}async getRefNames(e={}){const t=e.regions?.[0].assemblyName,n=await this.setup(e),s=this.getAssemblyNames().indexOf(t);if(-1!==s){const e=new Set;for(const t of n)e.add(0===s?t.qname:t.tname);return[...e]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(e,t={}){return(0,i.ObservableCreate)((async n=>{let a=await this.setup(t);const{config:r}=t;r&&"meanQueryIdentity"===(0,s.readConfObject)(r,"colorBy")&&(a=function(e){const t={};for(const n of e){const e=`${n.qname}-${n.tname}`;t[e]||(t[e]={quals:[],len:[]}),t[e].quals.push(n.extra.mappingQual||1),t[e].len.push(n.extra.blockLen||1)}const n=Object.fromEntries(Object.entries(t).map((([e,t])=>[e,h((0,f.yU)(t.quals,t.len))])));for(const t of e){const e=`${t.qname}-${t.tname}`;t.extra.meanScore=n[e]}let s=1e4,a=0;for(const t of e)s=Math.min(t.extra.meanScore||0,s),a=Math.max(t.extra.meanScore||0,a);for(const t of e){const e=t.extra.meanScore||0;t.extra.meanScore=(e-s)/(a-s)}return e}(a));const o=this.getAssemblyNames(),{start:i,end:l,refName:p,assemblyName:g}=e,d=o.indexOf(g),b=0===d;-1===d&&(console.warn(`${g} not found in this adapter`),n.complete());for(let e=0;e<a.length;e++){const t=a[e];let s=0,r=0,h="",d="",y=0,x=0;b?(s=t.qstart,r=t.qend,h=t.qname,d=t.tname,y=t.tstart,x=t.tend):(s=t.tstart,r=t.tend,h=t.tname,d=t.qname,y=t.qstart,x=t.qend);const{extra:M,strand:q}=t;if(h===p&&(0,c.R6)(i,l,s,r)){const{numMatches:t=0,blockLen:a=1,cg:c,...i}=M;let l=M.cg;M.cg&&(b&&-1===q?l=(0,f.qm)(m(M.cg)).join(""):b&&(l=(0,f.gJ)(M.cg))),n.next(new u.A({uniqueId:e+g,assemblyName:g,start:s,end:r,type:"match",refName:h,strand:q,...i,CIGAR:l,syntenyId:e,identity:t/a,numMatches:t,blockLen:a,mate:{start:y,end:x,refName:d,assemblyName:o[+b]}}))}}n.complete()}))}freeResources(){}}},72147:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(99546),a=n(27087);const{getMismatches:r}=a.aF;class o extends s.SimpleFeature{get(e){return"mismatches"===e?r(this.get("CIGAR")):super.get(e)}}},78054:(e,t,n)=>{n.d(t,{PX:()=>c,TA:()=>r,fY:()=>a,gJ:()=>u,qm:()=>l,xI:()=>i,yU:()=>o});var s=n(99546);function a(e){return new Map(e.split(/\n|\r\n|\r/).filter((e=>!!e||e.startsWith("#"))).map((e=>{const[t,n,s,a,r,o]=e.split("\t");return[a,{refName:t,start:+n,end:+s,score:+r,name:a,strand:"-"===o?-1:1}]})))}async function r(e,t){return(0,s.fetchAndMaybeUnzipText)(e,t)}function o(e,t){return e.map(((e,n)=>[e,t[n]]))}function c(e,t,n){const{statusCallback:s=()=>{}}=n||{};let a=0;const r=[],o=new TextDecoder("utf8");let c=0;for(;a<e.length;){const n=e.indexOf(10,a);if(-1===n)break;const i=e.subarray(a,n),l=o.decode(i).trim();if(l){const e=t(l);e&&r.push(e)}c++%1e4==0&&s(`Loading ${Math.floor(a/1e6).toLocaleString("en-US")}/${Math.floor(e.length/1e6).toLocaleString("en-US")} MB`),a=n+1}return r}function i(e){const t=e.split("\t"),n=t.slice(12),s={numMatches:+t[9],blockLen:+t[10],mappingQual:+t[11]};if(n.length)for(const e of n){const t=e.indexOf(":");s[e.slice(0,t)]=e.slice(t+3)}return{tname:t[5],tstart:+t[7],tend:+t[8],qname:t[0],qstart:+t[2],qend:+t[3],strand:"-"===t[4]?-1:1,extra:s}}function l(e){const t=[];for(let n=e.length-2;n>=0;n-=2){t.push(e[n]);const s=e[n+1];"D"===s?t.push("I"):"I"===s?t.push("D"):t.push(s)}return t}function u(e){return e.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}}}]);
//# sourceMappingURL=2820.8f6c98ca.chunk.js.map