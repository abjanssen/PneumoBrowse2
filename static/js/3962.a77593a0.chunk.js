"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3962],{3962(t,e,n){n.d(e,{sw:()=>O,Cj:()=>k,wi:()=>C,ZR:()=>T,$B:()=>A,ie:()=>N});var o=n(57141),i=n(11259),s=n(17868),a=n(35702),r=n(74721),c=n(20253);function l(t,e,n,o,i,s){s&&(i.strokeStyle=s),i.beginPath(),i.moveTo(t,e),i.lineTo(n,o),i.stroke()}var h=n(5248),f=n(47354);function d(t){return"dark"===(0,s.createJBrowseTheme)(t).palette.mode?"#aaa8":"#6665"}function g({ctx:t,xPos:e,yPos:n,width:o,height:i,strand:s,fillStyle:a,strokeStyle:r,renderChevrons:c,showOutline:l=!0}){if(c)!function(t,e,n,o,i,s,a,r,c){t.fillStyle=a,t.beginPath(),-1===s?(t.moveTo(e-r,n+i/2),t.lineTo(e,n+i),t.lineTo(e+o,n+i),t.lineTo(e+o,n),t.lineTo(e,n)):(t.moveTo(e,n),t.lineTo(e,n+i),t.lineTo(e+o,n+i),t.lineTo(e+o+r,n+i/2),t.lineTo(e+o,n)),t.closePath(),t.fill(),c&&(t.strokeStyle=c,t.stroke())}(t,e,n,o,i,s,a,f.Fz,l?r:void 0);else{let s=e,c=n,h=o;h<0&&(s+=h,h=-h),i<0&&(c+=i),t.fillStyle=a,t.fillRect(s,c,h,i),l&&function(t,e,n,o,i,s){n<0&&(t+=n,n=-n),o<0&&(e+=o,o=-o),s&&(i.strokeStyle=s),i.strokeRect(t,e,n,o)}(s,c,h,i,t,r)}}function m(t){return-1===t?"color_rev_strand":"color_fwd_strand"}function u(t){for(const e of t)if(e.get("flags")&h.Xx)return!0;return!1}function p(t){const e=[];for(const n of t)n.get("flags")&h.fs||e.push(n);return e}function x(t,e,n,o,a){const r=(0,i.QZ)(e,"mismatchAlpha"),c=(0,i.QZ)(e,"minSubfeatureWidth")??1,l=(0,i.QZ)(e,"largeInsertionIndicatorScale"),h=a?.hideSmallIndels??(0,i.QZ)(e,"hideSmallIndels"),d=a?.hideMismatches??(0,i.QZ)(e,"hideMismatches"),g=a?.hideLargeIndels??(0,i.QZ)(e,"hideLargeIndels")??!1,m=(0,s.createJBrowseTheme)(n),u=(0,f.LI)(m),p=(0,f._7)(m);(0,f.Hh)(t);const{charWidth:x,charHeight:P}=(0,f.Sr)();return{mismatchAlpha:r,minSubfeatureWidth:c,largeInsertionIndicatorScale:l,hideSmallIndels:h,hideMismatches:d,hideLargeIndels:g,colorMap:u,colorContrastMap:p,charWidth:x,charHeight:P,drawSNPsMuted:(0,f.B$)(o.type),drawIndels:(0,f.P9)()}}function P(t,e,n,o){return t===o.refName&&e<o.end&&n>o.start}function S(t,e,n,o,i){const s=Math.max(t,n),a=Math.min(e,o);return{xPos:(s-n)/i,width:Math.max((a-s)/i,3)}}function y(t,e){let n=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const i of t){const t=i;t.get("refName")===e&&(n=Math.min(n,t.get("start")),o=Math.max(o,t.get("end")))}return n!==Number.MAX_VALUE?{minStart:n,maxEnd:o}:void 0}function b(t,e,n,o){for(let o=0;o<t.coords.length;o+=4)n.push(t.coords[o]+e,t.coords[o+1],t.coords[o+2]+e,t.coords[o+3]);for(const e of t.items)o.push(e)}function M({ctx:t,feat:e,layoutFeat:n,region:o,regionStartPx:i,bpPerPx:s,canvasWidth:l,colorBy:h,visibleModifications:f,mismatchConfig:d,allCoords:g,allItems:m}){b((0,r.Y)({ctx:t,feat:n,checkRef:!0,bpPerPx:s,regions:[o],canvasWidth:l,...d}),i,g,m),function({ctx:t,feat:e,layoutFeat:n,region:o,regionStartPx:i,bpPerPx:s,colorBy:r,visibleModifications:l,allCoords:h,allItems:f}){if("modifications"!==r.type||!l)return;const d=(0,a.tQ)(e.get("NUMERIC_CIGAR")||e.get("CIGAR"));b((0,c.k)({ctx:t,feat:n,region:o,bpPerPx:s,renderArgs:{colorBy:r,visibleModifications:l},cigarOps:d}),i,h,f)}({ctx:t,feat:e,layoutFeat:n,region:o,regionStartPx:i,bpPerPx:s,colorBy:h,visibleModifications:f,allCoords:g,allItems:m})}var I=n(52901),_=n(15391);function v(t){const e=t.get("flags");if(2048&e){const e=t.get("tags")?.SA,n=e?.split(";")[0]?.split(",")[2];return"-"===n?-1:1}return 16&e?-1:1}function w({ctx:t,chainData:e,chainYOffsets:n,renderChevrons:o,featureHeight:i,computedChains:s,flipStrandLongReadChains:a,config:r,theme:c,region:h,regionStartPx:f,bpPerPx:u,colorBy:p,visibleModifications:b,stopToken:w,hideSmallIndels:L,hideMismatches:A,hideLargeIndels:C,showOutline:N}){const O=x(t,r,c,p,{hideSmallIndels:L,hideMismatches:A,hideLargeIndels:C}),T=h.widthPx,k=h.start,B=[],E=[],R=(0,I.jL)(w);for(const r of s){(0,I.As)(R);const{id:s,chain:x,isPairedEnd:w,nonSupplementary:L}=r;if(w)continue;const A=n.get(s);if(void 0===A)continue;const C=1===x.length,F=v(L[0]||x[0]);if(!C){const e=y(x,h.refName);if(e&&e.minStart<h.end&&e.maxEnd>h.start){const n=A+i/2;l((e.minStart-k)/u,n,(e.maxEnd-k)/u,n,t,d(c))}}const X=[];for(let n=0,s=x.length;n<s;n++){const s=x[n],r=s.get("refName"),c=s.get("start"),l=s.get("end");if(!P(r,c,l,h))continue;const f=s.get("strand"),d=C||!a?f:f*F,[p,y]=C?(0,_.Pq)({tlen:s.get("template_length"),pair_orientation:s.get("pair_orientation"),flags:s.get("flags")},e.stats):[_.pf[m(d)],_.w7[m(d)]],{xPos:b,width:M}=S(c,l,k,h.end,u);X.push(s),g({ctx:t,xPos:b,yPos:A,width:M,height:i,strand:d,fillStyle:p,strokeStyle:y,renderChevrons:o,showOutline:N})}for(const e of X)M({ctx:t,feat:e,layoutFeat:{feature:e,heightPx:i,topPx:A},region:h,regionStartPx:f,bpPerPx:u,canvasWidth:T,colorBy:p,visibleModifications:b,mismatchConfig:O,allCoords:B,allItems:E})}return{coords:B,items:E}}function L({ctx:t,type:e,chainData:n,chainYOffsets:o,renderChevrons:i,featureHeight:s,computedChains:a,config:r,theme:c,region:h,regionStartPx:f,bpPerPx:m,colorBy:u,visibleModifications:p,stopToken:b,hideSmallIndels:v,hideMismatches:w,hideLargeIndels:L,showOutline:A}){const C=x(t,r,c,u,{hideSmallIndels:v,hideMismatches:w,hideLargeIndels:L}),N=h.widthPx,O=h.start,T=[],k=[],B=(0,I.jL)(b);for(const r of a){(0,I.As)(B);const{id:a,chain:x,isPairedEnd:b,nonSupplementary:v}=r;if(!b)continue;const w=o.get(a);if(void 0===w)continue;const L=2===v.length,E=v[0]||x[0],[R,F]=(0,_.PJ)({type:e,v0:E,stats:n.stats})||["lightgrey","#888"],X=w+s/2,H=x.length>v.length;if(L){const e=y(x,h.refName);e&&e.minStart<h.end&&e.maxEnd>h.start&&l((e.minStart-O)/m,X,(e.maxEnd-O)/m,X,t,H?_.pf.color_supplementary:d(c))}const U=[];for(let e=0,n=x.length;e<n;e++){const n=x[e],o=n.get("refName"),a=n.get("start"),r=n.get("end");if(!P(o,a,r,h))continue;const{xPos:c,width:l}=S(a,r,O,h.end,m);U.push(n);const[f,d]=H?[_.pf.color_supplementary,_.w7.color_supplementary]:[R,F];g({ctx:t,xPos:c,yPos:w,width:l,height:s,strand:n.get("strand"),fillStyle:f,strokeStyle:d,renderChevrons:i,showOutline:A})}for(const e of U)M({ctx:t,feat:e,layoutFeat:{feature:e,heightPx:s,topPx:w},region:h,regionStartPx:f,bpPerPx:m,canvasWidth:N,colorBy:u,visibleModifications:p,mismatchConfig:C,allCoords:T,allItems:k});(0,I.As)(B)}return{coords:T,items:k}}function A(t,e,n,o,i){const s=[];for(const a of t){if(!e&&1===a.length)continue;const t=u(a);if(!n&&t){const t=p(a);if(2===t.length){const e=t[0];if((0,_.en)({type:o,f:{refName:e.get("refName"),next_ref:e.get("next_ref"),pair_orientation:e.get("pair_orientation"),tlen:e.get("template_length"),flags:e.get("flags")},stats:i.stats})===_.J8.PROPER_PAIR)continue}}s.push(a)}return s}function C(t,e){const n=[],{bpPerPx:o}=e;for(const i of t){let t=Number.MAX_VALUE,s=Number.MIN_VALUE,a="",r=0,c=!1;const l=[],f=i.length;for(let n=0;n<f;n++){const f=i[n],d=f.get("start"),g=f.get("end"),m=f.get("flags");m&h.Xx&&(c=!0),m&h.fs||l.push(f);const u=e.bpToPx({refName:f.get("refName"),coord:d})?.offsetPx;if(void 0!==u){const e=u+(g-d)/o;t=Math.min(t,u),s=Math.max(s,e)}a||(a=f.id());const p=f.get("template_length");0===r&&p&&(r=Math.abs(p))}if(t===Number.MAX_VALUE||s===Number.MIN_VALUE)continue;let d=0;r>0&&r<=(s-t)*o*100&&(d=r),n.push({distance:d,minX:t,maxX:s,chain:i,id:a,isPairedEnd:c,nonSupplementary:l})}return n}function N(t){t.sort((t,e)=>{const n=1===t.chain.length?1:0,o=1===e.chain.length?1:0;return o!==n?o-n:t.distance-e.distance})}function O(t,e){const n=new o.A(Math.max(t.length,1)),i=t.length;if(i)for(let e=0;e<i;e++){const{x1:o,y1:i,x2:s,y2:a}=t[e];n.add(o,i,s,a)}else n.add(0,0);n.finish(),e.setFeatureLayout(n),e.setFeaturesForFlatbush(t)}function T({ctx:t,params:e,view:n,calculateYOffsets:i}){const{chainData:s,featureHeight:a,colorBy:r,drawSingletons:c,drawProperPairs:l,flipStrandLongReadChains:h,stopToken:d}=e,g=r.type||"insertSizeAndOrientation",{chains:m}=s,u=C(A(m,c,l,g,s),n);N(u);const{chainYOffsets:p,layoutHeight:x,cloudMaxDistance:P}=i(u),S=[],y=(0,f.SP)(n.bpPerPx,a),b=n.offsetPx,M=[],I=[];for(const n of e.regions){t.save();const o=n.offsetPx-b;t.beginPath(),t.rect(o,0,n.widthPx,1e5),t.clip(),t.translate(o,0);const i=L({ctx:t,type:g,chainData:s,chainYOffsets:p,renderChevrons:y,featureHeight:a,computedChains:u,config:e.config,theme:e.theme,region:n,regionStartPx:o,bpPerPx:e.bpPerPx,colorBy:e.colorBy,visibleModifications:e.visibleModifications,stopToken:d,hideSmallIndels:e.hideSmallIndels,hideMismatches:e.hideMismatches,hideLargeIndels:e.hideLargeIndels,showOutline:e.showOutline}),r=w({ctx:t,chainData:s,chainYOffsets:p,renderChevrons:y,featureHeight:a,computedChains:u,flipStrandLongReadChains:h,config:e.config,theme:e.theme,region:n,regionStartPx:o,bpPerPx:e.bpPerPx,colorBy:e.colorBy,visibleModifications:e.visibleModifications,stopToken:d,hideSmallIndels:e.hideSmallIndels,hideMismatches:e.hideMismatches,hideLargeIndels:e.hideLargeIndels,showOutline:e.showOutline});for(const t of i.coords)M.push(t);for(const t of r.coords)M.push(t);for(const t of i.items)I.push(t);for(const t of r.items)I.push(t);t.restore()}!function(t,e,n,o,i){for(const s of t){const{id:t,chain:a,minX:r,maxX:c,nonSupplementary:l}=s,h=e.get(t);if(void 0===h)continue;const f=r-o.offsetPx,d=c-o.offsetPx;if(a.length>0){const e=l[0]||a[0],o=l.length<a.length;i.push({x1:f,y1:h,x2:d,y2:h+n,data:{name:e.get("name"),refName:e.get("refName"),start:e.get("start"),end:e.get("end"),strand:e.get("strand"),flags:e.get("flags"),id:e.id(),tlen:e.get("template_length")||0,pair_orientation:e.get("pair_orientation")||"",clipLengthAtStartOfRead:e.get("clipLengthAtStartOfRead")||0,next_ref:e.get("next_ref")},chainId:t,chainMinX:f,chainMaxX:d,hasSupplementary:o,chain:a.map(t=>({name:t.get("name"),refName:t.get("refName"),start:t.get("start"),end:t.get("end"),strand:t.get("strand"),flags:t.get("flags"),id:t.id(),tlen:t.get("template_length")||0,pair_orientation:t.get("pair_orientation")||"",clipLengthAtStartOfRead:t.get("clipLengthAtStartOfRead")||0,next_ref:t.get("next_ref")}))})}}}(u,p,a,n,S);const _=new o.A(Math.max(I.length,1));if(M.length)for(let t=0;t<M.length;t+=4)_.add(M[t],M[t+1],M[t+2],M[t+3]);else _.add(0,0,0,0);return _.finish(),{featuresForFlatbush:S,layoutHeight:x,cloudMaxDistance:P,mismatchFlatbush:_.data,mismatchItems:I}}function k(t,e,n){const i=o.A.from(t);n.setMismatchLayout(i),n.setMismatchItems(e)}}}]);
//# sourceMappingURL=3962.a77593a0.chunk.js.map