"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4877,8003],{8003(t,e,s){s.d(e,{default:()=>u});var i=s(51242),n=s(48455),a=s(77251),r=s(33624),o=s(86618),h=s(52901),c=s(50951),l=s(47354);class u extends n.L{configure(){if(!this.configureResult){const t=this.getConf("bamLocation"),e=this.getConf(["index","location"]),s="CSI"===this.getConf(["index","indexType"]);this.configureResult={bam:new i.j9({bamFilehandle:(0,r.openLocation)(t,this.pluginManager),csiFilehandle:s?(0,r.openLocation)(e,this.pluginManager):void 0,baiFilehandle:s?void 0:(0,r.openLocation)(e,this.pluginManager),recordClass:c.A})}}return this.configureResult}async getSequenceAdapter(){const t=this.sequenceAdapterConfig;if(t&&this.getSubAdapter)return this.sequenceAdapterP??=this.getSubAdapter(t).then(t=>{const e=t.dataAdapter;return"getSequence"in e?e:void 0}).catch(t=>{throw this.sequenceAdapterP=void 0,t}),this.sequenceAdapterP}async getHeader(t){const{bam:e}=this.configure();return e.getHeaderText()}async setup(t){const{statusCallback:e}=t||{};return this.setupP??=(0,a.updateStatus)("Downloading index",e,async()=>{try{const{bam:t}=this.configure(),e=await t.getHeader();return this.samHeader=(0,l.cY)(e??[]),this.samHeader}catch(t){throw this.setupP=void 0,this.configureResult=void 0,t}}),this.setupP}async getRefNames(t){const{idToName:e}=await this.setup(t);return e}getFeatures(t,e){const{refName:s,start:i,end:n,originalRefName:r}=t,{stopToken:c,filterBy:l,statusCallback:u=()=>{}}=e||{};return(0,o.ObservableCreate)(async t=>{const{bam:o}=this.configure(),f=await this.getSequenceAdapter();await this.setup(e),(0,h.SW)(c);const d=await(0,a.updateStatus)("Downloading alignments",u,()=>o.getRecordsForRange(s,i,n,{filterBy:l}));(0,h.SW)(c),await(0,a.updateStatus)("Processing alignments",u,async()=>{const{readName:e}=l||{};let i,n=1/0,a=0;if(f){for(const t of d)t.NUMERIC_MD||(n=Math.min(n,t.start),a=Math.max(a,t.end));a>0&&(i=await f.getSequence({refName:r||s,start:n,end:a}))}for(const s of d)e&&s.name!==e||(s.adapter=this,!s.NUMERIC_MD&&i&&(s.ref=i.slice(s.start-n,s.end-n)),t.next(s));t.complete()})})}async getMultiRegionFeatureDensityStats(t,e){const{bam:s}=this.configure();return s.index?{bytes:await s.estimatedBytesForRegions(t),fetchSizeLimit:this.getConf("fetchSizeLimit")}:super.getMultiRegionFeatureDensityStats(t,e)}refIdToName(t){return this.samHeader?.idToName[t]}}},24877(t,e,s){s.d(e,{default:()=>r});var i=s(51242),n=s(8003),a=s(50951);class r extends n.default{configure(){if(!this.configureResult){const t=this.getConf("htsgetBase"),e=this.getConf("htsgetTrackId");this.configureResult={bam:new i.Wg({baseUrl:t,trackId:e,recordClass:a.A})}}return this.configureResult}}},35702(t,e,s){s.d(e,{A_:()=>g,C4:()=>l,El:()=>p,Tr:()=>f,a2:()=>o,aT:()=>r,hE:()=>a,hK:()=>n,hN:()=>h,oE:()=>u,og:()=>c,q7:()=>d,sO:()=>m,tQ:()=>_});var i=s(35635);const n=0,a=1,r=2,o=3,h=4,c=5,l=7,u=8,f=129,d=389,g="=ACMGRSVTWYHKDBN",p=new Uint8Array([61,97,99,109,103,114,115,118,116,119,121,104,107,100,98,110]),m=Array.from({length:128},(t,e)=>String.fromCharCode(e));function _(t){return"string"==typeof t?(0,i.YJ)(t):t||[]}},50951(t,e,s){s.d(e,{A:()=>h});var i=s(51242),n=s(35702),a=s(54257);const r="=ACMGRSVTWYHKDBN".split("");var o=s(47354);class h extends i.ud{id(){return`${this.adapter.id}-${this.fileOffset}`}get seq(){return function(t,e){const s=new Array(e);let i=0;const n=e>>1;for(let e=0;e<n;++e){const n=t[e];s[i++]=r[(240&n)>>4],s[i++]=r[15&n]}if(i<e){const e=t[n];s[i]=r[(240&e)>>4]}return s.join("")}(this.NUMERIC_SEQ,this.seq_length)}get mismatches(){const t=[];return this.forEachMismatch((e,s,i,r,o,h,c)=>{e===a.oq?t.push({type:"mismatch",start:s,length:i,base:r,qual:void 0!==o&&o>=0?o:void 0,altbase:void 0!==h&&h>0?n.sO[h]:void 0}):e===a.jm?t.push({type:"insertion",start:s,length:i,insertlen:c,insertedBases:r}):e===a.eC?t.push({type:"softclip",start:s,length:i,cliplen:c}):e===a.bU?t.push({type:"hardclip",start:s,length:i,cliplen:c}):t.push({type:2===e?"deletion":"skip",start:s,length:i})}),t}forEachMismatch(t){!function(t,e,s,i,r,o,h){if(0===s){let e=0;for(let s=0,i=t.length;s<i;s++){const i=t[s],r=i>>4,o=15&i;1<<o&n.Tr?e+=r:o===n.hE?h(a.jm,e,0,"*",-1,0,r):o===n.aT?(h(a.YX,e,r,"*",-1,0,0),e+=r):o===n.a2?(h(a.D,e,r,"N",-1,0,0),e+=r):o===n.hN?h(a.eC,e,1,`S${r}`,-1,0,r):o===n.og&&h(a.bU,e,1,`H${r}`,-1,0,r)}return}const c=i?.length??0,l=!!r,u=i&&c>0;let f=0,d=0,g=0,p=0;if(u)for(;g<c;){const t=i[g];if(!(t>=48&&t<=57))break;p=10*p+(t-48),g++}for(let s=0,m=t.length;s<m;s++){const m=t[s],_=m>>4,C=15&m;if(1<<C&n.Tr){if(u){let t=_,s=0;for(;t>0;)if(p>=t)p-=t,s+=t,t=0;else{if(s+=p,t-=p,p=0,!(g<c&&i[g]>=65&&i[g]<=90))break;{const o=d+s,u=e[o>>1]>>(1-(1&o)<<2)&15;for(h(a.oq,f+s,1,n.A_[u],l?r[o]:-1,i[g],0),g++,s++,t--,p=0;g<c;){const t=i[g];if(!(t>=48&&t<=57))break;p=10*p+(t-48),g++}}}}else if(o)for(let t=0;t<_;t++){const s=d+t,i=e[s>>1]>>(1-(1&s)<<2)&15,c=n.El[i],u=o.charCodeAt(f+t);c!==(32|u)&&h(a.oq,f+t,1,n.A_[i],l?r[s]:-1,u,0)}d+=_,f+=_}else if(C===n.hE){let t;if(1===_){const s=e[d>>1]>>(1-(1&d)<<2)&15;t=n.A_[s]}else if(2===_){const s=d,i=e[s>>1]>>(1-(1&s)<<2)&15,a=d+1,r=e[a>>1]>>(1-(1&a)<<2)&15;t=n.A_[i]+n.A_[r]}else{const s=new Array(_);for(let t=0;t<_;t++){const i=d+t,a=e[i>>1]>>(1-(1&i)<<2)&15;s[t]=n.A_[a]}t=s.join("")}h(a.jm,f,0,t,-1,0,_),d+=_}else if(C===n.aT){if(h(a.YX,f,_,"*",-1,0,0),u&&g<c&&94===i[g]){for(g++;g<c&&i[g]>=65;)g++;for(p=0;g<c;){const t=i[g];if(!(t>=48&&t<=57))break;p=10*p+(t-48),g++}}f+=_}else if(C===n.a2)h(a.D,f,_,"N",-1,0,0),f+=_;else if(C===n.oE){for(let t=0;t<_;t++){const s=d+t,m=e[s>>1]>>(1-(1&s)<<2)&15;let _=0;if(u)if(0===p&&g<c&&i[g]>=65)for(_=i[g],g++,p=0;g<c;){const t=i[g];if(!(t>=48&&t<=57))break;p=10*p+(t-48),g++}else p>0&&p--;else o&&(_=o.charCodeAt(f+t));h(a.oq,f+t,1,n.A_[m],l?r[s]:-1,_,0)}d+=_,f+=_}else C===n.hN?(h(a.eC,f,1,`S${_}`,-1,0,_),d+=_):C===n.og&&h(a.bU,f,1,`H${_}`,-1,0,_)}}(this.NUMERIC_CIGAR,this.NUMERIC_SEQ,this.seq_length,this.NUMERIC_MD,this.qual,this.ref,t)}get qualString(){return this.qual?.join(" ")}get clipLengthAtStartOfRead(){const t=this.NUMERIC_CIGAR;if(0===t.length)return 0;const e=-1===this.strand?t[t.length-1]:t[0],s=15&e;return s===n.hN||s===n.og?e>>4:0}get refName(){return this.adapter.refIdToName(this.ref_id)}get(t){switch(t){case"mismatches":return this.mismatches;case"name":return this.name;case"start":return this.start;case"refName":return this.refName;case"end":return this.end;case"strand":return this.strand;case"qual":return this.qualString;case"seq":return this.seq;case"tags":return this.tags;case"NUMERIC_SEQ":return this.NUMERIC_SEQ;case"NUMERIC_CIGAR":return this.NUMERIC_CIGAR;case"CIGAR":return this.CIGAR;case"NUMERIC_QUAL":return this.qual;case"NUMERIC_MD":return this.NUMERIC_MD;case"seq_length":return this.seq_length;case"flags":return this.flags;case"pair_orientation":return this.pair_orientation;case"next_ref":return this.next_ref;case"next_pos":return this.next_pos;case"template_length":return this.template_length;case"clipLengthAtStartOfRead":return this.clipLengthAtStartOfRead;default:return this.fields[t]}}parent(){}children(){}get fields(){return void 0===this._cachedFields&&(this._cachedFields={start:this.start,name:this.name,end:this.end,score:this.score,strand:this.strand,template_length:this.template_length,flags:this.flags,tags:this.tags,refName:this.refName,type:"match",pair_orientation:this.pair_orientation,next_ref:this.next_ref,next_pos:this.next_pos,next_segment_position:this.next_segment_position,uniqueId:this.id()}),this._cachedFields}get next_ref(){return this.isPaired()?this.adapter.refIdToName(this.next_refid):void 0}get next_segment_position(){return this.isPaired()?`${this.adapter.refIdToName(this.next_refid)}:${this.next_pos+1}`:void 0}toJSON(){return{...this.fields,CIGAR:this.CIGAR,seq:this.seq,tags:(0,o.ce)(this.tags),qual:this.qualString}}}}}]);
//# sourceMappingURL=4877.b8753ce8.chunk.js.map