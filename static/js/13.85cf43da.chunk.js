(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[13],{9342:(e,t,a)=>{"use strict";a.d(t,{Q:()=>n,n:()=>g});var r=a(68584);const n=(0,r.ConfigurationSchema)("BaseFeatureWidget",{});var o=a(42489),i=a(36422),s=a(99546);function l(e,t){return+((0,s.localStorageGetItem)(e)??t)}function c(e,t){(0,s.localStorageSetItem)(e,JSON.stringify(t))}const d="sequenceFeatureDetails";var u=a(373),p=a(8832);function m(e,t,a,r=0,n={}){t<=r||e.subfeatures?.map((e=>{m(e,t,a,r+1,n),a(e)}))}function g(e){return i.types.model("BaseFeatureWidget",{id:p.ElementId,type:i.types.literal("BaseFeatureWidget"),featureData:i.types.frozen(),formattedFields:i.types.frozen(),unformattedFeatureData:i.types.frozen(),view:i.types.safeReference(e.pluggableMstType("view","stateModel")),track:i.types.safeReference(e.pluggableMstType("track","stateModel")),trackId:i.types.maybe(i.types.string),trackType:i.types.maybe(i.types.string),maxDepth:i.types.maybe(i.types.number),sequenceFeatureDetails:i.types.optional(i.types.model("SequenceFeatureDetails").volatile((()=>{return{showCoordinatesSetting:(0,s.localStorageGetItem)(`${d}-showCoordinatesSetting`)||"none",intronBp:l(`${d}-intronBp`,10),upDownBp:l(`${d}-upDownBp`,100),upperCaseCDS:(e=`${d}-upperCaseCDS`,Boolean(JSON.parse((0,s.localStorageGetItem)(e)||JSON.stringify(!0)))),charactersPerRow:100,feature:void 0,mode:""};var e})).actions((e=>({setFeature(t){e.feature=t},setUpDownBp(t){e.upDownBp=t},setIntronBp(t){e.intronBp=t},setUpperCaseCDS(t){e.upperCaseCDS=t},setShowCoordinates(t){e.showCoordinatesSetting=t},setMode(t){e.mode=t}}))).views((e=>({get showCoordinates(){return"none"!==e.showCoordinatesSetting},get showGenomicCoordsOption(){return"gene"===e.mode||"gene_updownstream"===e.mode||"genomic"===e.mode||"genomic_sequence_updownstream"===e.mode},get hasCDS(){return e.feature?.subfeatures?.some((e=>"CDS"===e.type))},get hasExon(){return e.feature?.subfeatures?.some((e=>"exon"===e.type))},get hasExonOrCDS(){return this.hasExon||this.hasCDS}}))).actions((e=>({afterAttach(){(0,i.addDisposer)(e,(0,o.autorun)((()=>{var t,a;c(`${d}-upDownBp`,e.upDownBp),c(`${d}-intronBp`,e.intronBp),t=`${d}-upperCaseCDS`,a=e.upperCaseCDS,(0,s.localStorageSetItem)(t,JSON.stringify(a)),(0,s.localStorageSetItem)(`${d}-showCoordinatesSetting`,e.showCoordinatesSetting)}))),(0,i.addDisposer)(e,(0,o.autorun)((()=>{e.setMode(e.hasCDS?"cds":e.hasExon?"cdna":"genomic")})))}}))),{})}).volatile((()=>({error:void 0}))).actions((e=>({setFeatureData(t){e.unformattedFeatureData=t},clearFeatureData(){e.featureData=void 0},setFormattedData(t){e.featureData=t},setExtra(t,a,r){e.trackId=a,e.trackType=t,e.maxDepth=r},setError(t){e.error=t}}))).actions((e=>({afterCreate(){(0,i.addDisposer)(e,(0,o.autorun)((()=>{try{const{unformattedFeatureData:t,track:a}=e,n=(0,s.getSession)(e);if(a&&e.setExtra(a.type,a.configuration.trackId,(0,r.getConf)(a,["formatDetails","maxDepth"])),t){const o=structuredClone(t),i=(e,t)=>({...(0,r.getConf)(n,["formatDetails",e],{feature:t}),...(0,r.getConf)(a,["formatDetails",e],{feature:t})});a&&(o.__jbrowsefmt=i("feature",o),m(o,(0,r.getConf)(a,["formatDetails","depth"]),(e=>{e.__jbrowsefmt=i("subfeatures",e)}))),e.setFormattedData(o)}}catch(t){console.error(t),e.setError(t)}})))}}))).preProcessSnapshot((e=>{const{featureData:t,finalizedFeatureData:a,...r}=e;return{unformattedFeatureData:t,featureData:a,...r}})).postProcessSnapshot((e=>{const{unformattedFeatureData:t,featureData:a,...r}=e;return{finalizedFeatureData:(0,u.Il)(a),...r}}))}},373:(e,t,a)=>{"use strict";function r(e,t){return e.map((e=>t.slice(e.start,e.end))).join("")}function n(e){return`${e.start}-${e.end}`}function o(e){return e.filter(((e,t,a)=>!t||n(e)!==n(a[t-1])))}function i(e,t){return e.map((e=>({...e,start:t-e.end,end:t-e.start}))).sort(((e,t)=>e.start-t.start))}function s(e,t){if(!e.length)return[];const a=e.at(0),r=e.at(-1),n=t.findIndex((e=>e.end>=a.start&&e.start<=a.start)),o=t.findIndex((e=>e.end>=r.end&&e.start<=r.end)),i=t[o],s=t[n];return[...[...t.slice(0,n),{start:s.start,end:a.start}].map((e=>({...e,type:"five_prime_UTR"}))),...[{start:r.end,end:i.end},...t.slice(o+1)].map((e=>({...e,type:"three_prime_UTR"})))]}function l(e,t){if(!e.length)return[];const a=e.at(0),r=e.at(-1);return[...[{start:t.start,end:a.start}].map((e=>({...e,type:"five_prime_UTR"}))),...[{start:r.end,end:t.end}].map((e=>({...e,type:"three_prime_UTR"})))]}function c(e){return e.length>20?`${e.slice(0,20)}...`:e}function d(e){return JSON.parse(JSON.stringify(e,((e,t)=>void 0===t?null:t)))}a.d(t,{Il:()=>d,Qq:()=>o,SX:()=>c,V4:()=>l,YC:()=>i,h8:()=>s,o9:()=>r})},12678:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});class r{install(e){}configure(e){}}},70129:(e,t,a)=>{"use strict";a.d(t,{A:()=>W});var r={};a.r(r),a.d(r,{CoreFreeResources:()=>P,CoreGetFeatureDensityStats:()=>M,CoreGetFeatureDetails:()=>y,CoreGetFeatures:()=>k,CoreGetFileInfo:()=>w,CoreGetMetadata:()=>b,CoreGetRefNames:()=>f,CoreRender:()=>A});var n=a(36422),o=a(7552),i=a(9342),s=a(12678),l=a(68584);const c=(0,l.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0});var d=a(58921),u=a(67736),p=a(46377),m=a(3496),g=a(2406);class f extends g.A{name="CoreGetRefNames";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:n,adapterConfig:o}=r,{dataAdapter:i}=await(0,m.cK)(a,n,o);return(0,p.isFeatureAdapter)(i)?i.getRefNames(r):[]}}var h=a(99546);class y extends g.A{name="CoreGetFeatureDetails";async serializeArguments(e,t){const{rootModel:a}=this.pluginManager,r=a.session.assemblyManager,n=await(0,h.renameRegionsIfNeeded)(r,e),o=await super.serializeArguments(n,t);if("MainThreadRpcDriver"===t)return o;const{rendererType:i}=e;return this.pluginManager.getRendererType(i).serializeArgsInClient(o)}async execute(e,t){let a=e;"MainThreadRpcDriver"!==t&&(a=await this.deserializeArguments(e,t));const{rendererType:r,featureId:n}=a,o=this.pluginManager.getRendererType(r);return{feature:o.sessions[(0,h.getLayoutId)(e)]?.cachedLayout.layout.getDataByID(n)?.toJSON()}}}class b extends g.A{name="CoreGetMetadata";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:n,adapterConfig:o}=r,{dataAdapter:i}=await(0,m.cK)(a,n,o);return(0,p.isFeatureAdapter)(i)?i.getMetadata(r):null}}class w extends g.A{name="CoreGetInfo";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:n,adapterConfig:o}=r,{dataAdapter:i}=await(0,m.cK)(a,n,o);return(0,p.isFeatureAdapter)(i)?i.getHeader(r):null}}var v=a(44728),C=a(82088),S=a(6434);class k extends g.A{name="CoreGetFeatures";async deserializeReturn(e,t,a){return(await super.deserializeReturn(e,t,a)).map((e=>new S.A(e)))}async serializeArguments(e,t){const{rootModel:a}=this.pluginManager,r=a.session.assemblyManager,n=await(0,h.renameRegionsIfNeeded)(r,e);return super.serializeArguments(n,t)}async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{stopToken:n,sessionId:o,adapterConfig:i,regions:s,opts:l}=r,{dataAdapter:c}=await(0,m.cK)(a,o,i);if(!(0,p.isFeatureAdapter)(c))throw new Error("Adapter does not support retrieving features");const d=c.getFeaturesInMultipleRegions(s,{...l,stopToken:n});return(await(0,v._)(d.pipe((0,C.$)()))).map((e=>e.toJSON()))}}function T(e,t){if(!t.ReactComponent)throw new Error(`renderer ${e} has no ReactComponent, it may not be completely implemented yet`);return t}var x=a(37347);class A extends g.A{name="CoreRender";async serializeArguments(e,t){const{rootModel:a}=this.pluginManager,r=a.session.assemblyManager,n=await(0,h.renameRegionsIfNeeded)(r,e),o=await super.serializeArguments(n,t);if("MainThreadRpcDriver"===t)return o;const{rendererType:i}=e;return T(i,this.pluginManager.getRendererType(i)).serializeArgsInClient(o)}async execute(e,t){let a=e;"MainThreadRpcDriver"!==t&&(a=await this.deserializeArguments(e,t));const{sessionId:r,rendererType:n,stopToken:o}=a;if(!r)throw new Error("must pass a unique session id");(0,x.SW)(o);const i=T(n,this.pluginManager.getRendererType(n)),s="MainThreadRpcDriver"===t?await i.render(a):await i.renderInWorker(a);return(0,x.SW)(o),s}async deserializeReturn(e,t,a){const r=await super.deserializeReturn(e,t,a);if("MainThreadRpcDriver"===a)return r;const{rendererType:n}=t;return T(n,this.pluginManager.getRendererType(n)).deserializeResultsInClient(r,t)}}class P extends g.A{name="CoreFreeResources";async execute(e){let t=0;return t+=(0,m.pZ)(e),this.pluginManager.getRendererTypes().forEach((e=>{const a=e.freeResources();a&&(t+=a)})),t}async serializeArguments(e,t){return e}}class M extends g.A{name="CoreGetFeatureDensityStats";async serializeArguments(e,t){const{rootModel:a}=this.pluginManager,r=a.session.assemblyManager,n=await(0,h.renameRegionsIfNeeded)(r,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(n,t)}async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{adapterConfig:n,sessionId:o,regions:i}=r,{dataAdapter:s}=await(0,m.cK)(a,o,n);if(!(0,p.isFeatureAdapter)(s))throw new Error("Adapter does not support retrieving features");return s.getMultiRegionFeatureDensityStats(i,r)}}class E extends s.A{name="CorePlugin";install(e){Object.values(r).forEach((t=>{e.addRpcMethod((()=>new t(e)))})),function(e){e.addAdapterType((()=>new d.AdapterType({name:"CytobandAdapter",configSchema:c,getAdapterClass:()=>a.e(4284).then(a.bind(a,94284)).then((e=>e.default))})))}(e),e.addWidgetType((()=>new u.A({name:"BaseFeatureWidget",heading:"Feature details",configSchema:i.Q,stateModel:(0,i.n)(e),ReactComponent:(0,o.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(3011),a.e(6157),a.e(1405),a.e(4144),a.e(3300)]).then(a.bind(a,93300))))})))}}var R=a(2862),I=a(47369),N=a(32767),L=a(91612),D=a(56328),F=a(92070),B=a(8024),V=a(58273),z=a(63589),O=a(97666),H=a(53085);class G{phaseCallbacks=new Map;phaseOrder=[];constructor(...e){this.phaseOrder=e}add(e,t){if(!this.phaseOrder.includes(e))throw new Error(`unknown phase ${e}`);let a=this.phaseCallbacks.get(e);a||(a=[],this.phaseCallbacks.set(e,a)),a.push(t)}run(){this.phaseOrder.forEach((e=>{this.phaseCallbacks.get(e)?.forEach((e=>e()))}))}}class j{registeredTypes={};constructor(e,t){this.typeName=e,this.baseClass=t}add(e,t){this.registeredTypes[e]=t}has(e){return e in this.registeredTypes}get(e){if(!this.has(e))throw new Error(`${this.typeName} '${e}' not found, perhaps its plugin is not loaded or its plugin has not added it.`);return this.registeredTypes[e]}all(){return Object.values(this.registeredTypes)}}class W{plugins=[];jexl=(0,H.A)();pluginMetadata={};runtimePluginDefinitions=[];elementCreationSchedule=new G("renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account","add track workflow");rendererTypes=new j("RendererType",O.default);adapterTypes=new j("AdapterType",I.A);textSearchAdapterTypes=new j("TextSearchAdapterType",B.A);trackTypes=new j("TrackType",V.A);displayTypes=new j("DisplayType",D.A);connectionTypes=new j("ConnectionType",L.A);viewTypes=new j("ViewType",z.A);widgetTypes=new j("WidgetType",u.A);rpcMethods=new j("RpcMethodType",g.A);addTrackWidgets=new j("AddTrackWorkflow",N.A);internetAccountTypes=new j("InternetAccountType",F.A);configured=!1;extensionPoints=new Map;constructor(e=[]){this.addPlugin({plugin:new E,metadata:{isCore:!0}}),e.forEach((e=>{this.addPlugin(e)}))}pluginConfigurationSchemas(){const e={};return this.plugins.forEach((t=>{t.configurationSchema&&(e[t.name]=t.configurationSchema)})),e}addPlugin(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");const[t,a={}]="install"in e&&"configure"in e?[e,{}]:[e.plugin,e.metadata];if(this.plugins.includes(t))throw new Error("plugin already installed");return this.pluginMetadata[t.name]=a,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),t.install(this),this.plugins.push(t),this}getPlugin(e){return this.plugins.find((t=>t.name===e))}hasPlugin(e){return void 0!==this.getPlugin(e)}createPluggableElements(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),this.elementCreationSchedule=void 0),this}setRootModel(e){return this.rootModel=e,this}configure(){if(this.configured)throw new Error("already configured");return this.plugins.forEach((e=>{e.configure(this)})),this.configured=!0,this}getElementTypeRecord(e){switch(e){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;case"add track workflow":return this.addTrackWidgets;default:throw new Error(`invalid element type '${e}'`)}}addElementType(e,t){if("function"!=typeof t)throw new Error("must provide a callback function that returns the new type object");const a=this.getElementTypeRecord(e);return this.elementCreationSchedule?.add(e,(()=>{const r=t(this);if(!r.name)throw new Error(`cannot add a ${e} with no name`);if(a.has(r.name))throw new Error(`${e} ${r.name} already registered, cannot register it again`);a.add(r.name,this.evaluateExtensionPoint("Core-extendPluggableElement",r))})),this}getElementType(e,t){return this.getElementTypeRecord(e).get(t)}getElementTypesInGroup(e){return this.getElementTypeRecord(e).all()}getViewElements(){return this.getElementTypesInGroup("view")}getTrackElements(){return this.getElementTypesInGroup("track")}getConnectionElements(){return this.getElementTypesInGroup("connection")}getAddTrackWorkflowElements(){return this.getElementTypesInGroup("add track workflow")}getRpcElements(){return this.getElementTypesInGroup("rpc method")}getDisplayElements(){return this.getElementTypesInGroup("display")}getAdapterElements(){return this.getElementTypesInGroup("adapter")}pluggableMstType(e,t,a=n.types.maybe(n.types.null)){const r=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,n.isType)(e)&&(0,n.isModelType)(e)));return 0===r.length&&"undefined"==typeof jest?(console.warn(`No pluggable types found matching ('${e}','${t}')`),a):n.types.union(...r)}pluggableConfigSchemaType(e,t="configSchema"){const a=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,l.isBareConfigurationSchemaType)(e)));return 0===a.length&&a.push((0,l.ConfigurationSchema)("Null",{})),n.types.union(...a)}jbrequireCache=new Map;lib=R.A;load=e=>(this.jbrequireCache.has(e)||this.jbrequireCache.set(e,e(this)),this.jbrequireCache.get(e));jbrequire=e=>{if("string"==typeof e){const t=this.lib[e];if(!t)throw new TypeError(`No jbrequire re-export defined for package '${e}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`);return t}if("function"==typeof e)return this.load(e);if(e.default)return this.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")};getRendererType(e){return this.rendererTypes.get(e)}getRendererTypes(){return this.rendererTypes.all()}getAdapterType(e){return this.adapterTypes.get(e)}getTextSearchAdapterType(e){return this.textSearchAdapterTypes.get(e)}getTrackType(e){return this.trackTypes.get(e)}getDisplayType(e){return this.displayTypes.get(e)}getViewType(e){return this.viewTypes.get(e)}getAddTrackWorkflow(e){return this.addTrackWidgets.get(e)}getWidgetType(e){return this.widgetTypes.get(e)}getConnectionType(e){return this.connectionTypes.get(e)}getRpcMethodType(e){return this.rpcMethods.get(e)}getInternetAccountType(e){return this.internetAccountTypes.get(e)}addRendererType(e){return this.addElementType("renderer",e)}addAdapterType(e){return this.addElementType("adapter",e)}addTextSearchAdapterType(e){return this.addElementType("text search adapter",e)}addTrackType(e){return this.addElementType("track",(()=>{const t=e(this);return this.getElementTypesInGroup("display").forEach((e=>{e.trackType!==t.name||t.displayTypes.includes(e)||t.addDisplayType(e)})),t}))}addDisplayType(e){return this.addElementType("display",e)}addViewType(e){return this.addElementType("view",(()=>{const t=e(this);return this.getElementTypesInGroup("display").forEach((e=>{e.viewType!==t.name&&e.viewType!==t.extendedName||t.displayTypes.includes(e)||t.addDisplayType(e)})),t}))}addWidgetType(e){return this.addElementType("widget",e)}addConnectionType(e){return this.addElementType("connection",e)}addRpcMethod(e){return this.addElementType("rpc method",e)}addInternetAccountType(e){return this.addElementType("internet account",e)}addAddTrackWorkflowType(e){return this.addElementType("add track workflow",e)}addToExtensionPoint(e,t){let a=this.extensionPoints.get(e);a||(a=[],this.extensionPoints.set(e,a)),a.push(t)}evaluateExtensionPoint(e,t,a){const r=this.extensionPoints.get(e);let n=t;if(r)for(const e of r)try{n=e(n,a)}catch(e){console.error(e)}return n}async evaluateAsyncExtensionPoint(e,t,a){const r=this.extensionPoints.get(e);let n=t;if(r)for(const e of r)try{n=await e(n,a)}catch(e){console.error(e)}return n}}},2862:(e,t,a)=>{"use strict";a.d(t,{A:()=>le});var r=a(7552),n=a(48231),o=a(963),i=a(46322),s=a(78301),l=a(76404),c=a(3274),d=a(64565),u=a(42489),p=a(68446),m=a(36422),g=a(69500),f=a.t(g,2),h=a(28485),y=a.t(h,2),b=a(75785),w=a(12678),v=a(68584),C=a(46377),S=a(58921);const k=["mobx","mobx-state-tree","react","react/jsx-runtime","react-dom","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react/mui","@material-ui/core","@mui/material","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"];var T=a(47369),x=a(56328),A=a(58273),P=a(63589),M=a(67736),E=a(1622),R=a(98111),I=a(94318),N=a(92880),L=a(97666),D=a(198),F=a(49823),B=a(99546),V=a(97884),z=a(80208),O=a(99834),H=a(88217),G=a(23550),j=a(66885),W=a(91468),$=a(8832);function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},U.apply(null,arguments)}const q={Accordion:(0,r.lazy)((()=>Promise.all([a.e(3011),a.e(7909)]).then(a.bind(a,7909)))),AccordionActions:(0,r.lazy)((()=>a.e(7309).then(a.bind(a,67309)))),AccordionDetails:(0,r.lazy)((()=>a.e(5101).then(a.bind(a,75101)))),Alert:(0,r.lazy)((()=>a.e(2197).then(a.bind(a,22197)))),AlertTitle:(0,r.lazy)((()=>a.e(7418).then(a.bind(a,27418)))),Autocomplete:(0,r.lazy)((()=>a.e(9329).then(a.bind(a,79329)))),Avatar:(0,r.lazy)((()=>a.e(2872).then(a.bind(a,42872)))),AvatarGroup:(0,r.lazy)((()=>a.e(4902).then(a.bind(a,34902)))),Backdrop:(0,r.lazy)((()=>a.e(1999).then(a.bind(a,11999)))),Badge:(0,r.lazy)((()=>a.e(3940).then(a.bind(a,13940)))),Box:(0,r.lazy)((()=>a.e(8114).then(a.bind(a,48114)))),Breadcrumbs:(0,r.lazy)((()=>a.e(366).then(a.bind(a,40366)))),Button:(0,r.lazy)((()=>a.e(4861).then(a.bind(a,54861)))),ButtonGroup:(0,r.lazy)((()=>a.e(7579).then(a.bind(a,17579)))),Card:(0,r.lazy)((()=>a.e(439).then(a.bind(a,50439)))),CardActions:(0,r.lazy)((()=>a.e(2306).then(a.bind(a,32306)))),CardActionArea:(0,r.lazy)((()=>a.e(8483).then(a.bind(a,38483)))),CardContent:(0,r.lazy)((()=>a.e(596).then(a.bind(a,596)))),CardHeader:(0,r.lazy)((()=>a.e(1598).then(a.bind(a,31598)))),CardMedia:(0,r.lazy)((()=>a.e(2141).then(a.bind(a,12141)))),CircularProgress:(0,r.lazy)((()=>a.e(7203).then(a.bind(a,97203)))),Collapse:(0,r.lazy)((()=>a.e(8678).then(a.bind(a,78678)))),ClickAwayListener:(0,r.lazy)((()=>a.e(2777).then(a.bind(a,42777)))),Chip:(0,r.lazy)((()=>a.e(2583).then(a.bind(a,2583)))),Checkbox:(0,r.lazy)((()=>a.e(7812).then(a.bind(a,7812)))),Container:(0,r.lazy)((()=>a.e(1157).then(a.bind(a,61157)))),Dialog:(0,r.lazy)((()=>a.e(1029).then(a.bind(a,41029)))),DialogActions:(0,r.lazy)((()=>a.e(8052).then(a.bind(a,68052)))),DialogTitle:(0,r.lazy)((()=>a.e(2729).then(a.bind(a,82729)))),DialogContent:(0,r.lazy)((()=>a.e(8582).then(a.bind(a,18582)))),DialogContentText:(0,r.lazy)((()=>a.e(2321).then(a.bind(a,42321)))),Divider:(0,r.lazy)((()=>a.e(4414).then(a.bind(a,64414)))),Drawer:(0,r.lazy)((()=>a.e(5608).then(a.bind(a,15608)))),Fab:(0,r.lazy)((()=>a.e(7974).then(a.bind(a,97974)))),Fade:(0,r.lazy)((()=>a.e(4659).then(a.bind(a,24659)))),FilledInput:(0,r.lazy)((()=>a.e(9943).then(a.bind(a,29943)))),FormLabel:(0,r.lazy)((()=>a.e(6423).then(a.bind(a,86423)))),FormControl:(0,r.lazy)((()=>a.e(2775).then(a.bind(a,25156)))),FormControlLabel:(0,r.lazy)((()=>a.e(2398).then(a.bind(a,22398)))),FormHelperText:(0,r.lazy)((()=>a.e(120).then(a.bind(a,70120)))),FormGroup:(0,r.lazy)((()=>a.e(6342).then(a.bind(a,76342)))),Grid:(0,r.lazy)((()=>a.e(6397).then(a.bind(a,6397)))),Grow:(0,r.lazy)((()=>a.e(1354).then(a.bind(a,91354)))),Icon:(0,r.lazy)((()=>a.e(12).then(a.bind(a,60012)))),IconButton:(0,r.lazy)((()=>a.e(3368).then(a.bind(a,83368)))),Input:(0,r.lazy)((()=>a.e(4395).then(a.bind(a,44395)))),InputBase:(0,r.lazy)((()=>a.e(6526).then(a.bind(a,86526)))),InputLabel:(0,r.lazy)((()=>a.e(6323).then(a.bind(a,66323)))),InputAdornment:(0,r.lazy)((()=>a.e(3003).then(a.bind(a,3003)))),Link:(0,r.lazy)((()=>a.e(4629).then(a.bind(a,94629)))),LinearProgress:(0,r.lazy)((()=>a.e(5763).then(a.bind(a,45763)))),List:(0,r.lazy)((()=>a.e(7773).then(a.bind(a,87773)))),ListItem:(0,r.lazy)((()=>a.e(266).then(a.bind(a,266)))),ListItemAvatar:(0,r.lazy)((()=>a.e(1345).then(a.bind(a,61345)))),ListItemSecondaryAction:(0,r.lazy)((()=>a.e(7374).then(a.bind(a,97374)))),ListItemIcon:(0,r.lazy)((()=>a.e(5327).then(a.bind(a,65327)))),ListSubheader:(0,r.lazy)((()=>a.e(8216).then(a.bind(a,68216)))),ListItemText:(0,r.lazy)((()=>a.e(1757).then(a.bind(a,61757)))),Menu:(0,r.lazy)((()=>a.e(26).then(a.bind(a,70026)))),MenuItem:(0,r.lazy)((()=>a.e(2493).then(a.bind(a,32493)))),MenuList:(0,r.lazy)((()=>a.e(1310).then(a.bind(a,81310)))),Modal:(0,r.lazy)((()=>a.e(8150).then(a.bind(a,98150)))),NativeSelect:(0,r.lazy)((()=>a.e(4947).then(a.bind(a,34947)))),OutlinedInput:(0,r.lazy)((()=>a.e(6149).then(a.bind(a,56149)))),Pagination:(0,r.lazy)((()=>a.e(1516).then(a.bind(a,51516)))),PaginationItem:(0,r.lazy)((()=>a.e(3266).then(a.bind(a,83266)))),Paper:(0,r.lazy)((()=>a.e(3029).then(a.bind(a,93029)))),Popover:(0,r.lazy)((()=>a.e(1978).then(a.bind(a,1978)))),Popper:(0,r.lazy)((()=>a.e(6799).then(a.bind(a,6799)))),Portal:(0,r.lazy)((()=>a.e(7067).then(a.bind(a,37067)))),Radio:(0,r.lazy)((()=>a.e(9384).then(a.bind(a,79384)))),RadioGroup:(0,r.lazy)((()=>a.e(5951).then(a.bind(a,25951)))),Rating:(0,r.lazy)((()=>a.e(2885).then(a.bind(a,92885)))),ScopedCssBaseline:(0,r.lazy)((()=>a.e(4615).then(a.bind(a,54615)))),Select:(0,r.lazy)((()=>a.e(6785).then(a.bind(a,36785)))),Skeleton:(0,r.lazy)((()=>a.e(518).then(a.bind(a,50518)))),Slider:(0,r.lazy)((()=>a.e(1824).then(a.bind(a,91824)))),Snackbar:(0,r.lazy)((()=>a.e(5090).then(a.bind(a,5090)))),SnackbarContent:(0,r.lazy)((()=>a.e(8187).then(a.bind(a,58187)))),SpeedDial:(0,r.lazy)((()=>a.e(9292).then(a.bind(a,99292)))),SpeedDialAction:(0,r.lazy)((()=>a.e(7407).then(a.bind(a,67407)))),SpeedDialIcon:(0,r.lazy)((()=>a.e(9458).then(a.bind(a,9458)))),Stack:(0,r.lazy)((()=>a.e(1260).then(a.bind(a,11260)))),Step:(0,r.lazy)((()=>a.e(7991).then(a.bind(a,47991)))),StepButton:(0,r.lazy)((()=>a.e(2062).then(a.bind(a,12062)))),StepConnector:(0,r.lazy)((()=>a.e(6658).then(a.bind(a,76658)))),StepLabel:(0,r.lazy)((()=>a.e(6703).then(a.bind(a,26703)))),StepIcon:(0,r.lazy)((()=>a.e(2246).then(a.bind(a,32246)))),Stepper:(0,r.lazy)((()=>a.e(6054).then(a.bind(a,36054)))),SvgIcon:(0,r.lazy)((()=>a.e(3728).then(a.bind(a,13728)))),Switch:(0,r.lazy)((()=>a.e(7117).then(a.bind(a,67117)))),Tab:(0,r.lazy)((()=>a.e(8165).then(a.bind(a,28165)))),Table:(0,r.lazy)((()=>a.e(8535).then(a.bind(a,78535)))),TableBody:(0,r.lazy)((()=>a.e(3103).then(a.bind(a,3103)))),TableCell:(0,r.lazy)((()=>a.e(4435).then(a.bind(a,74435)))),TableContainer:(0,r.lazy)((()=>a.e(3274).then(a.bind(a,93274)))),TableFooter:(0,r.lazy)((()=>a.e(9824).then(a.bind(a,39824)))),TableHead:(0,r.lazy)((()=>a.e(9657).then(a.bind(a,79657)))),TablePagination:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8105)]).then(a.bind(a,74379)))),TableRow:(0,r.lazy)((()=>a.e(561).then(a.bind(a,70561)))),TableSortLabel:(0,r.lazy)((()=>a.e(3862).then(a.bind(a,93862)))),Tabs:(0,r.lazy)((()=>a.e(1110).then(a.bind(a,91110)))),TextField:(0,r.lazy)((()=>a.e(9690).then(a.bind(a,49690)))),TextareaAutosize:(0,r.lazy)((()=>a.e(9037).then(a.bind(a,29037)))),ToggleButton:(0,r.lazy)((()=>a.e(2861).then(a.bind(a,82861)))),ToggleButtonGroup:(0,r.lazy)((()=>a.e(1012).then(a.bind(a,21012)))),Toolbar:(0,r.lazy)((()=>a.e(3012).then(a.bind(a,83012)))),Tooltip:(0,r.lazy)((()=>a.e(1996).then(a.bind(a,1996)))),Typography:(0,r.lazy)((()=>a.e(7584).then(a.bind(a,47584))))},_=Object.fromEntries(Object.entries(q).map((([e,t])=>{const a=r.forwardRef(((e,a)=>r.createElement(r.Suspense,{fallback:null},r.createElement(t,U({},e,{ref:a})))));return a.displayName=e,[e,a]}))),J=Object.fromEntries(Object.entries(_).map((([e,t])=>[`@material-ui/core/${e}`,t]))),X=Object.fromEntries(Object.entries(_).map((([e,t])=>[`@mui/material/${e}`,t]))),Y=(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(8506)]).then(a.bind(a,35300)))),K=(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(3011),a.e(6157),a.e(1405),a.e(4144)]).then(a.bind(a,84144)))),Q=(0,r.lazy)((()=>Promise.all([a.e(3011),a.e(7083)]).then(a.bind(a,87083)))),Z={DataGrid:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.DataGrid}))))),GridActionsCellItem:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridActionsCellItem}))))),GridAddIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridAddIcon}))))),GridArrowDownwardIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridArrowDownwardIcon}))))),GridArrowUpwardIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridArrowUpwardIcon}))))),GridCellCheckboxForwardRef:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridCellCheckboxForwardRef}))))),GridCellCheckboxRenderer:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridCellCheckboxRenderer}))))),GridCheckCircleIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridCheckCircleIcon}))))),GridCheckIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridCheckIcon}))))),GridCloseIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridCloseIcon}))))),GridColumnHeaderSeparator:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridColumnHeaderSeparator}))))),GridColumnHeaderSortIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridColumnHeaderSortIcon}))))),GridColumnIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridColumnIcon}))))),GridColumnMenu:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridColumnMenu}))))),GridColumnMenuContainer:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridColumnMenuContainer}))))),GridDragIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridDragIcon}))))),GridExpandMoreIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridExpandMoreIcon}))))),GridFilterAltIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridFilterAltIcon}))))),GridFilterForm:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridFilterForm}))))),GridFilterListIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridFilterListIcon}))))),GridFilterPanel:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridFilterPanel}))))),GridFooter:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridFooter}))))),GridFooterContainer:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridFooterContainer}))))),GridHeader:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridHeader}))))),GridHeaderCheckbox:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridHeaderCheckbox}))))),GridKeyboardArrowRight:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridKeyboardArrowRight}))))),GridLoadIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridLoadIcon}))))),GridLoadingOverlay:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridLoadingOverlay}))))),GridMenuIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridMenuIcon}))))),GridMoreVertIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridMoreVertIcon}))))),GridNoRowsOverlay:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridNoRowsOverlay}))))),GridOverlay:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridOverlay}))))),GridPagination:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridPagination}))))),GridPanel:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridPanel}))))),GridPanelWrapper:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridPanelWrapper}))))),GridRemoveIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridRemoveIcon}))))),GridRoot:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridRoot}))))),GridRowCount:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridRowCount}))))),GridSaveAltIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridSaveAltIcon}))))),GridSearchIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridSearchIcon}))))),GridSelectedRowCount:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridSelectedRowCount}))))),GridSeparatorIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridSeparatorIcon}))))),GridTableRowsIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridTableRowsIcon}))))),GridToolbar:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridToolbar}))))),GridToolbarColumnsButton:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridToolbarColumnsButton}))))),GridToolbarContainer:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridToolbarContainer}))))),GridToolbarDensitySelector:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridToolbarDensitySelector}))))),GridToolbarExport:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridToolbarExport}))))),GridToolbarExportContainer:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridToolbarExportContainer}))))),GridToolbarFilterButton:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridToolbarFilterButton}))))),GridTripleDotsVerticalIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridTripleDotsVerticalIcon}))))),GridViewHeadlineIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridViewHeadlineIcon}))))),GridViewStreamIcon:(0,r.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(6651)]).then(a.bind(a,75083)).then((e=>({default:e.GridViewStreamIcon})))))},ee=Object.fromEntries(Object.entries(Z).map((([e,t])=>{const a=r.forwardRef(((e,a)=>r.createElement(r.Suspense,{fallback:null},r.createElement(t,U({},e,{ref:a})))));return a.displayName=e,[e,a]}))),te=r.forwardRef(((e,t)=>r.createElement(r.Suspense,{fallback:null},r.createElement(Y,U({},e,{ref:t})))));te.displayName="Attributes";const ae=r.forwardRef(((e,t)=>r.createElement(r.Suspense,{fallback:null},r.createElement(K,U({},e,{ref:t})))));ae.displayName="FeatureDetails";const re=r.forwardRef(((e,t)=>r.createElement(r.Suspense,{fallback:null},r.createElement(Q,U({},e,{ref:t})))));re.displayName="BaseCard";const ne={mobx:u,"mobx-state-tree":m,react:r,"react/jsx-runtime":f,"react-dom":y,"mobx-react":p,"@mui/x-data-grid":{useGridApiContext:l.h,useGridApiRef:c.b,useGridRootProps:d.A,...ee},"@mui/material/utils":s,"@material-ui/core/utils":s,"tss-react/mui":{makeStyles:b.n9},"@material-ui/core":{..._,useTheme:n.A,alpha:o.X4,makeStyles:e=>{const t=(0,b.n9)()(e);return()=>t().classes}},"@mui/material":{..._,alpha:o.X4,useTheme:n.A},"@mui/material/styles":{MUIStyles:i,makeStyles:e=>{const t=(0,b.n9)()(e);return()=>t().classes}},"@material-ui/core/styles":{MUIStyles:i,makeStyles:e=>{const t=(0,b.n9)()(e);return()=>t().classes}},...J,...X,"@material-ui/lab/ToggleButton":q.ToggleButton,"@material-ui/lab/ToggleButtonGroup":q.ToggleButtonGroup,"@material-ui/lab/Autocomplete":q.Autocomplete,"@material-ui/lab/Alert":q.Alert,"@material-ui/lab":{Alert:q.Alert,Autocomplete:q.Autocomplete,ToggleButton:q.ToggleButton,ToggleButtonGroup:q.ToggleButtonGroup},"@jbrowse/core/Plugin":w.A,"@jbrowse/core/pluggableElementTypes":S,"@jbrowse/core/pluggableElementTypes/ViewType":P.A,"@jbrowse/core/pluggableElementTypes/AdapterType":T.A,"@jbrowse/core/pluggableElementTypes/DisplayType":x.A,"@jbrowse/core/pluggableElementTypes/TrackType":A.A,"@jbrowse/core/pluggableElementTypes/WidgetType":M.A,"@jbrowse/core/pluggableElementTypes/models":E,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":D,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":I.A,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":R,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":N,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":L,"@jbrowse/core/configuration":v,"@jbrowse/core/util/types/mst":$,"@jbrowse/core/ui":F,"@jbrowse/core/util":B,"@jbrowse/core/util/color":z,"@jbrowse/core/util/layouts":H,"@jbrowse/core/util/tracks":W,"@jbrowse/core/util/Base1DViewModel":V.A,"@jbrowse/core/util/io":O,"@jbrowse/core/util/mst-reflection":G,"@jbrowse/core/util/rxjs":j,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":{Attributes:te,FeatureDetails:ae,BaseCard:re},"@jbrowse/core/data_adapters/BaseAdapter":C},oe=Object.keys(ne),ie=oe.filter((e=>!k.includes(e)));if(ie.length>0)throw new Error(`The following modules are in the modules libs, but not the re-exports list: ${ie.join(", ")}`);const se=k.filter((e=>!oe.includes(e)));if(se.length)throw new Error(`The following modules are in the re-exports list, but not the modules libs: ${se.join(", ")}`);const le=ne},8656:(e,t,a)=>{"use strict";a.d(t,{A:()=>r,S:()=>n});class r{constructor(e){this.label=e.label,this.locString=e.locString,this.renderingComponent=e.renderingComponent,this.displayString=e.displayString,this.matchedAttribute=e.matchedAttribute,this.matchedObject=e.matchedObject,this.textSearchAdapter=e.textSearchAdapter,this.relevance=e.relevance,this.trackId=e.trackId,this.score=e.score||1,this.results=e.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(e){return this.score=e,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}class n extends r{constructor(e){super(e),this.refName=e.refName??""}getLocation(){return this.refName}}},83059:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(68584),n=a(43334);class o{adapterCache=new n.A({maxSize:15});constructor(e){this.pluginManager=e}loadTextSearchAdapters(e){return Promise.all(this.relevantAdapters(e).map((async e=>{const t=(0,r.readConfObject)(e,"textSearchAdapterId"),a=this.adapterCache.get(t);if(a)return a;{const a=this.pluginManager.getTextSearchAdapterType(e.type),r=new(await a.getAdapterClass())(e,void 0,this.pluginManager);return this.adapterCache.set(t,r),r}})))}relevantAdapters(e){const t=this.pluginManager.rootModel,{aggregateTextSearchAdapters:a}=t?.jbrowse,{tracks:r}=t?.session,{assemblyName:n}=e;return[...this.getAdaptersWithAssembly(n,a),...this.getTrackAdaptersWithAssembly(n,r)]}getAdaptersWithAssembly(e,t){return t.filter((t=>(0,r.readConfObject)(t,"assemblyNames")?.includes(e)))}getTrackAdaptersWithAssembly(e,t){return t.filter((t=>(0,r.readConfObject)(t,["textSearching","textSearchAdapter","assemblyNames"])?.includes(e))).map((e=>e.textSearching.textSearchAdapter))}async search(e,t,a){const r=await this.loadTextSearchAdapters(t),n=await Promise.all(r.map((t=>t.searchIndex(e))));return this.sortResults(n.flat(),a)}sortResults(e,t){return t(e.sort(((e,t)=>-t.getLabel().localeCompare(e.getLabel())))).sort(((e,t)=>e.getScore()-t.getScore()))}}},42498:(e,t,a)=>{"use strict";a.d(t,{A:()=>h,S:()=>f});var r=a(36422),n=a(99546),o=a(43283),i=a(8832);const s={stringArray:r.types.array(r.types.string),stringArrayMap:r.types.map(r.types.array(r.types.string)),numberMap:r.types.map(r.types.number),boolean:r.types.boolean,color:r.types.refinement("Color",r.types.string,(function(){return!0})),integer:r.types.integer,number:r.types.number,string:r.types.string,text:r.types.string,fileLocation:i.FileLocation,frozen:r.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},c=e=>({views:{get valueJSON(){return e.value}}}),d=e=>({views:{get valueJSON(){return JSON.stringify(e.value)}}}),u={fileLocation:d,number:c,integer:c,boolean:c,frozen:d,stringArray:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t){e.value.push(t)},removeAtIndex(t){e.value.splice(t,1)},setAtIndex(t,a){e.value[t]=a}}}),stringArrayMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,a){e.value.set(t,a)},remove(t){e.value.delete(t)},addToKey(t,a){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.push(a)},removeAtKeyIndex(t,a){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.splice(a,1)},setAtKeyIndex(t,a,r){const n=e.value.get(t);if(!n)throw new Error(`${t} not found`);n[a]=r}}}),numberMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,a){e.value.set(t,a)},remove(t){e.value.delete(t)}}})},p=r.types.refinement("JexlString",r.types.string,(e=>e.startsWith("jexl:")));var m=a(35254);function g(e){return Array.isArray(e)&&0===e.length}function f(e,t,a){const{schemaDefinition:c,options:d}=function(e,t,a={}){if("string"!=typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");let r=t,n=a;return a.baseConfiguration?.jbrowseSchemaDefinition&&(r={...a.baseConfiguration.jbrowseSchemaDefinition,...r},n={...a.baseConfiguration.jbrowseSchemaOptions,...a},n.baseConfiguration=void 0),{schemaDefinition:r,options:n}}(e,t,a),f=function(e,t,a){const c={};let d;if(a.explicitlyTyped&&(c.type=r.types.optional(r.types.literal(e),e)),a.explicitIdentifier&&a.implicitIdentifier)throw new Error(`Cannot have both explicit and implicit identifiers in ${e}`);a.explicitIdentifier?"string"==typeof a.explicitIdentifier?(c[a.explicitIdentifier]=r.types.identifier,d=a.explicitIdentifier):(c.id=r.types.identifier,d="id"):a.implicitIdentifier&&("string"==typeof a.implicitIdentifier?(c[a.implicitIdentifier]=i.ElementId,d=a.implicitIdentifier):(c.id=i.ElementId,d="id"));const f={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:a}};Object.entries(t).forEach((([t,a])=>{if((0,r.isType)(a)&&(0,r.isLateType)(a)||(0,m.oG)(a))c[t]=a;else if("string"==typeof a||"number"==typeof a)f[t]=a;else{if("object"!=typeof a)throw new Error(`invalid configuration schema definition, "${t}" must be either a valid configuration slot definition, a constant, or a nested configuration schema`);if(!a.type)throw new Error(`no type set for config slot ${e}.${t}`);try{c[t]=function(e,{description:t="",model:a,type:i,defaultValue:c,contextVariable:d=[]}){if(!i)throw new Error("type name required");if(a||(a=s[i]),!a)throw new Error(`no builtin config slot type "${i}", and no 'model' param provided`);if(void 0===c)throw new Error("no 'defaultValue' provided");const m=`${e.charAt(0).toUpperCase()}${e.slice(1)}ConfigSlot`;let g=r.types.model(m,{name:r.types.literal(e),description:r.types.literal(t),type:r.types.literal(i),value:r.types.optional(r.types.union(p,a),c)}).volatile((()=>({contextVariable:d}))).views((e=>({get isCallback(){return String(e.value).startsWith("jexl:")}}))).views((e=>({get expr(){if(e.isCallback){const{pluginManager:t}=(0,n.getEnv)(e);return t||"undefined"!=typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,o.A)(String(e.value),t?.jexl)}return{evalSync:()=>e.value}},get valueJSON(){var t;if(!e.isCallback)return t=e.value,t?.toJSON?t.toJSON():`"${t}"`}}))).preProcessSnapshot((a=>"object"==typeof a&&a.name===e?a:{name:e,description:t,type:i,value:a})).postProcessSnapshot((e=>"object"==typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0)).actions((e=>({set(t){e.value=t},reset(){e.value=c},convertToCallback(){e.isCallback||(e.value=`jexl:${e.valueJSON||"''"}`)},convertToValue(){if(e.isCallback){try{const t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(e){}if(e.value=c,!(i in l))throw new Error(`no fallbackDefault defined for type ${i}`);e.value=l[i]}}})));u[i]&&(g=g.extend(u[i]));const f=r.types.optional(g,{name:e,type:i,description:t,value:c});return Object.defineProperty(f,"isJBrowseConfigurationSlot",{value:!0}),f}(t,a)}catch(a){throw new Error(`invalid config slot definition for ${e}.${t}: ${a}`)}}}));let h=r.types.model(`${e}ConfigurationSchema`,c).actions((e=>({setSubschema(t,a){if(!(0,m.oG)(c[t]))throw new Error(`${t} is not a subschema, cannot replace`);const n=(0,r.isStateTreeNode)(a)?a:c[t].create(a);return e[t]=n,n}})));Object.keys(f).length&&(h=h.volatile((()=>f))),a.actions&&(h=h.actions(a.actions)),a.views&&(h=h.views(a.views)),a.extend&&(h=h.extend(a.extend));const y=d?{[d]:"placeholderId"}:{},b=a.explicitlyTyped?{type:e,...y}:y,w=(0,r.getSnapshot)(h.create(b));return h=h.postProcessSnapshot((e=>{const t={};let a=!0;for(const[n,o]of Object.entries(e))a&&("object"==typeof w[n]&&"object"==typeof o?JSON.stringify(w[n])!==JSON.stringify(o)&&(a=!1):w[n]!==o&&(a=!1)),void 0!==o&&void 0===f[n]&&("object"!=typeof(r=o)||Array.isArray(r)||null===r||0!==Object.keys(r).length)&&!g(o)&&(t[n]=o);var r;return a?{}:t})),a.preProcessSnapshot&&(h=h.preProcessSnapshot(a.preProcessSnapshot)),r.types.optional(h,b)}(e,c,d);return f.isJBrowseConfigurationSchema=!0,f.jbrowseSchemaDefinition=c,f.jbrowseSchemaOptions=d,f}function h(e){return r.types.union(r.types.reference(e),e)}},35254:(e,t,a)=>{"use strict";a.d(t,{C$:()=>l,FI:()=>i,JC:()=>s,QZ:()=>o,Rg:()=>u,oG:()=>c,wo:()=>d});var r=a(36422),n=a(23550);function o(e,t,a={}){if(!t)return structuredClone((0,r.getSnapshot)(e));if("string"!=typeof t){if(Array.isArray(t)){const n=t[0];if(t.length>1){const i=t.slice(1);let s=e[n];return!s&&(0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(s=e.get(n)),s?o(s,i,a):void 0}return o(e,n,a)}throw new TypeError("slotPath must be a string or array")}{let n=e[t];if(!n&&(0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(n=e.get(t)),n){const e=n.expr?n.expr.evalSync(a):n;return(0,r.isStateTreeNode)(e)?JSON.parse(JSON.stringify((0,r.getSnapshot)(e))):e}}}function i(e,t,a){const{configuration:r}=e;if(d(r))return o(r,t,a);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if((0,r.isType)(e)&&(e=(0,n.resolveLateType)(e),(0,r.isUnionType)(e))){const t=[];return(0,n.getUnionSubTypes)(e).forEach((e=>{let a=s(e=(0,n.resolveLateType)(e));if(a.length||(a=[(0,n.getDefaultValue)(e).type]),!a[0])throw new Error(`invalid config schema type ${e}`);t.push(...a)})),t}return[]}function l(e){if((0,r.isType)(e)){if((0,r.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,r.isLateType)(e))return!0}return!1}function c(e){return!!(0,r.isType)(e)&&(!!l(e)||((0,r.isUnionType)(e)?(0,n.getUnionSubTypes)(e).every((e=>c(e)||"undefined"===e.name)):!(!(0,r.isOptionalType)(e)||!c((0,n.getSubType)(e)))||!(!(0,r.isArrayType)(e)||!c((0,n.getSubType)(e)))||!(!(0,r.isMapType)(e)||!c((0,n.getSubType)(e)))))}function d(e){return(0,r.isStateTreeNode)(e)&&c((0,r.getType)(e))}function u(e){return"object"==typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},46377:(e,t,a)=>{"use strict";function r(e){return"getRegions"in e&&"getFeatures"in e}function n(e){return"getRegions"in e}function o(e){return"getFeatures"in e}function i(e){return"getRefNameAliases"in e}function s(e){return"searchIndex"in e}a.r(t),a.d(t,{BaseAdapter:()=>p,BaseFeatureDataAdapter:()=>v,BaseSequenceAdapter:()=>C,isFeatureAdapter:()=>o,isRefNameAliasAdapter:()=>i,isRegionsAdapter:()=>n,isSequenceAdapter:()=>r,isTextSearchAdapter:()=>s});var l=a(36422),c=a(68584),d=a(26257);const u=(0,c.ConfigurationSchema)("empty",{});class p{static capabilities=[];constructor(e=u.create(),t,a){if(this.config=e,this.getSubAdapter=t,this.pluginManager=a,"undefined"==typeof jest){const t=(0,l.isStateTreeNode)(e)?(0,l.getSnapshot)(e):e;this.id=`${(0,d.A)(t)}`}else this.id="test"}getConf(e){return(0,c.readConfObject)(this.config,e)}}var m=a(62718),g=a(44728),f=a(82088),h=a(99546),y=a(66885),b=a(37957),w=a(37347);class v extends p{async getHeader(e){return null}async getMetadata(e){return null}getFeaturesInRegion(e,t={}){return(0,y.ObservableCreate)((async a=>{const r=await this.hasDataForRefName(e.refName,t);(0,w.SW)(t.stopToken),r?this.getFeatures(e,t).subscribe(a):a.complete()}))}getFeaturesInMultipleRegions(e,t={}){return(0,m.h)(...e.map((e=>this.getFeaturesInRegion(e,t))))}async hasDataForRefName(e,t={}){return(await this.getRefNames(t)).includes(e)}async getRegionQuantitativeStats(e,t){const a=this.getFeatures(e,t);return(0,b.qn)(e,a)}async getMultiRegionQuantitativeStats(e=[],t){if(!e.length)return(0,b.Yv)();const a=await Promise.all(e.map((e=>this.getRegionQuantitativeStats(e,t)))),r=(0,h.max)(a.map((e=>e.scoreMax))),n=(0,h.min)(a.map((e=>e.scoreMin))),o=(0,h.sum)(a.map((e=>e.scoreSum))),i=(0,h.sum)(a.map((e=>e.scoreSumSquares))),s=(0,h.sum)(a.map((e=>e.featureCount))),l=(0,h.sum)(a.map((e=>e.basesCovered)));return(0,b.WD)({scoreMin:n,scoreMax:r,featureCount:s,basesCovered:l,scoreSumSquares:i,scoreSum:o})}getRegionFeatureDensityStats(e,t){let a=+Date.now();const r=async(a,r)=>{const{start:o,end:i}=e,s=.75*o+.25*i,l=await(0,g._)(this.getFeatures({...e,start:Math.max(0,Math.round(s-a/2)),end:Math.min(Math.round(s+a/2),i)},t).pipe((0,f.$)()));return n(a,{featureDensity:l.length/a},l.length,r)},n=async(t,n,o,i)=>{const s=e.end-e.start;if(o>=70||2*t>s)return n;if(i<=5e3){const e=+Date.now();return i+=e-a,a=e,r(2*t,i)}return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:Number.POSITIVE_INFINITY}};return r(1e3,0)}async getMultiRegionFeatureDensityStats(e,t){if(!e.length)throw new Error("No regions supplied");return this.getRegionFeatureDensityStats(e[0],t)}async getSources(e){const t=await(0,g._)(this.getFeaturesInMultipleRegions(e).pipe((0,f.$)())),a=new Set;for(const e of t)a.add(e.get("source"));return[...a].map((e=>({name:e})))}}class C extends v{async getMultiRegionFeatureDensityStats(){return{featureDensity:0}}}},47369:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{constructor(e){super(e),this.getAdapterClass="AdapterClass"in e?async()=>e.AdapterClass:e.getAdapterClass,this.configSchema=e.configSchema,this.adapterCapabilities=e.adapterCapabilities||[],this.adapterMetadata=e.adapterMetadata}}},32767:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel}}},91612:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema,this.description=e.description,this.url=e.url,this.configEditorComponent=e.configEditorComponent}}},56328:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.subDisplay=e.subDisplay,this.configSchema=e.configSchema,this.ReactComponent=e.ReactComponent,this.trackType=e.trackType,this.viewType=e.viewType}}},92070:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}}},35470:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});class r{constructor(e){this.name=e?.name||"UNKNOWN",this.maybeDisplayName=e?.displayName}get displayName(){return this.maybeDisplayName||this.name}}},2406:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(35470);const n=e=>"object"==typeof e&&null!==e,o=e=>n(e)&&!(e instanceof RegExp)&&!(e instanceof Error)&&!(e instanceof Date)&&!(globalThis.Blob&&e instanceof globalThis.Blob);function i(e,t,a=new WeakSet){if(a.has(e))return;a.add(e);const r=e=>{e.forEach((e=>{t(e),n(e)&&i(e,t,a)}))};Array.isArray(e)&&r(e);for(const n of Object.values(e))t(n),o(n)&&(Array.isArray(n)?r(n):i(n,t,a))}var s=a(91468),l=a(92516);class c extends r.A{constructor(e){super(),this.pluginManager=e}async serializeArguments(e,t){const a=(0,s.getBlobMap)();return await this.augmentLocationObjects(e,t),{...e,blobMap:a}}async serializeNewAuthArguments(e,t){const a=this.pluginManager.rootModel;if(!(0,l.bV)(a)||e.internetAccountPreAuthorization)return e;const r=a.findAppropriateInternetAccount(e);return r&&"MainThreadRpcDriver"!==t&&(e.internetAccountPreAuthorization=await r.getPreAuthorizationInformation(e)),e}async deserializeArguments(e,t){return e.blobMap&&(0,s.setBlobMap)(e.blobMap),e}async serializeReturn(e,t,a){return e}async deserializeReturn(e,t,a){let r;try{r=await e}catch(e){if((0,l.ZL)(e)){const t=this.pluginManager.rootModel?.createEphemeralInternetAccount(`HTTPBasicInternetAccount-${new URL(e.url).origin}`,{},e.url);throw new l.J_("Retrying with created internet account",t.internetAccountId)}throw e}return r}async augmentLocationObjects(e,t){const a=[];i(e,(e=>{(0,l.C1)(e)&&a.push(e)}));for(const e of a)await this.serializeNewAuthArguments(e,t);return e}}},14129:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var r=a(2406),n=a(99546),o=a(93100);class i extends r.A{async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new o.A({filters:e.filters}):void 0}}async serializeArguments(e,t){const a=this.pluginManager,r=a.rootModel?.session?.assemblyManager;if(!r)throw new Error("no assembly manager");const o=await(0,n.renameRegionsIfNeeded)(r,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(o,t)}}},8024:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{constructor(e){super(e),this.description=e.description,this.configSchema=e.configSchema,this.getAdapterClass="getAdapterClass"in e?e.getAdapterClass:async()=>e.AdapterClass}}},58273:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{displayTypes=[];constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}addDisplayType(e){this.displayTypes.push(e)}}},63589:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{displayTypes=[];viewMetadata={};constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.viewMetadata=e.viewMetadata||{},this.stateModel=e.stateModel,this.extendedName=e.extendedName}addDisplayType(e){this.displayTypes.push(e)}}},67736:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(35470);class n extends r.A{constructor(e){super(e),this.heading=e.heading,this.HeadingComponent=e.HeadingComponent,this.configSchema=e.configSchema,this.stateModel=e.stateModel,this.ReactComponent=e.ReactComponent}}},58921:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AdapterType:()=>u.A,AddTrackWorkflowType:()=>w.A,BaseConnectionModelFactory:()=>d.BaseConnectionModelFactory,BaseDisplay:()=>d.BaseDisplay,BaseInternetAccountConfig:()=>d.BaseInternetAccountConfig,BaseViewModel:()=>d.BaseViewModel,BoxRendererType:()=>r.default,CircularChordRendererType:()=>o.A,ComparativeServerSideRendererType:()=>n.A,ConnectionType:()=>p.A,DisplayType:()=>h.A,FeatureRendererType:()=>s.default,InternetAccount:()=>d.InternetAccount,InternetAccountType:()=>y.A,RendererType:()=>i.default,RpcMethodType:()=>b.A,ServerSideRenderedContent:()=>l.A,ServerSideRendererType:()=>c.default,TextSearchAdapterType:()=>v.A,TrackType:()=>m.A,ViewType:()=>f.A,WidgetType:()=>g.A,baseConnectionConfig:()=>d.baseConnectionConfig,createBaseTrackConfig:()=>d.createBaseTrackConfig,createBaseTrackModel:()=>d.createBaseTrackModel});var r=a(98111),n=a(57027),o=a(94318),i=a(97666),s=a(92880),l=a(25889),c=a(198),d=a(1622),u=a(47369),p=a(91612),m=a(58273),g=a(67736),f=a(63589),h=a(56328),y=a(92070),b=a(2406),w=a(32767),v=a(8024)},7772:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var r=a(36422),n=a(8832);const o=r.types.model("BaseView",{id:n.ElementId,displayName:r.types.maybe(r.types.string),minimized:!1}).volatile((()=>({width:800}))).views((()=>({menuItems:()=>[]}))).actions((e=>({setDisplayName(t){e.displayName=t},setWidth(t){e.width=t},setMinimized(t){e.minimized=t}}))),i=o;o.props({displayedRegions:r.types.array(n.Region)})},1622:(e,t,a)=>{"use strict";a.r(t),a.d(t,{BaseConnectionModelFactory:()=>i,BaseDisplay:()=>u,BaseInternetAccountConfig:()=>p,BaseViewModel:()=>s.A,InternetAccount:()=>f,baseConnectionConfig:()=>n,createBaseTrackConfig:()=>w,createBaseTrackModel:()=>b});var r=a(68584);const n=(0,r.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"});var o=a(36422);const i=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track")),configuration:(0,r.ConfigurationReference)(n)}).actions((()=>({connect(e){}}))).actions((e=>({afterAttach(){0===e.tracks.length&&e.connect(e.configuration)},addTrackConf(t){const a=e.tracks.push(t);return e.tracks[a-1]},addTrackConfs(t){e.tracks.push(...t)},setTrackConfs(t){e.tracks=(0,o.cast)(t)},clear(){}})))};var s=a(7772),l=a(99546),c=a(91468),d=a(8832);const u=o.types.model("BaseDisplay",{id:d.ElementId,type:o.types.string,rpcDriverName:o.types.maybe(o.types.string)}).volatile((()=>({rendererTypeName:"",error:void 0,message:void 0}))).views((e=>({get RenderingComponent(){const{pluginManager:t}=(0,l.getEnv)(e);return t.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,r.getConf)(this.parentTrack,"adapter")},get parentTrack(){let t=(0,o.getParent)(e);for(;!t.configuration||!(0,r.getConf)(t,"trackId");){if((0,o.isRoot)(t))throw new Error(`No parent track found for ${e.type} ${e.id}`);t=(0,o.getParent)(t)}return t},renderProps:()=>({...(0,c.getParentRenderProps)(e),notReady:(0,l.getContainingView)(e).minimized,rpcDriverName:e.rpcDriverName,displayModel:e}),get rendererType(){const{pluginManager:t}=(0,l.getEnv)(e);return t.getRendererType(e.rendererTypeName)},get DisplayMessageComponent(){},trackMenuItems:()=>[],get viewMenuActions(){return[]},regionCannotBeRendered:()=>null}))).actions((e=>({setMessage(t){e.message=t},setError(t){e.error=t},setRpcDriverName(t){e.rpcDriverName=t},reload(){}}))),p=(0,r.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0});var m=a(99834);const g="undefined"==typeof sessionStorage,f=o.types.model("InternetAccount",{id:d.ElementId,type:o.types.string,configuration:(0,r.ConfigurationReference)(p)}).views((e=>({get name(){return(0,r.getConf)(e,"name")},get description(){return(0,r.getConf)(e,"description")},get internetAccountId(){return(0,r.getConf)(e,"internetAccountId")},get authHeader(){return(0,r.getConf)(e,"authHeader")},get tokenType(){return(0,r.getConf)(e,"tokenType")},get domains(){return(0,r.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}}))).views((e=>({handlesLocation:t=>e.domains.some((e=>t.uri.includes(e))),get tokenKey(){return`${e.internetAccountId}-token`}}))).actions((e=>({getTokenFromUser(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken(t){sessionStorage.setItem(e.tokenKey,t)},removeToken(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:()=>sessionStorage.getItem(e.tokenKey),validateToken:async(e,t)=>e}))).actions((e=>{let t;return{async getToken(a){if(t)return t;let r=a?.internetAccountPreAuthorization?.authInfo?.token;if(r)return t=Promise.resolve(r),t;if(g)throw new Error("Did not get internet account pre-authorization info in worker");return r=e.retrieveToken(),r?(t=Promise.resolve(r),t):(t=new Promise(((t,a)=>{e.getTokenFromUser((a=>{e.storeToken(a),t(a)}),(t=>{e.removeToken(),a(t)}))})),t)}}})).actions((e=>({addAuthHeaderToInit:(t,a)=>({...t,headers:new Headers({...t?.headers,...a?{[e.authHeader]:e.tokenType?`${e.tokenType} ${a}`:a}:{}})}),async getPreAuthorizationInformation(t){const a=await e.getToken(t);let n;try{n=await e.validateToken(a,t)}catch(t){throw e.removeToken(),t}return{internetAccountType:e.type,authInfo:{token:n,configuration:(0,r.getConf)(e)}}}}))).actions((e=>({getFetcher:t=>async(a,r)=>{const n=await e.getToken(t),o=e.addAuthHeaderToInit(r,n);return fetch(a,o)}}))).actions((e=>({openLocation:t=>new m.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})})));var h=a(42489),y=a(92516);function b(e,t,a){return o.types.model(t,{id:d.ElementId,type:o.types.literal(t),configuration:(0,r.ConfigurationReference)(a),minimized:!1,displays:o.types.array(e.pluggableMstType("display","stateModel"))}).views((t=>({get rpcSessionId(){return t.configuration.trackId},get name(){return(0,r.getConf)(t,"name")},get textSearchAdapter(){return(0,r.getConf)(t,"textSearchAdapter")},get adapterType(){const a=(0,r.getConf)(t,"adapter");if(!a)throw new Error(`no adapter configuration provided for ${t.type}`);const n=e.getAdapterType(a.type);if(!n)throw new Error(`unknown adapter type ${a.type}`);return n},get viewMenuActions(){return t.displays.flatMap((e=>e.viewMenuActions))},get canConfigure(){const e=(0,l.getSession)(t),{sessionTracks:a,adminMode:r}=e;return(0,y.u3)(e)&&(r||a?.find((e=>e.trackId===t.configuration.trackId)))}}))).actions((t=>({setMinimized(e){t.minimized=e},showDisplay(a,r={}){const n=e.pluggableConfigSchemaType("display"),i=(0,o.resolveIdentifier)(n,(0,o.getRoot)(t),a),s=e.getDisplayType(i.type);if(!s)throw new Error(`unknown display type ${i.type}`);const l=s.stateModel.create({...r,type:i.type,configuration:i});t.displays.push(l)},hideDisplay(a){const r=e.pluggableConfigSchemaType("display"),n=(0,o.resolveIdentifier)(r,(0,o.getRoot)(t),a),i=t.displays.filter((e=>e.configuration===n));return(0,h.transaction)((()=>{i.forEach((e=>t.displays.remove(e)))})),i.length},replaceDisplay(a,r,n={}){const i=t.displays.findIndex((e=>e.configuration.displayId===a));if(-1===i)throw new Error(`could not find display id ${a} to replace`);const s=e.pluggableConfigSchemaType("display"),l=(0,o.resolveIdentifier)(s,(0,o.getRoot)(t),r);if(!e.getDisplayType(l.type))throw new Error(`unknown display type ${l.type}`);t.displays.splice(i,1,{...n,type:l.type,configuration:l})}}))).views((t=>({trackMenuItems(){const a=t.displays.flatMap((e=>e.trackMenuItems())),r=t.displays[0].configuration.displayId,n=function(e){const{pluginManager:t}=(0,l.getEnv)(e),a=(0,l.getContainingView)(e),r=t.getViewType(a.type),n=new Set(r.displayTypes.map((e=>e.name)));return e.configuration.displays.filter((e=>n.has(e.type)))}(t);return[...a,...n.length>1?[{type:"subMenu",label:"Display types",priority:-1e3,subMenu:n.map((a=>({type:"radio",label:e.getDisplayType(a.type).displayName,checked:a.displayId===r,onClick:()=>{t.replaceDisplay(r,a.displayId)}})))}]:[]]}})))}function w(e){return(0,r.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,r.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:o.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,r.ConfigurationSchema)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2"},maxDepth:{type:"number",defaultValue:99999,description:"Maximum depth to render subfeatures"}}),formatAbout:(0,r.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const a=e.evaluateExtensionPoint("Core-preProcessTrackConfig",structuredClone(t)),{displays:r=[]}=a;if("placeholderId"!==a.trackId){const t=new Set(r.map((e=>e.type)));e.getTrackType(a.type).displayTypes.forEach((e=>{t.has(e.name)||r.push({displayId:`${a.trackId}-${e.name}`,type:e.name})}))}return{...a,displays:r}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:a}=t;if(!a)throw new Error(`unknown display type ${a}`);const r=e.displays.find((e=>e?.displayId===t.displayId));if(r)return r;const n=e.displays.push(t);return e.displays[n-1]}})})}},98111:(e,t,a)=>{"use strict";a.r(t),a.d(t,{LayoutSession:()=>u,default:()=>p});var r=a(41365),n=a.n(r),o=a(92880),i=a(68584),s=a(99546),l=a(85012),c=a(2265),d=a(75762);class u{constructor(e){this.config=e.config,this.bpPerPx=e.bpPerPx,this.filters=e.filters,this.update(e)}update(e){Object.assign(this,e)}makeLayout(){return new c.A(l.A,{maxHeight:(0,i.readConfObject)(this.config,"maxHeight"),displayMode:(0,i.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:(0,i.readConfObject)(this.config,"noSpacing")?1:3})}cachedLayoutIsValid(e){return e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&n()((0,i.readConfObject)(this.config),e.config)&&n()(this.filters,e.filters)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,i.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}class p extends o.default{sessions={};getWorkerSession(e){const t=(0,s.getLayoutId)(e);this.sessions[t]||(this.sessions[t]=this.createSession(e));const a=this.sessions[t];return a.update(e),a}getExpandedRegion(e,t){const{bpPerPx:a,config:r}=t,n=(0,i.readConfObject)(r,"maxFeatureGlyphExpansion")||0,o=Math.round(n*a);return{...e,start:Math.floor(Math.max(e.start-o,0)),end:Math.ceil(e.end+o)}}createSession(e){return new u(e)}async freeResourcesInClient(e,t){const{regions:a}=t,r=(0,s.getLayoutId)(t),n=this.sessions[r];if(n){const e=a[0];n.layout.discardRange(e.refName,e.start,e.end)}return await super.freeResourcesInClient(e,t)}deserializeLayoutInClient(e){return new d.A(e)}deserializeResultsInClient(e,t){const a=this.deserializeLayoutInClient(e.layout);return super.deserializeResultsInClient({...e,layout:a},t)}createLayoutInWorker(e){const{regions:t}=e;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}serializeResultsInWorker(e,t){const a=super.serializeResultsInWorker(e,t),r=t.regions[0];return a.layout=e.layout.serializeRegion(this.getExpandedRegion(r,t)),a.features=a.features.filter((e=>Boolean(a.layout.rectangles[e.uniqueId]))),a.maxHeightReached=a.layout.maxHeightReached,a}async render(e){const t=e.layout||this.createLayoutInWorker(e);return{...await super.render({...e,layout:t}),layout:t}}}},94318:(e,t,a)=>{"use strict";a.d(t,{A:()=>f});var r=a(7552),n=a(92880),o=a(20139),i=a(68446),s=a(36422),l=a(28485),c=a(49823),d=a(99546);const u=(0,i.observer)((function(e){const{html:t,theme:a,RenderingComponent:n,...i}=e,l=(0,r.useRef)(null),u=(0,r.useRef)(),p=(0,s.getRoot)(e.displayModel).hydrateFn;return(0,r.useEffect)((()=>{const e=(0,d.rIC)((()=>{if(!l.current)return;const e=(0,c.createJBrowseTheme)(a);u.current=u.current??p(l.current,r.createElement(o.A,{theme:e},r.createElement(n,i)))}));return()=>{void 0!==e&&clearTimeout(e);const t=u.current;u.current=void 0,setTimeout((()=>{t?.unmount()}))}}),[n,p,a,i]),r.createElement("g",{ref:l,dangerouslySetInnerHTML:{__html:t}})})),p=(0,i.observer)((function(e){const{html:t,RenderingComponent:a}=e,n=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const o=n.current;return o&&t&&(o.innerHTML&&(0,l.unmountComponentAtNode)(o),o.style.outline="none",o.innerHTML=t,(0,d.rIC)((()=>{(0,l.hydrate)(r.createElement(a,e),o)}))),()=>{o&&(0,l.unmountComponentAtNode)(o)}}),[t,a,e]),r.createElement("g",{ref:n})})),m=(0,i.observer)((function(e){return(0,s.getRoot)(e.displayModel).hydrateFn?r.createElement(u,e):r.createElement(p,e)}));function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},g.apply(null,arguments)}class f extends n.default{supportsSVG=!0;deserializeResultsInClient(e,t){const a=new Map(e.features.map((e=>d.SimpleFeature.fromJSON(e))).map((e=>[e.id(),e])));return t.exportSVG?{...e,features:a,blockKey:"circularChord",html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,features:a,blockKey:"circularChord",reactElement:r.createElement(m,g({},t,e,{features:a,RenderingComponent:this.ReactComponent}))}}}},57027:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(44728),n=a(27570),o=a(82088),i=a(198),s=a(3496),l=a(99546);class c extends i.default{async renameRegionsIfNeeded(e){return e}serializeArgsInClient(e){const t={...e,displayModel:void 0};return super.serializeArgsInClient(t)}deserializeResultsInClient(e,t){return{...super.deserializeResultsInClient(e,t),blockKey:t.blockKey}}async renderInClient(e,t){const a=await e.call(t.sessionId,"ComparativeRender",t);return"canvasRecordedData"in a&&(a.html=await(0,l.getSerializedSvg)(a),a.reactElement=void 0),a}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async getFeatures(e){const t=this.pluginManager,{regions:a,sessionId:i,adapterConfig:c}=e,{dataAdapter:d}=await(0,s.cK)(t,i,c),u=a.map((e=>{const t={...e};return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),p=await(0,r._)(d.getFeaturesInMultipleRegions(u,e).pipe((0,n.p)((t=>this.featurePassesFilters(e,t))),(0,o.$)()));return(0,l.dedupe)(p,(e=>e.id()))}}},92880:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(44728),n=a(82088),o=a(198),i=a(46377),s=a(3496),l=a(99546),c=a(6434),d=a(37347);class u extends o.default{serializeArgsInClient(e){return super.serializeArgsInClient({...e,displayModel:void 0,regions:structuredClone(e.regions)})}deserializeResultsInClient(e,t){const a=new Map(e.features.map((e=>c.A.fromJSON(e))).map((e=>[e.id(),e])));return{...super.deserializeResultsInClient({...e,features:a},t),blockKey:t.blockKey,features:a}}serializeResultsInWorker(e,t){const a=super.serializeResultsInWorker(e,t),{features:r}=e;return{...a,features:(0,l.iterMap)(r.values(),(e=>e.toJSON()),r.size)}}getExpandedRegion(e,t){return e}async getFeatures(e){const t=this.pluginManager,{stopToken:a,regions:o,sessionId:l,adapterConfig:c}=e,{dataAdapter:u}=await(0,s.cK)(t,l,c);if(!(0,i.isFeatureAdapter)(u))throw new Error("Adapter does not support retrieving features");const p=o.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)}))),m=p[0],g=1===p.length?u.getFeatures(this.getExpandedRegion(m,e),e):u.getFeaturesInMultipleRegions(p,e),f=await(0,r._)(g.pipe((0,n.$)()));return(0,d.SW)(a),new Map(f.filter((t=>this.featurePassesFilters(e,t))).map((e=>[e.id(),e])))}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async render(e){const t=e.features||await this.getFeatures(e);return{...await super.render({...e,features:t}),features:t}}}},97666:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var r=a(7552),n=a(35470);class o extends n.A{supportsSVG=!0;constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.configSchema=e.configSchema,this.pluginManager=e.pluginManager}async render(e){return{reactElement:r.createElement(this.ReactComponent,e,null)}}freeResources(){return 0}}},25889:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var r=a(7552),n=a(20139),o=a(68446),i=a(36422),s=a(28485),l=a(49823),c=a(99546);const d=(0,o.observer)((function({theme:e,html:t,RenderingComponent:a,...o}){const s=(0,r.useRef)(null),d=(0,r.useRef)(),{hydrateFn:u}=(0,i.getRoot)(o.displayModel);return(0,r.useEffect)((()=>{s.current&&(s.current.innerHTML=t);const i=(0,c.rIC)((()=>{if(!s.current)return;const t=(0,l.createJBrowseTheme)(e);d.current=d.current??u(s.current,r.createElement(n.A,{theme:t},r.createElement(a,o)))}));return()=>{void 0!==i&&clearTimeout(i);const e=d.current;d.current=void 0,setTimeout((()=>{e?.unmount()}))}}),[e,o,t,u,a]),r.createElement("div",{"data-testid":"hydrationContainer",ref:s})})),u=(0,o.observer)((function({theme:e,html:t,RenderingComponent:a,...o}){const i=(0,r.useRef)(null),d=(0,l.createJBrowseTheme)(e);return(0,r.useEffect)((()=>{const e=i.current;return e&&((0,s.unmountComponentAtNode)(e),e.innerHTML=t,(0,c.rIC)((()=>{(0,s.hydrate)(r.createElement(n.A,{theme:d},r.createElement(a,o)),e)}))),()=>{e&&(0,s.unmountComponentAtNode)(e)}}),[t,d,o,a]),r.createElement("div",{ref:i})})),p=(0,o.observer)((function(e){return(0,i.getRoot)(e.displayModel).hydrateFn?r.createElement(d,e):r.createElement(u,e)}))},198:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var r=a(7552),n=a(20139),o=a(36422),i=a(48180),s=a(97666),l=a(25889),c=a(49823),d=a(93100),u=a(99546),p=a(37347);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},m.apply(null,arguments)}class g extends s.default{serializeArgsInClient(e){return{...e,config:(0,o.isStateTreeNode)(e.config)?(0,o.getSnapshot)(e.config):e.config,filters:e.filters?.toJSON().filters}}deserializeResultsInClient(e,t){return t.exportSVG?{...e,html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,reactElement:r.createElement(l.A,m({},t,e,{RenderingComponent:this.ReactComponent}))}}deserializeArgsInWorker(e){const t={...e};return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=e.filters?new d.A({filters:e.filters}):void 0,t}serializeResultsInWorker(e,t){const a=(0,i.F0)(r.createElement(n.A,{theme:(0,c.createJBrowseTheme)(t.theme)},e.reactElement));return e.reactElement=void 0,{...e,html:a}}async renderInClient(e,t){const a=await e.call(t.sessionId,"CoreRender",t);return"canvasRecordedData"in a&&(a.html=await(0,u.getSerializedSvg)(a),a.reactElement=void 0),a}async renderInWorker(e){const{stopToken:t,statusCallback:a=()=>{}}=e,r=this.deserializeArgsInWorker(e),n=await(0,u.updateStatus)("Rendering plot",a,(()=>this.render(r)));return(0,p.SW)(t),(0,u.updateStatus)("Serializing results",a,(()=>this.serializeResultsInWorker(n,r)))}async freeResourcesInClient(e,t){const a=this.serializeArgsInClient(t);return this.freeResources()+await e.call(t.sessionId,"CoreFreeResources",a)}}},93100:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(43283);class n{constructor({filters:e=[]}){this.filterChain=e.map((e=>e.trim())).filter((e=>!!e)).map((e=>{if("string"==typeof e)return{expr:(0,r.A)(e),string:e};throw new Error(`invalid inputFilter string "${e}"`)}))}passes(...e){for(const t of this.filterChain)if(!t.expr.evalSync({feature:e[0]}))return!1;return!0}toJSON(){return{filters:this.filterChain.map((e=>e.string))}}static fromJSON(e){return new n(e)}}},9236:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(7552),n=a(77089),o=a(963),i=a(48231),s=a(26993);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},l.apply(null,arguments)}const c=(0,a(75785).n9)()((e=>({tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,o.X4)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:Math.round(14e4)/1e5+"em",maxWidth:300,wordWrap:"break-word"}})));function d({clientPoint:e,children:t,placement:a="right"}){const o=(0,i.A)(),d=o.components?.MuiPopper,{classes:u}=c(),{refs:p,floatingStyles:m,context:g}=(0,n.we)({placement:a,strategy:"fixed"}),f=(0,n.ju)(g,e),{getFloatingProps:h}=(0,n.bv)([f]);return r.createElement(s.A,{container:d?.defaultProps?.container},r.createElement("div",l({className:u.tooltip,ref:p.setFloating,style:{...m,zIndex:1e5,visibility:"translate(0px, 0px)"===m.transform?"hidden":void 0,pointerEvents:"none"}},h()),t))}},23758:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(7552),n=a(85206),o=a(61723),i=a(45266);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s.apply(null,arguments)}const l=(0,a(68446).observer)((function({children:e,menuItems:t,closeAfterItemClick:a=!0,stopPropagation:l,setOpen:c,onClick:d,...u}){const p=(0,i.T6)({popupId:"viewMenu",variant:"popover"}),{onClick:m,onTouchStart:g,...f}=(0,i.cO)(p),{isOpen:h}=p;return(0,r.useEffect)((()=>{c?.(h)}),[h,c]),r.createElement(r.Fragment,null,r.createElement(o.A,s({onClick:e=>{l&&e.stopPropagation(),m(e),d?.()},onTouchStart:e=>{l&&e.stopPropagation(),g(e),d?.()}},f,u,{disabled:0===t.length}),e),r.createElement(n.A,s({},(0,i.dB)(p),{onMenuItemClick:(e,t)=>{t()},menuItems:t,closeAfterItemClick:a,popupState:p})))}))},57468:(e,t,a)=>{"use strict";a.d(t,{t:()=>n});var r=a(7552);class n extends r.Component{constructor(e){super(e),this.state={error:void 0}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e})}render(){return this.state.error?r.createElement(this.props.FallbackComponent,{error:this.state.error}):this.props.children}}},56174:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var r=a(7552),n=a(5401),o=a(40985),i=a(43163),s=a(29499),l=a(58507),c=a(38033),d=a(69941);const u=({onFactoryReset:e,resetButtonText:t})=>{const[a,o]=(0,r.useState)(!1);return r.createElement(r.Fragment,null,r.createElement(n.A,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:()=>{o(!0)}},t),r.createElement(d.default,{onClose:()=>{o(!1)},open:a,onFactoryReset:e}))};function p({componentStack:e,error:t="No error message provided",onFactoryReset:a,resetButtonText:d="Factory Reset"}){return r.createElement(o.A,{maxWidth:"xl",open:!0},r.createElement(i.A,null,"Fatal error"),r.createElement(s.A,null,r.createElement(c.A,{error:t}),r.createElement("pre",null,e)),r.createElement(l.A,null,r.createElement(n.A,{color:"secondary",variant:"contained",onClick:()=>{window.location.reload()}},"Refresh"),r.createElement(u,{onFactoryReset:a,resetButtonText:d})))}},43550:(e,t,a)=>{"use strict";a.d(t,{A:()=>m});var r=a(7552),n=a(6024),o=a(48171),i=a(5401),s=a(36715),l=a(75785),c=a(99546),d=a(91468);function u(e){return"blobId"in e}const p=(0,l.n9)()((e=>({filename:{marginLeft:e.spacing(1)}}))),m=function({location:e,setLocation:t}){const{classes:a}=p(),l=e&&(u(e)&&e.name||"localPath"in e&&e.localPath),m=e&&u(e)&&!(0,d.getBlob)(e.blobId);return r.createElement(n.A,{display:"flex",flexDirection:"row",alignItems:"center"},r.createElement(n.A,null,r.createElement(o.A,{fullWidth:!0},r.createElement(i.A,{variant:"outlined",component:"label"},"Choose File",r.createElement("input",{type:"file",hidden:!0,onChange:({target:e})=>{const a=e.files?.[0];if(a)if(c.isElectron){const{webUtils:e}=window.require("electron");t({localPath:e.getPathForFile(a),locationType:"LocalPathLocation"})}else t((0,d.storeBlobLocation)({blob:a}))}})))),r.createElement(n.A,null,r.createElement(s.A,{component:"span",className:a.filename,color:l?"initial":"textSecondary"},l||"No file chosen"),m?r.createElement(s.A,{color:"error"},"(need to reload)"):null))}},14862:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(7552),n=a(1343),o=a(68446),i=a(92516);const s=(0,o.observer)((function({location:e,label:t,style:a,setLocation:o}){return r.createElement(n.A,{variant:"outlined",fullWidth:!0,defaultValue:e&&(0,i.C1)(e)?e.uri:"",label:t||"Enter URL",style:a,onChange:e=>{o({uri:e.target.value.trim(),locationType:"UriLocation"})},slotProps:{htmlInput:{"data-testid":"urlInput"}}})}))},37565:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(7552),n=a(36715),o=a(73329);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},i.apply(null,arguments)}const s=(0,a(75785).n9)()({dots:{"&::after":{display:"inline-block",content:'""',width:"1em",textAlign:"left",animation:`${o.i7`
      0% {
        content: '';
      }
      25% {
          content: '.';
      }
      50% {
        content: '..';
      }
      75% {
        content: '...';
      }
      `} 1.2s infinite ease-in-out`}}});function l({message:e,variant:t="body2",...a}){const{cx:o,classes:l}=s();return r.createElement(n.A,i({className:o(l.dots,a.className)},a,{variant:t}),e||"Loading")}},21311:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(7552);const n=(0,a(75785).n9)()((e=>({bg:{padding:4,margin:4,overflow:"auto",maxHeight:200,background:"dark"===e.palette.mode?"#833":"#f88",border:`1px solid ${e.palette.divider}`}})));function o({children:e}){const{classes:t}=n();return r.createElement("div",{className:t.bg},e)}},40898:(e,t,a)=>{"use strict";a.r(t),a.d(t,{category10:()=>r,dark2:()=>n,ggplot2Colors3:()=>u,ggplot2Colors4:()=>d,ggplot2Colors5:()=>c,ggplot2Colors6:()=>l,set1:()=>o,set2:()=>i,tableau10:()=>s});const r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],n=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],o=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],i=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],s=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],l=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"],c=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"],d=["#F8766D","#7CAE00","#00BFC4","#C77CFF"],u=["#F8766D","#00BA38","#619CFF"]},95095:(e,t,a)=>{"use strict";function r(e,t,a){if(!t||!a)return;const{width:r,interRegionPaddingWidth:n,displayedRegions:o,bpPerPx:i,minimumBlockWidth:s}=e,l=function(e,t,a){let r=0;const{displayedRegions:n}=e;if(t.index===a.index)r+=a.offset-t.offset;else{const e=n[t.index];if(r+=e.end-e.start-t.offset,a.index-t.index>=2)for(let e=t.index+1;e<a.index;e++){const t=n[e];r+=t.end-t.start}r+=a.offset}return r}(e,t,a);let c=0;for(let e=t.index;e<a.index;e++){const t=o[e];(t.end-t.start)/i>s&&c++}const d=l/(r-n*c),u=e.zoomTo(d);let p=0;d<u&&(p=(u-d)*e.width/2);let m=-p;for(let a=0;a<e.displayedRegions.length;a+=1){const r=e.displayedRegions[a];if(t.index===a){m+=t.offset;break}m+=r.end-r.start}e.scrollTo(Math.round(m/e.bpPerPx))}function n(e,t){return Math.floor(e.reversed?e.end-t:e.start+t)+1}function o(e,t){let a=0;const{bpPerPx:r,offsetPx:o,displayedRegions:i,interRegionPaddingWidth:s,staticBlocks:l}=e,c=l.contentBlocks,d=(o+t)*r;if(d<0){const e=i[0];return{...e,oob:!0,coord:n(e,d),offset:d,index:0}}const u=s*r;let p=0;for(let e=0;e<i.length;e++){const t=i[e],r=t.end-t.start,o=d-a;if(r+a>d&&a<=d)return{...t,oob:!1,offset:o,coord:n(t,o),index:e};c[p]?.regionNumber===e?(a+=r+u,p++):a+=r}if(d>=a&&i.length>0){const e=i.at(-1),t=d-a+(e.end-e.start);return{...e,oob:!0,offset:t,coord:n(e,t),index:i.length-1}}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}function i({refName:e,coord:t,regionNumber:a,self:r}){let n=0;const{interRegionPaddingWidth:o,bpPerPx:i,displayedRegions:s,staticBlocks:l}=r,c=l.contentBlocks,d=o*i;let u=0,p=0;for(;p<s.length;p++){const r=s[p],o=r.end-r.start;if(e===r.refName&&t>=r.start&&t<=r.end&&(!a||a===p)){n+=r.reversed?r.end-t:t-r.start;break}c[u]?.regionNumber===p?(n+=o+d,u++):n+=o}if(s[p])return{index:p,offsetPx:Math.round(n/i)}}a.d(t,{Ii:()=>o,eB:()=>i,tw:()=>r})},97884:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(36422),n=a(95095),o=a(93707),i=a(88530),s=a(99546),l=a(8832);const c=r.types.model("Base1DView",{id:l.ElementId,displayedRegions:r.types.optional(r.types.frozen(),[]),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:r.types.optional(r.types.number,0),minimumBlockWidth:r.types.optional(r.types.number,0)}).volatile((()=>({features:void 0,volatileWidth:0}))).actions((e=>({setDisplayedRegions(t){e.displayedRegions=(0,r.cast)(t)},setBpPerPx(t){e.bpPerPx=t},setVolatileWidth(t){e.volatileWidth=t}}))).views((e=>({get width(){return e.volatileWidth},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return(0,s.sum)(e.displayedRegions.map((e=>e.end-e.start)))}}))).views((e=>({get dynamicBlocks(){return(0,o.A)(e)},get staticBlocks(){return(0,i.A)(e)},get currBp(){return(0,s.sum)(this.dynamicBlocks.map((e=>e.end-e.start)))}}))).views((e=>({pxToBp:t=>(0,n.Ii)(e,t),bpToPx:({refName:t,coord:a,regionNumber:r})=>(0,n.eB)({refName:t,coord:a,regionNumber:r,self:e})?.offsetPx}))).actions((e=>({setFeatures(t){e.features=t},showAllRegions(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut(){this.zoomTo(2*e.bpPerPx)},zoomIn(){this.zoomTo(e.bpPerPx/2)},zoomTo(t,a=e.width/2){const r=(0,s.clamp)(t,"minBpPerPx"in e?e.minBpPerPx:0,"maxBpPerPx"in e?e.maxBpPerPx:Number.POSITIVE_INFINITY),n=e.bpPerPx;return Math.abs(n-r)<1e-6?n:(e.bpPerPx=r,e.offsetPx=(0,s.clamp)(Math.round((e.offsetPx+a)*n/r-a),e.minOffset,e.maxOffset),e.bpPerPx)},scrollTo(t){const a=(0,s.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=a,a},centerAt(t,a,r){if(!a)return;const n=e.bpToPx({refName:a,coord:t,regionNumber:r});n&&this.scrollTo(Math.round(n-e.width/2))},scroll(t){const a=e.offsetPx,r=(0,s.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-a}}))).actions((e=>({moveTo(t,a){(0,n.tw)(e,t,a)}})))},20166:(e,t,a)=>{"use strict";a.d(t,{Kp:()=>d,R1:()=>c,Yo:()=>s,pB:()=>i,zm:()=>l});var r=a(89592),n=a(3862);class o extends Error{}function i(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw l()}}async function s(e){await new Promise((e=>setTimeout(e,1))),i(e)}function l(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");const e=new o("aborted");return e.code="ERR_ABORTED",e}function c(e){return e?(0,n.R)(e,"abort"):new r.c}function d(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!/\b(aborted|aborterror)\b/i.test(e.message))}},31673:(e,t,a)=>{"use strict";function r(e){const t=new FileReader;return new Promise(((a,r)=>{t.onload=e=>{e.target?a(e.target.result):r(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)}))}a.d(t,{y:()=>r})},76530:(e,t,a)=>{"use strict";a.d(t,{$G:()=>i,Db:()=>s,fK:()=>l,mh:()=>n});var r=a(99546);class n{constructor(e=[]){this.blocks=e}push(e){if("ElidedBlock"===e.type&&this.blocks.length>0){const t=this.blocks.at(-1);if("ElidedBlock"===t?.type)return void t.push(e)}this.blocks.push(e)}getBlocks(){return this.blocks}getRegions(){return this.blocks.map((e=>e.toRegion()))}map(e,t){return this.blocks.map(e,t)}forEach(e,t){this.blocks.forEach(e,t)}get length(){return this.blocks.length}get totalWidthPx(){return this.blocks.length>0?(0,r.sum)(this.blocks.map((e=>e.widthPx))):0}get totalWidthPxWithoutBorders(){return this.blocks.length>0?(0,r.sum)(this.blocks.filter((e=>"boundary"!==e.variant)).map((e=>e.widthPx))):0}get offsetPx(){return this.blocks.length>0?this.blocks[0].offsetPx:0}get contentBlocks(){return this.blocks.filter((e=>"ContentBlock"===e.type))}get totalBp(){return(0,r.sum)(this.contentBlocks.map((e=>e.end-e.start)))}}class o{type="BaseBlock";widthPx=0;constructor(e){Object.assign(this,e),this.assemblyName=e.assemblyName,this.refName=e.refName,this.start=e.start,this.end=e.end,this.key=e.key,this.offsetPx=e.offsetPx}toRegion(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}class i extends o{type="ContentBlock"}class s extends o{type="ElidedBlock";elidedBlockCount=0;constructor(e){super(e),this.widthPx=e.widthPx}push(e){this.elidedBlockCount+=1,this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx}}class l extends o{type="InterRegionPaddingBlock"}},93707:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(36422),n=a(99546),o=a(76530),i=a(32595);function s(e,t=!0,a=!0){const{offsetPx:s,displayedRegions:l,bpPerPx:c,width:d,minimumBlockWidth:u,interRegionPaddingWidth:p}=e;if(!d)throw new Error("view has no width, cannot calculate displayed blocks");const m=new o.mh;let g=0;const f=s,h=f+d;for(let e=0;e<l.length;e++){const y=l[e],{assemblyName:b,refName:w,start:v,end:C,reversed:S}=y,k=g+(C-v)/c,T=(C-v)/c,x=(0,r.isStateTreeNode)(y)?(0,r.getSnapshot)(y):y,[A,P]=(0,i.ky)(f,h,g,k);if(void 0!==A&&void 0!==P){let r,i,f,h,y;S?(r=Math.max(v,C-(P-g)*c),i=C-(A-g)*c,f=i===C,h=r===v,y=g+(C-i)/c):(r=(A-g)*c+v,i=Math.min(C,(P-g)*c+v),f=r===v,h=i===C,y=g+(r-v)/c);const k={assemblyName:b,refName:w,start:r,end:i,reversed:S,offsetPx:y,parentRegion:x,regionNumber:e,widthPx:(i-r)/c,isLeftEndOfDisplayedRegion:f,isRightEndOfDisplayedRegion:h,key:""};k.key=`${(0,n.assembleLocStringFast)(k)}-${e}${S?"-reversed":""}`,t&&0===m.length&&f&&m.push(new o.fK({key:`${k.key}-beforeFirstRegion`,widthPx:-s,offsetPx:k.offsetPx+s,variant:"boundary"})),a&&T<u?m.push(new o.Db(k)):m.push(new o.$G(k)),t&&(T>=u&&k.isRightEndOfDisplayedRegion&&e<l.length-1&&(m.push(new o.fK({key:`${k.key}-rightpad`,widthPx:p,offsetPx:k.offsetPx+k.widthPx})),g+=p),e===l.length-1&&k.isRightEndOfDisplayedRegion&&(y=k.offsetPx+k.widthPx,m.push(new o.fK({key:`${k.key}-afterLastRegion`,widthPx:d-y+s,offsetPx:y,variant:"boundary"}))))}g+=(C-v)/c}return m}},88530:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var r=a(36422),n=a(99546),o=a(76530);function i(e,t=!0,a=!0,i=0,s=800){const{offsetPx:l,displayedRegions:c,bpPerPx:d,minimumBlockWidth:u,interRegionPaddingWidth:p,width:m}=e,g=l*d,f=(l+m)*d,h=s,y=Math.ceil(h*d);let b=0;const w=new o.mh;for(let e=0;e<c.length;e++){const l=c[e],{assemblyName:m,refName:h,start:v,end:C,reversed:S}=l,k=Math.ceil((C-v)/y),T=(0,r.isStateTreeNode)(l)?(0,r.getSnapshot)(l):l;let x=Math.floor((f-b)/y)+i;x>=k&&(x=k-1);let A=Math.floor((g-b)/y)-i;A<0&&(A=0);const P=(C-v)/d;for(let r=A;r<=x;r+=1){let i,l,g,f;S?(i=Math.max(v,C-(r+1)*y),l=C-r*y,g=l===C,f=i===v):(i=v+r*y,l=Math.min(C,v+(r+1)*y),g=i===v,f=l===C);const k={assemblyName:m,refName:h,start:i,end:l,reversed:S,offsetPx:(b+r*y)/d,parentRegion:T,regionNumber:e,widthPx:(l-i)/d,isLeftEndOfDisplayedRegion:g,isRightEndOfDisplayedRegion:f,key:""};k.key=`${(0,n.assembleLocStringFast)(k)}-${e}${S?"-reversed":""}`,t&&0===e&&0===r&&w.push(new o.fK({key:`${k.key}-beforeFirstRegion`,widthPx:s,offsetPx:k.offsetPx-s,variant:"boundary"})),a&&P<u?w.push(new o.Db(k)):w.push(new o.$G(k)),t&&(P>=u&&k.isRightEndOfDisplayedRegion&&e<c.length-1&&(b+=p*d,w.push(new o.fK({key:`${k.key}-rightpad`,widthPx:p,offsetPx:k.offsetPx+k.widthPx}))),e===c.length-1&&k.isRightEndOfDisplayedRegion&&(b+=p*d,w.push(new o.fK({key:`${k.key}-afterLastRegion`,widthPx:s,offsetPx:k.offsetPx+k.widthPx,variant:"boundary"}))))}b+=C-v}return w}},80208:(e,t,a)=>{"use strict";a.r(t),a.d(t,{contrastingTextColor:()=>s,emphasize:()=>c,isNamedColor:()=>i,makeContrasting:()=>d,namedColorToHex:()=>o});var r=a(963);const n={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(e){return n[e]}function i(e){return!!n[e]}function s(e){return l(e)>.5?"black":"white"}function l(e){const t=o(e);return(0,r.J1)(t||e)}function c(e,t=.15){const a=o(e);return(0,r.tL)(a||e,t)}function d(e,t="white",a=3){let n=o(e)||e;const i=o(t)||t,s=l(i);let c=(0,r.eM)(n,i);const d=n;let u=.05;for(;c<a;)n=s>.5?(0,r.e$)(d,u):(0,r.a)(d,u),u+=.05,c=(0,r.eM)(n,i);return n}},87485:(e,t,a)=>{"use strict";a.d(t,{M:()=>r.Mj});var r=a(76958),n=a(8145),o=a(81687);(0,r.X$)([n.A,o.A])},3519:(e,t,a)=>{"use strict";function r(e,t=JSON.stringify){const a=[],r=new Set;for(const n of e){const e=t(n);r.has(e)||(a.push(n),r.add(e))}return a}a.d(t,{Q:()=>r})},26257:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(99546);function n(e,t="",a=5e3){const n=[e];for(;n.length;){const e=n.pop();for(const[o,i]of Object.entries(e)){if(t.length>a)return(0,r.hashCode)(t);"object"==typeof i&&null!==i?n.push(i):t+=`${o}-${i}`}}return(0,r.hashCode)(t)}},99834:(e,t,a)=>{"use strict";a.r(t),a.d(t,{RemoteFileWithRangeCache:()=>d,getFetcher:()=>h,openLocation:()=>f,resolveUriLocation:()=>g});var r=a(70777),n=a.n(r),o=a(45834),i=a(35451),s=a(18196);const l={},c=new s.j({fetch:function(e,t,a,r={}){const n=l[e];if(!n)throw new Error(`fetch not registered for ${e}`);return n(e,t,a,r)},size:524288e3,chunkSize:131072,maxFetchSize:104857600,minimumTTL:864e5});class d extends o.Tx{async fetch(e,t){const a=String(e);l[a]||(l[a]=this.fetchBinaryRange.bind(this));const r=new Headers(t?.headers).get("range");if(r){const t=/bytes=(\d+)-(\d+)/.exec(r);if(t){const[,a,r]=t,n=Number.parseInt(a,10),o=Number.parseInt(r,10)-n,{buffer:i,headers:s}=await c.getRange(e,n,o+1);return new Response(i,{status:206,headers:s})}}return super.fetch(e,t)}async fetchBinaryRange(e,t,a,r={}){const n=new Date,o=await super.fetch(e,{...r,headers:{...r.headers,range:`bytes=${t}-${a}`}}),s=new Date;if(!o.ok){const r=`HTTP ${o.status} fetching ${e} bytes ${t}-${a}`,n=" (should be 206 for range requests)";throw new Error(`${r}${200===o.status?n:""}`)}const l={};for(const[e,t]of o.headers.entries())l[e]=t;const c=await o.arrayBuffer();return{headers:l,requestDate:n,responseDate:s,buffer:i.hp.from(c)}}}var u=a(99546),p=a(91468),m=a(92516);function g(e){return e.baseUri?{...e,uri:new URL(e.uri,e.baseUri).href}:e}function f(e,t){if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(n()||u.isElectron)return new o.EY(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){const t=(0,p.getBlob)(e.blobId);if(!t)throw new Error(`file ("${e.name}") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);return new o.Ki(t)}if((0,m.C1)(e)){if(!e.uri)throw new Error("No URI provided");const a=g(e);if(t){const r=y(e,t);if(r)return r.openLocation(a)}return new d(a.uri,{fetch:b})}throw new Error("invalid fileLocation")}function h(e,t){if(!(0,m.C1)(e))throw new Error(`Not a valid UriLocation: ${JSON.stringify(e)}`);if(t){const a=y(e,t);if(a)return a.getFetcher(e)}return b}function y(e,t){const{rootModel:a}=t;if(a&&(0,m.lL)(a))return a.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}async function b(e,t){const a=await fetch(e,t);if(401===a.status&&a.headers.get("WWW-Authenticate")?.includes("Basic"))throw new m._u("Accessing HTTPBasic resource without authentication",e.toString());return a}},53085:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(26400),n=a.n(r);function o(){const e=new(n().Jexl);return e.addFunction("get",((e,t)=>e.get(t))),e.addFunction("parent",(e=>e.parent())),e.addFunction("id",(e=>e.id())),e.addFunction("cast",(e=>e)),e.addFunction("log",(e=>(console.log(e),e))),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",((e,t)=>e.split(t))),e.addFunction("charAt",((e,t)=>e.charAt(t))),e.addFunction("charCodeAt",((e,t)=>e.charCodeAt(t))),e.addFunction("codePointAt",((e,t)=>e.codePointAt(t))),e.addFunction("startsWith",((e,t,a)=>e.startsWith(t,a))),e.addFunction("endsWith",((e,t,a)=>e.endsWith(t,a))),e.addFunction("padEnd",((e,t,a)=>e.padEnd(t,a))),e.addFunction("padStart",((e,t,a)=>e.padStart(t,a))),e.addFunction("repeat",((e,t)=>e.repeat(t))),e.addFunction("replace",((e,t,a)=>e.replace(t,a))),e.addFunction("replaceAll",((e,t,a)=>e.replaceAll(t,a))),e.addFunction("slice",((e,t,a)=>e.slice(t,a))),e.addFunction("startsWith",((e,t,a)=>e.startsWith(t,a))),e.addFunction("substring",((e,t,a)=>e.substring(t,a))),e.addFunction("toLowerCase",(e=>e.toLowerCase())),e.addFunction("toUpperCase",(e=>e.toUpperCase())),e.addFunction("jsonParse",(e=>JSON.parse(e))),e.addFunction("trim",(e=>e.trim())),e.addFunction("trimEnd",(e=>e.trimEnd())),e.addFunction("trimStart",(e=>e.trimStart())),e.addFunction("getTag",((e,t)=>{const a=e.get("tags");return a?a[t]:e.get(t)})),e.addBinaryOp("&",15,((e,t)=>e&t)),e}},43283:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(53085);const n={};function o(e,t){const a=`nosig|${e}`;if(!n[a]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");const o=e.split("jexl:")[1],i=t?t.compile(o):(0,r.A)().compile(o);n[a]=i}return n[a]}},85012:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});const r=1e4;function n(e,t,a,r){return t>=a&&r>=e}class o{padding=1;widthLimit=1e6;setAllFilled(e){this.allFilled=e}getItemAt(e){return this.allFilled?this.allFilled:void 0===this.rowState?.min||e<this.rowState.min||e>=this.rowState.max?void 0:this.rowState.bits[e-this.rowState.offset]}isRangeClear(e,t){if(this.allFilled)return!1;if(void 0===this.rowState||t<=this.rowState.min||e>=this.rowState.max)return!0;const{min:a,max:r,offset:n,bits:o}=this.rowState,i=Math.min(r,t)-n;let s=!0;for(let t=Math.max(a,e)-n;t<i&&s;t++)s=void 0===o[t];return s}initialize(e,t){const a=t-e;return{offset:e-a,min:e,max:t,bits:Array.from({length:3*a})}}addRect(e,t){const a=e.l,r=e.r+this.padding;this.rowState||(this.rowState=this.initialize(a,r));let n=a-this.rowState.offset,o=r-this.rowState.offset;const i=this.rowState.bits.length;if(o>=this.rowState.bits.length){const e=o+1;this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(a,r)):e>0&&(this.rowState.bits=[...this.rowState.bits,...Array.from({length:e})])}if(a<this.rowState.offset){const e=Math.min(i-n,this.rowState.offset);this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(a,r)):(this.rowState.bits=[...Array.from({length:e}),...this.rowState.bits],this.rowState.offset-=e)}o=r-this.rowState.offset,n=a-this.rowState.offset;const s=o-n;s>2e4&&console.warn(`Layout X pitch set too low, feature spans ${s} bits in a single row.`,e,t);for(let e=n;e<o;e+=1)this.rowState.bits[e]=t;a<this.rowState.min&&(this.rowState.min=a),r>this.rowState.max&&(this.rowState.max=r)}discardRange(e,t){if(this.allFilled)return;if(!this.rowState)return;if(t<=this.rowState.min||e>=this.rowState.max)return;if(e<=this.rowState.min&&t>=this.rowState.max)return void(this.rowState=void 0);if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-r&&this.rowState.bits.length>this.rowState.max+r-this.rowState.offset){const e=this.rowState.min-this.rowState.offset,t=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(e,this.rowState.bits.length-t),this.rowState.offset+=e}else if(this.rowState.offset<this.rowState.min-r){const e=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,e),this.rowState.offset+=e}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+r){const e=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=e}const a=Math.max(this.rowState.min,e)-this.rowState.offset,n=Math.min(t,this.rowState.max)-this.rowState.offset;for(let e=a;e>=0&&e<n;e+=1)this.rowState.bits[e]=void 0}}class i{constructor({pitchX:e=10,pitchY:t=10,maxHeight:a=1e4,hardRowLimit:r=1e4,displayMode:n="normal"}={}){this.pitchX=e,this.pitchY=t,this.hardRowLimit=r,this.maxHeightReached=!1,this.displayMode=n,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(a/this.pitchY),this.pTotalHeight=0}addRect(e,t,a,r,n){const o=this.rectangles.get(e);if(o)return null===o.top?null:(this.addRectToBitmap(o),o.top*this.pitchY);const i=Math.floor(t/this.pitchX),s=Math.floor(a/this.pitchX),l=Math.ceil(r/this.pitchY),c={id:e,l:i,r:s,top:null,h:l,originalHeight:r,data:n},d=this.maxHeight-l;let u=0;if("collapse"!==this.displayMode){for(;u<=d&&this.collides(c,u);u+=1);if(u>d)return c.top=null,this.rectangles.set(e,c),this.maxHeightReached=!0,null}return c.top=u,this.addRectToBitmap(c),this.rectangles.set(e,c),this.pTotalHeight=Math.max(this.pTotalHeight||0,u+l),u*this.pitchY}collides(e,t){const{bitmap:a}=this,r=t+e.h;for(let n=t;n<r;n+=1){const t=a[n];if(void 0!==t&&!t.isRangeClear(e.l,e.r))return!0}return!1}autovivifyRow(e,t){let a=e[t];if(!a){if(t>this.hardRowLimit)throw new Error(`layout hard limit (${this.hardRowLimit*this.pitchY}px) exceeded, aborting layout`);a=new o,e[t]=a}return a}addRectToBitmap(e){if(null===e.top)return;const t=e.id,a=e.top+e.h;if(e.r-e.l>2e4)for(let r=e.top;r<a;r+=1)this.autovivifyRow(this.bitmap,r).setAllFilled(t);else for(let r=e.top;r<a;r+=1)this.autovivifyRow(this.bitmap,r).addRect(e,t)}discardRange(e,t){const a=Math.floor(e/this.pitchX),r=Math.floor(t/this.pitchX),{bitmap:n}=this;for(const e of n)e.discardRange(a,r)}hasSeen(e){return this.rectangles.has(e)}getByCoord(e,t){const a=Math.floor(t/this.pitchY),r=this.bitmap[a];if(!r)return;const n=Math.floor(e/this.pitchX);return r.getItemAt(n)}getByID(e){const t=this.rectangles.get(e);if(t){const e=t.top*this.pitchY;return[t.l*this.pitchX,e,t.r*this.pitchX,e+t.originalHeight]}}getDataByID(e){return this.rectangles.get(e)?.data}cleanup(){}getTotalHeight(){return this.pTotalHeight*this.pitchY}get totalHeight(){return this.getTotalHeight()}getRectangles(){return new Map([...this.rectangles.entries()].map((([e,t])=>{const{l:a,r,originalHeight:n,top:o}=t,i=(o||0)*this.pitchY,s=i+n;return[e,[a*this.pitchX,i,r*this.pitchX,s]]})))}serializeRegion(e){const t={};let a=!1;for(const[r,o]of this.rectangles.entries()){const{l:i,r:s,originalHeight:l,top:c}=o;if(null===o.top)a=!0;else{const a=(c||0)*this.pitchY,o=a+l,d=i*this.pitchX,u=s*this.pitchX;n(e.start,e.end,d-this.pitchX,u+this.pitchX)&&(t[r]=[d,a,u,o])}}return{rectangles:t,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:a}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}},2265:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});class r{subLayouts=new Map;constructor(e,t={}){this.SubLayoutClass=e,this.subLayoutConstructorArgs=t}getDataByID(e){for(const t of this.subLayouts.values()){const a=t.getDataByID(e);if(a)return a}}getSublayout(e){let t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}addRect(e,t,a,r,n,o={}){return this.getSublayout(e).addRect(t,a,r,n,o)}discardRange(e,t,a){return this.subLayouts.get(e)?.discardRange(t,a)}toJSON(){const e={};for(const[t,a]of this.subLayouts.entries())e[t]=a.toJSON();return e}}},75762:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(22593),n=a.n(r);class o{constructor({rectangles:e,totalHeight:t,maxHeightReached:a}){this.rectangles=new Map(Object.entries(e)),this.totalHeight=t,this.maxHeightReached=a,this.rbush=new(n());for(const[t,a]of Object.entries(e))this.rbush.insert({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],name:t})}addRect(e){const t=this.rectangles.get(e);if(!t)throw new Error(`id ${e} not found in precomputed feature layout`);return t[1]}getRectangles(){return this.rectangles}getTotalHeight(){return this.totalHeight}collides(e,t){throw new Error("Method not implemented.")}getByCoord(e,t){const a={minX:e,minY:t,maxX:e+1,maxY:t+1};return this.rbush.collides(a)?this.rbush.search(a)[0].name:void 0}getByID(e){return this.rectangles.get(e)}addRectToBitmap(e,t){throw new Error("Method not implemented.")}discardRange(e,t){throw new Error("Method not implemented.")}serializeRegion(e){throw new Error("Method not implemented.")}toJSON(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}},88217:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GranularRectLayout:()=>r.A,MultiLayout:()=>n.A,PrecomputedLayout:()=>o.A,PrecomputedMultiLayout:()=>s,SceneGraph:()=>l});var r=a(85012),n=a(2265),o=a(75762);class i{constructor(){throw new Error("invalid layout name")}}class s extends n.A{constructor(e){super(i),Object.entries(e).forEach((([e,t])=>{this.subLayouts.set(e,new o.A(t))}))}}class l{constructor(e,t,a,r,n,o){this.name=e,this.left=t,this.top=a,this.width=r,this.height=n,this.data=o,this.children=new Map,this.absoluteCache={dirty:!0}}addChild(e,t,a,r,n,o){const i=e instanceof l?e:new l(e,t,a,r,n,o);if(!(i instanceof l))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(i.name))throw new Error(`child named "${i.name}" already exists`);i.parent=this;const{left:s,right:c,top:d,bottom:u}=i.absolute;return void 0!==s&&void 0!==c&&void 0!==d&&void 0!==u&&(this.expand(s,c,d,u),this.children.set(i.name,i)),i}getSubRecord(e){return this.children.get(e)}expand(e,t,a,r){const{left:n,right:o,top:i,bottom:s}=this.absolute;if(void 0!==n&&e<n){const t=n-e;this.width+=t,this.left-=t}if(void 0!==o&&t>o&&(this.width+=t-o),void 0!==i&&a<i){const e=i-a;this.height+=e,this.top-=e}void 0!==s&&r>s&&(this.height+=r-s),this.parent&&this.parent.expand(e,t,a,r),this.absoluteCache.dirty=!0}get bottom(){return this.top+this.height}get right(){return this.left+this.width}walkParents(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}walkChildren(e){for(const t of this.children.values())e(t),t.walkChildren(e)}get absolute(){if(this.absoluteCache.dirty){let e=0,t=0;this.walkParents((a=>{e+=a.left,t+=a.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}move(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((e=>{e.absoluteCache.dirty=!0}));const{left:a,right:r,top:n,bottom:o}=this.absolute;void 0!==a&&void 0!==r&&void 0!==n&&void 0!==o&&this.expand(a,r,n,o)}}},56133:(e,t,a)=>{"use strict";a.d(t,{I:()=>s});var r=a(42489),n=a(36422),o=a(20166),i=a(37347);function s(e,t,a,s,l,c,d){let u;function p(t){(0,o.Kp)(t)||(console.error(t),(0,n.isAlive)(e)&&d(t))}(0,n.addDisposer)(e,(0,r.reaction)((()=>{try{return t(e)}catch(e){return void p(e)}}),(async(t,r)=>{if(u&&(0,i.CF)(u),(0,n.isAlive)(e)){u=(0,i.y5)(),l(u);try{const o=await a(t,u,e,r);(0,n.isAlive)(e)&&c(o)}catch(e){p(e)}}}),s)),(0,n.addDisposer)(e,(()=>{u&&(0,i.CF)(u)}))}},23550:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getDefaultValue:()=>s,getEnumerationValues:()=>l,getPropertyType:()=>i,getSubType:()=>n,getUnionSubTypes:()=>o,resolveLateType:()=>c});var r=a(36422);function n(e){let t;if((0,r.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,r.isArrayType)(e)&&!(0,r.isMapType)(e)){if("function"==typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function o(e){if(!(0,r.isUnionType)(e))throw new TypeError("not an MST union type");const t=e._types||e.types||n(e)._types||n(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function i(e,t){return e.properties[t]}function s(e){if(!(0,r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function l(e){return o(e).map((e=>e.value))}function c(e){return(0,r.isUnionType)(e)||(0,r.isArrayType)(e)||!(0,r.isLateType)(e)?e:e.getSubType()}},32761:(e,t,a)=>{"use strict";a.d(t,{Ak:()=>r});const r=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"")},18010:(e,t,a)=>{"use strict";a.d(t,{Nw:()=>o,T9:()=>i,bV:()=>s,pv:()=>l});var r=a(13862),n=a(70777);let o,i,s;function l(e,t){e.serializedCommands?new r.CanvasSequence(e.serializedCommands).execute(t):t.drawImage(e,0,0)}const c="function"==typeof OffscreenCanvas,d=a.n(n)();c?(o=(e,t)=>new OffscreenCanvas(e,t),i=window.createImageBitmap||self.createImageBitmap,s=window.ImageBitmap||self.ImageBitmap):d?(o=(...e)=>nodeCreateCanvas(...e),i=async e=>{const t=e.toDataURL(),a=new nodeImage;return new Promise(((e,r)=>{a.onload=()=>{e(a)},a.onerror=r,a.src=t}))}):(o=(e,t)=>{const a=new r.CanvasSequence;return{width:e,height:t,getContext:()=>a}},i=async e=>{const t=e.getContext("2d");return{height:e.height,width:e.width,serializedCommands:t.toJSON(),containsNoTransferables:!0}},s=String)},98506:(e,t,a)=>{"use strict";a.d(t,{Jy:()=>l,aE:()=>c,u1:()=>s});var r=a(7552),n=a(13862),o=a(31673),i=a(18010);async function s(e,t,a,s){const{exportSVG:l,highResolutionScaling:c=1}=a;if(l){if(l.rasterizeLayers){const a=l.scale||c,n=(0,i.Nw)(Math.ceil(e*a),t*a),d=n.getContext("2d");if(!d)throw new Error("2d canvas rendering not supported on this platform");return d.scale(a,a),{...await s(d),reactElement:r.createElement("image",{width:e,height:t,xlinkHref:"convertToBlob"in n?await(0,o.y)(await n.convertToBlob({type:"image/png"})):n.toDataURL("image/png")})}}{const e=new n.CanvasSequence;return{...await s(e),canvasRecordedData:e.toJSON()}}}{const a=c,r=(0,i.Nw)(Math.ceil(e*a),t*a),n=r.getContext("2d");if(!n)throw new Error("2d canvas rendering not supported on this platform");return n.scale(a,a),{...await s(n),imageData:await(0,i.T9)(r)}}}async function l(e){const{width:t,height:r,canvasRecordedData:o}=e,i=new((await a.e(3109).then(a.t.bind(a,63109,23))).default)(t,r);return new n.CanvasSequence(o).execute(i),i.getSvg().innerHTML}function c({rendering:e}){return r.isValidElement(e.reactElement)?e.reactElement:r.createElement("g",{dangerouslySetInnerHTML:{__html:e.html||""}})}},32595:(e,t,a)=>{"use strict";function r(e,t,a,r){return t>a&&e<r&&r-a&&t-e?e>a?t<r?[e,t]:[e,r]:t<r?[a,t]:[a,r]:[]}function n(e,t,a,r){return t>a&&e<r}function o(e,t,a,r){return a<=e&&r>=t}a.d(t,{R6:()=>n,Xx:()=>o,ky:()=>r})},66885:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ObservableCreate:()=>n});var r=a(89592);function n(e,t){return new r.c((t=>{try{const a=e(t);a?.catch&&a.catch((e=>{t.error(e)}))}catch(e){t.error(e)}}))}},6434:(e,t,a)=>{"use strict";function r(e){return"object"==typeof e&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id}function n(e){return"uniqueId"in e&&"object"!=typeof e.data}a.d(t,{A:()=>o,l:()=>r});class o{constructor(e){n(e)?this.data=e:(this.data=e.data,this.parentHandle=e.parent);const t=n(e)?e.uniqueId:e.id;if(null==t)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(t),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error(`invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`);this.data.subfeatures&&(this.subfeatures=this.data.subfeatures?.map(((e,a)=>"function"!=typeof e.get?new o({id:e.uniqueId||`${t}-${a}`,data:{strand:this.data.strand,...e},parent:this}):e)))}get(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}set(e,t){this.data[e]=t}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={...this.data,uniqueId:this.id()},t=this.parent();t&&(e.parentId=t.id());const a=this.children();return a&&(e.subfeatures=a.map((e=>e.toJSON()))),e}static fromJSON(e){return new o({...e})}}},37957:(e,t,a)=>{"use strict";a.d(t,{WD:()=>i,Yv:()=>l,qn:()=>s});var r=a(44728),n=a(69652);function o(e,t,a,r=!1){if(0===a)return 0;let n;return r?n=t/a-e*e/(a*a):(n=t-e*e/a,a>1&&(n/=a-1)),n<0?0:Math.sqrt(n)}function i(e){return{...e,scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:o(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered}}async function s(e,t){const{start:a,end:o}=e,s={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0};let l=!1;const{scoreMin:c,scoreMax:d,scoreSum:u,scoreSumSquares:p,featureCount:m}=await(0,r._)(t.pipe((0,n.T)(((e,t)=>{const a=t.get("score"),r=t.get("summary"),{scoreMax:n,scoreMin:o}=e;return e.scoreMax=Math.max(n,r?t.get("maxScore"):a),e.scoreMin=Math.min(o,r?t.get("minScore"):a),e.scoreSum+=a,e.scoreSumSquares+=a*a,e.featureCount+=1,l=!0,e}),s)));return l?i({scoreMax:d,scoreMin:c,scoreSum:u,scoreSumSquares:p,featureCount:m,basesCovered:o-a+1}):{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}function l(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},37347:(e,t,a)=>{"use strict";function r(){return URL.createObjectURL?.(new Blob)||`${Math.random()}`}function n(e){URL.revokeObjectURL?.(e)}function o(e){if("undefined"==typeof jest&&void 0!==e&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){const t=new XMLHttpRequest;t.open("GET",e,!1);try{t.send(null)}catch(e){throw new Error("aborted")}}}a.d(t,{CF:()=>n,SW:()=>o,y5:()=>r})},92516:(e,t,a)=>{"use strict";a.d(t,{BY:()=>u,C1:()=>S,DW:()=>o,EO:()=>b,EV:()=>k,J_:()=>A,Nh:()=>C,QW:()=>l,Tl:()=>f,Uy:()=>y,Y$:()=>i,ZL:()=>P,_u:()=>x,bV:()=>w,gx:()=>p,lL:()=>v,lO:()=>d,mY:()=>g,rF:()=>T,rz:()=>n.A,u3:()=>s,xU:()=>h,xv:()=>c,yH:()=>M,zA:()=>m});var r=a(36422),n=a(83059);function o(e){return(0,r.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function i(e){return"object"==typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function s(e){return i(e)&&"editConfiguration"in e}function l(e){return i(e)&&"addTrackConf"in e&&!e.disableAddTracks}function c(e){return i(e)&&"shareURL"in e&&!!e.shareURL}function d(e){return i(e)&&"widgets"in e}function u(e){return i(e)&&"makeConnection"in e}function p(e){return i(e)&&"addConnectionConf"in e}function m(e){return i(e)&&"sessionPlugins"in e}function g(e){return"object"==typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function f(e){return"object"==typeof e&&null!==e&&"width"in e&&"setWidth"in e}function h(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function y(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function b(e){return"object"==typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function w(e){return"object"==typeof e&&null!==e&&"findAppropriateInternetAccount"in e}function v(e){return"object"==typeof e&&null!==e&&"internetAccounts"in e&&"findAppropriateInternetAccount"in e}function C(e){return"object"==typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}function S(e){return"object"==typeof e&&null!==e&&"uri"in e&&!!e.uri}function k(e){return"object"==typeof e&&null!==e&&"localPath"in e&&!!e.localPath}function T(e){return"object"==typeof e&&null!==e&&"blobId"in e&&!!e.blobId}class x extends Error{constructor(e,t){super(e),this.message=e,this.url=t,this.name="AuthNeededError",Object.setPrototypeOf(this,x.prototype)}}class A extends Error{constructor(e,t){super(e),this.message=e,this.internetAccountId=t,this.name="RetryError"}}function P(e){return e instanceof Error&&("AuthNeededError"===e.name||void 0!==e.url)}function M(e){return"RetryError"===e.name||void 0!==e.internetAccountId}},40085:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(7552);function n(){const e=(0,r.useRef)(null),[t,a]=(0,r.useState)({width:void 0,height:void 0});return(0,r.useEffect)((()=>{if(!e.current)return;const t="undefined"!=typeof window&&"ResizeObserver"in window?window.ResizeObserver:void 0;if(!t)return;const r=new t((e=>{a({width:e[0].contentRect.width,height:e[0].contentRect.height})}));return r.observe(e.current),()=>{r.disconnect()}}),[]),[e,t]}},1864:(e,t,a)=>{"use strict";a.d(t,{z:()=>r.when});var r=a(42489)},82353:(e,t,a)=>{"use strict";a.d(t,{L$:()=>C,qe:()=>k,RI:()=>w});var r=a(7552),n=a(49823),o=a(29499),i=a(58507),s=a(5401),l=a(42489),c=a(68446),d=a(36422),u=a(33371),p=a(32808);const m=(0,a(75785).n9)()({block:{display:"block"}});function g({checked:e,disabled:t,label:a,onChange:n}){const{classes:o}=m();return r.createElement(u.A,{disabled:t,className:o.block,control:r.createElement(p.A,{checked:e,onChange:n}),label:a})}var f=a(9502),h=a(99546);function y(e){return e.map((({id:e,displays:t,...a})=>({...a,displays:t.map((({id:e,...t})=>t))})))}function b({feature:e,assembly:t}){const a=e.get("ALT")?.[0],r=a?(0,f.h)(a):void 0,n=e.get("start"),o=e.get("refName"),i=e=>t.getCanonicalRefName(e)||e;if("<TRA>"===a){const t=e.get("INFO");return{pos:n,refName:i(o),mateRefName:i(t.CHR2[0]),matePos:t.END[0]-1}}if(r?.MatePosition){const e=r.MatePosition.split(":");return{pos:n,refName:i(o),mateRefName:i(e[0]),matePos:+e[1]-1}}if(e.get("mate")){const t=e.get("mate");return{pos:n,refName:i(o),mateRefName:i(t.refName),matePos:t.start}}return{pos:n,refName:i(o),mateRefName:i(o),matePos:e.get("end")}}async function w({stableViewId:e,feature:t,assemblyName:a,session:r,tracks:n}){const{assemblyManager:o}=r,i=o.get(a);if(!i)throw new Error(`assembly ${a} not found`);if(!i.regions)throw new Error(`assembly ${a} regions not loaded`);const{refName:s,pos:c,mateRefName:u,matePos:p}=b({feature:t,assembly:i}),m=i.regions.find((e=>e.refName===s)),g=i.regions.find((e=>e.refName===u)),f=[{...m},{...m}],h=[{...g},{...g}];f[0].end=c,f[1].start=c,h[0].end=p,h[1].start=p;const w={type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:f,hideHeader:!0,bpPerPx:10,offsetPx:(m.start+t.get("start"))/10},{type:"LinearGenomeView",displayedRegions:h,hideHeader:!0,bpPerPx:10,tracks:n,offsetPx:(g.start+p)/10}],displayName:`${t.get("name")||t.get("id")||"breakend"} split detail`};let v=r.views.find((t=>t.id===e));v?(0,l.transaction)((()=>{for(let e=0;e<v.views.length;e++){const t=w.views[e];t&&(v.views[e].setDisplayedRegions(t.displayedRegions),v.views[e].scrollTo(t.offsetPx-800),v.views[e].zoomTo(t.bpPerPx))}v.setDisplayName(w.displayName)})):v=r.addView("BreakpointSplitView",{...w,id:e,views:[{...w.views[0],tracks:n?y((0,d.getSnapshot)(n)):[]},{...w.views[1],tracks:(n?y((0,d.getSnapshot)(n)):[]).reverse()}]})}function v(e){return e.map((({id:e,displays:t,...a})=>({...a,displays:t.map((({id:e,...t})=>t))})))}const C=(0,c.observer)((function({session:e,handleClose:t,feature:a,assemblyName:c,stableViewId:u,view:p}){const[m,f]=(0,r.useState)(!0),[h,y]=(0,r.useState)(!0);return r.createElement(n.Dialog,{open:!0,onClose:t,title:"Multi-level breakpoint split view options"},r.createElement(o.A,null,r.createElement("div",null,"Launch multi-level breakpoint split view"),p?r.createElement(r.Fragment,null,r.createElement(g,{checked:m,label:"Copy tracks into the new view",onChange:e=>{f(e.target.checked)}}),m?r.createElement(g,{checked:h,disabled:!m,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:e=>{y(e.target.checked)}}):null):null),r.createElement(i.A,null,r.createElement(s.A,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e,r=await t.waitForAssembly(c);if(!r)throw new Error(`assembly ${c} not found`);const{refName:n,pos:o,mateRefName:i,matePos:s}=b({feature:a,assembly:r}),m=p?(0,d.getSnapshot)(p.tracks):[];let g=e.views.find((e=>e.id===u));const f=`${a.get("name")||a.get("id")||"breakend"} split detail`;g||(g=e.addView("BreakpointSplitView",{id:u,type:"BreakpointSplitView",displayName:f,views:[{type:"LinearGenomeView",hideHeader:!0,tracks:v(m)},{type:"LinearGenomeView",hideHeader:!0,tracks:v(h?[...m].reverse():m)}]})),g.setDisplayName(f);const y=r.regions.find((e=>e.refName===n)),w=r.regions.find((e=>e.refName===i));if(!y||!w)throw new Error("can't find regions");await Promise.all([g.views[0].navToLocations([{refName:n,start:y.start,end:o,assemblyName:c},{refName:n,start:o+1,end:y.end,assemblyName:c}]),g.views[1].navToLocations([{refName:i,start:w.start,end:s,assemblyName:c},{refName:i,start:s+1,end:w.end,assemblyName:c}])]),await(0,l.when)((()=>g.views[1].initialized&&g.views[0].initialized)),g.views[1].zoomTo(10),g.views[0].zoomTo(10),g.views[1].centerAt(s,i),g.views[0].centerAt(o,n)}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0},"OK"),r.createElement(s.A,{color:"secondary",variant:"contained",onClick:()=>{t()}},"Cancel")))}));var S=a(1343);const k=(0,c.observer)((function({session:e,handleClose:t,feature:a,stableViewId:l,assemblyName:c,view:u}){const[p,m]=(0,r.useState)(!0),[f,w]=(0,h.useLocalStorage)("breakpointWindowSize","5000");return r.createElement(n.Dialog,{open:!0,onClose:t,title:"Single-level breakpoint split view options"},r.createElement(o.A,null,u?r.createElement(g,{checked:p,label:"Copy tracks into the new view",onChange:e=>{m(e.target.checked)}}):null,r.createElement(S.A,{label:"Window size (bp)",value:f,onChange:e=>{w(e.target.value)}})),r.createElement(i.A,null,r.createElement(s.A,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e;if(!await t.waitForAssembly(c))throw new Error(`assembly ${c} not found`);await async function({stableViewId:e,feature:t,assemblyName:a,session:r,tracks:n,windowSize:o=0}){const{snap:i,coverage:s}=function({feature:e,session:t,assemblyName:a}){const{assemblyManager:r}=t,n=r.get(a);if(!n)throw new Error(`assembly ${a} not found`);if(!n.regions)throw new Error(`assembly ${a} regions not loaded`);const o=b({feature:e,assembly:n}),{refName:i,mateRefName:s}=o,l=n.regions.find((e=>e.refName===i)),c=n.regions.find((e=>e.refName===s));return{coverage:o,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,h.gatherOverlaps)([{...l,assemblyName:a},{...c,assemblyName:a}])}],displayName:`${e.get("name")||e.get("id")||"breakend"} split detail`}}}({feature:t,assemblyName:a,session:r}),{refName:l,pos:c,mateRefName:u,matePos:p}=s;let m=r.views.find((t=>t.id===e));m?(m.views[0]?.setDisplayedRegions(i.views[0].displayedRegions),m.setDisplayName(i.displayName)):m=r.addView("BreakpointSplitView",{...i,views:[{...i.views[0],tracks:n?y((0,d.getSnapshot)(n)):[]}]});const g=m.views[0];await(0,h.when)((()=>g.initialized));const f=g.bpToPx({coord:Math.max(0,c-o),refName:l}),w=g.bpToPx({coord:p+o,refName:u});f&&w?g.moveTo({...f,offset:f.offsetPx},{...w,offset:w.offsetPx}):(0,h.getSession)(g).notify("Unable to navigate to breakpoint")}({feature:a,assemblyName:c,session:e,stableViewId:l,tracks:u?.tracks,windowSize:+f||0})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0},"OK"),r.createElement(s.A,{color:"secondary",variant:"contained",onClick:()=>{t()}},"Cancel")))}))},49256:(e,t,a)=>{"use strict";function r(e,t){let a=0,r=0,n=0;const o=[];for(let i=0;i<e.length&&n<t.length;i+=2){const s=+e[i],l=e[i+1];if("S"===l||"I"===l){for(let e=0;e<s&&n<t.length;e++)t[n]===a+e&&n++;a+=s}else if("D"===l||"N"===l)r+=s;else if("M"===l||"X"===l||"="===l){for(let e=0;e<s&&n<t.length;e++)t[n]===a+e&&(o.push({ref:r+e,idx:n}),n++);a+=s,r+=s}}return o}a.d(t,{h:()=>r})},95805:(e,t,a)=>{"use strict";function r(e,t,a,r){let n=0,o=0;const i=[],s=a&&t;for(let l=0;l<e.length;l+=2){const c=+e[l],d=e[l+1];if("M"===d||"="===d||"E"===d){if(s)for(let e=0;e<c;e++)t[o+e].toUpperCase()!==a[n+e].toUpperCase()&&i.push({start:n+e,type:"mismatch",base:t[o+e],altbase:a[n+e],length:1});o+=c}if("I"===d)i.push({start:n,type:"insertion",base:`${c}`,length:0}),o+=c;else if("D"===d)i.push({start:n,type:"deletion",base:"*",length:c});else if("N"===d)i.push({start:n,type:"skip",base:"N",length:c});else if("X"===d){const e=t?.slice(o,o+c)||[],a=r?.subarray(o,o+c)||[];for(let t=0;t<c;t++)i.push({start:n+t,type:"mismatch",base:e[t]||"X",qual:a[t],length:1});o+=c}else"H"===d?i.push({start:n,type:"hardclip",base:`H${c}`,cliplen:c,length:1}):"S"===d&&(i.push({start:n,type:"softclip",base:`S${c}`,cliplen:c,length:1}),o+=c);"I"!==d&&"S"!==d&&"H"!==d&&(n+=c)}return i}a.r(t),a.d(t,{featurizeSA:()=>b,getClip:()=>h,getLength:()=>g,getLengthOnRef:()=>m,getLengthSansClipping:()=>f,getMismatches:()=>d,getNextRefPos:()=>o.h,getOrientedCigar:()=>u,getOrientedMismatches:()=>p,getTag:()=>y,parseCigar:()=>c});const n=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi);var o=a(49256);const i=new RegExp(/([MIDNSHPX=])/),s=new RegExp(/(\d+)[SH]$/),l=new RegExp(/^(\d+)([SH])/);function c(e=""){return e.split(i).slice(0,-1)}function d(e,t,a,o,i){let s=[];const l=c(e);return e&&(s=s.concat(r(l,a,o,i))),t&&a&&(s=s.concat(function(e,t,a,r,o){let i={start:0,base:"",length:0,type:"mismatch"},s=0,l=0,c=0,d=0;const u=[],p=a.filter((e=>"skip"===e.type));function m(e){let a=l,r=c;for(let n=s;n<t.length&&r<=e;n+=2,s=n){const e=+t[n],o=t[n+1];"S"===o||"I"===o?a+=e:"D"===o||"P"===o||"N"===o?r+=e:"H"!==o&&(a+=e,r+=e)}return l=a,c=r,a-(r-e)}const g=e.match(n)||[];for(const e of g){const t=+e;if(Number.isNaN(t))if(e.startsWith("^"))i.start+=e.length-1;else for(let t=0;t<e.length;t+=1){for(i.length=1;d<p.length;){const e=p[d];if(!(i.start>=e.start))break;i.start+=e.length,d++}const t=m(i.start);i.base=r[t]||"X",i.qual=o?.[t],i.altbase=e,u.push(i),i={start:i.start+i.length,length:0,base:"",type:"mismatch"}}else i.start+=t}return u}(t,l,s,a,i))),s}function u(e,t){if(e){const e=[];for(let a=0;a<t.length;a+=2){const r=t[a];let n=t[a+1];"D"===n?n="I":"I"===n&&(n="D"),e.push(r,n)}return e}return t}function p(e,t){const a=c(t);return r(e?u(e,a):a)}function m(e){const t=c(e);let a=0;for(let e=0;e<t.length;e+=2){const r=+t[e],n=t[e+1];"H"!==n&&"S"!==n&&"I"!==n&&(a+=r)}return a}function g(e){const t=c(e);let a=0;for(let e=0;e<t.length;e+=2){const r=+t[e],n=t[e+1];"D"!==n&&"N"!==n&&(a+=r)}return a}function f(e){const t=c(e);let a=0;for(let e=0;e<t.length;e+=2){const r=+t[e],n=t[e+1];"H"!==n&&"S"!==n&&"D"!==n&&"N"!==n&&(a+=r)}return a}function h(e,t){return-1===t?+(s.exec(e)||[])[1]||0:+(l.exec(e)||[])[1]||0}function y(e,t){return e.get("tags")[t]}function b(e,t,a,r,n){return e?.split(";").filter((e=>!!e)).map(((e,o)=>{const i=e.split(","),s=i[0],l=i[1],c=i[2],d=i[3],u=m(d),p=g(d),y=f(d),b="-"===c?-1:1,w=h(d,(n?a:1)*b),v=+l-1;return{refName:s,start:v,end:v+u,seqLength:p,clipPos:w,CIGAR:d,strand:(n?a:1)*b,uniqueId:`${t}_SA${o}`,mate:{start:w,end:w+y,refName:r}}}))||[]}},93092:(e,t,a)=>{"use strict";a.d(t,{Ps:()=>d,Yj:()=>s,Z1:()=>l,eV:()=>c});var r=a(99546),n=a(49256),o=a(86576);const i=new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/);function s(e){const t=(0,o.c$)(e,"ML","Ml")||[];return t?("string"==typeof t?t.split(",").map((e=>+e)):t).map((e=>e/255)):(0,o.c$)(e,"MP","Mp")?.split("").map((e=>e.charCodeAt(0)-33)).map((e=>Math.min(1,e/50)))}function l(e,t,a){const n=-1===a?(0,r.revcom)(t):t,o=e.split(";").filter((e=>!!e)),s=[];for(const e of o){const[t,...r]=e.split(","),o=i.exec(t);if(!o)throw new Error("bad format for MM tag");const[,l,c,d]=o,u=d.split(/(\d+|.)/).filter((e=>!!e));"-"===c&&(console.warn("unsupported negative strand modifications"),s.push({type:"unsupported",positions:[],base:l,strand:c}));for(const e of u){let t=0;const o=[];for(const e of r){let r=+e;do{"N"!==l&&l!==n[t]||r--,t++}while(r>=0&&t<n.length);if(-1===a){const e=n.length-t;e>=0&&o.unshift(e)}else o.push(t-1)}s.push({type:e,base:l,strand:c,positions:o})}}return s}function c(e){return e.split(";").filter((e=>!!e)).flatMap((e=>{const t=e.split(",")[0],a=i.exec(t);if(!a)throw new Error("bad format for MM tag");const[,r,n,o]=a;return o.split(/(\d+|.)/).filter((e=>!!e)).map((e=>({type:e,base:r,strand:n})))}))}function d(e,t){const a=e.get("start"),r=e.get("end"),i=e.get("strand"),c=r-a,d=(0,o.c$)(e,"MM","Mm")||"",u=[],p=[],m=[],g=[],f=e.get("seq");if(f){const a=s(e),r=l(d,f,i);let o=0;for(const{type:e,positions:s}of r){for(const{ref:r,idx:l}of(0,n.h)(t,s)){const t=o+(-1===i?s.length-1-l:l),n=a?.[t]||0;"m"===e?r>=0&&r<c&&(u[r]=1,m[r]=n):"h"===e&&r>=0&&r<c&&(p[r]=1,g[r]=n)}o+=s.length}}return{methBins:u,hydroxyMethBins:p,methProbs:m,hydroxyMethProbs:g}}},42781:(e,t,a)=>{"use strict";a.d(t,{aF:()=>Ee,N5:()=>le,Ay:()=>Ke,ww:()=>H});var r=a(12678),n=a(7552),o=a(67736),i=a(68584);const s=(0,i.ConfigurationSchema)("AlignmentsFeatureWidget",{});var l=a(9342),c=a(36422);function d(e){const t=(0,l.n)(e);return c.types.compose(t,c.types.model("AlignmentsFeatureWidget",{type:c.types.literal("AlignmentsFeatureWidget")}))}function u(e){e.addWidgetType((()=>new o.A({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:s,stateModel:d(e),ReactComponent:(0,n.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(3011),a.e(6157),a.e(1405),a.e(4144),a.e(5132)]).then(a.bind(a,55132))))})))}var p=a(58273),m=a(1622),g=a(58921);function f(e){e.addTrackType((()=>{const t=(a=e,(0,i.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:(0,g.createBaseTrackConfig)(a)}));var a;const r=new p.A({name:"AlignmentsTrack",displayName:"Alignments track",configSchema:t,stateModel:(0,m.createBaseTrackModel)(e,"AlignmentsTrack",t)}),n=e.getDisplayType("LinearAlignmentsDisplay");return r.addDisplayType(n),r}))}var h=a(47369);const y=(0,i.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("BamIndex",{indexType:{model:c.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",description:"size to fetch in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:5e6},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0});function b(e){e.addAdapterType((()=>new h.A({name:"BamAdapter",displayName:"BAM adapter",configSchema:y,getAdapterClass:()=>Promise.all([a.e(4133),a.e(4770)]).then(a.bind(a,94770)).then((e=>e.default))})))}const w=(0,i.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",description:"size in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:{type:"frozen",description:"sequence data adapter",defaultValue:null}},{explicitlyTyped:!0});function v(e){e.addAdapterType((()=>new h.A({name:"CramAdapter",displayName:"CRAM adapter",configSchema:w,getAdapterClass:()=>Promise.all([a.e(5099),a.e(6391)]).then(a.bind(a,78369)).then((e=>e.default))})))}var C=a(91468);function S(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="CramAdapter",o=(0,C.getFileName)(t),i={type:n,cramLocation:t,craiLocation:a||(0,C.makeIndex)(t,".crai")};return/\.cram$/i.test(o)&&!r||r===n?i:e(t,a,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="BamAdapter",o=(0,C.getFileName)(t),i=a&&(0,C.getFileName)(a),s={type:n,bamLocation:t,index:{location:a||(0,C.makeIndex)(t,".bai"),indexType:(0,C.makeIndexType)(i,"CSI","BAI")}};return/\.bam$/i.test(o)&&!r||r===n?s:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t)))}const k=(0,i.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",description:"the base URL to fetch from",defaultValue:""},htsgetTrackId:{type:"string",description:"the trackId, which is appended to the base URL",defaultValue:""},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0});function T(e){e.addAdapterType((()=>new h.A({name:"HtsgetBamAdapter",displayName:"Htsget BAM adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:k,getAdapterClass:()=>Promise.all([a.e(4133),a.e(6823)]).then(a.bind(a,6823)).then((e=>e.default))})))}var x=a(56328),A=a(49823),P=a(68446);const M=(0,a(75785).n9)()({resizeHandle:{height:5,position:"absolute",zIndex:2}}),E=(0,P.observer)((function({model:e}){const{PileupDisplay:t,SNPCoverageDisplay:a}=e,{classes:r}=M();if(!a)return null;const o=a.height??100;return n.createElement("div",{"data-testid":`display-${(0,i.getConf)(e,"displayId")}`,style:{position:"relative"}},n.createElement("div",{"data-testid":"Blockset-snpcoverage"},n.createElement(a.RenderingComponent,{model:a})),n.createElement(A.ResizeHandle,{onDrag:e=>(a.setHeight(a.height+e),e),className:r.resizeHandle,style:{top:o-4}}),n.createElement("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:o}},n.createElement(t.RenderingComponent,{model:t})))})),R=E;var I=a(20529),N=a(41365),L=a.n(N),D=a(42489);function F(e){return e.getDisplayElements().filter((e=>"LinearAlignmentsDisplay"===e.subDisplay?.type)).filter((e=>e.subDisplay?.lowerPanel))}function B(e){const{PileupDisplay:t,SNPCoverageDisplay:a}=e;return t||(0,c.isAlive)(t)||a||(0,c.isAlive)(a)}const V=function(e,t){return c.types.compose("LinearAlignmentsDisplay",m.BaseDisplay,function(e,t){return c.types.model({PileupDisplay:c.types.maybe(c.types.union(...F(e).map((e=>e.stateModel)))),SNPCoverageDisplay:c.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:c.types.literal("LinearAlignmentsDisplay"),configuration:(0,i.ConfigurationReference)(t),heightPreConfig:c.types.maybe(c.types.number),userFeatureScreenDensity:c.types.maybe(c.types.number),lowerPanelType:"LinearPileupDisplay"})}(e,t)).volatile((()=>({scrollTop:0}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setSNPCoverageHeight(t){e.snpCovHeight=t}}))).views((e=>({get height(){return e.heightPreConfig??(0,i.getConf)(e,"height")},get featureIdUnderMouse(){return e.PileupDisplay.featureIdUnderMouse||e.SNPCoverageDisplay.featureIdUnderMouse}}))).views((e=>({get pileupConf(){return{...(0,i.getConf)(e,"pileupDisplay"),type:e.lowerPanelType,displayId:`${e.configuration.displayId}_${e.lowerPanelType}_xyz`}},getFeatureByID:(t,a)=>e.PileupDisplay.getFeatureByID(t,a),searchFeatureByID:t=>e.PileupDisplay.searchFeatureByID?.(t),get features(){return e.PileupDisplay.features},get DisplayBlurb(){return e.PileupDisplay?.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get coverageConf(){return{...(0,i.getConf)(e,"snpCoverageDisplay"),displayId:`${e.configuration.displayId}_snpcoverage_xyz`}}}))).actions((e=>({setSNPCoverageDisplay(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setFeatureDensityStatsLimit(t){e.PileupDisplay.setFeatureDensityStatsLimit(t),e.SNPCoverageDisplay.setFeatureDensityStatsLimit(t)},setPileupDisplay(t){e.PileupDisplay={type:t.type||"LinearPileupDisplay",configuration:t}},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.heightPreConfig),setFilterBy(t){e.PileupDisplay.setFilterBy(t),e.SNPCoverageDisplay.setFilterBy(t)},setLowerPanelType(t){e.lowerPanelType=t},resizeHeight(t){const a=e.height;return this.setHeight(e.height+t)-a}}))).actions((e=>({afterAttach(){(0,c.addDisposer)(e,(0,D.autorun)((()=>{const{SNPCoverageDisplay:t,PileupDisplay:a,coverageConf:r,pileupConf:n}=e;t?L()(r,(0,c.getSnapshot)(t.configuration))||(t.setHeight(e.snpCovHeight),t.setConfig(e.coverageConf)):e.setSNPCoverageDisplay(r),a&&e.lowerPanelType===a.type?L()(n,(0,c.getSnapshot)(a.configuration))||a.setConfig(e.pileupConf):e.setPileupDisplay(n),function(e){const{PileupDisplay:t,SNPCoverageDisplay:a}=e;B(e)&&t.colorBy&&(L()(t.colorBy,a.colorBy)||a.setColorScheme({...t.colorBy}))}(e),function(e){const{PileupDisplay:t,SNPCoverageDisplay:a}=e;B(e)&&t.filterBy&&(L()(t.filterBy,a.filterBy)||a.setFilterBy({...t.filterBy}))}(e)}))),(0,c.addDisposer)(e,(0,D.autorun)((()=>{e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)}))),(0,c.addDisposer)(e,(0,D.autorun)((()=>{e.PileupDisplay.setHeight(e.height-e.SNPCoverageDisplay.height)})))},async renderSvg(t){const a=e.height-e.SNPCoverageDisplay.height;return await(0,D.when)((()=>!e.PileupDisplay.renderProps().notReady&&!e.SNPCoverageDisplay.renderProps().notReady)),n.createElement(n.Fragment,null,n.createElement("g",null,await e.SNPCoverageDisplay.renderSvg(t)),n.createElement("g",{transform:`translate(0 ${e.SNPCoverageDisplay.height})`},await e.PileupDisplay.renderSvg({...t,overrideHeight:a})))}}))).views((t=>{const{trackMenuItems:a}=t;return{trackMenuItems(){if(!t.PileupDisplay)return[];const r=F(e).map((e=>({type:"radio",label:e.displayName,checked:e.name===t.PileupDisplay.type,onClick:()=>{t.setLowerPanelType(e.name)}})));return[...a(),{type:"subMenu",label:"Pileup settings",subMenu:t.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:t.SNPCoverageDisplay.trackMenuItems()},{type:"subMenu",label:"Replace lower panel with...",subMenu:r}]}}})).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...a}=e;return{heightPreConfig:t,...a}}))};function z(e){e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:e.getDisplayType("LinearPileupDisplay").configSchema,snpCoverageDisplay:e.getDisplayType("LinearSNPCoverageDisplay").configSchema,height:{type:"number",defaultValue:250}},{baseConfiguration:I.Ki,explicitlyTyped:!0})}(e);return new x.A({name:"LinearAlignmentsDisplay",displayName:"Alignments display (combination)",configSchema:t,stateModel:V(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:R})}))}var O=a(91476);const H=function(e){return(0,i.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:c.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:e.getRendererType("PileupRenderer").configSchema}),maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:O.JD}},{baseConfiguration:(0,I.lw)(e),explicitlyTyped:!0})};var G=a(99546),j=a(39794),W=a(8233),$=a(1633),U=a(88627),q=a(93100),_=a(90542),J=a(28669),X=a(63670),Y=a(31409),K=a.n(Y),Q=a(86576),Z=a(36715);const ee=(0,P.observer)((function({model:e}){const{sortedBy:t}=e;return t?n.createElement("div",{"data-testid":`blurb-${t}`},n.createElement(Z.A,{color:"secondary",variant:"caption"},`Sorted by ${t.tag??t.type} at ${t.refName}:${t.pos}`)):null})),te=ee;var ae=a(80256);const re=(0,n.lazy)((()=>a.e(130).then(a.bind(a,40130)))),ne=(0,n.lazy)((()=>a.e(6043).then(a.bind(a,8424)))),oe=(0,n.lazy)((()=>a.e(5369).then(a.bind(a,55369)))),ie=(0,n.lazy)((()=>a.e(9589).then(a.bind(a,49589)))),se=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]);function le(e){return c.types.compose(I.Lr,c.types.model({configuration:(0,i.ConfigurationReference)(e),featureHeight:c.types.maybe(c.types.number),noSpacing:c.types.maybe(c.types.boolean),fadeLikelihood:c.types.maybe(c.types.boolean),trackMaxHeight:c.types.maybe(c.types.number),colorBySetting:c.types.frozen(),filterBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[])})).volatile((()=>({colorTagMap:D.observable.map({}),featureUnderMouseVolatile:void 0,tagsReady:!1}))).views((e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")}}))).views((e=>({get autorunReady(){return(0,G.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge}}))).actions((e=>({setTagsReady(t){e.tagsReady=t},setMaxHeight(t){e.trackMaxHeight=t},setFeatureHeight(t){e.featureHeight=t},setNoSpacing(t){e.noSpacing=t},setColorScheme(t){e.colorTagMap=D.observable.map({}),e.colorBySetting={...t},t.tag&&(e.tagsReady=!1)},updateColorTagMap(t){const a=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((t=>{if(!e.colorTagMap.has(t)){const r=[...e.colorTagMap.keys()].length;e.colorTagMap.set(t,a[r])}}))},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},selectFeature(t){const a=(0,G.getSession)(e);if((0,G.isSessionModelWithWidgets)(a)){const r=a.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,G.getContainingView)(e),track:(0,G.getContainingTrack)(e)});a.showWidget(r)}a.setSelection(t)},copyFeatureToClipboard(t){const{uniqueId:a,...r}=t.toJSON(),n=(0,G.getSession)(e);K()(JSON.stringify(r,null,4)),n.notify("Copied to clipboard","success")},setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)}}))).views((e=>({get rendererConfig(){const{featureHeight:t,noSpacing:a,trackMaxHeight:r,rendererTypeName:n}=e,o=(0,i.getConf)(e,["renderers",n])||{};return e.rendererType.configSchema.create({...o,...void 0!==t?{height:t}:{},...void 0!==a?{noSpacing:a}:{},...void 0!==r?{maxHeight:r}:{}},(0,G.getEnv)(e))}}))).views((e=>({get maxHeight(){return(0,i.readConfObject)(e.rendererConfig,"maxHeight")},get featureHeightSetting(){return(0,i.readConfObject)(e.rendererConfig,"height")},get featureUnderMouse(){return e.featureUnderMouseVolatile},renderReady:()=>e.tagsReady,get filters(){return new q.A({filters:e.jexlFilters})}}))).views((e=>{const{trackMenuItems:t,renderProps:a}=e;return{get rendererTypeName(){const t=(0,i.getConf)(e,"defaultRendering"),a=se.get(t);if(!a)throw new Error(`unknown alignments view name ${t}`);return a},contextMenuItems(){const t=e.contextMenuFeature;return t?[{label:"Open feature details",icon:X.A,onClick:()=>{e.clearFeatureSelection(),e.selectFeature(t)}},{label:"Copy info to clipboard",icon:_.PM,onClick:()=>{e.copyFeatureToClipboard(t)}}]:[]},get DisplayBlurb(){return te},renderPropsPre(){const{colorTagMap:t,colorBy:r,filterBy:n,rpcDriverName:o}=e,i=a();return{...i,notReady:i.notReady||!e.renderReady(),rpcDriverName:o,displayModel:e,colorBy:r,filterBy:n,filters:e.filters,colorTagMap:Object.fromEntries(t.toJSON()),config:e.rendererConfig,async onFeatureClick(t,a){const r=(0,G.getSession)(e),{rpcManager:n}=r;try{const t=a||e.featureIdUnderMouse;if(t){const a=(0,C.getRpcSessionId)(e),{feature:r}=await n.call(a,"CoreGetFeatureDetails",{featureId:t,sessionId:a,layoutId:(0,G.getContainingView)(e).id,rendererType:"PileupRenderer"});(0,c.isAlive)(e)&&r&&e.selectFeature(new G.SimpleFeature(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notify(`${e}`)}},onClick(){e.clearFeatureSelection()},async onFeatureContextMenu(t,a){const r=(0,G.getSession)(e),{rpcManager:n}=r;try{const t=a||e.featureIdUnderMouse;if(t){const a=(0,C.getRpcSessionId)(e),{feature:r}=await n.call(a,"CoreGetFeatureDetails",{featureId:t,sessionId:a,layoutId:(0,G.getContainingView)(e).id,rendererType:"PileupRenderer"});r&&e.setContextMenuFeature(new G.SimpleFeature(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notify(`${e}`)}}}},colorSchemeSubMenuItems:()=>[{label:"Normal",onClick:()=>{e.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:()=>{e.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:()=>{e.setColorScheme({type:"strand"})}},{label:"Per-base quality",onClick:()=>{e.setColorScheme({type:"perBaseQuality"})}},{label:"Per-base lettering",onClick:()=>{e.setColorScheme({type:"perBaseLettering"})}},{label:"First-of-pair strand",onClick:()=>{e.setColorScheme({type:"stranded"})}},{label:"Color by tag...",onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[ne,{model:e,handleClose:t}]))}}],trackMenuItems:()=>[...t(),{label:"Set feature height...",priority:1,subMenu:[{label:"Normal",onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",onClick:()=>{e.setFeatureHeight(2),e.setNoSpacing(!0)}},{label:"Manually set height",onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[oe,{model:e,handleClose:t}]))}}]},{label:"Set max height...",priority:-1,onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[ie,{model:e,handleClose:t}]))}},{label:"Filter by...",icon:J.A,onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[re,{model:e,handleClose:t}]))}}]}})).views((e=>({renderProps:()=>e.renderPropsPre()}))).actions((e=>({afterAttach(){(0,Q.vi)(e,(async()=>{const t=(0,G.getContainingView)(e);if(!e.autorunReady)return;const{colorBy:a,tagsReady:r}=e,{staticBlocks:n}=t;if(a?.tag&&!r){const t=await(0,ae.X)({self:e,tag:a.tag,blocks:n});(0,c.isAlive)(e)&&(e.updateColorTagMap(t),e.setTagsReady(!0))}else e.setTagsReady(!0)}),{delay:1e3}),(0,c.addDisposer)(e,(0,D.autorun)((async()=>{const t=(0,G.getSession)(e);try{const a=e.featureIdUnderMouse;if(e.featureUnderMouse?.id()!==a)if(a){const r=(0,C.getRpcSessionId)(e),n=(0,G.getContainingView)(e),{feature:o}=await t.rpcManager.call(r,"CoreGetFeatureDetails",{featureId:a,sessionId:r,layoutId:n.id,rendererType:"PileupRenderer"});(0,c.isAlive)(e)&&o&&e.featureIdUnderMouse===o.uniqueId&&e.setFeatureUnderMouse(new G.SimpleFeature(o))}else e.setFeatureUnderMouse(void 0)}catch(e){console.error(e),t.notifyError(`${e}`,e)}})))}}))).preProcessSnapshot((e=>{if(e){const{colorBy:t,filterBy:a,...r}=e;return{...r,filterBySetting:a,colorBySetting:t}}return e}))}async function ce({self:e,adapterConfig:t,blocks:a,opts:r}){const{rpcManager:n}=(0,G.getSession)(e),o=(0,C.getRpcSessionId)(e);return await n.call(o,"PileupGetVisibleModifications",{adapterConfig:t,sessionId:o,regions:a.contentBlocks,...r})}const de=(0,n.lazy)((()=>a.e(2697).then(a.bind(a,32697)))),ue=(0,n.lazy)((()=>a.e(4806).then(a.bind(a,74806)))),pe=function(e){return c.types.compose("LinearPileupDisplay",le(e),c.types.model({type:c.types.literal("LinearPileupDisplay"),configuration:(0,i.ConfigurationReference)(e),showSoftClipping:!1,mismatchAlpha:c.types.maybe(c.types.boolean),sortedBy:c.types.frozen()})).volatile((()=>({sortReady:!1,currSortBpPerPx:0,visibleModifications:D.observable.map({}),modificationsReady:!1}))).actions((e=>({setCurrSortBpPerPx(t){e.currSortBpPerPx=t},updateVisibleModifications(t){t.forEach((t=>{e.visibleModifications.has(t.type)||e.visibleModifications.set(t.type,{...t,color:(0,Q.rT)(t.type)})}))},setModificationsReady(t){e.modificationsReady=t},setSortReady(t){e.sortReady=t},clearSelected(){e.sortedBy=void 0},toggleSoftClipping(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha(){e.mismatchAlpha=!e.mismatchAlpha},setSortedBy(t,a){const{centerLineInfo:r}=(0,G.getContainingView)(e);if(!r)return;const{refName:n,assemblyName:o,offset:i}=r,s=Math.round(i)+1;s<0||!n||(e.sortReady=!1,e.sortedBy={type:t,pos:s,refName:n,assemblyName:o,tag:a})},setFeatureHeight(t){e.sortReady=!1,e.featureHeight=t}}))).actions((e=>{const t=e.reload;return{reload(){e.clearSelected(),t()}}})).views((e=>({get visibleModificationTypes(){return[...e.visibleModifications.keys()]},get rendererConfig(){const{featureHeight:t,noSpacing:a,trackMaxHeight:r,mismatchAlpha:n,rendererTypeName:o}=e,s=(0,i.getConf)(e,["renderers",o])||{};return e.rendererType.configSchema.create({...s,...void 0!==t?{height:t}:{},...void 0!==a?{noSpacing:a}:{},...void 0!==n?{mismatchAlpha:n}:{},...void 0!==r?{maxHeight:r}:{}},(0,G.getEnv)(e))}}))).views((e=>{const{renderReady:t}=e;return{get mismatchAlphaSetting(){return(0,i.readConfObject)(e.rendererConfig,"mismatchAlpha")},renderReady(){const a=(0,G.getContainingView)(e);return e.modificationsReady&&e.currSortBpPerPx===a.bpPerPx&&t()}}})).views((e=>{const{trackMenuItems:t,renderPropsPre:a,renderProps:r,colorSchemeSubMenuItems:n}=e;return{renderPropsPre(){const{sortedBy:t,showSoftClipping:r,visibleModifications:n}=e;return{...a(),showSoftClip:r,sortedBy:t,visibleModifications:Object.fromEntries(n.toJSON())}},renderProps(){const{sortReady:t}=e,a=r();return{...a,notReady:a.notReady||!t}},trackMenuItems:()=>[...t(),{label:"Sort by...",icon:W.A,disabled:e.showSoftClipping,subMenu:[...["Start location","Read strand","Base pair"].map((t=>({label:t,onClick:()=>{e.setSortedBy(t)}}))),{label:"Sort by tag...",onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[de,{model:e,handleClose:t}]))}},{label:"Clear sort",onClick:()=>{e.clearSelected()}}]},{label:"Color by...",icon:j.A,subMenu:[{label:"Pair orientation",onClick:()=>{e.setColorScheme({type:"pairOrientation"})}},{label:"Modifications",type:"subMenu",subMenu:e.modificationsReady?[{label:"All modifications",onClick:()=>{e.setColorScheme({type:"modifications"})}},...e.visibleModificationTypes.map((t=>({label:`Show only ${Q.Rs[t]?.name||t}`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t}})}}))),{type:"divider"},{label:"All modifications (<50% prob colored blue)",onClick:()=>{e.setColorScheme({type:"modifications",modifications:{twoColor:!0}})}},...e.visibleModificationTypes.map((t=>({label:`Show only ${Q.Rs[t]?.name||t} (<50% prob colored blue)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t,twoColor:!0}})}}))),{type:"divider"},{label:"All reference CpGs",onClick:()=>{e.setColorScheme({type:"methylation"})}}]:[{label:"Loading modifications...",onClick:()=>{}}]},{label:"Insert size",onClick:()=>{e.setColorScheme({type:"insertSize"})}},...n()]},{label:"Group by...",icon:U.A,onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[ue,{model:e,handleClose:t}]))}},{label:"Show soft clipping",icon:$.A,type:"checkbox",checked:e.showSoftClipping,onClick:()=>{e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:()=>{e.toggleMismatchAlpha()}}]}})).actions((e=>({afterAttach(){(0,Q.vi)(e,(async()=>{const t=(0,G.getContainingView)(e);e.autorunReady&&e.setCurrSortBpPerPx(t.bpPerPx)}),{delay:1e3}),(0,Q.vi)(e,(async()=>{const{rpcManager:t}=(0,G.getSession)(e),a=(0,G.getContainingView)(e);if(!e.autorunReady)return;const{sortedBy:r,adapterConfig:n,rendererType:o,sortReady:i}=e,{bpPerPx:s}=a;if(r&&(!i||e.currSortBpPerPx===a.bpPerPx)){const{pos:i,refName:s,assemblyName:l}=r;await e.rendererType.renderInClient(t,{assemblyName:l,regions:[{start:i,end:i+1,refName:s,assemblyName:l}],adapterConfig:n,rendererType:o.name,sessionId:(0,C.getRpcSessionId)(e),layoutId:a.id,timeout:1e6,...e.renderPropsPre()})}(0,c.isAlive)(e)&&(e.setCurrSortBpPerPx(s),e.setSortReady(!0))}),{delay:1e3}),(0,Q.vi)(e,(async()=>{if(!e.autorunReady)return;const{staticBlocks:t}=(0,G.getContainingView)(e),a=await ce({self:e,adapterConfig:(0,i.getConf)(e.parentTrack,"adapter"),blocks:t});(0,c.isAlive)(e)&&(e.updateVisibleModifications(a),e.setModificationsReady(!0))}))}})))};function me(e){e.addDisplayType((()=>{const t=H(e);return new x.A({name:"LinearPileupDisplay",displayName:"Pileup display",configSchema:t,stateModel:pe(t),subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:I.GQ})}))}var ge=a(53794);const fe=(0,n.lazy)((()=>a.e(130).then(a.bind(a,40130)))),he=function(e){return c.types.compose("LinearReadArcsDisplay",g.BaseDisplay,(0,I._e)(),(0,I.e6)(),c.types.model({type:c.types.literal("LinearReadArcsDisplay"),configuration:(0,i.ConfigurationReference)(e),lineWidth:c.types.maybe(c.types.number),jitter:c.types.maybe(c.types.number),colorBySetting:c.types.frozen(),filterBySetting:c.types.frozen(),drawInter:!0,drawLongRange:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).views((e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")}}))).actions((e=>({setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBySetting={...t}},setChainData(t){e.chainData=t},setDrawInter(t){e.drawInter=t},setDrawLongRange(t){e.drawLongRange=t},setFilterBy(t){e.filterBySetting={...t}},setLineWidth(t){e.lineWidth=t},setJitter(t){e.jitter=t}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx},get lineWidthSetting(){return e.lineWidth??(0,i.getConf)(e,"lineWidth")},get jitterVal(){return e.jitter??(0,i.getConf)(e,"jitter")}}))).views((e=>{const{trackMenuItems:t,renderProps:a}=e;return{renderProps:()=>({...a(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Filter by",icon:J.A,onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[fe,{model:e,handleClose:t}]))}},{label:"Line width",subMenu:[{label:"Thin",onClick:()=>{e.setLineWidth(1)}},{label:"Bold",onClick:()=>{e.setLineWidth(2)}},{label:"Extra bold",onClick:()=>{e.setLineWidth(5)}}]},{label:"Jitter x-positions",subMenu:[{type:"checkbox",checked:0===e.jitterVal,label:"None",onClick:()=>{e.setJitter(0)}},{type:"checkbox",checked:2===e.jitterVal,label:"Small",onClick:()=>{e.setJitter(2)}},{type:"checkbox",checked:10===e.jitterVal,label:"Large",onClick:()=>{e.setJitter(10)}}]},{label:"Draw inter-region vertical lines",type:"checkbox",checked:e.drawInter,onClick:()=>{e.setDrawInter(!e.drawInter)}},{label:"Draw long range connections",type:"checkbox",checked:e.drawLongRange,onClick:()=>{e.setDrawLongRange(!e.drawLongRange)}},{label:"Color scheme",icon:ge.A,subMenu:[{label:"Insert size  3 and orientation",onClick:()=>{e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size  3",onClick:()=>{e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:()=>{e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:()=>{e.setColorScheme({type:"gradient"})}}]}]}})).views((e=>({async renderSvg(t){const{renderSvg:r}=await a.e(9584).then(a.bind(a,59584)),{drawFeats:n}=await a.e(3304).then(a.bind(a,63304));return r(e,t,n)}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await a.e(9070).then(a.bind(a,9070)),{drawFeats:r}=await a.e(3304).then(a.bind(a,63304));t(e,r)}catch(t){console.error(t),e.setError(t)}})()}})))};function ye(e){e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearReadArcsDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},lineWidth:{type:"number",description:"set arc line width",defaultValue:1},jitter:{type:"number",description:"jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them",defaultValue:0},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}},filterBy:{type:"frozen",defaultValue:O.JD}},{baseConfiguration:(0,I.lw)(e),explicitlyTyped:!0})}(e);return new x.A({name:"LinearReadArcsDisplay",displayName:"Arc display",configSchema:t,stateModel:he(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,n.lazy)((()=>a.e(2424).then(a.bind(a,52424))))})}))}const be=(0,n.lazy)((()=>a.e(130).then(a.bind(a,40130)))),we=function(e){return c.types.compose("LinearReadCloudDisplay",g.BaseDisplay,(0,I._e)(),(0,I.e6)(),c.types.model({type:c.types.literal("LinearReadCloudDisplay"),configuration:(0,i.ConfigurationReference)(e),filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen(),drawSingletons:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).views((e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")}}))).actions((e=>({setDrawSingletons(t){e.drawSingletons=t},setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBySetting={...t}},setChainData(t){e.chainData=t},setFilterBy(t){e.filterBySetting={...t}}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Draw singletons",type:"checkbox",checked:e.drawSingletons,onClick:()=>{e.setDrawSingletons(!e.drawSingletons)}},{label:"Filter by",icon:J.A,onClick:()=>{(0,G.getSession)(e).queueDialog((t=>[be,{model:e,handleClose:t}]))}},{label:"Color scheme",icon:ge.A,subMenu:[{label:"Insert size  3 and orientation",onClick:()=>{e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size  3",onClick:()=>{e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:()=>{e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:()=>{e.setColorScheme({type:"gradient"})}}]}],async renderSvg(t){const{renderSvg:r}=await a.e(9584).then(a.bind(a,59584)),{drawFeats:n}=await a.e(6946).then(a.bind(a,26946));return r(e,t,n)}}})).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await a.e(9070).then(a.bind(a,9070)),{drawFeats:r}=await a.e(6946).then(a.bind(a,26946));t(e,r)}catch(t){console.error(t),e.setError(t)}})()}})))};function ve(e){e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearReadCloudDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},featureHeight:{type:"number",defaultValue:7},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}}},{baseConfiguration:(0,I.lw)(e),explicitlyTyped:!0})}(e);return new x.A({name:"LinearReadCloudDisplay",displayName:"Read cloud display",configSchema:t,stateModel:we(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,n.lazy)((()=>a.e(8408).then(a.bind(a,48408))))})}))}var Ce=a(27725);const Se=(0,n.lazy)((()=>a.e(489).then(a.bind(a,80489)))),ke=new Map([["snpcoverage","SNPCoverageRenderer"]]),Te=function(e,t){return c.types.compose("LinearSNPCoverageDisplay",(0,Ce._i)(e,t),c.types.model({type:c.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:c.types.maybe(c.types.boolean),drawIndicators:c.types.maybe(c.types.boolean),drawArcs:c.types.maybe(c.types.boolean),filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[])})).volatile((()=>({visibleModifications:D.observable.map({}),modificationsReady:!1}))).views((e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")}}))).actions((e=>({setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setColorScheme(t){e.colorBySetting=t?{...t}:void 0},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)},updateVisibleModifications(t){for(const a of t)e.visibleModifications.has(a.type)||e.visibleModifications.set(a.type,{...a,color:(0,Q.rT)(a.type)})}}))).views((e=>{const{adapterProps:t}=e;return{get rendererConfig(){const t=(0,i.getConf)(e,["renderers",e.rendererTypeName])||{},{drawArcs:a,drawInterbaseCounts:r,drawIndicators:n}=e;return e.rendererType.configSchema.create({...t,drawInterbaseCounts:r??t.drawInterbaseCounts,drawIndicators:n??t.drawIndicators,drawArcs:a??t.drawArcs},(0,c.getEnv)(e))},get drawArcsSetting(){return e.drawArcs??(0,i.readConfObject)(this.rendererConfig,"drawArcs")},get drawInterbaseCountsSetting(){return e.drawInterbaseCounts??(0,i.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){return e.drawIndicators??(0,i.readConfObject)(this.rendererConfig,"drawIndicators")},get autorunReady(){return(0,G.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error},adapterProps(){const a=t(),{filters:r,filterBy:n}=e;return{...a,filters:r,filterBy:n}}}})).actions((e=>({setModificationsReady(t){e.modificationsReady=t},toggleDrawIndicators(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting},toggleDrawArcs(){e.drawArcs=!e.drawArcsSetting}}))).actions((e=>({afterAttach(){(0,Q.vi)(e,(async()=>{if(e.setModificationsReady(!1),!e.autorunReady)return;const t=(0,G.getContainingView)(e),{staticBlocks:a}=t,{colorBy:r}=e;if("modifications"===r?.type){const t=await ce({self:e,adapterConfig:(0,i.getConf)(e.parentTrack,"adapter"),blocks:a});(0,c.isAlive)(e)&&(e.updateVisibleModifications(t),e.setModificationsReady(!0))}else e.setModificationsReady(!0)}),{delay:1e3})}}))).views((e=>{const{renderProps:t,trackMenuItems:a}=e;return{get renderReady(){return!t().notReady&&e.modificationsReady},get ready(){return this.renderReady},renderProps(){const{colorBy:a,visibleModifications:r}=e;return{...t(),notReady:!this.ready,colorBy:a,visibleModifications:Object.fromEntries(r.toJSON())}},get TooltipComponent(){return Se},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:(0,i.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return ke.get("snpcoverage")},get needsScalebar(){return!0},contextMenuItems:()=>[],trackMenuItems:()=>[...a(),{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:()=>{e.toggleDrawIndicators()}},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:()=>{e.toggleDrawInterbaseCounts()}},{label:"Draw arcs",type:"checkbox",checked:e.drawArcsSetting,onClick:()=>{e.toggleDrawArcs()}}],get filters(){return new q.A({filters:e.jexlFilters})}}}))};function xe(e){e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:c.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:c.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:e.getRendererType("SNPCoverageRenderer").configSchema}),colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:O.JD}},{baseConfiguration:I.Ki,explicitlyTyped:!0})}(e);return new x.A({name:"LinearSNPCoverageDisplay",displayName:"SNPCoverage display",configSchema:t,stateModel:Te(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Ce.r})}))}var Ae=a(3496),Pe=a(44728),Me=a(82088),Ee=a(95805),Re=a(2406);class Ie extends Re.A{async serializeArguments(e,t){const{rootModel:a}=this.pluginManager,r=a?.session?.assemblyManager;if(!r)throw new Error("no assembly manager available");const n=await(0,G.renameRegionsIfNeeded)(r,e);return super.serializeArguments(n,t)}}class Ne extends Ie{name="PileupGetReducedFeatures";async execute(e,t){const a=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:n,regions:o}=a,i=(await(0,Ae.cK)(this.pluginManager,n,r)).dataAdapter,s=await(0,Pe._)(i.getFeaturesInMultipleRegions(o,a).pipe((0,Me.$)())),l=(0,G.dedupe)(s.map((e=>({id:e.id(),refName:e.get("refName"),name:e.get("name"),start:e.get("start"),strand:e.get("strand"),end:e.get("end"),flags:e.get("flags"),tlen:e.get("template_length"),pair_orientation:e.get("pair_orientation"),next_ref:e.get("next_ref"),next_pos:e.get("next_pos"),clipPos:(0,Ee.getClip)(e.get("CIGAR"),e.get("strand")),SA:e.get("tags")?.SA}))),(e=>e.id)),c=l.filter((e=>2&e.flags&&!(256&e.flags)&&!(2048&e.flags))),d=c.length?function(e){const t=e.map((e=>Math.abs(e.tlen))),a=t.reduce(((e,t)=>e+t),0),r=t.map((e=>e*e)).reduce(((e,t)=>e+t),0),n=t.length,o=a/n,i=Math.sqrt((n*r-a*a)/(n*n));return{upper:o+4*i,lower:o-3*i,avg:o,sd:i}}(c):void 0,u=(0,G.groupBy)(l,(e=>e.name));return{chains:Object.values(u),stats:d,hasPaired:!!d,containsNoTransferables:!0}}}var Le=a(93092);class De extends Ie{name="PileupGetVisibleModifications";async execute(e,t){const{adapterConfig:a,sessionId:r,regions:n}=await this.deserializeArguments(e,t),o=(await(0,Ae.cK)(this.pluginManager,r,a)).dataAdapter,i=await(0,Pe._)(o.getFeaturesInMultipleRegions(n).pipe((0,Me.$)())),s=new Map;return i.forEach((e=>{for(const t of(0,Le.eV)((0,Q.c$)(e,"MM","Mm")||""))s.has(t.type)||s.set(t.type,t)})),[...s.values()]}}class Fe extends Ie{name="PileupGetGlobalValueForTag";async execute(e,t){const{adapterConfig:a,sessionId:r,regions:n,tag:o}=await this.deserializeArguments(e,t),i=(await(0,Ae.cK)(this.pluginManager,r,a)).dataAdapter.getFeaturesInMultipleRegions(n),s=await(0,Pe._)(i.pipe((0,Me.$)()));return[...new Set(s.map((e=>e.get("tags")?.[o])).filter((e=>void 0!==e)).map((e=>`${e}`)))]}}function Be(e){e.addRpcMethod((()=>new Fe(e))),e.addRpcMethod((()=>new De(e))),e.addRpcMethod((()=>new Ne(e)))}var Ve=a(98111);class ze extends Ve.LayoutSession{showSoftClip=!1;constructor(e){super(e),this.config=e.config}cachedLayoutIsValid(e){return super.cachedLayoutIsValid(e)&&this.showSoftClip===e.showSoftClip&&L()(this.sortedBy,e.sortedBy)&&L()(this.filterBy,e.filterBy)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,i.readConfObject)(this.config),filters:this.filters,filterBy:this.filterBy,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}class Oe extends Ve.default{supportsSVG=!0;async fetchSequence(e,t){const{sessionId:a,adapterConfig:r}=e,{sequenceAdapter:n}=r;if(!n)return;const{dataAdapter:o}=await(0,Ae.cK)(this.pluginManager,a,n);return(0,Q.Iw)({...t,start:Math.max(0,t.start-1),end:t.end+1},o)}getExpandedRegion(e,t){const{config:a,showSoftClip:r}=t,{start:n,end:o}=e,s=(0,i.readConfObject)(a,"maxClippingSize"),l=r?Math.round(s):0;return{...e,start:Math.floor(Math.max(n-l,0)),end:Math.ceil(o+l)}}async render(e){const t=await this.getFeatures(e),r=this.createLayoutInWorker(e),{colorBy:n,regions:o,bpPerPx:s}=e,l=o[0],c="methylation"===n?.type&&t.size?await this.fetchSequence(e,l):void 0,{layoutRecords:d,height:u}=function(e){const{layout:t,features:a,sortedBy:r,config:n,bpPerPx:o,showSoftClip:s,regions:l}=e,c=l[0],d=r?.type&&c.start===r.pos?((e,t)=>{const a=Array.from(e.values()),r=[],n=[],{pos:o,type:i}=t;a.forEach((e=>{const t=e,a=t.get("start"),i=t.get("end");(0,G.doesIntersect2)(o-1,o,a,i)?r.push(e):n.push(e)}));const s=!!a.length&&a[0].get("tags");switch(i){case"Start location":r.sort(((e,t)=>e.get("start")-t.get("start")));break;case"tag":{const e=t.tag,a=(e,t)=>s?e.get("tags")[t]:e.get(t);r[0]&&"string"==typeof a(r[0],e)?r.sort(((t,r)=>a(r,e).localeCompare(a(t,e)))):r.sort(((t,r)=>(a(r,e)||0)-(a(t,e)||0)));break}case"Base pair":{const e=[];for(const t of r){const a=t.get("mismatches");for(const r of a){const a=t.get("start")+r.start+1,n="insertion"===r.type||"softclip"===r.type?0:r.length;o>=a&&o<a+n&&e.push([t.id(),r])}}const t=new Map(e);r.sort(((e,a)=>{const r=t.get(e.id()),n=t.get(a.id()),o=n?.base.toUpperCase(),i=r?.base.toUpperCase();return o===i&&"*"===o?r.length-n.length:(o?o.charCodeAt(0):0)-(i?i.charCodeAt(0):0)}));break}case"Read strand":r.sort(((e,t)=>e.get("strand")<=t.get("strand")?1:-1))}return new Map([...r,...n].map((e=>[e.id(),e])))})(a,r):a,u=(0,i.readConfObject)(n,"height"),p=(0,i.readConfObject)(n,"displayMode"),m=(0,G.iterMap)(d.values(),(e=>function({feature:e,layout:t,bpPerPx:a,region:r,showSoftClip:n,heightPx:o,displayMode:i}){let s=0,l=0;if(n){const t=e.get("mismatches");if(e.get("seq"))for(const{type:e,start:a,cliplen:r=0}of t)"softclip"===e&&(0===a?s=r:l=r)}const[c,d]=(0,G.bpSpanPx)(e.get("start")-s,e.get("end")+l,r,a);if("compact"===i&&(o/=3),e.get("refName")!==r.refName)throw new Error(`feature ${e.id()} is not on the current region's reference sequence ${r.refName}`);const u=t.addRect(e.id(),e.get("start")-s,e.get("end")+l,o,e);return null===u?null:{feature:e,leftPx:c,rightPx:d,topPx:"collapse"===i?0:u,heightPx:o}}({feature:e,layout:t,bpPerPx:o,region:c,showSoftClip:s,heightPx:u,displayMode:p})),d.size).filter(G.notEmpty);return{layoutRecords:m,height:Math.max(t.getTotalHeight(),1)}}({...e,features:t,layout:r}),p=(l.end-l.start)/s,{makeImageData:m}=await a.e(4060).then(a.bind(a,24060)),g=await(0,G.renderToAbstractCanvas)(p,u,e,(a=>{m({ctx:a,layoutRecords:d,canvasWidth:p,renderArgs:{...e,layout:r,features:t,regionSequence:c}})}));return{...await super.render({...e,...g,features:t,layout:r,height:u,width:p}),...g,features:new Map,layout:r,height:u,width:p,maxHeightReached:r.maxHeightReached,containsNoTransferables:!0}}createSession(e){return new ze(e)}}function He(){return He=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},He.apply(null,arguments)}const Ge=(0,P.observer)((function(e){const{onMouseMove:t,blockKey:a,displayModel:r,width:o,height:i,regions:s,bpPerPx:l,sortedBy:c,colorBy:d,filterBy:u}=e,{selectedFeatureId:p,featureIdUnderMouse:m,contextMenuFeature:g}=r||{},[f,h]=(0,n.useState)(!1);(0,n.useEffect)((()=>{h(!0)}),[]);const y=s[0],b=(0,n.useRef)(null),[w,v]=(0,n.useState)(!1),[C,S]=(0,n.useState)(!1),k=p?r?.getFeatureByID(a,p):void 0,T=m||g?.id(),x=T?r?.getFeatureByID(a,T):void 0;function P(e,t=2){const[a,r,n,o]=e,[i,s]=(0,G.bpSpanPx)(a,n,y,l);return{left:i-t,top:Math.round(r)-t,width:s-i,height:Math.round(o-r)}}const M=k?P(k):void 0,E=x?P(x,0):void 0;function R(t,a){const r=e[`onFeature${t}`],n=e[`on${t}`];r&&m?r(a,m):n&&n(a,m)}const I=Math.ceil(o);return n.createElement("div",{ref:b,"data-testid":["pileup-overlay",c?.type,d?.type,d?.tag,u?.tagFilter?.tag].filter((e=>!!e)).join("-"),style:{position:"relative",width:I,height:i},onMouseDown:e=>{!function(e){v(!0),S(!1),R("MouseDown",e)}(e)},onMouseEnter:e=>{!function(e){R("MouseEnter",e)}(e)},onMouseOut:e=>{!function(e){R("MouseOut",e),R("MouseLeave",e)}(e)},onMouseOver:e=>{!function(e){R("MouseOver",e)}(e)},onMouseUp:e=>{!function(e){v(!1),R("MouseUp",e)}(e)},onMouseLeave:e=>{!function(e){R("MouseOut",e),R("MouseLeave",e)}(e)},onMouseMove:e=>{!function(e){if(!b.current)return;w&&S(!0);const n=b.current.getBoundingClientRect(),i=e.clientX-n.left,s=e.clientY-n.top,c=y.reversed?o-i:i,d=y.start+l*c;t?.(e,r?.getFeatureOverlapping(a,d,s))}(e)},onClick:e=>{!function(e){C||R("Click",e)}(e)},onContextMenu:e=>{!function(e){R("ContextMenu",e)}(e)},onFocus:()=>{},onBlur:()=>{}},n.createElement(A.PrerenderedCanvas,He({},e,{style:{position:"absolute",left:0,top:0}})),f&&E?n.createElement("div",{style:{position:"absolute",backgroundColor:"#0003",pointerEvents:"none",...E}}):null,f&&M?n.createElement("div",{style:{position:"absolute",border:"2px solid #00b8ff",boxSizing:"content-box",pointerEvents:"none",...M}}):null)})),je=(0,i.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:c.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orientation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:c.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:1},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function We(e){e.addRendererType((()=>new Oe({name:"PileupRenderer",displayName:"Pileup renderer",ReactComponent:Ge,configSchema:je,pluginManager:e})))}const $e=(0,i.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0});function Ue(e){e.addAdapterType((()=>new h.A({name:"SNPCoverageAdapter",displayName:"SNPCoverage adapter",adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(2947).then(a.bind(a,52947)).then((e=>e.default)),configSchema:$e})))}var qe=a(37347);const _e={C:"G",G:"C",A:"T",T:"A"};class Je extends Ce.er{async draw(e,t){const{features:a,regions:r,bpPerPx:n,colorBy:o,displayCrossHatches:s,visibleModifications:l={},scaleOpts:c,height:d,theme:u,config:p,ticks:m,stopToken:g}=t,f=(0,A.createJBrowseTheme)(u),h=r[0],y=(h.end-h.start)/n,b=Ce.Oy,w=d-2*b,v={...c,range:[0,w]},C=(0,Ce.X_)(v),S=(0,Ce.X_)({...v,range:[0,w/2],scaleType:"linear"}),k=(0,Ce.$z)(c.scaleType),T=(0,Ce.$z)("linear"),x=(0,i.readConfObject)(p,"indicatorThreshold"),P=(0,i.readConfObject)(p,"drawInterbaseCounts"),M=(0,i.readConfObject)(p,"drawArcs"),E=(0,i.readConfObject)(p,"drawIndicators"),R=e=>w-(C(e)||0)+b,I=e=>R(k)-R(e),N=e=>w-(S(e)||0)+b,L=e=>N(T)-N(e),{bases:D}=f.palette,F={A:D.A.main,C:D.C.main,G:D.G.main,T:D.T.main,insertion:"purple",softclip:"blue",hardclip:"red",total:(0,i.readConfObject)(p,"color"),mod_NONE:"blue",cpg_meth:"red",cpg_unmeth:"blue"},B=[...a.values()];e.fillStyle=F.total;let V=performance.now();for(const t of B){if("skip"===t.get("type"))continue;const[a,r]=(0,G.featureSpanPx)(t,h,n),o=r-a+.6,i=t.get("score");e.fillRect(a,R(i),o,I(i)),performance.now()-V>400&&((0,qe.SW)(g),V=performance.now())}let z=0;const H=h.reversed?1/n:0,j="modifications"===o?.type,W="methylation"===o?.type,$=o?.modifications?.isolatedModification;V=performance.now();for(const t of B){if(performance.now()-V>400&&(0,qe.SW)(g),"skip"===t.get("type"))continue;const[a,r]=(0,G.featureSpanPx)(t,h,n),o=t.get("snpinfo"),i=Math.max(r-a,1),s=t.get("score");if(j){let t=0;const r=o.refbase?.toUpperCase(),{nonmods:n,mods:c,snps:d,ref:u}=o;for(const c of Object.keys(n).sort().reverse()){const n=l[c.replace("nonmod_","")]||l[c.replace("mod_","")];if(!n){console.warn(`${c} not known yet`);continue}if($&&n.type!==$)continue;const p=_e[n.base],m="N"===n.base?s:(d[n.base]?.entryDepth||0)+(d[p]?.entryDepth||0)+(r===n.base?u[1]:0)+(r===p?u[-1]:0),g="N"===n.base?s:(d[n.base]?.entryDepth||0)+(d[p]?.entryDepth||0)+(r===n.base?u.entryDepth:0)+(r===p?u.entryDepth:0),{entryDepth:f,avgProbability:h=0}=o.nonmods[c],y=g/s*(f/m),b="blue",w=(0,O.yr)(b,h),v=I(s),C=R(s)+v;e.fillStyle=w,e.fillRect(Math.round(a),C-(t+y*v),i,y*v),t+=y*v}for(const n of Object.keys(c).sort().reverse()){const o=l[n.replace("mod_","")];if(!o){console.warn(`${n} not known yet`);continue}if($&&o.type!==$)continue;const p=_e[o.base],m="N"===o.base?s:(d[o.base]?.entryDepth||0)+(d[p]?.entryDepth||0)+(r===o.base?u[1]:0)+(r===p?u[-1]:0),g="N"===o.base?s:(d[o.base]?.entryDepth||0)+(d[p]?.entryDepth||0)+(r===o.base?u.entryDepth:0)+(r===p?u.entryDepth:0),{entryDepth:f,avgProbability:h=0}=c[n],y=g/s*(f/m),b=o.color||"black",w=(0,O.yr)(b,h),v=I(s),C=R(s)+v;e.fillStyle=w,e.fillRect(Math.round(a),C-(t+y*v),i,y*v),t+=y*v}}else if(W){const{depth:t,nonmods:r,mods:n}=o;let l=0;for(const r of Object.keys(n).sort().reverse()){const{entryDepth:o}=n[r],c=I(s),d=R(s)+c;e.fillStyle=F[r]||"black",e.fillRect(Math.round(a),d-(o+l)/t*c,i,o/t*c),l+=o}for(const n of Object.keys(r).sort().reverse()){const{entryDepth:o}=r[n],c=I(s),d=R(s)+c;e.fillStyle=F[n]||"black",e.fillRect(Math.round(a),d-(o+l)/t*c,i,o/t*c),l+=o}}else{const{depth:t,snps:r}=o;let n=0;for(const o of Object.keys(r).sort().reverse()){const{entryDepth:l}=r[o],c=I(s),d=R(s)+c;e.fillStyle=F[o]||"black",e.fillRect(Math.round(a),d-(l+n)/t*c,i,l/t*c),n+=l}}const c=Object.keys(o.noncov);if(P){let t=0;for(const r of c){const{entryDepth:n}=o.noncov[r],i=.6;e.fillStyle=F[r],e.fillRect(a-i+H,4.5+L(t),2*i,L(n)),t+=n}}if(E){let t=0,r=0,n="";for(const e of c){const{entryDepth:a}=o.noncov[e];t+=a,a>r&&(r=a,n=e)}const i=Math.max(s,z);if(t>i*x&&i>7){e.fillStyle=F[n],e.beginPath();const t=a+H;e.moveTo(t-3.5,0),e.lineTo(t+3.5,0),e.lineTo(t,4.5),e.fill()}}z=s}if(M)for(const t of B){if("skip"!==t.get("type"))continue;const a=t.get("start"),r=t.get("end"),[o,i]=(0,G.bpSpanPx)(a,r,h,n);e.beginPath();const s=t.get("effectiveStrand"),l="rgba(255,200,200,0.7)",c="rgba(200,200,255,0.7)",d="rgba(200,200,200,0.7)";e.strokeStyle=1===s?l:-1===s?c:d,e.lineWidth=Math.log(t.get("score")+1),e.moveTo(o,w-2*b),e.bezierCurveTo(o,0,i,0,i,w-2*b),e.stroke()}if(s){e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)";for(const t of m.values)e.beginPath(),e.moveTo(0,Math.round(R(t))),e.lineTo(y,Math.round(R(t))),e.stroke()}}}const Xe=(0,i.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},drawArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0},color:{type:"color",description:"Background color for the SNPCoverage renderer",defaultValue:"#d3d3d3"}},{explicitlyTyped:!0});function Ye(e){e.addRendererType((()=>new Je({name:"SNPCoverageRenderer",ReactComponent:Ce.Ep,configSchema:Xe,pluginManager:e})))}class Ke extends r.A{name="AlignmentsPlugin";install(e){[b,v,me,xe,f,Ue,T,We,Be,Ye,ye,ve,z,u,S].map((t=>{t(e)}))}}},80256:(e,t,a)=>{"use strict";a.d(t,{X:()=>o});var r=a(99546),n=a(91468);async function o({self:e,tag:t,blocks:a,opts:o}){const{rpcManager:i}=(0,r.getSession)(e),{adapterConfig:s}=e,l=(0,n.getRpcSessionId)(e);return await i.call((0,n.getRpcSessionId)(e),"PileupGetGlobalValueForTag",{adapterConfig:s,tag:t,sessionId:l,regions:a.contentBlocks,...o})}},91476:(e,t,a)=>{"use strict";a.d(t,{Ar:()=>l,CQ:()=>s,JD:()=>i,Kl:()=>u,Kt:()=>c,dv:()=>n,lE:()=>d,yr:()=>o});var r=a(87485);function n(e){for(const t of e.chains.values())if(1&t[0].flags)return!0;return!1}function o(e,t){return 1!==t?(0,r.M)(e).alpha(t*t).toHslString():e}const i={flagInclude:0,flagExclude:1540},s={flagInclude:16,flagExclude:1540},l={flagInclude:0,flagExclude:1556};function c(e,t){const a=Object.getOwnPropertyDescriptor(e.prototype,t).get;Object.defineProperty(e.prototype,t,{get(){const e=a.call(this);return Object.defineProperty(this,t,{value:e}),e}})}function d(e,t,a){return(e&t)!==t||!!(e&a)}function u(e,t){return"*"===t?void 0===e:`${e}`!=`${t}`}},86576:(e,t,a)=>{"use strict";a.d(t,{Iw:()=>d,Rs:()=>u,c$:()=>s,il:()=>l,rT:()=>m,rr:()=>c,vi:()=>p});var r=a(42489),n=a(36422),o=a(44728),i=a(82088);function s(e,t,a){const r=e.get("tags");return r[t]??r[a]}const l={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}},c={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"};async function d(e,t){const{start:a,end:r,originalRefName:n,refName:s}=e,l=await(0,o._)(t.getFeatures({...e,refName:n||s,end:r,start:a}).pipe((0,i.$)()));return l[0]?.get("seq")}const u={m:{color:"rgb(255,0,0)",name:"5mC"},h:{color:"rgb(255,0,255)",name:"5hmC"},o:{color:"rgb(111, 78, 129)",name:"8oxoG"},f:{color:"rgb(246, 200, 95)",name:"5fC"},c:{color:"rgb(157, 216, 102)",name:"5cac"},g:{color:"rgb(255, 160, 86)",name:"5hmu"},e:{color:"rgb(141, 221, 208)",name:"5fU"},b:{color:"rgb(0,100,47)",name:"5caU"},a:{color:"rgb(51,0,111)",name:"6mA"},17082:{color:"rgb(51,153,255)",name:"pseU"},17596:{color:"rgb(102,153,0)",name:"inosine"},21839:{color:"rgb(153,0,153)",name:"4mC"}};function p(e,t,a){(0,n.addDisposer)(e,(0,r.autorun)((async()=>{try{await t()}catch(t){(0,n.isAlive)(e)&&e.setError(t)}}),a))}function m(e){return u[e]?.color||function(e){let t=0;for(let a=0;a<e.length;a++)t+=e.charCodeAt(a);return`hsl(${10*t}, 20%, 50%)`}(e)}},49473:(e,t,a)=>{"use strict";a.d(t,{E6:()=>d,Ec:()=>c,Tp:()=>l,eW:()=>s,y$:()=>u});var r=a(7552),n=a(99546);const[,o,,i]=[0,1,2,3];function s(e,t,a,r){return r?r(t,a):e[a].trackRefs[t]?.getBoundingClientRect().top||0}function l(e,t,a){return(e.bpToPx({refName:t,coord:a})?.offsetPx||0)-e.offsetPx}function c(e,t,a,r,l,c){const d=r[t].displays[0],u=d.height;let p=0;const{SNPCoverageDisplay:m}=d;m&&(p=m.height);const g=c?0:d.scrollTop;return(0,n.clamp)(l[o]-g+((f=l)[i]-f[o])/2+p,0,u)+s(a,e,t,c)+d.scrollTop;var f}const d=e=>{const[,t]=(0,r.useState)();(0,r.useEffect)((()=>{t(e)}),[e])};function u(e,t=[],a=[],...r){const n=new Set(a.map((t=>e(t)))),o=t.filter((t=>n.has(e(t))));return 0===r.length?o:u(e,o,...r)}},48133:(e,t,a)=>{"use strict";a.d(t,{DO:()=>M,dg:()=>L,kO:()=>R,Ay:()=>D});var r=a(12678),n=a(99546),o=a(98450),i=a(7552),s=a(63589),l=a(68584),c=a(1622),d=a(90542),u=a(29417),p=a(64502),m=a(45465),g=a(42489),f=a(36422);function h(e,t,a,r,n){const o=Math.abs(e-a);if(o>r)return;o===r&&n.push([t,e]);const i=Math.sqrt(r*r-o*o);n.push([t-i,e],[t+i,e])}function y(e,t,a,r,n){const o=Math.abs(e-t);if(o>r)return;o===r&&n.push([e,a]);const i=Math.sqrt(r*r-o*o);n.push([e,a-i],[e,a+i])}function b(e,t){const a=Math.sqrt(e*e+t*t);if(0===a)return[0,0];const r=function(e,t){let a=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?a+=Math.PI:a-=Math.PI),a}(e,t);return[a,r]}const w=2*Math.PI;class v{constructor(e,t,a,r){this.region=t,this.offsetRadians=a,this.radianWidth=r;const{bpPerRadian:o}=e;this.key="regions"in t?JSON.stringify(t.regions):(0,n.assembleLocString)(t),this.bpPerRadian=o,this.flipped=!1,this.startRadians=a,this.endRadians=t.widthBp/this.bpPerRadian+a,Object.freeze(this)}bpToXY(e,t){let a;a=this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start;const r=a/this.bpPerRadian+this.offsetRadians;return(0,n.polarToCartesian)(t,r)}toJSON(){return Object.fromEntries(Object.entries(this))}}const C=(0,i.lazy)((()=>a.e(5243).then(a.bind(a,15243)))),S=function(e){return f.types.compose("CircularView",c.BaseViewModel,f.types.model({type:f.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:200,tracks:f.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:f.types.optional(f.types.number,400),displayedRegions:f.types.optional(f.types.frozen(),[]),scrollX:0,scrollY:0,minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,trackSelectorType:"hierarchical"})).volatile((()=>({volatileWidth:void 0,error:void 0}))).views((e=>({get width(){if(void 0===e.volatileWidth)throw new Error("wait for view to be initialized first before accessing width");return e.volatileWidth},get visibleSection(){const{scrollX:t,scrollY:a,width:r,height:n}=e;return function(e,t,a){let[r,n,o,i]=e;const[s,l]=t;if(r-=s,n-=s,o-=l,i-=l,r<0&&n>0&&o<0&&i>0){const e=[[r,o],[n,o],[r,i],[n,i]];let t=Number.NEGATIVE_INFINITY;for(const[a,r]of e){const e=Math.sqrt(a*a+r*r);e>t&&(t=e)}return{rho:[0,Math.min(a,t)],theta:[0,2*Math.PI]}}const c=[[r,o],[n,o],[r,i],[n,i]];y(r,0,0,a,c),y(n,0,0,a,c),h(o,0,0,a,c),h(i,0,0,a,c),-r<a&&c.push([r,0]),n<a&&c.push([n,0]),-o<a&&c.push([0,o]),i<a&&c.push([0,i]);const d=r>=0?-1:1;let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(const[e,t]of c)if(e>=r&&e<=n&&t>=o&&t<=i){const[r,n]=b(e*d,t*d);r<=a+.001&&(n<m&&r>1e-4&&(m=n),n>g&&r>1e-4&&(g=n),r<u&&(u=r),r>p&&(p=r))}return-1===d&&(m+=Math.PI,g+=Math.PI),m>2*Math.PI&&g>2*Math.PI&&(m-=2*Math.PI,g-=2*Math.PI),{rho:[u,Math.min(a,p)],theta:[m,g]}}([t,t+r,a,a+n],this.centerXY,this.radiusPx)},get circumferencePx(){let t=0;for(const e of this.elidedRegions)t+=e.widthBp;return t/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){let t=0;for(const a of e.displayedRegions)t+=a.end-a.start;return t},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){const t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){const e=2*Math.PI*this.maximumRadiusPx;return(0,n.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){const t=[];e.displayedRegions.forEach((a=>{const r=a.end-a.start;if(r/e.bpPerPx<e.minVisibleWidth){const e=t.at(-1);e?.elided?(e.regions.push({...a}),e.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[{...a}]})}else t.push({...a,widthBp:r,elided:!1})}));for(let e=0;e<t.length;e+=1){const a=t[e];a.elided&&1===a.regions.length&&(t[e]={...a,...a.regions[0],elided:!1})}return t},get assemblyNames(){const t=[];return e.displayedRegions.forEach((e=>{t.includes(e.assemblyName)||t.push(e.assemblyName)})),t},get initialized(){const{assemblyManager:t}=(0,n.getSession)(e);return void 0!==e.volatileWidth&&this.assemblyNames.every((e=>t.get(e)?.initialized))}}))).views((e=>({get staticSlices(){return function(e){const t=[];let a=0;const{bpPerRadian:r,spacingPx:n,pxPerRadian:o}=e;for(const i of e.elidedRegions){const s=i.widthBp/r+n/o;t.push(new v(e,i,a,s)),a+=s}return t}(e)}}))).views((e=>({get visibleStaticSlices(){return e.staticSlices.filter((t=>function(e,t){const{theta:[a,r]}=e.visibleSection;return n=t.offsetRadians+e.offsetRadians,i=a,s=r-a,!((o=t.radianWidth)<=0||s<=0)&&(o+1e-4>=w||s+1e-4>=w||(n=(n%w+w)%w+w)<(i=(i%w+w)%w+w)+s&&n+o>i||n<(i-=w)+s&&n+o>i||n<(i+=w+w)+s&&n+o>i);var n,o,i,s}(e,t)))}}))).actions((t=>({setWidth:e=>(t.volatileWidth=Math.max(e,100),t.volatileWidth),setHeight:e=>(t.height=Math.max(e,40),t.height),resizeHeight(e){const a=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-a},resizeWidth(e){const a=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-a},rotateClockwiseButton(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise(e=.17){t.offsetRadians+=e},rotateCounterClockwise(e=.17){t.offsetRadians-=e},zoomInButton(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx(e){t.bpPerPx=(0,n.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},setDisplayedRegions(e){const a=0===t.displayedRegions.length;t.displayedRegions=(0,f.cast)(e),a?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector(){if("hierarchical"===t.trackSelectorType){const e=(0,n.getSession)(t);if((0,n.isSessionModelWithWidgets)(e)){const a=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(a),a}}throw new Error(`invalid track selector type ${t.trackSelectorType}`)},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setError(e){t.error=e},showTrack(a,r={}){const n=e.pluggableConfigSchemaType("track"),o=(0,f.resolveIdentifier)(n,(0,f.getRoot)(t),a),i=e.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=o.displays.find((e=>l.has(e.type))),d=i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:c.type,configuration:c}]});t.tracks.push(d)},addTrackConf(a,r={}){const{type:n}=a,o=(0,l.readConfObject)(a,"name"),i=e.getTrackType(n);if(!i)throw new Error(`unknown track type ${n}`);const s=e.getViewType(t.type),c=new Set(s.displayTypes.map((e=>e.name))),d=a.displays.find((e=>c.has(e.type)));t.tracks.push(i.stateModel.create({...r,name:o,type:n,configuration:a,displays:[{type:d.type,configuration:d}]}))},hideTrack(a){const r=e.pluggableConfigSchemaType("track"),n=(0,f.resolveIdentifier)(r,(0,f.getRoot)(t),a),o=t.tracks.filter((e=>e.configuration===n));return(0,g.transaction)((()=>{o.forEach((e=>t.tracks.remove(e)))})),o.length},toggleFitToWindowLock(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow},async exportSvg(e={}){const{renderToSvg:r}=await a.e(311).then(a.bind(a,60311)),n=await r(t,e),o=new Blob([n],{type:"image/svg+xml"});(0,m.saveAs)(o,e.filename||"image.svg")}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{e.setDisplayedRegions([])},icon:u.A},{label:"Export SVG",icon:p.A,onClick:()=>{(0,n.getSession)(e).queueDialog((t=>[C,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:d.xU}]})))};var k=a(68446);const T=(0,k.observer)((function({model:e}){const{renderProps:{radius:t},error:a}=e;return i.createElement("g",null,i.createElement("defs",null,i.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},i.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}}))),i.createElement("circle",{cx:"0",cy:"0",r:t,fill:"#ffb4b4"}),i.createElement("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),i.createElement("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},String(a)))})),x=T,A=(0,a(75785).n9)()((e=>{const{primary:t,secondary:a,tertiary:r,quaternary:n}=e.palette;return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash 1.4s ease-in-out infinite, $colors 5.6s ease-in-out infinite"},"@keyframes colors":{"0%":{stroke:t.light},"25%":{stroke:a.light},"50%":{stroke:r.light},"75%":{stroke:n.light},"100%":{stroke:t.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}})),P=(0,k.observer)((function({model:{renderProps:{radius:e}}}){const{classes:t}=A(),[a,r]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{const e=setTimeout((()=>{r(!0)}),400);return()=>{clearTimeout(e)}})),a?i.createElement("g",null,i.createElement("defs",null,i.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},i.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}}))),i.createElement("circle",{cx:"0",cy:"0",r:e,fill:"#f1f1f1"}),i.createElement("circle",{cx:"0",cy:"0",r:e,fill:"url(#diagonalHatch)"}),i.createElement("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},"Loading"),i.createElement("circle",{className:t.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})):null})),M=(0,k.observer)((function({display:e}){return e.error?i.createElement(x,{model:e}):e.filled?e.reactElement:i.createElement(P,{model:e})}));var E=a(91468);const R=(0,l.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"});function I(e){const t=(0,n.getContainingView)(e),{rendererType:a}=e,{rpcManager:r}=(0,n.getSession)(t);return{rendererType:a,rpcManager:r,renderProps:e.renderProps(),renderArgs:{assemblyName:t.displayedRegions[0].assemblyName,adapterConfig:structuredClone(e.adapterConfig),rendererType:a.name,regions:structuredClone(t.displayedRegions),blockDefinitions:e.blockDefinitions,sessionId:(0,E.getRpcSessionId)(e),timeout:1e6}}}async function N(e,t){if(!e)throw new Error("cannot render with no props");const{rendererType:a,rpcManager:r,cannotBeRenderedReason:n,renderArgs:o,renderProps:i,exportSVG:s}=e;if(n)return{message:n};if(!i.radius||!o.regions?.length)return{message:"Skipping render"};const{html:l,...c}=await a.renderInClient(r,{...o,...i,exportSVG:s,stopToken:t});return{html:l,data:c,reactElement:c.reactElement,renderingComponent:a.ReactComponent}}const L=f.types.compose("BaseChordDisplay",c.BaseDisplay,f.types.model({bezierRadiusRatio:.1,assemblyName:f.types.maybe(f.types.string),configuration:(0,l.ConfigurationReference)(R)})).volatile((()=>({filled:!1,reactElement:void 0,data:void 0,html:void 0,message:"",renderingComponent:void 0,refNameMap:void 0}))).actions((e=>{const{pluginManager:t}=(0,n.getEnv)(e),a=e;return{onChordClick(r){(0,l.getConf)(e,"onChordClick",{feature:r,track:a,pluginManager:t})}}})).views((e=>({get blockDefinitions(){const t=(0,n.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;const a=structuredClone(t);for(const t of a){const a=t.region.elided?t.region.regions:[t.region];for(const t of a){const a=e.refNameMap[t.refName];a&&t.refName!==a&&(t.refName=a)}}return a},renderProps(){const t=(0,n.getContainingView)(e);return{...(0,E.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick}},get rendererType(){return(0,n.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName)},get selectedFeatureId(){if(!(0,f.isAlive)(e))return;const{selection:t}=(0,n.getSession)(e);return(0,n.isFeature)(t)?t.id():void 0}}))).actions((e=>({renderStarted(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess({message:t,data:a,reactElement:r,html:n,renderingComponent:o}){t?(e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=r,e.data=a,e.html=n,e.error=void 0,e.renderingComponent=o)},renderError(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.html=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap(t){e.refNameMap=t}}))).actions((e=>({afterAttach(){(0,n.makeAbortableReaction)(e,I,N,{name:`${e.type} ${e.id} rendering`,fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,n.makeAbortableReaction)(e,(()=>({assemblyNames:(0,E.getTrackAssemblyNames)(e.parentTrack),adapter:(0,l.getConf)((0,f.getParent)(e,2),"adapter"),assemblyManager:(0,n.getSession)(e).assemblyManager})),(async(t,a)=>t?t.assemblyManager.getRefNameMapForAdapter(t.adapter,t.assemblyNames[0],{stopToken:a,sessionId:(0,E.getRpcSessionId)(e)}):void 0),{name:`${e.type} ${e.id} getting refNames`,fireImmediately:!0},(()=>{}),(t=>{t&&e.setRefNameMap(t)}),(t=>{console.error(t),e.setError(t)}))}}))).views((e=>({async renderSvg(t){const a=I(e),r=await N({...a,exportSVG:t,theme:t.theme||a.renderProps.theme});return i.createElement(n.ReactRendering,{rendering:r})}})));class D extends r.A{name="CircularViewPlugin";install(e){!function(e){e.addViewType((()=>new s.A({ReactComponent:(0,i.lazy)((()=>a.e(6205).then(a.bind(a,66205)))),stateModel:S(e),name:"CircularView",displayName:"Circular view"})))}(e),function(e){e.addToExtensionPoint("LaunchView-CircularView",(async({session:e,assembly:t,tracks:a=[]})=>{const{assemblyManager:r}=e,n=e.addView("CircularView",{});if(await(0,g.when)((()=>n.initialized)),!t)throw new Error("No assembly provided when launching circular genome view");const o=await r.waitForAssembly(t);if(!o)throw new Error(`Assembly "${t}" not found when launching circular genome view`);n.setDisplayedRegions(o.regions||[]),a.forEach((e=>{n.showTrack(e)}))}))}(e)}configure(e){(0,n.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:o.A,onClick:e=>{e.addView("CircularView",{})}})}}},59099:(e,t,a)=>{"use strict";a.d(t,{S:()=>w,A:()=>v});var r=a(7552),n=a(12678),o=a(68584),i=a(58921),s=a(68446),l=a(36422);const c=(0,s.observer)((function({model:e}){if(e?.target){if(e.target.type)return`${e.target.type} settings`;if((0,l.isStateTreeNode)(e.target)){const t=(0,l.getType)(e.target);if(t.name)return`${t.name.replace("ConfigurationSchema","")} settings`}}return r.createElement(r.Fragment,null,"Settings")}));var d=a(8832);function u(e){return l.types.model("ConfigurationEditorWidget",{id:d.ElementId,type:l.types.literal("ConfigurationEditorWidget"),target:l.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((e=>({setTarget(t){e.target=t}})))}const p=(0,o.ConfigurationSchema)("ConfigurationEditorWidget",{}),m=(0,r.lazy)((()=>Promise.all([a.e(3011),a.e(3814),a.e(6395),a.e(7874)]).then(a.bind(a,57874)))),g=(0,o.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),f=(0,o.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),h=(0,o.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),y=(0,o.ConfigurationSchema)("NcbiSequenceReportAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/sequence_report.tsv",locationType:"UriLocation"}},useUcscNameOverride:{type:"boolean",defaultValue:!0,description:"forces usage of the UCSC names over the NCBI style names from a FASTA"}},{explicitlyTyped:!0}),b=(0,o.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0}},{explicitlyTyped:!0}),w=(0,r.lazy)((()=>Promise.all([a.e(3011),a.e(3814),a.e(6395),a.e(7874)]).then(a.bind(a,57874))));class v extends n.A{name="ConfigurationPlugin";install(e){!function(e){e.addAdapterType((()=>new i.AdapterType({name:"FromConfigAdapter",configSchema:g,getAdapterClass:()=>a.e(6833).then(a.bind(a,86833)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addAdapterType((()=>new i.AdapterType({name:"FromConfigRegionsAdapter",configSchema:f,getAdapterClass:()=>a.e(491).then(a.bind(a,80491)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addAdapterType((()=>new i.AdapterType({name:"FromConfigSequenceAdapter",configSchema:h,getAdapterClass:()=>a.e(7013).then(a.bind(a,97013)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addAdapterType((()=>new i.AdapterType({name:"RefNameAliasAdapter",configSchema:b,getAdapterClass:()=>a.e(2249).then(a.bind(a,92249)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addWidgetType((()=>new i.WidgetType({name:"ConfigurationEditorWidget",HeadingComponent:c,configSchema:p,stateModel:u(e),ReactComponent:m})))}(e),function(e){e.addAdapterType((()=>new i.AdapterType({name:"NcbiSequenceReportAliasAdapter",configSchema:y,getAdapterClass:()=>a.e(3175).then(a.bind(a,43175)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e)}}},69426:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(7552),n=a(68584),o=a(58921),i=a(8832),s=a(36422);const l=s.types.model("AddConnectionModel",{id:i.ElementId,type:s.types.literal("AddConnectionWidget")}),c=(0,n.ConfigurationSchema)("AddConnectionWidget",{});function d(e){e.addWidgetType((()=>new o.WidgetType({name:"AddConnectionWidget",heading:"Add a connection",configSchema:c,stateModel:l,ReactComponent:(0,r.lazy)((()=>Promise.all([a.e(5189),a.e(7691)]).then(a.bind(a,7691))))})))}},62367:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var r=a(7552),n=a(68584),o=a(58921),i=a(91468),s=a(8832),l=a(36422);function c(e=""){try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function d(e){return l.types.model("AddTrackModel",{id:s.ElementId,type:l.types.literal("AddTrackWidget"),view:l.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((()=>({trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0}))).actions((e=>({setAdapterHint(t){e.adapterHint=t},setTrackSource(t){e.trackSource=t},setTextIndexingConf(t){e.textIndexingConf=t},setTextIndexTrack(t){e.textIndexTrack=t},setTrackData(t){e.trackData=t},setIndexTrackData(t){e.indexTrackData=t},setAssembly(t){e.altAssemblyName=t},setTrackName(t){e.altTrackName=t},setTrackType(t){e.altTrackType=t},clearData(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0,e.textIndexingConf=void 0,e.textIndexTrack=!0}}))).views((e=>({get trackAdapter(){const{trackData:t,indexTrackData:a,adapterHint:r}=e;return t?(0,i.guessAdapter)(t,a,r,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,i.getFileName)(e.trackData):"")},get isFtp(){const{trackData:t,indexTrackData:a}=e;return!(!a?.uri?.startsWith("ftp://")&&!t?.uri?.startsWith("ftp://"))},get isRelativeTrackUrl(){const t=e.trackData?.uri;return!!t&&!c(t)},get isRelativeIndexUrl(){const t=e.indexTrackData?.uri;return!!t&&!c(t)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){return e.trackData?.uri?.startsWith("http://")},get indexHttp(){return e.indexTrackData?.uri?.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){return this.trackAdapter?.type===i.UNSUPPORTED},get assembly(){return e.altAssemblyName||e.view.assemblyNames?.[0]},get trackType(){return e.altTrackType||(this.trackAdapter?(0,i.guessTrackType)(this.trackAdapter.type,e):"")}}))).views((e=>({get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}})))}const u=(0,n.ConfigurationSchema)("AddTrackWidget",{});function p(e){e.addWidgetType((()=>new o.WidgetType({name:"AddTrackWidget",heading:"Add a track",configSchema:u,stateModel:d(e),ReactComponent:(0,r.lazy)((()=>Promise.all([a.e(5189),a.e(8008),a.e(8704)]).then(a.bind(a,58704))))})))}},6842:(e,t,a)=>{"use strict";function r(e,t){return`${(e.startsWith("metadata.")?t.metadata?.[e.replace("metadata.","")]:t[e])||""}`}a.d(t,{a:()=>r})},68384:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>E});var r=a(7552),n=a(58921),o=a(68584);const i=(0,o.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{});var s=a(99546),l=a(8832),c=a(42489),d=a(36422),u=a(91468),p=a(6842);function m(e,t,a){return e.filter((e=>t.map((t=>a(t,e))).filter((e=>!!e)).length>5))}function g(e=[],t=[]){if(e[0]===t[0])return!0;{const a=new Set(e);return t.some((e=>a.has(e)))}}function f(e,t,a){const r=(0,o.readConfObject)(t,"category")||[],n=e.toLowerCase();return(0,u.getTrackName)(t,a).toLowerCase().includes(n)||!!r.filter((e=>e.toLowerCase().includes(n))).length}function h(e,t,a=0){let r=!1;for(const n of e)n.children.length?h(n.children,t,a+1)&&a>0&&t.push(n.id):r=!0;return r}function y(e,t){for(const a of e)a.children.length&&t.push(a.id)}const b=["category","adapter","description"];function w(e,t){const{assemblyManager:a}=(0,s.getSession)(t),{pluginManager:r}=(0,s.getEnv)(t),{view:n}=t;if(!n)return[];const i=t.assemblyNames.map((e=>a.get(e))).filter(s.notEmpty);return e.filter((e=>{const t=(0,o.readConfObject)(e,"assemblyNames"),r=t?.map((e=>a.get(e))).filter(s.notEmpty);return n.trackSelectorAnyOverlap?g(r,i):function(e=[],t=[]){const a=new Set(e);return t.every((e=>a.has(e)))}(r,i)})).filter((e=>{const{displayTypes:t}=r.getViewType(n.type);return g(t.map((e=>e.name)),e.displays.map((e=>e.type)))}))}function v({model:e,trackConfs:t,extra:a,noCategories:r,menuItems:n}){const i={children:[]},{collapsed:l,filterText:c,activeSortTrackNames:d,activeSortCategories:p,view:m}=e;if(!m)return[];const g=(0,s.getSession)(e),h=m.tracks,y=t.filter((e=>f(c,e,g)));for(const e of function(e,t,a){const r=e.map((e=>[e,(0,o.readConfObject)(e,"name"),(0,o.readConfObject)(e,"category")?.[0]||"",(0,o.readConfObject)(e,"category")?.[1]||"",(0,o.readConfObject)(e,"category")?.[2]||""]));return t&&r.sort(((e,t)=>e[1].localeCompare(t[1]))),a&&r.sort(((e,t)=>e[2]!==t[2]?e[2].localeCompare(t[2]):e[3]!==t[3]?e[3].localeCompare(t[3]):e[4]!==t[4]?e[4].localeCompare(t[4]):0)),r.map((e=>e[0]))}(y,d,p)){const t=[...(0,o.readConfObject)(e,"category")||[]];e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");let s=i;if(!r)for(let e=0;e<t.length;e++){const r=t[e],o=s.children.find((e=>e.name===r)),i=[a,t.slice(0,e+1).join(",")].filter((e=>!!e)).join("-");if(o)s=o;else{const e={children:[],name:r,id:i,isOpenByDefault:!l.get(i),menuItems:n,type:"category"};s.children.push(e),s=e}}const c=s.children.findIndex((e=>e.children.length)),d=-1===c?s.children.length:c;s.children.splice(d,0,{id:[a,e.trackId].filter((e=>!!e)).join(","),trackId:e.trackId,name:(0,u.getTrackName)(e,g),conf:e,checked:h.some((t=>t.configuration===e)),children:[],type:"track"})}return i.children}function C(){return"undefined"!=typeof window?[window.location.pathname,new URLSearchParams(window.location.search).get("config")].filter((e=>!!e)).join("-"):"empty"}function S(e){return["recentlyUsedTracks",C(),e.join(",")].filter((e=>!!e)).join("-")}function k(){return`favoriteTracks-${C()}}`}function T(e,t){return["collapsedCategories",C(),e.join(","),t].join("-")}function x(e,t){const a=(0,s.localStorageGetItem)(e);return null!=a&&a?JSON.parse(a):t}function A(e,t){null!=t&&(0,s.localStorageSetItem)(e,JSON.stringify(t))}const P=10;function M(e){return d.types.model("HierarchicalTrackSelectorWidget",{id:l.ElementId,type:d.types.literal("HierarchicalTrackSelectorWidget"),view:d.types.safeReference(e.pluggableMstType("view","stateModel")),faceted:d.types.optional(d.types.model("FacetedModel",{filterText:d.types.optional(d.types.string,""),showSparse:d.types.optional(d.types.boolean,(()=>JSON.parse((0,s.localStorageGetItem)("facet-showSparse")||"false"))),showFilters:d.types.optional(d.types.boolean,(()=>JSON.parse((0,s.localStorageGetItem)("facet-showFilters")||"true"))),showOptions:d.types.optional(d.types.boolean,(()=>JSON.parse((0,s.localStorageGetItem)("facet-showTableOptions")||"false"))),panelWidth:d.types.optional(d.types.number,(()=>JSON.parse((0,s.localStorageGetItem)("facet-panelWidth")||"400")))}).volatile((()=>({visible:{},useShoppingCart:!1,filters:c.observable.map()}))).actions((e=>({setFilter(t,a){e.filters.set(t,a)},setPanelWidth:t=>(e.panelWidth=t,e.panelWidth),setUseShoppingCart(t){e.useShoppingCart=t},setFilterText(t){e.filterText=t},setShowSparse(t){e.showSparse=t},setShowOptions(t){e.showOptions=t},setShowFilters(t){e.showFilters=t}}))).views((e=>({get allTrackConfigurations(){return(0,d.getParent)(e).allTrackConfigurations}}))).views((e=>({get rows(){const t=(0,s.getSession)(e),{allTrackConfigurations:a,filterText:r}=e;return a.filter((e=>f(r,e,t))).map((e=>({id:e.trackId,conf:e,name:(0,u.getTrackName)(e,t),category:(0,o.readConfObject)(e,"category")?.join(", "),adapter:(0,o.readConfObject)(e,"adapter")?.type,description:(0,o.readConfObject)(e,"description"),metadata:(0,o.readConfObject)(e,"metadata")})))}}))).views((e=>({get filteredNonMetadataKeys(){return e.showSparse?b:m(b,e.rows,((e,t)=>e[t]))},get metadataKeys(){return[...new Set(e.rows.flatMap((e=>{return t=e.metadata,Object.entries(t).map((([e,t])=>"string"==typeof t?e:"")).filter((e=>!!e));var t})))]},get filteredMetadataKeys(){return e.showSparse?this.metadataKeys:m(this.metadataKeys,e.rows,((e,t)=>e.metadata[t]))},get fields(){return["name",...this.filteredNonMetadataKeys,...this.filteredMetadataKeys.map((e=>`metadata.${e}`))]},get filteredRows(){const t=[...e.filters.entries()].filter((e=>e[1].length>0)).map((([e,t])=>[e,new Set(t)]));return e.rows.filter((e=>t.every((([t,a])=>a.has((0,p.a)(t,e))))))}}))).actions((e=>({setVisible(t){e.visible=t},afterAttach(){(0,d.addDisposer)(e,(0,c.autorun)((()=>{this.setVisible(Object.fromEntries(e.fields.map((e=>[e,!0]))))})))}}))),{})}).volatile((()=>({favorites:x(k(),[]),recentlyUsed:[],selection:[],sortTrackNames:x("sortTrackNames",void 0),sortCategories:x("sortCategories",void 0),collapsed:c.observable.map(),filterText:"",recentlyUsedCounter:0,favoritesCounter:0}))).views((e=>({get shownTrackIds(){return new Set(e.view?.tracks?.map((e=>e.configuration.trackId)))},get selectionSet(){return new Set(e.selection)},get favoritesSet(){return new Set(e.favorites)},get recentlyUsedSet(){return new Set(e.recentlyUsed)},get assemblyNames(){return e.view?.assemblyNames||[]}}))).actions((e=>({setSortTrackNames(t){e.sortTrackNames=t},setSortCategories(t){e.sortCategories=t},setSelection(t){e.selection=t},addToSelection(t){e.selection=(0,s.dedupe)([...e.selection,...t],(e=>e.trackId))},removeFromSelection(t){const a=new Set(t);e.selection=e.selection.filter((e=>!a.has(e)))},clearSelection(){e.selection=[]},addToFavorites(t){e.favoritesCounter+=1,e.favorites=[...e.favorites,t]},removeFromFavorites(t){e.favorites=e.favorites.filter((e=>e!==t))},clearFavorites(){e.favorites=[]},setRecentlyUsedCounter(t){e.recentlyUsedCounter=t},setRecentlyUsed(t){e.recentlyUsed=t},setFavorites(t){e.favorites=t},setFavoritesCounter(t){e.favoritesCounter=t},addToRecentlyUsed(t){e.recentlyUsed.includes(t)||(e.recentlyUsedCounter=Math.min(e.recentlyUsedCounter+1,P),e.recentlyUsed=e.recentlyUsed.length>=P?[...e.recentlyUsed.slice(1),t]:[...e.recentlyUsed,t])},clearRecentlyUsed(){e.recentlyUsed=[]},setView(t){e.view=t},toggleCategory(t){e.collapsed.set(t,!e.collapsed.get(t))},setCategoryCollapsed(t,a){e.collapsed.set(t,a)},expandAllCategories(){e.collapsed.clear()},setCollapsedCategories(t){e.collapsed.replace(t)},clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}}))).views((t=>({isSelected:e=>t.selectionSet.has(e),isFavorite:e=>t.favoritesSet.has(e),isRecentlyUsed:e=>t.recentlyUsedSet.has(e),getRefSeqTrackConf(a){const{assemblyManager:r}=(0,s.getSession)(t),n=r.get(a),o=n?.configuration.sequence,i=e.getViewType(t.view.type);if(o)for(const e of o.displays)if(i.displayTypes.some((t=>t.name===e.type)))return o}}))).views((e=>({get activeSortTrackNames(){return e.sortTrackNames??(0,o.getConf)((0,s.getSession)(e),["hierarchical","sort","trackNames"])},get activeSortCategories(){return e.sortCategories??(0,o.getConf)((0,s.getSession)(e),["hierarchical","sort","categories"])},get configAndSessionTrackConfigurations(){return[...e.assemblyNames.map((t=>e.getRefSeqTrackConf(t))),...w((0,s.getSession)(e).tracks,e)].filter(s.notEmpty)},get allTrackConfigurations(){const{connectionInstances:t=[]}=(0,s.getSession)(e);return[...this.configAndSessionTrackConfigurations,...t.flatMap((e=>e.tracks))]},get allTrackConfigurationTrackIdSet(){return new Map(this.allTrackConfigurations.map((e=>[e.trackId,e])))}}))).views((e=>({get favoriteTracks(){return e.favorites.filter((t=>e.allTrackConfigurationTrackIdSet.has(t))).map((t=>e.allTrackConfigurationTrackIdSet.get(t)))},get recentlyUsedTracks(){return e.recentlyUsed.filter((t=>e.allTrackConfigurationTrackIdSet.has(t))).map((t=>e.allTrackConfigurationTrackIdSet.get(t)))}}))).views((e=>({get allTracks(){const{connectionInstances:t=[]}=(0,s.getSession)(e);return[{group:"Tracks",tracks:e.configAndSessionTrackConfigurations,noCategories:!1,menuItems:[]},...t.flatMap((e=>({group:(0,o.getConf)(e,"name"),tracks:e.tracks,noCategories:!1,menuItems:[]})))]}}))).views((e=>({get hierarchy(){return{name:"Root",id:"Root",isOpenByDefault:!0,type:"category",children:e.allTracks.map((t=>({name:t.group,id:t.group,type:"category",isOpenByDefault:!e.collapsed.get(t.group),menuItems:t.menuItems,children:v({model:e,trackConfs:t.tracks,extra:t.group,noCategories:t.noCategories})})))}}}))).actions((e=>({collapseSubCategories(){const t=[];h(e.hierarchy.children,t);for(const a of t)e.setCategoryCollapsed(a,!0)},collapseTopLevelCategories(){const t=[];for(const a of e.hierarchy.children)a.children.length&&y(a.children,t);for(const a of t)e.setCategoryCollapsed(a,!0)}}))).views((e=>({get hasAnySubcategories(){return e.allTracks.some((e=>e.tracks.some((e=>(0,o.readConfObject)(e,"category")?.length>1))))}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,c.autorun)((()=>{const{assemblyNames:t,view:a}=e;if(e.setRecentlyUsed(x(S(t),[])),a){const r=x(T(t,a.type),void 0),n=["hierarchical","defaultCollapsed"],i=(0,s.getSession)(e);if(r)e.setCollapsedCategories(r);else{e.expandAllCategories(),(0,o.getConf)(i,[...n,"topLevelCategories"])&&e.collapseTopLevelCategories(),(0,o.getConf)(i,[...n,"subCategories"])&&e.collapseSubCategories();for(const t of(0,o.getConf)(i,[...n,"categoryNames"]))e.setCategoryCollapsed(`Tracks-${t}`,!0)}}}))),(0,d.addDisposer)(e,(0,c.autorun)((()=>{const{sortTrackNames:t,sortCategories:a,favorites:r,recentlyUsed:n,assemblyNames:o,collapsed:i,view:s}=e;A(S(o),n),A(k(),r),A("sortTrackNames",t),A("sortCategories",a),s&&A(T(o,s.type),i)})))}})))}function E(e){e.addWidgetType((()=>new n.WidgetType({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:i,stateModel:M(e),ReactComponent:(0,r.lazy)((()=>Promise.all([a.e(1848),a.e(5331)]).then(a.bind(a,25331))))})))}},679:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(7552),n=a(68584),o=a(58921),i=a(8832),s=a(36422);function l(e){return s.types.model("PluginStoreModel",{id:i.ElementId,type:s.types.literal("PluginStoreWidget"),filterText:"",view:s.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((e=>({clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}})))}const c=(0,n.ConfigurationSchema)("PluginStoreWidget",{});function d(e){e.addWidgetType((()=>new o.WidgetType({name:"PluginStoreWidget",heading:"Plugin store",configSchema:c,stateModel:l(e),ReactComponent:(0,r.lazy)((()=>Promise.all([a.e(3011),a.e(4094)]).then(a.bind(a,74094))))})))}},31756:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(58921),n=a(68584),o=a(1622);const i=(0,n.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:o.baseConnectionConfig});var s=a(36422);function l(e){return s.types.compose("UCSCTrackHubConnection",(0,o.BaseConnectionModelFactory)(e),s.types.model({configuration:(0,n.ConfigurationReference)(i),type:s.types.literal("UCSCTrackHubConnection")})).actions((e=>({async connect(){const{doConnect:t}=await a.e(4944).then(a.bind(a,44944));t(e)}})))}function c(e){e.addConnectionType((()=>new r.ConnectionType({name:"UCSCTrackHubConnection",configSchema:i,stateModel:l(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"https://genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})))}},90257:(e,t,a)=>{"use strict";function r(e,t,a=!0){const{assemblyName:r,refName:n,start:o,offset:i,oob:s}=t.pxToBp(e),l=Math.floor(o+i);return s?"out of bounds":`${a?`{${r}}`:""}${n}:${l.toLocaleString("en-US")}`}function n(e,t,a){const r=new Set,n=[...e].sort(((e,t)=>{const a=e.end-e.start;return t.end-t.start-a})),o=Array.from({length:Math.round(t)});for(const{key:e,offsetPx:i}of n){const n=Math.round(t-i+a),s=[Math.max(n-12,0),n];0===n||o.slice(...s).some(Boolean)?r.add(e):o.fill(!0,...s)}return r}function o(e,t,a=!0,r=!0){const n=[],o=function(e){const t=60*(e=Math.abs(e));let a=10**+Number(t).toExponential().split(/e/i)[1];for(;a<t&&(a*=2,!(a>=t));)a*=2.5;a=Math.max(a,5);const r=a/e;let n=0;return!(a%10)&&r/10>=15?n=a/10:!(a%5)&&r/5>=15?n=a/5:!(a%2)&&r/2>=15&&(n=a/2),{majorPitch:a,minorPitch:n}}(t),i=o.minorPitch||o.majorPitch;for(const{start:t,end:s,refName:l}of e){let e=0;const c=t,d=s;for(let s=Math.floor(c/i)*i;s<Math.ceil(d/i)*i+1;s+=i)r&&s%o.majorPitch?(n.push({type:"minor",base:s-1,index:e,refName:l}),e+=1):a&&Math.abs(s-t)>o.minorPitch&&(n.push({type:"major",base:s-1,index:e,refName:l}),e+=1)}return n}a.d(t,{H2:()=>o,rQ:()=>n,wJ:()=>r})},42752:(e,t,a)=>{"use strict";a.d(t,{$G:()=>i,Db:()=>s,fK:()=>l});var r=a(7552),n=a(68446);const o=(0,a(75785).n9)()((e=>({contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.disabled},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}))),i=(0,n.observer)((function({block:e,children:t}){const{classes:a}=o(),{widthPx:n}=e;return r.createElement("div",{style:{width:n},className:a.contentBlock},t)}));function s({width:e}){const{classes:t}=o();return r.createElement("div",{className:t.elidedBlock,style:{width:e}})}function l({boundary:e,width:t,style:a={}}){const{classes:n}=o();return r.createElement("div",{style:{...a,width:t},className:e?n.boundaryPaddingBlock:n.interRegionPaddingBlock})}},37205:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(7552),n=a(9937),o=a(89003);const i=(0,a(75785).n9)()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"}});function s({message:e,severity:t,action:a}){const{classes:s}=i();return r.createElement(n.A,{onClick:e=>{e.stopPropagation()},severity:t,action:a,classes:{message:s.ellipses}},r.createElement(o.A,{title:e},r.createElement("div",null,e)))}},2286:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(7552),n=a(68584),o=a(49823),i=a(9236),s=a(68446);const l=r.forwardRef((function({message:e},t){return r.createElement("div",{ref:t},r.isValidElement(e)?e:e?r.createElement(o.SanitizedHTML,{html:String(e)}):null)})),c=(0,s.observer)((function({model:e,clientMouseCoord:t}){const{featureUnderMouse:a}=e,o=t[0]+15,s=t[1],c=a?(0,n.getConf)(e,"mouseover",{feature:a}):void 0;return a&&c?r.createElement(i.A,{clientPoint:{x:o,y:s}},r.createElement(l,{message:c})):null}))},66344:(e,t,a)=>{"use strict";a.d(t,{A:()=>b,s:()=>w});var r=a(68584),n=a(99546),o=a(37347),i=a(91468),s=a(92516),l=a(36422),c=a(7552),d=a(49823),u=a(68446),p=a(75785),m=a(37205);const g=(0,c.lazy)((()=>Promise.all([a.e(1631),a.e(1612)]).then(a.bind(a,81612)))),f=(0,p.n9)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}})),h=(0,u.observer)((({model:e})=>{const{classes:t}=f(),{status:a}=e,{message:r}=(0,l.getParent)(e,2),n=r||a;return c.createElement("div",{className:t.loading},c.createElement(d.LoadingEllipses,{message:n}))})),y=(0,u.observer)((function({model:e}){return e.error?c.createElement(c.Suspense,{fallback:null},c.createElement(g,{model:e})):e.message?c.isValidElement(e.message)?e.message:c.createElement(m.A,{message:`${e.message}`,severity:"info"}):e.filled?e.reactElement:c.createElement(h,{model:e})})),b=l.types.model("BlockState",{key:l.types.string,region:l.types.frozen(),reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((()=>({stopToken:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:y,renderProps:void 0}))).actions((e=>({doReload(){e.reloadFlag=e.reloadFlag+1},afterAttach(){const t=(0,n.getContainingDisplay)(e);setTimeout((()=>{(0,l.isAlive)(e)&&(0,n.makeAbortableReaction)(e,w,v,{name:`${t.id}/${(0,n.assembleLocString)(e.region)} rendering`,delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)}),t.renderDelay)},setStatus(t){e.status=t},setLoading(t){void 0!==e.stopToken&&(0,o.CF)(e.stopToken),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,e.stopToken=t},setMessage(t){void 0!==e.stopToken&&(0,o.CF)(e.stopToken),e.filled=!1,e.message=t,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,e.stopToken=void 0},setRendered(t){if(!t)return;const{reactElement:a,features:r,layout:n,maxHeightReached:o,renderProps:i}=t;e.filled=!0,e.message=void 0,e.reactElement=a,e.features=r,e.layout=n,e.error=void 0,e.maxHeightReached=o,e.renderProps=i,e.stopToken=void 0},setError(t){console.error(t),void 0!==e.stopToken&&(0,o.CF)(e.stopToken),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=t,e.renderProps=void 0,e.stopToken=void 0,(0,s.yH)(t)&&this.reload()},reload(){e.stopToken=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=y,e.renderProps=void 0,(0,l.getParent)(e,2).reload()},beforeDestroy(){(async()=>{try{void 0!==e.stopToken&&(0,o.CF)(e.stopToken);const t=(0,n.getContainingDisplay)(e),{rpcManager:a}=(0,n.getSession)(e),{rendererType:r}=t,{renderArgs:i}=w((0,l.cast)(e));i&&await r.freeResourcesInClient(a,JSON.parse(JSON.stringify(i)))}catch(e){console.error("Error while destroying block",e)}})()}})));function w(e,t){try{const a=t||(0,n.getContainingDisplay)(e),{assemblyManager:o,rpcManager:s}=(0,n.getSession)(a),{adapterConfig:c,rendererType:d,error:u,parentTrack:p}=a,m=(0,i.getTrackAssemblyNames)(p),g=e.region.assemblyName;if(!m.includes(g)&&!m.some((e=>o.get(e)?.hasName(g))))throw new Error(`region assembly (${g}) does not match track assemblies (${m})`);const f=a.renderProps(),{config:h}=f;(0,r.readConfObject)(h);const y=(0,i.getRpcSessionId)(a),b=(0,n.getContainingView)(a).id;return{rendererType:d,rpcManager:s,renderProps:f,cannotBeRenderedReason:a.regionCannotBeRendered(e.region),displayError:u,renderArgs:{statusCallback:t=>{(0,l.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:c,rendererType:d.name,sessionId:y,layoutId:b,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(e){return{displayError:e}}}async function v(e,t,a){if(!e)return;const{rendererType:r,renderProps:o,rpcManager:i,renderArgs:s,cannotBeRenderedReason:c,displayError:d}=e;if((0,l.isAlive)(a)){if(d)return void a.setError(d);if(c)return void a.setMessage(c);if(o.notReady)return;{const{reactElement:e,features:l,layout:c,maxHeightReached:d}=await r.renderInClient(i,{...s,...o,viewParams:(0,n.getViewParams)(a),stopToken:t});return{reactElement:e,features:l,layout:c,maxHeightReached:d,renderProps:o}}}}},21479:(e,t,a)=>{"use strict";a.d(t,{OX:()=>s,W7:()=>i,bf:()=>l});var r=a(99546),n=a(91468),o=a(36422);function i(e){return Math.floor(e/1e6)>0?`${Number.parseFloat((e/1e6).toPrecision(3))} Mb`:Math.floor(e/1e3)>0?`${Number.parseFloat((e/1e3).toPrecision(3))} Kb`:`${Math.floor(e)} bytes`}function s(e,t){const a="undefined"==typeof jest;return["clip",a?e:"jest",t,a?Math.random():""].filter((e=>!!e)).join("-")}async function l(e){const t=(0,r.getContainingView)(e).staticBlocks.contentBlocks,{rpcManager:a}=(0,r.getSession)(e),{adapterConfig:i}=e;if(!i)return{};const s=(0,n.getRpcSessionId)(e);return a.call(s,"CoreGetFeatureDensityStats",{sessionId:s,regions:t,adapterConfig:i,statusCallback:t=>{(0,o.isAlive)(e)&&e.setMessage(t)}})}},84481:(e,t,a)=>{"use strict";a.d(t,{A:()=>m});var r=a(7552),n=a(99546),o=a(68446),i=a(50574),s=a(76239);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},l.apply(null,arguments)}function c(e,t,a,r,n){return`M${e},${t}h${a-n}a${n},${n} 0 0 1 ${n},${n}v${r-2*n}a${n},${n} 0 0 1 ${-n},${n}h${n-a}z`}function d(e,t,a,r){return[[e,0],[e+a,r/2],[e,r]].toString()}function u(e,t,a,r){return[[e,r/2],[e+a,0],[e+a,r]].toString()}const p={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},m=(0,o.observer)((function({overview:e,block:t,assembly:a}){const{offsetPx:o,reversed:m}=t,g=(0,i.S5)(a,t.refName),f=m?g.length-1:0,h=m?0:g.length-1,y=s.Gu;let b=!1;return r.createElement("g",{transform:`translate(-${o})`},g.map(((t,a)=>{const o=JSON.stringify(t),{refName:i,type:s,start:g,end:w}=t,v=e.bpToPx({refName:i,coord:g})||0,C=e.bpToPx({refName:i,coord:w})||0,S=Math.min(v,C),k=Math.abs(C-v),T=p[s]||"black";return"acen"!==s||b?"acen"===s&&b?r.createElement("polygon",l({key:o,points:m?d(v-k,0,k,y):u(v,0,k,y)},(0,n.getFillProps)(T))):f===a?r.createElement("path",l({key:o,d:(x=S,A=k,P=y,`M${x+8},0h${A-8}v${P}h${8-A}a8,8 0 0 1 -8,-8v${16-P}a8,8 0 0 1 8,-8z`)},(0,n.getFillProps)(T))):h===a?r.createElement("path",l({key:o,d:c(S,0,k,y,8)},(0,n.getFillProps)(T))):r.createElement("rect",l({key:o,x:S,y:0,width:k,height:y},(0,n.getFillProps)(T))):(b=!0,r.createElement("polygon",l({key:o,points:m?u(v-k,0,k,y):d(v,0,k,y)},(0,n.getFillProps)(T))));var x,A,P})))}))},40562:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Ce});var r=a(7552),n=a(49823),o=a(99546),i=a(68446),s=a(75785),l=a(57468),c=a(943),d=a(36422),u=a(68584),p=a(23758),m=a(91468),g=a(374),f=a(30157),h=a(66195),y=a(21430),b=a(91388),w=a(42281),v=a(16217),C=a(17307),S=a(963),k=a(61723),T=a(36715),x=a(35050);const A=(0,s.n9)()({dragHandle:{cursor:"grab"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"}}),P=function({trackId:e,view:t,track:a}){const{classes:n}=A();return r.createElement("span",{draggable:!0,className:n.dragHandle,onDragStart:e=>{const r=e.currentTarget;if(r.parentNode){const n=r.parentNode;e.dataTransfer.setDragImage(n,20,20),t.setDraggingTrackId(a.id)}},onDragEnd:()=>{t.setDraggingTrackId(void 0)},"data-testid":`dragHandle-${t.id}-${e}`},r.createElement(x.A,{className:n.dragHandleIcon,fontSize:"small"}))},M=(0,s.n9)()((e=>({root:{background:(0,S.X4)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper}},trackName:{fontSize:"0.8rem"},iconButton:{padding:e.spacing(1)}}))),E=(0,i.observer)(r.forwardRef((function({track:e,className:t},a){const{classes:i,cx:s}=M(),l=(0,o.getContainingView)(e),d=(0,o.getSession)(e),S=e.configuration,x=e.minimized,A=(0,u.getConf)(e,"trackId"),E=(0,m.getTrackName)(S,d),R=[{label:"Track order",type:"subMenu",priority:2e3,subMenu:[{label:x?"Restore track":"Minimize track",icon:x?g.A:v.A,onClick:()=>{e.setMinimized(!x)}},...l.tracks.length>2?[{label:"Move track to top",icon:w.A,onClick:()=>{l.moveTrackToTop(e.id)}}]:[],{label:"Move track up",icon:y.A,onClick:()=>{l.moveTrackUp(e.id)}},{label:"Move track down",icon:h.A,onClick:()=>{l.moveTrackDown(e.id)}},...l.tracks.length>2?[{label:"Move track to bottom",icon:b.A,onClick:()=>{l.moveTrackToBottom(e.id)}}]:[]]},...d.getTrackActionMenuItems?.(S)||[],...e.trackMenuItems()].sort(((e,t)=>(t?.priority||0)-(e?.priority||0)));return r.createElement(c.A,{ref:a,className:s(t,i.root),onClick:e=>{e.stopPropagation()}},r.createElement(P,{track:e,trackId:A,view:l}),r.createElement(k.A,{onClick:()=>l.hideTrack(A),className:i.iconButton,title:"close this track"},r.createElement(f.A,{fontSize:"small"})),r.createElement(T.A,{variant:"body1",component:"span",className:i.trackName,onMouseDown:e=>{e.stopPropagation()}},r.createElement(n.SanitizedHTML,{html:[E,x?"(minimized)":""].filter((e=>!!e)).join(" ")})),r.createElement(p.A,{menuItems:R,"data-testid":"track_menu_icon"},r.createElement(C.A,{fontSize:"small"})))}))),R=(0,s.n9)()({trackLabel:{zIndex:3},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"}}),I=(0,i.observer)((function({track:e,view:t}){const{classes:a,cx:n}=R(),o=e.displays[0],{trackLabel:i,trackLabelOverlap:s,trackLabelOffset:l}=a,c="overlapping"!==t.trackLabelsSetting||o.prefersOffset?l:s;return"hidden"!==t.trackLabelsSetting?r.createElement(E,{track:e,className:n(i,c)}):null})),N=(0,s.n9)()({renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2}}),L=(0,i.observer)((function({model:e,track:t,onDragEnter:a}){const{classes:o}=N(),i=t.displays[0],{height:s,RenderingComponent:l,DisplayBlurb:c}=i,{trackRefs:d,id:p,scaleFactor:m}=e,g=(0,u.getConf)(t,"trackId"),f=(0,r.useRef)(null),h=t.minimized;return(0,r.useEffect)((()=>(f.current&&(d[g]=f.current),()=>{delete d[g]})),[d,g]),r.createElement("div",{className:o.trackRenderingContainer,style:{height:h?20:s},onScroll:e=>i.setScrollTop(e.currentTarget.scrollTop),onDragEnter:a,"data-testid":`trackRenderingContainer-${p}-${g}`},h?null:r.createElement(r.Fragment,null,r.createElement("div",{ref:f,className:o.renderingComponentContainer,style:{transform:1!==m?`scaleX(${m})`:void 0}},r.createElement(r.Suspense,{fallback:r.createElement(n.LoadingEllipses,null)},r.createElement(l,{model:i,onHorizontalScroll:e.horizontalScroll}))),c?r.createElement("div",{style:{position:"absolute",left:0,top:i.height-20}},r.createElement(c,{model:i})):null))})),D=(0,s.n9)()({root:{marginTop:2},resizeHandle:{height:3,boxSizing:"border-box",position:"relative",zIndex:2}}),F=(0,i.observer)((function({model:e,track:t}){const{classes:a}=D(),o=t.displays[0],{draggingTrackId:i,showTrackOutlines:s}=e,u=(0,r.useRef)(null);return r.createElement(c.A,{ref:u,className:a.root,variant:s?"outlined":void 0,elevation:s?void 0:0,onClick:a=>{if(2===a.detail&&!t.displays[0].featureIdUnderMouse){const t=u.current?.getBoundingClientRect().left||0;e.zoomTo(e.bpPerPx/2,a.clientX-t,!0)}}},r.createElement(I,{track:t,view:e}),r.createElement(l.t,{FallbackComponent:e=>r.createElement(n.ErrorMessage,{error:e.error})},r.createElement(L,{model:e,track:t,onDragEnter:()=>{(0,d.isAlive)(o)&&void 0!==i&&i!==o.id&&e.moveTrack(i,t.id)}})),r.createElement(n.ResizeHandle,{onDrag:o.resizeHeight,className:a.resizeHandle}))})),B=(0,s.n9)()((e=>({centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:`1px ${e.palette.action.active} dashed`,borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}))),V=(0,i.observer)((function({model:e}){const{bpPerPx:t,centerLineInfo:a,trackHeights:n,tracks:o,width:i}=e,s=(0,r.useRef)(null),{classes:l}=B(),c=i/2;return o.length?r.createElement("div",{"data-testid":"centerline_container",className:l.centerLineContainer,role:"presentation",ref:s,style:{left:`${c}px`,width:Math.max(1/t,1)}},a&&r.createElement("div",{"data-testid":"centerline_text",className:l.centerLineText,role:"presentation",style:{left:Math.max(1/t,1)+5,top:n}},a.refName,":"," ",Math.max(Math.round(a.offset)+1,0))):null})),z=V;var O=a(42752),H=a(27703);const G=(0,s.n9)()((e=>({verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.action.disabled},minorTick:{background:e.palette.divider}})));function j({block:e,bpPerPx:t}){const{classes:a,cx:n}=G(),o=(0,H.H2)(e.start,e.end,t);return r.createElement(O.$G,{block:e},o.map((({type:o,base:i})=>{const s=(e.reversed?e.end-i:i-e.start)/t;return r.createElement("div",{key:i,className:n(a.tick,"major"===o||"labeledMajor"===o?a.majorTick:a.minorTick),style:{left:s}})})))}const W=(0,i.observer)((({model:e})=>{const{staticBlocks:t,bpPerPx:a}=e;return r.createElement(r.Fragment,null,t.map(((e,t)=>{const n=`${e.key}-${t}`;return"ContentBlock"===e.type?r.createElement(j,{key:n,block:e,bpPerPx:a}):"ElidedBlock"===e.type?r.createElement(O.Db,{key:n,width:e.widthPx}):"InterRegionPaddingBlock"===e.type?r.createElement(O.fK,{key:n,width:e.widthPx,boundary:"boundary"===e.variant}):null})))})),$=(0,i.observer)((function({model:e}){const{classes:t}=G(),a=e.staticBlocks.offsetPx-e.offsetPx;return r.createElement("div",{className:t.verticalGuidesZoomContainer,style:{transform:1!==e.scaleFactor?`scaleX(${e.scaleFactor})`:void 0}},r.createElement("div",{className:t.verticalGuidesContainer,style:{left:a,width:e.staticBlocks.totalWidthPx}},r.createElement(W,{model:e})))}));var U=a(87485),q=a(11353),_=a(75441),J=a(89003);const X=(0,s.n9)()((e=>({highlight:{height:"100%",position:"absolute",overflow:"hidden",background:(0,U.M)(e.palette.highlight.main).alpha(.35).toRgbString()},linkIcon:{color:(0,U.M)(e.palette.highlight.main).darken(.2).toRgbString()}}))),Y=(0,i.observer)((function({model:e,highlight:t}){const{classes:a}=X(),[i,s]=(0,r.useState)(!1),l=(0,r.useRef)(null),c=(0,o.getSession)(e),{assemblyManager:d}=c,u=()=>{e.removeHighlight(t)};function p(){s(!1)}const m=d.get(t.assemblyName),g=(t=>{const a=e.bpToPx({refName:t.refName,coord:t.start}),r=e.bpToPx({refName:t.refName,coord:t.end});return a&&r?{width:Math.max(Math.abs(r.offsetPx-a.offsetPx),3),left:Math.min(a.offsetPx,r.offsetPx)-e.offsetPx}:void 0})({...t,refName:m?.getCanonicalRefName(t.refName)??t.refName});return g?r.createElement("div",{className:a.highlight,style:{left:g.left,width:g.width}},r.createElement(J.A,{title:"Highlighted from URL parameter",arrow:!0},r.createElement(k.A,{ref:l,onClick:()=>{s(!0)},style:{zIndex:3}},r.createElement(_.A,{fontSize:"small",className:a.linkIcon}))),r.createElement(n.Menu,{anchorEl:l.current,onMenuItemClick:(e,t)=>{t(c),p()},open:i,onClose:p,menuItems:[{label:"Dismiss highlight",icon:f.A,onClick:()=>{u()}},{label:"Bookmark highlighted region",icon:q.A,onClick:()=>{let e=c.widgets.get("GridBookmark");e||(e=c.addWidget("GridBookmarkWidget","GridBookmark")),e.addBookmark(t),u()}}]})):null})),K=(0,i.observer)((function({model:e}){return e.highlight.map(((t,a)=>r.createElement(Y,{key:`${JSON.stringify(t)}-${a}`,model:e,highlight:t})))}));var Q=a(91289);const Z=(0,s.n9)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}),ee=(0,i.observer)((function({model:e,coordX:t}){const{classes:a}=Z();return r.createElement(J.A,{open:!0,placement:"top",title:(0,o.stringify)(e.pxToBp(t)),arrow:!0},r.createElement("div",{className:a.guide,style:{left:t,background:"red"}}))}));var te=a(50574);function ae(e,t,a){const[n,o]=(0,r.useState)(),[i,s]=(0,r.useState)(),[l,c]=(0,r.useState)(),[d,u]=(0,r.useState)(),p=void 0!==n&&void 0===l;function m(t){if(a&&!t.shiftKey)return;t.preventDefault(),t.stopPropagation();const r=(0,te.Pn)(t,e.current);o(r),s(r)}function g(t){a?t.shiftKey?u((0,te.Pn)(t,e.current)):u(void 0):u((0,te.Pn)(t,e.current))}function f(){u(void 0),t.setOffsets(void 0,void 0)}function h(){c(void 0),o(void 0),s(void 0)}function y(e,t){t(),h()}(0,r.useEffect)((()=>{function a(t){if(e.current&&p){const a=(0,te.Pn)(t,e.current);s(a)}}function r(a){if(void 0!==n&&e.current){const{clientX:r,clientY:o}=a,i=(0,te.Pn)(a,e.current);c({offsetX:i,clientX:r,clientY:o});const s=function(e){if(void 0===n)return;const a=Math.min(n,e),r=Math.max(n,e);return{leftOffset:t.pxToBp(a),rightOffset:t.pxToBp(r)}}(i);s&&t.setOffsets(s.leftOffset,s.rightOffset),u(void 0)}}return p?(window.addEventListener("mousemove",a),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",r)}):()=>{}}),[n,p,t,e]),(0,r.useEffect)((()=>{!p&&void 0!==i&&void 0!==n&&Math.abs(i-n)<=3&&h()}),[p,i,n]);const b=Boolean(l);if(void 0===n)return{open:b,guideX:d,mouseDown:m,mouseMove:g,mouseOut:f,handleMenuItemClick:y};const w=l?l.offsetX:i||0,v=Math.min(w,n),C=Math.abs(w-n);return{open:b,rubberbandOn:!0,mouseDown:m,mouseMove:g,mouseOut:f,handleClose:h,handleMenuItemClick:y,leftBpOffset:t.pxToBp(v),rightBpOffset:t.pxToBp(v+C),anchorPosition:l,numOfBpSelected:Math.ceil(C*t.bpPerPx),width:C,left:v}}const re=(0,s.n9)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8}}),ne=(0,i.observer)((function({model:e,ControlComponent:t=r.createElement("div",null)}){const a=(0,r.useRef)(null),{classes:o}=re(),{guideX:i,rubberbandOn:s,leftBpOffset:l,rightBpOffset:c,numOfBpSelected:d,width:u,left:p,anchorPosition:m,open:g,handleMenuItemClick:f,handleClose:h,mouseMove:y,mouseDown:b,mouseOut:w}=ae(a,e);return r.createElement(r.Fragment,null,void 0!==i?r.createElement(ee,{model:e,coordX:i}):s?r.createElement(Q.A,{leftBpOffset:l,rightBpOffset:c,numOfBpSelected:d,width:u,left:p}):null,m?r.createElement(n.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:m.clientX,top:m.clientY},onMenuItemClick:f,open:g,onClose:h,menuItems:e.rubberBandMenuItems()}):null,r.createElement("div",{"data-testid":"rubberband_controls",className:o.rubberbandControl,ref:a,onMouseDown:b,onMouseMove:y,onMouseOut:w},t))})),oe=(0,s.n9)()((e=>({majorTickLabel:{fontSize:11,zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"}}))),ie=function({block:e,bpPerPx:t}){const{classes:a}=oe(),{reversed:n,start:i,end:s}=e,l=(0,H.H2)(i,s,t,!0,!1);return r.createElement(O.$G,{block:e},l.map((({type:e,base:l})=>{if("major"===e){const e=(n?s-l:l-i)/t,c=l+1;return r.createElement("div",{key:l,className:a.tick,style:{left:e}},c?r.createElement(T.A,{className:a.majorTickLabel},(0,o.getTickDisplayStr)(c,t)):null)}return null})))},se=(0,i.observer)((function({model:e}){const{staticBlocks:t,bpPerPx:a}=e;return r.createElement(r.Fragment,null,t.map(((e,t)=>{const{key:n,widthPx:o}=e,i=`${n}-${t}`;return"ContentBlock"===e.type?r.createElement(ie,{key:i,block:e,bpPerPx:a}):"ElidedBlock"===e.type?r.createElement(O.Db,{key:i,width:o}):"InterRegionPaddingBlock"===e.type?r.createElement(O.fK,{key:i,width:o,style:{background:"none"},boundary:"boundary"===e.variant}):null})))})),le=(0,s.n9)()((e=>({refLabel:{fontSize:11,position:"absolute",left:2,top:-1,fontWeight:"bold",lineHeight:"normal",zIndex:1,background:e.palette.background.paper},b0:{left:0,zIndex:100}}))),ce=(0,i.observer)((function({model:e}){const{classes:t,cx:a}=le(),{staticBlocks:n,offsetPx:o,scaleBarDisplayPrefix:i}=e;let s=0;n.forEach(((e,t)=>{e.offsetPx-o<0&&(s=t)}));const l=i(),c=n.blocks[0];return r.createElement(r.Fragment,null,"ContentBlock"!==c?.type&&l?r.createElement(T.A,{className:a(t.b0,t.refLabel)},l):null,n.map(((e,a)=>{const{offsetPx:n,isLeftEndOfDisplayedRegion:i,key:c,type:d,refName:u}=e,p=a===s;return"ContentBlock"===d&&(i||p)?r.createElement(T.A,{key:`refLabel-${c}-${a}`,style:{left:p?Math.max(0,-o):n-o-1,paddingLeft:p?0:1},className:t.refLabel,"data-testid":`refLabel-${u}`},p&&l?`${l}:`:"",u):null})))}));function de(){return de=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},de.apply(null,arguments)}const ue=(0,s.n9)()({container:{overflow:"hidden",position:"relative"},zoomContainer:{position:"relative",zIndex:1},scalebar:{position:"absolute",display:"flex",pointerEvents:"none"}}),pe=(0,i.observer)(r.forwardRef((function({model:e,style:t,className:a,...n},o){const{classes:i,cx:s}=ue(),{staticBlocks:l,offsetPx:d,scaleFactor:u}=e,p=l.offsetPx-d;return r.createElement(c.A,de({"data-resizer":"true",className:s(i.container,a),variant:"outlined",ref:o,style:t},n),r.createElement("div",{className:i.zoomContainer,style:{transform:1!==u?`scaleX(${u})`:void 0}},r.createElement("div",{className:i.scalebar,style:{left:p-1,width:l.totalWidthPx,...t}},r.createElement(se,{model:e}))),r.createElement(ce,{model:e}))})));var me=a(76239);const ge=(0,s.n9)()({tracksContainer:{position:"relative",overflow:"hidden"}}),fe=(0,i.observer)((function({children:e,model:t}){const{classes:a}=ge(),{pluginManager:i}=(0,o.getEnv)(t),{mouseDown:s,mouseUp:l}=function(e){const[t,a]=(0,r.useState)(!1),n=(0,r.useRef)(!1),o=(0,r.useRef)(0);return(0,r.useEffect)((()=>{let r=()=>{};function i(t){t.preventDefault();const a=t.clientX-o.current;a&&(n.current||(n.current=!0,window.requestAnimationFrame((()=>{e.horizontalScroll(-a),n.current=!1,o.current=t.clientX}))))}function s(){o.current=0,t&&a(!1)}return t&&(window.addEventListener("mousemove",i,!0),window.addEventListener("mouseup",s,!0),r=()=>{window.removeEventListener("mousemove",i,!0),window.removeEventListener("mouseup",s,!0)}),r}),[e,t]),{mouseDown:function(e){if(e.shiftKey)return;const t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(o.current=e.clientX,a(!0))},mouseUp:function(e){e.preventDefault(),a(!1)}}}(t),{showGridlines:c,showCenterLine:d}=t,u=(0,r.useRef)(null),{guideX:p,rubberbandOn:m,leftBpOffset:g,rightBpOffset:f,numOfBpSelected:h,width:y,left:b,anchorPosition:w,open:v,handleMenuItemClick:C,handleClose:S,mouseMove:k,mouseDown:T}=ae(u,t,!0);!function(e,t){const a=(0,r.useRef)(0),n=(0,r.useRef)(),o=(0,r.useRef)(!1);(0,r.useEffect)((()=>{const r=e.current;function i(e){e.ctrlKey?(e.preventDefault(),a.current+=e.deltaY/500,t.setScaleFactor(a.current<0?1-a.current:1/(1+a.current)),n.current&&clearTimeout(n.current),n.current=setTimeout((()=>{t.setScaleFactor(1),t.zoomTo(a.current>0?t.bpPerPx*(1+a.current):t.bpPerPx/(1-a.current),e.clientX-(r?.getBoundingClientRect().left||0)),a.current=0}),300)):(Math.abs(e.deltaX)>Math.abs(2*e.deltaY)&&e.preventDefault(),a.current+=e.deltaX,o.current||(o.current=!0,window.requestAnimationFrame((()=>{t.horizontalScroll(a.current),a.current=0,o.current=!1}))))}return r?(r.addEventListener("wheel",i),()=>{r.removeEventListener("wheel",i)}):()=>{}}),[t,e])}(u,t);const x=i.evaluateExtensionPoint("LinearGenomeView-TracksContainerComponent",void 0,{model:t});return r.createElement("div",{ref:u,"data-testid":"trackContainer",className:a.tracksContainer,onMouseDown:e=>{s(e),T(e)},onMouseMove:k,onMouseUp:l},c?r.createElement($,{model:t}):null,d?r.createElement(z,{model:t}):null,void 0!==p?r.createElement(ee,{model:t,coordX:p}):m?r.createElement(Q.A,{leftBpOffset:g,rightBpOffset:f,numOfBpSelected:h,width:y,left:b}):null,w?r.createElement(n.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:w.clientX,top:w.clientY},onMenuItemClick:C,open:v,onClose:S,menuItems:t.rubberBandMenuItems()}):null,r.createElement(ne,{model:t,ControlComponent:r.createElement(pe,{model:t,style:{height:me.jE,boxSizing:"border-box"}})}),r.createElement(K,{model:t}),x,e)})),he=(0,r.lazy)((()=>a.e(9372).then(a.bind(a,29372)))),ye=(0,r.lazy)((()=>a.e(1189).then(a.bind(a,21189)))),be=(0,s.n9)()({rel:{position:"relative"},top:{zIndex:1e3}}),we=(0,i.observer)((function({model:e}){const{error:t,initialized:a,hasDisplayedRegions:o}=e;return a||t?!o||t?r.createElement(he,{model:e}):r.createElement(ve,{model:e}):r.createElement(n.LoadingEllipses,{variant:"h6"})})),ve=(0,i.observer)((function({model:e}){const{tracks:t}=e,{classes:a}=be(),n=(0,o.getSession)(e),i=(0,r.useRef)(null),s=e.MiniControlsComponent(),l=e.HeaderComponent();return(0,r.useEffect)((()=>{function t(t){t.target instanceof Element&&i.current?.contains(t.target)&&n.setFocusedViewId?.(e.id)}return document.addEventListener("mousedown",t),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",t)}}),[n,e]),r.createElement("div",{className:a.rel,ref:i,onMouseLeave:()=>{n.setHovered(void 0)},onMouseMove:t=>{const a=i.current;if(!a)return;const{tracks:r}=e,o=t.clientX-a.getBoundingClientRect().left,s=e.pxToBp(o),l=r.find((e=>e.displays[0].featureUnderMouse));n.setHovered({hoverPosition:s,hoverFeature:l})}},r.createElement(l,{model:e}),r.createElement(s,{model:e}),r.createElement(fe,{model:e},t.length?t.map((t=>r.createElement(F,{key:t.id,model:e,track:t}))):r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(ye,{model:e}))))})),Ce=we},32474:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(7552),n=a(99546),o=a(48231),i=a(963),s=a(68446),l=a(76239);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},c.apply(null,arguments)}const d=(0,s.observer)((function({model:e,overview:t,useOffset:a=!0}){const s=(0,o.A)(),d=Number(a),{interRegionPaddingWidth:u,offsetPx:p,dynamicBlocks:m,cytobandOffset:g}=e,{contentBlocks:f,totalWidthPxWithoutBorders:h}=m,y=s.palette.tertiary.light;if(!f.length)return null;const b=f.at(0),w=f.at(-1),v=(t.bpToPx({...b,coord:b.reversed?b.end:b.start})||0)+g*d,C=(t.bpToPx({...w,coord:w.reversed?w.start:w.end})||0)+g*d,S=Math.max(0,-p),k=S+h+f.length*u/2,T=[[S,l.Ij],[k,l.Ij],[C,0],[v,0]];return r.createElement("polygon",c({points:T.toString()},(0,n.getFillProps)((0,i.X4)(y,.3)),(0,n.getStrokeProps)((0,i.X4)(y,.8))))}))},5658:(e,t,a)=>{"use strict";a.d(t,{A:()=>b});var r=a(7552),n=a(8656),o=a(99546),i=a(48901),s=a(68446),l=a(1343),c=a(25914),d=a(59121),u=a(61723),p=a(93117);const m=(0,r.lazy)((()=>a.e(9374).then(a.bind(a,39374))));function g(){const[e,t]=(0,r.useState)(!1);return r.createElement(r.Fragment,null,r.createElement(u.A,{onClick:()=>{t(!0)},size:"small"},r.createElement(c.A,{fontSize:"small"})),e?r.createElement(r.Suspense,{fallback:null},r.createElement(m,{handleClose:()=>{t(!1)}})):null)}function f({showHelp:e,endAdornment:t}){return r.createElement(r.Fragment,null,r.createElement(p.A,{position:"end",style:{marginRight:7}},r.createElement(d.A,{fontSize:"small"}),e?r.createElement(g,null):null),t)}function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},h.apply(null,arguments)}function y({TextFieldProps:e,inputBoxVal:t,params:a,showHelp:n,setInputValue:o,setCurrentSearch:i}){const{helperText:s,InputProps:c={}}=e;return r.createElement(l.A,h({onBlur:()=>{o(t)}},a,e,{size:"small",helperText:s,slotProps:{input:{...a.InputProps,...c,endAdornment:r.createElement(f,{showHelp:n,endAdornment:a.InputProps.endAdornment})}},placeholder:"Search for location",onChange:e=>{i(e.target.value)}}))}const b=(0,s.observer)((function({model:e,onSelect:t,assemblyName:a,style:s,fetchResults:l,onChange:c,value:d,showHelp:u=!0,minWidth:p=200,maxWidth:m=550,TextFieldProps:g={}}){const f=(0,o.getSession)(e),{assemblyManager:h}=f,[b,w]=(0,r.useState)(!1),[v,C]=(0,r.useState)(!0),[S,k]=(0,r.useState)(""),[T,x]=(0,r.useState)(""),[A,P]=(0,r.useState)(),M=(0,o.useDebounce)(S,300),E=a?h.get(a):void 0,{coarseVisibleLocStrings:R,hasDisplayedRegions:I}=e;(0,r.useEffect)((()=>{(async()=>{try{if(""===M||!a)return;C(!1);const e=await l(M);C(!0),P(function(e){return Object.entries(function(e){const t={};for(const a of e){const e=a.getDisplayString();t[e]||(t[e]=[]),t[e].push(a)}return t}(e)).map((([e,t])=>1===t.length?{result:t[0]}:{result:new n.A({displayString:e,results:t,label:e})}))}(e))}catch(e){console.error(e),f.notifyError(`${e}`,e)}})()}),[a,l,M,f]);const N=R||d||"",L=Math.min(Math.max((0,o.measureText)(N,14)+100,p),m),D=E?.refNames,F=D?.map((e=>({result:new n.S({refName:e,label:e,matchedAttribute:"refName"})})))||[];return r.createElement(i.A,{"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!a,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:{...s,width:L},value:N,loading:!v,inputValue:T,onInputChange:(e,t)=>{x(t),c?.(t)},loadingText:"loading results",open:b,onOpen:()=>{w(!0)},onClose:()=>{w(!1),C(!0),I&&(k(""),P(void 0))},onChange:(e,r)=>{r&&a&&(t?.("string"==typeof r?new n.A({label:r}):r.result),x(N))},options:A?.length?A:F,getOptionDisabled:e=>"limitOption"===e.group,filterOptions:(e,{inputValue:t})=>function(e,t){const a=(r=e,o=t.toLocaleLowerCase(),r.filter((({result:e})=>e.getLabel().toLowerCase().includes(o)||e.matchedObject)));var r,o;return[...a.slice(0,100),...a.length>100?[{group:"limitOption",result:new n.A({label:"keep typing for more results"})}]:[]]}(e,t),renderInput:e=>r.createElement(y,{showHelp:u,params:e,inputBoxVal:N,TextFieldProps:g,setCurrentSearch:k,setInputValue:x}),getOptionLabel:e=>"string"==typeof e?e:e.result.getDisplayString()})}))},91289:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(7552),n=a(99546),o=a(963),i=a(9555),s=a(36715);const l=(0,a(75785).n9)()((e=>{const{tertiary:t}=e.palette;return{rubberband:{height:"100%",background:(0,o.X4)(t.light,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:t.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)}}}));function c({leftBpOffset:e,rightBpOffset:t,numOfBpSelected:a,left:o,width:c}){const d=(0,r.useRef)(null),{classes:u}=l();return r.createElement(r.Fragment,null,d.current?r.createElement(r.Fragment,null,r.createElement(i.Ay,{className:u.popover,classes:{paper:u.paper},open:!0,anchorEl:d.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},r.createElement(s.A,null,(0,n.stringify)(e))),r.createElement(i.Ay,{className:u.popover,classes:{paper:u.paper},open:!0,anchorEl:d.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},r.createElement(s.A,null,(0,n.stringify)(t)))):null,r.createElement("div",{ref:d,className:u.rubberband,style:{left:o,width:c}},a?r.createElement(s.A,{variant:"h6",className:u.rubberbandText},(0,n.toLocale)(a)," bp"):null))}},50574:(e,t,a)=>{"use strict";a.d(t,{Jf:()=>o,Pn:()=>i,S5:()=>s});var r=a(8656),n=a(99546);async function o({queryString:e,searchType:t,searchScope:a,rankSearchResults:o,textSearchManager:i,assembly:s}){i||console.warn("No text search manager");const l=await(i?.search({queryString:e,searchType:t},a,o)),c=s?.allRefNames?.filter((t=>t.toLowerCase().startsWith(e.toLowerCase()))).slice(0,10).map((e=>new r.A({label:e})));return(0,n.dedupe)([...c||[],...l||[]],(e=>e.getId()))}function i(e,t){return e.clientX-(t?.getBoundingClientRect().left||0)}function s(e,t){return e?.cytobands?.map((t=>({refName:e.getCanonicalRefName(t.get("refName"))||t.get("refName"),start:t.get("start"),end:t.get("end"),type:t.get("gieStain")}))).filter((e=>e.refName===t))||[]}},76239:(e,t,a)=>{"use strict";a.d(t,{Es:()=>l,Gu:()=>n,Ij:()=>r,P5:()=>c,Rd:()=>s,i3:()=>i,jE:()=>o});const r=48,n=20,o=17,i=3,s=2,l=7,c=32},98753:(e,t,a)=>{"use strict";a.d(t,{$:()=>h,z:()=>k,renderToSvg:()=>x});var r=a(7552),n=a(49823),o=a(99546),i=a(91468),s=a(20139),l=a(42489),c=a(36422),d=a(48231);function u({width:e,height:t,shift:a}){const n=(0,d.A)();return r.createElement("rect",{width:e+2*a,height:t,fill:(0,o.stripAlpha)(n.palette.background.default)})}var p=a(97884),m=a(27703);function g({model:e,height:t}){const{dynamicBlocks:a,offsetPx:n,interRegionPaddingWidth:o}=e;return r.createElement(r.Fragment,null,a.contentBlocks.slice(1).map((e=>r.createElement("rect",{key:e.key,x:e.offsetPx-n-o,width:o,y:0,height:t,fill:"grey"}))))}function f({start:e,end:t,bpPerPx:a,reversed:n=!1,major:i=!0,minor:s=!0,hideText:l=!1}){const c=(0,m.H2)(e,t,a,i,s),u=(0,d.A)(),p=(0,o.stripAlpha)(u.palette.text.secondary);return r.createElement(r.Fragment,null,c.map((o=>{const i=(n?t-o.base:o.base-e)/a;return r.createElement("line",{key:`tick-${o.base}`,x1:i,x2:i,y1:0,y2:"major"===o.type?6:4,strokeWidth:1,stroke:p})})),l?null:c.filter((e=>"major"===e.type)).map((i=>{const s=(n?t-i.base:i.base-e)/a;return r.createElement("text",{key:`label-${i.base}`,x:s-3,y:18,fontSize:11,fill:p},(0,o.getTickDisplayStr)(i.base+1,a))})))}function h({model:e,fontSize:t}){const{dynamicBlocks:{contentBlocks:a},offsetPx:n,bpPerPx:i}=e,s=a.length<5,l=(0,d.A)(),c=(0,o.stripAlpha)(l.palette.text.primary);return r.createElement(r.Fragment,null,r.createElement(g,{model:e,height:30}),a.map((e=>{const{start:a,end:o,key:l,reversed:d,offsetPx:u,refName:p,widthPx:m}=e,g=u-n,h=`clip-${l}`;return r.createElement("g",{key:l},r.createElement("defs",null,r.createElement("clipPath",{id:h},r.createElement("rect",{x:0,y:0,width:m,height:100}))),r.createElement("g",{transform:`translate(${g} 0)`},r.createElement("g",{clipPath:`url(#${h})`},r.createElement("text",{x:4,y:t,fontSize:t,fill:c},p),r.createElement("g",{transform:"translate(0 20)"},r.createElement(f,{hideText:!s,start:a,end:o,bpPerPx:i,reversed:d})))))})))}function y({model:e,fontSize:t}){const{offsetPx:a,dynamicBlocks:{totalWidthPxWithoutBorders:n,totalBp:i}}=e,s=(0,d.A)(),l=(0,o.getBpDisplayStr)(i),c=Math.max(-a,0),u=c+n,p=(0,o.stripAlpha)(s.palette.text.secondary),m=c+(u-c)/2,g=t;return r.createElement(r.Fragment,null,r.createElement("line",{x1:c,x2:u,y1:10,y2:10,stroke:p}),r.createElement("line",{x1:c,x2:c,y1:5,y2:15,stroke:p}),r.createElement("line",{x1:u,x2:u,y1:5,y2:15,stroke:p}),r.createElement("text",{x:m,y:g,textAnchor:"middle",dominantBaseline:"hanging",fontSize:t,fill:p},l))}var b=a(84481),w=a(32474),v=a(76239);function C({model:e,fontSize:t,cytobandHeight:a,rulerHeight:n}){const{width:i,assemblyNames:s,showCytobands:l,displayedRegions:c}=e,{assemblyManager:u}=(0,o.getSession)(e),m=s.length>1?"":s[0],g=u.get(m),f=(0,d.A)(),C=(0,o.stripAlpha)(f.palette.text.primary),S=p.A.create({displayedRegions:JSON.parse(JSON.stringify(c)),interRegionPaddingWidth:0,minimumBlockWidth:e.minimumBlockWidth}),k=e.dynamicBlocks.contentBlocks;if(!k.length)return null;S.setVolatileWidth(i),S.showAllRegions();const T=S.dynamicBlocks.contentBlocks[0],x=k.at(0),A=k.at(-1),P=S.bpToPx({...x,coord:x.reversed?x.end:x.start})||0,M=S.bpToPx({...A,coord:A.reversed?A.start:A.end})||0,E=+l*a;return r.createElement("g",{id:"header"},r.createElement("text",{x:0,y:0,dominantBaseline:"hanging",fontSize:t,fill:C},m),l?r.createElement("g",{transform:`translate(0 ${n})`},r.createElement(b.A,{overview:S,assembly:g,block:T}),r.createElement("rect",{stroke:"red",fill:"rgb(255,0,0)",fillOpacity:.1,width:Math.max(M-P,.5),height:v.Gu-1,x:P,y:.5}),r.createElement("g",{transform:`translate(0,${v.Gu})`},r.createElement(w.A,{overview:S,model:e,useOffset:!1}))):null,r.createElement("g",{transform:`translate(0 ${t+E})`},r.createElement(y,{model:e,fontSize:t})),r.createElement("g",{transform:`translate(0 ${n+E})`},r.createElement(h,{model:e,fontSize:t})))}function S({trackLabels:e,trackName:t,fontSize:a,trackLabelOffset:n,x:i}){const s=(0,d.A)(),l=(0,o.stripAlpha)(s.palette.text.primary),c="overlay"===e?5:0,u="offset"===e?5:0,p=(0,o.coarseStripHTML)(t);return"none"!==e?r.createElement("g",null,"left"===e?r.createElement("text",{x:n-40,y:20,fill:l,fontSize:a,dominantBaseline:"hanging",textAnchor:"end"},p):r.createElement("text",{x:i+c,y:u,fill:l,fontSize:a,dominantBaseline:"hanging"},p)):null}function k({displayResults:e,model:t,textHeight:a,fontSize:n,trackLabels:s="offset",trackLabelOffset:l=0}){const c=(0,o.getSession)(t),d="offset"===s?a:0;let u=0;return r.createElement(r.Fragment,null,e.map((({track:e,result:a})=>{const o=u,p=e.configuration,m=(0,i.getTrackName)(p,c),f=e.displays[0],h=Math.max(-t.offsetPx,0);return u+=f.height+d,r.createElement("g",{key:p.trackId,transform:`translate(0 ${o})`},r.createElement("g",{transform:`translate(${l} ${d})`},r.createElement(g,{model:t,height:f.height}),a),r.createElement(S,{trackName:m,fontSize:n,trackLabels:s,trackLabelOffset:l,x:h}))})))}var T=a(26612);async function x(e,t){await(0,l.when)((()=>e.initialized));const{textHeight:a=18,headerHeight:d=40,rulerHeight:p=50,fontSize:m=13,cytobandHeight:g=100,trackLabels:f="offset",themeName:h="default",Wrapper:y=({children:e})=>e}=t,b=(0,o.getSession)(e),{allThemes:w}=b,{createRootFn:v}=(0,c.getRoot)(e),S=w?.()[h],{width:x,tracks:A,showCytobands:P}=e,M=d+p+ +P*g+10,E=(0,T.m)(A,a,f)+M+100,R=await Promise.all(A.map((async e=>{const a=e.displays[0];return await(0,l.when)((()=>!a.renderProps().notReady)),{track:e,result:await a.renderSvg({...t,theme:S})}}))),I=(0,o.max)(A.map((e=>(0,o.measureText)((0,i.getTrackName)(e.configuration,b),m))),0)+40,N="left"===f?I:0,L=x+N;return(0,o.renderToStaticMarkup)(r.createElement(s.A,{theme:(0,n.createJBrowseTheme)(S)},r.createElement(y,null,r.createElement("svg",{width:L,height:E,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,L+100,E].toString()},r.createElement(u,{width:L,height:E,shift:50}),r.createElement("g",{transform:"translate(50 0)"},r.createElement("g",{transform:`translate(${N})`},r.createElement(C,{model:e,fontSize:m,rulerHeight:p,cytobandHeight:g})),r.createElement("g",{transform:`translate(0 ${M})`},r.createElement(k,{textHeight:a,fontSize:m,model:e,displayResults:R,trackLabels:f,trackLabelOffset:N})))))),v)}},26612:(e,t,a)=>{"use strict";a.d(t,{m:()=>n});var r=a(99546);function n(e,t,a){return(0,r.sum)(e.map((e=>e.displays[0].height+(["none","left"].includes(a)?0:t))))}},27703:(e,t,a)=>{"use strict";a.d(t,{CU:()=>s,Cz:()=>i,H2:()=>o,i3:()=>n});var r=a(99546);function n(e,t,a){const r=t*(e=Math.abs(e));let n=10**Number.parseInt(Number(r).toExponential().split(/e/i)[1],10);for(;n<r&&(n*=2,!(n>=r));)n*=2.5;n=Math.max(n,5);const o=n/e;let i=0;return!(n%10)&&o/10>=a?i=n/10:!(n%5)&&o/5>=a?i=n/5:!(n%2)&&o/2>=a&&(i=n/2),{majorPitch:n,minorPitch:i}}function o(e,t,a,r=!0,o=!0){const i=n(a,60,15);let s=e,l=t;a<0&&([s,l]=[l,s]),s-=Math.abs(20*a)-1,l+=Math.abs(20*a)+1;const c=i.minorPitch||i.majorPitch;let d=0;const u=[];for(let e=Math.floor(s/c)*c;e<Math.ceil(l/c)*c+1;e+=c)o&&e%(2*i.majorPitch)?(u.push({type:"minor",base:e-1,index:d}),d+=1):!r||e%(2*i.majorPitch)||(u.push({type:"major",base:e-1,index:d}),d+=1);return u}async function i(e,t,a){return Promise.all(e.map((async e=>{const r=e.assemblyName||a;if(!r)throw new Error("no assembly provided");const n=await t.waitForAssembly(r),{refName:o}=e;if(!n)throw new Error(`assembly ${r} not found`);const{regions:i}=n;if(!i)throw new Error(`regions not loaded yet for ${r}`);const s=n.getCanonicalRefName(e.refName);if(!s)throw new Error(`Could not find refName ${o} in ${n.name}`);const l=i.find((e=>e.refName===s));if(!l)throw new Error(`Could not find refName ${o} in ${r}`);return{...e,assemblyName:r,parentRegion:l}})))}function s(e,t,a){const n=e.split(/(\s+)/).map((e=>e.trim())).filter((e=>!!e));try{return n.map((e=>(0,r.parseLocString)(e,(e=>a(e,t)))))}catch(e){const[o,i,s]=n;if(/Unknown reference sequence/.exec(`${e}`)&&Number.isInteger(+i)&&Number.isInteger(+s))return[(0,r.parseLocString)(`${o}:${i}..${s}`,(e=>a(e,t)))];throw e}}},20529:(e,t,a)=>{"use strict";a.d(t,{Lr:()=>x,GQ:()=>V,LW:()=>b.A,e6:()=>v,$m:()=>it.$,zh:()=>it.z,Gd:()=>He,_e:()=>S,Ki:()=>l,Ay:()=>ft,Gx:()=>G,lw:()=>j,bN:()=>_,mJ:()=>gt.m});var r=a(12678),n=a(68584),o=a(99546),i=a(11370),s=a(36422);const l=(0,n.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"},height:{type:"number",defaultValue:100,description:"default height for the track"},mouseover:{type:"string",description:"text to display when the cursor hovers over a feature",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},jexlFilters:{type:"stringArray",description:"default set of jexl filters to apply to a track. note: these do not use the jexl prefix because they have a deferred evaluation system",defaultValue:[]}},{explicitIdentifier:"displayId"});var c=a(7552),d=a(1622);class u{constructor(e){this.submaps=e}has(e){for(const t of this.submaps.values())if(t.has(e))return!0;return!1}get(e){for(const t of this.submaps.values())if(t.has(e))return t.get(e)}*values(){for(const e of this.keys())yield this.get(e)}*keys(){const e=new Set;for(const t of this.submaps.values())for(const a of t.keys())e.add(a);for(const t of e)yield t}find(e){for(const t of this.submaps.values())for(const a of t.values())if(e(a))return a}*[Symbol.iterator](){for(const e of this.keys())yield[e,this.get(e)]}*entries(){for(const e of this.keys())yield[e,this.get(e)]}}var p=a(91468),m=a(86013),g=a(63670),f=a(42489),h=a(21479),y=a(5401),b=a(37205);const w=function({model:e}){const{regionTooLargeReason:t}=e;return c.createElement(b.A,{severity:"warning",action:c.createElement(y.A,{onClick:()=>{e.setFeatureDensityStatsLimit(e.featureDensityStats),e.reload()}},"Force load"),message:[t,"Zoom in to see features or force load (may be slow)"].filter((e=>!!e)).join(". ")})};function v(){return s.types.model({userBpPerPxLimit:s.types.maybe(s.types.number),userByteSizeLimit:s.types.maybe(s.types.number)}).volatile((()=>({featureDensityStatsP:void 0,featureDensityStats:void 0,currStatsBpPerPx:0}))).views((e=>({get currentBytesRequested(){return e.featureDensityStats?.bytes||0},get currentFeatureScreenDensity(){const t=(0,o.getContainingView)(e);return(e.featureDensityStats?.featureDensity||0)*t.bpPerPx},get maxFeatureScreenDensity(){return(0,n.getConf)(e,"maxFeatureScreenDensity")},get featureDensityStatsReady(){const t=(0,o.getContainingView)(e);return!(e.currStatsBpPerPx!==t.bpPerPx||!e.featureDensityStats&&!e.userBpPerPxLimit)},get maxAllowableBytes(){return e.userByteSizeLimit||e.featureDensityStats?.fetchSizeLimit||(0,n.getConf)(e,"fetchSizeLimit")}}))).actions((e=>({afterAttach(){(0,s.addDisposer)(e,(0,f.autorun)((()=>async function(e){try{const t=(0,o.getContainingView)(e);if(!t.initialized||!t.staticBlocks.contentBlocks.length||t.bpPerPx===e.currStatsBpPerPx||e.error)return;if(void 0!==e.featureDensityStats?.featureDensity)return void e.setCurrStatsBpPerPx(t.bpPerPx);e.clearFeatureDensityStats(),e.setCurrStatsBpPerPx(t.bpPerPx);const a=await e.getFeatureDensityStats();(0,s.isAlive)(e)&&e.setFeatureDensityStats(a)}catch(t){console.error(t),(0,s.isAlive)(e)&&!(0,o.isAbortException)(t)&&e.setError(t)}}(e))))}}))).actions((e=>({setCurrStatsBpPerPx(t){e.currStatsBpPerPx=t},setFeatureDensityStatsLimit(t){const a=(0,o.getContainingView)(e);t?.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=a.bpPerPx},getFeatureDensityStats(){return e.featureDensityStatsP||(e.featureDensityStatsP=(0,h.bf)(e).catch((t=>{throw(0,s.isAlive)(e)&&this.setFeatureDensityStatsP(void 0),t}))),e.featureDensityStatsP},setFeatureDensityStatsP(t){e.featureDensityStatsP=t},setFeatureDensityStats(t){e.featureDensityStats=t},clearFeatureDensityStats(){e.featureDensityStatsP=void 0,e.featureDensityStats=void 0}}))).views((e=>({get regionTooLarge(){const t=(0,o.getContainingView)(e);return!(!e.featureDensityStatsReady||t.dynamicBlocks.totalBp<2e4)&&(e.currentBytesRequested>e.maxAllowableBytes||(e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity))},get regionTooLargeReason(){const t=e.currentBytesRequested,a=e.maxAllowableBytes;return t&&t>a?`Requested too much data (${(0,h.W7)(t)})`:""}}))).views((e=>({get statsReadyAndRegionNotTooLarge(){return e.featureDensityStatsReady&&!e.regionTooLarge},regionCannotBeRenderedText:t=>e.regionTooLarge?"Force load to see features":"",regionCannotBeRendered:t=>e.regionTooLarge?c.createElement(w,{model:e}):null})))}const C=20;function S(){return s.types.model({heightPreConfig:s.types.maybe(s.types.refinement("displayHeight",s.types.number,(e=>e>=C)))}).volatile((()=>({scrollTop:0}))).views((e=>({get height(){return e.heightPreConfig??(0,n.getConf)(e,"height")}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,C),e.height),resizeHeight(t){const a=e.height;return this.setHeight(e.height+t)-a}})))}var k=a(66344);const T=(0,c.lazy)((()=>Promise.resolve().then(a.bind(a,2286)))),x=s.types.compose("BaseLinearDisplay",d.BaseDisplay,S(),v(),s.types.model({blockState:s.types.map(k.A),configuration:(0,n.ConfigurationReference)(l)})).volatile((()=>({featureIdUnderMouse:void 0,contextMenuFeature:void 0}))).views((e=>({get DisplayMessageComponent(){},get blockType(){return"staticBlocks"},get blockDefinitions(){const t=(0,o.getContainingView)(e);if(!t.initialized)throw new Error("view not initialized yet");return t[this.blockType]}}))).views((e=>({get renderDelay(){return 50},get TooltipComponent(){return T},get selectedFeatureId(){if((0,s.isAlive)(e)){const{selection:t}=(0,o.getSession)(e);if((0,o.isFeature)(t))return t.id()}}}))).views((e=>({get features(){const t=[];for(const a of e.blockState.values())a.features&&t.push(a.features);return new u(t)},get featureUnderMouse(){const t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping:(t,a,r)=>e.blockState.get(t)?.layout?.getByCoord(a,r),getFeatureByID:(t,a)=>e.blockState.get(t)?.layout?.getByID(a),searchFeatureByID(t){let a;return e.blockState.forEach((e=>{const r=e.layout?.getByID(t);r&&(a=r)})),a}}))).actions((e=>({addBlock(t,a){e.blockState.set(t,k.A.create({key:t,region:a.toRegion()}))},deleteBlock(t){e.blockState.delete(t)},selectFeature(t){const a=(0,o.getSession)(e);if((0,o.isSessionModelWithWidgets)(a)){const r=a.addWidget("BaseFeatureWidget","baseFeature",{view:(0,o.getContainingView)(e),track:(0,o.getContainingTrack)(e),featureData:t.toJSON()});a.showWidget(r)}(0,o.isSelectionContainer)(a)&&a.setSelection(t)},navToFeature(t){(0,o.getContainingView)(e).navTo({refName:t.get("refName"),start:t.get("start"),end:t.get("end")})},clearFeatureSelection(){(0,o.getSession)(e).clearSelection()},setFeatureIdUnderMouse(t){e.featureIdUnderMouse=t},setContextMenuFeature(t){e.contextMenuFeature=t}}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),e.setCurrStatsBpPerPx(0),e.clearFeatureDensityStats(),[...e.blockState.values()].forEach((e=>{e.doReload()})),t()}}})).views((e=>({trackMenuItems:()=>[],contextMenuItems:()=>[...e.contextMenuFeature?[{label:"Open feature details",icon:g.A,onClick:()=>{e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}},{label:"Zoom to feature",icon:m.A,onClick:()=>{e.contextMenuFeature&&e.navToFeature(e.contextMenuFeature)}}]:[]],renderProps:()=>({...(0,p.getParentRenderProps)(e),notReady:!e.featureDensityStatsReady,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick(t,a){const r=a||e.featureIdUnderMouse;if(r){const t=e.features.get(r);t&&e.selectFeature(t)}else e.clearFeatureSelection()},onClick(){e.clearFeatureSelection()},onFeatureContextMenu(t,a){const r=a||e.featureIdUnderMouse;r?e.setContextMenuFeature(e.features.get(r)):e.clearFeatureSelection()},onMouseMove(t,a){e.setFeatureIdUnderMouse(a)},onMouseLeave(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})}))).actions((e=>({async renderSvg(t){const{renderBaseLinearDisplaySvg:r}=await a.e(3311).then(a.bind(a,23311));return r(e,t)},afterAttach(){(0,s.addDisposer)(e,(0,f.autorun)((()=>{const t={};(0,o.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((a=>{t[a.key]=!0,e.blockState.has(a.key)||e.addBlock(a.key,a)})),e.blockState.forEach(((a,r)=>{t[r]||e.deleteBlock(r)})))})))}}))).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...a}=e;return{heightPreConfig:t,...a}})).postProcessSnapshot((e=>{const t=e,{blockState:a,...r}=t;return r}));var A=a(49823),P=a(48231),M=a(68446),E=a(75785),R=a(42752);const I=(0,E.n9)()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),N=(0,M.observer)((function({model:e}){const{classes:t}=I(),{blockDefinitions:a,blockState:r}=e;return c.createElement(c.Fragment,null,a.map((a=>{const n=`${e.id}-${a.key}`;if("ContentBlock"===a.type){const e=r.get(a.key);return c.createElement(R.$G,{block:a,key:n},e?.ReactComponent?c.createElement(e.ReactComponent,{model:e}):null,e?.maxHeightReached?c.createElement("div",{className:t.heightOverflowed,style:{top:e.layout.getTotalHeight()-16,pointerEvents:"none",height:16}},"Max height reached"):null)}if("ElidedBlock"===a.type)return c.createElement(R.Db,{key:n,width:a.widthPx});if("InterRegionPaddingBlock"===a.type)return c.createElement(R.fK,{key:n,width:a.widthPx,style:{background:"none"},boundary:"boundary"===a.variant});throw new Error(`invalid block type ${JSON.stringify(a)}`)})))})),L=(0,M.observer)((function({model:e}){const{classes:t}=I(),{blockDefinitions:a}=e,r=(0,o.getContainingView)(e);return c.createElement("div",{className:t.linearBlocks,style:{left:a.offsetPx-r.offsetPx}},c.createElement(N,{model:e}))})),D=L;a(2286);const F=(0,E.n9)()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),B=(0,M.observer)((function(e){const{classes:t}=F(),a=(0,P.A)(),r=(0,c.useRef)(null),[o,i]=(0,c.useState)(),[s,l]=(0,c.useState)([0,0]),[d,u]=(0,c.useState)([0,0]),[p,m]=(0,c.useState)(),{model:g,children:f}=e,{TooltipComponent:h,DisplayMessageComponent:y,height:b}=g,w=g.contextMenuItems();return c.createElement("div",{ref:r,"data-testid":`display-${(0,n.getConf)(g,"displayId")}`,className:t.display,onContextMenu:e=>{e.preventDefault(),p?m(void 0):r.current&&m([e.clientX,e.clientY])},onMouseMove:e=>{if(!r.current)return;const t=r.current.getBoundingClientRect(),{left:a,top:n}=t;l([e.clientX-a,e.clientY-n]),u([e.clientX,e.clientY]),i(t)}},y?c.createElement(y,{model:g}):c.createElement(D,e),f,c.createElement(c.Suspense,{fallback:null},c.createElement(h,{model:g,height:b,offsetMouseCoord:s,clientMouseCoord:d,clientRect:o,mouseCoord:s})),c.createElement(A.Menu,{open:Boolean(p)&&w.length>0,onMenuItemClick:(e,t)=>{t(),m(void 0)},onClose:()=>{m(void 0),g.setContextMenuFeature(void 0)},TransitionProps:{onExit:()=>{m(void 0),g.setContextMenuFeature(void 0)}},anchorReference:"anchorPosition",anchorPosition:p?{top:p[1],left:p[0]}:void 0,style:{zIndex:a.zIndex.tooltip},menuItems:w}))})),V=B;var z=a(58921);var O=a(6184);function H(e){return(0,n.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})}function G(e){return s.types.compose("LinearBareDisplay",x,s.types.model({type:s.types.literal("LinearBareDisplay"),configuration:(0,n.ConfigurationReference)(e)})).views((e=>({get rendererConfig(){const t=(0,n.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create(t,(0,o.getEnv)(e))},get rendererTypeName(){return(0,n.getConf)(e,["renderer","type"])}}))).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),...(0,p.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,config:e.rendererConfig})}}))}const j=function(e){return(0,n.ConfigurationSchema)("LinearBasicDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})};var W=a(93100),$=a(1633);const U=(0,c.lazy)((()=>a.e(4033).then(a.bind(a,34033)))),q=(0,c.lazy)((()=>a.e(2412).then(a.bind(a,92412)))),_=function(e){return s.types.compose("LinearBasicDisplay",x,s.types.model({type:s.types.literal("LinearBasicDisplay"),trackShowLabels:s.types.maybe(s.types.boolean),trackShowDescriptions:s.types.maybe(s.types.boolean),trackDisplayMode:s.types.maybe(s.types.string),trackMaxHeight:s.types.maybe(s.types.number),configuration:(0,n.ConfigurationReference)(e),jexlFilters:s.types.maybe(s.types.array(s.types.string))})).views((e=>({get activeFilters(){return e.jexlFilters??(0,n.getConf)(e,"jexlFilters").map((e=>`jexl:${e}`))},get rendererTypeName(){return(0,n.getConf)(e,["renderer","type"])},get showLabels(){return e.trackShowLabels??(0,n.getConf)(e,["renderer","showLabels"])},get showDescriptions(){return e.trackShowDescriptions??(0,n.getConf)(e,["renderer","showDescriptions"])},get maxHeight(){return e.trackMaxHeight??(0,n.getConf)(e,["renderer","maxHeight"])},get displayMode(){return e.trackDisplayMode??(0,n.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,n.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,showLabels:e.showLabels,showDescriptions:e.showDescriptions,displayMode:e.displayMode,maxHeight:e.maxHeight},(0,s.getEnv)(e))}}))).actions((e=>({setJexlFilters(t){e.jexlFilters=(0,s.cast)(t)},toggleShowLabels(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode(t){e.trackDisplayMode=t},setMaxHeight(t){e.trackMaxHeight=t}}))).views((e=>{const{trackMenuItems:t,renderProps:a}=e;return{renderProps:()=>({...a(),config:e.rendererConfig,filters:new W.A({filters:e.activeFilters})}),trackMenuItems:()=>[...t(),{label:"Show labels",icon:$.A,type:"checkbox",checked:e.showLabels,onClick:()=>{e.toggleShowLabels()}},{label:"Show descriptions",icon:$.A,type:"checkbox",checked:e.showDescriptions,onClick:()=>{e.toggleShowDescriptions()}},{label:"Display mode",icon:$.A,subMenu:["compact","reducedRepresentation","normal","collapse"].map((t=>({label:t,onClick:()=>{e.setDisplayMode(t)}})))},{label:"Set max height",onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[U,{model:e,handleClose:t}]))}},{label:"Edit filters",onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[q,{model:e,handleClose:t}]))}}]}}))};var J=a(90542),X=a(95095),Y=a(97884),K=a(93707),Q=a(88530),Z=a(8832),ee=a(29417),te=a(95947),ae=a(53794),re=a(64502),ne=a(59121),oe=a(25611),ie=a(87809),se=a(45465),le=a(97147),ce=a(40631),de=a(963),ue=a(61723),pe=a(36715),me=a(83867),ge=a(84481),fe=a(87485);const he=(0,E.n9)()((e=>({highlight:{height:"100%",position:"absolute",background:(0,fe.M)(e.palette.highlight.main).alpha(.35).toRgbString(),borderLeft:`1px solid ${e.palette.highlight.main}`,borderRight:`1px solid ${e.palette.highlight.main}`}}))),ye=(0,M.observer)((function({model:e,overview:t}){const{classes:a}=he(),{highlight:r,cytobandOffset:n}=e,i=(0,o.getSession)(e),{assemblyManager:s}=i;return r.map((e=>{const a=s.get(e.assemblyName),r=a?.getCanonicalRefName(e.refName)??e.refName,o=t.bpToPx({...e,refName:r,coord:e.start}),i=t.bpToPx({...e,refName:r,coord:e.end});return void 0!==o&&void 0!==i?{width:Math.abs(i-o),left:o+n}:void 0})).filter(o.notEmpty).map((({left:e,width:t},r)=>c.createElement("div",{key:`${e}_${t}_${r}`,className:a.highlight,style:{width:t,left:e}})))})),be=ye;var we=a(89003),ve=a(91289),Ce=a(50574);const Se=(0,E.n9)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10},rel:{position:"relative"}}),ke=(0,M.observer)((function({model:e,open:t,guideX:a,overview:r}){const{classes:n}=Se(),{cytobandOffset:i}=e,{assemblyManager:s}=(0,o.getSession)(e),l=r.pxToBp(a-i),d=s.get(l.assemblyName),u=d?.cytobands?.find((e=>l.coord>e.get("start")&&l.coord<e.get("end")&&l.refName===d.getCanonicalRefName(e.get("refName"))));return c.createElement(we.A,{open:t,placement:"top",title:[(0,o.stringify)(l),u?.get("name")].join(" "),arrow:!0},c.createElement("div",{className:n.guide,style:{left:a}}))})),Te=(0,M.observer)((function({model:e,overview:t,ControlComponent:a=c.createElement("div",null)}){const{cytobandOffset:r}=e,[n,i]=(0,c.useState)(),[s,l]=(0,c.useState)(),[d,u]=(0,c.useState)(),p=(0,c.useRef)(null),{classes:m}=Se(),g=void 0!==n;function f(e){e.preventDefault(),e.stopPropagation(),i((0,Ce.Pn)(e,p.current))}function h(e){u((0,Ce.Pn)(e,p.current))}function y(){u(void 0)}if((0,c.useEffect)((()=>{function a(e){const t=p.current;t&&g&&l((0,Ce.Pn)(e,t))}function c(){if(void 0!==n&&void 0!==s&&Math.abs(s-n)>3){const a=Math.min(n,s),o=Math.max(n,s);e.moveTo(t.pxToBp(a-r),t.pxToBp(o-r))}if(void 0!==n&&void 0===s){const a=t.pxToBp(n-r);a.refName?e.centerAt(Math.round(a.coord),a.refName,a.index):((0,o.getSession)(e).notify("unknown position clicked"),console.error("unknown position clicked",a))}i(void 0),l(void 0),void 0!==n&&u(void 0)}function d(e){"Escape"===e.key&&(i(void 0),l(void 0))}return g?(window.addEventListener("mousemove",a,!0),window.addEventListener("mouseup",c,!0),window.addEventListener("keydown",d,!0),()=>{window.removeEventListener("mousemove",a,!0),window.removeEventListener("mouseup",c,!0),window.removeEventListener("keydown",d,!0)}):()=>{}}),[g,s,n,e,t,r]),void 0===n)return c.createElement("div",{className:m.rel},void 0!==d?c.createElement(ke,{model:e,open:!g,overview:t,guideX:d}):null,c.createElement("div",{className:m.rubberbandControl,ref:p,onMouseDown:f,onMouseOut:y,onMouseMove:h},a));let b,w,v=n||0,C=0;return void 0!==s&&(v=Math.min(s,n),C=s-n),n&&(b=t.pxToBp(n-r),w=t.pxToBp(n+C-r),void 0!==s&&s<n&&([b,w]=[w,b])),c.createElement("div",{className:m.rel},b&&w?c.createElement(ve.A,{leftBpOffset:b,rightBpOffset:w,width:Math.abs(C),left:v}):null,c.createElement("div",{"data-testid":"rubberband_controls",className:m.rubberbandControl,ref:p,onMouseDown:f,onMouseOut:y,onMouseMove:h},a))})),xe=Te;var Ae=a(32474),Pe=a(76239),Me=a(27703);const Ee=(0,E.n9)()({scalebarLabel:{height:Pe.Gu,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"}}),Re=(0,M.observer)((function({block:e,scale:t,overview:a,model:r}){const{classes:n}=Ee(),{start:i,end:s,reversed:l,refName:d,assemblyName:u}=e,{majorPitch:p}=(0,Me.i3)(t,120,15),{assemblyManager:m}=(0,o.getSession)(r),g=m.get(u),f=g?.getRefNameColor(d),h=[];for(let e=0;e<Math.floor((s-i)/p);e++){const t=(e+1)*p;h.push(l?s-t:i+t)}return h.map(((r,i)=>c.createElement(pe.A,{key:`${JSON.stringify(e)}-${r}-${i}`,className:n.scalebarLabel,variant:"body2",style:{left:(i+1)*p/t,pointerEvents:"none",color:f}},(0,o.getTickDisplayStr)(r,a.bpPerPx))))})),Ie=Re,Ne=(0,E.n9)()((e=>({scalebar:{height:Pe.Gu},scalebarBorder:{border:"1px solid"},scalebarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:Pe.Gu,overflow:"hidden"},scalebarContigForward:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarContigReverse:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scalebarVisibleRegion:{position:"absolute",height:Pe.Gu,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:Pe.Ij,position:"relative"},overviewSvg:{pointerEvents:"none",width:"100%",position:"absolute"}}))),Le=(0,M.observer)((function({scale:e,model:t,block:a,overview:r}){const{classes:n,cx:i}=Ne(),s=(0,P.A)(),{cytobandOffset:l,showCytobands:d}=t,{reversed:u,refName:p,assemblyName:m}=a,{assemblyManager:g}=(0,o.getSession)(t),f=g.get(m),h=f?.getRefNameColor(p),y=d&&(0,Ce.S5)(f,a.refName).length;return c.createElement("div",null,c.createElement(pe.A,{style:{left:a.offsetPx+3,color:y?s.palette.text.primary:h},className:n.scalebarRefName},p),c.createElement("div",{className:i(n.scalebarContig,y?void 0:u?n.scalebarContigReverse:n.scalebarContigForward,y?void 0:n.scalebarBorder),style:{left:a.offsetPx+l,width:a.widthPx,borderColor:h}},y?c.createElement("svg",{style:{width:"100%"}},c.createElement(ge.A,{overview:r,assembly:f,block:a})):c.createElement(Ie,{model:t,overview:r,scale:e,block:a})))})),De=(0,M.observer)((function({model:e,scale:t,overview:a}){const{classes:r}=Ne(),n=(0,P.A)(),{dynamicBlocks:i,showCytobands:s,cytobandOffset:l}=e,{pluginManager:d}=(0,o.getEnv)(e),u=i.contentBlocks,p=a.dynamicBlocks,m=n.palette.tertiary.light;if(!u.length)return null;const g=u.at(0),f=u.at(-1),h=a.bpToPx({...g,coord:g.reversed?g.end:g.start})||0,y=a.bpToPx({...f,coord:f.reversed?f.start:f.end})||0,b=s?"#f00":m,w=s?.1:.3,v=d.evaluateExtensionPoint("LinearGenomeView-OverviewScalebarComponent",void 0,{model:e,overview:a});return c.createElement("div",{className:r.scalebar},c.createElement("div",{className:r.scalebarVisibleRegion,style:{width:y-h,left:h+l,background:(0,de.X4)(b,w),borderColor:b}}),p.map(((n,o)=>"ContentBlock"!==n.type?c.createElement("div",{key:`${JSON.stringify(n)}-${o}`,className:r.scalebarContig,style:{width:n.widthPx,left:n.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}}):c.createElement(Le,{scale:t,block:n,model:e,overview:a,key:`${JSON.stringify(n)}-${o}`}))),c.createElement(be,{model:e,overview:a}),v)})),Fe=(0,M.observer)((function({model:e,children:t}){const{classes:a}=Ne(),{minimumBlockWidth:r,totalBp:n,width:o,cytobandOffset:i,displayedRegions:s}=e,l=o-i,d=JSON.stringify(s),u=(0,c.useMemo)((()=>{const e=Y.A.create({displayedRegions:JSON.parse(d),interRegionPaddingWidth:0,minimumBlockWidth:r});return e.setVolatileWidth(l),e.showAllRegions(),e}),[d,r,l]),p=n/(l-2*(s.length-1));return c.createElement("div",null,c.createElement(xe,{model:e,overview:u,ControlComponent:c.createElement(De,{model:e,overview:u,scale:p})}),c.createElement("div",{className:a.overview},c.createElement("svg",{height:Pe.Ij,className:a.overviewSvg},c.createElement(Ae.A,{model:e,overview:u})),t))})),Be=Fe;var Ve=a(5658);const ze=(0,E.n9)()((()=>({headerRefName:{minWidth:100}}))),Oe=(0,M.observer)((function({model:e,showHelp:t}){const{classes:a}=ze(),r=(0,P.A)(),n=(0,o.getSession)(e),{textSearchManager:i,assemblyManager:s}=n,{assemblyNames:l,rankSearchResults:d}=e,u=l[0],p=s.get(u),m=e.searchScope(u);return c.createElement(Ve.A,{showHelp:t,onSelect:async t=>{try{t.hasLocation()?await(0,O.Kd)({option:t,model:e,assemblyName:u}):t.results?.length?e.setSearchResults(t.results,t.getLabel()):p&&await(0,O.cm)({input:t.getLabel(),assembly:p,model:e})}catch(t){console.error(t),(0,o.getSession)(e).notify(`${t}`,"warning")}},assemblyName:u,fetchResults:e=>(0,Ce.Jf)({queryString:e,searchScope:m,rankSearchResults:d,textSearchManager:i,assembly:p}),model:e,minWidth:175,TextFieldProps:{variant:"outlined",className:a.headerRefName,style:{margin:Pe.Es},InputProps:{style:{padding:0,height:Pe.P5,background:(0,de.X4)(r.palette.background.paper,.8)}}}})})),He=Oe;var Ge=a(91404),je=a(77005);const We=(0,E.n9)()((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70,color:e.palette.text.secondary}}))),$e=(0,M.observer)((function({model:e}){const{classes:t}=We(),{maxBpPerPx:a,minBpPerPx:r,bpPerPx:n}=e,[o,i]=(0,c.useState)(100*-Math.log2(n));return(0,c.useEffect)((()=>{i(100*-Math.log2(n))}),[n]),c.createElement("div",{className:t.container},c.createElement(ue.A,{"data-testid":"zoom_out",onClick:()=>{e.zoom(2*n)},disabled:n>=a-1e-4,size:"large"},c.createElement(Ge.A,null)),c.createElement(je.Ay,{size:"small",className:t.slider,value:o,min:100*-Math.log2(a),max:100*-Math.log2(r),onChange:(e,t)=>{i(t)},onChangeCommitted:()=>e.zoomTo(2**(-o/100))}),c.createElement(ue.A,{"data-testid":"zoom_in",onClick:()=>{e.zoom(e.bpPerPx/2)},disabled:n<=r+1e-4,size:"large"},c.createElement(ie.A,null)))})),Ue=$e,qe=(0,E.n9)()((e=>({headerBar:{display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},panButton:{background:(0,de.X4)(e.palette.background.paper,.8),color:e.palette.text.primary,margin:Pe.Es},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",marginLeft:e.spacing(4)},buttonSpacer:{marginRight:e.spacing(2)}}))),_e=(0,M.observer)((({model:e})=>{const{classes:t}=qe();return c.createElement(ue.A,{onClick:e.activateTrackSelector,className:t.toggleButton,title:"Open track selector",value:"track_select"},c.createElement(J.xU,{className:t.buttonSpacer}))}));function Je({model:e}){const{classes:t}=qe();return c.createElement(c.Fragment,null,c.createElement(y.A,{variant:"outlined",className:t.panButton,onClick:()=>{e.slide(-.9)}},c.createElement(le.A,null)),c.createElement(y.A,{variant:"outlined",className:t.panButton,onClick:()=>{e.slide(.9)}},c.createElement(ce.A,null)))}const Xe=(0,M.observer)((function({model:e}){const{classes:t}=qe(),{coarseTotalBp:a}=e;return c.createElement(pe.A,{variant:"body2",color:"textSecondary",className:t.bp},(0,o.getBpDisplayStr)(a))})),Ye=({model:e})=>{const{classes:t}=qe();return c.createElement("div",{className:t.headerBar},c.createElement(_e,{model:e}),c.createElement("div",{className:t.spacer}),c.createElement(me.A,{row:!0,className:t.headerForm},c.createElement(Je,{model:e}),c.createElement(He,{model:e})),c.createElement(Xe,{model:e}),c.createElement(Ue,{model:e}),c.createElement("div",{className:t.spacer}))},Ke=(0,M.observer)((function({model:e}){const{hideHeader:t,hideHeaderOverview:a}=e;return t?null:a?c.createElement(Ye,{model:e}):c.createElement(Be,{model:e},c.createElement(Ye,{model:e}))})),Qe=Ke;var Ze=a(23758),et=a(66195),tt=a(943);const at=(0,E.n9)()((e=>({background:{position:"absolute",right:0,zIndex:1001,background:e.palette.background.paper},focusedBackground:{background:(0,de.X4)(e.palette.secondary.light,.2)}}))),rt=(0,M.observer)((function({model:e}){const{classes:t}=at(),{id:a,bpPerPx:r,maxBpPerPx:n,minBpPerPx:i,scaleFactor:s,hideHeader:l}=e,{focusedViewId:d}=(0,o.getSession)(e);return l?c.createElement(tt.A,{className:t.background},c.createElement(tt.A,{className:d===a?t.focusedBackground:void 0},c.createElement(Ze.A,{menuItems:e.menuItems()},c.createElement(et.A,{fontSize:"small"})),c.createElement(ue.A,{"data-testid":"zoom_out",onClick:()=>{e.zoom(2*r)},disabled:r>=n-1e-4||1!==s},c.createElement(Ge.A,{fontSize:"small"})),c.createElement(ue.A,{"data-testid":"zoom_in",onClick:()=>{e.zoom(r/2)},disabled:r<=i+1e-4||1!==s},c.createElement(ie.A,{fontSize:"small"})))):null})),nt=rt;var ot=a(40562),it=a(98753);const st=(0,c.lazy)((()=>Promise.resolve().then(a.bind(a,87686)))),lt=(0,c.lazy)((()=>a.e(1281).then(a.bind(a,61281)))),ct=(0,c.lazy)((()=>a.e(8528).then(a.bind(a,98528)))),dt=(0,c.lazy)((()=>a.e(7761).then(a.bind(a,77761)))),ut=(0,c.lazy)((()=>a.e(9067).then(a.bind(a,79067))));function pt(e){if(!e.length)return"";const t=e.every((t=>t.assemblyName===e[0].assemblyName));return e.map((e=>(0,o.assembleLocString)({...e,start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))).join(" ")}function mt(e){return s.types.compose("LinearGenomeView",d.BaseViewModel,s.types.model({id:Z.ElementId,type:s.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:s.types.optional(s.types.frozen(),[]),tracks:s.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:s.types.optional(s.types.enumeration(["hierarchical"]),"hierarchical"),showCenterLine:s.types.optional(s.types.boolean,(()=>Boolean(JSON.parse((0,o.localStorageGetItem)("lgv-showCenterLine")||"false")))),showCytobandsSetting:s.types.optional(s.types.boolean,(()=>Boolean(JSON.parse((0,o.localStorageGetItem)("lgv-showCytobands")||"true")))),trackLabels:s.types.optional(s.types.string,(()=>(0,o.localStorageGetItem)("lgv-trackLabels")||"")),showGridlines:!0,highlight:s.types.optional(s.types.array(s.types.frozen()),[]),colorByCDS:s.types.optional(s.types.boolean,(()=>Boolean(JSON.parse((0,o.localStorageGetItem)("lgv-colorByCDS")||"false")))),showTrackOutlines:s.types.optional(s.types.boolean,(()=>Boolean(JSON.parse((0,o.localStorageGetItem)("lgv-showTrackOutlines")||"true"))))})).volatile((()=>({volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0}))).views((e=>({get trackLabelsSetting(){const t=(0,n.getConf)((0,o.getSession)(e),["LinearGenomeViewPlugin","trackLabels"]);return e.trackLabels||t},get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return Pe.Rd},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]}}))).views((e=>({scaleBarDisplayPrefix:()=>"LinearSyntenyView"===(0,s.getParent)(e,2).type?e.assemblyNames[0]:"",MiniControlsComponent:()=>nt,HeaderComponent:()=>Qe,get assembliesNotFound(){const{assemblyManager:t}=(0,o.getSession)(e),a=e.assemblyNames.map((e=>t.get(e)?void 0:e)).filter((e=>!!e)).join(",");return a?`Assemblies ${a} not found`:void 0},get assemblyErrors(){const{assemblyManager:t}=(0,o.getSession)(e);return e.assemblyNames.map((e=>t.get(e)?.error)).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,o.getSession)(e);return e.assemblyNames.every((e=>t.get(e)?.initialized))},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get scaleBarHeight(){return Pe.jE+Pe.i3},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?Pe.Ij:Pe.Ij+Pe.Gu},get trackHeights(){return(0,o.sum)(e.tracks.map((e=>e.displays[0].height)))},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*Pe.i3},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return(0,o.sum)(e.displayedRegions.map((e=>e.end-e.start)))},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors||this.assembliesNotFound},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:()=>({...(0,p.getParentRenderProps)(e),bpPerPx:e.bpPerPx,colorByCDS:e.colorByCDS}),searchScope:t=>({assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}),getTrack:t=>e.tracks.find((e=>e.configuration.trackId===t)),rankSearchResults(t){const a=new Set(e.tracks.map((e=>e.configuration.trackId)));for(const e of t)a.has(e.trackId)&&e.updateScore(e.getScore()+1);return t},rewriteOnClicks(t,a){a.forEach((a=>{if("subMenu"in a&&this.rewriteOnClicks(t,a.subMenu),"onClick"in a){const r=a.onClick;a.onClick=(...a)=>{e.tracks.forEach((e=>{e.type===t&&r.apply(e,[e,...a])}))}}}))},get trackTypeActions(){const t=new Map;return e.tracks.forEach((e=>{if(!t.get(e.type)){const a=structuredClone(e.viewMenuActions);this.rewriteOnClicks(e.type,a),t.set(e.type,a)}})),t}}))).actions((t=>({setShowTrackOutlines(e){t.showTrackOutlines=e},setColorByCDS(e){t.colorByCDS=e},setShowCytobands(e){t.showCytobandsSetting=e},setWidth(e){t.volatileWidth=e},setError(e){t.volatileError=e},setHideHeader(e){t.hideHeader=e},setHideHeaderOverview(e){t.hideHeaderOverview=e},setHideNoTracksActive(e){t.hideNoTracksActive=e},setShowGridlines(e){t.showGridlines=e},addToHighlights(e){t.highlight.push(e)},setHighlight(e){t.highlight=(0,s.cast)(e)},removeHighlight(e){t.highlight.remove(e)},scrollTo(e){const a=(0,o.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=a,a},zoomTo(e,a=t.width/2,r=!1){const n=(0,o.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(n===t.bpPerPx)return n;const i=t.bpPerPx;return Math.abs(i-n)<1e-6?(console.warn("zoomTo bpPerPx rounding error"),i):(t.bpPerPx=n,this.scrollTo(Math.round((t.offsetPx+a)*i/n-(r?t.width/2:a))),n)},setOffsets(e,a){t.leftOffset=e,t.rightOffset=a},setSearchResults(e,a,r){(0,o.getSession)(t).queueDialog((n=>[ut,{model:t,searchResults:e,searchQuery:a,handleClose:n,assemblyName:r}]))},setNewView(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip(){t.displayedRegions=(0,s.cast)([...t.displayedRegions].reverse().map((e=>({...e,reversed:!e.reversed})))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack(a,r={},n={}){const o=e.pluggableConfigSchemaType("track"),i=(0,s.resolveIdentifier)(o,(0,s.getRoot)(t),a);if(!i)throw new Error(`Could not resolve identifier "${a}"`);const l=e.getTrackType(i?.type);if(!l)throw new Error(`Unknown track type ${i.type}`);const c=e.getViewType(t.type),d=new Set(c.displayTypes.map((e=>e.name))),u=i.displays.find((e=>d.has(e.type)));if(!u)throw new Error(`Could not find a compatible display for view type ${t.type}`);const p=t.tracks.filter((e=>e.configuration===i));if(0===p.length){const e=l.stateModel.create({...r,type:i.type,configuration:i,displays:[{type:u.type,configuration:u,...n}]});return t.tracks.push(e),e}return p[0]},hideTrack(a){const r=e.pluggableConfigSchemaType("track"),n=(0,s.resolveIdentifier)(r,(0,s.getRoot)(t),a),o=t.tracks.filter((e=>e.configuration===n));return(0,f.transaction)((()=>{o.forEach((e=>t.tracks.remove(e)))})),o.length}}))).actions((e=>({moveTrackDown(t){const a=e.tracks.findIndex((e=>e.id===t));-1!==a&&-1!==a&&a<e.tracks.length-1&&e.tracks.splice(a,2,e.tracks[a+1],e.tracks[a])},moveTrackUp(t){const a=e.tracks.findIndex((e=>e.id===t));a>0&&e.tracks.splice(a-1,2,e.tracks[a],e.tracks[a-1])},moveTrackToTop(t){const a=e.tracks.findIndex((e=>e.id===t));e.tracks=(0,s.cast)([e.tracks[a],...e.tracks.filter((e=>e.id!==t))])},moveTrackToBottom(t){const a=e.tracks.findIndex((e=>e.id===t));e.tracks=(0,s.cast)([...e.tracks.filter((e=>e.id!==t)),e.tracks[a]])},moveTrack(t,a){const r=e.tracks.findIndex((e=>e.id===t));if(-1===r)throw new Error(`Track ID ${t} not found`);const n=e.tracks.findIndex((e=>e.id===a));if(-1===n)throw new Error(`Track ID ${a} not found`);const o=e.tracks.filter(((e,t)=>t!==r));o.splice(n,0,e.tracks[r]),e.tracks=(0,s.cast)(o)},toggleTrack:t=>!e.hideTrack(t)&&(e.showTrack(t),!0),setTrackLabels(t){localStorage.setItem("lgv-trackLabels",t),e.trackLabels=t},setShowCenterLine(t){e.showCenterLine=t},setDisplayedRegions(t){e.displayedRegions=(0,s.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,o.getSession)(e);if((0,o.isSessionModelWithWidgets)(t)){const a=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(a),a}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},getSelectedRegions(t,a){const r=(0,s.getSnapshot)(e),n=Y.A.create({...r,interRegionPaddingWidth:e.interRegionPaddingWidth});return n.setVolatileWidth(e.width),n.moveTo(t,a),n.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},afterDisplayedRegionsSet(t){e.afterDisplayedRegionsSetCallbacks.push(t)},horizontalScroll(t){const a=e.offsetPx;return e.scrollTo(e.offsetPx+t)-a},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(Math.round(t-e.width/2))},showAllRegions(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly(t){const a=(0,o.getSession)(e),{assemblyManager:r}=a;if(!t){const r=new Set(e.displayedRegions.map((e=>e.assemblyName)));if(r.size>1)return void a.notify("Can't perform operation with multiple assemblies currently");[t]=[...r]}const n=r.get(t);if(n){const{regions:t}=n;t&&(this.setDisplayedRegions(t),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId(t){e.draggingTrackId=t},setScaleFactor(t){e.scaleFactor=t},clearView(){this.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},async exportSvg(t={}){const{renderToSvg:r}=await Promise.resolve().then(a.bind(a,98753)),n=await r(e,t),o=new Blob([n],{type:"image/svg+xml"});(0,se.saveAs)(o,t.filename||"image.svg")}}))).actions((e=>{let t=()=>{};return{slide:function(a){const[r,n]=(0,o.springAnimate)(e.offsetPx,e.offsetPx+e.width*a,e.scrollTo,void 0,void 0,200);t(),t=n,r()}}})).actions((e=>{let t=()=>{};return{zoom:function(a){if(e.zoomTo(e.bpPerPx),a<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||a>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)return;const r=e.bpPerPx/a,[n,i]=(0,o.springAnimate)(1,r,e.setScaleFactor,(()=>{e.zoomTo(a),e.setScaleFactor(1)}));t(),t=i,n()}}})).views((e=>({get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){const{assemblyManager:t}=(0,o.getSession)(e);return e.assemblyNames.some((e=>t.get(e)?.cytobands?.length))},get cytobandOffset(){return this.showCytobands?(0,o.measureText)(e.displayedRegions[0]?.refName||"",12)+15:0}}))).views((e=>({menuItems(){const{canShowCytobands:t,showCytobands:a}=e,r=(0,o.getSession)(e),n=[{label:"Return to import form",onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[st,{model:e,handleClose:t}]))},icon:ee.A},...(0,o.isSessionWithAddTracks)(r)?[{label:"Sequence search",icon:ne.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[lt,{model:e,handleClose:t}]))}}]:[],{label:"Export SVG",icon:re.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[ct,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:J.xU},{label:"Horizontally flip",icon:oe.A,onClick:e.horizontallyFlip},{label:"Color by CDS",type:"checkbox",checked:e.colorByCDS,icon:ae.A,onClick:()=>{e.setColorByCDS(!e.colorByCDS)}},{label:"Show...",icon:$.A,subMenu:[{label:"Show all regions in assembly",onClick:e.showAllRegionsInAssembly},{label:"Show center line",type:"checkbox",checked:e.showCenterLine,onClick:()=>{e.setShowCenterLine(!e.showCenterLine)}},{label:"Show header",type:"checkbox",checked:!e.hideHeader,onClick:()=>{e.setHideHeader(!e.hideHeader)}},{label:"Show track outlines",type:"checkbox",checked:e.showTrackOutlines,onClick:()=>{e.setShowTrackOutlines(!e.showTrackOutlines)}},{label:"Show header overview",type:"checkbox",checked:!e.hideHeaderOverview,onClick:()=>{e.setHideHeaderOverview(!e.hideHeaderOverview)},disabled:e.hideHeader},{label:"Show no tracks active button",type:"checkbox",checked:!e.hideNoTracksActive,onClick:()=>{e.setHideNoTracksActive(!e.hideNoTracksActive)}},{label:"Show guidelines",type:"checkbox",checked:e.showGridlines,onClick:()=>{e.setShowGridlines(!e.showGridlines)}},...t?[{label:"Show ideogram",type:"checkbox",checked:e.showCytobands,onClick:()=>{e.setShowCytobands(!a)}}]:[]]},{label:"Track labels",icon:te.A,subMenu:[{label:"Overlapping",icon:$.A,type:"radio",checked:"overlapping"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("overlapping")}},{label:"Offset",icon:$.A,type:"radio",checked:"offset"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("offset")}},{label:"Hidden",icon:$.A,type:"radio",checked:"hidden"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("hidden")}}]}];for(const[t,a]of e.trackTypeActions.entries())a.length&&(n.push({type:"divider"},{type:"subHeader",label:t}),a.forEach((e=>n.push(e))));return n}}))).views((e=>{let t,a="";return{get staticBlocks(){const r=(0,Q.A)(e),n=JSON.stringify(r);return a!==n&&(t=r,a=n),t},get dynamicBlocks(){return(0,K.A)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},get visibleLocStrings(){return pt(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return pt(e.coarseDynamicBlocks)}}})).actions((e=>({setCoarseDynamicBlocks(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach(){(0,s.addDisposer)(e,(0,f.autorun)((()=>{e.initialized&&this.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150})),(0,s.addDisposer)(e,(0,f.autorun)((()=>{const t=e=>JSON.stringify(e),{showCytobandsSetting:a,showCenterLine:r,colorByCDS:n}=e;(0,o.localStorageSetItem)("lgv-showCytobands",t(a)),(0,o.localStorageSetItem)("lgv-showCenterLine",t(r)),(0,o.localStorageSetItem)("lgv-colorByCDS",t(n))})))}}))).actions((e=>({moveTo(t,a){(0,X.tw)(e,t,a)},async navToLocString(t,a){const{assemblyNames:r}=e,{assemblyManager:n}=(0,o.getSession)(e),i=a||r[0];return i&&await n.waitForAssembly(i),this.navToLocations((0,Me.CU)(t,i,((e,t)=>n.isValidRefName(e,t))),i)},async navToSearchString({input:t,assembly:a}){await(0,O.cm)({input:t,assembly:a,model:e})},async navToLocations(t,a){const{assemblyManager:r}=(0,o.getSession)(e);await(0,f.when)((()=>void 0!==e.volatileWidth));const n=await(0,Me.Cz)(t,r,a);if(1===n.length){const t=n[0],{reversed:a,parentRegion:r,start:i,end:s}=t;e.setDisplayedRegions([{reversed:a,...r}]),this.navTo({...t,start:(0,o.clamp)(i??0,0,r.end),end:(0,o.clamp)(s??r.end,0,r.end)})}else e.setDisplayedRegions(n.map((e=>void 0===e.start?e.parentRegion:e))),e.showAllRegions()},navTo(e){this.navToMultiple([e])},navToMultiple(t){if(t.some((e=>void 0!==e.start&&void 0!==e.end&&e.start>e.end)))throw new Error("found start greater than end");const a=t.at(0),r=t.at(-1);if(!a||!r)return;const n=e.assemblyNames[0],{assemblyManager:i}=(0,o.getSession)(e),s=i.get(a.assemblyName||n),l=i.get(r.assemblyName||n),c=s?.getCanonicalRefName(a.refName)||a.refName,d=l?.getCanonicalRefName(r.refName)||r.refName,u=e.displayedRegions.find((e=>e.refName===c)),p=(0,o.findLast)(e.displayedRegions,(e=>e.refName===d));if(!u)throw new Error(`could not find a region with refName "${c}"`);if(!p)throw new Error(`could not find a region with refName "${d}"`);const m=void 0===a.start?u.start:a.start,g=void 0===a.end?u.end:a.end,f=void 0===r.start?p.start:r.start,h=void 0===r.end?p.end:r.end,y=e.displayedRegions.findIndex((e=>c===e.refName&&m>=e.start&&m<=e.end&&g<=e.end&&g>=e.start)),b=e.displayedRegions.findIndex((e=>d===e.refName&&f>=e.start&&f<=e.end&&h<=e.end&&h>=e.start));if(-1===y||-1===b)throw new Error(`could not find a region that contained "${t.map((e=>(0,o.assembleLocString)(e)))}"`);const w=e.displayedRegions[y],v=e.displayedRegions[b];this.moveTo({index:y,offset:w.reversed?w.end-g:m-w.start},{index:b,offset:v.reversed?v.end-f:h-v.start})}}))).views((e=>({rubberBandMenuItems:()=>[{label:"Zoom to region",icon:ie.A,onClick:()=>{e.moveTo(e.leftOffset,e.rightOffset)}},{label:"Get sequence",icon:g.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[dt,{model:e,handleClose:t}]))}}],bpToPx:({refName:t,coord:a,regionNumber:r})=>(0,X.eB)({refName:t,coord:a,regionNumber:r,self:e}),centerAt(t,a,r){const n=this.bpToPx({refName:a,coord:t,regionNumber:r});void 0!==n&&e.scrollTo(Math.round(n.offsetPx-e.width/2))},pxToBp:t=>(0,X.Ii)(e,t),get centerLineInfo(){return e.displayedRegions.length>0?this.pxToBp(e.width/2):void 0}}))).actions((e=>({afterCreate(){function t(t){(0,o.getSession)(e).focusedViewId===e.id&&(t.ctrlKey||t.metaKey)&&("ArrowLeft"===t.code?(t.preventDefault(),e.slide(-.9)):"ArrowRight"===t.code?(t.preventDefault(),e.slide(.9)):"ArrowUp"===t.code&&1===e.scaleFactor?(t.preventDefault(),e.zoom(e.bpPerPx/2)):"ArrowDown"===t.code&&1===e.scaleFactor&&(t.preventDefault(),e.zoom(2*e.bpPerPx)))}document.addEventListener("keydown",t),(0,s.addDisposer)(e,(()=>{document.removeEventListener("keydown",t)}))}}))).preProcessSnapshot((e=>{if(!e)return e;const{highlight:t,...a}=e;return{highlight:Array.isArray(t)||void 0===t?t:[t],...a}}))}var gt=a(26612);class ft extends r.A{name="LinearGenomeViewPlugin";exports={BaseLinearDisplayComponent:V,BaseLinearDisplay:x,baseLinearDisplayConfigSchema:l,SearchBox:He,ZoomControls:Ue,LinearGenomeView:ot.default};configurationSchema=(0,n.ConfigurationSchema)("LinearGenomeViewConfigSchema",{trackLabels:{type:"string",defaultValue:"overlapping",model:s.types.enumeration("trackLabelOptions",["offset","overlapping","hidden"])}});install(e){var t;(t=e).addTrackType((()=>{const e=(e=>(0,n.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:(0,z.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(t);return new z.TrackType({name:"FeatureTrack",displayName:"Feature track",configSchema:e,stateModel:(0,z.createBaseTrackModel)(t,"FeatureTrack",e)})})),function(e){e.addTrackType((()=>{const t=(e=>(0,n.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:(0,z.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(e);return new z.TrackType({name:"BasicTrack",configSchema:t,stateModel:(0,z.createBaseTrackModel)(e,"BasicTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const t=j(e);return new z.DisplayType({name:"LinearBasicDisplay",displayName:"Basic feature display",configSchema:t,stateModel:_(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:V})}))}(e),function(e){e.addViewType((()=>new z.ViewType({name:"LinearGenomeView",displayName:"Linear genome view",stateModel:mt(e),ReactComponent:(0,c.lazy)((()=>Promise.resolve().then(a.bind(a,40562))))})))}(e),function(e){e.addDisplayType((()=>{const t=H(e);return new z.DisplayType({name:"LinearBareDisplay",configSchema:t,displayName:"Bare feature display",stateModel:G(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:V})}))}(e),function(e){e.addToExtensionPoint("LaunchView-LinearGenomeView",(async({session:e,assembly:t,loc:a,tracks:r=[],tracklist:n,nav:i,highlight:s})=>{try{const{assemblyManager:l}=e,{isValidRefName:c}=l,d=e.addView("LinearGenomeView",{});if(await(0,o.when)((()=>!!d.volatileWidth)),!t)throw new Error("No assembly provided when launching linear genome view");const u=await l.waitForAssembly(t);if(!u)throw new Error(`Assembly "${t}" not found when launching linear genome view`);n&&d.activateTrackSelector(),void 0!==i&&d.setHideHeader(!i),void 0!==s&&s.forEach((async e=>{const a=(0,o.parseLocString)(e,(e=>c(e,t))),{start:r,end:n}=a;void 0!==r&&void 0!==n&&d.addToHighlights({...a,start:r,end:n,assemblyName:t})})),await(0,O.cm)({input:a,model:d,assembly:u});const p=[];if(r.forEach((e=>{!function(e,t,a){try{e.showTrack(t)}catch(e){if(!/Could not resolve identifier/.exec(`${e}`))throw e;a.push(t)}}(d,e,p)})),p.length)throw new Error(`Could not resolve identifiers: ${p.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}}))}(e)}configure(e){(0,o.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:i.A,onClick:e=>{e.addView("LinearGenomeView",{})}})}}},6184:(e,t,a)=>{"use strict";a.d(t,{Kd:()=>o,cm:()=>i});var r=a(8656),n=a(99546);async function o({option:e,model:t,assemblyName:a}){const r=e.getLocation(),n=e.getTrackId();r&&(await t.navToLocString(r,a),n&&t.showTrack(n))}async function i({input:e,model:t,assembly:a}){const i=a.allRefNamesWithLowerCase||[],s=a.name;if(e.split(" ").every((e=>function(e,t){const[a,r]=function(e){const t=e.lastIndexOf(":");if(-1===t)return[e,""];return[e.slice(0,t),e.slice(t+1)]}(e);return t.includes(e)||t.includes(a)&&!Number.isNaN(Number.parseInt(r,10))}(e,i))))await t.navToLocString(e,a.name);else{const i=t.searchScope(s),{textSearchManager:l}=(0,n.getSession)(t),c=await async function({queryString:e,searchType:t,searchScope:a,rankSearchResults:o,textSearchManager:i,assembly:s}){i||console.warn("No text search manager");const l=await(i?.search({queryString:e,searchType:t},a,o)),c=s?.allRefNames?.filter((t=>t.toLowerCase().startsWith(e.toLowerCase()))).slice(0,10).map((e=>new r.A({label:e})));return(0,n.dedupe)([...c||[],...l||[]],(e=>e.getId()))}({queryString:e,searchType:"exact",searchScope:i,rankSearchResults:t.rankSearchResults,textSearchManager:l,assembly:a});c.length>1?t.setSearchResults(c,e.toLowerCase(),s):1===c.length?await o({option:c[0],model:t,assemblyName:s}):await t.navToLocString(e,s)}}},73716:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(7552),n=a(99546),o=a(68446);const i=(0,o.observer)((function({children:e,model:t,exportSVG:a}){const{height:o}=t,{width:i,offsetPx:s}=(0,n.getContainingView)(t),l=Math.max(0,-s);return a?r.createElement("g",{transform:`translate(${l})`},e):r.createElement("svg",{style:{position:"absolute",top:0,left:l,pointerEvents:"none",height:o,width:i}},e)})),s=(0,o.observer)((function({model:e,exportSVG:t}){const{assemblyManager:a}=(0,n.getSession)(e),o=(0,n.getContainingView)(e),{featuresVolatile:s}=e,{offsetPx:l,assemblyNames:c,dynamicBlocks:d}=o,u=a.get(c[0]),p=(d.contentBlocks[0]?.widthPx||0)/(s?.length||1),m=Math.max(l,0);return u&&s?r.createElement(i,{exportSVG:t,model:e},s.map(((e,t)=>{const a=e.get("refName"),n=(o.bpToPx({refName:u.getCanonicalRefName(a)||a,coord:e.get("start")})?.offsetPx||0)-m;return r.createElement("line",{stroke:"black",key:e.id(),x1:t*p+p/2,x2:n,y1:20,y2:0})}))):null}))},54702:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(9502);const n={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted_duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};function o(e,t,a){if(!t||0===t.length)return["remark","no alternative alleles"];const n=new Set;let o=new Set;if(t.forEach((t=>{let[l,c]=i(t,a);l||([l,c]=function(e,t){if((0,r.h)(t))return["breakend",t];if(1===e.length&&1===t.length)return["SNV",s("SNV",e,t)];if("<INS>"===t)return["insertion",t];if("<DEL>"===t)return["deletion",t];if("<DUP>"===t)return["duplication",t];if("<CNV>"===t)return["cnv",t];if("<INV>"===t)return["inversion",t];if("<TRA>"===t)return["translocation",t];if(t.includes("<"))return["sv",t];if(e.length===t.length)return e.split("").reverse().join("")===t?["inversion",s("inversion",e,t)]:["substitution",s("substitution",e,t)];if(e.length<=t.length){const a=t.length-e.length,r=a.toLocaleString("en-US");return["insertion",a>5?`${r}bp INS`:s("insertion",e,t)]}if(e.length>t.length){const a=e.length-t.length,r=a.toLocaleString("en-US");return["deletion",a>5?`${r}bp DEL`:s("deletion",e,t)]}return["indel",s("indel",e,t)]}(e,t)),l&&c&&(n.add(l),o.add(c))})),o.size>1){const e=[...o],t=new Set(e.map((e=>{const t=e.split("->");return t[1]?t[0]:e})).filter((e=>!!e)));o=new Set([...t].map((e=>e.trim())).map((t=>{const a=e.map((e=>e.split("->").map((e=>e.trim())))).map((e=>e[1]&&e[0]===t?e[1]:"")).filter((e=>!!e));return a.length?`${t} -> ${a.join(",")}`:t})))}return n.size?[[...n].join(","),[...o].join(",")]:[]}function i(e,t){if("string"==typeof e&&!e.startsWith("<"))return[];let a=n[e];if(!a&&t.getMetadata("ALT",e)&&(a="sequence_variant"),a)return[a,e];const r=e.split(":");return r.length>1?i(`<${r.slice(0,-1).join(":")}>`,t):[]}function s(e,t,a){return`${e} ${t} -> ${a}`}function l(e){const{POS:t,REF:a="",ALT:r}=e,n=r?.includes("<TRA>"),o=t-1,i=r?.some((e=>e.includes("<")));if(i){const t=e.INFO;if(t.END&&!n)return+t.END[0]}return o+a.length}class c{constructor(e){this.variant=e.variant,this.parser=e.parser,this.data=function(e,t){const{REF:a="",ALT:r,POS:n,CHROM:i,ID:s}=e,c=n-1,[d,u]=o(a,r,t);return{refName:i,start:c,end:l(e),description:u,type:d,name:s?.join(","),aliases:s&&s.length>1?s.slice(1):void 0}}(this.variant,this.parser),this._id=e.id}get(e){return"samples"===e?this.variant.SAMPLES():"genotypes"===e?this.variant.GENOTYPES():this.data[e]??this.variant[e]}parent(){}children(){}id(){return this._id}toJSON(){const{SAMPLES:e,GENOTYPES:t,...a}=this.variant;return{uniqueId:this._id,...a,...this.data,samples:this.variant.SAMPLES()}}}},6171:(e,t,a)=>{"use strict";a.d(t,{_:()=>he.A,A:()=>ye});var r=a(12678),n=a(56328),o=a(48133),i=a(68584),s=a(36422);var l=a(99546),c=a(91468);var d=a(20529);function u(e){return s.types.compose("LinearVariantDisplay",(0,d.bN)(e),s.types.model({type:s.types.literal("LinearVariantDisplay"),configuration:(0,i.ConfigurationReference)(e)})).actions((e=>({async selectFeature(t){const a=(0,l.getSession)(e);if((0,l.isSessionModelWithWidgets)(a)){const{rpcManager:r}=a,n=(0,c.getRpcSessionId)(e),o=(0,l.getContainingTrack)(e),s=(0,l.getContainingView)(e),d=(0,i.getConf)(o,"adapter"),u=await r.call(n,"CoreGetMetadata",{adapterConfig:d});a.showWidget(a.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:s,track:o,descriptions:u}))}a.setSelection(t)}})))}var p=a(7552),m=a(40898),g=a(37347),f=a(41365),h=a.n(f),y=a(7080);const b=(0,p.lazy)((()=>a.e(7778).then(a.bind(a,67778)))),w=(0,p.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(9948),a.e(6395),a.e(8585)]).then(a.bind(a,88585)))),v=(0,p.lazy)((()=>a.e(4244).then(a.bind(a,84244)))),C=function(e,t){return s.types.compose("MultiLinearVariantDisplay",(0,d.Gx)(t),s.types.model({type:s.types.literal("MultiLinearVariantDisplay"),layout:s.types.optional(s.types.frozen(),[]),rowHeightSetting:s.types.optional(s.types.number,11),autoHeight:!1,showSidebarLabelsSetting:!0})).volatile((()=>({sourcesLoadingStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0}))).actions((e=>({setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,g.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSources(t){h()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},setRowHeight(t){e.rowHeightSetting=t},setAutoHeight(t){e.autoHeight=t},setShowSidebarLabels(t){e.showSidebarLabelsSetting=t}}))).views((e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return b}}))).views((e=>({get rendererTypeName(){return"MultiVariantRenderer"},get sources(){const t=Object.fromEntries(e.sourcesVolatile?.map((e=>[e.name,e]))||[]),a=e.layout.length?e.layout:e.sourcesVolatile;return a?.map((e=>({...t[e.name],...e}))).map(((e,t)=>({...e,color:e.color||m.set1[t]||(0,y.XL)(e.name)})))}}))).views((e=>({get rowHeight(){const{autoHeight:t,sources:a,rowHeightSetting:r,height:n}=e;return t?n/(a?.length||1):r}}))).views((e=>{const{renderProps:t}=e;return{get canDisplayLabels(){return e.rowHeight>8&&e.showSidebarLabelsSetting},get totalHeight(){return e.rowHeight*(e.sources?.length||1)},adapterProps:()=>({...t(),displayModel:e,config:e.rendererConfig,rpcDriverName:e.rpcDriverName,sources:e.sources})}})).views((e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources,displayModel:e,rpcDriverName:e.rpcDriverName,height:e.height,totalHeight:e.totalHeight,rowHeight:e.rowHeight,scrollTop:e.scrollTop,onMouseMove:(t,a)=>{e.setFeatureUnderMouse(a)},onMouseLeave:()=>{e.setFeatureUnderMouse(void 0)}}}}))).views((e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Adjust to height of display?",type:"checkbox",checked:e.autoHeight,onClick:()=>{e.setAutoHeight(!e.autoHeight)}},{label:"Show sidebar labels",type:"checkbox",checked:e.showSidebarLabelsSetting,onClick:()=>{e.setShowSidebarLabels(!e.showSidebarLabelsSetting)}},{label:"Cluster by genotype",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[v,{model:e,handleClose:t}]))}},{label:"Edit colors/arrangement...",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[w,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const{getMultiVariantSourcesAutorun:t}=await a.e(9222).then(a.bind(a,9222));t(e)}catch(t){(0,s.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(r){const{renderSvg:n}=await a.e(8178).then(a.bind(a,88178));return n(e,r,t)}}}))};var S=a(49823),k=a(9236),T=a(68446),x=a(75785),A=a(73716),P=a(98054);const M=(0,x.n9)()({cursor:{pointerEvents:"none",zIndex:1e3,position:"relative"}}),E=(0,T.observer)((function(e){const{classes:t}=M(),{model:a}=e,{height:r,sources:n,rowHeight:o}=a,i=(0,p.useRef)(null),[s,c]=(0,p.useState)(),[u,m]=(0,p.useState)(),{width:g}=(0,l.getContainingView)(a);return p.createElement("div",{ref:i,onMouseMove:e=>{const t=i.current?.getBoundingClientRect(),a=t?.top||0,r=t?.left||0;c(e.clientY-a),m(e.clientX-r)},onMouseLeave:()=>{c(void 0),m(void 0)}},p.createElement("div",{style:{position:"relative"}},p.createElement(A.A,{model:a}),p.createElement("div",{style:{position:"absolute",top:20}},p.createElement(P.A,{model:a}),p.createElement(d.GQ,e))),s&&s>20&&n?.[Math.floor((s-20)/o)]?p.createElement(p.Fragment,null,p.createElement("svg",{className:t.cursor,width:g,height:r},p.createElement("line",{x1:0,x2:g,y1:s,y2:s,stroke:"black"}),p.createElement("line",{x1:u,x2:u,y1:0,y2:r,stroke:"black"})),p.createElement(k.A,null,p.createElement(S.SanitizedHTML,{html:Object.entries(n[Math.floor((s-20)/o)]||{}).filter((([e])=>"color"!==e)).map((([e,t])=>`${e}:${t}`)).join("\n")}))):null)})),R=E,I=(0,i.ConfigurationSchema)("LinearVariantMatrixRenderer",{},{explicitlyTyped:!0});function N(e){return(0,i.ConfigurationSchema)("LinearVariantMatrixDisplay",{renderer:I,height:{type:"number",defaultValue:250}},{baseConfiguration:(0,d.lw)(e),explicitlyTyped:!0})}const L=(0,p.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(9948),a.e(6395),a.e(8585)]).then(a.bind(a,88585)))),D=(0,p.lazy)((()=>a.e(1152).then(a.bind(a,31152)))),F=(0,p.lazy)((()=>a.e(4244).then(a.bind(a,84244))));function B(e){return s.types.compose("LinearVariantMatrixDisplay",(0,d.Gx)(e),s.types.model({type:s.types.literal("LinearVariantMatrixDisplay"),layout:s.types.optional(s.types.frozen(),[]),configuration:(0,i.ConfigurationReference)(e),mafFilter:s.types.optional(s.types.number,.1),showSidebarLabelsSetting:!0})).volatile((()=>({sourcesLoadingStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0,featuresVolatile:void 0,lineZoneHeight:20}))).actions((e=>({setFeatures(t){e.featuresVolatile=t},setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,g.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setSources(t){h()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setMafFilter(t){e.mafFilter=t},setShowSidebarLabels(t){e.showSidebarLabelsSetting=t}}))).views((e=>({get preSources(){return e.layout.length?e.layout:e.sourcesVolatile},get sources(){const t=Object.fromEntries(e.sourcesVolatile?.map((e=>[e.name,e]))||[]);return this.preSources?.map((e=>({...t[e.name],...e}))).map(((e,t)=>({...e,color:e.color||m.set1[t]||(0,y.XL)(e.name)})))}}))).views((e=>{const{trackMenuItems:t,renderProps:a}=e;return{adapterProps:()=>({...a(),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig}),trackMenuItems:()=>[...t(),{label:"Show sidebar labels",type:"checkbox",checked:e.showSidebarLabelsSetting,onClick:()=>{e.setShowSidebarLabels(!e.showSidebarLabelsSetting)}},{label:"Minimum allele frequency",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[D,{model:e,handleClose:t}]))}},{label:"Cluster by genotype",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[F,{model:e,handleClose:t}]))}},{label:"Edit colors/arrangement...",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[L,{model:e,handleClose:t}]))}}]}})).views((e=>({get blockType(){return"dynamicBlocks"},get totalHeight(){return e.height-e.lineZoneHeight},get rowHeight(){return this.totalHeight/(e.sources?.length||1)}}))).views((e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.featuresVolatile,mafFilter:e.mafFilter,height:e.totalHeight,sources:e.sources}},get canDisplayLabels(){return e.rowHeight>8&&e.showSidebarLabelsSetting}}))).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const{getMultiVariantSourcesAutorun:t}=await a.e(9222).then(a.bind(a,9222)),{getMultiVariantFeaturesAutorun:r}=await a.e(2303).then(a.bind(a,12303));t(e),r(e)}catch(t){(0,s.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(r){const{renderSvg:n}=await a.e(9875).then(a.bind(a,59875));return n(e,r,t)}}}))}var V=a(98111);const z=.3;class O extends V.default{supportsSVG=!0;makeImageData({ctx:e,canvasWidth:t,canvasHeight:a,renderArgs:r}){const{mafFilter:n,sources:o,features:i}=r,s=[...i.values()],l=a/o.length,c=[];for(const e of s){let t=0,a=0;const r=e.get("genotypes");if(e.get("end")-e.get("start")<=10){for(const{name:e}of o){const n=r[e];"0|0"===n||"./."===n?a++:"1|0"===n||"0|1"===n?t++:"1|1"===n?(t++,a++):t++}t/o.length>n&&a/o.length<1-n&&c.push(e)}}const d=t/c.length;for(let r=0;r<c.length;r++){const n=c[r];if(n.get("end")-n.get("start")<=10){const i=n.get("genotypes"),s=r/c.length*t;for(let t=0;t<o.length;t++){const r=t/o.length*a,{name:n}=o[t];e.fillStyle=(0,y.RR)(i[n]),e.fillRect(s-z,r-z,d+z,l+z)}}}return{mafs:c}}async render(e){const t=await this.getFeatures(e),{height:a,sources:r,regions:n,bpPerPx:o}=e,i=n[0],{end:s,start:c}=i,d=(s-c)/o,{mafs:u,...p}=await(0,l.renderToAbstractCanvas)(d,a,e,(n=>this.makeImageData({ctx:n,canvasWidth:d,canvasHeight:a,renderArgs:{...e,features:t,sources:r}})));return{...await super.render({...e,...p,features:t,height:a,width:d}),...p,features:new Map,simplifiedFeatures:u.map((e=>new l.SimpleFeature({id:e.id(),data:{start:e.get("start"),end:e.get("end"),refName:e.get("refName")}}))),height:a,width:d}}}var H=a(92880);class G extends H.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:a,regions:r,bpPerPx:n}=e,o=r[0],i=(o.end-o.start)/n,s=await(0,l.renderToAbstractCanvas)(i,a,e,(async a=>{await this.draw(a,{...e,features:t})}));return{...await super.render({...e,...s,features:t,height:a,width:i}),...s,features:new Map,height:a,width:i,containsNoTransferables:!0}}async draw(e,t){const{scrollTop:a,sources:r,rowHeight:n,features:o,regions:i,bpPerPx:s}=t,c=i[0];for(const t of o.values())if(t.get("end")-t.get("start")<=10){const[o,i]=(0,l.featureSpanPx)(t,c,s),d=Math.max(Math.round(i-o),2),u=t.get("genotypes");let p=-a;for(const{name:t}of r)e.fillStyle=(0,y.RR)(u[t]),e.fillRect(Math.floor(o),p,d,Math.max(p+n,1)),p+=n}}}function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},j.apply(null,arguments)}const W=(0,T.observer)((function(e){const{totalHeight:t,scrollTop:a}=e,r=(0,p.useRef)(null);return p.createElement("div",{ref:r,style:{overflow:"visible",position:"relative",height:t}},p.createElement(S.PrerenderedCanvas,j({},e,{style:{position:"absolute",left:0,top:a}})))})),$=(0,i.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:s.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0}),U=(0,i.ConfigurationSchema)("MultiVariantRenderer",{},{baseConfiguration:$,explicitlyTyped:!0});var q=a(94318),_=a(9502);function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},J.apply(null,arguments)}function X(e,t){const a=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-a)/e.bpPerRadian+e.startRadians}const Y=(0,T.observer)((function({feature:e,blocksForRefs:t,radius:a,config:r,bezierRadius:n,selected:o,onClick:s}){const[c,d]=(0,p.useState)(!1),u=t[e.get("refName")];if(!u)return null;let m,g,f;e.get("INFO")?[m]=e.get("INFO").SVTYPE||[]:e.get("mate")&&(m="mate");const h=e.get("ALT")?.[0],y=h&&(0,_.h)(h),b=e.get("start");if(y){const e=y.MatePosition.split(":");g=+e[1],f=t[e[0]]}else if("<TRA>"===h){const a=e.get("INFO")?.CHR2?.[0],r=e.get("INFO")?.END?.[0];g=Number.parseInt(r,10),f=t[a]}else if("mate"===m){const a=e.get("mate"),r=a.refName;g=a.start,f=t[r]}else f=u,g=e.get("end");if(f){const t=X(u,b),m=X(f,g),h=(0,l.polarToCartesian)(a,t),y=(0,l.polarToCartesian)(a,m),w=(0,l.polarToCartesian)(n,(m+t)/2),v=o?(0,i.readConfObject)(r,"strokeColorSelected",{feature:e}):(0,i.readConfObject)(r,"strokeColor",{feature:e}),C=(0,i.readConfObject)(r,"strokeColorHover",{feature:e});return p.createElement("path",J({"data-testid":`chord-${e.id()}`,cursor:"crosshair",fill:"none",d:["M",...h,"Q",...w,...y].join(" ")},(0,l.getStrokeProps)(c?C:v),{strokeWidth:c?3:1,onClick:t=>{s(e,u.region,f.region,t)},onMouseOver:()=>{o||d(!0)},onMouseOut:()=>{o||d(!1)}}))}return null})),K=(0,T.observer)((function({features:e,config:t,blockDefinitions:a,radius:r,bezierRadius:n,displayModel:o,onChordClick:i}){const{selectedFeatureId:s}=o||{},l=(0,p.useMemo)((()=>{const e={};for(const t of a){const a=t.region.elided?t.region.regions:[t.region];for(const r of a)e[r.refName]=t}return e}),[a]);return p.createElement("g",{"data-testid":"structuralVariantChordRenderer"},[...e.values()].map((e=>{const a=e.id(),o=String(s)===String(a);return p.createElement(Y,{key:a,feature:e,config:t,radius:r,bezierRadius:n,blocksForRefs:l,selected:o,onClick:i})})))})),Q=(0,i.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});var Z=a(67736);const ee=(0,i.ConfigurationSchema)("VariantFeatureWidget",{});var te=a(9342);function ae(e){const t=(0,te.n)(e);return s.types.compose(t,s.types.model("VariantFeatureWidget",{type:s.types.literal("VariantFeatureWidget"),descriptions:s.types.frozen()}))}var re=a(3496),ne=a(14129),oe=a(44728),ie=a(82088);class se extends ne.A{name="MultiVariantGetGenotypeMatrix";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{sources:n,mafFilter:o,regions:i,adapterConfig:s,sessionId:l}=r,c=(await(0,re.cK)(a,l,s)).dataAdapter,d=i[0],u=await(0,oe._)(c.getFeatures(d,r).pipe((0,ie.$)())),p=new Set,m=[];for(const e of u){let t=0,a=0;const r=e.get("genotypes");if(e.get("end")-e.get("start")<=10){for(const{name:e}of n){const n=r[e];p.add(n),"0|0"===n||"./."===n?a++:"1|0"===n||"0|1"===n?t++:"1|1"===n?(t++,a++):t++}t/n.length>o&&a/n.length<1-o&&m.push(e)}}const g=Object.fromEntries([...p].map(((e,t)=>[e,t]))),f={};for(const e of m){const t=e.get("genotypes");for(const{name:e}of n)f[e]||(f[e]={name:e,genotypes:[]}),f[e].genotypes.push(g[t[e]])}return f}}class le extends ne.A{name="MultiVariantGetSimplifiedFeatures";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{mafFilter:n,sources:o,regions:i,adapterConfig:s,sessionId:l}=r,{dataAdapter:c}=await(0,re.cK)(a,l,s),d=await(0,oe._)(c.getFeaturesInMultipleRegions(i,r).pipe((0,ie.$)())),u=new Set,p=[];for(const e of d){let t=0,a=0;const r=e.get("genotypes");if(e.get("end")-e.get("start")<=10){for(const{name:e}of o){const n=r[e];u.add(n),"0|0"===n||"./."===n?a++:"1|0"===n||"0|1"===n?t++:"1|1"===n?(t++,a++):t++}t/o.length>n&&a/o.length<1-n&&p.push(e)}}return p.map((e=>({id:e.id(),data:{start:e.get("start"),end:e.get("end"),refName:e.get("refName")}})))}}class ce extends ne.A{name="MultiVariantGetSources";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:n,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,re.cK)(a,i,o);return s.getSources(n,r)}}var de=a(58273),ue=a(1622),pe=a(58921);var me=a(47369);const ge=(0,i.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),fe=(0,i.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("VcfIndex",{indexType:{model:s.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0});var he=a(54702);class ye extends r.A{name="VariantsPlugin";install(e){var t;!function(e){e.addAdapterType((()=>new me.A({name:"VcfAdapter",displayName:"VCF adapter",configSchema:ge,getAdapterClass:()=>Promise.all([a.e(2598),a.e(8343)]).then(a.bind(a,98343)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new me.A({name:"VcfTabixAdapter",displayName:"VCF tabix adapter",configSchema:fe,getAdapterClass:()=>Promise.all([a.e(8120),a.e(6621)]).then(a.bind(a,66621)).then((e=>e.default))})))}(e),function(e){e.addWidgetType((()=>new Z.A({name:"VariantFeatureWidget",heading:"Feature details",configSchema:ee,stateModel:ae(e),ReactComponent:(0,p.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(3011),a.e(6157),a.e(1405),a.e(4144),a.e(8109)]).then(a.bind(a,88109))))})))}(e),(t=e).addTrackType((()=>{const e=(a=t,(0,i.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:(0,pe.createBaseTrackConfig)(a)}));var a;return new de.A({name:"VariantTrack",displayName:"Variant track",configSchema:e,stateModel:(0,ue.createBaseTrackModel)(t,"VariantTrack",e)})})),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="VcfTabixAdapter",o=(0,c.getFileName)(t),i=a&&(0,c.getFileName)(a),s={type:n,vcfGzLocation:t,index:{location:a||(0,c.makeIndex)(t,".tbi"),indexType:(0,c.makeIndexType)(i,"CSI","TBI")}};return/\.vcf\.b?gz$/i.test(o)&&!r||r===n?s:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"VcfTabixAdapter"===t||"VcfAdapter"===t?"VariantTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="VcfAdapter",o=(0,c.getFileName)(t);return/\.vcf$/i.test(o)||r===n?{type:n,vcfLocation:t}:e(t,a,r)}))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:(0,d.lw)(e),explicitlyTyped:!0})}(e);return new n.A({name:"LinearVariantDisplay",displayName:"Variant display",configSchema:t,stateModel:u(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:d.GQ})}))}(e),function(e){e.addDisplayType((()=>{const t=N(e);return new n.A({name:"LinearVariantMatrixDisplay",displayName:"Multi-variant display (matrix)",configSchema:t,stateModel:B(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:R})}))}(e),function(e){e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("MultiVariantRenderer").configSchema;return(0,i.ConfigurationSchema)("MultiLinearVariantDisplay",{defaultRendering:{type:"stringEnum",model:s.types.enumeration("Rendering",["multivariant"]),defaultValue:"multivariant"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{MultiVariantRenderer:t}),height:{type:"number",defaultValue:200}},{baseConfiguration:(0,i.ConfigurationSchema)("SharedVariantDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:s.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:s.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:d.Ki,explicitlyTyped:!0}),explicitlyTyped:!0})}(e);return new n.A({name:"MultiLinearVariantDisplay",displayName:"Multi-variant display (regular)",configSchema:t,stateModel:C(0,t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,p.lazy)((()=>a.e(4699).then(a.bind(a,94699))))})}))}(e),function(e){e.addRendererType((()=>new G({name:"MultiVariantRenderer",ReactComponent:W,configSchema:U,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new O({name:"LinearVariantMatrixRenderer",displayName:"Linear variant matrix renderer",ReactComponent:S.PrerenderedCanvas,configSchema:I,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new q.A({name:"StructuralVariantChordRenderer",displayName:"SV chord renderer",ReactComponent:K,configSchema:Q,pluginManager:e})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("ChordVariantDisplay",{renderer:s.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:o.kO,explicitlyTyped:!0})}(e),a=(e=>s.types.compose("ChordVariantDisplay",o.dg,s.types.model({type:s.types.literal("ChordVariantDisplay"),configuration:(0,i.ConfigurationReference)(e)})).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},renderProps(){const t=(0,l.getContainingView)(e);return{...(0,c.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:e.blockDefinitions,config:e.configuration.renderer,onChordClick:t=>{e.onChordClick(t)}}}}))))(t);return new n.A({name:"ChordVariantDisplay",displayName:"Chord variant display",configSchema:t,stateModel:a,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:o.DO})}))}(e),e.addRpcMethod((()=>new ce(e))),e.addRpcMethod((()=>new se(e))),e.addRpcMethod((()=>new le(e)))}}},98054:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(7552),n=a(99546),o=a(68446);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},i.apply(null,arguments)}const s=e=>{const{color:t="rgb(255,255,255)"}=e;return r.createElement("rect",i({pointerEvents:"auto"},e,(0,n.getFillProps)(t)))},l=(0,o.observer)((function({model:e,labelWidth:t}){const{canDisplayLabels:a,rowHeight:o,sources:i}=e,l=(0,n.clamp)(o,8,12),c=t+15+5;return i?r.createElement(r.Fragment,null,a?r.createElement(s,{y:0,x:0,width:c,height:(i.length+.25)*o}):null,i.map(((e,t)=>{const{color:n,name:i}=e;return r.createElement(r.Fragment,{key:`${i}-${t}`},n?r.createElement(s,{y:t*o+1,x:0,width:15.5,height:o+.5,color:n}):null,a?r.createElement("text",{y:t*o+l,x:17,fontSize:l},i):null)}))):null})),c=(0,o.observer)((function({children:e,model:t,exportSVG:a}){const{id:o,scrollTop:i,height:s}=t,l=`legend-${o}`;return a?r.createElement(r.Fragment,null,r.createElement("defs",null,r.createElement("clipPath",{id:l},r.createElement("rect",{x:0,y:0,width:1e3,height:s}))),r.createElement("g",{clipPath:`url(#${l})`},r.createElement("g",{transform:`translate(0,${-i})`},e))):r.createElement("svg",{style:{position:"absolute",top:0,left:0,zIndex:100,pointerEvents:"none",height:t.totalHeight,width:(0,n.getContainingView)(t).width}},e)})),d=(0,o.observer)((function(e){const{model:t}=e,{canDisplayLabels:a,rowHeight:o,sources:i}=t,s=(0,n.clamp)(o,8,12);return i?r.createElement(c,e,r.createElement(l,{model:t,labelWidth:Math.max(...i.map((e=>(0,n.measureText)(e.name,s)+10)).map((e=>a?e:20)))})):null}))},7080:(e,t,a)=>{"use strict";function r(e){return"0|0"===e||"0/0"===e?"#ccc":"1|0"===e||"0|1"===e||"0/1"===e||"1/0"===e?"teal":"1|1"===e||"1/1"===e?"blue":"#CBC3E3"}function n(e){let t=0;for(let a=0;a<e.length;a++)t+=e.charCodeAt(a);return`hsl(${10*t}, 20%, 50%)`}a.d(t,{RR:()=>r,XL:()=>n})},57266:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Tooltip:()=>o.A,default:()=>d});var r=a(7552),n=a(68446),o=a(88262),i=a(75429);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s.apply(null,arguments)}const l=e=>e.toLocaleString("en-US"),c=r.forwardRef((function({feature:e},t){const a=e.get("start")+1,n=e.get("end"),o=[e.get("refName"),e.get("name"),a===n?l(a):`${l(a)}..${l(n)}`].filter((e=>!!e)).join(":");return void 0!==e.get("summary")?r.createElement("div",{ref:t},o,r.createElement("br",null),"Max: ",(0,i.toP)(e.get("maxScore")),r.createElement("br",null),"Avg: ",(0,i.toP)(e.get("score")),r.createElement("br",null),"Min: ",(0,i.toP)(e.get("minScore"))):r.createElement("div",{ref:t},o,r.createElement("br",null),`${(0,i.toP)(e.get("score"))}`)})),d=(0,n.observer)((function(e){return r.createElement(o.A,s({TooltipContents:c},e))}))},98911:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(7552),n=a(68584),o=a(99546),i=a(20529),s=a(68446),l=a(90461);const c=(0,s.observer)((e=>{const{model:t}=e,{stats:a,height:s,needsScalebar:c}=t,{trackLabels:d}=(0,o.getContainingView)(t),u=(0,o.getContainingTrack)(t),p="overlapping"===d?(0,o.measureText)((0,n.getConf)(u,"name"),12.8)+100:50;return r.createElement("div",null,r.createElement(i.GQ,e),a&&c?r.createElement("svg",{style:{position:"absolute",top:0,left:p,pointerEvents:"none",height:s,width:50}},r.createElement(l.A,{model:t})):null)}))},88262:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(7552),n=a(9236),o=a(68446),i=a(75785),s=a(75429);const l=(0,i.n9)()({hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:s.YSCALEBAR_LABEL_OFFSET,cursor:"default",position:"absolute",pointerEvents:"none"}}),c=(0,o.observer)((function({model:e,height:t,clientMouseCoord:a,offsetMouseCoord:o,clientRect:i,TooltipContents:c,useClientY:d}){const{featureUnderMouse:u}=e,{classes:p}=l(),m=a[0]+5,g=d?a[1]:i?.top||0;return u?r.createElement(r.Fragment,null,r.createElement(r.Suspense,{fallback:null},r.createElement(n.A,{clientPoint:{x:m,y:g}},r.createElement(c,{model:e,feature:u}))),r.createElement("div",{className:p.hoverVertical,style:{left:o[0],height:t-2*s.YSCALEBAR_LABEL_OFFSET}})):null}))},27725:(e,t,a)=>{"use strict";a.d(t,{r:()=>V.default,m_:()=>B.default,er:()=>p,Ep:()=>C,Oy:()=>m.YSCALEBAR_LABEL_OFFSET,Ay:()=>be,$z:()=>m.getOrigin,X_:()=>m.getScale,_i:()=>F});var r=a(12678),n=a(91468),o=a(47369),i=a(68584);const s=(0,i.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier"}},{explicitlyTyped:!0});var l=a(7552),c=a(99546);const d=(0,l.lazy)((()=>a.e(9305).then(a.bind(a,69305))));var u=a(92880);class p extends u.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:a,regions:r,bpPerPx:n}=e,o=r[0],i=(o.end-o.start)/n,{reducedFeatures:s,...l}=await(0,c.renderToAbstractCanvas)(i,a,e,(a=>this.draw(a,{...e,features:t}))),d=await super.render({...e,...l,features:t,height:a,width:i});return{...d,...l,features:s?new Map(s.map((e=>[e.id(),e]))):d.features,height:a,width:i,containsNoTransferables:!0}}}var m=a(75429);function g(e,t){const{features:a,regions:r,bpPerPx:n,scaleOpts:o,height:s,config:l}=t,d=r[0],u=(0,i.readConfObject)(l,"bicolorPivot"),p=(0,i.readConfObject)(l,"bicolorPivotValue"),g=(0,i.readConfObject)(l,"negColor"),f=(0,i.readConfObject)(l,"posColor"),h=(0,i.readConfObject)(l,"color"),y=(0,i.readConfObject)(l,"clipColor"),b="none"!==u&&"log"!==o.scaleType,w=(0,m.getScale)({...o,pivotValue:b?p:void 0,range:b?[g,"white",f]:["white",f]}),v="#f0f"===h?(e,t)=>w(t):(e,t)=>(0,i.readConfObject)(l,"color",{feature:e,score:t}),C=(0,m.getScale)({...o,range:[0,s]}).domain(),S=C[0],k=C[1];let T=Number.NEGATIVE_INFINITY,x=!1;const A=[];for(const t of a.values()){const[a,r]=(0,c.featureSpanPx)(t,d,n);Math.floor(a)!==Math.floor(T)&&(A.push(t),T=a);const o=t.get("score");x=x||o>k||o<S;const i=r-a+.3;e.fillStyle=v(t,o),e.fillRect(a,0,i,s)}if(e.save(),x){e.fillStyle=y;for(const t of a.values()){const[a,r]=(0,c.featureSpanPx)(t,d,n),i=r-a+.3,s=t.get("score");(s>k||s<S&&"log"!==o.scaleType)&&(0,m.fillRectCtx)(a,0,i,2,e)}}return e.restore(),{reducedFeatures:A}}class f extends p{async draw(e,t){return g(e,t)}}var h=a(36422);const y=(0,i.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:h.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0}),b=(0,i.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:y,explicitlyTyped:!0});var w=a(49823),v=a(68446);const C=(0,v.observer)((function(e){const{regions:t,features:a,bpPerPx:r,width:n,height:o,onMouseLeave:i,onMouseMove:s,onFeatureClick:c}=e,d=t[0],u=(0,l.useRef)(null);function p(e){let t=0;u.current&&(t=u.current.getBoundingClientRect().left);const o=e-t,i=d.reversed?n-o:o,s=d.start+r*i;let l;for(const e of a.values())if(s<=e.get("end")+r&&s>=e.get("start")){l=e;break}return l}return l.createElement("div",{ref:u,"data-testid":"wiggle-rendering-test",onMouseMove:e=>s?.(e,p(e.clientX)?.id()),onClick:e=>c?.(e,p(e.clientX)?.id()),onMouseLeave:e=>i?.(e),style:{overflow:"visible",position:"relative",height:o}},l.createElement(w.PrerenderedCanvas,e))})),S=(0,i.ConfigurationSchema)("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:y,explicitlyTyped:!0});function k(e,t){const{features:a,regions:r,bpPerPx:n,scaleOpts:o,height:s,ticks:{values:l},displayCrossHatches:d,colorCallback:u,config:p,offset:g=0}=t,f=r[0],h=(f.end-f.start)/n,y=s-2*g,b=(0,i.readConfObject)(p,"clipColor"),w=(0,m.getScale)({...o,range:[0,y]}),v=w.domain(),C=v[0],S=v[1],k=e=>(0,c.clamp)(y-(w(e)||0),0,y)+g;let T,x=Number.NEGATIVE_INFINITY;const A=[];for(const t of a.values()){const[a,r]=(0,c.featureSpanPx)(t,f,n);Math.floor(a)!==Math.floor(x)&&(A.push(t),x=a);const i=t.get("score"),s=i<C,l=i>S,d=r-a+.3,p=u(t,i);e.beginPath(),e.strokeStyle=p;const m=void 0!==T?T:i;f.reversed?(e.moveTo(r,k(m)),e.lineTo(r,k(i)),e.lineTo(a,k(i))):(e.moveTo(a,k(m)),e.lineTo(a,k(i)),e.lineTo(r,k(i))),e.stroke(),T=i,l?(e.fillStyle=b,e.fillRect(a,g,d,2)):s&&"log"!==o.scaleType&&(e.fillStyle=b,e.fillRect(a,y-2,d,y))}return d&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",l.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(k(t))),e.lineTo(h,Math.round(k(t))),e.stroke()}))),{reducedFeatures:A}}class T extends p{async draw(e,t){const{config:a}=t,r=(0,i.readConfObject)(a,"color");return k(e,{...t,offset:m.YSCALEBAR_LABEL_OFFSET,colorCallback:"#f0f"===r?()=>"grey":e=>(0,i.readConfObject)(a,"color",{feature:e})})}}var x=a(56328),A=a(20529);function P(){return(0,i.ConfigurationSchema)("SharedWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:h.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:h.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:A.Ki,explicitlyTyped:!0})}var M=a(77126),E=a(37347);const R=(0,l.lazy)((()=>a.e(8615).then(a.bind(a,8615))));function I(e){return h.types.compose(A.Lr,h.types.model({selectedRendering:h.types.optional(h.types.string,""),resolution:h.types.optional(h.types.number,1),fill:h.types.maybe(h.types.boolean),minSize:h.types.maybe(h.types.number),color:h.types.maybe(h.types.string),posColor:h.types.maybe(h.types.string),negColor:h.types.maybe(h.types.string),summaryScoreMode:h.types.maybe(h.types.string),rendererTypeNameState:h.types.maybe(h.types.string),scale:h.types.maybe(h.types.string),autoscale:h.types.maybe(h.types.string),displayCrossHatches:h.types.maybe(h.types.boolean),constraints:h.types.optional(h.types.model({max:h.types.maybe(h.types.number),min:h.types.maybe(h.types.number)}),{}),configuration:(0,i.ConfigurationReference)(e)})).volatile((()=>({message:void 0,stats:void 0,statsFetchInProgress:void 0}))).actions((e=>({updateQuantitativeStats(t){const{currStatsBpPerPx:a,scoreMin:r,scoreMax:n}=t,o=1e-6;(!e.stats||Math.abs(e.stats.scoreMax-n)>o||Math.abs(e.stats.scoreMin-r)>o)&&(e.stats={currStatsBpPerPx:a,scoreMin:r,scoreMax:n})},setColor(t){e.color=t},setPosColor(t){e.posColor=t},setNegColor(t){e.negColor=t},setStatsLoading(t){e.statsFetchInProgress&&(0,E.CF)(e.statsFetchInProgress),e.statsFetchInProgress=t},selectFeature(t){const a=(0,c.getSession)(e);(0,c.isSelectionContainer)(a)&&a.setSelection(t)},setResolution(t){e.resolution=t},setFill(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale(){e.scale="log"===e.scale?"linear":"log"},setScaleType(t){e.scale=t},setSummaryScoreMode(t){e.summaryScoreMode=t},setAutoscale(t){e.autoscale=t},setMaxScore(t){e.constraints.max=t},setRendererType(t){e.rendererTypeNameState=t},setMinScore(t){e.constraints.min=t},toggleCrossHatches(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches(t){e.displayCrossHatches=t}}))).views((e=>({get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){return e.rendererTypeNameState??(0,i.getConf)(e,"defaultRendering")},get filters(){},get scaleType(){return e.scale??(0,i.getConf)(e,"scaleType")},get maxScore(){return e.constraints.max??(0,i.getConf)(e,"maxScore")},get minScore(){return e.constraints.min??(0,i.getConf)(e,"minScore")}}))).views((e=>({get adapterCapabilities(){const t=e.adapterTypeName,{pluginManager:a}=(0,c.getEnv)(e);return a.getAdapterType(t).adapterCapabilities},get rendererConfig(){const{color:t,displayCrossHatches:a,fill:r,minSize:n,negColor:o,posColor:s,summaryScoreMode:l,scaleType:d,rendererTypeName:u}=e,p=(0,i.getConf)(e,["renderers",u])||{};return e.rendererType.configSchema.create({...p,...d?{scaleType:d}:{},...void 0!==r?{filled:r}:{},...void 0!==a?{displayCrossHatches:a}:{},...void 0!==l?{summaryScoreMode:l}:{},...void 0!==t?{color:t}:{},...void 0!==o?{negColor:o}:{},...void 0!==s?{posColor:s}:{},...void 0!==n?{minSize:n}:{}},(0,c.getEnv)(e))},get autoscaleType(){return e.autoscale??(0,i.getConf)(e,"autoscale")}}))).views((e=>{let t=[0,0];return{get domain(){const{stats:a,scaleType:r,minScore:n,maxScore:o}=e;if(!a)return;const i=(0,m.getNiceDomain)({domain:[a.scoreMin,a.scoreMax],bounds:[n,o],scaleType:r});return"log"===r&&i[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(i)&&(t=i),t)}}})).views((e=>({get filled(){const{fill:t,rendererConfig:a}=e;return t??(0,i.readConfObject)(a,"filled")},get summaryScoreModeSetting(){const{summaryScoreMode:t,rendererConfig:a}=e;return t??(0,i.readConfObject)(a,"summaryScoreMode")},get scaleOpts(){return{domain:e.domain,stats:e.stats,autoscaleType:e.autoscaleType,scaleType:e.scaleType,inverted:(0,i.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get displayCrossHatchesSetting(){const{displayCrossHatches:t,rendererConfig:a}=e;return t??(0,i.readConfObject)(a,"displayCrossHatches")},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")}}))).views((e=>({scoreTrackMenuItems:()=>[...e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((t=>({label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:()=>{e.setSummaryScoreMode(t)}})))}]:[],{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:()=>{e.toggleLogScale()}},{label:"Autoscale type",subMenu:[["local","Local"],...e.hasGlobalStats?[["global","Global"],["globalsd","Global  3"]]:[],["localsd","Local  3"]].map((([t,a])=>({label:a,type:"radio",checked:e.autoscaleType===t,onClick:()=>{e.setAutoscale(t)}})))},{label:"Set min/max score",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[R,{model:e,handleClose:t}]))}}]}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),t()}}}))}const N=(0,l.lazy)((()=>Promise.resolve().then(a.bind(a,57266)))),L=(0,l.lazy)((()=>Promise.all([a.e(6395),a.e(3106)]).then(a.bind(a,23106)))),D=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),F=function(e,t){return h.types.compose("LinearWiggleDisplay",I(t),h.types.model({type:h.types.literal("LinearWiggleDisplay")})).views((e=>({get TooltipComponent(){return N},get rendererTypeName(){const t=e.rendererTypeNameSimple,a=D.get(t);if(!a)throw new Error(`unknown renderer ${t}`);return a},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,c.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx}}))).views((e=>{const{renderProps:t}=e;return{adapterProps(){const a=t(),{filters:r,resolution:n,scaleOpts:o}=e;return{...a,rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig,displayCrossHatches:e.displayCrossHatchesSetting,scaleOpts:o,resolution:n,filters:r}},get ticks(){const{scaleType:t,domain:a,height:r}=e,n=(0,i.getConf)(e,"minimalTicks"),o=(0,i.getConf)(e,"inverted");if(a){const e=(0,M.axisPropsFromTickScale)((0,m.getScale)({scaleType:t,domain:a,range:[r-m.YSCALEBAR_LABEL_OFFSET,m.YSCALEBAR_LABEL_OFFSET],inverted:o}),4);return r<100||n?{...e,values:a}:e}}}})).views((e=>({renderProps(){const{ticks:t,height:a}=e,r=e.adapterProps();return{...e.adapterProps(),notReady:r.notReady||!e.stats,height:a,ticks:t}},get needsScalebar(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get fillSetting(){return e.filled?0:1===e.minSize?1:2},get quantitativeStatsReady(){return(0,c.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error}}))).views((e=>{const{trackMenuItems:t}=e,a=(0,i.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,a)=>({label:t,type:"radio",checked:e.fillSetting===a,onClick:()=>{e.setFill(a)}})))}]:[],...e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[],...a?[{label:"Renderer type",subMenu:["xyplot","density","line"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}})))}]:[],{label:"Set color",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[L,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{const{getQuantitativeStatsAutorun:t}=await a.e(7722).then(a.bind(a,47722));t(e)})()},async renderSvg(r){const{renderSvg:n}=await a.e(1466).then(a.bind(a,51466));return n(e,r,t)}}}))};var B=a(57266),V=a(98911);const z=(0,i.ConfigurationSchema)("MultiDensityRenderer",{},{baseConfiguration:y,explicitlyTyped:!0}),O=(0,v.observer)((function(e){const{regions:t,features:a,bpPerPx:r,width:n,height:o,sources:i,onMouseLeave:s=()=>{},onMouseMove:d=()=>{},onFeatureClick:u=()=>{},displayModel:p}=e,m=t[0],g=(0,l.useRef)(null),{isMultiRow:f}=p||{};function h(e,t){if(!g.current)return;const s=g.current.getBoundingClientRect(),l=e-s.left,d=t-s.top,u=i[Math.floor(d/o*i.length)];if(!u)return;const p=m.reversed?n-l:l,h=m.start+r*p;let y;if(f){for(const e of a.values())if(e.get("source")===u.name&&h<=e.get("end")+r&&h>=e.get("start")){y=e;break}}else{const e=[];for(const t of a.values())h<=t.get("end")+r&&h>=t.get("start")&&e.push(t);if(e.length){const t=Math.floor(h);y=new c.SimpleFeature({uniqueId:"mouseoverfeat",sources:Object.fromEntries(e.map((e=>e.toJSON())).map((e=>{const{refName:t,start:a,end:r,source:n,...o}=e;return[n,o]}))),...m,start:t,end:t+1})}}return y}return l.createElement("div",{ref:g,onMouseMove:e=>{const{clientX:t,clientY:a}=e,r=h(t,a);d(e,r)},onClick:e=>{const{clientX:t,clientY:a}=e,r=h(t,a);u(e,r)},onMouseLeave:e=>{s(e)},style:{overflow:"visible",position:"relative",height:o}},l.createElement(w.PrerenderedCanvas,e))}));class H extends p{async draw(e,t){const{sources:a,features:r}=t,n=(0,c.groupBy)(r.values(),(e=>e.get("source"))),o=t.height/a.length;let i=[];return e.save(),a.forEach((a=>{const r=n[a.name]||[],{reducedFeatures:s}=g(e,{...t,features:r,height:o});e.translate(0,o),i=i.concat(s)})),e.restore(),{reducedFeatures:i}}}class G extends p{async draw(e,t){const{sources:a,features:r}=t,n=(0,c.groupBy)(r.values(),(e=>e.get("source")));let o=[];return a.forEach((a=>{const{reducedFeatures:r}=k(e,{...t,features:n[a.name]||[],colorCallback:()=>a.color||"blue"});o=o.concat(r)})),{reducedFeatures:o}}}const j=(0,i.ConfigurationSchema)("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:y,explicitlyTyped:!0});var W=a(40898),$=a(41365),U=a.n($);const q=(0,l.lazy)((()=>a.e(6021).then(a.bind(a,96021)))),_=(0,l.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(9948),a.e(6395),a.e(6932)]).then(a.bind(a,36932)))),J=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]),X=function(e,t){return h.types.compose("MultiLinearWiggleDisplay",I(t),h.types.model({type:h.types.literal("MultiLinearWiggleDisplay"),layout:h.types.optional(h.types.frozen(),[])})).volatile((()=>({sourcesLoadingStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0}))).actions((e=>({setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,E.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSources(t){U()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t}}))).views((e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return q},get rendererTypeName(){const t=e.rendererTypeNameSimple,a=J.get(t);if(!a)throw new Error(`unknown renderer ${t}`);return a}}))).views((e=>({get needsScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName},get needsFullHeightScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName},get isMultiRow(){return"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName||"MultiDensityRenderer"===e.rendererTypeName},get needsCustomLegend(){return"MultiDensityRenderer"===e.rendererTypeName},get canHaveFill(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName},get renderColorBoxes(){return!("MultiRowLineRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName)},get prefersOffset(){return this.isMultiRow},get sources(){const t=Object.fromEntries(e.sourcesVolatile?.map((e=>[e.name,e]))||[]),a=e.layout.length?e.layout:e.sourcesVolatile;return a?.map((e=>({...t[e.name],...e}))).map(((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":W.set1[t]||"#000000".replaceAll("0",(()=>(~~(16*Math.random())).toString(16))))})))},get quantitativeStatsReady(){return(0,c.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error}}))).views((e=>({get rowHeight(){const{sources:t,height:a,isMultiRow:r}=e;return r?a/(t?.length||1):a},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return(0,i.getConf)(e,"minimalTicks")||this.rowHeightTooSmallForScalebar}}))).views((e=>{const{renderProps:t}=e;return{adapterProps:()=>({...t(),displayModel:e,config:e.rendererConfig,filters:e.filters,resolution:e.resolution,rpcDriverName:e.rpcDriverName,sources:e.sources}),get ticks(){const{scaleType:t,domain:a,isMultiRow:r,rowHeight:n,useMinimalTicks:o}=e;if(!a)return;const s=r?0:m.YSCALEBAR_LABEL_OFFSET,l=(0,M.axisPropsFromTickScale)((0,m.getScale)({scaleType:t,domain:a,range:[n-s,s],inverted:(0,i.getConf)(e,"inverted")}),4);return o?{...l,values:a}:l},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,c.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx}}})).views((e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.stats,displayModel:e,rpcDriverName:e.rpcDriverName,displayCrossHatches:e.displayCrossHatches,height:e.height,ticks:e.ticks,stats:e.stats,scaleOpts:e.scaleOpts,onMouseMove:(t,a)=>{e.setFeatureUnderMouse(a)},onMouseLeave:()=>{e.setFeatureUnderMouse(void 0)}}},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:1===e.minSize?1:2}}))).views((e=>{const{trackMenuItems:t}=e,a=(0,i.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,a)=>({label:t,type:"radio",checked:e.fillSetting===a,onClick:()=>{e.setFill(a)}})))}]:[],...e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[],...a?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}})))}]:[],{label:"Edit colors/arrangement...",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[_,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const[{getMultiWiggleSourcesAutorun:t},{getQuantitativeStatsAutorun:r}]=await Promise.all([a.e(1439).then(a.bind(a,31439)),a.e(7722).then(a.bind(a,47722))]);r(e),t(e)}catch(t){(0,h.isAlive)(e)&&(console.error(t),(0,c.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(r){const{renderSvg:n}=await a.e(1531).then(a.bind(a,51531));return n(e,r,t)}}}))};var Y=a(58273),K=a(1622);class Q extends p{async draw(e,t){const{bpPerPx:a,sources:r,regions:n,features:o}=t,i=n[0],s=(0,c.groupBy)(o.values(),(e=>e.get("source"))),l=t.height/r.length,d=(i.end-i.start)/a;let u=[];return e.save(),r.forEach((a=>{const{reducedFeatures:r}=k(e,{...t,features:s[a.name]||[],height:l,colorCallback:()=>a.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,l),e.lineTo(d,l),e.stroke(),e.translate(0,l),u=u.concat(r)})),e.restore(),{reducedFeatures:u}}}const Z=(0,i.ConfigurationSchema)("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:y,explicitlyTyped:!0});var ee=a(87485);function te(e,t){const a=e.toHsl(),r=a.l*(1+t);return(0,ee.M)({...a,l:(0,c.clamp)(r,0,100)})}function ae(e,t){const a=e.toHsl(),r=a.l*(1-t);return(0,ee.M)({...a,l:(0,c.clamp)(r,0,100)})}const re=.3;function ne(e,t){const{features:a,bpPerPx:r,regions:n,scaleOpts:o,height:s,config:l,ticks:d,displayCrossHatches:u,offset:p=0,colorCallback:g}=t,f=n[0],h=(f.end-f.start)/r,y=s-2*p,b=(0,i.readConfObject)(l,"filled"),w=(0,i.readConfObject)(l,"clipColor"),v=(0,i.readConfObject)(l,"summaryScoreMode"),C=(0,i.readConfObject)(l,"bicolorPivotValue"),S=(0,i.readConfObject)(l,"minSize"),k=(0,m.getScale)({...o,range:[0,y]}),T=(0,m.getOrigin)(o.scaleType),x=k.domain(),A=x[0],P=x[1],M=e=>(0,c.clamp)(y-(k(e)||0),0,y)+p,R=e=>b?(e=>M(T)-M(e))(e):Math.max(S,1);let I=!1,N=Number.NEGATIVE_INFINITY;const L=[],D=A<C&&P>C;let F=performance.now();if("whiskers"===v){let t,n;F=performance.now();for(const o of a.values()){performance.now()-F>400&&((0,E.SW)(),F=performance.now());const[a,i]=(0,c.featureSpanPx)(o,f,r);if(o.get("summary")){const r=Math.max(i-a+re,S),s=o.get("maxScore"),l=g(o,s),c=D?l:l===t?n:n=te((0,ee.M)(l),.4).toHex();(0,m.fillRectCtx)(a,M(s),r,R(s),e,c),t=l}}n=void 0,t=void 0,F=performance.now();for(const o of a.values()){performance.now()-F>400&&((0,E.SW)(),F=performance.now());const[a,i]=(0,c.featureSpanPx)(o,f,r),s=o.get("score"),l=o.get("maxScore"),d=o.get("minScore"),u=o.get("summary"),p=g(o,s),h=D&&u?p===t?n:n=(0,ee.M)(g(o,l)).mix((0,ee.M)(g(o,d))).toString():p,y=Math.max(i-a+re,S);Math.floor(a)!==Math.floor(N)&&(L.push(o),N=a),I=I||s<A||s>P,(0,m.fillRectCtx)(a,M(s),y,R(s),e,h),t=p}n=void 0,t=void 0,F=performance.now();for(const o of a.values()){performance.now()-F>400&&((0,E.SW)(),F=performance.now());const[a,i]=(0,c.featureSpanPx)(o,f,r);if(o.get("summary")){const r=o.get("minScore"),s=g(o,r),l=Math.max(i-a+re,S),c=D?s:s===t?n:n=ae((0,ee.M)(s),.4).toHex();(0,m.fillRectCtx)(a,M(r),l,R(r),e,c),t=s}}}else{F=performance.now();for(const t of a.values()){performance.now()-F>400&&((0,E.SW)(),F=performance.now());const[a,n]=(0,c.featureSpanPx)(t,f,r);Math.floor(a)!==Math.floor(N)&&(L.push(t),N=a);const o=t.get("score"),i=g(t,o);I=I||o<A||o>P;const s=Math.max(n-a+re,S);if("max"===v){const r=t.get("summary")?t.get("maxScore"):o;(0,m.fillRectCtx)(a,M(r),s,R(r),e,i)}else if("min"===v){const r=t.get("summary")?t.get("minScore"):o;(0,m.fillRectCtx)(a,M(r),s,R(r),e,i)}else(0,m.fillRectCtx)(a,M(o),s,R(o),e,i)}}if(e.save(),I){e.fillStyle=w,F=performance.now();for(const t of a.values()){performance.now()-F>400&&((0,E.SW)(),F=performance.now());const[a,n]=(0,c.featureSpanPx)(t,f,r),i=n-a+re,l=t.get("score");l>P?(0,m.fillRectCtx)(a,p,i,2,e):l<A&&"log"!==o.scaleType&&(0,m.fillRectCtx)(a,s,i,2,e)}}return e.restore(),u&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",d.values.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(M(t))),e.lineTo(h,Math.round(M(t))),e.stroke()}))),{reducedFeatures:L}}class oe extends p{async draw(e,t){const{bpPerPx:a,sources:r,regions:n,features:o}=t,i=n[0],s=(0,c.groupBy)(o.values(),(e=>e.get("source"))),l=t.height/r.length,d=(i.end-i.start)/a;let u=[];return e.save(),r.forEach((a=>{const{reducedFeatures:r}=ne(e,{...t,features:s[a.name]||[],height:l,colorCallback:()=>a.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,l),e.lineTo(d,l),e.stroke(),e.translate(0,l),u=u.concat(r)})),e.restore(),{reducedFeatures:u}}}const ie=(0,i.ConfigurationSchema)("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:y,explicitlyTyped:!0}),se=(0,i.ConfigurationSchema)("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[],description:"array of subadapter JSON objects"},bigWigs:{type:"frozen",description:"array of bigwig filenames, alternative to the subadapters slot",defaultValue:[]}},{explicitlyTyped:!0});var le=a(58921);class ce extends p{async draw(e,t){const{sources:a,features:r}=t,n=(0,c.groupBy)(r.values(),(e=>e.get("source")));let o=[];for(const r of a){const a=n[r.name]||[],{reducedFeatures:i}=ne(e,{...t,features:a,offset:m.YSCALEBAR_LABEL_OFFSET,colorCallback:()=>r.color||"blue"});o=o.concat(i)}return{reducedFeatures:o}}}const de=(0,i.ConfigurationSchema)("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:y,explicitlyTyped:!0});var ue=a(3496),pe=a(14129);class me extends pe.A{name="MultiWiggleGetSources";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:n,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,ue.cK)(a,i,o);return s.getSources(n,r)}}class ge extends pe.A{name="WiggleGetMultiRegionQuantitativeStats";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:n,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,ue.cK)(a,i,o);return s.getMultiRegionQuantitativeStats(n,r)}}class fe extends pe.A{name="WiggleGetGlobalQuantitativeStats";async execute(e,t){const a=this.pluginManager,r=await this.deserializeArguments(e,t),{adapterConfig:n,sessionId:o}=r,{dataAdapter:i}=await(0,ue.cK)(a,o,n);return i.getGlobalStats(r)}}class he extends p{async draw(e,t){const{stopToken:a,features:r,config:n}=t,o=(0,i.readConfObject)(n,"bicolorPivotValue"),s=(0,i.readConfObject)(n,"negColor"),l=(0,i.readConfObject)(n,"posColor");return ne(e,{...t,colorCallback:"#f0f"===(0,i.readConfObject)(n,"color")?(e,t)=>t<o?s:l:(e,t)=>(0,i.readConfObject)(n,"color",{feature:e}),offset:m.YSCALEBAR_LABEL_OFFSET,features:[...r.values()],stopToken:a})}}const ye=(0,i.ConfigurationSchema)("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:y,explicitlyTyped:!0});class be extends r.A{name="WigglePlugin";install(e){e.addAdapterType((()=>new o.A({name:"MultiWiggleAdapter",displayName:"Multi-wiggle adapter",configSchema:se,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(1822).then(a.bind(a,31822)).then((e=>e.default))}))),e.addAdapterType((()=>new o.A({name:"BigWigAdapter",displayName:"BigWig adapter",configSchema:s,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>Promise.all([a.e(3902),a.e(4234)]).then(a.bind(a,14234)).then((e=>e.default))}))),function(e){e.addTrackType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:(0,K.createBaseTrackConfig)(e)})}(e);return new Y.A({name:"QuantitativeTrack",displayName:"Quantitative track",configSchema:t,stateModel:(0,K.createBaseTrackModel)(e,"QuantitativeTrack",t)})}))}(e),function(e){e.addTrackType((()=>{const t=(e=>(0,i.ConfigurationSchema)("MultiQuantitativeTrack",{},{baseConfiguration:(0,K.createBaseTrackConfig)(e)}))(e);return new Y.A({name:"MultiQuantitativeTrack",displayName:"Multi-quantitative track",configSchema:t,stateModel:(0,K.createBaseTrackModel)(e,"MultiQuantitativeTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("XYPlotRenderer").configSchema,a=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return(0,i.ConfigurationSchema)("LinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:h.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:a,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:P(),explicitlyTyped:!0})}(e),r=F(e,t);return new x.A({name:"LinearWiggleDisplay",displayName:"Wiggle display",configSchema:t,stateModel:r,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,l.lazy)((()=>Promise.resolve().then(a.bind(a,98911))))})}))}(e),function(e){e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("MultiXYPlotRenderer").configSchema,a=e.getRendererType("MultiDensityRenderer").configSchema,r=e.getRendererType("MultiRowXYPlotRenderer").configSchema,n=e.getRendererType("MultiLineRenderer").configSchema,o=e.getRendererType("MultiRowLineRenderer").configSchema;return(0,i.ConfigurationSchema)("MultiLinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:h.types.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:a,MultiRowXYPlotRenderer:r,MultiLineRenderer:n,MultiRowLineRenderer:o}),height:{type:"number",defaultValue:200}},{baseConfiguration:P(),explicitlyTyped:!0})}(e);return new x.A({name:"MultiLinearWiggleDisplay",displayName:"Multi-wiggle display",configSchema:t,stateModel:X(0,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,l.lazy)((()=>a.e(8526).then(a.bind(a,8526))))})}))}(e),function(e){e.addRendererType((()=>new T({name:"LinePlotRenderer",ReactComponent:C,configSchema:S,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new he({name:"XYPlotRenderer",ReactComponent:C,configSchema:ye,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new f({name:"DensityRenderer",ReactComponent:C,configSchema:b,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new ce({name:"MultiXYPlotRenderer",ReactComponent:O,configSchema:de,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new oe({name:"MultiRowXYPlotRenderer",ReactComponent:O,configSchema:ie,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new H({name:"MultiDensityRenderer",ReactComponent:O,configSchema:z,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new G({name:"MultiLineRenderer",ReactComponent:O,configSchema:j,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new Q({name:"MultiRowLineRenderer",ReactComponent:O,configSchema:Z,pluginManager:e})))}(e),function(e){e.addAddTrackWorkflowType((()=>new le.AddTrackWorkflowType({name:"Multi-wiggle track",ReactComponent:(0,l.lazy)((()=>a.e(2018).then(a.bind(a,52018)))),stateModel:h.types.model({})})))}(e),function(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",((e,t)=>{const{session:a}=t;return[...e,...(0,c.isSessionWithAddTracks)(a)?[{label:"Create multi-wiggle track",onClick:e=>{const t=e.selection;(0,c.getSession)(e).queueDialog((a=>[d,{tracks:t,onClose:(t,r)=>{t&&r&&function({model:e,arg:t}){const a=e.selection,r=a.map((e=>(0,i.readConfObject)(e,"name"))),n=a.map((e=>(0,i.readConfObject)(e,"adapter"))).map(((e,t)=>({...e,source:r[t]}))),o=`multitrack-${+Date.now()}-sessionTrack`,s=(0,c.getSession)(e);(0,c.isSessionWithAddTracks)(s)&&(s.addTrackConf({type:"MultiQuantitativeTrack",trackId:o,name:t.name,assemblyNames:[...new Set(a.flatMap((e=>(0,i.readConfObject)(e,"assemblyNames"))))],adapter:{type:"MultiWiggleAdapter",subadapters:n}}),e.view.showTrack(o))}({model:e,arg:r}),a()}}]))}}]:[]]}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const o="BigWigAdapter",i=(0,n.getFileName)(t),s={type:o,bigWigLocation:t};return/\.(bw|bigwig)$/i.test(i)&&!r||r===o?s:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BigWigAdapter"===t?"QuantitativeTrack":e(t))),e.addRpcMethod((()=>new fe(e))),e.addRpcMethod((()=>new ge(e))),e.addRpcMethod((()=>new me(e)))}exports={LinearWiggleDisplayReactComponent:V.default,XYPlotRendererReactComponent:C,XYPlotRenderer:he,WiggleBaseRenderer:p,linearWiggleDisplayModelFactory:F,xyPlotRendererConfigSchema:ye,utils:m}}},90461:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(7552),n=a(48231),o=a(68446),i=a(77126);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s.apply(null,arguments)}const l=(0,o.observer)((function({model:e,orientation:t}){const{ticks:a}=e,o=(0,n.A)();return a?r.createElement(i.Axis,s({},a,{shadow:2,format:e=>e,style:{orient:"left"===t?i.LEFT:i.RIGHT},bg:o.palette.background.default,fg:o.palette.text.primary})):null}))},75429:(e,t,a)=>{"use strict";a.r(t),a.d(t,{YSCALEBAR_LABEL_OFFSET:()=>i,fillRectCtx:()=>p,getNiceDomain:()=>c,getOrigin:()=>l,getScale:()=>s,round:()=>u,toP:()=>d});var r=a(45824),n=a(35873),o=a(6754);const i=5;function s({domain:e=[],range:t=[],scaleType:a,pivotValue:i,inverted:s}){let l;const[c,d]=e;if(void 0===c||void 0===d)throw new Error("invalid domain");if("linear"===a)l=(0,r.A)();else if("log"===a)l=(0,n.A)().base(2);else{if("quantize"!==a)throw new Error("undefined scaleType");l=(0,o.A)()}l.domain(void 0!==i?[c,i,d]:[c,d]),l.nice();const[u,p]=t;if(void 0===u||void 0===p)throw new Error("invalid range");return l.range(s?t.slice().reverse():t),l}function l(e){return"log"===e?1:0}function c({scaleType:e,domain:t,bounds:a}){const[i,s]=a;let[l,c]=t;"linear"===e&&(c<0&&(c=0),l>0&&(l=0)),"log"===e&&l>=0&&c>1&&(l=1),void 0!==i&&i!==Number.MIN_VALUE&&(l=i),void 0!==s&&s!==Number.MAX_VALUE&&(c=s);const d=(e=>{if("linear"===e)return(0,r.A)();if("log"===e){const e=(0,n.A)();return e.base(2),e}if("quantize"===e)return(0,o.A)();throw new Error(`undefined scaleType ${e}`)})(e);return d.domain([l,c]),d.nice(),d.domain()}function d(e=0){return+(+e).toPrecision(6)}function u(e){return Math.round(1e5*e)/1e5}function p(e,t,a,r,n,o){a<0&&(e+=a,a=-a),r<0&&(t+=r,r=-r),o&&(n.fillStyle=o),n.fillRect(e,t,a,r)}},66514:(e,t,a)=>{"use strict";a.d(t,{A:()=>Yn});var r=a(42781),n=a(12678),o=a(40898),i=a(92880);class s extends i.default{}var l=a(7552),c=a(68584),d=a(99546),u=a(68446);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},p.apply(null,arguments)}const m=(0,l.lazy)((()=>a.e(2241).then(a.bind(a,72241))));function g({selectedFeatureId:e,region:t,bpPerPx:a,config:r,height:n,feature:o,onFeatureClick:i}){const[s,u]=(0,l.useState)(!1),[g,f]=(0,d.bpSpanPx)(o.get("start"),o.get("end"),t,a),h=o.id(),y=e&&String(e)===String(o.id()),b=y?"red":(0,c.readConfObject)(r,"color",{feature:o}),w=y?"red":"black",v=(0,c.readConfObject)(r,"label",{feature:o}),C=(0,c.readConfObject)(r,"caption",{feature:o}),S=(0,c.readConfObject)(r,"thickness",{feature:o})||2,k=Math.min((0,c.readConfObject)(r,"height",{feature:o})||100,n),T=l.createRef(),x=.5*k*.75+.375*k;return l.createElement("g",null,l.createElement("path",p({ref:T},(0,d.getStrokeProps)(b),{d:`M ${g} 0 C ${g} ${k}, ${f} ${k}, ${f} 0`,strokeWidth:S,fill:"transparent",onClick:e=>{i(e,h)},onMouseOver:()=>{u(!0)},onMouseLeave:()=>{u(!1)},pointerEvents:"stroke"})),s?l.createElement(l.Suspense,{fallback:null},l.createElement(m,{contents:C})):null,l.createElement("text",{x:g+(f-g)/2,y:x+3,stroke:"white",strokeWidth:"0.6em"},v),l.createElement("text",{x:g+(f-g)/2,y:x+3,stroke:w},v))}function f(e,t,a,r){const n=(r-90)*Math.PI/180;return{x:e+a*Math.cos(n),y:t+a*Math.sin(n)}}function h(e,t,a,r,n){const o=f(e,t,a,n),i=f(e,t,a,r),s=n-r<=180?"0":"1";return["M",o.x,o.y,"A",a,a,0,s,0,i.x,i.y].join(" ")}function y({selectedFeatureId:e,region:t,bpPerPx:a,config:r,onFeatureClick:n,feature:o}){const[i,s]=(0,l.useState)(!1),[u,g]=(0,d.bpSpanPx)(o.get("start"),o.get("end"),t,a),f=o.id(),y=e&&String(e)===String(o.id()),b=y?"red":(0,c.readConfObject)(r,"color",{feature:o}),w=y?"red":"black",v=(0,c.readConfObject)(r,"label",{feature:o}),C=(0,c.readConfObject)(r,"caption",{feature:o}),S=(0,c.readConfObject)(r,"thickness",{feature:o})||2,k=l.createRef(),T=(g-u)/2;return l.createElement("g",null,l.createElement("path",p({d:h(u+(g-u)/2,0,(g-u)/2,90,270)},(0,d.getStrokeProps)(b),{strokeWidth:S,fill:"transparent",onClick:e=>{n(e,f)},onMouseOver:()=>{s(!0)},onMouseLeave:()=>{s(!1)},ref:k,pointerEvents:"stroke"})),i?l.createElement(m,{contents:C}):null,l.createElement("text",{x:u+(g-u)/2,y:T+3,stroke:"white",strokeWidth:"0.6em"},v),l.createElement("text",{x:u+(g-u)/2,y:T+3,stroke:w},v))}function b({exportSVG:e,width:t,height:a,children:r}){return e?r:l.createElement("svg",{width:t,height:a},r)}const w=(0,u.observer)((function({features:e,config:t,regions:a,bpPerPx:r,height:n,exportSVG:o,displayModel:i,onFeatureClick:s}){const d=a[0],u=(d.end-d.start)/r,p="semicircles"===(0,c.readConfObject)(t,"displayMode"),{selectedFeatureId:m}=i||{};return l.createElement(b,{exportSVG:o,width:u,height:n},[...e.values()].map((e=>p?l.createElement(y,{key:e.id(),config:t,region:d,bpPerPx:r,selectedFeatureId:m,onFeatureClick:s,feature:e}):l.createElement(g,{key:e.id(),height:n,config:t,region:d,bpPerPx:r,selectedFeatureId:m,onFeatureClick:s,feature:e}))))}));var v=a(36422);const C=(0,c.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue",contextVariable:["feature"]},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')",contextVariable:["feature"]},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50",contextVariable:["feature"]},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},displayMode:{type:"enum",defaultValue:"arcs",model:v.types.enumeration("DisplayMode",["arcs","semicircles"]),description:"render semi-circles instead of arcs"}},{explicitlyTyped:!0});var S=a(58921),k=a(20529);function T(e){return v.types.compose("LinearArcDisplay",k.Lr,v.types.model({type:v.types.literal("LinearArcDisplay"),configuration:(0,c.ConfigurationReference)(e),displayMode:v.types.maybe(v.types.string)})).views((e=>({get blockType(){return"staticBlocks"},get renderDelay(){return 500},get rendererTypeName(){return e.configuration.renderer.type}}))).views((e=>({get displayModeSetting(){return e.displayMode??(0,c.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,c.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,displayMode:e.displayModeSetting},(0,d.getEnv)(e))}}))).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.rendererConfig,height:e.height})}})).actions((e=>({setDisplayMode(t){e.displayMode=t}}))).views((e=>{const t=e.trackMenuItems;return{trackMenuItems:()=>[...t(),{label:"Display mode",subMenu:[{type:"radio",label:"Arcs",onClick:()=>{e.setDisplayMode("arcs")},checked:"arcs"===e.displayMode},{type:"radio",label:"Semi-circles",onClick:()=>{e.setDisplayMode("semicircles")},checked:"semicircles"===e.displayMode}]}]}}))}function x(e){return v.types.compose("LinearPairedArcDisplay",S.BaseDisplay,(0,k._e)(),(0,k.e6)(),v.types.model({type:v.types.literal("LinearPairedArcDisplay"),configuration:(0,c.ConfigurationReference)(e),displayMode:v.types.maybe(v.types.string)})).volatile((()=>({lastDrawnOffsetPx:0,features:void 0,loading:!1,drawn:!0}))).views((e=>({get displayModeSetting(){return e.displayMode??(0,c.getConf)(e,["renderer","displayMode"])}}))).actions((e=>({selectFeature(t){const a=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(a)){const r=a.addWidget("VariantFeatureWidget","variantFeature",{view:(0,d.getContainingView)(e),track:(0,d.getContainingTrack)(e),featureData:t.toJSON()});a.showWidget(r)}(0,d.isSelectionContainer)(a)&&a.setSelection(t)},setLoading(t){e.loading=t},setFeatures(t){e.features=t},setDisplayMode(t){e.displayMode=t}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await a.e(3497).then(a.bind(a,93497));t(e)}catch(t){console.error(t),e.setError(t)}})()},async renderSvg(t){const{renderArcSvg:r}=await a.e(4345).then(a.bind(a,44345));return r(e,t)}})))}class A extends n.A{name="ArcRenderer";install(e){!function(e){e.addRendererType((()=>new s({name:"ArcRenderer",ReactComponent:w,configSchema:C,pluginManager:e})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearArcDisplay",{renderer:v.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:k.Ki,explicitlyTyped:!0})}(e);return new S.DisplayType({name:"LinearArcDisplay",displayName:"Arc display",configSchema:t,stateModel:T(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:k.GQ})}))}(e),function(e){e.addDisplayType((()=>{const e=(0,c.ConfigurationSchema)("LinearPairedArcDisplay",{color:{type:"color",description:"the color of the arcs",defaultValue:"jexl:defaultPairedArcColor(feature,alt)",contextVariable:["feature","alt"]}},{baseConfiguration:k.Ki,explicitlyTyped:!0});return new S.DisplayType({name:"LinearPairedArcDisplay",displayName:"Arc display",configSchema:e,stateModel:x(e),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,l.lazy)((()=>a.e(7126).then(a.bind(a,87126))))})}))}(e),e.jexl.addFunction("logThickness",((e,t)=>Math.log(e.get(t)+1))),e.jexl.addFunction("defaultPairedArcColor",((e,t)=>t?.startsWith("<DEL")?o.set1[0]:t?.startsWith("<DUP")?o.set1[1]:t?.startsWith("<INV")?o.set1[2]:t?.startsWith("<TRA")?o.set1[3]:t?.startsWith("<CNV")?o.set1[4]:o.set1[6]))}}var P=a(92070),M=a(1622);const E=(0,c.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},state:{description:"optional state for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint. can be 'token' or 'code'",type:"string",defaultValue:"code"}},{baseConfiguration:M.BaseInternetAccountConfig,explicitlyTyped:!0}),R=(0,c.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]}},{baseConfiguration:E,explicitlyTyped:!0});var I=a(35451);function N(e){return e.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}function L(e,t){try{const a=JSON.parse(e);return"invalid_grant"===a.error&&t(),a?.error_description??e}catch(e){}return e}function D(e,t){return e.refresh_token&&t(e.refresh_token),e.access_token}async function F({response:e,reason:t,statusText:a}){return[`HTTP ${e.status}`,t,a??await B(e)].filter((e=>!!e)).join(" - ")}async function B(e){try{return await e.text()}catch(t){return e.statusText}}const V=e=>M.InternetAccount.named("OAuthInternetAccount").props({type:v.types.literal("OAuthInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((()=>{let e;return{get codeVerifierPKCE(){if(e)return e;const t=new Uint8Array(32);return globalThis.crypto.getRandomValues(t),e=N(I.hp.from(t).toString("base64")),e}}})).views((e=>({get authEndpoint(){return(0,c.getConf)(e,"authEndpoint")},get tokenEndpoint(){return(0,c.getConf)(e,"tokenEndpoint")},get needsPKCE(){return(0,c.getConf)(e,"needsPKCE")},get clientId(){return(0,c.getConf)(e,"clientId")},get scopes(){return(0,c.getConf)(e,"scopes")},state:()=>(0,c.getConf)(e,"state"),get responseType(){return(0,c.getConf)(e,"responseType")},get refreshTokenKey(){return`${e.internetAccountId}-refreshToken`}}))).actions((e=>({storeRefreshToken(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:()=>localStorage.getItem(e.refreshTokenKey),async exchangeAuthorizationForAccessToken(t,a){const r=new URLSearchParams(Object.entries({code:t,grant_type:"authorization_code",client_id:e.clientId,redirect_uri:a,...e.needsPKCE?{code_verifier:e.codeVerifierPKCE}:{}})),n=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(!n.ok)throw new Error(await F({response:n,reason:"Failed to obtain token"}));return D(await n.json(),(e=>{this.storeRefreshToken(e)}))},async exchangeRefreshForAccessToken(t){const a=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Object.entries({grant_type:"refresh_token",refresh_token:t,client_id:e.clientId})).toString()});if(!a.ok){e.removeToken();const t=await a.text();throw new Error(await F({response:a,statusText:L(t,(()=>{this.removeRefreshToken()}))}))}return D(await a.json(),(e=>{this.storeRefreshToken(e)}))}}))).actions((e=>{let t,r;return{addMessageChannel(e,a){t=t=>{this.finishOAuthWindow(t,e,a)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},async finishOAuthWindow(t,a,r){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return void this.deleteMessageChannel();const n=t.data.redirectUri,o=n.replace("#","?"),i=new URL(o),s=i.search,l=new URLSearchParams(s);if(l.has("access_token")){const t=l.get("access_token");return t?(e.storeToken(t),void a(t)):void r(new Error("Error with token endpoint"))}if(l.has("code")){const t=l.get("code");if(!t)return void r(new Error("Error with authorization endpoint"));try{const r=await e.exchangeAuthorizationForAccessToken(t,i.origin+i.pathname);return e.storeToken(r),void a(r)}catch(e){return void(e instanceof Error?r(e):r(new Error(String(e))))}}n.includes("access_denied")?r(new Error("OAuth flow was cancelled")):n.includes("error")?r(new Error(`OAuth flow error: ${s}`)):this.deleteMessageChannel()},async useEndpointForAuthorization(t,r){const n=d.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,o={client_id:e.clientId,redirect_uri:n,response_type:e.responseType,token_access_type:"offline"};e.state()&&(o.state=e.state()),e.scopes&&(o.scope=e.scopes),e.needsPKCE&&(o.code_challenge=await async function(e){const t=await Promise.all([a.e(7753),a.e(8424)]).then(a.t.bind(a,27181,23)).then((e=>e.default));return N((await Promise.all([a.e(7753),a.e(6435)]).then(a.t.bind(a,29038,23))).stringify(t(e)))}(e.codeVerifierPKCE),o.code_challenge_method="S256");const i=new URLSearchParams(Object.entries(o)),s=new URL(e.authEndpoint);s.search=i.toString();const l=`JBrowseAuthWindow-${e.internetAccountId}`;if(d.isElectron){const{ipcRenderer:a}=window.require("electron"),n=await a.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:o,url:s.toString()}),i=new MessageEvent("message",{data:{name:l,redirectUri:n}});this.finishOAuthWindow(i,t,r)}else window.open(s,l,"width=500,height=600,left=0,top=0")},async getTokenFromUser(t,a){const r=e.retrieveRefreshToken();let n=!0;if(r)try{t(await e.exchangeRefreshForAccessToken(r)),n=!1}catch(t){console.error(t),e.removeRefreshToken()}n&&(this.addMessageChannel(t,a),this.useEndpointForAuthorization(t,a))},async validateToken(t,a){const n=e.addAuthHeaderToInit({method:"HEAD"},t),o=await fetch(a.uri,n);if(!o.ok){e.removeToken();const t=e.retrieveRefreshToken();if(t)try{r||(r=e.exchangeRefreshForAccessToken(t));const a=await r;return r=void 0,a}catch(e){console.error("Token could not be refreshed",e)}throw new Error(await F({response:o,reason:"Error validating token"}))}return t}}})).actions((e=>{const t=e.getFetcher;return{getFetcher(a){const r=t(a);return async(t,n)=>(a&&await e.validateToken(await e.getToken(a),a),r(t,n))}}}));var z=a(2859);function O(e){return l.createElement(z.A,e,l.createElement("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"}))}const H={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};async function G(e,t){let a="";try{const t=JSON.parse(await e.text()).error[".tag"];a=H[t]||t}catch(e){}return F({response:e,reason:t,statusText:a})}const j=e=>V(E).named("DropboxOAuthInternetAccount").props({type:v.types.literal("DropboxOAuthInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return l.createElement(O,null)},get selectorLabel(){return"Enter Dropbox share link"}}))).actions((e=>({getFetcher:t=>async(a,r)=>{const n=await e.getToken(t),o=e.addAuthHeaderToInit({...r,method:"POST"},n);o.headers.append("Dropbox-API-Arg",JSON.stringify({url:a}));const i=await fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",o);if(!i.ok)throw new Error(await G(i));return i},async validateToken(t,a){const r=await fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({url:a.uri})});if(!r.ok){const t=e.retrieveRefreshToken();if(t){e.removeRefreshToken();const r=await e.exchangeRefreshForAccessToken(t);return this.validateToken(r,a)}throw new Error(await G(r,"Token could not be validated"))}return t}}))),W=(0,c.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:M.BaseInternetAccountConfig,explicitlyTyped:!0});var $=a(49823),U=a(29499),q=a(1343),_=a(58507),J=a(5401);const X=({internetAccountId:e,handleClose:t})=>{const[a,r]=(0,l.useState)("");return l.createElement($.Dialog,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",onClose:()=>{t()},title:`Enter token for ${e}`},l.createElement(U.A,{style:{display:"flex",flexDirection:"column"}},l.createElement(q.A,{required:!0,label:"Enter Token",variant:"outlined",onChange:e=>{r(e.target.value)},margin:"dense",slotProps:{htmlInput:{"data-testid":"entry-externalToken"}}})),l.createElement(_.A,null,l.createElement(J.A,{variant:"contained",color:"primary",type:"submit",disabled:!a,onClick:()=>{a&&t(a)}},"Add"),l.createElement(J.A,{variant:"contained",color:"secondary",onClick:()=>{t()}},"Cancel")))},Y=e=>M.InternetAccount.named("ExternalTokenInternetAccount").props({type:v.types.literal("ExternalTokenInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,c.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,a){const{session:r}=(0,v.getRoot)(e);r.queueDialog((r=>[X,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):a(new Error("user cancelled entry")),r()}}]))},async validateToken(t,a){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),n=await fetch(a.uri,r);if(!n.ok){let e;try{e=await n.text()}catch(t){e=""}throw new Error(`Token could not be validated  ${n.status} ${e?` (${e})`:""}`)}return t}}))),K=(0,c.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:E,explicitlyTyped:!0});var Q=a(99834);class Z extends Q.RemoteFileWithRangeCache{constructor(e,t){super(e,t),this.statsPromise=this.fetch(e,{metadataOnly:!0}).then((e=>e.json()))}async fetch(e,t){return super.fetch(e,t)}async stat(){return this.statsPromise}}function ee(e){return l.createElement(z.A,e,l.createElement("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"}))}async function te(e,t){let a="";try{a=JSON.parse(await e.text()).error.message}catch(e){}return F({response:e,reason:t,statusText:a})}function ae(e){return`https://www.googleapis.com/drive/v3/files/${/[-\w]{25,}/.exec(e)}`}function re(e){return V(E).named("GoogleDriveOAuthInternetAccount").props({type:v.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return l.createElement(ee,null)},get selectorLabel(){return"Enter Google Drive share link"}}))).actions((e=>({getFetcher:t=>async(a,r)=>{const n=new URL(ae(String(a))),o=new URLSearchParams;r?.metadataOnly?o.append("fields","size"):o.append("alt","media"),n.search=o.toString();const i=await e.getToken(t),s=await fetch(n,e.addAuthHeaderToInit({...r,method:"GET",credentials:"same-origin"},i));if(!s.ok)throw new Error(await te(s));return s},openLocation(e){return new Z(e.uri,{fetch:this.getFetcher(e)})},async validateToken(e,t){const a=await fetch(ae(t.uri),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"}});if(!a.ok)throw new Error(await te(a,"Token could not be validated"));return e}})))}const ne=(0,c.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:M.BaseInternetAccountConfig,explicitlyTyped:!0});function oe({internetAccountId:e,handleClose:t}){const[a,r]=(0,l.useState)(""),[n,o]=(0,l.useState)("");return l.createElement($.Dialog,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",title:`Log in for ${e}`,onClose:()=>{t()}},l.createElement("form",{onSubmit:e=>{a&&n?t(btoa(`${a}:${n}`)):t(),e.preventDefault()}},l.createElement(U.A,{style:{display:"flex",flexDirection:"column"}},l.createElement(q.A,{required:!0,label:"Username",variant:"outlined",onChange:e=>{r(e.target.value)},margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-username"}}}),l.createElement(q.A,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",onChange:e=>{o(e.target.value)},margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-password"}}})),l.createElement(_.A,null,l.createElement(J.A,{variant:"contained",color:"primary",type:"submit"},"Submit"),l.createElement(J.A,{variant:"contained",color:"secondary",type:"submit",onClick:()=>{t()}},"Cancel"))))}const ie=e=>M.InternetAccount.named("HTTPBasicInternetAccount").props({type:v.types.literal("HTTPBasicInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,c.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,a){const{session:r}=(0,v.getRoot)(e);r.queueDialog((r=>[oe,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):a(new Error("User cancelled entry")),r()}}]))},async validateToken(t,a){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),n=await fetch(a.uri,r);if(!n.ok)throw new Error(await F({response:n,reason:"Error validating token"}));return t}})));class se extends n.A{name="AuthenticationPlugin";exports={OAuthConfigSchema:E,OAuthInternetAccountModelFactory:V,ExternalTokenConfigSchema:W,ExternalTokenInternetAccountModelFactory:Y,HTTPBasicConfigSchema:ne,HTTPBasicInternetAccountModelFactory:ie,DropboxOAuthConfigSchema:R,DropboxOAuthInternetAccountModelFactory:j,GoogleDriveOAuthConfigSchema:K,GoogleDriveOAuthInternetAccountModelFactory:re};install(e){e.addInternetAccountType((()=>new P.A({name:"OAuthInternetAccount",configSchema:E,stateModel:V(E)}))),e.addInternetAccountType((()=>new P.A({name:"ExternalTokenInternetAccount",configSchema:W,stateModel:Y(W)}))),e.addInternetAccountType((()=>new P.A({name:"HTTPBasicInternetAccount",configSchema:ne,stateModel:ie(ne)}))),e.addInternetAccountType((()=>new P.A({name:"DropboxOAuthInternetAccount",configSchema:R,stateModel:j(R)}))),e.addInternetAccountType((()=>new P.A({name:"GoogleDriveOAuthInternetAccount",configSchema:K,stateModel:re(K)})))}}var le=a(91468),ce=a(47369);const de=(0,c.ConfigurationSchema)("BedAdapter",{bedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0}),ue=(0,c.ConfigurationSchema)("BedGraphAdapter",{bedGraphLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0}),pe=(0,c.ConfigurationSchema)("BedGraphTabixAdapter",{bedGraphGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("VcfIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0}),me=(0,c.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0}),ge=(0,c.ConfigurationSchema)("BedpeAdapter",{bedpeLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedpe.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0}),fe=(0,c.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},aggregateField:{type:"string",description:"An attribute to aggregate features with",defaultValue:"geneName"}},{explicitlyTyped:!0});class he extends n.A{name="BedPlugin";install(e){!function(e){e.addAdapterType((()=>new ce.A({name:"BigBedAdapter",displayName:"BigBed adapter",configSchema:fe,getAdapterClass:()=>Promise.all([a.e(972),a.e(3902),a.e(6834)]).then(a.bind(a,6834)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"BedAdapter",displayName:"BED adapter",configSchema:de,getAdapterClass:()=>Promise.all([a.e(2598),a.e(972),a.e(4864)]).then(a.bind(a,34864)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"BedpeAdapter",displayName:"BEDPE adapter",configSchema:ge,getAdapterClass:()=>Promise.all([a.e(2598),a.e(14)]).then(a.bind(a,10014)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"BedTabixAdapter",displayName:"BED tabix adapter",configSchema:me,getAdapterClass:()=>Promise.all([a.e(8120),a.e(972),a.e(6214)]).then(a.bind(a,86214)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"BedGraphAdapter",displayName:"BedGraph adapter",configSchema:ue,getAdapterClass:()=>Promise.all([a.e(2598),a.e(4058)]).then(a.bind(a,54058)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"BedGraphTabixAdapter",displayName:"BedGraphTabix adapter",configSchema:pe,getAdapterClass:()=>Promise.all([a.e(8120),a.e(6800)]).then(a.bind(a,96800)).then((e=>e.default))})))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="BigBedAdapter",o=(0,le.getFileName)(t),i={type:n,bigBedLocation:t};return/\.(bb|bigbed)$/i.test(o)&&!r||r===n?i:e(t,a,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="BedpeAdapter",o=(0,le.getFileName)(t);return/\.bedpe(\.gz)?$/i.test(o)||r===n?{type:n,bedpeLocation:t}:e(t,a,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="BedTabixAdapter",o=(0,le.getFileName)(t),i=a&&(0,le.getFileName)(a);return/\.bed\.b?gz$/i.test(o)||r===n?{type:n,bedGzLocation:t,index:{location:a||(0,le.makeIndex)(t,".tbi"),indexType:(0,le.makeIndexType)(i,"CSI","TBI")}}:e(t,a,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="BedAdapter",o=(0,le.getFileName)(t);return/\.bed$/i.test(o)||r===n?{type:n,bedLocation:t}:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BedpeAdapter"===t?"VariantTrack":e(t)))}}var ye=a(8832);const be=(0,c.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),we=v.types.model("BreakpointAlignmentsWidget",{id:ye.ElementId,type:v.types.literal("BreakpointAlignmentsWidget"),featureData:v.types.frozen()}).actions((e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}})));var ve=a(75441),Ce=a(64502),Se=a(45465),ke=a(42489),Te=a(49473);const xe=(0,l.lazy)((()=>a.e(7790).then(a.bind(a,47790)))),Ae=new RegExp(/(\d+)[SH]$/),Pe=new RegExp(/^(\d+)([SH])/);function Me(e,t){return e.displays[0].searchFeatureByID?.(t.id())}async function Ee(e,t){const{views:a}=e,{rpcManager:r,assemblyManager:n}=(0,d.getSession)(e),o=e.views[0]?.assemblyNames[0];if(!o)return;if(!await n.waitForAssembly(o))return;const i=t.configuration.trackId;return Promise.all(a.map((async e=>(await r.call(i,"CoreGetFeatures",{adapterConfig:(0,c.getConf)(t,["adapter"]),sessionId:i,regions:e.staticBlocks.contentBlocks})).flat())))}function Re(e){return v.types.compose("BreakpointSplitView",M.BaseViewModel,v.types.model({type:v.types.literal("BreakpointSplitView"),height:v.types.optional(v.types.refinement("viewHeight",v.types.number,(e=>e>=40)),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:v.types.array(e.getViewType("LinearGenomeView").stateModel)})).volatile((()=>({width:800,matchedTrackFeatures:{}}))).views((e=>({async exportSvg(t={}){const{renderToSvg:r}=await Promise.all([a.e(5727),a.e(5668)]).then(a.bind(a,95668)),n=await r(e,t),o=new Blob([n],{type:"image/svg+xml"});(0,Se.saveAs)(o,t.filename||"image.svg")}}))).views((e=>({get matchedTracks(){return 1===e.views.length?e.views[0].tracks:(0,Te.y$)((e=>e.configuration.trackId),...e.views.map((e=>e.tracks)))},getMatchedTracks:t=>e.views.map((e=>e.getTrack(t))).filter((e=>!!e)),hasTranslocations(e){return[...this.getTrackFeatures(e).values()].find((e=>"translocation"===e.get("type")))},hasPairedFeatures(e){return[...this.getTrackFeatures(e).values()].find((e=>"paired_feature"===e.get("type")))},getTrackFeatures:t=>new Map(e.matchedTrackFeatures[t]?.flat().map((e=>[e.id(),e]))),getMatchedFeaturesInLayout(e,t){const a=this.getMatchedTracks(e);return t.map((e=>e.map((e=>{const t=a.findIndex((t=>Me(t,e)));return-1!==t?{feature:e,layout:Me(a[t],e),level:t,clipPos:(r=e.get("CIGAR"),n=e.get("strand"),-1===n?+(Ae.exec(r)||[])[1]||0:+(Pe.exec(r)||[])[1]||0)}:void 0;var r,n})).filter(d.notEmpty)))}}))).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,v.onAction)(e,(({name:t,path:a,args:r})=>{e.linkViews&&["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(t)&&a&&this.onSubviewAction(t,a,r)})))},onSubviewAction(t,a,r){e.views.forEach((e=>{(0,v.getPath)(e).endsWith(a)||e[t](r?.[0])}))},setWidth(t){e.width=t,e.views.forEach((e=>{e.setWidth(t)}))},removeView(t){e.views.remove(t)},toggleInteract(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews(){e.linkViews=!e.linkViews},setMatchedTrackFeatures(t){e.matchedTrackFeatures=t},reverseViewOrder(){e.views.reverse()}}))).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,ke.autorun)((async()=>{try{if(!e.views.every((e=>e.initialized)))return;e.setMatchedTrackFeatures(Object.fromEntries(await Promise.all(e.matchedTracks.map((async t=>[t.configuration.trackId,await Ee(e,t)])))))}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}})))},menuItems:()=>[...e.views.map(((e,t)=>[t,e.menuItems()])).map((e=>({label:`Row ${e[0]+1} view menu`,subMenu:e[1]}))),{label:"Reverse view order",onClick:()=>{e.reverseViewOrder()}},{label:"Show intra-view links",type:"checkbox",checked:e.showIntraviewLinks,onClick:()=>{e.toggleIntraviewLinks()}},{label:"Allow clicking alignment squiggles?",type:"checkbox",checked:e.interactToggled,onClick:()=>{e.toggleInteract()}},{label:"Link views",type:"checkbox",icon:ve.A,checked:e.linkViews,onClick:()=>{e.toggleLinkViews()}},{label:"Export SVG",icon:Ce.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[xe,{model:e,handleClose:t}]))}}]})))}class Ie extends n.A{name="BreakpointSplitViewPlugin";install(e){!function(e){e.addViewType((()=>new S.ViewType({name:"BreakpointSplitView",displayName:"Breakpoint split view",stateModel:Re(e),ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(5727),a.e(7348)]).then(a.bind(a,67348))))})))}(e),function(e){e.addWidgetType((()=>new S.WidgetType({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:be,stateModel:we,ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(3011),a.e(6157),a.e(1405),a.e(4144),a.e(5677)]).then(a.bind(a,90439))))})))}(e)}configure(){}}var Ne=a(48133);const Le=(0,c.ConfigurationSchema)("BlastTabularAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Query assembly is the first value in the array, target assembly is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},blastTableLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/blastTable.tsv",locationType:"UriLocation"}},columns:{type:"string",description:"Optional space-separated column name list. If custom columns were used in outfmt, enter them here exactly as specified in the command. At least qseqid, sseqid, qstart, qend, sstart, and send are required",defaultValue:"qseqid sseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore"}},{explicitlyTyped:!0}),De=(0,c.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Fe=(0,c.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Be=(0,c.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),Ve=(0,c.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),ze=(0,c.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Oe=(0,c.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),He=(0,c.ConfigurationSchema)("PairwiseIndexedPAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pifGzLocation:{type:"fileLocation",description:"location of pairwise tabix indexed PAF (pif)",defaultValue:{uri:"/path/to/data/file.pif.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.paf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0});class Ge extends n.A{name="ComparativeAdaptersPlugin";install(e){!function(e){e.addAdapterType((()=>new ce.A({name:"PAFAdapter",displayName:"PAF adapter",configSchema:Oe,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(5904).then(a.bind(a,35904)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"PairwiseIndexedPAFAdapter",displayName:"Pairwise indexed PAF adapter",configSchema:He,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([a.e(8120),a.e(3167)]).then(a.bind(a,23167)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"DeltaAdapter",displayName:"MUMmer delta adapter",configSchema:Fe,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(2820).then(a.bind(a,12820)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"ChainAdapter",displayName:"Liftover chain adapter",configSchema:De,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(8929).then(a.bind(a,98929)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"MCScanAnchorsAdapter",displayName:"MCScan anchors adapter",configSchema:Be,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(8965).then(a.bind(a,28965)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"MCScanSimpleAnchorsAdapter",displayName:"MCScan anchors.simple adapter",configSchema:Ve,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(9409).then(a.bind(a,69409)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"MashMapAdapter",displayName:"MashMap adapter",configSchema:ze,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(9449).then(a.bind(a,29449)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"BlastTabularAdapter",displayName:"Tabular BLAST output adapter",configSchema:Le,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(7439).then(a.bind(a,67439)).then((e=>e.default))})))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="PAFAdapter",o=(0,le.getFileName)(t);return/\.paf/i.test(o)||r===n?{type:n,pafLocation:t}:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"PAFAdapter"===t?"SyntenyTrack":e(t)))}}var je=a(59099),We=a(16574),$e=a(24006),Ue=a(2406),qe=a(37347);class _e extends Ue.A{name="ComparativeRender";async renameRegionsIfNeeded(e,t){return t.renameRegionsIfNeeded(e)}getRenderer(e){return this.pluginManager.getRendererType(e)}async serializeArguments(e,t){const{rendererType:a}=e,r=this.getRenderer(a),n=await super.serializeArguments(e,t),o=await this.renameRegionsIfNeeded(n,r);return"MainThreadRpcDriver"===t?o:r.serializeArgsInClient(o)}async execute(e,t){let a=e;"MainThreadRpcDriver"!==t&&(a=await this.deserializeArguments(e,t));const{sessionId:r,rendererType:n,stopToken:o}=a;if(!r)throw new Error("must pass a unique session id");(0,qe.SW)(o);const i=this.getRenderer(n);return"MainThreadRpcDriver"===t?i.render(a):i.renderInWorker(a)}async deserializeReturn(e,t,a){const r=await super.deserializeReturn(e,t,a);return"MainThreadRpcDriver"===a?r:this.getRenderer(t.rendererType).deserializeResultsInClient(r,t)}}var Je=a(56328);function Xe(){return Xe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Xe.apply(null,arguments)}const Ye=(0,u.observer)((function(e){const{model:t,children:a}=e,{offsetX:r=0,offsetY:n=0}=t.data||{},o=(0,d.getContainingView)(t),i=o.vview.offsetPx-n,s=-(o.hview.offsetPx-r);return l.createElement("div",{style:{position:"relative"}},l.createElement(t.ReactComponent2,Xe({},e,{style:{position:"absolute",top:i,left:s}})),a)})),Ke=Ye;var Qe=a(36715),Ze=a(75785);const et=(0,Ze.n9)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{backgroundColor:t,padding:"10px"},blockError:{backgroundColor:t,padding:"10px",color:"red"}}}));function tt(){const[e,t]=(0,l.useState)(!1),{classes:a}=et();return(0,l.useEffect)((()=>{const e=setTimeout((()=>{t(!0)}),300);return()=>{clearTimeout(e)}}),[]),e?l.createElement("div",{className:a.loading},l.createElement($.LoadingEllipses,null)):null}function at({messageText:e}){const{classes:t}=et();return l.createElement("div",{className:t.blockMessage},l.createElement(Qe.A,null,e))}function rt({error:e}){const{classes:t}=et();return l.createElement("div",{className:t.blockError},l.createElement(Qe.A,null,`${e}`))}const nt=(0,u.observer)((function({model:e,style:t}){return e.error?l.createElement(rt,{error:e.error,"data-testid":"reload_button"}):e.message?l.createElement(at,{messageText:e.message}):e.filled?e.shouldDisplay?l.createElement("div",{style:t},e.reactElement):null:l.createElement(tt,null)})),ot=nt;function it(e){const{rpcManager:t}=(0,d.getSession)(e),{rendererType:a}=e,{adapterConfig:r}=e,n=(0,d.getContainingView)(e);if((0,c.readConfObject)(e.configuration),(0,v.getSnapshot)(n),n.initialized){const{viewWidth:o,viewHeight:i,borderSize:s,borderX:l,borderY:c}=n;return{rendererType:a,rpcManager:t,renderProps:{...e.renderProps(),view:structuredClone((0,v.getSnapshot)(n)),width:o,height:i,borderSize:s,borderX:l,borderY:c,adapterConfig:r,rendererType:a.name,sessionId:(0,le.getRpcSessionId)(e),timeout:1e6}}}}function st(e){return v.types.compose("DotplotDisplay",M.BaseDisplay,v.types.model({type:v.types.literal("DotplotDisplay"),configuration:(0,c.ConfigurationReference)(e)}).volatile((()=>({stopToken:void 0,warnings:[],filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:ot})))).views((e=>({get shouldDisplay(){const{vview:t,hview:a}=(0,d.getContainingView)(e);return t.bpPerPx===e.data.bpPerPxY&&a.bpPerPx===e.data.bpPerPxX},get rendererTypeName(){return(0,c.getConf)(e,["renderer","type"])},renderProps:()=>({...(0,le.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}))).views((e=>({async renderSvg(t){const a=it(e);if(!a)return null;const{rendererType:r,rpcManager:n,renderProps:o}=a,i=await r.renderInClient(n,{...o,exportSVG:t,theme:t.theme||o.theme}),{hview:s,vview:c}=(0,d.getContainingView)(e),u=-s.offsetPx+i.offsetX,p=-c.offsetPx+i.offsetY;return l.createElement("g",{transform:`translate(${u} ${-p})`},l.createElement(d.ReactRendering,{rendering:i}))}}))).actions((e=>({afterAttach(){(0,d.makeAbortableReaction)(e,(()=>it(e)),(e=>async function(e){if(!e)return;const{rendererType:t,rpcManager:a,renderProps:r}=e,{reactElement:n,...o}=await t.renderInClient(a,r);return{reactElement:n,data:o,renderingComponent:t.ReactComponent}}(e)),{name:`${e.type} ${e.id} rendering`,delay:500,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading(t){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,e.stopToken=t},setMessage(t){e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,e.stopToken=void 0},setRendered(t){if(void 0===t)return;const{data:a,reactElement:r,renderingComponent:n}=t;e.warnings=a.warnings,e.filled=!0,e.message=void 0,e.reactElement=r,e.data=a,e.error=void 0,e.renderingComponent=n,e.stopToken=void 0},setError(t){console.error(t),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0,e.stopToken=void 0}})))}var lt=a(374);const{featurizeSA:ct,getClip:dt,getLength:ut,getLengthSansClipping:pt}=r.aF;var mt=a(57027),gt=a(7772),ft=a(90542),ht=a(29417),yt=a(97884),bt=a(93707);const wt=yt.A.extend((e=>{const t=ke.observable.box(1);return{views:{get dynamicBlocks(){return(0,bt.A)(e,!1,!1)},get scaleFactor(){return t.get()},get maxBpPerPx(){return e.totalBp/(e.width-50)},get minBpPerPx(){return.02},get maxOffset(){return e.displayedRegionsTotalPx-.2*e.width},get minOffset(){return.8*-e.width}},actions:{setScaleFactor(e){t.set(e)},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(t-e.width/2)}}}})),vt=wt.extend((e=>({views:{get width(){return(0,v.getParent)(e).viewWidth}}}))),Ct=wt.extend((e=>({views:{get width(){return(0,v.getParent)(e).viewHeight}}})));var St=a(90257);const kt=(0,l.lazy)((()=>a.e(8859).then(a.bind(a,78859)))),Tt=(0,l.lazy)((()=>Promise.resolve().then(a.bind(a,87686))));function xt(e){return(0,d.measureText)(e.slice(0,30))}function At(e,t,a){return(0,d.max)([...e.filter((e=>!a.has(e.key))).map((e=>xt(e.refName))),...e.filter((e=>!a.has(e.key))).map((e=>xt((0,d.getTickDisplayStr)(e.end,t))))])}class Pt extends mt.A{supportsSVG=!0;async renameRegionsIfNeeded(e){const t=this.pluginManager,a=t.rootModel?.session?.assemblyManager,{view:r,sessionId:n,adapterConfig:o}=e;async function i(e){if(!a)throw new Error("No assembly manager provided");return(await(0,d.renameRegionsIfNeeded)(a,{sessionId:n,adapterConfig:o,regions:e})).regions}return r.hview.displayedRegions=await i(r.hview.displayedRegions),r.vview.displayedRegions=await i(r.vview.displayedRegions),e}async render(e){const{width:t,height:r,view:{hview:n,vview:o}}=e,i=[t,r],s=[n,o].map(((e,t)=>{const a=wt.create(e);return a.setVolatileWidth(i[t]),a})),l=s[0],c=await this.getFeatures({...e,regions:l.dynamicBlocks.contentBlocks});l.setFeatures(c);const{drawDotplot:u}=await a.e(1752).then(a.bind(a,31752)),p=await(0,d.renderToAbstractCanvas)(t,r,e,(t=>u(t,{...e,views:s})));return{...await super.render({...e,...p,height:r,width:t}),...p,height:r,width:t,offsetX:s[0].dynamicBlocks.blocks[0]?.offsetPx||0,offsetY:s[1].dynamicBlocks.blocks[0]?.offsetPx||0,bpPerPxX:s[0].bpPerPx,bpPerPxY:s[1].bpPerPx}}}const Mt=(0,u.observer)((function(e){return l.createElement($.PrerenderedCanvas,e)})),Et=(0,c.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"blue"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:v.types.enumeration("colorBy",["identity","meanQueryIdentity","mappingQuality","strand","default"]),description:'Color by options:<br/>\n<ul>\n  <li>"identity" - the identity of the particular hit, similar to D-GENIES, use the other config slots \'thresholds\' and \'thresholdsPalette\' to define colors for this setting</li>\n  <li>"meanQueryIdentity" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>"mappingQuality" - uses mapping quality from PAF, some adapters don\'t have this setting</li>\n  <li>"strand" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>"default" - uses the \'color\' config slot</li>\n</ul>',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0});var Rt=a(63589);class It extends n.A{name="DotplotPlugin";install(e){var t;!function(e){e.addViewType((()=>{return new Rt.A({name:"DotplotView",displayName:"Dotplot view",stateModel:(t=e,v.types.compose("DotplotView",gt.A,v.types.model({id:ye.ElementId,type:v.types.literal("DotplotView"),height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:v.types.array(v.types.string),drawCigar:!0,hview:v.types.optional(vt,{}),vview:v.types.optional(Ct,{}),tracks:v.types.array(t.pluggableMstType("track","stateModel")),viewTrackConfigs:v.types.array(t.pluggableConfigSchemaType("track"))})).volatile((()=>({volatileWidth:void 0,volatileError:void 0,cursorMode:(0,d.localStorageGetItem)("dotplot-cursorMode")||"crosshair",showPanButtons:Boolean(JSON.parse((0,d.localStorageGetItem)("dotplot-showPanbuttons")||"true")),wheelMode:(0,d.localStorageGetItem)("dotplot-wheelMode")||"zoom",borderX:100,borderY:100}))).views((e=>({get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}))).views((e=>({get assemblyErrors(){const{assemblyManager:t}=(0,d.getSession)(e);return e.assemblyNames.map((e=>t.get(e)?.error)).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,d.getSession)(e);return e.assemblyNames.every((e=>t.get(e)?.initialized??!0))}}))).views((e=>({get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){const{hview:t}=e,{dynamicBlocks:a,staticBlocks:r,bpPerPx:n}=t;return a.contentBlocks.length>5?[]:(0,St.H2)(r.contentBlocks,n)},get vticks(){const{vview:t}=e,{dynamicBlocks:a,staticBlocks:r,bpPerPx:n}=t;return a.contentBlocks.length>5?[]:(0,St.H2)(r.contentBlocks,n)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps(){const t=(0,d.getSession)(e);return{...(0,le.getParentRenderProps)(e),drawCigar:e.drawCigar,highResolutionScaling:(0,c.getConf)(t,"highResolutionScaling")}}}))).actions((e=>({setShowPanButtons(t){e.showPanButtons=t},setWheelMode(t){e.wheelMode=t},setCursorMode(t){e.cursorMode=t},setDrawCigar(t){e.drawCigar=t},clearView(){e.hview.setDisplayedRegions([]),e.vview.setDisplayedRegions([]),e.assemblyNames=(0,v.cast)([]),e.tracks.clear()},setBorderX(t){e.borderX=t},setBorderY(t){e.borderY=t},setWidth:t=>(e.volatileWidth=t,e.volatileWidth),setHeight:t=>(e.height=t,e.height),setError(t){e.volatileError=t},zoomOut(){e.hview.zoomOut(),e.vview.zoomOut()},zoomIn(){e.hview.zoomIn(),e.vview.zoomIn()},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(t)){const a=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(a),a}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},showTrack(a,r={}){const n=t.pluggableConfigSchemaType("track"),o=(0,v.resolveIdentifier)(n,(0,v.getRoot)(e),a),i=t.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=t.getViewType(e.type),l=o.displays.find((e=>s.displayTypes.find((t=>t.name===e.type))));if(!l)throw new Error(`could not find a compatible display for view type ${e.type}`);const c=i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:l.type,configuration:l}]});e.tracks.push(c)},hideTrack(a){const r=t.pluggableConfigSchemaType("track"),n=(0,v.resolveIdentifier)(r,(0,v.getRoot)(e),a),o=e.tracks.filter((e=>e.configuration===n));return(0,ke.transaction)((()=>{o.forEach((t=>e.tracks.remove(t)))})),o.length},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setAssemblyNames(t,a){e.assemblyNames=(0,v.cast)([t,a])},setViews(t){e.hview=(0,v.cast)(t[0]),e.vview=(0,v.cast)(t[1])},getCoords(t,a){const[r,n]=(0,d.minmax)(a[0],t[0]),[o,i]=(0,d.minmax)(a[1],t[1]);return Math.abs(n-r)>3&&Math.abs(i-o)>3?[e.hview.pxToBp(r),e.hview.pxToBp(n),e.vview.pxToBp(e.viewHeight-o),e.vview.pxToBp(e.viewHeight-i)]:void 0},zoomInToMouseCoords(t,a){const r=this.getCoords(t,a);if(r){const[t,a,n,o]=r;e.hview.moveTo(t,a),e.vview.moveTo(o,n)}},showAllRegions(){e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx),e.vview.center(),e.hview.center()},onDotplotView(t,a){const r=this.getCoords(t,a);if(r){const[t,a,n,o]=r,i=(0,d.getSession)(e),s=wt.create({...(0,v.getSnapshot)(e.hview),minimumBlockWidth:0,interRegionPaddingWidth:0}),l=wt.create({...(0,v.getSnapshot)(e.vview),minimumBlockWidth:0,interRegionPaddingWidth:0});s.setVolatileWidth(e.hview.width),l.setVolatileWidth(e.vview.width),s.moveTo(t,a),l.moveTo(o,n),s.zoomTo(s.bpPerPx/(e.width/e.hview.width),0),l.zoomTo(l.bpPerPx/(e.width/e.vview.width),0);const c=e.tracks.map((e=>e.configuration.displays.find((e=>"LinearSyntenyDisplay"===e.type)))).filter((e=>!!e)).map((e=>{const t=(0,v.getParent)(e,2);return{type:t.type,configuration:t,displays:[{type:e.type,configuration:e}]}})),{id:u,...p}=(0,v.getSnapshot)(s),{id:m,...g}=(0,v.getSnapshot)(l),f={type:"LinearSyntenyView",views:[{type:"LinearGenomeView",tracks:[],hideHeader:!0,...p},{type:"LinearGenomeView",tracks:[],hideHeader:!0,...g}],tracks:c};i.addView("LinearSyntenyView",f)}}}))).actions((e=>({async exportSvg(t={}){const{renderToSvg:r}=await a.e(1266).then(a.bind(a,11266)),n=await r(e,t),o=new Blob([n],{type:"image/svg+xml"});(0,Se.saveAs)(o,t.filename||"image.svg")},beforeDestroy(){const t=(0,d.getSession)(e);for(const a in e.assemblyNames)t.removeTemporaryAssembly?.(a)},afterAttach(){(0,v.addDisposer)(e,(0,ke.autorun)((()=>{const{showPanButtons:t,wheelMode:a,cursorMode:r}=e;var n;"undefined"!=typeof localStorage&&(localStorage.setItem("dotplot-showPanbuttons",(n=t,JSON.stringify(n))),localStorage.setItem("dotplot-cursorMode",r),localStorage.setItem("dotplot-wheelMode",a))}))),(0,v.addDisposer)(e,(0,ke.autorun)((()=>{const t=(0,d.getSession)(e);if(void 0===e.volatileWidth||!e.assembliesInitialized)return;if(e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0)return;const a=[e.hview,e.vview];(0,ke.transaction)((()=>{e.assemblyNames.forEach(((e,r)=>{const n=t.assemblyManager.get(e);a[r].setDisplayedRegions(n?.regions||[])})),e.showAllRegions()}))}),{delay:1e3})),(0,v.addDisposer)(e,(0,ke.autorun)((function(){if(void 0===e.volatileWidth)return;const{vview:t,hview:a,viewHeight:r,viewWidth:n}=e,o=t.dynamicBlocks.contentBlocks,i=a.dynamicBlocks.contentBlocks,s=a.offsetPx,l=t.offsetPx,c=(0,St.rQ)(o,r,l),d=(0,St.rQ)(i,n,s),u=At(i,t.bpPerPx,d),p=At(o,a.bpPerPx,c);e.setBorderY(Math.max(u+40,50)),e.setBorderX(Math.max(p+40,50))})))},squareView(){const{hview:t,vview:a}=e,r=(t.bpPerPx+a.bpPerPx)/2,n=t.pxToBp(t.width/2),o=a.pxToBp(a.width/2);t.setBpPerPx(r),t.centerAt(n.coord,n.refName,n.index),a.setBpPerPx(r),a.centerAt(o.coord,o.refName,o.index)},squareViewProportional(){const{hview:t,vview:a}=e,r=t.width/a.width,n=(t.bpPerPx+a.bpPerPx)/2,o=t.pxToBp(t.width/2),i=a.pxToBp(a.width/2);t.setBpPerPx(n/r),t.centerAt(o.coord,o.refName,o.index),a.setBpPerPx(n),a.centerAt(i.coord,i.refName,i.index)}}))).views((e=>({menuItems(){const t=(0,d.getSession)(e);return[{label:"Return to import form",onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Tt,{model:e,handleClose:t}]))},icon:ht.A},{label:"Square view - same bp per pixel",onClick:()=>{e.squareView()}},{label:"Rectangular view - same total bp",onClick:()=>{e.squareView()}},{label:"Show all regions",onClick:()=>{e.showAllRegions()}},{label:"Export SVG",icon:Ce.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[kt,{model:e,handleClose:t}]))}},...(0,d.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:ft.xU}]:[]]},get error(){return e.volatileError||e.assemblyErrors}})))),ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(3552),a.e(3474)]).then(a.bind(a,63474))))});var t}))}(e),(t=e).addDisplayType((()=>{const e=function(e){return(0,c.ConfigurationSchema)("DotplotDisplay",{renderer:v.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(t);return new Je.A({name:"DotplotDisplay",displayName:"Dotplot display",configSchema:e,stateModel:st(e),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:Ke})})),function(e){e.addRendererType((()=>new Pt({name:"DotplotRenderer",configSchema:Et,ReactComponent:Mt,pluginManager:e})))}(e),function(e){e.addToExtensionPoint("LaunchView-DotplotView",(async({session:e,views:t,tracks:a=[]})=>{try{const r=e.addView("DotplotView",{}),n=t.map((e=>e.assembly));(0,ke.transaction)((()=>{r.setViews([{bpPerPx:.1,offsetPx:0},{bpPerPx:.1,offsetPx:0}]),r.setAssemblyNames(n[0],n[1])}));const o=[];if(a.forEach((e=>{!function(e,t,a){try{e.showTrack(t)}catch(e){if(!/Could not resolve identifier/.exec(`${e}`))throw e;a.push(t)}}(r,e,o)})),o.length)throw new Error(`Could not resolve identifiers: ${o.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}}))}(e),function(e){e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearPileupDisplay"===e.name){const{stateModel:t}=e,a=t.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const a=e.contextMenuFeature;return[...t(),...a?[{label:"Dotplot of read vs ref",icon:lt.A,onClick:()=>{!function(e,t){const a=(0,d.getSession)(t);try{const r=e.get("CIGAR"),n=dt(r,1),o=e.get("flags"),i=e.get("strand"),s=e.get("name"),l=`${s}_assembly_${Date.now()}`,{parentTrack:u}=t,[p]=(0,c.getConf)(u,"assemblyNames"),m=[p,l],g=`track-${Date.now()}`,f=`${s}_vs_${p}`,h=e.get("tags")?.SA,y=ct(h,e.id(),i,s,!0),b=ut(2048&o?y[0].CIGAR:r),w=[{...e.toJSON(),strand:1,mate:{refName:s,start:n,end:n+pt(r)}},...y].sort(((e,t)=>e.clipPos-t.clipPos));a.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:(0,d.sum)(w.map((e=>e.end-e.start)))/800,displayedRegions:(0,d.gatherOverlaps)(w.map(((e,t)=>{const{start:a,end:r,refName:n}=e;return{start:a,end:r,refName:n,index:t,assemblyName:p}})))},vview:{offsetPx:0,bpPerPx:b/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:l,start:0,end:b,refName:s}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:m,adapter:{type:"FromConfigAdapter",features:w},trackId:g,name:f}],assemblyNames:m,tracks:[{configuration:g,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:`${g}-DotplotDisplay`}]}],displayName:`${s} vs ${p}`})}catch(e){console.error(e),a.notifyError(`${e}`,e)}}(a,e)}}]:[]]}}}}));e.stateModel=a}return e}))}(e),e.addRpcMethod((()=>new _e(e)))}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:$e.A,onClick:e=>{e.addView("DotplotView",{})}})}}var Nt=a(58273);var Lt=a(27725);const Dt=(0,l.lazy)((()=>a.e(3384).then(a.bind(a,93384))));function Ft(e,t){return v.types.compose("SharedGCContentModel",(0,Lt._i)(e,t),v.types.model({windowSize:v.types.maybe(v.types.number),windowDelta:v.types.maybe(v.types.number)})).actions((e=>({setGCContentParams({windowSize:t,windowDelta:a}){e.windowSize=t,e.windowDelta=a}}))).views((e=>({get windowSizeSetting(){return e.windowSize??(0,c.getConf)(e,"windowSize")},get windowDeltaSetting(){return e.windowDelta??(0,c.getConf)(e,"windowDelta")}}))).views((e=>{const{trackMenuItems:t,adapterProps:a}=e;return{trackMenuItems:()=>[...t(),{label:"Change GC parameters",onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Dt,{model:e,handleClose:t}]))}}],adapterProps(){const t=(0,c.getConf)(e.parentTrack,"adapter");return{...a(),adapterConfig:{type:"GCContentAdapter",sequenceAdapter:t,windowSize:e.windowSizeSetting,windowDelta:e.windowDeltaSetting}}}}}))}class Bt extends n.A{name="GCContentPlugin";install(e){var t;!function(e){e.addAdapterType((()=>new ce.A({name:"GCContentAdapter",displayName:"GC content adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:(0,c.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:{type:"frozen",defaultValue:null},windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{explicitlyTyped:!0}),getAdapterClass:()=>a.e(9756).then(a.bind(a,49756)).then((e=>e.default))})))}(e),(t=e).addTrackType((()=>{const e=(e=>(0,c.ConfigurationSchema)("GCContentTrack",{},{baseConfiguration:(0,S.createBaseTrackConfig)(e)}))(t);return new Nt.A({name:"GCContentTrack",displayName:"GCContent track",configSchema:e,stateModel:(0,M.createBaseTrackModel)(t,"GCContentTrack",e)})})),function(e){e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearGCContentDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),a=function(e,t){return v.types.compose("LinearGCContentDisplay",Ft(e,t),v.types.model({type:v.types.literal("LinearGCContentDisplay")}))}(e,t);return new S.DisplayType({name:"LinearGCContentDisplay",configSchema:t,stateModel:a,displayName:"GC content display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:Lt.r})})),e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearGCContentTrackDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),a=function(e,t){return v.types.compose("LinearGCContentTrackDisplay",Ft(e,t),v.types.model({type:v.types.literal("LinearGCContentTrackDisplay")}))}(e,t);return new S.DisplayType({name:"LinearGCContentTrackDisplay",configSchema:t,stateModel:a,displayName:"GC content display",trackType:"GCContentTrack",viewType:"LinearGenomeView",ReactComponent:Lt.r})}))}(e)}}const Vt=(0,c.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0}),zt=(0,c.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region","contig"]}},{explicitlyTyped:!0});class Ot extends n.A{name="GFF3Plugin";install(e){!function(e){e.addAdapterType((()=>new S.AdapterType({name:"Gff3TabixAdapter",displayName:"GFF3 tabix adapter",configSchema:zt,getAdapterClass:()=>Promise.all([a.e(8120),a.e(2645),a.e(7409)]).then(a.bind(a,27409)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new S.AdapterType({name:"Gff3Adapter",displayName:"GFF3 adapter",configSchema:Vt,getAdapterClass:()=>Promise.all([a.e(2598),a.e(2645),a.e(7809)]).then(a.bind(a,37809)).then((e=>e.default))})))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="Gff3TabixAdapter",o=(0,le.getFileName)(t),i=a&&(0,le.getFileName)(a);return/\.gff3?\.b?gz$/i.test(o)||r===n?{type:n,bamLocation:t,gffGzLocation:t,index:{location:a||(0,le.makeIndex)(t,".tbi"),indexType:(0,le.makeIndexType)(i,"CSI","TBI")}}:e(t,a,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="Gff3Adapter",o=(0,le.getFileName)(t),i={type:n,gffLocation:t};return/\.gff3?$/i.test(o)&&!r||r===n?i:e(t,a,r)}))}(e)}}var Ht=a(11353),Gt=a(29948),jt=a(17037),Wt=a(95947),$t=a(23758),Ut=a(87485),qt=a(89003);const _t=(0,Ze.n9)()({bookmarkButton:{overflow:"hidden",position:"absolute",zIndex:1e3},highlight:{overflow:"hidden",height:"100%",position:"absolute"}}),Jt=(0,u.observer)((function({model:e}){const{classes:t}=_t(),a=(0,d.getSession)(e),{assemblyManager:r}=a,{bookmarkHighlightsVisible:n,bookmarkLabelsVisible:o}=e,i=a.widgets.get("GridBookmark");(0,l.useEffect)((()=>{i||a.addWidget("GridBookmarkWidget","GridBookmark")}),[a,i]);const s=new Set(e.assemblyNames);return n&&i?.bookmarks?i.bookmarks.filter((e=>s.has(e.assemblyName))).map((t=>{const a=r.get(t.assemblyName),n=a?.getCanonicalRefName(t.refName)??t.refName,o=e.bpToPx({refName:n,coord:t.start}),i=e.bpToPx({refName:n,coord:t.end});return o&&i?{width:Math.max(Math.abs(i.offsetPx-o.offsetPx),3),left:Math.min(o.offsetPx,i.offsetPx)-e.offsetPx,highlight:t.highlight,label:t.label,bookmark:t}:void 0})).filter(d.notEmpty).map((({left:e,width:r,highlight:n,label:s,bookmark:c},d)=>l.createElement(l.Fragment,{key:`${e}_${r}_${d}`},l.createElement("div",{className:t.highlight,id:"highlight",style:{left:e,width:r,background:n}}),o&&r>20?l.createElement("div",{className:t.bookmarkButton,style:{left:e}},l.createElement($t.A,{menuItems:[{label:"Open bookmark widget",onClick:()=>{a.showWidget(i)}},{label:"Turn off highlights",onClick:()=>{i.setBookmarkHighlightsVisible(!1)}},{label:"Remove bookmark",onClick:()=>{i.removeBookmarkObject(c)}}]},l.createElement(qt.A,{title:s,arrow:!0},l.createElement(Ht.A,{fontSize:"small",sx:{color:0!==(0,Ut.M)(n).alpha()?(0,Ut.M)(n).alpha(.8).toRgbString():(0,Ut.M)(n).alpha(0).toRgbString()}})))):null))):null})),Xt=Jt,Yt=(0,Ze.n9)()({highlight:{height:"100%",position:"absolute"}}),Kt=(0,u.observer)((function({model:e,overview:t}){const{cytobandOffset:a}=e,r=(0,d.getSession)(e),{classes:n}=Yt(),{assemblyManager:o}=r,{bookmarkHighlightsVisible:i,bookmarkLabelsVisible:s}=e,c=r.widgets.get("GridBookmark");(0,l.useEffect)((()=>{c||r.addWidget("GridBookmarkWidget","GridBookmark")}),[r,c]);const u=new Set(e.assemblyNames);return i&&c?.bookmarks?c.bookmarks.filter((e=>u.has(e.assemblyName))).map((e=>{const r=o.get(e.assemblyName),n=r?.getCanonicalRefName(e.refName)??e.refName,i=e.reversed,s=t.bpToPx({refName:n,coord:i?e.end:e.start}),l=t.bpToPx({refName:n,coord:i?e.start:e.end});return void 0!==s&&void 0!==l?{width:Math.abs(l-s),left:s+a,highlight:e.highlight,label:e.label}:void 0})).filter(d.notEmpty).map(((e,t)=>{const{left:a,width:r,highlight:o,label:i}=e;return l.createElement(qt.A,{key:`${JSON.stringify(e)}-${t}`,title:s?i:"",arrow:!0},l.createElement("div",{className:n.highlight,style:{left:a,width:r,background:o,borderLeft:`1px solid ${o}`,borderRight:`1px solid ${o}`}}))})):null})),Qt=Kt,Zt=v.types.compose(ye.Region,v.types.model("Label",{label:v.types.optional(v.types.string,""),highlight:v.types.optional(v.types.string,"rgba(247, 129, 192, 0.35)")})).actions((e=>({setLabel(t){e.label=t},setHighlight(t){e.highlight=t}}))),ea=v.types.model("SharedBookmarksModel",{sharedBookmarks:v.types.maybe(v.types.array(Zt))}),ta=()=>"undefined"!=typeof window?`bookmarks-${[window.location.host+window.location.pathname].join("-")}`:"empty",aa=(0,c.ConfigurationSchema)("GridBookmarkWidget",{});class ra extends n.A{name="GridBookmarkPlugin";install(e){(function(e){e.addWidgetType((()=>new S.WidgetType({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:aa,stateModel:v.types.model("GridBookmarkModel",{id:ye.ElementId,type:v.types.literal("GridBookmarkWidget"),bookmarks:v.types.optional(v.types.array(Zt),(()=>JSON.parse((0,d.localStorageGetItem)(ta())||"[]")))}).volatile((()=>({selectedBookmarks:[],selectedAssembliesPre:void 0}))).views((e=>({get bookmarkAssemblies(){return[...new Set(e.bookmarks.map((e=>e.assemblyName)))]},get validAssemblies(){const{assemblyManager:t}=(0,d.getSession)(e);return new Set(this.bookmarkAssemblies.filter((e=>t.get(e))))},get areBookmarksHighlightedOnAllOpenViews(){const{views:t}=(0,d.getSession)(e);return t.every((e=>!("bookmarkHighlightsVisible"in e)||e.bookmarkHighlightsVisible))},get areBookmarksHighlightLabelsOnAllOpenViews(){const{views:t}=(0,d.getSession)(e);return t.every((e=>!("bookmarkLabelsVisible"in e)||e.bookmarkLabelsVisible))}}))).views((e=>({get bookmarksWithValidAssemblies(){return e.bookmarks.filter((t=>e.validAssemblies.has(t.assemblyName)))}}))).views((e=>({get sharedBookmarksModel(){return ea.create({sharedBookmarks:JSON.parse(JSON.stringify(e.selectedBookmarks))})},get allBookmarksModel(){return ea.create({sharedBookmarks:JSON.parse(JSON.stringify(e.bookmarksWithValidAssemblies))})}}))).actions((e=>({setSelectedAssemblies(t){e.selectedAssembliesPre=t}}))).views((e=>({get selectedAssemblies(){return e.selectedAssembliesPre?.filter((t=>e.validAssemblies.has(t)))??[...e.validAssemblies]}}))).actions((e=>({importBookmarks(t){e.bookmarks=(0,v.cast)([...e.bookmarks,...t])},addBookmark(t){e.bookmarks.push(t)},removeBookmark(t){e.bookmarks.splice(t,1)},updateBookmarkLabel(e,t){e.correspondingObj.setLabel(t)},updateBookmarkHighlight(e,t){e.correspondingObj.setHighlight(t)},updateBulkBookmarkHighlights(t){e.selectedBookmarks.forEach((e=>{this.updateBookmarkHighlight(e,t)}))},setSelectedBookmarks(t){e.selectedBookmarks=t},setBookmarkedRegions(t){e.bookmarks=(0,v.cast)(t)},setBookmarkHighlightsVisible(t){const{views:a}=(0,d.getSession)(e);a.forEach((e=>{e.setBookmarkHighlightsVisible?.(t),e.views?.map((e=>{e.setBookmarkHighlightsVisible?.(t)}))}))},setBookmarkLabelsVisible(t){const{views:a}=(0,d.getSession)(e);a.forEach((e=>{e.setBookmarkLabelsVisible?.(t),e.views?.map((e=>{e.setBookmarkHighlightsVisible?.(t)}))}))}}))).actions((e=>({clearAllBookmarks(){e.setBookmarkedRegions(e.bookmarks.filter((t=>!e.validAssemblies.has(t.assemblyName))))},clearSelectedBookmarks(){for(const t of e.selectedBookmarks)e.bookmarks.remove(t.correspondingObj);e.selectedBookmarks=[]},removeBookmarkObject(t){e.bookmarks.remove(t)}}))).actions((e=>({afterAttach(){const t=ta();function a(a){if(a.key===t){const a=JSON.parse((0,d.localStorageGetItem)(t)||"[]");e.setBookmarkedRegions(a)}}window.addEventListener("storage",a),(0,v.addDisposer)(e,(()=>{window.removeEventListener("storage",a)})),(0,v.addDisposer)(e,(0,ke.autorun)((()=>{(0,d.localStorageSetItem)(t,JSON.stringify(e.bookmarks))})))}}))).postProcessSnapshot((e=>{const{bookmarks:t,...a}=e;return a})),ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(8093),a.e(6395),a.e(3199)]).then(a.bind(a,53199))))}))),function(e){e.addToExtensionPoint("LinearGenomeView-TracksContainerComponent",((e,{model:t})=>[...e||[],l.createElement(Xt,{key:"highlight_grid_bookmark",model:t})])),e.addToExtensionPoint("LinearGenomeView-OverviewScalebarComponent",((e,{model:t,overview:a})=>[...e||[],l.createElement(Qt,{key:"overview_highlight_grid_bookmark",model:t,overview:a})]))}(e)})(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,a=t.props({bookmarkHighlightsVisible:!0,bookmarkLabelsVisible:!0}).actions((e=>({setBookmarkHighlightsVisible(t){e.bookmarkHighlightsVisible=t},setBookmarkLabelsVisible(t){e.bookmarkLabelsVisible=t},activateBookmarkWidget(){const t=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(t)){let e=t.widgets.get("GridBookmark");return e||(e=t.addWidget("GridBookmarkWidget","GridBookmark")),t.showWidget(e),t.widgets.get("GridBookmark")}throw new Error("Could not open bookmark widget")}}))).actions((e=>({navigateNewestBookmark(){const t=(0,d.getSession)(e),a=e.activateBookmarkWidget();a.bookmarks.length?e.navTo(a.bookmarks.at(-1)):t.notify("There are no recent bookmarks to navigate to.","info")},bookmarkCurrentRegion(){if(e.id===(0,d.getSession)(e).focusedViewId){const t=e.getSelectedRegions(void 0,void 0),a=e.activateBookmarkWidget();if(!t.length)throw new Error("no region selected");a.addBookmark(t[0])}}}))).views((e=>{const t=e.menuItems,a=e.rubberBandMenuItems;return{menuItems:()=>[...t(),{type:"divider"},{label:"Bookmarks",icon:Gt.A,subMenu:[{label:"Open bookmark widget",icon:Gt.A,onClick:()=>e.activateBookmarkWidget()},{label:"Bookmark current region",icon:Ht.A,onClick:()=>{e.bookmarkCurrentRegion()}},{label:"Toggle bookmark highlights",icon:jt.A,type:"checkbox",checked:e.bookmarkHighlightsVisible,onClick:()=>{e.setBookmarkHighlightsVisible(!e.bookmarkHighlightsVisible)}},{label:"Toggle bookmark labels",icon:Wt.A,type:"checkbox",checked:e.bookmarkLabelsVisible,onClick:()=>{e.setBookmarkLabelsVisible(!e.bookmarkLabelsVisible)}}]}],rubberBandMenuItems:()=>[...a(),{label:"Bookmark region",icon:Ht.A,onClick:()=>{const{leftOffset:t,rightOffset:a}=e,r=e.getSelectedRegions(t,a),n=e.activateBookmarkWidget();if(!r.length)throw new Error("no regions selected");n.addBookmark(r[0])}}]}})).actions((e=>({afterCreate(){document.addEventListener("keydown",(t=>{const a=(t.ctrlKey||t.metaKey)&&t.shiftKey;a&&"KeyD"===t.code&&(t.preventDefault(),e.activateBookmarkWidget(),e.bookmarkCurrentRegion(),(0,d.getSession)(e).notify("Bookmark created.","success")),a&&"KeyM"===t.code&&(t.preventDefault(),e.navigateNewestBookmark())}))}})));e.stateModel=a}return e}))}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Bookmarks",icon:Gt.A,onClick:e=>{let t=e.widgets.get("GridBookmark");t||(t=e.addWidget("GridBookmarkWidget","GridBookmark")),e.showWidget(t)}})}}const na=(0,c.ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}}},{explicitlyTyped:!0});class oa extends n.A{name="GTFPlugin";install(e){e.addAdapterType((()=>new ce.A({name:"GtfAdapter",displayName:"GTF adapter",configSchema:na,getAdapterClass:()=>Promise.all([a.e(2598),a.e(1503)]).then(a.bind(a,61503)).then((e=>e.default))}))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="GtfAdapter",o=(0,le.getFileName)(t),i={type:n,gtfLocation:t};return/\.gtf(\.gz)?$/i.test(o)&&!r||r===n?i:e(t,a,r)}))}}const ia=(0,c.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier"}},{explicitlyTyped:!0});var sa=a(3496),la=a(198),ca=a(98506),da=a(44728),ua=a(82088);class pa extends la.default{supportsSVG=!0;async render(e){const{config:t,regions:r,bpPerPx:n}=e,o=r[0],i=(o.end-o.start)/n,s=(0,c.readConfObject)(t,"maxHeight"),l=await this.getFeatures(e),{makeImageData:d}=await a.e(9088).then(a.bind(a,49088)),u=await(0,ca.u1)(i,s,e,(t=>d(t,{...e,features:l,pluginManager:this.pluginManager})));return{...await super.render({...e,...u,features:l,region:e.regions[0],height:s,width:i}),...u,height:s,width:i}}async getFeatures(e){const{regions:t,sessionId:a,adapterConfig:r}=e,{dataAdapter:n}=await(0,sa.cK)(this.pluginManager,a,r);return await(0,da._)(n.getFeatures(t[0],e).pipe((0,ua.$)()))}}function ma(){return ma=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},ma.apply(null,arguments)}const ga=(0,u.observer)((function(e){const{width:t,height:a}=e,r=Math.ceil(t);return l.createElement("div",{style:{position:"relative",width:r,height:a}},l.createElement($.PrerenderedCanvas,ma({},e,{style:{position:"absolute",left:0,top:0}})))})),fa=(0,c.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:interpolate(count,scale)",contextVariable:["count","maxScore","baseColor","scale"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0});function ha(e){return v.types.compose("LinearHicDisplay",k.Lr,v.types.model({type:v.types.literal("LinearHicDisplay"),configuration:(0,c.ConfigurationReference)(e),resolution:v.types.optional(v.types.number,1),useLogScale:!1,colorScheme:v.types.maybe(v.types.string),activeNormalization:"KR"})).volatile((()=>({availableNormalizations:void 0}))).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps(){const a=e.rendererType.configSchema.create({...(0,c.getConf)(e,"renderer"),...e.colorScheme?{color:"jexl:interpolate(count,scale)"}:{}},(0,v.getEnv)(e));return{...t(),config:a,normalization:e.activeNormalization,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution,useLogScale:e.useLogScale,colorScheme:e.colorScheme}}}})).actions((e=>({setResolution(t){e.resolution=t},setUseLogScale(t){e.useLogScale=t},setColorScheme(t){e.colorScheme=t},setActiveNormalization(t){e.activeNormalization=t},setAvailableNormalizations(t){e.availableNormalizations=t}}))).views((e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Use log scale",type:"checkbox",checked:e.useLogScale,onClick:()=>{e.setUseLogScale(!e.useLogScale)}},{label:"Color scheme",type:"subMenu",subMenu:[{label:"Fall",onClick:()=>{e.setColorScheme("fall")}},{label:"Viridis",onClick:()=>{e.setColorScheme("viridis")}},{label:"Juicebox",onClick:()=>{e.setColorScheme("juicebox")}},{label:"Clear",onClick:()=>{e.setColorScheme(void 0)}}]},{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/2)}}]},...e.availableNormalizations?[{label:"Normalization scheme",subMenu:e.availableNormalizations.map((t=>({label:t,type:"checkbox",checked:t===e.activeNormalization,onClick:()=>{e.setActiveNormalization(t)}})))}]:[]]}})).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,ke.autorun)((async()=>{try{const{rpcManager:t}=(0,d.getSession)(e),a=(0,d.getContainingTrack)(e),r=(0,c.getConf)(a,"adapter"),{norms:n}=await t.call((0,c.getConf)(a,"trackId"),"CoreGetInfo",{adapterConfig:r});n&&e.setAvailableNormalizations(n)}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}})))}})))}class ya extends n.A{name="HicPlugin";install(e){!function(e){e.addAdapterType((()=>new S.AdapterType({name:"HicAdapter",displayName:"Hi-C adapter",configSchema:ia,getAdapterClass:()=>Promise.all([a.e(6514),a.e(5312)]).then(a.bind(a,75312)).then((e=>e.default))})))}(e),function(e){e.addRendererType((()=>new pa({name:"HicRenderer",ReactComponent:ga,configSchema:fa,pluginManager:e})))}(e),function(e){e.addTrackType((()=>{const t=(e=>(0,c.ConfigurationSchema)("HicTrack",{},{baseConfiguration:(0,S.createBaseTrackConfig)(e)}))(e);return new Nt.A({name:"HicTrack",displayName:"Hi-C track",configSchema:t,stateModel:(0,M.createBaseTrackModel)(e,"HicTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const t=(e=>(0,c.ConfigurationSchema)("LinearHicDisplay",{renderer:e.getRendererType("HicRenderer").configSchema},{baseConfiguration:k.Ki,explicitlyTyped:!0}))(e);return new S.DisplayType({name:"LinearHicDisplay",displayName:"Hi-C contact matrix display",configSchema:t,stateModel:ha(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:k.GQ})}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="HicAdapter",o=(0,le.getFileName)(t),i={type:n,hicLocation:t};return/\.hic/i.test(o)&&!r||r===n?i:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"HicAdapter"===t?"HicTrack":e(t)))}configure(e){const{jexl:t}=e;t.addFunction("alpha",((e,t)=>e.alpha(t))),t.addFunction("hsl",(e=>(0,Ut.M)(e.toHsl()))),t.addFunction("colorString",(e=>e.toHex())),t.addFunction("interpolate",((e,t)=>t(e)))}}const ba=v.types.model("Job",{name:v.types.string,statusMessage:v.types.maybe(v.types.string),progressPct:v.types.number}).volatile((()=>({cancelCallback(){}}))).actions((e=>({setCancelCallback(t){e.cancelCallback=t},setStatusMessage(t){e.statusMessage=t},setProgressPct(t){e.progressPct=t}}))),wa=(0,c.ConfigurationSchema)("JobsListWidget",{});class va extends n.A{name="JobsManagementPlugin";install(e){!function(e){e.addWidgetType((()=>new S.WidgetType({name:"JobsListWidget",heading:"Jobs list",configSchema:wa,stateModel:v.types.model("JobsListModel",{id:ye.ElementId,type:v.types.literal("JobsListWidget"),jobs:v.types.array(ba),finished:v.types.array(ba),queued:v.types.array(ba),aborted:v.types.array(ba)}).actions((e=>({addJob(t){const{cancelCallback:a}=t,r=e.jobs.push(t),n=e.jobs[r-1];return n.setCancelCallback(a),n},removeJob(t){const a=e.jobs.findIndex((e=>e.name===t)),r=e.jobs[a];return e.jobs.splice(a,1),r},addFinishedJob:t=>(e.finished.push(t),e.finished),addQueuedJob:t=>(e.queued.push(t),e.finished),addAbortedJob:t=>(e.aborted.push(t),e.aborted),removeQueuedJob(t){const a=e.queued.findIndex((e=>e.name===t)),r=e.queued[a];return e.queued.splice(a,1),r},updateJobStatusMessage(t,a){const r=e.jobs.find((e=>e.name===t));if(!r)throw new Error(`No job found with name ${t}`);r.setStatusMessage(a)},updateJobProgressPct(t,a){const r=e.jobs.find((e=>e.name===t));if(!r)throw new Error(`No job found with name ${t}`);r.setProgressPct(a)}}))),ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(3011),a.e(9168)]).then(a.bind(a,29168))))})))}(e)}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Jobs list",icon:ft.jT,onClick:e=>{if((0,d.isSessionModelWithWidgets)(e)){const{widgets:t}=e;let a=t.get("JobsList");a||(a=e.addWidget("JobsListWidget","JobsList")),e.showWidget(a)}}})}}var Ca=a(91612);const Sa=(0,c.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:M.baseConnectionConfig});function ka(e){return v.types.compose("JBrowse1Connection",(0,M.BaseConnectionModelFactory)(e),v.types.model({configuration:(0,c.ConfigurationReference)(Sa),type:v.types.literal("JBrowse1Connection")})).actions((e=>({async connect(){const t=(0,d.getSession)(e);try{const r=(0,c.getConf)(e,"dataDirLocation"),{fetchJb1:n}=await a.e(7911).then(a.bind(a,77911)),{convertTrackConfig:o}=await a.e(5998).then(a.bind(a,55998)),i=await n(r),s=(0,c.getConf)(e,"assemblyNames")[0];if(!s)throw new Error("assembly name required for JBrowse 1 connection");const l=t.assemblies.find((e=>(0,c.readConfObject)(e,"name")===s));if(!l)throw new Error(`Assembly "${s}" not found`);const d=(0,c.readConfObject)(l,["sequence","adapter"]),u=i.tracks?.map((e=>({...o(e,i.dataRoot||"",d),assemblyNames:[s]})));e.setTrackConfs(u)}catch(a){console.error(a),t.notifyError(`There was a problem connecting to the JBrowse 1 data directory "${e.name}". Please make sure you have entered a valid location. The error that was thrown is: "${a}"`,a),t.breakConnection?.(e.configuration)}}})))}var Ta=a(8024);const xa=(0,c.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),Aa=(0,c.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0});class Pa extends n.A{name="LegacyJBrowsePlugin";install(e){!function(e){e.addAdapterType((()=>new S.AdapterType({name:"NCListAdapter",displayName:"NCList adapter",configSchema:Aa,getAdapterClass:()=>a.e(3525).then(a.bind(a,33525)).then((e=>e.default))})))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="NCListAdapter",o=(0,le.getFileName)(t);return/trackData.jsonz?$/i.test(o)||r===n?{type:n,rootUrlTemplate:t}:e(t,a,r)}))}(e),function(e){e.addTextSearchAdapterType((()=>new Ta.A({name:"JBrowse1TextSearchAdapter",configSchema:xa,description:"A JBrowse 1 text search adapter",getAdapterClass:()=>a.e(8797).then(a.bind(a,58797)).then((e=>e.default))})))}(e),function(e){e.addConnectionType((()=>new Ca.A({name:"JBrowse1Connection",configSchema:Sa,stateModel:ka(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})))}(e)}}var Ma=a(24250);const Ea=(0,l.lazy)((()=>a.e(3301).then(a.bind(a,33301))));const Ra=function(e){return(0,c.ConfigurationSchema)("LinearComparativeDisplay",{},{explicitlyTyped:!0,explicitIdentifier:"displayId"})};function Ia(e){const{rpcManager:t}=(0,d.getSession)(e),a=e;(0,c.readConfObject)(e.configuration);const{level:r,adapterConfig:n}=e,o=(0,d.getContainingView)(e),i=(0,le.getRpcSessionId)(e);return(0,v.getSnapshot)(o),o.initialized?{rpcManager:t,renderProps:{...a.renderProps(),level:r,view:o,adapterConfig:n,sessionId:i,timeout:1e6,self:e}}:void 0}async function Na(e){if(!e)return;const{rpcManager:t,renderProps:a}=e,{adapterConfig:r,level:n}=a,o=a.view.views[n],i=await t.call("getFeats","CoreGetFeatures",{regions:o.staticBlocks.contentBlocks,sessionId:"getFeats",adapterConfig:r});return{features:(0,d.dedupe)(i,(e=>e.id()))}}const La=function(e){return v.types.compose("LinearComparativeDisplay",M.BaseDisplay,v.types.model({type:v.types.literal("LinearComparativeDisplay"),configuration:(0,c.ConfigurationReference)(e)})).volatile((()=>({renderInProgress:void 0,features:void 0,message:void 0}))).views((e=>({get level(){return(0,v.getParent)(e,4).level},get height(){return(0,v.getParent)(e,4).height},renderProps:()=>({rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2})}))).actions((e=>{let t;return{setLoading(a){e.message=void 0,e.error=void 0,t=a},setMessage(a){e.message=a,e.error=void 0,t=void 0},setRendered(a){if(!a)return;const{features:r}=a,n=e.features||[],o=new Set(n.map((e=>e.id()))),i=new Set(r.map((e=>e.id())));let s=!1,l=!1;for(const e of r)if(!o.has(e.id())){s=!0;break}for(const e of n)if(!i.has(e.id())){l=!0;break}e.message=void 0,e.error=void 0,t=void 0,(s||l||!e.features)&&(e.features=r)},setError(a){console.error(a),void 0!==t&&(0,qe.CF)(t),e.message=void 0,e.error=a,t=void 0}}})).actions((e=>({afterAttach(){(0,d.makeAbortableReaction)(e,Ia,Na,{name:`${e.type} ${e.id} rendering`,delay:1e3,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)}})))},Da=(0,l.lazy)((()=>Promise.resolve().then(a.bind(a,87686)))),Fa=function(e){const t=e.getViewType("LinearSyntenyViewHelper")?.stateModel;return v.types.compose("LinearComparativeView",gt.A,v.types.model({id:ye.ElementId,type:v.types.literal("LinearComparativeView"),trackSelectorType:"hierarchical",showIntraviewLinks:!0,interactToggled:!1,levels:v.types.array(t),views:v.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:v.types.array(e.pluggableConfigSchemaType("track"))})).volatile((()=>({width:void 0}))).views((e=>({get initialized(){return void 0!==e.width&&e.views.length>0&&e.views.every((e=>e.initialized))},get refNames(){return e.views.map((e=>[...new Set(e.staticBlocks.map((e=>e.refName)))]))},get assemblyNames(){return[...new Set(e.views.flatMap((e=>e.assemblyNames)))]}}))).actions((e=>({beforeDestroy(){const t=(0,d.getSession)(e);for(const a of e.assemblyNames)t.removeTemporaryAssembly?.(a)},onSubviewAction(t,a,r){e.views.forEach((e=>{(0,v.getPath)(e).endsWith(a)||e[t](r?.[0])}))},setWidth(t){e.width=t},setViews(t){e.views=(0,v.cast)(t)},removeView(t){e.views.remove(t)},setLevelHeight(t,a=0){const r=e.levels[a];return r.setHeight(t),r.height},activateTrackSelector(t){if("hierarchical"===e.trackSelectorType){const a=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(a)){const r=a.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e.levels[t]});return a.showWidget(r),r}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},toggleTrack(t,a=0){e.levels[a]?.toggleTrack(t)},showTrack(t,a=0,r={}){e.levels[a]||(e.levels[a]=(0,v.cast)({level:a})),e.levels[a].showTrack(t,r)},hideTrack(t,a=0){e.levels[a]?.hideTrack(t)},squareView(){const t=(0,d.avg)(e.views.map((e=>e.bpPerPx)));for(const a of e.views){const e=a.pxToBp(a.width/2);a.setNewView(t,a.offsetPx),e.refName&&a.centerAt(e.coord,e.refName,e.index)}},clearView(){e.views=(0,v.cast)([]),e.levels=(0,v.cast)([])}}))).views((()=>({headerMenuItems:()=>[]}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Da,{model:e,handleClose:t}]))},icon:ht.A}],rubberBandMenuItems:()=>[{label:"Zoom to region(s)",onClick:()=>{for(const t of e.views){const{leftOffset:e,rightOffset:a}=t;e&&a&&t.moveTo(e,a)}}}]}))).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,ke.autorun)((()=>{if(e.width)for(const t of e.views)t.setWidth(e.width)})))}}))).preProcessSnapshot((e=>{const{tracks:t,levels:a=[{tracks:t,level:0}],...r}=e||{};return{...r,levels:a}}))},Ba=(0,l.lazy)((()=>a.e(3416).then(a.bind(a,3416)))),Va=function(e){return v.types.compose("LinearSyntenyDisplay",La(e),v.types.model({type:v.types.literal("LinearSyntenyDisplay"),configuration:(0,c.ConfigurationReference)(e)})).volatile((()=>({mainCanvas:null,clickMapCanvas:null,cigarClickMapCanvas:null,mouseoverCanvas:null,featPositions:[],mouseoverId:void 0,clickId:void 0,cigarMouseoverId:-1}))).actions((e=>({setFeatPositions(t){e.featPositions=t},setMainCanvasRef(t){e.mainCanvas=t},setClickMapCanvasRef(t){e.clickMapCanvas=t},setCigarClickMapCanvasRef(t){e.cigarClickMapCanvas=t},setMouseoverCanvasRef(t){e.mouseoverCanvas=t},setMouseoverId(t){e.mouseoverId=t},setCigarMouseoverId(t){e.cigarMouseoverId=t},setClickId(t){e.clickId=t}}))).views((e=>({get adapterConfig(){return{name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,c.getConf)(e,"assemblyNames"),...(0,c.getConf)(e.parentTrack,"adapter")}},get trackIds(){return(0,c.getConf)(e,"trackIds")},get numFeats(){return e.featPositions.length},get ready(){return this.numFeats>0},get featMap(){return Object.fromEntries(e.featPositions.map((e=>[e.f.id(),e])))}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await a.e(8856).then(a.bind(a,28856));t(e)}catch(t){console.error(t),e.setError(t)}})()}})))};var za=a(52521),Oa=a(1633);function Ha(e){return l.createElement(z.A,e,l.createElement("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"}))}const Ga=(0,l.lazy)((()=>a.e(8869).then(a.bind(a,78869))));function ja(e){return v.types.compose("LinearSyntenyView",Fa(e),v.types.model({type:v.types.literal("LinearSyntenyView"),drawCIGAR:!0,drawCurves:!1})).actions((e=>({toggleCurves(){e.drawCurves=!e.drawCurves},toggleCIGAR(){e.drawCIGAR=!e.drawCIGAR},showAllRegions(){(0,ke.transaction)((()=>{for(const t of e.views)t.showAllRegionsInAssembly()}))}}))).actions((e=>({async exportSvg(t){const{renderToSvg:r}=await a.e(3047).then(a.bind(a,93047)),n=await r(e,t),o=new Blob([n],{type:"image/svg+xml"});(0,Se.saveAs)(o,t.filename||"image.svg")}}))).views((e=>{const t=e.headerMenuItems,a=e.menuItems;return{headerMenuItems:()=>[...t(),{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:za.A},{label:"Show all regions",onClick:e.showAllRegions,description:"Show entire genome assemblies",icon:Oa.A},{label:"Draw CIGAR",onClick:e.toggleCIGAR,checked:e.drawCIGAR,type:"checkbox",description:"Draws per-base CIGAR level alignments"},{label:"Use curved lines",type:"checkbox",checked:e.drawCurves,onClick:e.toggleCurves,icon:Ha},{label:"Export SVG",icon:Ce.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Ga,{model:e,handleClose:t}]))}}],menuItems:()=>[...a(),{label:"Export SVG",icon:Ce.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Ga,{model:e,handleClose:t}]))}}]}}))}function Wa(e){return v.types.model("LinearSyntenyViewHelper",{id:ye.ElementId,type:"LinearSyntenyViewHelper",tracks:v.types.array(e.pluggableMstType("track","stateModel")),height:100,level:v.types.number}).actions((t=>({setHeight:e=>(t.height=e,t.height),showTrack(a,r={}){const n=e.pluggableConfigSchemaType("track"),o=(0,v.resolveIdentifier)(n,(0,v.getRoot)(t),a);if(!o)throw new Error(`track not found ${a}`);const i=e.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=o.displays.find((e=>l.has(e.type)));if(!c)throw new Error(`could not find a compatible display for view type ${t.type}`);t.tracks.push(i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:c.type,configuration:c}]}))},hideTrack(a){const r=e.pluggableConfigSchemaType("track"),n=(0,v.resolveIdentifier)(r,(0,v.getRoot)(t),a),o=t.tracks.filter((e=>e.configuration===n));return(0,ke.transaction)((()=>{o.forEach((e=>{t.tracks.remove(e)}))})),o.length},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)}}))).views((e=>({get assemblyNames(){const t=(0,v.getParent)(e,2);return[t.views[e.level].assemblyNames[0],t.views[e.level+1].assemblyNames[0]]}})))}function $a(){return l.createElement("div",null)}var Ua=a(9342),qa=a(67736);const _a=(0,c.ConfigurationSchema)("SyntenyFeatureWidget",{});function Ja(e){return v.types.compose((0,Ua.n)(e),v.types.model("SyntenyFeatureWidget",{type:v.types.literal("SyntenyFeatureWidget"),level:v.types.maybe(v.types.number)}))}class Xa extends n.A{name="LinearComparativeViewPlugin";install(e){!function(e){e.addViewType((()=>new Rt.A({name:"LinearSyntenyViewHelper",displayName:"Linear synteny view (helper)",viewMetadata:{hiddenFromGUI:!0},stateModel:Wa(e),ReactComponent:$a})))}(e),function(e){e.addViewType((()=>new Rt.A({name:"LinearComparativeView",viewMetadata:{hiddenFromGUI:!0},displayName:"Linear comparative view",stateModel:Fa(e),ReactComponent:(0,l.lazy)((()=>a.e(8142).then(a.bind(a,78142))))})))}(e),function(e){e.addViewType((()=>new Rt.A({name:"LinearSyntenyView",displayName:"Linear synteny view",stateModel:ja(e),ReactComponent:(0,l.lazy)((()=>a.e(3795).then(a.bind(a,13795))))})))}(e),function(e){e.addDisplayType((()=>{const e=Ra();return new Je.A({name:"LinearComparativeDisplay",configSchema:e,stateModel:La(e),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:()=>null})}))}(e),function(e){e.addDisplayType((()=>{const e=(0,c.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:Ra(),explicitlyTyped:!0});return new Je.A({name:"LinearSyntenyDisplay",configSchema:e,stateModel:Va(e),trackType:"SyntenyTrack",viewType:"LinearSyntenyViewHelper",ReactComponent:(0,l.lazy)((()=>a.e(4753).then(a.bind(a,44753))))})}))}(e),function(e){e.addWidgetType((()=>new qa.A({name:"SyntenyFeatureWidget",heading:"Synteny feature details",configSchema:_a,stateModel:Ja(e),ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(3011),a.e(6157),a.e(1405),a.e(4144),a.e(5576)]).then(a.bind(a,95576))))})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return e.jexl.addFunction("lgvSyntenyTooltip",(e=>{const t=e.get("mate");return[e.get("name")||e.get("id"),t?.name||t?.id].filter((e=>!!e)).join("<br/>")})),(0,c.ConfigurationSchema)("LGVSyntenyDisplay",{mouseover:{type:"string",defaultValue:"jexl:lgvSyntenyTooltip(feature)"}},{baseConfiguration:(0,r.ww)(e),explicitlyTyped:!0})}(e),a=(n=t,v.types.compose("LGVSyntenyDisplay",(0,r.N5)(n),v.types.model({type:v.types.literal("LGVSyntenyDisplay"),configuration:(0,c.ConfigurationReference)(n)})).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const a=e.contextMenuFeature;return[...t(),...a?[{label:"Launch synteny view for this position",onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Ea,{model:e,trackId:(0,c.getConf)((0,d.getContainingTrack)(e),"trackId"),handleClose:t,feature:a}]))}}]:[]]}}})).views((e=>{const{trackMenuItems:t,colorSchemeSubMenuItems:a}=e;return{trackMenuItems:()=>[...t(),{label:"Color scheme",subMenu:[...a()]}]}})).actions((e=>({selectFeature(t){const a=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(a)){let r=(0,d.getContainingView)(e);try{r=(0,d.getContainingView)(r)}catch(e){}const n=a.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:t.toJSON(),view:r,track:(0,d.getContainingTrack)(e)});a.showWidget(n)}a.setSelection(t)},afterCreate(){e.colorBySetting||"normal"!==e.colorBy.type||e.setColorScheme({type:"strand"})}}))));var n;return new Je.A({name:"LGVSyntenyDisplay",configSchema:t,stateModel:a,trackType:"SyntenyTrack",viewType:"LinearGenomeView",ReactComponent:k.GQ})}))}(e),function(e){e.addToExtensionPoint("LaunchView-LinearSyntenyView",(async({session:e,views:t,tracks:a=[]})=>{try{const{assemblyManager:n}=e,o=e.addView("LinearSyntenyView",{});await(0,ke.when)((()=>!!o.width)),o.setViews(await Promise.all(t.map((async e=>{const t=await n.waitForAssembly(e.assembly);if(!t)throw new Error(`Assembly ${e.assembly} failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:t.regions}})))),await Promise.all(o.views.map((e=>(0,ke.when)((()=>e.initialized)))));let i=[];if(await Promise.all(t.map((async(e,t)=>{const a=o.views[t],{assembly:r,loc:s,tracks:l=[]}=e,c=await n.waitForAssembly(r);if(!c)throw new Error(`Assembly ${e.assembly} failed to load`);await a.navToSearchString({input:s,assembly:c}),i=[...i,...l.map((e=>function({model:e,trackId:t}){try{e.showTrack(t)}catch(e){if(/Could not resolve identifier/.exec(`${e}`)||/track not found/.exec(`${e}`))return t;throw e}}({model:a,trackId:e})))]}))),i=[...i,...(r=a,Array.isArray(r[0])?r:[r]).flatMap(((e,t)=>e.map((e=>function({model:e,trackId:t,level:a}){try{e.showTrack(t,a)}catch(e){if(/Could not resolve identifier/.exec(`${e}`)||/track not found/.exec(`${e}`))return t;throw e}}({model:o,trackId:e,level:t})))))],i.filter(d.notEmpty).length)throw new Error(`Could not resolve identifiers: ${i.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}var r}))}(e),function(e){e.addTrackType((()=>{const t=(e=>(0,c.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:(0,M.createBaseTrackConfig)(e)}))(e);return new Nt.A({name:"SyntenyTrack",configSchema:t,stateModel:(0,M.createBaseTrackModel)(e,"SyntenyTrack",t)})}))}(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>("LinearPileupDisplay"!==e.name||(e.stateModel=e.stateModel.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const a=e.contextMenuFeature,r=(0,d.getContainingTrack)(e);return[...t(),...a?[{label:"Linear read vs ref",icon:lt.A,onClick:()=>{(0,d.getSession)(e).queueDialog((e=>[Ba,{track:r,feature:a,handleClose:e}]))}}]:[]]}}}}))),e)))}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:Ma.A,onClick:e=>{e.addView("LinearSyntenyView",{})}})}}function Ya(e){return v.types.compose("LinearLollipopDisplay",k.Lr,v.types.model({type:v.types.literal("LinearLollipopDisplay"),configuration:(0,c.ConfigurationReference)(e)})).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}}))}var Ka=a(98111),Qa=a(2265),Za=a(32595);class er{totalHeight=0;constructor({width:e}){if(!e)throw new Error("width required to make a new FloatingLayout");this.width=e}items=[];layout=new Map;layoutDirty=!1;add(e,t,a,r,n){this.items.push({uniqueId:e,anchorLocation:t,width:a,height:r,data:n}),this.layoutDirty=!0}getLayout(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");const t=(0,c.readConfObject)(e,"minStickLength"),a=this.items.sort(((e,t)=>e.data.score-t.data.score));let r=0;const n=new Array(a.length);for(let e=0;e<a.length;e+=1){const o=a[e],{anchorLocation:i,width:s,height:l}=o,c=i-s/2,d=c+s;let u=t,p=u+l;for(let t=0;t<e;t+=1){const[,e]=n[t],{x:a,y:r,width:o,height:i}=e,s=a+o,m=r+i;(0,Za.R6)(a,s,c,d)&&(0,Za.R6)(r,m,u,p)&&(u=m,p=u+l,t=-1)}n[e]=[o.uniqueId,{...o,x:c,y:u}],p>r&&(r=p)}return this.totalHeight=r,this.layout=new Map(n),this.layoutDirty=!1,this.layout}getTotalHeight(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}serializeRegion(){return this.toJSON()}toJSON(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:[...this.getLayout()],totalHeight:this.getTotalHeight()}}static fromJSON(){throw new Error("not supported")}}class tr{constructor({pairs:e,totalHeight:t}){this.layout=new Map(e),this.totalHeight=t}add(e){if(!this.layout.has(e))throw new Error(`layout error, precomputed layout is missing ${e}`)}getLayout(){return this.layout}getTotalHeight(){return this.totalHeight}static fromJSON(e){return new tr(e)}}class ar extends Ka.LayoutSession{makeLayout(){const{end:e,start:t}=this.regions[0],a=(e-t)/this.bpPerPx;return new Qa.A(er,{width:a})}layoutIsValid(){return!1}}class rr extends Ka.default{createSession(e){return new ar(e)}deserializeLayoutInClient(e){return new tr(e)}}const nr=(0,c.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0});class or extends n.A{name="LollipopPlugin";install(e){!function(e){e.addRendererType((()=>new rr({name:"LollipopRenderer",ReactComponent:(0,l.lazy)((()=>a.e(6861).then(a.bind(a,46861)))),configSchema:nr,pluginManager:e})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:k.Ki,explicitlyTyped:!0})}(e);return new S.DisplayType({name:"LinearLollipopDisplay",configSchema:t,stateModel:Ya(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:k.GQ})}))}(e)}}var ir=a(25914),sr=a(36993);const lr=(0,c.ConfigurationSchema)("AboutWidget",{}),cr=v.types.model("AboutWidget",{id:ye.ElementId,type:v.types.literal("AboutWidget")}),dr=(0,c.ConfigurationSchema)("HelpWidget",{}),ur=v.types.model("HelpWidget",{id:ye.ElementId,type:v.types.literal("HelpWidget")}),pr=(0,c.ConfigurationSchema)("ImportSessionWidget",{}),mr=v.types.model("ImportSessionWidget",{id:ye.ElementId,type:v.types.literal("ImportSessionWidget")}),gr=(0,c.ConfigurationSchema)("SessionManager",{}),fr=v.types.model("SessionManager",{id:ye.ElementId,type:v.types.literal("SessionManager")});class hr extends n.A{name="MenusPlugin";install(e){!function(e){e.addWidgetType((()=>new S.WidgetType({name:"AboutWidget",heading:"About",configSchema:lr,stateModel:cr,ReactComponent:(0,l.lazy)((()=>a.e(9032).then(a.bind(a,99032))))})))}(e),function(e){e.addWidgetType((()=>new S.WidgetType({name:"HelpWidget",heading:"Help",configSchema:dr,stateModel:ur,ReactComponent:(0,l.lazy)((()=>a.e(4974).then(a.bind(a,74974))))})))}(e),function(e){e.addWidgetType((()=>new S.WidgetType({name:"ImportSessionWidget",heading:"Import session",configSchema:pr,stateModel:mr,ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(4233),a.e(7389)]).then(a.bind(a,67389))))})))}(e),function(e){e.addWidgetType((()=>new S.WidgetType({name:"SessionManager",heading:"Recent sessions",configSchema:gr,stateModel:fr,ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6753),a.e(8590)]).then(a.bind(a,41116))))})))}(e)}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:sr.A,onClick:e=>{const t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:ir.A,onClick:e=>{const t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}}var yr=a(46377),br=a(66885),wr=a(6434),vr=a(2401),Cr=a.n(vr);class Sr extends yr.BaseFeatureDataAdapter{constructor(e,t,a){super(e,t,a),this.endpoint=(0,c.readConfObject)(e,"endpoint").uri,this.queryTemplate=(0,c.readConfObject)(e,"queryTemplate"),this.additionalQueryParams=(0,c.readConfObject)(e,"additionalQueryParams"),this.refNamesQueryTemplate=(0,c.readConfObject)(e,"refNamesQueryTemplate"),this.configRefNames=(0,c.readConfObject)(e,"refNames")}async getRefNames(e){if(this.refNames)return this.refNames;if(this.refNamesQueryTemplate){const t=encodeURIComponent(this.refNamesQueryTemplate),a=await this.querySparql(t,e);this.refNames=this.resultsToRefNames(a)}else this.refNames=this.configRefNames;return this.refNames}getFeatures(e,t={}){return(0,br.ObservableCreate)((async a=>{const r=encodeURIComponent(Cr()(this.queryTemplate,e)),{refName:n}=e,o=await this.querySparql(r,t),i=this.resultsToFeatures(o,n);for(const e of i)a.next(e);a.complete()}),t.stopToken)}async querySparql(e,t){let a="";this.additionalQueryParams.length&&(a=`&${this.additionalQueryParams.join("&")}`);const r=`${this.endpoint}?query=${e}${a}`;return(await fetch(r,{headers:{accept:"application/json,application/sparql-results+json"}})).json()}resultsToRefNames(e){const t=e.results.bindings||[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return t.map((e=>e.refName.value))}resultsToFeatures(e,t){const a=e.results.bindings||[],r=e.head.vars;["start","end","uniqueId"].forEach((e=>{r.includes(e)||console.error(`Required field ${e} missing from feature data`)}));const n={};a.forEach((e=>{const a=[{}];r.forEach((t=>{if(t in e){const{value:r}=e[t];let n=0;for(;t.startsWith("sub_");)t=t.slice(4),n+=1;for(;n>a.length-1;)a.push({});a[n][t]=r}})),a.forEach(((e,r)=>{const{uniqueId:o,start:i,end:s,strand:l}=e;r<a.length-1&&(a[r+1].parentUniqueId=o),n[o]={data:{...e,uniqueId:o,refName:t,start:Number.parseInt(i,10),end:Number.parseInt(s,10),strand:Number.parseInt(l,10)||0}}}))}));for(const[e,t]of Object.entries(n)){const a=t.data.parentUniqueId;if(t.data.parentUniqueId=void 0,a){const r=n[a];if(r)r.data.subfeatures||(r.data.subfeatures=[]),r.data.subfeatures.push({...t.data,uniqueId:e}),delete n[e];else{const r=Object.values(n).map((e=>e.data.subfeatures)).filter((e=>!!e)).flat();let o=!1;for(const i of r){if(i.uniqueId===a){i.subfeatures||(i.subfeatures=[]),i.subfeatures.push({...t.data,uniqueId:e}),delete n[e],o=!0;break}i.subfeatures&&r.push(...i.subfeatures)}o||console.error(`Could not find parentID ${a}`)}}}return Object.keys(n).map((e=>new wr.A({...n[e].data,uniqueId:e,subfeatures:n[e].data.subfeatures})))}async hasDataForRefName(e,t={}){const a=await this.getRefNames(t);return!(a.length&&!a.includes(e))}freeResources(){}}const kr=(0,c.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0});class Tr extends n.A{name="RdfPlugin";install(e){e.addAdapterType((()=>new ce.A({name:"SPARQLAdapter",displayName:"SPARQL adapter",configSchema:kr,AdapterClass:Sr}))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="SPARQLAdapter",o=(0,le.getFileName)(t);return/\/sparql$/i.test(o)||r===n?{type:n,endpoint:t}:e(t,a,r)}))}}const xr=(0,c.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Ar=(0,c.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0});function Pr(){return Pr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Pr.apply(null,arguments)}function Mr({codonTable:e,seq:t,frame:a,bpPerPx:r,colorByCDS:n,region:o,seqStart:i,height:s,y:c,reverse:u=!1,theme:p}){const m=(Math.abs(a)-1-i%3+3)%3,g=t.length-m,f=g-g%3,h=t.slice(m,m+f),y=[];for(let t=0;t<h.length;t+=3){const a=h.slice(t,t+3),r=u?(0,d.revcom)(a):a,n=e[r]||"";y.push({letter:n,codon:r.toUpperCase()})}const b=(o.end-o.start)/r,w=1/r*3,v=1/r>=12,C=m/r-(o.start-i)/r,S=n?p?.palette.framesCDS.at(a)?.main:p?.palette.frames.at(a)?.main;return l.createElement(l.Fragment,null,l.createElement("rect",{x:0,y:c,width:b,height:s,fill:S}),y.map(((e,t)=>{const a=o.reversed?b-(t+1)*w-C:w*t+C,{letter:r,codon:n}=e,i=d.defaultStarts.includes(n)?p?.palette.startCodon:d.defaultStops.includes(n)?p?.palette.stopCodon:void 0;return v||i?l.createElement(l.Fragment,{key:`${t}-${r}`},l.createElement("rect",{x:a,y:c,width:v?w:w+.7,height:s,stroke:v?"#555":"none",fill:i||"none"}),v?l.createElement("text",{x:a+w/2,fontSize:s-2,y:c+s/2,dominantBaseline:"middle",textAnchor:"middle"},r):null):null})))}function Er({bpPerPx:e,region:t,feature:a,sequenceType:r,theme:n,height:o,seq:i,y:s}){const c=1/e>=12,u=a.get("start"),p=a.get("end"),[m,g]=(0,d.bpSpanPx)(u,p,t,e),f=t.reversed,h=p-u,y=Math.max((g-m)/h,.8);return l.createElement(l.Fragment,null,i.split("").map(((e,t)=>{const a="dna"===r?n.palette.bases[e.toUpperCase()]:void 0,i=f?g-(t+1)*y:m+t*y;return l.createElement(l.Fragment,{key:`${e}-${t}`},l.createElement("rect",{x:i,y:s,width:y,height:o,fill:a?a.main:"#aaa",stroke:c?"#555":"none"}),c?l.createElement("text",{x:i+y/2,y:s+o/2,dominantBaseline:"middle",textAnchor:"middle",fontSize:o-2,fill:a?n.palette.getContrastText(a.main):"black"},e):null)})))}function Rr({regions:e,theme:t,colorByCDS:a,features:r=new Map,showReverse:n=!0,showForward:o=!0,showTranslation:i=!0,sequenceType:s="dna",bpPerPx:c,rowHeight:u}){const p=e[0],m=(0,$.createJBrowseTheme)(t),g=(0,d.generateCodonTable)(d.defaultCodonTable),[f]=[...r.values()];if(!f)return null;const h=f.get("seq");if(!h)return null;let y=-u;const b=c<=1,w=i&&o?[3,2,1]:[],v=i&&n?[-1,-2,-3]:[],[C,S]=p.reversed?[v.toReversed(),w.toReversed()]:[w,v];return l.createElement(l.Fragment,null,C.map((e=>l.createElement(Mr,{key:`translation-${e}`,colorByCDS:a,seq:h,y:y+=u,codonTable:g,frame:e,bpPerPx:c,region:p,seqStart:f.get("start"),theme:m,height:u,reverse:p.reversed}))),o&&b?l.createElement(Er,{height:u,sequenceType:s,y:y+=u,feature:f,region:p,seq:p.reversed?(0,d.complement)(h):h,bpPerPx:c,theme:m}):null,n&&b?l.createElement(Er,{height:u,sequenceType:s,y:y+=u,feature:f,region:p,seq:p.reversed?h:(0,d.complement)(h),bpPerPx:c,theme:m}):null,S.map((e=>l.createElement(Mr,{key:`rev-translation-${e}`,colorByCDS:a,seq:h,y:y+=u,codonTable:g,frame:e,bpPerPx:c,region:p,seqStart:f.get("start"),theme:m,height:u,reverse:!p.reversed}))))}function Ir({exportSVG:e,width:t,totalHeight:a,children:r}){return e?r:l.createElement("svg",{"data-testid":"sequence_track",width:t,height:a,style:{display:"block",width:t,height:a,userSelect:"none"}},r)}const Nr=(0,u.observer)((function(e){const{regions:t,bpPerPx:a,sequenceHeight:r}=e,n=t[0],o=(n.end-n.start)/a;return l.createElement(Ir,Pr({},e,{totalHeight:r,width:o}),l.createElement(Rr,e))})),Lr=(0,c.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0});class Dr extends i.default{supportsSVG=!0;getExpandedRegion(e){return{...e,start:Math.max(e.start-3,0),end:e.end+3}}}const Fr=(0,c.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Br=(0,c.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:Lr},{explicitIdentifier:"displayId",explicitlyTyped:!0});const Vr=(0,c.ConfigurationSchema)("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0}),zr=(0,c.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0}),Or=(0,c.ConfigurationSchema)("UnindexedFastaAdapter",{rewriteRefNames:{type:"string",defaultValue:"",contextVariable:["refName"]},fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0});class Hr extends n.A{name="SequencePlugin";install(e){!function(e){e.addRendererType((()=>new Dr({name:"DivSequenceRenderer",ReactComponent:Nr,configSchema:Lr,pluginManager:e})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"TwoBitAdapter",displayName:"TwoBit adapter",configSchema:zr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([a.e(9763),a.e(1590)]).then(a.bind(a,11590)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"BgzipFastaAdapter",displayName:"Bgzip-indexed FASTA adapter",configSchema:xr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(9206).then(a.bind(a,79206)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"ChromSizesAdapter",displayName:"Chrom sizes adapter",configSchema:Ar,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(7842).then(a.bind(a,57842)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"IndexedFastaAdapter",displayName:"Indexed FASTA adapter",configSchema:Fr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(9870).then(a.bind(a,69870)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"UnindexedFastaAdapter",displayName:"Unindexed FASTA adapter",configSchema:Or,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>a.e(3578).then(a.bind(a,93578)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new ce.A({name:"SequenceSearchAdapter",displayName:"Sequence search adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:Vr,getAdapterClass:()=>a.e(946).then(a.bind(a,90946)).then((e=>e.default))})))}(e),function(e){e.addTrackType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:v.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:'optional track name, otherwise uses the "Reference sequence (assemblyName)"',defaultValue:""},sequenceType:{type:"string",description:"either dna or pep",defaultValue:"dna"},description:{description:"a description of the track",type:"string",defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},formatAbout:(0,c.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const a=JSON.parse(JSON.stringify(t)),r=new Set,{displays:n=[]}=a;if("placeholderId"!==a.trackId){n.forEach((e=>e&&r.add(e.type)));const t=e.getTrackType(a.type);t?.displayTypes.forEach((e=>{r.has(e.name)||n.push({displayId:`${a.trackId}-${e.name}`,type:e.name})}))}return{...a,displays:n}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:a}=t;if(!a)throw new Error(`unknown display type ${a}`);const r=e.displays.find((e=>e&&e.displayId===t.displayId));if(r)return r;const n=e.displays.push(t);return e.displays[n-1]}})})}(e);return new Nt.A({name:"ReferenceSequenceTrack",displayName:"Reference sequence track",configSchema:t,stateModel:(0,M.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const e=function(e){return v.types.compose("LinearReferenceSequenceDisplay",k.Lr,v.types.model({type:v.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,c.ConfigurationReference)(e),showForward:!0,showReverse:!0,showTranslation:!0})).volatile((()=>({rowHeight:15}))).views((e=>({get sequenceType(){return(0,c.getConf)((0,d.getContainingTrack)(e),"sequenceType")},get showForwardActual(){return e.showForward},get showReverseActual(){return"dna"===this.sequenceType&&e.showReverse},get showTranslationActual(){return"dna"===this.sequenceType&&e.showTranslation}}))).views((e=>({get sequenceHeight(){const{rowHeight:t,showTranslationActual:a,showReverseActual:r,showForwardActual:n}=e;return(r&&a?3*t:0)+(n&&a?3*t:0)+(r?t:0)+(n?t:0)}}))).views((e=>{const{renderProps:t}=e;return{renderProps(){const{rpcDriverName:a,showForwardActual:r,showReverseActual:n,showTranslationActual:o,rowHeight:i,sequenceHeight:s,sequenceType:l}=e;return{...t(),...(0,le.getParentRenderProps)(e),config:e.configuration.renderer,rpcDriverName:a,showForward:r,showReverse:n,showTranslation:o,sequenceType:l,rowHeight:i,sequenceHeight:s}}}})).views((e=>({regionCannotBeRendered:()=>(0,d.getContainingView)(e).bpPerPx>3?"Zoom in to see sequence":void 0,get rendererTypeName(){return e.configuration.renderer.type}}))).actions((e=>({toggleShowForward(){e.showForward=!e.showForward},toggleShowReverse(){e.showReverse=!e.showReverse},toggleShowTranslation(){e.showTranslation=!e.showTranslation},afterAttach(){(0,v.addDisposer)(e,(0,ke.autorun)((()=>{(0,d.getContainingView)(e).bpPerPx>3?e.setHeight(50):e.setHeight(e.sequenceHeight)})))}}))).views((e=>({trackMenuItems:()=>[..."dna"===e.sequenceType?[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:()=>{e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:()=>{e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:()=>{e.toggleShowTranslation()}}]:[]]})))}(Br);return new S.DisplayType({name:"LinearReferenceSequenceDisplay",configSchema:Br,stateModel:e,displayName:"Reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:k.GQ})}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="TwoBitAdapter",o=(0,le.getFileName)(t),i={type:n,twoBitLocation:t};return/\.2bit$/i.test(o)&&!r||r===n?i:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="IndexedFastaAdapter",o=(0,le.getFileName)(t),i={type:n,fastaLocation:t,faiLocation:a||(0,le.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(o)&&!r||r===n?i:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,a,r)=>{const n="BgzipFastaAdapter",o=(0,le.getFileName)(t),i={type:n,faiLocation:(0,le.makeIndex)(t,".fai"),gziLocation:(0,le.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(o)&&!r||r===n?i:e(t,a,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t)))}(e)}}var Gr=a(39494);const jr=["VCF","BED","BEDPE","STAR-Fusion"],Wr={VCF:()=>a.e(9314).then(a.bind(a,99314)).then((e=>e.parseVcfBuffer)),BED:()=>a.e(6310).then(a.bind(a,6310)).then((e=>e.parseBedBuffer)),BEDPE:()=>a.e(3025).then(a.bind(a,3025)).then((e=>e.parseBedPEBuffer)),"STAR-Fusion":()=>a.e(759).then(a.bind(a,759)).then((e=>e.parseSTARFusionBuffer))};function $r(e){return e.vcfLocation||e.vcfGzLocation?"VCF":e.bedLocation||e.bedGzLocation?"BED":e.bedpeLocation?"BEDPE":void 0}const Ur=new RegExp(`\\.(${jr.join("|")})(\\.gz)?$`,"i");var qr=a(87731);function _r({assemblyName:e,session:t,locString:a,spreadsheetViewId:r}){const n=`${r}_${e}`;let o=t.views.find((e=>e.id===n));return o||(o=t.addView("LinearGenomeView",{id:n})),o.navToLocString(a,e)}var Jr=a(32813);const Xr=(0,l.lazy)((()=>a.e(3331).then(a.bind(a,3331)))),Yr=(0,l.lazy)((()=>a.e(2130).then(a.bind(a,42130))));function Kr({assemblyName:e,session:t,spreadsheetViewId:a,feature:r}){return l.createElement($t.A,{menuItems:[{label:"Open in linear genome view",onClick:async()=>{try{await _r({spreadsheetViewId:a,assemblyName:e,session:t,locString:(0,d.assembleLocStringFast)(r)})}catch(e){console.error(e),t.notifyError(`${e}`,e)}}},{label:"Open in single-level split view",onClick:async()=>{const{pluginManager:n}=(0,v.getEnv)(t),o=n.getViewType("BreakpointSplitView");t.queueDialog((n=>[Yr,{handleClose:n,session:t,stableViewId:`${a}_${e}_breakpointsplitview_singlelevel`,feature:new d.SimpleFeature(r),viewType:o,assemblyName:e}]))}},{label:"Open in multi-level split view",onClick:async()=>{const{pluginManager:n}=(0,v.getEnv)(t),o=n.getViewType("BreakpointSplitView");t.queueDialog((n=>[Xr,{handleClose:n,session:t,stableViewId:`${a}_${e}_breakpointsplitview_multilevel`,feature:new d.SimpleFeature(r),viewType:o,assemblyName:e}]))}}]},l.createElement(Jr.A,null))}function Qr({model:e,feature:t}){return l.createElement(l.Fragment,null,l.createElement(Kr,{session:(0,d.getSession)(e),spreadsheetViewId:(0,v.getParent)(e).id,assemblyName:e.assemblyName,feature:t}),l.createElement(qr.A,{href:"#",onClick:async a=>{try{a.preventDefault(),await _r({spreadsheetViewId:(0,v.getParent)(e).id,session:(0,d.getSession)(e),locString:(0,d.assembleLocString)(t),assemblyName:e.assemblyName})}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}}},(0,d.assembleLocString)(t)))}function Zr(){const e=v.types.model("SpreadsheetImportWizard",{fileType:v.types.optional(v.types.enumeration(jr),"VCF"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:v.types.maybe(v.types.string),cachedFileLocation:v.types.frozen()}).volatile((()=>({fileTypes:jr,fileSource:void 0,error:void 0,loading:!1}))).views((e=>({get isReadyToOpen(){return e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName(t,a){const{assemblyManager:r}=(0,d.getSession)(e);return!!a&&r.isValidRefName(t,a)},tracksForAssembly(t){const a=(0,d.getSession)(e),{tracks:r=[],sessionTracks:n=[]}=a;return[...r,...n].map((e=>{const r=(0,c.readConfObject)(e,"assemblyNames"),n=(0,c.readConfObject)(e,"adapter"),o=(0,c.readConfObject)(e,"category").join(","),i=function(e){return e.vcfLocation||e.vcfGzLocation||e.bedLocation||e.bedGzLocation||e.bedpeLocation}(n);return r.includes(t)&&i?{track:e,label:[o?`[${o}]`:"",(0,le.getTrackName)(e,a)].filter((e=>!!e)).join(" "),assemblyNames:r,type:$r(n)||"UNKNOWN",loc:i}:void 0})).filter((e=>!!e)).sort(((e,t)=>e.label.localeCompare(t.label)))}}))).actions((e=>({setSelectedAssemblyName(t){e.selectedAssemblyName=t},setFileSource(t){if(e.fileSource=t,e.error=void 0,e.fileSource){const t=e.fileName;if(t){const a=Ur.exec(t)?.[1];a&&(e.fileType="tsv"===a&&t.includes("star-fusion")?"STAR-Fusion":a.toUpperCase())}}},setColumnNameLineNumber(t){t>0&&(e.columnNameLineNumber=t)},setFileType(t){e.fileType=t},setError(t){e.error=t},setLoading(t){e.loading=t},cancelButton(){e.error=void 0,(0,v.getParent)(e).setDisplayMode()},setCachedFileHandle(t){e.cachedFileLocation=t}}))).actions((e=>({async import(t){if(!e.fileSource)return;e.selectedAssemblyName=t;const r=e.fileType,n=await Wr[r](),{fetchAndMaybeUnzip:o}=await Promise.resolve().then(a.bind(a,99546)),{pluginManager:i}=(0,d.getEnv)(e),s=(0,Q.openLocation)(e.fileSource,i);e.setLoading(!0);try{if((await s.stat()).size>1e8)return void e.setError(`File is too big. Tabular files are limited to at most ${1e5.toLocaleString()}kb.`)}catch(e){console.warn(e)}finally{e.setLoading(!1)}e.setLoading(!0);try{e.fileSource.uri&&e.setCachedFileHandle({uri:e.fileSource.uri,baseUri:e.fileSource.baseUri,locationType:"UriLocation"});const a=await o(s);(0,v.getParent)(e).displaySpreadsheet({...n(a),assemblyName:t})}catch(t){console.error(t),e.setError(t)}finally{e.setLoading(!1)}}}))).actions((e=>({afterAttach(){(async()=>{try{e.cachedFileLocation&&e.selectedAssemblyName&&(e.setFileSource(e.cachedFileLocation),await e.import(e.selectedAssemblyName))}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}})()}})));return v.types.compose(M.BaseViewModel,v.types.model("SpreadsheetView",{type:v.types.literal("SpreadsheetView"),offsetPx:0,height:v.types.optional(v.types.number,440),hideVerticalResizeHandle:!1,hideFilterControls:!1,importWizard:v.types.optional(e,(()=>e.create())),spreadsheet:v.types.maybe(v.types.model("Spreadsheet",{rowSet:v.types.frozen(),columns:v.types.frozen(),assemblyName:v.types.maybe(v.types.string),visibleColumns:v.types.frozen()}).volatile((()=>({isLoaded:!1,visibleRowFlags:void 0}))).views((e=>({get rows(){return e.rowSet?.rows.map(((t,a)=>({id:a,feature:t.feature,...Object.fromEntries(e.columns.map(((e,a)=>[e.name,t.cellData?.[e.name]??t.cells?.[a]?.text])))})))},get initialized(){const t=(0,d.getSession)(e),a=e.assemblyName;return!!a&&t.assemblyManager.get(a)?.initialized}}))).views((e=>({get dataGridColumns(){const{rows:t}=e;return t?[{field:"Location",width:(0,d.measureGridWidth)(t.map((e=>e.feature?(0,d.assembleLocStringFast)(e.feature):0)))+40,renderCell:({row:t})=>{const{feature:a}=t;return a?l.createElement(Qr,{model:e,feature:a}):"N/A"}},{field:"Length",width:(0,d.measureGridWidth)(t.map((e=>e.feature?(0,d.toLocale)(e.feature.end-e.feature.start):0))),valueGetter:(e,t)=>t.feature?t.feature.end-t.feature.start:void 0,valueFormatter:e=>(0,d.toLocale)(e)},...e.columns.map((e=>({field:e.name,width:(0,d.measureGridWidth)([...t.map((t=>t[e.name])),e.name],{minWidth:20})})))]:void 0}}))).views((e=>({get visibleRows(){const{visibleRowFlags:t}=e;return t?e.rows?.filter(((e,a)=>!!t[a])):e.rows}}))).actions((e=>({setVisibleRows(t){e.visibleRowFlags=t},setVisibleColumns(t){e.visibleColumns=t},setLoaded(t){e.isLoaded=t},afterAttach(){(0,v.addDisposer)(e,(0,ke.autorun)((async()=>{const t=(0,d.getSession)(e),{assemblyManager:a}=t;try{e.assemblyName&&(await a.waitForAssembly(e.assemblyName),this.setLoaded(!0))}catch(a){console.error(a),t.notifyError(`Failed to load assembly ${e.assemblyName} ${a}`,a)}})))}}))).preProcessSnapshot((e=>e?{...e,columns:e.columns.filter((e=>!e.isDerived)),rowSet:e.rowSet?{...e.rowSet,rows:e.rowSet.rows.map((e=>({...e,feature:e.feature??e.extendedData?.vcfFeature})))}:void 0}:e)))}).volatile((()=>({width:400,rowMenuItems:[]}))).views((e=>({get assembly(){const t=e.spreadsheet?.assemblyName;return t?(0,d.getSession)(e).assemblyManager.get(t)?.configuration:void 0}}))).actions((e=>({setRowMenuItems(t){e.rowMenuItems=t},setWidth:t=>(e.width=t,e.width),setHeight:t=>(e.height=Math.max(t,40),e.height),resizeHeight(t){const a=e.height;return this.setHeight(e.height+t)-a},resizeWidth(t){const a=e.width;return this.setWidth(e.width+t)-a},displaySpreadsheet(t){e.spreadsheet=(0,v.cast)(t)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",icon:ht.A,onClick:()=>{e.displaySpreadsheet(void 0)}}]})))).postProcessSnapshot((e=>{const{importWizard:t,spreadsheet:a}=e;if(t.cachedFileLocation&&a){const{rowSet:t,...r}=a;return{...e,spreadsheet:r}}return e}))}class en extends n.A{name="SpreadsheetViewPlugin";install(e){!function(e){e.addViewType((()=>new S.ViewType({name:"SpreadsheetView",displayName:"Spreadsheet view",stateModel:Zr(),ReactComponent:(0,l.lazy)((()=>Promise.all([a.e(8565),a.e(8237),a.e(6157),a.e(2060)]).then(a.bind(a,47282))))})))}(e),function(e){e.addToExtensionPoint("LaunchView-SpreadsheetView",(async({session:e,assembly:t,uri:a,fileType:r})=>{const n=e.addView("SpreadsheetView"),o=a.split(".");let i=o.pop()?.toUpperCase();"GZ"===i&&(i=o.pop()?.toUpperCase()),n.importWizard.setFileType(r||i||""),n.importWizard.setSelectedAssemblyName(t),n.importWizard.setFileSource({uri:a,locationType:"UriLocation"}),await n.importWizard.import(t)}))}(e)}configure(e){const{rootModel:t}=e;(0,d.isAbstractMenuManager)(t)&&t.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:Gr.A,onClick:e=>{e.addView("SpreadsheetView",{})}})}}var tn=a(92516),an=a(67393),rn=a(82353),nn=a(67314),on=a(33371),sn=a(32808);const ln=(0,Ze.n9)()((e=>({circularViewOptions:{padding:e.spacing(1)}}))),cn=(0,u.observer)((function({svInspector:e}){const{classes:t}=ln();return l.createElement(nn.Ay,{container:!0,className:t.circularViewOptions,style:{height:e.circularViewOptionsBarHeight}},l.createElement(nn.Ay,{item:!0},l.createElement(on.A,{control:l.createElement(sn.A,{checked:e.onlyDisplayRelevantRegionsInCircularView,onChange:t=>{e.setOnlyDisplayRelevantRegionsInCircularView(t.target.checked)}}),label:"show only regions with data"})))})),dn=(0,Ze.n9)()((e=>({resizeHandleVert:{background:e.palette.action.selected,width:4,boxSizing:"border-box",borderTop:"1px solid #fafafa"},resizeHandleHoriz:{background:e.palette.action.selected,height:4,boxSizing:"border-box",borderTop:"1px solid #fafafa"},viewControls:{margin:0},viewsContainer:{display:"flex"},container:{overflow:"hidden"}}))),un=(0,u.observer)((function({model:e}){const{classes:t}=dn(),{SpreadsheetViewReactComponent:a,CircularViewReactComponent:r,showCircularView:n}=e;return l.createElement("div",{className:t.container},l.createElement("div",{className:t.viewsContainer},l.createElement("div",{style:{width:e.spreadsheetView.width},className:t.container},l.createElement(a,{model:e.spreadsheetView})),n?l.createElement(l.Fragment,null,l.createElement($.ResizeHandle,{onDrag:t=>{const a=e.circularView.resizeWidth(-t);return e.spreadsheetView.resizeWidth(-a)},vertical:!0,flexbox:!0,className:t.resizeHandleVert}),l.createElement("div",{style:{width:e.circularView.width}},l.createElement(cn,{svInspector:e}),l.createElement(r,{model:e.circularView}))):null),l.createElement($.ResizeHandle,{onDrag:e.resizeHeight,className:t.resizeHandleHoriz}))})),pn=un;function mn(e,t){(async()=>{const a=(0,d.getSession)(t);try{a.setSelection(e);const r=(0,d.getContainingView)(t),n=`${(0,v.getParent)(r).id}_spawned`;await(0,rn.RI)({assemblyName:r.assemblyNames[0],session:a,stableViewId:n,feature:e})}catch(e){console.error(e),a.notifyError(`${e}`,e)}})()}class gn extends n.A{name="SvInspectorViewPlugin";install(e){!function(e){e.jexl.addFunction("defaultOnChordClick",mn),e.addViewType((()=>{const t=function(e){const t=e.getViewType("SpreadsheetView"),a=e.getViewType("CircularView"),r=t.stateModel,n=a.stateModel;return v.types.compose("SvInspectorView",M.BaseViewModel,v.types.model({id:ye.ElementId,type:v.types.literal("SvInspectorView"),height:v.types.optional(v.types.number,550),onlyDisplayRelevantRegionsInCircularView:!1,spreadsheetView:v.types.optional(r,(()=>r.create({type:"SpreadsheetView",hideVerticalResizeHandle:!0}))),circularView:v.types.optional(n,(()=>n.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})))})).volatile((()=>({width:800,SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:a.ReactComponent,circularViewOptionsBarHeight:52}))).views((e=>({get assemblyName(){const{assembly:t}=e.spreadsheetView;return t?(0,c.readConfObject)(t,"name"):void 0},get showCircularView(){return!!e.spreadsheetView.spreadsheet},get features(){return structuredClone(e.spreadsheetView.spreadsheet?.visibleRows)?.map((e=>e.feature)).filter((e=>!!e))||[]},get featuresAdapterConfigSnapshot(){return{type:"FromConfigAdapter",features:this.features}},get featureRefNames(){return[...new Set([...this.features.map((e=>e.refName)),...this.features.flatMap((e=>e.INFO?.CHR2)),...this.features.flatMap((e=>e.mate?.refName))].filter((e=>!!e)))]},get currentAssembly(){const{assemblyManager:t}=(0,d.getSession)(e);return this.assemblyName?t.get(this.assemblyName):void 0},get canonicalFeatureRefNameSet(){const e=this.currentAssembly;return new Set(e?.initialized?this.featureRefNames.map((t=>e.getCanonicalRefName(t)||t)):[])},get featuresCircularTrackConfiguration(){return{type:"VariantTrack",trackId:`sv-inspector-variant-track-${e.id}`,name:"features from tabular data",adapter:this.featuresAdapterConfigSnapshot,assemblyNames:[this.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:`sv-inspector-variant-track-chord-display-${e.id}`,onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}))).actions((e=>({setWidth(t){e.width=t},setHeight:t=>(e.height=Math.max(t,400),e.height),setDisplayedRegions(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",icon:ht.A,onClick:()=>{e.spreadsheetView.displaySpreadsheet(void 0)}}]}))).actions((e=>({resizeHeight(t){const a=e.height;return e.setHeight(e.height+t)-a},afterAttach(){(0,v.addDisposer)(e,(0,ke.autorun)((()=>{if(e.showCircularView){const t=Math.round(.66*e.width),a=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(a)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),(0,v.addDisposer)(e,(0,ke.autorun)((()=>{e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),(0,v.addDisposer)(e,(0,ke.autorun)((async()=>{const{onlyDisplayRelevantRegionsInCircularView:t,circularView:a,canonicalFeatureRefNameSet:r,currentAssembly:n}=e;if(a.initialized&&n?.regions)if(t){if(1===a.tracks.length)try{a.setDisplayedRegions(structuredClone(n.regions.filter((e=>r.has(e.refName)))))}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}}else a.setDisplayedRegions(n.regions)}),{name:"SvInspectorView displayed regions bind"})),(0,v.addDisposer)(e,(0,ke.reaction)((()=>({generatedTrackConf:e.featuresCircularTrackConfiguration,assemblyName:e.assemblyName})),(t=>{if(!t)return;const{assemblyName:a,generatedTrackConf:r}=t,{circularView:n}=e;n.tracks.forEach((e=>n.hideTrack(e.configuration.trackId))),a&&n.addTrackConf(r,{assemblyName:a})}),{name:"SvInspectorView track configuration binding",fireImmediately:!0}))}}))).postProcessSnapshot((e=>{const{circularView:t,...a}=e;return a}))}(e);return new Rt.A({name:"SvInspectorView",displayName:"SV inspector",stateModel:t,ReactComponent:pn})}))}(e),function(e){e.addToExtensionPoint("LaunchView-SvInspectorView",(async({session:e,assembly:t,uri:a,fileType:r})=>{const n=e.addView("SvInspectorView"),o=a.split(".");let i=o.pop()?.toUpperCase();"GZ"===i&&(i=o.pop()?.toUpperCase()),n.spreadsheetView.importWizard.setFileType(r||i||""),n.spreadsheetView.importWizard.setSelectedAssemblyName(t),n.spreadsheetView.importWizard.setFileSource({uri:a,locationType:"UriLocation"}),await n.spreadsheetView.importWizard.import(t)}))}(e)}configure(e){(0,tn.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:an.A,onClick:e=>{e.addView("SvInspectorView",{})}})}}var fn=a(88217),hn=a(48231);const yn=(0,u.observer)((function({text:e,x:t,y:a,region:r,reversed:n,bpPerPx:o,exportSVG:i,feature:s,viewParams:c,color:u="black",fontHeight:p=11,featureWidth:m=0,allowedWidthExpansion:g=0,displayModel:f={}}){const h=m+g,y=(0,d.measureText)(e,p),b=(0,v.isStateTreeNode)(f)&&(0,v.isAlive)(f)&&!i?(0,d.getViewParams)(f):c,w=n?b.end:b.start,[C,S]=(0,l.useState)(i),k=(0,hn.A)();if((0,l.useEffect)((()=>{S(!0)}),[]),(0,v.isStateTreeNode)(r)&&!(0,v.isAlive)(r))return null;const T=r.start,x=r.end,A=s.get("start"),P=s.get("end"),M=y*o;return w<x&&w>T&&A<w&&w+M<P?t=b.offsetPx:A<w&&w+M<P&&w+M>T&&w+M<x&&(t=b.offsetPx1),C?l.createElement("text",{x:t,y:a+p,fill:"#f0f"===u?(0,d.stripAlpha)(k.palette.text.primary):u,fontSize:p},y>h?`${e.slice(0,h/(.6*p))}...`:e):null}));function bn(){return bn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},bn.apply(null,arguments)}const wn=(0,u.observer)((function(e){const{feature:t,rootLayout:a,config:r,name:n,description:o,shouldShowName:i,shouldShowDescription:s}=e,d=a.getSubRecord(String(t.id()));if(!d)return null;const{GlyphComponent:u}=d.data||{};return l.createElement("g",null,l.createElement(u,bn({featureLayout:d},e)),i?l.createElement(yn,bn({text:n,x:a.getSubRecord("nameLabel")?.absolute.left||0,y:a.getSubRecord("nameLabel")?.absolute.top||0,color:(0,c.readConfObject)(r,["labels","nameColor"],{feature:t}),featureWidth:d.width},e)):null,s?l.createElement(yn,bn({text:o,x:a.getSubRecord("descriptionLabel")?.absolute.left||0,y:a.getSubRecord("descriptionLabel")?.absolute.top||0,color:(0,c.readConfObject)(r,["labels","descriptionColor"],{feature:t}),featureWidth:d.width},e)):null)}));function vn(){return vn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},vn.apply(null,arguments)}function Cn({rect:e,region:t,bpPerPx:a,...r}){if(!e)return null;const[n,o,i,s]=e,[c,u]=(0,d.bpSpanPx)(n,i,t,a),p=Math.round(o),m=(t.end-t.start)/a,g=Math.round(s-o),f=u-c;if(c+f<0)return null;const h=Math.max(c,0),y=h-c,b=Math.max(1,Math.min(f-y,m));return l.createElement("rect",vn({x:h-2,y:p-2,width:b+4,height:g+4},r))}const Sn=(0,u.observer)((function({displayModel:e={},blockKey:t,region:a,bpPerPx:r,movedDuringLastMouseDown:n,...o}){const{selectedFeatureId:i,featureIdUnderMouse:s,contextMenuFeature:c}=e,d=s||c?.id(),[u,p]=(0,l.useState)(!1);function m(e){const{onFeatureMouseOut:t}=o;t&&d&&t(e,d)}function g(e){const{onFeatureMouseOver:t}=o;t&&d&&t(e,d)}return(0,l.useEffect)((()=>{p(!0)}),[]),u?l.createElement(l.Fragment,null,d?l.createElement(Cn,{rect:e.getFeatureByID?.(t,d),region:a,bpPerPx:r,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){const{onFeatureMouseDown:t}=o;t&&d&&t(e,d)},onMouseEnter:function(e){const{onFeatureMouseEnter:t}=o;t&&d&&t(e,d)},onMouseOut:m,onMouseOver:g,onMouseUp:function(e){const{onFeatureMouseUp:t}=o;t&&d&&t(e,d)},onMouseLeave:function(e){const{onFeatureMouseLeave:t}=o;t&&d&&t(e,d)},onMouseMove:function(e){const{onFeatureMouseMove:t}=o;t&&d&&t(e,d)},onClick:function(e){if(n)return;const{onFeatureClick:t}=o;t&&d&&(e.stopPropagation(),t(e,d))},onContextMenu:function(e){const{onFeatureContextMenu:t}=o;t&&d&&t(e,d)},onFocus:g,onBlur:m,"data-testid":d}):null,i?l.createElement(Cn,{rect:e.getFeatureByID?.(t,i),region:a,bpPerPx:r,stroke:"#00b8ff",fill:"none"}):null):null})),kn=(0,u.observer)((function({feature:e,featureLayout:t,config:a,region:r}){const n=e.get("strand"),o=r.reversed?-1:1,i=7*n*o,{left:s=0,top:u=0,width:p=0,height:m=0}=t.absolute,g=(0,c.readConfObject)(a,"color2",{feature:e}),f=(0,hn.A)(),h="#f0f"===g?(0,d.stripAlpha)(f.palette.text.secondary):g,y=n*o==-1?s:n*o==1?s+p:null,b=u+m/2;return y?l.createElement(l.Fragment,null,l.createElement("line",{x1:y,x2:y+i,y1:b,y2:b,stroke:h}),l.createElement("polygon",{points:[[y+i/2,b-2.5],[y+i/2,b+2.5],[y+i,b]].toString(),stroke:h,fill:h})):null})),Tn=(0,u.observer)((function(e){const t=(0,hn.A)(),{colorByCDS:a,feature:r,region:n,config:o,featureLayout:i,bpPerPx:s,topLevel:u}=e,{start:p,end:m}=n,g=(m-p)/s,f=r.get("start"),h=r.get("end"),y=r.get("type"),b=r.get("strand"),w=r.get("phase"),v=(h-f)/s,{left:C=0}=i.absolute;let{top:S=0,height:k=0}=i.absolute;if(C+v<0)return null;On(r)&&(S+=.175*k,k*=.65);const T=Math.max(C,0),x=T-C,A=Math.max(2,Math.min(v-x,g));let P=On(r)?(0,c.readConfObject)(o,"color3",{feature:r}):(0,c.readConfObject)(o,"color1",{feature:r});if(a&&"CDS"===y&&void 0!==b&&void 0!==w){const e=(0,d.getFrame)(f,h,b,w),a=t.palette.framesCDS.at(e)?.main;a&&(P=a)}return r.parent()&&"intron"===y?null:l.createElement(l.Fragment,null,u?l.createElement(kn,e):null,l.createElement("rect",{"data-testid":`box-${r.id()}`,x:T,y:S,width:A,height:k,fill:P,stroke:(0,c.readConfObject)(o,"outline",{feature:r})}))}));function xn(){return xn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},xn.apply(null,arguments)}const An=(0,u.observer)((function(e){const{feature:t,featureLayout:a,selected:r,config:n,subfeatures:o=t.get("subfeatures")}=e,i=(0,hn.A)(),s=(0,c.readConfObject)(n,"color2",{feature:t}),u="#f0f"===s?(0,d.stripAlpha)(i.palette.text.secondary):s,{left:p=0,top:m=0,width:g=0,height:f=0}=a.absolute,h=m+f/2;return l.createElement(l.Fragment,null,l.createElement("line",{"data-testid":t.id(),x1:p,y1:h,y2:h,x2:p+g,stroke:u}),o?.map((t=>{const n=String(t.id()),o=a.getSubRecord(n);if(!o)return null;const{GlyphComponent:i}=o.data||{};return l.createElement(i,xn({key:`glyph-${n}`},e,{feature:t,topLevel:!1,featureLayout:o,selected:r}))})),l.createElement(kn,e))}));function Pn(){return Pn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Pn.apply(null,arguments)}function Mn(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function En(e,t){let a=e.get("subfeatures");if(!a||0===a.length)return[];const r=a.some((e=>Mn(e))),n=["mRNA","transcript"].includes(e.get("type"));return(!r&&n||(0,c.readConfObject)(t,"impliedUTRs"))&&(a=function(e,t){const a=[...t];let r,n,o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const s=[];for(const t of a){const a=t.get("type");/^cds/i.test(a)?(o>t.get("start")&&(o=t.get("start")),i<t.get("end")&&(i=t.get("end"))):/exon/i.test(a)?s.push(t):Mn(t)&&(r=t.get("start")===e.get("start"),n=t.get("end")===e.get("end"))}if(!(s.length&&o<Number.POSITIVE_INFINITY&&i>Number.NEGATIVE_INFINITY))return a;s.sort(((e,t)=>e.get("start")-t.get("start")));const l=e.get("strand");let c,u;if(!r)for(let t=0;t<s.length&&(c=s[t].get("start"),!(c>=o));t++){u=Math.min(o,s[t].get("end"));const r=l>=0?"five_prime_UTR":"three_prime_UTR";a.unshift(new d.SimpleFeature({parent:e,id:`${e.id()}_${r}_${t}`,data:{start:c,end:u,strand:l,type:r}}))}if(!n)for(let t=s.length-1;t>=0&&(u=s[t].get("end"),!(u<=i));t--){c=Math.max(i,s[t].get("start"));const r=l>=0?"three_prime_UTR":"five_prime_UTR";a.push(new d.SimpleFeature({parent:e,id:`${e.id()}_${r}_${t}`,data:{start:c,end:u,strand:l,type:r}}))}return a}(e,a)),a.filter((e=>function(e,t){return function(e,t){const a=(0,c.readConfObject)(t,"subParts"),r="string"==typeof a?a.split(/\s*,\s*/):a;return e=>r.map((e=>e.toLowerCase())).includes(e.get("type").toLowerCase())}(0,t)(e)}(e,t)))}const Rn=(0,u.observer)((function(e){const{feature:t,config:a}=e,r=En(t,a);return l.createElement(An,Pn({},e,{subfeatures:r}))}));Rn.layOut=({layout:e,feature:t,bpPerPx:a,reversed:r,config:n,extraGlyphs:o})=>{const i=Vn({layout:e,feature:t,bpPerPx:a,reversed:r,config:n,extraGlyphs:o});return zn({layout:i,subfeatures:En(t,n),bpPerPx:a,reversed:r,config:n,extraGlyphs:o}),i};const In=Rn;function Nn(){return Nn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Nn.apply(null,arguments)}const Ln=(0,u.observer)((function(e){const{feature:t,featureLayout:a,selected:r}=e;return t.get("subfeatures")?.map((t=>{const n=String(t.id()),o=a.getSubRecord(n);if(!o)return null;const{GlyphComponent:i}=o.data||{};return l.createElement(i,Nn({key:`glyph-${n}`},e,{feature:t,featureLayout:o,selected:r}))}))}));Ln.layOut=({layout:e,feature:t,bpPerPx:a,reversed:r,config:n,extraGlyphs:o})=>{const i=Vn({layout:e,feature:t,bpPerPx:a,reversed:r,config:n,extraGlyphs:o}),s=(0,c.readConfObject)(n,"displayMode");if("reducedRepresentation"!==s){let e=0;t.get("subfeatures")?.forEach((t=>{const l=Fn({feature:t,extraGlyphs:o,config:n}),d=(0,c.readConfObject)(n,"height",{feature:t});(l.layOut||Bn)({layout:i,feature:t,bpPerPx:a,reversed:r,config:n,extraGlyphs:o}).move(0,e),e+="collapse"===s?0:("compact"===s?d/3:d)+2}))}return i};const Dn=Ln;function Fn({feature:e,extraGlyphs:t,config:a}){const r=e.get("type"),n=e.get("subfeatures"),o=(0,c.readConfObject)(a,"transcriptTypes"),i=(0,c.readConfObject)(a,"containerTypes");if(n?.length&&"CDS"!==r){const t=n.some((e=>e.get("subfeatures")?.length)),a=n.some((e=>"CDS"===e.get("type")));return o.includes(r)&&a?In:!e.parent()&&t||i.includes(r)?Dn:An}return t?.find((t=>t.validator(e)))?.glyph||Tn}function Bn({layout:e,feature:t,bpPerPx:a,reversed:r,config:n,extraGlyphs:o}){const i=(0,c.readConfObject)(n,"displayMode"),s=Vn({layout:e,feature:t,bpPerPx:a,reversed:r,config:n,extraGlyphs:o});return"reducedRepresentation"!==i&&zn({layout:s,subfeatures:t.get("subfeatures")||[],bpPerPx:a,reversed:r,config:n,extraGlyphs:o}),s}function Vn(e){const{layout:t,feature:a,bpPerPx:r,reversed:n,config:o,extraGlyphs:i}=e,s=(0,c.readConfObject)(o,"displayMode"),l="reducedRepresentation"===s?Tn:Fn({feature:a,extraGlyphs:i,config:o}),d=a.parent();let u=0;d&&(u=(n?d.get("end")-a.get("end"):a.get("start")-d.get("start"))/r);const p=(0,c.readConfObject)(o,"height",{feature:a}),m=(a.get("end")-a.get("start"))/r,g=t.parent,f=g?g.top:0;return t.addChild(String(a.id()),u,"collapse"===s?0:f,Math.max(m,1),"compact"===s?p/2:p,{GlyphComponent:l})}function zn(e){const{layout:t,subfeatures:a,bpPerPx:r,reversed:n,config:o,extraGlyphs:i}=e;a.forEach((e=>{(Fn({feature:e,extraGlyphs:i,config:o}).layOut||Bn)({layout:t,feature:e,bpPerPx:r,reversed:n,config:o,extraGlyphs:i})}))}function On(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function Hn(){return Hn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Hn.apply(null,arguments)}function Gn(e){const{feature:t,detectRerender:a,bpPerPx:r,region:n,config:o,displayMode:i,layout:s,extraGlyphs:u}=e;a?.();const{reversed:p}=n,m=t.get(p?"end":"start"),g=(0,d.bpToPx)(m,n,r),f="collapsed"!==i,h=new fn.SceneGraph("root",0,0,0,0),y=(Fn({config:o,feature:t,extraGlyphs:u}).layOut||Bn)({layout:h,feature:t,bpPerPx:r,reversed:p,config:o,extraGlyphs:u});let b=!1,w=!1,v="",C="",S=0,k=0;if(f){const e=(0,c.readConfObject)(o,"showLabels"),a=(0,c.readConfObject)(o,"showDescriptions");S=(0,c.readConfObject)(o,["labels","fontSize"],{feature:t}),k=(0,c.readConfObject)(o,"maxFeatureGlyphExpansion")||0,v=String((0,c.readConfObject)(o,["labels","name"],{feature:t})||""),b=/\S/.test(v)&&e;const r=e=>{const t=h.width+k,a=(0,d.measureText)(e,S);return Math.round(Math.min(a,t))};if(C=String((0,c.readConfObject)(o,["labels","description"],{feature:t})||""),w=/\S/.test(C)&&a,b&&h.addChild("nameLabel",0,y.bottom,r(v),S),w){const e=b?h.getSubRecord("nameLabel"):y;if(!e)throw new Error("failed to layout nameLabel");h.addChild("descriptionLabel",0,e.bottom,r(C),S)}}const T=s.addRect(t.id(),t.get("start"),t.get("start")+h.width*r+3*r,h.height+5);return null===T?null:(h.move(g,T),l.createElement(wn,Hn({rootLayout:h,name:v,shouldShowName:b,description:C,shouldShowDescription:w,fontHeight:S,allowedWidthExpansion:k,reversed:n.reversed,topLevel:!0},e)))}const jn=(0,u.observer)((function(e){const{features:t=new Map,isFeatureDisplayed:a}=e;return l.createElement(l.Fragment,null,[...t.values()].filter((e=>!a||a(e))).map((t=>l.createElement(Gn,Hn({key:t.id(),feature:t},e)))))})),Wn=(0,u.observer)((function(e){const{layout:t,blockKey:a,regions:r=[],bpPerPx:n,config:o,displayModel:i={},exportSVG:s,featureDisplayHandler:d,onMouseOut:u,onMouseDown:p,onMouseLeave:m,onMouseEnter:g,onMouseOver:f,onMouseMove:h,onMouseUp:y,onClick:b}=e,w=r[0],v=(w.end-w.start)/n,C=(0,c.readConfObject)(o,"displayMode"),S=(0,c.readConfObject)(o,"maxHeight"),k=(0,l.useRef)(null),[T,x]=(0,l.useState)(!1),[A,P]=(0,l.useState)(S),[M,E]=(0,l.useState)(!1),R=(0,l.useCallback)((e=>(x(!0),E(!1),p?.(e))),[p]),I=(0,l.useCallback)((e=>(x(!1),y?.(e))),[y]),N=(0,l.useCallback)((e=>{if(!k.current)return;T&&E(!0);const{left:t,top:r}=k.current.getBoundingClientRect(),o=e.clientX-t,s=e.clientY-r,l=w.reversed?v-o:o,c=w.start+n*l,d=i.getFeatureOverlapping?.(a,c,s);h&&h(e,d)}),[a,n,T,h,w.reversed,w.start,i,v]),L=(0,l.useCallback)((e=>{M||b?.(e)}),[M,b]);return(0,l.useEffect)((()=>{P(t.getTotalHeight())}),[t]),s?l.createElement(jn,Hn({displayMode:C,isFeatureDisplayed:d,region:w},e)):l.createElement("svg",{ref:k,"data-testid":"svgfeatures",width:v,height:A+100,style:{display:"block"},onMouseDown:R,onMouseUp:I,onMouseEnter:g,onMouseLeave:m,onMouseOver:f,onMouseOut:u,onMouseMove:N,onClick:L},l.createElement(jn,Hn({displayMode:C,region:w,movedDuringLastMouseDown:M,isFeatureDisplayed:d},e)),l.createElement(Sn,Hn({},e,{region:w,movedDuringLastMouseDown:M})))})),$n=(0,c.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"#f0f",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:(0,c.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"#f0f",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:12,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:v.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:1200},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1},transcriptTypes:{type:"stringArray",defaultValue:["mRNA","transcript","primary_transcript"]},containerTypes:{type:"stringArray",defaultValue:["proteoform_orf"]}},{explicitlyTyped:!0});class Un extends Ka.default{supportsSVG=!0}class qn extends n.A{name="SVGPlugin";install(e){e.addRendererType((()=>new Un({name:"SvgFeatureRenderer",ReactComponent:Wn,configSchema:$n,pluginManager:e})))}}const _n=(0,c.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"},description:"the location of the trix ix file"},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"},description:"the location of the trix ixx file"},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"},description:"the location of the metadata json file for the trix index"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"});class Jn extends n.A{name="TrixPlugin";install(e){e.addTextSearchAdapterType((()=>new Ta.A({name:"TrixTextSearchAdapter",displayName:"Trix text search adapter",configSchema:_n,description:"Trix text search adapter",getAdapterClass:()=>a.e(5260).then(a.bind(a,15260)).then((e=>e.default))})))}}var Xn=a(6171);const Yn=[qn,k.Ay,r.Ay,se,he,Ne.Ay,je.A,We.A,It,oa,Ot,va,Pa,Xa,or,hr,Tr,Hr,Xn.A,Lt.Ay,Bt,en,gn,Ie,ya,Jn,ra,Ge,A]},52404:()=>{}}]);
//# sourceMappingURL=13.85cf43da.chunk.js.map