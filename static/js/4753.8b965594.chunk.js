"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4753],{30385:(e,t,n)=>{n.d(t,{C4:()=>d,OX:()=>f,Ww:()=>u,xx:()=>s});var o=n(99546),a=n(79610);const s=16581375;function r(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const i={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},l=3,c=1600;function f(e,t,n,o){return Math.floor((255*e*255+255*t+n-1)/o)}function u(e,t,n){const f=(0,o.getContainingView)(e),u=f.drawCurves,d=f.drawCIGAR,{level:g,height:h,featPositions:v}=e,m=f.width,b=f.views.map((e=>e.bpPerPx));n&&(n.imageSmoothingEnabled=!1),t.beginPath();const x=f.views.map((e=>e.offsetPx)),C=Math.floor(s/v.length);t.fillStyle=i.M,t.strokeStyle=i.M;for(const{p11:e,p12:n,p21:o,p22:a}of v){const s=e.offsetPx-x[g],r=n.offsetPx-x[g],i=o.offsetPx-x[g+1],f=a.offsetPx-x[g+1],d=Math.abs(r-s),v=Math.abs(f-i),b=0,C=h,p=(C-b)/2;d<=l&&v<=l&&i<m+c&&i>-c&&(t.moveTo(s,b),u?t.bezierCurveTo(s,p,i,p,i,C):t.lineTo(i,C))}t.stroke(),t.fillStyle=i.M,t.strokeStyle=i.M;for(const{p11:e,p12:C,p21:p,p22:M,f:w,cigar:k}of v){const v=e.offsetPx-x[g],S=C.offsetPx-x[g],T=p.offsetPx-x[g+1],P=M.offsetPx-x[g+1],$=Math.abs(S-v),y=Math.abs(P-T),I=Math.min(T,P),X=Math.max(T,P),j=0,L=h,N=(L-j)/2;if(!($<=l&&y<=l)&&(0,o.doesIntersect2)(I,X,-c,f.width+c)){const e=w.get("strand"),o=-1===e?S:v,l=o<(-1===e?v:S)?1:-1,c=(T<P?1:-1)*e;let f=o,h=-1===e?P:T;if(k.length&&d){let e=!1,o=0,d=0;const v=Math.floor(s/k.length);for(let s=0;s<k.length;s+=2){const x=s*v+1,C=+k[s],p=k[s+1];e||(o=f,d=h);const M=C/b[g],w=C/b[g+1];if("M"===p||"="===p||"X"===p?(f+=M*l,h+=w*c):"D"===p||"N"===p?f+=M*l:"I"===p&&(h+=w*c),!(Math.max(o,d,f,h)<0||Math.min(o,d,f,h)>m)){const l=s<k.length-2;Math.abs(f-o)<=1&&Math.abs(h-d)<=1&&l?e=!0:(t.fillStyle=i[e&&M>1||w>1?p:"M"],e=!1,(0,a.$2)(t,o,f,j,h,d,L,N,u),t.fill(),n&&(n.fillStyle=r(x),(0,a.$2)(n,o,f,j,h,d,L,N,u),n.fill()))}}}else(0,a.$2)(t,v,S,j,P,T,L,N,u),t.fill()}}const p=e.clickMapCanvas?.getContext("2d");if(p){p.imageSmoothingEnabled=!1,p.clearRect(0,0,m,h);for(let e=0;e<v.length;e++){const t=v[e],n=e*C+1;p.fillStyle=r(n),(0,a.mr)({cb:e=>{e.fill()},feature:t,ctx:p,drawCurves:u,level:g,offsets:x,oobLimit:c,viewWidth:f.width,hideTiny:!0,height:h})}}}function d(e){const{level:t,clickId:n,mouseoverId:s}=e,r=(0,o.getContainingView)(e),i=r.drawCurves,l=e.height,f=r.width,u=e.mouseoverCanvas?.getContext("2d"),d=r.views.map((e=>e.offsetPx));if(!u)return;u.resetTransform(),u.scale(1,1),u.clearRect(0,0,f,l),u.strokeStyle="rgba(0, 0, 0, 0.9)",u.fillStyle="rgba(0, 0, 0, 0.1)";const g=e.featMap[s||""];g&&(0,a.mr)({cb:e=>{e.fill()},feature:g,level:t,ctx:u,oobLimit:c,viewWidth:r.width,drawCurves:i,offsets:d,height:l});const h=e.featMap[n||""];h&&(0,a.mr)({cb:e=>{e.stroke()},feature:h,ctx:u,level:t,oobLimit:c,viewWidth:r.width,drawCurves:i,offsets:d,height:l})}},44753:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var o=n(7552),a=n(49823),s=n(68446),r=n(75785),i=n(99546),l=n(42489),c=n(30385),f=n(69500);function u({model:e,onClose:t,anchorEl:n}){const o=(0,i.getContainingView)(e),{clientX:s,clientY:r,feature:l}=n;return(0,f.jsx)(a.Menu,{onMenuItemClick:(e,n)=>{n(e),t()},anchorEl:{nodeType:1,getBoundingClientRect:()=>({top:r,left:s,bottom:r,right:s,width:0,height:0,x:s,y:r,toJSON(){}})},onClose:t,open:Boolean(n),menuItems:[{label:"Center on feature",onClick:()=>{const{f:t}=l,n=t.get("start"),a=t.get("end"),s=t.get("refName"),r=t.get("mate"),c=o.views[e.level],f=o.views[e.level+1];c.navToLocString(`${s}:${n}-${a}`).catch((t=>{const n=`${c.assemblyNames[0]}:${t}`;console.error(n),(0,i.getSession)(e).notifyError(n,t)})),f.navToLocString(`${r.refName}:${r.start}-${r.end}`).catch((t=>{const n=`${f.assemblyNames[0]}:${t}`;console.error(n),(0,i.getSession)(e).notifyError(n,t)}))}}]})}var d=n(79610);const g=(0,o.lazy)((()=>n.e(7831).then(n.bind(n,47831)))),h=(0,r.n9)()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},mouseoverCanvas:{position:"absolute",pointEvents:"none"},mainCanvas:{position:"absolute"}}),v=(0,s.observer)((function({model:e}){const{classes:t}=h(),{mouseoverId:n,height:a}=e,s=(0,o.useRef)(0),r=(0,i.getContainingView)(e),v=r.width,m=(0,o.useRef)(0),b=(0,o.useRef)(!1),x=(0,o.useRef)(null),[C,p]=(0,o.useState)(),[M,w]=(0,o.useState)(""),[k,S]=(0,o.useState)(),[T,P]=(0,o.useState)(),[$,y]=(0,o.useState)(),[I,X]=(0,o.useState)(),j=(0,o.useRef)(null),L=(0,o.useCallback)((t=>{e.setMouseoverCanvasRef(t)}),[e,a,v]),N=(0,o.useCallback)((t=>{e.setMainCanvasRef(t),j.current=t}),[e,a,v]);(0,o.useEffect)((()=>{function e(e){if(e.preventDefault(),e.ctrlKey){m.current+=e.deltaY/500;for(const e of r.views)e.setScaleFactor(m.current<0?1-m.current:1/(1+m.current));x.current&&clearTimeout(x.current),x.current=setTimeout((()=>{for(const t of r.views)t.setScaleFactor(1),t.zoomTo(m.current>0?t.bpPerPx*(1+m.current):t.bpPerPx/(1-m.current),e.clientX-(j.current?.getBoundingClientRect().left||0));m.current=0}),300)}else Math.abs(e.deltaY)<Math.abs(e.deltaX)&&(s.current+=e.deltaX/2),b.current||(b.current=!0,window.requestAnimationFrame((()=>{(0,l.transaction)((()=>{for(const e of r.views)e.horizontalScroll(s.current);s.current=0,b.current=!1}))})))}return j.current?.addEventListener("wheel",e),()=>{j.current?.removeEventListener("wheel",e)}}),[e,a,v]);const R=(0,o.useCallback)((t=>{e.setClickMapCanvasRef(t)}),[e,a,v]),E=(0,o.useCallback)((t=>{e.setCigarClickMapCanvasRef(t)}),[e,a,v]);return(0,f.jsxs)("div",{className:t.rel,children:[(0,f.jsx)("canvas",{ref:L,width:v,height:a,className:t.mouseoverCanvas}),(0,f.jsx)("canvas",{ref:N,onMouseMove:t=>{if(void 0!==T)s.current+=T-t.clientX,P(t.clientX),b.current||(b.current=!0,window.requestAnimationFrame((()=>{(0,l.transaction)((()=>{for(const e of r.views)e.horizontalScroll(s.current);s.current=0,b.current=!1}))})));else{const n=e.clickMapCanvas,o=e.cigarClickMapCanvas;if(!n||!o)return;const a=n.getBoundingClientRect(),s=n.getContext("2d"),r=o.getContext("2d");if(!s||!r)return;const{clientX:i,clientY:l}=t,f=i-a.left,u=l-a.top;S(i),X(l);const[g,h,v]=s.getImageData(f,u,1,1).data,[m,b,x]=r.getImageData(f,u,1,1).data,C=Math.floor(c.xx/e.numFeats),p=(0,c.OX)(g,h,v,C);if(e.setMouseoverId(e.featPositions[p]?.f.id()),-1===p)w("");else if(e.featPositions[p]){const{f:t,cigar:n}=e.featPositions[p],o=Math.floor(c.xx/n.length),a=(0,c.OX)(m,b,x,o);w((0,d.Eg)({feature:t,cigarOp:n[a],cigarOpLen:n[a+1]}))}}},onMouseLeave:()=>{e.setMouseoverId(void 0),y(void 0),P(void 0)},onMouseDown:e=>{P(e.clientX),y(e.clientX)},onMouseUp:t=>{P(void 0),void 0!==$&&Math.abs(t.clientX-$)<5&&(0,d.WT)(t,e)},onContextMenu:t=>{(0,d.f0)(t,e,p)},"data-testid":"synteny_canvas",className:t.mainCanvas,width:v,height:a}),(0,f.jsx)("canvas",{ref:R,className:t.pix,width:v,height:a}),(0,f.jsx)("canvas",{ref:E,className:t.pix,width:v,height:a}),n&&M&&k&&I?(0,f.jsx)(g,{title:M}):null,C?(0,f.jsx)(u,{model:e,anchorEl:C,onClose:()=>{p(void 0)}}):null]})})),m=(0,r.n9)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10},blockError:{background:"#f1f1f1",padding:10,color:"red"}}}));function b(){const[e,t]=(0,o.useState)(!1),{classes:n}=m();return(0,o.useEffect)((()=>{const e=setTimeout((()=>{t(!0)}),300);return()=>{clearTimeout(e)}})),e?(0,f.jsx)("div",{className:n.loading,children:(0,f.jsx)(a.LoadingEllipses,{})}):null}function x({messageText:e}){const{classes:t}=m();return(0,f.jsx)("div",{className:t.blockMessage,children:e})}function C({error:e}){const{classes:t}=m();return(0,f.jsx)("div",{className:t.blockError,children:`${e}`})}const p=(0,s.observer)((function({model:e}){return e.error?(0,f.jsx)(C,{error:e.error}):e.message?(0,f.jsx)(x,{messageText:e.message}):e.features?(0,f.jsx)(v,{model:e}):(0,f.jsx)(b,{})}))},79610:(e,t,n)=>{n.d(t,{$2:()=>r,Eg:()=>c,WT:()=>i,f0:()=>l,mr:()=>s});var o=n(99546),a=n(30385);function s({feature:e,ctx:t,offsets:n,level:a,cb:s,height:i,drawCurves:l,oobLimit:c,viewWidth:f,hideTiny:u}){const{p11:d,p12:g,p21:h,p22:v}=e,m=d.offsetPx-n[a],b=g.offsetPx-n[a],x=h.offsetPx-n[a+1],C=v.offsetPx-n[a+1],p=Math.abs(b-m),M=Math.abs(C-x),w=i,k=(w-0)/2,S=Math.min(x,C),T=Math.max(x,C);(0,o.doesIntersect2)(S,T,-c,f+c)&&(p<=1&&M<=1?u||(t.beginPath(),t.moveTo(m,0),l?t.bezierCurveTo(m,k,x,k,x,w):t.lineTo(x,w),t.stroke()):(r(t,m,b,0,C,x,w,k,l),s(t)))}function r(e,t,n,o,a,s,r,i,l){l?function(e,t,n,o,a,s,r,i){const l=Math.abs(t-n),c=Math.abs(t-n);if(l<5&&c<5&&n<t&&Math.abs(t-a)>100){const e=t;t=n,n=e}e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.bezierCurveTo(n,i,a,i,a,r),e.lineTo(s,r),e.bezierCurveTo(s,i,t,i,t,o),e.closePath()}(e,t,n,o,a,s,r,i):function(e,t,n,o,a,s,r){e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.lineTo(a,r),e.lineTo(s,r),e.closePath()}(e,t,n,o,a,s,r)}function i(e,t){const n=(0,o.getContainingView)(t),s=(0,o.getContainingTrack)(t),{featPositions:r,numFeats:i,clickMapCanvas:l,cigarClickMapCanvas:c,level:f}=t;if(!l||!c)return;const u=l.getBoundingClientRect(),d=l.getContext("2d"),g=c.getContext("2d");if(!d||!g)return;const h=e.clientX-u.left,v=e.clientY-u.top,[m,b,x]=d.getImageData(h,v,1,1).data,C=Math.floor(a.xx/i),p=r[(0,a.OX)(m,b,x,C)];if(p){const{f:e}=p;t.setClickId(e.id());const a=(0,o.getSession)(t);(0,o.isSessionModelWithWidgets)(a)&&a.showWidget(a.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:n,track:s,featureData:e.toJSON(),level:f}))}return p}function l(e,t,n){e.preventDefault();const o=t.clickMapCanvas,s=t.cigarClickMapCanvas;if(!o||!s)return;const r=o.getBoundingClientRect(),i=o.getContext("2d"),l=s.getContext("2d");if(!i||!l)return;const{clientX:c,clientY:f}=e,u=c-r.left,d=f-r.top,[g,h,v]=i.getImageData(u,d,1,1).data,m=Math.floor(a.xx/t.numFeats),b=(0,a.OX)(g,h,v,m),x=t.featPositions[b];x&&(t.setClickId(x.f.id()),n({clientX:c,clientY:f,feature:x}))}function c({feature:e,cigarOp:t,cigarOpLen:n}){const a=e.toJSON(),s=a.mate,r=a.end-a.start,i=s.end-s.start,l=a.identity,c=a.name,f=s.name;return[`Loc1: ${(0,o.assembleLocString)(a)}`,`Loc2: ${(0,o.assembleLocString)(s)}`,`Inverted: ${-1===a.strand}`,`Query len: ${r.toLocaleString("en-US")}`,`Target len: ${i.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${n}`:"",c?`Name 1: ${c}`:"",f?`Name 2: ${f}`:""].filter((e=>!!e)).join("<br/>")}}}]);
//# sourceMappingURL=4753.8b965594.chunk.js.map