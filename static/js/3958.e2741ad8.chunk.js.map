{"version":3,"file":"static/js/3958.e2741ad8.chunk.js","mappings":"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","sources":["../../../plugins/alignments/src/LinearReadArcsDisplay/components/LinearReadArcsReactComponent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/NonBlockCanvasDisplayComponent.tsx","../../../packages/core/src/ui/ErrorMessageStackTraceContents.tsx","../../../packages/core/src/ui/ErrorMessageStackTraceDialog.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BlockErrorMessage.tsx"],"sourcesContent":["import { useCallback } from 'react'\n\nimport { getContainingView } from '@jbrowse/core/util'\nimport { NonBlockCanvasDisplayComponent as BaseDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { observer } from 'mobx-react'\n\nimport type { LinearReadArcsDisplayModel } from '../model.ts'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nconst Arcs = observer(function Arcs({\n  model,\n}: {\n  model: LinearReadArcsDisplayModel\n}) {\n  const view = getContainingView(model) as LGV\n  const width = Math.round(view.dynamicBlocks.totalWidthPx)\n  const height = model.height\n  // biome-ignore lint/correctness/useExhaustiveDependencies:\n  const cb = useCallback(\n    (ref: HTMLCanvasElement) => {\n      model.setRef(ref)\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [model, width, height],\n  )\n\n  // note: the position absolute below avoids scrollbar from appearing on track\n  return (\n    <div style={{ position: 'relative', width, height }}>\n      <canvas\n        data-testid=\"arc-canvas\"\n        ref={cb}\n        style={{ width, height, position: 'absolute' }}\n        width={width * 2}\n        height={height * 2}\n      />\n    </div>\n  )\n})\n\nconst LinearReadArcsReactComponent = observer(\n  function LinearReadArcsReactComponent({\n    model,\n  }: {\n    model: LinearReadArcsDisplayModel\n  }) {\n    return (\n      <BaseDisplayComponent model={model}>\n        <Arcs model={model} />\n      </BaseDisplayComponent>\n    )\n  },\n)\n\nexport default LinearReadArcsReactComponent\n","import React from 'react'\n\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { observer } from 'mobx-react'\n\nimport BlockErrorMessage from './BlockErrorMessage.tsx'\nimport FloatingLegend from './FloatingLegend.tsx'\n\nimport type { LinearGenomeViewModel } from '../../LinearGenomeView/index.ts'\nimport type { LegendItem } from '../model.ts'\n\n/**\n * Interface for models that can be rendered with NonBlockCanvasDisplayComponent.\n * These are displays that render to a single canvas across the view width\n * rather than using block-based rendering.\n */\nexport interface NonBlockCanvasDisplayModel {\n  error?: unknown\n  regionTooLarge?: boolean\n  reload: () => void\n  regionCannotBeRendered: () => React.ReactElement | null\n  drawn: boolean\n  loading: boolean\n  lastDrawnOffsetPx?: number\n  statusMessage?: string\n  showLegend?: boolean\n  legendItems?: () => LegendItem[]\n}\n\nconst useStyles = makeStyles()({\n  loading: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    backgroundColor: 'rgba(255, 255, 255, 0.15)',\n    backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(0, 0, 0, 0.05) 8px, rgba(0, 0, 0, 0.05) 16px)`,\n    pointerEvents: 'none',\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    zIndex: 1,\n  },\n  loadingMessage: {\n    zIndex: 2,\n    pointerEvents: 'none',\n  },\n})\n\n/**\n * Component that handles the display container for non-block-based canvas displays.\n *\n * This component:\n * - Shows error messages when the display has an error\n * - Shows region-too-large message when appropriate\n * - Handles the offset positioning during scrolling (shifts the canvas using\n *   lastDrawnOffsetPx - view.offsetPx to provide smooth scrolling before re-render)\n * - Shows loading indicator when data is being fetched or the view has scrolled\n */\nconst NonBlockCanvasDisplayComponent = observer(\n  function NonBlockCanvasDisplayComponent({\n    model,\n    children,\n  }: {\n    model: NonBlockCanvasDisplayModel\n    children?: React.ReactNode\n  }) {\n    const { error, regionTooLarge } = model\n    return error ? (\n      <BlockErrorMessage model={model} />\n    ) : regionTooLarge ? (\n      model.regionCannotBeRendered()\n    ) : (\n      <DataDisplay model={model}>{children}</DataDisplay>\n    )\n  },\n)\n\nconst DataDisplay = observer(function DataDisplay({\n  model,\n  children,\n}: {\n  model: NonBlockCanvasDisplayModel\n  children?: React.ReactNode\n}) {\n  const { drawn, loading, showLegend, legendItems } = model\n  const view = getContainingView(model) as LinearGenomeViewModel\n  const items = legendItems?.() ?? []\n\n  // Calculate how much to shift the rendered canvas to account for scrolling.\n  // When the user scrolls, view.offsetPx changes but the canvas content\n  // stays the same until a new render completes. This shift keeps the\n  // content aligned during that time.\n  const calculatedLeft = (model.lastDrawnOffsetPx ?? 0) - view.offsetPx\n\n  return (\n    // this data-testid is located here because changing props on the canvas\n    // itself is very sensitive to triggering ref invalidation\n    <div data-testid={`drawn-${drawn}`}>\n      <div\n        style={{\n          position: 'absolute',\n          left: calculatedLeft,\n        }}\n      >\n        {children}\n      </div>\n      {showLegend && items.length > 0 ? <FloatingLegend items={items} /> : null}\n      {calculatedLeft !== 0 || loading ? <LoadingBar model={model} /> : null}\n    </div>\n  )\n})\n\nconst LoadingBar = observer(function LoadingBar({\n  model,\n}: {\n  model: NonBlockCanvasDisplayModel\n}) {\n  const { classes } = useStyles()\n  const { statusMessage } = model\n  return (\n    <div className={classes.loading}>\n      <div className={classes.loadingMessage}>\n        <LoadingEllipses message={statusMessage} />\n      </div>\n    </div>\n  )\n})\n\nexport default NonBlockCanvasDisplayComponent\n","import { Typography, alpha } from '@mui/material'\n\nimport ExternalLink from './ExternalLink.tsx'\nimport { makeStyles } from '../util/tss-react/index.ts'\n\n// produce a source-map resolved stack trace\n// reference code https://stackoverflow.com/a/77158517/2129219\nconst EMAIL = 'jbrowse2@berkeley.edu'\n\nconst useStyles = makeStyles()(theme => ({\n  pre: {\n    background: alpha(theme.palette.error.main, 0.2),\n    border: `1px solid ${theme.palette.divider}`,\n    overflow: 'auto',\n    margin: 20,\n    maxHeight: 300,\n  },\n}))\n\nexport default function ErrorMessageStackTraceContents({\n  text,\n  extra,\n}: {\n  text: string\n  extra?: unknown\n}) {\n  const { classes } = useStyles()\n  const extraStr = extra\n    ? `supporting data: ${JSON.stringify(extra, null, 2)}`\n    : ''\n  const displayText = [text, extraStr].filter(Boolean).join('\\n')\n  const issueBody = encodeURIComponent(\n    `I got this error from JBrowse, here is the stack trace:\\n\\n\\`\\`\\`\\n${text}\\n\\`\\`\\`\\n${extraStr}\\n`,\n  )\n  const githubLink = `https://github.com/GMOD/jbrowse-components/issues/new?labels=bug&title=JBrowse+issue&body=${issueBody}`\n  const emailLink = `mailto:${EMAIL}?subject=JBrowse%202%20error&body=${issueBody}`\n\n  return (\n    <>\n      <Typography>\n        Post a new issue at{' '}\n        <ExternalLink href={githubLink}>GitHub</ExternalLink> or send an email\n        to <ExternalLink href={emailLink}>{EMAIL}</ExternalLink>\n      </Typography>\n      <pre className={classes.pre}>{displayText}</pre>\n    </>\n  )\n}\n","import { useEffect, useState } from 'react'\n\nimport CloseIcon from '@mui/icons-material/Close'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n} from '@mui/material'\nimport { SourceMapConsumer } from 'source-map-js'\n\nimport ErrorMessageStackTraceContents from './ErrorMessageStackTraceContents.tsx'\nimport LoadingEllipses from './LoadingEllipses.tsx'\n\nasync function myfetchtext(uri: string) {\n  const res = await fetch(uri)\n  if (!res.ok) {\n    throw new Error(`HTTP ${res.status} fetching ${uri}: ${await res.text()}`)\n  }\n  return res.text()\n}\n\nasync function myfetchjson(uri: string) {\n  return JSON.parse(await myfetchtext(uri))\n}\n\n// produce a source-map resolved stack trace\n// reference code https://stackoverflow.com/a/77158517/2129219\nconst sourceMaps: Record<string, SourceMapConsumer> = {}\nconst sourceMappingUrlRe = /\\/\\/# sourceMappingURL=(.*)/\nconst stackLineRe = /(.*)((?:https?|file):\\/\\/.*):(\\d+):(\\d+)/\n\nasync function getSourceMapFromUri(uri: string) {\n  if (sourceMaps[uri]) {\n    return sourceMaps[uri]\n  }\n  const uriQuery = new URL(uri).search\n  const currentScriptContent = await myfetchtext(uri)\n  const mapUri = sourceMappingUrlRe.exec(currentScriptContent)?.[1] ?? ''\n  const data = await myfetchjson(new URL(mapUri, uri).href + uriQuery)\n  const map = new SourceMapConsumer(data)\n  sourceMaps[uri] = map\n  return map\n}\n\nasync function mapStackTrace(stack: string) {\n  const mappedStack = []\n  for (const line of stack.split('\\n')) {\n    const match = stackLineRe.exec(line)\n    if (!match) {\n      mappedStack.push(line)\n      continue\n    }\n\n    const uri = match[2]!\n    const consumer = await getSourceMapFromUri(uri)\n    const pos = consumer.originalPositionFor({\n      line: +match[3]!,\n      column: +match[4]!,\n    })\n\n    if (!pos.source || !pos.line || !pos.column) {\n      mappedStack.push(line)\n      continue\n    }\n\n    mappedStack.push(\n      `${pos.source}:${pos.line}:${pos.column + 1} (${match[1]!.trim()})`,\n    )\n  }\n  return mappedStack.join('\\n')\n}\n\nconst MAX_ERR_LEN = 10_000\n\n// Chrome has the error message in the stacktrace, firefox doesn't.\n// Remove it since it can be very long due to mobx-state-tree stuff\nfunction stripMessage(trace: string, error: unknown) {\n  return trace.startsWith('Error:') ? trace.slice(`${error}`.length) : trace\n}\n\nfunction getStackTrace(error: unknown) {\n  return typeof error === 'object' && error !== null && 'stack' in error\n    ? `${error.stack}`\n    : ''\n}\n\nexport default function ErrorMessageStackTraceDialog({\n  error,\n  onClose,\n  extra,\n}: {\n  onClose: () => void\n  error: unknown\n  extra?: unknown\n}) {\n  const [mappedStackTrace, setMappedStackTrace] = useState<string>()\n  const [secondaryError, setSecondaryError] = useState<unknown>()\n  const [clicked, setClicked] = useState(false)\n  const errorText = error ? `${error}` : ''\n  const stackTrace = stripMessage(getStackTrace(error), errorText)\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        setMappedStackTrace(await mapStackTrace(stackTrace))\n      } catch (e) {\n        console.error(e)\n        setMappedStackTrace(stackTrace)\n        setSecondaryError(e)\n      }\n    })()\n  }, [stackTrace])\n\n  // @ts-expect-error\n  const version = window.JBrowseSession?.version\n  const errorBoxText = [\n    secondaryError\n      ? 'Error loading source map, showing raw stack trace below:'\n      : '',\n    errorText.length > MAX_ERR_LEN\n      ? `${errorText.slice(0, MAX_ERR_LEN)}...`\n      : errorText,\n    mappedStackTrace || 'No stack trace available',\n    version ? `JBrowse ${version}` : '',\n  ]\n    .filter(Boolean)\n    .join('\\n')\n\n  return (\n    <Dialog open onClose={onClose} maxWidth=\"xl\">\n      <DialogTitle>\n        Stack trace\n        <IconButton\n          onClick={onClose}\n          sx={{\n            position: 'absolute',\n            right: 8,\n            top: 8,\n          }}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {mappedStackTrace === undefined ? (\n          <LoadingEllipses variant=\"h6\" />\n        ) : (\n          <ErrorMessageStackTraceContents text={errorBoxText} extra={extra} />\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={async () => {\n            const { default: copy } = await import('copy-to-clipboard')\n            copy(errorBoxText)\n            setClicked(true)\n            setTimeout(() => {\n              setClicked(false)\n            }, 1000)\n          }}\n        >\n          {clicked ? 'Copied!' : 'Copy stack trace to clipboard'}\n        </Button>\n        <Button variant=\"contained\" color=\"primary\" onClick={onClose}>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import ErrorMessageStackTraceDialog from '@jbrowse/core/ui/ErrorMessageStackTraceDialog'\nimport { getSession } from '@jbrowse/core/util'\nimport RefreshIcon from '@mui/icons-material/Refresh'\nimport ReportIcon from '@mui/icons-material/Report'\nimport { IconButton, Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport BlockMsg from './BlockMsg.tsx'\n\nconst BlockErrorMessage = observer(function BlockErrorMessage({\n  model,\n}: {\n  model: {\n    error?: unknown\n    reload: () => void\n  }\n}) {\n  return (\n    <BlockMsg\n      message={`${model.error}`}\n      severity=\"error\"\n      action={\n        <>\n          <Tooltip title=\"Reload track\">\n            <IconButton\n              data-testid=\"reload_button\"\n              onClick={() => {\n                model.reload()\n              }}\n            >\n              <RefreshIcon />\n            </IconButton>\n          </Tooltip>\n          <Tooltip title=\"Show stack trace\">\n            <IconButton\n              onClick={() => {\n                getSession(model).queueDialog(onClose => [\n                  ErrorMessageStackTraceDialog,\n                  {\n                    onClose,\n                    error: model.error as Error,\n                  },\n                ])\n              }}\n            >\n              <ReportIcon />\n            </IconButton>\n          </Tooltip>\n        </>\n      }\n    />\n  )\n})\n\nexport default BlockErrorMessage\n"],"names":["Arcs","observer","model","view","getContainingView","width","Math","round","dynamicBlocks","totalWidthPx","height","cb","useCallback","ref","setRef","_jsx","style","position","children","BaseDisplayComponent","useStyles","makeStyles","loading","top","left","right","bottom","backgroundColor","backgroundImage","pointerEvents","display","justifyContent","alignItems","zIndex","loadingMessage","NonBlockCanvasDisplayComponent","error","regionTooLarge","BlockErrorMessage","regionCannotBeRendered","DataDisplay","drawn","showLegend","legendItems","items","calculatedLeft","lastDrawnOffsetPx","offsetPx","_jsxs","length","FloatingLegend","LoadingBar","classes","statusMessage","className","LoadingEllipses","message","EMAIL","theme","pre","background","alpha","palette","main","border","divider","overflow","margin","maxHeight","ErrorMessageStackTraceContents","t0","$","_c","text","extra","t1","JSON","stringify","extraStr","t2","filter","Boolean","displayText","join","issueBody","encodeURIComponent","githubLink","emailLink","t3","t4","t5","t6","t7","ExternalLink","Typography","_Fragment","async","myfetchtext","uri","res","fetch","ok","Error","status","sourceMaps","sourceMappingUrlRe","stackLineRe","getSourceMapFromUri","uriQuery","URL","search","currentScriptContent","mapUri","exec","data","parse","myfetchjson","href","map","SourceMapConsumer","ErrorMessageStackTraceDialog","onClose","mappedStackTrace","setMappedStackTrace","useState","secondaryError","setSecondaryError","clicked","setClicked","errorText","stackTrace","trace","startsWith","slice","stripMessage","stack","getStackTrace","useEffect","mappedStack","line","split","match","push","pos","originalPositionFor","column","source","trim","mapStackTrace","e","console","version","window","JBrowseSession","errorBoxText","Dialog","open","maxWidth","DialogTitle","IconButton","onClick","sx","CloseIcon","DialogContent","undefined","variant","DialogActions","Button","color","default","copy","setTimeout","BlockMsg","severity","action","Tooltip","title","reload","RefreshIcon","getSession","queueDialog","ReportIcon"],"ignoreList":[],"sourceRoot":""}