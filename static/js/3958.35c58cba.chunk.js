"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3958],{3958:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var s=n(7552),r=n(49823),i=n(99546),o=n(91468),l=n(29499),a=n(36715),c=n(5401),u=n(33371),d=n(32808),p=n(1343),h=n(58507),g=n(31409),x=n.n(g),m=n(45465),j=n(36422),f=n(75785),b=n(69500);const w=(0,f.n9)()((e=>({textAreaFont:{fontFamily:"Courier New"},mgap:{display:"flex",flexDirection:"column",gap:e.spacing(4)}})));function y({model:e,handleClose:t}){const{classes:n}=w(),[g,f]=(0,s.useState)(),[y,A]=(0,s.useState)(),[C,v]=(0,s.useState)(""),[k,S]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{(async()=>{try{A(void 0);const t=(0,i.getContainingView)(e);if(!t.initialized)return;const{rpcManager:n}=(0,i.getSession)(e),{sources:s,minorAlleleFrequencyFilter:r,adapterConfig:l}=e,a=(0,o.getRpcSessionId)(e),{bpPerPx:c}=t,u=await n.call(a,"MultiWiggleGetScoreMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:s,minorAlleleFrequencyFilter:r,sessionId:a,adapterConfig:l,bpPerPx:c}),d=Object.values(u),p=Object.keys(u),h=k?"complete":"single",g=`try(library(fastcluster), silent=TRUE)\ninputMatrix<-matrix(c(${d.map((e=>e.scores.join(","))).join(",\n")}\n),nrow=${d.length},byrow=TRUE)\nrownames(inputMatrix)<-c(${p.map((e=>`'${e}'`)).join(",")})\nresultClusters<-hclust(dist(inputMatrix), method='${h}')\ncat(resultClusters$order,sep='\\n')`;f(g)}catch(t){!(0,i.isAbortException)(t)&&(0,j.isAlive)(e)&&(console.error(t),A(t))}})()}),[e,k]),(0,b.jsxs)(r.Dialog,{open:!0,title:"Cluster by score",onClose:t,children:[(0,b.jsx)(l.A,{children:(0,b.jsxs)("div",{className:n.mgap,children:[(0,b.jsx)(a.A,{children:"This page will produce an R script that will perform hierarchical clustering on the visible score data using `hclust`."}),(0,b.jsx)(a.A,{children:"You can then paste the results in this form to specify the row ordering."}),g?(0,b.jsx)("div",{children:(0,b.jsxs)("div",{children:["Step 1:"," ",(0,b.jsx)(c.A,{variant:"contained",onClick:()=>{(0,m.saveAs)(new Blob([g||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,b.jsx)(c.A,{variant:"contained",onClick:()=>{x()(g||"")},children:"Copy Rscript to clipboard"}),(0,b.jsx)(u.A,{control:(0,b.jsx)(d.A,{checked:k,onChange:e=>{S(e.target.checked)}}),label:"Use 'complete' linkage method instead of 'single'"}),(0,b.jsx)("div",{children:(0,b.jsx)(p.A,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Step 2. Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:C,onChange:e=>{v(e.target.value)},slotProps:{input:{classes:{input:n.textAreaFont}}}})})]})}):(0,b.jsx)(r.LoadingEllipses,{variant:"h6",title:"Generating score matrix"}),y?(0,b.jsx)(r.ErrorMessage,{error:y}):null]})}),(0,b.jsxs)(h.A,{children:[(0,b.jsx)(c.A,{disabled:!g,variant:"contained",onClick:()=>{const{sources:n}=e;if(n)try{e.setLayout(C.split("\n").map((e=>e.trim())).filter((e=>!!e)).map((e=>+e)).map((e=>{const t=n[e-1];if(!t)throw new Error(`out of bounds at ${e}`);return t})))}catch(e){console.error(e),A(e)}t()},children:"Apply clustering"}),(0,b.jsx)(c.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})}}}]);
//# sourceMappingURL=3958.35c58cba.chunk.js.map