"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2347,9335],{12453(e,t,s){s.r(t),s.d(t,{default:()=>K});var n=s(85787),l=s(24215),o=s(64074),i=s(28397),a=s(50639),r=s(65045),c=s(30936),d=s(42918),h=s(14227),m=s(87134),u=s(45996),f=s(91073),p=s(27607),g=s(74919),w=s(96919),x=s(1591),v=s(40338),b=s(32118);const j=(0,r.n)()(e=>({facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}}));function k(e){const t=(0,c.c)(5),{onClick:s}=e;let n,l,o;return t[0]!==s?(n=()=>{s()},t[0]=s,t[1]=n):n=t[1],t[2]===Symbol.for("react.memo_cache_sentinel")?(l=(0,b.jsx)(u.A,{}),t[2]=l):l=t[2],t[3]!==n?(o=(0,b.jsx)(p.A,{title:"Clear selection on this facet filter",children:(0,b.jsx)(g.A,{onClick:n,size:"small",children:l})}),t[3]=n,t[4]=o):o=t[4],o}function C(e){const t=(0,c.c)(7),{visible:s,onClick:n}=e;let l,o,i;return t[0]!==n?(l=()=>{n()},t[0]=n,t[1]=l):l=t[1],t[2]!==s?(o=s?(0,b.jsx)(f.A,{}):(0,b.jsx)(m.A,{}),t[2]=s,t[3]=o):o=t[3],t[4]!==l||t[5]!==o?(i=(0,b.jsx)(p.A,{title:"Minimize/expand this facet filter",children:(0,b.jsx)(g.A,{onClick:l,size:"small",children:o})}),t[4]=l,t[5]=o,t[6]=i):i=t[6],i}const A=(0,o.observer)(function({column:e,vals:t,model:s}){const{classes:n}=j(),[l,o]=(0,d.useState)(!0),{faceted:i}=s,{filters:a}=i,{field:r}=e;return(0,b.jsxs)(w.A,{className:n.facet,fullWidth:!0,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(x.A,{component:"span",children:r}),(0,b.jsx)(k,{onClick:()=>{i.setFilter(r,[])}}),(0,b.jsx)(C,{visible:l,onClick:()=>{o(!l)}})]}),l?(0,b.jsx)(v.A,{multiple:!0,native:!0,className:n.select,value:a.get(e.field)||[],onChange:t=>{i.setFilter(e.field,[...t.target.options].filter(e=>e.selected).map(e=>e.value))},children:t.sort((e,t)=>e[0].localeCompare(t[0])).map(([e,t])=>(0,b.jsxs)("option",{value:e,children:[(0,h.Z)(e)," (",t,")"]},e))}):null]})});var S=s(53732);const y=(0,o.observer)(function({rows:e,columns:t,model:s}){const{faceted:n}=s,{filters:l}=n,o=t.slice(1),i=new Map(t.slice(1).map(e=>[e.field,new Map])),a=n.filters.keys(),r=o.map(e=>e.field),c=new Set;for(const e of a)l.get(e)?.length&&c.add(e);for(const e of r)c.add(e);let d=e;for(const e of c){const t=i.get(e);if(t)for(const s of d){const n=(0,S.a)(e,s),l=t.get(n);n&&(void 0===l?t.set(n,1):t.set(n,l+1))}const s=l.get(e)?.length?new Set(l.get(e)):void 0;d=d.filter(t=>void 0===s||s.has((0,S.a)(e,t)))}return(0,b.jsx)("div",{children:o.map(e=>(0,b.jsx)(A,{vals:[...i.get(e.field)],column:e,model:s},e.field))})});var M=s(77251),T=s(99226),W=s(46961),N=s(38567);const H=(0,o.observer)(function({model:e,columns:t,shownTrackIds:s,selection:n}){const{pluginManager:l}=(0,M.getEnv)(e),{view:o,faceted:i}=e,{rows:a,useShoppingCart:r,showOptions:c,filteredRows:h,filteredNonMetadataKeys:m,filteredMetadataKeys:u,visible:f}=i,[,p]=(0,d.useTransition)(),[g,w]=(0,d.useState)(()=>function(e,t,s,n){return{name:(0,M.measureGridWidth)(e.map(e=>e.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(t.filter(e=>n[e]).map(t=>[t,(0,M.measureGridWidth)(e.map(e=>e[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(s.filter(e=>n[`metadata.${e}`]).map(t=>[`metadata.${t}`,(0,M.measureGridWidth)(e.map(e=>e.metadata[t]),{maxWidth:400,stripHTML:!0})]))}}(a,m,u,f)),x=(0,d.useMemo)(()=>({type:"include",ids:new Set(r?n.map(e=>e.trackId):[...s])}),[r,n,s]),v=(0,d.useMemo)(()=>t.map(e=>({...e,width:g[e.field]})),[t,g]);return(0,b.jsx)(W.z,{rowHeight:25,columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,rows:h,columnVisibilityModel:f,showToolbar:c,onColumnWidthChange:e=>{w(t=>({...t,[e.colDef.field]:e.width}))},onColumnVisibilityModelChange:t=>{e.faceted.setVisible(t)},onRowSelectionModelChange:t=>{p(()=>{if(r){const s=(0,T.getRoot)(e),n=l.pluggableConfigSchemaType("track");e.setSelection([...t.ids].map(e=>(0,T.resolveIdentifier)(n,s,e)))}else{const n=s,l=t.ids;(0,N.transaction)(()=>{[...n].filter(e=>!l.has(e)).map(e=>o.hideTrack(e)),[...l].filter(e=>!n.has(e)).map(t=>{o.showTrack(t),e.addToRecentlyUsed(t)})})}})},rowSelectionModel:x,columns:v})});var R=s(14391),F=s(21267),_=s(42913),G=s(68584),I=s(29047);function L(e){const t=(0,c.c)(49),{model:s}=e,{faceted:n}=s,{filterText:l,showOptions:o,showFilters:i,showSparse:a,useShoppingCart:r}=n,[h,m]=(0,d.useState)(null);let u,f,p,w,x;t[0]!==n?(u=e=>{n.setFilterText(e)},t[0]=n,t[1]=u):u=t[1],t[2]!==l||t[3]!==u?(f=(0,b.jsx)(G.A,{label:"Search...",value:l,onChange:u}),t[2]=l,t[3]=u,t[4]=f):f=t[4],t[5]===Symbol.for("react.memo_cache_sentinel")?(p=(0,b.jsx)(g.A,{onClick:e=>{m(e.currentTarget)},children:(0,b.jsx)(F.A,{})}),t[5]=p):p=t[5],t[6]!==s?(w=(0,b.jsx)(I.A,{model:s}),t[6]=s,t[7]=w):w=t[7],t[8]!==f||t[9]!==w?(x=(0,b.jsxs)(_.A,{container:!0,spacing:4,alignItems:"center",children:[f,p,w]}),t[8]=f,t[9]=w,t[10]=x):x=t[10];const v=!!h;let j,k,C,A,S,y,M,T,W,N,H,L,O;return t[11]===Symbol.for("react.memo_cache_sentinel")?(j=()=>{m(null)},k=(e,t)=>{t(),m(null)},t[11]=j,t[12]=k):(j=t[11],k=t[12]),t[13]!==n||t[14]!==r?(C=()=>{n.setUseShoppingCart(!r)},t[13]=n,t[14]=r,t[15]=C):C=t[15],t[16]!==C||t[17]!==r?(A={label:"Add tracks to selection instead of turning them on/off",onClick:C,type:"checkbox",checked:r},t[16]=C,t[17]=r,t[18]=A):A=t[18],t[19]!==n||t[20]!==a?(S=()=>{n.setShowSparse(!a)},t[19]=n,t[20]=a,t[21]=S):S=t[21],t[22]!==a||t[23]!==S?(y={label:"Show sparse metadata columns",onClick:S,checked:a,type:"checkbox"},t[22]=a,t[23]=S,t[24]=y):y=t[24],t[25]!==n||t[26]!==i?(M=()=>{n.setShowFilters(!i)},t[25]=n,t[26]=i,t[27]=M):M=t[27],t[28]!==i||t[29]!==M?(T={label:"Show facet filters",onClick:M,checked:i,type:"checkbox"},t[28]=i,t[29]=M,t[30]=T):T=t[30],t[31]!==n||t[32]!==o?(W=()=>{n.setShowOptions(!o)},t[31]=n,t[32]=o,t[33]=W):W=t[33],t[34]!==o||t[35]!==W?(N={label:"Show extra table options",onClick:W,checked:o,type:"checkbox"},t[34]=o,t[35]=W,t[36]=N):N=t[36],t[37]!==A||t[38]!==y||t[39]!==T||t[40]!==N?(H=[A,y,T,N],t[37]=A,t[38]=y,t[39]=T,t[40]=N,t[41]=H):H=t[41],t[42]!==h||t[43]!==H||t[44]!==v?(L=(0,b.jsx)(R.A,{anchorEl:h,open:v,onClose:j,onMenuItemClick:k,menuItems:H}),t[42]=h,t[43]=H,t[44]=v,t[45]=L):L=t[45],t[46]!==L||t[47]!==x?(O=(0,b.jsxs)(b.Fragment,{children:[x,L]}),t[46]=L,t[47]=x,t[48]=O):O=t[48],O}var O=s(67016);const z=(0,r.n)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),E=.75,$=(0,o.observer)(function({model:e}){const{classes:t}=z(),{selection:s,shownTrackIds:n,faceted:l}=e,{rows:o,panelWidth:r,showFilters:c,filteredNonMetadataKeys:d,filteredMetadataKeys:h}=l,m=[{field:"name",hideable:!1,renderCell:s=>{const{value:n,row:l}=s,{id:o,conf:i}=l;return(0,b.jsxs)("div",{className:t.cell,children:[(0,b.jsx)(a.A,{html:n}),(0,b.jsx)(O.A,{id:o,conf:i,model:e})]})}},...d.map(e=>({field:e,renderCell:e=>{const s=e.value;return s?(0,b.jsx)(a.A,{className:t.cell,html:s}):""}})),...h.map(e=>({field:`metadata.${e}`,headerName:["name",...d].includes(e)?`${e} (from metadata)`:e,valueGetter:(t,s)=>`${s.metadata[e]??""}`,renderCell:e=>{const s=e.value;return s?(0,b.jsx)(a.A,{className:t.cell,html:s}):""}}))];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(L,{model:e}),(0,b.jsxs)("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*E,width:window.innerWidth*E},children:[(0,b.jsx)("div",{style:{height:window.innerHeight*E,width:window.innerWidth*E-(c?r:0)},children:(0,b.jsx)(H,{model:e,columns:m,shownTrackIds:n,selection:s})}),c?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.A,{vertical:!0,onDrag:e=>l.setPanelWidth(r-e),className:t.resizeHandle}),(0,b.jsx)("div",{style:{width:r,overflow:"auto"},children:(0,b.jsx)(y,{model:e,rows:o,columns:m})})]}):null]})]})}),K=(0,o.observer)(function(e){const{handleClose:t}=e;return(0,b.jsx)(n.A,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector",children:(0,b.jsx)(l.A,{children:(0,b.jsx)($,{...e})})})})},19335(e,t,s){s.d(t,{A:()=>m});var n=s(42918),l=s(77710),o=s(62981),i=s(41680),a=s(711),r=s(32717),c=s(57747),d=s(32118);const h=(0,i.Ay)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,!s.disableGutters&&t.gutters,t[s.variant]]}})((0,a.A)(({theme:e})=>({position:"relative",display:"flex",alignItems:"center",variants:[{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}}},{props:{variant:"dense"},style:{minHeight:48}},{props:{variant:"regular"},style:e.mixins.toolbar}]}))),m=n.forwardRef(function(e,t){const s=(0,r.b)({props:e,name:"MuiToolbar"}),{className:n,component:i="div",disableGutters:a=!1,variant:m="regular",...u}=s,f={...s,component:i,disableGutters:a,variant:m},p=(e=>{const{classes:t,disableGutters:s,variant:n}=e,l={root:["root",!s&&"gutters",n]};return(0,o.A)(l,c.U,t)})(f);return(0,d.jsx)(h,{as:i,className:(0,l.A)(p.root,n),ref:t,ownerState:f,...u})})},57747(e,t,s){s.d(t,{A:()=>i,U:()=>o});var n=s(99287),l=s(47739);function o(e){return(0,l.Ay)("MuiToolbar",e)}const i=(0,n.A)("MuiToolbar",["root","gutters","regular","dense"])}}]);
//# sourceMappingURL=2347.c2f316a4.chunk.js.map