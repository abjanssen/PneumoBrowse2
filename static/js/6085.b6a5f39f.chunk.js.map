{"version":3,"file":"static/js/6085.b6a5f39f.chunk.js","mappings":"wMAUe,MAAMA,UAA8BC,EAAAA,EACjD,eAAaC,GACX,MAAMC,QAAgBC,KAAKC,gBAAgBD,KAAKE,QAAQ,qBACxD,IAAKH,EACH,MAAM,IAAII,MAAM,4BAElB,OAAOJ,EAAQK,WACjB,CAEA,iBAAaC,GAEX,aADsBL,KAAKF,aACZO,aACjB,CAEOC,WAAAA,CAAYC,EAAeC,GAChC,OAAOC,EAAAA,EAAAA,kBAA0BC,UAC/B,MAAMC,QAAwBX,KAAKF,YAE7Bc,EAAWL,EAAMM,IADZ,IAELC,EAAaC,KAAKC,IAAI,EAAGT,EAAMU,MAF1B,KAIX,GAAIL,EAAW,GAAKE,EAAaF,EAE/B,YADAM,EAASC,WAIX,MAAMC,QACGT,EAAgBU,YACrB,IACKd,EACHU,MAAOH,EACPD,IAAKD,GAEPJ,IACI,GACFc,EAAStB,KAAKE,QAAQ,UACtBqB,EAAgBvB,KAAKE,QAAQ,iBAC7BsB,EAAgBxB,KAAKE,QAAQ,iBAC7BuB,EAAkBzB,KAAKE,QAAQ,mBAC/BwB,EAAK,IAAIC,OAAOL,EAAQ,KAAIG,EAAkB,IAAM,KAE1D,GAAIH,EAAQ,CACV,GAAIC,EAAe,CACjB,MAAMK,EAAUR,EAASS,SAASH,GAClC,IAAK,MAAMI,KAASF,EAAS,CAC3B,MAAMG,EAAIjB,EAAagB,EAAME,MACvBC,EAAInB,EAAagB,EAAME,MAAQF,EAAM,GAAGI,QAC1CC,EAAAA,EAAAA,IAAeJ,EAAGE,EAAG1B,EAAMU,MAAOV,EAAMM,MAC1CK,EAASkB,KACP,IAAIC,EAAAA,EAAc,CAChBC,SAAU,GAAGtC,KAAKuC,MAAMR,KAAKD,EAAM,SACnCU,QAASjC,EAAMiC,QACfvB,MAAOc,EACPlB,IAAKoB,EACLQ,KAAMX,EAAM,GACZY,OAAQ,IAIhB,CACF,CACA,GAAIlB,EAAe,CACjB,MAAMI,GAAUe,EAAAA,EAAAA,QAAOvB,GAAUS,SAASH,GAC1C,IAAK,MAAMI,KAASF,EAAS,CAC3B,MAAMK,EAAIrB,EAAWkB,EAAME,MACrBD,EAAInB,EAAWkB,EAAME,MAAQF,EAAM,GAAGI,QACxCC,EAAAA,EAAAA,IAAeJ,EAAGE,EAAG1B,EAAMU,MAAOV,EAAMM,MAC1CK,EAASkB,KACP,IAAIC,EAAAA,EAAc,CAChBC,SAAU,GAAGtC,KAAKuC,MAAMR,KAAKD,EAAM,SACnCU,QAASjC,EAAMiC,QACfvB,MAAOc,EACPlB,IAAKoB,EACLQ,KAAMX,EAAM,GACZY,QAAS,IAIjB,CACF,CACF,CAEAxB,EAASC,YAEb,E","sources":["webpack://@jbrowse/web/../../plugins/sequence/src/SequenceSearchAdapter/SequenceSearchAdapter.ts"],"sourcesContent":["import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { SimpleFeature, doesIntersect2, revcom } from '@jbrowse/core/util'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\n\nimport type {\n  BaseOptions,\n  BaseSequenceAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { Feature, Region } from '@jbrowse/core/util'\n\nexport default class SequenceSearchAdapter extends BaseFeatureDataAdapter {\n  public async configure() {\n    const adapter = await this.getSubAdapter?.(this.getConf('sequenceAdapter'))\n    if (!adapter) {\n      throw new Error('Error getting subadapter')\n    }\n    return adapter.dataAdapter as BaseSequenceAdapter\n  }\n\n  public async getRefNames() {\n    const adapter = await this.configure()\n    return adapter.getRefNames()\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions) {\n    return ObservableCreate<Feature>(async observer => {\n      const sequenceAdapter = await this.configure()\n      const hw = 10000\n      const queryEnd = query.end + hw\n      const queryStart = Math.max(0, query.start - hw)\n\n      if (queryEnd < 0 || queryStart > queryEnd) {\n        observer.complete()\n        return\n      }\n\n      const residues =\n        (await sequenceAdapter.getSequence(\n          {\n            ...query,\n            start: queryStart,\n            end: queryEnd,\n          },\n          opts,\n        )) ?? ''\n      const search = this.getConf('search') as string\n      const searchForward = this.getConf('searchForward')\n      const searchReverse = this.getConf('searchReverse')\n      const caseInsensitive = this.getConf('caseInsensitive')\n      const re = new RegExp(search, `g${caseInsensitive ? 'i' : ''}`)\n\n      if (search) {\n        if (searchForward) {\n          const matches = residues.matchAll(re)\n          for (const match of matches) {\n            const s = queryStart + match.index\n            const e = queryStart + match.index + match[0].length\n            if (doesIntersect2(s, e, query.start, query.end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `${this.id}-${s}-${match[0]}-pos`,\n                  refName: query.refName,\n                  start: s,\n                  end: e,\n                  name: match[0],\n                  strand: 1,\n                }),\n              )\n            }\n          }\n        }\n        if (searchReverse) {\n          const matches = revcom(residues).matchAll(re)\n          for (const match of matches) {\n            const e = queryEnd - match.index\n            const s = queryEnd - match.index - match[0].length\n            if (doesIntersect2(s, e, query.start, query.end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `${this.id}-${s}-${match[0]}-neg`,\n                  refName: query.refName,\n                  start: s,\n                  end: e,\n                  name: match[0],\n                  strand: -1,\n                }),\n              )\n            }\n          }\n        }\n      }\n\n      observer.complete()\n    })\n  }\n}\n"],"names":["SequenceSearchAdapter","BaseFeatureDataAdapter","configure","adapter","this","getSubAdapter","getConf","Error","dataAdapter","getRefNames","getFeatures","query","opts","ObservableCreate","async","sequenceAdapter","queryEnd","end","queryStart","Math","max","start","observer","complete","residues","getSequence","search","searchForward","searchReverse","caseInsensitive","re","RegExp","matches","matchAll","match","s","index","e","length","doesIntersect2","next","SimpleFeature","uniqueId","id","refName","name","strand","revcom"],"sourceRoot":""}