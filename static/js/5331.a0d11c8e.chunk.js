"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5331],{25331:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue});var l=n(7552),o=n(68446),a=n(28685),r=n(99546),c=n(374),i=n(62859),s=n(2051),d=n(29629),m=n(75785);const u=(0,m.n9)()((e=>({fab:{position:"absolute",bottom:e.spacing(6),right:e.spacing(6)}}))),g=(0,o.observer)((function({model:e}){const{classes:t}=u(),n=(0,r.getSession)(e),[o,a]=(0,l.useState)(null);function m(){a(null)}const g=(0,r.isSessionModelWithConnections)(n),k=(0,r.isSessionWithAddTracks)(n);return k||g?l.createElement(l.Fragment,null,l.createElement(i.A,{color:"secondary",className:t.fab,onClick:e=>{a(e.currentTarget)}},l.createElement(c.A,null)),l.createElement(s.A,{anchorEl:o,open:Boolean(o),onClose:()=>{a(null)}},g?l.createElement(d.A,{onClick:()=>{m(),(0,r.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("AddConnectionWidget","addConnectionWidget"))}},"Add connection"):null,k?l.createElement(d.A,{onClick:()=>{m(),(0,r.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))}},"Add track"):null)):null}));var k=n(31892),h=n(1343),b=n(93117),C=n(61723),f=n(68584),p=n(23758),v=n(922);const E=(0,l.lazy)((()=>Promise.all([n.e(8565),n.e(8237),n.e(6157),n.e(399)]).then(n.bind(n,48927)))),y=(0,l.lazy)((()=>n.e(7181).then(n.bind(n,97181)))),A=(0,l.lazy)((()=>n.e(5896).then(n.bind(n,35896)))),S=(0,l.lazy)((()=>n.e(741).then(n.bind(n,60741)))),T=(0,l.lazy)((()=>n.e(4138).then(n.bind(n,44138)))),w=(0,o.observer)((function({model:e}){const t=(0,r.getSession)(e),[n,o]=(0,l.useState)(),[a,c]=(0,l.useState)(),[i,s]=(0,l.useState)(!1),[d,m]=(0,l.useState)(!1),[u,g]=(0,l.useState)(!1);function k(e,n){const l=(0,f.readConfObject)(e,"name"),a=t.prepareToBreakConnection?.(e);if(a){const[t,n]=a;Object.keys(n).length>0?o({connectionConf:e,safelyBreakConnection:t,dereferenceTypeCount:n,name:l}):t()}n&&c({name:l,connectionConf:e})}return l.createElement(l.Fragment,null,l.createElement(p.A,{menuItems:[{label:"Open faceted track selector",onClick:()=>{g(!0)}},...(0,r.isSessionWithAddTracks)(t)?[{label:"Add track...",onClick:()=>{(0,r.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))}}]:[],{label:"Connections...",subMenu:[...(0,r.isSessionModelWithConnections)(t)?[{label:"Turn on/off connections...",onClick:()=>{s(!0)}}]:[],...(0,r.isSessionModelWithConnectionEditing)(t)?[{label:"Add connection...",onClick:()=>{(0,r.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>{m(!0)}}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:e.activeSortTrackNames,onClick:()=>{e.setSortTrackNames(!e.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:e.activeSortCategories,onClick:()=>{e.setSortCategories(!e.activeSortCategories)}}]},{label:"Collapse...",type:"subMenu",subMenu:[...e.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>{e.collapseSubCategories()}}]:[],{label:"Collapse top-level categories",onClick:()=>{e.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:()=>{e.expandAllCategories()}}]}]},l.createElement(v.A,null)),l.createElement(l.Suspense,{fallback:null},n?l.createElement(y,{modalInfo:n,onClose:()=>{o(void 0)}}):null,a?l.createElement(A,{handleClose:()=>{c(void 0)},deleteDialogDetails:a,session:t}):null,d?l.createElement(S,{handleClose:()=>{m(!1)},breakConnection:k,session:t}):null,i?l.createElement(T,{handleClose:()=>{s(!1)},session:t,breakConnection:k}):null,u?l.createElement(E,{handleClose:()=>{g(!1)},model:e}):null))}));var W=n(9469),I=n(1114),x=n(89003),M=n(84885),N=n(13476),F=n(91468),O=n(26027);const L=(0,o.observer)((function({model:e,tracks:t,extraMenuItems:n,children:o,onClick:a}){const{view:c}=e,[i,s]=(0,l.useState)(!1),d=(0,r.getSession)(e);return c?l.createElement(p.A,{closeAfterItemClick:!1,onClick:a,menuItems:[...t.map((t=>({type:"checkbox",label:l.createElement(l.Fragment,null,l.createElement(N.A,{html:(0,F.getTrackName)(t,d)})," ",l.createElement(O.A,{id:t.trackId,trackId:t.trackId,model:e,conf:t,setOpen:s,stopPropagation:!0})),checked:c.tracks.some((e=>e.configuration===t)),onClick:()=>{i||e.view.toggleTrack(t.trackId)&&e.addToRecentlyUsed(t.trackId)}}))),...n]},o):null})),B=(0,m.n9)()({smallBadge:{height:14},margin:{marginRight:10}}),P=(0,o.observer)((function({model:e}){const{classes:t}=B(),{view:n,favoriteTracks:o}=e;return n?l.createElement(L,{onClick:()=>{e.setFavoritesCounter(0)},tracks:o,model:e,extraMenuItems:o.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>{e.clearFavorites()}}]:[{label:"No favorite tracks yet",onClick:()=>{}}]},l.createElement(x.A,{title:"Favorite tracks"},l.createElement(M.A,{classes:{badge:t.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:t.margin,badgeContent:e.favoritesCounter},l.createElement(I.A,null)))):null}));var R=n(69833);const H=(0,m.n9)()({smallBadge:{height:14}}),D=(0,o.observer)((function({model:e}){const{classes:t}=H(),{view:n,recentlyUsedCounter:o,recentlyUsedTracks:a}=e;return n?l.createElement(L,{onClick:()=>{e.setRecentlyUsedCounter(0)},model:e,tracks:a,extraMenuItems:a.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>{e.clearRecentlyUsed()}}]:[{label:"No recently used",onClick:()=>{}}]},l.createElement(x.A,{title:"Recently used tracks"},l.createElement(M.A,{classes:{badge:t.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:o},l.createElement(R.A,null)))):null})),U=(0,m.n9)()((e=>({searchBox:{margin:e.spacing(2)}}))),j=(0,o.observer)((function({model:e}){const{filterText:t}=e,{classes:n}=U();return l.createElement(h.A,{className:n.searchBox,label:"Filter tracks",value:t,onChange:t=>{e.setFilterText(t.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:l.createElement(b.A,{position:"end"},l.createElement(C.A,{onClick:()=>{e.clearFilterText()}},l.createElement(k.A,null)))}}})})),z=(0,o.observer)((function({model:e,setHeaderHeight:t}){return l.createElement("div",{ref:e=>{t(e?.getBoundingClientRect().height||0)},"data-testid":"hierarchical_track_selector"},l.createElement("div",{style:{display:"flex"}},l.createElement(w,{model:e}),l.createElement(W.A,{model:e}),l.createElement(j,{model:e}),l.createElement(D,{model:e}),l.createElement(P,{model:e})))}));var _=n(32296),$=n(8463),V=n(32813),Y=n(12756),q=n(30476),G=n(36715);function J(e){return"category"===e?.type?e.children.map((e=>"category"===e.type?J(e):e.conf)).flat(Number.POSITIVE_INFINITY):[]}function K(e,t=new Map){e.id&&e.children.length&&t.set(e.id,e);for(const n of e.children)K(n,t);return t}function Q(e=""){return e.endsWith("(Unsupported)")||e.endsWith("(Unknown)")}const X=(0,m.n9)()((e=>({contrastColor:{color:e.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}})));function Z({isOpen:e,setOpen:t,data:n}){const{classes:o}=X(),[a,r]=(0,l.useState)(null),{menuItems:c=[],name:i,model:s,id:d,tree:m}=n;return l.createElement("div",{className:o.accordionText,onClick:()=>{a||(n.toggleCollapse(d),t(!e))}},l.createElement(G.A,{"data-testid":`htsCategory-${i}`},e?l.createElement(V.A,null):l.createElement(Y.A,null),i,l.createElement(C.A,{onClick:e=>{r(e.currentTarget),e.stopPropagation()},className:o.contrastColor},l.createElement(q.A,null))),a?l.createElement($.A,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:()=>{const e=K(m).get(d);s.addToSelection(J(e))}},{label:"Remove from selection",onClick:()=>{const e=K(m).get(d);s.removeFromSelection(J(e))}},{label:"Show all tracks",onClick:()=>{for(const e of K(m).get(d)?.children||[])"track"===e.type&&s.view.showTrack(e.trackId)}},{label:"Hide all tracks",onClick:()=>{for(const e of K(m).get(d)?.children||[])"track"===e.type&&s.view.hideTrack(e.trackId)}},...c],onMenuItemClick:(e,t)=>{t(),r(null)},open:Boolean(a),onClose:()=>{r(null)}}):null)}var ee=n(33371),te=n(32808);const ne=(0,m.n9)()((e=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:e.palette.action.selected}},selected:{background:"#cccc"}})));function le({data:e}){const{classes:t}=ne(),{checked:n,conf:o,model:a,drawerPosition:r,id:c,trackId:i,name:s,onChange:d,selected:m}=e,u=(0,f.readConfObject)(o,"description");return l.createElement(l.Fragment,null,l.createElement(x.A,{title:u+(m?" (in selection)":""),placement:"left"===r?"right":"left"},l.createElement(ee.A,{className:t.checkboxLabel,control:l.createElement(te.A,{className:t.compactCheckbox,checked:n,onChange:()=>{d(i)},disabled:Q(s),inputProps:{"data-testid":`htsTrackEntry-${c}`}}),label:l.createElement("div",{"data-testid":`htsTrackLabel-${c}`,style:{background:m?"#cccc":void 0}},l.createElement(N.A,{html:s}))})),l.createElement(O.A,{model:a,trackId:i,id:c,conf:o}))}const oe=(0,m.n9)()((e=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:e.palette.tertiary.main,color:e.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}})));function ae({data:e,isOpen:t,style:n,setOpen:o}){const{isLeaf:a,nestingLevel:r}=e,{classes:c}=oe(),i=10*r+(a?10:0);return l.createElement("div",{style:n,className:a?void 0:c.accordionBase},new Array(r).fill(0).map(((e,t)=>l.createElement("div",{key:`mark-${t}`,style:{left:10*t+4,height:n?.height},className:c.nestingLevelMarker}))),l.createElement("div",{className:a?void 0:c.accordionCard,style:{marginLeft:i,whiteSpace:"nowrap",width:"100%"}},l.createElement("div",{className:a?void 0:c.accordionColor},a?l.createElement(le,{data:e}):l.createElement(Z,{isOpen:t,data:e,setOpen:o}))))}function re(e,t,n,l){const o="track"===e.type;return{data:{defaultHeight:o?22:40,isLeaf:o,isOpenByDefault:!0,nestingLevel:t,selected:!!o&&l[e.trackId],...e,...n},nestingLevel:t,node:e}}const ce=(0,o.observer)((function({height:e,tree:t,model:n}){const{filterText:o,selection:a,view:c}=n,i=(0,l.useRef)(null),s=(0,r.getSession)(n),{drawerPosition:d}=s,m=(0,l.useMemo)((()=>Object.fromEntries(a.map((e=>[e.trackId,e])))),[a]),u=(0,l.useMemo)((()=>({onChange:e=>{c.toggleTrack(e)&&n.addToRecentlyUsed(e)},toggleCollapse:e=>{n.toggleCategory(e)},tree:t,model:n,drawerPosition:d})),[c,n,d,t]),g=(0,l.useCallback)((function*(){for(const e of t.children)yield re(e,0,u,m);for(;;){const e=yield;for(const t of e.node.children)yield re(t,e.nestingLevel+1,u,m)}}),[t,u,m]);return(0,l.useEffect)((()=>{i.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})}),[t,o]),l.createElement(l.Fragment,null,l.createElement(_.SS,{ref:i,treeWalker:g,height:e},ae))})),ie=({tree:e,model:t,offset:n})=>"undefined"==typeof jest?l.createElement(a.Ay,{disableWidth:!0},(o=>l.createElement(ce,{height:(o.height||n)-n,model:t,tree:e}))):l.createElement(ce,{height:9e3,model:t,tree:e}),se=({overrideDimensions:e,children:t})=>e?l.createElement("div",{style:{...e}},t):t,de=(0,o.observer)((function({model:e,toolbarHeight:t,overrideDimensions:n}){return l.createElement(se,{overrideDimensions:n},l.createElement(me,{model:e,toolbarHeight:t}),l.createElement(g,{model:e}))})),me=(0,o.observer)((function({model:e,toolbarHeight:t=0}){const[n,o]=(0,l.useState)(0);return l.createElement(l.Fragment,null,l.createElement(z,{model:e,setHeaderHeight:o}),l.createElement(ie,{tree:e.hierarchy,model:e,offset:t+n}))})),ue=de},9469:(e,t,n)=>{n.d(t,{A:()=>i});var l=n(7552),o=n(23758),a=n(99546),r=n(7215),c=n(84885);const i=(0,n(68446).observer)((function({model:e}){const{selection:t}=e,{pluginManager:n}=(0,a.getEnv)(e),i=(0,a.getSession)(e),s=n.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:i});return t.length?l.createElement(o.A,{menuItems:[{label:"Clear",onClick:()=>{e.clearSelection()}},...s.map((t=>({...t,..."onClick"in t?{onClick:()=>{t.onClick(e)}}:{}})))]},l.createElement(c.A,{badgeContent:t.length,color:"primary"},l.createElement(r.A,null))):null}))},26027:(e,t,n)=>{n.d(t,{A:()=>d});var l=n(7552),o=n(23758),a=n(99546),r=n(30476),c=n(1185),i=n(84181);const s=(0,n(75785).n9)()({cascadingStyle:{padding:0}}),d=function({id:e,trackId:t,stopPropagation:n,model:d,setOpen:m,conf:u}){const{classes:g}=s();return l.createElement(o.A,{className:g.cascadingStyle,stopPropagation:n,setOpen:m,"data-testid":`htsTrackEntryMenu-${e}`,menuItems:[...(0,a.getSession)(d).getTrackActionMenuItems?.(u)||[],d.isFavorite(t)?{label:"Remove from favorites",onClick:()=>{d.removeFromFavorites(t)},icon:i.A}:{label:"Add to favorites",onClick:()=>{d.addToFavorites(t)},icon:c.A},{label:"Add to selection",onClick:()=>{d.addToSelection([u])}},...d.isSelected(u)?[{label:"Remove from selection",onClick:()=>{d.removeFromSelection([u])}}]:[]]},l.createElement(r.A,null))}}}]);
//# sourceMappingURL=5331.a0d11c8e.chunk.js.map