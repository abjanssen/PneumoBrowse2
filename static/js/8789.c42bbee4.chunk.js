"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8789],{98789(e,t,a){a.d(t,{default:()=>g});var s=a(38113),r=a(90946),n=a(57379),i=a(43921),o=a(23886),u=a(11931),c=a(25529);class g extends r.L{static capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];async setupPre(e){const{statusCallback:t=()=>{}}=e||{},a=this.pluginManager,r=new s.Ct({filehandle:(0,u.openLocation)(this.getConf("bigWigLocation"),a)});return{bigwig:r,header:await(0,o.updateStatus)("Downloading bigwig header",t,()=>r.getHeader(e))}}async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async getRefNames(e){const{header:t}=await this.setup(e);return Object.keys(t.refsByName)}async refIdToName(e){const{header:t}=await this.setup();return t.refsByNumber[e]?.name}async getGlobalStats(e){const{header:t}=await this.setup(e);return(0,i.WD)(t.totalSummary)}getFeatures(e,t={}){const{refName:a,start:r,end:n}=e,{bpPerPx:i=0,resolution:u=1,stopToken:g,statusCallback:l=()=>{}}=t,h=this.getConf("source"),b=this.getConf("resolutionMultiplier");return(0,c.ObservableCreate)(async e=>{const{bigwig:c}=await this.setup(t),g=await(0,o.updateStatus)("Downloading bigwig data",l,()=>c.getFeaturesAsArrays(a,r,n,{...t,basesPerSpan:i/u*b})),m=new s.Hp(g,h,a);for(let t=0;t<m.length;t++){const s=m.id(t),r=t;e.next({get:e=>m.get(r,e),id:()=>s,toJSON:()=>({start:m.start(r),end:m.end(r),score:m.score(r),refName:a,source:h,uniqueId:s,summary:m.isSummary,minScore:m.minScore(r),maxScore:m.maxScore(r)})})}e.complete()},g)}async getArrayFeatureView(e,t={}){const{refName:a,start:r,end:n}=e,{bpPerPx:i=0,resolution:u=1,statusCallback:c=()=>{}}=t,g=this.getConf("resolutionMultiplier"),l=this.getConf("source"),{bigwig:h}=await this.setup(t),b=await(0,o.updateStatus)("Downloading bigwig data",c,()=>h.getFeaturesAsArrays(a,r,n,{...t,basesPerSpan:i/u*g}));return new s.Hp(b,l,a)}async getRegionQuantitativeStats(e,t){const{start:a,end:s}=e;return function(e,t,a){const s=e.length;if(0===s)return{scoreMin:0,scoreMax:0,scoreSum:0,scoreSumSquares:0,scoreMean:0,scoreStdDev:0,featureCount:0,basesCovered:a-t,featureDensity:0};let r=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE,u=0,c=0,g=0;for(let l=0;l<s;l++){const s=e.start(l);if(e.end(l)<=t||s>=a)continue;const h=e.score(l),b=e.minScore(l)??h,m=e.maxScore(l)??h;r=Math.min(r,b),n=Math.max(n,m),i=Math.min(i,h),o=Math.max(o,h),u+=h,c+=h*h,g++}if(0===g)return{scoreMin:0,scoreMax:0,scoreSum:0,scoreSumSquares:0,scoreMean:0,scoreStdDev:0,featureCount:0,basesCovered:a-t,featureDensity:0};const l=u/g;return{scoreMin:r,scoreMax:n,scoreMeanMin:i,scoreMeanMax:o,scoreSum:u,scoreSumSquares:c,scoreMean:l,scoreStdDev:Math.sqrt(c/g-l*l),featureCount:g,basesCovered:a-t,featureDensity:g/(a-t)}}(await this.getArrayFeatureView(e,{...t,bpPerPx:(s-a)/1e3}),a,s)}async getMultiRegionFeatureDensityStats(e){return{featureDensity:0}}async getMultiRegionQuantitativeStats(e=[],t={}){if(!e.length)return(0,i.Yv)();const a=await Promise.all(e.map(e=>this.getRegionQuantitativeStats(e,t)));return(0,n.iz)(a)}}}}]);
//# sourceMappingURL=8789.c42bbee4.chunk.js.map