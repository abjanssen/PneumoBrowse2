"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4060],{10420:(t,e,r)=>{r.d(e,{Z:()=>a});var o=r(99546),n=r(94026);function a(t,e,r){const a=-1===r?(0,o.revcom)(e):e,i=t.split(";"),s=[];for(const t of i){if(""===t)continue;const e=t.split(","),o=e[0],i=n.k.exec(o);if(!i)throw new Error(`bad format for MM tag: "${t}"`);const[,c,l,f]=i,p=f.split(/(\d+|.)/);"-"===l&&(console.warn("unsupported negative strand modifications"),s.push({type:"unsupported",positions:[],base:c,strand:l}));for(const t of p){if(""===t)continue;let o=0;const n=[];for(let t=1,i=e.length;t<i;t++){let i=+e[t];do{"N"!==c&&c!==a[o]||i--,o++}while(i>=0&&o<a.length);if(-1===r){const t=a.length-o;t>=0&&n.unshift(t)}else n.push(o-1)}s.push({type:t,base:c,strand:l,positions:n})}}return s}},24060:(t,e,r)=>{r.d(e,{makeImageData:()=>m});var o=r(68584),n=r(67112),a=r(99546),i=r(36917),s=r(86576);function c({colorType:t,tag:e,feature:r,config:n,defaultColor:a,colorTagMap:c}){switch(t){case"insertSize":return function(t){return t.get("is_paired")&&t.get("refName")!==t.get("next_ref")?"#555":`hsl(${Math.abs(t.get("template_length"))/10},50%,50%)`}(r);case"strand":return function(t){return-1===t.get("strand")?"#8F8FD8":"#EC8B8B"}(r);case"mappingQuality":return function(t){return`hsl(${t.get("score")},50%,50%)`}(r);case"pairOrientation":return function(t,e){return i.pf[function(t,e){const r=(0,o.readConfObject)(e,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[s.il[r][t.get("pair_orientation")]]}(t,e)||"color_nostrand"]}(r,n);case"stranded":return function(t){return i.pf[function(t){const e=t.get("flags"),r=t.get("strand");if(1&e){const o=64&e?-1:1;return 2&e?r*o===1?"color_rev_strand":"color_fwd_strand":8&e?r*o===1?"color_rev_missing_mate":"color_fwd_missing_mate":t.get("refName")===t.get("next_ref")?r*o===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(t)]}(r);case"xs":case"tag":{const t=r.get("tags"),o=t?t[e]:r.get(e);return"XS"===e||"TS"===e?"-"===o?i.pf.color_rev_strand:"+"===o?i.pf.color_fwd_strand:i.pf.color_nostrand:"ts"===e?"-"===o?-1===r.get("strand")?i.pf.color_fwd_strand:i.pf.color_rev_strand:"+"===o?-1===r.get("strand")?i.pf.color_rev_strand:i.pf.color_fwd_strand:i.pf.color_nostrand:c[o]||i.pf.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return a?"lightgrey":(0,o.readConfObject)(n,"color",{feature:r})}}var l=r(95805);function f(t,e,r,o,n,a,i){e+o<0||e>a||(i&&(t.fillStyle=i),t.fillRect(e,r,o,n))}function p(t){const{skip:e,deletion:r,insertion:o,hardclip:n,softclip:a,bases:i}=t.palette;return{A:i.A.main,C:i.C.main,G:i.G.main,T:i.T.main,deletion:r,insertion:o,hardclip:n,softclip:a,skip:e}}function h(){return{charWidth:(0,a.measureText)("A"),charHeight:(0,a.measureText)("M")-2}}var d=r(59509),g=r(91476),u=r(87485),_=r(69276);function m({ctx:t,layoutRecords:e,canvasWidth:r,renderArgs:i}){const{stopToken:s,config:m,showSoftClip:b,colorBy:x,theme:P}=i,M=(0,o.readConfObject)(m,"mismatchAlpha"),C=(0,o.readConfObject)(m,"minSubfeatureWidth"),y=(0,o.readConfObject)(m,"largeInsertionIndicatorScale"),v=(0,o.readConfObject)(m,"hideSmallIndels"),S="#f0f"===(0,o.readConfObject)(m,"color"),w=(0,n.createJBrowseTheme)(P),T=p(w),A=function(t){return Object.fromEntries(Object.entries(p(t)).map(([e,r])=>[e,t.palette.getContrastText(r)]))}(w);t.font="bold 10px Courier New,monospace";const{charWidth:W,charHeight:k}=h(),I=(O=x?.type,["methylation","modifications"].includes(O||""));var O;(0,a.forEachWithStopTokenCheck)(e,s,e=>{(function({ctx:t,feat:e,renderArgs:r,colorMap:o,colorContrastMap:n,charWidth:i,charHeight:s,defaultColor:p,canvasWidth:h}){const{config:m,bpPerPx:b,regions:x,colorBy:P,colorTagMap:M={}}=r,{tag:C="",type:y=""}=P||{},{feature:v}=e,S=x[0];switch(t.fillStyle=c({feature:v,config:m,tag:C,defaultColor:p,colorType:y,colorTagMap:M}),function({ctx:t,feat:e,renderArgs:r}){const{regions:o,bpPerPx:n}=r,{heightPx:i,topPx:s,feature:c}=e,f=o[0],p=c.get("start"),h=c.get("end"),d=c.get("CIGAR"),g=f.reversed?-1:1,u=c.get("strand")*g,_=n<10&&i>5;if(d?.includes("N")){const e=(0,l.parseCigar)(d);if(1===u){let r=0,o=p;for(let c=0;c<e.length;c+=2){const l=+e[c],p=e[c+1];if("M"===p||"X"===p||"="===p||"D"===p)r+=l;else if("N"===p){if(o!==r){const[e,c]=(0,a.bpSpanPx)(o,o+r,f,n),l=c-e;t.fillRect(e,s,l,i)}o+=r+l,r=0}}if(o!==r){const[e,c]=(0,a.bpSpanPx)(o,o+r,f,n),l=c-e;_?(t.beginPath(),t.moveTo(e,s),t.lineTo(e,s+i),t.lineTo(c,s+i),t.lineTo(c+5,s+i/2),t.lineTo(c,s),t.closePath(),t.fill()):t.fillRect(e,s,l,i)}}else if(-1===u){let r=0,o=h;for(let c=e.length-2;c>=0;c-=2){const l=+e[c],p=e[c+1];if("M"===p||"X"===p||"="===p||"D"===p)r+=l;else if("N"===p){if(0!==r){const[e,c]=(0,a.bpSpanPx)(o-r,o,f,n);t.fillRect(e,s,c-e,i)}o-=r+l,r=0}}if(0!==r){const[e,c]=(0,a.bpSpanPx)(o-r,o,f,n),l=c-e;_?(t.beginPath(),t.moveTo(e-5,s+i/2),t.lineTo(e,s+i),t.lineTo(c,s+i),t.lineTo(c,s),t.lineTo(e,s),t.closePath(),t.fill()):t.fillRect(e,s,l,i)}}}else{const[e,r]=(0,a.bpSpanPx)(p,h,f,n);n<10&&i>5?-1===u?(t.beginPath(),t.moveTo(e-5,s+i/2),t.lineTo(e,s+i),t.lineTo(r,s+i),t.lineTo(r,s),t.lineTo(e,s),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(e,s),t.lineTo(e,s+i),t.lineTo(r,s+i),t.lineTo(r+5,s+i/2),t.lineTo(r,s),t.closePath(),t.fill()):t.fillRect(e,s,r-e,i)}}({ctx:t,feat:e,renderArgs:r}),y){case"perBaseQuality":!function({ctx:t,feat:e,region:r,bpPerPx:o,canvasWidth:n,cigarOps:i}){const{feature:s,topPx:c,heightPx:l}=e,p=(s.get("qual")||"").split(" ").map(t=>+t),h=1/o,d=s.get("start");let g=0,u=0;for(let e=0;e<i.length;e+=2){const s=+i[e],_=i[e+1];if("S"===_||"I"===_)g+=s;else if("D"===_||"N"===_)u+=s;else if("M"===_||"X"===_||"="===_){for(let e=0;e<s;e++){const i=p[g+e],s=d+u+e;f(t,(0,a.bpSpanPx)(s,s+1,r,o)[0],c,h+.5,l,n,`hsl(${255===i?150:1.5*i},55%,50%)`)}g+=s,u+=s}}}({ctx:t,feat:e,region:S,bpPerPx:b,canvasWidth:h,cigarOps:(0,l.parseCigar)(v.get("CIGAR"))});break;case"perBaseLettering":!function({ctx:t,feat:e,region:r,bpPerPx:o,colorMap:n,colorContrastMap:i,charWidth:s,charHeight:c,canvasWidth:l,cigarOps:p}){const h=c-2,{feature:d,topPx:g,heightPx:u}=e,_=d.get("seq"),m=1/o,b=d.get("start");let x=0,P=0;if(_)for(let e=0;e<p.length;e+=2){const c=+p[e],d=p[e+1];if("S"===d||"I"===d)x+=c;else if("D"===d||"N"===d)P+=c;else if("M"===d||"X"===d||"="===d){for(let e=0;e<c;e++){const c=_[x+e],p=b+P+e,[d]=(0,a.bpSpanPx)(p,p+1,r,o);f(t,d,g,m+.5,u,l,n[c]),m>=s&&u>=h&&(t.fillStyle=i[c],t.fillText(c,d+(m-s)/2+1,g+u))}x+=c,P+=c}}}({ctx:t,feat:e,region:S,bpPerPx:b,colorMap:o,colorContrastMap:n,charWidth:i,charHeight:s,canvasWidth:h,cigarOps:(0,l.parseCigar)(v.get("CIGAR"))});break;case"modifications":!function({ctx:t,feat:e,region:r,bpPerPx:o,renderArgs:n,canvasWidth:i,cigarOps:s}){const{feature:c,topPx:l,heightPx:p}=e,{colorBy:h,visibleModifications:u={}}=n;if(!c.get("seq"))return;const _=c.get("start"),m=h?.modifications?.isolatedModification,b=h?.modifications?.twoColor;(0,d.r)(c,s)?.forEach(({allProbs:e,prob:n,type:s},c)=>{const h=_+c,[d,x]=(0,a.bpSpanPx)(h,h+1,r,o),P=u[s];if(!P)return void console.warn(`${s} not known yet`);if(m&&P.type!==m)return;const M=P.color||"black",C=1-(0,a.sum)(e);if(b&&C>(0,a.max)(e)){const e=(0,g.yr)("blue",C);f(t,d,l,x-d+.5,p,i,e)}else{const e=(0,g.yr)(M,n);f(t,d,l,x-d+.5,p,i,e)}c++})}({ctx:t,feat:e,region:S,bpPerPx:b,renderArgs:r,canvasWidth:h,cigarOps:(0,l.parseCigar)(v.get("CIGAR"))});break;case"methylation":!function({ctx:t,feat:e,region:r,bpPerPx:o,renderArgs:n,canvasWidth:i,cigarOps:s}){const{regionSequence:c}=n,{feature:l,topPx:p,heightPx:h}=e;if(!c)throw new Error("region sequence required for methylation");if(!l.get("seq"))return;const d=l.get("start"),g=l.get("end"),{methBins:m,methProbs:b,hydroxyMethBins:x,hydroxyMethProbs:P}=(0,_.P)(l,s);function M(t){if(m[t]){const e=b[t]||0;return(e>.5?(0,u.M)("red").alpha(2*(e-.5)):(0,u.M)("blue").alpha(1-2*e)).toHslString()}if(x[t]){const e=P[t]||0;return(e>.5?(0,u.M)("pink").alpha(2*(e-.5)):(0,u.M)("purple").alpha(1-2*e)).toHslString()}}const C=c.toLowerCase();for(let e=0;e<g-d;e++){const n=e+d,s=C[n-r.start+1],c=C[n-r.start+2];if("c"===s&&"g"===c)if(o>2){const[s,c]=(0,a.bpSpanPx)(n,n+2,r,o);f(t,s,p,c-s+.5,h,i,M(e)||M(e+1)||"blue")}else{const[s,c]=(0,a.bpSpanPx)(n,n+1,r,o);f(t,s,p,c-s+.5,h,i,M(e)||"blue");const[l,d]=(0,a.bpSpanPx)(n+1,n+2,r,o);f(t,l,p,d-l+.5,h,i,M(e+1)||"blue")}}}({ctx:t,feat:e,region:S,bpPerPx:b,renderArgs:r,canvasWidth:h,cigarOps:(0,l.parseCigar)(v.get("CIGAR"))})}})({ctx:t,feat:e,renderArgs:i,defaultColor:S,colorMap:T,colorContrastMap:A,charWidth:W,charHeight:k,canvasWidth:r}),function({ctx:t,feat:e,renderArgs:r,minSubfeatureWidth:o,largeInsertionIndicatorScale:n,mismatchAlpha:i,charWidth:s,charHeight:c,colorMap:l,colorContrastMap:p,hideSmallIndels:h,canvasWidth:d,drawSNPsMuted:g,drawIndels:_=!0}){const{bpPerPx:m,regions:b}=r,{heightPx:x,topPx:P,feature:M}=e,C=b[0],y=M.get("start"),v=Math.min(1/m,2),S=M.get("mismatches"),w=c-2,T=C.reversed?1/m+1:-1;if(S){for(const e of S){const r=y+e.start,n=e.length,c=e.base,[b,M]=(0,a.bpSpanPx)(r,r+n,C,m),S=Math.max(o,M-b);if("mismatch"===e.type){if(!g){const r=l[e.base]||"#888",o=i&&void 0!==e.qual?(0,u.M)(r).alpha(Math.min(1,e.qual/50)).toHslString():r;f(t,Math.round(b),P,S,x,d,o)}if(S>=s&&x>=w){const r=g?"black":p[e.base]||"black";t.fillStyle=i&&void 0!==e.qual?(0,u.M)(r).alpha(Math.min(1,e.qual/50)).toHslString():r,t.fillText(c,b+(S-s)/2+1,P+x)}}else if("deletion"===e.type&&_){const r=e.length;if(!h||r>=10){f(t,b,P,Math.abs(b-M),x,d,l.deletion);const r=`${e.length}`,o=(0,a.measureText)(r,10);S>=o&&x>=w&&(t.fillStyle=p.deletion,t.fillText(r,(b+M)/2-o/2,P+x))}}else if("insertion"===e.type&&_){const r=b+T,o=+e.base||e.length,n=Math.max(0,Math.min(1.2,1/m));if(o<10&&!h&&(f(t,r,P,n,x,d,l.insertion),1/m>=s&&x>=w)){const o=Math.round(r-n);f(t,o,P,3*n,1,d),f(t,o,P+x-1,3*n,1,d),t.fillText(`(${e.base})`,r+3,P+x)}}else if("hardclip"===e.type||"softclip"===e.type){const r=b+T,n=l[e.type],a=Math.max(o,v);if(f(t,r,P,a,x,d,n),1/m>=s&&x>=w){const o=r-a;f(t,o,P,3*a,1,d),f(t,o,P+x-1,3*a,1,d),t.fillText(`(${e.base})`,r+3,P+x)}}else if("skip"===e.type&&b+S>0){const e=S-(m>10?1.5:0);f(t,Math.max(0,b),P+x/2-1,e+Math.min(b,0),1,d,l.skip)}}if(_)for(const e of S){const r=y+e.start,o=e.length,i=+e.base||e.length;if("insertion"===e.type&&i>=10){const[e]=(0,a.bpSpanPx)(r,r+o,C,m),s=`${i}`;if(m>n)f(t,e-1,P,2,x,d,l.insertion);else if(x>c){const r=(0,a.measureText)(s),o=5;f(t,e-r/2-o,P,r+2*o,x,d,"purple"),t.fillStyle=p.insertion,t.fillText(s,e-r/2,P+x)}else{const r=2;f(t,e-r,P,2*r,x,d,l.insertion)}}}}}({ctx:t,feat:e,renderArgs:i,hideSmallIndels:v,mismatchAlpha:M,drawSNPsMuted:I,drawIndels:!0,largeInsertionIndicatorScale:y,minSubfeatureWidth:C,charWidth:W,charHeight:k,colorMap:T,colorContrastMap:A,canvasWidth:r}),b&&function({ctx:t,feat:e,renderArgs:r,config:n,theme:i,colorMap:s,canvasWidth:c}){const{feature:p,topPx:d,heightPx:g}=e,{regions:u,bpPerPx:_}=r,m=u[0],b=(0,o.readConfObject)(n,"minSubfeatureWidth"),x=p.get("mismatches"),P=p.get("seq"),{charWidth:M,charHeight:C}=h();if(!P||!x)return;const y=C-2;let v=0,S=0;const w=p.get("CIGAR"),T=(0,l.parseCigar)(w);for(let e=0;e<T.length;e+=2){const r=T[e+1],o=+T[e];if("S"===r){for(let r=0;r<o;r++){const n=P[v+r],l=p.get("start")-(0===e?o:0)+S+r,[h,u]=(0,a.bpSpanPx)(l,l+1,m,_),x=Math.max(b,u-h),C=s[n]||"#000000";t.fillStyle=C,f(t,h,d,x,g,c),x>=M&&g>=y&&(t.fillStyle=i.palette.getContrastText(C),t.fillText(n,h+(x-M)/2+1,d+g))}v+=o}"N"===r&&(S+=o),"M"!==r&&"="!==r&&"X"!==r||(S+=o,v+=o),"D"===r&&(S+=o),"I"===r&&(v+=o)}}({ctx:t,feat:e,renderArgs:i,colorMap:T,config:m,theme:w,canvasWidth:r})})}},36917:(t,e,r)=>{r.d(e,{DW:()=>f,L9:()=>i,pf:()=>n,sY:()=>c,w7:()=>a});var o=r(86576);const n={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unknown:"grey"},a={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00005A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unknown:"grey"};function i(t,e,r){const o=t.refName===e.refName,i=Math.abs(t.tlen||0);return o&&i>(r?.upper||0)?[n.color_longinsert,a.color_longinsert]:o&&i<(r?.lower||0)?[n.color_shortinsert,a.color_shortinsert]:o?void 0:[n.color_interchrom,a.color_interchrom]}const s=[n.color_unknown,n.color_unknown];function c(t,e,r){return l(t)||i(t,e,r)||s}function l(t){const e=o.il.fr[t.pair_orientation||""],r=o.rr[e];return"LR"===e?void 0:[n[r],a[r]]}function f(t){return l(t)||s}},59509:(t,e,r)=>{r.d(e,{r:()=>c});var o=r(95805),n=r(49256),a=r(10420),i=r(60515),s=r(86576);function c(t,e){const r=t.get("strand"),c=t.get("seq"),l=(0,s.c$)(t,"MM","Mm")||"",f=e||(0,o.parseCigar)(t.get("CIGAR"));if(c){const e=(0,a.Z)(l,c,r),o=(0,i.Y)(t),s=[];let p=0;for(const{type:t,positions:a}of e){for(const{ref:e,idx:i}of(0,n.h)(f,a)){const n=o?.[p+(-1===r?a.length-1-i:i)]||0;if(s[e]){const r=s[e];s[e]={allProbs:[...r.allProbs,n],prob:Math.max(r.prob,n),type:r.prob>n?r.type:t}}else s[e]={type:t,prob:n,allProbs:[n]}}p+=a.length}return s}}},60515:(t,e,r)=>{r.d(e,{Y:()=>n});var o=r(86576);function n(t){const e=(0,o.c$)(t,"ML","Ml")||[];if(e){const t=[];if("string"==typeof e){const r=e.split(",");for(let e=0,o=r.length;e<o;e++)t.push(+r[e]/255)}else for(let r=0,o=e.length;r<o;r++)t.push(e[r]/255);return t}{const e=(0,o.c$)(t,"MP","Mp");if(e){const t=[];for(let r=0,o=e.length;r<o;r++){const o=e.charCodeAt(r)-33;t.push(Math.min(1,o/50))}return t}return}}},69276:(t,e,r)=>{r.d(e,{P:()=>s});var o=r(49256),n=r(10420),a=r(60515),i=r(86576);function s(t,e){const r=t.get("start"),s=t.get("end"),c=t.get("strand"),l=s-r,f=(0,i.c$)(t,"MM","Mm")||"",p=[],h=[],d=[],g=[],u=t.get("seq");if(u){const r=(0,a.Y)(t),i=(0,n.Z)(f,u,c);let s=0;for(const{type:t,positions:n}of i){for(const{ref:a,idx:i}of(0,o.h)(e,n)){if(a<0||a>=l)continue;const e=s+(-1===c?n.length-1-i:i),o=r?.[e]||0;"m"===t?(p[a]=1,d[a]=o):"h"===t&&(h[a]=1,g[a]=o)}s+=n.length}}return{methBins:p,hydroxyMethBins:h,methProbs:d,hydroxyMethProbs:g}}}}]);
//# sourceMappingURL=4060.1d5341ee.chunk.js.map