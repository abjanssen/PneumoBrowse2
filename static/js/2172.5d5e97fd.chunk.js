"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2172,9326],{1832(t,e,n){n.d(e,{P:()=>a});var s=n(23886);function a(t,e,n=()=>{}){const a=new TextDecoder("utf8");let r=0,o=0;for(;r<t.length;){const c=t.indexOf(10,r),i=-1===c?t.length:c,l=t.subarray(r,i),u=a.decode(l).trim();if(u&&!1===e(u,o))break;o++%1e4==0&&n(`Loading ${(0,s.getProgressDisplayStr)(r,t.length)}`),r=i+1}}},2172(t,e,n){n.d(e,{default:()=>i});var s=n(23886),a=n(11931),r=n(1832),o=n(79326),c=n(75780);class i extends o.default{async setupPre(t){return(0,c.W)(function(t,e){const{statusCallback:n=()=>{}}=e||{};let s="",a="",o=0,c=0,i=0,l=0,u=0,h=0,m=[],f=0,g=0,p=!1;const d=[],b=/^>(\S+)\s+(\S+)\s+(\d+)\s+(\d+)/;return(0,r.P)(t,t=>{const e=b.exec(t);if(null!==e)return s=e[1],a=e[2],p=!0,!0;if(!p)return!0;const n=t.split(" ");if(7===n.length){const t=+n[0],e=+n[1],s=+n[2],a=+n[3],r=+n[4];u=t<e&&s<a||t>e&&s>a?1:-1,i=Math.min(t,e)-1,l=Math.max(e,t),o=Math.min(s,a)-1,c=Math.max(a,s),f=g=0,h=r,m=[]}else if(1===n.length){const e=+n[0];if(0===e){let e=0;const n=[];if(l-i-f!==c-o-g)throw new Error(`inconsistent alignment on line ${t}`);m.push(l-i-f<<4);for(const t of m){const s=t>>4;e+=s,n.push(s+"MID".charAt(15&t))}d.push({qname:a,qstart:o,qend:c,tname:s,tstart:i,tend:l,strand:u,extra:{numMatches:e-h,blockLen:e,mappingQual:0,NM:h,cg:n.join("")}})}else if(e>0){const t=e-1;f+=t+1,g+=t,t>0&&m.push(t<<4),m.length>0&&2==(15&m[m.length-1])?m[m.length-1]+=16:m.push(18)}else{const t=-e-1;f+=t,g+=t+1,t>0&&m.push(t<<4),m.length>0&&1==(15&m[m.length-1])?m[m.length-1]+=16:m.push(17)}}return!0},n),d}(await(0,s.fetchAndMaybeUnzip)((0,a.openLocation)(this.getConf("deltaLocation"),this.pluginManager),t),t))}}},79326(t,e,n){n.d(e,{default:()=>g});var s=n(90946),a=n(23886),r=n(11931),o=n(1832),c=n(49303),i=n(25529),l=n(153),u=n(64738),h=n(5843),m=n(75780);const{eL:f}=l;class g extends s.L{static capabilities=["getFeatures","getRefNames"];async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(t=>{throw this.setupP=void 0,t})),this.setupP}async setupPre(t){const e=[];return(0,o.P)(await(0,a.fetchAndMaybeUnzip)((0,r.openLocation)(this.getConf("pafLocation"),this.pluginManager),t),t=>(e.push((0,h.xI)(t)),!0),t?.statusCallback),(0,m.W)(e)}async hasDataForRefName(){return!0}getAssemblyNames(){const t=this.getConf("assemblyNames");return 0===t.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:t}async getRefNames(t={}){const e=t.regions?.[0].assemblyName,n=await this.setup(t),s=this.getAssemblyNames().indexOf(e);if(-1!==s){const t=new Set;for(const e of n)t.add(0===s?e.qname:e.tname);return[...t]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(t,e={}){return(0,i.ObservableCreate)(async n=>{const s=await this.setup(e),a=this.getAssemblyNames(),{start:r,end:o,refName:i,assemblyName:l}=t,m=a.indexOf(l),g=0===m;-1===m&&(console.warn(`${l} not found in this adapter`),n.complete());for(let t=0;t<s.length;t++){const e=s[t];let m=0,p=0,d="",b="",y=0,w=0;g?(m=e.qstart,p=e.qend,d=e.qname,b=e.tname,y=e.tstart,w=e.tend):(m=e.tstart,p=e.tend,d=e.tname,b=e.qname,y=e.qstart,w=e.qend);const{extra:x,strand:q}=e;if(d===i&&(0,c.R6)(r,o,m,p)){const{numMatches:e=0,blockLen:s=1,cg:r,...o}=x;let c=x.cg;x.cg&&(g&&-1===q?c=(0,h.qm)(f(x.cg)).join(""):g&&(c=(0,h.gJ)(x.cg))),n.next(new u.A({uniqueId:t+l,assemblyName:l,start:m,end:p,type:"match",refName:d,strand:q,...o,CIGAR:c,syntenyId:t,identity:e/s,numMatches:e,blockLen:s,mate:{start:y,end:w,refName:b,assemblyName:a[+g]}}))}}n.complete()})}}},75780(t,e,n){function s(t){const e={};for(const n of t){const t=`${n.qname}-${n.tname}`,s=n.extra.mappingQual||1,a=n.extra.blockLen||1,r=e[t];r?(r.valueSum+=s*a,r.weightSum+=a):e[t]={valueSum:s*a,weightSum:a}}const n={};let s=1/0,a=-1/0;for(const[t,{valueSum:r,weightSum:o}]of Object.entries(e)){const e=r/o;n[t]=e,s=Math.min(e,s),a=Math.max(e,a)}const r=a-s;for(const e of t){const t=n[`${e.qname}-${e.tname}`];e.extra.meanScore=r>0?(t-s)/r:1}return t}n.d(e,{W:()=>s})},64738(t,e,n){n.d(e,{A:()=>o});var s=n(43102),a=n(153);const{DQ:r}=a;class o extends s.A{get(t){return"mismatches"===t?r(this.get("CIGAR")):super.get(t)}}},5843(t,e,n){n.d(e,{TA:()=>r,fY:()=>a,gJ:()=>i,qm:()=>c,xI:()=>o});var s=n(23886);function a(t){return new Map(t.split(/\n|\r\n|\r/).filter(t=>!!t&&!t.startsWith("#")).map(t=>{const[e,n,s,a,r,o]=t.split("\t");return[a,{refName:e,start:+n,end:+s,score:+r,name:a,strand:"-"===o?-1:1}]}))}async function r(t,e){return(0,s.fetchAndMaybeUnzipText)(t,e)}function o(t){const e=t.split("\t"),n=e.slice(12),s={numMatches:+e[9],blockLen:+e[10],mappingQual:+e[11]};if(n.length)for(const t of n){const e=t.indexOf(":");s[t.slice(0,e)]=t.slice(e+3)}return{tname:e[5],tstart:+e[7],tend:+e[8],qname:e[0],qstart:+e[2],qend:+e[3],strand:"-"===e[4]?-1:1,extra:s}}function c(t){const e=[];for(let n=t.length-2;n>=0;n-=2){e.push(t[n]);const s=t[n+1];"D"===s?e.push("I"):"I"===s?e.push("D"):e.push(s)}return e}function i(t){return t.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}}}]);
//# sourceMappingURL=2172.5d5e97fd.chunk.js.map