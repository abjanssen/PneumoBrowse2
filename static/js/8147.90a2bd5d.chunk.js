"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8147,8258],{68147(e,t,r){r.r(t),r.d(t,{default:()=>b});var n=r(42918),s=r(24215),o=r(1591),c=r(65525),a=r(11543),l=r(64074),d=r(67752),u=r(31260),i=r(85787),m=r(27351),h=r(87574),f=r(77251),g=r(53155),w=r(65045),p=r(86111),x=r(68258),j=r(32118);const C=(0,w.n)()({dialogContent:{width:"80em"}}),b=(0,l.observer)(function({handleClose:e,model:t,feature:r}){const{sequenceFeatureDetails:l}=t,{upDownBp:w}=l,{classes:b}=C(),q=(0,n.useRef)(null),[S,v]=(0,n.useState)(!1),_=(0,f.getSession)(t),y=t.view?.assemblyNames?.[0],{sequence:k,error:R}=(0,p.p)({assemblyName:y,session:_,feature:new g.A(r),upDownBp:w,forceLoad:S});return(0,j.jsxs)(i.A,{maxWidth:"xl",open:!0,title:"Sequence view",onClose:()=>{e()},children:[(0,j.jsxs)(s.A,{className:b.dialogContent,children:[(0,j.jsxs)("div",{children:[(0,j.jsx)(u.A,{model:l}),(0,j.jsx)(d.A,{ref:q,model:l})]}),(0,j.jsxs)("div",{children:["gene"===r.type?(0,j.jsx)(o.A,{children:"Note: inspect subfeature sequences for protein/CDS computations"}):null,R?(0,j.jsx)(m.A,{error:R}):k?"error"in k?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(o.A,{color:"error",children:k.error}),(0,j.jsx)(c.A,{variant:"contained",color:"inherit",onClick:()=>{v(!0)},children:"Force load"})]}):(0,j.jsx)(n.Suspense,{fallback:(0,j.jsx)(h.A,{}),children:(0,j.jsx)(x.default,{ref:q,feature:r,sequence:k,model:l})}):(0,j.jsx)(h.A,{})]})]}),(0,j.jsx)(a.A,{children:(0,j.jsx)(c.A,{onClick:()=>{e()},variant:"contained",children:"Close"})})]})})},68258(e,t,r){r.r(t),r.d(t,{default:()=>_});var n=r(30936),s=r(42918),o=r(64074);const c="rgb(220,220,180)",a="rgba(250,200,200)";function l({str:e,charactersPerRow:t,showCoordinates:r,currRemainder:n=0,spacingInterval:s=10}){const o=Math.ceil(e.length/t),c=new Array(o);let a=n%s,l=0,i=0;for(;l<o+1;++l){const o=0===l?t-n:t,u=e.slice(i,i+o);if(!u)break;c[l]=r?d(u,a,s):u,a=0,i+=o}return{segments:c,remainder:u(c,l,n,t)}}function d(e,t,r){if(!e)return"";let n="";for(let s=0,o=t;s<e.length;s++,o++)o%r===0&&(n+=" ",o=0),n+=e[s];return n}function u(e,t,r,n){return((e.at(-1)?.replaceAll(" ","").length||0)+(t<2?r:0))%n}var i=r(32118);const m=(0,o.observer)(function({chunks:e,start:t,color:r,strand:n=1,coordStart:o=t,model:c}){const{charactersPerRow:a,showCoordinates:l}=c;return e.map((c,d)=>{const u=0===d&&t%a===0||d>0?`${(""+(o-t%a+d*n*a)).padStart(4)}   `:"",m=d===e.length-1&&(e.at(-1)?.replaceAll(" ","").length||0)+(0===d?t%a:0)!==a?null:l?" \n":"";return(0,i.jsxs)(s.Fragment,{children:[l?u:null,(0,i.jsx)("span",{style:{background:r},children:c}),m]},`${c}-${d}`)})}),h=(0,o.observer)(function({utr:e,cds:t,exons:r,sequence:n,upstream:s,downstream:o,feature:d,includeIntrons:u,collapseIntron:h,model:f}){const{upperCaseCDS:g,intronBp:w,charactersPerRow:p,showCoordinates:x,showCoordinatesSetting:j}=f,C=t.length>0,b=(t.length?[...t,...e].sort((e,t)=>e.start-t.start):r).filter(e=>e.start!==e.end),q=e=>g?e.toLowerCase():e,S=e=>g?e.toUpperCase():e,v=-1===d.strand?-1:1,_="genomic"===j&&u&&!h,y=_?v:1;let k=_?v>0?d.start+1-(s?.length||0):d.end+(s?.length||0):0,R=0,A=0,P=null;if(s){const{segments:e,remainder:t}=l({str:q(s),charactersPerRow:p,showCoordinates:x});P=(0,i.jsx)(m,{model:f,color:a,strand:y,start:R,coordStart:k,chunks:e}),A=t,R+=s.length*y,k+=s.length*y}const $=[];for(let e=0;e<b.length;e++){const t=b[e],r=n.slice(t.end,b[e+1]?.start),s=n.slice(t.start,t.end),{segments:o,remainder:a}=l({str:C?"CDS"===t.type?S(s):q(s):S(s),charactersPerRow:p,currRemainder:A,showCoordinates:x});if($.push((0,i.jsx)(m,{model:f,color:"CDS"===t.type?c:"rgb(200,240,240)",strand:y,start:R,coordStart:k,chunks:o},`${JSON.stringify(t)}-mid`)),A=a,R+=s.length*y,k+=s.length*y,r&&u&&e<b.length-1){const e=q(h&&r.length>2*w?`${r.slice(0,w)}...${r.slice(-w)}`:r),{segments:n,remainder:s}=l({str:e,charactersPerRow:p,currRemainder:A,showCoordinates:x});n.length&&($.push((0,i.jsx)(m,{model:f,strand:y,coordStart:k,start:R,chunks:n},`${JSON.stringify(t)}-intron`)),A=s,R+=e.length*y,k+=e.length*y)}}let D=null;if(o){const{segments:e}=l({str:q(o),charactersPerRow:p,currRemainder:A,showCoordinates:x});D=(0,i.jsx)(m,{start:R,model:f,strand:y,chunks:e,coordStart:k,color:a})}return(0,i.jsxs)(i.Fragment,{children:[P,$,D]})});var f=r(91674);const g=(0,o.observer)(function({cds:e,sequence:t,model:r}){const{charactersPerRow:n,showCoordinates:s}=r,{segments:o}=l({str:(0,f.o9)(e,t),charactersPerRow:n,showCoordinates:s});return(0,i.jsx)(m,{model:r,color:c,chunks:o,start:0})}),w=(0,o.observer)(function({sequence:e,upstream:t,feature:r,downstream:n,model:s}){const{charactersPerRow:o,showCoordinatesSetting:c,showCoordinates:d}=s;let u=0,h=null,f=0;const g=-1===r.strand?-1:1,w="genomic"===c,p=w?g:1;let x=w?g>0?r.start+1-(t?.length||0):r.end+(t?.length||0):0;if(t){const{segments:e,remainder:r}=l({str:t,charactersPerRow:o,showCoordinates:d});h=(0,i.jsx)(m,{model:s,color:a,start:u,coordStart:x,chunks:e}),f=r,u+=t.length*p,x+=t.length*p}const{segments:j,remainder:C}=l({str:e,charactersPerRow:o,showCoordinates:d,currRemainder:f}),b=(0,i.jsx)(m,{model:s,color:"rgb(200,280,200)",start:u,coordStart:x,chunks:j});f=C,u+=e.length*p,x+=e.length*p;let q=null;if(n){const{segments:e}=l({str:n,charactersPerRow:o,currRemainder:f,showCoordinates:d});q=(0,i.jsx)(m,{start:u,model:s,chunks:e,coordStart:x,color:a})}return(0,i.jsxs)(i.Fragment,{children:[h,b,q]})});var p=r(66867);const x=(0,o.observer)(function({cds:e,sequence:t,codonTable:r,model:n}){const{charactersPerRow:s,showCoordinates:o}=n,c=(0,p.E)({cds:e,sequence:t,codonTable:r}),{segments:a}=l({str:c,charactersPerRow:s,showCoordinates:o});return(0,i.jsx)(m,{model:n,color:"rgb(220,160,220)",chunks:a,start:0})});var j=r(77251);function C(e){const t=(0,n.c)(59),{mode:r,feature:s,model:o,sequenceData:c}=e,{seq:a,upstream:l,downstream:d,cds:u,exons:m,utr:f}=c;switch(r){case"genomic":{let e;return t[0]!==s||t[1]!==o||t[2]!==a?(e=(0,i.jsx)(w,{feature:s,model:o,sequence:a}),t[0]=s,t[1]=o,t[2]=a,t[3]=e):e=t[3],e}case"genomic_sequence_updownstream":{let e;return t[4]!==d||t[5]!==s||t[6]!==o||t[7]!==a||t[8]!==l?(e=(0,i.jsx)(w,{model:o,feature:s,sequence:a,upstream:l,downstream:d}),t[4]=d,t[5]=s,t[6]=o,t[7]=a,t[8]=l,t[9]=e):e=t[9],e}case"cds":{let e;return t[10]!==u||t[11]!==o||t[12]!==a?(e=(0,i.jsx)(g,{model:o,cds:u,sequence:a}),t[10]=u,t[11]=o,t[12]=a,t[13]=e):e=t[13],e}case"cdna":{let e;return t[14]!==u||t[15]!==m||t[16]!==s||t[17]!==o||t[18]!==a||t[19]!==f?(e=(0,i.jsx)(h,{model:o,exons:m,feature:s,cds:u,utr:f,sequence:a}),t[14]=u,t[15]=m,t[16]=s,t[17]=o,t[18]=a,t[19]=f,t[20]=e):e=t[20],e}case"protein":{let e,r;return t[21]===Symbol.for("react.memo_cache_sentinel")?(e=(0,j.generateCodonTable)(j.defaultCodonTable),t[21]=e):e=t[21],t[22]!==u||t[23]!==o||t[24]!==a?(r=(0,i.jsx)(x,{model:o,cds:u,codonTable:e,sequence:a}),t[22]=u,t[23]=o,t[24]=a,t[25]=r):r=t[25],r}case"gene":{let e;return t[26]!==u||t[27]!==m||t[28]!==s||t[29]!==o||t[30]!==a||t[31]!==f?(e=(0,i.jsx)(h,{model:o,exons:m,feature:s,cds:u,utr:f,sequence:a,includeIntrons:!0}),t[26]=u,t[27]=m,t[28]=s,t[29]=o,t[30]=a,t[31]=f,t[32]=e):e=t[32],e}case"gene_collapsed_intron":{let e;return t[33]!==u||t[34]!==m||t[35]!==s||t[36]!==o||t[37]!==a||t[38]!==f?(e=(0,i.jsx)(h,{model:o,exons:m,feature:s,cds:u,sequence:a,utr:f,includeIntrons:!0,collapseIntron:!0}),t[33]=u,t[34]=m,t[35]=s,t[36]=o,t[37]=a,t[38]=f,t[39]=e):e=t[39],e}case"gene_updownstream":{let e;return t[40]!==u||t[41]!==d||t[42]!==m||t[43]!==s||t[44]!==o||t[45]!==a||t[46]!==l||t[47]!==f?(e=(0,i.jsx)(h,{model:o,exons:m,feature:s,cds:u,sequence:a,utr:f,upstream:l,downstream:d,includeIntrons:!0}),t[40]=u,t[41]=d,t[42]=m,t[43]=s,t[44]=o,t[45]=a,t[46]=l,t[47]=f,t[48]=e):e=t[48],e}case"gene_updownstream_collapsed_intron":{let e;return t[49]!==u||t[50]!==d||t[51]!==m||t[52]!==s||t[53]!==o||t[54]!==a||t[55]!==l||t[56]!==f?(e=(0,i.jsx)(h,{model:o,exons:m,feature:s,cds:u,sequence:a,utr:f,upstream:l,downstream:d,includeIntrons:!0,collapseIntron:!0}),t[49]=u,t[50]=d,t[51]=m,t[52]=s,t[53]=o,t[54]=a,t[55]=l,t[56]=f,t[57]=e):e=t[57],e}default:{let e;return t[58]===Symbol.for("react.memo_cache_sentinel")?(e=(0,i.jsx)("div",{children:"Unknown type"}),t[58]=e):e=t[58],e}}}const b=(0,o.observer)(function({mode:e,feature:t,sequence:r,model:n}){const s=function({feature:e,sequence:t}){const r=function(e){const{start:t,subfeatures:r}=e;return r?.sort((e,t)=>e.start-t.start).map(e=>({...e,start:e.start-t,end:e.end-t}))||[]}(e),{cds:n,exons:s,utr:o}=function(e,t){const r=t.type?.toLowerCase(),n="mature_protein_region_of_cds"===r?[{start:0,end:t.end-t.start,type:"CDS"}]:(0,f.SC)(e.filter(e=>{const t=e.type?.toLowerCase();return"cds"===t||"mature_protein_region_of_cds"===t})),s=(0,f.SC)(e.filter(e=>"exon"===e.type));let o=(0,f.SC)(e.filter(e=>e.type?.match(/utr/i)));return!o.length&&n.length&&s.length?o=(0,f.h8)(n,s):o.length||!n.length||s.length||(o=(0,f.V4)(n,{start:0,end:t.end-t.start,type:"gene"})),{cds:n,exons:s,utr:o}}(r,e);if(t&&!("error"in t)){const{sequence:r,cds:c,exons:a,utr:l}=-1===e.strand?function(e,t,r,n){const{seq:s,upstream:o="",downstream:c=""}=e;return{sequence:{seq:(0,j.revcom)(s),upstream:c?(0,j.revcom)(c):"",downstream:o?(0,j.revcom)(o):""},cds:(0,f.YC)(t,s.length),exons:(0,f.YC)(r,s.length),utr:(0,f.YC)(n,s.length)}}(t,n,s,o):{sequence:t,cds:n,exons:s,utr:o},{seq:d,upstream:u,downstream:i}=r;return{seq:d,upstream:u,downstream:i,cds:c,exons:a,utr:l}}}({feature:t,sequence:r});return s?(0,i.jsx)(C,{mode:e,feature:t,model:n,sequenceData:s}):null}),q=(0,o.observer)(function({mode:e,model:t,feature:r}){return(0,i.jsx)("div",{style:{background:"white"},children:`>${[[r.name||r.id,e].filter(e=>!!e).join("-"),`${r.refName}:${(0,j.toLocale)(r.start+1)}-${(0,j.toLocale)(r.end)}${n=r.strand,-1===n?"(-)":1===n?"(+)":""}`,e.endsWith("updownstream")?`+/- ${(0,j.toLocale)(t.upDownBp)} up/downstream bp`:""].filter(e=>!!e).join(" ")}\n`});var n});function S(e){const t=(0,n.c)(3),{children:r}=e;let s,o;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s={fontFamily:"monospace",color:"black",fontSize:11},t[0]=s):s=t[0],t[1]!==r?(o=(0,i.jsx)("pre",{style:s,children:r}),t[1]=r,t[2]=o):o=t[2],o}function v(e){const t=(0,n.c)(3),{children:r}=e;let s,o;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s={fontFamily:"monospace",color:"black",fontSize:11,maxWidth:600,whiteSpace:"wrap",wordBreak:"break-all"},t[0]=s):s=t[0],t[1]!==r?(o=(0,i.jsx)("div",{style:s,children:r}),t[1]=r,t[2]=o):o=t[2],o}const _=(0,o.observer)((0,s.forwardRef)(function(e,t){const r=(0,n.c)(17),{sequence:s,model:o,feature:c}=e,{showCoordinates:a,mode:l}=o,d=a?S:v;let u,m,h,f,g;return r[0]===Symbol.for("react.memo_cache_sentinel")?(u={maxHeight:300,overflow:"auto"},r[0]=u):u=r[0],r[1]!==c||r[2]!==l||r[3]!==o?(m=(0,i.jsx)(q,{model:o,mode:l,feature:c}),r[1]=c,r[2]=l,r[3]=o,r[4]=m):m=r[4],r[5]!==c||r[6]!==l||r[7]!==o||r[8]!==s?(h=(0,i.jsx)(b,{model:o,mode:l,feature:c,sequence:s}),r[5]=c,r[6]=l,r[7]=o,r[8]=s,r[9]=h):h=r[9],r[10]!==d||r[11]!==m||r[12]!==h?(f=(0,i.jsxs)(d,{children:[m,h]}),r[10]=d,r[11]=m,r[12]=h,r[13]=f):f=r[13],r[14]!==t||r[15]!==f?(g=(0,i.jsx)("div",{"data-testid":"sequence_panel",ref:t,style:u,children:f}),r[14]=t,r[15]=f,r[16]=g):g=r[16],g}))}}]);
//# sourceMappingURL=8147.90a2bd5d.chunk.js.map