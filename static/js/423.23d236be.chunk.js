"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[423],{50219(t,e,a){a.d(e,{W:()=>i});var s=a(77251);function i(t){const e=t.length,a=(0,s.sum)(t);let i=0;for(let a=0;a<e;a++){const e=t[a];i+=e*e}const n=a/e,o=Math.sqrt((e*i-a*a)/(e*e));return{upper:n+3*o,lower:n-3*o,avg:n,sd:o}}},80423(t,e,a){a.d(e,{executeRenderLinearReadCloudDisplay:()=>S});var s=a(38433),i=a(77251),n=a(61132),o=a(83640),r=a(26931),c=a(83090),l=a(68589),d=a(16876),h=a(52901),u=a(99226),g=a(96852),f=a(10596),p=a(14050),m=a(3962),w=a(45089);function b(t,e,a,s){const i=new w.A({featureHeight:e,spacing:a?0:2,maxHeight:s}),n=new Map;for(const{id:a,minX:s,maxX:o}of t){const t=i.addRect(a,s,o,e);null!==t&&n.set(a,t)}return{chainYOffsets:n,layoutHeight:i.getTotalHeight()}}var x=a(50219);async function S({pluginManager:t,args:e}){const{sessionId:a,view:w,adapterConfig:S,sequenceAdapter:y,config:k,theme:C,featureHeight:M,noSpacing:P,drawCloud:v,colorBy:H,drawSingletons:B,drawProperPairs:R,flipStrandLongReadChains:F,trackMaxHeight:I,cloudModeHeight:A,cloudDomain:N,highResolutionScaling:W,exportSVG:O,statusCallback:T=()=>{},stopToken:_,visibleModifications:q,hideSmallIndels:D,hideMismatches:L,hideLargeIndels:V,showOutline:j}=e,X=l.A.create(w);w.width&&X.setVolatileWidth(w.width);const{bpPerPx:Y,offsetPx:E}=X,G=X.staticBlocks.totalWidthPx,$=X.staticBlocks.contentBlocks;if(!X.assemblyNames[0])throw new Error("No assembly name found in view");const z={...(0,u.getSnapshot)(X),width:X.width,staticBlocks:X.staticBlocks,bpToPx(t){const e=(0,c.eB)({self:this,refName:t.refName,coord:t.coord});return void 0!==e?{offsetPx:e.offsetPx,index:e.index}:void 0}},K=(await(0,s.cK)(t,a,S)).dataAdapter;y&&!K.sequenceAdapterConfig&&K.setSequenceAdapterConfig(y);const Q=await(0,i.updateStatus)("Fetching alignments",T,()=>(0,g._)(K.getFeaturesInMultipleRegions($,e).pipe((0,f.$)())));(0,h.SW)(_);const Z=(0,n.Q)(Q,t=>t.id()),{chains:J,stats:U}=await(0,i.updateStatus)("Processing alignments",T,async()=>{const t=[];for(const e of Z){const a=e.get("flags");if(2&a&&!(256&a)&&!(2048&a)){const a=e.get("template_length");0===a||Number.isNaN(a)||t.push(Math.abs(a))}}let e;return t.length>0&&(e={...(0,x.W)(t),max:(0,i.max)(t),min:(0,i.min)(t)}),{chains:Object.values((0,i.groupBy)(Z,t=>t.get("name"))),stats:e}}),tt={chains:J,stats:U};(0,h.SW)(_);const{computedChains:et}=await(0,i.updateStatus)("Calculating layout",T,async()=>{const t=(0,m.$B)(J,B,R,H.type||"insertSizeAndOrientation",tt),e=(0,m.wi)(t,z);return(0,m.ie)(e),{filteredChains:t,computedChains:e}});let at;if(v){if(void 0===A)throw new Error("cloudModeHeight is required when drawCloud is true");at=A}else at=b(et,M,P,I??1200).layoutHeight;const st={highResolutionScaling:W,exportSVG:O},it=await(0,i.updateStatus)("Rendering alignments",T,()=>(0,o.u)(G,at,st,async t=>{const{layoutHeight:e,cloudMaxDistance:a,featuresForFlatbush:s,mismatchFlatbush:i,mismatchItems:n}=(0,m.ZR)({ctx:t,params:{chainData:tt,featureHeight:M,canvasWidth:G,noSpacing:P,colorBy:H,drawSingletons:B,drawProperPairs:R,flipStrandLongReadChains:F,trackMaxHeight:I,config:k,theme:C,regions:$,bpPerPx:Y,stopToken:_,visibleModifications:q,hideSmallIndels:D,hideMismatches:L,hideLargeIndels:V,showOutline:j},view:z,calculateYOffsets:t=>v?(0,p.VY)(t,at,N):b(t,M,P,I??1200)});return{layoutHeight:e,cloudMaxDistance:a,featuresForFlatbush:s,mismatchFlatbush:i,mismatchItems:n}})),nt={...it,offsetPx:E};return(0,d.lk)(nt,(0,r.X)(it))}}}]);
//# sourceMappingURL=423.23d236be.chunk.js.map