"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6834],{6834:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var a=r(67260),n=r(41256),s=r(46377),i=r(99546),o=r(99834),c=r(66885),u=r(44728),d=r(82088),p=r(28493);class f extends s.BaseFeatureDataAdapter{async configurePre(e){const t=this.pluginManager,r=new a.C({filehandle:(0,o.openLocation)(this.getConf("bigBedLocation"),t)}),s=await r.getHeader(e);return{bigbed:r,header:s,parser:new n.A({autoSql:s.autoSql})}}async configure(e){return this.cachedP||(this.cachedP=this.configurePre(e).catch((e=>{throw this.cachedP=void 0,e}))),this.cachedP}async getRefNames(e){const{header:t}=await this.configure(e);return Object.keys(t.refsByName)}async getRefNameAliases(e){const{header:t}=await this.configure(e);return(await Promise.all(Object.keys(t.refsByName).map((async e=>(await(0,u._)(this.getFeatures({assemblyName:"",refName:e,start:0,end:1}).pipe((0,d.$)())))[0])))).map((e=>e.toJSON())).map((e=>({refName:e.ucsc,aliases:[e.ncbi,e.refseq,e.genbank],override:!0})))}async getData(){const e=await this.getRefNames(),t=[];for(const r of e){const e=await(0,u._)(this.getFeatures({assemblyName:"unknown",refName:r,start:0,end:Number.MAX_SAFE_INTEGER}).pipe((0,d.$)()));t.push(e)}return t.flat()}async getHeader(e){const{parser:t,header:r}=await this.configure(e),{version:a,fileType:n}=r,{fields:s,...i}=t.autoSql;return{version:a,fileType:n,autoSql:i,fields:await this.getMetadata(e)}}async getMetadata(e){const{parser:t}=await this.configure(e),{fields:r}=t.autoSql;return Object.fromEntries(r.map((({name:e,comment:t})=>[e,t])))}async getFeaturesHelper({query:e,opts:t,observer:r,allowRedispatch:a,originalQuery:n=e}){const{statusCallback:s=()=>{}}=t,o=this.getConf("scoreColumn"),c=this.getConf("aggregateField"),{parser:u,bigbed:d}=await(0,i.updateStatus)("Downloading header",s,(()=>this.configure(t))),f=await(0,i.updateStatus)("Downloading features",s,(()=>d.getFeatures(e.refName,e.start,e.end,{basesPerSpan:e.end-e.start})));await(0,i.updateStatus)("Processing features",s,(async()=>{const s={},d=[];if(f.some((e=>void 0===e.uniqueId)))throw new Error("found uniqueId undefined");for(const t of f){const a=[e.refName,`${t.start}`,`${t.end}`,...t.rest?.split("\t")||[]],f=u.parseLine(a,{uniqueId:t.uniqueId}),m=f[c],l=m&&"none"!==m;l&&!s[m]&&(s[m]=[]);const{uniqueId:h,type:b,chrom:S,chromStart:N,chromEnd:k,description:g,chromStarts:y,blockStarts:_,blockSizes:I,score:q,blockCount:w,thickStart:C,thickEnd:v,strand:E,...T}=f,F=(0,p.np)({...T,scoreColumn:o,splitLine:a,parser:u,uniqueId:h,start:t.start,end:t.end,refName:e.refName});l?(s[m].push(F),d.push(F)):(0,i.doesIntersect2)(F.start,F.end,n.start,n.end)&&r.next(new i.SimpleFeature({id:`${this.id}-${h}`,data:F}))}if(a&&d.length){let a=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(const e of d)e.start<a&&(a=e.start),e.end>n&&(n=e.end);if(n>e.end||a<e.start)return void await this.getFeaturesHelper({query:{...e,start:a-5e5,end:n+5e5},opts:t,observer:r,allowRedispatch:!1,originalQuery:e})}Object.entries(s).map((([t,a])=>{const s=(0,i.min)(a.map((e=>e.start))),o=(0,i.max)(a.map((e=>e.end)));if((0,i.doesIntersect2)(s,o,n.start,n.end)){const n=a.sort(((e,t)=>e.uniqueId.localeCompare(t.uniqueId)));if(n.every((e=>e.strand===(n[0]?.strand||1))))r.next(new i.SimpleFeature({id:`${this.id}-${n[0]?.uniqueId}-parent`,data:{type:"gene",subfeatures:n,strand:n[0]?.strand||1,name:t,start:s,end:o,refName:e.refName}}));else for(const a of n)r.next(new i.SimpleFeature({id:`${this.id}-${a.uniqueId}-parent`,data:{type:"gene",subfeatures:[a],strand:n[0]?.strand||1,name:t,start:a.start,end:a.end,refName:e.refName}}))}}))})),r.complete()}getFeatures(e,t={}){return(0,c.ObservableCreate)((async r=>{try{await this.getFeaturesHelper({query:{...e,start:e.start,end:e.end},opts:t,observer:r,allowRedispatch:!0})}catch(e){r.error(e)}}),t.stopToken)}}},28493:(e,t,r)=>{function a(e){const t=e?.trim().split(" ");return[0,1,2,3,5,6].every((e=>void 0!==t?.[e]&&!Number.isNaN(+t[e])))}function n(e){if(a(e)){const[t,r,a,n,s,i,o,c,u,d,p,f,m,l,h]=e.trim().split(" ");return{bitsw_score:t,percent_div:r,percent_del:a,percent_ins:n,query_chr:s,query_begin:i,query_end:o,query_remaining:c,orientation:u,matching_repeat_name:d,matching_repeat_class:p,matching_repeat_begin:f,matching_repeat_end:m,matching_repeat_remaining:l,repeat_id:h}}return{description:e}}function s({line:e,colRef:t,colStart:r,colEnd:a,scoreColumn:n,parser:s,uniqueId:o,names:c}){const u=e.split("\t");return i({splitLine:u,refName:u[t],start:Number.parseInt(u[r],10),end:Number.parseInt(u[a],10)+(r===a?1:0),parser:s,uniqueId:o,scoreColumn:n,names:c})}function i({splitLine:e,refName:t,start:r,end:s,parser:i,uniqueId:c,scoreColumn:u,names:d}){const p=d?function(e,t){let r=!1;const a=[];for(let n=0;n<t.length;n++)"blockCount"===e[n]&&(r=!0),a.push([e[n],t[n]]);const n=Object.fromEntries(a);if(r){const{blockStarts:e,blockCount:t,chromStarts:r,thickEnd:a,thickStart:s,blockSizes:i,...c}=n;return{...c,blockStarts:o(e),chromStarts:o(r),blockSizes:o(i),thickStart:s?+s:void 0,thickEnd:a?+a:void 0,blockCount:t?+t:void 0}}return n}(d,e):i.parseLine(e,{uniqueId:c}),{strand:f,score:m,chrom:l,chromStart:h,chromEnd:b,...S}=p,N=u?+p[u]:m?+m:void 0,k="string"==typeof f?"-"===f?-1:1:f,g=S.blockCount?function({start:e,uniqueId:t,refName:r,chromStarts:a,blockCount:n,blockSizes:s,blockStarts:i}){const o=[],c=a||i||[];for(let a=0;a<n;a++){const n=(c[a]||0)+e,i=s?.[a];if(i&&i>0){const e=n+i;o.push({uniqueId:`${t}-${a}`,start:n,end:e,refName:r,type:"block"})}}return o}({start:r,uniqueId:c,refName:t,chromStarts:S.chromStarts,blockCount:S.blockCount,blockSizes:S.blockSizes,blockStarts:S.blockStarts}):void 0;if(function({splitLine:e,start:t,end:r}){return+(e[6]||0)===t&&+(e[7]||0)===r&&[9,10,11,12,13,14,15,16,17].every((t=>e[t]&&!Number.isNaN(+e[t])))}({splitLine:e,start:r,end:s}))return function({splitLine:e,uniqueId:t,refName:r,start:a,end:n}){const[,,,s,,i,,,o,c,u,d,p,f,m,l,h,b]=e;return{uniqueId:t,refName:r,start:a,end:n,code:s,score:+u||0,strand:i,color:o,source:s,n_valid_cov:c,fraction_modified:u,n_mod:d,n_canonical:p,n_other_mod:f,n_delete:m,n_fail:l,n_diff:h,n_nocall:b}}({splitLine:e,uniqueId:c,refName:t,start:r,end:s});if(a(S.description)){const{chromStarts:e,blockSizes:a,blockStarts:i,type:o,blockCount:u,thickStart:d,thickEnd:p,description:f,...m}=S;return function({uniqueId:e,refName:t,start:r,end:a,description:s,...i}){const{subfeatures:o,...c}=i;return{...c,...n(s),uniqueId:e,refName:t,start:r,end:a}}({...m,uniqueId:c,description:f,type:o,score:N,start:r,end:s,strand:k,refName:t,subfeatures:g})}if(g&&function({thickStart:e,blockCount:t,strand:r}){return e&&t&&0!==r}({strand:k,blockCount:S.blockCount,thickStart:S.thickStart})){const{chromStarts:e,blockSizes:a,type:n,blockCount:i,thickStart:o,thickEnd:u,description:d}=S;return function(e){const{strand:t=0,chrom:r,chromStart:a,chromEnd:n,chromStarts:s,blockStarts:i,blockSizes:o,uniqueId:c,...u}=e,{subfeatures:d,thickStart:p,thickEnd:f,blockCount:m,refName:l,...h}=u,b=[],S=d.filter((e=>"block"===e.type)).sort(((e,t)=>e.start-t.start)),{cdsEndStat:N,cdsStartStat:k}=h;if("none"===k&&"none"===N)return{...h,uniqueId:c,strand:t,type:"transcript",refName:l,subfeatures:S.map((e=>({...e,type:"exon"})))};for(const e of S){const r=e.start,a=e.end;p>=a?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:a,refName:l}):p>r&&p<a&&f>=a?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:p,refName:l},{type:"CDS",phase:0,start:p,end:a,refName:l}):p<=r&&f>=a?b.push({type:"CDS",phase:0,start:r,end:a,refName:l}):p>r&&p<a&&f<a?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:p,refName:l},{type:"CDS",phase:0,start:p,end:f,refName:l},{type:(t>0?"three":"five")+"_prime_UTR",start:f,end:a,refName:l}):p<=r&&f>r&&f<a?b.push({type:"CDS",phase:0,start:r,end:f,refName:l},{type:(t>0?"three":"five")+"_prime_UTR",start:f,end:a,refName:l}):f<=r&&b.push({type:(t>0?"three":"five")+"_prime_UTR",start:r,end:a,refName:l})}return{...h,uniqueId:c,strand:t,type:"mRNA",refName:l,subfeatures:b}}({...S,description:d,chromStarts:e,thickStart:o,thickEnd:u,blockSizes:a,blockCount:i,type:n,score:N,start:r,end:s,strand:k,refName:t,uniqueId:c,subfeatures:g})}return{...S,uniqueId:c,score:N,start:r,end:s,strand:k,refName:t,subfeatures:g}}function o(e){return void 0!==e?"string"==typeof e?e.split(",").map((e=>+e)):e:void 0}r.d(t,{dE:()=>s,np:()=>i})}}]);
//# sourceMappingURL=6834.3307f121.chunk.js.map