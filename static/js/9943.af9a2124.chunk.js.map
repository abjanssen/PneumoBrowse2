{"version":3,"file":"static/js/9943.af9a2124.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/components/PileupTooltip.tsx","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/components/util.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/components/PileupRendering.tsx","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/types.ts"],"sourcesContent":["import BaseTooltip from '@jbrowse/core/ui/BaseTooltip'\nimport { toLocale } from '@jbrowse/core/util'\n\nimport { getFlatbushItemLabel } from '../types.ts'\n\nimport type { FlatbushItem } from '../types.ts'\n\nexport default function PileupTooltip({\n  item,\n  featureName,\n  refName,\n  mousePosition,\n}: {\n  item?: FlatbushItem\n  featureName?: string\n  refName: string\n  mousePosition: { x: number; y: number }\n}) {\n  return (\n    <BaseTooltip\n      placement=\"bottom-start\"\n      clientPoint={{\n        x: mousePosition.x,\n        y: mousePosition.y + 20,\n      }}\n    >\n      <div>\n        <div>{featureName}</div>\n        {item ? (\n          <>\n            <div\n              style={{\n                whiteSpace: 'pre-line',\n              }}\n            >\n              {getFlatbushItemLabel(item)}\n            </div>\n            <div>\n              Position: {refName}:{toLocale(item.start + 1)}\n            </div>\n          </>\n        ) : null}\n      </div>\n    </BaseTooltip>\n  )\n}\n","import type { Region } from '@jbrowse/core/util'\n\nexport function makeRect(\n  r: [number, number, number, number] | [number, number, number, number, any],\n  offset: number,\n  region: Region,\n  bpPerPx: number,\n) {\n  const [leftBp, topPx, rightBp, bottomPx] = r\n  const leftPx = region.reversed\n    ? (region.end - rightBp) / bpPerPx\n    : (leftBp - region.start) / bpPerPx\n  const rightPx = region.reversed\n    ? (region.end - leftBp) / bpPerPx\n    : (rightBp - region.start) / bpPerPx\n  const rectTop = Math.round(topPx)\n  const rectHeight = Math.round(bottomPx - topPx)\n  return {\n    left: leftPx - offset,\n    top: rectTop - offset,\n    width: rightPx - leftPx,\n    height: rectHeight,\n  }\n}\n","import { useMemo, useRef, useState } from 'react'\n\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport Flatbush from '@jbrowse/core/util/flatbush'\nimport Menu from '@mui/material/Menu'\nimport MenuItem from '@mui/material/MenuItem'\nimport { observer } from 'mobx-react'\n\nimport { flatbushItemToFeatureData } from '../types.ts'\nimport PileupTooltip from './PileupTooltip.tsx'\nimport { makeRect } from './util.ts'\n\nimport type { ColorBy, FilterBy, SortedBy } from '../../shared/types.ts'\nimport type { FlatbushItem } from '../types.ts'\nimport type { Region } from '@jbrowse/core/util/types'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst PileupRendering = observer(function PileupRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: SortedBy\n  colorBy?: ColorBy\n  filterBy?: FilterBy\n  items: FlatbushItem[]\n  flatbush: ArrayBufferLike\n  featureNames?: Record<string, string>\n}) {\n  const {\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n    colorBy,\n    filterBy,\n    flatbush,\n    items,\n    featureNames = {},\n  } = props\n  const { refName } = regions[0]!\n  const flatbush2 = useMemo(() => Flatbush.from(flatbush), [flatbush])\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const region = regions[0]!\n  const ref = useRef<HTMLDivElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n  const [itemUnderMouse, setItemUnderMouse] = useState<FlatbushItem>()\n  const [featureNameUnderMouse, setFeatureNameUnderMouse] = useState<string>()\n  const [mousePosition, setMousePosition] = useState<{ x: number; y: number }>()\n  const [contextMenuAnchor, setContextMenuAnchor] = useState<{\n    mouseX: number\n    mouseY: number\n    item: FlatbushItem\n  } | null>(null)\n  const selectedRect = selectedFeatureId\n    ? displayModel.getFeatureByID(blockKey, selectedFeatureId)\n    : undefined\n\n  const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n  const highlightedRect = highlightedFeature\n    ? displayModel.getFeatureByID(blockKey, highlightedFeature)\n    : undefined\n\n  const selected = selectedRect\n    ? makeRect(selectedRect, 2, region, bpPerPx)\n    : undefined\n  const highlight = highlightedRect\n    ? makeRect(highlightedRect, 0, region, bpPerPx)\n    : undefined\n\n  const canvasWidth = Math.ceil(width)\n  const isClickable = itemUnderMouse || featureIdUnderMouse\n  return (\n    <div\n      ref={ref}\n      data-testid={[\n        'pileup-overlay',\n        sortedBy?.type,\n        colorBy?.type,\n        colorBy?.tag,\n        filterBy?.tagFilter?.tag,\n      ]\n        .filter(f => !!f)\n        .join('-')}\n      style={{\n        position: 'relative',\n        width: canvasWidth,\n        height,\n        cursor: isClickable ? 'pointer' : 'default',\n      }}\n      onMouseLeave={() => {\n        setItemUnderMouse(undefined)\n        setFeatureNameUnderMouse(undefined)\n        setMousePosition(undefined)\n        displayModel.setFeatureIdUnderMouse(undefined)\n      }}\n      onMouseDown={(_event: React.MouseEvent) => {\n        setMouseIsDown(true)\n        setMovedDuringLastMouseDown(false)\n      }}\n      onMouseUp={() => {\n        setMouseIsDown(false)\n      }}\n      onMouseMove={event => {\n        if (!ref.current) {\n          return\n        }\n        if (mouseIsDown) {\n          setMovedDuringLastMouseDown(true)\n        }\n        const rect = ref.current.getBoundingClientRect()\n        const offsetX = event.clientX - rect.left\n        const offsetY = event.clientY - rect.top\n        const px = region.reversed ? width - offsetX : offsetX\n        const clientBp = region.start + bpPerPx * px\n        const search = flatbush2.search(\n          offsetX,\n          offsetY,\n          offsetX + 1,\n          offsetY + 1,\n        )\n        const item = search.length ? items[search[0]!] : undefined\n        setItemUnderMouse(item)\n        const featureId = displayModel.getFeatureOverlapping(\n          blockKey,\n          clientBp,\n          offsetY,\n        )\n        const featureName = featureId ? featureNames[featureId] : undefined\n        setFeatureNameUnderMouse(featureName)\n        setMousePosition(\n          item || featureName\n            ? {\n                x: event.clientX,\n                y: event.clientY,\n              }\n            : undefined,\n        )\n        displayModel.setFeatureIdUnderMouse(featureId)\n      }}\n      onClick={() => {\n        if (!movedDuringLastMouseDown) {\n          if (itemUnderMouse) {\n            const session = getSession(displayModel)\n            const view = getContainingView(displayModel)\n            const sourceRead = featureIdUnderMouse\n              ? featureNames[featureIdUnderMouse]\n              : undefined\n            const featureData = flatbushItemToFeatureData(\n              itemUnderMouse,\n              refName,\n              sourceRead,\n            )\n            if (isSessionModelWithWidgets(session)) {\n              const featureWidget = session.addWidget(\n                'BaseFeatureWidget',\n                'baseFeature',\n                {\n                  featureData,\n                  view,\n                  track: getContainingTrack(displayModel),\n                },\n              )\n              session.showWidget(featureWidget)\n            }\n          } else if (featureIdUnderMouse) {\n            displayModel\n              .selectFeatureById(featureIdUnderMouse)\n              .catch((e: unknown) => {\n                console.error(e)\n                getSession(displayModel).notifyError(`${e}`, e)\n              })\n          }\n        }\n      }}\n      onContextMenu={event => {\n        if (itemUnderMouse) {\n          event.preventDefault()\n          setContextMenuAnchor({\n            mouseX: event.clientX,\n            mouseY: event.clientY,\n            item: itemUnderMouse,\n          })\n        } else if (featureIdUnderMouse) {\n          displayModel\n            .setContextMenuFeatureById(featureIdUnderMouse)\n            .catch((e: unknown) => {\n              console.error(e)\n              getSession(displayModel).notifyError(`${e}`, e)\n            })\n        } else {\n          displayModel.setContextMenuFeature(undefined)\n          displayModel.clearFeatureSelection()\n        }\n      }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{\n          position: 'absolute',\n          left: 0,\n          top: 0,\n        }}\n      />\n      {highlight ? (\n        <div\n          style={{\n            position: 'absolute',\n            backgroundColor: '#0003',\n            pointerEvents: 'none',\n            ...highlight,\n          }}\n        />\n      ) : null}\n      {selected ? (\n        <div\n          style={{\n            position: 'absolute',\n            border: '2px solid #00b8ff',\n            boxSizing: 'content-box',\n            pointerEvents: 'none',\n            ...selected,\n          }}\n        />\n      ) : null}\n      {(itemUnderMouse || featureNameUnderMouse) &&\n      mousePosition &&\n      !contextMenuAnchor ? (\n        <PileupTooltip\n          item={itemUnderMouse}\n          featureName={featureNameUnderMouse}\n          refName={refName}\n          mousePosition={mousePosition}\n        />\n      ) : null}\n      <Menu\n        open={contextMenuAnchor !== null}\n        onClose={() => {\n          setContextMenuAnchor(null)\n        }}\n        anchorReference=\"anchorPosition\"\n        anchorPosition={\n          contextMenuAnchor\n            ? { top: contextMenuAnchor.mouseY, left: contextMenuAnchor.mouseX }\n            : undefined\n        }\n      >\n        <MenuItem\n          onClick={() => {\n            if (contextMenuAnchor) {\n              const session = getSession(displayModel)\n              const view = getContainingView(displayModel)\n              const sourceRead = featureIdUnderMouse\n                ? featureNames[featureIdUnderMouse]\n                : undefined\n              const featureData = flatbushItemToFeatureData(\n                contextMenuAnchor.item,\n                refName,\n                sourceRead,\n              )\n              if (isSessionModelWithWidgets(session)) {\n                const featureWidget = session.addWidget(\n                  'BaseFeatureWidget',\n                  'baseFeature',\n                  {\n                    featureData,\n                    view,\n                    track: getContainingTrack(displayModel),\n                  },\n                )\n                session.showWidget(featureWidget)\n              }\n            }\n            setContextMenuAnchor(null)\n          }}\n        >\n          Show details\n        </MenuItem>\n        {contextMenuAnchor?.item.type === 'mismatch' ? (\n          <MenuItem\n            onClick={() => {\n              const { item } = contextMenuAnchor\n              // @ts-expect-error setSortedByAtPosition is added to the pileup model\n              displayModel.setSortedByAtPosition?.(\n                'Base pair',\n                item.start,\n                refName,\n              )\n              setContextMenuAnchor(null)\n            }}\n          >\n            Sort by base pair\n          </MenuItem>\n        ) : null}\n      </Menu>\n    </div>\n  )\n})\n\nexport default PileupRendering\n","import type {\n  ColorBy,\n  ModificationTypeWithColor,\n  SortedBy,\n} from '../shared/types.ts'\nimport type { RenderArgsDeserialized as BoxRenderArgsDeserialized } from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { BaseLayout } from '@jbrowse/core/util/layouts/BaseLayout'\n\nexport interface LayoutFeature {\n  heightPx: number\n  topPx: number\n  feature: Feature\n}\n\nexport type FlatbushItem =\n  | { type: 'mismatch'; base: string; start: number }\n  | { type: 'insertion'; length: number; sequence?: string; start: number }\n  | { type: 'deletion'; length: number; start: number }\n  | { type: 'softclip'; length: number; start: number }\n  | { type: 'hardclip'; length: number; start: number }\n  | {\n      type: 'modification'\n      info: string\n      modType: string\n      probability: number\n      start: number\n      mismatch?: string\n    }\n\nconst LARGE_INSERTION_THRESHOLD = 10\n\nexport function getFlatbushItemLabel(item: FlatbushItem): string {\n  switch (item.type) {\n    case 'insertion':\n      // If we have the actual sequence and it's small enough, show it\n      if (item.sequence && item.sequence.length <= LARGE_INSERTION_THRESHOLD) {\n        return `Insertion: ${item.sequence}`\n      }\n      // Otherwise just show the length\n      return `Insertion: ${item.length}bp`\n    case 'deletion':\n      return `Deletion: ${item.length}bp`\n    case 'softclip':\n      return `Soft clip: ${item.length}bp`\n    case 'hardclip':\n      return `Hard clip: ${item.length}bp`\n    case 'modification': {\n      const mismatchInfo = item.mismatch ? `\\nMismatch: ${item.mismatch}` : ''\n      return item.info + mismatchInfo\n    }\n    case 'mismatch':\n      return `Mismatch: ${item.base}`\n  }\n}\n\nexport function flatbushItemToFeatureData(\n  item: FlatbushItem,\n  refName: string,\n  sourceRead?: string,\n): Record<string, unknown> {\n  const base = {\n    uniqueId: `${item.type}-${item.start}`,\n    type: item.type,\n    refName,\n    sourceRead,\n  }\n  switch (item.type) {\n    case 'insertion':\n      return {\n        ...base,\n        start: item.start,\n        end: item.start + 1,\n        ...(item.sequence ? { sequence: item.sequence } : {}),\n        insertionLength: item.length,\n      }\n    case 'deletion':\n      return {\n        ...base,\n        start: item.start,\n        end: item.start + item.length,\n      }\n    case 'softclip':\n    case 'hardclip':\n      return {\n        ...base,\n        start: item.start,\n        end: item.start + 1,\n        clipLength: item.length,\n      }\n    case 'modification':\n      return {\n        ...base,\n        start: item.start,\n        end: item.start + 1,\n        info: item.info,\n        modType: item.modType,\n        probability: item.probability.toFixed(3),\n        ...(item.mismatch ? { mismatch: item.mismatch } : {}),\n      }\n    case 'mismatch':\n      return {\n        ...base,\n        start: item.start,\n        end: item.start + 1,\n        base: item.base,\n      }\n  }\n}\n\nexport interface RenderArgsDeserialized extends BoxRenderArgsDeserialized {\n  colorBy?: ColorBy\n  colorTagMap?: Record<string, string>\n  visibleModifications?: Record<string, ModificationTypeWithColor>\n  sortedBy?: SortedBy\n  showSoftClip: boolean\n  highResolutionScaling: number\n  statusCallback?: (arg: string) => void\n}\n\nexport interface ProcessedRenderArgs extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n  regionSequence: string | undefined\n}\n\nexport interface PreProcessedRenderArgs extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n}\n"],"names":["PileupTooltip","t0","$","_c","item","featureName","refName","mousePosition","t1","y","t2","t3","t4","t5","t6","x","_jsx","children","_jsxs","_Fragment","style","whiteSpace","getFlatbushItemLabel","toLocale","start","BaseTooltip","placement","clientPoint","makeRect","r","offset","region","bpPerPx","leftBp","topPx","rightBp","bottomPx","leftPx","reversed","end","rightPx","left","top","Math","round","width","height","observer","props","blockKey","displayModel","regions","sortedBy","colorBy","filterBy","flatbush","items","featureNames","flatbush2","useMemo","Flatbush","from","selectedFeatureId","featureIdUnderMouse","contextMenuFeature","ref","useRef","mouseIsDown","setMouseIsDown","useState","movedDuringLastMouseDown","setMovedDuringLastMouseDown","itemUnderMouse","setItemUnderMouse","featureNameUnderMouse","setFeatureNameUnderMouse","setMousePosition","contextMenuAnchor","setContextMenuAnchor","selectedRect","getFeatureByID","undefined","highlightedFeature","id","highlightedRect","selected","highlight","canvasWidth","ceil","isClickable","type","tag","tagFilter","filter","f","join","position","cursor","onMouseLeave","setFeatureIdUnderMouse","onMouseDown","_event","onMouseUp","onMouseMove","event","current","rect","getBoundingClientRect","offsetX","clientX","offsetY","clientY","px","clientBp","search","length","featureId","getFeatureOverlapping","onClick","session","getSession","view","getContainingView","sourceRead","featureData","flatbushItemToFeatureData","isSessionModelWithWidgets","featureWidget","addWidget","track","getContainingTrack","showWidget","selectFeatureById","catch","e","console","error","notifyError","onContextMenu","preventDefault","mouseX","mouseY","setContextMenuFeatureById","setContextMenuFeature","clearFeatureSelection","PrerenderedCanvas","backgroundColor","pointerEvents","border","boxSizing","Menu","open","onClose","anchorReference","anchorPosition","MenuItem","setSortedByAtPosition","sequence","mismatchInfo","mismatch","info","base","uniqueId","insertionLength","clipLength","modType","probability","toFixed"],"sourceRoot":""}