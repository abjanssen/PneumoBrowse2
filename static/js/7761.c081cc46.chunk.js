"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7761],{13677(e,t,s){s.d(t,{E:()=>a});var l=s(14157),n=s(19598),o=s(80921);function a(e,t,s,a,c,i,f,r,h=!0,u=1){const p=+e[f],g=p?void 0!==r?`hsl(${+r%255}, 50%, 50%)`||o.lh:l.set1[p-1]||o.lh:h?o.Us:void 0;return g&&(t.fillStyle=1!==u?(0,n.M)(g).alpha(u).toHex():g,t.fillRect(s-o.f2,a-o.f2,c+o.f2,i+o.f2)),g}},27761(e,t,s){s.d(t,{makeImageData:()=>f});var l=s(77251),n=s(52901),o=s(80921),a=s(61494),c=s(13677),i=s(95067);async function f({ctx:e,canvasWidth:t,canvasHeight:s,renderArgs:f}){const{renderingMode:r,minorAlleleFrequencyFilter:h,sources:u,features:p,stopToken:g,lengthCutoffFilter:d,rowHeight:m,scrollTop:T,statusCallback:w=()=>{}}=f,b=m,C=Math.floor(T/b),k=Math.min(u.length,Math.ceil((T+s)/b)),v=(0,n.jL)(g),y=new Map,R={},M=await(0,l.updateStatus)("Calculating stats",w,()=>(0,i.Cg)({lastCheck:v,features:p.values(),minorAlleleFrequencyFilter:h,lengthCutoffFilter:d,genotypesCache:y,splitCache:R})),P={ctx:e,sources:u,startRow:C,endRow:k,h:b,w:t/M.length,scrollTop:T,splitCache:R,colorCache:{},genotypesCache:y,stopToken:g},F=await(0,l.updateStatus)("Drawing variant matrix",w,()=>"phased"===r?function(e,t){const{ctx:s,sources:l,startRow:a,endRow:i,h:f,w:r,scrollTop:h,splitCache:u,genotypesCache:p,stopToken:g}=e,d=[],m=(0,n.jL)(g);for(let e=0,g=t.length;e<g;e++){const{feature:g}=t[e],T=[],w=g.get("FORMAT")?.includes("PS"),b=e*r;if(w){const e=g.get("samples");for(let t=a;t<i;t++){const n=t*f-h,a=l[t],{name:i,HP:p,baseName:g}=a,d=e[g??i];if(d){const e=d.GT?.[0];if(e)if(T.push(e),e.includes("|")){const t=d.PS?.[0],l=u[e]??(u[e]=e.split("|"));(0,c.E)(l,s,b,n,r,f,p,t)}else s.fillStyle="black",s.fillRect(b-o.f2,n-o.f2,r+o.f2,f+o.f2)}}}else{const e=g.id();let t=p.get(e);t||(t=g.get("genotypes"),p.set(e,t));for(let e=a;e<i;e++){const n=e*f-h,a=l[e],{name:i,HP:p,baseName:g}=a,d=t[g??i];if(d)if(T.push(d),d.includes("|")){const e=u[d]??(u[d]=d.split("|"));(0,c.E)(e,s,b,n,r,f,p)}else s.fillStyle="black",s.fillRect(b-o.f2,n-o.f2,r+o.f2,f+o.f2)}}d.push(T),(0,n.As)(m)}return d}(P,M):function(e,t){const{ctx:s,sources:l,startRow:o,endRow:c,h:i,w:f,scrollTop:r,splitCache:h,stopToken:u,colorCache:p,genotypesCache:g}=e,d=[],m=(0,n.jL)(u);for(let e=0,u=t.length;e<u;e++){const{feature:u,mostFrequentAlt:T}=t[e],w=[],b=u.get("FORMAT")?.includes("PS"),C=e*f;if(b){const e=u.get("samples");for(let t=o;t<c;t++){const n=t*i-r,o=l[t],c=e[o.baseName??o.name];if(c){const e=c.GT?.[0];if(e){w.push(e);const t=(0,a.Bs)(e,T,p,h,!0);t&&(0,a.KP)(t,s,C,n,f,i)}}}}else{const e=u.id();let t=g.get(e);t||(t=u.get("genotypes"),g.set(e,t));for(let e=o;e<c;e++){const n=e*i-r,o=l[e],c=t[o.baseName??o.name];if(c){w.push(c);const e=(0,a.Bs)(c,T,p,h,!0);e&&(0,a.KP)(e,s,C,n,f,i)}}}d.push(w),(0,n.As)(m)}return d}(P,M)),x=M.map(({feature:e})=>({alt:e.get("ALT"),ref:e.get("REF"),name:e.get("name"),description:e.get("description"),length:e.get("end")-e.get("start")}));return{mafs:M,arr:F,featureData:x}}},61494(e,t,s){s.d(t,{Bs:()=>o,KP:()=>a});var l=s(19598),n=s(80921);function o(e,t,s,o,a){const c=`${e}:${t}`;let i=s[c];if(void 0===i){let f=0,r=0,h=0,u=0;const p=o[e]??(o[e]=e.split(/[/|]/)),g=p.length;for(let e=0;e<g;e++){const s=p[e];s===t?f++:"0"===s?u++:"."===s?r++:h++}i=function(e,t,s,o,a,c=!0){if(e===a)return c?n.Us:"";if(!(t||s||o))return"";let i;if(t){const e=80-t/a*50;i=(0,l.M)(`hsl(${n.Lp},${n.V4}%,${e}%)`)}if(s){const e=`hsla(0,100%,20%,${s/a})`;i=i?i.mix(e):(0,l.M)(e)}if(o){const e=o/a,t=n.FX.replace(")",`,${e})`).replace("hsl","hsla");i=i?i.mix(t):(0,l.M)(t)}return i?.toHex()||"black"}(u,f,h,r,g,a),s[c]=i}return i}function a(e,t,s,o,a,c,i="",f,r=1){t.fillStyle=1!==r?(0,l.M)(e).alpha(r).toHex():e,"inversion"===i?1===f?(t.beginPath(),t.moveTo(s-n.f2,o-n.f2),t.lineTo(s-n.f2,o+c+n.f2),t.lineTo(s+a+n.f2,o+c/2),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(s+a+n.f2,o-n.f2),t.lineTo(s+a+n.f2,o+c+n.f2),t.lineTo(s-n.f2,o+c/2),t.closePath(),t.fill()):t.fillRect(s-n.f2,o-n.f2,a+n.f2,c+n.f2)}}}]);
//# sourceMappingURL=7761.c081cc46.chunk.js.map