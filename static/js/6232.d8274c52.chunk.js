"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6232],{76232(e,t,n){n.r(t),n.d(t,{default:()=>F});var s=n(51049),r=n(35864),o=n(23886),i=n(46625),l=n(69566),a=n(30128),c=n(72242),d=n(53458),m=n(78566),h=n(95066),g=n(66143),x=n(59962),u=n(53483),p=n(62610),j=n(68325),f=n(88216),b=n(59705),v=n(71348),A=n(44460);const k=(0,i.n)()(e=>({controls:{position:"absolute",borderRight:`1px solid ${e.palette.divider}`,borderBottom:`1px solid ${e.palette.divider}`,left:0,top:0}})),y=(0,l.observer)(function({model:e}){const{classes:t}=k(),[n,s]=(0,a.useState)(null);return(0,A.jsxs)("div",{className:t.controls,children:[(0,A.jsx)(b.A,{onClick:e.zoomOutButton,title:e.lockedFitToWindow?"unlock to zoom out":"zoom out",disabled:e.atMaxBpPerPx||e.lockedFitToWindow,children:(0,A.jsx)(f.A,{})}),(0,A.jsx)(b.A,{onClick:e.zoomInButton,disabled:e.atMinBpPerPx,title:"zoom in",children:(0,A.jsx)(j.A,{})}),(0,A.jsx)(b.A,{onClick:e.rotateCounterClockwiseButton,title:"rotate counter-clockwise",children:(0,A.jsx)(u.A,{})}),(0,A.jsx)(b.A,{onClick:e.rotateClockwiseButton,title:"rotate clockwise",children:(0,A.jsx)(p.A,{})}),(0,A.jsx)(b.A,{onClick:e.toggleFitToWindowLock,title:e.lockedFitToWindow?"locked model to window size":"unlocked model to zoom further",disabled:e.tooSmallToLock,children:e.lockedFitToWindow?(0,A.jsx)(m.A,{}):(0,A.jsx)(h.A,{})}),(0,A.jsx)(b.A,{onClick:e=>{s(e.currentTarget)},children:(0,A.jsx)(g.A,{})}),e.hideTrackSelectorButton?null:(0,A.jsx)(b.A,{onClick:e.activateTrackSelector,title:"Open track selector","data-testid":"circular_track_select",children:(0,A.jsx)(c.xU,{})}),n?(0,A.jsx)(d.A,{anchorEl:n,menuItems:[{label:"Export SVG",icon:x.A,onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[v.default,{model:e,handleClose:t}])}}],onMenuItemClick:(e,t)=>{t(),s(null)},open:Boolean(n),onClose:()=>{s(null)}}):null]})});var C=n(62088),w=n(27305),S=n(21988),T=n(49186),P=n(35703);const z=(0,i.n)()(e=>({importFormContainer:{padding:e.spacing(6)}})),N=(0,l.observer)(function({model:e}){const{classes:t}=z(),n=(0,o.getSession)(e),{error:s}=e,{assemblyNames:r,assemblyManager:i}=n,[l,c]=(0,a.useState)(r[0]),d=i.get(l),m=r.length?d?.error:"No configured assemblies",h=d?.regions||[],g=m||s;return(0,A.jsxs)(S.A,{className:t.importFormContainer,children:[g?(0,A.jsx)(T.A,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:(0,A.jsx)(C.A,{error:g})}):null,(0,A.jsxs)(T.A,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,A.jsx)(w.A,{onChange:t=>{e.setError(void 0),c(t)},session:n,selected:l}),(0,A.jsx)(P.A,{disabled:!h.length,onClick:()=>{e.setError(void 0),e.setDisplayedRegions(h)},variant:"contained",color:"primary",children:h.length||g?"Open":"Loading..."})]})]})});var $=n(23592);const L=(0,i.n)()(e=>({root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},scroller:{overflow:"auto"}})),R=(0,l.observer)(function({model:e}){return(0,A.jsxs)(A.Fragment,{children:[e.staticSlices.map(t=>(0,A.jsx)($.A,{model:e,slice:t},(0,o.assembleLocString)(t.region.elided?t.region.regions[0]:t.region))),e.tracks.map(t=>{const n=t.displays[0];return(0,A.jsx)(n.RenderingComponent,{display:n,view:e},n.id)})]})}),W=(0,l.observer)(function({model:e}){const{showLoading:t,showView:n,showImportForm:r,loadingMessage:o}=e;return t?(0,A.jsx)(s.A,{variant:"h6",message:o}):r?(0,A.jsx)(N,{model:e}):n?(0,A.jsx)(B,{model:e}):null}),B=(0,l.observer)(function({model:e}){const{width:t,height:n,id:s,offsetRadians:o,centerXY:i,figureWidth:l,figureHeight:a,hideVerticalResizeHandle:c}=e,{classes:d}=L();return(0,A.jsxs)("div",{className:d.root,style:{width:t,height:n},"data-testid":s,children:[(0,A.jsx)("div",{className:d.scroller,style:{width:t,height:n},children:(0,A.jsx)("svg",{style:{transform:`rotate(${o}rad)`,transition:"transform 0.5s",transformOrigin:i.map(e=>`${e}px`).join(" "),position:"absolute",left:0,top:0},width:l,height:a,children:(0,A.jsx)("g",{transform:`translate(${i})`,children:(0,A.jsx)(R,{model:e})})})}),(0,A.jsx)(y,{model:e}),c?null:(0,A.jsx)(r.A,{onDrag:e.resizeHeight,style:{height:3,position:"absolute",bottom:0,left:0,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}})]})}),F=W},71348(e,t,n){n.r(t),n.d(t,{default:()=>y});var s=n(55614),r=n(30128),o=n(28910),i=n(62088),l=n(23886),a=n(88263),c=n(54825),d=n(23149),m=n(63209),h=n(31961),g=n(78125),x=n(79291),u=n(78921),p=n(42700),j=n(44641),f=n(35703),b=n(44460);function v(e){const t=(0,s.c)(5),{format:n}=e;let r,o,i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,b.jsx)(a.A,{size:20,style:{marginRight:20}}),t[0]=r):r=t[0],t[1]!==n?(o=n.toUpperCase(),t[1]=n,t[2]=o):o=t[2],t[3]!==o?(i=(0,b.jsxs)("div",{children:[r,(0,b.jsxs)(c.A,{display:"inline",children:["Creating ",o]})]}),t[3]=o,t[4]=i):i=t[4],i}function A(e){const t=(0,s.c)(6);let n,r,o;return t[0]!==e?(({children:n,...r}=e),t[0]=e,t[1]=n,t[2]=r):(n=t[1],r=t[2]),t[3]!==n||t[4]!==r?(o=(0,b.jsx)("div",{children:(0,b.jsx)(d.A,{...r,children:n})}),t[3]=n,t[4]=r,t[5]=o):o=t[5],o}function k(e,t){return(0,l.useLocalStorage)(`svg-${e}`,t)}function y({model:e,handleClose:t}){const n=(0,l.getSession)(e),s="undefined"!=typeof OffscreenCanvas,[a,y]=(0,r.useState)(s),[C,w]=(0,r.useState)(!1),[S,T]=(0,r.useState)(),[P,z]=k("format","svg"),[N,$]=k("file","jbrowse.svg"),[L,R]=k("theme",n.themeName||"default");return(0,b.jsxs)(o.A,{open:!0,onClose:t,title:"Export image",children:[(0,b.jsxs)(m.A,{children:[S?(0,b.jsx)(i.A,{error:S}):C?(0,b.jsx)(v,{format:P}):null,(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,b.jsx)(d.A,{helperText:"filename",value:N,onChange:e=>{$(e.target.value)}}),(0,b.jsxs)(h.A,{value:P,exclusive:!0,onChange:(e,t)=>{t&&(z(t),N.endsWith(".svg")&&"png"===t?$(N.replace(/\.svg$/,".png")):N.endsWith(".png")&&"svg"===t&&$(N.replace(/\.png$/,".svg")))},size:"small",children:[(0,b.jsx)(g.A,{value:"svg",children:"SVG"}),(0,b.jsx)(g.A,{value:"png",children:"PNG"})]})]}),n.allThemes?(0,b.jsx)(A,{select:!0,label:"Theme",value:L,onChange:e=>{R(e.target.value)},children:Object.entries(n.allThemes()).map(([e,t])=>(0,b.jsx)(x.A,{value:e,children:t.name||"(Unknown name)"},e))}):null,s?(0,b.jsx)(u.A,{control:(0,b.jsx)(p.A,{checked:a,onChange:()=>{y(e=>!e)}}),label:"Rasterize canvas based tracks? File may be much larger if this is turned off"}):(0,b.jsx)(c.A,{children:"Note: rasterizing layers not yet supported in this browser, so SVG size may be large"})]}),(0,b.jsxs)(j.A,{children:[(0,b.jsx)(f.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"}),(0,b.jsx)(f.A,{variant:"contained",color:"primary",type:"submit",onClick:async()=>{w(!0),T(void 0);try{await e.exportSvg({rasterizeLayers:a,format:P,filename:N,themeName:L}),t()}catch(e){console.error(e),T(e)}finally{w(!1)}},children:"Submit"})]})]})}},23592(e,t,n){n.d(t,{A:()=>x});var s=n(23886),r=n(18846),o=n(46625),i=n(87377),l=n(69566),a=n(44460);const c=(0,o.n)()({rulerLabel:{fontSize:"0.8rem",fontWeight:500,lineHeight:1.6,letterSpacing:"0.0075em"}});function d(e,t,n,s){e.flipped&&([n,s]=[s,n]);const r=e.bpToXY(n,t),o=e.bpToXY(s,t);return["M",...r,"A",t,t,"0",Math.abs(s-n)/e.bpPerRadian>Math.PI?"1":"0","1",...o].join(" ")}const m=(0,l.observer)(function({model:e,slice:t,region:n}){const r=(0,i.A)(),{radiusPx:o}=e,l=o+1,{endRadians:c,startRadians:d}=t,m=(0,s.polarToCartesian)(l,d),g=(0,s.polarToCartesian)(l,c),x=(c-d)*l,u=c-d>Math.PI?"1":"0",p=(c+d)/2,j=`[${(0,s.toLocale)(n.regions.length)}]`;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h,{text:j,view:e,maxWidthPx:x,radians:p,radiusPx:l,title:`${j} more regions`,color:r.palette.text.primary}),(0,a.jsx)("path",{d:["M",...m,"A",l,l,"0",u,"1",...g].join(" "),...(0,s.getStrokeProps)(r.palette.text.secondary),strokeWidth:2,strokeDasharray:"2,2",fill:"none"})]})}),h=(0,l.observer)(function({view:e,text:t,maxWidthPx:n,radians:r,radiusPx:o,title:i,color:l}){const{classes:d}=c(),m=(0,s.polarToCartesian)(o+5,r);return t?6.5*t.length<n?(0,a.jsxs)("text",{x:0,y:0,className:d.rulerLabel,textAnchor:"middle",dominantBaseline:"middle",transform:`translate(${m}) rotate(${(0,s.radToDeg)(r)+90})`,...(0,s.getFillProps)(l),children:[t,(0,a.jsx)("title",{children:i||t})]}):n>4?(0,s.radToDeg)(r+e.offsetRadians-Math.PI/2)>=180?(0,a.jsxs)("text",{x:0,y:0,className:d.rulerLabel,textAnchor:"start",dominantBaseline:"middle",transform:`translate(${m}) rotate(${(0,s.radToDeg)(r)})`,fill:l,children:[t,(0,a.jsx)("title",{children:i||t})]}):(0,a.jsxs)("text",{x:0,y:0,className:d.rulerLabel,textAnchor:"end",dominantBaseline:"middle",transform:`translate(${m}) rotate(${(0,s.radToDeg)(r)+180})`,fill:l,children:[t,(0,a.jsx)("title",{children:i||t})]}):null:null}),g=(0,l.observer)(function({model:e,slice:t,region:n}){const o=(0,i.A)(),{radiusPx:l}=e,{endRadians:c,startRadians:m}=t,g=(c+m)/2,x=(c-m)*l,u=(0,s.getSession)(e).assemblyManager.get(n.assemblyName);let p=u?u.getRefNameColor(n.refName):void 0;if(p)try{p=(0,r.makeContrasting)(p,o.palette.background.paper)}catch(e){p=o.palette.text.primary}else p=o.palette.text.primary;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h,{text:n.refName,view:e,maxWidthPx:x,radians:g,radiusPx:l,color:p}),(0,a.jsx)("path",{d:d(t,l+1,n.start,n.end),stroke:p,strokeWidth:2,fill:"none"})]})}),x=(0,l.observer)(function({model:e,slice:t}){return t.region.elided?(0,a.jsx)(m,{model:e,region:t.region,slice:t},(0,s.assembleLocString)(t.region.regions[0])):(0,a.jsx)(g,{region:t.region,model:e,slice:t},(0,s.assembleLocString)(t.region))})}}]);
//# sourceMappingURL=6232.d8274c52.chunk.js.map