{"version":3,"file":"static/js/3030.ba6b173b.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../packages/product-core/src/Session/Connections.ts","webpack://@jbrowse/web/../../plugins/data-management/src/AddConnectionWidget/components/ConfigureConnection.tsx","webpack://@jbrowse/web/../../plugins/data-management/src/AddConnectionWidget/components/ConnectionTypeSelect.tsx","webpack://@jbrowse/web/../../plugins/data-management/src/AddConnectionWidget/components/AddConnectionWidget.tsx"],"sourcesContent":["import { readConfObject } from '@jbrowse/core/configuration'\nimport { types } from '@jbrowse/mobx-state-tree'\n\nimport { isBaseSession } from './BaseSession.ts'\n\nimport type { SessionWithReferenceManagementType } from './ReferenceManagement.ts'\nimport type { BaseRootModelType } from '../RootModel/BaseRootModel.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel ConnectionManagementSessionMixin\n */\nexport function ConnectionManagementSessionMixin(pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      connectionInstances: types.array(\n        pluginManager.pluggableMstType('connection', 'stateModel'),\n      ),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get connections(): BaseConnectionConfigModel[] {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.connections\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      makeConnection(\n        configuration: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const type = configuration.type as string\n        if (!type) {\n          throw new Error('track configuration has no `type` listed')\n        }\n        const name = readConfObject(configuration, 'name')\n        const connectionType = pluginManager.getConnectionType(type)\n        if (!connectionType) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connectionInstances.push({\n          ...initialSnapshot,\n          name,\n          type,\n          configuration,\n        })\n        return self.connectionInstances[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      prepareToBreakConnection(configuration: AnyConfigurationModel) {\n        const root = self as typeof self &\n          Instance<SessionWithReferenceManagementType>\n        const callbacksToDeref: (() => void)[] = []\n        const derefTypeCount: Record<string, number> = {}\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          return undefined\n        }\n        for (const track of connection.tracks) {\n          const ref = root.getReferring(track)\n          root.removeReferring(ref, track, callbacksToDeref, derefTypeCount)\n        }\n        return [\n          () => {\n            for (const cb of callbacksToDeref) {\n              cb()\n            }\n            this.breakConnection(configuration)\n          },\n          derefTypeCount,\n        ]\n      },\n\n      /**\n       * #action\n       */\n      breakConnection(configuration: AnyConfigurationModel) {\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          throw new Error(`no connection found with name ${name}`)\n        }\n        self.connectionInstances.remove(connection)\n      },\n\n      /**\n       * #action\n       */\n      deleteConnection(configuration: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.deleteConnectionConf(configuration)\n      },\n\n      /**\n       * #action\n       */\n      addConnectionConf(connectionConf: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.addConnectionConf(connectionConf)\n      },\n\n      /**\n       * #action\n       */\n      clearConnections() {\n        self.connectionInstances.clear()\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      // mst types wrong, nullish needed\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { connectionInstances, ...rest } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        // mst types wrong, nullish needed\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        ...(connectionInstances?.length ? { connectionInstances } : {}),\n      } as typeof snap\n    })\n}\n\n/** Session mixin MST type for a session that has connections */\nexport type SessionWithConnectionsType = ReturnType<\n  typeof ConnectionManagementSessionMixin\n>\n\n/** Instance of a session that has connections: `connectionInstances`,\n * `makeConnection()`, etc. */\nexport type SessionWithConnections = Instance<SessionWithConnectionsType>\n\n/** Type guard for SessionWithConnections */\nexport function isSessionWithConnections(\n  session: IAnyStateTreeNode,\n): session is SessionWithConnections {\n  return isBaseSession(session) && 'connectionInstances' in session\n}\n","import { Suspense } from 'react'\n\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { ConfigurationEditor } from '@jbrowse/plugin-config'\nimport { observer } from 'mobx-react'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nconst ConfigureConnection = observer(function ConfigureConnection({\n  connectionType,\n  model,\n  session,\n}: {\n  connectionType: ConnectionType\n  model: AnyConfigurationModel\n  session: AbstractSessionModel\n}) {\n  const ConfigEditorComponent =\n    connectionType.configEditorComponent || ConfigurationEditor\n\n  return (\n    <Suspense fallback={<LoadingEllipses />}>\n      <ConfigEditorComponent model={{ target: model }} session={session} />\n    </Suspense>\n  )\n})\n\nexport default ConfigureConnection\n","import { useEffect } from 'react'\n\nimport { ExternalLink } from '@jbrowse/core/ui'\nimport { MenuItem, TextField } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\n\nconst ConnectionTypeSelect = observer(function ConnectionTypeSelect({\n  connectionTypeChoices,\n  connectionType,\n  setConnectionType,\n}: {\n  connectionTypeChoices: ConnectionType[]\n  connectionType?: ConnectionType\n  setConnectionType: (c?: ConnectionType) => void\n}) {\n  const firstChoice = connectionTypeChoices[0]\n  useEffect(() => {\n    if (!connectionType) {\n      setConnectionType(firstChoice)\n    }\n  }, [connectionType, firstChoice, setConnectionType])\n\n  return (\n    <form autoComplete=\"off\">\n      {connectionType ? (\n        <TextField\n          value={connectionType.name}\n          label=\"connectionType\"\n          helperText={\n            connectionType.description ? (\n              <>\n                {connectionType.description}\n                {connectionType.url ? (\n                  <ExternalLink href={connectionType.url} />\n                ) : null}\n              </>\n            ) : null\n          }\n          select\n          fullWidth\n          onChange={event => {\n            setConnectionType(\n              connectionTypeChoices.find(c => c.name === event.target.value),\n            )\n          }}\n          variant=\"outlined\"\n        >\n          {connectionTypeChoices.map(c => (\n            <MenuItem key={c.name} value={c.name}>\n              {c.displayName || c.name}\n            </MenuItem>\n          ))}\n        </TextField>\n      ) : null}\n    </form>\n  )\n})\n\nexport default ConnectionTypeSelect\n","import { useMemo, useState } from 'react'\n\nimport {\n  getEnv,\n  getSession,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { isSessionWithConnections } from '@jbrowse/product-core'\nimport { Button, Step, StepContent, StepLabel, Stepper } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport ConfigureConnection from './ConfigureConnection.tsx'\nimport ConnectionTypeSelect from './ConnectionTypeSelect.tsx'\n\nimport type { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    marginTop: theme.spacing(1),\n  },\n  stepper: {\n    backgroundColor: theme.palette.background.default,\n  },\n  button: {\n    marginTop: theme.spacing(1),\n    marginRight: theme.spacing(1),\n  },\n  actionsContainer: {\n    marginBottom: theme.spacing(2),\n  },\n}))\n\nconst steps = ['Select a Connection Type', 'Configure Connection']\n\nconst AddConnectionWidget = observer(function AddConnectionWidget({\n  model,\n}: {\n  model: unknown\n}) {\n  const [connectionType, setConnectionType] = useState<ConnectionType>()\n  const [connectionId, setConnectionId] = useState<string>()\n  const [activeStep, setActiveStep] = useState(0)\n  const { classes } = useStyles()\n  const session = getSession(model)\n  const { pluginManager } = getEnv(session)\n\n  // useMemo is needed for react@18+mobx-react@9, previous code called configSchema.create directly in a setConfigModel useState hook setter but this caused infinite loop\n  const configModel = useMemo(\n    () => connectionType?.configSchema.create({ connectionId }, getEnv(model)),\n    [connectionId, connectionType, model],\n  )\n\n  return (\n    <div className={classes.root}>\n      <Stepper\n        className={classes.stepper}\n        activeStep={activeStep}\n        orientation=\"vertical\"\n      >\n        {steps.map(label => (\n          <Step key={label}>\n            <StepLabel>{label}</StepLabel>\n            <StepContent>\n              {activeStep === 0 ? (\n                <ConnectionTypeSelect\n                  connectionTypeChoices={pluginManager.getConnectionElements()}\n                  connectionType={connectionType}\n                  setConnectionType={c => {\n                    setConnectionType(c)\n                    if (!c) {\n                      return\n                    }\n                    setConnectionId(`${c.name}-${Date.now()}`)\n                  }}\n                />\n              ) : connectionType && configModel ? (\n                <ConfigureConnection\n                  connectionType={connectionType}\n                  model={configModel}\n                  session={session}\n                />\n              ) : null}\n              <div className={classes.actionsContainer}>\n                <Button\n                  disabled={activeStep === 0}\n                  onClick={() => {\n                    setActiveStep(activeStep - 1)\n                  }}\n                  className={classes.button}\n                >\n                  Back\n                </Button>\n                <Button\n                  disabled={\n                    !(\n                      (activeStep === 0 && connectionType) ||\n                      (activeStep === 1 && configModel)\n                    )\n                  }\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={() => {\n                    if (activeStep === steps.length - 1) {\n                      if (configModel && isSessionWithConnections(session)) {\n                        const conf = session.addConnectionConf(configModel)\n                        session.makeConnection(conf)\n                      } else {\n                        session.notify('No config model to add')\n                      }\n\n                      if (isSessionModelWithWidgets(session)) {\n                        session.hideWidget(model)\n                      }\n                    } else {\n                      setActiveStep(activeStep + 1)\n                    }\n                  }}\n                  className={classes.button}\n                  data-testid=\"addConnectionNext\"\n                >\n                  {activeStep === steps.length - 1 ? 'Connect' : 'Next'}\n                </Button>\n              </div>\n            </StepContent>\n          </Step>\n        ))}\n      </Stepper>\n    </div>\n  )\n})\n\nexport default AddConnectionWidget\n"],"names":["ConnectionManagementSessionMixin","pluginManager","types","model","connectionInstances","array","pluggableMstType","views","self","connections","jbrowse","actions","makeConnection","configuration","initialSnapshot","type","Error","name","readConfObject","getConnectionType","length","push","prepareToBreakConnection","root","callbacksToDeref","derefTypeCount","connection","find","c","track","tracks","ref","getReferring","removeReferring","cb","this","breakConnection","remove","deleteConnection","deleteConnectionConf","addConnectionConf","connectionConf","clearConnections","clear","postProcessSnapshot","snap","rest","isSessionWithConnections","session","isBaseSession","observer","connectionType","ConfigEditorComponent","configEditorComponent","ConfigurationEditor","_jsx","Suspense","fallback","LoadingEllipses","children","target","connectionTypeChoices","setConnectionType","firstChoice","useEffect","autoComplete","TextField","value","label","helperText","description","_jsxs","_Fragment","url","ExternalLink","href","select","fullWidth","onChange","event","variant","map","MenuItem","displayName","useStyles","makeStyles","theme","marginTop","spacing","stepper","backgroundColor","palette","background","default","button","marginRight","actionsContainer","marginBottom","steps","useState","connectionId","setConnectionId","activeStep","setActiveStep","classes","getSession","getEnv","configModel","useMemo","configSchema","create","className","Stepper","orientation","Step","StepLabel","StepContent","ConnectionTypeSelect","getConnectionElements","Date","now","ConfigureConnection","Button","disabled","onClick","color","conf","notify","isSessionModelWithWidgets","hideWidget"],"sourceRoot":""}