"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2113],{62113(e,t,o){o.d(t,{drawDotplot:()=>$});var a=o(17378),s=o(56993),r=o(92558),n=o(89147),f=o(53121),l=o(10533),c=o(153);const i="fell outside of range due to CIGAR string",d="(less than min coordinate of feature)",g="(greater than max coordinate of feature)";function h(e,t,o,a,s){const r=a.get("strand")||1;if(-1===r&&([o,t]=[t,o]),e<t-1){let e=a.get("start"),o=a.get("end");const n=a.get("refName");return-1===r&&([o,e]=[e,o]),s.push({message:`feature at (X ${n}:${e}-${o}) ${i} ${d}`,effect:"clipped the feature"}),t}if(e>o+1){const e=a.get("strand")||1,t=1===e?a.get("start"):a.get("end"),r=1===e?a.get("end"):a.get("start"),n=a.get("refName");return s.push({message:`feature at (X ${n}:${t}-${r}) ${i} ${g}`,effect:"clipped the feature"}),o}return e}function u(e,t,o,a,s){if(e<t-1){const e=a.get("mate"),{refName:o,start:r,end:n}=e;return s.push({message:`feature at (Y ${o}:${r}-${n}) ${i} ${d}`,effect:"clipped the feature"}),t}if(e>o+1){const e=a.get("mate"),{refName:t,start:r,end:n}=e;return s.push({message:`feature at (Y ${t}:${r}-${n}) ${i} ${g}`,effect:"clipped the feature"}),o}return e}const{eL:m}=c;function p(e,t){return 1===t?e:(0,f.M)(e).alpha(t).toRgbString()}async function $(e,t){const{config:o,views:f,height:c,drawCigar:i,theme:d,alpha:g=1,minAlignmentLength:$=0,colorBy:b}=t,k=(0,a.QZ)(o,"color"),w=(0,a.QZ)(o,"posColor"),y=(0,a.QZ)(o,"negColor"),B=b??(0,a.QZ)(o,"colorBy"),P=(0,a.QZ)(o,"lineWidth"),N=(0,a.QZ)(o,"thresholds"),Q=(0,a.QZ)(o,"thresholdsPalette"),v=o.color.isCallback,x=f[0],M=f[1],C=x.dynamicBlocks.contentBlocks[0]?.offsetPx,Z=M.dynamicBlocks.contentBlocks[0]?.offsetPx,T=[];e.lineWidth=P;const{bpPerPx:S}=x,{bpPerPx:I}=M,A={...(0,l.getSnapshot)(x),staticBlocks:x.staticBlocks,width:x.width},X={...(0,l.getSnapshot)(M),staticBlocks:M.staticBlocks,width:M.width},_=(0,s.createJBrowseTheme)(d),R=x.features||[];let Y,j,D;const G=new Map,L=e=>{if(!G.has(e)){const t=function(e){const t=function(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t&=t;return Math.abs(t)}(e);return r.category10[t%r.category10.length]}(e);G.set(e,p(t,g))}return G.get(e)};"strand"===B?(Y=p(w,g),j=p(y,g)):"default"!==B||v||(D=p("#f0f"===k?_.palette.text.primary:k,g));for(const t of R){const s=t.get("strand")||1,r=t.get("start"),f=t.get("end");if($>0&&Math.abs(f-r)<$)continue;const l=t.get("refName"),d=t.get("mate"),b=d.refName,k=1===s?r:f,w=1===s?f:r;let y;if("strand"===B)y=-1===s?j:Y;else if("query"===B)y=L(l);else if("default"!==B||v){let e="black";if("identity"===B){const o=t.get("identity");for(let t=0;t<N.length;t++)if(o>+N[t]){e=Q[t]||"black";break}}else"meanQueryIdentity"===B?e=`hsl(${200*t.get("meanScore")},100%,40%)`:"mappingQuality"===B?e=`hsl(${t.get("mappingQual")},100%,40%)`:"default"===B&&v&&(e=(0,a.QZ)(o,"color",{feature:t}));y=p(e,g)}else y=D;e.fillStyle=y,e.strokeStyle=y;const x=(0,n.eB)({self:A,refName:l,coord:k}),M=(0,n.eB)({self:A,refName:l,coord:w}),_=(0,n.eB)({self:X,refName:b,coord:d.start}),R=(0,n.eB)({self:X,refName:b,coord:d.end});if(void 0!==x&&void 0!==M&&void 0!==_&&void 0!==R){const o=x.offsetPx-C,a=M.offsetPx-C,r=_.offsetPx-Z,n=R.offsetPx-Z;if(Math.abs(o-a)<=4&&Math.abs(r-n)<=4)e.beginPath(),e.arc(o,c-r,P/2,0,2*Math.PI),e.fill();else{let f=o,l=r;const d=t.get("CIGAR");if(i&&d){const i=m(d);e.beginPath(),e.moveTo(f,c-l);let g=f,p=f;for(let d=0;d<i.length;d+=2){const m=+i[d],$=i[d+1];"M"===$||"="===$||"X"===$?(f+=m/S*s,l+=m/I):"D"===$||"N"===$?f+=m/S*s:"I"===$&&(l+=m/I),f=h(f,o,a,t,T),l=u(l,r,n,t,T),(Math.abs(f-g)>.5||Math.abs(l-p)>.5)&&(e.lineTo(f,c-l),g=f,p=l)}e.stroke()}else e.beginPath(),e.moveTo(o,c-r),e.lineTo(a,c-n),e.stroke()}}else T.length<=5&&(void 0===x||void 0===M?T.push({message:`feature at (X-coord: ${l}:${k}-${w}) not plotted, fell outside of range`,effect:"feature not rendered"}):T.push({message:`feature at (Y-coord: ${b}:${d.start}-${d.end}) not plotted, fell outside of range`,effect:"feature not rendered"}))}return{warnings:T}}}}]);
//# sourceMappingURL=2113.f5f2acf8.chunk.js.map