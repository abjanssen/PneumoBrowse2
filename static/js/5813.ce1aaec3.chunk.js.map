{"version":3,"file":"static/js/5813.ce1aaec3.chunk.js","mappings":"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","sources":["../../../plugins/grid-bookmark/src/GridBookmarkWidget/sessionSharing.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/dialogs/ShareBookmarksDialog.tsx"],"sourcesContent":["// duplicated from products/jbrowse-web/src/sessionSharing.ts ; could possibly be moved into a higher directory and shared between the two\nimport { aesDecrypt, aesEncrypt } from '@jbrowse/core/util'\n\nimport { toUrlSafeB64 } from './utils.ts'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      [...window.crypto.getRandomValues(new Uint8Array(length * 2))]\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replaceAll(/[+/]/g, '')\n    .slice(0, length)\n}\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: unknown,\n  url: string,\n  referer: string,\n) {\n  const sess = await toUrlSafeB64(JSON.stringify(session))\n  const password = generateUID(5)\n  const encryptedSession = await aesEncrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]!\n  const url = `${baseUrl}?sessionId=${encodeURIComponent(sessionId)}`\n  const response = await fetch(url)\n  if (!response.ok) {\n    throw new Error(getErrorMsg(await response.text()))\n  }\n\n  const json = await response.json()\n  return aesDecrypt(json.session, password)\n}\n","import { useEffect, useState } from 'react'\n\nimport { Dialog, ErrorMessage } from '@jbrowse/core/ui'\nimport { getSession, isSessionWithShareURL } from '@jbrowse/core/util'\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { getSnapshot } from '@jbrowse/mobx-state-tree'\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy'\nimport {\n  Alert,\n  Button,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { shareSessionToDynamo } from '../../sessionSharing.ts'\n\nimport type { GridBookmarkModel } from '../../model.ts'\n\nconst useStyles = makeStyles()(() => ({\n  flexItem: {\n    margin: 5,\n  },\n  content: {\n    display: 'flex',\n    flexFlow: 'column',\n    gap: '5px',\n  },\n}))\n\nconst ShareBookmarksDialog = observer(function ShareBookmarksDialog({\n  onClose,\n  model,\n}: {\n  onClose: () => void\n  model: GridBookmarkModel\n}) {\n  const { classes } = useStyles()\n  const [url, setUrl] = useState('')\n  const [error, setError] = useState<unknown>()\n  const [loading, setLoading] = useState(true)\n  const session = getSession(model)\n  const { selectedBookmarks } = model\n  const shareAll = selectedBookmarks.length === 0\n  const bookmarksToShare =\n    selectedBookmarks.length === 0\n      ? model.allBookmarksModel\n      : model.sharedBookmarksModel\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        if (!isSessionWithShareURL(session)) {\n          throw new Error('No shareURL configured')\n        }\n        setLoading(true)\n        const snap = getSnapshot(bookmarksToShare)\n        const locationUrl = new URL(window.location.href)\n        const result = await shareSessionToDynamo(\n          snap,\n          session.shareURL,\n          locationUrl.href,\n        )\n        const params = new URLSearchParams(locationUrl.search)\n        params.set('bookmarks', `share-${result.json.sessionId}`)\n        params.set('password', result.password)\n        locationUrl.search = params.toString()\n        setUrl(locationUrl.href)\n        setLoading(false)\n      } catch (e) {\n        setError(e)\n      } finally {\n        setLoading(false)\n      }\n    })()\n  }, [bookmarksToShare, session])\n  return (\n    <Dialog open onClose={onClose} title=\"Share bookmarks\">\n      <DialogContent className={classes.content}>\n        <Alert severity=\"info\">\n          {shareAll ? (\n            <>\n              <span>All bookmarks will be shared.</span>\n              <br />\n              <span>\n                Use the checkboxes to select individual bookmarks to share.\n              </span>\n            </>\n          ) : (\n            'Only selected bookmarks will be shared.'\n          )}\n        </Alert>\n        <DialogContentText>\n          Copy the URL below to share your bookmarks.\n        </DialogContentText>\n        {error ? (\n          <ErrorMessage error={error} />\n        ) : loading ? (\n          <Typography>Generating short URL...</Typography>\n        ) : (\n          <TextField\n            label=\"URL\"\n            value={url}\n            slotProps={{\n              input: {\n                readOnly: true,\n              },\n            }}\n            variant=\"filled\"\n            fullWidth\n            onClick={event => {\n              const target = event.target as HTMLTextAreaElement\n              target.select()\n            }}\n          />\n        )}\n        <DialogContentText>\n          The URL should be pasted into the \"Import from share link\" field in\n          the \"Import\" form found in the \"Bookmarked regions\" drawer.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          className={classes.flexItem}\n          data-testid=\"dialogShare\"\n          variant=\"contained\"\n          color=\"primary\"\n          disabled={loading}\n          startIcon={<ContentCopyIcon />}\n          onClick={async () => {\n            const { default: copy } = await import('copy-to-clipboard')\n            copy(url)\n            session.notify('Copied to clipboard', 'success')\n            onClose()\n          }}\n        >\n          Copy share link\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default ShareBookmarksDialog\n"],"names":["getErrorMsg","err","JSON","parse","message","e","async","shareSessionToDynamo","session","url","referer","sess","toUrlSafeB64","stringify","password","window","btoa","crypto","getRandomValues","Uint8Array","length","map","b","String","fromCharCode","join","replaceAll","slice","encryptedSession","aesEncrypt","data","FormData","append","Date","now","response","fetch","method","mode","body","ok","text","Error","json","readSessionFromDynamo","baseUrl","sessionQueryParam","sessionId","split","encodeURIComponent","aesDecrypt","useStyles","makeStyles","flexItem","margin","content","display","flexFlow","gap","observer","onClose","model","classes","setUrl","useState","error","setError","loading","setLoading","getSession","selectedBookmarks","shareAll","bookmarksToShare","allBookmarksModel","sharedBookmarksModel","useEffect","isSessionWithShareURL","snap","getSnapshot","locationUrl","URL","location","href","result","shareURL","params","URLSearchParams","search","set","toString","_jsxs","Dialog","open","title","children","DialogContent","className","_jsx","Alert","severity","_Fragment","DialogContentText","ErrorMessage","Typography","TextField","label","value","slotProps","input","readOnly","variant","fullWidth","onClick","event","target","select","DialogActions","Button","color","disabled","startIcon","ContentCopyIcon","default","copy","notify"],"ignoreList":[],"sourceRoot":""}