"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2174],{2174(e,t,o){o.r(t),o.d(t,{default:()=>d});var n=o(42918),s=o(64074),r=o(94162),i=o(98234),l=o(95766),a=o(14972),c=o(32118);const d=(0,s.observer)(function(e){const{model:t}=e,{lineZoneHeight:o,height:s}=t,d=(0,n.useRef)(null),{mouseState:h,handleMouseMove:u,handleMouseLeave:x}=(0,a.A)(d);return(0,c.jsxs)("div",{ref:d,style:{position:"relative",height:s},onMouseMove:u,onMouseLeave:x,children:[(0,c.jsx)("div",{"data-testid":"connecting-lines",children:(0,c.jsx)(r.A,{model:t})}),(0,c.jsx)(l.A,{model:t,topOffset:o,testId:"matrix-display"}),h&&h.y>o?(0,c.jsx)(i.A,{mouseX:h.x,mouseY:h.y,offsetX:h.offsetX,offsetY:h.offsetY,model:t}):null]})})},9807(e,t,o){o.d(t,{A:()=>p});var n=o(42918),s=o(77251),r=o(64074),i=o(30936),l=o(33579),a=o(15943),c=o(32118);const d=e=>{const t=(0,i.c)(11),{x:o,y:n,width:r,height:d,color:h}=e,u=(0,l.A)();let x,g,p;return t[0]!==h||t[1]!==u?(x=h||(0,a.X4)(u.palette.background.paper,.8),t[0]=h,t[1]=u,t[2]=x):x=t[2],t[3]!==x?(g=(0,s.getFillProps)(x),t[3]=x,t[4]=g):g=t[4],t[5]!==d||t[6]!==g||t[7]!==r||t[8]!==o||t[9]!==n?(p=(0,c.jsx)("rect",{pointerEvents:"auto",x:o,y:n,width:r,height:d,...g}),t[5]=d,t[6]=g,t[7]=r,t[8]=o,t[9]=n,t[10]=p):p=t[10],p},h=function(e){const t=(0,i.c)(4),{source:o,idx:n,rowHeight:s}=e,{color:r}=o;let l;return t[0]!==r||t[1]!==n||t[2]!==s?(l=r?(0,c.jsx)(d,{y:n*s,x:0,width:15.5,height:s+.5,color:r}):null,t[0]=r,t[1]=n,t[2]=s,t[3]=l):l=t[3],l},u=function(e){const t=(0,i.c)(6),{source:o,idx:n,rowHeight:s,textFillProps:r}=e,{color:l,name:a}=o,d=Math.min(s,12),h=(n+.5)*s,u=l?17:0;let x;return t[0]!==a||t[1]!==d||t[2]!==h||t[3]!==u||t[4]!==r?(x=(0,c.jsx)("text",{y:h,x:u,fontSize:d,dominantBaseline:"central",...r,children:a}),t[0]=a,t[1]=d,t[2]=h,t[3]=u,t[4]=r,t[5]=x):x=t[5],x},x=(0,r.observer)(function({model:e,labelWidth:t}){const{canDisplayLabels:o,rowHeight:r,sources:i}=e,a=(0,l.A)(),x=t+((0,n.useMemo)(()=>i?.some(e=>e.color)??!1,[i])?20:0),g=(0,n.useMemo)(()=>(0,s.getFillProps)(a.palette.text.primary),[a.palette.text.primary]);return i?(0,c.jsxs)(c.Fragment,{children:[o?(0,c.jsx)(d,{y:0,x:0,width:x,height:(i.length+.25)*r}):null,i.map((e,t)=>(0,c.jsx)(h,{source:e,idx:t,rowHeight:r},`${e.name}-${t}`)),o?i.map((e,t)=>(0,c.jsx)(u,{source:e,idx:t,rowHeight:r,textFillProps:g},`${e.name}-text-${t}`)):null]}):null}),g=(0,r.observer)(function({children:e,model:t,exportSVG:o}){const{id:n,scrollTop:r,height:i,hierarchy:l,treeAreaWidth:a,showTree:d}=t,h=`legend-${"undefined"==typeof jest?n:"test"}`,u=l&&d?a:0;return o?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("defs",{children:(0,c.jsx)("clipPath",{id:h,children:(0,c.jsx)("rect",{x:0,y:0,width:1e3,height:i})})}),(0,c.jsx)("g",{clipPath:`url(#${h})`,children:(0,c.jsx)("g",{transform:`translate(0,${-r})`,children:e})})]}):(0,c.jsx)("svg",{style:{position:"absolute",top:0,left:u,zIndex:100,pointerEvents:"none",height:t.totalHeight,width:(0,s.getContainingView)(t).width},children:e})}),p=(0,r.observer)(function(e){const{model:t}=e,{canDisplayLabels:o,rowHeight:r,sources:i}=t,l=Math.min(r,12),a=(0,n.useMemo)(()=>{if(!i)return 0;let e=0;for(const t of i){const n=o?(0,s.measureText)(t.name,l)+10:20;n>e&&(e=n)}return e},[i,l,o]);return i?(0,c.jsx)(g,{...e,children:(0,c.jsx)(x,{model:t,labelWidth:a})}):null})},14972(e,t,o){o.d(t,{A:()=>r});var n=o(30936),s=o(42918);function r(e){const t=(0,n.c)(6),o=(0,s.useRef)(void 0),[r,i]=(0,s.useState)();let l;t[0]!==e?(l=t=>{o.current&&cancelAnimationFrame(o.current);const n=t.clientX,s=t.clientY;o.current=requestAnimationFrame(()=>{const t=e.current?.getBoundingClientRect();t&&i({x:n-t.left,y:s-t.top,offsetX:t.left,offsetY:t.top})})},t[0]=e,t[1]=l):l=t[1];const a=l;let c;t[2]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{o.current&&cancelAnimationFrame(o.current),i(void 0)},t[2]=c):c=t[2];const d=c;let h;return t[3]!==a||t[4]!==r?(h={mouseState:r,handleMouseMove:a,handleMouseLeave:d},t[3]=a,t[4]=r,t[5]=h):h=t[5],h}},94162(e,t,o){o.d(t,{A:()=>y});var n=o(30936),s=o(42918),r=o(28397),i=o(50639),l=o(71547),a=o(77251),c=o(65045),d=o(15943),h=o(33579),u=o(64074),x=o(32118);const g=(0,c.n)()(e=>({resizeHandle:{height:5,boxSizing:"border-box",background:"transparent","&:hover":{background:e.palette.divider}}})),p=(0,u.observer)(function({children:e,model:t,exportSVG:o}){const{height:n}=t,{width:s,offsetPx:r}=(0,a.getContainingView)(t),i=Math.max(0,-r);return o?(0,x.jsx)("g",{transform:`translate(${i})`,children:e}):(0,x.jsx)("svg",{style:{position:"absolute",top:0,left:i,height:n,width:s},children:e})}),m=(0,u.observer)(function({model:e,exportSVG:t}){const{classes:o}=g(),{assemblyManager:n}=(0,a.getSession)(e),i=(0,a.getContainingView)(e),[l,c]=(0,s.useState)(),{lineZoneHeight:d,featuresVolatile:h}=e,{assemblyNames:u,dynamicBlocks:m}=i,f=n.get(u[0]),y=(m.contentBlocks[0]?.widthPx||0)/(h?.length||1);return f&&h?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(p,{exportSVG:t,model:e,children:[(0,x.jsx)(b,{model:e,setMouseOverLine:c}),l?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("line",{stroke:"#f00c",strokeWidth:2,style:{pointerEvents:"none"},x1:l.idx*y+y/2,x2:l.c,y1:d,y2:0,onMouseLeave:()=>{c(void 0)}}),(0,x.jsx)(v,{contents:l.f.get("name")})]}):null]}),t?null:(0,x.jsx)(r.A,{style:{position:"absolute",top:d-4},onDrag:t=>e.setLineZoneHeight(d+t),className:o.resizeHandle})]}):null}),f=(0,s.forwardRef)(function(e,t){const o=(0,n.c)(5),{message:r}=e;let l,a;return o[0]!==r?(l=(0,s.isValidElement)(r)?r:r?(0,x.jsx)(i.A,{html:String(r)}):null,o[0]=r,o[1]=l):l=o[1],o[2]!==t||o[3]!==l?(a=(0,x.jsx)("div",{ref:t,children:l}),o[2]=t,o[3]=l,o[4]=a):a=o[4],a}),v=(0,u.observer)(function({contents:e}){return e?(0,x.jsx)(l.A,{children:(0,x.jsx)(f,{message:e})}):null}),b=(0,u.observer)(function({model:e,setMouseOverLine:t}){const o=(0,h.A)(),{assemblyManager:n}=(0,a.getSession)(e),r=(0,a.getContainingView)(e),{lineZoneHeight:i,featuresVolatile:l}=e,{offsetPx:c,assemblyNames:u,dynamicBlocks:g}=r,p=n.get(u[0]),m=(g.contentBlocks[0]?.widthPx||0)/(l?.length||1),f=Math.max(c,0),v=(0,a.getStrokeProps)((0,d.X4)(o.palette.text.primary,.4));return p&&l?(0,x.jsx)(x.Fragment,{children:l.map((e,o)=>{const n=e.get("refName"),l=(r.bpToPx({refName:p.getCanonicalRefName2(n),coord:e.get("start")})?.offsetPx||0)-f;return(0,s.createElement)("line",{...v,strokeWidth:1,key:e.id(),x1:o*m+m/2,x2:l,y1:i,y2:0,onMouseEnter:()=>{t({f:e,idx:o,c:l})},onMouseLeave:()=>{t(void 0)}})})}):null}),y=m},95766(e,t,o){o.d(t,{A:()=>f});var n=o(18769),s=o(64074),r=o(9807),i=o(42918),l=o(28397),a=o(77251),c=o(57141),d=o(65045),h=o(15943),u=o(38567),x=o(32118);const g=(0,d.n)()(e=>({resizeHandle:{position:"absolute",top:0,height:"100%",width:4,zIndex:101,background:"transparent","&:hover":{background:e.palette.divider}},treeBackground:{position:"absolute",top:0,left:0,background:(0,h.X4)(e.palette.background.paper,.8)}}));function p(e){return e.children?.length?e.children.flatMap(e=>p(e)):[e.data.name]}const m=(0,s.observer)(function({model:e}){const{classes:t}=g(),{width:o}=(0,a.getContainingView)(e),[n,s]=(0,i.useState)(null),[r,d]=(0,i.useState)([]),{hierarchy:h,treeAreaWidth:m,height:f,scrollTop:v,showTree:b,sources:y}=e,w=(0,i.useCallback)(t=>{e.setTreeCanvasRef(t)},[e,m,f]),j=(0,i.useCallback)(t=>{e.setMouseoverCanvasRef(t)},[e,o,f]);(0,i.useEffect)(()=>(0,u.autorun)(function(){const{treeAreaWidth:t,hierarchy:o,totalHeight:n}=e;if(!o)return s(null),void d([]);const r=o.descendants().filter(e=>e.children?.length),i=new c.A(r.length);for(const e of r){const t=e.y,o=e.x;i.add(t-8,o-8,t+8,o+8)}i.finish(),s(i),d(r)},{name:"TreeSpatialIndex"}),[e]);const k=(0,i.useCallback)(t=>{if(!h||!n)return;const o=t.currentTarget.getBoundingClientRect(),s=t.clientX-o.left,i=t.clientY-o.top+v,l=n.search(s,i,s,i),a=l.length>0?r[l[0]]:void 0;a?e.setHoveredTreeNode({node:a,descendantNames:p(a)}):e.setHoveredTreeNode(void 0)},[h,n,r,v,e]),M=(0,i.useCallback)(()=>{e.setHoveredTreeNode(void 0)},[e]);return h&&b&&y?.length?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{style:{position:"sticky",top:0,left:0,height:0,zIndex:100},children:[(0,x.jsx)("div",{className:t.treeBackground,style:{width:m,height:f}}),(0,x.jsx)("canvas",{ref:w,width:2*m,height:2*f,style:{width:m,height:f,position:"absolute",top:0,left:0,pointerEvents:"none"}}),(0,x.jsx)("canvas",{ref:j,width:o,height:f,style:{position:"absolute",top:0,left:0,zIndex:1,pointerEvents:"none"}}),(0,x.jsx)("div",{onMouseMove:k,onMouseLeave:M,style:{position:"absolute",top:0,left:0,width:m,height:f,zIndex:2,cursor:"pointer"}})]}),(0,x.jsx)(l.A,{onDrag:t=>{e.setTreeAreaWidth(Math.max(50,m+t))},className:t.resizeHandle,style:{left:m},vertical:!0})]}):null}),f=(0,s.observer)(function({model:e,topOffset:t=0,testId:o}){const{setScrollTop:s,autoHeight:i,availableHeight:l}=e;return(0,x.jsxs)("div",{"data-testid":o,style:{position:"absolute",top:t,height:l,width:"100%",overflowY:i?"hidden":"auto",overflowX:"hidden"},onScroll:e=>{s(e.currentTarget.scrollTop)},children:[(0,x.jsx)(m,{model:e}),(0,x.jsx)(r.A,{model:e}),(0,x.jsx)("div",{style:{position:"absolute",left:0,width:"100%"},children:(0,x.jsx)(n.Ay,{model:e})})]})})},98234(e,t,o){o.d(t,{A:()=>p});var n=o(42918),s=o(77251),r=o(65045),i=o(64074),l=o(30936),a=o(15943),c=o(27309),d=o(32118);const h=(0,r.n)()(e=>({tooltip:{position:"fixed",top:0,left:0,pointerEvents:"none",backgroundColor:(0,a.X4)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.fontSize,maxWidth:300,wordWrap:"break-word",zIndex:1e5},row:{whiteSpace:"nowrap"},colorBox:{width:10,height:10,display:"inline-block",marginRight:4}})),u=new Set(["color","HP","name","baseName","id"]),x=(0,n.memo)(function(e){const t=(0,l.c)(17),{source:o,x:n,y:s}=e,{classes:r}=h(),i=r.tooltip,a=`translate(${n+10}px, ${s+10}px)`;let x,g,p,m,f;return t[0]!==a?(x={transform:a},t[0]=a,t[1]=x):x=t[1],t[2]!==r.colorBox||t[3]!==o.color?(g=o.color?(0,d.jsx)("div",{className:r.colorBox,style:{backgroundColor:o.color}}):null,t[2]=r.colorBox,t[3]=o.color,t[4]=g):g=t[4],t[5]!==r.row||t[6]!==o.name?(p=o.name?(0,d.jsx)("div",{className:r.row,children:o.name}):null,t[5]=r.row,t[6]=o.name,t[7]=p):p=t[7],t[8]!==r.row||t[9]!==o?(m=Object.entries(o).map(e=>{const[t,o]=e;return u.has(t)||void 0===o?null:(0,d.jsxs)("div",{className:r.row,children:[t,": ",String(o)]},t)}),t[8]=r.row,t[9]=o,t[10]=m):m=t[10],t[11]!==r.tooltip||t[12]!==x||t[13]!==g||t[14]!==p||t[15]!==m?(f=(0,d.jsx)(c.A,{children:(0,d.jsxs)("div",{className:i,style:x,children:[g,p,m]})}),t[11]=r.tooltip,t[12]=x,t[13]=g,t[14]=p,t[15]=m,t[16]=f):f=t[16],f}),g=(0,r.n)()(e=>({container:{position:"absolute",top:0,left:0,pointerEvents:"none",zIndex:800},horizontalLine:{position:"absolute",left:0,height:1,backgroundColor:e.palette.text.primary,pointerEvents:"none"},verticalLine:{position:"absolute",top:0,width:1,backgroundColor:e.palette.text.primary,pointerEvents:"none"}})),p=(0,i.observer)(function({mouseX:e,mouseY:t,model:o,offsetX:r,offsetY:i}){const{classes:l}=g(),{hoveredGenotype:a,height:c,sourceMap:h}=o,{width:u}=(0,s.getContainingView)(o),p=(0,n.useMemo)(()=>{if(!a)return;const e=h?.[a.name];return e?{...e,...a}:void 0},[a,h]);return(0,d.jsxs)("div",{className:l.container,style:{width:u,height:c},children:[(0,d.jsx)("div",{className:l.horizontalLine,style:{transform:`translateY(${t}px)`,width:u}}),(0,d.jsx)("div",{className:l.verticalLine,style:{transform:`translateX(${e}px)`,height:c}}),p?(0,d.jsx)(x,{source:p,x:r+e,y:i+t}):null]})})}}]);
//# sourceMappingURL=2174.553d0e1b.chunk.js.map