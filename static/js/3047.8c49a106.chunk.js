"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3047],{79610:(e,t,a)=>{a.d(t,{$2:()=>o,Eg:()=>c,WT:()=>s,f0:()=>l,mr:()=>r});var n=a(99546),i=a(30385);function r({feature:e,ctx:t,offsets:a,level:i,cb:r,height:s,drawCurves:l,oobLimit:c,viewWidth:f,hideTiny:h}){const{p11:g,p12:d,p21:m,p22:u}=e,w=g.offsetPx-a[i],p=d.offsetPx-a[i],v=m.offsetPx-a[i+1],b=u.offsetPx-a[i+1],x=Math.abs(p-w),k=Math.abs(b-v),y=s,M=(y-0)/2,C=Math.min(v,b),P=Math.max(v,b);(0,n.doesIntersect2)(C,P,-c,f+c)&&(x<=1&&k<=1?h||(t.beginPath(),t.moveTo(w,0),l?t.bezierCurveTo(w,M,v,M,v,y):t.lineTo(v,y),t.stroke()):(o(t,w,p,0,b,v,y,M,l),r(t)))}function o(e,t,a,n,i,r,o,s,l){l?function(e,t,a,n,i,r,o,s){const l=Math.abs(t-a),c=Math.abs(t-a);if(l<5&&c<5&&a<t&&Math.abs(t-i)>100){const e=t;t=a,a=e}e.beginPath(),e.moveTo(t,n),e.lineTo(a,n),e.bezierCurveTo(a,s,i,s,i,o),e.lineTo(r,o),e.bezierCurveTo(r,s,t,s,t,n),e.closePath(),e.fill()}(e,t,a,n,i,r,o,s):function(e,t,a,n,i,r,o){e.beginPath(),e.moveTo(t,n),e.lineTo(a,n),e.lineTo(i,o),e.lineTo(r,o),e.closePath(),e.fill()}(e,t,a,n,i,r,o)}function s(e,t){const a=(0,n.getContainingView)(t),r=(0,n.getContainingTrack)(t),o=t.clickMapCanvas,s=t.cigarClickMapCanvas;if(!o||!s)return;const l=o.getBoundingClientRect(),c=o.getContext("2d"),f=s.getContext("2d");if(!c||!f)return;const h=e.clientX-l.left,g=e.clientY-l.top,[d,m,u]=c.getImageData(h,g,1,1).data,w=Math.floor(i.xx/t.numFeats),p=(0,i.OX)(d,m,u,w),v=t.featPositions[p];if(v){const{f:e}=v;t.setClickId(e.id());const i=(0,n.getSession)(t);(0,n.isSessionModelWithWidgets)(i)&&i.showWidget(i.addWidget("BaseFeatureWidget","baseFeature",{view:a,track:r,featureData:e.toJSON()}))}return v}function l(e,t,a){e.preventDefault();const n=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(!n||!r)return;const o=n.getBoundingClientRect(),s=n.getContext("2d"),l=r.getContext("2d");if(!s||!l)return;const{clientX:c,clientY:f}=e,h=c-o.left,g=f-o.top,[d,m,u]=s.getImageData(h,g,1,1).data,w=Math.floor(i.xx/t.numFeats),p=(0,i.OX)(d,m,u,w),v=t.featPositions[p];v&&(t.setClickId(v.f.id()),a({clientX:c,clientY:f,feature:v}))}function c(e,t,a){const i=e.toJSON(),r=i.mate,o=i.end-i.start,s=r.end-r.start,l=i.identity,c=i.name,f=r.name;return[`Loc1: ${(0,n.assembleLocString)(i)}`,`Loc2: ${(0,n.assembleLocString)(r)}`,`Inverted: ${-1===i.strand}`,`Query len: ${o.toLocaleString("en-US")}`,`Target len: ${s.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${a}`:"",c?`Name 1: ${c}`:"",f?`Name 1: ${f}`:""].filter((e=>!!e)).join("<br/>")}},30385:(e,t,a)=>{a.d(t,{C4:()=>d,OX:()=>h,Ww:()=>g,xx:()=>o});var n=a(99546),i=a(79610),r=a(36422);const o=16581375;function s(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const l={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,f=1600;function h(e,t,a,n){return Math.floor((255*e*255+255*t+a-1)/n)}function g(e,t,a){const h=(0,n.getContainingView)(e),g=(0,r.getParent)(e,4).level,d=h.drawCurves,m=h.drawCIGAR,{height:u,featPositions:w}=e,p=h.width,v=h.views.map((e=>e.bpPerPx));a&&(a.imageSmoothingEnabled=!1),t.beginPath();const b=h.views.map((e=>e.offsetPx)),x=Math.floor(o/w.length);t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:a,p21:n,p22:i}of w){const r=e.offsetPx-b[g],o=a.offsetPx-b[g],s=n.offsetPx-b[g+1],l=i.offsetPx-b[g+1],h=Math.abs(o-r),m=Math.abs(l-s),w=0,v=u,x=(v-w)/2;h<=c&&m<=c&&s<p+f&&s>-f&&(t.moveTo(r,w),d?t.bezierCurveTo(r,x,s,x,s,v):t.lineTo(s,v))}t.stroke(),t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:r,p21:x,p22:k,f:y,cigar:M}of w){const w=e.offsetPx-b[g],C=r.offsetPx-b[g],P=x.offsetPx-b[g+1],S=k.offsetPx-b[g+1],T=Math.abs(C-w),$=Math.abs(S-P),E=Math.min(P,S),L=Math.max(P,S),R=0,z=u,I=(z-R)/2;if(!(T<=c&&$<=c)&&(0,n.doesIntersect2)(E,L,-f,h.width+f)){const e=y.get("strand"),n=-1===e?C:w,r=n<(-1===e?w:C)?1:-1,c=(P<S?1:-1)*e;let f=n,h=-1===e?S:P;if(M.length&&m){let e=!1,n=0,m=0;const u=Math.floor(o/M.length);for(let o=0;o<M.length;o+=2){const w=o*u+1,b=+M[o],x=M[o+1];e||(n=f,m=h);const k=b/v[g],y=b/v[g+1];if("M"===x||"="===x||"X"===x?(f+=k*r,h+=y*c):"D"===x||"N"===x?f+=k*r:"I"===x&&(h+=y*c),!(Math.max(n,m,f,h)<0||Math.min(n,m,f,h)>p)){const r=o<M.length-2;Math.abs(f-n)<=1&&Math.abs(h-m)<=1&&r?e=!0:(t.fillStyle=l[e&&k>1||y>1?x:"M"],e=!1,(0,i.$2)(t,n,f,R,h,m,z,I,d),a&&(a.fillStyle=s(w),(0,i.$2)(a,n,f,R,h,m,z,I,d)))}}}else(0,i.$2)(t,w,C,R,S,P,z,I,d)}}const k=e.clickMapCanvas?.getContext("2d");if(k){k.imageSmoothingEnabled=!1,k.clearRect(0,0,p,u);for(let e=0;e<w.length;e++){const t=w[e],a=e*x+1;k.fillStyle=s(a),(0,i.mr)({cb:e=>{e.fill()},feature:t,ctx:k,drawCurves:d,level:g,offsets:b,oobLimit:f,viewWidth:h.width,hideTiny:!0,height:u})}}}function d(e){const{clickId:t,mouseoverId:a}=e,o=(0,n.getContainingView)(e),s=o.drawCurves,l=e.height,c=o.width,h=e.mouseoverCanvas?.getContext("2d"),g=o.views.map((e=>e.offsetPx)),d=(0,r.getParent)(e,4).level;if(!h)return;h.resetTransform(),h.scale(1,1),h.clearRect(0,0,c,l);const m=e.featMap[a||""];m&&(h.fillStyle="rgb(0,0,0,0.1)",(0,i.mr)({cb:e=>{e.fill()},feature:m,level:d,ctx:h,oobLimit:f,viewWidth:o.width,drawCurves:s,offsets:g,height:l}));const u=e.featMap[t||""];u&&(h.strokeStyle="rgb(0, 0, 0, 0.9)",(0,i.mr)({cb:e=>{e.stroke()},feature:u,ctx:h,level:d,oobLimit:f,viewWidth:o.width,drawCurves:s,offsets:g,height:l}))}},93047:(e,t,a)=>{a.d(t,{renderToSvg:()=>w});var n=a(7552),i=a(20139),r=a(36422),o=a(42489),s=a(99546),l=a(91468),c=a(49823),f=a(20529),h=a(48231);function g({width:e,height:t,shift:a}){const i=(0,h.A)();return n.createElement("rect",{width:e+2*a,height:t,fill:(0,s.stripAlpha)(i.palette.background.default)})}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d.apply(null,arguments)}function m({trackLabelOffset:e,fontSize:t,textHeight:a,trackLabels:i,view:r,displayResults:o,rulerHeight:l,shift:c}){const g=(0,h.A)();return n.createElement("g",{transform:`translate(${c} ${t})`},n.createElement("g",{transform:`translate(${e})`},n.createElement("text",d({x:0,fontSize:t},(0,s.getFillProps)(g.palette.text.primary)),r.assemblyNames.join(", ")),n.createElement(f.$m,{model:o.view,fontSize:t})),n.createElement("g",{transform:`translate(0 ${l+t})`},n.createElement(f.zh,{textHeight:a,trackLabels:i,fontSize:t,model:o.view,displayResults:o.data,trackLabelOffset:e})))}var u=a(30385);async function w(e,t){await(0,o.when)((()=>e.initialized));const{textHeight:a=18,rulerHeight:h=30,fontSize:d=13,trackLabels:w="offset",Wrapper:p=({children:e})=>e,themeName:v="default"}=t,b=(0,s.getSession)(e),x=b.allThemes?.()[v],{width:k,views:y,levels:M}=e,C=h,{createRootFn:P}=(0,r.getRoot)(e),S=y.map((e=>(0,f.mJ)(e.tracks,a,w)+C)),T=(0,s.sum)(S)+(0,s.sum)(M.map((e=>e.height)))+100,$=await Promise.all(y.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const a=e.displays[0];return await(0,o.when)((()=>void 0===a.ready||a.ready)),{track:e,result:await a.renderSvg({...t,theme:x})}})))})))),E=await Promise.all(M.map((async e=>await Promise.all(e.tracks.map((async a=>{const n=a.displays[0];await(0,o.when)((()=>void 0===n.ready||n.ready));const i=await(0,s.renderToAbstractCanvas)(k,e.height,{exportSVG:t},(e=>{(0,u.Ww)(n,e)}));if("imageData"in i)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in i?{html:await(0,s.getSerializedSvg)({...i,width:k,height:e.height})}:i})))))),L=(0,s.max)(y.flatMap((e=>e.tracks.map((e=>(0,s.measureText)((0,l.getTrackName)(e.configuration,b),d))))),0)+40,R="left"===w?L:0,z=k+R,I=(0,c.createJBrowseTheme)(x),W=[n.createElement(m,{rulerHeight:h,trackLabelOffset:R,shift:50,textHeight:a,trackLabels:w,displayResults:$[0],key:y[0].id,view:y[0],fontSize:d})];let O=S[0]+d+h;for(let e=1;e<y.length;e++){const t=y[e],i=M[e-1],r=E[e-1],o=S[e],l=i.height||0;W.push(n.createElement("g",{key:t.id,transform:`translate(0 ${O})`},l?n.createElement("defs",null,n.createElement("clipPath",{id:`synclip-${e}`},n.createElement("rect",{x:0,y:0,width:k,height:l}))):null,n.createElement("g",{transform:`translate(${50+R} ${d})`,clipPath:`url(#synclip-${e})`},r?.map(((e,t)=>n.createElement(s.ReactRendering,{key:t,rendering:e})))),n.createElement("g",{transform:`translate(0 ${l})`},n.createElement(m,{rulerHeight:h,shift:50,trackLabelOffset:R,textHeight:a,trackLabels:w,displayResults:$[e],key:t.id,view:t,fontSize:d})))),O+=o+d+h+l}return(0,s.renderToStaticMarkup)(n.createElement(i.A,{theme:I},n.createElement(p,null,n.createElement("svg",{width:k,height:T,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,z+100,T].toString()},n.createElement(g,{width:z,height:T,shift:50}),W))),P)}}}]);
//# sourceMappingURL=3047.8c49a106.chunk.js.map