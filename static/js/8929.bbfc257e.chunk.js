"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5904,8929],{18340:(t,e,n)=>{n.d(e,{P:()=>s});var a=n(99546);function s(t,e,n=()=>{}){const s=new TextDecoder("utf8");let r=0,c=0;for(;r<t.length;){const o=t.indexOf(10,r),i=-1===o?t.length:o,l=t.subarray(r,i),u=s.decode(l).trim();if(u&&!1===e(u,c))break;c++%1e4==0&&n(`Loading ${(0,a.getProgressDisplayStr)(r,t.length)}`),r=i+1}}},35904:(t,e,n)=>{n.r(e),n.d(e,{default:()=>d});var a=n(68584),s=n(46377),r=n(99546),c=n(99834),o=n(18340),i=n(32595),l=n(66885),u=n(55689),m=n(72147),f=n(78054);function h(t){const[e,n]=t.reduce(([t,e],[n,a])=>[t+n*a,e+a],[0,0]);return e/n}const{parseCigar:p}=u.aF;class d extends s.BaseFeatureDataAdapter{static capabilities=["getFeatures","getRefNames"];async setup(t){return this.setupP||(this.setupP=this.setupPre(t).catch(t=>{throw this.setupP=void 0,t})),this.setupP}async setupPre(t){const e=[];return(0,o.P)(await(0,r.fetchAndMaybeUnzip)((0,c.openLocation)(this.getConf("pafLocation"),this.pluginManager),t),t=>(e.push((0,f.xI)(t)),!0),t?.statusCallback),e}async hasDataForRefName(){return!0}getAssemblyNames(){const t=this.getConf("assemblyNames");return 0===t.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:t}async getRefNames(t={}){const e=t.regions?.[0].assemblyName,n=await this.setup(t),a=this.getAssemblyNames().indexOf(e);if(-1!==a){const t=new Set;for(const e of n)t.add(0===a?e.qname:e.tname);return[...t]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(t,e={}){return(0,l.ObservableCreate)(async n=>{let s=await this.setup(e);const{config:r}=e;r&&"meanQueryIdentity"===(0,a.readConfObject)(r,"colorBy")&&(s=function(t){const e={};for(const n of t){const t=`${n.qname}-${n.tname}`;e[t]||(e[t]={quals:[],len:[]}),e[t].quals.push(n.extra.mappingQual||1),e[t].len.push(n.extra.blockLen||1)}const n=Object.fromEntries(Object.entries(e).map(([t,e])=>[t,h((0,f.yU)(e.quals,e.len))]));for(const e of t){const t=`${e.qname}-${e.tname}`;e.extra.meanScore=n[t]}let a=1e4,s=0;for(const e of t)a=Math.min(e.extra.meanScore||0,a),s=Math.max(e.extra.meanScore||0,s);for(const e of t){const t=e.extra.meanScore||0;e.extra.meanScore=(t-a)/(s-a)}return t}(s));const c=this.getAssemblyNames(),{start:o,end:l,refName:u,assemblyName:d}=t,g=c.indexOf(d),b=0===g;-1===g&&(console.warn(`${d} not found in this adapter`),n.complete());for(let t=0;t<s.length;t++){const e=s[t];let a=0,r=0,h="",g="",y=0,x=0;b?(a=e.qstart,r=e.qend,h=e.qname,g=e.tname,y=e.tstart,x=e.tend):(a=e.tstart,r=e.tend,h=e.tname,g=e.qname,y=e.qstart,x=e.qend);const{extra:q,strand:w}=e;if(h===u&&(0,i.R6)(o,l,a,r)){const{numMatches:e=0,blockLen:s=1,cg:o,...i}=q;let l=q.cg;q.cg&&(b&&-1===w?l=(0,f.qm)(p(q.cg)).join(""):b&&(l=(0,f.gJ)(q.cg))),n.next(new m.A({uniqueId:t+d,assemblyName:d,start:a,end:r,type:"match",refName:h,strand:w,...i,CIGAR:l,syntenyId:t,identity:e/s,numMatches:e,blockLen:s,mate:{start:y,end:x,refName:g,assemblyName:c[+b]}}))}}n.complete()})}}},72147:(t,e,n)=>{n.d(e,{A:()=>c});var a=n(99546),s=n(55689);const{getMismatches:r}=s.aF;class c extends a.SimpleFeature{get(t){return"mismatches"===t?r(this.get("CIGAR")):super.get(t)}}},78054:(t,e,n)=>{n.d(e,{TA:()=>r,fY:()=>s,gJ:()=>l,qm:()=>i,xI:()=>o,yU:()=>c});var a=n(99546);function s(t){return new Map(t.split(/\n|\r\n|\r/).filter(t=>!!t||t.startsWith("#")).map(t=>{const[e,n,a,s,r,c]=t.split("\t");return[s,{refName:e,start:+n,end:+a,score:+r,name:s,strand:"-"===c?-1:1}]}))}async function r(t,e){return(0,a.fetchAndMaybeUnzipText)(t,e)}function c(t,e){return t.map((t,n)=>[t,e[n]])}function o(t){const e=t.split("\t"),n=e.slice(12),a={numMatches:+e[9],blockLen:+e[10],mappingQual:+e[11]};if(n.length)for(const t of n){const e=t.indexOf(":");a[t.slice(0,e)]=t.slice(e+3)}return{tname:e[5],tstart:+e[7],tend:+e[8],qname:e[0],qstart:+e[2],qend:+e[3],strand:"-"===e[4]?-1:1,extra:a}}function i(t){const e=[];for(let n=t.length-2;n>=0;n-=2){e.push(t[n]);const a=t[n+1];"D"===a?e.push("I"):"I"===a?e.push("D"):e.push(a)}return e}function l(t){return t.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}},98929:(t,e,n)=>{n.r(e),n.d(e,{default:()=>i});var a=n(99546),s=n(99834),r=n(18340);function c(t,e,n,a,s,r,c,o,i){return{qname:t,qstart:e,qend:n,tname:s,tstart:r,tend:c,strand:"-"===a?-1:1,extra:{numMatches:i,blockLen:Math.max(n-e,c-r),mappingQual:0,cg:o}}}var o=n(35904);class i extends o.default{async setupPre(t){return function(t,e){const{statusCallback:n=()=>{}}=e||{};let a="",s=0,o=0,i="",l="",u="",m=0,f=0,h=0,p="";const d=[];return(0,r.P)(t,t=>{if(!t||t.startsWith("#"))return!0;const e=t.split(/[ \t]+/);if("chain"===e[0]){if(p&&d.push(c(i,m,f,u,a,s,o,p,h)),a=e[2],s=+e[5],o=+e[6],i=e[7],l=e[8],u=e[9],m=+e[10],f=+e[11],"-"===u){const t=m;m=+l-f,f=+l-t}h=0,p=""}else{const t=+e[0]||0,n=e.length>1?+e[1]:0,a=e.length>2?+e[2]:0;0!==t&&(h+=+t,p+=`${t}M`),0!==a&&(p+=`${a}I`),0!==n&&(p+=`${n}D`)}return!0},e?.statusCallback),p&&c(i,m,f,u,a,s,o,p,h),n(""),d}(await(0,a.fetchAndMaybeUnzip)((0,s.openLocation)(this.getConf("chainLocation"),this.pluginManager),t),t)}}}}]);
//# sourceMappingURL=8929.bbfc257e.chunk.js.map