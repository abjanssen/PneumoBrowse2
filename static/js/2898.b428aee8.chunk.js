"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2898],{32898(t,e,r){r.r(e),r.d(e,{default:()=>h});var s=r(96870),n=r(69566),o=r(30128),i=r(62456),a=r(23886),c=r(16640),d=r(55614),u=r(28642),l=r(44460);function f(t){const e=(0,d.c)(24),{arc:r}=t;let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,l.jsx)("div",{children:(0,l.jsx)("strong",{children:"Intron/Skip"})}),e[0]=s):s=e[0];const n=r.refName;let o,i,c;e[1]!==r.start?(o=(0,a.toLocale)(r.start),e[1]=r.start,e[2]=o):o=e[2],e[3]!==r.end?(i=(0,a.toLocale)(r.end),e[3]=r.end,e[4]=i):i=e[4],e[5]!==r.refName||e[6]!==o||e[7]!==i?(c=(0,l.jsxs)("div",{children:["Location: ",n,":",o,"-",i]}),e[5]=r.refName,e[6]=o,e[7]=i,e[8]=c):c=e[8];const f=r.end-r.start;let g,h,b,p,k,m;return e[9]!==f?(g=(0,a.toLocale)(f),e[9]=f,e[10]=g):g=e[10],e[11]!==g?(h=(0,l.jsxs)("div",{children:["Length: ",g," bp"]}),e[11]=g,e[12]=h):h=e[12],e[13]!==r.score?(b=(0,l.jsxs)("div",{children:["Reads supporting junction: ",r.score]}),e[13]=r.score,e[14]=b):b=e[14],e[15]!==r.strand?(p=(0,u.lJ)(r.strand),e[15]=r.strand,e[16]=p):p=e[16],e[17]!==p?(k=(0,l.jsxs)("div",{children:["Strand: ",p]}),e[17]=p,e[18]=k):k=e[18],e[19]!==k||e[20]!==c||e[21]!==h||e[22]!==b?(m=(0,l.jsxs)("div",{children:[s,c,h,b,k]}),e[19]=k,e[20]=c,e[21]=h,e[22]=b,e[23]=m):m=e[23],m}const g=(0,n.observer)(function({model:t}){const{showArcsSetting:e,height:r,skipFeatures:s}=t,n=(0,a.getContainingView)(t),{assemblyManager:d}=(0,a.getSession)(t),[g,h]=(0,o.useState)(null),[b,p]=(0,o.useState)(null),k=(0,o.useRef)(null),m=(0,o.useRef)(new Map),v=(0,o.useRef)(new Map),w=(0,o.useRef)(null);w.current=b;const x=Math.round(n.dynamicBlocks.totalWidthPx),A=r-10,{arcs:P,drawnAtBpPerPx:j,drawnAtOffsetPx:S}=(0,o.useMemo)(()=>{const t=n.offsetPx,e=d.get(n.assemblyNames[0]);return{arcs:e?s.map(r=>(0,u.cZ)(r,n,A,t,e)).filter(a.notEmpty):[],drawnAtBpPerPx:n.bpPerPx,drawnAtOffsetPx:t}},[s,n.bpPerPx,A]);if((0,o.useEffect)(()=>{const e=k.current;if(!e)return;for(;e.firstChild;)e.firstChild.remove();const r=new Map,s=new Map,n=t=>{const e=t.currentTarget,s=e.dataset.id;if(s){const n=r.get(s);if(n){h({arc:n,x:t.clientX,y:t.clientY});const r=s===w.current;e.setAttribute("opacity","1"),e.setAttribute("stroke-width",String(n.strokeWidth+(r?4:2)))}}},o=t=>{const e=t.currentTarget,s=e.dataset.id;if(s){const t=r.get(s);if(t){const r=s===w.current;e.setAttribute("opacity","0.7"),r?(e.setAttribute("stroke",(0,u.D)(t.strand)),e.setAttribute("stroke-width",String(t.strokeWidth+3))):(e.setAttribute("stroke",t.stroke),e.setAttribute("stroke-width",String(t.strokeWidth)))}}h(null)},i=e=>{const s=e.currentTarget.dataset.id;if(s){p(t=>t===s?null:s);const e=r.get(s);if(e){const r=(0,a.getSession)(t);if((0,c.lO)(r)){const s=r.addWidget("BaseFeatureWidget","baseFeature",{featureData:{uniqueId:e.id,refName:e.refName,start:e.start,end:e.end,type:"junction",strand:e.strand,score:e.score,length:e.end-e.start},view:(0,a.getContainingView)(t),track:(0,a.getContainingTrack)(t)});r.showWidget(s)}}}},d=[...P].sort((t,e)=>t.score-e.score);for(const t of d){r.set(t.id,t);const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",t.path),a.setAttribute("stroke",t.stroke),a.setAttribute("stroke-width",String(t.strokeWidth)),a.setAttribute("fill","none"),a.setAttribute("opacity","0.7"),a.setAttribute("pointer-events","stroke"),a.setAttribute("cursor","pointer"),a.dataset.id=t.id,a.addEventListener("mouseenter",n),a.addEventListener("mouseleave",o),a.addEventListener("click",i),s.set(t.id,a),e.append(a)}return m.current=r,v.current=s,()=>{for(;e.firstChild;){const t=e.firstChild;t.removeEventListener("mouseenter",n),t.removeEventListener("mouseleave",o),t.removeEventListener("click",i),t.remove()}}},[P,t]),(0,o.useEffect)(()=>{const t=v.current,e=m.current;for(const[r,s]of t){const t=e.get(r);t&&(r===b?(s.setAttribute("stroke",(0,u.D)(t.strand)),s.setAttribute("stroke-width",String(t.strokeWidth+3))):(s.setAttribute("stroke",t.stroke),s.setAttribute("stroke-width",String(t.strokeWidth))))}},[b]),!e||!n.initialized||j!==n.bpPerPx)return null;const y=S-n.offsetPx;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("svg",{ref:k,style:{position:"absolute",top:5,left:y,pointerEvents:"none",height:A,width:x}}),g?(0,l.jsx)(i.A,{clientPoint:{x:g.x+5,y:g.y},children:(0,l.jsx)(f,{arc:g.arc})}):null]})}),h=(0,n.observer)(function(t){const{model:e}=t;return(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsx)(s.default,{...t}),(0,l.jsx)(g,{model:e})]})})},28642(t,e,r){function s(t){return 1===t?"rgba(255,170,170,0.7)":-1===t?"rgba(160,160,255,0.7)":"rgba(200,200,200,0.7)"}function n(t){return 1===t?"rgba(255,100,100,1)":-1===t?"rgba(100,100,255,1)":"rgba(120,120,120,1)"}function o(t){return 1===t?"+":-1===t?"-":"unknown"}function i(t,e,r,n,o){const i=t.get("start"),a=t.get("end"),c=o.getCanonicalRefName2(t.get("refName")),d=e.bpToPx({refName:c,coord:i}),u=e.bpToPx({refName:c,coord:a});if(void 0===d||void 0===u)return;const l=d.offsetPx-n,f=u.offsetPx-n,g=t.get("effectiveStrand")??0,h=t.get("score")??1;return{id:t.id(),path:`M ${l} ${.9*r} C ${l} ${.1*r}, ${f} ${.1*r}, ${f} ${.9*r}`,stroke:s(g),strokeWidth:Math.log(h+1),start:i,end:a,refName:c,score:h,strand:g}}r.d(e,{D:()=>n,cZ:()=>i,lJ:()=>o})}}]);
//# sourceMappingURL=2898.b428aee8.chunk.js.map