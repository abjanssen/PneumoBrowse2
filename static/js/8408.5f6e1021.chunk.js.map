{"version":3,"file":"static/js/8408.5f6e1021.chunk.js","mappings":"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","sources":["../../../plugins/alignments/src/shared/components/BaseDisplayComponent.tsx","../../../plugins/alignments/src/LinearReadCloudDisplay/components/ReactComponent.tsx"],"sourcesContent":["import type React from 'react'\n\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { BlockMsg } from '@jbrowse/plugin-linear-genome-view'\nimport { Button, Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// Duck-typed interface to avoid circular dependencies\ninterface BaseDisplayModel {\n  error?: unknown\n  regionTooLarge?: boolean\n  reload: () => void\n  regionCannotBeRendered: () => React.ReactElement | null\n  drawn: boolean\n  loading: boolean\n  lastDrawnOffsetPx?: number\n  message?: string\n}\n\nconst useStyles = makeStyles()(theme => ({\n  loading: {\n    backgroundColor: theme.palette.background.default,\n    backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 5px, ${theme.palette.action.disabledBackground} 5px, ${theme.palette.action.disabledBackground} 10px)`,\n    position: 'absolute',\n    bottom: 0,\n    height: 50,\n    width: 300,\n    right: 0,\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n}))\n\nconst BlockError = observer(function ({ model }: { model: BaseDisplayModel }) {\n  const { error } = model\n  return (\n    <BlockMsg\n      message={`${error}`}\n      severity=\"error\"\n      action={\n        <Tooltip title=\"Reload\">\n          <Button\n            data-testid=\"reload_button\"\n            onClick={() => {\n              model.reload()\n            }}\n          >\n            Reload\n          </Button>\n        </Tooltip>\n      }\n    />\n  )\n})\n\nconst BaseDisplayComponent = observer(function ({\n  model,\n  children,\n}: {\n  model: BaseDisplayModel\n  children?: React.ReactNode\n}) {\n  const { error, regionTooLarge } = model\n  return error ? (\n    <BlockError model={model} />\n  ) : regionTooLarge ? (\n    model.regionCannotBeRendered()\n  ) : (\n    <DataDisplay model={model}>{children}</DataDisplay>\n  )\n})\n\nconst DataDisplay = observer(function ({\n  model,\n  children,\n}: {\n  model: BaseDisplayModel\n  children?: React.ReactNode\n}) {\n  const { drawn, loading } = model\n  const view = getContainingView(model) as LinearGenomeViewModel\n  const left = (model.lastDrawnOffsetPx || 0) - view.offsetPx\n  return (\n    // this data-testid is located here because changing props on the canvas\n    // itself is very sensitive to triggering ref invalidation\n    <div data-testid={`drawn-${drawn}`}>\n      <div style={{ position: 'absolute', left }}>{children}</div>\n      {left !== 0 || loading ? <LoadingBar model={model} /> : null}\n    </div>\n  )\n})\n\nconst LoadingBar = observer(function ({ model }: { model: BaseDisplayModel }) {\n  const { classes } = useStyles()\n  const { message } = model\n  return (\n    <div className={classes.loading}>\n      <LoadingEllipses message={message} />\n    </div>\n  )\n})\n\nexport default BaseDisplayComponent\n","import { useCallback, useMemo, useRef, useState } from 'react'\n\nimport BaseTooltip from '@jbrowse/core/ui/BaseTooltip'\nimport { getContainingView } from '@jbrowse/core/util'\nimport Flatbush from '@jbrowse/core/util/flatbush'\nimport { observer } from 'mobx-react'\n\nimport BaseDisplayComponent from '../../shared/components/BaseDisplayComponent'\n\nimport type { ReducedFeature } from '../../shared/fetchChains'\nimport type { LinearReadCloudDisplayModel } from '../model'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nconst Cloud = observer(function ({\n  model,\n}: {\n  model: LinearReadCloudDisplayModel\n}) {\n  const view = getContainingView(model) as LGV\n  const width = Math.round(view.dynamicBlocks.totalWidthPx)\n  const height = model.drawCloud ? model.height : model.layoutHeight\n  const containerRef = useRef<HTMLDivElement>(null)\n  const [hoveredFeature, setHoveredFeature] = useState<{\n    x: number\n    y: number\n    width: number\n    height: number\n  } | null>(null)\n  const [hoveredFeatureData, setHoveredFeatureData] =\n    useState<ReducedFeature | null>(null)\n  const [mousePosition, setMousePosition] = useState<{\n    x: number\n    y: number\n  } | null>(null)\n\n  // Convert flatbush data to Flatbush instance\n  const flatbushIndex = useMemo(() => {\n    return model.featureLayout ? Flatbush.from(model.featureLayout.data) : null\n  }, [model.featureLayout])\n\n  // biome-ignore lint/correctness/useExhaustiveDependencies:\n  const cb = useCallback(\n    (ref: HTMLCanvasElement) => {\n      model.setRef(ref)\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [model, width, height],\n  )\n\n  // biome-ignore lint/correctness/useExhaustiveDependencies:\n  const mouseoverCb = useCallback(\n    (ref: HTMLCanvasElement) => {\n      model.setMouseoverRef(ref)\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [model, width, height],\n  )\n\n  const onMouseMove = useCallback(\n    (event: React.MouseEvent) => {\n      if (!containerRef.current || !flatbushIndex) {\n        setHoveredFeature(null)\n        setHoveredFeatureData(null)\n        setMousePosition(null)\n        return\n      }\n\n      const rect = containerRef.current.getBoundingClientRect()\n      const offsetX = event.clientX - rect.left\n      const offsetY = event.clientY - rect.top\n\n      // Track mouse position for tooltip\n      setMousePosition({ x: event.clientX, y: event.clientY })\n\n      // Search for features at this position\n      const results = flatbushIndex.search(\n        offsetX,\n        offsetY,\n        offsetX + 1,\n        offsetY + 1,\n      )\n\n      if (results.length > 0) {\n        const featureIndex = results[0]!\n        const feature = model.featuresForFlatbush[featureIndex]\n\n        if (feature) {\n          // Highlight the entire chain instead of just the individual feature\n          setHoveredFeature({\n            x: feature.chainMinX,\n            y: feature.y1,\n            width: feature.chainMaxX - feature.chainMinX,\n            height: feature.y2 - feature.y1,\n          })\n          setHoveredFeatureData(feature.data)\n        } else {\n          setHoveredFeature(null)\n          setHoveredFeatureData(null)\n        }\n      } else {\n        setHoveredFeature(null)\n        setHoveredFeatureData(null)\n      }\n    },\n    [flatbushIndex, model.featuresForFlatbush],\n  )\n\n  const onMouseLeave = useCallback(() => {\n    setHoveredFeature(null)\n    setHoveredFeatureData(null)\n    setMousePosition(null)\n  }, [])\n\n  const onClick = useCallback(\n    (event: React.MouseEvent) => {\n      if (!containerRef.current || !flatbushIndex) {\n        return\n      }\n\n      const rect = containerRef.current.getBoundingClientRect()\n      const offsetX = event.clientX - rect.left\n      const offsetY = event.clientY - rect.top\n\n      // Search for features at this position\n      const results = flatbushIndex.search(\n        offsetX,\n        offsetY,\n        offsetX + 1,\n        offsetY + 1,\n      )\n\n      if (results.length > 0) {\n        const featureIndex = results[0]!\n        const feature = model.featuresForFlatbush[featureIndex]\n\n        if (feature) {\n          model.selectFeature(feature.chain)\n        }\n      }\n    },\n    [flatbushIndex, model],\n  )\n\n  // note: the position absolute below avoids scrollbar from appearing on track\n  return (\n    <div\n      ref={containerRef}\n      style={{ position: 'relative', width, height }}\n      onMouseMove={onMouseMove}\n      onMouseLeave={onMouseLeave}\n      onClick={onClick}\n    >\n      <canvas\n        data-testid={model.drawCloud ? 'cloud-canvas' : 'stack-canvas'}\n        ref={cb}\n        style={{ width, height, position: 'absolute', left: 0, top: 0 }}\n        width={width * 2}\n        height={height * 2}\n      />\n      <canvas\n        data-testid=\"cloud-mouseover-canvas\"\n        ref={mouseoverCb}\n        style={{\n          width,\n          height,\n          position: 'absolute',\n          left: 0,\n          top: 0,\n          pointerEvents: 'none',\n        }}\n        width={width * 2}\n        height={height * 2}\n      />\n      {hoveredFeature ? (\n        <div\n          style={{\n            position: 'absolute',\n            left: hoveredFeature.x,\n            top: hoveredFeature.y,\n            width: hoveredFeature.width,\n            height: hoveredFeature.height,\n            backgroundColor: 'rgba(0, 0, 0, 0.2)',\n            pointerEvents: 'none',\n          }}\n        />\n      ) : null}\n      {hoveredFeatureData && mousePosition ? (\n        <BaseTooltip\n          clientPoint={{ x: mousePosition.x, y: mousePosition.y + 20 }}\n          placement=\"bottom-start\"\n        >\n          <div>\n            <div>\n              <strong>{hoveredFeatureData.name}</strong>\n            </div>\n            <div>\n              {hoveredFeatureData.refName}:\n              {hoveredFeatureData.start.toLocaleString()}-\n              {hoveredFeatureData.end.toLocaleString()}\n            </div>\n            {hoveredFeatureData.tlen !== 0 ? (\n              <div>Template length: {hoveredFeatureData.tlen}</div>\n            ) : null}\n          </div>\n        </BaseTooltip>\n      ) : null}\n    </div>\n  )\n})\n\nconst LinearReadCloudReactComponent = observer(function ({\n  model,\n}: {\n  model: LinearReadCloudDisplayModel\n}) {\n  return (\n    <BaseDisplayComponent model={model}>\n      <Cloud model={model} />\n    </BaseDisplayComponent>\n  )\n})\nexport default LinearReadCloudReactComponent\n"],"names":["useStyles","makeStyles","theme","loading","backgroundColor","palette","background","default","backgroundImage","action","disabledBackground","position","bottom","height","width","right","pointerEvents","textAlign","BlockError","observer","model","error","_jsx","BlockMsg","message","severity","Tooltip","title","children","Button","onClick","reload","BaseDisplayComponent","regionTooLarge","regionCannotBeRendered","DataDisplay","drawn","view","getContainingView","left","lastDrawnOffsetPx","offsetPx","_jsxs","style","LoadingBar","classes","className","LoadingEllipses","Cloud","Math","round","dynamicBlocks","totalWidthPx","drawCloud","layoutHeight","containerRef","useRef","hoveredFeature","setHoveredFeature","useState","hoveredFeatureData","setHoveredFeatureData","mousePosition","setMousePosition","flatbushIndex","useMemo","featureLayout","Flatbush","from","data","cb","useCallback","ref","setRef","mouseoverCb","setMouseoverRef","onMouseMove","event","current","rect","getBoundingClientRect","offsetX","clientX","offsetY","clientY","top","x","y","results","search","length","featureIndex","feature","featuresForFlatbush","chainMinX","y1","chainMaxX","y2","onMouseLeave","selectFeature","chain","BaseTooltip","clientPoint","placement","name","refName","start","toLocaleString","end","tlen"],"sourceRoot":""}