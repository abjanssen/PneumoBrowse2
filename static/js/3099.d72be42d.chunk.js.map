{"version":3,"file":"static/js/3099.d72be42d.chunk.js","mappings":"4KAaA,SAASA,EACPC,EACAC,EACAC,EACAC,GAGA,MAAMC,EAAYJ,EAAeK,IAAIC,GAAKA,EAAEC,UAAUC,OAAOC,GAAKA,EAAI,GAEtE,GAAyB,IAArBL,EAAUM,OACZ,MAAO,CAAEC,cAAe,IAAIC,KAM9B,MAEMC,EAAOC,KAAKC,KAAIC,EAAAA,EAAAA,KAAIZ,GAFR,IAGZa,EAAOH,KAAKC,KAAIG,EAAAA,EAAAA,KAAId,GAHR,IAIZe,GAAUlB,EAAKmB,OAAS,KAAOP,EAAOI,GAAQ,GAG9CN,EAAgB,IAAIC,IAC1B,IAAK,MAAM,GAAES,EAAE,SAAEd,KAAcP,EAAgB,CAC7C,MAAMsB,EACJf,EAAW,GAAKO,KAAKC,IAAIR,EAVX,IAUmCU,GAAQE,EAAS,EACpER,EAAcY,IAAIF,EAAIC,EACxB,CAEA,MAAO,CAAEX,gBACX,CAEO,SAASa,EACdvB,EACAwB,IAEAC,EAAAA,EAAAA,IAAgBzB,EAAMwB,EAAK1B,EAC7B,C","sources":["../../../plugins/alignments/src/LinearReadCloudDisplay/drawFeatsCloud.ts"],"sourcesContent":["import { max, min } from '@jbrowse/core/util'\n\nimport { drawFeatsCommon } from './drawFeatsCommon'\n\nimport type { ComputedChain } from './drawFeatsCommon'\nimport type { LinearReadCloudDisplayModel } from './model'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * Calculate Y-offsets using logarithmic scaling based on distance\n */\nfunction calculateCloudYOffsets(\n  computedChains: ComputedChain[],\n  self: LinearReadCloudDisplayModel,\n  _view: LGV,\n  _featureHeight: number,\n) {\n  // Calculate Y-offsets based on distance (logarithmic scaling)\n  const distances = computedChains.map(c => c.distance).filter(d => d > 0)\n\n  if (distances.length === 0) {\n    return { chainYOffsets: new Map<string, number>() }\n  }\n\n  // Use log(distance + offset) instead of log(distance) to smooth out small values\n  // The offset shifts the logarithmic curve, reducing the dramatic variation for small TLEN\n  // This provides a smooth compression without hard thresholds\n  const logOffset = 10\n\n  const maxD = Math.log(max(distances) + logOffset)\n  const minD = Math.log(min(distances) + logOffset)\n  const scaler = (self.height - 20) / (maxD - minD || 1)\n\n  // Calculate Y-offsets for each chain\n  const chainYOffsets = new Map<string, number>()\n  for (const { id, distance } of computedChains) {\n    const top =\n      distance > 0 ? (Math.log(distance + logOffset) - minD) * scaler : 0\n    chainYOffsets.set(id, top)\n  }\n\n  return { chainYOffsets }\n}\n\nexport function drawFeats(\n  self: LinearReadCloudDisplayModel,\n  ctx: CanvasRenderingContext2D,\n) {\n  drawFeatsCommon(self, ctx, calculateCloudYOffsets)\n}\n"],"names":["calculateCloudYOffsets","computedChains","self","_view","_featureHeight","distances","map","c","distance","filter","d","length","chainYOffsets","Map","maxD","Math","log","max","minD","min","scaler","height","id","top","set","drawFeats","ctx","drawFeatsCommon"],"sourceRoot":""}