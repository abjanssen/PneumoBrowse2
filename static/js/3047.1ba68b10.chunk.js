"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3047],{93047:(e,t,a)=>{a.d(t,{renderToSvg:()=>f});var s=a(67112),i=a(99546),r=a(91468),l=a(90863),n=a(91063),h=a(42489),c=a(67758),d=a(51414),o=a(69500);function w(e){const t=(0,c.c)(6),{width:a,height:s,shift:r}=e,l=(0,d.A)(),n=a+2*r;let h,w;return t[0]!==l.palette.background.default?(h=(0,i.stripAlpha)(l.palette.background.default),t[0]=l.palette.background.default,t[1]=h):h=t[1],t[2]!==s||t[3]!==n||t[4]!==h?(w=(0,o.jsx)("rect",{width:n,height:s,fill:h}),t[2]=s,t[3]=n,t[4]=h,t[5]=w):w=t[5],w}function g(e){const t=(0,c.c)(29),{trackLabelOffset:a,fontSize:s,textHeight:r,trackLabels:n,view:h,displayResults:w,rulerHeight:g,shift:m}=e,f=(0,d.A)(),p=`translate(${m} ${s})`,x=`translate(${a})`;let u,b,v,k,y;t[0]!==f.palette.text.primary?(u=(0,i.getFillProps)(f.palette.text.primary),t[0]=f.palette.text.primary,t[1]=u):u=t[1],t[2]!==h.assemblyNames?(b=h.assemblyNames.join(", "),t[2]=h.assemblyNames,t[3]=b):b=t[3],t[4]!==s||t[5]!==u||t[6]!==b?(v=(0,o.jsx)("text",{x:0,fontSize:s,...u,children:b}),t[4]=s,t[5]=u,t[6]=b,t[7]=v):v=t[7],t[8]!==w.view||t[9]!==s?(k=(0,o.jsx)(l.$m,{model:w.view,fontSize:s}),t[8]=w.view,t[9]=s,t[10]=k):k=t[10],t[11]!==x||t[12]!==v||t[13]!==k?(y=(0,o.jsxs)("g",{transform:x,children:[v,k]}),t[11]=x,t[12]=v,t[13]=k,t[14]=y):y=t[14];const j=`translate(0 ${g+s})`;let S,$,z;return t[15]!==w.data||t[16]!==w.view||t[17]!==s||t[18]!==r||t[19]!==a||t[20]!==n?(S=(0,o.jsx)(l.zh,{textHeight:r,trackLabels:n,fontSize:s,model:w.view,displayResults:w.data,trackLabelOffset:a}),t[15]=w.data,t[16]=w.view,t[17]=s,t[18]=r,t[19]=a,t[20]=n,t[21]=S):S=t[21],t[22]!==j||t[23]!==S?($=(0,o.jsx)("g",{transform:j,children:S}),t[22]=j,t[23]=S,t[24]=$):$=t[24],t[25]!==p||t[26]!==$||t[27]!==y?(z=(0,o.jsxs)("g",{transform:p,children:[y,$]}),t[25]=p,t[26]=$,t[27]=y,t[28]=z):z=t[28],z}var m=a(30385);async function f(e,t){await(0,h.when)(()=>e.initialized);const{textHeight:a=18,rulerHeight:c=30,fontSize:d=13,trackLabels:f="offset",Wrapper:p=({children:e})=>e,themeName:x="default"}=t,u=(0,i.getSession)(e),b=u.allThemes?.()[x],{width:v,views:k,levels:y}=e,j=c,S=k.map(e=>(0,l.mJ)(e.tracks,a,f)+j),$=(0,i.sum)(S)+(0,i.sum)(y.map(e=>e.height))+100,z=await Promise.all(k.map(async e=>({view:e,data:await Promise.all(e.tracks.map(async e=>{const a=e.displays[0];return await(0,h.when)(()=>void 0===a.ready||a.ready),{track:e,result:await a.renderSvg({...t,theme:b})}}))}))),H=await Promise.all(y.map(async e=>await Promise.all(e.tracks.map(async a=>{const s=a.displays[0];await(0,h.when)(()=>void 0===s.ready||s.ready);const r=await(0,i.renderToAbstractCanvas)(v,e.height,{exportSVG:t},e=>{(0,m.Ww)(s,e)});if("imageData"in r)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in r?{html:await(0,i.getSerializedSvg)({...r,width:v,height:e.height})}:r})))),L=(0,i.max)(k.flatMap(e=>e.tracks.map(e=>(0,i.measureText)((0,r.getTrackName)(e.configuration,u),d))),0)+40,T="left"===f?L:0,P=v+T,R=(0,s.createJBrowseTheme)(b),A=[(0,o.jsx)(g,{rulerHeight:c,trackLabelOffset:T,shift:50,textHeight:a,trackLabels:f,displayResults:z[0],view:k[0],fontSize:d},k[0].id)];let N=S[0]+d+c;for(let e=1;e<k.length;e++){const t=k[e],s=y[e-1],r=H[e-1],l=S[e],n=s.height||0;A.push((0,o.jsxs)("g",{transform:`translate(0 ${N})`,children:[n?(0,o.jsx)("defs",{children:(0,o.jsx)("clipPath",{id:`synclip-${e}`,children:(0,o.jsx)("rect",{x:0,y:0,width:v,height:n})})}):null,(0,o.jsx)("g",{transform:`translate(${50+T} ${d})`,clipPath:`url(#synclip-${e})`,children:r?.map((e,t)=>(0,o.jsx)(i.ReactRendering,{rendering:e},t))}),(0,o.jsx)("g",{transform:`translate(0 ${n})`,children:(0,o.jsx)(g,{rulerHeight:c,shift:50,trackLabelOffset:T,textHeight:a,trackLabels:f,displayResults:z[e],view:t,fontSize:d},t.id)})]},t.id)),N+=l+d+c+n}return(0,i.renderToStaticMarkup)((0,o.jsx)(n.A,{theme:R,children:(0,o.jsx)(p,{children:(0,o.jsxs)("svg",{width:v,height:$,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,P+100,$].toString(),children:[(0,o.jsx)(w,{width:P,height:$,shift:50}),A]})})}))}}}]);
//# sourceMappingURL=3047.1ba68b10.chunk.js.map