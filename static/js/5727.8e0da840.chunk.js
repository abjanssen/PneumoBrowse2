"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5727],{95727:(e,t,r)=>{r.d(t,{A:()=>E});var n=r(7552),o=r(68446),a=r(99546),s=r(48231),i=r(36422),l=r(9502);function c(e,t){const r=e.get("ALT");if(r)return new Map(r.map((e=>(0,l.h)(e))).filter(a.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var u=r(49473),d=r(963);const g={F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},f={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"},p={color_fwd_strand_not_proper:(0,d.X4)("#CA6767",.8),color_rev_strand_not_proper:(0,d.X4)("#7272AA",.8),color_fwd_strand:(0,d.X4)("#DC2A2A",.8),color_rev_strand:(0,d.X4)("#4141BA",.8),color_fwd_missing_mate:(0,d.X4)("#921111",.8),color_rev_missing_mate:(0,d.X4)("#111192",.8),color_fwd_diff_chr:(0,d.X4)("#000000",.8),color_rev_diff_chr:(0,d.X4)("#696969",.8),color_pair_lr:(0,d.X4)("#8C8C8C",.8),color_pair_rr:(0,d.X4)("#00005A",.8),color_pair_rl:(0,d.X4)("#005A5A",.8),color_pair_ll:(0,d.X4)("#005A00",.8),color_nostrand:(0,d.X4)("#8C8C8C",.8),color_interchrom:(0,d.X4)("#5A005A",.8),color_longinsert:(0,d.X4)("#B30000",.8),color_shortinsert:(0,d.X4)("#FF3A5C",.8),color_unknown:(0,d.X4)("#555",.8)},h=p.color_unknown;function m(e,t){return-1===e&&1===t?p.color_pair_rr:1===e&&-1===t?p.color_pair_ll:p.color_unknown}function v(e,t){return-1===e&&1===t||1===e&&-1===t}function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_.apply(null,arguments)}const[k,,w]=[0,1,2,3],R=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:l,showIntraviewLinks:c}=e,d=(0,s.A)(),R=(0,a.getSession)(e),T=(0,i.getSnapshot)(e),{assemblyManager:y}=R,M=l[0],N=M?y.get(M.assemblyNames[0]):void 0;(0,u.E6)(T);const S=e.getTrackFeatures(t),b=(0,n.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(S)),[S]),L=(0,n.useMemo)((()=>{const r=e.getMatchedFeaturesInLayout(t,b?function(e){const t=new Map,r=new Set,n=new Set;for(const o of e.values()){const e=o.get("flags"),s=o.id(),i=(0,a.assembleLocStringFast)({refName:o.get("refName"),start:o.get("start"),end:o.get("end")}),l=4&e,c=2&e;if(!(r.has(s)||n.has(i)||c||l)){const e=o.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(o)}r.add(o.id()),n.add(i)}return[...t.values()].filter((e=>e.length>1))}(S):function(e){const t=new Map,r=new Set;for(const n of e.values()){const e=n.id(),o=4&n.get("flags"),a=!!n.get("tags")?.SA;if(!r.has(e)&&!o&&a){const e=n.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(S));if(!b)for(const e of r)e.sort(((e,t)=>e.clipPos-t.clipPos));return r}),[S,t,b,e]),[E,C]=(0,n.useState)();let F=0;if(r.current){const e=r.current.getBoundingClientRect();F=e.top}return N?n.createElement("g",{fill:"none","data-testid":L.length?`${t}-loaded`:t},L.map((e=>{const r=[];for(let s=0;s<e.length-1;s++){const{layout:i,feature:T,level:y}=e[s],{layout:M,feature:L,level:O}=e[s+1];if(!i||!M)return console.warn("received null layout for a overlay feature"),null;if(!c&&y===O)return null;const A=N.getCanonicalRefName(T.get("refName")),W=N.getCanonicalRefName(L.get("refName"));if(!A||!W)throw new Error(`unable to find ref for ${A||W}`);const X={pair_orientation:T.get("pair_orientation")},B=T.get("strand"),$=L.get("strand");let J="",I=!1;A===W&&(b?(J=function(e){const t=g[e.pair_orientation||""];return"LR"===t?void 0:p[f[t]]}(X)||h,I="LR"!==g[X.pair_orientation||""]):(J=m(B,$),I=v(B,$)));const P=i[-1===B?k:w],j=-1===$,D=b?M[j?k:w]:M[j?w:k],x=(0,u.Tp)(l[y],A,P),V=(0,u.Tp)(l[O],W,D),Y=l[y].pxToBp(x).reversed?-1:1,H=l[O].pxToBp(V).reversed?-1:1,q=l.map((e=>e.getTrack(t))),z=(0,u.Ec)(t,y,l,q,i,o)-F,G=(0,u.Ec)(t,O,l,q,M,o)-F,K=y===O&&I,Q=K?q[y].displays[0].height:0,U=b?-1:1,Z=(0,u.eW)(l,t,y,o),ee=["M",x,z,"C",x+200*T.get("strand")*Y,K?Math.min(Z-F+Q,z+Q):z,V-200*L.get("strand")*H*U,K?Math.min(Z-F+Q,G+Q):G,V,G].join(" "),te=`${T.id()}-${L.id()}`;r.push(n.createElement("path",_({d:ee,key:te,"data-testid":"r1",strokeWidth:E===te?5:1},(0,a.getStrokeProps)(J||d.palette.text.disabled),{onClick:()=>{const e=R.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(S.get(T.id())||{toJSON:()=>{}}).toJSON(),feature2:(S.get(L.id())||{toJSON:()=>{}}).toJSON()}});R.showWidget?.(e)},onMouseOver:()=>{C(te)},onMouseOut:()=>{C(void 0)}})))}return r}))):null})),[T]=[0,1,2,3],y=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:s}=e,d=(0,a.getSession)(e),{assemblyManager:g}=d,f=e.getTrackFeatures(t),p=(0,n.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"breakend"===n.get("type")){const e=n.get("ALT");e?.forEach((e=>{const r=`${n.get("refName")}:${n.get("start")+1}`,o=(0,l.h)(e);if(o){const e=t.get(r);e?e.push(n):t.set(o.MatePosition||"none",[n])}}))}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(f))),[f,t,e]),[h,m]=(0,n.useState)(),v=(0,i.getSnapshot)(e);(0,u.E6)(v);const _=g.get(s[0].assemblyNames[0]);if(!_)return null;let k=0;if(r.current){const e=r.current.getBoundingClientRect();k=e.top}return n.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":p.length?`${t}-loaded`:t},p.map((e=>{const r=[];for(let a=0;a<e.length-1;a+=1){const{layout:i,feature:l,level:g}=e[a],{layout:p,feature:v,level:w}=e[a+1],R=l.id(),y=c(l,v);if(!i||!p)return null;const M=l.get("refName"),N=v.get("refName"),S=_.getCanonicalRefName(M),b=_.getCanonicalRefName(N);if(!S||!b)throw new Error(`unable to find ref for ${S||b}`);const L=(0,u.Tp)(s[g],S,i[T]),E=(0,u.Tp)(s[w],b,p[T]),C=s[g].pxToBp(L).reversed,F=s[w].pxToBp(E).reversed,O=s.map((e=>e.getTrack(t))),A=(0,u.Ec)(t,g,s,O,i,o)-k,W=(0,u.Ec)(t,w,s,O,p,o)-k;if(y){const e=["M",L-20*("left"===y.Join?-1:1)*(C?-1:1),A,"L",L,A,"L",E,W,"L",E-20*("left"===y.MateDirection?1:-1)*(F?-1:1),W].join(" ");r.push(n.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:R===h?10:5,onClick:()=>{const e=d.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:f.get(R)?.toJSON()});d.showWidget?.(e)},onMouseOver:()=>{m(R)},onMouseOut:()=>{m(void 0)}}))}else console.warn("the relevant ALT allele was not found, cannot render")}return r})))})),[M]=[0,1,2,3],N=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:s}=e,l=(0,a.getSession)(e),{assemblyManager:c}=l,d=e.getTrackFeatures(t),g=(0,n.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"paired_feature"===n.get("type")){const e=n.id().replace("-r1",""),r=n.id().replace("-r2","");n.id().endsWith("-r1")?(t.get(e)||t.set(e,[]),t.get(e).push(n)):n.id().endsWith("-r2")&&(t.get(r)||t.set(r,[]),t.get(r).push(n))}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(d))),[d,t,e]),[f,p]=(0,n.useState)(),h=(0,i.getSnapshot)(e);(0,u.E6)(h);const m=c.get(s[0].assemblyNames[0]);if(!m)return null;let v=0;if(r.current){const e=r.current.getBoundingClientRect();v=e.top}return n.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":g.length?`${t}-loaded`:t},g.map((e=>{const r=[];for(let a=0;a<e.length-1;a+=1){const{layout:i,feature:c,level:g}=e[a],{layout:h,feature:_,level:k}=e[a+1],w=c.id();if(!i||!h)return null;const R=c.get("refName"),T=_.get("refName"),y=m.getCanonicalRefName(R),N=m.getCanonicalRefName(T);if(!y||!N)throw new Error(`unable to find ref for ${y||N}`);const S=(0,u.Tp)(s[g],y,i[M]),b=(0,u.Tp)(s[k],N,h[M]),L=s.map((e=>e.getTrack(t))),E=["M",S,(0,u.Ec)(t,g,s,L,i,o)-v,"L",b,(0,u.Ec)(t,k,s,L,h,o)-v].join(" ");r.push(n.createElement("path",{d:E,"data-testid":"r2",key:JSON.stringify(E),strokeWidth:w===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:d.get(w)?.toJSON()});l.showWidget?.(e)},onMouseOver:()=>{p(w)},onMouseOut:()=>{p(void 0)}}))}return r})))})),[S]=[0,1,2,3];function b(e){return"+"===e?1:"-"===e?-1:0}const L=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:s}=e,l=(0,a.getSession)(e),{assemblyManager:c}=l,d=e.getTrackFeatures(t),g=(0,n.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],r=new Set;for(const n of e.values())r.has(n.id())||"<TRA>"!==n.get("ALT")[0]||t.push([n]),r.add(n.id());return t}(d))),[d,t,e]),[f,p]=(0,n.useState)(),h=(0,i.getSnapshot)(e);if((0,u.E6)(h),!c.get(s[0].assemblyNames[0]))return null;let m=0;if(r.current){const e=r.current.getBoundingClientRect();m=e.top}return s.length<2?null:n.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":g.length?`${t}-loaded`:t},g.map((e=>{const r=[];for(const{layout:a,feature:i,level:c}of e){const e=0===c?1:0,g=i.id();if(!a)return null;const h=i.get("INFO"),v=h.CHR2[0],_=h.END[0],k=h.STRANDS?.[0]?.split(""),[w,R]=k??[".","."],T=(0,u.Tp)(s[e],v,_);if(T){const h=[T,0,T+1,0],v=(0,u.Tp)(s[c],i.get("refName"),a[S]),_=T,k=s[c].pxToBp(v).reversed,y=s[e].pxToBp(_).reversed,M=s.map((e=>e.getTrack(t))),N=(0,u.Ec)(t,c,s,M,a,o)-m,L=(0,u.Ec)(t,e,s,M,h,o)-m,E=["M",v-20*b(w)*(k?-1:1),N,"L",v,N,"L",_,L,"L",_-20*b(R)*(y?-1:1),L].join(" ");r.push(n.createElement("path",{d:E,key:JSON.stringify(E),strokeWidth:g===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(d.get(g)||{toJSON:()=>{}}).toJSON()});l.showWidget?.(e)},onMouseOver:()=>{p(g)},onMouseOut:()=>{p(void 0)}}))}}return r})))})),E=(0,o.observer)((function(e){const{model:t,trackId:r}=e,o=t.getMatchedTracks(r);return"AlignmentsTrack"===o[0]?.type?n.createElement(R,e):"VariantTrack"===o[0]?.type?t.hasTranslocations(r)?n.createElement(L,e):t.hasPairedFeatures(r)?n.createElement(N,e):n.createElement(y,e):null}))}}]);
//# sourceMappingURL=5727.8e0da840.chunk.js.map