"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3477],{83477(e,o,t){t.r(o),t.d(o,{default:()=>y});var r=t(42918),n=t(11259),u=t(77251),s=t(64074),a=t(25978);class i{totalHeight=0;items=[];layout=new Map;constructor({width:e}){if(!e)throw new Error("width required to make a new FloatingLayout");this.width=e}add(e,o,t,r,n){this.items.push({uniqueId:e,anchorLocation:o,width:t,height:r,data:n})}getLayout(e){if(!e)return this.layout;const o=(0,n.QZ)(e,"minStickLength"),t=this.items.sort((e,o)=>e.data.score-o.data.score);let r=0;const u=new Array(t.length);for(const[e,n]of t.entries()){const t=n,{anchorLocation:s,width:i,height:c}=t,l=s-i/2,d=l+i;let M=o,h=M+c;for(let o=0;o<e;o+=1){const[,e]=u[o],{x:t,y:r,width:n,height:s}=e,i=t+n,f=r+s;(0,a.R6)(t,i,l,d)&&(0,a.R6)(r,f,M,h)&&(M=f,h=M+c,o=-1)}u[e]=[t.uniqueId,{...t,x:l,y:M}],h>r&&(r=h)}return this.totalHeight=r,this.layout=new Map(u),this.layout}getTotalHeight(){return this.totalHeight}}var c=t(30936),l=t(86559),d=t(32118);function M(e){const o=(0,c.c)(19),{feature:t,config:r,layoutRecord:u}=e,{y:s,data:a}=u,{anchorX:i,radiusPx:M,score:h}=a;let f,g,F,y,v,x,w;if(o[0]!==r||o[1]!==t||o[2]!==M||o[3]!==h){x=Symbol.for("react.early_return_sentinel");{const e=(0,n.QZ)(r,"innerColor",{feature:t});g=String(h),f=2*M/g.length*1.1,f<12?x=null:(F="none",y=f,v=(0,l.contrastingTextColor)(e))}o[0]=r,o[1]=t,o[2]=M,o[3]=h,o[4]=f,o[5]=g,o[6]=F,o[7]=y,o[8]=v,o[9]=x}else f=o[4],g=o[5],F=o[6],y=o[7],v=o[8],x=o[9];if(x!==Symbol.for("react.early_return_sentinel"))return x;o[10]!==F||o[11]!==y||o[12]!==v?(w={pointerEvents:F,fontSize:y,fill:v},o[10]=F,o[11]=y,o[12]=v,o[13]=w):w=o[13];const p=s+M-f/2.4;let k;return o[14]!==i||o[15]!==g||o[16]!==w||o[17]!==p?(k=(0,d.jsx)("text",{style:w,x:i,y:p,textAnchor:"middle",dominantBaseline:"hanging",children:g}),o[14]=i,o[15]=g,o[16]=w,o[17]=p,o[18]=k):k=o[18],k}function h(e){const o=(0,c.c)(45),{cx:t,cy:r,r:n,style:u,featureId:s,onFeatureMouseDown:a,onFeatureMouseEnter:i,onFeatureMouseOut:l,onFeatureMouseOver:M,onFeatureMouseUp:h,onFeatureMouseLeave:f,onFeatureMouseMove:g,onFeatureClick:F}=e;let y,v,x,w,p,k,b,L,O,C,j;return o[0]!==s||o[1]!==a?(y=e=>a?.(e,s),o[0]=s,o[1]=a,o[2]=y):y=o[2],o[3]!==s||o[4]!==i?(v=e=>i?.(e,s),o[3]=s,o[4]=i,o[5]=v):v=o[5],o[6]!==s||o[7]!==l?(x=e=>l?.(e,s),o[6]=s,o[7]=l,o[8]=x):x=o[8],o[9]!==s||o[10]!==M?(w=e=>M?.(e,s),o[9]=s,o[10]=M,o[11]=w):w=o[11],o[12]!==s||o[13]!==h?(p=e=>h?.(e,s),o[12]=s,o[13]=h,o[14]=p):p=o[14],o[15]!==s||o[16]!==f?(k=e=>f?.(e,s),o[15]=s,o[16]=f,o[17]=k):k=o[17],o[18]!==s||o[19]!==g?(b=e=>g?.(e,s),o[18]=s,o[19]=g,o[20]=b):b=o[20],o[21]!==s||o[22]!==F?(L=e=>{e.stopPropagation(),F?.(e,s)},o[21]=s,o[22]=F,o[23]=L):L=o[23],o[24]!==s||o[25]!==M?(O=e=>M?.(e,s),o[24]=s,o[25]=M,o[26]=O):O=o[26],o[27]!==s||o[28]!==l?(C=e=>l?.(e,s),o[27]=s,o[28]=l,o[29]=C):C=o[29],o[30]!==t||o[31]!==r||o[32]!==n||o[33]!==u||o[34]!==y||o[35]!==C||o[36]!==v||o[37]!==x||o[38]!==w||o[39]!==p||o[40]!==k||o[41]!==b||o[42]!==L||o[43]!==O?(j=(0,d.jsx)("circle",{cx:t,cy:r,r:n,style:u,onMouseDown:y,onMouseEnter:v,onMouseOut:x,onMouseOver:w,onMouseUp:p,onMouseLeave:k,onMouseMove:b,onClick:L,onFocus:O,onBlur:C}),o[30]=t,o[31]=r,o[32]=n,o[33]=u,o[34]=y,o[35]=C,o[36]=v,o[37]=x,o[38]=w,o[39]=p,o[40]=k,o[41]=b,o[42]=L,o[43]=O,o[44]=j):j=o[44],j}const f=(0,s.observer)(function({feature:e,config:o,layoutRecord:t,selectedFeatureId:r,onFeatureMouseDown:u,onFeatureMouseEnter:s,onFeatureMouseOut:a,onFeatureMouseOver:i,onFeatureMouseUp:c,onFeatureMouseLeave:l,onFeatureMouseMove:f,onFeatureClick:g}){const{anchorLocation:F,y,data:{radiusPx:v}}=t,x=e.id(),w=(0,n.QZ)(o,"strokeWidth",{feature:e}),p=F,k=y+v,b={featureId:x,onFeatureMouseDown:u,onFeatureMouseEnter:s,onFeatureMouseOut:a,onFeatureMouseOver:i,onFeatureMouseUp:c,onFeatureMouseLeave:l,onFeatureMouseMove:f,onFeatureClick:g};return(0,d.jsxs)("g",{"data-testid":x,children:[(0,d.jsx)("title",{children:(0,n.QZ)(o,"caption",{feature:e})}),(0,d.jsx)(h,{cx:p,cy:k,r:v,style:{fill:String(r)===String(x)?"red":(0,n.QZ)(o,"strokeColor",{feature:e})},...b}),v-w>2?(0,d.jsx)(h,{cx:p,cy:k,r:v-w,style:{fill:(0,n.QZ)(o,"innerColor",{feature:e})},...b}):null,(0,d.jsx)(M,{feature:e,config:o,layoutRecord:t})]})}),g=(0,s.observer)(function({feature:e,config:o,layoutRecord:{anchorLocation:t,y:r,data:{radiusPx:u}}}){return(0,d.jsx)("line",{x1:t,y1:0,x2:t,y2:r+2*u,stroke:(0,n.QZ)(o,"stickColor",{feature:e}),strokeWidth:(0,n.QZ)(o,"stickWidth",{feature:e})})});function F(e){const{feature:o,bpPerPx:t,config:r,region:s,layout:a}=e,i=Math.abs(o.get("end")+o.get("start"))/2,c=(0,u.bpToPx)(i,s,t),l=(0,n.QZ)(r,"radius",{feature:o});l||console.error(new Error(`lollipop radius ${l} configured for feature ${o.id()}`)),a.add(o.id(),c,2*l,2*l,{featureId:o.id(),anchorX:c,radiusPx:l,score:(0,n.QZ)(r,"score",{feature:o})})}const y=(0,s.observer)(function(e){const o=o=>{const{onMouseEnter:t}=e;return t?.(o)},t=o=>{const{onMouseLeave:t}=e;return t?.(o)},{regions:n,bpPerPx:u,config:s,features:a=new Map,displayModel:c={}}=e,{selectedFeatureId:l}=c,M=n[0],h=(M.end-M.start)/u,{records:y,height:v}=(0,r.useMemo)(()=>{const e=new i({width:h});for(const o of a.values())F({feature:o,bpPerPx:u,region:M,config:s,layout:e});return{records:[...e.getLayout(s).values()],height:e.getTotalHeight()}},[a,u,M,s,h]);return(0,d.jsx)("svg",{width:h,height:v,style:{position:"relative"},onMouseDown:o=>{const{onMouseDown:t}=e;return t?.(o)},onMouseUp:o=>{const{onMouseUp:t}=e;return t?.(o)},onMouseEnter:o,onMouseLeave:t,onMouseOver:o=>{const{onMouseOver:t}=e;return t?.(o)},onMouseOut:o=>{const{onMouseOut:t}=e;return t?.(o)},onFocus:o,onBlur:t,onClick:o=>{const{onClick:t}=e;return t?.(o)},children:y.map(o=>{const t=a.get(o.data.featureId);return(0,d.jsxs)(r.Fragment,{children:[(0,d.jsx)(g,{config:s,layoutRecord:o,feature:t}),(0,d.jsx)(f,{config:s,layoutRecord:o,feature:t,selectedFeatureId:l,onFeatureMouseDown:e.onFeatureMouseDown,onFeatureMouseEnter:e.onFeatureMouseEnter,onFeatureMouseOut:e.onFeatureMouseOut,onFeatureMouseOver:e.onFeatureMouseOver,onFeatureMouseUp:e.onFeatureMouseUp,onFeatureMouseLeave:e.onFeatureMouseLeave,onFeatureMouseMove:e.onFeatureMouseMove,onFeatureClick:e.onFeatureClick})]},t.id())})})})}}]);
//# sourceMappingURL=3477.75f97e74.chunk.js.map