{"version":3,"file":"static/js/6651.d02b337d.chunk.js","mappings":"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","sources":["../../../plugins/variants/src/shared/setupMultiVariantAutoruns.ts","../../../plugins/variants/src/shared/getMultiVariantSourcesAutorun.ts","../../../plugins/variants/src/shared/getMultiVariantFeaturesAutorun.ts","../../../plugins/variants/src/shared/treeDrawingAutorun.ts","../../../plugins/variants/src/shared/colorByAutorun.ts","../../../plugins/variants/src/shared/applyColorPalette.ts"],"sourcesContent":["import { setupColorByAutorun } from './colorByAutorun.ts'\nimport { getMultiVariantFeaturesAutorun } from './getMultiVariantFeaturesAutorun.ts'\nimport { getMultiVariantSourcesAutorun } from './getMultiVariantSourcesAutorun.ts'\nimport { setupTreeDrawingAutorun } from './treeDrawingAutorun.ts'\n\nimport type { MultiVariantBaseModel } from './MultiVariantBaseModel.ts'\n\n/**\n * Sets up the autoruns for multi-variant displays.\n * This is shared between MultiLinearVariantDisplay and LinearVariantMatrixDisplay.\n */\nexport function setupMultiVariantAutoruns(self: MultiVariantBaseModel) {\n  getMultiVariantSourcesAutorun(self)\n  getMultiVariantFeaturesAutorun(self)\n  setupTreeDrawingAutorun(self)\n  setupColorByAutorun(self)\n}\n","import { getContainingView, getSession } from '@jbrowse/core/util'\nimport { isAbortException } from '@jbrowse/core/util/aborting'\nimport { createStopToken } from '@jbrowse/core/util/stopToken'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type { Source } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { StopToken } from '@jbrowse/core/util/stopToken'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function getMultiVariantSourcesAutorun(self: {\n  configuration: AnyConfigurationModel\n  adapterConfig: AnyConfigurationModel\n  isMinimized: boolean\n  adapterProps: () => Record<string, unknown>\n  setSourcesLoading: (aborter: StopToken) => void\n  setError: (error: unknown) => void\n  setStatusMessage: (str: string) => void\n  setSources: (sources: Source[]) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      async () => {\n        try {\n          // isAlive check guards against display being destroyed during async import\n          if (!isAlive(self) || self.isMinimized) {\n            return\n          }\n          const view = getContainingView(self) as LinearGenomeViewModel\n          if (!view.initialized) {\n            return\n          }\n          const { rpcManager } = getSession(self)\n          const { adapterConfig } = self\n          const stopToken = createStopToken()\n          self.setSourcesLoading(stopToken)\n          const sessionId = getRpcSessionId(self)\n          const sources = (await rpcManager.call(\n            sessionId,\n            'MultiVariantGetSources',\n            {\n              sessionId,\n              adapterConfig,\n              stopToken,\n              statusCallback: (arg: string) => {\n                if (isAlive(self)) {\n                  self.setStatusMessage(arg)\n                }\n              },\n            },\n          )) as Source[]\n          if (isAlive(self)) {\n            self.setSources(sources)\n          }\n        } catch (e) {\n          if (!isAbortException(e) && isAlive(self)) {\n            console.error(e)\n            getSession(self).notifyError(`${e}`, e)\n          }\n        }\n      },\n      {\n        delay: 1000,\n        name: 'GetMultiVariantSources',\n      },\n    ),\n  )\n}\n","import {\n  SimpleFeature,\n  getContainingView,\n  getSession,\n} from '@jbrowse/core/util'\nimport { isAbortException } from '@jbrowse/core/util/aborting'\nimport { createStopToken } from '@jbrowse/core/util/stopToken'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type { SampleInfo, Source } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, SimpleFeatureSerialized } from '@jbrowse/core/util'\nimport type { StopToken } from '@jbrowse/core/util/stopToken'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function getMultiVariantFeaturesAutorun(self: {\n  configuration: AnyConfigurationModel\n  adapterConfig: AnyConfigurationModel\n  sources?: Source[]\n  minorAlleleFrequencyFilter: number\n  lengthCutoffFilter: number\n  featureDensityStatsReadyAndRegionNotTooLarge: boolean\n  isMinimized: boolean\n  adapterProps: () => Record<string, unknown>\n  setError: (error: unknown) => void\n  setFeatures: (f: Feature[]) => void\n  setStatusMessage: (str: string) => void\n  setHasPhased: (arg: boolean) => void\n  setSampleInfo: (arg: Record<string, SampleInfo>) => void\n  setSimplifiedFeaturesLoading: (arg: StopToken) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      async () => {\n        try {\n          // isAlive check guards against display being destroyed during async import\n          if (!isAlive(self) || self.isMinimized) {\n            return\n          }\n          const view = getContainingView(self) as LinearGenomeViewModel\n          if (\n            !view.initialized ||\n            !self.featureDensityStatsReadyAndRegionNotTooLarge\n          ) {\n            return\n          }\n\n          const stopToken = createStopToken()\n          self.setSimplifiedFeaturesLoading(stopToken)\n          const { rpcManager } = getSession(self)\n          const {\n            lengthCutoffFilter,\n            sources,\n            minorAlleleFrequencyFilter,\n            adapterConfig,\n          } = self\n          if (sources) {\n            const sessionId = getRpcSessionId(self)\n            const { sampleInfo, hasPhased, features } = (await rpcManager.call(\n              sessionId,\n              'MultiVariantGetSimplifiedFeatures',\n              {\n                regions: view.dynamicBlocks.contentBlocks,\n                sources,\n                minorAlleleFrequencyFilter,\n                lengthCutoffFilter,\n                sessionId,\n                adapterConfig,\n                stopToken,\n                statusCallback: (arg: string) => {\n                  if (isAlive(self)) {\n                    self.setStatusMessage(arg)\n                  }\n                },\n              },\n            )) as {\n              sampleInfo: Record<string, SampleInfo>\n              hasPhased: boolean\n              features: SimpleFeatureSerialized[]\n            }\n            if (isAlive(self)) {\n              self.setHasPhased(hasPhased)\n              self.setSampleInfo(sampleInfo)\n              self.setFeatures(features.map(f => new SimpleFeature(f)))\n            }\n          }\n        } catch (e) {\n          console.error(e)\n          if (!isAbortException(e) && isAlive(self)) {\n            getSession(self).notifyError(`${e}`, e)\n          }\n        }\n      },\n      {\n        delay: 1000,\n        name: 'MultiVariantFeatures',\n      },\n    ),\n  )\n}\n","import { getContainingView } from '@jbrowse/core/util'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type {\n  ClusterHierarchyNode,\n  HoveredTreeNode,\n} from './components/types.ts'\nimport type { Source } from './types.ts'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ninterface TreeDrawingModel {\n  treeCanvas?: HTMLCanvasElement\n  mouseoverCanvas?: HTMLCanvasElement\n  hierarchy?: ClusterHierarchyNode\n  treeAreaWidth: number\n  height: number\n  scrollTop: number\n  rowHeight: number\n  totalHeight: number\n  hoveredTreeNode?: HoveredTreeNode\n  sources?: Source[]\n  isMinimized: boolean\n}\n\nexport function setupTreeDrawingAutorun(self: TreeDrawingModel) {\n  // Draw tree structure\n  addDisposer(\n    self,\n    autorun(\n      function treeDrawAutorun() {\n        // isAlive check guards against display being destroyed during async import\n        if (!isAlive(self) || self.isMinimized) {\n          return\n        }\n        const {\n          treeCanvas,\n          hierarchy,\n          treeAreaWidth,\n          height,\n          scrollTop,\n          // eslint-disable-next-line  @typescript-eslint/no-unused-vars\n          totalHeight: _totalHeight,\n        } = self\n\n        if (!treeCanvas || !hierarchy) {\n          return\n        }\n\n        const ctx = treeCanvas.getContext('2d')\n        if (!ctx) {\n          return\n        }\n\n        // Clear the entire canvas\n        ctx.resetTransform()\n        ctx.scale(2, 2)\n        ctx.clearRect(0, 0, treeAreaWidth, height)\n\n        // Translate to simulate scrolling\n        ctx.translate(0, -scrollTop)\n\n        // Draw the tree (this draws the full tree, but only visible part shows)\n        // Note: accessing totalHeight ensures we redraw when row height changes\n        ctx.strokeStyle = '#0008'\n        ctx.lineWidth = 1\n\n        // Use single path for all tree lines for better performance\n        ctx.beginPath()\n        for (const link of hierarchy.links()) {\n          const { source, target } = link\n          const sy = source.x!\n          const ty = target.x!\n          const tx = target.y!\n          const sx = source.y!\n\n          // Vertical line\n          ctx.moveTo(sx, sy)\n          ctx.lineTo(sx, ty)\n\n          // Horizontal line\n          ctx.moveTo(sx, ty)\n          ctx.lineTo(tx, ty)\n        }\n        ctx.stroke()\n      },\n      {\n        name: 'TreeDraw',\n      },\n    ),\n  )\n\n  // Draw hover highlights\n  addDisposer(\n    self,\n    autorun(\n      function treeHoverAutorun() {\n        // isAlive check guards against display being destroyed during async import\n        if (!isAlive(self) || self.isMinimized) {\n          return\n        }\n        const {\n          mouseoverCanvas,\n          hierarchy,\n          rowHeight,\n          hoveredTreeNode,\n          height,\n          scrollTop,\n          sources,\n          // eslint-disable-next-line  @typescript-eslint/no-unused-vars\n          totalHeight,\n        } = self\n        if (!mouseoverCanvas) {\n          return\n        }\n\n        const ctx = mouseoverCanvas.getContext('2d')\n        if (!ctx) {\n          return\n        }\n\n        const view = getContainingView(self) as LinearGenomeViewModel\n        const viewWidth = view.width\n\n        ctx.clearRect(0, 0, viewWidth, height)\n\n        if (hierarchy && hoveredTreeNode && sources) {\n          // Save the context state\n          ctx.save()\n\n          // Translate to simulate scrolling\n          ctx.translate(0, -scrollTop)\n\n          // Draw highlight rectangles for descendant leaf rows\n          // Note: accessing totalHeight ensures we redraw when row height changes\n          // In phased mode, each sample name may correspond to multiple rows\n          // (e.g., SAMPLE1 -> SAMPLE1 HP0, SAMPLE1 HP1)\n          ctx.fillStyle = 'rgba(255,165,0,0.2)'\n          const descendantSet = new Set(hoveredTreeNode.descendantNames)\n          for (let i = 0, l = sources.length; i < l; i++) {\n            const source = sources[i]!\n            if (descendantSet.has(source.name)) {\n              const y = (i + 0.5) * rowHeight\n              ctx.fillRect(0, y - rowHeight / 2, viewWidth, rowHeight)\n            }\n          }\n\n          // Draw circle at the hovered node\n          const { node } = hoveredTreeNode\n          ctx.fillStyle = 'rgba(255,165,0,0.8)'\n          ctx.beginPath()\n          ctx.arc(node.y!, node.x!, 4, 0, 2 * Math.PI)\n          ctx.fill()\n\n          // Add a border to the circle\n          ctx.strokeStyle = 'rgba(255,140,0,1)'\n          ctx.lineWidth = 1\n          ctx.stroke()\n\n          // Restore the context state\n          ctx.restore()\n        }\n      },\n      { name: 'TreeHover' },\n    ),\n  )\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { addDisposer, isAlive } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport { applyColorPalette } from './applyColorPalette.ts'\n\nimport type { Source } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\n/**\n * Sets up an autorun that applies a color palette to sources based on the\n * colorBy config option when sources are first loaded.\n */\nexport function setupColorByAutorun(self: {\n  configuration: AnyConfigurationModel\n  sourcesVolatile: Source[] | undefined\n  layout: Source[]\n  colorByApplied: boolean\n  setLayout: (layout: Source[], clearTree?: boolean) => void\n  setColorByApplied: (value: boolean) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      () => {\n        if (!isAlive(self)) {\n          return\n        }\n\n        // Only apply once\n        if (self.colorByApplied) {\n          return\n        }\n\n        // Wait for sources to be loaded\n        const sources = self.sourcesVolatile\n        if (!sources || sources.length === 0) {\n          return\n        }\n\n        // Don't override existing layout (user customization)\n        if (self.layout.length > 0) {\n          self.setColorByApplied(true)\n          return\n        }\n\n        // Check if colorBy config is set\n        const colorBy = getConf(self, 'colorBy') as string\n        if (!colorBy) {\n          self.setColorByApplied(true)\n          return\n        }\n\n        // Check if the attribute exists in the sources\n        const hasAttribute = sources.some(source => colorBy in source)\n        if (!hasAttribute) {\n          console.warn(\n            `colorBy attribute \"${colorBy}\" not found in sample metadata. ` +\n              `Available attributes: ${Object.keys(sources[0] || {}).join(', ')}`,\n          )\n          self.setColorByApplied(true)\n          return\n        }\n\n        // Apply the color palette\n        const coloredSources = applyColorPalette(sources, colorBy)\n        self.setLayout(coloredSources, false)\n        self.setColorByApplied(true)\n      },\n      {\n        name: 'ColorByAutorun',\n      },\n    ),\n  )\n}\n","import { set1 } from '@jbrowse/core/ui/colors'\nimport { randomColor } from '@jbrowse/core/util/color'\n\nimport type { Source } from './types.ts'\n\n/**\n * Applies a color palette to sources based on a metadata attribute.\n * Colors are assigned based on the frequency of values, with less common\n * values getting colors first from the set1 palette.\n *\n * @param sources - The source array to apply colors to\n * @param attribute - The metadata attribute to color by\n * @returns A new array of sources with colors applied\n */\nexport function applyColorPalette(sources: Source[], attribute: string) {\n  if (!attribute || sources.length === 0) {\n    return sources\n  }\n\n  // Check if any source has the attribute\n  const hasAttribute = sources.some(source => attribute in source)\n  if (!hasAttribute) {\n    return sources\n  }\n\n  // Count occurrences of each value\n  const counts = new Map<string, number>()\n  for (const source of sources) {\n    const key = String(source[attribute] ?? '')\n    counts.set(key, (counts.get(key) || 0) + 1)\n  }\n\n  // Create color map, sorting by frequency (least common first gets colors first)\n  const colorMap = Object.fromEntries(\n    [...counts.entries()]\n      .sort((a, b) => a[1] - b[1])\n      .map(([key], idx) => [key, set1[idx] || randomColor(key)]),\n  )\n\n  // Apply colors to sources\n  return sources.map(source => ({\n    ...source,\n    color: colorMap[String(source[attribute] ?? '')],\n  }))\n}\n"],"names":["setupMultiVariantAutoruns","self","addDisposer","autorun","async","isAlive","isMinimized","getContainingView","initialized","rpcManager","getSession","adapterConfig","stopToken","createStopToken","setSourcesLoading","sessionId","getRpcSessionId","sources","call","statusCallback","arg","setStatusMessage","setSources","e","isAbortException","console","error","notifyError","delay","name","getMultiVariantSourcesAutorun","view","featureDensityStatsReadyAndRegionNotTooLarge","setSimplifiedFeaturesLoading","lengthCutoffFilter","minorAlleleFrequencyFilter","sampleInfo","hasPhased","features","regions","dynamicBlocks","contentBlocks","setHasPhased","setSampleInfo","setFeatures","map","f","SimpleFeature","getMultiVariantFeaturesAutorun","treeCanvas","hierarchy","treeAreaWidth","height","scrollTop","totalHeight","_totalHeight","ctx","getContext","resetTransform","scale","clearRect","translate","strokeStyle","lineWidth","beginPath","link","links","source","target","sy","x","ty","tx","y","sx","moveTo","lineTo","stroke","mouseoverCanvas","rowHeight","hoveredTreeNode","viewWidth","width","save","fillStyle","descendantSet","Set","descendantNames","i","l","length","has","fillRect","node","arc","Math","PI","fill","restore","setupTreeDrawingAutorun","colorByApplied","sourcesVolatile","layout","setColorByApplied","colorBy","getConf","some","warn","Object","keys","join","coloredSources","applyColorPalette","setLayout","setupColorByAutorun","attribute","counts","Map","key","String","set","get","colorMap","fromEntries","entries","sort","a","b","idx","set1","randomColor","color"],"ignoreList":[],"sourceRoot":""}