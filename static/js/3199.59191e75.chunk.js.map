{"version":3,"file":"static/js/3199.59191e75.chunk.js","mappings":"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","sources":["../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/AssemblySelector.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/BookmarkGrid.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/GridBookmarkWidget.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/utils.ts"],"sourcesContent":["import React from 'react'\n\nimport {\n  Checkbox,\n  FormControl,\n  InputLabel,\n  ListItemText,\n  MenuItem,\n  OutlinedInput,\n  Select,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { GridBookmarkModel } from '../model'\n\nconst AssemblySelector = observer(function ({\n  model,\n}: {\n  model: GridBookmarkModel\n}) {\n  const { validAssemblies, selectedAssemblies } = model\n  const noAssemblies = validAssemblies.size === 0\n  const label = 'Select assemblies'\n  const id = 'select-assemblies-label'\n  const selectedSet = new Set(selectedAssemblies)\n  const isAllSelected = [...validAssemblies].every(e => selectedSet.has(e))\n\n  return (\n    <FormControl disabled={noAssemblies} fullWidth>\n      <InputLabel id={id}>{label}</InputLabel>\n      <Select\n        labelId={id}\n        multiple\n        value={selectedAssemblies}\n        onChange={event => {\n          model.setSelectedAssemblies([...event.target.value])\n        }}\n        input={<OutlinedInput label={label} />}\n        renderValue={selected => selected.join(', ')}\n      >\n        <MenuItem\n          onClickCapture={event => {\n            // onClickCapture allows us to avoid the parent Select onChange from triggering\n            if (isAllSelected) {\n              model.setSelectedAssemblies([])\n            } else {\n              model.setSelectedAssemblies(undefined)\n            }\n            event.preventDefault()\n          }}\n        >\n          <Checkbox\n            checked={isAllSelected}\n            indeterminate={!isAllSelected && selectedAssemblies.length > 0}\n          />\n          <ListItemText primary=\"Select all\" />\n        </MenuItem>\n        {[...validAssemblies].map(name => (\n          <MenuItem key={name} value={name}>\n            <Checkbox checked={selectedAssemblies.includes(name)} />\n            <ListItemText primary={name} />\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  )\n})\n\nexport default AssemblySelector\n","import React from 'react'\n\nimport ColorPicker from '@jbrowse/core/ui/ColorPicker'\nimport {\n  assembleLocString,\n  getSession,\n  measureGridWidth,\n  measureText,\n} from '@jbrowse/core/util'\nimport { Link } from '@mui/material'\nimport { DataGrid, GRID_CHECKBOX_SELECTION_COL_DEF } from '@mui/x-data-grid'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport { navToBookmark } from '../utils'\n\nimport type { GridBookmarkModel } from '../model'\n\nconst useStyles = makeStyles()(() => ({\n  cell: {\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n  },\n}))\n\nconst BookmarkGrid = observer(function ({\n  model,\n}: {\n  model: GridBookmarkModel\n}) {\n  const { classes } = useStyles()\n  const {\n    bookmarks,\n    bookmarksWithValidAssemblies,\n    selectedAssemblies,\n    selectedBookmarks,\n  } = model\n\n  const session = getSession(model)\n  const selectedSet = new Set(selectedAssemblies)\n  const rows = bookmarks\n    .filter(r => selectedSet.has(r.assemblyName))\n    .map((region, index) => {\n      const { assemblyName, ...rest } = region\n      return {\n        ...region,\n        id: index,\n        assemblyName,\n        locString: assembleLocString(rest),\n        correspondingObj: region,\n      }\n    })\n\n  const widths = [\n    50,\n    Math.max(\n      measureText('Bookmark link', 12) + 30,\n      measureGridWidth(rows.map(row => row.locString)),\n    ),\n    Math.max(\n      measureText('Label', 12) + 30,\n      measureGridWidth(rows.map(row => row.label)),\n    ),\n    Math.max(\n      measureText('Assembly', 12) + 30,\n      measureGridWidth(rows.map(row => row.assemblyName)),\n    ),\n    100,\n  ]\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column' }}>\n      <DataGrid\n        density=\"compact\"\n        rows={rows}\n        columns={[\n          {\n            ...GRID_CHECKBOX_SELECTION_COL_DEF,\n            width: widths[0],\n          },\n          {\n            field: 'locString',\n            headerName: 'Bookmark link',\n            width: widths[1],\n            renderCell: ({ value, row }) => (\n              <Link\n                className={classes.cell}\n                href=\"#\"\n                onClick={async event => {\n                  event.preventDefault()\n                  const { views } = session\n                  await navToBookmark(value, row.assemblyName, views, model)\n                }}\n              >\n                {value}\n              </Link>\n            ),\n          },\n          {\n            field: 'label',\n            headerName: 'Label',\n            width: widths[2],\n            editable: true,\n          },\n          {\n            field: 'assemblyName',\n            headerName: 'Assembly',\n            width: widths[3],\n          },\n          {\n            field: 'highlight',\n            headerName: 'Highlight',\n            width: widths[4],\n            renderCell: ({ value, row }) => (\n              <ColorPicker\n                color={value || 'black'}\n                onChange={event => {\n                  model.updateBookmarkHighlight(row, event)\n                }}\n              />\n            ),\n          },\n        ]}\n        processRowUpdate={row => {\n          const target = rows[row.id]!\n          model.updateBookmarkLabel(target, row.label)\n          return row\n        }}\n        onProcessRowUpdateError={e => {\n          session.notifyError(`${e}`, e)\n        }}\n        checkboxSelection\n        onRowSelectionModelChange={newRowSelectionModel => {\n          if (bookmarksWithValidAssemblies.length > 0) {\n            model.setSelectedBookmarks(\n              newRowSelectionModel.map(value => ({\n                ...rows[value as number]!,\n              })),\n            )\n          }\n        }}\n        rowSelectionModel={selectedBookmarks.map(r => r.id)}\n        disableRowSelectionOnClick\n      />\n    </div>\n  )\n})\n\nexport default BookmarkGrid\n","import React, { lazy } from 'react'\n\nimport CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { getSession } from '@jbrowse/core/util'\nimport Delete from '@mui/icons-material/Delete'\nimport GetApp from '@mui/icons-material/GetApp'\nimport Menu from '@mui/icons-material/Menu'\nimport Palette from '@mui/icons-material/Palette'\nimport Publish from '@mui/icons-material/Publish'\nimport Settings from '@mui/icons-material/Settings'\nimport Share from '@mui/icons-material/Share'\nimport { Alert } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport AssemblySelector from './AssemblySelector'\nimport BookmarkGrid from './BookmarkGrid'\n\nimport type { GridBookmarkModel } from '../model'\n\n// lazies\nconst ExportBookmarksDialog = lazy(\n  () => import('./dialogs/ExportBookmarksDialog'),\n)\nconst ImportBookmarksDialog = lazy(\n  () => import('./dialogs/ImportBookmarksDialog'),\n)\nconst ShareBookmarksDialog = lazy(\n  () => import('./dialogs/ShareBookmarksDialog'),\n)\nconst HighlightSettingsDialog = lazy(\n  () => import('./dialogs/HighlightSettingsDialog'),\n)\nconst EditHighlightColorDialog = lazy(\n  () => import('./dialogs/EditHighlightColorDialog'),\n)\nconst DeleteBookmarksDialog = lazy(\n  () => import('./dialogs/DeleteBookmarksDialog'),\n)\n\nconst useStyles = makeStyles()({\n  flex: {\n    display: 'flex',\n  },\n})\n\nconst GridBookmarkWidget = observer(function GridBookmarkWidget({\n  model,\n}: {\n  model: GridBookmarkModel\n}) {\n  const { classes } = useStyles()\n  return (\n    <div>\n      <Alert severity=\"info\">\n        Click and type within the <strong>label</strong> field to annotate your\n        bookmark. Double click the <strong>label</strong> field to do so within\n        a dialog.\n      </Alert>\n      <div className={classes.flex}>\n        <CascadingMenuButton\n          data-testid=\"grid_bookmark_menu\"\n          menuItems={[\n            {\n              label: 'Export',\n              icon: GetApp,\n              onClick: () => {\n                getSession(model).queueDialog(onClose => [\n                  ExportBookmarksDialog,\n                  { onClose, model },\n                ])\n              },\n            },\n            {\n              label: 'Import',\n              icon: Publish,\n              onClick: () => {\n                getSession(model).queueDialog(onClose => [\n                  ImportBookmarksDialog,\n                  { model, onClose },\n                ])\n              },\n            },\n            {\n              label: 'Delete',\n              icon: Delete,\n              onClick: () => {\n                getSession(model).queueDialog(onClose => [\n                  DeleteBookmarksDialog,\n                  { model, onClose },\n                ])\n              },\n            },\n            {\n              label: 'Share',\n              icon: Share,\n              onClick: () => {\n                getSession(model).queueDialog(onClose => [\n                  ShareBookmarksDialog,\n                  { model, onClose },\n                ])\n              },\n            },\n            {\n              label: 'Edit colors',\n              icon: Palette,\n              onClick: () => {\n                getSession(model).queueDialog(onClose => [\n                  EditHighlightColorDialog,\n                  { model, onClose },\n                ])\n              },\n            },\n            {\n              label: 'Settings',\n              icon: Settings,\n              onClick: () => {\n                getSession(model).queueDialog(onClose => [\n                  HighlightSettingsDialog,\n                  { model, onClose },\n                ])\n              },\n            },\n          ]}\n        >\n          <Menu />\n        </CascadingMenuButton>\n\n        <AssemblySelector model={model} />\n      </div>\n      <BookmarkGrid model={model} />\n    </div>\n  )\n})\n\nexport default GridBookmarkWidget\n","import { assembleLocString, getSession } from '@jbrowse/core/util'\nimport { saveAs } from 'file-saver'\n\nimport type { GridBookmarkModel } from './model'\nimport type { AbstractViewModel } from '@jbrowse/core/util/types'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ntype MaybeLGV = LGV | undefined\n\nexport async function navToBookmark(\n  locString: string,\n  assembly: string,\n  views: AbstractViewModel[],\n  model: GridBookmarkModel,\n) {\n  const session = getSession(model)\n  try {\n    // get the focused view\n    let view = views.find(view => view.id === session.focusedViewId) as MaybeLGV\n\n    // check if the focused view is the appropriate assembly, if not proceed\n    if (view?.assemblyNames[0] !== assembly) {\n      view = views.find(\n        elt =>\n          // @ts-expect-error\n          elt.type === 'LinearGenomeView' && elt.assemblyNames[0] === assembly,\n      ) as MaybeLGV\n    }\n\n    // if no view is opened of the selectedAssembly, open a new\n    // view with that assembly\n    if (!view) {\n      const newViewId = `${model.id}_${assembly}`\n      view = session.addView('LinearGenomeView', {\n        id: newViewId,\n      }) as LGV\n    }\n    await view.navToLocString(locString, assembly)\n  } catch (e) {\n    console.error(e)\n    session.notifyError(`${e}`, e)\n  }\n}\n\nexport function downloadBookmarkFile(\n  fileFormat: string,\n  model: GridBookmarkModel,\n) {\n  const { selectedBookmarks, bookmarksWithValidAssemblies } = model\n  const bookmarksToDownload =\n    selectedBookmarks.length === 0\n      ? bookmarksWithValidAssemblies\n      : selectedBookmarks\n\n  if (fileFormat === 'BED') {\n    const fileHeader = ''\n    const fileContents: Record<string, string[]> = {}\n    bookmarksToDownload.forEach(bookmark => {\n      const { label } = bookmark\n      const labelVal = label === '' ? '.' : label\n      const line = `${bookmark.refName}\\t${bookmark.start}\\t${bookmark.end}\\t${labelVal}\\n`\n\n      if (fileContents[bookmark.assemblyName]) {\n        fileContents[bookmark.assemblyName]!.push(line)\n      } else {\n        fileContents[bookmark.assemblyName] = [line]\n      }\n    })\n\n    for (const assembly in fileContents) {\n      const fileContent = fileContents[assembly]!.reduce(\n        (a, b) => a + b,\n        fileHeader,\n      )\n      const blob = new Blob([fileContent || ''], {\n        type: 'text/x-bed;charset=utf-8',\n      })\n      const fileName = `jbrowse_bookmarks_${assembly}.bed`\n      saveAs(blob, fileName)\n    }\n  } else {\n    // TSV\n    const fileHeader = 'chrom\\tstart\\tend\\tlabel\\tassembly_name\\tcoord_range\\n'\n\n    const fileContents = bookmarksToDownload\n      .map(bookmark => {\n        const { label } = bookmark\n        const labelVal = label === '' ? '.' : label\n        const locString = assembleLocString(bookmark)\n        return `${bookmark.refName}\\t${bookmark.start + 1}\\t${\n          bookmark.end\n        }\\t${labelVal}\\t${bookmark.assemblyName}\\t${locString}\\n`\n      })\n      .reduce((a, b) => a + b, fileHeader)\n\n    const blob = new Blob([fileContents || ''], {\n      type: 'text/tab-separated-values;charset=utf-8',\n    })\n    const fileName = 'jbrowse_bookmarks.tsv'\n    saveAs(blob, fileName)\n  }\n}\n\n/**\n * Pad the end of a base64 string with \"=\" to make it valid\n * @param b64 - unpadded b64 string\n */\nexport function b64PadSuffix(b64: string): string {\n  let num = 0\n  const mo = b64.length % 4\n  switch (mo) {\n    case 3:\n      num = 1\n      break\n    case 2:\n      num = 2\n      break\n    case 0:\n      num = 0\n      break\n    default:\n      throw new Error('base64 not a valid length')\n  }\n  return b64 + '='.repeat(num)\n}\n\n/**\n * Decode and inflate a url-safe base64 to a string\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param b64 - a base64 string to decode and inflate\n */\nexport async function fromUrlSafeB64(b64: string) {\n  const originalB64 = b64PadSuffix(\n    b64.replaceAll('-', '+').replaceAll('_', '/'),\n  )\n  const { toByteArray } = await import('base64-js')\n  const { inflate } = await import('pako')\n  const bytes = toByteArray(originalB64)\n  const inflated = inflate(bytes)\n  return new TextDecoder().decode(inflated)\n}\n\n/**\n * Compress and encode a string as url-safe base64\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param str-  a string to compress and encode\n */\nexport async function toUrlSafeB64(str: string) {\n  const bytes = new TextEncoder().encode(str)\n  const { deflate } = await import('pako')\n  const { fromByteArray } = await import('base64-js')\n  const deflated = deflate(bytes)\n  const encoded = fromByteArray(deflated)\n  const pos = encoded.indexOf('=')\n  return pos > 0\n    ? encoded.slice(0, pos).replaceAll('+', '-').replaceAll('/', '_')\n    : encoded.replaceAll('+', '-').replaceAll('/', '_')\n}\n"],"names":["observer","model","validAssemblies","selectedAssemblies","noAssemblies","size","label","id","selectedSet","Set","isAllSelected","every","e","has","React","FormControl","disabled","fullWidth","InputLabel","Select","labelId","multiple","value","onChange","event","setSelectedAssemblies","target","input","OutlinedInput","renderValue","selected","join","MenuItem","onClickCapture","undefined","preventDefault","Checkbox","checked","indeterminate","length","ListItemText","primary","map","name","key","includes","useStyles","makeStyles","cell","whiteSpace","overflow","textOverflow","classes","bookmarks","bookmarksWithValidAssemblies","selectedBookmarks","session","getSession","rows","filter","r","assemblyName","region","index","rest","locString","assembleLocString","correspondingObj","widths","Math","max","measureText","measureGridWidth","row","style","display","flexDirection","DataGrid","density","columns","GRID_CHECKBOX_SELECTION_COL_DEF","width","field","headerName","renderCell","Link","className","href","onClick","async","views","navToBookmark","editable","ColorPicker","color","updateBookmarkHighlight","processRowUpdate","updateBookmarkLabel","onProcessRowUpdateError","notifyError","checkboxSelection","onRowSelectionModelChange","newRowSelectionModel","setSelectedBookmarks","rowSelectionModel","disableRowSelectionOnClick","ExportBookmarksDialog","lazy","ImportBookmarksDialog","ShareBookmarksDialog","HighlightSettingsDialog","EditHighlightColorDialog","DeleteBookmarksDialog","flex","Alert","severity","CascadingMenuButton","menuItems","icon","GetApp","queueDialog","onClose","Publish","Delete","Share","Palette","Settings","Menu","AssemblySelector","BookmarkGrid","assembly","view","find","focusedViewId","assemblyNames","elt","type","newViewId","addView","navToLocString","console","error","downloadBookmarkFile","fileFormat","bookmarksToDownload","fileHeader","fileContents","forEach","bookmark","labelVal","line","refName","start","end","push","fileContent","reduce","a","b","blob","Blob","fileName","saveAs","fromUrlSafeB64","b64","originalB64","num","Error","repeat","b64PadSuffix","replaceAll","toByteArray","inflate","inflated","TextDecoder","decode","toUrlSafeB64","str","bytes","TextEncoder","encode","deflate","fromByteArray","encoded","pos","indexOf","slice"],"sourceRoot":""}