"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1569],{1569(e,t,o){o.r(t),o.d(t,{default:()=>l});var r=o(30128),n=o(45084),u=o(23886),s=o(61425),i=o(69566),a=o(44460);const l=(0,i.observer)(function(e){const{displayModel:t,width:o,height:i,flatbush:l,items:c,subfeatureFlatbush:d,subfeatureInfos:f=[],onContextMenu:p}=e,I=(0,r.useMemo)(()=>s.A.from(l),[l]),h=(0,r.useMemo)(()=>d?s.A.from(d):null,[d]),b=(0,r.useMemo)(()=>{const e=new Map;for(const t of c)e.set(t.featureId,t);return e},[c]),{selectedFeatureId:v,featureIdUnderMouse:M,subfeatureIdUnderMouse:g,contextMenuFeature:x}=t,m=(0,r.useRef)(null),[y,F]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1),S=(0,r.useRef)(null),k=(0,r.useMemo)(()=>{const e=new Map;for(const t of f)e.set(t.featureId,t);return e},[f]),U=(0,r.useCallback)((e,t)=>{const o=I.search(e,t,e+1,t+1),r=o.length?c[o[0]]:void 0;if(!r)return{item:void 0,featureId:void 0,parentFeatureId:void 0};let n,u=r.featureId;if(h&&f.length){const o=h.search(e,t,e+1,t+1);if(o.length){const e=f[o[0]];e&&(u=e.featureId,n=e.parentFeatureId)}}return{item:r,featureId:u,parentFeatureId:n}},[I,c,h,f]),j=v?k.get(v):void 0,B=v&&!j?b.get(v):void 0,E=M||x?.id(),P=g?k.get(g):void 0,R=E&&!P?b.get(E):void 0;function T(e,t=2){const o=Math.round(e.topPx),r=Math.round(e.bottomPx-e.topPx);return{left:e.leftPx-t,top:o-t,width:e.rightPx-e.leftPx,height:r}}const $=j?T(j):B?T(B):void 0,X=P?T(P,0):R?T(R,0):void 0,Y=Math.ceil(o);return(0,a.jsxs)("div",{ref:m,"data-testid":"canvas-feature-overlay",style:{position:"relative",width:Y,height:i},onMouseLeave:()=>{t.setFeatureIdUnderMouse(void 0),t.setSubfeatureIdUnderMouse(void 0),t.setMouseoverExtraInformation(void 0)},onMouseDown:e=>{if(F(!0),C(!1),m.current){const t=m.current.getBoundingClientRect(),o=m.current.scrollTop;S.current={x:e.clientX-t.left,y:e.clientY-t.top+o}}},onMouseUp:()=>{F(!1)},onMouseMove:e=>{if(!m.current)return;const o=m.current.getBoundingClientRect(),r=m.current.scrollTop,n=e.clientX-o.left,u=e.clientY-o.top+r;if(y&&S.current){const e=n-S.current.x,t=u-S.current.y;Math.sqrt(e*e+t*t)>3&&C(!0)}const{item:s,featureId:i,parentFeatureId:a}=U(n,u);let l=s?.tooltip;if(l&&a){const e=k.get(i);if(e){const{displayLabel:t,type:o}=e;l+=`<br/>${t?`${t} (${o})`:o}`}}t.setFeatureIdUnderMouse(s?.featureId),t.setSubfeatureIdUnderMouse(a?i:void 0),t.setMouseoverExtraInformation(l)},onClick:e=>{if(!w&&m.current){const o=m.current.getBoundingClientRect(),r=m.current.scrollTop,n=e.clientX-o.left,s=e.clientY-o.top+r,{item:i,featureId:a,parentFeatureId:l}=U(n,s);i?t.selectFeatureById(a,l,i.featureId).catch(e=>{console.error(e),(0,u.getSession)(t).notifyError(`${e}`,e)}):t.clearFeatureSelection()}},onContextMenu:e=>{if(m.current){const o=m.current.getBoundingClientRect(),r=m.current.scrollTop,n=e.clientX-o.left,s=e.clientY-o.top+r,{item:i,featureId:a,parentFeatureId:l}=U(n,s);i?t.setContextMenuFeatureById(a,l,i.featureId).catch(e=>{console.error(e),(0,u.getSession)(t).notifyError(`${e}`,e)}):p?.(e)}else p?.(e)},children:[(0,a.jsx)(n.A,{...e,style:{position:"absolute",left:0,top:0}}),X?(0,a.jsx)("div",{style:{position:"absolute",backgroundColor:"#00000033",pointerEvents:"none",zIndex:10,...X}}):null,$?(0,a.jsx)("div",{style:{position:"absolute",border:"2px solid #00b8ff",boxSizing:"content-box",pointerEvents:"none",...$}}):null]})})}}]);
//# sourceMappingURL=1569.19797c95.chunk.js.map