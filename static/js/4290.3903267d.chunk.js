"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4290],{54290(e,r,t){t.d(r,{default:()=>n});var s=t(32560),a=t(23886);class n extends s.D{async configurePre(e){const r=this.getConf("ldLocation"),t=(await(0,a.fetchAndMaybeUnzipText)(r,e)).split("\n").filter(e=>e.trim());if(0===t.length)throw new Error("Empty LD file");const s=this.parseHeader(t[0]),n=[],d=new Set;for(let e=1;e<t.length;e++){const r=this.parseLine(t[e],s);r&&(n.push(r),d.add(r.chrA),d.add(r.chrB))}return{records:n,header:s,refNames:[...d].sort()}}parseHeader(e){const r=e.trim().split(/\s+/),t=e=>{for(const t of e){const e=r.indexOf(t);if(-1!==e)return e}return-1},s=t(["CHR_A","CHR1"]),a=t(["BP_A","BP1","POS_A","POS1"]),n=t(["SNP_A","SNP1","ID_A","ID1"]),d=t(["CHR_B","CHR2"]),i=t(["BP_B","BP2","POS_B","POS2"]),o=t(["SNP_B","SNP2","ID_B","ID2"]),c=t(["R2","R^2","RSQ"]),p=t(["DP","DPRIME","D'"]),h=t(["MAF_A","MAF1"]),u=t(["MAF_B","MAF2"]);if(-1===s||-1===a||-1===d||-1===i)throw new Error(`Invalid PLINK LD header. Expected columns CHR_A, BP_A, CHR_B, BP_B. Got: ${r.join(", ")}`);if(-1===c&&-1===p)throw new Error(`Invalid PLINK LD header. Expected at least R2 or DP column. Got: ${r.join(", ")}`);return{columns:r,hasR2:-1!==c,hasDprime:-1!==p,hasMafA:-1!==h,hasMafB:-1!==u,chrAIdx:s,bpAIdx:a,snpAIdx:n,chrBIdx:d,bpBIdx:i,snpBIdx:o,r2Idx:c,dprimeIdx:p,mafAIdx:h,mafBIdx:u}}async configurePre2(e){return this.configured||(this.configured=this.configurePre(e).catch(e=>{throw this.configured=void 0,e})),this.configured}async configure(e){const{statusCallback:r=()=>{}}=e||{};return(0,a.updateStatus)("Loading LD data",r,()=>this.configurePre2(e))}async getRefNames(e={}){const{refNames:r}=await this.configure(e);return r}async getHeader(e){const{header:r}=await this.configure(e);return r}async getLDRecords(e,r={}){const{refName:t,start:s,end:a}=e,{records:n}=await this.configure(r);return n.filter(e=>e.chrA===t&&e.bpA>=s&&e.bpA<=a)}async getLDRecordsInRegion(e,r={}){const{refName:t,start:s,end:a}=e;return(await this.getLDRecords(e,r)).filter(e=>e.chrB===t&&e.bpB>=s&&e.bpB<=a&&e.chrA===t&&e.bpA>=s&&e.bpA<=a)}parseLine(e,r){const t=e.trim().split(/\s+/),s=t[r.chrAIdx],a=Number.parseInt(t[r.bpAIdx]??"",10),n=r.snpAIdx>=0?t[r.snpAIdx]:`${s}:${a}`,d=t[r.chrBIdx],i=Number.parseInt(t[r.bpBIdx]??"",10),o=r.snpBIdx>=0?t[r.snpBIdx]:`${d}:${i}`;return!s||!d||Number.isNaN(a)||Number.isNaN(i)?null:{chrA:s,bpA:a,snpA:n??`${s}:${a}`,chrB:d,bpB:i,snpB:o??`${d}:${i}`,r2:(r.r2Idx>=0?Number.parseFloat(t[r.r2Idx]??""):void 0)??0,dprime:r.dprimeIdx>=0?Number.parseFloat(t[r.dprimeIdx]??""):void 0,mafA:r.mafAIdx>=0?Number.parseFloat(t[r.mafAIdx]??""):void 0,mafB:r.mafBIdx>=0?Number.parseFloat(t[r.mafBIdx]??""):void 0}}freeResources(){}}}}]);
//# sourceMappingURL=4290.3903267d.chunk.js.map