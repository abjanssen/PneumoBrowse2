"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1689],{1689:(e,s,t)=>{t.r(s),t.d(s,{default:()=>q});var n=t(7552),a=t(67112),o=t(99546),l=t(59570),i=t(68446),r=t(75785),c=t(67758),d=t(7946),m=t(94332),y=t(91818),p=t(94540),h=t(15897),u=t(95054),b=t(61282),f=t(92826),x=t(37962),j=t(69092);function g({radioOption:e,assembly1:s,assembly2:t,fileLocation:n,indexFileLocation:a,bed1Location:o,bed2Location:l}){if(".paf"===e)return{type:"PAFAdapter",pafLocation:n,queryAssembly:s,targetAssembly:t};if(".out"===e)return{type:"MashMapAdapter",outLocation:n,queryAssembly:s,targetAssembly:t};if(".delta"===e)return{type:"DeltaAdapter",deltaLocation:n,queryAssembly:s,targetAssembly:t};if(".chain"===e)return{type:"ChainAdapter",chainLocation:n,queryAssembly:s,targetAssembly:t};if(".anchors"===e)return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:n,bed1Location:o,bed2Location:l,assemblyNames:[s,t]};if(".anchors.simple"===e)return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:n,bed1Location:o,bed2Location:l,assemblyNames:[s,t]};if(".pif.gz"===e)return{type:"PairwiseIndexedPAFAdapter",pifGzLocation:n,index:{location:a},assemblyNames:[s,t]};throw new Error(`Unknown to detect type ${e} from filename (select radio button to clarify)`)}var v=t(69500);const A=(0,i.observer)((function({model:e,assembly1:s,assembly2:t,selectedRow:o}){const[l,i]=(0,n.useState)(!1),[r,c]=(0,n.useState)(),[y,A]=(0,n.useState)(),[S,w]=(0,n.useState)(),[k,C]=(0,n.useState)(),[L,N]=(0,n.useState)(""),[T,F]=(0,n.useState)(),R=(I=S)?I.uri||I.localPath||I.name:void 0;var I;const P=L||(R?function(e){const s=e.split(".").pop();return s?`.${s}`:""}(function(e){return e.endsWith(".gz")?e.slice(0,-3):e}(R)):"");return(0,n.useEffect)((()=>{try{if(S){const n=R?R.split("#")[0].split("?")[0].split("/").pop():"MyTrack",a=`${n}-${Date.now()}-sessionTrack`;F(void 0),e.setImportFormSyntenyTrack(o,{type:"userOpened",value:{trackId:a,name:n,assemblyNames:[t,s],type:"SyntenyTrack",adapter:g({radioOption:P,assembly1:l?t:s,assembly2:l?s:t,fileLocation:S,indexFileLocation:k,bed1Location:y,bed2Location:r})}})}}catch(e){console.error(e),F(e)}}),[l,e,o,R,s,t,y,r,S,k,P]),(0,v.jsxs)(u.A,{style:{padding:12},children:[T?(0,v.jsx)(a.ErrorMessage,{error:T}):null,(0,v.jsx)(b.A,{style:{textAlign:"center"},children:"Add a .paf (minimap2), .delta (Mummer), .chain (UCSC liftover), .anchors or .anchors.simple (MCScan), or .pif.gz (jbrowse CLI make-pif) file to view. These file types can also be gzipped."}),(0,v.jsx)(p.A,{value:P,onChange:e=>{N(e.target.value)},children:(0,v.jsx)(f.A,{container:!0,justifyContent:"center",children:[".paf",".delta",".out",".chain",".anchors",".anchors.simple",".pif.gz"].map((e=>(0,v.jsx)(d.A,{value:e,control:(0,v.jsx)(m.A,{}),label:e},e)))})}),(0,v.jsx)(f.A,{container:!0,justifyContent:"center",children:".paf"===P||".out"===P||".delta"===P||".chain"===P||".pif.gz"===P?(0,v.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,v.jsx)(a.FileSelector,{name:`${P} location`,inline:!0,description:"",location:S,setLocation:e=>{w(e)}}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{children:["Verify or click swap",(0,v.jsx)(x.A,{title:(0,v.jsx)("code",{children:{".paf":"minimap2 target.fa query.fa",".pif.gz":"minimap2 target.fa query.fa",".out":"mashmap target.fa query.fa",".delta":"mummer target.fa query.fa",".chain":"e.g. queryToTarget.chain"}[P]}),children:(0,v.jsx)(h.A,{})})]}),(0,v.jsxs)("div",{style:{display:"flex",gap:20},children:[(0,v.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,alignItems:"center"},children:[(0,v.jsx)("div",{children:(0,v.jsx)("i",{children:l?t:s})}),(0,v.jsx)("div",{children:"query assembly"}),(0,v.jsx)("div",{children:(0,v.jsx)("i",{children:l?s:t})}),(0,v.jsx)("div",{children:"target assembly"})]}),(0,v.jsx)(j.A,{variant:"contained",onClick:()=>{i(!l)},children:"Swap?"})]})]})]}):".anchors"===L||".anchors.simple"===L?(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{style:{margin:20},children:["Open the ",L," and .bed files for both genome assemblies from the MCScan (Python version) pipeline"," ",(0,v.jsx)("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)(a.FileSelector,{inline:!0,name:L,location:S,setLocation:e=>{w(e)}}),(0,v.jsx)(a.FileSelector,{inline:!0,name:"genome 1 .bed (left column of anchors file)",description:"",location:y,setLocation:e=>{A(e)}}),(0,v.jsx)(a.FileSelector,{inline:!0,name:"genome 2 .bed (right column of anchors file)",description:"",location:r,setLocation:e=>{c(e)}})]}),(0,v.jsxs)("div",{style:{margin:"auto",display:"flex",justifyContent:"center",gap:20},children:[(0,v.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,alignItems:"center"},children:[(0,v.jsx)("div",{children:(0,v.jsx)("i",{children:l?t:s})}),(0,v.jsx)("div",{children:"bed1 assembly"}),(0,v.jsx)("div",{children:(0,v.jsx)("i",{children:l?s:t})}),(0,v.jsx)("div",{children:"bed2 assembly"})]}),(0,v.jsx)(j.A,{variant:"contained",onClick:()=>{i(!l)},children:"Swap?"})]})]}):".pif.gz"===L?(0,v.jsxs)("div",{style:{display:"flex"},children:[(0,v.jsx)("div",{children:(0,v.jsx)(a.FileSelector,{name:`${L} location`,description:"",location:S,setLocation:e=>{w(e)}})}),(0,v.jsx)("div",{children:(0,v.jsx)(a.FileSelector,{name:`${L} index location`,description:"",location:k,setLocation:e=>{C(e)}})})]}):(0,v.jsx)(a.FileSelector,{name:L?`${L} location`:"",description:"",location:S,setLocation:e=>{w(e)}})})]})}));var S=t(68584),w=t(91468),k=t(21049),C=t(10240);const L=(0,i.observer)((function({model:e,selectedRow:s,assembly1:t,assembly2:l}){const i=(0,o.getSession)(e),{importFormSyntenyTrackSelections:r}=e,{tracks:c=[],sessionTracks:d=[]}=i,m=[...c,...d].filter((e=>{const s=(0,S.readConfObject)(e,"assemblyNames");return s.includes(t)&&s.includes(l)&&e.type.includes("Synteny")})),y=m[0]?.trackId||"",p=r[s],h="preConfigured"===p?.type?p.value:void 0;return(0,n.useEffect)((()=>{e.setImportFormSyntenyTrack(s,{type:"preConfigured",value:y})}),[l,t,y,s,e]),(0,v.jsxs)(u.A,{style:{padding:12},children:[(0,v.jsx)(b.A,{children:'Select a track from the select box below, the track will be shown when you hit "Launch".'}),h&&m.map((e=>e.trackId)).includes(h)?(0,v.jsx)(k.A,{value:h,onChange:t=>{e.setImportFormSyntenyTrack(s,{type:"preConfigured",value:t.target.value})},children:m.map((e=>(0,v.jsx)(C.A,{value:e.trackId,children:(0,w.getTrackName)(e,i)},e.trackId)))}):(0,v.jsx)(a.ErrorMessage,{error:`No synteny tracks found for ${t},${l}`})]})}));function N(e){const s=(0,c.c)(27),{model:t,assembly1:a,assembly2:o,selectedRow:l}=e,[i,r]=(0,n.useState)("tracklist");let h,u,b,f,x,j,g,S,w,k;return s[0]!==i||s[1]!==t||s[2]!==l?(h=()=>{"none"===i&&t.setImportFormSyntenyTrack(l,{type:"none"})},u=[i,t,l],s[0]=i,s[1]=t,s[2]=l,s[3]=h,s[4]=u):(h=s[3],u=s[4]),(0,n.useEffect)(h,u),s[5]===Symbol.for("react.memo_cache_sentinel")?(b=e=>{r(e.target.value)},s[5]=b):b=s[5],s[6]===Symbol.for("react.memo_cache_sentinel")?(f=(0,v.jsx)(d.A,{value:"none",control:(0,v.jsx)(m.A,{}),label:"None"}),s[6]=f):f=s[6],s[7]===Symbol.for("react.memo_cache_sentinel")?(x=(0,v.jsx)(d.A,{value:"tracklist",control:(0,v.jsx)(m.A,{}),label:"Existing track"}),s[7]=x):x=s[7],s[8]===Symbol.for("react.memo_cache_sentinel")?(j=(0,v.jsx)(d.A,{value:"custom",control:(0,v.jsx)(m.A,{}),label:"New track"}),s[8]=j):j=s[8],s[9]!==i?(g=(0,v.jsx)(y.A,{children:(0,v.jsxs)(p.A,{row:!0,value:i,"aria-labelledby":"group-label",onChange:b,children:[f,x,j]})}),s[9]=i,s[10]=g):g=s[10],s[11]!==a||s[12]!==o||s[13]!==i||s[14]!==t||s[15]!==l?(S="custom"===i?(0,v.jsx)(A,{model:t,selectedRow:l,assembly2:o,assembly1:a}):null,s[11]=a,s[12]=o,s[13]=i,s[14]=t,s[15]=l,s[16]=S):S=s[16],s[17]!==a||s[18]!==o||s[19]!==i||s[20]!==t||s[21]!==l?(w="tracklist"===i?(0,v.jsx)(L,{model:t,selectedRow:l,assembly1:a,assembly2:o}):null,s[17]=a,s[18]=o,s[19]=i,s[20]=t,s[21]=l,s[22]=w):w=s[22],s[23]!==g||s[24]!==S||s[25]!==w?(k=(0,v.jsxs)("div",{children:[g,S,w]}),s[23]=g,s[24]=S,s[25]=w,s[26]=k):k=s[26],k}var T=t(93459),F=t(84340),R=t(89870);const I=(0,r.n9)()((e=>({mb:{marginBottom:10},button:{margin:e.spacing(2)},rel:{position:"relative"},synbutton:{position:"absolute",top:30},bg:{background:e.palette.divider}}))),P=(0,i.observer)((function({selectedRow:e,selectedAssemblyNames:s,setSelectedRow:t,setSelectedAssemblyNames:n,model:l}){const{classes:i,cx:r}=I(),c=(0,o.getSession)(l);return s.map(((d,m)=>(0,v.jsxs)("div",{className:i.rel,children:[(0,v.jsxs)("span",{children:["Row ",m+1,": "]}),(0,v.jsx)(R.A,{disabled:s.length<=2,onClick:()=>{l.importFormRemoveRow(m),n(s.map(((e,s)=>s===m?void 0:e)).filter(o.notEmpty)),e>=s.length-2&&t(0)},children:(0,v.jsx)(F.A,{})}),(0,v.jsx)(a.AssemblySelector,{helperText:"",selected:d,onChange:e=>{n(s.map(((s,t)=>t===m?e:s)))},session:c}),m!==s.length-1?(0,v.jsx)(R.A,{"data-testid":"synbutton",className:r(i.synbutton,m===e?i.bg:void 0),onClick:()=>{t(m)},children:(0,v.jsx)(T.A,{})}):null]},`${d}-${m}`)))})),M=(0,i.observer)((function({model:e,selectedAssemblyNames:s,setSelectedAssemblyNames:t,selectedRow:n,setSelectedRow:a,defaultAssemblyName:o,onLaunch:l}){const{classes:i}=I();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:i.mb,children:"Select assemblies for linear synteny view"}),(0,v.jsx)(P,{model:e,selectedAssemblyNames:s,setSelectedAssemblyNames:t,selectedRow:n,setSelectedRow:a}),(0,v.jsxs)("div",{children:[(0,v.jsx)(j.A,{className:i.button,variant:"contained",color:"secondary",onClick:()=>{t([...s,o])},children:"Add row"}),(0,v.jsx)(j.A,{className:i.button,onClick:l,variant:"contained",color:"primary",children:"Launch"})]})]})}));var $=t(42489);const _=(0,r.n9)()((e=>({importFormContainer:{padding:e.spacing(4)},flex:{display:"flex",gap:90},rightPanel:{flexGrow:11},leftPanel:{flexGrow:4,flexShrink:0}}))),q=(0,i.observer)((function({model:e}){const{classes:s}=_(),t=(0,o.getSession)(e),{assemblyNames:i}=t,r=i[0]||"",[c,d]=(0,n.useState)(0),[m,y]=(0,n.useState)([r,r]),[p,h]=(0,n.useState)();return(0,v.jsxs)(l.A,{className:s.importFormContainer,children:[p?(0,v.jsx)(a.ErrorMessage,{error:p}):null,(0,v.jsxs)("div",{className:s.flex,children:[(0,v.jsx)("div",{className:s.leftPanel,children:(0,v.jsx)(M,{model:e,selectedAssemblyNames:m,setSelectedAssemblyNames:y,selectedRow:c,setSelectedRow:d,defaultAssemblyName:r,onLaunch:()=>{(async()=>{try{h(void 0),await async function({selectedAssemblyNames:e,model:s}){const t=(0,o.getSession)(s),{assemblyManager:n}=t,{importFormSyntenyTrackSelections:a}=s;s.setViews(await Promise.all(e.map((async e=>{const s=await n.waitForAssembly(e);if(!s)throw new Error(`Assembly "${e}" failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:s.regions}}))));for(const e of s.views)e.setWidth(s.width),e.showAllRegions();(0,o.isSessionWithAddTracks)(t)?(0,$.toJS)(a).map(((e,n)=>{"userOpened"===e.type?(t.addTrackConf(e.value),s.toggleTrack(e.value?.trackId,n)):"preConfigured"===e.type&&s.showTrack(e.value,n)})):t.notify("Can't add tracks","warning"),s.clearImportFormSyntenyTracks()}({selectedAssemblyNames:m,model:e})}catch(e){console.error(e),h(e)}})()}})}),(0,v.jsxs)("div",{className:s.rightPanel,children:[(0,v.jsxs)("div",{children:["Synteny dataset to display between row ",c+1," and"," ",c+2]}),(0,v.jsx)(N,{model:e,selectedRow:c,assembly1:m[c],assembly2:m[c+1]})]})]})]})}))}}]);
//# sourceMappingURL=1689.5b651f38.chunk.js.map