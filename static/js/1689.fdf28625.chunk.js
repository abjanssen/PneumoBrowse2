"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1689],{1689:(e,s,t)=>{t.r(s),t.d(s,{default:()=>q});var n=t(7552),a=t(67112),i=t(99546),l=t(59570),o=t(68446),r=t(75785),c=t(91818),d=t(94540),m=t(7946),y=t(94332),p=t(15897),h=t(95054),u=t(61282),b=t(92826),f=t(37962),x=t(69092);function j({radioOption:e,assembly1:s,assembly2:t,fileLocation:n,indexFileLocation:a,bed1Location:i,bed2Location:l}){if(".paf"===e)return{type:"PAFAdapter",pafLocation:n,queryAssembly:s,targetAssembly:t};if(".out"===e)return{type:"MashMapAdapter",outLocation:n,queryAssembly:s,targetAssembly:t};if(".delta"===e)return{type:"DeltaAdapter",deltaLocation:n,queryAssembly:s,targetAssembly:t};if(".chain"===e)return{type:"ChainAdapter",chainLocation:n,queryAssembly:s,targetAssembly:t};if(".anchors"===e)return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:n,bed1Location:i,bed2Location:l,assemblyNames:[s,t]};if(".anchors.simple"===e)return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:n,bed1Location:i,bed2Location:l,assemblyNames:[s,t]};if(".pif.gz"===e)return{type:"PairwiseIndexedPAFAdapter",pifGzLocation:n,index:{location:a},assemblyNames:[s,t]};throw new Error(`Unknown to detect type ${e} from filename (select radio button to clarify)`)}var g=t(69500);const v=(0,o.observer)((function({model:e,assembly1:s,assembly2:t,selectedRow:i}){const[l,o]=(0,n.useState)(!1),[r,c]=(0,n.useState)(),[v,A]=(0,n.useState)(),[w,S]=(0,n.useState)(),[k,C]=(0,n.useState)(),[L,N]=(0,n.useState)(""),[T,F]=(0,n.useState)(),R=(I=w)?I.uri||I.localPath||I.name:void 0;var I;const P=L||(R?function(e){const s=e.split(".").pop();return s?`.${s}`:""}(function(e){return e.endsWith(".gz")?e.slice(0,-3):e}(R)):"");return(0,n.useEffect)((()=>{try{if(w){const n=R?R.split("#")[0].split("?")[0].split("/").pop():"MyTrack",a=`${n}-${Date.now()}-sessionTrack`;F(void 0),e.setImportFormSyntenyTrack(i,{type:"userOpened",value:{trackId:a,name:n,assemblyNames:[t,s],type:"SyntenyTrack",adapter:j({radioOption:P,assembly1:l?t:s,assembly2:l?s:t,fileLocation:w,indexFileLocation:k,bed1Location:v,bed2Location:r})}})}}catch(e){console.error(e),F(e)}}),[l,e,i,R,s,t,v,r,w,k,P]),(0,g.jsxs)(h.A,{style:{padding:12},children:[T?(0,g.jsx)(a.ErrorMessage,{error:T}):null,(0,g.jsx)(u.A,{style:{textAlign:"center"},children:"Add a .paf (minimap2), .delta (Mummer), .chain (UCSC liftover), .anchors or .anchors.simple (MCScan), or .pif.gz (jbrowse CLI make-pif) file to view. These file types can also be gzipped."}),(0,g.jsx)(d.A,{value:P,onChange:e=>{N(e.target.value)},children:(0,g.jsx)(b.A,{container:!0,justifyContent:"center",children:[".paf",".delta",".out",".chain",".anchors",".anchors.simple",".pif.gz"].map((e=>(0,g.jsx)(m.A,{value:e,control:(0,g.jsx)(y.A,{}),label:e},e)))})}),(0,g.jsx)(b.A,{container:!0,justifyContent:"center",children:".paf"===P||".out"===P||".delta"===P||".chain"===P||".pif.gz"===P?(0,g.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,g.jsx)(a.FileSelector,{name:`${P} location`,inline:!0,description:"",location:w,setLocation:e=>{S(e)}}),(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{children:["Verify or click swap",(0,g.jsx)(f.A,{title:(0,g.jsx)("code",{children:{".paf":"minimap2 target.fa query.fa",".pif.gz":"minimap2 target.fa query.fa",".out":"mashmap target.fa query.fa",".delta":"mummer target.fa query.fa",".chain":"e.g. queryToTarget.chain"}[P]}),children:(0,g.jsx)(p.A,{})})]}),(0,g.jsxs)("div",{style:{display:"flex",gap:20},children:[(0,g.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,alignItems:"center"},children:[(0,g.jsx)("div",{children:(0,g.jsx)("i",{children:l?t:s})}),(0,g.jsx)("div",{children:"query assembly"}),(0,g.jsx)("div",{children:(0,g.jsx)("i",{children:l?s:t})}),(0,g.jsx)("div",{children:"target assembly"})]}),(0,g.jsx)(x.A,{variant:"contained",onClick:()=>{o(!l)},children:"Swap?"})]})]})]}):".anchors"===L||".anchors.simple"===L?(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{style:{margin:20},children:["Open the ",L," and .bed files for both genome assemblies from the MCScan (Python version) pipeline"," ",(0,g.jsx)("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)(a.FileSelector,{inline:!0,name:L,location:w,setLocation:e=>{S(e)}}),(0,g.jsx)(a.FileSelector,{inline:!0,name:"genome 1 .bed (left column of anchors file)",description:"",location:v,setLocation:e=>{A(e)}}),(0,g.jsx)(a.FileSelector,{inline:!0,name:"genome 2 .bed (right column of anchors file)",description:"",location:r,setLocation:e=>{c(e)}})]}),(0,g.jsxs)("div",{style:{margin:"auto",display:"flex",justifyContent:"center",gap:20},children:[(0,g.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,alignItems:"center"},children:[(0,g.jsx)("div",{children:(0,g.jsx)("i",{children:l?t:s})}),(0,g.jsx)("div",{children:"bed1 assembly"}),(0,g.jsx)("div",{children:(0,g.jsx)("i",{children:l?s:t})}),(0,g.jsx)("div",{children:"bed2 assembly"})]}),(0,g.jsx)(x.A,{variant:"contained",onClick:()=>{o(!l)},children:"Swap?"})]})]}):".pif.gz"===L?(0,g.jsxs)("div",{style:{display:"flex"},children:[(0,g.jsx)("div",{children:(0,g.jsx)(a.FileSelector,{name:`${L} location`,description:"",location:w,setLocation:e=>{S(e)}})}),(0,g.jsx)("div",{children:(0,g.jsx)(a.FileSelector,{name:`${L} index location`,description:"",location:k,setLocation:e=>{C(e)}})})]}):(0,g.jsx)(a.FileSelector,{name:L?`${L} location`:"",description:"",location:w,setLocation:e=>{S(e)}})})]})}));var A=t(68584),w=t(91468),S=t(21049),k=t(10240);const C=(0,o.observer)((function({model:e,selectedRow:s,assembly1:t,assembly2:l}){const o=(0,i.getSession)(e),{importFormSyntenyTrackSelections:r}=e,{tracks:c=[],sessionTracks:d=[]}=o,m=[...c,...d].filter((e=>{const s=(0,A.readConfObject)(e,"assemblyNames");return s.includes(t)&&s.includes(l)&&e.type.includes("Synteny")})),y=m[0]?.trackId||"",p=r[s],b="preConfigured"===p?.type?p.value:void 0;return(0,n.useEffect)((()=>{e.setImportFormSyntenyTrack(s,{type:"preConfigured",value:y})}),[l,t,y,s,e]),(0,g.jsxs)(h.A,{style:{padding:12},children:[(0,g.jsx)(u.A,{children:'Select a track from the select box below, the track will be shown when you hit "Launch".'}),b&&m.map((e=>e.trackId)).includes(b)?(0,g.jsx)(S.A,{value:b,onChange:t=>{e.setImportFormSyntenyTrack(s,{type:"preConfigured",value:t.target.value})},children:m.map((e=>(0,g.jsx)(k.A,{value:e.trackId,children:(0,w.getTrackName)(e,o)},e.trackId)))}):(0,g.jsx)(a.ErrorMessage,{error:`No synteny tracks found for ${t},${l}`})]})}));function L({model:e,assembly1:s,assembly2:t,selectedRow:a}){const[i,l]=(0,n.useState)("tracklist");return(0,n.useEffect)((()=>{"none"===i&&e.setImportFormSyntenyTrack(a,{type:"none"})}),[i,e,a]),(0,g.jsxs)("div",{children:[(0,g.jsx)(c.A,{children:(0,g.jsxs)(d.A,{row:!0,value:i,"aria-labelledby":"group-label",onChange:e=>{l(e.target.value)},children:[(0,g.jsx)(m.A,{value:"none",control:(0,g.jsx)(y.A,{}),label:"None"}),(0,g.jsx)(m.A,{value:"tracklist",control:(0,g.jsx)(y.A,{}),label:"Existing track"}),(0,g.jsx)(m.A,{value:"custom",control:(0,g.jsx)(y.A,{}),label:"New track"})]})}),"custom"===i?(0,g.jsx)(v,{model:e,selectedRow:a,assembly2:t,assembly1:s}):null,"tracklist"===i?(0,g.jsx)(C,{model:e,selectedRow:a,assembly1:s,assembly2:t}):null]})}var N=t(93459),T=t(84340),F=t(89870);const R=(0,r.n9)()((e=>({mb:{marginBottom:10},button:{margin:e.spacing(2)},rel:{position:"relative"},synbutton:{position:"absolute",top:30},bg:{background:e.palette.divider}}))),I=(0,o.observer)((function({selectedRow:e,selectedAssemblyNames:s,setSelectedRow:t,setSelectedAssemblyNames:n,model:l}){const{classes:o,cx:r}=R(),c=(0,i.getSession)(l);return s.map(((d,m)=>(0,g.jsxs)("div",{className:o.rel,children:[(0,g.jsxs)("span",{children:["Row ",m+1,": "]}),(0,g.jsx)(F.A,{disabled:s.length<=2,onClick:()=>{l.importFormRemoveRow(m),n(s.map(((e,s)=>s===m?void 0:e)).filter(i.notEmpty)),e>=s.length-2&&t(0)},children:(0,g.jsx)(T.A,{})}),(0,g.jsx)(a.AssemblySelector,{helperText:"",selected:d,onChange:e=>{n(s.map(((s,t)=>t===m?e:s)))},session:c}),m!==s.length-1?(0,g.jsx)(F.A,{"data-testid":"synbutton",className:r(o.synbutton,m===e?o.bg:void 0),onClick:()=>{t(m)},children:(0,g.jsx)(N.A,{})}):null]},`${d}-${m}`)))})),P=(0,o.observer)((function({model:e,selectedAssemblyNames:s,setSelectedAssemblyNames:t,selectedRow:n,setSelectedRow:a,defaultAssemblyName:i,onLaunch:l}){const{classes:o}=R();return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:o.mb,children:"Select assemblies for linear synteny view"}),(0,g.jsx)(I,{model:e,selectedAssemblyNames:s,setSelectedAssemblyNames:t,selectedRow:n,setSelectedRow:a}),(0,g.jsxs)("div",{children:[(0,g.jsx)(x.A,{className:o.button,variant:"contained",color:"secondary",onClick:()=>{t([...s,i])},children:"Add row"}),(0,g.jsx)(x.A,{className:o.button,onClick:l,variant:"contained",color:"primary",children:"Launch"})]})]})}));var M=t(42489);const $=(0,r.n9)()((e=>({importFormContainer:{padding:e.spacing(4)},flex:{display:"flex",gap:90},rightPanel:{flexGrow:11},leftPanel:{flexGrow:4,flexShrink:0}}))),q=(0,o.observer)((function({model:e}){const{classes:s}=$(),t=(0,i.getSession)(e),{assemblyNames:o}=t,r=o[0]||"",[c,d]=(0,n.useState)(0),[m,y]=(0,n.useState)([r,r]),[p,h]=(0,n.useState)();return(0,g.jsxs)(l.A,{className:s.importFormContainer,children:[p?(0,g.jsx)(a.ErrorMessage,{error:p}):null,(0,g.jsxs)("div",{className:s.flex,children:[(0,g.jsx)("div",{className:s.leftPanel,children:(0,g.jsx)(P,{model:e,selectedAssemblyNames:m,setSelectedAssemblyNames:y,selectedRow:c,setSelectedRow:d,defaultAssemblyName:r,onLaunch:()=>{(async()=>{try{h(void 0),await async function({selectedAssemblyNames:e,model:s}){const t=(0,i.getSession)(s),{assemblyManager:n}=t,{importFormSyntenyTrackSelections:a}=s;s.setViews(await Promise.all(e.map((async e=>{const s=await n.waitForAssembly(e);if(!s)throw new Error(`Assembly "${e}" failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:s.regions}}))));for(const e of s.views)e.setWidth(s.width),e.showAllRegions();(0,i.isSessionWithAddTracks)(t)?(0,M.toJS)(a).map(((e,n)=>{"userOpened"===e.type?(t.addTrackConf(e.value),s.toggleTrack(e.value?.trackId,n)):"preConfigured"===e.type&&s.showTrack(e.value,n)})):t.notify("Can't add tracks","warning"),s.clearImportFormSyntenyTracks()}({selectedAssemblyNames:m,model:e})}catch(e){console.error(e),h(e)}})()}})}),(0,g.jsxs)("div",{className:s.rightPanel,children:[(0,g.jsxs)("div",{children:["Synteny dataset to display between row ",c+1," and"," ",c+2]}),(0,g.jsx)(L,{model:e,selectedRow:c,assembly1:m[c],assembly2:m[c+1]})]})]})]})}))}}]);
//# sourceMappingURL=1689.fdf28625.chunk.js.map