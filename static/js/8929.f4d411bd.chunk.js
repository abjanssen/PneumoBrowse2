"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5904,8929],{35904:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(68584),s=n(46377),r=n(99546),o=n(99834),c=n(32595),i=n(66885),l=n(27087),u=n(72147),f=n(78054);function m(e){const[t,n]=e.reduce((([e,t],[n,a])=>[e+n*a,t+a]),[0,0]);return t/n}const{parseCigar:h}=l.aF;class d extends s.BaseFeatureDataAdapter{static capabilities=["getFeatures","getRefNames"];async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch((e=>{throw this.setupP=void 0,e}))),this.setupP}async setupPre(e){const t=this.pluginManager,n=(0,o.openLocation)(this.getConf("pafLocation"),t),a=await(0,r.fetchAndMaybeUnzip)(n,e);return(0,f.PX)(a,f.xI,e)}async hasDataForRefName(){return!0}getAssemblyNames(){const e=this.getConf("assemblyNames");return 0===e.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}async getRefNames(e={}){const t=e.regions?.[0].assemblyName,n=await this.setup(e),a=this.getAssemblyNames().indexOf(t);if(-1!==a){const e=new Set;for(const t of n)e.add(0===a?t.qname:t.tname);return[...e]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(e,t={}){return(0,i.ObservableCreate)((async n=>{let s=await this.setup(t);const{config:r}=t;r&&"meanQueryIdentity"===(0,a.readConfObject)(r,"colorBy")&&(s=function(e){const t={};for(const n of e){const e=`${n.qname}-${n.tname}`;t[e]||(t[e]={quals:[],len:[]}),t[e].quals.push(n.extra.mappingQual||1),t[e].len.push(n.extra.blockLen||1)}const n=Object.fromEntries(Object.entries(t).map((([e,t])=>[e,m((0,f.yU)(t.quals,t.len))])));for(const t of e){const e=`${t.qname}-${t.tname}`;t.extra.meanScore=n[e]}let a=1e4,s=0;for(const t of e)a=Math.min(t.extra.meanScore||0,a),s=Math.max(t.extra.meanScore||0,s);for(const t of e){const e=t.extra.meanScore||0;t.extra.meanScore=(e-a)/(s-a)}return e}(s));const o=this.getAssemblyNames(),{start:i,end:l,refName:d,assemblyName:p}=e,g=o.indexOf(p),b=0===g;-1===g&&(console.warn(`${p} not found in this adapter`),n.complete());for(let e=0;e<s.length;e++){const t=s[e];let a=0,r=0,m="",g="",y=0,x=0;b?(a=t.qstart,r=t.qend,m=t.qname,g=t.tname,y=t.tstart,x=t.tend):(a=t.tstart,r=t.tend,m=t.tname,g=t.qname,y=t.qstart,x=t.qend);const{extra:q,strand:M}=t;if(m===d&&(0,c.R6)(i,l,a,r)){const{numMatches:t=0,blockLen:s=1,cg:c,...i}=q;let l=q.cg;q.cg&&(b&&-1===M?l=(0,f.qm)(h(q.cg)).join(""):b&&(l=(0,f.gJ)(q.cg))),n.next(new u.A({uniqueId:e+p,assemblyName:p,start:a,end:r,type:"match",refName:m,strand:M,...i,CIGAR:l,syntenyId:e,identity:t/s,numMatches:t,blockLen:s,mate:{start:y,end:x,refName:g,assemblyName:o[+b]}}))}}n.complete()}))}freeResources(){}}},72147:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(99546),s=n(27087);const{getMismatches:r}=s.aF;class o extends a.SimpleFeature{get(e){return"mismatches"===e?r(this.get("CIGAR")):super.get(e)}}},78054:(e,t,n)=>{n.d(t,{PX:()=>c,TA:()=>r,fY:()=>s,gJ:()=>u,qm:()=>l,xI:()=>i,yU:()=>o});var a=n(99546);function s(e){return new Map(e.split(/\n|\r\n|\r/).filter((e=>!!e||e.startsWith("#"))).map((e=>{const[t,n,a,s,r,o]=e.split("\t");return[s,{refName:t,start:+n,end:+a,score:+r,name:s,strand:"-"===o?-1:1}]})))}async function r(e,t){return(0,a.fetchAndMaybeUnzipText)(e,t)}function o(e,t){return e.map(((e,n)=>[e,t[n]]))}function c(e,t,n){const{statusCallback:a=()=>{}}=n||{};let s=0;const r=[],o=new TextDecoder("utf8");let c=0;for(;s<e.length;){const n=e.indexOf(10,s);if(-1===n)break;const i=e.subarray(s,n),l=o.decode(i).trim();if(l){const e=t(l);e&&r.push(e)}c++%1e4==0&&a(`Loading ${Math.floor(s/1e6).toLocaleString("en-US")}/${Math.floor(e.length/1e6).toLocaleString("en-US")} MB`),s=n+1}return r}function i(e){const t=e.split("\t"),n=t.slice(12),a={numMatches:+t[9],blockLen:+t[10],mappingQual:+t[11]};if(n.length)for(const e of n){const t=e.indexOf(":");a[e.slice(0,t)]=e.slice(t+3)}return{tname:t[5],tstart:+t[7],tend:+t[8],qname:t[0],qstart:+t[2],qend:+t[3],strand:"-"===t[4]?-1:1,extra:a}}function l(e){const t=[];for(let n=e.length-2;n>=0;n-=2){t.push(e[n]);const a=e[n+1];"D"===a?t.push("I"):"I"===a?t.push("D"):t.push(a)}return t}function u(e){return e.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}},98929:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var a=n(99546),s=n(99834);function r(e,t,n,a,s,r,o,c,i){return{qname:e,qstart:t,qend:n,tname:s,tstart:r,tend:o,strand:"-"===a?-1:1,extra:{numMatches:i,blockLen:Math.max(n-t,o-r),mappingQual:0,cg:c}}}var o=n(35904);class c extends o.default{async setupPre(e){const t=(0,s.openLocation)(this.getConf("chainLocation"),this.pluginManager);return function(e){const{statusCallback:t=()=>{}}={};let n="",a=0,s=0,o="",c="",i="",l=0,u=0,f=0,m="";const h=[];let d=0,p=0;const g=new TextDecoder("utf8");for(;p<e.length;){d++%1e4==0&&t(`Loading ${Math.floor(p/1e6).toLocaleString("en-US")}/${Math.floor(e.length/1e6).toLocaleString("en-US")} MB`);const b=e.indexOf(10,p);if(-1===b)break;const y=e.subarray(p,b);p=b+1;const x=g.decode(y).trim().replaceAll(" ","\t").split("\t");if("chain"===x[0]){if(m&&h.push(r(o,l,u,i,n,a,s,m,f)),n=x[2],a=+x[5],s=+x[6],o=x[7],c=x[8],i=x[9],l=+x[10],u=+x[11],"-"===i){const e=l;l=+c-u,u=+c-e}f=0,m=""}else{const e=+x[0]||0,t=x.length>1?+x[1]:0,n=x.length>2?+x[2]:0;0!==e&&(f+=+e,m+=`${e}M`),0!==n&&(m+=`${n}I`),0!==t&&(m+=`${t}D`)}}return m&&r(o,l,u,i,n,a,s,m,f),h}(await(0,a.fetchAndMaybeUnzip)(t,e))}}}}]);
//# sourceMappingURL=8929.f4d411bd.chunk.js.map