"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1062],{11062(t,e,r){r.d(e,{default:()=>f});var n=r(37710),s=r(49964),a=r(48455),o=r(77251),i=r(53155),c=r(33624),u=r(94645),d=r(86618),l=r(50268);class f extends a.L{intervalTrees={};static capabilities=["getFeatures","getRefNames"];async loadDataP(t){const e=this.getConf("bedLocation"),r=await(0,o.fetchAndMaybeUnzip)((0,c.openLocation)(e,this.pluginManager),t),n=[],a={};(0,u.P)(r,t=>{if(t.startsWith("#"))n.push(t);else{const e=t.indexOf("\t"),r=t.slice(0,e);a[r]||(a[r]=[]),a[r].push(t)}return!0},t?.statusCallback);const i=n.join("\n"),d=this.getConf("autoSql"),l=new s.A({autoSql:d}),f=this.getConf("columnNames"),h=this.getConf("scoreColumn"),m=this.getConf("colRef"),p=this.getConf("colStart"),b=this.getConf("colEnd");return{header:i,features:a,parser:l,columnNames:f,scoreColumn:h,colRef:m,colStart:p,colEnd:b}}async loadData(t={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(t).catch(t=>{throw this.bedFeatures=void 0,t})),this.bedFeatures}async getRefNames(t={}){const{features:e}=await this.loadData(t);return Object.keys(e)}async getHeader(t={}){const{header:e}=await this.loadData(t);return e}async getNames(){const{header:t,columnNames:e}=await this.loadData();if(e.length)return e;const r=t.split(/\n|\r\n|\r/).filter(t=>!!t).at(-1);return r?.includes("\t")?r.slice(1).split("\t").map(t=>t.trim()):void 0}async loadFeatureIntervalTreeHelper(t){const{colRef:e,colStart:r,colEnd:s,features:a,parser:o,scoreColumn:c}=await this.loadData(),u=a[t];if(!u)return;const d=await this.getNames(),f=new n.MF;for(let n=0;n<u.length;n++){const a=u[n],h=`${this.id}-${t}-${n}`,m=new i.A((0,l.dE)({line:a,colRef:e,colStart:r,colEnd:s,scoreColumn:c,parser:o,uniqueId:h,names:d}));f.insert([m.get("start"),m.get("end")],m)}return f}async loadFeatureIntervalTree(t){return this.intervalTrees[t]||(this.intervalTrees[t]=this.loadFeatureIntervalTreeHelper(t).catch(e=>{throw this.intervalTrees[t]=void 0,e})),this.intervalTrees[t]}getFeatures(t,e={}){return(0,d.ObservableCreate)(async e=>{const{start:r,end:n,refName:s}=t,a=await this.loadFeatureIntervalTree(s),o=a?.search([r,n]);if(o)for(const t of o)e.next(t);e.complete()},e.stopToken)}}},50268(t,e,r){function n(t){const e=t?.trim().split(" ");return[0,1,2,3,5,6].every(t=>void 0!==e?.[t]&&!Number.isNaN(+e[t]))}function s(t){if(n(t)){const[e,r,n,s,a,o,i,c,u,d,l,f,h,m,p]=t.trim().split(" ");return{bitsw_score:e,percent_div:r,percent_del:n,percent_ins:s,query_chr:a,query_begin:o,query_end:i,query_remaining:c,orientation:u,matching_repeat_name:d,matching_repeat_class:l,matching_repeat_begin:f,matching_repeat_end:h,matching_repeat_remaining:m,repeat_id:p}}return{description:t}}function a(t){return(3-t)%3}function o({line:t,colRef:e,colStart:r,colEnd:n,scoreColumn:s,parser:a,uniqueId:o,names:c}){const u=t.split("\t");return i({splitLine:u,refName:u[e],start:Number.parseInt(u[r],10),end:Number.parseInt(u[n],10)+(r===n?1:0),parser:a,uniqueId:o,scoreColumn:s,names:c})}function i({splitLine:t,refName:e,start:r,end:o,parser:i,uniqueId:u,scoreColumn:d,names:l}){const f=l?function(t,e){const r={};let n=!1;for(const[s,a]of e.entries()){const e=t[s];e&&(r[e]=a,"blockCount"===e&&(n=!0))}if(n){const{blockStarts:t,blockCount:e,chromStarts:n,thickEnd:s,thickStart:a,blockSizes:o,...i}=r;return{...i,blockStarts:c(t),chromStarts:c(n),blockSizes:c(o),thickStart:a?+a:void 0,thickEnd:s?+s:void 0,blockCount:e?+e:void 0}}return r}(l,t):i.parseLine(t,{uniqueId:u}),{strand:h,score:m,chrom:p,chromStart:b,chromEnd:k,...S}=f,_=d?+f[d]:m?+m:void 0,g=function(t){return"-"===t||-1===t?-1:"+"===t||1===t?1:0}(h),N=S.blockCount?function({start:t,uniqueId:e,refName:r,chromStarts:n,blockCount:s,blockSizes:a,blockStarts:o}){const i=[],c=n??o??[];for(let n=0;n<s;n++){const s=(c[n]??0)+t,o=a?.[n];o&&o>0&&i.push({uniqueId:`${e}-${n}`,start:s,end:s+o,refName:r,type:"block"})}return i}({start:r,uniqueId:u,refName:e,chromStarts:S.chromStarts,blockCount:S.blockCount,blockSizes:S.blockSizes,blockStarts:S.blockStarts}):void 0;if(function({splitLine:t,start:e,end:r}){return+(t[6]||0)===e&&+(t[7]||0)===r&&[9,10,11,12,13,14,15,16,17].every(e=>t[e]&&!Number.isNaN(+t[e]))}({splitLine:t,start:r,end:o}))return function({splitLine:t,uniqueId:e,refName:r,start:n,end:s}){const[,,,a,,o,,,i,c,u,d,l,f,h,m,p,b]=t;return{uniqueId:e,refName:r,start:n,end:s,code:a,score:+u||0,strand:o,color:i,source:a,n_valid_cov:c,fraction_modified:u,n_mod:d,n_canonical:l,n_other_mod:f,n_delete:h,n_fail:m,n_diff:p,n_nocall:b}}({splitLine:t,uniqueId:u,refName:e,start:r,end:o});if(n(S.description)){const{chromStarts:t,blockSizes:n,blockStarts:a,blockCount:i,thickStart:c,thickEnd:d,description:l,...f}=S;return function({uniqueId:t,refName:e,start:r,end:n,description:a,...o}){const{subfeatures:i,...c}=o;return{...c,...s(a),uniqueId:t,refName:e,start:r,end:n}}({...f,description:l,uniqueId:u,score:_,start:r,end:o,strand:g,refName:e,subfeatures:N})}return N&&function({thickStart:t,blockCount:e,strand:r}){return t&&e&&0!==r}({strand:g,blockCount:S.blockCount,thickStart:S.thickStart})?function(t){const{strand:e=0,uniqueId:r,start:n,end:s,...o}=t,{subfeatures:i,thickStart:c,thickEnd:u,refName:d,chrom:l,chromStart:f,chromEnd:h,chromStarts:m,blockStarts:p,blockSizes:b,blockCount:k,...S}=o,_=S.exonFrames??S._exonFrames,g=i.filter(t=>"block"===t.type).sort((t,e)=>t.start-e.start),N=e>0?"five_prime_UTR":"three_prime_UTR",C=e>0?"three_prime_UTR":"five_prime_UTR",{cdsEndStat:v,cdsStartStat:y}=S;if("none"===y&&"none"===v)return{...S,uniqueId:r,strand:e,type:"transcript",refName:d,start:n,end:s,subfeatures:g.map(t=>({...t,type:"exon"}))};let q;if(!_){const t=[];for(const e of g){const{start:r,end:n}=e;c<n&&u>r&&t.push({start:Math.max(r,c),end:Math.min(n,u)})}q=function(t,e){const r=[...t].sort((t,r)=>e>0?t.start-r.start:r.start-t.start),n=new Map;let s=0;for(const t of r){const e=(3-s%3)%3;n.set(t.start,e),s+=t.end-t.start}return n}(t,e)}const I=[];for(const[t,e]of g.entries()){const r=e,{start:n,end:s}=r;if(c>=s)I.push({type:N,start:n,end:s,refName:d});else if(u<=n)I.push({type:C,start:n,end:s,refName:d});else{n<c&&I.push({type:N,start:n,end:c,refName:d});const e=Math.max(n,c),r=Math.min(s,u);let o=0;if(_){const e=_[t];void 0!==e&&e>=0&&(o=a(e))}else q&&(o=q.get(e)??0);I.push({type:"CDS",phase:o,start:e,end:r,refName:d}),s>u&&I.push({type:C,start:u,end:s,refName:d})}}return{...S,uniqueId:r,strand:e,type:"mRNA",refName:d,start:n,end:s,subfeatures:I}}({...S,score:_,start:r,end:o,strand:g,refName:e,uniqueId:u,subfeatures:N,thickStart:S.thickStart,thickEnd:S.thickEnd}):{...S,uniqueId:u,score:_,start:r,end:o,strand:g,refName:e,subfeatures:N}}function c(t){if(void 0!==t)return"string"==typeof t?t.split(",").map(t=>+t):t}r.d(e,{dE:()=>o,np:()=>i})},94645(t,e,r){r.d(e,{P:()=>s});var n=r(77251);function s(t,e,r=()=>{}){const s=new TextDecoder("utf8");let a=0,o=0;for(;a<t.length;){const i=t.indexOf(10,a),c=-1===i?t.length:i,u=t.subarray(a,c),d=s.decode(u).trim();if(d&&!1===e(d,o))break;o++%1e4==0&&r(`Loading ${(0,n.getProgressDisplayStr)(a,t.length)}`),a=c+1}}}}]);
//# sourceMappingURL=1062.78e38b4d.chunk.js.map