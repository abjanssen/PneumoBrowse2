"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5172],{75172(e,t,s){s.d(t,{default:()=>u});var n=s(45188),a=s(90946),r=s(23886),i=s(11931),c=s(25529),o=s(64738),l=s(5843);class u extends a.L{static capabilities=["getFeatures","getRefNames"];constructor(e,t,s){super(e,t,s);const a=this.getConf("pifGzLocation"),r=this.getConf(["index","indexType"]),c=this.getConf(["index","location"]),o=this.pluginManager;this.pif=new n.wD({filehandle:(0,i.openLocation)(a,o),csiFilehandle:"CSI"===r?(0,i.openLocation)(c,o):void 0,tbiFilehandle:"CSI"!==r?(0,i.openLocation)(c,o):void 0,chunkCacheSize:52428800})}async getHeader(e){const{statusCallback:t=()=>{}}=e||{};return(0,r.updateStatus)("Downloading header",t,()=>this.pif.getHeader())}getAssemblyNames(){const e=this.getConf("assemblyNames");return 0===e.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}async hasDataForRefName(){return!0}async getRefNames(e={}){const t=e.regions?.[0]?.assemblyName;if(!t)throw new Error("no assembly name provided");const s=this.getAssemblyNames().indexOf(t),n=await this.pif.getReferenceSequenceNames(e);return 0===s?n.filter(e=>e.startsWith("q")).map(e=>e.slice(1)):1===s?n.filter(e=>e.startsWith("t")).map(e=>e.slice(1)):[]}getFeatures(e,t={}){const{statusCallback:s=()=>{}}=t;return(0,c.ObservableCreate)(async n=>{const{assemblyName:a}=e,i=this.getAssemblyNames(),c=0===i.indexOf(a),u=c?"q":"t",m=i[c?1:0];await(0,r.updateStatus)("Downloading features",s,()=>this.pif.getLines(u+e.refName,e.start,e.end,{lineCallback:(e,t)=>{const s=(0,l.xI)(e),{extra:r,strand:i}=s,{numMatches:c=0,blockLen:u=1,cg:h,...d}=r,f=s.qstart,p=s.qend,g=s.qname.slice(1),b=s.tname,y=s.tstart,C=s.tend,w=r.cg;n.next(new o.A({uniqueId:t+a,assemblyName:a,start:f,end:p,type:"match",refName:g,strand:i,...d,CIGAR:w,syntenyId:t,identity:c/u,numMatches:c,blockLen:u,mate:{start:y,end:C,refName:b,assemblyName:m}}))},stopToken:t.stopToken})),n.complete()})}}},64738(e,t,s){s.d(t,{A:()=>i});var n=s(43102),a=s(153);const{DQ:r}=a;class i extends n.A{get(e){return"mismatches"===e?r(this.get("CIGAR")):super.get(e)}}},5843(e,t,s){s.d(t,{TA:()=>r,fY:()=>a,gJ:()=>o,qm:()=>c,xI:()=>i});var n=s(23886);function a(e){return new Map(e.split(/\n|\r\n|\r/).filter(e=>!!e&&!e.startsWith("#")).map(e=>{const[t,s,n,a,r,i]=e.split("\t");return[a,{refName:t,start:+s,end:+n,score:+r,name:a,strand:"-"===i?-1:1}]}))}async function r(e,t){return(0,n.fetchAndMaybeUnzipText)(e,t)}function i(e){const t=e.split("\t"),s=t.slice(12),n={numMatches:+t[9],blockLen:+t[10],mappingQual:+t[11]};if(s.length)for(const e of s){const t=e.indexOf(":");n[e.slice(0,t)]=e.slice(t+3)}return{tname:t[5],tstart:+t[7],tend:+t[8],qname:t[0],qstart:+t[2],qend:+t[3],strand:"-"===t[4]?-1:1,extra:n}}function c(e){const t=[];for(let s=e.length-2;s>=0;s-=2){t.push(e[s]);const n=e[s+1];"D"===n?t.push("I"):"I"===n?t.push("D"):t.push(n)}return t}function o(e){return e.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}}}]);
//# sourceMappingURL=5172.dfe70264.chunk.js.map