{"version":3,"file":"static/js/4364.61632ede.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../plugins/alignments/src/ModificationParser/getMethBins.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/layoutFeature.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/renderers/getAlignmentShapeColor.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/colorBy.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/renderers/renderAlignmentShape.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/renderers/renderMethylation.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/renderers/renderPerBaseQuality.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/renderers/renderAlignment.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/renderers/renderPerBaseLettering.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/renderers/renderSoftClipping.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/makeImageData.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/layoutFeatures.ts","webpack://@jbrowse/web/../../plugins/alignments/src/PileupRenderer/sortUtil.ts"],"sourcesContent":["import { getModPositions } from './getModPositions.ts'\nimport { getModProbabilities } from './getModProbabilities.ts'\nimport { getNextRefPos } from '../MismatchParser/index.ts'\nimport { getTagAlt } from '../util.ts'\n\nimport type { Feature } from '@jbrowse/core/util'\n\nexport function getMethBins(feature: Feature, cigarOps: ArrayLike<number>) {\n  const fstart = feature.get('start')\n  const fend = feature.get('end')\n  const fstrand = feature.get('strand') as -1 | 0 | 1\n  const flen = fend - fstart\n  const mm = (getTagAlt(feature, 'MM', 'Mm') as string | undefined) || ''\n  const methBins = []\n  const hydroxyMethBins = []\n  const methProbs = []\n  const hydroxyMethProbs = []\n  const seq = feature.get('seq') as string | undefined\n  if (seq) {\n    const probabilities = getModProbabilities(feature)\n    const modifications = getModPositions(mm, seq, fstrand)\n    let probIndex = 0\n\n    for (const { type, positions } of modifications) {\n      for (const { ref, idx } of getNextRefPos(cigarOps, positions)) {\n        // Skip positions outside the feature bounds\n        if (ref < 0 || ref >= flen) {\n          continue\n        }\n\n        // Calculate probability index based on strand\n        const isReverseStrand = fstrand === -1\n        const idx2 =\n          probIndex + (isReverseStrand ? positions.length - 1 - idx : idx)\n        const prob = probabilities?.[idx2] || 0\n\n        // Store modification data in appropriate bins\n        if (type === 'm') {\n          methBins[ref] = 1\n          methProbs[ref] = prob\n        } else if (type === 'h') {\n          hydroxyMethBins[ref] = 1\n          hydroxyMethProbs[ref] = prob\n        }\n      }\n      probIndex += positions.length\n    }\n  }\n  return {\n    methBins,\n    hydroxyMethBins,\n    methProbs,\n    hydroxyMethProbs,\n  }\n}\n","import type { LayoutFeature } from './types.ts'\nimport type { Mismatch } from '../shared/types.ts'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { BaseLayout } from '@jbrowse/core/util/layouts'\n\nexport function layoutFeature({\n  feature,\n  layout,\n  showSoftClip,\n  heightPx,\n  displayMode,\n}: {\n  feature: Feature\n  layout: BaseLayout<Feature>\n  showSoftClip?: boolean\n  heightPx: number\n  displayMode: string\n}): LayoutFeature | null {\n  // Cache start/end to avoid multiple get() calls\n  const featureStart = feature.get('start')\n  const featureEnd = feature.get('end')\n\n  let s = featureStart\n  let e = featureEnd\n\n  // Expand the start and end of feature when softclipping enabled\n  if (showSoftClip) {\n    const mismatches = feature.get('mismatches') as Mismatch[] | undefined\n    if (mismatches) {\n      for (const mismatch of mismatches) {\n        if (mismatch.type === 'softclip') {\n          const cliplen = mismatch.cliplen\n          if (mismatch.start === 0) {\n            s -= cliplen\n          } else {\n            e += cliplen\n          }\n        }\n      }\n    }\n  }\n\n  if (displayMode === 'compact') {\n    heightPx /= 3\n  }\n\n  const topPx = layout.addRect(feature.id(), s, e, heightPx, feature)\n  if (topPx === null) {\n    return null\n  }\n\n  return {\n    feature,\n    topPx: displayMode === 'collapse' ? 0 : topPx,\n    heightPx,\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\n\nimport { fillColor } from '../../shared/color.ts'\nimport {\n  colorByInsertSize,\n  colorByMappingQuality,\n  colorByOrientation,\n  colorByStrand,\n  colorByStrandedRnaSeq,\n} from '../colorBy.ts'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport function getAlignmentShapeColor({\n  colorType,\n  tag,\n  feature,\n  config,\n  defaultColor,\n  colorTagMap,\n}: {\n  colorType: string\n  tag: string\n  feature: Feature\n  defaultColor: boolean\n  config: AnyConfigurationModel\n  colorTagMap: Record<string, string>\n}) {\n  // first pass for simple color changes that change the color of the\n  // alignment\n  switch (colorType) {\n    case 'insertSize':\n      return colorByInsertSize(feature)\n    case 'strand':\n      return colorByStrand(feature)\n    case 'mappingQuality':\n      return colorByMappingQuality(feature)\n    case 'pairOrientation':\n      return colorByOrientation(feature, config)\n    case 'stranded':\n      return colorByStrandedRnaSeq(feature)\n    case 'xs':\n    case 'tag': {\n      const tags = feature.get('tags')\n      const val = tags ? tags[tag] : feature.get(tag)\n\n      if (tag === 'XS' || tag === 'TS') {\n        if (val === '-') {\n          return fillColor.color_rev_strand\n        } else if (val === '+') {\n          return fillColor.color_fwd_strand\n        } else {\n          return fillColor.color_nostrand\n        }\n      }\n      if (tag === 'ts') {\n        if (val === '-') {\n          return feature.get('strand') === -1\n            ? fillColor.color_fwd_strand\n            : fillColor.color_rev_strand\n        } else if (val === '+') {\n          return feature.get('strand') === -1\n            ? fillColor.color_rev_strand\n            : fillColor.color_fwd_strand\n        } else {\n          return fillColor.color_nostrand\n        }\n      }\n      return colorTagMap[val] || fillColor.color_nostrand\n    }\n    case 'insertSizeAndPairOrientation':\n      break\n\n    case 'modifications':\n    case 'methylation':\n      // this coloring is similar to igv.js, and is helpful to color negative\n      // strand reads differently because their c-g will be flipped (e.g. g-c\n      // read right to left)\n      return feature.get('flags') & 16 ? '#c8dcc8' : '#c8c8c8'\n\n    default:\n      return defaultColor\n        ? 'lightgrey'\n        : readConfObject(config, 'color', { feature })\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\n\nimport { fillColor } from '../shared/color.ts'\nimport { orientationTypes } from '../util.ts'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport function colorByInsertSize(feature: Feature) {\n  return feature.get('is_paired') &&\n    feature.get('refName') !== feature.get('next_ref')\n    ? '#555'\n    : `hsl(${Math.abs(feature.get('template_length')) / 10},50%,50%)`\n}\n\nexport function colorByMappingQuality(feature: Feature) {\n  return `hsl(${feature.get('score')},50%,50%)`\n}\n\nfunction getOrientation(feature: Feature, config: AnyConfigurationModel) {\n  const orientationType = readConfObject(config, 'orientationType') as\n    | 'fr'\n    | 'ff'\n    | 'rf'\n  const type = orientationTypes[orientationType]\n  const orientation = type[feature.get('pair_orientation') as string]!\n  return {\n    LR: 'color_pair_lr' as const,\n    RR: 'color_pair_rr' as const,\n    RL: 'color_pair_rl' as const,\n    LL: 'color_pair_ll' as const,\n  }[orientation]\n}\n\nexport function colorByStrand(feature: Feature) {\n  return feature.get('strand') === -1 ? '#8F8FD8' : '#EC8B8B'\n}\n\nexport function colorByOrientation(\n  feature: Feature,\n  config: AnyConfigurationModel,\n) {\n  return fillColor[getOrientation(feature, config) || 'color_nostrand']\n}\nfunction getStranded(feature: Feature) {\n  const flags = feature.get('flags')\n  const strand = feature.get('strand')\n\n  // is paired\n  if (flags & 1) {\n    // first-of-pair?\n    const flipper = flags & 64 ? -1 : 1\n\n    // proper pairing\n    if (flags & 2) {\n      return strand * flipper === 1 ? 'color_rev_strand' : 'color_fwd_strand'\n    }\n    // mate missing, separate color\n    if (flags & 8) {\n      return strand * flipper === 1\n        ? 'color_rev_missing_mate'\n        : 'color_fwd_missing_mate'\n    }\n    // same chrom without proper pairing gets separate color\n    if (feature.get('refName') === feature.get('next_ref')) {\n      return strand * flipper === 1\n        ? 'color_rev_strand_not_proper'\n        : 'color_fwd_strand_not_proper'\n    }\n    // abberant chrom\n\n    return strand === 1 ? 'color_fwd_diff_chr' : 'color_rev_diff_chr'\n  }\n  return 'color_unknown'\n}\n\nexport function colorByStrandedRnaSeq(feature: Feature) {\n  return fillColor[getStranded(feature)]\n}\n","import { CIGAR_N, CIGAR_REF_CONSUMING_MASK } from './cigarUtil.ts'\nimport { CHEVRON_WIDTH } from '../../shared/util.ts'\n\nimport type { ProcessedRenderArgs } from '../types.ts'\nimport type { LayoutFeature } from '../util.ts'\n\n// Helper to draw forward strand chevron\nfunction drawForwardChevron(\n  ctx: CanvasRenderingContext2D,\n  leftPx: number,\n  rightPx: number,\n  topPx: number,\n  heightPx: number,\n  midY: number,\n) {\n  ctx.beginPath()\n  ctx.moveTo(leftPx, topPx)\n  ctx.lineTo(leftPx, topPx + heightPx)\n  ctx.lineTo(rightPx, topPx + heightPx)\n  ctx.lineTo(rightPx + CHEVRON_WIDTH, midY)\n  ctx.lineTo(rightPx, topPx)\n  ctx.closePath()\n  ctx.fill()\n}\n\n// Helper to draw reverse strand chevron\nfunction drawReverseChevron(\n  ctx: CanvasRenderingContext2D,\n  leftPx: number,\n  rightPx: number,\n  topPx: number,\n  heightPx: number,\n  midY: number,\n) {\n  ctx.beginPath()\n  ctx.moveTo(leftPx - CHEVRON_WIDTH, midY)\n  ctx.lineTo(leftPx, topPx + heightPx)\n  ctx.lineTo(rightPx, topPx + heightPx)\n  ctx.lineTo(rightPx, topPx)\n  ctx.lineTo(leftPx, topPx)\n  ctx.closePath()\n  ctx.fill()\n}\n\nexport function renderAlignmentShape({\n  ctx,\n  feat,\n  renderArgs,\n  canvasWidth,\n  color,\n  cigarOps,\n}: {\n  ctx: CanvasRenderingContext2D\n  feat: LayoutFeature\n  renderArgs: ProcessedRenderArgs\n  canvasWidth: number\n  color: string\n  cigarOps: ArrayLike<number>\n}) {\n  const { regions, bpPerPx } = renderArgs\n  const { heightPx, topPx, feature } = feat\n  const region = regions[0]!\n  const regionStart = region.start\n  const regionEnd = region.end\n  const reversed = region.reversed\n  const invBpPerPx = 1 / bpPerPx\n  const s = feature.get('start')\n  const e = feature.get('end')\n\n  const flip = region.reversed ? -1 : 1\n  const strand = feature.get('strand') * flip\n  const renderChevrons = bpPerPx < 10 && heightPx > 5\n\n  ctx.fillStyle = color\n\n  let hasSkips = false\n  for (let i = 0, l = cigarOps.length; i < l; i++) {\n    if ((cigarOps[i]! & 0xf) === CIGAR_N) {\n      hasSkips = true\n      break\n    }\n  }\n\n  // Check for skips (N operations)\n  if (hasSkips) {\n    const midY = topPx + heightPx / 2\n\n    if (strand === 1) {\n      let drawLen = 0\n      let drawStart = s\n      const opsLen = cigarOps.length\n\n      for (let i = 0; i < opsLen; i++) {\n        const packed = cigarOps[i]!\n        const opLen = packed >> 4\n        const op = packed & 0xf\n\n        if ((1 << op) & CIGAR_REF_CONSUMING_MASK) {\n          drawLen += opLen\n        } else if (op === CIGAR_N) {\n          if (drawLen) {\n            const drawEnd = drawStart + drawLen\n            const leftPx = reversed\n              ? (regionEnd - drawEnd) * invBpPerPx\n              : (drawStart - regionStart) * invBpPerPx\n            const rightPx = reversed\n              ? (regionEnd - drawStart) * invBpPerPx\n              : (drawEnd - regionStart) * invBpPerPx\n            const w = rightPx - leftPx\n            if (leftPx + w > 0 && leftPx < canvasWidth) {\n              ctx.fillRect(leftPx, topPx, w, heightPx)\n            }\n          }\n          drawStart += drawLen + opLen\n          drawLen = 0\n        }\n      }\n\n      if (drawLen) {\n        const drawEnd = drawStart + drawLen\n        const leftPx = reversed\n          ? (regionEnd - drawEnd) * invBpPerPx\n          : (drawStart - regionStart) * invBpPerPx\n        const rightPx = reversed\n          ? (regionEnd - drawStart) * invBpPerPx\n          : (drawEnd - regionStart) * invBpPerPx\n\n        if (renderChevrons) {\n          drawForwardChevron(ctx, leftPx, rightPx, topPx, heightPx, midY)\n        } else {\n          const w = rightPx - leftPx\n          if (leftPx + w > 0 && leftPx < canvasWidth) {\n            ctx.fillRect(leftPx, topPx, w, heightPx)\n          }\n        }\n      }\n    } else if (strand === -1) {\n      let drawLen = 0\n      let drawStart = e\n\n      for (let i = cigarOps.length - 1; i >= 0; i--) {\n        const packed = cigarOps[i]!\n        const opLen = packed >> 4\n        const op = packed & 0xf\n\n        if ((1 << op) & CIGAR_REF_CONSUMING_MASK) {\n          drawLen += opLen\n        } else if (op === CIGAR_N) {\n          if (drawLen) {\n            const drawBegin = drawStart - drawLen\n            const leftPx = reversed\n              ? (regionEnd - drawStart) * invBpPerPx\n              : (drawBegin - regionStart) * invBpPerPx\n            const rightPx = reversed\n              ? (regionEnd - drawBegin) * invBpPerPx\n              : (drawStart - regionStart) * invBpPerPx\n            const w = rightPx - leftPx\n            if (leftPx + w > 0 && leftPx < canvasWidth) {\n              ctx.fillRect(leftPx, topPx, w, heightPx)\n            }\n          }\n          drawStart -= drawLen + opLen\n          drawLen = 0\n        }\n      }\n\n      if (drawLen) {\n        const drawBegin = drawStart - drawLen\n        const leftPx = reversed\n          ? (regionEnd - drawStart) * invBpPerPx\n          : (drawBegin - regionStart) * invBpPerPx\n        const rightPx = reversed\n          ? (regionEnd - drawBegin) * invBpPerPx\n          : (drawStart - regionStart) * invBpPerPx\n\n        if (renderChevrons) {\n          drawReverseChevron(ctx, leftPx, rightPx, topPx, heightPx, midY)\n        } else {\n          const w = rightPx - leftPx\n          if (leftPx + w > 0 && leftPx < canvasWidth) {\n            ctx.fillRect(leftPx, topPx, w, heightPx)\n          }\n        }\n      }\n    }\n  } else {\n    const leftPx = reversed\n      ? (regionEnd - e) * invBpPerPx\n      : (s - regionStart) * invBpPerPx\n    const rightPx = reversed\n      ? (regionEnd - s) * invBpPerPx\n      : (e - regionStart) * invBpPerPx\n    const midY = topPx + heightPx / 2\n\n    if (renderChevrons) {\n      if (strand === -1) {\n        drawReverseChevron(ctx, leftPx, rightPx, topPx, heightPx, midY)\n      } else {\n        drawForwardChevron(ctx, leftPx, rightPx, topPx, heightPx, midY)\n      }\n    } else {\n      const w = rightPx - leftPx\n      if (leftPx + w > 0 && leftPx < canvasWidth) {\n        ctx.fillRect(leftPx, topPx, w, heightPx)\n      }\n    }\n  }\n}\n","import { colord } from '@jbrowse/core/util/colord'\n\nimport { getMethBins } from '../../ModificationParser/getMethBins.ts'\nimport { buildMismatchMap } from '../../shared/util.ts'\n\nimport type { FlatbushItem, ProcessedRenderArgs } from '../types.ts'\nimport type { LayoutFeature } from '../util.ts'\nimport type { Region } from '@jbrowse/core/util'\n\n// Pre-compute colord objects for methylation colors\nconst RED_COLORD = colord('red')\nconst BLUE_COLORD = colord('blue')\nconst PINK_COLORD = colord('pink')\nconst PURPLE_COLORD = colord('purple')\n\n// Color by methylation is slightly modified version of color by modifications\n// at reference CpG sites, with non-methylated CpG colored (looking only at the\n// MM tag can not tell you where reference CpG sites are)\nexport function renderMethylation({\n  ctx,\n  feat,\n  region,\n  bpPerPx,\n  renderArgs,\n  cigarOps,\n}: {\n  ctx: CanvasRenderingContext2D\n  feat: LayoutFeature\n  region: Region\n  bpPerPx: number\n  renderArgs: ProcessedRenderArgs\n  cigarOps: ArrayLike<number>\n}) {\n  const items = [] as FlatbushItem[]\n  const coords = [] as number[]\n  const { regionSequence } = renderArgs\n  const { feature, topPx, heightPx } = feat\n  const bottomPx = topPx + heightPx\n  if (!regionSequence) {\n    throw new Error('region sequence required for methylation')\n  }\n\n  const seq = feature.get('seq') as string | undefined\n  if (!seq) {\n    return { items, coords }\n  }\n  const fstart = feature.get('start')\n  const fend = feature.get('end')\n  const { methBins, methProbs, hydroxyMethBins, hydroxyMethProbs } =\n    getMethBins(feature, cigarOps)\n  const mismatchMap = buildMismatchMap(feature, fstart)\n\n  function getColAndProb(\n    k: number,\n  ): { color: string; prob: number; type: string } | undefined {\n    if (methBins[k]) {\n      const p = methProbs[k] || 0\n      return {\n        color: (p > 0.5\n          ? RED_COLORD.alpha((p - 0.5) * 2)\n          : BLUE_COLORD.alpha(1 - p * 2)\n        ).toHslString(),\n        prob: p,\n        type: 'm (5mC)',\n      }\n    }\n    if (hydroxyMethBins[k]) {\n      const p = hydroxyMethProbs[k] || 0\n      return {\n        color: (p > 0.5\n          ? PINK_COLORD.alpha((p - 0.5) * 2)\n          : PURPLE_COLORD.alpha(1 - p * 2)\n        ).toHslString(),\n        prob: p,\n        type: 'h (5hmC)',\n      }\n    }\n    return undefined\n  }\n\n  const regionStart = region.start\n  const regionEnd = region.end\n  const reversed = region.reversed\n  const invBpPerPx = 1 / bpPerPx\n  const r = regionSequence.toLowerCase()\n\n  function drawBase(\n    start: number,\n    end: number,\n    info: { color: string; prob: number; type: string } | undefined,\n    label: string,\n  ) {\n    const leftPx = reversed\n      ? (regionEnd - end) * invBpPerPx\n      : (start - regionStart) * invBpPerPx\n    const rightPx = reversed\n      ? (regionEnd - start) * invBpPerPx\n      : (end - regionStart) * invBpPerPx\n    const w = rightPx - leftPx + 0.5\n    ctx.fillStyle = info?.color || 'blue'\n    ctx.fillRect(leftPx, topPx, w, heightPx)\n\n    if (rightPx - leftPx >= 0.2) {\n      const prob = info?.prob ?? 0\n      const modType = info?.type ?? 'unmethylated'\n      const mismatchBase = mismatchMap.get(start)\n      items.push({\n        type: 'modification',\n        info: `${label} ${modType} (${(prob * 100).toFixed(1)}%)`,\n        modType: 'methylation',\n        probability: prob,\n        start,\n        mismatch: mismatchBase,\n      })\n      coords.push(leftPx, topPx, rightPx, bottomPx)\n    }\n  }\n\n  // Calculate visible range within feature\n  const visStart = Math.max(0, regionStart - fstart)\n  const visEnd = Math.min(fend - fstart, regionEnd - fstart)\n\n  for (let i = visStart; i < visEnd; i++) {\n    const j = i + fstart\n\n    const l1 = r[j - regionStart + 1]\n    const l2 = r[j - regionStart + 2]\n\n    if (l1 === 'c' && l2 === 'g') {\n      const info1 = getColAndProb(i)\n      const info2 = getColAndProb(i + 1)\n\n      if (bpPerPx > 2) {\n        drawBase(j, j + 2, info1 || info2, 'CpG')\n      } else {\n        drawBase(j, j + 1, info1, 'CpG C')\n        drawBase(j + 1, j + 2, info2, 'CpG G')\n      }\n    }\n  }\n\n  return { items, coords }\n}\n","import {\n  CIGAR_D,\n  CIGAR_EQ,\n  CIGAR_I,\n  CIGAR_M,\n  CIGAR_N,\n  CIGAR_S,\n  CIGAR_X,\n} from './cigarUtil.ts'\n\nimport type { LayoutFeature } from '../util.ts'\nimport type { Region } from '@jbrowse/core/util'\n\n// Pre-cached HSL color strings for quality scores 0-255\nconst qualityColors: string[] = Array.from(\n  { length: 256 },\n  (_, score) => `hsl(${score === 255 ? 150 : score * 1.5},55%,50%)`,\n)\n\nexport function renderPerBaseQuality({\n  ctx,\n  feat,\n  region,\n  bpPerPx,\n  cigarOps,\n}: {\n  ctx: CanvasRenderingContext2D\n  feat: LayoutFeature\n  region: Region\n  bpPerPx: number\n  cigarOps: ArrayLike<number>\n}) {\n  const { feature, topPx, heightPx } = feat\n  const qual: string = feature.get('qual') || ''\n  const scores = qual.split(' ').map(val => +val)\n  const invBpPerPx = 1 / bpPerPx\n  const w = invBpPerPx\n  const start = feature.get('start')\n  let soffset = 0\n  let roffset = 0\n\n  const regionStart = region.start\n  const regionEnd = region.end\n  const reversed = region.reversed\n\n  for (let i = 0, l = cigarOps.length; i < l; i++) {\n    const packed = cigarOps[i]!\n    const len = packed >> 4\n    const opIdx = packed & 0xf\n    if (opIdx === CIGAR_S || opIdx === CIGAR_I) {\n      soffset += len\n    } else if (opIdx === CIGAR_D || opIdx === CIGAR_N) {\n      roffset += len\n    } else if (opIdx === CIGAR_M || opIdx === CIGAR_X || opIdx === CIGAR_EQ) {\n      const opStart = start + roffset\n      const opEnd = opStart + len\n\n      if (opStart >= regionEnd) {\n        break\n      }\n\n      if (opEnd > regionStart) {\n        const visStart = Math.max(0, regionStart - opStart)\n        const visEnd = Math.min(len, regionEnd - opStart)\n\n        for (let m = visStart; m < visEnd; m++) {\n          const score = scores[soffset + m]!\n          const refPos = opStart + m\n          const leftPx = reversed\n            ? (regionEnd - refPos - 1) * invBpPerPx\n            : (refPos - regionStart) * invBpPerPx\n          ctx.fillStyle = qualityColors[score] || qualityColors[0]!\n          ctx.fillRect(leftPx, topPx, w + 0.5, heightPx)\n        }\n      }\n      soffset += len\n      roffset += len\n    }\n  }\n}\n","import { getCigarOps } from './cigarUtil.ts'\nimport { getAlignmentShapeColor } from './getAlignmentShapeColor.ts'\nimport { renderAlignmentShape } from './renderAlignmentShape.ts'\nimport { renderMethylation } from './renderMethylation.ts'\nimport { renderModifications } from './renderModifications.ts'\nimport { renderPerBaseLettering } from './renderPerBaseLettering.ts'\nimport { renderPerBaseQuality } from './renderPerBaseQuality.ts'\n\nimport type { FlatbushItem, ProcessedRenderArgs } from '../types.ts'\nimport type { LayoutFeature } from '../util.ts'\n\nfunction collectResults(\n  ret: { coords: number[]; items: FlatbushItem[] },\n  coords: number[],\n  items: FlatbushItem[],\n) {\n  for (let i = 0, l = ret.coords.length; i < l; i++) {\n    coords.push(ret.coords[i]!)\n  }\n  for (let i = 0, l = ret.items.length; i < l; i++) {\n    items.push(ret.items[i]!)\n  }\n}\n\nexport function renderAlignment({\n  ctx,\n  feat,\n  renderArgs,\n  colorMap,\n  colorContrastMap,\n  charWidth,\n  charHeight,\n  defaultColor,\n  canvasWidth,\n}: {\n  ctx: CanvasRenderingContext2D\n  feat: LayoutFeature\n  renderArgs: ProcessedRenderArgs\n  colorMap: Record<string, string>\n  colorContrastMap: Record<string, string>\n  charWidth: number\n  charHeight: number\n  defaultColor: boolean\n  canvasWidth: number\n}) {\n  const items = [] as FlatbushItem[]\n  const coords = [] as number[]\n  const { config, bpPerPx, regions, colorBy, colorTagMap = {} } = renderArgs\n  const { tag = '', type: colorType = '' } = colorBy || {}\n  const { feature } = feat\n  const region = regions[0]!\n\n  const alignmentColor = getAlignmentShapeColor({\n    feature,\n    config,\n    tag,\n    defaultColor,\n    colorType,\n    colorTagMap,\n  })\n  const cigarOps = getCigarOps(\n    feature.get('NUMERIC_CIGAR') || feature.get('CIGAR'),\n  )\n  renderAlignmentShape({\n    ctx,\n    feat,\n    renderArgs,\n    canvasWidth,\n    color: alignmentColor,\n    cigarOps,\n  })\n\n  // second pass for color types that render per-base things that go over the\n  // existing drawing\n  switch (colorType) {\n    case 'perBaseQuality': {\n      renderPerBaseQuality({\n        ctx,\n        feat,\n        region,\n        bpPerPx,\n        cigarOps,\n      })\n      break\n    }\n\n    case 'perBaseLettering': {\n      renderPerBaseLettering({\n        ctx,\n        feat,\n        region,\n        bpPerPx,\n        colorMap,\n        colorContrastMap,\n        charWidth,\n        charHeight,\n        canvasWidth,\n        cigarOps,\n      })\n      break\n    }\n\n    case 'modifications': {\n      collectResults(\n        renderModifications({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          renderArgs,\n          cigarOps,\n        }),\n        coords,\n        items,\n      )\n      break\n    }\n\n    case 'methylation': {\n      collectResults(\n        renderMethylation({ ctx, feat, region, bpPerPx, renderArgs, cigarOps }),\n        coords,\n        items,\n      )\n      break\n    }\n  }\n\n  return { coords, items }\n}\n","import {\n  CIGAR_D,\n  CIGAR_EQ,\n  CIGAR_I,\n  CIGAR_M,\n  CIGAR_N,\n  CIGAR_S,\n  CIGAR_X,\n} from './cigarUtil.ts'\n\nimport type { LayoutFeature } from '../util.ts'\nimport type { Region } from '@jbrowse/core/util'\n\nexport function renderPerBaseLettering({\n  ctx,\n  feat,\n  region,\n  bpPerPx,\n  colorMap,\n  colorContrastMap,\n  charWidth,\n  charHeight,\n  canvasWidth,\n  cigarOps,\n}: {\n  ctx: CanvasRenderingContext2D\n  feat: LayoutFeature\n  region: Region\n  bpPerPx: number\n  colorMap: Record<string, string>\n  colorContrastMap: Record<string, string>\n  charWidth: number\n  charHeight: number\n  canvasWidth: number\n  cigarOps: ArrayLike<number>\n}) {\n  const heightLim = charHeight - 2\n  const { feature, topPx, heightPx } = feat\n  const seq = feature.get('seq') as string | undefined\n  const invBpPerPx = 1 / bpPerPx\n  const w = invBpPerPx\n  const start = feature.get('start')\n  let soffset = 0\n  let roffset = 0\n\n  if (!seq) {\n    return\n  }\n\n  const regionStart = region.start\n  const regionEnd = region.end\n  const reversed = region.reversed\n\n  for (let i = 0, l = cigarOps.length; i < l; i++) {\n    const packed = cigarOps[i]!\n    const len = packed >> 4\n    const op = packed & 0xf\n    if (op === CIGAR_S || op === CIGAR_I) {\n      soffset += len\n    } else if (op === CIGAR_D || op === CIGAR_N) {\n      roffset += len\n    } else if (op === CIGAR_M || op === CIGAR_X || op === CIGAR_EQ) {\n      const opStart = start + roffset\n      const opEnd = opStart + len\n\n      // Early exit if we've passed the visible region\n      if (opStart >= regionEnd) {\n        break\n      }\n\n      // Skip if this op is entirely before visible region\n      if (opEnd > regionStart) {\n        // Calculate visible portion of this op\n        const visStart = Math.max(0, regionStart - opStart)\n        const visEnd = Math.min(len, regionEnd - opStart)\n\n        for (let m = visStart; m < visEnd; m++) {\n          const letter = seq[soffset + m]!\n          const r = opStart + m\n          const leftPx = reversed\n            ? (regionEnd - r - 1) * invBpPerPx\n            : (r - regionStart) * invBpPerPx\n          ctx.fillStyle = colorMap[letter]!\n          ctx.fillRect(leftPx, topPx, w + 0.5, heightPx)\n\n          if (w >= charWidth && heightPx >= heightLim) {\n            const x = leftPx + (w - charWidth) / 2 + 1\n            const y = topPx + heightPx\n            const color = colorContrastMap[letter]\n            if (x >= 0 && x <= canvasWidth && color) {\n              ctx.fillStyle = color\n              ctx.fillText(letter, x, y)\n            }\n          }\n        }\n      }\n      soffset += len\n      roffset += len\n    }\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\n\nimport {\n  CIGAR_D,\n  CIGAR_EQ,\n  CIGAR_I,\n  CIGAR_M,\n  CIGAR_N,\n  CIGAR_S,\n  CIGAR_X,\n  getCigarOps,\n} from './cigarUtil.ts'\nimport { getCharWidthHeight } from '../../shared/util.ts'\n\nimport type { Mismatch } from '../../shared/types.ts'\nimport type { ProcessedRenderArgs } from '../types.ts'\nimport type { LayoutFeature } from '../util.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Theme } from '@mui/material'\n\nexport function renderSoftClipping({\n  ctx,\n  feat,\n  renderArgs,\n  config,\n  theme,\n  colorMap,\n  canvasWidth,\n}: {\n  ctx: CanvasRenderingContext2D\n  feat: LayoutFeature\n  renderArgs: ProcessedRenderArgs\n  config: AnyConfigurationModel\n  colorMap: Record<string, string>\n  theme: Theme\n  canvasWidth: number\n}) {\n  const { feature, topPx, heightPx } = feat\n  const { regions, bpPerPx } = renderArgs\n  const region = regions[0]!\n  const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n  const mismatches = feature.get('mismatches') as Mismatch[] | undefined\n  const seq = feature.get('seq') as string | undefined\n  const { charWidth, charHeight } = getCharWidthHeight()\n\n  // Display all bases softclipped off in lightened colors\n  if (!(seq && mismatches)) {\n    return\n  }\n\n  const heightLim = charHeight - 2\n  let seqOffset = 0\n  let refOffset = 0\n  const CIGAR =\n    feature.get('NUMERIC_CIGAR') || (feature.get('CIGAR') as string | undefined)\n  const ops = getCigarOps(CIGAR)\n  const featStart = feature.get('start')\n  const regionStart = region.start\n  const regionEnd = region.end\n  const reversed = region.reversed\n  const invBpPerPx = 1 / bpPerPx\n\n  for (let i = 0, l = ops.length; i < l; i++) {\n    const packed = ops[i]!\n    const len = packed >> 4\n    const op = packed & 0xf\n    if (op === CIGAR_S) {\n      // Calculate soft clip region bounds\n      const clipStart = featStart - (i === 0 ? len : 0) + refOffset\n      const clipEnd = clipStart + len\n\n      // Skip if entirely outside visible region\n      if (clipEnd > regionStart && clipStart < regionEnd) {\n        const visStart = Math.max(0, regionStart - clipStart)\n        const visEnd = Math.min(len, regionEnd - clipStart)\n\n        for (let k = visStart; k < visEnd; k++) {\n          const base = seq[seqOffset + k]!\n          const s0 = clipStart + k\n          const leftPx = reversed\n            ? (regionEnd - s0 - 1) * invBpPerPx\n            : (s0 - regionStart) * invBpPerPx\n          const rightPx = reversed\n            ? (regionEnd - s0) * invBpPerPx\n            : (s0 + 1 - regionStart) * invBpPerPx\n          const widthPx = Math.max(minFeatWidth, rightPx - leftPx)\n\n          // Black accounts for IUPAC ambiguity code bases such as N that\n          // show in soft clipping\n          const baseColor = colorMap[base] || '#000000'\n          ctx.fillStyle = baseColor\n          ctx.fillRect(leftPx, topPx, widthPx, heightPx)\n\n          if (widthPx >= charWidth && heightPx >= heightLim) {\n            const x = leftPx + (widthPx - charWidth) / 2 + 1\n            const y = topPx + heightPx\n            const color = theme.palette.getContrastText(baseColor)\n            if (x >= 0 && x <= canvasWidth && color) {\n              ctx.fillStyle = color\n              ctx.fillText(base, x, y)\n            }\n          }\n        }\n      }\n      seqOffset += len\n    } else if (op === CIGAR_N) {\n      refOffset += len\n    } else if (op === CIGAR_M || op === CIGAR_EQ || op === CIGAR_X) {\n      refOffset += len\n      seqOffset += len\n    } else if (op === CIGAR_D) {\n      refOffset += len\n    } else if (op === CIGAR_I) {\n      seqOffset += len\n    }\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util'\nimport Flatbush from '@jbrowse/core/util/flatbush'\nimport { checkStopToken2 } from '@jbrowse/core/util/stopToken'\n\nimport { layoutFeats } from './layoutFeatures.ts'\nimport { renderAlignment } from './renderers/renderAlignment.ts'\nimport { renderMismatchesCallback } from './renderers/renderMismatchesCallback.ts'\nimport { renderSoftClipping } from './renderers/renderSoftClipping.ts'\nimport {\n  getCharWidthHeight,\n  getColorBaseMap,\n  getContrastBaseMap,\n  setAlignmentFont,\n  shouldDrawIndels,\n  shouldDrawSNPsMuted,\n} from '../shared/util.ts'\n\nimport type {\n  FlatbushItem,\n  LayoutFeature,\n  PreProcessedRenderArgs,\n  ProcessedRenderArgs,\n} from './types.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseSequenceAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nasync function fetchRegionSequence(\n  renderArgs: PreProcessedRenderArgs,\n  pluginManager: PluginManager,\n) {\n  const { colorBy, features, sessionId, regions, adapterConfig } = renderArgs\n  if (colorBy?.type !== 'methylation' || !features.size) {\n    return undefined\n  }\n  // Get the BAM/CRAM adapter to access its cached sequenceAdapterConfig\n  const { dataAdapter } = await getAdapter(\n    pluginManager,\n    sessionId,\n    adapterConfig,\n  )\n  const sequenceAdapterConfig = (\n    dataAdapter as { sequenceAdapterConfig?: Record<string, unknown> }\n  ).sequenceAdapterConfig\n  if (!sequenceAdapterConfig) {\n    return undefined\n  }\n  const { dataAdapter: seqAdapter } = await getAdapter(\n    pluginManager,\n    sessionId,\n    sequenceAdapterConfig,\n  )\n  const region = regions[0]!\n  return (seqAdapter as BaseSequenceAdapter).getSequence({\n    ...region,\n    refName: region.originalRefName || region.refName,\n    start: Math.max(0, region.start - 1),\n    end: region.end + 1,\n  })\n}\n\nfunction renderFeatures({\n  ctx,\n  layoutRecords,\n  canvasWidth,\n  renderArgs,\n}: {\n  ctx: CanvasRenderingContext2D\n  canvasWidth: number\n  layoutRecords: LayoutFeature[]\n  renderArgs: ProcessedRenderArgs\n}) {\n  const {\n    stopTokenCheck,\n    config,\n    showSoftClip,\n    colorBy,\n    theme: configTheme,\n  } = renderArgs\n  const mismatchAlpha = readConfObject(config, 'mismatchAlpha')\n  const minSubfeatureWidth = readConfObject(config, 'minSubfeatureWidth')\n  const largeInsertionIndicatorScale = readConfObject(\n    config,\n    'largeInsertionIndicatorScale',\n  )\n  const hideSmallIndels = readConfObject(config, 'hideSmallIndels') as boolean\n  const hideMismatches = readConfObject(config, 'hideMismatches') as boolean\n  const hideLargeIndels = readConfObject(config, 'hideLargeIndels') as boolean\n  const defaultColor = readConfObject(config, 'color') === '#f0f'\n  const theme = createJBrowseTheme(configTheme)\n  const colorMap = getColorBaseMap(theme)\n  const colorContrastMap = getContrastBaseMap(theme)\n  setAlignmentFont(ctx)\n\n  const { charWidth, charHeight } = getCharWidthHeight()\n  const drawSNPsMuted = shouldDrawSNPsMuted(colorBy?.type)\n  const drawIndels = shouldDrawIndels()\n  const coords = [] as number[]\n  const items = [] as FlatbushItem[]\n\n  for (const feat of layoutRecords) {\n    const alignmentRet = renderAlignment({\n      ctx,\n      feat,\n      renderArgs,\n      defaultColor,\n      colorMap,\n      colorContrastMap,\n      charWidth,\n      charHeight,\n      canvasWidth,\n    })\n    for (let i = 0, l = alignmentRet.coords.length; i < l; i++) {\n      coords.push(alignmentRet.coords[i]!)\n    }\n    for (let i = 0, l = alignmentRet.items.length; i < l; i++) {\n      items.push(alignmentRet.items[i]!)\n    }\n    const ret = renderMismatchesCallback({\n      ctx,\n      feat,\n      bpPerPx: renderArgs.bpPerPx,\n      regions: renderArgs.regions,\n      hideSmallIndels,\n      hideMismatches,\n      hideLargeIndels,\n      mismatchAlpha,\n      drawSNPsMuted,\n      drawIndels,\n      largeInsertionIndicatorScale,\n      minSubfeatureWidth,\n      charWidth,\n      charHeight,\n      colorMap,\n      colorContrastMap,\n      canvasWidth,\n    })\n    for (let i = 0, l = ret.coords.length; i < l; i++) {\n      coords.push(ret.coords[i]!)\n    }\n    for (let i = 0, l = ret.items.length; i < l; i++) {\n      items.push(ret.items[i]!)\n    }\n    if (showSoftClip) {\n      renderSoftClipping({\n        ctx,\n        feat,\n        renderArgs,\n        colorMap,\n        config,\n        theme,\n        canvasWidth,\n      })\n    }\n    checkStopToken2(stopTokenCheck)\n  }\n\n  const flatbush = new Flatbush(Math.max(items.length, 1))\n  if (coords.length) {\n    for (let i = 0; i < coords.length; i += 4) {\n      flatbush.add(coords[i]!, coords[i + 1]!, coords[i + 2], coords[i + 3])\n    }\n  } else {\n    flatbush.add(0, 0)\n  }\n  flatbush.finish()\n\n  return {\n    flatbush: flatbush.data,\n    items,\n  }\n}\n\nexport async function makeImageData({\n  width,\n  renderArgs,\n  pluginManager,\n}: {\n  width: number\n  renderArgs: PreProcessedRenderArgs\n  pluginManager: PluginManager\n}) {\n  const { statusCallback = () => {}, features } = renderArgs\n\n  statusCallback('Creating layout')\n  const { layoutRecords, height } = layoutFeats(renderArgs)\n\n  statusCallback('Fetching sequence')\n  const regionSequence = await fetchRegionSequence(renderArgs, pluginManager)\n\n  statusCallback('Rendering alignments')\n  const result = await renderToAbstractCanvas(width, height, renderArgs, ctx =>\n    renderFeatures({\n      ctx,\n      layoutRecords,\n      canvasWidth: width,\n      renderArgs: {\n        ...renderArgs,\n        regionSequence,\n      },\n    }),\n  )\n\n  const featureNames: Record<string, string> = {}\n  for (const [id, feature] of features) {\n    const name = feature.get('name')\n    if (name) {\n      featureNames[id] = name\n    }\n  }\n\n  return { result, height, featureNames }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\n\nimport { layoutFeature } from './layoutFeature.ts'\nimport { sortFeature } from './sortUtil.ts'\n\nimport type { LayoutFeature, PreProcessedRenderArgs } from './types.ts'\n\n// layout determines the height of the canvas that we use to render\nexport function layoutFeats(props: PreProcessedRenderArgs) {\n  const { layout, features, sortedBy, config, showSoftClip, regions } = props\n  const region = regions[0]!\n  const hasSortedBy = sortedBy?.type && region.start === sortedBy.pos\n  const featureMap = hasSortedBy ? sortFeature(features, sortedBy) : features\n\n  const heightPx = readConfObject(config, 'height')\n  const displayMode = readConfObject(config, 'displayMode')\n\n  // Sort features by start position for PileupLayout's built-in hint optimization,\n  // but only when not using explicit sorting (which has its own order)\n  const featureArr = hasSortedBy\n    ? [...featureMap.values()]\n    : [...featureMap.values()].sort((a, b) => a.get('start') - b.get('start'))\n\n  const layoutRecords: LayoutFeature[] = []\n\n  for (const feature of featureArr) {\n    const result = layoutFeature({\n      feature,\n      layout,\n      showSoftClip,\n      heightPx,\n      displayMode,\n    })\n\n    if (result) {\n      layoutRecords.push(result)\n    }\n  }\n\n  return {\n    layoutRecords,\n    height: Math.max(layout.getTotalHeight(), 1),\n  }\n}\n","import { doesIntersect2 } from '@jbrowse/core/util'\n\nimport type { Mismatch, SortedBy } from '../shared/types.ts'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport function sortFeature(\n  features: Map<string, Feature>,\n  sortedBy: SortedBy,\n) {\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // Partition features directly from map iterator (avoids intermediate array)\n  let firstFeature: Feature | undefined\n  for (const feature of features.values()) {\n    if (!firstFeature) {\n      firstFeature = feature\n    }\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(feature)\n    } else {\n      featuresOutsideCenter.push(feature)\n    }\n  }\n\n  const isCram = firstFeature ? firstFeature.get('tags') : false\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    case 'tag': {\n      const tag = sortedBy.tag!\n      const getTag = (f: Feature, t: string) => {\n        return isCram ? f.get('tags')[t] : f.get(t)\n      }\n      const isString =\n        featuresInCenterLine[0] &&\n        typeof getTag(featuresInCenterLine[0], tag) === 'string'\n      if (isString) {\n        featuresInCenterLine.sort((a, b) =>\n          getTag(b, tag).localeCompare(getTag(a, tag)),\n        )\n      } else {\n        featuresInCenterLine.sort(\n          (a, b) => (getTag(b, tag) || 0) - (getTag(a, tag) || 0),\n        )\n      }\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseMap = new Map<string, Mismatch>()\n      for (const feature of featuresInCenterLine) {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        const start = feature.get('start')\n        for (const m of mismatches) {\n          const offset = start + m.start + 1\n          const consuming = m.type === 'insertion' || m.type === 'softclip'\n          const len = consuming ? 0 : m.length\n          if (pos >= offset && pos < offset + len) {\n            baseMap.set(feature.id(), m)\n          }\n        }\n      }\n\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode =\n          aMismatch?.type === 'mismatch'\n            ? aMismatch.base.toUpperCase()\n            : aMismatch?.type === 'deletion'\n              ? '*'\n              : undefined\n        const bcode =\n          bMismatch?.type === 'mismatch'\n            ? bMismatch.base.toUpperCase()\n            : bMismatch?.type === 'deletion'\n              ? '*'\n              : undefined\n        return acode === bcode && acode === '*'\n          ? (bMismatch?.length ?? 0) - (aMismatch?.length ?? 0)\n          : (bcode ? bcode.charCodeAt(0) : 0) -\n              (acode ? acode.charCodeAt(0) : 0)\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  // Build result map directly without intermediate array spread\n  const result = new Map<string, Feature>()\n  for (const feature of featuresInCenterLine) {\n    result.set(feature.id(), feature)\n  }\n  for (const feature of featuresOutsideCenter) {\n    result.set(feature.id(), feature)\n  }\n  return result\n}\n"],"names":["getMethBins","feature","cigarOps","fstart","get","fend","fstrand","flen","mm","getTagAlt","methBins","hydroxyMethBins","methProbs","hydroxyMethProbs","seq","probabilities","getModProbabilities","modifications","getModPositions","probIndex","type","positions","ref","idx","getNextRefPos","idx2","length","prob","layoutFeature","layout","showSoftClip","heightPx","displayMode","s","e","mismatches","mismatch","cliplen","start","topPx","addRect","id","getAlignmentShapeColor","colorType","tag","config","defaultColor","colorTagMap","Math","abs","colorByInsertSize","colorByStrand","colorByMappingQuality","fillColor","orientationType","readConfObject","LR","RR","RL","LL","orientationTypes","getOrientation","colorByOrientation","flags","strand","flipper","getStranded","colorByStrandedRnaSeq","tags","val","color_rev_strand","color_fwd_strand","color_nostrand","drawForwardChevron","ctx","leftPx","rightPx","midY","beginPath","moveTo","lineTo","CHEVRON_WIDTH","closePath","fill","drawReverseChevron","RED_COLORD","colord","BLUE_COLORD","PINK_COLORD","PURPLE_COLORD","qualityColors","Array","from","_","score","collectResults","ret","coords","items","i","l","push","renderAlignment","feat","renderArgs","colorMap","colorContrastMap","charWidth","charHeight","canvasWidth","bpPerPx","regions","colorBy","region","alignmentColor","getCigarOps","color","regionStart","regionEnd","end","reversed","invBpPerPx","flip","renderChevrons","fillStyle","hasSkips","CIGAR_N","drawLen","drawStart","opsLen","packed","opLen","op","CIGAR_REF_CONSUMING_MASK","drawEnd","w","fillRect","drawBegin","renderAlignmentShape","scores","split","map","soffset","roffset","len","opIdx","CIGAR_S","CIGAR_I","CIGAR_D","CIGAR_M","CIGAR_X","CIGAR_EQ","opStart","opEnd","visStart","max","visEnd","min","m","refPos","renderPerBaseQuality","heightLim","letter","r","x","y","fillText","renderPerBaseLettering","renderModifications","regionSequence","bottomPx","Error","mismatchMap","buildMismatchMap","getColAndProb","k","p","alpha","toHslString","toLowerCase","drawBase","info","label","modType","mismatchBase","toFixed","probability","j","l1","l2","info1","info2","renderMethylation","renderSoftClipping","theme","minFeatWidth","getCharWidthHeight","seqOffset","refOffset","CIGAR","ops","featStart","clipStart","base","s0","widthPx","baseColor","palette","getContrastText","async","makeImageData","width","pluginManager","statusCallback","features","layoutRecords","height","props","sortedBy","hasSortedBy","pos","featureMap","featuresInCenterLine","featuresOutsideCenter","firstFeature","values","doesIntersect2","isCram","sort","a","b","getTag","f","t","localeCompare","baseMap","Map","offset","set","aMismatch","bMismatch","acode","toUpperCase","undefined","bcode","charCodeAt","result","sortFeature","featureArr","getTotalHeight","layoutFeats","sessionId","adapterConfig","size","dataAdapter","getAdapter","sequenceAdapterConfig","seqAdapter","getSequence","refName","originalRefName","fetchRegionSequence","renderToAbstractCanvas","stopTokenCheck","configTheme","mismatchAlpha","minSubfeatureWidth","largeInsertionIndicatorScale","hideSmallIndels","hideMismatches","hideLargeIndels","createJBrowseTheme","getColorBaseMap","getContrastBaseMap","setAlignmentFont","drawSNPsMuted","shouldDrawSNPsMuted","drawIndels","shouldDrawIndels","alignmentRet","renderMismatchesCallback","checkStopToken2","flatbush","Flatbush","add","finish","data","renderFeatures","featureNames","name"],"sourceRoot":""}