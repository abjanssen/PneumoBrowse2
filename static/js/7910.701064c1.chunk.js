"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7910],{7910(e,a,n){n.r(a),n.d(a,{default:()=>x});var t=n(42918),r=n(11259),s=n(85787),i=n(77251),o=n(70203),c=n(65045),l=n(35635),d=n(24215),y=n(1591),m=n(25861),f=n(15675),g=n(11543),u=n(65525),p=n(32118);const{Cu:h,NI:w,R3:S,Gl:b,bH:A}=l,k=(0,c.n)()({root:{width:300}});function x({track:e,feature:a,handleClose:n}){const{classes:c}=k(),[l,x]=(0,t.useState)("0"),[R,N]=(0,t.useState)(),[$,C]=(0,t.useState)(),v=+l;return(0,t.useEffect)(()=>{(async()=>{N(void 0);try{if(2048&a.get("flags")){const n=(A(a,"SA")||"").split(";")[0],[t,s]=n.split(","),{rpcManager:c}=(0,i.getSession)(e),l=(0,r.FI)(e,"adapter"),d=(0,o.getRpcSessionId)(e),y=(await c.call(d,"CoreGetFeatures",{adapterConfig:l,sessionId:d,regions:[{refName:t,start:+s-1,end:+s}]})).find(e=>!(e.get("name")!==a.get("name")||2048&e.get("flags")||256&e.get("flags")));if(!y)throw new Error("primary feature not found");C(y)}else C(a)}catch(e){console.error(e),N(e)}})()},[a,e]),(0,p.jsxs)(s.A,{open:!0,onClose:n,title:"Set window size",children:[(0,p.jsx)(d.A,{children:R?(0,p.jsx)(y.A,{color:"error",children:`${R}`}):$?(0,p.jsxs)("div",{className:c.root,children:[256&$.get("flags")?(0,p.jsx)(y.A,{style:{color:"orange"},children:"Note: You selected a secondary alignment (which generally does not have SA tags or SEQ fields) so do a full reconstruction of the alignment"}):null,(0,p.jsx)(y.A,{children:"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."}),(0,p.jsx)(f.A,{value:v,onChange:e=>{x(e.target.value)},label:"Set window size"})]}):(0,p.jsxs)("div",{children:[(0,p.jsx)(y.A,{children:"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."}),(0,p.jsx)(m.A,{})]})}),(0,p.jsxs)(g.A,{children:[(0,p.jsx)(u.A,{variant:"contained",color:"secondary",onClick:n,children:"Cancel"}),(0,p.jsx)(u.A,{disabled:!$,variant:"contained",color:"primary",onClick:function(){try{if(!$)return;const a=$,t=(0,i.getSession)(e),s=(0,i.getContainingView)(e),o=a.get("CIGAR"),c=a.get("flags"),l=a.get("strand"),d=A(a,"SA")||"",y=a.get("name"),m=w(o,1),f=`${y}_assembly_${Date.now()}`,[g]=(0,r.FI)(e,"assemblyNames"),u=[g,f],p=`track-${Date.now()}`,k=`${y}_vs_${g}`,{assemblyManager:x}=t,R=x.get(g);if(!R)throw new Error("assembly not found");const N=h(d,a.id(),l,y,!0),C=a.toJSON();C.clipLengthAtStartOfRead=m,C.strand=1,C.mate={refName:y,start:m,end:m+b(o)};const I=S(2048&c?N[0].CIGAR:o),q=[C,...N];for(const[e,a]of q.entries())a.refName=R.getCanonicalRefName(a.refName)||a.refName,a.syntenyId=e,a.mate.syntenyId=e,a.mate.uniqueId=`${a.uniqueId}_mate`;q.sort((e,a)=>e.clipLengthAtStartOfRead-a.clipLengthAtStartOfRead);const j=a.get("seq"),L=[...q,...q.map(e=>e.mate)],T=2*v,_=q.reduce((e,a)=>e+a.end-a.start+T,0),D=`${y}_${Date.now()}`,M=(0,r.FI)(R,"sequence"),F=(0,i.gatherOverlaps)(q.map(e=>({...e,start:Math.max(0,e.start-v),end:e.end+v,assemblyName:g})));t.addTemporaryAssembly?.({name:f,sequence:{type:"ReferenceSequenceTrack",name:"Read sequence",trackId:D,assemblyNames:[f],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:I,seq:j||"",refName:y,uniqueId:`${Math.random()}`}]}}}),t.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:_/s.width,displayedRegions:F,tracks:[{id:`${Math.random()}`,type:"ReferenceSequenceTrack",assemblyNames:[g],configuration:M.trackId,displays:[{id:`${Math.random()}`,type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:`${M.trackId}-LinearReferenceSequenceDisplay`}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:I/s.width,displayedRegions:[{assemblyName:f,start:0,end:I,refName:y}],tracks:[{id:`${Math.random()}`,type:"ReferenceSequenceTrack",configuration:D,displays:[{id:`${Math.random()}`,type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:`${D}-LinearReferenceSequenceDisplay`}]}]}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:u,adapter:{type:"FromConfigAdapter",features:L},trackId:p,name:k}],tracks:[{configuration:p,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:`${p}-LinearSyntenyDisplay`}]}],displayName:`${y} vs ${g}`}),n()}catch(e){console.error(e),N(e)}},children:"Submit"})]})]})}}}]);
//# sourceMappingURL=7910.701064c1.chunk.js.map