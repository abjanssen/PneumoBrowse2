"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5534],{25534(e,t,n){n.d(t,{default:()=>h});var s=n(45188),i=n(90946),r=n(23886),a=n(11931),o=n(49303),l=n(25529),c=n(43102),f=n(66431);class h extends i.L{async configurePre(e){const t=this.getConf("gffGzLocation"),n=this.getConf(["index","indexType"]),i=this.getConf(["index","location"]),r=this.getConf("dontRedispatch"),o=new s.wD({filehandle:(0,a.openLocation)(t,this.pluginManager),csiFilehandle:"CSI"===n?(0,a.openLocation)(i,this.pluginManager):void 0,tbiFilehandle:"CSI"!==n?(0,a.openLocation)(i,this.pluginManager):void 0,chunkCacheSize:52428800});return{gff:o,dontRedispatchSet:new Set(r),header:await o.getHeader()}}async configurePre2(){return this.configured||(this.configured=this.configurePre().catch(e=>{throw this.configured=void 0,e})),this.configured}async configure(e){const{statusCallback:t=()=>{}}=e||{};return(0,r.updateStatus)("Downloading index",t,()=>this.configurePre2())}async getRefNames(e={}){const{gff:t}=await this.configure(e);return t.getReferenceSequenceNames(e)}async getHeader(e={}){const{gff:t}=await this.configure(e);return t.getHeader()}getFeatures(e,t={}){return(0,l.ObservableCreate)(async n=>{const{gff:s}=await this.configure(t),i=await s.getMetadata();await this.getFeaturesHelper(e,t,i,n,!0)},t.stopToken)}async getFeaturesHelper(e,t,n,s,i,a=e){const{statusCallback:l=()=>{}}=t;try{const h=[],{dontRedispatchSet:u,gff:g}=await this.configure(t);if(await(0,r.updateStatus)("Downloading features",l,()=>g.getLines(e.refName,e.start,e.end,(e,t,n,s)=>{const i=e.indexOf("\t"),r=e.indexOf("\t",i+1),a=e.indexOf("\t",r+1),o=e.slice(r+1,a);h.push({line:e,lineHash:t,start:n,end:s,hasEscapes:e.includes("%"),type:o})})),i&&h.length){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const e of h)if(!u.has(e.type)){const t=e.start-1;t<i&&(i=t),e.end>r&&(r=e.end)}if(r>e.end||i<e.start)return void await this.getFeaturesHelper({...e,start:i,end:r},t,n,s,!1,e)}for(const e of(0,f.w2)(h))(0,o.R6)(e.start,e.end,a.start,a.end)&&s.next(new c.A({data:e,id:`${this.id}-offset-${e._lineHash}`}));s.complete()}catch(e){s.error(e)}}}},66431(e,t,n){n.d(t,{w2:()=>f,ES:()=>c});const s={};for(let e=0;e<256;e++){const t=e.toString(16).toUpperCase().padStart(2,"0");s[t]=String.fromCharCode(e),s[t.toLowerCase()]=String.fromCharCode(e)}function i(e){const t=e.indexOf("%");if(-1===t)return e;let n="",i=0,r=t;for(;r<e.length;)if("%"===e[r]&&r+2<e.length){n+=e.slice(i,r);const t=e.slice(r+1,r+3),a=s[t];n+=void 0!==a?a:e.slice(r,r+3),r+=3,i=r}else r++;return n+e.slice(i)}const r=new Set(["start","end","seq_id","score","type","source","phase","strand"]);function a(e){return"+"===e?1:"-"===e?-1:"."===e?0:void 0}function o(e){const t=e.split("\t"),n=t[0],s=t[1],o=t[2],l=t[3],c=t[4],f=t[5],h=t[6],u=t[7],g=t[8],d={refName:0===n.length||"."===n?"":i(n),source:0===s.length||"."===s?null:i(s),type:0===o.length||"."===o?null:i(o),start:0===l.length||"."===l?0:+l-1,end:0===c.length||"."===c?0:+c,score:0===f.length||"."===f?void 0:+f,strand:a(h),phase:0===u.length||"."===u?void 0:+u,subfeatures:[]};return function(e,t){if(0===e.length||"."===e)return;let n=e.length;"\n"===e[n-1]&&(n="\r"===e[n-2]?n-2:n-1,e=e.slice(0,n));let s=0;for(;s<n;){let a=e.indexOf(";",s);if(-1===a&&(a=n),a>s){const n=e.indexOf("=",s);if(-1!==n&&n<a&&n+1<a){const o=e.slice(s,n);if("_lineHash"===o){s=a+1;continue}let l=o.toLowerCase();r.has(l)&&(l+="2");const c=[];let f=n+1;for(;f<a;){let t=e.indexOf(",",f);if((-1===t||t>a)&&(t=a),t>f){const n=e.slice(f,t);c.push(i(n))}f=t+1}t[l]=1===c.length?c[0]:c}}s=a+1}}(g,d),d}function l(e){const t=e.split("\t"),n=t[0],s=t[1],i=t[2],o=t[3],l=t[4],c=t[5],f=t[6],h=t[7],u=t[8],g={refName:0===n.length||"."===n?"":n,source:0===s.length||"."===s?null:s,type:0===i.length||"."===i?null:i,start:0===o.length||"."===o?0:+o-1,end:0===l.length||"."===l?0:+l,score:0===c.length||"."===c?void 0:+c,strand:a(f),phase:0===h.length||"."===h?void 0:+h,subfeatures:[]};return function(e,t){if(0===e.length||"."===e)return;let n=e.length;"\n"===e[n-1]&&(n="\r"===e[n-2]?n-2:n-1,e=e.slice(0,n));let s=0;for(;s<n;){let i=e.indexOf(";",s);if(-1===i&&(i=n),i>s){const n=e.indexOf("=",s);if(-1!==n&&n<i&&n+1<i){const a=e.slice(s,n);if("_lineHash"===a){s=i+1;continue}let o=a.toLowerCase();r.has(o)&&(o+="2");const l=[];let c=n+1;for(;c<i;){let t=e.indexOf(",",c);(-1===t||t>i)&&(t=i),t>c&&l.push(e.slice(c,t)),c=t+1}t[o]=1===l.length?l[0]:l}}s=i+1}}(u,g),g}function c(e){return f(function(e){const t=e.split(/\r?\n/),n=[];for(let e=0;e<t.length;e++){const s=t[e];if(0!==s.length&&"#"!==s[0]){if(">"===s[0])break;n.push({line:s,start:0,end:0,hasEscapes:s.includes("%")})}else if(s.startsWith("##FASTA"))break}return n}(e))}function f(e){const t=[],n=new Map,s=new Map;for(let i=0;i<e.length;i++){const r=e[i],a=r.hasEscapes?o(r.line):l(r.line);void 0!==r.lineHash&&(a._lineHash=String(r.lineHash));const c=a.id,f=a.parent;if(c||f){if(c&&!n.get(c)){f||t.push(a),n.set(c,a);const e=s.get(c);if(e){for(let t=0;t<e.length;t++)a.subfeatures.push(e[t]);s.delete(c)}}if(f){const e=Array.isArray(f)?f:[f];for(let t=0;t<e.length;t++){const i=e[t],r=n.get(i);if(r)r.subfeatures.push(a);else{let e=s.get(i);e||(e=[],s.set(i,e)),e.push(a)}}}}else t.push(a)}return t}}}]);
//# sourceMappingURL=5534.03975c46.chunk.js.map