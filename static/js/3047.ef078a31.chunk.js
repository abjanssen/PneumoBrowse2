"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3047],{79610:(e,t,a)=>{a.d(t,{$2:()=>o,Eg:()=>c,WT:()=>s,f0:()=>l,mr:()=>r});var n=a(99546),i=a(30385);function r({feature:e,ctx:t,offsets:a,level:i,cb:r,height:s,drawCurves:l,oobLimit:c,viewWidth:f,hideTiny:h}){const{p11:g,p12:d,p21:m,p22:u}=e,w=g.offsetPx-a[i],p=d.offsetPx-a[i],v=m.offsetPx-a[i+1],b=u.offsetPx-a[i+1],x=Math.abs(p-w),y=Math.abs(b-v),k=s,M=(k-0)/2,C=Math.min(v,b),S=Math.max(v,b);(0,n.doesIntersect2)(C,S,-c,f+c)&&(x<=1&&y<=1?h||(t.beginPath(),t.moveTo(w,0),l?t.bezierCurveTo(w,M,v,M,v,k):t.lineTo(v,k),t.stroke()):(o(t,w,p,0,b,v,k,M,l),r(t)))}function o(e,t,a,n,i,r,o,s,l){l?function(e,t,a,n,i,r,o,s){const l=Math.abs(t-a),c=Math.abs(t-a);if(l<5&&c<5&&a<t&&Math.abs(t-i)>100){const e=t;t=a,a=e}e.beginPath(),e.moveTo(t,n),e.lineTo(a,n),e.bezierCurveTo(a,s,i,s,i,o),e.lineTo(r,o),e.bezierCurveTo(r,s,t,s,t,n),e.closePath()}(e,t,a,n,i,r,o,s):function(e,t,a,n,i,r,o){e.beginPath(),e.moveTo(t,n),e.lineTo(a,n),e.lineTo(i,o),e.lineTo(r,o),e.closePath()}(e,t,a,n,i,r,o)}function s(e,t){const a=(0,n.getContainingView)(t),r=(0,n.getContainingTrack)(t),{featPositions:o,numFeats:s,clickMapCanvas:l,cigarClickMapCanvas:c,level:f}=t;if(!l||!c)return;const h=l.getBoundingClientRect(),g=l.getContext("2d"),d=c.getContext("2d");if(!g||!d)return;const m=e.clientX-h.left,u=e.clientY-h.top,[w,p,v]=g.getImageData(m,u,1,1).data,b=Math.floor(i.xx/s),x=o[(0,i.OX)(w,p,v,b)];if(x){const{f:e}=x;t.setClickId(e.id());const i=(0,n.getSession)(t);(0,n.isSessionModelWithWidgets)(i)&&i.showWidget(i.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:a,track:r,featureData:e.toJSON(),level:f}))}return x}function l(e,t,a){e.preventDefault();const n=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(!n||!r)return;const o=n.getBoundingClientRect(),s=n.getContext("2d"),l=r.getContext("2d");if(!s||!l)return;const{clientX:c,clientY:f}=e,h=c-o.left,g=f-o.top,[d,m,u]=s.getImageData(h,g,1,1).data,w=Math.floor(i.xx/t.numFeats),p=(0,i.OX)(d,m,u,w),v=t.featPositions[p];v&&(t.setClickId(v.f.id()),a({clientX:c,clientY:f,feature:v}))}function c({feature:e,cigarOp:t,cigarOpLen:a}){const i=e.toJSON(),r=i.mate,o=i.end-i.start,s=r.end-r.start,l=i.identity,c=i.name,f=r.name;return[`Loc1: ${(0,n.assembleLocString)(i)}`,`Loc2: ${(0,n.assembleLocString)(r)}`,`Inverted: ${-1===i.strand}`,`Query len: ${o.toLocaleString("en-US")}`,`Target len: ${s.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${a}`:"",c?`Name 1: ${c}`:"",f?`Name 1: ${f}`:""].filter((e=>!!e)).join("<br/>")}},30385:(e,t,a)=>{a.d(t,{C4:()=>g,OX:()=>f,Ww:()=>h,xx:()=>r});var n=a(99546),i=a(79610);const r=16581375;function o(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const s={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},l=3,c=1600;function f(e,t,a,n){return Math.floor((255*e*255+255*t+a-1)/n)}function h(e,t,a){const f=(0,n.getContainingView)(e),h=f.drawCurves,g=f.drawCIGAR,{level:d,height:m,featPositions:u}=e,w=f.width,p=f.views.map((e=>e.bpPerPx));a&&(a.imageSmoothingEnabled=!1),t.beginPath();const v=f.views.map((e=>e.offsetPx)),b=Math.floor(r/u.length);t.fillStyle=s.M,t.strokeStyle=s.M;for(const{p11:e,p12:a,p21:n,p22:i}of u){const r=e.offsetPx-v[d],o=a.offsetPx-v[d],s=n.offsetPx-v[d+1],f=i.offsetPx-v[d+1],g=Math.abs(o-r),u=Math.abs(f-s),p=0,b=m,x=(b-p)/2;g<=l&&u<=l&&s<w+c&&s>-c&&(t.moveTo(r,p),h?t.bezierCurveTo(r,x,s,x,s,b):t.lineTo(s,b))}t.stroke(),t.fillStyle=s.M,t.strokeStyle=s.M;for(const{p11:e,p12:b,p21:x,p22:y,f:k,cigar:M}of u){const u=e.offsetPx-v[d],C=b.offsetPx-v[d],S=x.offsetPx-v[d+1],P=y.offsetPx-v[d+1],T=Math.abs(C-u),$=Math.abs(P-S),E=Math.min(S,P),L=Math.max(S,P),R=0,z=m,I=(z-R)/2;if(!(T<=l&&$<=l)&&(0,n.doesIntersect2)(E,L,-c,f.width+c)){const e=k.get("strand"),n=-1===e?C:u,l=n<(-1===e?u:C)?1:-1,c=(S<P?1:-1)*e;let f=n,m=-1===e?P:S;if(M.length&&g){let e=!1,n=0,g=0;const u=Math.floor(r/M.length);for(let r=0;r<M.length;r+=2){const v=r*u+1,b=+M[r],x=M[r+1];e||(n=f,g=m);const y=b/p[d],k=b/p[d+1];if("M"===x||"="===x||"X"===x?(f+=y*l,m+=k*c):"D"===x||"N"===x?f+=y*l:"I"===x&&(m+=k*c),!(Math.max(n,g,f,m)<0||Math.min(n,g,f,m)>w)){const l=r<M.length-2;Math.abs(f-n)<=1&&Math.abs(m-g)<=1&&l?e=!0:(t.fillStyle=s[e&&y>1||k>1?x:"M"],e=!1,(0,i.$2)(t,n,f,R,m,g,z,I,h),t.fill(),a&&(a.fillStyle=o(v),(0,i.$2)(a,n,f,R,m,g,z,I,h),a.fill()))}}}else(0,i.$2)(t,u,C,R,P,S,z,I,h),t.fill()}}const x=e.clickMapCanvas?.getContext("2d");if(x){x.imageSmoothingEnabled=!1,x.clearRect(0,0,w,m);for(let e=0;e<u.length;e++){const t=u[e],a=e*b+1;x.fillStyle=o(a),(0,i.mr)({cb:e=>{e.fill()},feature:t,ctx:x,drawCurves:h,level:d,offsets:v,oobLimit:c,viewWidth:f.width,hideTiny:!0,height:m})}}}function g(e){const{level:t,clickId:a,mouseoverId:r}=e,o=(0,n.getContainingView)(e),s=o.drawCurves,l=e.height,f=o.width,h=e.mouseoverCanvas?.getContext("2d"),g=o.views.map((e=>e.offsetPx));if(!h)return;h.resetTransform(),h.scale(1,1),h.clearRect(0,0,f,l),h.strokeStyle="rgba(0, 0, 0, 0.9)",h.fillStyle="rgba(0, 0, 0, 0.1)";const d=e.featMap[r||""];d&&(0,i.mr)({cb:e=>{e.fill()},feature:d,level:t,ctx:h,oobLimit:c,viewWidth:o.width,drawCurves:s,offsets:g,height:l});const m=e.featMap[a||""];m&&(0,i.mr)({cb:e=>{e.stroke()},feature:m,ctx:h,level:t,oobLimit:c,viewWidth:o.width,drawCurves:s,offsets:g,height:l})}},93047:(e,t,a)=>{a.d(t,{renderToSvg:()=>w});var n=a(7552),i=a(20139),r=a(36422),o=a(42489),s=a(99546),l=a(91468),c=a(49823),f=a(20529),h=a(48231);function g({width:e,height:t,shift:a}){const i=(0,h.A)();return n.createElement("rect",{width:e+2*a,height:t,fill:(0,s.stripAlpha)(i.palette.background.default)})}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d.apply(null,arguments)}function m({trackLabelOffset:e,fontSize:t,textHeight:a,trackLabels:i,view:r,displayResults:o,rulerHeight:l,shift:c}){const g=(0,h.A)();return n.createElement("g",{transform:`translate(${c} ${t})`},n.createElement("g",{transform:`translate(${e})`},n.createElement("text",d({x:0,fontSize:t},(0,s.getFillProps)(g.palette.text.primary)),r.assemblyNames.join(", ")),n.createElement(f.$m,{model:o.view,fontSize:t})),n.createElement("g",{transform:`translate(0 ${l+t})`},n.createElement(f.zh,{textHeight:a,trackLabels:i,fontSize:t,model:o.view,displayResults:o.data,trackLabelOffset:e})))}var u=a(30385);async function w(e,t){await(0,o.when)((()=>e.initialized));const{textHeight:a=18,rulerHeight:h=30,fontSize:d=13,trackLabels:w="offset",Wrapper:p=({children:e})=>e,themeName:v="default"}=t,b=(0,s.getSession)(e),x=b.allThemes?.()[v],{width:y,views:k,levels:M}=e,C=h,{createRootFn:S}=(0,r.getRoot)(e),P=k.map((e=>(0,f.mJ)(e.tracks,a,w)+C)),T=(0,s.sum)(P)+(0,s.sum)(M.map((e=>e.height)))+100,$=await Promise.all(k.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const a=e.displays[0];return await(0,o.when)((()=>void 0===a.ready||a.ready)),{track:e,result:await a.renderSvg({...t,theme:x})}})))})))),E=await Promise.all(M.map((async e=>await Promise.all(e.tracks.map((async a=>{const n=a.displays[0];await(0,o.when)((()=>void 0===n.ready||n.ready));const i=await(0,s.renderToAbstractCanvas)(y,e.height,{exportSVG:t},(e=>{(0,u.Ww)(n,e)}));if("imageData"in i)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in i?{html:await(0,s.getSerializedSvg)({...i,width:y,height:e.height})}:i})))))),L=(0,s.max)(k.flatMap((e=>e.tracks.map((e=>(0,s.measureText)((0,l.getTrackName)(e.configuration,b),d))))),0)+40,R="left"===w?L:0,z=y+R,I=(0,c.createJBrowseTheme)(x),O=[n.createElement(m,{rulerHeight:h,trackLabelOffset:R,shift:50,textHeight:a,trackLabels:w,displayResults:$[0],key:k[0].id,view:k[0],fontSize:d})];let W=P[0]+d+h;for(let e=1;e<k.length;e++){const t=k[e],i=M[e-1],r=E[e-1],o=P[e],l=i.height||0;O.push(n.createElement("g",{key:t.id,transform:`translate(0 ${W})`},l?n.createElement("defs",null,n.createElement("clipPath",{id:`synclip-${e}`},n.createElement("rect",{x:0,y:0,width:y,height:l}))):null,n.createElement("g",{transform:`translate(${50+R} ${d})`,clipPath:`url(#synclip-${e})`},r?.map(((e,t)=>n.createElement(s.ReactRendering,{key:t,rendering:e})))),n.createElement("g",{transform:`translate(0 ${l})`},n.createElement(m,{rulerHeight:h,shift:50,trackLabelOffset:R,textHeight:a,trackLabels:w,displayResults:$[e],key:t.id,view:t,fontSize:d})))),W+=o+d+h+l}return(0,s.renderToStaticMarkup)(n.createElement(i.A,{theme:I},n.createElement(p,null,n.createElement("svg",{width:y,height:T,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,z+100,T].toString()},n.createElement(g,{width:z,height:T,shift:50}),O))),S)}}}]);
//# sourceMappingURL=3047.ef078a31.chunk.js.map