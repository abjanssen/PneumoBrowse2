{"version":3,"file":"static/js/3462.ce18916e.chunk.js","mappings":"qLAKO,SAASA,EACdC,EACAC,GAEID,EAAKE,WACPC,EAAAA,EAAAA,WAAWH,EAAMC,IAEjBG,EAAAA,EAAAA,WAAWJ,EAAMC,EAErB,C,qECDA,SAASI,EACPC,EACAN,EACAO,EACAC,GAGA,MAAMC,EAAYH,EAAeI,IAAIC,GAAKA,EAAEC,UAAUC,OAAOC,GAAKA,EAAI,GAEtE,GAAyB,IAArBL,EAAUM,OACZ,MAAO,CAAEC,cAAe,IAAIC,KAM9B,MAEMC,EAAOC,KAAKC,KAAIC,EAAAA,EAAAA,KAAIZ,GAFR,IAGZa,EAAOH,KAAKC,KAAIG,EAAAA,EAAAA,KAAId,GAHR,IAIZe,GAAUxB,EAAKyB,OAAS,KAAOP,EAAOI,GAAQ,GAG9CN,EAAgB,IAAIC,IAC1B,IAAK,MAAM,GAAES,EAAE,SAAEd,KAAcN,EAAgB,CAC7C,MAAMqB,EACJf,EAAW,GAAKO,KAAKC,IAAIR,EAVX,IAUmCU,GAAQE,EAAS,EACpER,EAAcY,IAAIF,EAAIC,EACxB,CAEA,MAAO,CAAEX,gBACX,CAEO,SAASjB,EACdC,EACAC,IAEA4B,EAAAA,EAAAA,IAAgB7B,EAAMC,EAAKI,EAC7B,C,qEC9BA,SAASyB,EACPxB,EACAN,EACAO,EACAwB,GAEA,MAAMC,EAAYhC,EAAKgC,YAAa,EAC9BC,EAAYjC,EAAKkC,gBAAkB,KAEnCC,EAAS,IAAIC,EAAAA,EAA+B,CAChDC,OAAQ,EACRC,OAAQ,EACRL,cAIIM,EAAgBP,EAAY,EAAI,EAGtC,IAAK,MAAM,GAAEN,EAAE,KAAEc,EAAI,KAAEC,EAAI,MAAEC,KAAWpC,EACtC6B,EAAOQ,QAAQjB,EAAIc,EAAMC,EAAMV,EAAgBQ,EAAe,CAC5DK,KAAMF,EAAM,GACZG,KAAM,cACNC,OAAQ,cACRlC,SAAU6B,EAAOD,IAKrB,MAAMxB,EAAgB,IAAIC,IAC1B,IAAK,MAAOS,EAAIqB,KAASZ,EAAOa,gBAAiB,CAC/C,MAAMrB,EAAMoB,EAAK,GACjB/B,EAAcY,IAAIF,EAAIC,EACxB,CAEA,MAAO,CAAEX,gBAAeiC,aAAcd,EAAOe,iBAC/C,CAEO,SAASnD,EACdC,EACAC,IAEA4B,EAAAA,EAAAA,IAAgB7B,EAAMC,EAAK6B,EAC7B,C","sources":["../../../plugins/alignments/src/LinearReadCloudDisplay/drawFeatsAbstract.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/drawFeatsCloud.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/drawFeatsStack.ts"],"sourcesContent":["import { drawFeats as drawFeats1 } from './drawFeatsCloud'\nimport { drawFeats as drawFeats2 } from './drawFeatsStack'\n\nimport type { LinearReadCloudDisplayModel } from './model'\n\nexport function drawFeats(\n  self: LinearReadCloudDisplayModel,\n  ctx: CanvasRenderingContext2D,\n) {\n  if (self.drawCloud) {\n    drawFeats1(self, ctx)\n  } else {\n    drawFeats2(self, ctx)\n  }\n}\n","import { max, min } from '@jbrowse/core/util'\n\nimport { drawFeatsCommon } from './drawFeatsCommon'\n\nimport type { ComputedChain } from './drawFeatsCommon'\nimport type { LinearReadCloudDisplayModel } from './model'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * Calculate Y-offsets using logarithmic scaling based on distance\n */\nfunction calculateCloudYOffsets(\n  computedChains: ComputedChain[],\n  self: LinearReadCloudDisplayModel,\n  _view: LGV,\n  _featureHeight: number,\n) {\n  // Calculate Y-offsets based on distance (logarithmic scaling)\n  const distances = computedChains.map(c => c.distance).filter(d => d > 0)\n\n  if (distances.length === 0) {\n    return { chainYOffsets: new Map<string, number>() }\n  }\n\n  // Use log(distance + offset) instead of log(distance) to smooth out small values\n  // The offset shifts the logarithmic curve, reducing the dramatic variation for small TLEN\n  // This provides a smooth compression without hard thresholds\n  const logOffset = 10\n\n  const maxD = Math.log(max(distances) + logOffset)\n  const minD = Math.log(min(distances) + logOffset)\n  const scaler = (self.height - 20) / (maxD - minD || 1)\n\n  // Calculate Y-offsets for each chain\n  const chainYOffsets = new Map<string, number>()\n  for (const { id, distance } of computedChains) {\n    const top =\n      distance > 0 ? (Math.log(distance + logOffset) - minD) * scaler : 0\n    chainYOffsets.set(id, top)\n  }\n\n  return { chainYOffsets }\n}\n\nexport function drawFeats(\n  self: LinearReadCloudDisplayModel,\n  ctx: CanvasRenderingContext2D,\n) {\n  drawFeatsCommon(self, ctx, calculateCloudYOffsets)\n}\n","import GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\n\nimport { drawFeatsCommon } from './drawFeatsCommon'\n\nimport type { ComputedChain } from './drawFeatsCommon'\nimport type { LinearReadCloudDisplayModel } from './model'\nimport type { ReducedFeature } from '../shared/fetchChains'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface LayoutData {\n  feat: ReducedFeature\n  fill: string\n  stroke: string\n  distance: number\n}\n\n/**\n * Calculate Y-offsets using GranularRectLayout for stacking\n */\nfunction calculateStackYOffsets(\n  computedChains: ComputedChain[],\n  self: LinearReadCloudDisplayModel,\n  _view: LGV,\n  featureHeight: number,\n) {\n  const noSpacing = self.noSpacing ?? false\n  const maxHeight = self.trackMaxHeight ?? 1200\n\n  const layout = new GranularRectLayout<LayoutData>({\n    pitchX: 1,\n    pitchY: 1,\n    maxHeight,\n  })\n\n  // Add small padding between rows (unless noSpacing is enabled)\n  const layoutPadding = noSpacing ? 0 : 1\n\n  // First pass: add all dummy chain rectangles to the layout\n  for (const { id, minX, maxX, chain } of computedChains) {\n    layout.addRect(id, minX, maxX, featureHeight + layoutPadding, {\n      feat: chain[0]!, // Use first feature as a placeholder for layout data\n      fill: 'transparent',\n      stroke: 'transparent',\n      distance: maxX - minX,\n    })\n  }\n\n  // Second pass: retrieve laid-out rectangles and populate chainYOffsets\n  const chainYOffsets = new Map<string, number>()\n  for (const [id, rect] of layout.getRectangles()) {\n    const top = rect[1]\n    chainYOffsets.set(id, top) // Store the Y-offset (top) for the chain\n  }\n\n  return { chainYOffsets, layoutHeight: layout.getTotalHeight() }\n}\n\nexport function drawFeats(\n  self: LinearReadCloudDisplayModel,\n  ctx: CanvasRenderingContext2D,\n) {\n  drawFeatsCommon(self, ctx, calculateStackYOffsets)\n}\n"],"names":["drawFeats","self","ctx","drawCloud","drawFeats1","drawFeats2","calculateCloudYOffsets","computedChains","_view","_featureHeight","distances","map","c","distance","filter","d","length","chainYOffsets","Map","maxD","Math","log","max","minD","min","scaler","height","id","top","set","drawFeatsCommon","calculateStackYOffsets","featureHeight","noSpacing","maxHeight","trackMaxHeight","layout","GranularRectLayout","pitchX","pitchY","layoutPadding","minX","maxX","chain","addRect","feat","fill","stroke","rect","getRectangles","layoutHeight","getTotalHeight"],"sourceRoot":""}