{"version":3,"file":"static/js/5829.5f6d6805.chunk.js","mappings":"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","sources":["../../../plugins/variants/src/StructuralVariantChordRenderer/Chord.tsx","../../../plugins/variants/src/StructuralVariantChordRenderer/ReactComponent.tsx"],"sourcesContent":["import { useState } from 'react'\n\nimport { parseBreakend } from '@gmod/vcf'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getStrokeProps, polarToCartesian } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { AnyRegion, Block } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nfunction bpToRadians(block: Block, pos: number) {\n  const blockStart = block.region.elided ? 0 : block.region.start\n  const blockEnd = block.region.elided ? 0 : block.region.end\n  const bpOffset = block.flipped ? blockEnd - pos : pos - blockStart\n  return bpOffset / block.bpPerRadian + block.startRadians\n}\n\nfunction getEndpoint(\n  feature: Feature,\n  blocksForRefs: Record<string, Block>,\n  startBlock: Block,\n) {\n  const alt = feature.get('ALT')?.[0]\n  const bnd = alt && parseBreakend(alt)\n  const mate = feature.get('mate')\n  if (bnd) {\n    const [chr, pos] = bnd.MatePosition.split(':')\n    return { endBlock: blocksForRefs[chr], endPosition: +pos }\n  } else if (alt === '<TRA>') {\n    const chr2 = feature.get('INFO')?.CHR2?.[0]\n    const end = feature.get('INFO')?.END?.[0]\n    return {\n      endBlock: blocksForRefs[chr2],\n      endPosition: Number.parseInt(end, 10),\n    }\n  } else if (mate) {\n    return { endBlock: blocksForRefs[mate.refName], endPosition: mate.start }\n  }\n  return { endBlock: startBlock, endPosition: feature.get('end') }\n}\n\nconst Chord = observer(function Chord({\n  feature,\n  blocksForRefs,\n  radius,\n  config,\n  bezierRadius,\n  selected,\n  onClick,\n}: {\n  feature: Feature\n  blocksForRefs: Record<string, Block>\n  radius: number\n  config: AnyConfigurationModel\n  bezierRadius: number\n  selected: boolean\n  onClick: (feat: Feature, reg: AnyRegion, end: AnyRegion, evt: unknown) => void\n}) {\n  const [hovered, setHovered] = useState(false)\n  const startBlock = blocksForRefs[feature.get('refName')]\n  if (!startBlock) {\n    return null\n  }\n  const startPos = feature.get('start')\n  const { endBlock, endPosition } = getEndpoint(\n    feature,\n    blocksForRefs,\n    startBlock,\n  )\n  if (!endBlock) {\n    return null\n  }\n  const startRadians = bpToRadians(startBlock, startPos)\n  const endRadians = bpToRadians(endBlock, endPosition)\n  const [x1, y1] = polarToCartesian(radius, startRadians)\n  const [x2, y2] = polarToCartesian(radius, endRadians)\n  const [cx, cy] = polarToCartesian(\n    bezierRadius,\n    (endRadians + startRadians) / 2,\n  )\n  const stroke = readConfObject(\n    config,\n    hovered\n      ? 'strokeColorHover'\n      : selected\n        ? 'strokeColorSelected'\n        : 'strokeColor',\n    { feature },\n  )\n  return (\n    <path\n      data-testid={`chord-${feature.id()}`}\n      cursor=\"crosshair\"\n      fill=\"none\"\n      d={`M ${x1} ${y1} Q ${cx} ${cy} ${x2} ${y2}`}\n      {...getStrokeProps(stroke)}\n      strokeWidth={hovered ? 3 : 1}\n      onClick={evt => {\n        onClick(feature, startBlock.region, endBlock.region, evt)\n      }}\n      onMouseOver={() => {\n        setHovered(true)\n      }}\n      onMouseOut={() => {\n        setHovered(false)\n      }}\n    />\n  )\n})\n\nexport default Chord\n","import { useMemo } from 'react'\n\nimport { observer } from 'mobx-react'\n\nimport Chord from './Chord.tsx'\n\nimport type { AnyRegion, Block } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nconst SVChordsReactComponent = observer(function SVChordsReactComponent({\n  features,\n  config,\n  blockDefinitions,\n  radius,\n  bezierRadius,\n  displayModel,\n  onChordClick,\n}: {\n  features: Map<string, Feature>\n  radius: number\n  config: AnyConfigurationModel\n  displayModel?: {\n    id: string\n    selectedFeatureId: string\n  }\n  blockDefinitions: Block[]\n  bezierRadius: number\n  onChordClick: (\n    feature: Feature,\n    reg: AnyRegion,\n    endBlock: AnyRegion,\n    evt: unknown,\n  ) => void\n}) {\n  const { selectedFeatureId } = displayModel || {}\n  const blocksForRefsMemo = useMemo(() => {\n    const blocksForRefs = {} as Record<string, Block>\n    for (const block of blockDefinitions) {\n      const regions = block.region.elided\n        ? block.region.regions\n        : [block.region]\n      for (const region of regions) {\n        blocksForRefs[region.refName] = block\n      }\n    }\n    return blocksForRefs\n  }, [blockDefinitions])\n\n  return (\n    <g data-testid=\"structuralVariantChordRenderer\">\n      {[...features.values()].map(feature => {\n        const id = feature.id()\n        const selected = selectedFeatureId === id\n        return (\n          <Chord\n            key={id}\n            feature={feature}\n            config={config}\n            radius={radius}\n            bezierRadius={bezierRadius}\n            blocksForRefs={blocksForRefsMemo}\n            selected={selected}\n            onClick={onChordClick}\n          />\n        )\n      })}\n    </g>\n  )\n})\n\nexport default SVChordsReactComponent\n"],"names":["bpToRadians","block","pos","blockStart","region","elided","start","blockEnd","end","flipped","bpPerRadian","startRadians","observer","feature","blocksForRefs","radius","config","bezierRadius","selected","onClick","hovered","setHovered","useState","startBlock","get","startPos","endBlock","endPosition","alt","bnd","parseBreakend","mate","chr","MatePosition","split","chr2","CHR2","END","Number","parseInt","refName","getEndpoint","endRadians","x1","y1","polarToCartesian","x2","y2","cx","cy","stroke","readConfObject","_jsx","id","cursor","fill","d","getStrokeProps","strokeWidth","evt","onMouseOver","onMouseOut","features","blockDefinitions","displayModel","onChordClick","selectedFeatureId","blocksForRefsMemo","useMemo","regions","children","values","map","Chord"],"ignoreList":[],"sourceRoot":""}