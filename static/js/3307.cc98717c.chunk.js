"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3307],{3560(e,t,s){s.d(t,{N:()=>r,u:()=>o});var n=s(10533);function o(){return n.types.model({dockviewLayout:n.types.maybe(n.types.frozen()),panelViewAssignments:n.types.optional(n.types.map(n.types.array(n.types.string)),{}),init:n.types.frozen(),activePanelId:n.types.maybe(n.types.string)}).views(e=>({getViewIdsForPanel:t=>e.panelViewAssignments.get(t)??[]})).actions(e=>({setDockviewLayout(t){e.dockviewLayout=t},setActivePanelId(t){e.activePanelId=t},setInit(t){e.init=t},assignViewToPanel(t,s){const n=e.panelViewAssignments.get(t);n?n.includes(s)||n.push(s):e.panelViewAssignments.set(t,[s])},removeViewFromPanel(t){for(const[s,n]of e.panelViewAssignments.entries()){const o=n.indexOf(t);if(-1!==o){n.splice(o,1),0===n.length&&e.panelViewAssignments.delete(s);break}}},removePanel(t){e.panelViewAssignments.delete(t)},moveViewUpInPanel(t){for(const s of e.panelViewAssignments.values()){const e=s.indexOf(t);if(e>0){const t=s[e-1];s[e-1]=s[e],s[e]=t;break}}},moveViewDownInPanel(t){for(const s of e.panelViewAssignments.values()){const e=s.indexOf(t);if(-1!==e&&e<s.length-1){const t=s[e+1];s[e+1]=s[e],s[e]=t;break}}},moveViewToTopInPanel(t){for(const s of e.panelViewAssignments.values()){const e=s.indexOf(t);if(e>0){s.splice(e,1),s.unshift(t);break}}},moveViewToBottomInPanel(t){for(const s of e.panelViewAssignments.values()){const e=s.indexOf(t);if(-1!==e&&e<s.length-1){s.splice(e,1),s.push(t);break}}}})).postProcessSnapshot(e=>{if(!e)return e;const{dockviewLayout:t,panelViewAssignments:s,init:n,activePanelId:o,...r}=e;return{...r,...void 0!==t?{dockviewLayout:t}:{},...s&&Object.keys(s).length?{panelViewAssignments:s}:{},...void 0!==o?{activePanelId:o}:{}}})}function r(e){return"dockviewLayout"in e&&"setDockviewLayout"in e}},22601(e,t,s){s.d(t,{Ay:()=>f,Cx:()=>a,Hm:()=>d,Nz:()=>c,lc:()=>l,rE:()=>i});var n=s(36082),o=s(22669),r=s(23886);function i(e){return(void 0!==e.umdUrl||void 0!==e.url||void 0!==e.umdLoc)&&void 0!==e.name}function a(e){return void 0!==e.esmUrl||void 0!==e.esmLoc}function c(e){return void 0!==e.cjsUrl}function l(e){return i(e)?`UMD plugin ${e.name}`:a(e)?`ESM plugin ${e.esmUrl||e.esmLoc.uri}`:c(e)?`CJS plugin ${e.cjsUrl}`:"unknown plugin"}function d(e){return i(e)?e.url??e.umdLoc?.uri??e.umdUrl:a(e)?e.esmUrl??e.esmUri??e.esmLoc?.uri:c(e)?e.cjsUrl||e.cjsLoc.uri:"unknown url"}function u(e){if(!globalThis.__jbrowseCacheBuster)return e;const t=new URL(e);return t.searchParams.set("_cb",Date.now().toString()),t.href}class f{definitions=[];constructor(e=[],t){this.fetchESM=t?.fetchESM,this.fetchCJS=t?.fetchCJS,this.definitions=JSON.parse(JSON.stringify(e))}async loadCJSPlugin(e,t){const s=new URL(e.cjsUrl,t);if("http:"!==s.protocol&&"https:"!==s.protocol)throw new Error(`Cannot load plugins using protocol "${s.protocol}"`);if(!this.fetchCJS)throw new Error("No fetchCJS callback provided");return this.fetchCJS(s.href)}async loadESMPlugin(e,t){const s="esmUrl"in e?new URL(e.esmUrl,t):new URL(e.esmLoc.uri,e.esmLoc.baseUri);if("http:"!==s.protocol&&"https:"!==s.protocol)throw new Error(`cannot load plugins using protocol "${s.protocol}"`);if(!this.fetchESM)throw new Error("No ESM fetcher installed");const n=await this.fetchESM(u(s.href));if(!n)throw new Error(`Could not load ESM plugin: ${s}`);return n}async loadUMDPlugin(e,t){const s="url"in e?new URL(e.url,t):"umdUrl"in e?new URL(e.umdUrl,t):new URL(e.umdLoc.uri,e.umdLoc.baseUri);if("http:"!==s.protocol&&"https:"!==s.protocol)throw new Error(`cannot load plugins using protocol "${s.protocol}"`);const o=e.name,r=`JBrowsePlugin${o}`;"undefined"==typeof jest?await async function(e){if(!("WorkerGlobalScope"in globalThis))return t=e,new Promise((e,s)=>{const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=()=>{e(n.src)},n.onerror=()=>{s(new Error(`Failed to load script: ${t}`))},document.head.append(n)});var t;if(!globalThis.importScripts)throw new Error("cannot figure out how to load external JS scripts in this environment");await globalThis.importScripts(e)}(u(s.href)):globalThis[r]={default:n.A};const i=globalThis[r];if(!i)throw new Error(`Failed to load UMD bundle for ${o}, ${r} is undefined`);return i}async loadPlugin(e,t){let s;if(r.isElectron&&c(e))s=await this.loadCJSPlugin(e,t);else if(a(e))s=await this.loadESMPlugin(e,t);else{if(!i(e))throw!r.isElectron&&c(e)?new Error(`CommonJS plugin found, but not in a NodeJS environment: ${JSON.stringify(e)}`):new Error(`Could not determine plugin type: ${JSON.stringify(e)}`);s=await this.loadUMDPlugin(e,t)}if(!s.default)throw new Error(`${l(e)} does not have a default export, cannot load`);return s.default}installGlobalReExports(e){return e.JBrowseExports=Object.fromEntries(Object.entries(o.A).map(([e,t])=>[e,t])),this}async load(e){return Promise.all(this.definitions.map(async t=>({plugin:await this.loadPlugin(t,e),definition:t})))}}},72242(e,t,s){s.d(t,{A8:()=>l,jT:()=>i,uB:()=>c,xU:()=>a});var n=s(55614),o=s(7929),r=s(44460);function i(e){const t=(0,n.c)(3);let s,i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,r.jsx)("path",{d:"M19.31 18.9L22.39 22L21 23.39L17.88 20.32C17.19 20.75 16.37 21 15.5 21C13 21 11 19 11 16.5C11 14 13 12 15.5 12C18 12 20 14 20 16.5C20 17.38 19.75 18.21 19.31 18.9M15.5 19C16.88 19 18 17.88 18 16.5C18 15.12 16.88 14 15.5 14C14.12 14 13 15.12 13 16.5C13 17.88 14.12 19 15.5 19M21 4V6H3V4H21M3 16V14H9V16H3M3 11V9H21V11H18.97C17.96 10.37 16.77 10 15.5 10C14.23 10 13.04 10.37 12.03 11H3Z"}),t[0]=s):s=t[0],t[1]!==e?(i=(0,r.jsx)(o.A,{...e,children:s}),t[1]=e,t[2]=i):i=t[2],i}function a(e){const t=(0,n.c)(3);let s,i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,r.jsx)("path",{d:"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"}),t[0]=s):s=t[0],t[1]!==e?(i=(0,r.jsx)(o.A,{...e,children:s}),t[1]=e,t[2]=i):i=t[2],i}function c(e){const t=(0,n.c)(3);let s,i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,r.jsx)("path",{fill:"currentColor",d:"M4,2H6V4C6,5.44 6.68,6.61 7.88,7.78C8.74,8.61 9.89,9.41 11.09,10.2L9.26,11.39C8.27,10.72 7.31,10 6.5,9.21C5.07,7.82 4,6.1 4,4V2M18,2H20V4C20,6.1 18.93,7.82 17.5,9.21C16.09,10.59 14.29,11.73 12.54,12.84C10.79,13.96 9.09,15.05 7.88,16.22C6.68,17.39 6,18.56 6,20V22H4V20C4,17.9 5.07,16.18 6.5,14.79C7.91,13.41 9.71,12.27 11.46,11.16C13.21,10.04 14.91,8.95 16.12,7.78C17.32,6.61 18,5.44 18,4V2M14.74,12.61C15.73,13.28 16.69,14 17.5,14.79C18.93,16.18 20,17.9 20,20V22H18V20C18,18.56 17.32,17.39 16.12,16.22C15.26,15.39 14.11,14.59 12.91,13.8L14.74,12.61M7,3H17V4L16.94,4.5H7.06L7,4V3M7.68,6H16.32C16.08,6.34 15.8,6.69 15.42,7.06L14.91,7.5H9.07L8.58,7.06C8.2,6.69 7.92,6.34 7.68,6M9.09,16.5H14.93L15.42,16.94C15.8,17.31 16.08,17.66 16.32,18H7.68C7.92,17.66 8.2,17.31 8.58,16.94L9.09,16.5M7.06,19.5H16.94L17,20V21H7V20L7.06,19.5Z"}),t[0]=s):s=t[0],t[1]!==e?(i=(0,r.jsx)(o.A,{...e,children:s}),t[1]=e,t[2]=i):i=t[2],i}function l(e){const t=(0,n.c)(3);let s,i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,r.jsx)("path",{d:"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z"}),t[0]=s):s=t[0],t[1]!==e?(i=(0,r.jsx)(o.A,{...e,children:s}),t[1]=e,t[2]=i):i=t[2],i}},23886(e,t,s){s.r(t),s.d(t,{AuthNeededError:()=>m._u,IntervalTree:()=>P.M,ReactRendering:()=>b.aE,RetryError:()=>m.J_,SimpleFeature:()=>k.A,TextSearchManager:()=>m.rz,UNKNOWN:()=>M.UNKNOWN,UNSUPPORTED:()=>M.UNSUPPORTED,abortBreakPoint:()=>T.Yo,aesDecrypt:()=>v.F6,aesEncrypt:()=>v.ff,assembleLocString:()=>O,assembleLocStringFast:()=>G,avg:()=>Qe,blobToDataURL:()=>C.y,bpSpanPx:()=>se,bpToPx:()=>K,bytesForRegions:()=>xe,calculateLayoutBounds:()=>ne,cartesianToPolar:()=>ee,checkAbortSignal:()=>T.pB,checkStopToken:()=>p.SW,checkStopToken2:()=>p.As,clamp:()=>J,cleanupStaleHandles:()=>N.N7,clearFileFromCache:()=>M.clearFileFromCache,clearPendingFileHandleIds:()=>M.clearPendingFileHandleIds,coarseStripHTML:()=>d.Z,collectTransferables:()=>w.XY,compareLocStrings:()=>q,compareLocs:()=>z,complement:()=>ye,complementTable:()=>me,createCanvas:()=>w.Nw,createImageBitmap:()=>w.T9,createStopToken:()=>p.y5,createStopTokenChecker:()=>p.jL,dedupe:()=>y.Q,defaultCodonTable:()=>Ae,defaultStarts:()=>ke,defaultStops:()=>Ce,degToRad:()=>X,doesIntersect2:()=>h.R6,drawImageOntoCanvasContext:()=>w.pv,ensureFileHandleReady:()=>M.ensureFileHandleReady,featureSpanPx:()=>te,fetchAndMaybeUnzip:()=>it,fetchAndMaybeUnzipText:()=>at,findFileHandleIds:()=>M.findFileHandleIds,findLast:()=>ie,findLastIndex:()=>re,findParentThat:()=>L,findParentThatIs:()=>$,forEachWithStopTokenCheck:()=>p.ib,gatherOverlaps:()=>et,generateCodonTable:()=>Te,generateUnknownTrackConf:()=>M.generateUnknownTrackConf,generateUnsupportedTrackConf:()=>M.generateUnsupportedTrackConf,getBlob:()=>M.getBlob,getBlobMap:()=>M.getBlobMap,getBpDisplayStr:()=>Re,getConfAssemblyNames:()=>M.getConfAssemblyNames,getContainingDisplay:()=>B,getContainingTrack:()=>H,getContainingView:()=>V,getEnv:()=>Ge,getFileFromCache:()=>M.getFileFromCache,getFileHandle:()=>N.D0,getFileHandleCache:()=>M.getFileHandleCache,getFileName:()=>M.getFileName,getFillProps:()=>nt,getFrame:()=>ve,getLayoutId:()=>Ue,getParentRenderProps:()=>M.getParentRenderProps,getPendingFileHandleIds:()=>M.getPendingFileHandleIds,getProgressDisplayStr:()=>De,getRpcSessionId:()=>M.getRpcSessionId,getSerializedSvg:()=>b.Jy,getSession:()=>F,getStatsId:()=>$e,getStr:()=>He,getStrokeProps:()=>st,getTickDisplayStr:()=>Le,getTrackAssemblyNames:()=>M.getTrackAssemblyNames,getTrackName:()=>M.getTrackName,getUriLink:()=>Ve,groupBy:()=>Ze,guessAdapter:()=>M.guessAdapter,guessTrackType:()=>M.guessTrackType,hashCode:()=>Pe,hideTrackGeneric:()=>M.hideTrackGeneric,intersection2:()=>h.ky,isAbortException:()=>T.Kp,isAbstractMenuManager:()=>m.Nh,isAppRootModel:()=>m.bV,isAuthNeededException:()=>m.ZL,isBlobLocation:()=>m.rF,isContainedWithin:()=>h.Xx,isDetachedBuffer:()=>w.pc,isDisplayModel:()=>m.Uy,isElectron:()=>pe,isFeature:()=>k.l,isFileHandleLocation:()=>m.Qm,isFileSystemAccessSupported:()=>N.mV,isGzip:()=>rt,isImageBitmap:()=>w.Fw,isLocalPathLocation:()=>m.EV,isObject:()=>ct,isRetryException:()=>m.yH,isRootModelWithInternetAccounts:()=>m.lL,isRpcResult:()=>S.N,isSelectionContainer:()=>m.mY,isSessionModel:()=>m.Y$,isSessionModelWithConfigEditing:()=>m.u3,isSessionModelWithConnectionEditing:()=>m.gx,isSessionModelWithConnections:()=>m.BY,isSessionModelWithWidgets:()=>m.lO,isSessionWithAddTracks:()=>m.QW,isSessionWithSessionPlugins:()=>m.zA,isSessionWithShareURL:()=>m.xv,isSupportedIndexingAdapter:()=>Ee,isTrackModel:()=>m.xU,isTrackViewModel:()=>m.EO,isUriLocation:()=>m.C1,isViewContainer:()=>m.DW,isViewModel:()=>m.Tl,iterMap:()=>oe,linkify:()=>Be,localStorageGetBoolean:()=>dt,localStorageGetItem:()=>ze,localStorageGetNumber:()=>lt,localStorageSetBoolean:()=>ut,localStorageSetItem:()=>qe,makeAbortError:()=>T.zm,makeAbortableReaction:()=>A.I,makeIndex:()=>M.makeIndex,makeIndexType:()=>M.makeIndexType,max:()=>Je,measureGridWidth:()=>Oe,measureText:()=>Se,mergeIntervals:()=>Ye,min:()=>Ke,minmax:()=>le,notEmpty:()=>Xe,objectHash:()=>Ie,observeAbortSignal:()=>T.R1,parseLocString:()=>f.f,parseLocStringOneBased:()=>f.m,polarToCartesian:()=>Y,rIC:()=>we,radToDeg:()=>Z,reducePrecision:()=>je,removeFileHandle:()=>N.pu,renameRegionIfNeeded:()=>ae,renameRegionsIfNeeded:()=>ce,renderToAbstractCanvas:()=>b.u1,renderToStaticMarkup:()=>ot,renderingToSvg:()=>b.MD,restoreFileHandles:()=>M.restoreFileHandles,restoreFileHandlesFromSnapshot:()=>M.restoreFileHandlesFromSnapshot,restorePendingFileHandles:()=>M.restorePendingFileHandles,revcom:()=>ge,reverse:()=>he,setBlobMap:()=>M.setBlobMap,setFileHandleCache:()=>M.setFileHandleCache,setFileInCache:()=>M.setFileInCache,setPendingFileHandleIds:()=>M.setPendingFileHandleIds,sha256:()=>v.sc,sha256Base64:()=>v.TZ,sha256Base64Url:()=>v.gg,shorten:()=>de,shorten2:()=>ue,showTrackGeneric:()=>M.showTrackGeneric,springAnimate:()=>U,stopStopToken:()=>p.CF,storeBlobLocation:()=>M.storeBlobLocation,storeFileHandle:()=>N.gw,storeFileHandleLocation:()=>M.storeFileHandleLocation,stringify:()=>fe,stripAlpha:()=>tt,sum:()=>_e,testAdapter:()=>ft,toBase64:()=>v.nk,toBase64Url:()=>v._e,toLocale:()=>We,toggleTrackGeneric:()=>M.toggleTrackGeneric,updateStatus:()=>Me,updateStatus2:()=>Ne,useDebounce:()=>j,useDebouncedCallback:()=>W,useLocalStorage:()=>Fe,useWidthSetter:()=>D,verifyPermission:()=>N.pZ,when:()=>g.z});var n=s(55614),o=s(30128),r=s(91219),i=s(87529),a=s(10533),c=s(23772),l=s(67845),d=s(89570),u=s(53121),f=s(93949),p=s(29458),m=s(16640),g=s(19236),h=s(49303),y=s(1259),w=s(39926),b=s(27518),S=s(7353),v=s(15773),k=s(43102),C=s(78357),A=s(67665),T=s(15146),M=s(19608),N=s(3787),P=s(27725);const I=new WeakMap,x=new WeakMap,E=new WeakMap,R=new WeakMap;function j(e,t){const s=(0,n.c)(4),[r,i]=(0,o.useState)(e);let a,c;return s[0]!==t||s[1]!==e?(a=()=>{const s=setTimeout(()=>{i(e)},t);return()=>{clearTimeout(s)}},c=[e,t],s[0]=t,s[1]=e,s[2]=a,s[3]=c):(a=s[2],c=s[3]),(0,o.useEffect)(a,c),r}function D(e,t){const s=(0,n.c)(7),[r,c]=(0,i.A)(),{width:l}=c;let d,u;return s[0]!==e||s[1]!==l?(d=()=>{let t;return l&&(0,a.isAlive)(e)&&(t=requestAnimationFrame(()=>{e.setWidth(l)})),()=>{t&&cancelAnimationFrame(t)}},s[0]=e,s[1]=l,s[2]=d):d=s[2],s[3]!==t||s[4]!==e||s[5]!==l?(u=[t,e,l],s[3]=t,s[4]=e,s[5]=l,s[6]=u):u=s[6],(0,o.useEffect)(d,u),r}function W(e,t){const s=(0,n.c)(5),r=void 0===t?400:t,i=(0,o.useRef)(null),a=(0,o.useRef)(null);let c,l,d;return s[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{a.current&&clearTimeout(a.current)},l=[],s[0]=c,s[1]=l):(c=s[0],l=s[1]),(0,o.useEffect)(c,l),s[2]!==e||s[3]!==r?(d=function(...t){const s=t;i.current=s,a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{i.current&&e(...i.current)},r)},s[2]=e,s[3]=r,s[4]=d):d=s[4],d}function L(e,t){if(!(0,a.hasParent)(e))throw new Error("node does not have parent");let s=(0,a.getParent)(e);for(;s&&(0,a.isAlive)(s);){if(t(s))return s;if(!(0,a.hasParent)(s))break;s=(0,a.getParent)(s)}throw new Error("no matching node found")}function U(e,t,s,n=()=>{},o=0,r=400,i=20,a=!0){let c;function l(d){const u=performance.now();let f=d.lastPosition,p=d.lastTime||u,m=d.lastVelocity||0;u>p+64&&(p=u);const g=Math.floor(u-p);for(let e=0;e<g;++e)m+=(-r*(f-t)+-i*m)/1*1/1e3,f+=1*m/1e3;const h=Math.abs(m)<=o,y=0===r||Math.abs(t-f)<=o;a&&0!==r&&(e<t?f>t:f<t)||h&&y?(s(t),n()):(s(f),c=requestAnimationFrame(()=>{l({lastPosition:f,lastTime:u,lastVelocity:m})}))}return o||(o=Math.abs(t-e)/1e3),[()=>{l({lastPosition:e})},()=>{cancelAnimationFrame(c)}]}function $(e,t){return L(e,t)}function F(e){const t=R.get(e);if(t&&(0,a.isAlive)(t))return t;try{const t=$(e,m.Y$);return R.set(e,t),t}catch(e){throw new Error("no session model found!")}}function V(e){const t=E.get(e);if(t&&(0,a.isAlive)(t))return t;try{const t=$(e,m.Tl);return E.set(e,t),t}catch(e){throw new Error("no containing view found")}}function H(e){const t=x.get(e);if(t&&(0,a.isAlive)(t))return t;try{const t=$(e,m.xU);return x.set(e,t),t}catch(e){throw new Error("no containing track found")}}function B(e){const t=I.get(e);if(t&&(0,a.isAlive)(t))return t;try{const t=$(e,m.Uy);return I.set(e,t),t}catch(e){throw new Error("no containing display found")}}function O(e){return G(e,We)}function G(e,t=e=>e){const{assemblyName:s,refName:n,start:o,end:r,reversed:i}=e,a=s?`{${s}}`:"";let c,l;c=void 0!==o?`:${t(o+1)}`:void 0!==r?":1":"",l=void 0!==r?void 0!==o&&o+1===r?"":`..${t(r)}`:void 0!==o?"..":"";let d="";return i&&(d="[rev]"),`${a}${n}${c}${l}${d}`}function z(e,t){const s=e.assemblyName||t.assemblyName?(e.assemblyName||"").localeCompare(t.assemblyName||""):0;if(s)return s;const n=e.refName||t.refName?(e.refName||"").localeCompare(t.refName||""):0;if(n)return n;if(void 0!==e.start&&void 0!==t.start){const s=e.start-t.start;if(s)return s}if(void 0!==e.end&&void 0!==t.end){const s=e.end-t.end;if(s)return s}return 0}function q(e,t,s){return z((0,f.f)(e,s),(0,f.f)(t,s))}function J(e,t,s){return e<t?t:e>s?s:e}function K(e,{reversed:t,end:s=0,start:n=0},o){return r=(t?s-e:e-n)/o,Math.round(10*r)/10;var r}const _=180/Math.PI,Q=Math.PI/180;function Z(e){return e*_%360}function X(e){return e*Q%(2*Math.PI)}function Y(e,t){return[e*Math.cos(t),e*Math.sin(t)]}function ee(e,t){return[Math.sqrt(e*e+t*t),Math.atan(t/e)]}function te(e,t,s){return se(e.get("start"),e.get("end"),t,s)}function se(e,t,s,n){const o=K(e,s,n),r=K(t,s,n);return s.reversed?[r,o]:[o,r]}function ne(e,t,s,n){const o=t-e,r=Math.max(0,s-o);return n?[e-r,t]:[e,e+s]}function oe(e,t,s){const n=Array.from({length:s||0});let o=0;for(const s of e)n[o]=t(s),o+=1;return n}function re(e,t){let s=e.length;for(;s--;)if(t(e[s],s,e))return s;return-1}function ie(e,t){let s=e.length;for(;s--;)if(t(e[s],s,e))return e[s]}function ae(e,t){if((0,a.isStateTreeNode)(t)&&!(0,a.isAlive)(t))return t;if(e?.[t.refName]){const s=e[(t=(0,a.isStateTreeNode)(t)?{...(0,a.getSnapshot)(t)}:{...t}).refName];if(s)return{...t,refName:s,originalRefName:t.refName}}return t}async function ce(e,t){const{regions:s=[],adapterConfig:n}=t;if(!t.sessionId)throw new Error("sessionId is required");const o=s.map(e=>e.assemblyName),r=Object.fromEntries(await Promise.all([...new Set(o)].map(async s=>[s,await e.getRefNameMapForAdapter(n,s,t)])));return{...t,regions:s.map((e,t)=>ae(r[o[t]],e))}}function le(e,t){return[Math.min(e,t),Math.max(e,t)]}function de(e,t=70,s=30){return e.length>t?`${e.slice(0,s)}...${e.slice(-s)}`:e}function ue(e,t=70){return e.length>t?`${e.slice(0,t)}...`:e}function fe({refName:e,coord:t,assemblyName:s,oob:n},o){return[s&&o?`{${s}}`:"",e?`${de(e)}:${We(t)}${n?" (out of bounds)":""}`:""].join("")}const pe=/electron/i.test("undefined"!=typeof navigator?navigator.userAgent:""),me={S:"S",w:"w",T:"A",r:"y",a:"t",N:"N",K:"M",x:"x",d:"h",Y:"R",V:"B",y:"r",M:"K",h:"d",k:"m",C:"G",g:"c",t:"a",A:"T",n:"n",W:"W",X:"X",m:"k",v:"b",B:"V",s:"s",H:"D",c:"g",D:"H",b:"v",R:"Y",G:"C"};function ge(e){const t=[];for(let s=e.length-1;s>=0;s--)t.push(me[e[s]]??e[s]);return t.join("")}function he(e){const t=[];for(let s=e.length-1;s>=0;s--)t.push(e[s]);return t.join("")}function ye(e){const t=[];for(let s=0,n=e.length;s<n;s++)t.push(me[e[s]]??e[s]);return t.join("")}const we="undefined"==typeof jest?"undefined"!=typeof window&&window.requestIdleCallback?window.requestIdleCallback:e=>setTimeout(()=>{e()},1):e=>{e()},be=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625];function Se(e,t=10){const s=String(e);let n=0;for(let e=0,t=s.length;e<t;e++)n+=be[s.charCodeAt(e)]??.5279276315789471;return n*t}function ve(e,t,s,n){return 1===s?(e+n)%3+1:(t-n)%3*-1-1}const ke=["ATG"],Ce=["TAA","TAG","TGA"],Ae={TCA:"S",TCC:"S",TCG:"S",TCT:"S",TTC:"F",TTT:"F",TTA:"L",TTG:"L",TAC:"Y",TAT:"Y",TAA:"*",TAG:"*",TGC:"C",TGT:"C",TGA:"*",TGG:"W",CTA:"L",CTC:"L",CTG:"L",CTT:"L",CCA:"P",CCC:"P",CCG:"P",CCT:"P",CAC:"H",CAT:"H",CAA:"Q",CAG:"Q",CGA:"R",CGC:"R",CGG:"R",CGT:"R",ATA:"I",ATC:"I",ATT:"I",ATG:"M",ACA:"T",ACC:"T",ACG:"T",ACT:"T",AAC:"N",AAT:"N",AAA:"K",AAG:"K",AGC:"S",AGT:"S",AGA:"R",AGG:"R",GTA:"V",GTC:"V",GTG:"V",GTT:"V",GCA:"A",GCC:"A",GCG:"A",GCT:"A",GAC:"D",GAT:"D",GAA:"E",GAG:"E",GGA:"G",GGC:"G",GGG:"G",GGT:"G"};function Te(e){const t={};for(const s of Object.keys(e)){const n=e[s],o=[];for(let e=0;e<3;e++){const t=s.charAt(e);o[e]=[],o[e][0]=t.toUpperCase(),o[e][1]=t.toLowerCase()}for(let e=0;e<2;e++){const s=o[0][e];for(let e=0;e<2;e++){const r=o[1][e];for(let e=0;e<2;e++)t[s+r+o[2][e]]=n}}}return t}async function Me(e,t,s){t?.(e);const n=await s();return t?.(""),n}async function Ne(e,t,s,n){t(e);const o=await n();return(0,p.SW)(s),t(""),o}function Pe(e){let t=0;if(0===e.length)return t;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return t}function Ie(e){return`${Pe(JSON.stringify(e))}`}async function xe(e,t){return _e((await Promise.all(e.map(e=>t.blocksForRange(e.refName,e.start,e.end)))).flat().map(e=>e.maxv.blockPosition+65535-e.minv.blockPosition))}function Ee(e=""){return["Gff3TabixAdapter","VcfTabixAdapter","Gff3Adapter","VcfAdapter"].includes(e)}function Re(e){return Math.floor(e/1e6)>0?`${je(e/1e6)}Mbp`:Math.floor(e/1e3)>0?`${je(e/1e3)}Kbp`:`${Math.floor(e)}bp`}function je(e,t=3){return We(Number.parseFloat(e.toPrecision(t)))}function De(e,t){return Math.floor(t/1e6)>0?`${je(e/1e6)}/${je(t/1e6)}Mb`:Math.floor(t/1e3)>0?`${je(e/1e3)}/${je(t/1e3)}Kb`:`${je(e)}/${je(t)} bytes`}function We(e){if(e<1e3)return String(e);const t=String(e),s=t.length;let n="";for(let e=0;e<s;e++)e>0&&(s-e)%3==0&&(n+=","),n+=t[e];return n}function Le(e,t){return Math.floor(t/1e3)>0?`${We(Number.parseFloat((e/1e6).toFixed(2)))}M`:We(Math.floor(e))}function Ue({sessionId:e,trackInstanceId:t}){return`${e}-${t}`}function $e({sessionId:e,trackInstanceId:t}){return`${e}-${t}`}function Fe(e,t,s=!0){const[n,r]=(0,o.useState)(()=>{if("undefined"==typeof window||!s)return t;try{const s=window.localStorage.getItem(e);return s?JSON.parse(s):t}catch(e){return console.error(e),t}});return[n,t=>{try{const o=t instanceof Function?t(n):t;r(o),"undefined"!=typeof window&&s&&window.localStorage.setItem(e,JSON.stringify(o))}catch(e){console.error(e)}}]}function Ve(e){const{uri:t,baseUri:s=""}=e;let n;try{n=new URL(t,s).href}catch(e){n=t}return n}function He(e){return ct(e)?(0,m.C1)(e)?Ve(e):JSON.stringify(e):String(e)}function Be(e){return e.replaceAll(/(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[-A-Z0-9+\u0026\u2019@#/%?=()~_|!:,.;]*[-A-Z0-9+\u0026@#/%=~()_|])/gi,"$1<a href='$2' target=\"_blank\">$2</a>")}function Oe(e,t){const{padding:s=30,minWidth:n=80,fontSize:o=12,maxWidth:r=1e3,stripHTML:i=!1}=t||{};return Je(e.map(e=>He(e)).map(e=>i?(0,d.Z)(e):e).map(e=>Se(e,o)).map(e=>Math.min(Math.max(e+s,n),r)))}function Ge(e){return(0,a.getEnv)(e)}function ze(e){return"undefined"!=typeof localStorage?localStorage.getItem(e):void 0}function qe(e,t){"undefined"!=typeof localStorage&&localStorage.setItem(e,t)}function Je(e,t=Number.NEGATIVE_INFINITY){let s=t;for(const t of e)s=Math.max(t,s);return s}function Ke(e,t=Number.POSITIVE_INFINITY){let s=t;for(const t of e)s=Math.min(t,s);return s}function _e(e){let t=0;for(const s of e)t+=s;return t}function Qe(e){return _e(e)/e.length}function Ze(e,t){const s={};for(const n of e){const e=t(n);s[e]||(s[e]=[]),s[e].push(n)}return s}function Xe(e){return null!=e}function Ye(e,t=5e3){if(e.length<=1)return e;const s=[];let n=null;e=e.sort((e,t)=>e.start-t.start),s.push(e[0]);for(let o=1;o<e.length;o++)n=s.at(-1),n.end+t<e[o].start-t?s.push(e[o]):n.end<e[o].end&&(n.end=Math.max(n.end,e[o].end),s.pop(),s.push(n));return s}function et(e,t=5e3){const s={};for(const t of e)s[t.refName]||(s[t.refName]=[]),s[t.refName].push(t);return Object.values(s).flatMap(e=>Ye(e.sort((e,t)=>e.start-t.start),t))}function tt(e){return(0,u.M)(e).alpha(1).toHex()}function st(e){if(e){const t=(0,u.M)(e);return{strokeOpacity:t.alpha(),stroke:t.alpha(1).toHex()}}return{}}function nt(e){if(e){const t=(0,u.M)(e);return{fillOpacity:t.alpha(),fill:t.alpha(1).toHex()}}return{}}function ot(e){const t=document.createElement("div");return(0,c.flushSync)(()=>{(0,l.createRoot)(t).render(e)}),t.innerHTML.replaceAll(/\brgba\((.+?),[^,]+?\)/g,"rgb($1)")}function rt(e){return 31===e[0]&&139===e[1]&&8===e[2]}async function it(e,t={}){const{statusCallback:s=()=>{}}=t,n=await Me("Downloading file",s,()=>e.readFile(t));return rt(n)?await Me("Unzipping",s,()=>(0,r.$1)(n)):n}async function at(e,t){const s=await it(e,t);if(s.length>536870888)throw new Error("Data exceeds maximum string length (512MB)");return new TextDecoder("utf8",{fatal:!0}).decode(s)}function ct(e){return"object"==typeof e&&null!==e}function lt(e,t){return+(ze(e)??t)}function dt(e,t){return Boolean(JSON.parse(ze(e)||JSON.stringify(t)))}function ut(e,t){qe(e,JSON.stringify(t))}function ft(e,t,s,n){return t.test(e)&&!s||s===n}},38811(e,t,s){s.d(t,{DH:()=>r,qk:()=>i});var n=s(38817),o=s(10533);function r(e){return o.types.model({id:n.K,name:o.types.string,margin:0}).volatile(()=>({selection:void 0,hovered:void 0})).views(e=>({get root(){return(0,o.getParent)(e)}})).views(e=>({get jbrowse(){return e.root.jbrowse},get rpcManager(){return e.root.rpcManager},get configuration(){return this.jbrowse.configuration},get adminMode(){return e.root.adminMode},get textSearchManager(){return e.root.textSearchManager}})).views(e=>({get assemblies(){return e.jbrowse.assemblies}})).actions(e=>({setSelection(t){e.selection=t},clearSelection(){e.selection=void 0},setHovered(t){e.hovered=t}})).postProcessSnapshot(e=>{if(!e)return e;const{margin:t,...s}=e;return{...s,...t?{margin:t}:{}}})}function i(e){return"id"in e&&"name"in e&&"root"in e}},56593(e,t,s){s.d(t,{F:()=>i,M:()=>a});var n=s(17378),o=s(10533),r=s(38811);function i(e){return o.types.model({connectionInstances:o.types.array(e.pluggableMstType("connection","stateModel"))}).views(e=>({get connections(){const{jbrowse:t}=e;return t.connections}})).actions(t=>({makeConnection(s,o={}){const r=s.type;if(!r)throw new Error("track configuration has no `type` listed");const i=(0,n.QZ)(s,"name");if(!e.getConnectionType(r))throw new Error(`unknown connection type ${r}`);const a=t.connectionInstances.push({...o,name:i,type:r,configuration:s});return t.connectionInstances[a-1]},prepareToBreakConnection(e){const s=t,o=[],r={},i=(0,n.QZ)(e,"name"),a=t.connectionInstances.find(e=>e.name===i);if(a){for(const e of a.tracks){const t=s.getReferring(e);s.removeReferring(t,e,o,r)}return[()=>{for(const e of o)e();this.breakConnection(e)},r]}},breakConnection(e){const s=(0,n.QZ)(e,"name"),o=t.connectionInstances.find(e=>e.name===s);if(!o)throw new Error(`no connection found with name ${s}`);t.connectionInstances.remove(o)},deleteConnection(e){const{jbrowse:s}=t;return s.deleteConnectionConf(e)},addConnectionConf(e){const{jbrowse:s}=t;return s.addConnectionConf(e)},clearConnections(){t.connectionInstances.clear()}})).postProcessSnapshot(e=>{if(!e)return e;const{connectionInstances:t,...s}=e;return{...s,...t?.length?{connectionInstances:t}:{}}})}function a(e){return(0,r.qk)(e)&&"connectionInstances"in e}},27878(e,t,s){s.d(t,{X:()=>a});var n=s(17378),o=s(23886),r=s(10533),i=s(44934);function a(e){const t=e.pluggableMstType("widget","stateModel");return r.types.model({drawerPosition:r.types.optional(r.types.string,()=>(0,o.localStorageGetItem)("drawerPosition")||"right"),drawerWidth:r.types.optional(r.types.refinement(r.types.integer,e=>e>=128),384),widgets:r.types.map(t),activeWidgets:r.types.map(r.types.safeReference(t)),minimized:r.types.optional(r.types.boolean,!1)}).views(e=>({get visibleWidget(){if((0,r.isAlive)(e))return[...e.activeWidgets.values()][e.activeWidgets.size-1]}})).actions(t=>({setDrawerPosition(e){t.drawerPosition=e,localStorage.setItem("drawerPosition",e)},updateDrawerWidth(e){if(e===t.drawerWidth)return t.drawerWidth;let s=e;return s<128&&(s=128),t.drawerWidth=s,s},resizeDrawer(e){"left"===t.drawerPosition&&(e*=-1);const s=t.drawerWidth;return s-this.updateDrawerWidth(s-e)},addWidget(s,n,o={},r){if(!e.getElementType("widget",s))throw new Error(`unknown widget type ${s}`);const i={...o,id:n,type:s,configuration:r||{type:s}};return t.widgets.set(n,i),t.widgets.get(n)},showWidget(e){t.activeWidgets.has(e.id)&&t.activeWidgets.delete(e.id),t.activeWidgets.set(e.id,e),t.minimized=!1},hasWidget:e=>t.activeWidgets.has(e.id),hideWidget(e){t.activeWidgets.delete(e.id)},minimizeWidgetDrawer(){t.minimized=!0},showWidgetDrawer(){t.minimized=!1},hideAllWidgets(){t.activeWidgets.clear()},editConfiguration(s){let o;if((0,r.isStateTreeNode)(s)&&(0,n.wo)(s))o=s;else{if(!("trackId"in s))throw new Error("must pass a configuration model or frozen config with trackId to editConfiguration");o=e.pluggableConfigSchemaType("track").create(s,(0,r.getEnv)(t))}const i=this.addWidget("ConfigurationEditorWidget","configEditor",{});i.setTarget(o),this.showWidget(i)},afterAttach(){(0,r.addDisposer)(t,(0,i.autorun)(function(){(0,o.localStorageSetItem)("drawerPosition",t.drawerPosition)},{name:"DrawerPosition"}))}})).postProcessSnapshot(e=>{if(!e)return e;const{drawerPosition:t,drawerWidth:s,widgets:n,activeWidgets:o,minimized:r,...i}=e;return{...i,..."right"!==t?{drawerPosition:t}:{},...384!==s?{drawerWidth:s}:{},...Object.keys(n??{}).length?{widgets:n}:{},...Object.keys(o??{}).length?{activeWidgets:o}:{},...r?{minimized:r}:{}}})}},78770(e,t,s){s.d(t,{S:()=>c,X:()=>l});var n=s(23886),o=s(10533),r=s(44934),i=s(38811),a=s(27878);function c(e){return o.types.compose((0,i.DH)(e),(0,a.X)(e),o.types.model({views:o.types.array(e.pluggableMstType("view","stateModel")),stickyViewHeaders:o.types.optional(o.types.boolean,()=>(0,n.localStorageGetBoolean)("stickyViewHeaders",!0)),useWorkspaces:o.types.optional(o.types.boolean,()=>(0,n.localStorageGetBoolean)("useWorkspaces",!1))})).actions(t=>({moveViewDown(e){const s=t.views.findIndex(t=>t.id===e);-1!==s&&s<t.views.length-1&&t.views.splice(s,2,t.views[s+1],t.views[s])},moveViewUp(e){const s=t.views.findIndex(t=>t.id===e);s>0&&t.views.splice(s-1,2,t.views[s],t.views[s-1])},moveViewToTop(e){const s=t.views.findIndex(t=>t.id===e);t.views=(0,o.cast)([t.views[s],...t.views.filter(t=>t.id!==e)])},moveViewToBottom(e){const s=t.views.findIndex(t=>t.id===e);t.views=(0,o.cast)([...t.views.filter(t=>t.id!==e),t.views[s]])},addView(s,n={}){if(!e.getElementType("view",s))throw new Error(`unknown view type ${s}`);const o=t.views.push({...n,type:s});return t.views[o-1]},removeView(e){for(const[,s]of t.activeWidgets)s.view?.id===e.id&&t.hideWidget(s);t.views.remove(e)},setStickyViewHeaders(e){t.stickyViewHeaders=e},setUseWorkspaces(e){t.useWorkspaces=e},afterAttach(){(0,o.addDisposer)(t,(0,r.autorun)(function(){(0,n.localStorageSetBoolean)("stickyViewHeaders",t.stickyViewHeaders)},{name:"StickyViewHeaders"})),(0,o.addDisposer)(t,(0,r.autorun)(function(){(0,n.localStorageSetBoolean)("useWorkspaces",t.useWorkspaces)},{name:"UseWorkspaces"}))}})).postProcessSnapshot(e=>{if(!e)return e;const{stickyViewHeaders:t,useWorkspaces:s,...n}=e;return{...n,...t?{}:{stickyViewHeaders:t},...s?{useWorkspaces:s}:{}}})}function l(e){return(0,i.qk)(e)&&"views"in e}},56591(e,t,s){s.d(t,{A:()=>f,m:()=>u});var n=s(30128),o=s(36082),r=s(27976),i=s(92155),a=s(8631),c=s(64444),l=s(39417),d=s(91848);const u=(0,n.lazy)(()=>Promise.all([s.e(5754),s.e(7993),s.e(7529),s.e(5043),s.e(902)]).then(s.bind(s,63782)));class f extends o.A{name="DataManagementPlugin";exports={AssemblyManager:u};install(e){(0,d.A)(e),(0,c.A)(e),(0,i.A)(e),(0,a.Ay)(e),(0,r.A)(e),(0,l.A)(e)}configure(e){}}},81590(e,t,s){s.r(t),s.d(t,{Loader:()=>Wt,default:()=>Ft});var n=s(55614),o=s(30128),r=s(11173),i=s(95360),a=s(10533),c=s(69566),l=(s(40214),s(44460));const d=(0,o.lazy)(()=>Promise.all([s.e(7120),s.e(1629)]).then(s.bind(s,71629))),u=(0,c.observer)(function({session:e}){const{snackbarMessages:t}=e,s=t.at(-1);return s?(0,l.jsx)(o.Suspense,{fallback:null,children:(0,l.jsx)(d,{onClose:(t,s)=>{"clickaway"!==s&&e.popSnackbarMessage()},contents:s})}):null});var f=s(46625),p=s(69565),m=s(31046),g=s(30097),h=s(92633);const y=(0,f.n)()(e=>({left:{zIndex:1e4,position:"fixed",bottom:e.spacing(2),left:e.spacing(2)},right:{zIndex:1e4,position:"fixed",bottom:e.spacing(2),right:e.spacing(2)}})),w=(0,c.observer)(function({session:e}){const{minimized:t,activeWidgets:s,drawerPosition:n}=e,{classes:o}=y();return s.size>0&&t?(0,l.jsx)(g.A,{title:"Open drawer widget",children:(0,l.jsx)(h.A,{className:"right"===n?o.right:o.left,color:"primary","data-testid":"drawer-maximize",onClick:()=>{e.showWidgetDrawer()},children:(0,l.jsx)(m.A,{})})}):null});var b=s(79659),S=s(17378);const v=(0,c.observer)(function({session:e}){const{configuration:t}=e,s=(0,S.QZ)(t,"logoPath");return s?.uri?(0,l.jsx)("img",{src:s.uri,alt:"Custom logo"}):(0,l.jsx)(b.P,{variant:"white"})});var k=s(77065),C=s(7201),A=s(35703),T=s(9378);const M=(0,f.n)()(e=>({buttonRoot:{"&:hover":{backgroundColor:(0,C.X4)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}));function N(e){const t=(0,n.c)(3),{classes:s}=M();let o;return t[0]!==s.buttonRoot||t[1]!==e?(o=(0,l.jsx)(A.A,{...e,className:s.buttonRoot,children:e.children}),t[0]=s.buttonRoot,t[1]=e,t[2]=o):o=t[2],o}const P=(0,c.observer)(function({menuTitle:e,menuItems:t}){return(0,l.jsxs)(T.A,{menuItems:t,color:"inherit",ButtonComponent:N,children:[e,(0,l.jsx)(k.A,{})]})});var I=s(10897),x=s(46537);const E=(0,f.n)()(e=>({grow:{flexGrow:1},inputBase:{color:e.palette.primary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.primary.light}},inputFocused:{borderColor:e.palette.secondary.main,backgroundColor:e.palette.primary.light}}));function R(e,t){return e.map(e=>({...e,..."onClick"in e?{onClick:()=>{e.onClick(t)}}:{},..."subMenu"in e?{subMenu:R(e.subMenu,t)}:{}}))}const j=(0,c.observer)(function({session:e,HeaderButtons:t=(0,l.jsx)("div",{})}){const{classes:s}=E(),{name:n,menus:o}=e;return(0,l.jsxs)(x.A,{children:[o().map(t=>(0,l.jsx)(P,{menuTitle:t.label,menuItems:()=>R("function"==typeof t.menuItems?t.menuItems():t.menuItems,e)},t.label)),(0,l.jsx)("div",{className:s.grow}),(0,l.jsx)(g.A,{title:"Rename session",arrow:!0,children:(0,l.jsx)(I.A,{value:n,variant:"body1",classes:{inputBase:s.inputBase,inputRoot:s.inputRoot,inputFocused:s.inputFocused},setValue:t=>{e.renameCurrentSession(t)}})}),t,(0,l.jsx)("div",{className:s.grow}),(0,l.jsx)("div",{style:{width:150,maxHeight:48},children:(0,l.jsx)(v,{session:e})})]})}),D=(0,c.observer)(function({session:e}){const{DialogComponent:t,DialogProps:s}=e;return t?(0,l.jsx)(o.Suspense,{fallback:null,children:(0,l.jsx)(t,{...s})}):null}),W=(0,o.lazy)(()=>s.e(4401).then(s.bind(s,64401))),L=(0,o.lazy)(()=>Promise.all([s.e(7562),s.e(6985)]).then(s.bind(s,86985))),U=(0,o.lazy)(()=>s.e(6595).then(s.bind(s,16595))),$=(0,f.n)()({viewsContainer:{gridRow:"components",overflow:"hidden"}}),F=(0,c.observer)(function(e){const{session:t}=e,{views:s}=t,{classes:n}=$(),r=!("useWorkspaces"in t)||t.useWorkspaces;return(0,l.jsx)("div",{className:n.viewsContainer,children:s.length>0?(0,l.jsx)(o.Suspense,{fallback:null,children:r?(0,l.jsx)(L,{session:t}):(0,l.jsx)(W,{session:t})}):(0,l.jsx)(o.Suspense,{fallback:null,children:(0,l.jsx)(U,{...e})})})}),V=(0,o.lazy)(()=>s.e(2910).then(s.bind(s,92910))),H=(0,f.n)()(e=>({root:{display:"grid",height:"100vh",width:"100%",colorScheme:e.palette.mode},appContainer:{gridColumn:"main",display:"grid",gridTemplateRows:"[menubar] min-content [components] auto",height:"100vh"},appBar:{flexGrow:1,gridRow:"menubar"}})),B=(0,c.observer)(function(e){const{session:t}=e;return(0,l.jsx)(o.Suspense,{fallback:null,children:(0,l.jsx)(V,{session:t})})}),O=(0,c.observer)(function(e){const{session:t}=e,{classes:s}=H(),{minimized:n,visibleWidget:o,drawerWidth:r,drawerPosition:i}=t,a=o&&!n,c=a?`[drawer] ${r}px`:void 0,d="right"===i?["[main] 1fr",c]:[c,"[main] 1fr"];return(0,l.jsxs)("div",{className:s.root,style:{gridTemplateColumns:d.filter(e=>!!e).join(" ")},children:[a&&"left"===i?(0,l.jsx)(B,{session:t}):null,(0,l.jsx)(D,{session:t}),(0,l.jsxs)("div",{className:s.appContainer,children:[(0,l.jsx)(p.A,{className:s.appBar,position:"static",children:(0,l.jsx)(j,{...e})}),(0,l.jsx)(F,{...e})]}),(0,l.jsx)(w,{session:t}),a&&"right"===i?(0,l.jsx)(B,{session:t}):null,(0,l.jsx)(u,{session:t})]})});var G=s(88015),z=s(51585),q=s(19608),J=s(43754);function K(){const[e,t]=(0,o.useState)(0),[s,n]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{const e=()=>{const e=(0,q.getPendingFileHandleIds)();t(e.length)};e();const s=setInterval(e,1e3);return()=>{clearInterval(s)}},[]),0===e?null:(0,l.jsxs)(J.A,{severity:"warning",action:(0,l.jsx)(A.A,{color:"inherit",size:"small",onClick:async()=>{n(!0);try{const e=(await(0,q.restorePendingFileHandles)()).filter(e=>e.success).length,s=(0,q.getPendingFileHandleIds)().length;t(s),e>0&&window.location.reload()}catch(e){console.error("Error restoring file handles:",e)}finally{n(!1)}},disabled:s,children:s?"Restoring...":"Restore access"}),children:[e," local file",e>1?"s":""," need",1===e?"s":""," permission to be restored."]})}var _=s(75242);const Q=(0,f.n)()(e=>({shareDiv:{textAlign:"center",paddingLeft:"2px"},shareButton:{backgroundColor:(0,C.X4)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}})),Z=(0,o.lazy)(()=>s.e(2088).then(s.bind(s,72088))),X=(0,c.observer)(function(e){const[t,s]=(0,o.useState)(!1),{session:n}=e,{classes:r}=Q();return(0,l.jsxs)("div",{className:r.shareDiv,children:[(0,l.jsx)(A.A,{size:"small",color:"inherit",startIcon:(0,l.jsx)(_.A,{}),classes:{root:r.shareButton},onClick:async()=>{s(!0)},children:"Share"}),t?(0,l.jsx)(o.Suspense,{fallback:null,children:(0,l.jsx)(Z,{session:n,handleClose:()=>{s(!1)}})}):null]})});var Y=s(6430);const ee=(0,c.observer)(function({pluginManager:e}){const{adminKey:t,adminServer:s,config:n}=(0,Y.BW)(["adminKey","adminServer","config"]),{rootModel:r}=e,{error:i,jbrowse:c,session:d}=r,u=d,{id:f,theme:p}=u;if((0,o.useEffect)(()=>{(0,Y.dR)({session:`local-${f}`}),window.JBrowseRootModel=r,window.JBrowseSession=u},[f,r,u]),(0,o.useEffect)(()=>t?(0,a.onSnapshot)(c,async e=>{try{const o=await fetch(s||"/updateConfig",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminKey:t,configPath:n,config:e})});if(!o.ok){const e=await o.text();throw new Error(`HTTP ${o.status} (${e})`)}}catch(e){u.notify(`Admin server error: ${e}`)}}):void 0,[c,u,t,s,n]),i)throw i;return(0,l.jsxs)(G.A,{theme:p,children:[(0,l.jsx)(z.Ay,{}),(0,l.jsx)(K,{}),(0,l.jsx)(O,{session:u,HeaderButtons:(0,l.jsx)(X,{session:u})},f)]})}),te=ee;var se=s(37647),ne=s(22601),oe=s(11931),re=s(38817),ie=s(86625),ae=s(44934),ce=s(95994);const le=["https://jbrowse.org/plugins/"];async function de(e){if(0===e.length)return!0;const t=await async function(){const e=await fetch("https://jbrowse.org/plugin-store/plugins.json");if(!e.ok)throw new Error(`HTTP ${e.status} ${e.statusText} fetching plugins`);return e.json()}();return e.every(e=>{return s=(0,ne.Hm)(e),le.some(e=>s.startsWith(e))||function(e,t){const s=(0,ne.Hm)(e);return(0,ne.rE)(e)?t.plugins.some(e=>(0,ne.rE)(e)&&(0,ne.Hm)(e)===s):(0,ne.Cx)(e)?t.plugins.some(e=>(0,ne.Cx)(e)&&(0,ne.Hm)(e)===s):!!(0,ne.Nz)(e)&&t.plugins.some(e=>(0,ne.Nz)(e)&&(0,ne.Hm)(e)===s)}(e,t);var s})}var ue=s(65446);const fe=a.types.model({configPath:a.types.maybe(a.types.string),sessionQuery:a.types.maybe(a.types.string),password:a.types.maybe(a.types.string),adminKey:a.types.maybe(a.types.string),loc:a.types.maybe(a.types.string),sessionTracks:a.types.maybe(a.types.string),assembly:a.types.maybe(a.types.string),tracks:a.types.maybe(a.types.string),tracklist:a.types.maybe(a.types.boolean),highlight:a.types.maybe(a.types.string),nav:a.types.maybe(a.types.boolean),sessionName:a.types.maybe(a.types.string),initialTimestamp:a.types.number,hubURL:a.types.maybe(a.types.array(a.types.string)),configSnapshot:a.types.frozen(void 0),sessionSnapshot:a.types.frozen(void 0)}).volatile(()=>({sessionTriaged:void 0,sessionSpec:void 0,hubSpec:void 0,blankSession:!1,runtimePlugins:void 0,sessionPlugins:void 0,sessionError:void 0,configError:void 0})).views(e=>({get isSharedSession(){return!!e.sessionQuery?.startsWith("share-")},get isSpecSession(){return!!e.sessionQuery?.startsWith("spec-")},get isHubSession(){return!!e.hubURL},get isJb1StyleSession(){return!(!e.loc&&!e.assembly)},get isEncodedSession(){return!!e.sessionQuery?.startsWith("encoded-")},get isJsonSession(){return!!e.sessionQuery?.startsWith("json-")},get isLocalSession(){return!!e.sessionQuery?.startsWith("local-")},get ready(){return this.isSessionLoaded&&!e.configError&&this.pluginsLoaded},get error(){return e.configError||e.sessionError},get pluginsLoaded(){return e.sessionError||e.blankSession||e.sessionSpec?Boolean(e.runtimePlugins):Boolean(e.runtimePlugins&&e.sessionPlugins)},get isSessionLoaded(){return Boolean(e.sessionError||e.sessionSnapshot||e.blankSession||e.sessionSpec)},get isConfigLoaded(){return Boolean(e.configError||e.configSnapshot)},get sessionTracksParsed(){return e.sessionTracks?JSON.parse(e.sessionTracks):[]},get resolvedConfigPath(){const t=window.__jbrowseConfigPath;return e.configPath||t||"config.json"}})).actions(e=>({setConfigError(t){e.configError=t},setSessionError(t){e.sessionError=t},setRuntimePlugins(t){e.runtimePlugins=t},setSessionPlugins(t){e.sessionPlugins=t},setConfigSnapshot(t){e.configSnapshot=t},setBlankSession(t){e.blankSession=t},setSessionTriaged(t){e.sessionTriaged=t},setSessionSnapshot(t){e.sessionSnapshot=t}})).actions(e=>({async fetchPlugins(t){try{const s=new ne.Ay(t.plugins||[],{fetchESM:e=>import(e)});s.installGlobalReExports(window);const n=await s.load(window.location.href);e.setRuntimePlugins([...n])}catch(t){console.error(t),e.setConfigError(t)}},async fetchSessionPlugins(t){try{const s=new ne.Ay(t.sessionPlugins||[],{fetchESM:e=>import(e)}).installGlobalReExports(window),n=await s.load(window.location.href);e.setSessionPlugins([...n])}catch(t){console.error(t),e.setConfigError(t)}},async loadSession(t,s){try{const{sessionPlugins:n=[]}=t;await de(n)||s?(await this.fetchSessionPlugins(t),e.setSessionSnapshot(t)):e.setSessionTriaged({snap:t,origin:"session",reason:n})}catch(t){console.error(t),e.setConfigError(t)}},async fetchConfig(){const t=e.resolvedConfigPath;if("none"!==t){const s=await(0,oe.openLocation)({uri:t+(window.__jbrowseCacheBuster?`?rand=${Math.random()}`:""),locationType:"UriLocation"}).readFile("utf8"),n=JSON.parse(s),o=new URL(t,window.location.href);if((0,ue.XE)(n,o),o.hostname!==window.location.hostname){const t=n.plugins||[];if(!await de(t))return void e.setSessionTriaged({snap:n,origin:"config",reason:t})}await this.fetchPlugins(n),e.setConfigSnapshot(n)}else e.setConfigSnapshot({})},async setUpConfig(){const t=e.resolvedConfigPath,s=new URL(t,window.location.href),n=structuredClone(e.configSnapshot);(0,ue.XE)(n,s),e.setConfigSnapshot(n),await this.fetchPlugins(n)},async fetchSessionFromSessionStorage(e){const t=sessionStorage.getItem("current");if(t){const s=JSON.parse(t).session||{};if(e===s.id)return await this.loadDecodedSession(s),!0}return!1},async fetchSessionFromIndexedDB(e){try{const t=await(0,ie.P2)("sessionsDB",2,{upgrade(e){e.createObjectStore("metadata"),e.createObjectStore("sessions")}}),s=await t.get("sessions",e);if(s)return await this.loadDecodedSession(s),!0}catch(e){console.error(e)}return!1},async fetchLocalSession(){const t=e.sessionQuery.replace("local-","");if(!await this.fetchSessionFromSessionStorage(t)&&!await this.fetchSessionFromIndexedDB(t))throw new Error("Local session not found")},async loadSessionPluginsIfNeeded(t){e.sessionPlugins||await this.loadSession(t)},async loadDecodedSession(e){await this.loadSession({...e,id:(0,re.w)()})},async fetchSharedSession(){const t=await(0,ce.Z)(`${(0,ue.Vr)(e.configSnapshot,"shareURL","https://share.jbrowse.org/api/v1/")}load`,e.sessionQuery||"",e.password||""),s=JSON.parse(await(0,ue.LP)(t));await this.loadDecodedSession(s)},async decodeEncodedUrlSession(){const t=JSON.parse(await(0,ue.LP)(e.sessionQuery.replace("encoded-","")));await this.loadDecodedSession(t)},decodeSessionSpec(){e.sessionSpec=JSON.parse(e.sessionQuery.replace("spec-",""))},decodeJb1StyleSession(){const{loc:t,tracks:s,assembly:n,tracklist:o,nav:r,highlight:i,sessionTracksParsed:a}=e;e.sessionSpec={sessionTracks:a,views:[{type:"LinearGenomeView",tracks:s?.split(","),sessionTracks:a,loc:t,assembly:n,tracklist:o,nav:r,highlight:i?.split(" ")}]}},decodeHubSpec(){const{hubURL:t,sessionTracksParsed:s}=e;e.hubSpec={sessionTracks:s,hubURL:t}},async decodeJsonUrlSession(){const{session:t}=JSON.parse(e.sessionQuery.replace(/^json-/,""));await this.loadDecodedSession(t)},afterCreate(){(async()=>{try{await(e.configSnapshot?this.setUpConfig():this.fetchConfig()),(0,a.addDisposer)(e,(0,ae.autorun)(async()=>{try{const{isLocalSession:t,isEncodedSession:s,isSpecSession:n,isSharedSession:o,isJsonSession:r,isJb1StyleSession:i,isHubSession:a,sessionSnapshot:c,configSnapshot:l}=e;if(!l)return;if(c)await this.loadSessionPluginsIfNeeded(c);else if(o)await this.fetchSharedSession();else if(n)this.decodeSessionSpec();else if(i)this.decodeJb1StyleSession();else if(s)await this.decodeEncodedUrlSession();else if(r)await this.decodeJsonUrlSession();else if(t)await this.fetchLocalSession();else if(a)this.decodeHubSpec(),e.setBlankSession(!0);else{if(e.sessionQuery)throw new Error(`Unrecognized URL session format: "${e.sessionQuery}"`);e.setBlankSession(!0)}}catch(t){console.error(t),e.setSessionError(t)}}))}catch(t){console.error(t),e.setConfigError(t)}})()}})),pe=fe;var me=s(26994),ge=s(23886);var he=s(56246);function ye(e,t){return void 0!==e.views?{viewIds:e.views.map(e=>t[e]?.id).filter(e=>void 0!==e),size:e.size}:e.children?{direction:e.direction,children:e.children.map(e=>ye(e,t)),size:e.size}:{}}async function we({views:e,sessionTracks:t=[],layout:s,sessionName:n},o){const r=o.rootModel;try{r.setSession({name:n??`New session ${(new Date).toLocaleString()}`});for(const e of t)r.session.addTrackConf(e);if(await Promise.all(e.map(e=>o.evaluateAsyncExtensionPoint(`LaunchView-${e.type}`,{...e,session:r.session}))),s){const e=r.session;e.setUseWorkspaces(!0),e.setInit(ye(s,e.views))}}catch(e){console.error(e),r.session?.notifyError(`${e}`,e)}}const be=a.types.model("TimeTraveller",{undoIdx:-1,targetPath:""}).volatile(()=>({history:[],notTrackingUndo:!1})).views(e=>({get canUndo(){return e.undoIdx>0&&!e.notTrackingUndo},get canRedo(){return e.undoIdx<e.history.length-1&&!e.notTrackingUndo}})).actions(e=>{let t,s,n,o,r=!1;return{stopTrackingUndo(){e.notTrackingUndo=!0},resumeTrackingUndo(){e.notTrackingUndo=!1},addUndoState(t){e.notTrackingUndo||(r?r=!1:(e.history.splice(e.undoIdx+1),e.history.push(t),e.history.length>20&&e.history.shift(),e.undoIdx=e.history.length-1))},beforeDestroy(){s(),n&&clearTimeout(n)},initialize(){if(t=e.targetPath?(0,a.resolvePath)(e,e.targetPath):(0,a.getEnv)(e).targetStore,!t)throw new Error("Failed to find target store for TimeTraveller. Please provide `targetPath` property, or a `targetStore` in the environment");s=(0,a.onSnapshot)(t,t=>{e.notTrackingUndo||r||(o=t,n&&clearTimeout(n),n=setTimeout(()=>{n=void 0,this.addUndoState(o)},300))}),0===e.history.length&&this.addUndoState((0,a.getSnapshot)(t))},undo(){e.undoIdx--,r=!0,t&&(0,a.applySnapshot)(t,e.history[e.undoIdx])},redo(){e.undoIdx++,r=!0,t&&(0,a.applySnapshot)(t,e.history[e.undoIdx])}}});function Se({menus:e,menuName:t}){return e.push({label:t,menuItems:[]})}function ve({menus:e,menuName:t,position:s}){return e.splice((s<0?e.length:0)+s,0,{label:t,menuItems:[]}),e.length}function ke({menus:e,menuName:t,menuItem:s}){const n=e.find(e=>e.label===t);return n?n.menuItems.push(s):(e.push({label:t,menuItems:[s]}),1)}function Ce({menus:e,menuName:t,menuItem:s,position:n}){const o=e.find(e=>e.label===t);if(!o)return e.push({label:t,menuItems:[s]}),1;const r=n<0?o.menuItems.length+n:n;return o.menuItems.splice(r,0,s),o.menuItems.length}function Ae({menus:e,menuPath:t,menuItem:s}){let n=e.find(e=>e.label===t[0]);n||(n=e[Se({menus:e,menuName:t[0]})-1]);let{menuItems:o}=n;const r=[t[0]];for(const e of t.slice(1)){r.push(e);let t=o.find(t=>"label"in t&&t.label===e);if(!t){const s=o.push({label:e,subMenu:[]});t=o[s-1]}if(!("subMenu"in t))throw new Error(`"${e}" in path "${r}" is not a subMenu`);o=t.subMenu}return o.push(s)}function Te({menus:e,menuPath:t,menuItem:s,position:n}){let o=e.find(e=>e.label===t[0]);o||(o=e[Se({menus:e,menuName:t[0]})-1]);let{menuItems:r}=o;const i=[t[0]];for(const e of t.slice(1)){i.push(e);let t=r.find(t=>"label"in t&&t.label===e);if(!t){const s=r.push({label:e,subMenu:[]});t=r[s-1]}if(!("subMenu"in t))throw new Error(`"${e}" in path "${i}" is not a subMenu`);r=t.subMenu}return r.splice(n,0,s),r.length}var Me=s(75335),Ne=s(60459);function Pe(e){return!("function"==typeof e||e instanceof Error)}class Ie{constructor(e){this.driver=e}async getWorker(){return this.workerP||(this.workerP=this.driver.makeWorker().catch(e=>{throw this.workerP=void 0,e})),this.workerP}}class xe{lastWorkerAssignment=-1;workerAssignments=new Map;constructor(e){this.config=e.config}filterArgs(e,t){if(null==e)return e;const s=typeof e;if("string"===s||"number"===s||"boolean"===s)return e;if("object"===s){if(Array.isArray(e))return e.filter(e=>Pe(e)).map(e=>this.filterArgs(e,t));if((0,a.isStateTreeNode)(e)&&!(0,a.isAlive)(e))throw new Error("dead state tree node passed to RPC call");return e instanceof File?e:Object.fromEntries(Object.entries(e).filter(e=>Pe(e[1])).map(([e,s])=>[e,this.filterArgs(s,t)]))}}async remoteAbort(e,t,s){const n=await this.getWorker(e);await n.call(t,{stopTokenId:s},{rpcDriverClassName:this.name})}createWorkerPool(){const e=function(){const e="undefined"!=typeof window,t=e&&"hardwareConcurrency"in window.navigator;return e&&t?window.navigator.hardwareConcurrency:1}(),t=(0,S.QZ)(this.config,"workerCount")||(0,ge.clamp)(1,Math.max(1,e-1),5),s=[];for(let e=0;e<t;e++)s.push(new Ie(this));return s}getWorkerPool(){if(!this.workerPool){const e=this.createWorkerPool();return this.workerPool=e,e}return this.workerPool}async getWorker(e){const t=this.getWorkerPool();let s=this.workerAssignments.get(e);if(void 0===s){const n=(this.lastWorkerAssignment+1)%t.length;this.workerAssignments.set(e,n),this.lastWorkerAssignment=n,s=n}return t[s].getWorker()}async call(e,t,s,n,o={}){if(!t)throw new TypeError("sessionId is required");const r=await this.getWorker(t),i=e.evaluateExtensionPoint("Core-extendWorker",r),a=e.getRpcMethodType(s);if(!a)throw new Error(`unknown RPC method ${s}`);const c=await a.serializeArguments(n,this.name),l=this.filterArgs(c,t),d=await i.call(s,l,{statusCallback:n.statusCallback,rpcDriverClassName:this.name,...o});return a.deserializeReturn(d,n,this.name)}}class Ee{destroy(){}async call(e,t,s={}){}}class Re extends xe{name="MainThreadRpcDriver";constructor(e){super(e),this.makeWorker=async()=>new Ee}async call(e,t,s,n){if(!t)throw new TypeError("sessionId is required");const o=e.getRpcMethodType(s);if(!o)throw new Error(`unknown RPC method ${s}`);if(o.supportsDirectExecution()){const e=await o.executeDirect(n);if(void 0!==e)return e}const r=await o.serializeArguments(n,this.name),i=await o.execute(r,this.name);return o.deserializeReturn(i,n,this.name)}}var je=s(31508),De=s(95783);class We{constructor(e){this.worker=e,this.client=new je.XK(e),this.client.on("error",e=>{console.error("[WebWorker RPC Error]",e)})}destroy(){this.worker.terminate()}async call(e,t,s){const{statusCallback:n,rpcDriverClassName:o}=s,r=`message-${(0,De.Ak)()}`,i=e=>{n?.(e)};this.client.on(r,i);try{return await this.client.call(e,{...t,channel:r,rpcDriverClassName:o})}finally{this.client.off(r,i)}}}class Le extends xe{name="WebWorkerRpcDriver";constructor(e,t){super(e),this.workerBootConfiguration=t,this.makeWorkerInstance=e.makeWorkerInstance}async makeWorker(){const e=this.makeWorkerInstance(),t=new We(e);return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&console.log("console logging the webworker handle avoids the track going into an infinite loading state, this is a hacky workaround for safari",e),new Promise((s,n)=>{const o=r=>{switch(r.data.message){case"ready":s(t),e.removeEventListener("message",o);break;case"readyForConfig":e.postMessage({message:"config",config:this.workerBootConfiguration});break;case"error":n((0,je.cy)(r.data.error))}};e.addEventListener("message",o)})}}const Ue=(0,Ne.S7)("BaseRpcDriver",{workerCount:{type:"number",description:"The number of workers to use. If 0 (the default) JBrowse will decide how many workers to use.",defaultValue:0}},{explicitlyTyped:!0}),$e=(0,Ne.S7)("MainThreadRpcDriver",{},{baseConfiguration:Ue,explicitlyTyped:!0}),Fe=(0,Ne.S7)("WebWorkerRpcDriver",{},{baseConfiguration:Ue,explicitlyTyped:!0}),Ve=(0,Ne.S7)("RpcOptions",{defaultDriver:{type:"string",description:"the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend",defaultValue:"MainThreadRpcDriver"},drivers:a.types.optional(a.types.map(a.types.union($e,Fe)),{MainThreadRpcDriver:{type:"MainThreadRpcDriver"},WebWorkerRpcDriver:{type:"WebWorkerRpcDriver"}})},{actions:e=>({addDriverConfig(t,s){e.drivers.set(t,s)}})});class He{static configSchema=Ve;constructor(e,t,s){this.pluginManager=e,this.mainConfiguration=t,this.backendConfigurations=s,this.driverObjects=new Map,this.driverFactories=new Map,this.registerDriverFactory("MainThreadRpcDriver",(e,t)=>new Re({...t,config:e})),this.registerDriverFactory("WebWorkerRpcDriver",(e,t,s)=>new Le({...t,config:e},{plugins:s.runtimePluginDefinitions,windowHref:"undefined"!=typeof window?window.location.href:""}))}registerDriverFactory(e,t){this.driverFactories.set(e,t)}getDriver(e){const t=this.driverObjects.get(e);if(t)return t;const s=this.driverFactories.get(e);if(!s)throw new Error(`RPC driver "${e}" is not registered`);const n=this.backendConfigurations[e];if(!n)throw new Error(`RPC driver "${e}" is missing configuration`);const o=s(this.mainConfiguration.drivers.get("WebWorkerRpcDriver"),n,this.pluginManager);return this.driverObjects.set(e,o),o}async getDriverForCall(e,t,s){const n=s.rpcDriverName||(0,S.QZ)(this.mainConfiguration,"defaultDriver");return this.getDriver(n)}async call(e,t,s,n={}){if(!e)throw new Error("sessionId is required");return(await this.getDriverForCall(e,t,s)).call(this.pluginManager,e,t,s,n)}}var Be=s(72242),Oe=s(56591),Ge=s(95670),ze=s(21115),qe=s(47664);const Je=new RegExp("[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*"),Ke=["rgb(153, 102, 0)","rgb(102, 102, 0)","rgb(153, 153, 30)","rgb(204, 0, 0)","rgb(255, 0, 0)","rgb(255, 0, 204)","rgb(165, 132, 132)","rgb(204, 122, 0)","rgb(178, 142, 0)","rgb(153, 153, 0)","rgb(122, 153, 0)","rgb(0, 165, 0)","rgb(53, 128, 0)","rgb(0, 0, 204)","rgb(96, 145, 242)","rgb(107, 142, 178)","rgb(0, 165, 165)","rgb(122, 153, 153)","rgb(153, 0, 204)","rgb(204, 51, 255)","rgb(173, 130, 216)","rgb(102, 102, 102)","rgb(145, 145, 145)","rgb(142, 142, 142)","rgb(142, 142, 107)","rgb(96, 163, 48)"];function _e(e){if(!Je.test(e))throw new Error(`Encountered invalid refName: "${e}"`)}function Qe(e,t){const s=new Ge.A({cache:new qe.A({maxSize:1e3}),async fill(e,t,s){const{adapterConf:n,self:o,options:r}=e;let i;try{const e=o.configuration?.sequence?.adapter;i=e?(0,a.getSnapshot)(e):void 0}catch(e){}return async function(e,t,s){const{sessionId:n,sequenceAdapter:o}=s;await(0,ae.when)(()=>!(!e.regions||!e.refNameAliases),{name:"when assembly ready"});const r=await e.rpcManager.call(n||"assemblyRpc","CoreGetRefNames",{adapterConfig:t,sequenceAdapter:o,stopToken:void 0,...s},{timeout:1e6}),{refNameAliases:i}=e;if(!i)throw new Error(`error loading assembly ${e.name}'s refNameAliases`);const a=Object.fromEntries(r.map(t=>(_e(t),[e.getCanonicalRefName(t),t])));return{forwardMap:a,reverseMap:Object.fromEntries(Object.entries(a).map(([e,t])=>[t,e]))}}(o,n,{...r,statusCallback:s,sequenceAdapter:i})}});return a.types.model({configuration:a.types.safeReference(e)}).volatile(()=>({error:void 0,loadingP:void 0,volatileRegions:void 0,refNameAliases:void 0,canonicalToSeqAdapterRefNames:void 0,cytobands:void 0})).views(e=>({getConf:t=>e.configuration?(0,S.FI)(e,t):void 0,get lowerCaseRefNameAliases(){return e.refNameAliases?Object.fromEntries(Object.entries(e.refNameAliases).map(([e,t])=>[e.toLowerCase(),t])):void 0}})).views(e=>({get initialized(){return e.load(),!!e.refNameAliases},get name(){return e.getConf("name")||""},get regions(){return e.load(),e.volatileRegions},get aliases(){return e.getConf("aliases")||[]},get displayName(){return e.getConf("displayName")||e.getConf("name")||""},hasName(e){return this.allAliases.includes(e)},get allAliases(){return[this.name,...this.aliases]},get allRefNames(){return e.refNameAliases?Object.keys(e.refNameAliases):void 0},get lowerCaseRefNames(){return e.lowerCaseRefNameAliases?Object.keys(e.lowerCaseRefNameAliases):void 0},get allRefNamesWithLowerCase(){return this.allRefNames&&this.lowerCaseRefNames?[...new Set([...this.allRefNames,...this.lowerCaseRefNames])]:void 0},get rpcManager(){return(0,a.getParent)(e,2).rpcManager},get refNameColors(){const t=e.getConf("refNameColors")||[];return 0===t.length?Ke:t}})).views(e=>({get refNames(){return e.regions?.map(e=>e.refName)}})).views(e=>({getCanonicalRefName(t){if(!e.refNameAliases||!e.lowerCaseRefNameAliases)throw new Error("aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called");return e.refNameAliases[t]||e.lowerCaseRefNameAliases[t]},getCanonicalRefName2(e){return this.getCanonicalRefName(e)||e},getRefNameColor(t){if(!e.refNames)return;const s=e.refNames.indexOf(t);return-1===s?void 0:e.refNameColors[s%e.refNameColors.length]},isValidRefName(t){if(!e.refNameAliases)throw new Error("isValidRefName cannot be called yet, the assembly has not finished loading");return!!this.getCanonicalRefName(t)},getSeqAdapterRefName:t=>e.canonicalToSeqAdapterRefNames?.[t]??t})).actions(e=>({setLoaded({regions:e,refNameAliases:t,cytobands:s}){this.setRegions(e),this.setRefNameAliases(t),this.setCytobands(s)},setError(t){e.error=t},setRegions(t){e.volatileRegions=t},setRefNameAliases(t){e.refNameAliases=t},setCytobands(t){e.cytobands=t},setCanonicalToSeqAdapterRefNames(t){e.canonicalToSeqAdapterRefNames=t},setLoadingP(t){e.loadingP=t},load(){return e.loadingP||(e.loadingP=this.loadPre().catch(e=>{this.setLoadingP(void 0),this.setError(e)})),e.loadingP},async loadPre(){const s=e.configuration,n=s?.refNameAliases?.adapter,o=s?.cytobands?.adapter,r=s?.sequence.adapter,i=e.name,a=await async function({config:e,pluginManager:t,stopToken:s}){const n=t.getAdapterType(e.type);return new(await n.getAdapterClass())(e,void 0,t).getRegions({stopToken:s})}({config:r,pluginManager:t});for(const e of a)_e(e.refName);const c={},l=await async function({config:e,pluginManager:t,stopToken:s}){const n=t.getAdapterType(e.type);return new(await n.getAdapterClass())(e,void 0,t).getRefNameAliases({stopToken:s})}({config:n,pluginManager:t});for(const{refName:e,aliases:t,override:s}of l){for(const s of t)_e(s),c[s]=e;s&&(c[e]=e)}for(const e of a)c[e.refName]||=e.refName;const d={};for(const e of a){const t=c[e.refName]||e.refName;t!==e.refName&&(d[t]=e.refName)}this.setCanonicalToSeqAdapterRefNames(d),this.setLoaded({refNameAliases:c,regions:a.map(e=>({...e,refName:c[e.refName]||e.refName,assemblyName:i})),cytobands:await Ze({config:o,pluginManager:t})})}})).views(e=>({getAdapterMapEntry(t,n){const{stopToken:o,statusCallback:r,...i}=n;if(!n.sessionId)throw new Error("sessionId is required");return s.get((0,ze.L)(t),{adapterConf:t,self:e,options:i},void 0,r)},async getRefNameMapForAdapter(e,t){if(!t.sessionId)throw new Error("sessionId is required");return(await this.getAdapterMapEntry(e,t)).forwardMap},async getReverseRefNameMapForAdapter(e,t){return(await this.getAdapterMapEntry(e,t)).reverseMap},afterCreate(){(0,a.addDisposer)(e,(0,ae.autorun)(function(){e.allRefNamesWithLowerCase},{name:"AssemblyRefNames"}))}}))}async function Ze({config:e,pluginManager:t}){const s=t.getAdapterType(e.type);return new(await s.getAdapterClass())(e,void 0,t).getData()}var Xe=s(11218),Ye=s(24424),et=s(2202),tt=s(89693),st=s(50518),nt=s(67922),ot=s(7085),rt=s(66820),it=s(51255),at=s(38173),ct=s(46820),lt=s(14359),dt=s(99759);function ut({pluginManager:e}){return(0,Ne.S7)("Root",{rpc:He.configSchema,highResolutionScaling:{type:"number",defaultValue:2},formatDetails:(0,Ne.S7)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth to iterate the formatDetails->subfeatures callback on subfeatures (used for example to only apply the callback to the first layer of subfeatures)"},maxDepth:{type:"number",defaultValue:1e4,description:"hide subfeatures greater than a certain depth"}}),formatAbout:(0,Ne.S7)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}}),shareURL:{type:"string",defaultValue:"https://share.jbrowse.org/api/v1/"},disableAnalytics:{type:"boolean",defaultValue:!1},hierarchical:(0,Ne.S7)("hierarchical",{sort:(0,Ne.S7)("hierarchicalSort",{trackNames:{type:"boolean",defaultValue:!1},categories:{type:"boolean",defaultValue:!1}}),defaultCollapsed:(0,Ne.S7)("defaultCollapsed",{categoryNames:{type:"stringArray",defaultValue:[]},topLevelCategories:{type:"boolean",defaultValue:!1},subCategories:{type:"boolean",defaultValue:!1}})}),theme:{type:"frozen",defaultValue:{}},extraThemes:{type:"frozen",defaultValue:{}},logoPath:{type:"fileLocation",defaultValue:{uri:"",locationType:"UriLocation"}},...e.pluginConfigurationNamespacedSchemas(),...e.pluginConfigurationUnnamespacedSchemas()})}function ft(){return new Worker(new URL(s.p+s.u(5224),s.b))}window.getSnapshot=a.getSnapshot,window.resolveIdentifier=a.resolveIdentifier;const pt=(0,o.lazy)(()=>s.e(3114).then(s.bind(s,13114))),mt=(0,o.lazy)(()=>s.e(513).then(s.bind(s,22894)));function gt({pluginManager:e,sessionModelFactory:t,adminMode:n=!1}){const o=function(e){return(0,Ne.S7)("BaseAssembly",{aliases:{type:"stringArray",defaultValue:[],description:"Other possible names for the assembly"},sequence:e.getTrackType("ReferenceSequenceTrack").configSchema,refNameColors:{type:"stringArray",defaultValue:[],description:"Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence."},refNameAliases:(0,Ne.S7)("RefNameAliases",{adapter:e.pluggableConfigSchemaType("adapter")},{preProcessSnapshot:e=>e.adapter?e:{adapter:{type:"RefNameAliasAdapter"}}}),cytobands:(0,Ne.S7)("Cytoband",{adapter:e.pluggableConfigSchemaType("adapter")},{preProcessSnapshot:e=>e.adapter?e:{adapter:{type:"CytobandAdapter"}}}),displayName:{type:"string",defaultValue:"",description:'A human readable display name for the assembly e.g. "Homo sapiens (hg38)" while the assembly name may just be "hg38"'}},{explicitIdentifier:"name"})}(e),r=function({pluginManager:e,assemblyConfigSchema:t,adminMode:s}){return a.types.snapshotProcessor(function({pluginManager:e,assemblyConfigSchema:t}){return function({pluginManager:e,assemblyConfigSchema:t}){return a.types.model("JBrowseConfig",{configuration:ut({pluginManager:e}),plugins:a.types.array(a.types.frozen()),assemblies:a.types.array(t),tracks:a.types.frozen([]),internetAccounts:a.types.array(e.pluggableConfigSchemaType("internet account")),aggregateTextSearchAdapters:a.types.array(e.pluggableConfigSchemaType("text search adapter")),connections:a.types.array(e.pluggableConfigSchemaType("connection")),defaultSession:a.types.optional(a.types.frozen(),{name:"New Session"}),preConfiguredSessions:a.types.array(a.types.frozen()),...e.pluginConfigurationRootSchemas()})}({pluginManager:e,assemblyConfigSchema:t}).views(e=>({get assemblyNames(){return e.assemblies.map(e=>(0,S.QZ)(e,"name"))},get rpcManager(){return(0,a.getParent)(e).rpcManager}})).actions(e=>({addAssemblyConf(t){const{name:s}=t;if(!s)throw new Error('Can\'t add assembly with no "name"');if(e.assemblyNames.includes(s))throw new Error(`Can't add assembly with name "${s}", an assembly with that name already exists`);const n=e.assemblies.push({...t,sequence:{type:"ReferenceSequenceTrack",trackId:`${s}-${Date.now()}`,...t.sequence}});return e.assemblies[n-1]},removeAssemblyConf(t){const s=e.assemblies.find(e=>e.name===t);s&&e.assemblies.remove(s)},addTrackConf(t){const{type:s}=t;if(!s)throw new Error(`unknown track type ${s}`);return e.tracks=[...e.tracks,t],e.tracks.at(-1)},addConnectionConf(t){const{type:s}=t;if(!s)throw new Error(`unknown connection type ${s}`);const n=e.connections.push(t);return e.connections[n-1]},deleteConnectionConf(t){const s=e.connections.find(e=>e.id===t.id);return e.connections.remove(s)},deleteTrackConf(t){const s=t.trackId;e.tracks=e.tracks.filter(e=>e.trackId!==s)},updateTrackConf(t){const{trackId:s}=t,n=e.tracks.findIndex(e=>e.trackId===s);if(-1!==n){const s=[...e.tracks];s[n]=t,e.tracks=s}},addPlugin(t){e.plugins.push(t),(0,a.getParent)(e).setPluginsUpdated(!0)},removePlugin(t){e.plugins=(0,a.cast)(e.plugins.filter(e=>e.url!==t.url||e.umdUrl!==t.umdUrl||e.cjsUrl!==t.cjsUrl||e.esmUrl!==t.esmUrl)),(0,a.getParent)(e).setPluginsUpdated(!0)},setDefaultSessionConf(t){const s=(0,a.getParent)(e).session.name===t.name?(0,a.getSnapshot)(t):(0,ae.toJS)(t);if(!s.name)throw new Error(`unable to set default session to ${s.name}`);e.defaultSession=(0,a.cast)(s)},addInternetAccountConf(t){const{type:s}=t;if(!s)throw new Error(`unknown internetAccount type ${s}`);const n=e.internetAccounts.push(t);return e.internetAccounts[n-1]},deleteInternetAccountConf(t){const s=e.internetAccounts.find(e=>e.id===t.id);return e.internetAccounts.remove(s)}}))}({pluginManager:e,assemblyConfigSchema:t,adminMode:s}),{postProcessor:e=>(0,ue.K$)(structuredClone(e),"baseUri")})}({adminMode:n,pluginManager:e,assemblyConfigSchema:o}),i=t({pluginManager:e,assemblyConfigSchema:o});return a.types.compose(function({pluginManager:e,jbrowseModelType:t,sessionModelType:s,assemblyConfigSchema:n}){return a.types.model("BaseRootModel",{jbrowse:t,session:a.types.maybe(s),sessionPath:a.types.optional(a.types.string,""),assemblyManager:a.types.optional((o=n,r=e,a.types.model({assemblies:a.types.array(Qe(o,r))}).views(e=>({get assemblyNameMap(){const t={};for(const s of e.assemblies)for(const e of s.allAliases)t[e]=s;return t}})).views(e=>({getCanonicalAssemblyName:t=>e.assemblyNameMap[t]?.name,getCanonicalAssemblyName2:t=>e.assemblyNameMap[t]?.name||t,get(t){if(t){const s=e.assemblyNameMap[t];if(s)return s;this.assemblyNamesList.includes(t)||r.evaluateExtensionPoint("Core-handleUnrecognizedAssembly",void 0,{assemblyName:t,session:(0,a.getParent)(e).session})}},get assemblyNamesList(){return this.assemblyList.map(e=>e.name)},get assemblyList(){const{jbrowse:{assemblies:t},session:{sessionAssemblies:s=[],temporaryAssemblies:n=[]}={}}=(0,a.getParent)(e);return[...t,...s,...n]},get rpcManager(){return(0,a.getParent)(e).rpcManager}})).views(e=>({async waitForAssembly(t){if(!t)throw new Error("no assembly name supplied to waitForAssembly");let s=e.get(t);if(!s)try{await(0,ae.when)(()=>Boolean(e.get(t)),{timeout:1e4}),s=e.get(t)}catch(e){}if(s){if(await s.load(),await(0,ae.when)(()=>!(!s.regions||!s.refNameAliases)||!!s.error),s.error)throw s.error;return s}},async getRefNameMapForAdapter(e,t,s){if(t){const n=await this.waitForAssembly(t);return n?.getRefNameMapForAdapter(e,s)}return{}},async getReverseRefNameMapForAdapter(e,t,s){if(t){const n=await this.waitForAssembly(t);return n?.getReverseRefNameMapForAdapter(e,s)}return{}},isValidRefName(t,s){const n=e.get(s);if(n)return n.isValidRefName(t);throw new Error(`Failed to look up refName:${t} on assemblyName:${s} (assembly does not exist)`)}})).actions(e=>({afterAttach(){(0,a.addDisposer)(e,(0,ae.reaction)(()=>e.assemblyList,t=>{for(const t of e.assemblies)t.configuration||this.removeAssembly(t);for(const s of t){const t=(0,S.QZ)(s,"name");e.assemblies.some(e=>e.name===t)||this.addAssembly(s)}},{fireImmediately:!0,name:"assemblyManagerAfterAttach"}))},removeAssembly(t){e.assemblies.remove(t)},addAssembly(t){e.assemblies.push({configuration:t})}}))),{})}).volatile(t=>({rpcManager:new He(e,t.jbrowse.configuration.rpc,{MainThreadRpcDriver:{}}),adminMode:!1,error:void 0,textSearchManager:new Me.A(e),pluginManager:e})).actions(e=>({setError(t){e.error=t},setSession(t){e.session=(0,a.cast)(t)},setDefaultSession(){this.setSession(e.jbrowse.defaultSession)},setSessionPath(t){e.sessionPath=t},renameCurrentSession(t){e.session&&this.setSession({...(0,a.getSnapshot)(e.session),name:t})}}));var o,r}({pluginManager:e,jbrowseModelType:r,sessionModelType:i,assemblyConfigSchema:o}),function(e){return a.types.model({internetAccounts:a.types.array(e.pluggableMstType("internet account","stateModel"))}).actions(t=>({initializeInternetAccount(s,n={}){if(!e.getInternetAccountType(s.type))throw new Error(`unknown internet account type ${s.type}`);const o=t.internetAccounts.push({...n,type:s.type,configuration:s});return t.internetAccounts[o-1]},createEphemeralInternetAccount(s,n,o){let r;try{r=new URL(o).origin}catch(e){}const i=s.split("-"),a={type:i[0],internetAccountId:s,name:i.slice(1).join("-"),description:"",domains:r?[r]:[]},c=e.getInternetAccountType(a.type).stateModel.create({...n,type:a.type,configuration:a});return t.internetAccounts.push(c),c},findAppropriateInternetAccount(e){const s=e.internetAccountId;if(s){const e=t.internetAccounts.find(e=>e.internetAccountId===s);if(e)return e}for(const s of t.internetAccounts)if(s.handlesLocation(e))return s;return s?this.createEphemeralInternetAccount(s,{},e.uri):null}})).actions(e=>({afterCreate(){(0,a.addDisposer)(e,(0,ae.autorun)(function(){const{jbrowse:t}=e;for(const s of t.internetAccounts)e.initializeInternetAccount(s)},{name:"InternetAccounts"}))}}))}(e),a.types.model({history:a.types.optional(be,{targetPath:"../session"})}).actions(e=>{const t=t=>{e.history.canRedo&&((t.ctrlKey||t.metaKey)&&t.shiftKey&&"KeyZ"===t.code||t.ctrlKey&&!t.shiftKey&&"KeyY"===t.code)&&"INPUT"!==document.activeElement?.tagName.toUpperCase()&&e.history.redo(),e.history.canUndo&&(t.ctrlKey||t.metaKey)&&!t.shiftKey&&"KeyZ"===t.code&&"INPUT"!==document.activeElement?.tagName.toUpperCase()&&e.history.undo()};return{afterCreate(){document.addEventListener("keydown",t),(0,a.addDisposer)(e,(0,ae.autorun)(function(){const{session:t}=e;t&&e.history.initialize()},{name:"HistoryInit"}))},beforeDestroy(){document.removeEventListener("keydown",t)}}}),a.types.model({}).volatile(()=>({mutableMenuActions:[]})).actions(e=>({setMenus(t){e.mutableMenuActions=[...e.mutableMenuActions,{type:"setMenus",newMenus:t}]},appendMenu(t){e.mutableMenuActions=[...e.mutableMenuActions,{type:"appendMenu",menuName:t}]},insertMenu(t,s){e.mutableMenuActions=[...e.mutableMenuActions,{type:"insertMenu",menuName:t,position:s}]},appendToMenu(t,s){e.mutableMenuActions=[...e.mutableMenuActions,{type:"appendToMenu",menuName:t,menuItem:s}]},insertInMenu(t,s,n){e.mutableMenuActions.push({type:"insertInMenu",menuName:t,menuItem:s,position:n})},appendToSubMenu(t,s){e.mutableMenuActions=[...e.mutableMenuActions,{type:"appendToSubMenu",menuPath:t,menuItem:s}]},insertInSubMenu(t,s,n){e.mutableMenuActions=[...e.mutableMenuActions,{type:"insertInSubMenu",menuPath:t,menuItem:s,position:n}]}}))).props({configPath:a.types.maybe(a.types.string)}).volatile(t=>({adminMode:n,sessionDB:void 0,version:"4.1.13",pluginsUpdated:!1,rpcManager:new He(e,t.jbrowse.configuration.rpc,{WebWorkerRpcDriver:{makeWorkerInstance:ft},MainThreadRpcDriver:{}}),savedSessionMetadata:void 0,textSearchManager:new Me.A(e),error:void 0,reloadPluginManagerCallback:(e,t)=>{console.error("reloadPluginManagerCallback unimplemented")}})).actions(e=>({setSavedSessionMetadata(t){e.savedSessionMetadata=t},async fetchSessionMetadata(){if(e.sessionDB){const t=await e.sessionDB.getAll("metadata");this.setSavedSessionMetadata(t.filter(t=>t.configPath===(e.configPath||"")).sort((e,t)=>+t.createdAt-+e.createdAt))}},setSessionDB(t){e.sessionDB=t}})).actions(e=>({afterCreate(){(async()=>{if("undefined"!=typeof indexedDB)try{const t=await(0,ie.P2)("sessionsDB",2,{upgrade(e){e.createObjectStore("metadata"),e.createObjectStore("sessions")}});e.setSessionDB(t),(0,a.addDisposer)(e,(0,ae.autorun)(async()=>{if(e.session)try{const s=e.session;if(e.sessionDB){if(await t.put("sessions",(0,a.getSnapshot)(s),s.id),!(0,a.isAlive)(e))return;const n=await e.sessionDB.get("metadata",s.id);await t.put("metadata",{...n,favorite:n?.favorite||!1,name:s.name,id:s.id,createdAt:new Date,configPath:e.configPath||""},s.id)}await e.fetchSessionMetadata()}catch(t){console.error(t),e.session?.notifyError(`${t}`,t)}},{delay:400}))}catch(t){console.error(t),e.session?.notifyError(`${t}`,t)}let t=!1;(0,a.addDisposer)(e,(0,ae.autorun)(()=>{if(e.session){const s=e.session,n=(0,a.getSnapshot)(s);try{sessionStorage.setItem("current",JSON.stringify({session:n,createdAt:new Date})),t&&(t=!1,s.notify("Auto-saving restored","info")),e.pluginsUpdated&&e.reloadPluginManagerCallback(structuredClone((0,a.getSnapshot)(e.jbrowse)),structuredClone(n))}catch(e){console.error(e);const n=`${e}`;t||(t=!0,n.includes("quota")?s.notifyError("Unable to auto-save session, exceeded sessionStorage quota. This may be because a very large feature was stored in session",e):s.notifyError(n,e))}}},{delay:400}))})()},setSession(t){const s=e.session;if(e.session=(0,a.cast)(t),e.session)try{(0,ue.pK)(e.session,(0,a.getType)(e.session))}catch(t){throw e.session=s,t}},setPluginsUpdated(t){e.pluginsUpdated=t},setReloadPluginManagerCallback(t){e.reloadPluginManagerCallback=t},setDefaultSession(){const{defaultSession:t}=e.jbrowse;this.setSession({...t,name:`${t.name||"New session"} ${(new Date).toLocaleString()}`})},async activateSession(t){const s=await(e.sessionDB?.get("sessions",t));s?this.setSession(s):e.session?.notifyError("Session not found")},async favoriteSavedSession(t){if(e.sessionDB){const s=e.savedSessionMetadata.find(e=>e.id===t);s&&(await e.sessionDB.put("metadata",{...s,favorite:!0},s.id),await e.fetchSessionMetadata())}},async unfavoriteSavedSession(t){if(e.sessionDB){const s=e.savedSessionMetadata.find(e=>e.id===t);s&&await e.sessionDB.put("metadata",{...s,favorite:!1},s.id),await e.fetchSessionMetadata()}},async deleteSavedSession(t){e.sessionDB&&(await e.sessionDB.delete("metadata",t),await e.sessionDB.delete("sessions",t),await e.fetchSessionMetadata())},renameCurrentSession(t){this.setSession({...(0,a.getSnapshot)(e.session),name:t})},setError(t){e.error=t}})).views(e=>({menus(){const t=(0,S.QZ)(e.jbrowse,"preConfiguredSessions");return function(e,t){for(const s of t)"setMenus"===s.type?e=s.newMenus:"appendMenu"===s.type?Se({menus:e,...s}):"insertMenu"===s.type?ve({menus:e,...s}):"insertInSubMenu"===s.type?Te({menus:e,...s}):"appendToSubMenu"===s.type?Ae({menus:e,...s}):"appendToMenu"===s.type?ke({menus:e,...s}):"insertInMenu"===s.type&&Ce({menus:e,...s});return e}([{label:"File",menuItems:()=>{const n=e.savedSessionMetadata?.filter(e=>e.favorite).slice(0,5),o=e.savedSessionMetadata?.filter(e=>!e.favorite).slice(0,5);return[{label:"New session",icon:Xe.A,onClick:()=>{e.setDefaultSession()}},{label:"Import session...",icon:nt.A,onClick:()=>{const t=e.session?.addWidget("ImportSessionWidget","importSessionWidget");t&&e.session?.showWidget(t)}},{label:"Export session",icon:st.A,onClick:async()=>{if(e.session){const{saveAs:t}=await s.e(1611).then(s.bind(s,91611));t(new Blob([JSON.stringify({session:(0,a.getSnapshot)(e.session)},null,2)],{type:"text/plain;charset=utf-8"}),"session.json",{autoBom:!1})}}},{label:"Duplicate session",icon:et.A,onClick:()=>{if(e.session){const{id:t,...s}=(0,a.getSnapshot)(e.session);e.setSession(s)}}},...t?.length?[{label:"Pre-configured sessions...",subMenu:t.map(t=>({label:t.name,onClick:()=>{e.setSession(t)}}))}]:[],...n?.length?[{label:"Favorite sessions...",subMenu:[...n.slice(0,5).map(t=>({label:`${t.name} (${t.id===e.session?.id?"current":(0,dt.m)(t.createdAt,{addSuffix:!0})})`,disabled:t.id===e.session?.id,icon:at.A,onClick:()=>{(async()=>{try{await e.activateSession(t.id)}catch(t){e.session?.notifyError(`${t}`,t)}})()}})),{label:"More...",icon:tt.A,onClick:()=>{const t=e.session?.addWidget("SessionManager","sessionManager");t&&e.session?.showWidget(t)}}]}]:[],{label:"Recent sessions...",type:"subMenu",subMenu:o?.length?[...o.map(t=>({label:`${t.name} (${t.id===e.session?.id?"current":(0,dt.m)(t.createdAt,{addSuffix:!0})})`,disabled:t.id===e.session?.id,onClick:()=>{(async()=>{try{await e.activateSession(t.id)}catch(t){e.session?.notifyError(`${t}`,t)}})()}})),{label:"More...",icon:tt.A,onClick:()=>{const t=e.session?.addWidget("SessionManager","sessionManager");t&&e.session?.showWidget(t)}}]:[{label:"No autosaves found",onClick:()=>{}}]},{type:"divider"},{label:"Open track...",icon:ct.A,onClick:()=>{if(e.session)if(0===e.session.views.length)e.session.notify("Please open a view to add a track first");else{const t=e.session.addWidget("AddTrackWidget","addTrackWidget",{view:e.session.views[0].id});e.session.showWidget(t),e.session.views.length>1&&e.session.notify("This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right")}}},{label:"Open connection...",icon:Be.A8,onClick:()=>{const t=e.session?.addWidget("AddConnectionWidget","addConnectionWidget");t&&e.session?.showWidget(t)}}]}},...n?[{label:"Admin",menuItems:[{label:"Set default session",onClick:()=>{e.session?.queueDialog(t=>[pt,{rootModel:e,onClose:t}])}}]}]:[],{label:"Add",menuItems:[]},{label:"Tools",menuItems:[{label:"Undo",icon:lt.A,onClick:()=>{e.history.canUndo&&e.history.undo()}},{label:"Redo",icon:ot.A,onClick:()=>{e.history.canRedo&&e.history.redo()}},{type:"divider"},{label:"Plugin store",icon:Ye.A,onClick:()=>{e.session&&e.session.showWidget(e.session.addWidget("PluginStoreWidget","pluginStoreWidget"))}},{label:"Assembly manager",icon:Be.uB,onClick:()=>{e.session?.queueDialog(t=>[Oe.m,{onClose:t,session:e.session,rootModel:e}])}},{label:"Preferences",icon:rt.A,onClick:()=>{e.session&&e.session.queueDialog(t=>[mt,{session:e.session,handleClose:t}])}},{label:"Use workspaces",icon:it.A,type:"checkbox",checked:e.session?.useWorkspaces??!1,helpText:"Workspaces allow you to organize views into tabs and tiles. There are a variety of unique features, for instance, you can drag views between tabs or split them side-by-side. Try clicking and dragging the tab header to create a new split",onClick:()=>{e.session?.setUseWorkspaces(!e.session.useWorkspaces)}}]}],e.mutableMenuActions)}}))}var ht=s(3560);const yt=(0,o.lazy)(()=>Promise.all([s.e(9490),s.e(7985)]).then(s.bind(s,7985)));var wt=s(16640);function bt(e){return a.types.model("ReferenceManagementSessionMixin",{}).views(e=>({getReferring(t){const s=[],n=t.trackId;return(0,a.walk)((0,a.getParent)(e),e=>{if((0,a.isModelType)((0,a.getType)(e))){const o=(0,a.getMembers)(e);for(const[r,i]of Object.entries(o.properties))if((0,a.isReferenceType)(i)){const o=e[r],i=o?.trackId;(o===t||n&&i&&i===n)&&s.push({node:e,key:r})}}}),s}})).actions(e=>({removeReferring(t,s,n,o){for(const{node:r}of t){let t=!1;try{const e="open track(s)",i=(0,ge.getContainingView)(r);n.push(()=>{i.hideTrack(s.trackId)}),t=!0,o[e]||(o[e]=0),o[e]+=1}catch(e){}if((0,wt.lO)(e)&&e.widgets.has(r.id)){const s="configuration editor widget(s)";(0,wt.lO)(e)&&n.push(()=>{e.hideWidget(r)}),t=!0,o[s]||(o[s]=0),o[s]+=1}if(!t)throw new Error(`Error when closing this connection, the following node is still referring to a track configuration: ${JSON.stringify((0,a.getSnapshot)(r))}`)}}}))}var St=s(27878),vt=s(56993),kt=s(78770),Ct=s(38811);var At=s(34230),Tt=s(25053),Mt=s(56593);const Nt=(0,o.lazy)(()=>Promise.all([s.e(5754),s.e(7993),s.e(7529),s.e(8705),s.e(5043),s.e(6569),s.e(8187)]).then(s.bind(s,88187)));function Pt({pluginManager:e,assemblyConfigSchema:t}){const s=a.types.compose("WebCoreSessionModel",a.types.compose("WebCoreSessionModelGroupA",bt(),(0,St.X)(e),a.types.model("DialogQueueSessionMixin",{}).volatile(()=>({queueOfDialogs:[]})).views(e=>({get DialogComponent(){return e.queueOfDialogs[0]?.[0]},get DialogProps(){return e.queueOfDialogs[0]?.[1]}})).actions(e=>({removeActiveDialog(){e.queueOfDialogs=e.queueOfDialogs.slice(1)},queueDialog(t){const[s,n]=t(()=>{this.removeActiveDialog()});e.queueOfDialogs=[...e.queueOfDialogs,[s,n]]}})),a.types.model({}).volatile(()=>({sessionThemeName:(0,ge.localStorageGetItem)("themeName")||"default"})).views(e=>({allThemes(){const t=e,s=(0,S.FI)(t.jbrowse,"extraThemes");return{...vt.defaultThemes,...s}},get themeName(){const{sessionThemeName:t}=e;return this.allThemes()[t]?t:"default"},get theme(){const t=e,s=(0,S.FI)(t.jbrowse,"theme"),n=this.allThemes();return(0,vt.createJBrowseTheme)(s,n,this.themeName)}})).actions(e=>({setThemeName(t){e.sessionThemeName=t},afterAttach(){(0,a.addDisposer)(e,(0,ae.autorun)(function(){(0,ge.localStorageSetItem)("themeName",e.themeName)},{name:"ThemeName"}))}})),(0,kt.S)(e)),a.types.compose("WebCoreSessionModelGroupB",function(e){return function(e){return a.types.compose("TracksManagerSessionMixin",(0,Ct.DH)(e),bt()).views(e=>({get tracks(){return e.jbrowse.tracks},get assemblies(){return e.jbrowse.assemblies},getTracksById(){const t="temporaryAssemblies"in e?e.temporaryAssemblies:[],s="connectionInstances"in e?e.connectionInstances:[];return Object.fromEntries([...this.tracks.map(e=>[e.trackId,e]),...this.assemblies.map(e=>[e.sequence.trackId,e.sequence]),...t.map(e=>[e.sequence.trackId,e.sequence]),...s.flatMap(e=>e.tracks.map(e=>[e.trackId,e]))])}})).actions(e=>({addTrackConf:t=>e.jbrowse.addTrackConf(t),deleteTrackConf(t){const s=[],n=e.getReferring(t);e.removeReferring(n,t,s,{});for(const e of s)e();if(e.adminMode)return e.jbrowse.deleteTrackConf(t)}}))}(e).named("SessionTracksManagerSessionMixin").props({sessionTracks:a.types.array(e.pluggableConfigSchemaType("track"))}).views(e=>({get tracks(){return[...e.sessionTracks,...e.jbrowse.tracks]}})).actions(e=>{const{addTrackConf:t,deleteTrackConf:s}=e;return{addTrackConf(s){if(e.adminMode)return t(s);const{trackId:n,type:o}=s;if(!o)throw new Error(`unknown track type ${o}`);const r=e.sessionTracks.find(e=>e.trackId===n);if(r)return r;const i=e.sessionTracks.push(s);return e.sessionTracks[i-1]},deleteTrackConf(t){const n=s(t);if(n)return n;const{trackId:o}=t,r=e.sessionTracks.findIndex(e=>e.trackId===o);return-1!==r?e.sessionTracks.splice(r,1):void 0}}}).postProcessSnapshot(e=>{if(!e)return e;const{sessionTracks:t,...s}=e;return{...s,...t?.length?{sessionTracks:t}:{}}})}(e),(n=t,a.types.model({sessionAssemblies:a.types.array(n)}).actions(e=>{const t=e;return{addSessionAssembly(e){const s=t.sessionAssemblies.find(t=>t.name===e.name);if(s)return console.warn(`Assembly ${e.name} already exists`),s;const n=t.sessionAssemblies.push(e);return t.sessionAssemblies[n-1]},addAssembly(e){t.adminMode?t.jbrowse.addAssemblyConf(e):this.addSessionAssembly(e)},removeAssembly(e){t.adminMode?t.jbrowse.removeAssemblyConf(e):this.removeSessionAssembly(e)},removeSessionAssembly(e){const s=t.sessionAssemblies.find(t=>t.name===e);s&&t.sessionAssemblies.remove(s)}}}).postProcessSnapshot(e=>{if(!e)return e;const{sessionAssemblies:t,...s}=e;return{...s,...t.length?{sessionAssemblies:t}:{}}})),function(e,t=a.types.frozen()){return a.types.model({temporaryAssemblies:a.types.array(t)}).actions(e=>{const t=e;return{addTemporaryAssembly(e){const s=t.temporaryAssemblies.find(t=>t.name===e.name);if(s)return console.warn(`Assembly ${e.name} was already existing`),s;const n=t.temporaryAssemblies.push(e);return t.temporaryAssemblies[n-1]},removeTemporaryAssembly(e){const s=t.temporaryAssemblies.find(t=>t.name===e);s&&t.temporaryAssemblies.remove(s)}}}).postProcessSnapshot(e=>{if(!e)return e;const{temporaryAssemblies:t,...s}=e;return{...s,...t.length?{temporaryAssemblies:t}:{}}})}(0,t),function(e){return a.types.compose("SessionConnectionsManagement",(0,Mt.F)(e),a.types.model({sessionConnections:a.types.array(e.pluggableConfigSchemaType("connection"))})).actions(e=>{const t=e,s=t.deleteConnection,n=t.addConnectionConf;return{addConnectionConf(e){if(t.adminMode)return n(e);{const{connectionId:s,type:n}=e;if(!n)throw new Error(`unknown connection type "${n}"`);const o=t.sessionConnections.find(e=>e.connectionId===s);if(o)return o;{const s=t.sessionConnections.push(e);return t.sessionConnections[s-1]}}},deleteConnection(e){if(t.adminMode)return s(e);{const{connectionId:s}=e,n=t.sessionConnections.findIndex(e=>e.connectionId===s);return-1===n?void 0:t.sessionConnections.splice(n,1)}}}}).postProcessSnapshot(e=>{if(!e)return e;const{sessionConnections:t,...s}=e;return{...s,...t.length?{sessionConnections:t}:{}}})}(e),(0,ht.u)(),a.types.model({focusedViewId:a.types.maybe(a.types.string)}).actions(e=>({setFocusedViewId(t){e.focusedViewId=t}})),a.types.model({}).volatile(()=>({snackbarMessages:ae.observable.array()})).views(e=>({get snackbarMessageSet(){return new Map(e.snackbarMessages.map(e=>[e.message,e]))}})).actions(e=>({notify(e,t,s){const n=s?Array.isArray(s)?s:[s]:void 0;this.pushSnackbarMessage(e,t,n),"info"!==t&&"success"!==t||setTimeout(()=>{this.removeSnackbarMessage(e)},5e3)},notifyError(t,s,n,o){const r={name:"report",onClick:()=>{e.queueDialog(e=>[yt,{onClose:e,error:s,extra:n}])}},i=o?[r,o]:[r];this.pushSnackbarMessage(t,"error",i)},pushSnackbarMessage(t,s,n){!n?.length&&e.snackbarMessageSet.has(t)||e.snackbarMessages.push({message:t,level:s,actions:n})},popSnackbarMessage:()=>e.snackbarMessages.pop(),removeSnackbarMessage(t){const s=e.snackbarMessageSet.get(t);void 0!==s&&e.snackbarMessages.remove(s)}})))).props({margin:0,sessionPlugins:a.types.array(a.types.frozen())}).volatile(()=>({sessionThemeName:(0,ge.localStorageGetItem)("themeName")||"default",task:void 0})).views(e=>({get tracks(){return[...e.sessionTracks,...e.jbrowse.tracks]},get root(){return(0,a.getParent)(e)},get assemblies(){return[...e.jbrowse.assemblies,...e.sessionAssemblies]},get connections(){return[...e.jbrowse.connections,...e.sessionConnections]}})).actions(e=>({setName(t){e.name=t}})).views(e=>({get assemblyNames(){return e.assemblies.map(e=>(0,S.QZ)(e,"name"))},get version(){return e.root.version},get shareURL(){return(0,S.FI)(e.jbrowse,"shareURL")},get textSearchManager(){return e.root.textSearchManager},get assemblyManager(){return e.root.assemblyManager},get savedSessionMetadata(){return e.root.savedSessionMetadata},get previousAutosaveId(){return e.root.previousAutosaveId},get history(){return e.root.history},renderProps:()=>({theme:e.theme,highResolutionScaling:(0,S.FI)(e,"highResolutionScaling")})})).actions(e=>({addAssemblyConf(t){e.jbrowse.addAssemblyConf(t)},addSessionPlugin(t){if(e.sessionPlugins.some(e=>e.name===t.name))throw new Error("session plugin cannot be installed twice");e.sessionPlugins.push(t),e.root.setPluginsUpdated(!0)},removeSessionPlugin(t){const s=t;e.sessionPlugins=(0,a.cast)(e.sessionPlugins.filter(e=>{const t=e;return t.url!==s.url||t.umdUrl!==s.umdUrl||t.cjsUrl!==s.cjsUrl||t.esmUrl!==s.esmUrl})),(0,a.getParent)(e).setPluginsUpdated(!0)},addSavedSession:t=>e.root.addSavedSession(t),deleteSavedSession:t=>e.root.deleteSavedSession(t),favoriteSavedSession:t=>e.root.favoriteSavedSession(t),unfavoriteSavedSession:t=>e.root.unfavoriteSavedSession(t),renameCurrentSession:t=>e.root.renameCurrentSession(t),duplicateCurrentSession:()=>e.root.duplicateCurrentSession(),activateSession:t=>e.root.activateSession(t),setDefaultSession:()=>e.root.setDefaultSession(),saveSessionToLocalStorage:()=>e.root.saveSessionToLocalStorage(),loadAutosaveSession:()=>e.root.loadAutosaveSession(),setSession:t=>e.root.setSession(t)})).actions(e=>({editTrackConfiguration(t){const{adminMode:s,sessionTracks:n}=e,o=t.trackId,r=n.some(e=>e.trackId===o);if(!s&&!r)throw new Error("Can't edit the configuration of a non-session track");e.editConfiguration(t)}})).views(e=>({getTrackActions(t){const{adminMode:s,sessionTracks:n}=e,o=s||n.find(e=>e.trackId===t.trackId),r="ReferenceSequenceTrack"===t.type;return[{label:"Settings",disabled:!o,icon:rt.A,onClick:()=>{e.editTrackConfiguration(t)}},{label:"Copy track",disabled:r,onClick:()=>{const s=structuredClone((0,a.isStateTreeNode)(t)?(0,a.getSnapshot)(t):t),n=Date.now();if(s.trackId+=`-${n}`,s.displays)for(const e of s.displays)e.displayId+=`-${n}`;e.adminMode||(s.trackId+="-sessionTrack",s.category=void 0),s.name+=" (copy)",e.addTrackConf(s)},icon:et.A},{label:"Delete track",disabled:!o||r,icon:At.A,onClick:()=>{e.deleteTrackConf(t)}}]}})).views(e=>({getTrackListMenuItems:t=>[{label:"About track",onClick:()=>{e.queueDialog(s=>[Nt,{config:t,handleClose:s,session:e}])},icon:Tt.A},...e.getTrackActions(t)],getTrackActionMenuItems:(t,s)=>[{label:"About track",priority:1002,onClick:()=>{e.queueDialog(s=>[Nt,{config:t,handleClose:s,session:e}])},icon:Tt.A},{type:"subMenu",label:"Track actions",priority:1001,subMenu:[...e.getTrackActions(t),...s||[]]},{type:"divider"}],menus:()=>e.root.menus()})).actions(e=>({afterAttach(){(0,a.addDisposer)(e,(0,ae.autorun)(function(){(0,ge.localStorageSetItem)("drawerPosition",e.drawerPosition),(0,ge.localStorageSetItem)("themeName",e.themeName)},{name:"SessionLocalStorage"}))}}));var n;const o=e.evaluateExtensionPoint("Core-extendSession",s);return a.types.snapshotProcessor(o,{preProcessor(e){const{connectionInstances:t,...s}=e||{};return Array.isArray(t)?e:s}})}function It({pluginManager:e,assemblyConfigSchema:t}){return Pt({pluginManager:e,assemblyConfigSchema:t})}function xt(e,t){const s=new me.A([...he.A.map(e=>({plugin:new e,metadata:{isCore:!0}})),...(e.runtimePlugins??[]).map(({plugin:e,definition:t})=>({plugin:new e,definition:t,metadata:{url:t.url}})),...(e.sessionPlugins??[]).map(({plugin:e,definition:t})=>({plugin:new e,definition:t,metadata:{url:t.url}}))]).createPluggableElements(),n=gt({pluginManager:s,sessionModelFactory:It,adminMode:!!e.adminKey});if(e.configSnapshot){const o=n.create({jbrowse:e.configSnapshot,configPath:e.configPath},{pluginManager:s});o.setReloadPluginManagerCallback(t),e.configSnapshot.configuration?.rpc?.defaultDriver||o.jbrowse.configuration.rpc.defaultDriver.set("WebWorkerRpcDriver");let r=()=>{};try{const{sessionError:t,sessionSpec:n,sessionSnapshot:i,hubSpec:a,sessionName:c}=e;if(t)throw t;i?((0,q.restoreFileHandlesFromSnapshot)(i,!1).then(e=>{const t=e.filter(e=>!e.success);if(t.length>0){const e=t.map(e=>e.handleId);console.warn("[createPluginManager] Some file handles could not be restored (need user gesture):",e),(0,q.setPendingFileHandleIds)(e)}}).catch(e=>{console.error("[createPluginManager] Error restoring file handles:",e)}),o.setSession(i)):a?r=()=>async function({hubURL:e,sessionName:t},s){const n=s.rootModel;try{const s=await fetch(e[0]);if(!s.ok)throw new Error(`HTTP ${s.status} fetching ${e[0]}`);const o=await s.text(),r=o.split("\n").find(e=>e.startsWith("shortLabel"))?.replace("shortLabel","").trim();n.setSession({name:t??r??e[0],sessionConnections:e.map(e=>({type:"UCSCTrackHubConnection",connectionId:e,name:e,hubTxtLocation:{uri:e,locationType:"UriLocation"}}))});const{session:i}=n;i.makeConnection(i.sessionConnections[0])}catch(e){console.error(e),n.session?.notifyError(`${e}`,e)}}({...a,sessionName:c},s):n?r=()=>we({...n,sessionName:c},s):(o.setDefaultSession(),c&&o.renameCurrentSession(c))}catch(t){o.setDefaultSession();const s=`${t}`.replace("[@jbrowse/mobx-state-tree] ","").replace(/\(.+/,""),n=s.length>1e3?`${s.slice(0,1e3)}...see more in console`:s,r=n.startsWith("Error:")?n:`Error: ${n}`;o.session?.notifyError(`${r}. If you received this URL from another user, request that they send you a session generated with the "Share" button instead of copying and pasting their URL`,e.sessionError,e.sessionSnapshot),console.error(t)}return function(e,t,s){e&&!(0,S.QZ)(e.jbrowse.configuration,"disableAnalytics")&&(async function(e,t,s){try{const n="https://analytics.jbrowse.org/api/v1",o=e.jbrowse.tracks.filter(e=>((0,S.QZ)(e,"assemblyNames")||[]).length>1).length,r=Object.keys(localStorage).filter(e=>e.includes("localSaved-")).length,{jbrowse:i,session:a,version:c}=e,{tracks:l,assemblies:d,plugins:u}=i,f={ver:c,"plugins-count":u?.length||0,"plugin-names":u?.map(e=>e.name).join(","),"assemblies-count":d.length,"tracks-count":l.length,"session-tracks-count":a?.sessionTracks.length||0,"open-views":a?.views.length||0,"synteny-tracks-count":o,"saved-sessions-count":r,"existing-session-param-type":s?.split("-")[0]||"none","scn-h":window.screen.height,"scn-w":window.screen.width,"win-h":window.innerHeight,"win-w":window.innerWidth,electron:ge.isElectron,loadTime:(Date.now()-t)/1e3,jb2:!0};l.forEach(e=>{const t=`track-types-${e.type}`;f[t]=f[t]+1||1}),a?.sessionTracks.forEach(e=>{const t=`sessionTrack-types-${e.type}`;f[t]=f[t]+1||1});const p=Object.keys(f).map(e=>`${e}=${f[e]}`).join("&");await fetch(`${n}?${p}`)}catch(e){console.error("Failed to write analytics to AWS.",e)}}(e,t,s),async function(e,t){const s={"tracks-count":e.jbrowse.tracks.length,ver:e.version,electron:ge.isElectron,loadTime:Date.now()-t,pluginNames:e.jbrowse.plugins?.map(e=>e.name)||""};let n="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){";n+="(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),",n+="m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)",n+="})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');",n+="ga('create', 'UA-7115575-5', 'auto', 'jbrowseTracker');";const o={};for(const[e,t]of"tracks-count ver electron loadTime pluginNames".split(/\s+/).entries())o[`dimension${e+1}`]=s[t];o.metric1=Math.round(s.loadTime),n+=`ga('jbrowseTracker.send', 'pageview',${JSON.stringify(o)});`;const r=document.createElement("script");r.innerHTML=n,document.getElementsByTagName("head")[0].append(r)}(e,t))}(o,e.initialTimestamp,e.sessionQuery),s.setRootModel(o),s.configure(),r(),s}}var Et=s(85775);const Rt=(0,o.lazy)(()=>s.e(1051).then(s.bind(s,31051))),jt=(0,o.lazy)(()=>s.e(3739).then(s.bind(s,43739))),Dt=["loc","tracks","assembly","password","sessionTracks","hubURL","tracklist","nav","highlight","sessionName"];function Wt(e){const t=(0,n.c)(7),{initialTimestamp:s}=e;let r;t[0]!==s?(r=()=>s??Date.now(),t[0]=s,t[1]=r):r=t[1];const[i]=(0,o.useState)(r);let a;t[2]!==i?(a=()=>{const{config:e,session:t,adminKey:s,password:n,loc:o,assembly:r,tracks:a,sessionTracks:c,tracklist:l,highlight:d,nav:u,hubURL:f,sessionName:p}=(0,Y.BW)(["config","session","adminKey","password","loc","assembly","tracks","sessionTracks","tracklist","highlight","nav","hubURL","sessionName"]);return pe.create({configPath:e,sessionQuery:t,password:n,adminKey:s,loc:o,assembly:r,tracks:a,sessionTracks:c,tracklist:JSON.parse(l||"false"),highlight:d,nav:JSON.parse(u||"true"),hubURL:f?.split(","),sessionName:p,initialTimestamp:i})},t[2]=i,t[3]=a):a=t[3];const[c]=(0,o.useState)(a);let d,u;return t[4]===Symbol.for("react.memo_cache_sentinel")?(d=[],t[4]=d):d=t[4],(0,o.useEffect)(Lt,d),t[5]!==c?(u=(0,l.jsx)(Ut,{loader:c}),t[5]=c,t[6]=u):u=t[6],u}function Lt(){(0,Y.oP)([...Dt])}const Ut=(0,c.observer)(function({loader:e}){const[t,s]=(0,o.useState)(e),n=(0,o.useRef)(void 0),[r,i]=(0,o.useState)(!1),c=(0,o.useCallback)((e,n)=>{const o=pe.create({configPath:t.configPath,sessionQuery:t.sessionQuery,password:t.password,adminKey:t.adminKey,loc:t.loc,assembly:t.assembly,tracks:t.tracks,sessionTracks:t.sessionTracks,tracklist:t.tracklist,highlight:t.highlight,nav:t.nav,hubURL:t.hubURL,sessionName:t.sessionName,initialTimestamp:Date.now(),configSnapshot:e,sessionSnapshot:n});s(o),i(!1)},[t]),{configError:d,ready:u,sessionTriaged:f}=t,[p,m]=(0,o.useState)();(0,o.useEffect)(()=>{const e="undefined"!=typeof jest;if(u)try{n.current?.rootModel&&!e&&(0,a.destroy)(n.current.rootModel),n.current=xt(t,c),i(!0)}catch(e){console.error(e),m(e)}return()=>{if(n.current?.rootModel&&!e){const e=n.current.rootModel.session;e&&(0,a.isAlive)(e)&&t.setSessionSnapshot((0,a.getSnapshot)(e)),(0,a.destroy)(n.current.rootModel)}}},[u,t,c]);const g=d||p;return g?(0,l.jsx)(o.Suspense,{fallback:null,children:(0,l.jsx)(jt,{error:g})}):f?(0,l.jsx)(Rt,{loader:t,sessionTriaged:f}):r&&n.current?(0,l.jsx)(te,{pluginManager:n.current}):(0,l.jsx)(se.A,{})});function $t(e){return(0,l.jsx)(r.A,{...e,resetButtonText:"Reset Session",onFactoryReset:Et.A})}const Ft=function(e){const t=(0,n.c)(2),{initialTimestamp:s}=e;let o;return t[0]!==s?(o=(0,l.jsx)(i.t,{FallbackComponent:$t,children:(0,l.jsx)(Wt,{initialTimestamp:s})}),t[0]=s,t[1]=o):o=t[1],o}},85775(e,t,s){async function n(){window.location=window.location.pathname}s.d(t,{A:()=>n})},95994(e,t,s){s.d(t,{J:()=>i,Z:()=>a});var n=s(15773),o=s(65446);function r(e){try{return JSON.parse(e).message}catch(t){return e}}async function i(e,t,s){const i=await(0,o.eW)(JSON.stringify(e)),a=window.btoa([...window.crypto.getRandomValues(new Uint8Array(10))].map(e=>String.fromCharCode(e)).join("")).replaceAll(/[+/]/g,"").slice(0,5);const c=await(0,n.ff)(i,a),l=new FormData;l.append("session",c),l.append("dateShared",`${Date.now()}`),l.append("referer",s);const d=await fetch(`${t}share`,{method:"POST",mode:"cors",body:l});if(!d.ok){const e=await d.text();throw new Error(r(e))}return{json:await d.json(),encryptedSession:c,password:a}}async function a(e,t,s,o){const i=t.split("share-")[1],a=`${e}?sessionId=${encodeURIComponent(i)}`,c=await fetch(a,{signal:o});if(!c.ok){const e=await c.text();throw new Error(r(e))}const l=await c.json();return(0,n.F6)(l.session,s)}},6430(e,t,s){function n(){return new URLSearchParams(window.location.search)}function o(e){const t=e.toString(),s=t?`${window.location.pathname}?${t}`:window.location.pathname;window.history.replaceState(null,"",s)}function r(e){const t=n(),s={};for(const n of e)s[n]=t.get(n)??void 0;return s}function i(e){const t=n();for(const s of e)t.delete(s);o(t)}function a(e){const t=n();for(const[s,n]of Object.entries(e))void 0===n?t.delete(s):t.set(s,n);o(t)}s.d(t,{BW:()=>r,dR:()=>a,oP:()=>i}),s(55614),s(30128)},65446(e,t,s){s.d(t,{K$:()=>l,LP:()=>o,Vr:()=>c,XE:()=>a,eW:()=>r,pK:()=>i});var n=s(10533);async function o(e){const t=function(e){let t=0;switch(e.length%4){case 3:t=1;break;case 2:t=2;break;case 0:t=0;break;default:throw new Error("base64 not a valid length")}return e+"=".repeat(t)}(e.replaceAll("-","+").replaceAll("_","/")),{toByteArray:n}=await s.e(4531).then(s.t.bind(s,34531,19)),{inflate:o}=await s.e(4484).then(s.bind(s,54484)),r=o(n(t),void 0);return new TextDecoder("utf8").decode(r)}async function r(e){const t=(new TextEncoder).encode(e),{deflate:n}=await s.e(4484).then(s.bind(s,54484)),{fromByteArray:o}=await s.e(4531).then(s.t.bind(s,34531,19)),r=o(n(t,void 0)),i=r.indexOf("=");return i>0?r.slice(0,i).replaceAll("+","-").replaceAll("/","_"):r.replaceAll("+","-").replaceAll("/","_")}function i(e,t){if(void 0!==e)if((0,n.isArrayType)(t)){const t=e,s=(0,n.getChildType)(e);if((0,n.isReferenceType)(s))for(let e=0;e<t.length;)(0,n.isValidReference)(()=>t[e])?e+=1:t.splice(e,1);t.forEach(e=>{i(e,s)})}else if((0,n.isMapType)(t)){const t=e,s=(0,n.getChildType)(t);if((0,n.isReferenceType)(s))for(const e in t.keys())(0,n.isValidReference)(()=>t.get(e))||t.delete(e);t.forEach(e=>{i(e,s)})}else if((0,n.isModelType)(t)){const{properties:t}=(0,n.getPropertyMembers)(e);Object.entries(t).forEach(([t,s])=>{i(e[t],s)})}}function a(e,t){if("object"==typeof e&&null!==e)for(const s of Object.keys(e))"object"==typeof e[s]&&null!==e[s]?a(e[s],t):"uri"===s&&(e.baseUri=e.baseUri??t.href)}function c({configuration:e},t,s){return e?.[t]||s}function l(e,t){for(const s in e)s===t?delete e[s]:"object"==typeof e[s]&&l(e[s],t);return e}}}]);
//# sourceMappingURL=3307.cc98717c.chunk.js.map