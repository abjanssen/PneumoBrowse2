"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2786],{82786(e,t,o){o.d(t,{renderSNPCoverageToCanvas:()=>I});var n=o(11259),s=o(17868),r=o(77251),a=o(83640),i=o(52901),c=o(57141),l=o(16876),f=o(26931),h=o(27535),p=o(47354);const u=4.5,d={C:"G",G:"C",A:"T",T:"A"};function g(e,t,o,n,s){return{type:e,base:e,count:t,total:o,avgLength:s?.avgLength,minLength:s?.minLength,maxLength:s?.maxLength,topSequence:s?.topSequence,start:n}}function b(e,t,o,n,s,r,a,i,c){let l=c;for(const c in t){const{entryDepth:f}=t[c];e.fillStyle=o[c]||"black",e.fillRect(n,s-(f+l)/i*a,r,f/i*a),l+=f}return l}function m({base:e,isSimplex:t,refbase:o,snps:n,ref:s,score0:r}){if("N"===e)return{modifiable:r,detectable:r};const a=d[e],i=(n[e]?.entryDepth||0)+(o===e?s.entryDepth:0)+((n[a]?.entryDepth||0)+(o===a?s.entryDepth:0));return{modifiable:i,detectable:t?(n[e]?.[1]||0)+(n[a]?.[-1]||0)+(o===e?s[1]:0)+(o===a?s[-1]:0):i}}function y(e,t){const o=new c.A(Math.max(t.length,1));if(e.length)for(let t=0;t<e.length;t+=4)o.add(e[t],e[t+1],e[t+2],e[t+3]);else o.add(0,0);return o.finish(),{flatbush:o.data,items:t}}function x(e,t,o,n,s,r,a){const{ctx:i,colorMap:c,toHeight2:l,extraHorizontallyFlippedOffset:f,coords:h,items:p,bpPerPx:d,indicatorThreshold:b,showInterbaseCounts:m,showInterbaseIndicators:y}=e;let x=0,I=0,T="",v=0;const S=o-.6+f;for(const e in t.noncov){const{entryDepth:o}=t.noncov[e];x+=o,o>I&&(I=o,T=e)}const N=n>0&&x>.1*n,P=m&&(!r||N);if(P)for(const e in t.noncov){const{entryDepth:o}=t.noncov[e],n=l(o);i.fillStyle=c[e],i.fillRect(S,u+v,1.2,n),v+=n}if(x>0){const e=t.noncov[T];if(P&&(d<50||N)){const t=Math.max(1.2,2);h.push(S,u,S+t,u+v),p.push(g(T,x,n,a,e))}if(y&&(!r||N)){const t=Math.max(n,s);if(x>t*b&&t>7){i.fillStyle=c[T],i.beginPath();const n=o+f;i.moveTo(n-3.5,0),i.lineTo(n+3.5,0),i.lineTo(n,u),i.fill();const s=1;h.push(n-3.5-s,0,n+3.5+s,u+s),p.push(g(T,x,t,a,e))}}}}async function I(e){const{features:t,regions:o,bpPerPx:c,adapterConfig:u}=e,d=o[0],g=(d.end-d.start)/c,I=e.height,T=u.adapterId??"unknown",v=[],S=[];for(const e of t.values())"skip"===e.get("type")?v.push({uniqueId:e.id(),type:"skip",refName:d.refName,start:e.get("start"),end:e.get("end"),strand:e.get("strand"),score:e.get("score"),effectiveStrand:e.get("effectiveStrand")}):S.push(e);const{reducedFeatures:N,coords:P,items:C,...k}=await(0,a.u)(g,I,e,t=>function(e,t,o){const{regions:a,bpPerPx:c,colorBy:l,displayCrossHatches:f,visibleModifications:u={},simplexModifications:d=[],scaleOpts:g,height:y,theme:I,config:T,ticks:v,stopToken:S}=t,N=(0,s.createJBrowseTheme)(I),P=a[0],C=(P.end-P.start)/c,k=h.YSCALEBAR_LABEL_OFFSET,w=y-2*k,M={...g,range:[0,w]},A=(0,h.getScale)(M),F=(0,h.getScale)({...M,range:[0,w/2],scaleType:"linear"}),_=(0,h.getOrigin)(g.scaleType),E=(0,n.QZ)(T,"indicatorThreshold"),D=(0,n.QZ)(T,"showInterbaseCounts"),L=(0,n.QZ)(T,"showInterbaseIndicators"),H=e=>w-(A(e)||0)+k,Y=e=>H(_)-H(e),{bases:G,softclip:R,hardclip:O,insertion:Q}=N.palette,q={A:G.A.main,C:G.C.main,G:G.G.main,T:G.T.main,insertion:Q,softclip:R,hardclip:O,total:(0,n.QZ)(T,"color"),mod_NONE:"blue",cpg_meth:"red",cpg_unmeth:"blue"},B=[];let V=Number.NEGATIVE_INFINITY;const Z=[],j=[];e.fillStyle=q.total;const $=(0,i.jL)(S);for(let t=0,n=o.length;t<n;t++){(0,i.As)($);const n=o[t],[s,a]=(0,r.featureSpanPx)(n,P,c),l=a-s+.6,f=n.get("score");e.fillRect(s,H(f),l,Y(f)),s>V+1&&(B.push({start:n.get("start"),end:n.get("end"),score:f,snpinfo:n.get("snpinfo"),refName:P.refName}),V=s)}const z=P.reversed?1/c:0,U={ctx:e,coverageFeatures:o,region:P,bpPerPx:c,colorMap:q,toY:H,toHeight:Y,toHeight2:e=>F(e)||0,lastCheck:$,extraHorizontallyFlippedOffset:z,coords:Z,items:j,indicatorThreshold:E,showInterbaseCounts:D,showInterbaseIndicators:L};if("modifications"===l.type){const e=l.modifications?.isolatedModification;!function(e,t,o,n){const{ctx:s,coverageFeatures:a,region:c,bpPerPx:l,toY:f,toHeight:h,lastCheck:u}=e;let d=Number.NEGATIVE_INFINITY,g=0;for(let b=0,y=a.length;b<y;b++){(0,i.As)(u);const y=a[b],[I,T]=(0,r.featureSpanPx)(y,c,l),v=y.get("snpinfo"),S=Math.max(T-I,1),N=y.get("score"),P=Math.round(I),C=P===d;let k=0;const w=v.refbase?.toUpperCase(),{nonmods:M,mods:A,snps:F,ref:_}=v,E=h(N),D=f(N)+E;for(const e in M){const r=t[e.slice(7)];if(!r||o&&r.type!==o)continue;const{modifiable:a,detectable:i}=m({base:r.base,isSimplex:n.has(r.type),refbase:w,snps:F,ref:_,score0:N}),{entryDepth:c,avgProbability:l=0}=M[e],f=a/N*(c/i)*E;C?0:(s.fillStyle=(0,p.yr)("blue",l),s.fillRect(P,D-(k+f),S,f),d=P),k+=f}for(const e in A){const r=t[e.slice(4)];if(!r||o&&r.type!==o)continue;const{modifiable:a,detectable:i}=m({base:r.base,isSimplex:n.has(r.type),refbase:w,snps:F,ref:_,score0:N}),{entryDepth:c,avgProbability:l=0}=A[e],f=a/N*(c/i)*E;C?0:(s.fillStyle=(0,p.yr)(r.color||"black",l),s.fillRect(P,D-(k+f),S,f),d=P),k+=f}x(e,v,I,N,g,C,y.get("start")),g=N}}(U,u,e,new Set(d))}else"methylation"===l.type?function(e){const{ctx:t,coverageFeatures:o,region:n,bpPerPx:s,colorMap:a,toY:c,toHeight:l,lastCheck:f}=e;let h=Number.NEGATIVE_INFINITY,p=0;for(let u=0,d=o.length;u<d;u++){(0,i.As)(f);const d=o[u],[g,m]=(0,r.featureSpanPx)(d,n,s),y=d.get("snpinfo"),I=Math.max(m-g,1),T=d.get("score"),v=Math.round(g),S=v===h;if(!S){const{depth:e,nonmods:o,mods:n}=y,s=l(T),r=c(T)+s,i=b(t,n,a,v,r,I,s,e,0);b(t,o,a,v,r,I,s,e,i),h=v}x(e,y,g,T,p,S,d.get("start")),p=T}}(U):function(e){const{ctx:t,coverageFeatures:o,region:n,bpPerPx:s,colorMap:a,toY:c,toHeight:l,lastCheck:f,coords:h,items:p}=e;let u=Number.NEGATIVE_INFINITY,d=-1,g=0;for(let b=0,m=o.length;b<m;b++){(0,i.As)(f);const m=o[b],[y,I]=(0,r.featureSpanPx)(m,n,s),T=m.get("snpinfo"),v=Math.max(I-y,1),S=m.get("score"),N=Math.round(y),P=N===u,{depth:C,snps:k,refbase:w}=T,M=w?.toUpperCase(),A=l(S),F=c(S)+A;let _=0;for(const e in k){const o=k[e],{entryDepth:n}=o,s=F-(n+_)/C*A,r=n/C*A,i=n/S>=.04;P&&!i||P&&n===d?0:(t.fillStyle=a[e]||"black",t.fillRect(N,s,v,r),u=N,d=n),i&&(h.push(N,s,N+v,s+r),p.push({type:"snp",base:e,count:n,total:S,refbase:M,avgQual:o.avgProbability,fwdCount:o[1]||0,revCount:o[-1]||0,bin:T,start:m.get("start"),end:m.get("end")})),_+=n}x(e,T,y,S,g,P,m.get("start")),g=S}}(U);return f&&function(e,t,o,n){e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)";for(const s of t.values)e.beginPath(),e.moveTo(0,Math.round(n(s))),e.lineTo(o,Math.round(n(s))),e.stroke()}(e,v,C,H),{reducedFeatures:B,coords:Z,items:j}}(t,e,S)),w={...k,features:N.map((e,t)=>({...e,uniqueId:`${T}-${e.start}-${t}`})),skipFeatures:v,clickMap:y(P,C),height:I,width:g};return(0,l.lk)(w,(0,f.X)(k))}}}]);
//# sourceMappingURL=2786.981895b5.chunk.js.map