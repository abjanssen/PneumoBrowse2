"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3047],{30385:(t,e,a)=>{a.d(e,{C4:()=>d,OX:()=>f,Ww:()=>h,xx:()=>s});var i=a(99546),n=a(79610);const s=16581375;function r(t){return`rgb(${Math.floor(t/65025)%255},${Math.floor(t/255)%255},${t%255})`}const o={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},l=3,c=1600;function f(t,e,a,i){return Math.floor((255*t*255+255*e+a-1)/i)}function h(t,e,a){const f=(0,i.getContainingView)(t),h=f.drawCurves,d=f.drawCIGAR,g=f.drawCIGARMatchesOnly,{level:u,height:m,featPositions:w}=t,x=f.width,p=f.views.map((t=>t.bpPerPx));a&&(a.imageSmoothingEnabled=!1),e.beginPath();const v=f.views.map((t=>t.offsetPx)),b=Math.floor(s/w.length);e.fillStyle=o.M,e.strokeStyle=o.M;for(const{p11:t,p12:a,p21:i,p22:n}of w){const s=t.offsetPx-v[u],r=a.offsetPx-v[u],o=i.offsetPx-v[u+1],f=n.offsetPx-v[u+1],d=Math.abs(r-s),g=Math.abs(f-o),w=0,p=m,b=(p-w)/2;d<=l&&g<=l&&o<x+c&&o>-c&&(e.moveTo(s,w),h?e.bezierCurveTo(s,b,o,b,o,p):e.lineTo(o,p))}e.stroke(),e.fillStyle=o.M,e.strokeStyle=o.M;for(const{p11:t,p12:b,p21:M,p22:y,f:k,cigar:C}of w){const w=t.offsetPx-v[u],S=b.offsetPx-v[u],P=M.offsetPx-v[u+1],T=y.offsetPx-v[u+1],$=Math.abs(S-w),j=Math.abs(T-P),L=Math.min(P,T),I=Math.max(P,T),z=0,R=m,W=(R-z)/2;if(!($<=l&&j<=l)&&(0,i.doesIntersect2)(L,I,-c,f.width+c)){const t=k.get("strand"),i=-1===t?S:w,l=i<(-1===t?w:S)?1:-1,c=(P<T?1:-1)*t;let f=i,m=-1===t?T:P;if(C.length&&d){let t=!1,i=0,d=0;const w=Math.floor(s/C.length);for(let s=0;s<C.length;s+=2){const v=s*w+1,b=+C[s],M=C[s+1];t||(i=f,d=m);const y=b/p[u],k=b/p[u+1];if("M"===M||"="===M||"X"===M?(f+=y*l,m+=k*c):"D"===M||"N"===M?f+=y*l:"I"===M&&(m+=k*c),!(Math.max(i,d,f,m)<0||Math.min(i,d,f,m)>x)){const l=s<C.length-2;if(Math.abs(f-i)<=1&&Math.abs(m-d)<=1&&l)t=!0;else{const s=t&&y>1||k>1?M:"M";e.fillStyle=o[s],t=!1,g?"M"===s&&((0,n.$2)(e,i,f,z,m,d,R,W,h),e.fill()):((0,n.$2)(e,i,f,z,m,d,R,W,h),e.fill()),a&&(a.fillStyle=r(v),(0,n.$2)(a,i,f,z,m,d,R,W,h),a.fill())}}}}else(0,n.$2)(e,w,S,z,T,P,R,W,h),e.fill()}}const M=t.clickMapCanvas?.getContext("2d");if(M){M.imageSmoothingEnabled=!1,M.clearRect(0,0,x,m);for(let t=0;t<w.length;t++){const e=w[t],a=t*b+1;M.fillStyle=r(a),(0,n.mr)({cb:t=>{t.fill()},feature:e,ctx:M,drawCurves:h,level:u,offsets:v,oobLimit:c,viewWidth:f.width,hideTiny:!0,height:m})}}}function d(t){const{level:e,clickId:a,mouseoverId:s}=t,r=(0,i.getContainingView)(t),o=r.drawCurves,l=t.height,f=r.width,h=t.mouseoverCanvas?.getContext("2d"),d=r.views.map((t=>t.offsetPx));if(!h)return;h.resetTransform(),h.scale(1,1),h.clearRect(0,0,f,l),h.strokeStyle="rgba(0, 0, 0, 0.9)",h.fillStyle="rgba(0, 0, 0, 0.1)";const g=t.featMap[s||""];g&&(0,n.mr)({cb:t=>{t.fill()},feature:g,level:e,ctx:h,oobLimit:c,viewWidth:r.width,drawCurves:o,offsets:d,height:l});const u=t.featMap[a||""];u&&(0,n.mr)({cb:t=>{t.stroke()},feature:u,ctx:h,level:e,oobLimit:c,viewWidth:r.width,drawCurves:o,offsets:d,height:l})}},79610:(t,e,a)=>{a.d(e,{$2:()=>r,Eg:()=>c,WT:()=>o,f0:()=>l,mr:()=>s});var i=a(99546),n=a(30385);function s({feature:t,ctx:e,offsets:a,level:n,cb:s,height:o,drawCurves:l,oobLimit:c,viewWidth:f,hideTiny:h}){const{p11:d,p12:g,p21:u,p22:m}=t,w=d.offsetPx-a[n],x=g.offsetPx-a[n],p=u.offsetPx-a[n+1],v=m.offsetPx-a[n+1],b=Math.abs(x-w),M=Math.abs(v-p),y=o,k=(y-0)/2,C=Math.min(p,v),S=Math.max(p,v);(0,i.doesIntersect2)(C,S,-c,f+c)&&(b<=1&&M<=1?h||(e.beginPath(),e.moveTo(w,0),l?e.bezierCurveTo(w,k,p,k,p,y):e.lineTo(p,y),e.stroke()):(r(e,w,x,0,v,p,y,k,l),s(e)))}function r(t,e,a,i,n,s,r,o,l){l?function(t,e,a,i,n,s,r,o){const l=Math.abs(e-a),c=Math.abs(e-a);if(l<5&&c<5&&a<e&&Math.abs(e-n)>100){const t=e;e=a,a=t}t.beginPath(),t.moveTo(e,i),t.lineTo(a,i),t.bezierCurveTo(a,o,n,o,n,r),t.lineTo(s,r),t.bezierCurveTo(s,o,e,o,e,i),t.closePath()}(t,e,a,i,n,s,r,o):function(t,e,a,i,n,s,r){t.beginPath(),t.moveTo(e,i),t.lineTo(a,i),t.lineTo(n,r),t.lineTo(s,r),t.closePath()}(t,e,a,i,n,s,r)}function o(t,e){const a=(0,i.getContainingView)(e),s=(0,i.getContainingTrack)(e),{featPositions:r,numFeats:o,clickMapCanvas:l,cigarClickMapCanvas:c,level:f}=e;if(!l||!c)return;const h=l.getBoundingClientRect(),d=l.getContext("2d"),g=c.getContext("2d");if(!d||!g)return;const u=t.clientX-h.left,m=t.clientY-h.top,[w,x,p]=d.getImageData(u,m,1,1).data,v=Math.floor(n.xx/o),b=r[(0,n.OX)(w,x,p,v)];if(b){const{f:t}=b;e.setClickId(t.id());const n=(0,i.getSession)(e);(0,i.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:a,track:s,featureData:t.toJSON(),level:f}))}return b}function l(t,e,a){t.preventDefault();const i=e.clickMapCanvas,s=e.cigarClickMapCanvas;if(!i||!s)return;const r=i.getBoundingClientRect(),o=i.getContext("2d"),l=s.getContext("2d");if(!o||!l)return;const{clientX:c,clientY:f}=t,h=c-r.left,d=f-r.top,[g,u,m]=o.getImageData(h,d,1,1).data,w=Math.floor(n.xx/e.numFeats),x=(0,n.OX)(g,u,m,w),p=e.featPositions[x];p&&(e.setClickId(p.f.id()),a({clientX:c,clientY:f,feature:p}))}function c({feature:t,cigarOp:e,cigarOpLen:a}){const n=t.toJSON(),s=n.mate,r=n.end-n.start,o=s.end-s.start,l=n.identity,c=n.name,f=s.name;return[`Loc1: ${(0,i.assembleLocString)(n)}`,`Loc2: ${(0,i.assembleLocString)(s)}`,`Inverted: ${-1===n.strand}`,`Query len: ${r.toLocaleString("en-US")}`,`Target len: ${o.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",e?`CIGAR operator: ${e}${a}`:"",c?`Name 1: ${c}`:"",f?`Name 2: ${f}`:""].filter((t=>!!t)).join("<br/>")}},93047:(t,e,a)=>{a.d(e,{renderToSvg:()=>u});var i=a(67112),n=a(99546),s=a(91468),r=a(97486),o=a(91063),l=a(42489),c=a(51414),f=a(69500);function h({width:t,height:e,shift:a}){const i=(0,c.A)();return(0,f.jsx)("rect",{width:t+2*a,height:e,fill:(0,n.stripAlpha)(i.palette.background.default)})}function d({trackLabelOffset:t,fontSize:e,textHeight:a,trackLabels:i,view:s,displayResults:o,rulerHeight:l,shift:h}){const d=(0,c.A)();return(0,f.jsxs)("g",{transform:`translate(${h} ${e})`,children:[(0,f.jsxs)("g",{transform:`translate(${t})`,children:[(0,f.jsx)("text",{x:0,fontSize:e,...(0,n.getFillProps)(d.palette.text.primary),children:s.assemblyNames.join(", ")}),(0,f.jsx)(r.$m,{model:o.view,fontSize:e})]}),(0,f.jsx)("g",{transform:`translate(0 ${l+e})`,children:(0,f.jsx)(r.zh,{textHeight:a,trackLabels:i,fontSize:e,model:o.view,displayResults:o.data,trackLabelOffset:t})})]})}var g=a(30385);async function u(t,e){await(0,l.when)((()=>t.initialized));const{textHeight:a=18,rulerHeight:c=30,fontSize:u=13,trackLabels:m="offset",Wrapper:w=({children:t})=>t,themeName:x="default"}=e,p=(0,n.getSession)(t),v=p.allThemes?.()[x],{width:b,views:M,levels:y}=t,k=c,C=M.map((t=>(0,r.mJ)(t.tracks,a,m)+k)),S=(0,n.sum)(C)+(0,n.sum)(y.map((t=>t.height)))+100,P=await Promise.all(M.map((async t=>({view:t,data:await Promise.all(t.tracks.map((async t=>{const a=t.displays[0];return await(0,l.when)((()=>void 0===a.ready||a.ready)),{track:t,result:await a.renderSvg({...e,theme:v})}})))})))),T=await Promise.all(y.map((async t=>await Promise.all(t.tracks.map((async a=>{const i=a.displays[0];await(0,l.when)((()=>void 0===i.ready||i.ready));const s=await(0,n.renderToAbstractCanvas)(b,t.height,{exportSVG:e},(t=>{(0,g.Ww)(i,t)}));if("imageData"in s)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in s?{html:await(0,n.getSerializedSvg)({...s,width:b,height:t.height})}:s})))))),$=(0,n.max)(M.flatMap((t=>t.tracks.map((t=>(0,n.measureText)((0,s.getTrackName)(t.configuration,p),u))))),0)+40,j="left"===m?$:0,L=b+j,I=(0,i.createJBrowseTheme)(v),z=[(0,f.jsx)(d,{rulerHeight:c,trackLabelOffset:j,shift:50,textHeight:a,trackLabels:m,displayResults:P[0],view:M[0],fontSize:u},M[0].id)];let R=C[0]+u+c;for(let t=1;t<M.length;t++){const e=M[t],i=y[t-1],s=T[t-1],r=C[t],o=i.height||0;z.push((0,f.jsxs)("g",{transform:`translate(0 ${R})`,children:[o?(0,f.jsx)("defs",{children:(0,f.jsx)("clipPath",{id:`synclip-${t}`,children:(0,f.jsx)("rect",{x:0,y:0,width:b,height:o})})}):null,(0,f.jsx)("g",{transform:`translate(${50+j} ${u})`,clipPath:`url(#synclip-${t})`,children:s?.map(((t,e)=>(0,f.jsx)(n.ReactRendering,{rendering:t},e)))}),(0,f.jsx)("g",{transform:`translate(0 ${o})`,children:(0,f.jsx)(d,{rulerHeight:c,shift:50,trackLabelOffset:j,textHeight:a,trackLabels:m,displayResults:P[t],view:e,fontSize:u},e.id)})]},e.id)),R+=r+u+c+o}return(0,n.renderToStaticMarkup)((0,f.jsx)(o.A,{theme:I,children:(0,f.jsx)(w,{children:(0,f.jsxs)("svg",{width:b,height:S,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,L+100,S].toString(),children:[(0,f.jsx)(h,{width:L,height:S,shift:50}),z]})})}))}}}]);
//# sourceMappingURL=3047.3c1a2d6a.chunk.js.map