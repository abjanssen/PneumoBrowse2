"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2254],{32254(e,t,i){function n(e){const t=new Uint8Array(function(e){let t=0;for(const i of e)t+=i.length;return t}(e));let i=0;for(const n of e)t.set(n,i),i+=n.length;return t}i.d(t,{default:()=>f});const s=65536;class r{ixxFile;ixFile;maxResults;decoder=new TextDecoder("utf8");indexCache;ixFileSize;constructor(e,t,i=20){this.ixxFile=e,this.ixFile=t,this.maxResults=i}async getIxFileSize(e){if(void 0!==this.ixFileSize)return this.ixFileSize;try{const t=await this.ixFile.stat(e);return this.ixFileSize=t.size,this.ixFileSize}catch{return}}async search(e,t){let i=[];const r=e.split(" ")[0];if(r){const e=r.toLowerCase(),o=await this.getBuffer(e,t);let{end:a,buffer:c}=o;const{fileSize:l}=o;let h=!1;for(;!h;){const r=this.decoder.decode(c),o=r.slice(0,r.lastIndexOf("\n")).split("\n").filter(Boolean),u=[];for(const t of o){const i=t.split(" ")[0];i.startsWith(e)?u.push(t):i>e&&(h=!0)}const f=u.flatMap(e=>{const[t,...i]=e.split(" ");return i.filter(Boolean).map(e=>[t,e.split(",")[0]])});if(i=i.concat(f),h||i.length>=this.maxResults)break;if(void 0!==l&&a>=l)break;let d=s;void 0!==l&&(d=Math.min(s,l-a));const x=await this.ixFile.read(d,a,t);if(0===x.length)break;c=n([c,x]),a+=x.length}}return function(e,t=JSON.stringify){const i=[],n=new Set;for(const s of e){const e=t(s);n.has(e)||(i.push(s),n.add(e))}return i}(i,e=>e[1]).slice(0,this.maxResults)}async getIndex(e){if(this.indexCache)return this.indexCache;const t=(await this.ixxFile.readFile({encoding:"utf8",...e})).split("\n").filter(Boolean).map(e=>{const t=e.length-10,i=e.slice(0,t),n=e.slice(t);return[i,Number.parseInt(n,16)]});return this.indexCache=t,t}async getBuffer(e,t){let i=0,n=s;const r=await this.getIndex(t);for(const[t,o]of r)t.slice(0,e.length)<e&&(i=o,n=o+s);const o=await this.getIxFileSize(t);return void 0!==o&&(n=Math.min(n,o)),{buffer:await this.ixFile.read(n-i,i,t),end:n,fileSize:o}}}var o=i(80009),a=i(11259),c=i(54523),l=i(33624);function h(e){try{return decodeURIComponent(e)}catch(t){return e}}function u(e,t,i=15){const n=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,n-i)>0?"...":"")+e.slice(Math.max(0,n-i),n+t.length+i).trim()+(n+t.length<e.length?"...":"")}class f extends c.D{constructor(e,t,i){super(e,t,i);const n=(0,a.QZ)(e,"ixFilePath"),s=(0,a.QZ)(e,"ixxFilePath");if(!n)throw new Error("must provide out.ix");if(!s)throw new Error("must provide out.ixx");this.trixJs=new r((0,l.openLocation)(s,i),(0,l.openLocation)(n,i),1500)}async searchIndex(e){const t=e.queryString.toLowerCase(),i=t.split(" "),n=(await this.trixJs.search(t)).filter(([,e])=>i.every(t=>h(e).toLowerCase().includes(t))).map(([e,t])=>{const i=JSON.parse(t.replaceAll("|",",")),[n,s,...r]=i.map(e=>h(e)),a=r.findIndex(e=>!!e),c=r.map(e=>e.toLowerCase()).findIndex(t=>t.includes(e.toLowerCase())),l=r[a],f=r[c],d=-1!==c?u(f,e):void 0,x=u(l,e),w=d&&x.toLowerCase()!==d.toLowerCase()?`${x} (${d})`:x;return new o.A({locString:n,label:l,displayString:w,matchedObject:i.map(e=>decodeURIComponent(e)),trackId:s})});return"exact"===e.searchType?n.filter(t=>t.getLabel().toLowerCase()===e.queryString.toLowerCase()):n}}}}]);
//# sourceMappingURL=2254.30ec867f.chunk.js.map