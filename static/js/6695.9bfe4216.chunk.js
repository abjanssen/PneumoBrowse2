"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6695],{36695(e,t,o){o.d(t,{makeImageData:()=>c});var n=o(23886),s=o(61425),l=o(29458),a=o(24154),f=o(1449),i=o(81164),r=o(44732);async function c(e,t){const{scrollTop:o,minorAlleleFrequencyFilter:c,sources:h,rowHeight:g,height:p,features:u,regions:d,bpPerPx:T,renderingMode:m,stopTokenCheck:w,lengthCutoffFilter:b,referenceDrawingMode:P,statusCallback:C=()=>{}}=t,M=d[0],k=[],x=[],v={},y={},R=new Map,F="draw"===P,H=g,$=Math.max(g,1),A=Math.floor(o/H),S=Math.min(h.length,Math.ceil((o+p)/H)),L=await(0,n.updateStatus)("Calculating stats",C,()=>(0,r.Cg)({stopTokenCheck:w,features:u.values(),minorAlleleFrequencyFilter:c,lengthCutoffFilter:b,genotypesCache:R,splitCache:y})),_={ctx:e,sources:h,region:M,bpPerPx:T,startRow:A,endRow:S,h:H,drawH:$,scrollTop:o,splitCache:y,drawRef:F,genotypesCache:R,stopTokenCheck:w},q={items:x,coords:k};await(0,n.updateStatus)("Drawing variants",C,()=>{"phased"===m?function(e,t,o){const{ctx:s,sources:f,region:r,bpPerPx:c,startRow:h,endRow:g,h:p,drawH:u,scrollTop:d,splitCache:T,drawRef:m,genotypesCache:w,stopTokenCheck:b}=e,{items:P,coords:C}=t;for(const{feature:e}of o){const[t,o]=(0,n.featureSpanPx)(e,r,c),M=e.id(),k=e.get("end")-e.get("start"),x=Math.max(Math.round(o-t),2),v=Math.floor(t);let y=w.get(M);y||(y=e.get("genotypes"),w.set(M,y));const R=e.get("type"),F=e.get("strand"),H=k>5?.75:1;for(let e=h;e<g;e++){const t=e*p-d,o=f[e],{name:n,HP:l,baseName:r}=o,c=y[r??n];if(c)if(c.includes("|")){const e=T[c]??(T[c]=c.split("|"));(0,i.E)(e,s,v,t,x,u,l,void 0,m,H,R,F)&&(P.push({name:n,genotype:c,featureId:M,bpLen:k}),C.push(v,t,v+x,t+u))}else s.fillStyle="black",s.fillRect(v-a.f2,t-a.f2,x+a.f2,u+a.f2)}(0,l.As)(b)}}(_,q,L):function(e,t,o,s){const{ctx:a,sources:i,region:r,bpPerPx:c,startRow:h,endRow:g,h:p,drawH:u,scrollTop:d,splitCache:T,drawRef:m,genotypesCache:w,stopTokenCheck:b}=e,{items:P,coords:C}=t;for(const{mostFrequentAlt:e,feature:t}of o){const[o,M]=(0,n.featureSpanPx)(t,r,c),k=t.id(),x=t.get("end")-t.get("start"),v=Math.max(Math.round(M-o),2),y=Math.floor(o);let R=w.get(k);R||(R=t.get("genotypes"),w.set(k,R));const F=t.get("type"),H=t.get("strand"),$=x>5?.75:1;for(let t=h;t<g;t++){const o=t*p-d,{name:n}=i[t],l=R[n];if(l){const t=(0,f.Bs)(l,e,s,T,m);t&&((0,f.KP)(t,a,y,o,v,u,F,H,$),P.push({name:n,genotype:l,featureId:k,bpLen:x}),C.push(y,o,y+v,o+u))}}(0,l.As)(b)}}(_,q,L,v)});const D=new s.A(Math.max(x.length,1));if(x.length)for(let e=0,t=k.length;e<t;e+=4)D.add(k[e],k[e+1],k[e+2],k[e+3]);else D.add(0,0);D.finish();const E={};for(const{feature:e}of L)E[e.id()]={alt:e.get("ALT"),ref:e.get("REF"),name:e.get("name"),description:e.get("description"),length:e.get("end")-e.get("start")};return{flatbush:D.data,items:x,featureGenotypeMap:E}}},1449(e,t,o){o.d(t,{Bs:()=>l,KP:()=>a});var n=o(53121),s=o(24154);function l(e,t,o,l,a){const f=`${e}:${t}`;let i=o[f];if(void 0===i){let r=0,c=0,h=0,g=0;const p=l[e]??(l[e]=e.split(/[/|]/)),u=p.length;for(let e=0;e<u;e++){const o=p[e];o===t?r++:"0"===o?g++:"."===o?c++:h++}i=function(e,t,o,l,a,f=!0){if(e===a)return f?s.Us:"";if(!(t||o||l))return"";let i;if(t){const e=80-t/a*50;i=(0,n.M)(`hsl(${s.Lp},${s.V4}%,${e}%)`)}if(o){const e=`hsla(0,100%,20%,${o/a})`;i=i?i.mix(e):(0,n.M)(e)}if(l){const e=l/a,t=s.FX.replace(")",`,${e})`).replace("hsl","hsla");i=i?i.mix(t):(0,n.M)(t)}return i?.toHex()||"black"}(g,r,h,c,u,a),o[f]=i}return i}function a(e,t,o,l,a,f,i="",r,c=1){if(t.fillStyle=1!==c?(0,n.M)(e).alpha(c).toHex():e,"inversion"===i)1===r?(t.beginPath(),t.moveTo(o-s.f2,l-s.f2),t.lineTo(o-s.f2,l+f+s.f2),t.lineTo(o+a+s.f2,l+f/2),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(o+a+s.f2,l-s.f2),t.lineTo(o+a+s.f2,l+f+s.f2),t.lineTo(o-s.f2,l+f/2),t.closePath(),t.fill());else if("insertion"===i){const e=3;t.beginPath(),t.moveTo(o-s.f2-e,l-s.f2),t.lineTo(o+a+s.f2+e,l-s.f2),t.lineTo(o+a/2,l+f+s.f2),t.closePath(),t.fill()}else t.fillRect(o-s.f2,l-s.f2,a+s.f2,f+s.f2)}},81164(e,t,o){o.d(t,{E:()=>a});var n=o(92558),s=o(53121),l=o(24154);function a(e,t,o,a,f,i,r,c,h=!0,g=1,p="",u){const d=+e[r],T=d?void 0!==c?`hsl(${+c%255}, 50%, 50%)`||l.lh:n.set1[d-1]||l.lh:h?l.Us:void 0;if(T)if(t.fillStyle=1!==g?(0,s.M)(T).alpha(g).toHex():T,"inversion"===p)1===u?(t.beginPath(),t.moveTo(o-l.f2,a-l.f2),t.lineTo(o-l.f2,a+i+l.f2),t.lineTo(o+f+l.f2,a+i/2),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(o+f+l.f2,a-l.f2),t.lineTo(o+f+l.f2,a+i+l.f2),t.lineTo(o-l.f2,a+i/2),t.closePath(),t.fill());else if("insertion"===p){const e=3;t.beginPath(),t.moveTo(o-l.f2-e,a-l.f2),t.lineTo(o+f+l.f2+e,a-l.f2),t.lineTo(o+f/2,a+i+l.f2),t.closePath(),t.fill()}else t.fillRect(o-l.f2,a-l.f2,f+l.f2,i+l.f2);return T}}}]);
//# sourceMappingURL=6695.9bfe4216.chunk.js.map