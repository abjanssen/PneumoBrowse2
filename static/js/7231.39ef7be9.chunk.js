"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7231],{17231(e,t,a){a.d(t,{default:()=>m});var s=a(48455),n=a(77251),r=a(25978),o=a(33624),i=a(86618),c=a(53155),l=a(27108);class m extends s.L{static capabilities=["getFeatures","getRefNames"];async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async setupPre(e){const{statusCallback:t=()=>{}}=e,a=this.getConf("assemblyNames"),s=this.pluginManager,r=(0,o.openLocation)(this.getConf("bed1Location"),s),i=(0,o.openLocation)(this.getConf("bed2Location"),s),c=(0,o.openLocation)(this.getConf("mcscanSimpleAnchorsLocation"),s),[m,f,u]=await(0,n.updateStatus)("Downloading data",t,()=>Promise.all([r,i,c].map(t=>(0,l.TA)(t,e)))),d=(0,l.fY)(m),p=(0,l.fY)(f);return{assemblyNames:a,feats:u.split(/\n|\r\n|\r/).filter(e=>!!e&&"###"!==e).map((e,t)=>{const[a,s,n,r,o,i]=e.split("\t"),c=d.get(a),l=d.get(s),m=p.get(n),f=p.get(r);if(!(c&&l&&m&&f))throw new Error(`feature not found, ${a} ${s} ${n} ${r} ${c} ${l} ${m} ${f}`);return[c,l,m,f,+o,"-"===i?-1:1,t]})}}async hasDataForRefName(){return!0}getAssemblyNames(){return this.getConf("assemblyNames")}async getRefNames(e={}){const t=e.regions?.[0].assemblyName,{feats:a}=await this.setup(e),s=this.getAssemblyNames().indexOf(t);if(-1!==s){const e=new Set;for(const t of a)0===s?(e.add(t[0].refName),e.add(t[1].refName)):(e.add(t[2].refName),e.add(t[3].refName));return[...e]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(e,t={}){return(0,i.ObservableCreate)(async a=>{const{assemblyNames:s,feats:n}=await this.setup(t),o=s.indexOf(e.assemblyName);if(-1!==o){const t=0===o;for(const o of n){const[n,i,l,m,f,u,d]=o;let p={refName:n.refName,start:Math.min(n.start,i.start),end:Math.max(n.end,i.end)},h={refName:l.refName,start:Math.min(l.start,m.start),end:Math.max(l.end,m.end)};t||([h,p]=[p,h]),p.refName===e.refName&&(0,r.R6)(p.start,p.end,e.start,e.end)&&a.next(new c.A({...p,uniqueId:`${d}`,syntenyId:d,assemblyName:s[+!t],score:f,strand:u,mate:{...h,assemblyName:s[+t]}}))}}a.complete()})}}},27108(e,t,a){a.d(t,{TA:()=>r,fY:()=>n,gJ:()=>c,qm:()=>i,xI:()=>o});var s=a(77251);function n(e){return new Map(e.split(/\n|\r\n|\r/).filter(e=>!!e&&!e.startsWith("#")).map(e=>{const[t,a,s,n,r,o]=e.split("\t");return[n,{refName:t,start:+a,end:+s,score:+r,name:n,strand:"-"===o?-1:1}]}))}async function r(e,t){return(0,s.fetchAndMaybeUnzipText)(e,t)}function o(e){const t=e.split("\t"),a=t.slice(12),s={numMatches:+t[9],blockLen:+t[10],mappingQual:+t[11]};if(a.length)for(const e of a){const t=e.indexOf(":");s[e.slice(0,t)]=e.slice(t+3)}return{tname:t[5],tstart:+t[7],tend:+t[8],qname:t[0],qstart:+t[2],qend:+t[3],strand:"-"===t[4]?-1:1,extra:s}}function i(e){const t=[];for(let a=e.length-2;a>=0;a-=2){t.push(e[a]);const s=e[a+1];"D"===s?t.push("I"):"I"===s?t.push("D"):t.push(s)}return t}function c(e){return e.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}}}]);
//# sourceMappingURL=7231.39ef7be9.chunk.js.map