"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5895],{25895(e,t,n){n.d(t,{default:()=>f});var s=n(37710),r=n(48455),a=n(77251),i=n(33624),l=n(86618),o=n(53155),c=n(46570),h=n(94645);class f extends r.L{calculatedIntervalTreeMap={};async loadDataP(e){const{statusCallback:t=()=>{}}=e||{},n=await(0,a.fetchAndMaybeUnzip)((0,i.openLocation)(this.getConf("gffLocation"),this.pluginManager),e),{header:r,featureMap:l}=function(e,t=()=>{}){const n=[],s={};return(0,h.P)(e,e=>{if(e.startsWith("#"))n.push(e);else{if(e.startsWith(">"))return!1;{const t=e.indexOf("\t"),n=e.slice(0,t);s[n]||(s[n]=""),s[n]+=`${e}\n`}}return!0},t),{header:n.join("\n"),featureMap:s}}(n,t);return{header:r,intervalTreeMap:Object.fromEntries(Object.entries(l).map(([e,t])=>[e,n=>{if(!this.calculatedIntervalTreeMap[e]){n?.("Parsing GFF data");const r=new s.MF,a=(0,c.ES)(t);for(let t=0,n=a.length;t<n;t++){const n=a[t],s=new o.A({data:n,id:`${this.id}-${e}-${t}`});r.insert([n.start,n.end],s)}this.calculatedIntervalTreeMap[e]=r}return this.calculatedIntervalTreeMap[e]}]))}}async loadData(e){return this.gffFeatures||(this.gffFeatures=this.loadDataP(e).catch(e=>{throw this.gffFeatures=void 0,e})),this.gffFeatures}async getRefNames(e={}){const{intervalTreeMap:t}=await this.loadData(e);return Object.keys(t)}async getHeader(e={}){const{header:t}=await this.loadData(e);return t}getFeatures(e,t={}){return(0,l.ObservableCreate)(async n=>{try{const{start:s,end:r,refName:a}=e,{intervalTreeMap:i}=await this.loadData(t);for(const e of i[a]?.(t.statusCallback).search([s,r])||[])n.next(e);n.complete()}catch(e){n.error(e)}},t.stopToken)}}},46570(e,t,n){n.d(t,{w2:()=>h,ES:()=>c});const s={};for(let e=0;e<256;e++){const t=e.toString(16).toUpperCase().padStart(2,"0");s[t]=String.fromCharCode(e),s[t.toLowerCase()]=String.fromCharCode(e)}function r(e){const t=e.indexOf("%");if(-1===t)return e;let n="",r=0,a=t;for(;a<e.length;)if("%"===e[a]&&a+2<e.length){n+=e.slice(r,a);const t=e.slice(a+1,a+3),i=s[t];n+=void 0!==i?i:e.slice(a,a+3),a+=3,r=a}else a++;return n+e.slice(r)}const a=new Set(["start","end","seq_id","score","type","source","phase","strand"]);function i(e){return"+"===e?1:"-"===e?-1:"."===e?0:void 0}function l(e){const t=e.split("\t"),n=t[0],s=t[1],l=t[2],o=t[3],c=t[4],h=t[5],f=t[6],u=t[7],d=t[8],g={refName:0===n.length||"."===n?"":r(n),source:0===s.length||"."===s?null:r(s),type:0===l.length||"."===l?null:r(l),start:0===o.length||"."===o?0:+o-1,end:0===c.length||"."===c?0:+c,score:0===h.length||"."===h?void 0:+h,strand:i(f),phase:0===u.length||"."===u?void 0:+u,subfeatures:[]};return function(e,t){if(0===e.length||"."===e)return;let n=e.length;"\n"===e[n-1]&&(n="\r"===e[n-2]?n-2:n-1,e=e.slice(0,n));let s=0;for(;s<n;){let i=e.indexOf(";",s);if(-1===i&&(i=n),i>s){const n=e.indexOf("=",s);if(-1!==n&&n<i&&n+1<i){const l=e.slice(s,n);if("_lineHash"===l){s=i+1;continue}let o=l.toLowerCase();a.has(o)&&(o+="2");const c=[];let h=n+1;for(;h<i;){let t=e.indexOf(",",h);if((-1===t||t>i)&&(t=i),t>h){const n=e.slice(h,t);c.push(r(n))}h=t+1}t[o]=1===c.length?c[0]:c}}s=i+1}}(d,g),g}function o(e){const t=e.split("\t"),n=t[0],s=t[1],r=t[2],l=t[3],o=t[4],c=t[5],h=t[6],f=t[7],u=t[8],d={refName:0===n.length||"."===n?"":n,source:0===s.length||"."===s?null:s,type:0===r.length||"."===r?null:r,start:0===l.length||"."===l?0:+l-1,end:0===o.length||"."===o?0:+o,score:0===c.length||"."===c?void 0:+c,strand:i(h),phase:0===f.length||"."===f?void 0:+f,subfeatures:[]};return function(e,t){if(0===e.length||"."===e)return;let n=e.length;"\n"===e[n-1]&&(n="\r"===e[n-2]?n-2:n-1,e=e.slice(0,n));let s=0;for(;s<n;){let r=e.indexOf(";",s);if(-1===r&&(r=n),r>s){const n=e.indexOf("=",s);if(-1!==n&&n<r&&n+1<r){const i=e.slice(s,n);if("_lineHash"===i){s=r+1;continue}let l=i.toLowerCase();a.has(l)&&(l+="2");const o=[];let c=n+1;for(;c<r;){let t=e.indexOf(",",c);(-1===t||t>r)&&(t=r),t>c&&o.push(e.slice(c,t)),c=t+1}t[l]=1===o.length?o[0]:o}}s=r+1}}(u,d),d}function c(e){return h(function(e){const t=e.split(/\r?\n/),n=[];for(let e=0;e<t.length;e++){const s=t[e];if(0!==s.length&&"#"!==s[0]){if(">"===s[0])break;n.push({line:s,start:0,end:0,hasEscapes:s.includes("%")})}else if(s.startsWith("##FASTA"))break}return n}(e))}function h(e){const t=[],n=new Map,s=new Map;for(let r=0;r<e.length;r++){const a=e[r],i=a.hasEscapes?l(a.line):o(a.line);void 0!==a.lineHash&&(i._lineHash=String(a.lineHash));const c=i.id,h=i.parent;if(c||h){if(c&&!n.get(c)){h||t.push(i),n.set(c,i);const e=s.get(c);if(e){for(let t=0;t<e.length;t++)i.subfeatures.push(e[t]);s.delete(c)}}if(h){const e=Array.isArray(h)?h:[h];for(let t=0;t<e.length;t++){const r=e[t],a=n.get(r);if(a)a.subfeatures.push(i);else{let e=s.get(r);e||(e=[],s.set(r,e)),e.push(i)}}}}else t.push(i)}return t}},94645(e,t,n){n.d(t,{P:()=>r});var s=n(77251);function r(e,t,n=()=>{}){const r=new TextDecoder("utf8");let a=0,i=0;for(;a<e.length;){const l=e.indexOf(10,a),o=-1===l?e.length:l,c=e.subarray(a,o),h=r.decode(c).trim();if(h&&!1===t(h,i))break;i++%1e4==0&&n(`Loading ${(0,s.getProgressDisplayStr)(a,e.length)}`),a=o+1}}}}]);
//# sourceMappingURL=5895.45775f57.chunk.js.map