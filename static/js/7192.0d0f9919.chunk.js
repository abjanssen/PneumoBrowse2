"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7192],{37192:(e,t,o)=>{o.d(t,{makeImage:()=>d});var n=o(68584),s=o(67112),r=o(99546),i=o(11210),c=o(91476);const a=7,l=4.5,f=7,p={C:"G",G:"C",A:"T",T:"A"},b=.6;function h({base:e,isSimplex:t,refbase:o,snps:n,ref:s,score0:r}){if("N"===e)return{modifiable:r,detectable:r};const i=p[e],c=(n[e]?.entryDepth||0)+(o===e?s.entryDepth:0)+((n[i]?.entryDepth||0)+(o===i?s.entryDepth:0));return{modifiable:c,detectable:t?(n[e]?.[1]||0)+(n[i]?.[-1]||0)+(o===e?s[1]:0)+(o===i?s[-1]:0):c}}async function d(e,t){const{features:o,regions:p,bpPerPx:d,colorBy:y,displayCrossHatches:m,visibleModifications:u={},simplexModifications:k=[],scaleOpts:g,height:v,theme:S,config:T,ticks:C,stopToken:w}=t,O=(0,s.createJBrowseTheme)(S),j=p[0],M=(j.end-j.start)/d,_=i.Oy,D=v-2*_,x={...g,range:[0,D]},P=(0,i.X_)(x),R=(0,i.X_)({...x,range:[0,D/2],scaleType:"linear"}),A=(0,i.$z)(g.scaleType),W=(0,i.$z)("linear"),E=(0,n.readConfObject)(T,"indicatorThreshold"),G=(0,n.readConfObject)(T,"showInterbaseCounts"),I=(0,n.readConfObject)(T,"showArcs"),$=(0,n.readConfObject)(T,"showInterbaseIndicators"),z=e=>D-(P(e)||0)+_,N=e=>z(A)-z(e),B=e=>D-(R(e)||0)+_,X=e=>B(W)-B(e),{bases:H,softclip:J,hardclip:U,insertion:q}=O.palette,F={A:H.A.main,C:H.C.main,G:H.G.main,T:H.T.main,insertion:q,softclip:J,hardclip:U,total:(0,n.readConfObject)(T,"color"),mod_NONE:"blue",cpg_meth:"red",cpg_unmeth:"blue"};e.fillStyle=F.total,(0,r.forEachWithStopTokenCheck)(o.values(),w,t=>{if("skip"===t.get("type"))return;const[o,n]=(0,r.featureSpanPx)(t,j,d),s=n-o+b,i=t.get("score");e.fillRect(o,z(i),s,N(i))});let K=0;const L=j.reversed?1/d:0,Q="modifications"===y.type,V="methylation"===y.type,Y=y.modifications?.isolatedModification,Z=new Set(k);if((0,r.forEachWithStopTokenCheck)(o.values(),w,t=>{if("skip"===t.get("type"))return;const[o,n]=(0,r.featureSpanPx)(t,j,d),s=t.get("snpinfo"),i=Math.max(n-o,1),p=t.get("score");if(Q){let t=0;const n=s.refbase?.toUpperCase(),{nonmods:r,mods:a,snps:l,ref:f}=s,b=Object.keys(r).sort().reverse();for(const r of b){const a=r.replace(/^(nonmod_|mod_)/,""),b=u[a];if(!b){console.warn(`${r} not known yet`);continue}if(Y&&b.type!==Y)continue;const{modifiable:d,detectable:y}=h({base:b.base,isSimplex:Z.has(b.type),refbase:n,snps:l,ref:f,score0:p}),{entryDepth:m,avgProbability:k=0}=s.nonmods[r],g=d/p*(m/y),v="blue",S=(0,c.yr)(v,k),T=N(p),C=z(p)+T;e.fillStyle=S,e.fillRect(Math.round(o),C-(t+g*T),i,g*T),t+=g*T}const d=Object.keys(a).sort().reverse();for(const s of d){const r=s.replace("mod_",""),b=u[r];if(!b){console.warn(`${s} not known yet`);continue}if(Y&&b.type!==Y)continue;const{modifiable:d,detectable:y}=h({base:b.base,isSimplex:Z.has(b.type),refbase:n,snps:l,ref:f,score0:p}),{entryDepth:m,avgProbability:k=0}=a[s],g=d/p*(m/y),v=b.color||"black",S=(0,c.yr)(v,k),T=N(p),C=z(p)+T;e.fillStyle=S,e.fillRect(Math.round(o),C-(t+g*T),i,g*T),t+=g*T}}else if(V){const{depth:t,nonmods:n,mods:r}=s;let c=0;for(const n of Object.keys(r).sort().reverse()){const{entryDepth:s}=r[n],a=N(p),l=z(p)+a;e.fillStyle=F[n]||"black",e.fillRect(Math.round(o),l-(s+c)/t*a,i,s/t*a),c+=s}for(const s of Object.keys(n).sort().reverse()){const{entryDepth:r}=n[s],a=N(p),l=z(p)+a;e.fillStyle=F[s]||"black",e.fillRect(Math.round(o),l-(r+c)/t*a,i,r/t*a),c+=r}}else{const{depth:t,snps:n}=s;let r=0;for(const s of Object.keys(n).sort().reverse()){const{entryDepth:c}=n[s],a=N(p),l=z(p)+a;e.fillStyle=F[s]||"black",e.fillRect(Math.round(o),l-(c+r)/t*a,i,c/t*a),r+=c}}const b=Object.keys(s.noncov);if(G){let t=0;for(const n of b){const{entryDepth:r}=s.noncov[n],i=.6;e.fillStyle=F[n],e.fillRect(o-i+L,l+X(t),2*i,X(r)),t+=r}}if($){let t=0,n=0,r="";for(const e of b){const{entryDepth:o}=s.noncov[e];t+=o,o>n&&(n=o,r=e)}const i=Math.max(p,K);if(t>i*E&&i>f){e.fillStyle=F[r],e.beginPath();const t=o+L;e.moveTo(t-a/2,0),e.lineTo(t+a/2,0),e.lineTo(t,l),e.fill()}}K=p}),I&&(0,r.forEachWithStopTokenCheck)(o.values(),w,t=>{if("skip"!==t.get("type"))return;const o=t.get("start"),n=t.get("end"),[s,i]=(0,r.bpSpanPx)(o,n,j,d);e.beginPath();const c=t.get("effectiveStrand");e.strokeStyle=1===c?"rgba(255,200,200,0.7)":-1===c?"rgba(200,200,255,0.7)":"rgba(200,200,200,0.7)",e.lineWidth=Math.log(t.get("score")+1),e.moveTo(s,D-2*_),e.bezierCurveTo(s,0,i,0,i,D-2*_),e.stroke()}),m){e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)";for(const t of C.values)e.beginPath(),e.moveTo(0,Math.round(z(t))),e.lineTo(M,Math.round(z(t))),e.stroke()}}}}]);
//# sourceMappingURL=7192.0d0f9919.chunk.js.map