"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5980],{50268(t,e,n){function r(t){const e=t?.trim().split(" ");return[0,1,2,3,5,6].every(t=>void 0!==e?.[t]&&!Number.isNaN(+e[t]))}function s(t){if(r(t)){const[e,n,r,s,a,o,i,c,u,d,l,m,f,h,p]=t.trim().split(" ");return{bitsw_score:e,percent_div:n,percent_del:r,percent_ins:s,query_chr:a,query_begin:o,query_end:i,query_remaining:c,orientation:u,matching_repeat_name:d,matching_repeat_class:l,matching_repeat_begin:m,matching_repeat_end:f,matching_repeat_remaining:h,repeat_id:p}}return{description:t}}function a(t){return(3-t)%3}function o({line:t,colRef:e,colStart:n,colEnd:r,scoreColumn:s,parser:a,uniqueId:o,names:c}){const u=t.split("\t");return i({splitLine:u,refName:u[e],start:Number.parseInt(u[n],10),end:Number.parseInt(u[r],10)+(n===r?1:0),parser:a,uniqueId:o,scoreColumn:s,names:c})}function i({splitLine:t,refName:e,start:n,end:o,parser:i,uniqueId:u,scoreColumn:d,names:l}){const m=l?function(t,e){const n={};let r=!1;for(const[s,a]of e.entries()){const e=t[s];e&&(n[e]=a,"blockCount"===e&&(r=!0))}if(r){const{blockStarts:t,blockCount:e,chromStarts:r,thickEnd:s,thickStart:a,blockSizes:o,...i}=n;return{...i,blockStarts:c(t),chromStarts:c(r),blockSizes:c(o),thickStart:a?+a:void 0,thickEnd:s?+s:void 0,blockCount:e?+e:void 0}}return n}(l,t):i.parseLine(t,{uniqueId:u}),{strand:f,score:h,chrom:p,chromStart:b,chromEnd:k,...S}=m,_=d?+m[d]:h?+h:void 0,g=function(t){return"-"===t||-1===t?-1:"+"===t||1===t?1:0}(f),N=S.blockCount?function({start:t,uniqueId:e,refName:n,chromStarts:r,blockCount:s,blockSizes:a,blockStarts:o}){const i=[],c=r??o??[];for(let r=0;r<s;r++){const s=(c[r]??0)+t,o=a?.[r];o&&o>0&&i.push({uniqueId:`${e}-${r}`,start:s,end:s+o,refName:n,type:"block"})}return i}({start:n,uniqueId:u,refName:e,chromStarts:S.chromStarts,blockCount:S.blockCount,blockSizes:S.blockSizes,blockStarts:S.blockStarts}):void 0;if(function({splitLine:t,start:e,end:n}){return+(t[6]||0)===e&&+(t[7]||0)===n&&[9,10,11,12,13,14,15,16,17].every(e=>t[e]&&!Number.isNaN(+t[e]))}({splitLine:t,start:n,end:o}))return function({splitLine:t,uniqueId:e,refName:n,start:r,end:s}){const[,,,a,,o,,,i,c,u,d,l,m,f,h,p,b]=t;return{uniqueId:e,refName:n,start:r,end:s,code:a,score:+u||0,strand:o,color:i,source:a,n_valid_cov:c,fraction_modified:u,n_mod:d,n_canonical:l,n_other_mod:m,n_delete:f,n_fail:h,n_diff:p,n_nocall:b}}({splitLine:t,uniqueId:u,refName:e,start:n,end:o});if(r(S.description)){const{chromStarts:t,blockSizes:r,blockStarts:a,blockCount:i,thickStart:c,thickEnd:d,description:l,...m}=S;return function({uniqueId:t,refName:e,start:n,end:r,description:a,...o}){const{subfeatures:i,...c}=o;return{...c,...s(a),uniqueId:t,refName:e,start:n,end:r}}({...m,description:l,uniqueId:u,score:_,start:n,end:o,strand:g,refName:e,subfeatures:N})}return N&&function({thickStart:t,blockCount:e,strand:n}){return t&&e&&0!==n}({strand:g,blockCount:S.blockCount,thickStart:S.thickStart})?function(t){const{strand:e=0,uniqueId:n,start:r,end:s,...o}=t,{subfeatures:i,thickStart:c,thickEnd:u,refName:d,chrom:l,chromStart:m,chromEnd:f,chromStarts:h,blockStarts:p,blockSizes:b,blockCount:k,...S}=o,_=S.exonFrames??S._exonFrames,g=i.filter(t=>"block"===t.type).sort((t,e)=>t.start-e.start),N=e>0?"five_prime_UTR":"three_prime_UTR",C=e>0?"three_prime_UTR":"five_prime_UTR",{cdsEndStat:q,cdsStartStat:y}=S;if("none"===y&&"none"===q)return{...S,uniqueId:n,strand:e,type:"transcript",refName:d,start:r,end:s,subfeatures:g.map(t=>({...t,type:"exon"}))};let w;if(!_){const t=[];for(const e of g){const{start:n,end:r}=e;c<r&&u>n&&t.push({start:Math.max(n,c),end:Math.min(r,u)})}w=function(t,e){const n=[...t].sort((t,n)=>e>0?t.start-n.start:n.start-t.start),r=new Map;let s=0;for(const t of n){const e=(3-s%3)%3;r.set(t.start,e),s+=t.end-t.start}return r}(t,e)}const I=[];for(const[t,e]of g.entries()){const n=e,{start:r,end:s}=n;if(c>=s)I.push({type:N,start:r,end:s,refName:d});else if(u<=r)I.push({type:C,start:r,end:s,refName:d});else{r<c&&I.push({type:N,start:r,end:c,refName:d});const e=Math.max(r,c),n=Math.min(s,u);let o=0;if(_){const e=_[t];void 0!==e&&e>=0&&(o=a(e))}else w&&(o=w.get(e)??0);I.push({type:"CDS",phase:o,start:e,end:n,refName:d}),s>u&&I.push({type:C,start:u,end:s,refName:d})}}return{...S,uniqueId:n,strand:e,type:"mRNA",refName:d,start:r,end:s,subfeatures:I}}({...S,score:_,start:n,end:o,strand:g,refName:e,uniqueId:u,subfeatures:N,thickStart:S.thickStart,thickEnd:S.thickEnd}):{...S,uniqueId:u,score:_,start:n,end:o,strand:g,refName:e,subfeatures:N}}function c(t){if(void 0!==t)return"string"==typeof t?t.split(",").map(t=>+t):t}n.d(e,{dE:()=>o,np:()=>i})},85980(t,e,n){n.d(e,{default:()=>m});var r=n(49964),s=n(9272),a=n(48455),o=n(77251),i=n(53155),c=n(33624),u=n(86618),d=n(52901),l=n(50268);class m extends a.L{static capabilities=["getFeatures","getRefNames"];constructor(t,e,n){super(t,e,n);const a=this.getConf("bedGzLocation"),o=this.getConf(["index","indexType"]),i=this.getConf(["index","location"]),u=this.getConf("autoSql"),d=this.pluginManager;this.bed=new s.wD({filehandle:(0,c.openLocation)(a,d),csiFilehandle:"CSI"===o?(0,c.openLocation)(i,d):void 0,tbiFilehandle:"CSI"!==o?(0,c.openLocation)(i,d):void 0,chunkCacheSize:52428800}),this.columnNames=this.getConf("columnNames"),this.scoreColumn=this.getConf("scoreColumn"),this.parser=new r.A({autoSql:u})}async getRefNames(t={}){return this.bed.getReferenceSequenceNames(t)}async getHeader(t){return this.bed.getHeader(t)}async getMetadataPre2(t){return this.setupP||(this.setupP=this.getMetadataPre().catch(t=>{throw this.setupP=void 0,t})),this.setupP}async getMetadataPre(){return{meta:await this.bed.getMetadata()}}async getMetadata(t){const{statusCallback:e=()=>{}}=t||{};return(0,o.updateStatus)("Downloading index",e,()=>this.getMetadataPre2(t))}async getNames(){if(this.columnNames.length)return this.columnNames;const t=(await this.getHeader()).split(/\n|\r\n|\r/).filter(t=>!!t).at(-1);return t?.includes("\t")?t.slice(1).split("\t").map(t=>t.trim()):void 0}getFeatures(t,e){const{stopToken:n,statusCallback:r=()=>{}}=e||{};return(0,u.ObservableCreate)(async e=>{const{meta:s}=await this.getMetadata(),{columnNumbers:a}=s,c=a.ref-1,u=a.start-1,m=a.end-1,f=await this.getNames();let h=performance.now();(0,d.SW)(n),await(0,o.updateStatus)("Downloading features",r,()=>this.bed.getLines(t.refName,t.start,t.end,{lineCallback:(t,r)=>{performance.now()-h>500&&((0,d.SW)(n),h=performance.now()),e.next(new i.A((0,l.dE)({line:t,colRef:c,colStart:u,colEnd:m,scoreColumn:this.scoreColumn,parser:this.parser,uniqueId:`${this.id}-${r}`,names:f})))},stopToken:n})),e.complete()},n)}}}}]);
//# sourceMappingURL=5980.1bfeb875.chunk.js.map