"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7258],{198:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var r=n(91063),a=n(36422),o=n(48180),i=n(95742),s=n(25889),l=n(67112),c=n(93100),d=n(99546),u=n(37347),p=n(69500);class h extends i.default{serializeArgsInClient(e){return{...e,config:(0,a.isStateTreeNode)(e.config)?(0,a.getSnapshot)(e.config):e.config,filters:e.filters?.toJSON().filters}}deserializeResultsInClient(e,t){return t.exportSVG?{...e,html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,reactElement:(0,p.jsx)(s.A,{...t,...e,RenderingComponent:this.ReactComponent})}}deserializeArgsInWorker(e){const t={...e};return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=e.filters?new c.A({filters:e.filters}):void 0,t}serializeResultsInWorker(e,t){const n=(0,o.F0)((0,p.jsx)(r.A,{theme:(0,l.createJBrowseTheme)(t.theme),children:e.reactElement}));return e.reactElement=void 0,{...e,html:n}}async renderInClient(e,t){const n=await e.call(t.sessionId,"CoreRender",t);return"canvasRecordedData"in n&&(n.html=await(0,d.getSerializedSvg)(n),n.reactElement=void 0),n}async renderInWorker(e){const{stopToken:t,statusCallback:n=()=>{}}=e,r=this.deserializeArgsInWorker(e),a=await(0,d.updateStatus)("Rendering plot",n,()=>this.render(r));return(0,u.SW)(t),(0,d.updateStatus)("Serializing results",n,()=>this.serializeResultsInWorker(a,r))}async freeResourcesInClient(e,t){const n=this.serializeArgsInClient(t),{sessionId:r}=t;await e.call(r,"CoreFreeResources",n)}}},373:(e,t,n)=>{function r(e,t){return e.map(e=>t.slice(e.start,e.end)).join("")}function a(e){return`${e.start}-${e.end}`}function o(e){return e.filter((e,t,n)=>!t||a(e)!==a(n[t-1]))}function i(e,t){return e.map(e=>({...e,start:t-e.end,end:t-e.start})).sort((e,t)=>e.start-t.start)}function s(e,t){if(!e.length)return[];if(t.length<e.length)return console.warn("exons.length less than cds.length, cant calculate UTR properly",{exons:t,cds:e}),[];const n=e.at(0),r=e.at(-1),a=t.findIndex(e=>e.end>=n.start&&e.start<=n.start),o=t.findIndex(e=>e.end>=r.end&&e.start<=r.end),i=t[o],s=t[a];return[...[...t.slice(0,a),{start:s.start,end:n.start}].map(e=>({...e,type:"five_prime_UTR"})),...[{start:r.end,end:i.end},...t.slice(o+1)].map(e=>({...e,type:"three_prime_UTR"}))]}function l(e,t){if(!e.length)return[];const n=e.at(0),r=e.at(-1);return[...[{start:t.start,end:n.start}].map(e=>({...e,type:"five_prime_UTR"})),...[{start:r.end,end:t.end}].map(e=>({...e,type:"three_prime_UTR"}))]}function c(e){return e.length>20?`${e.slice(0,20)}...`:e}function d(e){return JSON.parse(JSON.stringify(e,(e,t)=>void 0===t?null:t))}function u(e,t,n,r=0,a={}){t<=r||e.subfeatures?.map(e=>{u(e,t,n,r+1,a),n(e)})}n.d(t,{Il:()=>d,SC:()=>o,SX:()=>c,V4:()=>l,YC:()=>i,fq:()=>u,h8:()=>s,o9:()=>r})},679:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(7552),a=n(68584),o=n(58921),i=n(8832),s=n(36422);function l(e){return s.types.model("PluginStoreModel",{id:i.ElementId,type:s.types.literal("PluginStoreWidget"),filterText:"",view:s.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions(e=>({clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}}))}const c=(0,a.ConfigurationSchema)("PluginStoreWidget",{});function d(e){e.addWidgetType(()=>new o.WidgetType({name:"PluginStoreWidget",heading:"Plugin store",configSchema:c,stateModel:l(e),ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(6386),n.e(1557)]).then(n.bind(n,21557)))}))}},1622:(e,t,n)=>{n.r(t),n.d(t,{BaseConnectionModelFactory:()=>i,BaseDisplay:()=>u,BaseInternetAccountConfig:()=>p,BaseViewModel:()=>s.A,InternetAccount:()=>m,baseConnectionConfig:()=>a,createBaseTrackConfig:()=>v,createBaseTrackModel:()=>w});var r=n(68584);const a=(0,r.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"});var o=n(36422);const i=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track")),configuration:(0,r.ConfigurationReference)(a)}).actions(()=>({connect(e){}})).actions(e=>({afterAttach(){0===e.tracks.length&&e.connect(e.configuration)},addTrackConf(t){const n=e.tracks.push(t);return e.tracks[n-1]},addTrackConfs(t){e.tracks.push(...t)},setTrackConfs(t){e.tracks=(0,o.cast)(t)},clear(){}}))};var s=n(7772),l=n(99546),c=n(91468),d=n(8832);const u=o.types.model("BaseDisplay",{id:d.ElementId,type:o.types.string,rpcDriverName:o.types.maybe(o.types.string)}).volatile(()=>({rendererTypeName:"",error:void 0,message:void 0})).views(e=>({get RenderingComponent(){const{pluginManager:t}=(0,l.getEnv)(e);return t.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,r.getConf)(this.parentTrack,"adapter")},get parentTrack(){let t=(0,o.getParent)(e);for(;!t.configuration||!(0,r.getConf)(t,"trackId");){if((0,o.isRoot)(t))throw new Error(`No parent track found for ${e.type} ${e.id}`);t=(0,o.getParent)(t)}return t},renderProps:()=>({...(0,c.getParentRenderProps)(e),notReady:(0,l.getContainingView)(e).minimized,rpcDriverName:e.rpcDriverName,displayModel:e}),get rendererType(){const{pluginManager:t}=(0,l.getEnv)(e);return t.getRendererType(e.rendererTypeName)},get DisplayMessageComponent(){},trackMenuItems:()=>[],get viewMenuActions(){return[]},regionCannotBeRendered:()=>null})).actions(e=>({setMessage(t){e.message=t},setError(t){e.error=t},setRpcDriverName(t){e.rpcDriverName=t},reload(){}})),p=(0,r.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0});var h=n(99834);const g="undefined"==typeof sessionStorage,m=o.types.model("InternetAccount",{id:d.ElementId,type:o.types.string,configuration:(0,r.ConfigurationReference)(p)}).views(e=>({get name(){return(0,r.getConf)(e,"name")},get description(){return(0,r.getConf)(e,"description")},get internetAccountId(){return(0,r.getConf)(e,"internetAccountId")},get authHeader(){return(0,r.getConf)(e,"authHeader")},get tokenType(){return(0,r.getConf)(e,"tokenType")},get domains(){return(0,r.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}})).views(e=>({handlesLocation:t=>e.domains.some(e=>t.uri.includes(e)),get tokenKey(){return`${e.internetAccountId}-token`}})).actions(e=>({getTokenFromUser(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken(t){sessionStorage.setItem(e.tokenKey,t)},removeToken(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:()=>sessionStorage.getItem(e.tokenKey),validateToken:async(e,t)=>e})).actions(e=>{let t;return{async getToken(n){if(t)return t;let r=n?.internetAccountPreAuthorization?.authInfo?.token;if(r)return t=Promise.resolve(r),t;if(g)throw new Error("Did not get internet account pre-authorization info in worker");return r=e.retrieveToken(),r?(t=Promise.resolve(r),t):(t=new Promise((t,n)=>{e.getTokenFromUser(n=>{e.storeToken(n),t(n)},t=>{e.removeToken(),n(t)})}),t)}}}).actions(e=>({addAuthHeaderToInit:(t,n)=>({...t,headers:new Headers({...t?.headers,...n?{[e.authHeader]:e.tokenType?`${e.tokenType} ${n}`:n}:{}})}),async getPreAuthorizationInformation(t){const n=await e.getToken(t);let a;try{a=await e.validateToken(n,t)}catch(t){throw e.removeToken(),t}return{internetAccountType:e.type,authInfo:{token:a,configuration:(0,r.getConf)(e)}}}})).actions(e=>({getFetcher:t=>async(n,r)=>{const a=await e.getToken(t),o=e.addAuthHeaderToInit(r,a);return fetch(n,o)}})).actions(e=>({openLocation:t=>new h.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})}));var f=n(42489),y=n(80703),b=n(92516);function w(e,t,n){return o.types.model(t,{id:d.ElementId,type:o.types.literal(t),configuration:(0,r.ConfigurationReference)(n),minimized:!1,pinned:!1,displays:o.types.array(e.pluggableMstType("display","stateModel"))}).views(t=>({get rpcSessionId(){const e=(0,r.getConf)(t,"adapter");return e?(0,y.L)(e):t.configuration.trackId},get name(){return(0,r.getConf)(t,"name")},get textSearchAdapter(){return(0,r.getConf)(t,"textSearchAdapter")},get adapterConfig(){return(0,r.getConf)(t,"adapter")},get adapterType(){const n=(0,r.getConf)(t,"adapter");if(!n)throw new Error(`no adapter configuration provided for ${t.type}`);const a=e.getAdapterType(n.type);if(!a)throw new Error(`unknown adapter type ${n.type}`);return a},get viewMenuActions(){return t.displays.flatMap(e=>e.viewMenuActions)},get canConfigure(){const e=(0,l.getSession)(t),{sessionTracks:n,adminMode:r}=e;return(0,b.u3)(e)&&(r||n?.find(e=>e.trackId===t.configuration.trackId))}})).actions(t=>({setPinned(e){t.pinned=e},setMinimized(e){t.minimized=e},showDisplay(n,r={}){const a=e.pluggableConfigSchemaType("display"),i=(0,o.resolveIdentifier)(a,(0,o.getRoot)(t),n),s=e.getDisplayType(i.type);if(!s)throw new Error(`unknown display type ${i.type}`);const l=s.stateModel.create({...r,type:i.type,configuration:i});t.displays.push(l)},hideDisplay(n){const r=e.pluggableConfigSchemaType("display"),a=(0,o.resolveIdentifier)(r,(0,o.getRoot)(t),n),i=t.displays.filter(e=>e.configuration===a);return(0,f.transaction)(()=>{for(const e of i)t.displays.remove(e)}),i.length},replaceDisplay(n,r,a={}){const i=t.displays.findIndex(e=>e.configuration.displayId===n);if(-1===i)throw new Error(`could not find display id ${n} to replace`);const s=e.pluggableConfigSchemaType("display"),l=(0,o.resolveIdentifier)(s,(0,o.getRoot)(t),r);if(!e.getDisplayType(l.type))throw new Error(`unknown display type ${l.type}`);t.displays.splice(i,1,{...a,type:l.type,configuration:l})}})).views(t=>({trackMenuItems(){const n=t.displays.flatMap(e=>e.trackMenuItems()),r=t.displays[0].configuration.displayId,a=function(e){const{pluginManager:t}=(0,l.getEnv)(e),n=(0,l.getContainingView)(e),r=t.getViewType(n.type),a=new Set(r.displayTypes.map(e=>e.name));return e.configuration.displays.filter(e=>a.has(e.type))}(t);return[...n,...a.length>1?[{type:"subMenu",label:"Display types",priority:-1e3,subMenu:a.map(n=>({type:"radio",label:e.getDisplayType(n.type).displayName,checked:n.displayId===r,onClick:()=>{t.replaceDisplay(r,n.displayId)}}))}]:[]]}}))}function v(e){return(0,r.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,r.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:o.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,r.ConfigurationSchema)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2"},maxDepth:{type:"number",defaultValue:99999,description:"Maximum depth to render subfeatures"}}),formatAbout:(0,r.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const n=e.evaluateExtensionPoint("Core-preProcessTrackConfig",structuredClone(t)),{displays:r=[]}=n;if("placeholderId"!==n.trackId)try{const t=new Set(r.map(e=>e.type));for(const a of e.getTrackType(n.type).displayTypes)t.has(a.name)||r.push({displayId:`${n.trackId}-${a.name}`,type:a.name})}catch(e){throw new Error(`Unknown track type "${n.type}" in ${JSON.stringify(n)}`,{cause:e})}return{...n,displays:r.map(e=>({...e,displayId:e.displayId??`${n.trackId}-${e.type}`}))}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:n}=t;if(!n)throw new Error(`unknown display type ${n}`);const r=e.displays.find(e=>e?.displayId===t.displayId);if(r)return r;const a=e.displays.push(t);return e.displays[a-1]}})})}},1864:(e,t,n)=>{n.d(t,{z:()=>r.when});var r=n(42489)},2138:(e,t,n)=>{n.d(t,{p:()=>s});var r=n(7552),a=n(68584);async function o({start:e,end:t,refName:n,assemblyName:r,session:o}){const{rpcManager:i,assemblyManager:s}=o,l=await s.waitForAssembly(r);if(!l)throw new Error("assembly not found");const c="getSequence",d=l.getCanonicalRefName(n),u=await i.call(c,"CoreGetFeatures",{adapterConfig:(0,a.getConf)(l,["sequence","adapter"]),sessionId:c,regions:[{start:e,end:t,refName:d,assemblyName:r}]}),[p]=u;return p?.get("seq")||""}const i=2e7;function s({session:e,feature:t,upDownBp:n,forceLoad:a,assemblyName:s,shouldFetch:l=!0}){const[c,d]=(0,r.useState)(),[u,p]=(0,r.useState)(),[h,g]=(0,r.useState)(!1),m=(0,r.useMemo)(()=>e&&l?{start:t.get("start"),end:t.get("end"),refName:t.get("refName"),assemblyName:s,upDownBp:n,forceLoad:a,sessionId:e.id||"default"}:null,[e,t,s,n,a,l]);return(0,r.useEffect)(()=>{if(!m)return d(void 0),void p(void 0);(async()=>{try{g(!0),p(void 0);const{start:t,end:n,refName:r,assemblyName:a,upDownBp:s,forceLoad:l}=m;if(!l&&n-t>i)return void d({error:`Genomic sequence larger than ${i}bp, use "force load" button to display`});const c=t-s,u=n+s,[h,f,y]=await Promise.all([o({start:t,end:n,refName:r,assemblyName:a,session:e}),o({start:Math.max(0,c),end:t,refName:r,assemblyName:a,session:e}),o({start:n,end:u,refName:r,assemblyName:a,session:e})]);d({seq:h,upstream:f,downstream:y})}catch(e){p(e)}finally{g(!1)}})()},[m,e]),{sequence:c,loading:h,error:u}}},2265:(e,t,n)=>{n.d(t,{A:()=>r});class r{subLayouts=new Map;constructor(e,t={}){this.SubLayoutClass=e,this.subLayoutConstructorArgs=t}getDataByID(e){for(const t of this.subLayouts.values()){const n=t.getDataByID(e);if(n)return n}}getSublayout(e){let t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}addRect(e,t,n,r,a,o={}){return this.getSublayout(e).addRect(t,n,r,a,o)}discardRange(e,t,n){return this.subLayouts.get(e)?.discardRange(t,n)}toJSON(){const e={};for(const[t,n]of this.subLayouts.entries())e[t]=n.toJSON();return e}}},2286:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var r=n(67758),a=n(7552),o=n(68584),i=n(67112),s=n(9236),l=n(68446),c=n(69500);const d=(0,a.forwardRef)(function(e,t){const n=(0,r.c)(5),{message:o}=e;let s,l;return n[0]!==o?(s=(0,a.isValidElement)(o)?o:o?(0,c.jsx)(i.SanitizedHTML,{html:String(o)}):null,n[0]=o,n[1]=s):s=n[1],n[2]!==t||n[3]!==s?(l=(0,c.jsx)("div",{ref:t,children:s}),n[2]=t,n[3]=s,n[4]=l):l=n[4],l}),u=(0,l.observer)(function({model:e,clientMouseCoord:t}){const{featureUnderMouse:n,mouseoverExtraInformation:r}=e,a=t[0]+15,i=t[1],l=n?(0,o.getConf)(e,"mouseover",{feature:n,mouseoverExtraInformation:r}):void 0;return n&&l?(0,c.jsx)(s.A,{clientPoint:{x:a,y:i},children:(0,c.jsx)(d,{message:l})}):null})},2406:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(35470);const a=e=>"object"==typeof e&&null!==e,o=e=>a(e)&&!(e instanceof RegExp)&&!(e instanceof Error)&&!(e instanceof Date)&&!(globalThis.Blob&&e instanceof globalThis.Blob);function i(e,t,n=new WeakSet){if(n.has(e))return;n.add(e);const r=e=>{for(const r of e)t(r),a(r)&&i(r,t,n)};Array.isArray(e)&&r(e);for(const a of Object.values(e))t(a),o(a)&&(Array.isArray(a)?r(a):i(a,t,n))}var s=n(91468),l=n(92516);class c extends r.A{constructor(e){super(),this.pluginManager=e}async serializeArguments(e,t){const n=(0,s.getBlobMap)();return await this.augmentLocationObjects(e,t),{...e,blobMap:n}}async serializeNewAuthArguments(e,t){const n=this.pluginManager.rootModel;if(!(0,l.bV)(n)||e.internetAccountPreAuthorization)return e;const r=n.findAppropriateInternetAccount(e);return r&&"MainThreadRpcDriver"!==t&&(e.internetAccountPreAuthorization=await r.getPreAuthorizationInformation(e)),e}async deserializeArguments(e,t){return e.blobMap&&(0,s.setBlobMap)(e.blobMap),e}async serializeReturn(e,t,n){return e}async deserializeReturn(e,t,n){let r;try{r=await e}catch(e){if((0,l.ZL)(e)){const t=this.pluginManager.rootModel?.createEphemeralInternetAccount(`HTTPBasicInternetAccount-${new URL(e.url).origin}`,{},e.url);throw new l.J_("Retrying with created internet account",t.internetAccountId)}throw e}return r}async augmentLocationObjects(e,t){const n=[];i(e,e=>{(0,l.C1)(e)&&n.push(e)});for(const e of n)await this.serializeNewAuthArguments(e,t);return e}}},3496:(e,t,n)=>{n.d(t,{cK:()=>o,pZ:()=>i});var r=n(80703);let a={};async function o(e,t,n){const i=(0,r.L)(n);a[i]??=async function(e,t,n){const r=n?.type;if(!r)throw new Error(`could not determine adapter type from adapter config snapshot ${JSON.stringify(n)}`);const a=e.getAdapterType(r);if(!a)throw new Error(`unknown data adapter type ${r}`);const i=a.configSchema.create(n,{pluginManager:e}),s=o.bind(null,e,t);return{dataAdapter:new(await a.getAdapterClass())(i,s,e),sessionIds:new Set([t])}}(e,t,n);const s=await a[i];return s.sessionIds.add(t),s}async function i(e){const t=Object.keys(e);if(1===t.length&&"sessionId"===t[0]){const{sessionId:t}=e;for(const[e,n]of Object.entries(a)){const r=await n;r.sessionIds.delete(t),0===r.sessionIds.size&&delete a[e]}}else for(const t of Object.values(a)){const n=await t,r=e.regions||(e.region?[e.region]:[]);for(const e of r)void 0!==e.refName&&n.dataAdapter.freeResources(e)}}},3519:(e,t,n)=>{function r(e,t=JSON.stringify){const n=[],r=new Set;for(const a of e){const e=t(a);r.has(e)||(n.push(a),r.add(e))}return n}n.d(t,{Q:()=>r})},6184:(e,t,n)=>{n.d(t,{Kd:()=>o,cm:()=>i});var r=n(8656),a=n(99546);async function o({option:e,model:t,assemblyName:n}){const r=e.getLocation(),a=e.getTrackId();r&&(await t.navToLocString(r,n,.2),a&&t.showTrack(a))}async function i({input:e,model:t,assembly:n}){const i=n.allRefNamesWithLowerCase||[],s=n.name;if(e.split(" ").every(e=>function(e,t){const[n,r]=function(e){const t=e.lastIndexOf(":");if(-1===t)return[e,""];return[e.slice(0,t),e.slice(t+1)]}(e);return t.includes(e)||t.includes(n)&&!Number.isNaN(Number.parseInt(r,10))}(e,i)))await t.navToLocString(e,n.name);else{const i=t.searchScope(s),{textSearchManager:l}=(0,a.getSession)(t),c=await async function({queryString:e,searchType:t,searchScope:n,rankSearchResults:o,textSearchManager:i,assembly:s}){i||console.warn("No text search manager");const l=await(i?.search({queryString:e,searchType:t},n,o)),c=s?.allRefNames?.filter(t=>t.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(e=>new r.A({label:e}));return(0,a.dedupe)([...c||[],...l||[]],e=>e.getId())}({queryString:e,searchType:"exact",searchScope:i,rankSearchResults:t.rankSearchResults,textSearchManager:l,assembly:n});c.length>1?t.setSearchResults(c,e.toLowerCase(),s):1===c.length?await o({option:c[0],model:t,assemblyName:s}):await t.navToLocString(e,s)}}},6434:(e,t,n)=>{function r(e){return"object"==typeof e&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id}function a(e){return"uniqueId"in e&&"object"!=typeof e.data}n.d(t,{A:()=>o,l:()=>r});class o{constructor(e){a(e)?this.data=e:(this.data=e.data,this.parentHandle=e.parent);const t=a(e)?e.uniqueId:e.id;if(null==t)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(t),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error(`invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`);this.data.subfeatures&&(this.subfeatures=this.data.subfeatures?.map((e,n)=>"function"!=typeof e.get?new o({id:e.uniqueId||`${t}-${n}`,data:{strand:this.data.strand,...e},parent:this}):e))}get(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}set(e,t){this.data[e]=t}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={...this.data,uniqueId:this.id()},t=this.parent();t&&(e.parentId=t.id());const n=this.children();return n&&(e.subfeatures=n.map(e=>e.toJSON())),e}static fromJSON(e){return new o({...e})}}},6842:(e,t,n)=>{function r(e,t){return`${(e.startsWith("metadata.")?t.metadata?.[e.replace("metadata.","")]:t[e])||""}`}n.d(t,{a:()=>r})},7772:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(36422),a=n(8832);const o=r.types.model("BaseView",{id:a.ElementId,displayName:r.types.maybe(r.types.string),minimized:!1}).volatile(()=>({width:800})).views(()=>({menuItems:()=>[]})).actions(e=>({setDisplayName(t){e.displayName=t},setWidth(t){e.width=t},setMinimized(t){e.minimized=t}})),i=o;o.props({displayedRegions:r.types.array(a.Region)})},8024:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{constructor(e){super(e),this.description=e.description,this.configSchema=e.configSchema,this.getAdapterClass="getAdapterClass"in e?e.getAdapterClass:async()=>e.AdapterClass}}},8656:(e,t,n)=>{n.d(t,{A:()=>r,S:()=>a});class r{constructor(e){this.label=e.label,this.locString=e.locString,this.renderingComponent=e.renderingComponent,this.displayString=e.displayString,this.matchedAttribute=e.matchedAttribute,this.matchedObject=e.matchedObject,this.textSearchAdapter=e.textSearchAdapter,this.relevance=e.relevance,this.trackId=e.trackId,this.score=e.score||1,this.results=e.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(e){return this.score=e,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}class a extends r{constructor(e){super(e),this.refName=e.refName??""}getLocation(){return this.refName}}},9342:(e,t,n)=>{n.d(t,{Q:()=>a,n:()=>p});var r=n(68584);const a=(0,r.ConfigurationSchema)("BaseFeatureWidget",{});var o=n(42489),i=n(36422),s=n(99546);function l(e,t){(0,s.localStorageSetItem)(e,JSON.stringify(t))}const c="sequenceFeatureDetails";var d=n(373),u=n(8832);function p(e){return i.types.model("BaseFeatureWidget",{id:u.ElementId,type:i.types.literal("BaseFeatureWidget"),featureData:i.types.frozen(),formattedFields:i.types.frozen(),unformattedFeatureData:i.types.frozen(),view:i.types.safeReference(e.pluggableMstType("view","stateModel")),track:i.types.safeReference(e.pluggableMstType("track","stateModel")),trackId:i.types.maybe(i.types.string),trackType:i.types.maybe(i.types.string),maxDepth:i.types.maybe(i.types.number),sequenceFeatureDetails:i.types.optional(i.types.model("SequenceFeatureDetails").volatile(()=>({showCoordinatesSetting:(0,s.localStorageGetItem)(`${c}-showCoordinatesSetting`)||"none",intronBp:(0,s.localStorageGetNumber)(`${c}-intronBp`,10),upDownBp:(0,s.localStorageGetNumber)(`${c}-upDownBp`,100),upperCaseCDS:(0,s.localStorageGetBoolean)(`${c}-upperCaseCDS`,!0),charactersPerRow:100,feature:void 0,mode:""})).actions(e=>({setFeature(t){e.feature=t},setUpDownBp(t){e.upDownBp=t},setIntronBp(t){e.intronBp=t},setUpperCaseCDS(t){e.upperCaseCDS=t},setShowCoordinates(t){e.showCoordinatesSetting=t},setMode(t){e.mode=t}})).views(e=>({get showCoordinates(){return"none"!==e.showCoordinatesSetting},get showGenomicCoordsOption(){return"gene"===e.mode||"gene_updownstream"===e.mode||"genomic"===e.mode||"genomic_sequence_updownstream"===e.mode},get hasCDS(){return e.feature?.subfeatures?.some(e=>"cds"===e.type?.toLowerCase())},get hasExon(){return e.feature?.subfeatures?.some(e=>"exon"===e.type)},get hasExonOrCDS(){return this.hasExon||this.hasCDS}})).actions(e=>({afterAttach(){(0,i.addDisposer)(e,(0,o.autorun)(()=>{var t,n;l(`${c}-upDownBp`,e.upDownBp),l(`${c}-intronBp`,e.intronBp),t=`${c}-upperCaseCDS`,n=e.upperCaseCDS,(0,s.localStorageSetItem)(t,JSON.stringify(n)),(0,s.localStorageSetItem)(`${c}-showCoordinatesSetting`,e.showCoordinatesSetting)})),(0,i.addDisposer)(e,(0,o.autorun)(()=>{e.setMode(e.hasCDS?"cds":e.hasExon?"cdna":"genomic")}))}})),{}),descriptions:i.types.frozen()}).volatile(()=>({error:void 0})).actions(e=>({setFeatureData(t){e.unformattedFeatureData=t},clearFeatureData(){e.featureData=void 0},setFormattedData(t){e.featureData=t},setExtra(t,n,r){e.trackId=n,e.trackType=t,e.maxDepth=r},setError(t){e.error=t}})).actions(e=>({afterCreate(){(0,i.addDisposer)(e,(0,o.autorun)(()=>{try{const{unformattedFeatureData:t,track:n}=e,a=(0,s.getSession)(e);if(n&&e.setExtra(n.type,n.configuration.trackId,(0,r.getConf)(n,["formatDetails","maxDepth"])),t){const o=structuredClone(t),i=(e,t)=>({...(0,r.getConf)(a,["formatDetails",e],{feature:t}),...(0,r.getConf)(n,["formatDetails",e],{feature:t})});n&&(o.__jbrowsefmt=i("feature",o),(0,d.fq)(o,(0,r.getConf)(n,["formatDetails","depth"]),e=>{e.__jbrowsefmt=i("subfeatures",e)})),e.setFormattedData(o)}}catch(t){console.error(t),e.setError(t)}}))}})).preProcessSnapshot(e=>{const{featureData:t,finalizedFeatureData:n,...r}=e;return{unformattedFeatureData:t,featureData:n,...r}}).postProcessSnapshot(e=>{const{unformattedFeatureData:t,featureData:n,...r}=e,a=JSON.stringify(n,(e,t)=>void 0===t?null:t);return{finalizedFeatureData:!a||a.length>2e6?void 0:JSON.parse(a),...r}})}},9669:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(99546),a=n(68446),o=n(7552),i=n(51414),s=n(67758),l=n(62266),c=n(69500);const d=e=>{const t=(0,s.c)(11),{x:n,y:a,width:o,height:d,color:u}=e,p=(0,i.A)();let h,g,m;return t[0]!==u||t[1]!==p?(h=u||(0,l.X4)(p.palette.background.paper,.3),t[0]=u,t[1]=p,t[2]=h):h=t[2],t[3]!==h?(g=(0,r.getFillProps)(h),t[3]=h,t[4]=g):g=t[4],t[5]!==d||t[6]!==g||t[7]!==o||t[8]!==n||t[9]!==a?(m=(0,c.jsx)("rect",{pointerEvents:"auto",x:n,y:a,width:o,height:d,...g}),t[5]=d,t[6]=g,t[7]=o,t[8]=n,t[9]=a,t[10]=m):m=t[10],m},u=(0,a.observer)(function({model:e,labelWidth:t}){const{canDisplayLabels:n,rowHeight:a,sources:s}=e,l=(0,r.clamp)(a,8,12),u=s?.some(e=>e.color),p=t+(u?20:0),h=(0,i.A)();return s?(0,c.jsxs)(c.Fragment,{children:[n?(0,c.jsx)(d,{y:0,x:0,width:p,height:(s.length+.25)*a}):null,s.map((e,t)=>{const{color:i,name:s,label:u}=e;return(0,c.jsxs)(o.Fragment,{children:[i?(0,c.jsx)(d,{y:t*a,x:0,width:15.5,height:a+.5,color:i}):null,n?(0,c.jsx)("text",{y:t*a+l,x:i?17:0,fontSize:l,...(0,r.getFillProps)(h.palette.text.primary),children:u||s}):null]},`${u}-${t}`)})]}):null}),p=(0,a.observer)(function({children:e,model:t,exportSVG:n}){const{id:a,scrollTop:o,height:i}=t,s=`legend-${a}`;return n?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("defs",{children:(0,c.jsx)("clipPath",{id:s,children:(0,c.jsx)("rect",{x:0,y:0,width:1e3,height:i})})}),(0,c.jsx)("g",{clipPath:`url(#${s})`,children:(0,c.jsx)("g",{transform:`translate(0,${-o})`,children:e})})]}):(0,c.jsx)("svg",{style:{position:"absolute",top:0,left:0,zIndex:100,pointerEvents:"none",height:t.totalHeight,width:(0,r.getContainingView)(t).width},children:e})}),h=(0,a.observer)(function(e){const{model:t}=e,{canDisplayLabels:n,rowHeight:a,sources:o}=t,i=(0,r.clamp)(a,8,12);return o?(0,c.jsx)(p,{...e,children:(0,c.jsx)(u,{model:t,labelWidth:(0,r.max)(o.map(e=>(0,r.measureText)(e.label,i)+10).map(e=>n?e:20),0)})}):null})},11210:(e,t,n)=>{n.d(t,{r:()=>z.default,m_:()=>E.default,er:()=>u,Ep:()=>w,Oy:()=>x.YSCALEBAR_LABEL_OFFSET,Ay:()=>Ce,$z:()=>x.getOrigin,X_:()=>x.getScale,_i:()=>V});var r=n(12678),a=n(47369),o=n(68584);const i=(0,o.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bigWigLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=n(7552),l=n(99546);const c=(0,s.lazy)(()=>n.e(9305).then(n.bind(n,69305)));var d=n(92880);class u extends d.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{inverted:n,height:r,regions:a,bpPerPx:o,statusCallback:i=()=>{}}=e,s=a[0],c=(s.end-s.start)/o,{reducedFeatures:d,...u}=await(0,l.updateStatus)("Rendering plot",i,()=>(0,l.renderToAbstractCanvas)(c,r,e,r=>this.draw(r,{...e,features:t,inverted:n}))),p=await super.render({...e,...u,features:t,height:r,width:c});return{...p,...u,features:d?new Map(d.map(e=>[e.id(),e])):p.features,height:r,width:c,containsNoTransferables:!0}}}class p extends u{async draw(e,t){const{drawDensity:r}=await n.e(5847).then(n.bind(n,65847));return r(e,t)}}var h=n(36422);const g=(0,o.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue",contextVariable:["feature"]},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red",contextVariable:["feature"]},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:h.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0}),m=(0,o.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:g,explicitlyTyped:!0});var f=n(67112),y=n(68446),b=n(69500);const w=(0,y.observer)(function(e){const{regions:t,features:n,bpPerPx:r,width:a,height:o,onMouseLeave:i,onMouseMove:l,onFeatureClick:c}=e,d=t[0],u=(0,s.useRef)(null);function p(e){let t=0;u.current&&(t=u.current.getBoundingClientRect().left);const o=e-t,i=d.reversed?a-o:o,s=d.start+r*i;let l;for(const e of n.values())if(s<=e.get("end")+r&&s>=e.get("start")){l=e;break}return l}return(0,b.jsx)("div",{ref:u,"data-testid":"wiggle-rendering-test",onMouseMove:e=>l?.(e,p(e.clientX)?.id()),onClick:e=>c?.(e,p(e.clientX)?.id()),onMouseLeave:e=>i?.(e),style:{overflow:"visible",position:"relative",height:o},children:(0,b.jsx)(f.PrerenderedCanvas,{...e})})});var v=n(91468);const S=(0,o.ConfigurationSchema)("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:g,explicitlyTyped:!0});var x=n(75429);class C extends u{async draw(e,t){const{config:r}=t,a=(0,o.readConfObject)(r,"color"),{drawLine:i}=await n.e(9113).then(n.bind(n,49113));return i(e,{...t,offset:x.YSCALEBAR_LABEL_OFFSET,colorCallback:"#f0f"===a?()=>"grey":e=>(0,o.readConfObject)(r,"color",{feature:e})})}}var k=n(56328),T=n(90863);function A(){return(0,o.ConfigurationSchema)("SharedWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:h.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:h.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:T.Ki,explicitlyTyped:!0})}var M=n(37832),P=n(48747),R=n(20482),I=n(77126),L=n(37347);const F=(0,s.lazy)(()=>n.e(8615).then(n.bind(n,8615)));function N(e){return h.types.compose(T.Lr,h.types.model({selectedRendering:h.types.optional(h.types.string,""),resolution:h.types.optional(h.types.number,1),fill:h.types.maybe(h.types.boolean),minSize:h.types.maybe(h.types.number),color:h.types.maybe(h.types.string),posColor:h.types.maybe(h.types.string),negColor:h.types.maybe(h.types.string),summaryScoreMode:h.types.maybe(h.types.string),rendererTypeNameState:h.types.maybe(h.types.string),scale:h.types.maybe(h.types.string),autoscale:h.types.maybe(h.types.string),displayCrossHatches:h.types.maybe(h.types.boolean),constraints:h.types.optional(h.types.model({max:h.types.maybe(h.types.number),min:h.types.maybe(h.types.number)}),{}),configuration:(0,o.ConfigurationReference)(e)})).volatile(()=>({message:void 0,stats:void 0,statsFetchInProgress:void 0})).actions(e=>({updateQuantitativeStats(t){const{currStatsBpPerPx:n,scoreMin:r,scoreMax:a}=t,o=1e-6;(!e.stats||Math.abs(e.stats.scoreMax-a)>o||Math.abs(e.stats.scoreMin-r)>o)&&(e.stats={currStatsBpPerPx:n,scoreMin:r,scoreMax:a})},setColor(t){e.color=t},setPosColor(t){e.posColor=t},setNegColor(t){e.negColor=t},setStatsLoading(t){e.statsFetchInProgress&&(0,L.CF)(e.statsFetchInProgress),e.statsFetchInProgress=t},selectFeature(t){const n=(0,l.getSession)(e);(0,l.isSelectionContainer)(n)&&n.setSelection(t)},setResolution(t){e.resolution=t},setFill(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale(){e.scale="log"===e.scale?"linear":"log"},setScaleType(t){e.scale=t},setSummaryScoreMode(t){e.summaryScoreMode=t},setAutoscale(t){e.autoscale=t},setMaxScore(t){e.constraints.max=t},setRendererType(t){e.rendererTypeNameState=t},setMinScore(t){e.constraints.min=t},toggleCrossHatches(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches(t){e.displayCrossHatches=t}})).views(e=>({get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){return e.rendererTypeNameState??(0,o.getConf)(e,"defaultRendering")},get filters(){},get scaleType(){return e.scale??(0,o.getConf)(e,"scaleType")},get maxScore(){return e.constraints.max??(0,o.getConf)(e,"maxScore")},get minScore(){return e.constraints.min??(0,o.getConf)(e,"minScore")}})).views(e=>({get adapterCapabilities(){const t=e.adapterTypeName,{pluginManager:n}=(0,l.getEnv)(e);return n.getAdapterType(t).adapterCapabilities},get rendererConfig(){const{color:t,displayCrossHatches:n,fill:r,minSize:a,negColor:i,posColor:s,summaryScoreMode:c,scaleType:d,rendererTypeName:u}=e,p=(0,o.getConf)(e,["renderers",u])||{};return e.rendererType.configSchema.create({...p,...d?{scaleType:d}:{},...void 0!==r?{filled:r}:{},...void 0!==n?{displayCrossHatches:n}:{},...void 0!==c?{summaryScoreMode:c}:{},...void 0!==t?{color:t}:{},...void 0!==i?{negColor:i}:{},...void 0!==s?{posColor:s}:{},...void 0!==a?{minSize:a}:{}},(0,l.getEnv)(e))},get autoscaleType(){return e.autoscale??(0,o.getConf)(e,"autoscale")}})).views(e=>{let t=[0,0];return{get domain(){const{stats:n,scaleType:r,minScore:a,maxScore:o}=e;if(!n)return;const i=(0,x.getNiceDomain)({domain:[n.scoreMin,n.scoreMax],bounds:[a,o],scaleType:r});return"log"===r&&i[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(i)&&(t=i),t)}}}).views(e=>({get filled(){return e.fill??(0,o.readConfObject)(e.rendererConfig,"filled")},get summaryScoreModeSetting(){return e.summaryScoreMode??(0,o.readConfObject)(e.rendererConfig,"summaryScoreMode")},get scaleOpts(){return{domain:e.domain,stats:e.stats,autoscaleType:e.autoscaleType,scaleType:e.scaleType,inverted:(0,o.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get displayCrossHatchesSetting(){return e.displayCrossHatches??(0,o.readConfObject)(e.rendererConfig,"displayCrossHatches")},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")}})).views(e=>({scoreTrackMenuItems:()=>[...e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map(t=>({label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:()=>{e.setSummaryScoreMode(t)}}))}]:[],{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:()=>{e.toggleLogScale()}},{label:"Autoscale type",subMenu:[["local","Local"],...e.hasGlobalStats?[["global","Global"],["globalsd","Global ± 3σ"]]:[],["localsd","Local ± 3σ"]].map(([t,n])=>({label:n,type:"radio",checked:e.autoscaleType===t,onClick:()=>{e.setAutoscale(t)}}))},{label:"Set min/max score",onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[F,{model:e,handleClose:t}])}}]})).actions(e=>{const{reload:t}=e;return{async reload(){e.setError(),t()}}})}const D=(0,s.lazy)(()=>Promise.resolve().then(n.bind(n,57266))),B=(0,s.lazy)(()=>Promise.all([n.e(6395),n.e(725)]).then(n.bind(n,23106))),j=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),V=function(e,t){return h.types.compose("LinearWiggleDisplay",N(t),h.types.model({type:h.types.literal("LinearWiggleDisplay"),invertedSetting:h.types.maybe(h.types.boolean)})).actions(e=>({setInverted(t){e.invertedSetting=t}})).views(e=>({get TooltipComponent(){return D},get rendererTypeName(){const t=e.rendererTypeNameSimple,n=j.get(t);if(!n)throw new Error(`unknown renderer ${t}`);return n},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,l.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx},get graphType(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get inverted(){return e.invertedSetting??(0,o.getConf)(e,"inverted")}})).views(e=>{const{renderProps:t}=e;return{adapterProps(){const n=t(),{filters:r,resolution:a,scaleOpts:o}=e;return{...n,rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig,displayCrossHatches:e.displayCrossHatchesSetting,scaleOpts:o,resolution:a,filters:r}},get ticks(){const{inverted:t,scaleType:n,domain:r,height:a}=e,i=(0,o.getConf)(e,"minimalTicks");if(r){const e=(0,I.axisPropsFromTickScale)((0,x.getScale)({scaleType:n,domain:r,range:[a-x.YSCALEBAR_LABEL_OFFSET,x.YSCALEBAR_LABEL_OFFSET],inverted:t}),4);return a<100||i?{...e,values:r}:e}}}}).views(e=>({renderProps(){const{inverted:t,ticks:n,height:r}=e,a=e.adapterProps();return{...e.adapterProps(),notReady:a.notReady||!e.stats,height:r,ticks:n,inverted:t}},get fillSetting(){return e.filled?0:1===e.minSize?1:2},get quantitativeStatsReady(){return(0,l.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error}})).views(e=>{const{trackMenuItems:t}=e,n=(0,o.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",icon:M.A,subMenu:e.scoreTrackMenuItems()},...e.graphType?[{label:"Inverted",type:"checkbox",checked:e.inverted,onClick:()=>{e.setInverted(!e.inverted)}}]:[],...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((t,n)=>({label:t,type:"radio",checked:e.fillSetting===n,onClick:()=>{e.setFill(n)}}))}]:[],...n?[{label:"Renderer type",subMenu:["xyplot","density","line"].map(t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}}))}]:[],{label:"Color",icon:P.A,onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[B,{model:e,handleClose:t}])}},...e.graphType?[{type:"checkbox",icon:R.A,label:"Show cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[]]}}).actions(e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{const{getQuantitativeStatsAutorun:t}=await n.e(7722).then(n.bind(n,47722));t(e)})()},async renderSvg(r){const{renderSvg:a}=await n.e(1466).then(n.bind(n,51466));return a(e,r,t)}}})};var E=n(57266),z=n(98911);const O=(0,o.ConfigurationSchema)("MultiDensityRenderer",{},{baseConfiguration:g,explicitlyTyped:!0}),H=(0,y.observer)(function(e){const{regions:t,features:n,bpPerPx:r,width:a,height:o,sources:i,onMouseLeave:c=()=>{},onMouseMove:d=()=>{},onFeatureClick:u=()=>{},displayModel:p}=e,h=t[0],g=(0,s.useRef)(null),{isMultiRow:m}=p||{};function y(e,t){if(!g.current)return;const s=g.current.getBoundingClientRect(),c=e-s.left,d=t-s.top,u=i[Math.floor(d/o*i.length)];if(!u)return;const p=h.reversed?a-c:c,f=h.start+r*p;let y;if(m){for(const e of n.values())if(e.get("source")===u.name&&f<=e.get("end")+r&&f>=e.get("start")){y=e;break}}else{const e=[];for(const t of n.values())f<=t.get("end")+r&&f>=t.get("start")&&e.push(t);if(e.length){const t=Math.floor(f);y=new l.SimpleFeature({uniqueId:"mouseoverfeat",sources:Object.fromEntries(e.map(e=>e.toJSON()).map(e=>{const{refName:t,start:n,end:r,source:a,...o}=e;return[a,o]})),...h,start:t,end:t+1})}}return y}return(0,b.jsx)("div",{ref:g,onMouseMove:e=>{const{clientX:t,clientY:n}=e,r=y(t,n);d(e,r)},onClick:e=>{const{clientX:t,clientY:n}=e,r=y(t,n);u(e,r)},onMouseLeave:e=>{c(e)},style:{overflow:"visible",position:"relative",height:o},children:(0,b.jsx)(f.PrerenderedCanvas,{...e})})});class G extends u{async draw(e,t){const{stopToken:r,sources:a,features:o}=t,i=(0,l.groupBy)(o.values(),e=>e.get("source")),s=t.height/a.length;let c=[];const{drawDensity:d}=await n.e(5847).then(n.bind(n,65847));return e.save(),(0,l.forEachWithStopTokenCheck)(a,r,n=>{const r=i[n.name]||[],{reducedFeatures:a}=d(e,{...t,features:r,height:s});e.translate(0,s),c=c.concat(a)}),e.restore(),{reducedFeatures:c}}}class $ extends u{async draw(e,t){const{stopToken:r,sources:a,features:o}=t,i=(0,l.groupBy)(o.values(),e=>e.get("source")),{drawLine:s}=await n.e(9113).then(n.bind(n,49113));let c=[];return(0,l.forEachWithStopTokenCheck)(a,r,n=>{const{reducedFeatures:r}=s(e,{...t,features:i[n.name]||[],colorCallback:()=>n.color||"blue"});c=c.concat(r)}),{reducedFeatures:c}}}const W=(0,o.ConfigurationSchema)("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:g,explicitlyTyped:!0});var U=n(40898),_=n(41365),q=n.n(_);const J=()=>"#000000".replaceAll("0",()=>(~~(16*Math.random())).toString(16)),X=(0,s.lazy)(()=>n.e(6021).then(n.bind(n,96021))),Y=(0,s.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(3100),n.e(6395),n.e(7513)]).then(n.bind(n,17513))),K=(0,s.lazy)(()=>n.e(7040).then(n.bind(n,67040))),Q=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]),Z=function(e,t){return h.types.compose("MultiLinearWiggleDisplay",N(t),h.types.model({type:h.types.literal("MultiLinearWiggleDisplay"),layout:h.types.optional(h.types.frozen(),[]),showSidebar:!0})).volatile(()=>({sourcesLoadingStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0})).actions(e=>({setShowSidebar(t){e.showSidebar=t},setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,L.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSources(t){q()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t}})).views(e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return X},get rendererTypeName(){const t=e.rendererTypeNameSimple,n=Q.get(t);if(!n)throw new Error(`unknown renderer ${t}`);return n}})).views(e=>({get graphType(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName},get needsFullHeightScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName},get isMultiRow(){return"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName||"MultiDensityRenderer"===e.rendererTypeName},get needsCustomLegend(){return"MultiDensityRenderer"===e.rendererTypeName},get canHaveFill(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName},get renderColorBoxes(){return!("MultiRowLineRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName)},get prefersOffset(){return this.isMultiRow},get sourcesWithoutLayout(){const t=Object.fromEntries(e.sourcesVolatile?.map(e=>[e.name,e])||[]),n=e.sourcesVolatile;return n?.map(e=>({...t[e.name],...e})).map((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":U.set1[t]||J())}))},get sources(){const t=Object.fromEntries(e.sourcesVolatile?.map(e=>[e.name,e])||[]),n=e.layout.length?e.layout:e.sourcesVolatile;return n?.map(e=>({...t[e.name],...e})).map((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":U.set1[t]||J())}))},get quantitativeStatsReady(){return(0,l.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error}})).views(e=>({get rowHeight(){const{sources:t,height:n,isMultiRow:r}=e;return r?n/(t?.length||1):n},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return(0,o.getConf)(e,"minimalTicks")||this.rowHeightTooSmallForScalebar}})).views(e=>{const{renderProps:t}=e;return{adapterProps:()=>({...t(),displayModel:e,config:e.rendererConfig,filters:e.filters,resolution:e.resolution,rpcDriverName:e.rpcDriverName,sources:e.sources}),get ticks(){const{scaleType:t,domain:n,isMultiRow:r,rowHeight:a,useMinimalTicks:i}=e;if(!n)return;const s=r?0:x.YSCALEBAR_LABEL_OFFSET,l=(0,I.axisPropsFromTickScale)((0,x.getScale)({scaleType:t,domain:n,range:[a-s,s],inverted:(0,o.getConf)(e,"inverted")}),4);return i?{...l,values:n}:l},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,l.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx}}}).views(e=>({get legendFontSize(){return Math.min(e.rowHeight,8)},get canDisplayLegendLabels(){return e.rowHeight>7},get labelWidth(){return(0,l.max)(e.sources?.map(e=>(0,l.measureText)(e.name,this.legendFontSize)).map(e=>this.canDisplayLegendLabels?e:20)||[])},renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.stats,displayModel:e,rpcDriverName:e.rpcDriverName,displayCrossHatches:e.displayCrossHatches,height:e.height,ticks:e.ticks,stats:e.stats,scaleOpts:e.scaleOpts,onMouseMove:(t,n)=>{e.setFeatureUnderMouse(n)},onMouseLeave:()=>{e.setFeatureUnderMouse(void 0)}}},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:1===e.minSize?1:2}})).views(e=>{const{trackMenuItems:t}=e,n=(0,o.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((t,n)=>({label:t,type:"radio",checked:e.fillSetting===n,onClick:()=>{e.setFill(n)}}))}]:[],...n?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map(t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}}))}]:[],...e.graphType?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[],{label:"Cluster by score",onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[K,{model:e,handleClose:t}])}},{label:"Show sidebar",type:"checkbox",checked:e.showSidebar,onClick:()=>{e.setShowSidebar(!e.showSidebar)}},{label:"Edit colors/arrangement...",onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[Y,{model:e,handleClose:t}])}}]}}).actions(e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const[{getMultiWiggleSourcesAutorun:t},{getQuantitativeStatsAutorun:r}]=await Promise.all([n.e(1439).then(n.bind(n,31439)),n.e(7722).then(n.bind(n,47722))]);r(e),t(e)}catch(t){(0,h.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(r){const{renderSvg:a}=await n.e(1531).then(n.bind(n,51531));return a(e,r,t)}}})};var ee=n(58273),te=n(1622);class ne extends u{async draw(e,t){const{stopToken:r,bpPerPx:a,sources:o,regions:i,features:s}=t,c=i[0],d=(0,l.groupBy)(s.values(),e=>e.get("source")),u=t.height/o.length,p=(c.end-c.start)/a,{drawLine:h}=await n.e(9113).then(n.bind(n,49113));let g=[];return e.save(),(0,l.forEachWithStopTokenCheck)(o,r,n=>{const{reducedFeatures:r}=h(e,{...t,features:d[n.name]||[],height:u,colorCallback:()=>n.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,u),e.lineTo(p,u),e.stroke(),e.translate(0,u),g=g.concat(r)}),e.restore(),{reducedFeatures:g}}}const re=(0,o.ConfigurationSchema)("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:g,explicitlyTyped:!0});class ae extends u{async draw(e,t){const{stopToken:r,bpPerPx:a,sources:o,regions:i,features:s}=t,c=i[0],d=(0,l.groupBy)(s.values(),e=>e.get("source")),u=t.height/o.length,p=(c.end-c.start)/a,{drawXY:h}=await n.e(5524).then(n.bind(n,15524));let g=[];return e.save(),(0,l.forEachWithStopTokenCheck)(o,r,n=>{const{reducedFeatures:r}=h(e,{...t,features:d[n.name]||[],height:u,colorCallback:()=>n.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,u),e.lineTo(p,u),e.stroke(),e.translate(0,u),g=g.concat(r)}),e.restore(),{reducedFeatures:g}}}const oe=(0,o.ConfigurationSchema)("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:g,explicitlyTyped:!0}),ie=(0,o.ConfigurationSchema)("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[],description:"array of subadapter JSON objects"},bigWigs:{type:"frozen",description:"array of bigwig filenames, alternative to the subadapters slot",defaultValue:[]}},{explicitlyTyped:!0});var se=n(58921);class le extends u{async draw(e,t){const{stopToken:r,sources:a,features:o}=t,i=(0,l.groupBy)(o.values(),e=>e.get("source")),{drawXY:s}=await n.e(5524).then(n.bind(n,15524));let c=[];return(0,l.forEachWithStopTokenCheck)(a,r,n=>{const r=i[n.name]||[],{reducedFeatures:a}=s(e,{...t,features:r,offset:x.YSCALEBAR_LABEL_OFFSET,colorCallback:()=>n.color||"blue"});c=c.concat(a)}),{reducedFeatures:c}}}const ce=(0,o.ConfigurationSchema)("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:g,explicitlyTyped:!0});var de=n(3496),ue=n(14129);class pe extends ue.A{name="MultiWiggleGetSources";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:a,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,de.cK)(n,i,o);return s.getSources(a,r)}}class he extends ue.A{name="WiggleGetMultiRegionQuantitativeStats";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:a,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,de.cK)(n,i,o);return s.getMultiRegionQuantitativeStats(a,r)}}class ge extends ue.A{name="WiggleGetGlobalQuantitativeStats";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:o}=r,{dataAdapter:i}=await(0,de.cK)(n,o,a);return i.getGlobalStats(r)}}var me=n(44728),fe=n(82088);async function ye({pluginManager:e,args:t}){const{sources:n,regions:r,adapterConfig:a,sessionId:o,bpPerPx:i}=t,s=(await(0,de.cK)(e,o,a)).dataAdapter,c=r[0],d=c.end-c.start,u=Math.floor(d/i),p=await(0,me._)(s.getFeatures(c,t).pipe((0,fe.$)())),h=(0,l.groupBy)(p,e=>e.get("source")),g={};for(const e of n){const{name:t}=e,n=h[t]||[],r=new Array(u).fill(0);for(const e of n){const t=e.get("start"),n=e.get("end"),a=e.get("score");for(let e=t;e<n;e+=i){const t=Math.floor((e-c.start)/i);t>=0&&t<u&&(r[t]||=a)}}g[t]=r}return g}class be extends ue.A{name="MultiWiggleGetScoreMatrix";async execute(e,t){return ye({args:await this.deserializeArguments(e,t),pluginManager:this.pluginManager})}}var we=n(53996);class ve extends ue.A{name="MultiWiggleClusterScoreMatrix";async execute(e,t){const n=await this.deserializeArguments(e,t),r=await ye({pluginManager:this.pluginManager,args:n});return(0,we.DV)({data:Object.values(r),stopToken:n.stopToken,onProgress:e=>{n.statusCallback?.(e)}})}}class Se extends u{async draw(e,t){const{inverted:r,stopToken:a,features:i,config:s}=t,{drawXY:l}=await n.e(5524).then(n.bind(n,15524)),c=(0,o.readConfObject)(s,"bicolorPivotValue"),d=(0,o.readConfObject)(s,"negColor"),u=(0,o.readConfObject)(s,"posColor");return l(e,{...t,colorCallback:s.color.isCallback?(e,t)=>(0,o.readConfObject)(s,"color",{feature:e}):(e,t)=>t<c?d:u,offset:x.YSCALEBAR_LABEL_OFFSET,features:[...i.values()],inverted:r,stopToken:a})}}const xe=(0,o.ConfigurationSchema)("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:g,explicitlyTyped:!0});class Ce extends r.A{name="WigglePlugin";install(e){e.addAdapterType(()=>new a.A({name:"MultiWiggleAdapter",displayName:"Multi-wiggle adapter",configSchema:ie,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(1822).then(n.bind(n,31822)).then(e=>e.default)})),e.addAdapterType(()=>new a.A({name:"BigWigAdapter",displayName:"BigWig adapter",configSchema:i,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>Promise.all([n.e(7368),n.e(4234)]).then(n.bind(n,14234)).then(e=>e.default)})),function(e){e.addTrackType(()=>{const t=function(e){return(0,o.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:(0,te.createBaseTrackConfig)(e)})}(e);return new ee.A({name:"QuantitativeTrack",displayName:"Quantitative track",configSchema:t,stateModel:(0,te.createBaseTrackModel)(e,"QuantitativeTrack",t)})})}(e),function(e){e.addTrackType(()=>{const t=(e=>(0,o.ConfigurationSchema)("MultiQuantitativeTrack",{},{baseConfiguration:(0,te.createBaseTrackConfig)(e)}))(e);return new ee.A({name:"MultiQuantitativeTrack",displayName:"Multi-quantitative track",configSchema:t,stateModel:(0,te.createBaseTrackModel)(e,"MultiQuantitativeTrack",t)})})}(e),function(e){e.addDisplayType(()=>{const t=function(e){const t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return(0,o.ConfigurationSchema)("LinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:h.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:A(),explicitlyTyped:!0})}(e),r=V(e,t);return new k.A({name:"LinearWiggleDisplay",displayName:"Wiggle display",configSchema:t,stateModel:r,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,s.lazy)(()=>Promise.resolve().then(n.bind(n,98911)))})})}(e),function(e){e.addDisplayType(()=>{const t=function(e){const t=e.getRendererType("MultiXYPlotRenderer").configSchema,n=e.getRendererType("MultiDensityRenderer").configSchema,r=e.getRendererType("MultiRowXYPlotRenderer").configSchema,a=e.getRendererType("MultiLineRenderer").configSchema,i=e.getRendererType("MultiRowLineRenderer").configSchema;return(0,o.ConfigurationSchema)("MultiLinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:h.types.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:n,MultiRowXYPlotRenderer:r,MultiLineRenderer:a,MultiRowLineRenderer:i}),height:{type:"number",defaultValue:200}},{baseConfiguration:A(),explicitlyTyped:!0})}(e);return new k.A({name:"MultiLinearWiggleDisplay",displayName:"Multi-wiggle display",configSchema:t,stateModel:Z(0,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,s.lazy)(()=>n.e(8526).then(n.bind(n,8526)))})})}(e),function(e){e.addRendererType(()=>new C({name:"LinePlotRenderer",ReactComponent:w,configSchema:S,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new Se({name:"XYPlotRenderer",ReactComponent:w,configSchema:xe,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new p({name:"DensityRenderer",ReactComponent:w,configSchema:m,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new le({name:"MultiXYPlotRenderer",ReactComponent:H,configSchema:ce,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new ae({name:"MultiRowXYPlotRenderer",ReactComponent:H,configSchema:oe,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new G({name:"MultiDensityRenderer",ReactComponent:H,configSchema:O,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new $({name:"MultiLineRenderer",ReactComponent:H,configSchema:W,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new ne({name:"MultiRowLineRenderer",ReactComponent:H,configSchema:re,pluginManager:e}))}(e),function(e){e.addAddTrackWorkflowType(()=>new se.AddTrackWorkflowType({name:"Multi-wiggle track",ReactComponent:(0,s.lazy)(()=>n.e(2018).then(n.bind(n,52018))),stateModel:h.types.model({})}))}(e),function(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",(e,t)=>{const{session:n}=t;return[...e,...(0,l.isSessionWithAddTracks)(n)?[{label:"Create multi-wiggle track",onClick:e=>{const t=e.selection;(0,l.getSession)(e).queueDialog(n=>[c,{tracks:t,onClose:(t,r)=>{t&&r&&function({model:e,arg:t}){const n=e.selection,r=n.map(e=>(0,o.readConfObject)(e,"name")),a=n.map(e=>(0,o.readConfObject)(e,"adapter")).map((e,t)=>({...e,source:r[t]})),i=`multitrack-${Date.now()}-sessionTrack`,s=(0,l.getSession)(e);(0,l.isSessionWithAddTracks)(s)&&(s.addTrackConf({type:"MultiQuantitativeTrack",trackId:i,name:t.name,assemblyNames:[...new Set(n.flatMap(e=>(0,o.readConfObject)(e,"assemblyNames")))],adapter:{type:"MultiWiggleAdapter",subadapters:a}}),e.view.showTrack(i))}({model:e,arg:r}),n()}}])}}]:[]]})}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,v.getFileName)(t);return(0,l.testAdapter)(a,/\.(bw|bigwig)$/i,r,"BigWigAdapter")?{type:"BigWigAdapter",bigWigLocation:t}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"BigWigAdapter"===t?"QuantitativeTrack":e(t))}(e),e.addRpcMethod(()=>new ge(e)),e.addRpcMethod(()=>new he(e)),e.addRpcMethod(()=>new pe(e)),e.addRpcMethod(()=>new be(e)),e.addRpcMethod(()=>new ve(e))}exports={LinearWiggleDisplayReactComponent:z.default,XYPlotRendererReactComponent:w,XYPlotRenderer:Se,WiggleBaseRenderer:u,linearWiggleDisplayModelFactory:V,xyPlotRendererConfigSchema:xe,utils:x}}},12678:(e,t,n)=>{n.d(t,{A:()=>r});class r{install(e){}configure(e){}}},14129:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(2406),a=n(99546),o=n(93100);class i extends r.A{async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new o.A({filters:e.filters}):void 0}}async serializeArguments(e,t){const n=this.pluginManager,r=n.rootModel?.session?.assemblyManager;if(!r)throw new Error("no assembly manager");const o=await(0,a.renameRegionsIfNeeded)(r,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(o,t)}}},14862:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(93062),a=n(68446),o=n(92516),i=n(69500);const s=(0,a.observer)(function({location:e,label:t,style:n,setLocation:a}){return(0,i.jsx)(r.A,{variant:"outlined",fullWidth:!0,defaultValue:e&&(0,o.C1)(e)?e.uri:"",label:t||"Enter URL",style:n,onChange:e=>{a({uri:e.target.value.trim(),locationType:"UriLocation"})},slotProps:{htmlInput:{"data-testid":"urlInput"}}})})},16062:(e,t,n)=>{n.d(t,{aF:()=>je,N5:()=>de,Ay:()=>at,ww:()=>$});var r=n(12678),a=n(7552),o=n(67736),i=n(68584);const s=(0,i.ConfigurationSchema)("AlignmentsFeatureWidget",{});var l=n(9342),c=n(36422);function d(e){return c.types.compose((0,l.n)(e),c.types.model("AlignmentsFeatureWidget",{type:c.types.literal("AlignmentsFeatureWidget")}))}function u(e){e.addWidgetType(()=>new o.A({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:s,stateModel:d(e),ReactComponent:(0,a.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6386),n.e(1475),n.e(5300),n.e(5132)]).then(n.bind(n,55132)))}))}var p=n(58273),h=n(1622),g=n(58921);function m(e){e.addTrackType(()=>{const t=(n=e,(0,i.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:(0,g.createBaseTrackConfig)(n)}));var n;const r=new p.A({name:"AlignmentsTrack",displayName:"Alignments track",configSchema:t,stateModel:(0,h.createBaseTrackModel)(e,"AlignmentsTrack",t)}),a=e.getDisplayType("LinearAlignmentsDisplay");return r.addDisplayType(a),r})}var f=n(47369);const y=(0,i.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("BamIndex",{indexType:{model:c.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",description:"size to fetch in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:5e6},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bamLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.bai`,baseUri:e.baseUri}}}:e});function b(e){e.addAdapterType(()=>new f.A({name:"BamAdapter",displayName:"BAM adapter",configSchema:y,getAdapterClass:()=>Promise.all([n.e(1794),n.e(4770)]).then(n.bind(n,94770)).then(e=>e.default)}))}const w=(0,i.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",description:"size in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:{type:"frozen",description:"sequence data adapter",defaultValue:null}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,cramLocation:{uri:e.uri,baseUri:e.baseUri},craiLocation:{uri:`${e.uri}.crai`,baseUri:e.baseUri}}:e});function v(e){e.addAdapterType(()=>new f.A({name:"CramAdapter",displayName:"CRAM adapter",configSchema:w,getAdapterClass:()=>Promise.all([n.e(4808),n.e(9822)]).then(n.bind(n,18554)).then(e=>e.default)}))}var S=n(99546),x=n(91468);function C(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,x.getFileName)(t),o=n&&(0,x.getFileName)(n);return(0,S.testAdapter)(a,/\.bam$/i,r,"BamAdapter")?{type:"BamAdapter",bamLocation:t,index:{location:n||(0,x.makeIndex)(t,".bai"),indexType:(0,x.makeIndexType)(o,"CSI","BAI")}}:(0,S.testAdapter)(a,/\.cram$/i,r,"CramAdapter")?{type:"CramAdapter",cramLocation:t,craiLocation:n||(0,x.makeIndex)(t,".crai")}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t))}const k=(0,i.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",description:"the base URL to fetch from",defaultValue:""},htsgetTrackId:{type:"string",description:"the trackId, which is appended to the base URL",defaultValue:""},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0});function T(e){e.addAdapterType(()=>new f.A({name:"HtsgetBamAdapter",displayName:"Htsget BAM adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:k,getAdapterClass:()=>Promise.all([n.e(1794),n.e(6823)]).then(n.bind(n,6823)).then(e=>e.default)}))}var A=n(56328),M=n(67112),P=n(68446),R=n(75785),I=n(69500);const L=(0,R.n9)()(e=>({resizeHandle:{height:5,position:"absolute",zIndex:2,background:"transparent","&:hover":{background:e.palette.divider}}})),F=(0,P.observer)(function({model:e}){const{PileupDisplay:t,SNPCoverageDisplay:n}=e,{classes:r}=L();if(!n)return null;const a=n.height??100;return(0,I.jsxs)("div",{"data-testid":`display-${(0,i.getConf)(e,"displayId")}`,style:{position:"relative"},children:[(0,I.jsx)("div",{"data-testid":"Blockset-snpcoverage",children:(0,I.jsx)(n.RenderingComponent,{model:n})}),(0,I.jsx)(M.ResizeHandle,{onDrag:e=>(n.setHeight(n.height+e),e),className:r.resizeHandle,style:{top:a-4}}),(0,I.jsx)("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:a},children:(0,I.jsx)(t.RenderingComponent,{model:t})})]})}),N=F;var D=n(90863),B=n(41365),j=n.n(B),V=n(42489);function E(e){return e.getDisplayElements().filter(e=>"LinearAlignmentsDisplay"===e.subDisplay?.type).filter(e=>e.subDisplay?.lowerPanel)}function z(e){const{PileupDisplay:t,SNPCoverageDisplay:n}=e;return t||(0,c.isAlive)(t)||n||(0,c.isAlive)(n)}const O=function(e,t){return c.types.compose("LinearAlignmentsDisplay",h.BaseDisplay,function(e,t){return c.types.model({PileupDisplay:c.types.maybe(c.types.union(...E(e).map(e=>e.stateModel))),SNPCoverageDisplay:c.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:c.types.literal("LinearAlignmentsDisplay"),configuration:(0,i.ConfigurationReference)(t),heightPreConfig:c.types.maybe(c.types.number),userFeatureScreenDensity:c.types.maybe(c.types.number),lowerPanelType:"LinearPileupDisplay"})}(e,t)).volatile(()=>({scrollTop:0})).actions(e=>({setScrollTop(t){e.scrollTop=t},setSNPCoverageHeight(t){e.snpCovHeight=t}})).views(e=>({get height(){return e.heightPreConfig??(0,i.getConf)(e,"height")},get featureIdUnderMouse(){return e.PileupDisplay.featureIdUnderMouse||e.SNPCoverageDisplay.featureIdUnderMouse}})).views(e=>({get pileupConf(){return{...(0,i.getConf)(e,"pileupDisplay"),type:e.lowerPanelType,displayId:`${e.configuration.displayId}_${e.lowerPanelType}_xyz`}},getFeatureByID:(t,n)=>e.PileupDisplay.getFeatureByID(t,n),searchFeatureByID:t=>e.PileupDisplay.searchFeatureByID?.(t),get features(){return e.PileupDisplay.features},get DisplayBlurb(){return e.PileupDisplay?.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get coverageConf(){return{...(0,i.getConf)(e,"snpCoverageDisplay"),displayId:`${e.configuration.displayId}_snpcoverage_xyz`}},notReady:()=>e.PileupDisplay?.renderProps().notReady||e.SNPCoverageDisplay?.renderProps().notReady})).actions(e=>({setSNPCoverageDisplay(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setFeatureDensityStatsLimit(t){e.PileupDisplay.setFeatureDensityStatsLimit(t),e.SNPCoverageDisplay.setFeatureDensityStatsLimit(t)},setPileupDisplay(t){e.PileupDisplay={type:t.type||"LinearPileupDisplay",configuration:t}},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.heightPreConfig),setFilterBy(t){e.PileupDisplay.setFilterBy(t),e.SNPCoverageDisplay.setFilterBy(t)},setLowerPanelType(t){e.lowerPanelType=t},resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n}})).actions(e=>({afterAttach(){(0,c.addDisposer)(e,(0,V.autorun)(()=>{const{SNPCoverageDisplay:t,PileupDisplay:n,coverageConf:r,pileupConf:a}=e;t?j()(r,(0,c.getSnapshot)(t.configuration))||(t.setHeight(e.snpCovHeight),t.setConfig(e.coverageConf)):e.setSNPCoverageDisplay(r),n&&e.lowerPanelType===n.type?j()(a,(0,c.getSnapshot)(n.configuration))||n.setConfig(e.pileupConf):e.setPileupDisplay(a),function(e){const{PileupDisplay:t,SNPCoverageDisplay:n}=e;z(e)&&t.colorBy&&(j()(t.colorBy,n.colorBy)||n.setColorScheme({...t.colorBy}))}(e),function(e){const{PileupDisplay:t,SNPCoverageDisplay:n}=e;z(e)&&t.filterBy&&(j()(t.filterBy,n.filterBy)||n.setFilterBy({...t.filterBy}))}(e)})),(0,c.addDisposer)(e,(0,V.autorun)(()=>{e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)})),(0,c.addDisposer)(e,(0,V.autorun)(()=>{e.PileupDisplay.setHeight(e.height-e.SNPCoverageDisplay.height)}))},async renderSvg(t){const n=e.height-e.SNPCoverageDisplay.height;return await(0,V.when)(()=>!e.notReady()),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("g",{children:await e.SNPCoverageDisplay.renderSvg(t)}),(0,I.jsx)("g",{transform:`translate(0 ${e.SNPCoverageDisplay.height})`,children:await e.PileupDisplay.renderSvg({...t,overrideHeight:n})})]})}})).views(t=>{const{trackMenuItems:n}=t;return{trackMenuItems(){if(!t.PileupDisplay)return[];const r=E(e).map(e=>({type:"radio",label:e.displayName,checked:e.name===t.PileupDisplay.type,onClick:()=>{t.setLowerPanelType(e.name)}}));return[...n(),{type:"subMenu",label:"Pileup settings",subMenu:t.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:t.SNPCoverageDisplay.trackMenuItems()},{type:"subMenu",label:"Replace lower panel with...",subMenu:r}]}}}).preProcessSnapshot(e=>{if(!e)return e;const{height:t,...n}=e;return{heightPreConfig:t,...n}})};function H(e){e.addDisplayType(()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:e.getDisplayType("LinearPileupDisplay").configSchema,snpCoverageDisplay:e.getDisplayType("LinearSNPCoverageDisplay").configSchema,height:{type:"number",defaultValue:250}},{baseConfiguration:D.Ki,explicitlyTyped:!0})}(e);return new A.A({name:"LinearAlignmentsDisplay",displayName:"Alignments display (combination)",configSchema:t,stateModel:O(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:N})})}var G=n(91476);const $=function(e){return(0,i.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:c.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:e.getRendererType("PileupRenderer").configSchema}),maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:G.JD}},{baseConfiguration:(0,D.lw)(e),explicitlyTyped:!0})};var W=n(23063),U=n(84038),_=n(20482),q=n(15480),J=n(93100),X=n(98670),Y=n(8328),K=n(28129),Q=n(31409),Z=n.n(Q),ee=n(86576),te=n(61282);const ne=(0,P.observer)(function({model:e}){const{sortedBy:t}=e;return t?(0,I.jsx)("div",{"data-testid":`blurb-${t}`,children:(0,I.jsx)(te.A,{color:"secondary",variant:"caption",children:`Sorted by ${t.tag??t.type} at ${t.refName}:${t.pos}`})}):null}),re=ne;var ae=n(80256);const oe=(0,a.lazy)(()=>n.e(130).then(n.bind(n,40130))),ie=(0,a.lazy)(()=>n.e(8424).then(n.bind(n,8424))),se=(0,a.lazy)(()=>n.e(4706).then(n.bind(n,34706))),le=(0,a.lazy)(()=>n.e(8482).then(n.bind(n,58482))),ce=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]);function de(e){return c.types.compose(D.Lr,c.types.model({configuration:(0,i.ConfigurationReference)(e),featureHeight:c.types.maybe(c.types.number),noSpacing:c.types.maybe(c.types.boolean),fadeLikelihood:c.types.maybe(c.types.boolean),trackMaxHeight:c.types.maybe(c.types.number),colorBySetting:c.types.frozen(),filterBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[]),hideSmallIndelsSetting:c.types.maybe(c.types.boolean)})).volatile(()=>({colorTagMap:V.observable.map({}),featureUnderMouseVolatile:void 0,tagsReady:!1})).views(e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")}})).views(e=>({get autorunReady(){return(0,S.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge},get hideSmallIndels(){return e.hideSmallIndelsSetting}})).actions(e=>({setTagsReady(t){e.tagsReady=t},setMaxHeight(t){e.trackMaxHeight=t},setFeatureHeight(t){e.featureHeight=t},setNoSpacing(t){e.noSpacing=t},setColorScheme(t){e.colorTagMap=V.observable.map({}),e.colorBySetting={...t},t.tag&&(e.tagsReady=!1)},updateColorTagMap(t){const n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];for(const r of t)if(!e.colorTagMap.has(r)){const t=[...e.colorTagMap.keys()].length;e.colorTagMap.set(r,n[t])}},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},selectFeature(t){const n=(0,S.getSession)(e);if((0,S.isSessionModelWithWidgets)(n)){const r=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,S.getContainingView)(e),track:(0,S.getContainingTrack)(e)});n.showWidget(r)}n.setSelection(t)},setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)},setHideSmallIndels(t){e.hideSmallIndelsSetting=t}})).views(e=>({copyFeatureToClipboard(t){const{uniqueId:n,...r}=t.toJSON(),a=(0,S.getSession)(e);Z()(JSON.stringify(r,null,4)),a.notify("Copied to clipboard","success")},get rendererConfig(){const{featureHeight:t,noSpacing:n,hideSmallIndels:r,trackMaxHeight:a,rendererTypeName:o}=e,s=(0,i.getConf)(e,["renderers",o])||{};return e.rendererType.configSchema.create({...s,...void 0!==r?{hideSmallIndels:r}:{},...void 0!==t?{height:t}:{},...void 0!==n?{noSpacing:n}:{},...void 0!==a?{maxHeight:a}:{}},(0,S.getEnv)(e))}})).views(e=>({get maxHeight(){return(0,i.readConfObject)(e.rendererConfig,"maxHeight")},get featureHeightSetting(){return(0,i.readConfObject)(e.rendererConfig,"height")},get featureUnderMouse(){return e.featureUnderMouseVolatile},renderReady:()=>e.tagsReady,get filters(){return new J.A({filters:e.jexlFilters})}})).views(e=>{const{trackMenuItems:t,renderProps:n}=e;return{get rendererTypeName(){const t=(0,i.getConf)(e,"defaultRendering"),n=ce.get(t);if(!n)throw new Error(`unknown alignments view name ${t}`);return n},contextMenuItems(){const t=e.contextMenuFeature;return t?[{label:"Open feature details",icon:K.A,onClick:()=>{e.clearFeatureSelection(),e.selectFeature(t)}},{label:"Copy info to clipboard",icon:Y.A,onClick:()=>{e.copyFeatureToClipboard(t)}}]:[]},get DisplayBlurb(){return re},renderPropsPre(){const{colorTagMap:t,colorBy:r,filterBy:a,rpcDriverName:o}=e,i=n();return{...i,notReady:i.notReady||!e.renderReady(),rpcDriverName:o,displayModel:e,colorBy:r,filterBy:a,filters:e.filters,colorTagMap:Object.fromEntries(t.toJSON()),config:e.rendererConfig,async onFeatureClick(t,n){const r=(0,S.getSession)(e),{rpcManager:a}=r;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,x.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,layoutId:(0,S.getContainingTrack)(e).id,rendererType:"PileupRenderer"});(0,c.isAlive)(e)&&r&&e.selectFeature(new S.SimpleFeature(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notifyError(`${e}`,e)}},onClick(){e.clearFeatureSelection()},async onFeatureContextMenu(t,n){const r=(0,S.getSession)(e),{rpcManager:a}=r;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,x.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,layoutId:(0,S.getContainingTrack)(e).id,rendererType:"PileupRenderer"});r&&e.setContextMenuFeature(new S.SimpleFeature(r))}else e.clearFeatureSelection()}catch(e){console.error(e),r.notifyError(`${e}`,e)}}}},colorSchemeSubMenuItems:()=>[{label:"Normal",onClick:()=>{e.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:()=>{e.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:()=>{e.setColorScheme({type:"strand"})}},{label:"Per-base quality",onClick:()=>{e.setColorScheme({type:"perBaseQuality"})}},{label:"Per-base lettering",onClick:()=>{e.setColorScheme({type:"perBaseLettering"})}},{label:"First-of-pair strand",onClick:()=>{e.setColorScheme({type:"stranded"})}},{label:"Color by tag...",onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[ie,{model:e,handleClose:t}])}}],trackMenuItems:()=>[...t(),{label:"Set feature height...",priority:1,subMenu:[{label:"Normal",onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",onClick:()=>{e.setFeatureHeight(2),e.setNoSpacing(!0)}},{label:"Manually set height",onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[se,{model:e,handleClose:t}])}}]},{label:"Hide small indels (<10bp)",priority:-1,type:"checkbox",checked:e.hideSmallIndels,onClick:()=>{e.setHideSmallIndels(!e.hideSmallIndels)}},{label:"Set max height...",priority:-1,onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[le,{model:e,handleClose:t}])}},{label:"Filter by...",icon:X.A,onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[oe,{model:e,handleClose:t}])}}]}}).views(e=>({renderProps:()=>e.renderPropsPre()})).actions(e=>({afterAttach(){(0,ee.vi)(e,async()=>{const t=(0,S.getContainingView)(e);if(!e.autorunReady)return;const{colorBy:n,tagsReady:r}=e,{staticBlocks:a}=t;if(n?.tag&&!r){const t=await(0,ae.X)({self:e,tag:n.tag,blocks:a});(0,c.isAlive)(e)&&(e.updateColorTagMap(t),e.setTagsReady(!0))}else e.setTagsReady(!0)},{delay:1e3}),(0,c.addDisposer)(e,(0,V.autorun)(async()=>{const t=(0,S.getSession)(e);try{const n=e.featureIdUnderMouse;if(e.featureUnderMouse?.id()!==n)if(n){const r=(0,x.getRpcSessionId)(e),{feature:a}=await t.rpcManager.call(r,"CoreGetFeatureDetails",{featureId:n,sessionId:r,layoutId:(0,S.getContainingTrack)(e).id,rendererType:"PileupRenderer"});(0,c.isAlive)(e)&&a&&e.featureIdUnderMouse===a.uniqueId&&e.setFeatureUnderMouse(new S.SimpleFeature(a))}else e.setFeatureUnderMouse(void 0)}catch(e){console.error(e),t.notifyError(`${e}`,e)}}))}})).preProcessSnapshot(e=>{if(e){const{colorBy:t,colorBySetting:n,filterBySetting:r,filterBy:a,...o}=e;return{...o,filterBySetting:r||a,colorBySetting:n||t}}return e})}var ue=n(57240);const pe=(0,a.lazy)(()=>n.e(2697).then(n.bind(n,32697))),he=(0,a.lazy)(()=>n.e(4806).then(n.bind(n,74806))),ge=(0,a.lazy)(()=>n.e(483).then(n.bind(n,70483))),me=function(e){return c.types.compose("LinearPileupDisplay",de(e),c.types.model({type:c.types.literal("LinearPileupDisplay"),configuration:(0,i.ConfigurationReference)(e),showSoftClipping:!1,mismatchAlpha:c.types.maybe(c.types.boolean),sortedBy:c.types.frozen()})).volatile(()=>({sortReady:!1,currSortBpPerPx:0,visibleModifications:V.observable.map({}),simplexModifications:new Set,modificationsReady:!1})).actions(e=>({setCurrSortBpPerPx(t){e.currSortBpPerPx=t},updateVisibleModifications(t){for(const n of t)e.visibleModifications.has(n.type)||e.visibleModifications.set(n.type,{...n,color:(0,ee.rT)(n.type)})},setSimplexModifications(t){for(const n of t)e.simplexModifications.add(n)},setModificationsReady(t){e.modificationsReady=t},setSortReady(t){e.sortReady=t},clearSelected(){e.sortedBy=void 0},toggleSoftClipping(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha(){e.mismatchAlpha=!e.mismatchAlpha},setSortedBy(t,n){const{centerLineInfo:r}=(0,S.getContainingView)(e);if(!r)return;const{refName:a,assemblyName:o,offset:i}=r,s=Math.round(i)+1;s<0||!a||(e.sortReady=!1,e.sortedBy={type:t,pos:s,refName:a,assemblyName:o,tag:n})},setFeatureHeight(t){e.sortReady=!1,e.featureHeight=t}})).actions(e=>{const t=e.reload;return{reload(){e.clearSelected(),t()}}}).views(e=>({get visibleModificationTypes(){return[...e.visibleModifications.keys()]},get modificationThreshold(){return e.colorBy?.modifications?.threshold??10},get rendererConfig(){const{featureHeight:t,noSpacing:n,trackMaxHeight:r,mismatchAlpha:a,rendererTypeName:o,hideSmallIndels:s}=e,l=(0,i.getConf)(e,["renderers",o])||{};return e.rendererType.configSchema.create({...l,...void 0!==t?{height:t}:{},...void 0!==s?{hideSmallIndels:s}:{},...void 0!==n?{noSpacing:n}:{},...void 0!==a?{mismatchAlpha:a}:{},...void 0!==r?{maxHeight:r}:{}},(0,S.getEnv)(e))}})).views(e=>{const{renderReady:t}=e;return{get mismatchAlphaSetting(){return(0,i.readConfObject)(e.rendererConfig,"mismatchAlpha")},renderReady(){const n=(0,S.getContainingView)(e);return e.modificationsReady&&e.currSortBpPerPx===n.bpPerPx&&t()}}}).views(e=>{const{trackMenuItems:t,renderPropsPre:n,renderProps:r,colorSchemeSubMenuItems:a}=e;return{renderPropsPre(){const{sortedBy:t,showSoftClipping:r,visibleModifications:a,simplexModifications:o}=e;return{...n(),showSoftClip:r,sortedBy:t,visibleModifications:Object.fromEntries(a.toJSON()),simplexModifications:[...o]}},renderProps(){const{sortReady:t}=e,n=r();return{...n,notReady:n.notReady||!t}},trackMenuItems:()=>[...t(),{label:"Sort by...",icon:U.A,disabled:e.showSoftClipping,subMenu:[...["Start location","Read strand","Base pair"].map(t=>({label:t,onClick:()=>{e.setSortedBy(t)}})),{label:"Sort by tag...",onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[pe,{model:e,handleClose:t}])}},{label:"Clear sort",onClick:()=>{e.clearSelected()}}]},{label:"Color by...",icon:W.A,subMenu:[{label:"Pair orientation",onClick:()=>{e.setColorScheme({type:"pairOrientation"})}},{label:"Modifications",type:"subMenu",subMenu:e.modificationsReady?[{label:`All modifications (>= ${e.modificationThreshold}% prob)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{threshold:e.modificationThreshold}})}},...e.visibleModificationTypes.map(t=>({label:`Show only ${ue.R[t]?.name||t}  (>= ${e.modificationThreshold}% prob)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t,threshold:e.modificationThreshold}})}})),{type:"divider"},{label:"All modifications (<50% prob colored blue)",onClick:()=>{e.setColorScheme({type:"modifications",modifications:{twoColor:!0,threshold:e.modificationThreshold}})}},...e.visibleModificationTypes.map(t=>({label:`Show only ${ue.R[t]?.name||t} (<50% prob colored blue)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t,twoColor:!0,threshold:e.modificationThreshold}})}})),{type:"divider"},{label:"All reference CpGs",onClick:()=>{e.setColorScheme({type:"methylation",modifications:{threshold:e.modificationThreshold}})}},{type:"divider"},{label:`Adjust threshold (${e.modificationThreshold}%)`,onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[ge,{model:e,handleClose:t}])}}]:[{label:"Loading modifications...",onClick:()=>{}}]},{label:"Insert size",onClick:()=>{e.setColorScheme({type:"insertSize"})}},...a()]},{label:"Group by...",icon:q.A,onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[he,{model:e,handleClose:t}])}},{label:"Show soft clipping",icon:_.A,type:"checkbox",checked:e.showSoftClipping,onClick:()=>{e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:()=>{e.toggleMismatchAlpha()}}]}}).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(7796).then(n.bind(n,85415));t(e)}catch(t){(0,S.getSession)(e).notifyError(`${t}`,t),console.error(t)}})()}}))};function fe(e){e.addDisplayType(()=>{const t=$(e);return new A.A({name:"LinearPileupDisplay",displayName:"Pileup display",configSchema:t,stateModel:me(t),subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:D.GQ})})}function ye(){return c.types.model("LinearReadDisplayBaseMixin",{filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen()}).volatile(()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null})).actions(e=>({setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},setRef(t){e.ref=t},setColorScheme(t){e.colorBySetting={...t}},setChainData(t){e.chainData=t},setFilterBy(t){e.filterBySetting={...t}}})).views(e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx}}))}var be=n(48747);const we=(0,a.lazy)(()=>n.e(130).then(n.bind(n,40130)));function ve(e){return{label:"Color scheme",icon:be.A,subMenu:[{label:"Insert size ± 3σ and orientation",onClick:()=>{e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size ± 3σ",onClick:()=>{e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:()=>{e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:()=>{e.setColorScheme({type:"gradient"})}}]}}function Se(e){return{label:"Filter by",icon:X.A,onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[we,{model:e,handleClose:t}])}}}const xe=function(e){return c.types.compose("LinearReadArcsDisplay",g.BaseDisplay,(0,D._e)(),(0,D.e6)(),ye(),c.types.model({type:c.types.literal("LinearReadArcsDisplay"),configuration:(0,i.ConfigurationReference)(e),lineWidth:c.types.maybe(c.types.number),jitter:c.types.maybe(c.types.number),drawInter:!0,drawLongRange:!0})).views(e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")}})).actions(e=>({reload(){e.error=void 0},setDrawInter(t){e.drawInter=t},setDrawLongRange(t){e.drawLongRange=t},setLineWidth(t){e.lineWidth=t},setJitter(t){e.jitter=t}})).views(e=>({get lineWidthSetting(){return e.lineWidth??(0,i.getConf)(e,"lineWidth")},get jitterVal(){return e.jitter??(0,i.getConf)(e,"jitter")}})).views(e=>{const{trackMenuItems:t,renderProps:n}=e;return{renderProps:()=>({...n(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),Se(e),{label:"Line width",subMenu:[{label:"Thin",onClick:()=>{e.setLineWidth(1)}},{label:"Bold",onClick:()=>{e.setLineWidth(2)}},{label:"Extra bold",onClick:()=>{e.setLineWidth(5)}}]},{label:"Jitter x-positions",subMenu:[{type:"checkbox",checked:0===e.jitterVal,label:"None",onClick:()=>{e.setJitter(0)}},{type:"checkbox",checked:2===e.jitterVal,label:"Small",onClick:()=>{e.setJitter(2)}},{type:"checkbox",checked:10===e.jitterVal,label:"Large",onClick:()=>{e.setJitter(10)}}]},{label:"Draw inter-region vertical lines",type:"checkbox",checked:e.drawInter,onClick:()=>{e.setDrawInter(!e.drawInter)}},{label:"Draw long range connections",type:"checkbox",checked:e.drawLongRange,onClick:()=>{e.setDrawLongRange(!e.drawLongRange)}},ve(e)]}}).views(e=>({async renderSvg(t){const{renderSvg:r}=await n.e(9584).then(n.bind(n,59584)),{drawFeats:a}=await n.e(3304).then(n.bind(n,63304));return r(e,t,a)}})).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(9070).then(n.bind(n,9070)),{drawFeats:r}=await n.e(3304).then(n.bind(n,63304));t(e,r)}catch(t){console.error(t),e.setError(t)}})()}}))};function Ce(e){e.addDisplayType(()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearReadArcsDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},lineWidth:{type:"number",description:"set arc line width",defaultValue:1},jitter:{type:"number",description:"jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them",defaultValue:0},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}},filterBy:{type:"frozen",defaultValue:G.JD}},{baseConfiguration:(0,D.lw)(e),explicitlyTyped:!0})}(e);return new A.A({name:"LinearReadArcsDisplay",displayName:"Read arc display",configSchema:t,stateModel:xe(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,a.lazy)(()=>n.e(2424).then(n.bind(n,52424)))})})}const ke=(0,a.lazy)(()=>n.e(5225).then(n.bind(n,85225))),Te=function(e){return c.types.compose("LinearReadCloudDisplay",g.BaseDisplay,(0,D._e)(),(0,D.e6)(),ye(),c.types.model("LinearReadDisplayWithLayoutMixin",{}).volatile(()=>({featureLayout:void 0,mouseoverRef:null,featuresForFlatbush:[]})).actions(e=>({setFeatureLayout(t){e.featureLayout=t},setMouseoverRef(t){e.mouseoverRef=t},setFeaturesForFlatbush(t){e.featuresForFlatbush=t}})),c.types.model("LinearReadDisplayWithPairFiltersMixin",{drawSingletons:!0,drawProperPairs:!0,flipStrandLongReadChains:!0,featureHeight:c.types.maybe(c.types.number)}).actions(e=>({setDrawSingletons(t){e.drawSingletons=t},setDrawProperPairs(t){e.drawProperPairs=t},setFlipStrandLongReadChains(t){e.flipStrandLongReadChains=t},setFeatureHeight(t){e.featureHeight=t}})),c.types.model({type:c.types.literal("LinearReadCloudDisplay"),configuration:(0,i.ConfigurationReference)(e),drawCloud:!1,noSpacing:c.types.maybe(c.types.boolean),trackMaxHeight:c.types.maybe(c.types.number)})).volatile(()=>({layoutHeight:0})).views(e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")},get featureHeightSetting(){return e.featureHeight??(0,i.getConf)(e,"featureHeight")}})).actions(e=>({reload(){e.error=void 0},setNoSpacing(t){e.noSpacing=t},setMaxHeight(t){e.trackMaxHeight=t},setLayoutHeight(t){e.layoutHeight=t},selectFeature(t){const n=(0,S.getSession)(e),r=function(e){if(0===e.length)throw new Error("Chain cannot be empty");const t=e[0];return new S.SimpleFeature({uniqueId:t.id,id:t.id,name:t.name,refName:t.refName,start:Math.min(...e.map(e=>e.start)),end:Math.max(...e.map(e=>e.end)),strand:t.strand,flags:t.flags,tlen:t.tlen,pair_orientation:t.pair_orientation,clipPos:t.clipPos,...t.next_ref&&{next_ref:t.next_ref},...void 0!==t.next_pos&&{next_pos:t.next_pos},...t.SA&&{SA:t.SA},subfeatures:e.map((e,t)=>({uniqueId:`${e.id}_${t}`,id:`${e.id}_${t}`,name:e.name,refName:e.refName,start:e.start,end:e.end,strand:e.strand,type:"alignment_part",flags:e.flags,tlen:e.tlen,pair_orientation:e.pair_orientation,clipPos:e.clipPos,...e.next_ref&&{next_ref:e.next_ref},...void 0!==e.next_pos&&{next_pos:e.next_pos},...e.SA&&{SA:e.SA}}))})}(t);if((0,S.isSessionModelWithWidgets)(n)){const t=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:r.toJSON(),view:(0,S.getContainingView)(e),track:(0,S.getContainingTrack)(e)});n.showWidget(t)}n.setSelection(r)},setDrawCloud(t){e.drawCloud=t}})).views(e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Set feature height...",subMenu:[{label:"Normal",onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",onClick:()=>{e.setFeatureHeight(3),e.setNoSpacing(!0)}},{label:"Manually set height...",onClick:()=>{(0,S.getSession)(e).queueDialog(t=>[ke,{model:e,handleClose:t}])}}]},{label:"Toggle read cloud (y-coordinate proportional to TLEN)",type:"checkbox",checked:e.drawCloud,onClick:()=>{e.setDrawCloud(!e.drawCloud)}},{label:"Draw singletons",type:"checkbox",checked:e.drawSingletons,onClick:()=>{e.setDrawSingletons(!e.drawSingletons)}},{label:"Draw proper pairs",type:"checkbox",checked:e.drawProperPairs,onClick:()=>{e.setDrawProperPairs(!e.drawProperPairs)}},{label:"Flip strand relative to primary alignment for long read chains",type:"checkbox",checked:e.flipStrandLongReadChains,onClick:()=>{e.setFlipStrandLongReadChains(!e.flipStrandLongReadChains)}},Se(e),ve(e)],async renderSvg(t){const{renderSvg:r}=await n.e(9584).then(n.bind(n,59584));if(e.drawCloud){const{drawFeats:a}=await Promise.all([n.e(3241),n.e(3099)]).then(n.bind(n,73099));return r(e,t,a)}{const{drawFeats:a}=await Promise.all([n.e(3241),n.e(898)]).then(n.bind(n,80898));return r(e,t,a)}}}}).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(9070).then(n.bind(n,9070)),{drawFeats:r}=await Promise.all([n.e(3241),n.e(3462)]).then(n.bind(n,23462));t(e,r)}catch(t){console.error(t),e.setError(t)}})()}}))};function Ae(e){e.addDisplayType(()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearReadCloudDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},featureHeight:{type:"number",defaultValue:7},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}},filterBy:{type:"frozen",defaultValue:G.JD}},{baseConfiguration:(0,D.lw)(e),explicitlyTyped:!0})}(e);return new A.A({name:"LinearReadCloudDisplay",displayName:"Linked reads display",configSchema:t,stateModel:Te(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,a.lazy)(()=>n.e(8408).then(n.bind(n,48408)))})})}var Me=n(11210),Pe=n(99412);const Re=(0,a.lazy)(()=>n.e(3678).then(n.bind(n,63678))),Ie=new Map([["snpcoverage","SNPCoverageRenderer"]]),Le=function(e,t){return c.types.compose("LinearSNPCoverageDisplay",(0,Me._i)(e,t),c.types.model({type:c.types.literal("LinearSNPCoverageDisplay"),showInterbaseCounts:c.types.maybe(c.types.boolean),showInterbaseIndicators:c.types.maybe(c.types.boolean),showArcs:c.types.maybe(c.types.boolean),filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[])})).volatile(()=>({visibleModifications:V.observable.map({}),simplexModifications:new Set,modificationsReady:!1})).views(e=>({get colorBy(){return e.colorBySetting??(0,i.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,i.getConf)(e,"filterBy")}})).actions(e=>({setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setColorScheme(t){e.colorBySetting=t?{...t}:void 0},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)},updateVisibleModifications(t){for(const n of t)e.visibleModifications.has(n.type)||e.visibleModifications.set(n.type,{...n,color:(0,ee.rT)(n.type)})},setSimplexModifications(t){e.simplexModifications=new Set(t)}})).views(e=>{const{adapterProps:t}=e;return{get modificationThreshold(){return e.colorBy?.modifications?.threshold??10},get rendererConfig(){const t=(0,i.getConf)(e,["renderers",e.rendererTypeName])||{},{showArcs:n,showInterbaseCounts:r,showInterbaseIndicators:a}=e;return e.rendererType.configSchema.create({...t,showInterbaseCounts:r??t.showInterbaseCounts,showInterbaseIndicators:a??t.showInterbaseIndicators,showArcs:n??t.showArcs},(0,c.getEnv)(e))},get showArcsSetting(){return e.showArcs??(0,i.readConfObject)(this.rendererConfig,"showArcs")},get showInterbaseCountsSetting(){return e.showInterbaseCounts??(0,i.readConfObject)(this.rendererConfig,"showInterbaseCounts")},get showInterbaseIndicatorsSetting(){return e.showInterbaseIndicators??(0,i.readConfObject)(this.rendererConfig,"showInterbaseIndicators")},get autorunReady(){return(0,S.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error},adapterProps(){const n=t(),{filters:r,filterBy:a}=e;return{...n,filters:r,filterBy:a,modificationThreshold:this.modificationThreshold}}}}).actions(e=>({setModificationsReady(t){e.modificationsReady=t},setShowInterbaseIndicators(t){e.showInterbaseIndicators=t},setShowInterbaseCounts(t){e.showInterbaseCounts=t},setShowArcs(t){e.showArcs=t}})).actions(e=>({afterAttach(){(0,ee.vi)(e,async()=>{if(e.setModificationsReady(!1),!e.autorunReady)return;const t=(0,S.getContainingView)(e),{staticBlocks:n}=t,{colorBy:r}=e;if("modifications"===r?.type){const{modifications:t,simplexModifications:r}=await(0,Pe.D)({model:e,adapterConfig:(0,i.getConf)(e.parentTrack,"adapter"),blocks:n});(0,c.isAlive)(e)&&(e.updateVisibleModifications(t),e.setSimplexModifications(r),e.setModificationsReady(!0))}else e.setModificationsReady(!0)},{delay:1e3})}})).views(e=>{const{renderProps:t,trackMenuItems:n}=e;return{renderReady:()=>!t().notReady&&e.modificationsReady,renderProps(){const{colorBy:n,visibleModifications:r,simplexModifications:a}=e;return{...t(),notReady:!this.renderReady(),colorBy:n,visibleModifications:Object.fromEntries(r.toJSON()),simplexModifications:[...a]}},get TooltipComponent(){return Re},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:(0,i.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return Ie.get("snpcoverage")},get graphType(){return!0},contextMenuItems:()=>[],trackMenuItems:()=>[...n(),{label:"Show insertion/clipping indicators",icon:_.A,type:"checkbox",checked:e.showInterbaseIndicatorsSetting,onClick:()=>{e.setShowInterbaseIndicators(!e.showInterbaseIndicatorsSetting)}},{label:"Show insertion/clipping counts",icon:_.A,type:"checkbox",checked:e.showInterbaseCountsSetting,onClick:()=>{e.setShowInterbaseCounts(!e.showInterbaseCountsSetting)}},{label:"Show arcs",icon:_.A,type:"checkbox",checked:e.showArcsSetting,onClick:()=>{e.setShowArcs(!e.showArcsSetting)}}],get filters(){return new J.A({filters:e.jexlFilters})}}})};function Fe(e){e.addDisplayType(()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:c.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:c.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:e.getRendererType("SNPCoverageRenderer").configSchema}),colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:G.JD}},{baseConfiguration:D.Ki,explicitlyTyped:!0})}(e);return new A.A({name:"LinearSNPCoverageDisplay",displayName:"SNPCoverage display",configSchema:t,stateModel:Le(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Me.r})})}var Ne=n(3496),De=n(44728),Be=n(82088),je=n(95805),Ve=n(2406);class Ee extends Ve.A{async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n?.session?.assemblyManager;if(!r)throw new Error("no assembly manager available");const a=await(0,S.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}}class ze extends Ee{name="PileupGetReducedFeatures";async execute(e,t){const n=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:a,regions:o}=n,i=(await(0,Ne.cK)(this.pluginManager,a,r)).dataAdapter,s=await(0,De._)(i.getFeaturesInMultipleRegions(o,n).pipe((0,Be.$)())),l=(0,S.dedupe)(s.map(e=>({id:e.id(),refName:e.get("refName"),name:e.get("name"),start:e.get("start"),strand:e.get("strand"),end:e.get("end"),flags:e.get("flags"),tlen:e.get("template_length"),pair_orientation:e.get("pair_orientation"),next_ref:e.get("next_ref"),next_pos:e.get("next_pos"),clipPos:(0,je.getClip)(e.get("CIGAR"),e.get("strand")),SA:e.get("tags")?.SA})),e=>e.id),c=l.filter(e=>2&e.flags&&!(256&e.flags)&&!(2048&e.flags)),d=c.length?function(e){const t=e.map(e=>Math.abs(e.tlen)),n=t.reduce((e,t)=>e+t,0),r=t.map(e=>e*e).reduce((e,t)=>e+t,0),a=t.length,o=n/a,i=Math.sqrt((a*r-n*n)/(a*a));return{upper:o+4*i,lower:o-3*i,avg:o,sd:i}}(c):void 0,u=(0,S.groupBy)(l,e=>e.name);return{chains:Object.values(u),stats:d,hasPaired:!!d,containsNoTransferables:!0}}}var Oe=n(94026);function He(e){const t=[],n=e.split(";");for(let e=0,r=n.length;e<r;e++){const r=n[e];if(""===r)continue;const a=r.split(",")[0],o=Oe.k.exec(a);if(!o)throw new Error(`bad format for MM tag: "${r}"`);const i=o[1],s=o[2],l=o[3].split(/(\d+|.)/);for(let e=0,n=l.length;e<n;e++){const n=l[e];""!==n&&t.push({type:n,base:i,strand:s})}}return t}class Ge extends Ee{name="PileupGetVisibleModifications";async execute(e,t){const n=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:a,regions:o}=n,i=(await(0,Ne.cK)(this.pluginManager,a,r)).dataAdapter,s=await(0,De._)(i.getFeaturesInMultipleRegions(o,n).pipe((0,Be.$)())),l=new Map;for(const e of s){const t=(0,ee.c$)(e,"MM","Mm");for(const e of He("string"==typeof t?t:"")){const t=`${e.base}${e.strand}${e.type}`;l.has(t)||l.set(t,e)}}const c=[...l.values()],d=function(e){const t=new Set,n=new Set;for(const n of e){const e=n;"-"===e.strand&&t.add(e.type)}for(const r of e){const e=r;"+"!==e.strand||t.has(e.type)||n.add(e.type)}return n}(c),u=new Map;for(const e of c)u.has(e.type)||u.set(e.type,e);return{modifications:[...u.values()],simplexModifications:[...d]}}}class $e extends Ee{name="PileupGetGlobalValueForTag";async execute(e,t){const n=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:a,regions:o,tag:i}=n,s=(await(0,Ne.cK)(this.pluginManager,a,r)).dataAdapter.getFeaturesInMultipleRegions(o,n),l=await(0,De._)(s.pipe((0,Be.$)()));return[...new Set(l.map(e=>e.get("tags")?.[i]).filter(e=>void 0!==e).map(e=>`${e}`))]}}function We(e){e.addRpcMethod(()=>new $e(e)),e.addRpcMethod(()=>new Ge(e)),e.addRpcMethod(()=>new ze(e))}var Ue=n(98111),_e=n(31415);class qe extends _e.h{constructor(e){super(e),this.props=e}update(e){return super.update(e),this.props=e,this}cachedLayoutIsValid(e){return super.cachedLayoutIsValid(e)&&this.props.showSoftClip===e.props.showSoftClip&&j()(this.props.sortedBy,e.props.sortedBy)&&j()(this.props.filterBy,e.props.filterBy)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),props:this.props}),this.cachedLayout.layout}}class Je extends Ue.default{supportsSVG=!0;async fetchSequence(e,t){const{sessionId:n,adapterConfig:r}=e,{sequenceAdapter:a}=r;if(!a)return;const{dataAdapter:o}=await(0,Ne.cK)(this.pluginManager,n,a);return(0,ee.Iw)({...t,start:Math.max(0,t.start-1),end:t.end+1},o)}getExpandedRegion(e,t){const{config:n,showSoftClip:r}=t,{start:a,end:o}=e,s=(0,i.readConfObject)(n,"maxClippingSize"),l=r?Math.round(s):0;return{...e,start:Math.floor(Math.max(a-l,0)),end:Math.ceil(o+l)}}async render(e){const t=await this.getFeatures(e),r=this.createLayoutInWorker(e),{statusCallback:a=()=>{},colorBy:o,regions:s,bpPerPx:l}=e,c=s[0],d=(c.end-c.start)/l,{layoutRecords:u,height:p}=await(0,S.updateStatus)("Creating layout",a,()=>function(e){const{layout:t,features:n,sortedBy:r,config:a,bpPerPx:o,showSoftClip:s,regions:l}=e,c=l[0],d=r?.type&&c.start===r.pos?((e,t)=>{const n=Array.from(e.values()),r=[],a=[],{pos:o,type:i}=t;for(const e of n){const t=e,n=t.get("start"),i=t.get("end");(0,S.doesIntersect2)(o-1,o,n,i)?r.push(e):a.push(e)}const s=!!n.length&&n[0].get("tags");switch(i){case"Start location":r.sort((e,t)=>e.get("start")-t.get("start"));break;case"tag":{const e=t.tag,n=(e,t)=>s?e.get("tags")[t]:e.get(t);r[0]&&"string"==typeof n(r[0],e)?r.sort((t,r)=>n(r,e).localeCompare(n(t,e))):r.sort((t,r)=>(n(r,e)||0)-(n(t,e)||0));break}case"Base pair":{const e=[];for(const t of r){const n=t.get("mismatches");for(const r of n){const n=t.get("start")+r.start+1,a="insertion"===r.type||"softclip"===r.type?0:r.length;o>=n&&o<n+a&&e.push([t.id(),r])}}const t=new Map(e);r.sort((e,n)=>{const r=t.get(e.id()),a=t.get(n.id()),o=a?.base.toUpperCase(),i=r?.base.toUpperCase();return o===i&&"*"===o?r.length-a.length:(o?o.charCodeAt(0):0)-(i?i.charCodeAt(0):0)});break}case"Read strand":r.sort((e,t)=>e.get("strand")<=t.get("strand")?1:-1)}return new Map([...r,...a].map(e=>[e.id(),e]))})(n,r):n,u=(0,i.readConfObject)(a,"height"),p=(0,i.readConfObject)(a,"displayMode"),h=(0,S.iterMap)(d.values(),e=>function({feature:e,layout:t,bpPerPx:n,region:r,showSoftClip:a,heightPx:o,displayMode:i}){let s=0,l=0;if(a){const t=e.get("mismatches");if(e.get("seq"))for(const{type:e,start:n,cliplen:r=0}of t)"softclip"===e&&(0===n?s=r:l=r)}const[c,d]=(0,S.bpSpanPx)(e.get("start")-s,e.get("end")+l,r,n);if("compact"===i&&(o/=3),e.get("refName")!==r.refName)throw new Error(`feature ${e.id()} is not on the current region's reference sequence ${r.refName}`);const u=t.addRect(e.id(),e.get("start")-s,e.get("end")+l,o,e);return null===u?null:{feature:e,leftPx:c,rightPx:d,topPx:"collapse"===i?0:u,heightPx:o}}({feature:e,layout:t,bpPerPx:o,region:c,showSoftClip:s,heightPx:u,displayMode:p}),d.size).filter(S.notEmpty);return{layoutRecords:h,height:Math.max(t.getTotalHeight(),1)}}({...e,features:t,layout:r})),h=await(0,S.updateStatus)("Rendering alignments",a,async()=>{const a="methylation"===o?.type&&t.size?await this.fetchSequence(e,c):void 0,{makeImageData:i}=await n.e(2812).then(n.bind(n,72812));return(0,S.renderToAbstractCanvas)(d,p,e,n=>i({ctx:n,layoutRecords:u,canvasWidth:d,renderArgs:{...e,layout:r,features:t,regionSequence:a}}))});return{...await super.render({...e,...h,features:t,layout:r,height:p,width:d}),...h,features:new Map,layout:r,height:p,width:d,maxHeightReached:r.maxHeightReached,containsNoTransferables:!0}}createLayoutSession(e){return new qe(e)}}var Xe=n(65944);const Ye=(0,P.observer)(function(e){const{onMouseMove:t,blockKey:n,displayModel:r,width:o,height:i,regions:s,bpPerPx:l,sortedBy:c,colorBy:d,filterBy:u,flatbush:p,items:h}=e,g=(0,a.useMemo)(()=>Xe.A.from(p),[p]),{selectedFeatureId:m,featureIdUnderMouse:f,contextMenuFeature:y}=r||{},[b,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{w(!0)},[]);const v=s[0],x=(0,a.useRef)(null),[C,k]=(0,a.useState)(!1),[T,A]=(0,a.useState)(!1),P=m?r?.getFeatureByID(n,m):void 0,R=f||y?.id(),L=R?r?.getFeatureByID(n,R):void 0;function F(e,t=2){const[n,r,a,o]=e,[i,s]=(0,S.bpSpanPx)(n,a,v,l);return{left:i-t,top:Math.round(r)-t,width:s-i,height:Math.round(o-r)}}const N=P?F(P):void 0,D=L?F(L,0):void 0;function B(t,n){const r=e[`onFeature${t}`],a=e[`on${t}`];r&&f?r(n,f):a&&a(n,f)}const j=Math.ceil(o);return(0,I.jsxs)("div",{ref:x,"data-testid":["pileup-overlay",c?.type,d?.type,d?.tag,u?.tagFilter?.tag].filter(e=>!!e).join("-"),style:{position:"relative",width:j,height:i},onMouseDown:e=>{!function(e){k(!0),A(!1),B("MouseDown",e)}(e)},onMouseEnter:e=>{!function(e){B("MouseEnter",e)}(e)},onMouseOut:e=>{!function(e){B("MouseOut",e),B("MouseLeave",e)}(e)},onMouseOver:e=>{!function(e){B("MouseOver",e)}(e)},onMouseUp:e=>{!function(e){k(!1),B("MouseUp",e)}(e)},onMouseLeave:e=>{!function(e){B("MouseOut",e),B("MouseLeave",e)}(e)},onMouseMove:e=>{!function(e){if(!x.current)return;C&&A(!0);const a=x.current.getBoundingClientRect(),i=e.clientX-a.left,s=e.clientY-a.top,c=v.reversed?o-i:i,d=v.start+l*c,u=g.search(i,s,i+1,s+1),p=u.length?h[u[0]]:void 0,m=p?"insertion"===p.type?`Insertion: ${p.seq}`:"deletion"===p.type?`Deletion: ${p.seq}bp`:"modification"===p.type?p.seq:`Mismatch: ${p.seq}`:void 0;t?.(e,r?.getFeatureOverlapping(n,d,s),m)}(e)},onClick:e=>{!function(e){T||B("Click",e)}(e)},onContextMenu:e=>{!function(e){B("ContextMenu",e)}(e)},onFocus:()=>{},onBlur:()=>{},children:[(0,I.jsx)(M.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:0}}),b&&D?(0,I.jsx)("div",{style:{position:"absolute",backgroundColor:"#0003",pointerEvents:"none",...D}}):null,b&&N?(0,I.jsx)("div",{style:{position:"absolute",border:"2px solid #00b8ff",boxSizing:"content-box",pointerEvents:"none",...N}}):null]})}),Ke=(0,i.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:c.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orientation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:c.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:1},hideSmallIndels:{type:"boolean",description:"Hides small indels, sometimes occurring in long read sequencing",defaultValue:!1},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function Qe(e){e.addRendererType(()=>new Je({name:"PileupRenderer",displayName:"Pileup renderer",ReactComponent:Ye,configSchema:Ke,pluginManager:e}))}const Ze=(0,i.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0});function et(e){e.addAdapterType(()=>new f.A({name:"SNPCoverageAdapter",displayName:"SNPCoverage adapter",adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(2947).then(n.bind(n,52947)).then(e=>e.default),configSchema:Ze}))}class tt extends Me.er{async draw(e,t){const{statusCallback:r=()=>{}}=t,{makeImage:a}=await n.e(7192).then(n.bind(n,37192));await(0,S.updateStatus)("Rendering coverage",r,()=>a(e,t))}}const nt=(0,i.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},showArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},showInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},showInterbaseIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0},color:{type:"color",description:"Background color for the SNPCoverage renderer",defaultValue:"#d3d3d3"}},{explicitlyTyped:!0});function rt(e){e.addRendererType(()=>new tt({name:"SNPCoverageRenderer",ReactComponent:Me.Ep,configSchema:nt,pluginManager:e}))}class at extends r.A{name="AlignmentsPlugin";install(e){[b,v,fe,Fe,m,et,T,Qe,We,rt,Ce,Ae,H,u,C].map(t=>{t(e)})}}},18010:(e,t,n)=>{n.d(t,{Nw:()=>o,T9:()=>i,bV:()=>s,pv:()=>l});var r=n(13862),a=n(70777);let o,i,s;function l(e,t){e.serializedCommands?new r.CanvasSequence(e.serializedCommands).execute(t):t.drawImage(e,0,0)}const c="function"==typeof OffscreenCanvas,d=n.n(a)();c?(o=(e,t)=>new OffscreenCanvas(e,t),i=window.createImageBitmap||self.createImageBitmap,s=window.ImageBitmap||self.ImageBitmap):d?(o=(...e)=>nodeCreateCanvas(...e),i=async e=>{const t=e.toDataURL(),n=new nodeImage;return new Promise((e,r)=>{n.onload=()=>{e(n)},n.onerror=r,n.src=t})}):(o=(e,t)=>{const n=new r.CanvasSequence;return{width:e,height:t,getContext:()=>n}},i=async e=>{const t=e.getContext("2d");return{height:e.height,width:e.width,serializedCommands:t.toJSON(),containsNoTransferables:!0}},s=String)},20166:(e,t,n)=>{n.d(t,{Kp:()=>d,R1:()=>c,Yo:()=>s,pB:()=>i,zm:()=>l});var r=n(89592),a=n(3862);class o extends Error{}function i(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw l()}}async function s(e){await new Promise(e=>setTimeout(e,1)),i(e)}function l(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");const e=new o("aborted");return e.code="ERR_ABORTED",e}function c(e){return e?(0,a.R)(e,"abort"):new r.c}function d(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||/\b(aborted|aborterror)\b/i.test(e.message))}},20195:(e,t,n)=>{n.d(t,{A:()=>y});var r=n(99546),a=n(51414),o=n(68446),i=n(75785),s=n(67758),l=n(67112),c=n(9236),d=n(10424),u=n.n(d),p=n(69500);function h(e){const t=(0,s.c)(9),{source:n}=e;let r,a;t[0]!==n.color?(r=n.color?(0,p.jsx)("div",{style:{width:10,height:10,backgroundColor:n.color}}):null,t[0]=n.color,t[1]=r):r=t[1],t[2]!==n?(a=Object.entries(n).filter(m).map(g),t[2]=n,t[3]=a):a=t[3];const o=a.join("<br/>");let i,d;return t[4]!==o?(i=(0,p.jsx)(l.SanitizedHTML,{html:o}),t[4]=o,t[5]=i):i=t[5],t[6]!==r||t[7]!==i?(d=(0,p.jsxs)(c.A,{children:[r,i]}),t[6]=r,t[7]=i,t[8]=d):d=t[8],d}function g(e){const[t,n]=e;return`${t}:${u()(`${n}`)}`}function m(e){const[t,n]=e;return"color"!==t&&"HP"!==t&&"name"!==t&&"id"!==t&&void 0!==n}const f=(0,i.n9)()({rel:{position:"relative"},cursor:{pointerEvents:"none",zIndex:800,position:"absolute"},color:{width:10,height:10}}),y=(0,o.observer)(function({mouseX:e,mouseY:t,model:n}){const{classes:o}=f(),i=(0,a.A)(),{hoveredGenotype:s,height:l,scrollTop:c,sourceMap:d}=n,{width:u}=(0,r.getContainingView)(n),g=s?d?.[s.name]:void 0,m=t-c;return(0,p.jsxs)("div",{className:o.rel,children:[(0,p.jsxs)("svg",{className:o.cursor,width:u,height:l,style:{top:c},children:[(0,p.jsx)("line",{x1:0,x2:u,y1:m,y2:m,stroke:i.palette.text.primary}),(0,p.jsx)("line",{x1:e,x2:e,y1:0,y2:l,stroke:i.palette.text.primary})]}),g?(0,p.jsx)(h,{source:{...g,...s}}):null]})})},20952:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(58921),a=n(68584),o=n(1622);const i=(0,a.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:o.baseConnectionConfig,preProcessSnapshot:e=>e.uri?{...e,hubTxtLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=n(36422);function l(e){return s.types.compose("UCSCTrackHubConnection",(0,o.BaseConnectionModelFactory)(e),s.types.model({configuration:(0,a.ConfigurationReference)(i),type:s.types.literal("UCSCTrackHubConnection")})).actions(e=>({async connect(){const{doConnect:t}=await n.e(8442).then(n.bind(n,78442));t(e)}}))}function c(e){e.addConnectionType(()=>new r.ConnectionType({name:"UCSCTrackHubConnection",configSchema:i,stateModel:l(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"https://genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"}))}},21311:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(67758),a=n(75785),o=n(69500);const i=(0,a.n9)()(e=>({bg:{padding:4,margin:4,overflow:"auto",maxHeight:200,background:"dark"===e.palette.mode?"#833":"#f88",border:`1px solid ${e.palette.divider}`}}));function s(e){const t=(0,r.c)(3),{children:n}=e,{classes:a}=i();let s;return t[0]!==n||t[1]!==a.bg?(s=(0,o.jsx)("div",{className:a.bg,children:n}),t[0]=n,t[1]=a.bg,t[2]=s):s=t[2],s}},21479:(e,t,n)=>{n.d(t,{OX:()=>s,W7:()=>i,bf:()=>l});var r=n(99546),a=n(91468),o=n(36422);function i(e){return Math.floor(e/1e6)>0?`${Number.parseFloat((e/1e6).toPrecision(3))} Mb`:Math.floor(e/1e3)>0?`${Number.parseFloat((e/1e3).toPrecision(3))} Kb`:`${Math.floor(e)} bytes`}function s(e,t){const n="undefined"==typeof jest;return["clip",n?e:"jest",t,n?Math.random():""].filter(e=>!!e).join("-")}async function l(e){const t=(0,r.getContainingView)(e).staticBlocks.contentBlocks,{rpcManager:n}=(0,r.getSession)(e),{adapterConfig:i}=e;if(!i)return{};const s=(0,a.getRpcSessionId)(e);return n.call(s,"CoreGetFeatureDensityStats",{sessionId:s,regions:t,adapterConfig:i,statusCallback:t=>{(0,o.isAlive)(e)&&e.setMessage(t)}})}},23516:(e,t,n)=>{n.d(t,{A:()=>qa});var r=n(16062),a=n(12678),o=n(40898),i=n(92880);class s extends i.default{}var l=n(67758),c=n(7552),d=n(68584),u=n(99546),p=n(68446),h=n(69500);const g=(0,c.lazy)(()=>n.e(2241).then(n.bind(n,72241)));function m(e){const t=(0,l.c)(45),{selectedFeatureId:n,region:r,bpPerPx:a,config:o,height:i,feature:s,onFeatureClick:p}=e,[m,f]=(0,c.useState)(!1);let y;t[0]!==a||t[1]!==s||t[2]!==r?(y=(0,u.bpSpanPx)(s.get("start"),s.get("end"),r,a),t[0]=a,t[1]=s,t[2]=r,t[3]=y):y=t[3];const[b,w]=y;let v;t[4]!==s?(v=s.id(),t[4]=s,t[5]=v):v=t[5];const S=v,x=n&&n===s.id(),C=x?"red":(0,d.readConfObject)(o,"color",{feature:s}),k=x?"red":"black";let T;t[6]!==o||t[7]!==s?(T=(0,d.readConfObject)(o,"label",{feature:s}),t[6]=o,t[7]=s,t[8]=T):T=t[8];const A=T;let M;t[9]!==o||t[10]!==s?(M=(0,d.readConfObject)(o,"caption",{feature:s}),t[9]=o,t[10]=s,t[11]=M):M=t[11];const P=M;let R;t[12]!==o||t[13]!==s?(R=(0,d.readConfObject)(o,"thickness",{feature:s})||2,t[12]=o,t[13]=s,t[14]=R):R=t[14];const I=R;let L;t[15]!==o||t[16]!==s?(L=(0,d.readConfObject)(o,"height",{feature:s})||100,t[15]=o,t[16]=s,t[17]=L):L=t[17];const F=Math.min(L,i),N=(0,c.useRef)(null),D=.5*F*.75+.375*F,B=(0,u.getStrokeProps)(C),j=`M ${b} 0 C ${b} ${F}, ${w} ${F}, ${w} 0`;let V,E,z,O,H;t[18]!==S||t[19]!==p?(V=e=>{p(e,S)},t[18]=S,t[19]=p,t[20]=V):V=t[20],t[21]===Symbol.for("react.memo_cache_sentinel")?(E=()=>{f(!0)},z=()=>{f(!1)},t[21]=E,t[22]=z):(E=t[21],z=t[22]),t[23]!==I||t[24]!==B||t[25]!==j||t[26]!==V?(O=(0,h.jsx)("path",{ref:N,...B,d:j,strokeWidth:I,fill:"transparent",onClick:V,onMouseOver:E,onMouseLeave:z,pointerEvents:"stroke"}),t[23]=I,t[24]=B,t[25]=j,t[26]=V,t[27]=O):O=t[27],t[28]!==P||t[29]!==m?(H=m?(0,h.jsx)(c.Suspense,{fallback:null,children:(0,h.jsx)(g,{contents:P})}):null,t[28]=P,t[29]=m,t[30]=H):H=t[30];const G=b+(w-b)/2,$=D+3;let W;t[31]!==A||t[32]!==G||t[33]!==$?(W=(0,h.jsx)("text",{x:G,y:$,stroke:"white",strokeWidth:"0.6em",children:A}),t[31]=A,t[32]=G,t[33]=$,t[34]=W):W=t[34];const U=b+(w-b)/2,_=D+3;let q,J;return t[35]!==A||t[36]!==U||t[37]!==_||t[38]!==k?(q=(0,h.jsx)("text",{x:U,y:_,stroke:k,children:A}),t[35]=A,t[36]=U,t[37]=_,t[38]=k,t[39]=q):q=t[39],t[40]!==O||t[41]!==H||t[42]!==W||t[43]!==q?(J=(0,h.jsxs)("g",{children:[O,H,W,q]}),t[40]=O,t[41]=H,t[42]=W,t[43]=q,t[44]=J):J=t[44],J}function f(e,t,n,r){const a=(r-90)*Math.PI/180;return{x:e+n*Math.cos(a),y:t+n*Math.sin(a)}}function y(e){const t=(0,l.c)(45),{selectedFeatureId:n,region:r,bpPerPx:a,config:o,onFeatureClick:i,feature:s}=e,[p,m]=(0,c.useState)(!1);let y;t[0]!==a||t[1]!==s||t[2]!==r?(y=(0,u.bpSpanPx)(s.get("start"),s.get("end"),r,a),t[0]=a,t[1]=s,t[2]=r,t[3]=y):y=t[3];const[b,w]=y;let v;t[4]!==s?(v=s.id(),t[4]=s,t[5]=v):v=t[5];const S=v,x=n&&n===s.id(),C=x?"red":(0,d.readConfObject)(o,"color",{feature:s}),k=x?"red":"black";let T;t[6]!==o||t[7]!==s?(T=(0,d.readConfObject)(o,"label",{feature:s}),t[6]=o,t[7]=s,t[8]=T):T=t[8];const A=T;let M;t[9]!==o||t[10]!==s?(M=(0,d.readConfObject)(o,"caption",{feature:s}),t[9]=o,t[10]=s,t[11]=M):M=t[11];const P=M;let R;t[12]!==o||t[13]!==s?(R=(0,d.readConfObject)(o,"thickness",{feature:s})||2,t[12]=o,t[13]=s,t[14]=R):R=t[14];const I=R,L=(0,c.useRef)(null),F=(w-b)/2,N=b+(w-b)/2,D=(w-b)/2;let B;t[15]!==N||t[16]!==D?(B=function(e,t,n){const r=f(e,0,n,270),a=f(e,0,n,90),o="0";return["M",r.x,r.y,"A",n,n,0,o,0,a.x,a.y].join(" ")}(N,0,D),t[15]=N,t[16]=D,t[17]=B):B=t[17];const j=(0,u.getStrokeProps)(C);let V,E,z,O,H;t[18]!==S||t[19]!==i?(V=e=>{i(e,S)},t[18]=S,t[19]=i,t[20]=V):V=t[20],t[21]===Symbol.for("react.memo_cache_sentinel")?(E=()=>{m(!0)},z=()=>{m(!1)},t[21]=E,t[22]=z):(E=t[21],z=t[22]),t[23]!==I||t[24]!==V||t[25]!==B||t[26]!==j?(O=(0,h.jsx)("path",{d:B,...j,strokeWidth:I,fill:"transparent",onClick:V,onMouseOver:E,onMouseLeave:z,ref:L,pointerEvents:"stroke"}),t[23]=I,t[24]=V,t[25]=B,t[26]=j,t[27]=O):O=t[27],t[28]!==P||t[29]!==p?(H=p?(0,h.jsx)(g,{contents:P}):null,t[28]=P,t[29]=p,t[30]=H):H=t[30];const G=b+(w-b)/2,$=F+3;let W;t[31]!==A||t[32]!==G||t[33]!==$?(W=(0,h.jsx)("text",{x:G,y:$,stroke:"white",strokeWidth:"0.6em",children:A}),t[31]=A,t[32]=G,t[33]=$,t[34]=W):W=t[34];const U=b+(w-b)/2,_=F+3;let q,J;return t[35]!==A||t[36]!==U||t[37]!==_||t[38]!==k?(q=(0,h.jsx)("text",{x:U,y:_,stroke:k,children:A}),t[35]=A,t[36]=U,t[37]=_,t[38]=k,t[39]=q):q=t[39],t[40]!==O||t[41]!==H||t[42]!==W||t[43]!==q?(J=(0,h.jsxs)("g",{children:[O,H,W,q]}),t[40]=O,t[41]=H,t[42]=W,t[43]=q,t[44]=J):J=t[44],J}function b(e){const t=(0,l.c)(5),{exportSVG:n,width:r,height:a,children:o}=e;let i;return t[0]!==o||t[1]!==n||t[2]!==a||t[3]!==r?(i=n?o:(0,h.jsx)("svg",{width:r,height:a,children:o}),t[0]=o,t[1]=n,t[2]=a,t[3]=r,t[4]=i):i=t[4],i}const w=(0,p.observer)(function({features:e,config:t,regions:n,bpPerPx:r,height:a,exportSVG:o,displayModel:i,onFeatureClick:s}){const l=n[0],c=(l.end-l.start)/r,u="semicircles"===(0,d.readConfObject)(t,"displayMode"),{selectedFeatureId:p}=i||{};return(0,h.jsx)(b,{exportSVG:o,width:c,height:a,children:[...e.values()].map(e=>u?(0,h.jsx)(y,{config:t,region:l,bpPerPx:r,selectedFeatureId:p,onFeatureClick:s,feature:e},e.id()):(0,h.jsx)(m,{height:a,config:t,region:l,bpPerPx:r,selectedFeatureId:p,onFeatureClick:s,feature:e},e.id()))})});var v=n(36422);const S=(0,d.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue",contextVariable:["feature"]},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')",contextVariable:["feature"]},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50",contextVariable:["feature"]},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},displayMode:{type:"enum",defaultValue:"arcs",model:v.types.enumeration("DisplayMode",["arcs","semicircles"]),description:"render semi-circles instead of arcs"}},{explicitlyTyped:!0});var x=n(58921),C=n(90863);function k(e){return v.types.compose("LinearArcDisplay",C.Lr,v.types.model({type:v.types.literal("LinearArcDisplay"),configuration:(0,d.ConfigurationReference)(e),displayMode:v.types.maybe(v.types.string)})).views(e=>({get blockType(){return"staticBlocks"},get renderDelay(){return 500},get rendererTypeName(){return e.configuration.renderer.type}})).views(e=>({get displayModeSetting(){return e.displayMode??(0,d.getConf)(e,["renderer","displayMode"])}})).views(e=>({get rendererConfig(){const t=(0,d.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,displayMode:e.displayModeSetting},(0,u.getEnv)(e))}})).views(e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.rendererConfig,height:e.height})}}).actions(e=>({setDisplayMode(t){e.displayMode=t}})).views(e=>{const t=e.trackMenuItems;return{trackMenuItems:()=>[...t(),{label:"Display mode",subMenu:[{type:"radio",label:"Arcs",onClick:()=>{e.setDisplayMode("arcs")},checked:"arcs"===e.displayMode},{type:"radio",label:"Semi-circles",onClick:()=>{e.setDisplayMode("semicircles")},checked:"semicircles"===e.displayMode}]}]}})}function T(e){return v.types.compose("LinearPairedArcDisplay",x.BaseDisplay,(0,C._e)(),(0,C.e6)(),v.types.model({type:v.types.literal("LinearPairedArcDisplay"),configuration:(0,d.ConfigurationReference)(e),displayMode:v.types.maybe(v.types.string)})).volatile(()=>({lastDrawnOffsetPx:0,features:void 0,loading:!1,drawn:!0})).views(e=>({get displayModeSetting(){return e.displayMode??(0,d.getConf)(e,["renderer","displayMode"])}})).actions(e=>({selectFeature(t){const n=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(n)){const r=n.addWidget("VariantFeatureWidget","variantFeature",{view:(0,u.getContainingView)(e),track:(0,u.getContainingTrack)(e),featureData:t.toJSON()});n.showWidget(r)}(0,u.isSelectionContainer)(n)&&n.setSelection(t)},setLoading(t){e.loading=t},setFeatures(t){e.features=t},setDisplayMode(t){e.displayMode=t}})).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(3497).then(n.bind(n,93497));t(e)}catch(t){console.error(t),e.setError(t)}})()},async renderSvg(t){const{renderArcSvg:r}=await n.e(4345).then(n.bind(n,44345));return r(e,t)}}))}class A extends a.A{name="ArcRenderer";install(e){!function(e){e.addRendererType(()=>new s({name:"ArcRenderer",ReactComponent:w,configSchema:S,pluginManager:e}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,d.ConfigurationSchema)("LinearArcDisplay",{renderer:v.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:C.Ki,explicitlyTyped:!0})}(e);return new x.DisplayType({name:"LinearArcDisplay",displayName:"Arc display",configSchema:t,stateModel:k(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:C.GQ})})}(e),function(e){e.addDisplayType(()=>{const e=(0,d.ConfigurationSchema)("LinearPairedArcDisplay",{color:{type:"color",description:"the color of the arcs",defaultValue:"jexl:defaultPairedArcColor(feature,alt)",contextVariable:["feature","alt"]}},{baseConfiguration:C.Ki,explicitlyTyped:!0});return new x.DisplayType({name:"LinearPairedArcDisplay",displayName:"Arc display",configSchema:e,stateModel:T(e),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,c.lazy)(()=>n.e(8984).then(n.bind(n,78984)))})})}(e),e.jexl.addFunction("logThickness",(e,t)=>Math.log(e.get(t)+1)),e.jexl.addFunction("defaultPairedArcColor",(e,t)=>t?.startsWith("<DEL")?o.set1[0]:t?.startsWith("<DUP")?o.set1[1]:t?.startsWith("<INV")?o.set1[2]:t?.startsWith("<TRA")?o.set1[3]:t?.startsWith("<CNV")?o.set1[4]:o.set1[6])}}var M=n(92070),P=n(1622);const R=(0,d.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},state:{description:"optional state for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint. can be 'token' or 'code'",type:"string",defaultValue:"code"}},{baseConfiguration:P.BaseInternetAccountConfig,explicitlyTyped:!0}),I=(0,d.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]}},{baseConfiguration:R,explicitlyTyped:!0});function L(e){return e.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}function F(e,t){try{const n=JSON.parse(e);return"invalid_grant"===n.error&&t(),n?.error_description??e}catch(e){}return e}function N(e,t){return e.refresh_token&&t(e.refresh_token),e.access_token}async function D({response:e,reason:t,statusText:n}){return[`HTTP ${e.status}`,t,n??await B(e)].filter(e=>!!e).join(" - ")}async function B(e){try{return await e.text()}catch(t){return e.statusText}}const j=e=>P.InternetAccount.named("OAuthInternetAccount").props({type:v.types.literal("OAuthInternetAccount"),configuration:(0,d.ConfigurationReference)(e)}).views(()=>{let e;return{get codeVerifierPKCE(){if(!e){const t=new Uint8Array(32);globalThis.crypto.getRandomValues(t),e=L(function(e){const t=[];for(let n=0,r=e.length;n<r;n++)t.push(String.fromCharCode(e[n]));return btoa(t.join(""))}(t))}return e}}}).views(e=>({get authEndpoint(){return(0,d.getConf)(e,"authEndpoint")},get tokenEndpoint(){return(0,d.getConf)(e,"tokenEndpoint")},get needsPKCE(){return(0,d.getConf)(e,"needsPKCE")},get clientId(){return(0,d.getConf)(e,"clientId")},get scopes(){return(0,d.getConf)(e,"scopes")},state:()=>(0,d.getConf)(e,"state"),get responseType(){return(0,d.getConf)(e,"responseType")},get refreshTokenKey(){return`${e.internetAccountId}-refreshToken`}})).actions(e=>({storeRefreshToken(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:()=>localStorage.getItem(e.refreshTokenKey),async exchangeAuthorizationForAccessToken(t,n){const r=new URLSearchParams(Object.entries({code:t,grant_type:"authorization_code",client_id:e.clientId,redirect_uri:n,...e.needsPKCE?{code_verifier:e.codeVerifierPKCE}:{}})),a=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(!a.ok)throw new Error(await D({response:a,reason:"Failed to obtain token"}));return N(await a.json(),e=>{this.storeRefreshToken(e)})},async exchangeRefreshForAccessToken(t){const n=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Object.entries({grant_type:"refresh_token",refresh_token:t,client_id:e.clientId})).toString()});if(!n.ok){e.removeToken();const t=await n.text();throw new Error(await D({response:n,statusText:F(t,()=>{this.removeRefreshToken()})}))}return N(await n.json(),e=>{this.storeRefreshToken(e)})}})).actions(e=>{let t,r;return{addMessageChannel(e,n){t=t=>{this.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},async finishOAuthWindow(t,n,r){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return void this.deleteMessageChannel();const a=t.data.redirectUri,o=a.replace("#","?"),i=new URL(o),s=i.search,l=new URLSearchParams(s);if(l.has("access_token")){const t=l.get("access_token");return t?(e.storeToken(t),void n(t)):void r(new Error("Error with token endpoint"))}if(l.has("code")){const t=l.get("code");if(!t)return void r(new Error("Error with authorization endpoint"));try{const r=await e.exchangeAuthorizationForAccessToken(t,i.origin+i.pathname);return e.storeToken(r),void n(r)}catch(e){return void(e instanceof Error?r(e):r(new Error(String(e))))}}a.includes("access_denied")?r(new Error("OAuth flow was cancelled")):a.includes("error")?r(new Error(`OAuth flow error: ${s}`)):this.deleteMessageChannel()},async useEndpointForAuthorization(t,r){const a=u.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,o={client_id:e.clientId,redirect_uri:a,response_type:e.responseType,token_access_type:"offline"};e.state()&&(o.state=e.state()),e.scopes&&(o.scope=e.scopes),e.needsPKCE&&(o.code_challenge=await async function(e){const t=await Promise.all([n.e(7753),n.e(6043)]).then(n.t.bind(n,27181,23)).then(e=>e.default);return L((await Promise.all([n.e(7753),n.e(6435)]).then(n.t.bind(n,29038,23))).stringify(t(e)))}(e.codeVerifierPKCE),o.code_challenge_method="S256");const i=new URLSearchParams(Object.entries(o)),s=new URL(e.authEndpoint);s.search=i.toString();const l=`JBrowseAuthWindow-${e.internetAccountId}`;if(u.isElectron){const{ipcRenderer:n}=window.require("electron"),a=await n.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:o,url:s.toString()}),i=new MessageEvent("message",{data:{name:l,redirectUri:a}});this.finishOAuthWindow(i,t,r)}else window.open(s,l,"width=500,height=600,left=0,top=0")},async getTokenFromUser(t,n){const r=e.retrieveRefreshToken();let a=!0;if(r)try{t(await e.exchangeRefreshForAccessToken(r)),a=!1}catch(t){console.error(t),e.removeRefreshToken()}a&&(this.addMessageChannel(t,n),this.useEndpointForAuthorization(t,n))},async validateToken(t,n){const a=e.addAuthHeaderToInit({method:"HEAD"},t),o=await fetch(n.uri,a);if(!o.ok){e.removeToken();const t=e.retrieveRefreshToken();if(t)try{r||(r=e.exchangeRefreshForAccessToken(t));const n=await r;return r=void 0,n}catch(e){console.error("Token could not be refreshed",e)}throw new Error(await D({response:o,reason:"Error validating token"}))}return t}}}).actions(e=>{const t=e.getFetcher;return{getFetcher(n){const r=t(n);return async(t,a)=>(n&&await e.validateToken(await e.getToken(n),n),r(t,a))}}});var V=n(94874);function E(e){const t=(0,l.c)(3);let n,r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,h.jsx)("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"}),t[0]=n):n=t[0],t[1]!==e?(r=(0,h.jsx)(V.A,{...e,children:n}),t[1]=e,t[2]=r):r=t[2],r}const z={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};async function O(e,t){let n="";try{const t=JSON.parse(await e.text()).error[".tag"];n=z[t]||t}catch(e){}return D({response:e,reason:t,statusText:n})}const H=e=>j(R).named("DropboxOAuthInternetAccount").props({type:v.types.literal("DropboxOAuthInternetAccount"),configuration:(0,d.ConfigurationReference)(e)}).views(()=>({get toggleContents(){return(0,h.jsx)(E,{})},get selectorLabel(){return"Enter Dropbox share link"}})).actions(e=>({getFetcher:t=>async(n,r)=>{const a=await e.getToken(t),o=e.addAuthHeaderToInit({...r,method:"POST"},a);o.headers.append("Dropbox-API-Arg",JSON.stringify({url:n}));const i=await fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",o);if(!i.ok)throw new Error(await O(i));return i},async validateToken(t,n){const r=await fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({url:n.uri})});if(!r.ok){const t=e.retrieveRefreshToken();if(t){e.removeRefreshToken();const r=await e.exchangeRefreshForAccessToken(t);return this.validateToken(r,n)}throw new Error(await O(r,"Token could not be validated"))}return t}})),G=(0,d.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:P.BaseInternetAccountConfig,explicitlyTyped:!0});var $=n(67112),W=n(76218),U=n(93062),_=n(69092),q=n(30698);const J=e=>{const t=(0,l.c)(20),{internetAccountId:n,handleClose:r}=e,[a,o]=(0,c.useState)("");let i;t[0]!==r?(i=()=>{r()},t[0]=r,t[1]=i):i=t[1];const s=`Enter token for ${n}`;let d,u,p;t[2]===Symbol.for("react.memo_cache_sentinel")?(d={display:"flex",flexDirection:"column"},t[2]=d):d=t[2],t[3]===Symbol.for("react.memo_cache_sentinel")?(u=e=>{o(e.target.value)},t[3]=u):u=t[3],t[4]===Symbol.for("react.memo_cache_sentinel")?(p=(0,h.jsx)(W.A,{style:d,children:(0,h.jsx)(U.A,{required:!0,label:"Enter Token",variant:"outlined",onChange:u,margin:"dense",slotProps:{htmlInput:{"data-testid":"entry-externalToken"}}})}),t[4]=p):p=t[4];const g=!a;let m,f,y,b,w;return t[5]!==r||t[6]!==a?(m=()=>{a&&r(a)},t[5]=r,t[6]=a,t[7]=m):m=t[7],t[8]!==g||t[9]!==m?(f=(0,h.jsx)(_.A,{variant:"contained",color:"primary",type:"submit",disabled:g,onClick:m,children:"Add"}),t[8]=g,t[9]=m,t[10]=f):f=t[10],t[11]!==r?(y=(0,h.jsx)(_.A,{variant:"contained",color:"secondary",onClick:()=>{r()},children:"Cancel"}),t[11]=r,t[12]=y):y=t[12],t[13]!==f||t[14]!==y?(b=(0,h.jsxs)(q.A,{children:[f,y]}),t[13]=f,t[14]=y,t[15]=b):b=t[15],t[16]!==i||t[17]!==b||t[18]!==s?(w=(0,h.jsxs)($.Dialog,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",onClose:i,title:s,children:[p,b]}),t[16]=i,t[17]=b,t[18]=s,t[19]=w):w=t[19],w},X=e=>P.InternetAccount.named("ExternalTokenInternetAccount").props({type:v.types.literal("ExternalTokenInternetAccount"),configuration:(0,d.ConfigurationReference)(e)}).views(e=>({get validateWithHEAD(){return(0,d.getConf)(e,"validateWithHEAD")}})).actions(e=>({getTokenFromUser(t,n){const{session:r}=(0,v.getRoot)(e);r.queueDialog(r=>[J,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):n(new Error("user cancelled entry")),r()}}])},async validateToken(t,n){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(n.uri,r);if(!a.ok){let e;try{e=await a.text()}catch(t){e=""}throw new Error(`Token could not be validated — ${a.status} ${e?` (${e})`:""}`)}return t}})),Y=(0,d.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:R,explicitlyTyped:!0});var K=n(99834);class Q extends K.RemoteFileWithRangeCache{constructor(e,t){super(e,t),this.statsPromise=this.fetch(e,{metadataOnly:!0}).then(e=>e.json())}async fetch(e,t){return super.fetch(e,t)}async stat(){return this.statsPromise}}function Z(e){const t=(0,l.c)(3);let n,r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,h.jsx)("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"}),t[0]=n):n=t[0],t[1]!==e?(r=(0,h.jsx)(V.A,{...e,children:n}),t[1]=e,t[2]=r):r=t[2],r}async function ee(e,t){let n="";try{n=JSON.parse(await e.text()).error.message}catch(e){}return D({response:e,reason:t,statusText:n})}function te(e){return`https://www.googleapis.com/drive/v3/files/${/[-\w]{25,}/.exec(e)}`}function ne(e){return j(R).named("GoogleDriveOAuthInternetAccount").props({type:v.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,d.ConfigurationReference)(e)}).views(()=>({get toggleContents(){return(0,h.jsx)(Z,{})},get selectorLabel(){return"Enter Google Drive share link"}})).actions(e=>({getFetcher:t=>async(n,r)=>{const a=new URL(te(String(n))),o=new URLSearchParams;r?.metadataOnly?o.append("fields","size"):o.append("alt","media"),a.search=o.toString();const i=await e.getToken(t),s=await fetch(a,e.addAuthHeaderToInit({...r,method:"GET",credentials:"same-origin"},i));if(!s.ok)throw new Error(await ee(s));return s},openLocation(e){return new Q(e.uri,{fetch:this.getFetcher(e)})},async validateToken(e,t){const n=await fetch(te(t.uri),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"}});if(!n.ok)throw new Error(await ee(n,"Token could not be validated"));return e}}))}const re=(0,d.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:P.BaseInternetAccountConfig,explicitlyTyped:!0});function ae(e){const t=(0,l.c)(21),{internetAccountId:n,handleClose:r}=e,[a,o]=(0,c.useState)(""),[i,s]=(0,c.useState)(""),d=`Log in for ${n}`;let u,p,g,m,f,y,b,w,v,S,x;return t[0]!==r?(u=()=>{r()},t[0]=r,t[1]=u):u=t[1],t[2]!==r||t[3]!==i||t[4]!==a?(p=e=>{a&&i?r(btoa(`${a}:${i}`)):r(),e.preventDefault()},t[2]=r,t[3]=i,t[4]=a,t[5]=p):p=t[5],t[6]===Symbol.for("react.memo_cache_sentinel")?(g={display:"flex",flexDirection:"column"},t[6]=g):g=t[6],t[7]===Symbol.for("react.memo_cache_sentinel")?(m=e=>{o(e.target.value)},t[7]=m):m=t[7],t[8]===Symbol.for("react.memo_cache_sentinel")?(f=(0,h.jsx)(U.A,{required:!0,label:"Username",variant:"outlined",onChange:m,margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-username"}}}),t[8]=f):f=t[8],t[9]===Symbol.for("react.memo_cache_sentinel")?(y=e=>{s(e.target.value)},t[9]=y):y=t[9],t[10]===Symbol.for("react.memo_cache_sentinel")?(b=(0,h.jsxs)(W.A,{style:g,children:[f,(0,h.jsx)(U.A,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",onChange:y,margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-password"}}})]}),t[10]=b):b=t[10],t[11]===Symbol.for("react.memo_cache_sentinel")?(w=(0,h.jsx)(_.A,{variant:"contained",color:"primary",type:"submit",children:"Submit"}),t[11]=w):w=t[11],t[12]!==r?(v=(0,h.jsxs)(q.A,{children:[w,(0,h.jsx)(_.A,{variant:"contained",color:"secondary",type:"submit",onClick:()=>{r()},children:"Cancel"})]}),t[12]=r,t[13]=v):v=t[13],t[14]!==v||t[15]!==p?(S=(0,h.jsxs)("form",{onSubmit:p,children:[b,v]}),t[14]=v,t[15]=p,t[16]=S):S=t[16],t[17]!==d||t[18]!==S||t[19]!==u?(x=(0,h.jsx)($.Dialog,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",title:d,onClose:u,children:S}),t[17]=d,t[18]=S,t[19]=u,t[20]=x):x=t[20],x}const oe=e=>P.InternetAccount.named("HTTPBasicInternetAccount").props({type:v.types.literal("HTTPBasicInternetAccount"),configuration:(0,d.ConfigurationReference)(e)}).views(e=>({get validateWithHEAD(){return(0,d.getConf)(e,"validateWithHEAD")}})).actions(e=>({getTokenFromUser(t,n){const{session:r}=(0,v.getRoot)(e);r.queueDialog(r=>[ae,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):n(new Error("User cancelled entry")),r()}}])},async validateToken(t,n){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(n.uri,r);if(!a.ok)throw new Error(await D({response:a,reason:"Error validating token"}));return t}}));class ie extends a.A{name="AuthenticationPlugin";exports={OAuthConfigSchema:R,OAuthInternetAccountModelFactory:j,ExternalTokenConfigSchema:G,ExternalTokenInternetAccountModelFactory:X,HTTPBasicConfigSchema:re,HTTPBasicInternetAccountModelFactory:oe,DropboxOAuthConfigSchema:I,DropboxOAuthInternetAccountModelFactory:H,GoogleDriveOAuthConfigSchema:Y,GoogleDriveOAuthInternetAccountModelFactory:ne};install(e){e.addInternetAccountType(()=>new M.A({name:"OAuthInternetAccount",configSchema:R,stateModel:j(R)})),e.addInternetAccountType(()=>new M.A({name:"ExternalTokenInternetAccount",configSchema:G,stateModel:X(G)})),e.addInternetAccountType(()=>new M.A({name:"HTTPBasicInternetAccount",configSchema:re,stateModel:oe(re)})),e.addInternetAccountType(()=>new M.A({name:"DropboxOAuthInternetAccount",configSchema:I,stateModel:H(I)})),e.addInternetAccountType(()=>new M.A({name:"GoogleDriveOAuthInternetAccount",configSchema:Y,stateModel:ne(Y)}))}}var se=n(47369);const le=(0,d.ConfigurationSchema)("BedAdapter",{bedLocation:{type:"fileLocation",description:"path to bed file, also allows gzipped bed",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),ce=(0,d.ConfigurationSchema)("BedGraphAdapter",{bedGraphLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGraphLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),de=(0,d.ConfigurationSchema)("BedGraphTabixAdapter",{bedGraphGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},index:(0,d.ConfigurationSchema)("VcfIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGraphGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e}),ue=(0,d.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,d.ConfigurationSchema)("TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e}),pe=(0,d.ConfigurationSchema)("BedpeAdapter",{bedpeLocation:{type:"fileLocation",description:"can be plaintext or gzipped, not indexed so loaded into memory on startup",defaultValue:{uri:"/path/to/my.bedpe.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedpeLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),he=(0,d.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},aggregateField:{type:"string",description:"An attribute to aggregate features with",defaultValue:"geneName2"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bigBedLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var ge=n(91468);class me extends a.A{name="BedPlugin";install(e){!function(e){e.addAdapterType(()=>new se.A({name:"BigBedAdapter",displayName:"BigBed adapter",configSchema:he,getAdapterClass:()=>Promise.all([n.e(1256),n.e(7368),n.e(6834)]).then(n.bind(n,6834)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"BedAdapter",displayName:"BED adapter",configSchema:le,getAdapterClass:()=>Promise.all([n.e(2598),n.e(1256),n.e(4864)]).then(n.bind(n,34864)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"BedpeAdapter",displayName:"BEDPE adapter",configSchema:pe,getAdapterClass:()=>Promise.all([n.e(2598),n.e(8738)]).then(n.bind(n,28738)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"BedTabixAdapter",displayName:"BED tabix adapter",configSchema:ue,getAdapterClass:()=>Promise.all([n.e(3085),n.e(1256),n.e(6214)]).then(n.bind(n,86214)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"BedGraphAdapter",displayName:"BedGraph adapter",configSchema:ce,getAdapterClass:()=>Promise.all([n.e(2598),n.e(4058)]).then(n.bind(n,54058)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"BedGraphTabixAdapter",displayName:"BedGraphTabix adapter",configSchema:de,getAdapterClass:()=>Promise.all([n.e(3085),n.e(6800)]).then(n.bind(n,96800)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,ge.getFileName)(t),o=n&&(0,ge.getFileName)(n);return(0,u.testAdapter)(a,/\.bedpe(\.gz)?$/i,r,"BedpeAdapter")?{type:"BedpeAdapter",bedpeLocation:t}:(0,u.testAdapter)(a,/\.bb$/i,r,"BigBedAdapter")||(0,u.testAdapter)(a,/\.bigBed?$/i,r,"BigBedAdapter")?{type:"BigBedAdapter",bigBedLocation:t}:(0,u.testAdapter)(a,/\.bed$/i,r,"BedAdapter")?{type:"BedAdapter",bedLocation:t}:(0,u.testAdapter)(a,/\.bg$/i,r,"BedGraphAdapter")?{type:"BedGraphAdapter",bedGraphLocation:t}:(0,u.testAdapter)(a,/\.bg(\.gz)?$/i,r,"BedGraphTabixAdapter")?{type:"BedGraphTabixAdapter",bedGraphGzLocation:t,index:{location:n||(0,ge.makeIndex)(t,".tbi"),indexType:(0,ge.makeIndexType)(o,"CSI","TBI")}}:(0,u.testAdapter)(a,/\.bed\.gz$/i,r,"BedTabixAdapter")?{type:"BedTabixAdapter",bedGzLocation:t,index:{location:n||(0,ge.makeIndex)(t,".tbi"),indexType:(0,ge.makeIndexType)(o,"CSI","TBI")}}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>({BedpeAdapter:"VariantTrack",BedGraphAdapter:"QuantitativeTrack",BedGraphTabixAdapter:"QuantitativeTrack"}[t]||e(t)))}(e)}}var fe=n(8832);const ye=(0,d.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),be=v.types.model("BreakpointAlignmentsWidget",{id:fe.ElementId,type:v.types.literal("BreakpointAlignmentsWidget"),featureData:v.types.frozen()}).actions(e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}}));var we=n(27614),ve=n(34727),Se=n(45465),xe=n(42489);const Ce=new RegExp(/(\d+)[SH]$/),ke=new RegExp(/^(\d+)([SH])/);var Te=n(49473);const Ae=(0,c.lazy)(()=>n.e(7790).then(n.bind(n,47790)));function Me(e){return v.types.compose("BreakpointSplitView",P.BaseViewModel,v.types.model({type:v.types.literal("BreakpointSplitView"),height:v.types.optional(v.types.number,400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactiveOverlay:!0,showHeader:!1,views:v.types.array(e.getViewType("LinearGenomeView").stateModel)})).volatile(()=>({width:800,matchedTrackFeatures:{}})).views(e=>({async exportSvg(t={}){const{renderToSvg:r}=await Promise.all([n.e(5727),n.e(5668)]).then(n.bind(n,95668)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,Se.saveAs)(o,t.filename||"image.svg")}})).views(e=>({get matchedTracks(){return 1===e.views.length?e.views[0].tracks:(0,Te.y$)(e=>e.configuration.trackId,...e.views.map(e=>e.tracks))},getMatchedTracks:t=>e.views.map(e=>e.getTrack(t)).filter(e=>!!e),hasTranslocations(e){return[...this.getTrackFeatures(e).values()].find(e=>"translocation"===e.get("type"))},hasPairedFeatures(e){return[...this.getTrackFeatures(e).values()].find(e=>"paired_feature"===e.get("type"))},getTrackFeatures:t=>new Map(e.matchedTrackFeatures[t]?.flat().map(e=>[e.id(),e])),getMatchedFeaturesInLayout(e,t){const n=this.getMatchedTracks(e);return t.map(e=>e.map(e=>{const t=n.findIndex(t=>(0,Te._u)(t,e));return-1!==t?{feature:e,layout:(0,Te._u)(n[t],e),level:t,clipPos:(r=e.get("CIGAR"),a=e.get("strand"),-1===a?+(Ce.exec(r)||[])[1]||0:+(ke.exec(r)||[])[1]||0)}:void 0;var r,a}).filter(u.notEmpty))}})).actions(e=>({afterAttach(){(0,v.addDisposer)(e,(0,v.onAction)(e,({name:t,path:n,args:r})=>{e.linkViews&&["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(t)&&n&&this.onSubviewAction(t,n,r)}))},onSubviewAction(t,n,r){for(const a of e.views)(0,v.getPath)(a).endsWith(n)||a[t](r?.[0])},setWidth(t){e.width=t;for(const n of e.views)n.setWidth(t)},setInteractiveOverlay(t){e.interactiveOverlay=t},setShowIntraviewLinks(t){e.showIntraviewLinks=t},setLinkViews(t){e.linkViews=t},setShowHeader(t){e.showHeader=t},setMatchedTrackFeatures(t){e.matchedTrackFeatures=t},reverseViewOrder(){e.views.reverse()}})).actions(e=>({afterAttach(){(0,v.addDisposer)(e,(0,xe.autorun)(async()=>{try{if(!e.views.every(e=>e.initialized))return;if(e.matchedTracks.some(e=>e.displays[0].notReady?.()))return;e.setMatchedTrackFeatures(Object.fromEntries(await Promise.all(e.matchedTracks.map(async t=>[t.configuration.trackId,await(0,Te.JV)(e,t)]))))}catch(t){console.error(t),(0,u.getSession)(e).notifyError(`${t}`,t)}}))},menuItems:()=>[...e.views.map((e,t)=>[t,e.menuItems()]).map(e=>({label:`Row ${e[0]+1} view menu`,subMenu:e[1]})),...e.views.length>1?[{label:"Reverse view order",onClick:()=>{e.reverseViewOrder()}}]:[],{label:"Show header",type:"checkbox",checked:e.showHeader,onClick:()=>{e.setShowHeader(!e.showHeader)}},{label:"Show intra-view links",type:"checkbox",checked:e.showIntraviewLinks,onClick:()=>{e.setShowIntraviewLinks(!e.showIntraviewLinks)}},{label:"Allow clicking alignment squiggles?",type:"checkbox",checked:e.interactiveOverlay,onClick:()=>{e.setInteractiveOverlay(!e.interactiveOverlay)}},{label:"Link views",type:"checkbox",icon:we.A,checked:e.linkViews,onClick:()=>{e.setLinkViews(!e.linkViews)}},{label:"Export SVG",icon:ve.A,onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[Ae,{model:e,handleClose:t}])}}]}))}class Pe extends a.A{name="BreakpointSplitViewPlugin";install(e){!function(e){e.addViewType(()=>new x.ViewType({name:"BreakpointSplitView",displayName:"Breakpoint split view",stateModel:Me(e),ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(5727),n.e(8092)]).then(n.bind(n,18092)))}))}(e),function(e){e.addWidgetType(()=>new x.WidgetType({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:ye,stateModel:be,ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6386),n.e(1475),n.e(5300),n.e(439)]).then(n.bind(n,90439)))}))}(e)}configure(){}}var Re=n(48133);const Ie=(0,d.ConfigurationSchema)("BlastTabularAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Query assembly is the first value in the array, target assembly is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},blastTableLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/blastTable.tsv",locationType:"UriLocation"}},columns:{type:"string",description:"Optional space-separated column name list. If custom columns were used in outfmt, enter them here exactly as specified in the command. At least qseqid, sseqid, qstart, qend, sstart, and send are required",defaultValue:"qseqid sseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore"}},{explicitlyTyped:!0}),Le=(0,d.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,chainLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Fe=["PAFAdapter","ChainAdapter","DeltaAdapter","BlastTabularAdapter","MashMapAdapter","MCScanAnchorsAdapter","MCScanSimpleAnchorsAdapter","PairwiseIndexedPAFAdapter"],Ne=["PAFAdapter","ChainAdapter","DeltaAdapter","MashMapAdapter","BlastTabularAdapter","PairwiseIndexedPAFAdapter"],De=["MCScanAnchorsAdapter","MCScanSimpleAnchorsAdapter"],Be=(0,c.lazy)(()=>n.e(2819).then(n.bind(n,22819))),je=(0,d.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,deltaLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Ve=(0,c.lazy)(()=>n.e(4141).then(n.bind(n,34141))),Ee=(0,d.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri&&e.bed1&&e.bed2?{...e,mcscanAnchorsLocation:{uri:e.uri,baseUri:e.baseUri},bed1Location:{uri:e.bed1,baseUri:e.baseUri},bed2Location:{uri:e.bed2,baseUri:e.baseUri}}:e}),ze=(0,d.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri&&e.bed1&&e.bed2?{...e,mcscanSimpleAnchorsLocation:{uri:e.uri,baseUri:e.baseUri},bed1Location:{uri:e.bed1,baseUri:e.baseUri},bed2Location:{uri:e.bed2,baseUri:e.baseUri}}:e}),Oe=(0,d.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,outLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),He=(0,d.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,pafLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Ge=(0,d.ConfigurationSchema)("PairwiseIndexedPAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pifGzLocation:{type:"fileLocation",description:"location of pairwise tabix indexed PAF (pif)",defaultValue:{uri:"/path/to/data/file.pif.gz",locationType:"UriLocation"}},index:(0,d.ConfigurationSchema)("TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.paf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,pifGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});class $e extends a.A{name="ComparativeAdaptersPlugin";install(e){!function(e){e.addAdapterType(()=>new se.A({name:"PAFAdapter",displayName:"PAF adapter",configSchema:He,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(5904).then(n.bind(n,35904)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"PairwiseIndexedPAFAdapter",displayName:"Pairwise indexed PAF adapter",configSchema:Ge,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>Promise.all([n.e(3085),n.e(3167)]).then(n.bind(n,23167)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"DeltaAdapter",displayName:"MUMmer delta adapter",configSchema:je,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(2820).then(n.bind(n,12820)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"ChainAdapter",displayName:"Liftover chain adapter",configSchema:Le,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(8929).then(n.bind(n,98929)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"MCScanAnchorsAdapter",displayName:"MCScan anchors adapter",configSchema:Ee,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(8965).then(n.bind(n,28965)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"MCScanSimpleAnchorsAdapter",displayName:"MCScan anchors.simple adapter",configSchema:ze,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(9409).then(n.bind(n,69409)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"MashMapAdapter",displayName:"MashMap adapter",configSchema:Oe,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(9449).then(n.bind(n,29449)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"BlastTabularAdapter",displayName:"Tabular BLAST output adapter",configSchema:Ie,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>n.e(7439).then(n.bind(n,67439)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-addTrackComponent",(e,{model:t})=>Ne.includes(t.trackAdapterType)?Be:e)}(e),function(e){e.addToExtensionPoint("Core-addTrackComponent",(e,{model:t})=>De.includes(t.trackAdapterType)?Ve:e)}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,ge.getFileName)(t),o=n&&(0,ge.getFileName)(n);return(0,u.testAdapter)(a,/\.paf(.gz)?/i,r,"PAFAdapter")?{type:"PAFAdapter",pafLocation:t}:"BlastTabularAdapter"===r?{type:"BlastTabularAdapter",blastTableLocation:t}:(0,u.testAdapter)(a,/\.anchors.simple(.gz)?/i,r,"MCScanSimpleAnchorsAdapter")?{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:t}:(0,u.testAdapter)(a,/\.anchors(.gz)?/i,r,"MCScanAnchorsAdapter")?{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:t}:(0,u.testAdapter)(a,/\.delta(.gz)?/i,r,"DeltaAdapter")?{type:"DeltaAdapter",deltaLocation:t}:(0,u.testAdapter)(a,/\.chain(.gz)?/i,r,"ChainAdapter")?{type:"ChainAdapter",chainLocation:t}:(0,u.testAdapter)(a,/\.out(.gz)?/i,r,"MashMapAdapter")?{type:"MashMapAdapter",outLocation:t}:(0,u.testAdapter)(a,/\.pif\.gz/i,r,"PairwiseIndexedPAFAdapter")?{type:"PairwiseIndexedPAFAdapter",pifGzLocation:t,index:{location:n||(0,ge.makeIndex)(t,".tbi"),indexType:(0,ge.makeIndexType)(o,"CSI","TBI")}}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>Fe.includes(t)?"SyntenyTrack":e(t))}(e)}}var We=n(59099),Ue=n(16574),_e=n(64669),qe=n(2406),Je=n(37347);class Xe extends qe.A{name="ComparativeRender";async renameRegionsIfNeeded(e,t){return t.renameRegionsIfNeeded(e)}getRenderer(e){return this.pluginManager.getRendererType(e)}async serializeArguments(e,t){const{rendererType:n}=e,r=this.getRenderer(n),a=await super.serializeArguments(e,t),o=await this.renameRegionsIfNeeded(a,r);return"MainThreadRpcDriver"===t?o:r.serializeArgsInClient(o)}async execute(e,t){let n=e;"MainThreadRpcDriver"!==t&&(n=await this.deserializeArguments(e,t));const{sessionId:r,rendererType:a,stopToken:o}=n;if(!r)throw new Error("must pass a unique session id");(0,Je.SW)(o);const i=this.getRenderer(a);return"MainThreadRpcDriver"===t?i.render(n):i.renderInWorker(n)}async deserializeReturn(e,t,n){const r=await super.deserializeReturn(e,t,n);return"MainThreadRpcDriver"===n?r:this.getRenderer(t.rendererType).deserializeResultsInClient(r,t)}}var Ye=n(14129),Ke=n(7772),Qe=n(90542),Ze=n(41718),et=n(97884),tt=n(93707);const nt=et.A.extend(e=>{const t=xe.observable.box(1);return{views:{get dynamicBlocks(){return(0,tt.A)(e,!1,!1)},get scaleFactor(){return t.get()},get maxBpPerPx(){return e.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get maxOffset(){return e.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width}},actions:{setScaleFactor(e){t.set(e)},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(t-e.width/2)}}}}),rt=nt.extend(e=>({views:{get width(){return(0,v.getParent)(e).viewWidth}}})),at=nt.extend(e=>({views:{get width(){return(0,v.getParent)(e).viewHeight}}}));var ot=n(90257);const it=(0,c.lazy)(()=>n.e(8859).then(n.bind(n,78859))),st=(0,c.lazy)(()=>n.e(7686).then(n.bind(n,87686)));function lt(e){return(0,u.measureText)(e.slice(0,30))}function ct(e,t,n){return(0,u.max)([...e.filter(e=>!n.has(e.key)).map(e=>lt(e.refName)),...e.filter(e=>!n.has(e.key)).map(e=>lt((0,u.getTickDisplayStr)(e.end,t)))])}class dt extends Ye.A{name="DiagonalizeDotplot";async execute(e,t){const n=await this.deserializeArguments(e,t),{view:r,sessionId:a,adapterConfig:o,stopToken:i,statusCallback:s}=n;if(!a)throw new Error("must pass a unique session id");s?.("Initializing diagonalization...");const l=[800,800],c=[r.hview,r.vview].map((e,t)=>{const n=nt.create(e);return n.setVolatileWidth(l[t]),n})[0];(0,Je.SW)(i),s?.("Getting renderer...");const d=this.pluginManager.getRendererType("DotplotRenderer");if(!d)throw new Error("DotplotRenderer not found");(0,Je.SW)(i),s?.("Fetching features...");const u=await d.getFeatures({regions:c.dynamicBlocks.contentBlocks,adapterConfig:o,sessionId:a});(0,Je.SW)(i),s?.("Extracting alignment data...");const p=[];for(const e of u.values()){const t=e.get("mate");t&&p.push({queryRefName:e.get("refName"),refRefName:t.refName,queryStart:e.get("start"),queryEnd:e.get("end"),refStart:t.start,refEnd:t.end,strand:e.get("strand")||1})}if(0===p.length)throw new Error("No alignments found to diagonalize");s?.(`Running diagonalization on ${p.length} alignments...`);const h=await async function(e,t,n){const r=(e,t)=>{n&&n(0,t)};r(0,`Grouping ${e.length} alignments...`);const a=new Map;for(const t of e){const e=t.refRefName;a.has(e)||a.set(e,{refAlignments:new Map,strandWeightedSum:0});const n=a.get(e),r=Math.abs(t.queryEnd-t.queryStart);n.refAlignments.has(t.queryRefName)||n.refAlignments.set(t.queryRefName,{bases:0,positions:[]});const o=n.refAlignments.get(t.queryRefName);o.bases+=r,o.positions.push((t.queryStart+t.queryEnd)/2);const i=t.strand>=0?1:-1;n.strandWeightedSum+=i*r}r(0,"Determining optimal ordering and orientation...");const o=[];for(const[e,t]of a){let n="",r=0,a=[];for(const[e,o]of t.refAlignments)o.bases>r&&(r=o.bases,n=e,a=o.positions);const i=a.reduce((e,t)=>e+t,0)/a.length,s=t.strandWeightedSum<0;o.push({refName:e,bestRefName:n,bestRefPos:i,shouldReverse:s})}r(0,`Sorting ${o.length} query regions...`),o.sort((e,t)=>e.bestRefName!==t.bestRefName?e.bestRefName.localeCompare(t.bestRefName):e.bestRefPos-t.bestRefPos),r(0,"Building new region layout...");const i=[];let s=0;for(const{refName:e,shouldReverse:n}of o){const r=t.find(t=>t.refName===e);r&&(i.push({...r,reversed:n}),n!==r.reversed&&s++)}const l=t.filter(e=>!i.some(t=>t.refName===e.refName));return r(0,"Diagonalization complete!"),{newRegions:[...i,...l],stats:{totalAlignments:e.length,regionsProcessed:o.length,regionsReordered:i.length,regionsReversed:s}}}(p,r.vview.displayedRegions,(e,t)=>{(0,Je.SW)(i),s?.(t)});return s?.("Diagonalization complete!"),h}}var ut=n(56328);const pt=(0,p.observer)(function(e){const{model:t,children:n}=e,{offsetX:r=0,offsetY:a=0}=t.data||{},o=(0,u.getContainingView)(t),i=o.vview.offsetPx-a,s=-(o.hview.offsetPx-r);return(0,h.jsxs)("div",{style:{position:"relative"},children:[(0,h.jsx)(t.ReactComponent2,{...e,style:{position:"absolute",top:i,left:s}}),n]})}),ht=pt;var gt=n(75785);const mt=(0,gt.n9)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{backgroundColor:t,padding:"10px"}}});function ft(){const e=(0,l.c)(3),{classes:t}=mt();let n,r;return e[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,h.jsx)($.LoadingEllipses,{}),e[0]=n):n=e[0],e[1]!==t.loading?(r=(0,h.jsx)("div",{className:t.loading,children:n}),e[1]=t.loading,e[2]=r):r=e[2],r}function yt(e){const t=(0,l.c)(5),{messageText:n}=e,{classes:r}=mt();let a,o;return t[0]!==n?(a=(0,h.jsx)($.LoadingEllipses,{message:n}),t[0]=n,t[1]=a):a=t[1],t[2]!==r.loading||t[3]!==a?(o=(0,h.jsx)("div",{className:r.loading,children:a}),t[2]=r.loading,t[3]=a,t[4]=o):o=t[4],o}function bt(e){const t=(0,l.c)(2),{error:n}=e;let r;return t[0]!==n?(r=(0,h.jsx)($.ErrorMessage,{error:n}),t[0]=n,t[1]=r):r=t[1],r}const wt=(0,p.observer)(function({model:e,style:t}){return e.error?(0,h.jsx)(bt,{error:e.error,"data-testid":"reload_button"}):e.message?(0,h.jsx)(yt,{messageText:e.message}):e.filled?e.shouldDisplay?(0,h.jsx)("div",{style:t,children:e.reactElement}):null:(0,h.jsx)(ft,{})}),vt=wt;function St(e){const{rpcManager:t}=(0,u.getSession)(e),{rendererType:n}=e,{adapterConfig:r}=e,a=(0,u.getContainingView)(e);if((0,d.readConfObject)(e.configuration),(0,v.getSnapshot)(a),a.initialized){const{viewWidth:o,viewHeight:i,borderSize:s,borderX:l,borderY:c}=a;return{rendererType:n,rpcManager:t,renderProps:{...e.renderProps(),view:structuredClone((0,v.getSnapshot)(a)),width:o,height:i,borderSize:s,borderX:l,borderY:c,adapterConfig:r,rendererType:n.name,sessionId:(0,ge.getRpcSessionId)(e),timeout:1e6,alpha:e.alpha,minAlignmentLength:e.minAlignmentLength,colorBy:e.colorBy}}}}function xt(e){return v.types.compose("DotplotDisplay",P.BaseDisplay,v.types.model({type:v.types.literal("DotplotDisplay"),configuration:(0,d.ConfigurationReference)(e),colorBy:v.types.optional(v.types.string,"default")}).volatile(()=>({stopToken:void 0,warnings:[],filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:vt,alpha:1,minAlignmentLength:0}))).views(e=>({get shouldDisplay(){const{vview:t,hview:n}=(0,u.getContainingView)(e);return t.bpPerPx===e.data.bpPerPxY&&n.bpPerPx===e.data.bpPerPxX},get rendererTypeName(){return(0,d.getConf)(e,["renderer","type"])},renderProps:()=>({...(0,ge.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer,statusCallback:t=>{e.setMessage(t)}})})).views(e=>({async renderSvg(t){const n=St(e);if(!n)return null;const{rendererType:r,rpcManager:a,renderProps:o}=n,i=await r.renderInClient(a,{...o,exportSVG:t,theme:t.theme||o.theme}),{hview:s,vview:l}=(0,u.getContainingView)(e),c=-s.offsetPx+i.offsetX,d=-l.offsetPx+i.offsetY;return(0,h.jsx)("g",{transform:`translate(${c} ${-d})`,children:(0,h.jsx)(u.ReactRendering,{rendering:i})})}})).actions(e=>({afterAttach(){(0,u.makeAbortableReaction)(e,()=>St(e),e=>async function(e){if(!e)return;const{rendererType:t,rpcManager:n,renderProps:r}=e,{reactElement:a,...o}=await t.renderInClient(n,r);return{reactElement:a,data:o,renderingComponent:t.ReactComponent}}(e),{name:`${e.type} ${e.id} rendering`,delay:500,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading(t){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,e.stopToken=t},setMessage(t){e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,e.stopToken=void 0},setRendered(t){if(void 0===t)return;const{data:n,reactElement:r,renderingComponent:a}=t;e.warnings=n.warnings,e.filled=!0,e.message=void 0,e.reactElement=r,e.data=n,e.error=void 0,e.renderingComponent=a,e.stopToken=void 0},setError(t){console.error(t),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0,e.stopToken=void 0},setAlpha(t){e.alpha=t},setMinAlignmentLength(t){e.minAlignmentLength=t},setColorBy(t){e.colorBy=t}}))}var Ct=n(18423);const{featurizeSA:kt,getClip:Tt,getLength:At,getLengthSansClipping:Mt}=r.aF;var Pt=n(57027);class Rt extends Pt.A{supportsSVG=!0;async renameRegionsIfNeeded(e){const t=this.pluginManager,n=t.rootModel?.session?.assemblyManager,{view:r,sessionId:a,adapterConfig:o}=e;async function i(e){if(!n)throw new Error("No assembly manager provided");return(await(0,u.renameRegionsIfNeeded)(n,{sessionId:a,adapterConfig:o,regions:e})).regions}return r.hview.displayedRegions=await i(r.hview.displayedRegions),r.vview.displayedRegions=await i(r.vview.displayedRegions),e}async render(e){const{width:t,height:r,view:{hview:a,vview:o}}=e,i=[t,r],s=[a,o].map((e,t)=>{const n=nt.create(e);return n.setVolatileWidth(i[t]),n}),l=s[0],c=await this.getFeatures({...e,regions:l.dynamicBlocks.contentBlocks});l.setFeatures(c);const{drawDotplot:d}=await n.e(2786).then(n.bind(n,82786)),p=await(0,u.renderToAbstractCanvas)(t,r,e,t=>d(t,{...e,views:s}));return{...await super.render({...e,...p,height:r,width:t}),...p,height:r,width:t,offsetX:s[0].dynamicBlocks.blocks[0]?.offsetPx||0,offsetY:s[1].dynamicBlocks.blocks[0]?.offsetPx||0,bpPerPxX:s[0].bpPerPx,bpPerPxY:s[1].bpPerPx}}}const It=(0,p.observer)(function(e){return(0,h.jsx)($.PrerenderedCanvas,{...e})}),Lt=(0,d.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"blue"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:v.types.enumeration("colorBy",["identity","meanQueryIdentity","mappingQuality","strand","default"]),description:'Color by options:<br/>\n<ul>\n  <li>"identity" - the identity of the particular hit, similar to D-GENIES, use the other config slots \'thresholds\' and \'thresholdsPalette\' to define colors for this setting</li>\n  <li>"meanQueryIdentity" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>"mappingQuality" - uses mapping quality from PAF, some adapters don\'t have this setting</li>\n  <li>"strand" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>"default" - uses the \'color\' config slot</li>\n</ul>',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0});var Ft=n(63589);function Nt(e,t,n){try{e.showTrack(t)}catch(e){if(!/Could not resolve identifier/.exec(`${e}`))throw e;n.push(t)}}class Dt extends a.A{name="DotplotPlugin";install(e){var t;!function(e){e.addViewType(()=>{return new Ft.A({name:"DotplotView",displayName:"Dotplot view",stateModel:(t=e,v.types.compose("DotplotView",Ke.A,v.types.model({id:fe.ElementId,type:v.types.literal("DotplotView"),height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:v.types.array(v.types.string),drawCigar:!0,hview:v.types.optional(rt,{}),vview:v.types.optional(at,{}),tracks:v.types.array(t.pluggableMstType("track","stateModel")),viewTrackConfigs:v.types.array(t.pluggableConfigSchemaType("track"))})).volatile(()=>({volatileWidth:void 0,volatileError:void 0,cursorMode:(0,u.localStorageGetItem)("dotplot-cursorMode")||"crosshair",showPanButtons:(0,u.localStorageGetBoolean)("dotplot-showPanbuttons",!0),wheelMode:(0,u.localStorageGetItem)("dotplot-wheelMode")||"zoom",borderX:100,borderY:100,importFormSyntenyTrackSelections:xe.observable.array()})).actions(e=>({importFormRemoveRow(t){e.importFormSyntenyTrackSelections.splice(t,1)},clearImportFormSyntenyTracks(){e.importFormSyntenyTrackSelections.clear()},setImportFormSyntenyTrack(t,n){e.importFormSyntenyTrackSelections[t]=n}})).views(e=>({get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}})).views(e=>({get assemblyErrors(){const{assemblyManager:t}=(0,u.getSession)(e);return e.assemblyNames.map(e=>t.get(e)?.error).filter(e=>!!e).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,u.getSession)(e);return e.assemblyNames.every(e=>t.get(e)?.initialized??!0)}})).views(e=>({get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){const{hview:t}=e,{dynamicBlocks:n,staticBlocks:r,bpPerPx:a}=t;return n.contentBlocks.length>5?[]:(0,ot.H2)(r.contentBlocks,a)},get vticks(){const{vview:t}=e,{dynamicBlocks:n,staticBlocks:r,bpPerPx:a}=t;return n.contentBlocks.length>5?[]:(0,ot.H2)(r.contentBlocks,a)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps(){const t=(0,u.getSession)(e);return{...(0,ge.getParentRenderProps)(e),drawCigar:e.drawCigar,highResolutionScaling:(0,d.getConf)(t,"highResolutionScaling")}}})).actions(e=>({setShowPanButtons(t){e.showPanButtons=t},setWheelMode(t){e.wheelMode=t},setCursorMode(t){e.cursorMode=t},setDrawCigar(t){e.drawCigar=t},clearView(){e.hview.setDisplayedRegions([]),e.vview.setDisplayedRegions([]),e.assemblyNames=(0,v.cast)([]),e.tracks.clear()},setBorderX(t){e.borderX=t},setBorderY(t){e.borderY=t},setWidth:t=>(e.volatileWidth=t,e.volatileWidth),setHeight:t=>(e.height=t,e.height),setError(t){e.volatileError=t},zoomOut(){e.hview.zoomOut(),e.vview.zoomOut()},zoomIn(){e.hview.zoomIn(),e.vview.zoomIn()}})).actions(e=>({activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(t)){const n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},showTrack(n,r={}){const a=t.pluggableConfigSchemaType("track"),o=(0,v.resolveIdentifier)(a,(0,v.getRoot)(e),n),i=t.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=t.getViewType(e.type),l=o.displays.find(e=>s.displayTypes.find(t=>t.name===e.type));if(!l)throw new Error(`could not find a compatible display for view type ${e.type}`);const c=i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:l.type,configuration:l}]});e.tracks.push(c)},hideTrack(n){const r=t.pluggableConfigSchemaType("track"),a=(0,v.resolveIdentifier)(r,(0,v.getRoot)(e),n),o=e.tracks.filter(e=>e.configuration===a);return(0,xe.transaction)(()=>{for(const t of o)e.tracks.remove(t)}),o.length},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setAssemblyNames(t,n){e.assemblyNames=(0,v.cast)([t,n])},setViews(t){e.hview=(0,v.cast)(t[0]),e.vview=(0,v.cast)(t[1])},getCoords(t,n){const[r,a]=(0,u.minmax)(n[0],t[0]),[o,i]=(0,u.minmax)(n[1],t[1]);return Math.abs(a-r)>3&&Math.abs(i-o)>3?[e.hview.pxToBp(r),e.hview.pxToBp(a),e.vview.pxToBp(e.viewHeight-o),e.vview.pxToBp(e.viewHeight-i)]:void 0},zoomInToMouseCoords(t,n){const r=this.getCoords(t,n);if(r){const[t,n,a,o]=r;e.hview.moveTo(t,n),e.vview.moveTo(o,a)}},calculateBorders(){if(void 0===e.volatileWidth)return{borderX:e.borderX,borderY:e.borderY};const{vview:t,hview:n,viewHeight:r,viewWidth:a}=e,o=t.dynamicBlocks.contentBlocks,i=n.dynamicBlocks.contentBlocks,s=n.offsetPx,l=t.offsetPx,c=(0,ot.rQ)(o,r,l),d=(0,ot.rQ)(i,a,s),u=ct(i,t.bpPerPx,d),p=ct(o,n.bpPerPx,c);return{borderX:Math.max(p+40,50),borderY:Math.max(u+40,50)}},showAllRegions(){e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx);const{borderX:t,borderY:n}=this.calculateBorders();e.setBorderX(t),e.setBorderY(n),e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx),e.vview.center(),e.hview.center()},onDotplotView(t,n){const r=this.getCoords(t,n);if(r){const[t,n,a,o]=r,i=(0,u.getSession)(e),s=nt.create({...(0,v.getSnapshot)(e.hview),minimumBlockWidth:0,interRegionPaddingWidth:0}),l=nt.create({...(0,v.getSnapshot)(e.vview),minimumBlockWidth:0,interRegionPaddingWidth:0});s.setVolatileWidth(e.hview.width),l.setVolatileWidth(e.vview.width),s.moveTo(t,n),l.moveTo(o,a),s.zoomTo(s.bpPerPx/(e.width/e.hview.width),0),l.zoomTo(l.bpPerPx/(e.width/e.vview.width),0);const c=e.tracks.map(e=>e.configuration.displays.find(e=>"LinearSyntenyDisplay"===e.type)).filter(e=>!!e).map(e=>{const t=(0,v.getParent)(e,2);return{type:t.type,configuration:t,displays:[{type:e.type,configuration:e}]}}),{id:d,...p}=(0,v.getSnapshot)(s),{id:h,...g}=(0,v.getSnapshot)(l),m={type:"LinearSyntenyView",views:[{type:"LinearGenomeView",tracks:[],hideHeader:!0,...p},{type:"LinearGenomeView",tracks:[],hideHeader:!0,...g}],tracks:c};i.addView("LinearSyntenyView",m)}}})).actions(e=>({async exportSvg(t={}){const{renderToSvg:r}=await n.e(1266).then(n.bind(n,11266)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,Se.saveAs)(o,t.filename||"image.svg")},beforeDestroy(){const t=(0,u.getSession)(e);for(const n of e.assemblyNames)t.removeTemporaryAssembly?.(n)},afterAttach(){(0,v.addDisposer)(e,(0,xe.autorun)(()=>{const{showPanButtons:t,wheelMode:n,cursorMode:r}=e;var a;"undefined"!=typeof localStorage&&(localStorage.setItem("dotplot-showPanbuttons",(a=t,JSON.stringify(a))),localStorage.setItem("dotplot-cursorMode",r),localStorage.setItem("dotplot-wheelMode",n))})),(0,v.addDisposer)(e,(0,xe.autorun)(()=>{const t=(0,u.getSession)(e);if(void 0===e.volatileWidth||!e.assembliesInitialized)return;const{hview:n,assemblyNames:r,vview:a}=e;n.displayedRegions.length&&a.displayedRegions.length||(0,xe.transaction)(()=>{n.setDisplayedRegions(t.assemblyManager.get(r[0])?.regions||[]),a.setDisplayedRegions(t.assemblyManager.get(r[1])?.regions||[]),e.showAllRegions()})},{delay:1e3})),(0,v.addDisposer)(e,(0,xe.autorun)(function(){if(void 0===e.volatileWidth)return;const{borderX:t,borderY:n}=e.calculateBorders();e.setBorderX(t),e.setBorderY(n)}))},squareView(){const{hview:t,vview:n}=e,r=(t.bpPerPx+n.bpPerPx)/2,a=t.pxToBp(t.width/2),o=n.pxToBp(n.width/2);t.setBpPerPx(r),t.centerAt(a.coord,a.refName,a.index),n.setBpPerPx(r),n.centerAt(o.coord,o.refName,o.index)},squareViewProportional(){const{hview:t,vview:n}=e,r=t.width/n.width,a=(t.bpPerPx+n.bpPerPx)/2,o=t.pxToBp(t.width/2),i=n.pxToBp(n.width/2);t.setBpPerPx(a/r),t.centerAt(o.coord,o.refName,o.index),n.setBpPerPx(a),n.centerAt(i.coord,i.refName,i.index)}})).views(e=>({menuItems(){const t=(0,u.getSession)(e);return[{label:"Return to import form",icon:Ze.A,onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[st,{model:e,handleClose:t}])}},{label:"Export SVG",icon:ve.A,onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[it,{model:e,handleClose:t}])}},...(0,u.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:Qe.xU}]:[]]},get error(){return e.volatileError||e.assemblyErrors}}))),ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(2826),n.e(469),n.e(9787)]).then(n.bind(n,19787)))});var t})}(e),(t=e).addDisplayType(()=>{const e=function(e){return(0,d.ConfigurationSchema)("DotplotDisplay",{renderer:v.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(t);return new ut.A({name:"DotplotDisplay",displayName:"Dotplot display",configSchema:e,stateModel:xt(e),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:ht})}),function(e){e.addRendererType(()=>new Rt({name:"DotplotRenderer",configSchema:Lt,ReactComponent:It,pluginManager:e}))}(e),function(e){e.addToExtensionPoint("LaunchView-DotplotView",async({session:e,views:t,tracks:n=[]})=>{try{const r=e.addView("DotplotView",{}),a=t.map(e=>e.assembly);(0,xe.transaction)(()=>{r.setViews([{bpPerPx:.1,offsetPx:0},{bpPerPx:.1,offsetPx:0}]),r.setAssemblyNames(a[0],a[1])});const o=[];for(const e of n)Nt(r,e,o);if(o.length)throw new Error(`Could not resolve identifiers: ${o.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}})}(e),function(e){e.addToExtensionPoint("Core-extendPluggableElement",e=>{if("LinearPileupDisplay"===e.name){const{stateModel:t}=e,n=t.extend(e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const n=e.contextMenuFeature;return[...t(),...n?[{label:"Dotplot of read vs ref",icon:Ct.A,onClick:()=>{!function(e,t){const n=(0,u.getSession)(t);try{const r=e.get("CIGAR"),a=Tt(r,1),o=e.get("flags"),i=e.get("strand"),s=e.get("name"),l=`${s}_assembly_${Date.now()}`,{parentTrack:c}=t,[p]=(0,d.getConf)(c,"assemblyNames"),h=[p,l],g=`track-${Date.now()}`,m=`${s}_vs_${p}`,f=e.get("tags")?.SA,y=kt(f,e.id(),i,s,!0),b=At(2048&o?y[0].CIGAR:r),w=[{...e.toJSON(),strand:1,mate:{refName:s,start:a,end:a+Mt(r)}},...y].sort((e,t)=>e.clipPos-t.clipPos);n.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:(0,u.sum)(w.map(e=>e.end-e.start))/800,displayedRegions:(0,u.gatherOverlaps)(w.map((e,t)=>{const{start:n,end:r,refName:a}=e;return{start:n,end:r,refName:a,index:t,assemblyName:p}}))},vview:{offsetPx:0,bpPerPx:b/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:l,start:0,end:b,refName:s}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:h,adapter:{type:"FromConfigAdapter",features:w},trackId:g,name:m}],assemblyNames:h,tracks:[{configuration:g,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:`${g}-DotplotDisplay`}]}],displayName:`${s} vs ${p}`})}catch(e){console.error(e),n.notifyError(`${e}`,e)}}(n,e)}}]:[]]}}}});e.stateModel=n}return e})}(e),e.addRpcMethod(()=>new Xe(e)),e.addRpcMethod(()=>new dt(e))}configure(e){(0,u.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:_e.A,onClick:e=>{e.addView("DotplotView",{})}})}}var Bt=n(58273);var jt=n(11210);const Vt=(0,c.lazy)(()=>n.e(3384).then(n.bind(n,93384)));function Et(e,t){return v.types.compose("SharedGCContentModel",(0,jt._i)(e,t),v.types.model({windowSize:v.types.maybe(v.types.number),windowDelta:v.types.maybe(v.types.number)})).actions(e=>({setGCContentParams({windowSize:t,windowDelta:n}){e.windowSize=t,e.windowDelta=n}})).views(e=>({get windowSizeSetting(){return e.windowSize??(0,d.getConf)(e,"windowSize")},get windowDeltaSetting(){return e.windowDelta??(0,d.getConf)(e,"windowDelta")}})).views(e=>{const{trackMenuItems:t,adapterProps:n}=e;return{trackMenuItems:()=>[...t(),{label:"Change GC parameters",onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[Vt,{model:e,handleClose:t}])}}],adapterProps(){const t=(0,d.getConf)(e.parentTrack,"adapter");return{...n(),adapterConfig:{type:"GCContentAdapter",sequenceAdapter:t,windowSize:e.windowSizeSetting,windowDelta:e.windowDeltaSetting}}}}})}class zt extends a.A{name="GCContentPlugin";install(e){var t;!function(e){e.addAdapterType(()=>new se.A({name:"GCContentAdapter",displayName:"GC content adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:(0,d.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:{type:"frozen",defaultValue:null},windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{explicitlyTyped:!0}),getAdapterClass:()=>n.e(9756).then(n.bind(n,49756)).then(e=>e.default)}))}(e),(t=e).addTrackType(()=>{const e=(e=>(0,d.ConfigurationSchema)("GCContentTrack",{},{baseConfiguration:(0,x.createBaseTrackConfig)(e)}))(t);return new Bt.A({name:"GCContentTrack",displayName:"GCContent track",configSchema:e,stateModel:(0,P.createBaseTrackModel)(t,"GCContentTrack",e)})}),function(e){e.addDisplayType(()=>{const t=function(e){return(0,d.ConfigurationSchema)("LinearGCContentDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),n=function(e,t){return v.types.compose("LinearGCContentDisplay",Et(e,t),v.types.model({type:v.types.literal("LinearGCContentDisplay")}))}(e,t);return new x.DisplayType({name:"LinearGCContentDisplay",configSchema:t,stateModel:n,displayName:"GC content display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:jt.r})}),e.addDisplayType(()=>{const t=function(e){return(0,d.ConfigurationSchema)("LinearGCContentTrackDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),n=function(e,t){return v.types.compose("LinearGCContentTrackDisplay",Et(e,t),v.types.model({type:v.types.literal("LinearGCContentTrackDisplay")}))}(e,t);return new x.DisplayType({name:"LinearGCContentTrackDisplay",configSchema:t,stateModel:n,displayName:"GC content display",trackType:"GCContentTrack",viewType:"LinearGenomeView",ReactComponent:jt.r})})}(e)}}const Ot=(0,d.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gffLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Ht=(0,d.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,d.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region","contig"]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gffGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});class Gt extends a.A{name="GFF3Plugin";install(e){!function(e){e.addAdapterType(()=>new x.AdapterType({name:"Gff3TabixAdapter",displayName:"GFF3 tabix adapter",configSchema:Ht,getAdapterClass:()=>Promise.all([n.e(3085),n.e(2645),n.e(7409)]).then(n.bind(n,27409)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new x.AdapterType({name:"Gff3Adapter",displayName:"GFF3 adapter",configSchema:Ot,getAdapterClass:()=>Promise.all([n.e(2598),n.e(2645),n.e(2635)]).then(n.bind(n,2635)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,ge.getFileName)(t),o=n&&(0,ge.getFileName)(n);return(0,u.testAdapter)(a,/\.gff3?\.b?gz$/i,r,"Gff3TabixAdapter")?{type:"Gff3TabixAdapter",bamLocation:t,gffGzLocation:t,index:{location:n||(0,ge.makeIndex)(t,".tbi"),indexType:(0,ge.makeIndexType)(o,"CSI","TBI")}}:(0,u.testAdapter)(a,/\.gff3?$/i,r,"Gff3Adapter")?{type:"Gff3Adapter",gffLocation:t}:e(t,n,r)})}(e)}}var $t=n(21230),Wt=n(30501),Ut=n(9152),_t=n(41562),qt=n(23758),Jt=n(87485),Xt=n(37962);const Yt=(0,gt.n9)()({bookmarkButton:{overflow:"hidden",position:"absolute",zIndex:800},highlight:{overflow:"hidden",height:"100%",position:"absolute"}}),Kt=(0,p.observer)(function({model:e}){const{classes:t}=Yt(),n=(0,u.getSession)(e),{assemblyManager:r}=n,{bookmarkHighlightsVisible:a,bookmarkLabelsVisible:o}=e,i=n.widgets.get("GridBookmark");(0,c.useEffect)(()=>{i||n.addWidget("GridBookmarkWidget","GridBookmark")},[n,i]);const s=new Set(e.assemblyNames);return a&&i?.bookmarks?i.bookmarks.filter(e=>s.has(e.assemblyName)).map(t=>{const n=r.get(t.assemblyName),a=n?.getCanonicalRefName(t.refName)??t.refName,o=e.bpToPx({refName:a,coord:t.start}),i=e.bpToPx({refName:a,coord:t.end});return o&&i?{width:Math.max(Math.abs(i.offsetPx-o.offsetPx),3),left:Math.min(o.offsetPx,i.offsetPx)-e.offsetPx,highlight:t.highlight,label:t.label,bookmark:t}:void 0}).filter(u.notEmpty).map(({left:e,width:r,highlight:a,label:s,bookmark:l},d)=>(0,h.jsxs)(c.Fragment,{children:[(0,h.jsx)("div",{className:t.highlight,id:"highlight",style:{left:e,width:r,background:a}}),o&&r>20?(0,h.jsx)("div",{className:t.bookmarkButton,style:{left:e},children:(0,h.jsx)(qt.A,{menuItems:[{label:"Open bookmark widget",onClick:()=>{n.showWidget(i)}},{label:"Turn off highlights",onClick:()=>{i.setBookmarkHighlightsVisible(!1)}},{label:"Remove bookmark",onClick:()=>{i.removeBookmarkObject(l)}}],children:(0,h.jsx)(Xt.A,{title:s,arrow:!0,children:(0,h.jsx)($t.A,{fontSize:"small",sx:{color:0!==(0,Jt.M)(a).alpha()?(0,Jt.M)(a).alpha(.8).toRgbString():(0,Jt.M)(a).alpha(0).toRgbString()}})})})}):null]},`${e}_${r}_${d}`)):null}),Qt=Kt,Zt=(0,gt.n9)()({highlight:{height:"100%",position:"absolute"}}),en=(0,p.observer)(function({model:e,overview:t}){const{cytobandOffset:n}=e,r=(0,u.getSession)(e),{classes:a}=Zt(),{assemblyManager:o}=r,{bookmarkHighlightsVisible:i,bookmarkLabelsVisible:s}=e,l=r.widgets.get("GridBookmark");(0,c.useEffect)(()=>{l||r.addWidget("GridBookmarkWidget","GridBookmark")},[r,l]);const d=new Set(e.assemblyNames);return i&&l?.bookmarks?l.bookmarks.filter(e=>d.has(e.assemblyName)).map(e=>{const r=o.get(e.assemblyName),a=r?.getCanonicalRefName(e.refName)??e.refName,i=e.reversed,s=t.bpToPx({refName:a,coord:i?e.end:e.start}),l=t.bpToPx({refName:a,coord:i?e.start:e.end});return void 0!==s&&void 0!==l?{width:Math.abs(l-s),left:s+n,highlight:e.highlight,label:e.label}:void 0}).filter(u.notEmpty).map((e,t)=>{const{left:n,width:r,highlight:o,label:i}=e;return(0,h.jsx)(Xt.A,{title:s?i:"",arrow:!0,children:(0,h.jsx)("div",{className:a.highlight,style:{left:n,width:r,background:o,borderLeft:`1px solid ${o}`,borderRight:`1px solid ${o}`}})},`${JSON.stringify(e)}-${t}`)}):null}),tn=en,nn=v.types.compose(fe.Region,v.types.model("Label",{label:v.types.optional(v.types.string,""),highlight:v.types.optional(v.types.string,"rgba(247, 129, 192, 0.35)")})).actions(e=>({setLabel(t){e.label=t},setHighlight(t){e.highlight=t}})),rn=v.types.model("SharedBookmarksModel",{sharedBookmarks:v.types.maybe(v.types.array(nn))}),an=()=>"undefined"!=typeof window?`bookmarks-${[window.location.host+window.location.pathname].join("-")}`:"empty",on=(0,d.ConfigurationSchema)("GridBookmarkWidget",{});class sn extends a.A{name="GridBookmarkPlugin";install(e){(function(e){e.addWidgetType(()=>new x.WidgetType({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:on,stateModel:v.types.model("GridBookmarkModel",{id:fe.ElementId,type:v.types.literal("GridBookmarkWidget"),bookmarks:v.types.optional(v.types.array(nn),()=>JSON.parse((0,u.localStorageGetItem)(an())||"[]"))}).volatile(()=>({selectedBookmarks:[],selectedAssembliesPre:void 0})).views(e=>({get bookmarkAssemblies(){return[...new Set(e.bookmarks.map(e=>e.assemblyName))]},get validAssemblies(){const{assemblyManager:t}=(0,u.getSession)(e);return new Set(this.bookmarkAssemblies.filter(e=>t.get(e)))},get areBookmarksHighlightedOnAllOpenViews(){const{views:t}=(0,u.getSession)(e);return t.every(e=>!("bookmarkHighlightsVisible"in e)||e.bookmarkHighlightsVisible)},get areBookmarksHighlightLabelsOnAllOpenViews(){const{views:t}=(0,u.getSession)(e);return t.every(e=>!("bookmarkLabelsVisible"in e)||e.bookmarkLabelsVisible)}})).views(e=>({get bookmarksWithValidAssemblies(){return e.bookmarks.filter(t=>e.validAssemblies.has(t.assemblyName))}})).views(e=>({get sharedBookmarksModel(){return rn.create({sharedBookmarks:JSON.parse(JSON.stringify(e.selectedBookmarks))})},get allBookmarksModel(){return rn.create({sharedBookmarks:JSON.parse(JSON.stringify(e.bookmarksWithValidAssemblies))})}})).actions(e=>({setSelectedAssemblies(t){e.selectedAssembliesPre=t}})).views(e=>({get selectedAssemblies(){return e.selectedAssembliesPre?.filter(t=>e.validAssemblies.has(t))??[...e.validAssemblies]}})).actions(e=>({importBookmarks(t){e.bookmarks=(0,v.cast)([...e.bookmarks,...t])},addBookmark(t){e.bookmarks.push(t)},removeBookmark(t){e.bookmarks.splice(t,1)},updateBookmarkLabel(e,t){e.correspondingObj.setLabel(t)},updateBookmarkHighlight(e,t){e.correspondingObj.setHighlight(t)},updateBulkBookmarkHighlights(t){for(const n of e.selectedBookmarks)this.updateBookmarkHighlight(n,t)},setSelectedBookmarks(t){e.selectedBookmarks=t},setBookmarkedRegions(t){e.bookmarks=(0,v.cast)(t)},setBookmarkHighlightsVisible(t){const{views:n}=(0,u.getSession)(e);for(const e of n)e.setBookmarkHighlightsVisible?.(t),e.views?.map(e=>{e.setBookmarkHighlightsVisible?.(t)})},setBookmarkLabelsVisible(t){const{views:n}=(0,u.getSession)(e);for(const e of n)e.setBookmarkLabelsVisible?.(t),e.views?.map(e=>{e.setBookmarkHighlightsVisible?.(t)})}})).actions(e=>({clearAllBookmarks(){e.setBookmarkedRegions(e.bookmarks.filter(t=>!e.validAssemblies.has(t.assemblyName)))},clearSelectedBookmarks(){for(const t of e.selectedBookmarks)e.bookmarks.remove(t.correspondingObj);e.selectedBookmarks=[]},removeBookmarkObject(t){e.bookmarks.remove(t)}})).actions(e=>({afterAttach(){const t=an();function n(n){if(n.key===t){const n=JSON.parse((0,u.localStorageGetItem)(t)||"[]");e.setBookmarkedRegions(n)}}window.addEventListener("storage",n),(0,v.addDisposer)(e,()=>{window.removeEventListener("storage",n)}),(0,v.addDisposer)(e,(0,xe.autorun)(()=>{(0,u.localStorageSetItem)(t,JSON.stringify(e.bookmarks))}))}})).postProcessSnapshot(e=>{const{bookmarks:t,...n}=e;return n}),ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(7343),n.e(6395),n.e(3199)]).then(n.bind(n,53199)))})),function(e){e.addToExtensionPoint("LinearGenomeView-TracksContainerComponent",(e,{model:t})=>[...e||[],(0,h.jsx)(Qt,{model:t},"highlight_grid_bookmark")]),e.addToExtensionPoint("LinearGenomeView-OverviewScalebarComponent",(e,{model:t,overview:n})=>[...e||[],(0,h.jsx)(tn,{model:t,overview:n},"overview_highlight_grid_bookmark")])}(e)})(e),e.addToExtensionPoint("Core-extendPluggableElement",e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,n=t.props({bookmarkHighlightsVisible:!0,bookmarkLabelsVisible:!0}).actions(e=>({setBookmarkHighlightsVisible(t){e.bookmarkHighlightsVisible=t},setBookmarkLabelsVisible(t){e.bookmarkLabelsVisible=t},activateBookmarkWidget(){const t=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(t)){let e=t.widgets.get("GridBookmark");return e||(e=t.addWidget("GridBookmarkWidget","GridBookmark")),t.showWidget(e),t.widgets.get("GridBookmark")}throw new Error("Could not open bookmark widget")}})).actions(e=>({navigateNewestBookmark(){const t=(0,u.getSession)(e),n=e.activateBookmarkWidget();n.bookmarks.length?e.navTo(n.bookmarks.at(-1)):t.notify("There are no recent bookmarks to navigate to.","info")},bookmarkCurrentRegion(){if(e.id===(0,u.getSession)(e).focusedViewId){const t=e.getSelectedRegions(void 0,void 0),n=e.activateBookmarkWidget();if(!t.length)throw new Error("no region selected");n.addBookmark(t[0])}}})).views(e=>{const t=e.menuItems,n=e.rubberBandMenuItems;return{menuItems:()=>[...t(),{type:"divider"},{label:"Bookmarks",icon:Wt.A,subMenu:[{label:"Open bookmark widget",icon:Wt.A,onClick:()=>e.activateBookmarkWidget()},{label:"Bookmark current region",icon:$t.A,onClick:()=>{e.bookmarkCurrentRegion()}},{label:"Toggle bookmark highlights",icon:Ut.A,type:"checkbox",checked:e.bookmarkHighlightsVisible,onClick:()=>{e.setBookmarkHighlightsVisible(!e.bookmarkHighlightsVisible)}},{label:"Toggle bookmark labels",icon:_t.A,type:"checkbox",checked:e.bookmarkLabelsVisible,onClick:()=>{e.setBookmarkLabelsVisible(!e.bookmarkLabelsVisible)}}]}],rubberBandMenuItems:()=>[...n(),{label:"Bookmark region",icon:$t.A,onClick:()=>{const{leftOffset:t,rightOffset:n}=e,r=e.getSelectedRegions(t,n),a=e.activateBookmarkWidget();if(!r.length)throw new Error("no regions selected");a.addBookmark(r[0])}}]}}).actions(e=>{const t=t=>{const n=(t.ctrlKey||t.metaKey)&&t.shiftKey;n&&"KeyD"===t.code&&(t.preventDefault(),e.activateBookmarkWidget(),e.bookmarkCurrentRegion(),(0,u.getSession)(e).notify("Bookmark created.","success")),n&&"KeyM"===t.code&&(t.preventDefault(),e.navigateNewestBookmark())};return{afterCreate(){document.addEventListener("keydown",t)},beforeDestroy(){document.removeEventListener("keydown",t)}}});e.stateModel=n}return e})}configure(e){(0,u.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Bookmarks",icon:Wt.A,onClick:e=>{let t=e.widgets.get("GridBookmark");t||(t=e.addWidget("GridBookmarkWidget","GridBookmark")),e.showWidget(t)}})}}const ln=(0,d.ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",description:"path to gtf file, also allows for gzipped gtf",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}},aggregateField:{type:"string",description:"field used to aggregate multiple transcripts into a single parent gene feature",defaultValue:"gene_name"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gtfLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class cn extends a.A{name="GTFPlugin";install(e){!function(e){e.addAdapterType(()=>new x.AdapterType({name:"GtfAdapter",displayName:"GTF adapter",configSchema:ln,getAdapterClass:()=>Promise.all([n.e(2598),n.e(1503)]).then(n.bind(n,61503)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,ge.getFileName)(t);return(0,u.testAdapter)(a,/\.gtf(\.gz)?$/i,r,"GtfAdapter")?{type:"GtfAdapter",gtfLocation:t}:e(t,n,r)})}(e)}}const dn=(0,d.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,hicLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var un=n(3496),pn=n(198),hn=n(98506),gn=n(44728),mn=n(82088);class fn extends pn.default{supportsSVG=!0;async render(e){const{displayHeight:t,regions:r,bpPerPx:a}=e,o=r[0],i=(o.end-o.start)/a,s=i/2,l=t??s,c=await this.getFeatures(e),{makeImageData:d}=await n.e(9088).then(n.bind(n,49088)),u=await(0,hn.u1)(i,l,e,t=>d(t,{...e,yScalar:l/Math.max(l,s),features:c,pluginManager:this.pluginManager}));return{...await super.render({...e,...u,features:c,region:e.regions[0],height:l,width:i}),...u,height:l,width:i}}async getFeatures(e){const{regions:t,sessionId:n,adapterConfig:r}=e,{dataAdapter:a}=await(0,un.cK)(this.pluginManager,n,r);return await(0,gn._)(a.getFeatures(t[0],e).pipe((0,mn.$)()))}}const yn=(0,p.observer)(function(e){const{width:t,height:n}=e,r=Math.ceil(t);return(0,h.jsx)("div",{style:{position:"relative",width:r,height:n},children:(0,h.jsx)($.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:0}})})}),bn=(0,d.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:interpolate(count,scale)",contextVariable:["count","maxScore","baseColor","scale"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0});function wn(e){return v.types.compose("LinearHicDisplay",C.Lr,v.types.model({type:v.types.literal("LinearHicDisplay"),configuration:(0,d.ConfigurationReference)(e),resolution:v.types.optional(v.types.number,1),useLogScale:!1,colorScheme:v.types.maybe(v.types.string),activeNormalization:"KR",mode:"triangular"})).volatile(()=>({availableNormalizations:void 0})).views(e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps(){const n=e.rendererType.configSchema.create({...(0,d.getConf)(e,"renderer"),...e.colorScheme?{color:"jexl:interpolate(count,scale)"}:{}},(0,v.getEnv)(e));return{...t(),config:n,displayHeight:"adjust"===e.mode?e.height:void 0,normalization:e.activeNormalization,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution,useLogScale:e.useLogScale,colorScheme:e.colorScheme}}}}).actions(e=>({setResolution(t){e.resolution=t},setUseLogScale(t){e.useLogScale=t},setColorScheme(t){e.colorScheme=t},setActiveNormalization(t){e.activeNormalization=t},setAvailableNormalizations(t){e.availableNormalizations=t},setMode(t){e.mode=t}})).views(e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Use log scale",type:"checkbox",checked:e.useLogScale,onClick:()=>{e.setUseLogScale(!e.useLogScale)}},{label:"Rendering mode",type:"subMenu",subMenu:[{label:"Triangular",type:"radio",checked:"triangular"===e.mode,onClick:()=>{e.setMode("triangular")}},{label:"Adjust to height of display",type:"radio",checked:"adjust"===e.mode,onClick:()=>{e.setMode("adjust")}}]},{label:"Color scheme",type:"subMenu",subMenu:[{label:"Fall",type:"radio",checked:"fall"===e.colorScheme,onClick:()=>{e.setColorScheme("fall")}},{label:"Viridis",type:"radio",checked:"viridis"===e.colorScheme,onClick:()=>{e.setColorScheme("viridis")}},{label:"Juicebox",type:"radio",checked:"juicebox"===e.colorScheme,onClick:()=>{e.setColorScheme("juicebox")}},{label:"Default",type:"radio",checked:void 0===e.colorScheme,onClick:()=>{e.setColorScheme(void 0)}}]},{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/2)}}]},...e.availableNormalizations?[{label:"Normalization scheme",subMenu:e.availableNormalizations.map(t=>({label:t,type:"radio",checked:t===e.activeNormalization,onClick:()=>{e.setActiveNormalization(t)}}))}]:[]]}}).actions(e=>({afterAttach(){(0,v.addDisposer)(e,(0,xe.autorun)(async()=>{try{const{rpcManager:t}=(0,u.getSession)(e),n=(0,u.getContainingTrack)(e),r=(0,d.getConf)(n,"adapter"),{norms:a}=await t.call((0,d.getConf)(n,"trackId"),"CoreGetInfo",{adapterConfig:r});a&&e.setAvailableNormalizations(a)}catch(t){console.error(t),(0,u.getSession)(e).notifyError(`${t}`,t)}}))}}))}class vn extends a.A{name="HicPlugin";install(e){!function(e){e.addAdapterType(()=>new x.AdapterType({name:"HicAdapter",displayName:"Hi-C adapter",configSchema:dn,getAdapterClass:()=>Promise.all([n.e(6514),n.e(5312)]).then(n.bind(n,75312)).then(e=>e.default)}))}(e),function(e){e.addRendererType(()=>new fn({name:"HicRenderer",ReactComponent:yn,configSchema:bn,pluginManager:e}))}(e),function(e){e.addTrackType(()=>{const t=(e=>(0,d.ConfigurationSchema)("HicTrack",{},{baseConfiguration:(0,x.createBaseTrackConfig)(e)}))(e);return new Bt.A({name:"HicTrack",displayName:"Hi-C track",configSchema:t,stateModel:(0,P.createBaseTrackModel)(e,"HicTrack",t)})})}(e),function(e){e.addDisplayType(()=>{const t=(e=>(0,d.ConfigurationSchema)("LinearHicDisplay",{renderer:e.getRendererType("HicRenderer").configSchema},{baseConfiguration:C.Ki,explicitlyTyped:!0}))(e);return new x.DisplayType({name:"LinearHicDisplay",displayName:"Hi-C contact matrix display",configSchema:t,stateModel:wn(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:C.GQ})})}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,ge.getFileName)(t);return/\.hic$/i.test(a)&&!r||"HicAdapter"===r?{type:"HicAdapter",hicLocation:t}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"HicAdapter"===t?"HicTrack":e(t))}(e)}configure(e){const{jexl:t}=e;t.addFunction("alpha",(e,t)=>e.alpha(t)),t.addFunction("hsl",e=>(0,Jt.M)(e.toHsl())),t.addFunction("colorString",e=>e.toHex()),t.addFunction("interpolate",(e,t)=>t(e))}}const Sn=v.types.model("Job",{name:v.types.string,statusMessage:v.types.maybe(v.types.string),progressPct:v.types.number}).volatile(()=>({cancelCallback(){}})).actions(e=>({setCancelCallback(t){e.cancelCallback=t},setStatusMessage(t){e.statusMessage=t},setProgressPct(t){e.progressPct=t}})),xn=(0,d.ConfigurationSchema)("JobsListWidget",{});class Cn extends a.A{name="JobsManagementPlugin";install(e){!function(e){e.addWidgetType(()=>new x.WidgetType({name:"JobsListWidget",heading:"Jobs list",configSchema:xn,stateModel:v.types.model("JobsListModel",{id:fe.ElementId,type:v.types.literal("JobsListWidget"),jobs:v.types.array(Sn),finished:v.types.array(Sn),queued:v.types.array(Sn),aborted:v.types.array(Sn)}).actions(e=>({addJob(t){const{cancelCallback:n,name:r}=t,a=e.jobs.find(e=>e.name===r);if(a)return a;const o=e.jobs.push(t),i=e.jobs[o-1];return i.setCancelCallback(n),i},removeJob(t){const n=e.jobs.findIndex(e=>e.name===t);if(-1!==n)return e.jobs.splice(n,1)[0]},addFinishedJob(t){const n=e.finished.find(e=>e.name===t.name);if(n)return n;const r=e.finished.push(t);return e.finished[r-1]},addQueuedJob(t){const n=e.queued.find(e=>e.name===t.name);if(n)return n;const r=e.queued.push(t);return e.queued[r-1]},addAbortedJob(t){const n=e.aborted.find(e=>e.name===t.name);if(n)return n;const r=e.aborted.push(t);return e.aborted[r-1]},removeQueuedJob(t){const n=e.queued.findIndex(e=>e.name===t);if(-1!==n)return e.queued.splice(n,1)[0]},updateJobStatusMessage(t,n){const r=e.jobs.find(e=>e.name===t);if(!r)throw new Error(`No job found with name ${t}`);r.setStatusMessage(n)},updateJobProgressPct(t,n){const r=e.jobs.find(e=>e.name===t);if(!r)throw new Error(`No job found with name ${t}`);r.setProgressPct(n)}})),ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(6386),n.e(9168)]).then(n.bind(n,29168)))}))}(e)}configure(e){(0,u.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Jobs list",icon:Qe.jT,onClick:e=>{if((0,u.isSessionModelWithWidgets)(e)){const{widgets:t}=e;let n=t.get("JobsList");n||(n=e.addWidget("JobsListWidget","JobsList")),e.showWidget(n)}}})}}var kn=n(91612);const Tn=(0,d.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:P.baseConnectionConfig});function An(e){return v.types.compose("JBrowse1Connection",(0,P.BaseConnectionModelFactory)(e),v.types.model({configuration:(0,d.ConfigurationReference)(Tn),type:v.types.literal("JBrowse1Connection")})).actions(e=>({async connect(){const t=(0,u.getSession)(e);try{const r=(0,d.getConf)(e,"dataDirLocation"),{fetchJb1:a}=await n.e(8504).then(n.bind(n,98504)),{convertTrackConfig:o}=await n.e(5998).then(n.bind(n,55998)),i=await a(r),s=(0,d.getConf)(e,"assemblyNames")[0];if(!s)throw new Error("assembly name required for JBrowse 1 connection");const l=t.assemblies.find(e=>(0,d.readConfObject)(e,"name")===s);if(!l)throw new Error(`Assembly "${s}" not found`);const c=(0,d.readConfObject)(l,["sequence","adapter"]),u=i.tracks?.map(e=>({...o(e,i.dataRoot||"",c),assemblyNames:[s]}));e.setTrackConfs(u)}catch(n){console.error(n),t.notifyError(`There was a problem connecting to the JBrowse 1 data directory "${e.name}". Please make sure you have entered a valid location. The error that was thrown is: "${n}"`,n),t.breakConnection?.(e.configuration)}}}))}var Mn=n(8024);const Pn=(0,d.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),Rn=(0,d.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0});class In extends a.A{name="LegacyJBrowsePlugin";install(e){!function(e){e.addAdapterType(()=>new x.AdapterType({name:"NCListAdapter",displayName:"NCList adapter",configSchema:Rn,adapterMetadata:{category:"Uncommon"},getAdapterClass:()=>n.e(7645).then(n.bind(n,47645)).then(e=>e.default)}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,ge.getFileName)(t);return/trackData.jsonz?$/i.test(a)&&!r||"NCListAdapter"===r?{type:"NCListAdapter",rootUrlTemplate:t}:e(t,n,r)})}(e),function(e){e.addTextSearchAdapterType(()=>new Mn.A({name:"JBrowse1TextSearchAdapter",configSchema:Pn,description:"A JBrowse 1 text search adapter",getAdapterClass:()=>Promise.all([n.e(7097),n.e(8797)]).then(n.bind(n,58797)).then(e=>e.default)}))}(e),function(e){e.addConnectionType(()=>new kn.A({name:"JBrowse1Connection",configSchema:Tn,stateModel:An(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"}))}(e)}}var Ln=n(71331);const Fn=(0,c.lazy)(()=>n.e(3301).then(n.bind(n,33301)));const Nn=function(e){return(0,d.ConfigurationSchema)("LinearComparativeDisplay",{},{explicitlyTyped:!0,explicitIdentifier:"displayId"})};function Dn(e){const{rpcManager:t}=(0,u.getSession)(e),n=e;(0,d.readConfObject)(e.configuration);const{level:r,adapterConfig:a}=e,o=(0,u.getContainingView)(e),i=(0,ge.getRpcSessionId)(e);return(0,v.getSnapshot)(o),o.initialized?{rpcManager:t,renderProps:{...n.renderProps(),model:n,level:r,view:o,adapterConfig:a,sessionId:i,timeout:1e6,self:e}}:void 0}async function Bn(e){if(!e)return;const{rpcManager:t,renderProps:n}=e,{model:r,sessionId:a,adapterConfig:o,level:i}=n,s=n.view.views[i];return{features:(0,u.dedupe)(await t.call("getFeats","CoreGetFeatures",{regions:s.staticBlocks.contentBlocks,sessionId:a,adapterConfig:o,statusCallback:e=>{r.setLoadingStatus(e)}}),e=>e.id())}}const jn=function(e){return v.types.compose("LinearComparativeDisplay",P.BaseDisplay,v.types.model({type:v.types.literal("LinearComparativeDisplay"),configuration:(0,d.ConfigurationReference)(e)})).volatile(()=>({renderInProgress:void 0,features:void 0,message:void 0,loadingStatus:void 0})).views(e=>({get level(){return(0,v.getParent)(e,4).level},get height(){return(0,v.getParent)(e,4).height},renderProps:()=>({rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2})})).actions(e=>{let t;return{setLoading(n){e.message=void 0,e.error=void 0,t=n},setMessage(n){e.message=n,e.error=void 0,t=void 0},setLoadingStatus(t){e.loadingStatus=t},setRendered(n){if(!n)return;const{features:r}=n,a=e.features||[],o=new Set(a.map(e=>e.id())),i=new Set(r.map(e=>e.id()));let s=!1,l=!1;for(const e of r)if(!o.has(e.id())){s=!0;break}for(const e of a)if(!i.has(e.id())){l=!0;break}e.message=void 0,e.error=void 0,t=void 0,(s||l||!e.features)&&(e.features=r)},setError(n){console.error(n),void 0!==t&&(0,Je.CF)(t),e.message=void 0,e.error=n,t=void 0}}}).actions(e=>({afterAttach(){(0,u.makeAbortableReaction)(e,Dn,Bn,{name:`${e.type} ${e.id} rendering`,delay:1e3,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)}}))},Vn=(0,c.lazy)(()=>n.e(7686).then(n.bind(n,87686))),En=function(e){const t=e.getViewType("LinearSyntenyViewHelper")?.stateModel;return v.types.compose("LinearComparativeView",Ke.A,v.types.model({id:fe.ElementId,type:v.types.literal("LinearComparativeView"),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactiveOverlay:!1,showDynamicControls:!0,levels:v.types.array(t),views:v.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:v.types.array(e.pluggableConfigSchemaType("track"))})).volatile(()=>({width:void 0})).views(e=>({get initialized(){return void 0!==e.width&&e.views.length>0&&e.views.every(e=>e.initialized)},get refNames(){return e.views.map(e=>[...new Set(e.staticBlocks.map(e=>e.refName))])},get assemblyNames(){return[...new Set(e.views.flatMap(e=>e.assemblyNames))]}})).actions(e=>({afterAttach(){const t=new Set(["horizontalScroll","zoomTo","setScaleFactor"]);(0,v.addDisposer)(e,(0,v.onAction)(e,n=>{if(e.linkViews){const{name:e,path:r,args:a}=n;t.has(e)&&r&&this.onSubviewAction(e,r,a)}}))},beforeDestroy(){const t=(0,u.getSession)(e);for(const n of e.assemblyNames)t.removeTemporaryAssembly?.(n)},onSubviewAction(t,n,r){for(const a of e.views)(0,v.getPath)(a).endsWith(n)||a[t](r?.[0])},setWidth(t){e.width=t},setViews(t){e.views=(0,v.cast)(t);const n=[];for(let e=0;e<t.length-1;e++)n.push({level:e});e.levels=(0,v.cast)(n)},removeView(t){e.views.remove(t)},setLevelHeight(t,n=0){const r=e.levels[n];return r.setHeight(t),r.height},setLinkViews(t){e.linkViews=t},setShowDynamicControls(t){e.showDynamicControls=t},activateTrackSelector(t){if("hierarchical"===e.trackSelectorType){const n=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(n)){const r=n.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e.levels[t]});return n.showWidget(r),r}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},toggleTrack(t,n=0){e.levels[n]?.toggleTrack(t)},showTrack(t,n=0,r={}){e.levels[n]||(e.levels[n]=(0,v.cast)({level:n})),e.levels[n].showTrack(t,r)},hideTrack(t,n=0){e.levels[n]?.hideTrack(t)},squareView(){const t=(0,u.avg)(e.views.map(e=>e.bpPerPx));for(const n of e.views){const e=n.pxToBp(n.width/2);n.setNewView(t,n.offsetPx),e.refName&&n.centerAt(e.coord,e.refName,e.index)}},clearView(){e.views=(0,v.cast)([]),e.levels=(0,v.cast)([])}})).views(()=>({headerMenuItems:()=>[]})).views(e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[Vn,{model:e,handleClose:t}])},icon:Ze.A}],rubberBandMenuItems:()=>[{label:"Zoom to region(s)",onClick:()=>{for(const t of e.views){const{leftOffset:e,rightOffset:n}=t;e&&n&&t.moveTo(e,n)}}}]})).actions(e=>({afterAttach(){(0,v.addDisposer)(e,(0,xe.autorun)(()=>{if(e.width)for(const t of e.views)t.setWidth(e.width)}))}})).preProcessSnapshot(e=>{const{tracks:t,levels:n=[{tracks:t,level:0}],...r}=e||{};return{...r,levels:n}})},zn=(0,c.lazy)(()=>n.e(3416).then(n.bind(n,3416))),On=function(e){return v.types.compose("LinearSyntenyDisplay",jn(e),v.types.model({type:v.types.literal("LinearSyntenyDisplay"),configuration:(0,d.ConfigurationReference)(e),colorBy:v.types.optional(v.types.string,"default")})).volatile(()=>({mainCanvas:null,clickMapCanvas:null,cigarClickMapCanvas:null,mouseoverCanvas:null,featPositions:[],mouseoverId:void 0,clickId:void 0,cigarMouseoverId:-1,alpha:.2,minAlignmentLength:0})).actions(e=>({setFeatPositions(t){e.featPositions=t},setMainCanvasRef(t){e.mainCanvas=t},setClickMapCanvasRef(t){e.clickMapCanvas=t},setCigarClickMapCanvasRef(t){e.cigarClickMapCanvas=t},setMouseoverCanvasRef(t){e.mouseoverCanvas=t},setMouseoverId(t){e.mouseoverId=t},setCigarMouseoverId(t){e.cigarMouseoverId=t},setClickId(t){e.clickId=t},setAlpha(t){e.alpha=t},setMinAlignmentLength(t){e.minAlignmentLength=t},setColorBy(t){e.colorBy=t}})).views(e=>({get adapterConfig(){return{name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,d.getConf)(e,"assemblyNames"),...(0,d.getConf)(e.parentTrack,"adapter")}},get trackIds(){return(0,d.getConf)(e,"trackIds")},get numFeats(){return e.featPositions.length},get ready(){return this.numFeats>0},get featMap(){return Object.fromEntries(e.featPositions.map(e=>[e.f.id(),e]))}})).actions(e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await Promise.all([n.e(1770),n.e(8856)]).then(n.bind(n,28856));t(e)}catch(t){console.error(t),e.setError(t)}})()}}))};var Hn=n(1618),Gn=n(50421),$n=n(20482);function Wn(e){const t=(0,l.c)(3);let n,r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,h.jsx)("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"}),t[0]=n):n=t[0],t[1]!==e?(r=(0,h.jsx)(V.A,{...e,children:n}),t[1]=e,t[2]=r):r=t[2],r}const Un=(0,c.lazy)(()=>n.e(893).then(n.bind(n,20893))),_n=(0,c.lazy)(()=>n.e(5262).then(n.bind(n,25262)));function qn(e){return v.types.compose("LinearSyntenyView",En(e),v.types.model({type:v.types.literal("LinearSyntenyView"),drawCIGAR:!0,drawCIGARMatchesOnly:!1,drawCurves:!1,drawLocationMarkers:!1})).volatile(()=>({importFormSyntenyTrackSelections:xe.observable.array()})).actions(e=>({importFormRemoveRow(t){e.importFormSyntenyTrackSelections.splice(t,1)},clearImportFormSyntenyTracks(){e.importFormSyntenyTrackSelections.clear()},setImportFormSyntenyTrack(t,n){e.importFormSyntenyTrackSelections[t]=n},setDrawCurves(t){e.drawCurves=t},setDrawCIGAR(t){e.drawCIGAR=t},setDrawCIGARMatchesOnly(t){e.drawCIGARMatchesOnly=t},setDrawLocationMarkers(t){e.drawLocationMarkers=t},showAllRegions(){(0,xe.transaction)(()=>{for(const t of e.views)t.showAllRegionsInAssembly()})}})).actions(e=>({async exportSvg(t){const{renderToSvg:r}=await Promise.all([n.e(1770),n.e(3047)]).then(n.bind(n,93047)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,Se.saveAs)(o,t.filename||"image.svg")}})).views(e=>{const t=e.headerMenuItems,n=e.menuItems;return{headerMenuItems:()=>[...t(),{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:Hn.A,helpText:"Square view synchronizes the zoom levels of both genome views by calculating the average zoom level and applying it to both panels. This helps ensure features are displayed at comparable scales, making it easier to compare syntenic regions visually."},{label:"Show all regions",onClick:e.showAllRegions,description:"Show entire genome assemblies",icon:$n.A,helpText:"This command will zoom out all views to display the entire genome assemblies. This is useful when you want to get a high-level overview of syntenic relationships across whole genomes or when you need to reset the view after zooming into specific regions."},{label:"Re-order chromosomes",onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[_n,{handleClose:t,model:e}])},icon:Gn.A,description:"Reorder and reorient query regions to minimize crossing lines, also known as 'diagonalizing'",helpText:"This operation 'diagonalizes' the data which algorithmically reorders and reorients chromosomes to minimize crossing synteny lines, creating a more diagonal pattern. This makes it easier to identify large-scale genomic rearrangements, inversions, and translocations. The process may take a few moments for large genomes."},{label:"Show dynamic controls",type:"checkbox",checked:e.showDynamicControls,onClick:()=>{e.setShowDynamicControls(!e.showDynamicControls)},helpText:"Toggle visibility of dynamic controls like opacity and minimum length sliders. These controls allow you to adjust synteny visualization parameters in real-time."},{label:"Draw",subMenu:[{label:"Draw CIGAR",checked:e.drawCIGAR,type:"checkbox",description:"If disabled, only draws the broad scale CIGAR match",onClick:()=>{e.setDrawCIGAR(!e.drawCIGAR)},helpText:"CIGAR strings encode detailed alignment information including matches, insertions, and deletions. When enabled, this option visualizes the fine-scale variations in syntenic alignments. Disable this for a cleaner view that shows only broad syntenic blocks."},{label:"Draw only CIGAR matches",checked:e.drawCIGARMatchesOnly,type:"checkbox",description:"If enabled, it hides the insertions and deletions in the CIGAR strings, helps with divergent",onClick:()=>{e.setDrawCIGARMatchesOnly(!e.drawCIGARMatchesOnly)},helpText:"When comparing divergent genomes, showing all insertions and deletions can clutter the view. This option filters the CIGAR visualization to show only the matching regions, providing a cleaner view of conserved syntenic blocks while hiding small-scale indels."},{label:"Draw curved lines",type:"checkbox",checked:e.drawCurves,icon:Wn,onClick:()=>{e.setDrawCurves(!e.drawCurves)},helpText:"Toggle between straight lines and smooth bezier curves for synteny connections. Curved lines can make the visualization more aesthetically pleasing and may help reduce visual clutter when many syntenic regions are displayed. Straight lines provide a more direct representation."},{label:"Draw location markers",type:"checkbox",checked:e.drawLocationMarkers,description:"Draw periodic markers to show location within large matches",onClick:()=>{e.setDrawLocationMarkers(!e.drawLocationMarkers)},helpText:"Location markers add periodic visual indicators along long syntenic blocks, helping you track position and scale within large conserved regions. This is particularly useful when examining very long syntenic matches where it can be difficult to gauge relative position."}]},{label:"Link views",type:"checkbox",checked:e.linkViews,icon:we.A,onClick:()=>{e.setLinkViews(!e.linkViews)},helpText:"When linked, panning and zooming in one genome view will automatically adjust the other view to maintain the correspondence shown by synteny lines. This makes it easier to explore syntenic regions interactively. Unlink views to navigate each genome independently."},{label:"Export SVG",icon:ve.A,onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[Un,{model:e,handleClose:t}])},helpText:"Export the current synteny view as a scalable vector graphics (SVG) file. SVG format preserves quality at any zoom level and can be edited in vector graphics software like Inkscape or Adobe Illustrator. Perfect for creating publication-quality figures."}],menuItems:()=>[...n(),{label:"Export SVG",icon:ve.A,onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[Un,{model:e,handleClose:t}])}}]}})}function Jn(e){return v.types.model("LinearSyntenyViewHelper",{id:fe.ElementId,type:"LinearSyntenyViewHelper",tracks:v.types.array(e.pluggableMstType("track","stateModel")),height:100,level:v.types.number}).actions(t=>({setHeight:e=>(t.height=e,t.height),showTrack(n,r={}){const a=e.pluggableConfigSchemaType("track"),o=(0,v.resolveIdentifier)(a,(0,v.getRoot)(t),n);if(!o)throw new Error(`track not found ${n}`);const i=e.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map(e=>e.name)),c=o.displays.find(e=>l.has(e.type));if(!c)throw new Error(`could not find a compatible display for view type ${t.type}`);t.tracks.push(i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:c.type,configuration:c}]}))},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=(0,v.resolveIdentifier)(r,(0,v.getRoot)(t),n),o=t.tracks.filter(e=>e.configuration===a);return(0,xe.transaction)(()=>{for(const e of o)t.tracks.remove(e)}),o.length},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)}})).views(e=>({get assemblyNames(){const t=(0,v.getParent)(e,2);return[t.views[e.level].assemblyNames[0],t.views[e.level+1].assemblyNames[0]]}}))}function Xn(){const e=(0,l.c)(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,h.jsx)("div",{}),e[0]=t):t=e[0],t}var Yn=n(9342),Kn=n(67736);const Qn=(0,d.ConfigurationSchema)("SyntenyFeatureWidget",{});function Zn(e){return v.types.compose((0,Yn.n)(e),v.types.model("SyntenyFeatureWidget",{type:v.types.literal("SyntenyFeatureWidget"),level:v.types.maybe(v.types.number)}))}class er extends a.A{name="LinearComparativeViewPlugin";install(e){!function(e){e.addViewType(()=>new Ft.A({name:"LinearSyntenyViewHelper",displayName:"Linear synteny view (helper)",viewMetadata:{hiddenFromGUI:!0},stateModel:Jn(e),ReactComponent:Xn}))}(e),function(e){e.addViewType(()=>new Ft.A({name:"LinearComparativeView",viewMetadata:{hiddenFromGUI:!0},displayName:"Linear comparative view",stateModel:En(e),ReactComponent:(0,c.lazy)(()=>n.e(6423).then(n.bind(n,16423)))}))}(e),function(e){e.addViewType(()=>new Ft.A({name:"LinearSyntenyView",displayName:"Linear synteny view",stateModel:qn(e),ReactComponent:(0,c.lazy)(()=>n.e(3795).then(n.bind(n,13795)))}))}(e),function(e){e.addDisplayType(()=>{const e=Nn();return new ut.A({name:"LinearComparativeDisplay",configSchema:e,stateModel:jn(e),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:()=>null})})}(e),function(e){e.addDisplayType(()=>{const e=(0,d.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:Nn(),explicitlyTyped:!0});return new ut.A({name:"LinearSyntenyDisplay",configSchema:e,stateModel:On(e),trackType:"SyntenyTrack",viewType:"LinearSyntenyViewHelper",ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(1770),n.e(8384)]).then(n.bind(n,88384)))})})}(e),function(e){e.addWidgetType(()=>new Kn.A({name:"SyntenyFeatureWidget",heading:"Synteny feature details",configSchema:Qn,stateModel:Zn(e),ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6386),n.e(1475),n.e(5300),n.e(4700)]).then(n.bind(n,64700)))}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return e.jexl.addFunction("lgvSyntenyTooltip",e=>{const t=e.get("mate"),n=e.get("name")||e.get("id"),r=t?.name||t?.id;return[n?`Name1: ${n}`:"",r?`Name2: ${r}`:"",`Loc1: ${(0,u.assembleLocString)({refName:e.get("refName"),start:e.get("start"),end:e.get("end")})} (${(0,u.toLocale)(e.get("end")-e.get("start"))}bp)`,`Loc2: ${(0,u.assembleLocString)({refName:t.refName,start:t.start,end:t.end})} (${(0,u.toLocale)(t.end-t.start)}bp)`].filter(e=>!!e).join("<br/>")}),(0,d.ConfigurationSchema)("LGVSyntenyDisplay",{mouseover:{type:"string",defaultValue:"jexl:lgvSyntenyTooltip(feature)"}},{baseConfiguration:(0,r.ww)(e),explicitlyTyped:!0})}(e),n=(a=t,v.types.compose("LGVSyntenyDisplay",(0,r.N5)(a),v.types.model({type:v.types.literal("LGVSyntenyDisplay"),configuration:(0,d.ConfigurationReference)(a)})).views(e=>{const t=e.contextMenuItems;return{contextMenuItems(){const n=e.contextMenuFeature;return[...t(),...n?[{label:"Launch synteny view for this position",onClick:()=>{(0,u.getSession)(e).queueDialog(t=>[Fn,{view:(0,u.getContainingView)(e),trackId:(0,d.getConf)((0,u.getContainingTrack)(e),"trackId"),handleClose:t,session:(0,u.getSession)(e),feature:n}])}}]:[]]}}}).views(e=>{const{trackMenuItems:t,colorSchemeSubMenuItems:n}=e;return{trackMenuItems:()=>[...t(),{label:"Color scheme",subMenu:[...n()]}]}}).actions(e=>({selectFeature(t){const n=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(n)){let r=(0,u.getContainingView)(e);try{r=(0,u.getContainingView)(r)}catch(e){}const a=n.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:t.toJSON(),view:r,track:(0,u.getContainingTrack)(e)});n.showWidget(a)}n.setSelection(t)},afterCreate(){e.colorBySetting||"normal"!==e.colorBy.type||e.setColorScheme({type:"strand"})}})));var a;return new ut.A({name:"LGVSyntenyDisplay",configSchema:t,stateModel:n,trackType:"SyntenyTrack",viewType:"LinearGenomeView",ReactComponent:C.GQ})})}(e),function(e){e.addToExtensionPoint("LaunchView-LinearSyntenyView",async({session:e,views:t,tracks:n=[]})=>{try{const{assemblyManager:a}=e,o=e.addView("LinearSyntenyView",{});await(0,xe.when)(()=>!!o.width),o.setViews(await Promise.all(t.map(async e=>{const t=await a.waitForAssembly(e.assembly);if(!t)throw new Error(`Assembly ${e.assembly} failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:t.regions}}))),await Promise.all(o.views.map(e=>(0,xe.when)(()=>e.initialized)));let i=[];if(await Promise.all(t.map(async(e,t)=>{const n=o.views[t],{assembly:r,loc:s,tracks:l=[]}=e,c=await a.waitForAssembly(r);if(!c)throw new Error(`Assembly ${e.assembly} failed to load`);await n.navToSearchString({input:s,assembly:c}),i=[...i,...l.map(e=>function({model:e,trackId:t}){try{e.showTrack(t)}catch(e){if(/Could not resolve identifier/.exec(`${e}`)||/track not found/.exec(`${e}`))return t;throw e}}({model:n,trackId:e}))]})),i=[...i,...(r=n,Array.isArray(r[0])?r:[r]).flatMap((e,t)=>e.map(e=>function({model:e,trackId:t,level:n}){try{e.showTrack(t,n)}catch(e){if(/Could not resolve identifier/.exec(`${e}`)||/track not found/.exec(`${e}`))return t;throw e}}({model:o,trackId:e,level:t})))],i.filter(u.notEmpty).length)throw new Error(`Could not resolve identifiers: ${i.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}var r})}(e),function(e){e.addTrackType(()=>{const t=(e=>(0,d.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:(0,P.createBaseTrackConfig)(e)}))(e);return new Bt.A({name:"SyntenyTrack",configSchema:t,stateModel:(0,P.createBaseTrackModel)(e,"SyntenyTrack",t)})})}(e),e.addToExtensionPoint("Core-extendPluggableElement",e=>("LinearPileupDisplay"!==e.name||(e.stateModel=e.stateModel.extend(e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const n=e.contextMenuFeature,r=(0,u.getContainingTrack)(e);return[...t(),...n?[{label:"Linear read vs ref",icon:Ct.A,onClick:()=>{(0,u.getSession)(e).queueDialog(e=>[zn,{track:r,feature:n,handleClose:e}])}}]:[]]}}}})),e))}configure(e){(0,u.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:Ln.A,onClick:e=>{e.addView("LinearSyntenyView",{})}})}}function tr(e){return v.types.compose("LinearLollipopDisplay",C.Lr,v.types.model({type:v.types.literal("LinearLollipopDisplay"),configuration:(0,d.ConfigurationReference)(e)})).views(e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}})}var nr=n(98111),rr=n(31415),ar=n(88217),or=n(32595);class ir{totalHeight=0;rectangles=new Map;constructor({width:e}){if(!e)throw new Error("width required to make a new FloatingLayout");this.width=e}discardRange(){this.items=[],this.layout=new Map,this.totalHeight=0}items=[];layout=new Map;add(e,t,n,r,a){this.items.push({uniqueId:e,anchorLocation:t,width:n,height:r,data:a})}getLayout(e){if(!e)return this.layout;const t=(0,d.readConfObject)(e,"minStickLength"),n=this.items.sort((e,t)=>e.data.score-t.data.score);let r=0;const a=new Array(n.length);for(const[e,o]of n.entries()){const n=o,{anchorLocation:i,width:s,height:l}=n,c=i-s/2,d=c+s;let u=t,p=u+l;for(let t=0;t<e;t+=1){const[,e]=a[t],{x:n,y:r,width:o,height:i}=e,s=n+o,h=r+i;(0,or.R6)(n,s,c,d)&&(0,or.R6)(r,h,u,p)&&(u=h,p=u+l,t=-1)}a[e]=[n.uniqueId,{...n,x:c,y:u}],p>r&&(r=p)}return this.totalHeight=r,this.layout=new Map(a),this.layout}getTotalHeight(){return this.totalHeight}serializeRegion(){return this.toJSON()}toJSON(){return{pairs:[...this.getLayout()],totalHeight:this.getTotalHeight()}}static fromJSON(){throw new Error("not supported")}}class sr{constructor({pairs:e,totalHeight:t}){this.layout=new Map(e),this.totalHeight=t}add(e){if(!this.layout.has(e))throw new Error(`layout error, precomputed layout is missing ${e}`)}getLayout(){return this.layout}getTotalHeight(){return this.totalHeight}discardRange(){}static fromJSON(e){return new sr(e)}}class lr extends rr.h{makeLayout(){const{end:e,start:t}=this.props.regions[0],n=(e-t)/this.props.bpPerPx;return new ar.MultiLayout(ir,{width:n})}layoutIsValid(){return!1}}class cr extends nr.default{createLayoutSession(e){return new lr(e)}deserializeLayoutInClient(e){return new sr(e)}}var dr=n(80208);function ur(e){const t=(0,l.c)(19),{feature:n,config:r,layoutRecord:a}=e,{y:o,data:i}=a,{anchorX:s,radiusPx:c,score:u}=i;let p,g,m,f,y,b,w;if(t[0]!==r||t[1]!==n||t[2]!==c||t[3]!==u){b=Symbol.for("react.early_return_sentinel");{const e=(0,d.readConfObject)(r,"innerColor",{feature:n});g=String(u),p=2*c/g.length*1.1,p<12?b=null:(m="none",f=p,y=(0,dr.contrastingTextColor)(e))}t[0]=r,t[1]=n,t[2]=c,t[3]=u,t[4]=p,t[5]=g,t[6]=m,t[7]=f,t[8]=y,t[9]=b}else p=t[4],g=t[5],m=t[6],f=t[7],y=t[8],b=t[9];if(b!==Symbol.for("react.early_return_sentinel"))return b;t[10]!==m||t[11]!==f||t[12]!==y?(w={pointerEvents:m,fontSize:f,fill:y},t[10]=m,t[11]=f,t[12]=y,t[13]=w):w=t[13];const v=o+c-p/2.4;let S;return t[14]!==s||t[15]!==g||t[16]!==w||t[17]!==v?(S=(0,h.jsx)("text",{style:w,x:s,y:v,textAnchor:"middle",dominantBaseline:"hanging",children:g}),t[14]=s,t[15]=g,t[16]=w,t[17]=v,t[18]=S):S=t[18],S}const pr=(0,p.observer)(function(e){const{feature:t,config:n,layoutRecord:r,selectedFeatureId:a}=e,{anchorLocation:o,y:i,data:{radiusPx:s}}=r,l={fill:(0,d.readConfObject)(n,"strokeColor",{feature:t})};String(a)===String(t.id())&&(l.fill="red");const c={fill:(0,d.readConfObject)(n,"innerColor",{feature:t})},u=(0,d.readConfObject)(n,"strokeWidth",{feature:t});return(0,h.jsxs)("g",{"data-testid":t.id(),children:[(0,h.jsx)("title",{children:(0,d.readConfObject)(n,"caption",{feature:t})}),(0,h.jsx)("circle",{cx:o,cy:i+s,r:s,style:l,onMouseDown:t=>{const{onFeatureMouseDown:n,feature:r}=e;return n?.(t,r.id())},onMouseEnter:t=>{const{onFeatureMouseEnter:n,feature:r}=e;return n?.(t,r.id())},onMouseOut:t=>{const{onFeatureMouseOut:n,feature:r}=e;return n?.(t,r.id())},onMouseOver:t=>{const{onFeatureMouseOver:n,feature:r}=e;return n?.(t,r.id())},onMouseUp:t=>{const{onFeatureMouseUp:n,feature:r}=e;return n?.(t,r.id())},onMouseLeave:t=>{const{onFeatureMouseLeave:n,feature:r}=e;return n?.(t,r.id())},onMouseMove:t=>{const{onFeatureMouseMove:n,feature:r}=e;return n?.(t,r.id())},onClick:t=>{const{onFeatureClick:n,feature:r}=e;return t.stopPropagation(),n?.(t,r.id())},onFocus:t=>{const{onFeatureMouseOver:n,feature:r}=e;return n?.(t,r.id())},onBlur:t=>{const{onFeatureMouseOut:n,feature:r}=e;return n?.(t,r.id())}}),s-u<=2?null:(0,h.jsx)("circle",{cx:o,cy:i+s,r:s-u,style:c,onMouseDown:t=>{const{onFeatureMouseDown:n,feature:r}=e;return n?.(t,r.id())},onMouseEnter:t=>{const{onFeatureMouseEnter:n,feature:r}=e;return n?.(t,r.id())},onMouseOut:t=>{const{onFeatureMouseOut:n,feature:r}=e;return n?.(t,r.id())},onMouseOver:t=>{const{onFeatureMouseOver:n,feature:r}=e;return n?.(t,r.id())},onMouseUp:t=>{const{onFeatureMouseUp:n,feature:r}=e;return n?.(t,r.id())},onMouseLeave:t=>{const{onFeatureMouseLeave:n,feature:r}=e;return n?.(t,r.id())},onMouseMove:t=>{const{onFeatureMouseMove:n,feature:r}=e;return n?.(t,r.id())},onClick:t=>{const{onFeatureClick:n,feature:r}=e;return t.stopPropagation(),n?.(t,r.id())},onFocus:t=>{const{onFeatureMouseOver:n,feature:r}=e;return n?.(t,r.id())},onBlur:t=>{const{onFeatureMouseOut:n,feature:r}=e;return n?.(t,r.id())}}),(0,h.jsx)(ur,{feature:t,config:n,layoutRecord:r})]})}),hr=(0,p.observer)(function({feature:e,config:t,layoutRecord:{anchorLocation:n,y:r,data:{radiusPx:a}}}){return(0,h.jsx)("line",{x1:n,y1:0,x2:n,y2:r+2*a,stroke:(0,d.readConfObject)(t,"stickColor",{feature:e}),strokeWidth:(0,d.readConfObject)(t,"stickWidth",{feature:e})})});function gr(e){const{feature:t,bpPerPx:n,config:r,region:a,layout:o}=e,i=Math.abs(t.get("end")+t.get("start"))/2,s=(0,u.bpToPx)(i,a,n),l=(0,d.readConfObject)(r,"radius",{feature:t});l||console.error(new Error(`lollipop radius ${l} configured for feature ${t.id()}`)),o.add(t.id(),s,2*l,2*l,{featureId:t.id(),anchorX:s,radiusPx:l,score:(0,d.readConfObject)(e.config,"score",{feature:t})})}const mr=(0,p.observer)(function(e){const t=t=>{const{onMouseEnter:n}=e;return n?.(t)},n=t=>{const{onMouseLeave:n}=e;return n?.(t)},[r,a]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a(!0)},[]);const{regions:o,bpPerPx:i,layout:s,config:l,features:d=new Map,displayModel:u={}}=e,{selectedFeatureId:p}=u,g=o[0];for(const e of d.values())gr({feature:e,bpPerPx:i,region:g,config:l,layout:s});const m=(g.end-g.start)/i,f=[...s.getLayout(l).values()],y=s.getTotalHeight();return(0,h.jsx)("svg",{width:m,height:y,style:{position:"relative"},onMouseDown:t=>{const{onMouseDown:n}=e;return n?.(t)},onMouseUp:t=>{const{onMouseUp:n}=e;return n?.(t)},onMouseEnter:t,onMouseLeave:n,onMouseOver:t=>{const{onMouseOver:n}=e;return n?.(t)},onMouseOut:t=>{const{onMouseOut:n}=e;return n?.(t)},onFocus:t,onBlur:n,onClick:t=>{const{onClick:n}=e;return n?.(t)},children:r?(0,h.jsx)(h.Fragment,{children:f.map(t=>{const n=d.get(t.data.featureId);return(0,h.jsxs)(c.Fragment,{children:[(0,h.jsx)(hr,{...e,config:l,layoutRecord:t,feature:n},`stick-${n.id()}`),(0,h.jsx)(pr,{...e,layoutRecord:t,feature:n,selectedFeatureId:p},`body-${n.id()}`)]},n.id())})}):null})}),fr=(0,d.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0});class yr extends a.A{name="LollipopPlugin";install(e){!function(e){e.addRendererType(()=>new cr({name:"LollipopRenderer",ReactComponent:mr,configSchema:fr,pluginManager:e}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,d.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:C.Ki,explicitlyTyped:!0})}(e);return new x.DisplayType({name:"LinearLollipopDisplay",configSchema:t,stateModel:tr(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:C.GQ})})}(e)}}var br=n(15897),wr=n(77538);const vr=(0,d.ConfigurationSchema)("AboutWidget",{}),Sr=v.types.model("AboutWidget",{id:fe.ElementId,type:v.types.literal("AboutWidget")}),xr=(0,d.ConfigurationSchema)("HelpWidget",{}),Cr=v.types.model("HelpWidget",{id:fe.ElementId,type:v.types.literal("HelpWidget")}),kr=(0,d.ConfigurationSchema)("ImportSessionWidget",{}),Tr=v.types.model("ImportSessionWidget",{id:fe.ElementId,type:v.types.literal("ImportSessionWidget")}),Ar=(0,d.ConfigurationSchema)("SessionManager",{}),Mr=v.types.model("SessionManager",{id:fe.ElementId,type:v.types.literal("SessionManager")});class Pr extends a.A{name="MenusPlugin";install(e){!function(e){e.addWidgetType(()=>new x.WidgetType({name:"AboutWidget",heading:"About",configSchema:vr,stateModel:Sr,ReactComponent:(0,c.lazy)(()=>n.e(9032).then(n.bind(n,99032)))}))}(e),function(e){e.addWidgetType(()=>new x.WidgetType({name:"HelpWidget",heading:"Help",configSchema:xr,stateModel:Cr,ReactComponent:(0,c.lazy)(()=>n.e(4974).then(n.bind(n,74974)))}))}(e),function(e){e.addWidgetType(()=>new x.WidgetType({name:"ImportSessionWidget",heading:"Import session",configSchema:kr,stateModel:Tr,ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(7605),n.e(7389)]).then(n.bind(n,67389)))}))}(e),function(e){e.addWidgetType(()=>new x.WidgetType({name:"SessionManager",heading:"Recent sessions",configSchema:Ar,stateModel:Mr,ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6342),n.e(5183)]).then(n.bind(n,83662)))}))}(e)}configure(e){(0,u.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:wr.A,onClick:e=>{const t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:br.A,onClick:e=>{const t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}}const Rr=(0,d.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0});class Ir extends a.A{name="RdfPlugin";install(e){!function(e){e.addAdapterType(()=>new x.AdapterType({name:"SPARQLAdapter",displayName:"SPARQL adapter",configSchema:Rr,adapterMetadata:{category:"Uncommon"},getAdapterClass:()=>n.e(5813).then(n.bind(n,75813)).then(e=>e.default)}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="SPARQLAdapter",o=(0,ge.getFileName)(t);return/\/sparql$/i.test(o)||r===a?{type:a,endpoint:t}:e(t,n,r)})}}const Lr=(0,d.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri},faiLocation:{uri:`${e.uri}.fai`,baseUri:e.baseUri},gziLocation:{uri:`${e.uri}.gzi`,baseUri:e.baseUri}}:e}),Fr=(0,d.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,chromSizesLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var Nr=n(51414);function Dr(e){const t=(0,l.c)(29),{bpPerPx:n,region:r,feature:a,sequenceType:o,height:i,seq:s,y:d}=e,p=(0,Nr.A)(),g=1/n>=12;let m,f,y;t[0]!==n||t[1]!==a||t[2]!==r?(f=a.get("start"),m=a.get("end"),y=(0,u.bpSpanPx)(f,m,r,n),t[0]=n,t[1]=a,t[2]=r,t[3]=m,t[4]=f,t[5]=y):(m=t[3],f=t[4],y=t[5]);const[b,w]=y,v=r.reversed,S=m-f,x=Math.max((w-b)/S,.8);let C,k;if(t[6]!==i||t[7]!==b||t[8]!==g||t[9]!==v||t[10]!==w||t[11]!==s||t[12]!==o||t[13]!==p||t[14]!==x||t[15]!==d){let e;t[17]!==i||t[18]!==b||t[19]!==g||t[20]!==v||t[21]!==w||t[22]!==o||t[23]!==p||t[24]!==x||t[25]!==d?(e=(e,t)=>{const n="dna"===o?p.palette.bases[e.toUpperCase()]:void 0,r=v?w-(t+1)*x:b+t*x;return(0,h.jsxs)(c.Fragment,{children:[(0,h.jsx)("rect",{x:r,y:d,width:x,height:i,fill:n?n.main:"#aaa",stroke:g?"#555":"none"}),g?(0,h.jsx)("text",{x:r+x/2,y:d+i/2,dominantBaseline:"middle",textAnchor:"middle",fontSize:i-2,fill:n?p.palette.getContrastText(n.main):"black",children:e}):null]},`${e}-${t}`)},t[17]=i,t[18]=b,t[19]=g,t[20]=v,t[21]=w,t[22]=o,t[23]=p,t[24]=x,t[25]=d,t[26]=e):e=t[26],C=s.split("").map(e),t[6]=i,t[7]=b,t[8]=g,t[9]=v,t[10]=w,t[11]=s,t[12]=o,t[13]=p,t[14]=x,t[15]=d,t[16]=C}else C=t[16];return t[27]!==C?(k=(0,h.jsx)(h.Fragment,{children:C}),t[27]=C,t[28]=k):k=t[28],k}function Br(e){const t=(0,l.c)(25),{codonTable:n,seq:r,frame:a,width:o,bpPerPx:i,colorByCDS:s,region:d,seqStart:p,height:g,y:m,reverse:f}=e,y=void 0!==f&&f,b=(0,Nr.A)(),w=(Math.abs(a)-1-p%3+3)%3,v=r.length-w,S=v-v%3;let x;if(t[0]!==i||t[1]!==n||t[2]!==s||t[3]!==a||t[4]!==w||t[5]!==g||t[6]!==S||t[7]!==d||t[8]!==y||t[9]!==r||t[10]!==p||t[11]!==b||t[12]!==o||t[13]!==m){const e=r.slice(w,w+S),l=[];for(let t=0;t<e.length;t+=3,t){const r=e.slice(t,t+3),a=y?(0,u.revcom)(r):r,o=n[a]||"";l.push({letter:o,codon:a.toUpperCase()})}const f=1/i*3,v=1/i>=12,C=w/i-(d.start-p)/i;let k;t[15]!==s||t[16]!==a||t[17]!==b.palette.frames||t[18]!==b.palette.framesCDS?(k=s?b.palette.framesCDS.at(a)?.main:b.palette.frames.at(a)?.main,t[15]=s,t[16]=a,t[17]=b.palette.frames,t[18]=b.palette.framesCDS,t[19]=k):k=t[19];const T=k;let A;t[20]!==T||t[21]!==g||t[22]!==o||t[23]!==m?(A=(0,h.jsx)("rect",{x:0,y:m,width:o,height:g,fill:T}),t[20]=T,t[21]=g,t[22]=o,t[23]=m,t[24]=A):A=t[24],x=(0,h.jsxs)(h.Fragment,{children:[A,l.map((e,t)=>{const n=d.reversed?o-(t+1)*f-C:f*t+C,{letter:r,codon:a}=e,i=u.defaultStarts.includes(a)?b.palette.startCodon:u.defaultStops.includes(a)?b.palette.stopCodon:void 0;return v||i?(0,h.jsxs)(c.Fragment,{children:[(0,h.jsx)("rect",{x:n,y:m,width:v?f:f+.7,height:g,stroke:v?"#555":"none",fill:i||"none"}),v?(0,h.jsx)("text",{x:n+f/2,fontSize:g-2,y:m+g/2,dominantBaseline:"middle",textAnchor:"middle",children:r}):null]},`${t}-${r}`):null})]}),t[0]=i,t[1]=n,t[2]=s,t[3]=a,t[4]=w,t[5]=g,t[6]=S,t[7]=d,t[8]=y,t[9]=r,t[10]=p,t[11]=b,t[12]=o,t[13]=m,t[14]=x}else x=t[14];return x}function jr({regions:e,width:t,colorByCDS:n,features:r=new Map,showReverse:a=!0,showForward:o=!0,showTranslation:i=!0,sequenceType:s="dna",bpPerPx:l,rowHeight:c}){const d=e[0],p=(0,u.generateCodonTable)(u.defaultCodonTable),[g]=[...r.values()];if(!g)return null;const m=g.get("seq");if(!m)return null;let f=-c;const y=l<=1,b=i&&o?[3,2,1]:[],w=i&&a?[-1,-2,-3]:[],[v,S]=d.reversed?[w.toReversed(),b.toReversed()]:[b,w];return(0,h.jsxs)(h.Fragment,{children:[v.map(e=>(0,h.jsx)(Br,{width:t,colorByCDS:n,seq:m,y:f+=c,codonTable:p,frame:e,bpPerPx:l,region:d,seqStart:g.get("start"),height:c,reverse:d.reversed},`translation-${e}`)),o&&y?(0,h.jsx)(Dr,{height:c,sequenceType:s,y:f+=c,feature:g,region:d,seq:d.reversed?(0,u.complement)(m):m,bpPerPx:l}):null,a&&y?(0,h.jsx)(Dr,{height:c,sequenceType:s,y:f+=c,feature:g,region:d,seq:d.reversed?m:(0,u.complement)(m),bpPerPx:l}):null,S.map(e=>(0,h.jsx)(Br,{width:t,colorByCDS:n,seq:m,y:f+=c,codonTable:p,frame:e,bpPerPx:l,region:d,seqStart:g.get("start"),height:c,reverse:!d.reversed},`rev-translation-${e}`))]})}function Vr(e){const t=(0,l.c)(5),{exportSVG:n,width:r,totalHeight:a,children:o}=e;let i;return t[0]!==o||t[1]!==n||t[2]!==a||t[3]!==r?(i=n?o:(0,h.jsx)("svg",{"data-testid":"sequence_track",width:r,height:a,style:{display:"block",width:r,height:a,userSelect:"none"},children:o}),t[0]=o,t[1]=n,t[2]=a,t[3]=r,t[4]=i):i=t[4],i}const Er=(0,p.observer)(function({exportSVG:e,features:t,regions:n,colorByCDS:r,bpPerPx:a,rowHeight:o,sequenceHeight:i,showForward:s,showReverse:l,showTranslation:c}){const d=n[0],u=Math.ceil((d.end-d.start)/a);return(0,h.jsx)(Vr,{exportSVG:e,totalHeight:i,width:u,children:(0,h.jsx)(jr,{width:u,showReverse:l,showForward:s,showTranslation:c,colorByCDS:r,bpPerPx:a,rowHeight:o,features:t,regions:n})})}),zr=(0,d.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0});class Or extends i.default{supportsSVG=!0;getExpandedRegion(e){return{...e,start:Math.max(e.start-3,0),end:e.end+3}}}const Hr=(0,d.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri},faiLocation:{uri:`${e.uri}.fai`,baseUri:e.baseUri}}:e}),Gr=(0,d.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:zr},{explicitIdentifier:"displayId",explicitlyTyped:!0});const $r=(0,d.ConfigurationSchema)("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0}),Wr=(0,d.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,twoBitLocation:{uri:e.uri,baseUri:e.baseUri},...e.chromSizes?{chromSizesLocation:{uri:e.chromSizes,baseUri:e.baseUri}}:{}}:e}),Ur=(0,d.ConfigurationSchema)("UnindexedFastaAdapter",{rewriteRefNames:{type:"string",defaultValue:"",contextVariable:["refName"]},fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class _r extends a.A{name="SequencePlugin";install(e){!function(e){e.addRendererType(()=>new Or({name:"DivSequenceRenderer",ReactComponent:Er,configSchema:zr,pluginManager:e}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"TwoBitAdapter",displayName:"TwoBit adapter",configSchema:Wr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(2930).then(n.bind(n,82930)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"BgzipFastaAdapter",displayName:"Bgzip-indexed FASTA adapter",configSchema:Lr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(9206).then(n.bind(n,79206)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"ChromSizesAdapter",displayName:"Chrom sizes adapter",configSchema:Fr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(7842).then(n.bind(n,57842)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"IndexedFastaAdapter",displayName:"Indexed FASTA adapter",configSchema:Hr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(9870).then(n.bind(n,69870)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"UnindexedFastaAdapter",displayName:"Unindexed FASTA adapter",configSchema:Ur,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(3578).then(n.bind(n,93578)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new se.A({name:"SequenceSearchAdapter",displayName:"Sequence search adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:$r,getAdapterClass:()=>n.e(946).then(n.bind(n,90946)).then(e=>e.default)}))}(e),function(e){e.addTrackType(()=>{const t=function(e){return(0,d.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:v.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:'optional track name, otherwise uses the "Reference sequence (assemblyName)"',defaultValue:""},sequenceType:{type:"string",description:"either dna or pep",defaultValue:"dna"},description:{description:"a description of the track",type:"string",defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},formatAbout:(0,d.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const n=JSON.parse(JSON.stringify(t)),r=new Set,{displays:a=[]}=n;if("placeholderId"!==n.trackId){for(const e of a)e&&r.add(e.type);const t=e.getTrackType(n.type);for(const e of t?.displayTypes||[])r.has(e.name)||a.push({displayId:`${n.trackId}-${e.name}`,type:e.name})}return{...n,displays:a}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:n}=t;if(!n)throw new Error(`unknown display type ${n}`);const r=e.displays.find(e=>e&&e.displayId===t.displayId);if(r)return r;const a=e.displays.push(t);return e.displays[a-1]}})})}(e);return new Bt.A({name:"ReferenceSequenceTrack",displayName:"Reference sequence track",configSchema:t,stateModel:(0,P.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})})}(e),function(e){e.addDisplayType(()=>{const e=function(e){return v.types.compose("LinearReferenceSequenceDisplay",C.Lr,v.types.model({type:v.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,d.ConfigurationReference)(e),showForward:!0,showReverse:!0,showTranslation:!0})).volatile(()=>({rowHeight:15})).views(e=>({get sequenceType(){return(0,d.getConf)((0,u.getContainingTrack)(e),"sequenceType")},get showForwardActual(){return e.showForward},get showReverseActual(){return"dna"===this.sequenceType&&e.showReverse},get showTranslationActual(){return"dna"===this.sequenceType&&e.showTranslation}})).views(e=>({get sequenceHeight(){const{rowHeight:t,showTranslationActual:n,showReverseActual:r,showForwardActual:a}=e;return(r&&n?3*t:0)+(a&&n?3*t:0)+(r?t:0)+(a?t:0)}})).views(e=>{const{renderProps:t}=e;return{renderProps(){const{rpcDriverName:n,showForwardActual:r,showReverseActual:a,showTranslationActual:o,rowHeight:i,sequenceHeight:s,sequenceType:l}=e;return{...t(),...(0,ge.getParentRenderProps)(e),config:e.configuration.renderer,rpcDriverName:n,showForward:r,showReverse:a,showTranslation:o,sequenceType:l,rowHeight:i,sequenceHeight:s}}}}).views(e=>({regionCannotBeRendered:()=>(0,u.getContainingView)(e).bpPerPx>3?"Zoom in to see sequence":void 0,get rendererTypeName(){return e.configuration.renderer.type}})).actions(e=>({toggleShowForward(){e.showForward=!e.showForward},toggleShowReverse(){e.showReverse=!e.showReverse},toggleShowTranslation(){e.showTranslation=!e.showTranslation},afterAttach(){(0,v.addDisposer)(e,(0,xe.autorun)(()=>{(0,u.getContainingView)(e).bpPerPx>3?e.setHeight(50):e.setHeight(e.sequenceHeight)}))}})).views(e=>({trackMenuItems:()=>[..."dna"===e.sequenceType?[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:()=>{e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:()=>{e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:()=>{e.toggleShowTranslation()}}]:[]]}))}(Gr);return new x.DisplayType({name:"LinearReferenceSequenceDisplay",configSchema:Gr,stateModel:e,displayName:"Reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:C.GQ})})}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="TwoBitAdapter",o=(0,ge.getFileName)(t),i={type:a,twoBitLocation:t};return/\.2bit$/i.test(o)&&!r||r===a?i:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t)),e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="IndexedFastaAdapter",o=(0,ge.getFileName)(t),i={type:a,fastaLocation:t,faiLocation:n||(0,ge.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(o)&&!r||r===a?i:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t)),e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a="BgzipFastaAdapter",o=(0,ge.getFileName)(t),i={type:a,faiLocation:(0,ge.makeIndex)(t,".fai"),gziLocation:(0,ge.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(o)&&!r||r===a?i:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t))}(e)}}var qr=n(34027);const Jr=["VCF","BED","BEDPE","STAR-Fusion"],Xr={VCF:()=>n.e(9314).then(n.bind(n,99314)).then(e=>e.parseVcfBuffer),BED:()=>n.e(6310).then(n.bind(n,6310)).then(e=>e.parseBedBuffer),BEDPE:()=>n.e(3025).then(n.bind(n,3025)).then(e=>e.parseBedPEBuffer),"STAR-Fusion":()=>n.e(759).then(n.bind(n,759)).then(e=>e.parseSTARFusionBuffer)};function Yr(e){return e.vcfLocation||e.vcfGzLocation?"VCF":e.bedLocation||e.bedGzLocation?"BED":e.bedpeLocation?"BEDPE":void 0}const Kr=new RegExp(String.raw`\.(${Jr.join("|")})(\.gz)?$`,"i");var Qr=n(65895);function Zr({assemblyName:e,session:t,locString:n,spreadsheetViewId:r}){const a=`${r}_${e}`;let o=t.views.find(e=>e.id===a);return o||(o=t.addView("LinearGenomeView",{id:a})),o.navToLocString(n,e)}var ea=n(61968);const ta=(0,c.lazy)(()=>n.e(3331).then(n.bind(n,3331))),na=(0,c.lazy)(()=>n.e(2130).then(n.bind(n,42130)));function ra(e){const t=(0,l.c)(22),{assemblyName:n,session:r,spreadsheetViewId:a,feature:o}=e;let i,s,c,d,p,g;return t[0]!==n||t[1]!==o||t[2]!==r||t[3]!==a?(i={label:"Open in linear genome view",onClick:async()=>{try{await Zr({spreadsheetViewId:a,assemblyName:n,session:r,locString:(0,u.assembleLocStringFast)(o)})}catch(e){const t=e;console.error(t),r.notifyError(`${t}`,t)}}},t[0]=n,t[1]=o,t[2]=r,t[3]=a,t[4]=i):i=t[4],t[5]!==n||t[6]!==o||t[7]!==r||t[8]!==a?(s={label:"Open in single-level split view",onClick:async()=>{const{pluginManager:e}=(0,v.getEnv)(r),t=e.getViewType("BreakpointSplitView");r.queueDialog(e=>[na,{handleClose:e,session:r,stableViewId:`${a}_${n}_breakpointsplitview_singlelevel`,feature:new u.SimpleFeature(o),viewType:t,assemblyName:n}])}},t[5]=n,t[6]=o,t[7]=r,t[8]=a,t[9]=s):s=t[9],t[10]!==n||t[11]!==o||t[12]!==r||t[13]!==a?(c={label:"Open in multi-level split view",onClick:async()=>{const{pluginManager:e}=(0,v.getEnv)(r),t=e.getViewType("BreakpointSplitView");r.queueDialog(e=>[ta,{handleClose:e,session:r,stableViewId:`${a}_${n}_breakpointsplitview_multilevel`,feature:new u.SimpleFeature(o),viewType:t,assemblyName:n}])}},t[10]=n,t[11]=o,t[12]=r,t[13]=a,t[14]=c):c=t[14],t[15]!==i||t[16]!==s||t[17]!==c?(d=[i,s,c],t[15]=i,t[16]=s,t[17]=c,t[18]=d):d=t[18],t[19]===Symbol.for("react.memo_cache_sentinel")?(p=(0,h.jsx)(ea.A,{}),t[19]=p):p=t[19],t[20]!==d?(g=(0,h.jsx)(qt.A,{menuItems:d,children:p}),t[20]=d,t[21]=g):g=t[21],g}function aa(e){const t=(0,l.c)(20),{model:n,feature:r}=e;let a,o,i,s,c,d,p;return t[0]!==n?(a=(0,u.getSession)(n),t[0]=n,t[1]=a):a=t[1],t[2]!==n?(o=(0,v.getParent)(n),t[2]=n,t[3]=o):o=t[3],t[4]!==r||t[5]!==n.assemblyName||t[6]!==a||t[7]!==o.id?(i=(0,h.jsx)(ra,{session:a,spreadsheetViewId:o.id,assemblyName:n.assemblyName,feature:r}),t[4]=r,t[5]=n.assemblyName,t[6]=a,t[7]=o.id,t[8]=i):i=t[8],t[9]!==r||t[10]!==n?(s=async e=>{try{e.preventDefault(),await Zr({spreadsheetViewId:(0,v.getParent)(n).id,session:(0,u.getSession)(n),locString:(0,u.assembleLocString)(r),assemblyName:n.assemblyName})}catch(e){const t=e;console.error(t),(0,u.getSession)(n).notifyError(`${t}`,t)}},t[9]=r,t[10]=n,t[11]=s):s=t[11],t[12]!==r?(c=(0,u.assembleLocString)(r),t[12]=r,t[13]=c):c=t[13],t[14]!==s||t[15]!==c?(d=(0,h.jsx)(Qr.A,{href:"#",onClick:s,children:c}),t[14]=s,t[15]=c,t[16]=d):d=t[16],t[17]!==i||t[18]!==d?(p=(0,h.jsxs)(h.Fragment,{children:[i,d]}),t[17]=i,t[18]=d,t[19]=p):p=t[19],p}function oa(){const e=v.types.model("SpreadsheetImportWizard",{fileType:v.types.optional(v.types.enumeration(Jr),"VCF"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:v.types.maybe(v.types.string),cachedFileLocation:v.types.frozen()}).volatile(()=>({fileTypes:Jr,fileSource:void 0,error:void 0,loading:!1})).views(e=>({get isReadyToOpen(){return e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName(t,n){const{assemblyManager:r}=(0,u.getSession)(e);return!!n&&r.isValidRefName(t,n)},tracksForAssembly(t){const n=(0,u.getSession)(e),{tracks:r=[],sessionTracks:a=[]}=n;return[...r,...a].map(e=>{const r=(0,d.readConfObject)(e,"assemblyNames"),a=(0,d.readConfObject)(e,"adapter"),o=(0,d.readConfObject)(e,"category").join(","),i=function(e){return e.vcfLocation||e.vcfGzLocation||e.bedLocation||e.bedGzLocation||e.bedpeLocation}(a);return r.includes(t)&&i?{track:e,label:[o?`[${o}]`:"",(0,ge.getTrackName)(e,n)].filter(e=>!!e).join(" "),assemblyNames:r,type:Yr(a)||"UNKNOWN",loc:i}:void 0}).filter(e=>!!e).sort((e,t)=>e.label.localeCompare(t.label))}})).actions(e=>({setSelectedAssemblyName(t){e.selectedAssemblyName=t},setFileSource(t){if(e.fileSource=t,e.error=void 0,e.fileSource){const t=e.fileName;if(t){const n=Kr.exec(t)?.[1];n&&(e.fileType="tsv"===n&&t.includes("star-fusion")?"STAR-Fusion":n.toUpperCase())}}},setColumnNameLineNumber(t){t>0&&(e.columnNameLineNumber=t)},setFileType(t){e.fileType=t},setError(t){e.error=t},setLoading(t){e.loading=t},cancelButton(){e.error=void 0,(0,v.getParent)(e).setDisplayMode()},setCachedFileHandle(t){e.cachedFileLocation=t}})).actions(e=>({async import(t){if(!e.fileSource)return;e.selectedAssemblyName=t;const r=e.fileType,a=await Xr[r](),{fetchAndMaybeUnzip:o}=await Promise.resolve().then(n.bind(n,99546)),{pluginManager:i}=(0,u.getEnv)(e),s=(0,K.openLocation)(e.fileSource,i);e.setLoading(!0);try{if((await s.stat()).size>1e8)return void e.setError(`File is too big. Tabular files are limited to at most ${1e5.toLocaleString()}kb.`)}catch(e){console.warn(e)}finally{e.setLoading(!1)}e.setLoading(!0);try{e.fileSource.uri&&e.setCachedFileHandle({uri:e.fileSource.uri,baseUri:e.fileSource.baseUri,locationType:"UriLocation"});const n=await o(s);(0,v.getParent)(e).displaySpreadsheet({...a(n),assemblyName:t})}catch(t){console.error(t),e.setError(t)}finally{e.setLoading(!1)}}})).actions(e=>({afterAttach(){(async()=>{try{e.cachedFileLocation&&e.selectedAssemblyName&&(e.setFileSource(e.cachedFileLocation),await e.import(e.selectedAssemblyName))}catch(t){console.error(t),(0,u.getSession)(e).notifyError(`${t}`,t)}})()}}));return v.types.compose(P.BaseViewModel,v.types.model("SpreadsheetView",{type:v.types.literal("SpreadsheetView"),offsetPx:0,height:v.types.optional(v.types.number,440),hideVerticalResizeHandle:!1,hideFilterControls:!1,importWizard:v.types.optional(e,()=>e.create()),spreadsheet:v.types.maybe(v.types.model("Spreadsheet",{rowSet:v.types.frozen(),columns:v.types.frozen(),assemblyName:v.types.maybe(v.types.string),visibleColumns:v.types.frozen()}).volatile(()=>({visibleRowFlags:void 0})).views(e=>({get rows(){return e.rowSet?.rows.map((t,n)=>({id:n,feature:t.feature,...Object.fromEntries(e.columns.map((e,n)=>[e.name,t.cellData?.[e.name]??t.cells?.[n]?.text]))}))},get initialized(){const t=(0,u.getSession)(e),n=e.assemblyName;return e.rowSet&&!!n&&t.assemblyManager.get(n)?.initialized}})).views(e=>({get dataGridColumns(){const{rows:t}=e;return t?[{field:"Location",width:(0,u.measureGridWidth)(t.map(e=>e.feature?(0,u.assembleLocStringFast)(e.feature):0))+40,renderCell:({row:t})=>{const{feature:n}=t;return n?(0,h.jsx)(aa,{model:e,feature:n}):"N/A"}},{field:"Length",type:"number",width:(0,u.measureGridWidth)(t.map(e=>{const{feature:t}=e;return t?t.end-t.start:0})),valueGetter:(e,t)=>{const{feature:n}=t;return n?n.end-n.start:void 0},valueFormatter:e=>(0,u.toLocale)(e)},...e.columns.map(e=>({field:e.name,width:(0,u.measureGridWidth)([...t.map(t=>t[e.name]),e.name],{minWidth:20}),type:"number"==typeof t[0][e.name]?"number":void 0}))]:void 0}})).views(e=>({get visibleRows(){const{visibleRowFlags:t}=e;return t?e.rows?.filter((e,n)=>!1!==t[n]):e.rows}})).actions(e=>({setVisibleRows(t){e.visibleRowFlags=t},setVisibleColumns(t){e.visibleColumns=t}})).preProcessSnapshot(e=>e?{...e,columns:e.columns.filter(e=>!e.isDerived),rowSet:e.rowSet?{...e.rowSet,rows:e.rowSet.rows.map(e=>({...e,feature:e.feature??e.extendedData?.vcfFeature}))}:void 0}:e))}).volatile(()=>({width:400,rowMenuItems:[]})).views(e=>({get assembly(){const t=e.spreadsheet?.assemblyName;return t?(0,u.getSession)(e).assemblyManager.get(t)?.configuration:void 0}})).actions(e=>({setRowMenuItems(t){e.rowMenuItems=t},setWidth:t=>(e.width=t,e.width),setHeight:t=>(e.height=Math.max(t,40),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},resizeWidth(t){const n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet(t){e.spreadsheet=(0,v.cast)(t)}})).views(e=>({menuItems:()=>[{label:"Return to import form",icon:Ze.A,onClick:()=>{e.displaySpreadsheet(void 0)}}]}))).postProcessSnapshot(e=>{const{importWizard:t,spreadsheet:n}=e;if(t.cachedFileLocation&&n){const{rowSet:t,...r}=n;return{...e,spreadsheet:r}}if(n){const{rowSet:t,...r}=n;return t&&JSON.stringify(t).length>1e6?{...e,spreadsheet:r}:e}return e})}class ia extends a.A{name="SpreadsheetViewPlugin";install(e){!function(e){e.addViewType(()=>new x.ViewType({name:"SpreadsheetView",displayName:"Spreadsheet view",stateModel:oa(),ReactComponent:(0,c.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(553)]).then(n.bind(n,76633)))}))}(e),function(e){e.addToExtensionPoint("LaunchView-SpreadsheetView",async({session:e,assembly:t,uri:n,fileType:r})=>{const a=e.addView("SpreadsheetView"),o=n.split(".");let i=o.pop()?.toUpperCase();"GZ"===i&&(i=o.pop()?.toUpperCase()),a.importWizard.setFileType(r||i||""),a.importWizard.setSelectedAssemblyName(t),a.importWizard.setFileSource({uri:n,locationType:"UriLocation"}),await a.importWizard.import(t)})}(e)}configure(e){const{rootModel:t}=e;(0,u.isAbstractMenuManager)(t)&&t.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:qr.A,onClick:e=>{e.addView("SpreadsheetView",{})}})}}var sa=n(92516),la=n(1182),ca=n(33935);function da(e,t){(async()=>{const n=(0,u.getSession)(t);try{n.setSelection(e);const r=(0,u.getContainingView)(t),a=`${(0,v.getParent)(r).id}_spawned`;await(0,ca.RI)({assemblyName:r.assemblyNames[0],session:n,stableViewId:a,feature:e})}catch(e){console.error(e),n.notifyError(`${e}`,e)}})()}class ua extends a.A{name="SvInspectorViewPlugin";install(e){!function(e){e.jexl.addFunction("defaultOnChordClick",da),e.addViewType(()=>{const t=function(e){const t=e.getViewType("SpreadsheetView"),n=e.getViewType("CircularView"),r=t.stateModel,a=n.stateModel;return v.types.compose("SvInspectorView",P.BaseViewModel,v.types.model({id:fe.ElementId,type:v.types.literal("SvInspectorView"),height:v.types.optional(v.types.number,550),onlyDisplayRelevantRegionsInCircularView:!1,spreadsheetView:v.types.optional(r,()=>r.create({type:"SpreadsheetView",hideVerticalResizeHandle:!0})),circularView:v.types.optional(a,()=>a.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0}))})).volatile(()=>({width:800,SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:n.ReactComponent,circularViewOptionsBarHeight:52})).views(e=>({get assemblyName(){const{assembly:t}=e.spreadsheetView;return t?(0,d.readConfObject)(t,"name"):void 0},get showCircularView(){return!!e.spreadsheetView.spreadsheet?.rowSet},get features(){return structuredClone(e.spreadsheetView.spreadsheet?.visibleRows)?.map(e=>e.feature).filter(e=>!!e)||[]},get featuresAdapterConfigSnapshot(){return{type:"FromConfigAdapter",features:this.features}},get featureRefNames(){return[...new Set([...this.features.map(e=>e.refName),...this.features.flatMap(e=>e.INFO?.CHR2),...this.features.flatMap(e=>e.mate?.refName)].filter(e=>!!e))]},get currentAssembly(){const{assemblyManager:t}=(0,u.getSession)(e);return this.assemblyName?t.get(this.assemblyName):void 0},get canonicalFeatureRefNameSet(){const e=this.currentAssembly;return new Set(e?.initialized?this.featureRefNames.map(t=>e.getCanonicalRefName(t)||t):[])},get featuresCircularTrackConfiguration(){return{type:"VariantTrack",trackId:`sv-inspector-variant-track-${e.id}`,name:"features from tabular data",adapter:this.featuresAdapterConfigSnapshot,assemblyNames:[this.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:`sv-inspector-variant-track-chord-display-${e.id}`,onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}})).actions(e=>({setWidth(t){e.width=t},setHeight:t=>(e.height=Math.max(t,400),e.height),setDisplayedRegions(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView(t){e.onlyDisplayRelevantRegionsInCircularView=t}})).views(e=>({menuItems:()=>[{label:"Return to import form",icon:Ze.A,onClick:()=>{e.spreadsheetView.displaySpreadsheet(void 0)}}]})).actions(e=>({resizeHeight(t){const n=e.height;return e.setHeight(e.height+t)-n},afterAttach(){(0,v.addDisposer)(e,(0,xe.autorun)(()=>{if(e.showCircularView){const t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)},{name:"SvInspectorView width binding"})),(0,v.addDisposer)(e,(0,xe.autorun)(()=>{e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)},{name:"SvInspectorView height binding"})),(0,v.addDisposer)(e,(0,xe.autorun)(async()=>{const{onlyDisplayRelevantRegionsInCircularView:t,circularView:n,canonicalFeatureRefNameSet:r,currentAssembly:a}=e;if(n.initialized&&a?.regions)if(t){if(1===n.tracks.length)try{n.setDisplayedRegions(structuredClone(a.regions.filter(e=>r.has(e.refName))))}catch(t){console.error(t),(0,u.getSession)(e).notifyError(`${t}`,t)}}else n.setDisplayedRegions(a.regions)},{name:"SvInspectorView displayed regions bind"})),(0,v.addDisposer)(e,(0,xe.reaction)(()=>({generatedTrackConf:e.featuresCircularTrackConfiguration,assemblyName:e.assemblyName}),t=>{if(!t)return;const{assemblyName:n,generatedTrackConf:r}=t,{circularView:a}=e;for(const e of a.tracks)a.hideTrack(e.configuration.trackId);n&&a.addTrackConf(r,{assemblyName:n})},{name:"SvInspectorView track configuration binding",fireImmediately:!0}))}})).postProcessSnapshot(e=>{const{circularView:t,...n}=e;return n})}(e);return new Ft.A({name:"SvInspectorView",displayName:"SV inspector",stateModel:t,ReactComponent:(0,c.lazy)(()=>n.e(1915).then(n.bind(n,51915)))})})}(e),function(e){e.addToExtensionPoint("LaunchView-SvInspectorView",async({session:e,assembly:t,uri:n,fileType:r})=>{const a=e.addView("SvInspectorView"),o=n.split(".");let i=o.pop()?.toUpperCase();"GZ"===i&&(i=o.pop()?.toUpperCase()),a.spreadsheetView.importWizard.setFileType(r||i||""),a.spreadsheetView.importWizard.setSelectedAssemblyName(t),a.spreadsheetView.importWizard.setFileSource({uri:n,locationType:"UriLocation"}),await a.spreadsheetView.importWizard.import(t)})}(e)}configure(e){(0,sa.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:la.A,onClick:e=>{e.addView("SvInspectorView",{})}})}}class pa extends x.BoxRendererType{supportsSVG=!0}const ha=(0,p.observer)(function({text:e,x:t,y:n,region:r,reversed:a,bpPerPx:o,exportSVG:i,feature:s,viewParams:l,color:d="black",fontHeight:p=11,featureWidth:g=0,allowedWidthExpansion:m=0,displayModel:f={}}){const y=g+m,b=(0,u.measureText)(e,p),w=(0,v.isStateTreeNode)(f)&&(0,v.isAlive)(f)&&!i?(0,u.getViewParams)(f):l,S=a?w.end:w.start,[x,C]=(0,c.useState)(i),k=(0,Nr.A)();if((0,c.useEffect)(()=>{C(!0)},[]),(0,v.isStateTreeNode)(r)&&!(0,v.isAlive)(r))return null;const T=r.start,A=r.end,M=s.get("start"),P=s.get("end"),R=b*o;return S<A&&S>T&&M<S&&S+R<P?t=w.offsetPx:M<S&&S+R<P&&S+R>T&&S+R<A&&(t=w.offsetPx1),x?(0,h.jsx)("text",{x:t,y:n+p,fill:"#f0f"===d?(0,u.stripAlpha)(k.palette.text.primary):d,fontSize:p,children:b>y?`${e.slice(0,y/(.6*p))}...`:e}):null}),ga=ha,ma=(0,p.observer)(function(e){const{config:t,name:n,description:r,shouldShowDescription:a,shouldShowName:o,feature:i,rootLayout:s}=e,l=s.getSubRecord(String(i.id()));if(l){const{GlyphComponent:c}=l.data||{};return(0,h.jsxs)("g",{children:[(0,h.jsx)(c,{featureLayout:l,...e}),o?(0,h.jsx)(ga,{text:n,x:s.getSubRecord("nameLabel")?.absolute.left||0,y:s.getSubRecord("nameLabel")?.absolute.top||0,color:(0,d.readConfObject)(t,["labels","nameColor"],{feature:i}),featureWidth:l.width,...e}):null,a?(0,h.jsx)(ga,{text:r,x:s.getSubRecord("descriptionLabel")?.absolute.left||0,y:s.getSubRecord("descriptionLabel")?.absolute.top||0,color:(0,d.readConfObject)(t,["labels","descriptionColor"],{feature:i}),featureWidth:l.width,...e}):null]})}return null});function fa(e){const t=(0,l.c)(16);let n,r,a,o;if(t[0]!==e?(({rect:r,region:o,bpPerPx:n,...a}=e),t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o):(n=t[1],r=t[2],a=t[3],o=t[4]),!r)return null;const[i,s,c,d]=r;let p;t[5]!==n||t[6]!==i||t[7]!==o||t[8]!==c?(p=(0,u.bpSpanPx)(i,c,o,n),t[5]=n,t[6]=i,t[7]=o,t[8]=c,t[9]=p):p=t[9];const[g,m]=p,f=Math.round(s),y=(o.end-o.start)/n,b=Math.round(d-s),w=m-g;if(g+w<0)return null;const v=Math.max(g,0),S=v-g,x=v-2,C=f-2,k=Math.max(1,Math.min(w-S,y))+4,T=b+4;let A;return t[10]!==a||t[11]!==x||t[12]!==C||t[13]!==k||t[14]!==T?(A=(0,h.jsx)("rect",{x,y:C,width:k,height:T,...a}),t[10]=a,t[11]=x,t[12]=C,t[13]=k,t[14]=T,t[15]=A):A=t[15],A}const ya=(0,p.observer)(function({displayModel:e={},blockKey:t,region:n,bpPerPx:r,movedDuringLastMouseDown:a,...o}){const{selectedFeatureId:i,featureIdUnderMouse:s,contextMenuFeature:l}=e,d=s||l?.id(),[u,p]=(0,c.useState)(!1);function g(e){const{onFeatureMouseOut:t}=o;t&&d&&t(e,d)}function m(e){const{onFeatureMouseOver:t}=o;t&&d&&t(e,d)}return(0,c.useEffect)(()=>{p(!0)},[]),u?(0,h.jsxs)(h.Fragment,{children:[d?(0,h.jsx)(fa,{rect:e.getFeatureByID?.(t,d),region:n,bpPerPx:r,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){const{onFeatureMouseDown:t}=o;t&&d&&t(e,d)},onMouseEnter:function(e){const{onFeatureMouseEnter:t}=o;t&&d&&t(e,d)},onMouseOut:g,onMouseOver:m,onMouseUp:function(e){const{onFeatureMouseUp:t}=o;t&&d&&t(e,d)},onMouseLeave:function(e){const{onFeatureMouseLeave:t}=o;t&&d&&t(e,d)},onMouseMove:function(e){const{onFeatureMouseMove:t}=o;t&&d&&t(e,d)},onClick:function(e){if(a)return;const{onFeatureClick:t}=o;t&&d&&(e.stopPropagation(),t(e,d))},onContextMenu:function(e){const{onFeatureContextMenu:t}=o;t&&d&&t(e,d)},onFocus:m,onBlur:g,"data-testid":d}):null,i?(0,h.jsx)(fa,{rect:e.getFeatureByID?.(t,i),region:n,bpPerPx:r,stroke:"#00b8ff",fill:"none"}):null]}):null}),ba=(0,p.observer)(function({feature:e,featureLayout:t,config:n,region:r}){const a=e.get("strand"),o=r.reversed?-1:1,i=7*a*o,{left:s=0,top:l=0,width:c=0,height:p=0}=t.absolute,g=(0,d.readConfObject)(n,"color2",{feature:e}),m=(0,Nr.A)(),f="#f0f"===g?(0,u.stripAlpha)(m.palette.text.secondary):g,y=a*o===-1?s:a*o===1?s+c:null,b=l+p/2;return y?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("line",{x1:y,x2:y+i,y1:b,y2:b,stroke:f}),(0,h.jsx)("polygon",{points:[[y+i/2,b-2.5],[y+i/2,b+2.5],[y+i,b]].toString(),stroke:f,fill:f})]}):null});function wa(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/i.test(e.get("type")||"")}function va({feature:e,config:t,colorByCDS:n,theme:r}){let a=wa(e)?(0,d.readConfObject)(t,"color3",{feature:e}):(0,d.readConfObject)(t,"color1",{feature:e});const o=e.get("type"),i=e.get("strand"),s=e.get("phase");if(n&&"CDS"===o&&void 0!==i&&void 0!==s){const t=e.get("start"),n=e.get("end"),o=(0,u.getFrame)(t,n,i,s),l=r.palette.framesCDS.at(o)?.main;l&&(a=l)}return a}const Sa=(0,p.observer)(function(e){const t=(0,Nr.A)(),{colorByCDS:n,feature:r,region:a,config:o,featureLayout:i,bpPerPx:s,topLevel:l}=e,{start:c,end:p}=a,g=Math.ceil((p-c)/s),m=r.get("start"),f=r.get("end"),y=r.get("type"),b=(f-m)/s,{left:w=0}=i.absolute;let{top:v=0,height:S=0}=i.absolute;if(w+b<0)return null;wa(r)&&(v+=.175*S,S*=.65);const x=Math.max(w,0),C=x-w,k=Math.max(2,Math.min(b-C,g)),T=va({feature:r,config:o,colorByCDS:n,theme:t}),A=(0,d.readConfObject)(o,"outline",{feature:r});return r.parent()&&"intron"===y?null:(0,h.jsxs)(h.Fragment,{children:[l?(0,h.jsx)(ba,{...e}):null,(0,h.jsx)("rect",{"data-testid":`box-${r.id()}`,x,y:v,width:k,height:S,...(0,u.getFillProps)(T),...(0,u.getStrokeProps)(A)})]})});var xa=n(62266),Ca=n(32296),ka=n(24499),Ta=n(31813),Aa=n(2138);const Ma=(0,p.observer)(function(e){const t=(0,Nr.A)(),{colorByCDS:n,feature:r,region:a,config:o,featureLayout:i,bpPerPx:s,topLevel:c,displayModel:p}=e,{start:g,end:m,reversed:f}=a,y=Math.ceil((m-g)/s),b=r.get("start"),w=f?-1:1,v=r.get("end"),S=r.get("strand"),x=(v-b)/s,{left:C=0,top:k=0,right:T=0,height:A=0}=i.absolute,M=C+x<0||C>y,P=!!(1/s>=10)&&!M&&n,R=Math.max(C,0),I=R-C,L=Math.max(2,Math.min(x-I,y)),F=r.parent()??r,N=function(e){const t=(0,l.c)(17),{feature:n,region:r,displayModel:a,upDownBp:o,forceLoad:i,shouldFetch:s}=e,c=void 0===o?0:o,d=void 0===i||i,p=void 0===s||s;let h;t[0]!==a?(h=a?(0,u.getSession)(a):void 0,t[0]=a,t[1]=h):h=t[1];const g=h,{assemblyName:m}=r;let f;t[2]!==m||t[3]!==n||t[4]!==d||t[5]!==g||t[6]!==p||t[7]!==c?(f={session:g,assemblyName:m,feature:n,upDownBp:c,forceLoad:d,shouldFetch:p},t[2]=m,t[3]=n,t[4]=d,t[5]=g,t[6]=p,t[7]=c,t[8]=f):f=t[8];const{sequence:y}=(0,Aa.p)(f);let b,w;t[9]!==n?(b=n.toJSON(),t[9]=n,t[10]=b):b=t[10],t[11]!==y||t[12]!==b?(w={feature:b,sequence:y},t[11]=y,t[12]=b,t[13]=w):w=t[13];const v=(0,ka.f)(w);let S;return t[14]!==v||t[15]!==p?(S=v&&p?(0,Ta.E)({cds:v.cds,sequence:v.seq,codonTable:(0,u.generateCodonTable)(u.defaultCodonTable)}):void 0,t[14]=v,t[15]=p,t[16]=S):S=t[16],S}({feature:F,region:a,displayModel:p,shouldFetch:P}),D=P?(0,Ca.W)(F.toJSON()).g2p:void 0,B=[];if(D&&N&&P){const e=function(e,t,n,r,a){const o=[],i=r-n;let s,l=null,c=0,d=0;for(let u=0;u<i;u++){const i=t[-1===a?r-u:n+u],p=e[i]??"&";void 0===s?(s=i,l=p,c=d):s!==i&&(o.push({aminoAcid:l,startIndex:c,endIndex:d-1,length:d-c,proteinIndex:s}),s=i,l=p,c=d),d++}return null!==l&&o.push({aminoAcid:l,startIndex:c,endIndex:d-1,length:d-c,proteinIndex:s}),o}(N,D,b,v,S),a=va({feature:r,config:o,colorByCDS:n,theme:t});for(let t=0,n=e.length;t<n;t++){const n=e[t],r=Math.floor((n.startIndex+n.endIndex)/2),o=n.length%3!=0||"&"===n.aminoAcid,i=o?"red":"black",l=t%2==1?(0,xa.e$)((0,Jt.M)(a).toHex(),.1):(0,xa.a)((0,Jt.M)(a).toHex(),.2);if(S*w===-1){const e=T-1/s*n.startIndex,r=T-1/s*(n.endIndex+1),a=(e+r)/2,c=e-r;B.push((0,h.jsx)("rect",{x:r,y:k,width:c,height:A,fill:l,stroke:"none"},`${t}-bg-${n.aminoAcid}-${n.startIndex}-${n.endIndex}`),(0,h.jsx)("text",{x:a,y:k+A-1,fontSize:A,fill:i,textAnchor:"middle",children:o||"*"===n.aminoAcid||"&"===n.aminoAcid?n.aminoAcid:`${n.aminoAcid}${n.proteinIndex+1}`},`${t}-${n.aminoAcid}-${n.startIndex}-${n.endIndex}`))}else{const e=C+1/s*r+1/s/2,a=C+1/s*n.startIndex,c=C+1/s*(n.endIndex+1)-a;B.push((0,h.jsx)("rect",{x:a,y:k,width:c,height:A,fill:l,stroke:"none"},`${t}-bg-${n.aminoAcid}-${n.startIndex}-${n.endIndex}`),(0,h.jsx)("text",{x:e,y:k+A-1,fontSize:A,fill:i,textAnchor:"middle",children:o||"*"===n.aminoAcid||"&"===n.aminoAcid?n.aminoAcid:`${n.aminoAcid}${n.proteinIndex+1}`},`${t}-${n.aminoAcid}-${n.startIndex}-${n.endIndex}`))}}}return M?null:(0,h.jsxs)(h.Fragment,{children:[c?(0,h.jsx)(ba,{...e}):null,(0,h.jsx)("rect",{"data-testid":`box-${r.id()}`,x:R,y:k,width:L,height:A,fill:va({feature:r,config:o,colorByCDS:n,theme:t}),stroke:(0,d.readConfObject)(o,"outline",{feature:r})}),B]})}),Pa=(0,p.observer)(function(e){const{feature:t,featureLayout:n,selected:r,config:a,subfeatures:o=t.get("subfeatures")}=e,i=(0,Nr.A)(),s=(0,d.readConfObject)(a,"color2",{feature:t}),l="#f0f"===s?(0,u.stripAlpha)(i.palette.text.secondary):s,{left:c=0,top:p=0,width:g=0,height:m=0}=n.absolute,f=p+m/2;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("line",{"data-testid":t.id(),x1:c,y1:f,y2:f,x2:c+g,stroke:l}),o?.map(t=>{const a=String(t.id()),o=n.getSubRecord(a);if(!o)return null;const{GlyphComponent:i}=o.data||{};return(0,h.jsx)(i,{...e,feature:t,topLevel:!1,featureLayout:o,selected:r},`glyph-${a}`)}),(0,h.jsx)(ba,{...e})]})});function Ra(e,t){let n=e.get("subfeatures");if(!n||0===n.length)return[];const r=n.some(e=>wa(e)),a=["mRNA","transcript"].includes(e.get("type"));return(!r&&a||(0,d.readConfObject)(t,"impliedUTRs"))&&(n=function(e,t){const n=[...t];let r,a,o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const s=[];for(const t of n){const n=t.get("type");/^cds/i.test(n)?(o>t.get("start")&&(o=t.get("start")),i<t.get("end")&&(i=t.get("end"))):/exon/i.test(n)?s.push(t):wa(t)&&(r=t.get("start")===e.get("start"),a=t.get("end")===e.get("end"))}if(!(s.length&&o<Number.POSITIVE_INFINITY&&i>Number.NEGATIVE_INFINITY))return n;s.sort((e,t)=>e.get("start")-t.get("start"));const l=e.get("strand");let c,d;if(!r)for(const[t,r]of s.entries()){if(c=r.get("start"),c>=o)break;d=Math.min(o,r.get("end"));const a=l>=0?"five_prime_UTR":"three_prime_UTR";n.unshift(new u.SimpleFeature({parent:e,id:`${e.id()}_${a}_${t}`,data:{start:c,end:d,strand:l,type:a}}))}if(!a)for(let t=s.length-1;t>=0&&(d=s[t].get("end"),!(d<=i));t--){c=Math.max(i,s[t].get("start"));const r=l>=0?"three_prime_UTR":"five_prime_UTR";n.push(new u.SimpleFeature({parent:e,id:`${e.id()}_${r}_${t}`,data:{start:c,end:d,strand:l,type:r}}))}return n}(e,n)),n.filter(e=>function(e,t){return function(e,t){const n=(0,d.readConfObject)(t,"subParts"),r="string"==typeof n?n.split(/\s*,\s*/):n;return e=>r.map(e=>e.toLowerCase()).includes(e.get("type").toLowerCase())}(0,t)(e)}(e,t))}const Ia=(0,p.observer)(function(e){const{feature:t,config:n}=e;return(0,h.jsx)(Pa,{...e,subfeatures:Ra(t,n)})});Ia.layOut=({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o})=>{const i=ja({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o});return Va({layout:i,subfeatures:Ra(t,a),bpPerPx:n,reversed:r,config:a,extraGlyphs:o}),i};const La=Ia,Fa=(0,p.observer)(function(e){const{feature:t,featureLayout:n,selected:r}=e;return t.get("subfeatures")?.map(t=>{const a=String(t.id()),o=n.getSubRecord(a);if(!o)return null;const{GlyphComponent:i}=o.data||{};return(0,h.jsx)(i,{...e,feature:t,featureLayout:o,selected:r},`glyph-${a}`)})});Fa.layOut=({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o})=>{const i=ja({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}),s=(0,d.readConfObject)(a,"displayMode");if("reducedRepresentation"!==s){let e=0;const l=t.get("subfeatures");if(l)for(const t of l){const l=Da({feature:t,extraGlyphs:o,config:a}),c=(0,d.readConfObject)(a,"height",{feature:t});(l.layOut||Ba)({layout:i,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}).move(0,e),e+="collapse"===s?0:("compact"===s?c/3:c)+2}}return i};const Na=Fa;function Da({feature:e,extraGlyphs:t,config:n}){const r=e.get("type"),a=e.get("subfeatures"),o=(0,d.readConfObject)(n,"transcriptTypes"),i=(0,d.readConfObject)(n,"containerTypes");if(a?.length&&"CDS"!==r){const t=a.some(e=>e.get("subfeatures")?.length),n=a.some(e=>"CDS"===e.get("type"));return o.includes(r)&&n?La:!e.parent()&&t||i.includes(r)?Na:Pa}return"CDS"===r?Ma:t?.find(t=>t.validator(e))?.glyph||Sa}function Ba({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o}){const i=(0,d.readConfObject)(a,"displayMode"),s=ja({layout:e,feature:t,bpPerPx:n,reversed:r,config:a,extraGlyphs:o});return"reducedRepresentation"!==i&&Va({layout:s,subfeatures:t.get("subfeatures")||[],bpPerPx:n,reversed:r,config:a,extraGlyphs:o}),s}function ja(e){const{layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}=e,s=(0,d.readConfObject)(o,"displayMode"),l="reducedRepresentation"===s?Sa:Da({feature:n,extraGlyphs:i,config:o}),c=n.parent();let u=0;c&&(u=(a?c.get("end")-n.get("end"):n.get("start")-c.get("start"))/r);const p=(0,d.readConfObject)(o,"height",{feature:n}),h=(n.get("end")-n.get("start"))/r,g=t.parent,m=g?g.top:0;return t.addChild(n.id(),u,"collapse"===s?0:m,Math.max(h,1),"compact"===s?p/2:p,{GlyphComponent:l})}function Va(e){const{layout:t,subfeatures:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}=e;for(const e of n)(Da({feature:e,extraGlyphs:i,config:o}).layOut||Ba)({layout:t,feature:e,bpPerPx:r,reversed:a,config:o,extraGlyphs:i})}function Ea(e){const t=(0,l.c)(36),{feature:n,detectRerender:r,bpPerPx:a,region:o,config:i,displayMode:s,layout:c,extraGlyphs:p}=e;r?.();const{reversed:g}=o;let m;if(t[0]!==a||t[1]!==i||t[2]!==s||t[3]!==p||t[4]!==n||t[5]!==c||t[6]!==e||t[7]!==o||t[8]!==g){m=Symbol.for("react.early_return_sentinel");e:{const r=n.get(g?"end":"start"),l=(0,u.bpToPx)(r,o,a),f="collapsed"!==s,y=new ar.SceneGraph("root",0,0,0,0),b=(Da({config:i,feature:n,extraGlyphs:p}).layOut||Ba)({layout:y,feature:n,bpPerPx:a,reversed:g,config:i,extraGlyphs:p});let w=!1,v=!1,S="",x="",C=0,k=0;if(f){let e;t[10]!==i?(e=(0,d.readConfObject)(i,"showLabels"),t[10]=i,t[11]=e):e=t[11];const r=e;let a;t[12]!==i?(a=(0,d.readConfObject)(i,"showDescriptions"),t[12]=i,t[13]=a):a=t[13];const o=a;let s,l;C=(0,d.readConfObject)(i,["labels","fontSize"],{feature:n}),k=(0,d.readConfObject)(i,"maxFeatureGlyphExpansion")||0,t[14]!==i||t[15]!==n?(s=(0,d.readConfObject)(i,["labels","name"],{feature:n})||"",t[14]=i,t[15]=n,t[16]=s):s=t[16],S=String(s),t[17]!==S||t[18]!==r?(l=/\S/.test(S)&&r,t[17]=S,t[18]=r,t[19]=l):l=t[19],w=l;const c=e=>{const t=y.width+k,n=(0,u.measureText)(e,C);return Math.round(Math.min(n,t))};let p,h;if(t[20]!==i||t[21]!==n?(p=(0,d.readConfObject)(i,["labels","description"],{feature:n})||"",t[20]=i,t[21]=n,t[22]=p):p=t[22],x=String(p),t[23]!==x||t[24]!==o?(h=/\S/.test(x)&&o,t[23]=x,t[24]=o,t[25]=h):h=t[25],v=h,w&&y.addChild("nameLabel",0,b.bottom,c(S),C),v){const e=w?y.getSubRecord("nameLabel"):b;if(!e)throw new Error("failed to layout nameLabel");y.addChild("descriptionLabel",0,e.bottom,c(x),C)}}const T=c.addRect(n.id(),n.get("start"),n.get("start")+y.width*a+3*a,y.height+5,{label:n.get("name")||n.get("id"),description:n.get("description")||n.get("note"),refName:n.get("refName")});if(null!==T){y.move(l,T);const n=C,r=k;let a;t[26]!==x||t[27]!==S||t[28]!==e||t[29]!==o.reversed||t[30]!==y||t[31]!==v||t[32]!==w||t[33]!==n||t[34]!==r?(a=(0,h.jsx)(ma,{rootLayout:y,name:S,shouldShowName:w,description:x,shouldShowDescription:v,fontHeight:n,allowedWidthExpansion:r,reversed:o.reversed,topLevel:!0,...e}),t[26]=x,t[27]=S,t[28]=e,t[29]=o.reversed,t[30]=y,t[31]=v,t[32]=w,t[33]=n,t[34]=r,t[35]=a):a=t[35],m=a;break e}m=null}t[0]=a,t[1]=i,t[2]=s,t[3]=p,t[4]=n,t[5]=c,t[6]=e,t[7]=o,t[8]=g,t[9]=m}else m=t[9];if(m!==Symbol.for("react.early_return_sentinel"))return m}const za=(0,p.observer)(function(e){const{features:t=new Map,isFeatureDisplayed:n}=e;return(0,h.jsx)(h.Fragment,{children:[...t.values()].filter(e=>!n||n(e)).map(t=>(0,h.jsx)(Ea,{feature:t,...e},t.id()))})});function Oa(e){const t=(0,l.c)(44),{layout:n,blockKey:r,regions:a,bpPerPx:o,config:i,displayModel:s,onMouseOut:u,onMouseDown:p,onMouseLeave:g,onMouseEnter:m,onMouseOver:f,onMouseMove:y,onMouseUp:b,onClick:w,children:v}=e;let S;t[0]!==a?(S=void 0===a?[]:a,t[0]=a,t[1]=S):S=t[1];const x=S;let C;t[2]!==s?(C=void 0===s?{}:s,t[2]=s,t[3]=C):C=t[3];const k=C,T=x[0],A=(T.end-T.start)/o;let M;t[4]!==i?(M=(0,d.readConfObject)(i,"maxHeight"),t[4]=i,t[5]=M):M=t[5];const P=M,R=(0,c.useRef)(null),[I,L]=(0,c.useState)(!1),[F,N]=(0,c.useState)(P),[D,B]=(0,c.useState)(!1),[j,V]=(0,c.useState)();let E,z;t[6]!==n?(E=()=>{N(n.getTotalHeight())},z=[n],t[6]=n,t[7]=E,t[8]=z):(E=t[7],z=t[8]),(0,c.useEffect)(E,z);const O=F+100;let H,G,$,W,U,_,q;return t[9]===Symbol.for("react.memo_cache_sentinel")?(H={display:"block"},t[9]=H):H=t[9],t[10]!==p?(G=e=>(L(!0),B(!1),V({x:e.clientX,y:e.clientY}),p?.(e)),t[10]=p,t[11]=G):G=t[11],t[12]!==b?($=e=>(L(!1),V(void 0),b?.(e)),t[12]=b,t[13]=$):$=t[13],t[14]!==r||t[15]!==o||t[16]!==k||t[17]!==j||t[18]!==I||t[19]!==y||t[20]!==T.reversed||t[21]!==T.start||t[22]!==A?(W=e=>{if(!R.current)return;if(I&&j){const t=e.clientX-j.x,n=e.clientY-j.y;(Math.abs(t)>8||Math.abs(n)>8)&&B(!0)}const{left:t,top:n}=R.current.getBoundingClientRect(),a=e.clientX-t,i=e.clientY-n,s=T.reversed?A-a:a,l=T.start+o*s,c=k.getFeatureOverlapping?.(r,l,i);y&&y(e,c)},t[14]=r,t[15]=o,t[16]=k,t[17]=j,t[18]=I,t[19]=y,t[20]=T.reversed,t[21]=T.start,t[22]=A,t[23]=W):W=t[23],t[24]!==D||t[25]!==w?(U=e=>{D||w?.(e)},t[24]=D,t[25]=w,t[26]=U):U=t[26],t[27]!==D||t[28]!==e||t[29]!==T?(_=(0,h.jsx)(ya,{...e,region:T,movedDuringLastMouseDown:D}),t[27]=D,t[28]=e,t[29]=T,t[30]=_):_=t[30],t[31]!==v||t[32]!==m||t[33]!==g||t[34]!==u||t[35]!==f||t[36]!==$||t[37]!==W||t[38]!==U||t[39]!==_||t[40]!==O||t[41]!==G||t[42]!==A?(q=(0,h.jsxs)("svg",{ref:R,"data-testid":"svgfeatures",width:A,height:O,style:H,onMouseDown:G,onMouseUp:$,onMouseEnter:m,onMouseLeave:g,onMouseOver:f,onMouseOut:u,onMouseMove:W,onClick:U,children:[v,_]}),t[31]=v,t[32]=m,t[33]=g,t[34]=u,t[35]=f,t[36]=$,t[37]=W,t[38]=U,t[39]=_,t[40]=O,t[41]=G,t[42]=A,t[43]=q):q=t[43],q}const Ha=(0,p.observer)(function(e){const{regions:t=[],config:n,exportSVG:r,featureDisplayHandler:a}=e,o=t[0],i=(0,d.readConfObject)(n,"displayMode");return r?(0,h.jsx)(za,{displayMode:i,isFeatureDisplayed:a,region:o,...e}):(0,h.jsx)(Oa,{...e,children:(0,h.jsx)(za,{displayMode:i,region:o,isFeatureDisplayed:a,...e})})}),Ga=(0,d.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"#f0f",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:(0,d.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"#f0f",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:12,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:v.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:1200},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1},transcriptTypes:{type:"stringArray",defaultValue:["mRNA","transcript","primary_transcript"]},containerTypes:{type:"stringArray",defaultValue:["proteoform_orf"]}},{explicitlyTyped:!0});class $a extends a.A{name="SVGPlugin";install(e){!function(e){e.addRendererType(()=>new pa({name:"SvgFeatureRenderer",ReactComponent:Ha,configSchema:Ga,pluginManager:e}))}(e)}}const Wa=(0,d.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"}},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"}},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"}},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId",preProcessSnapshot:e=>e.uri?{...e,ixFilePath:{uri:e.uri,baseUri:e.baseUri},ixxFilePath:{uri:`${e.uri}x`,baseUri:e.baseUri}}:e});class Ua extends a.A{name="TrixPlugin";install(e){e.addTextSearchAdapterType(()=>new Mn.A({name:"TrixTextSearchAdapter",displayName:"Trix text search adapter",configSchema:Wa,description:"Trix text search adapter",getAdapterClass:()=>n.e(4181).then(n.bind(n,24181)).then(e=>e.default)}))}}var _a=n(49854);const qa=[$a,C.Ay,r.Ay,ie,me,Re.Ay,We.A,Ue.A,Dt,cn,Gt,Cn,In,er,yr,Pr,Ir,_r,_a.A,jt.Ay,zt,ia,ua,Pe,vn,Ua,sn,$e,A]},23550:(e,t,n)=>{n.r(t),n.d(t,{getDefaultValue:()=>s,getEnumerationValues:()=>l,getPropertyType:()=>i,getSubType:()=>a,getUnionSubTypes:()=>o,resolveLateType:()=>c});var r=n(36422);function a(e){let t;if((0,r.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,r.isArrayType)(e)&&!(0,r.isMapType)(e)){if("function"==typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function o(e){if(!(0,r.isUnionType)(e))throw new TypeError("not an MST union type");const t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function i(e,t){return e.properties[t]}function s(e){if(!(0,r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function l(e){return o(e).map(e=>e.value)}function c(e){return(0,r.isUnionType)(e)||(0,r.isArrayType)(e)||!(0,r.isLateType)(e)?e:e.getSubType()}},24499:(e,t,n)=>{n.d(t,{f:()=>o});var r=n(99546),a=n(373);function o({feature:e,sequence:t}){const n=function(e){const{start:t,subfeatures:n}=e;return n?.sort((e,t)=>e.start-t.start).map(e=>({...e,start:e.start-t,end:e.end-t}))||[]}(e),{cds:o,exons:i,utr:s}=function(e,t){const n=(0,a.SC)(e.filter(e=>"cds"===e.type?.toLowerCase())),r=(0,a.SC)(e.filter(e=>"exon"===e.type));let o=(0,a.SC)(e.filter(e=>e.type?.match(/utr/i)));return!o.length&&n.length&&r.length?o=(0,a.h8)(n,r):o.length||!n.length||r.length||(o=(0,a.V4)(n,{start:0,end:t.end-t.start,type:"gene"})),{cds:n,exons:r,utr:o}}(n,e);if(t&&!("error"in t)){const{sequence:n,cds:l,exons:c,utr:d}=-1===e.strand?function(e,t,n,o){const{seq:i="",upstream:s="",downstream:l=""}=e;return{sequence:{seq:(0,r.revcom)(i),upstream:l?(0,r.revcom)(l):"",downstream:s?(0,r.revcom)(s):""},cds:(0,a.YC)(t,i.length),exons:(0,a.YC)(n,i.length),utr:(0,a.YC)(o,i.length)}}(t,o,i,s):{sequence:t,cds:o,exons:i,utr:s},{seq:u,upstream:p,downstream:h}=n;return{seq:u,upstream:p,downstream:h,cds:l,exons:c,utr:d}}}},25889:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(68446),a=n(69500);const o=(0,r.observer)(function({html:e,RenderingComponent:t,...n}){return(0,a.jsx)(t,{...n})})},26257:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(99546);function a(e,t="",n=5e3){const a=[e];for(;a.length;){const e=a.pop();for(const[o,i]of Object.entries(e)){if(t.length>n)return(0,r.hashCode)(t);"object"==typeof i&&null!==i?a.push(i):t+=`${o}-${i}`}}return`adp-${(0,r.hashCode)(t)}`}},26612:(e,t,n)=>{n.d(t,{m:()=>a});var r=n(99546);function a(e,t,n){return(0,r.sum)(e.map(e=>e.displays[0].height+(["none","left"].includes(n)?0:t)))}},27703:(e,t,n)=>{n.d(t,{CU:()=>s,Cz:()=>i,H2:()=>o,H4:()=>l,i3:()=>a});var r=n(99546);function a(e,t,n){const r=t*(e=Math.abs(e));let a=10**+r.toExponential().split(/e/i)[1];for(;a<r&&(a*=2,!(a>=r));)a*=2.5;a=Math.max(a,5);const o=a/e;let i=0;return!(a%10)&&o/10>=n?i=a/10:!(a%5)&&o/5>=n?i=a/5:!(a%2)&&o/2>=n&&(i=a/2),{majorPitch:a,minorPitch:i}}function o(e,t,n,r=!0,o=!0){const i=a(n,60,15);let s=e,l=t;n<0&&([s,l]=[l,s]),s-=Math.abs(20*n)-1,l+=Math.abs(20*n)+1;const c=i.minorPitch||i.majorPitch;let d=0;const u=[];for(let e=Math.floor(s/c)*c;e<Math.ceil(l/c)*c+1;e+=c)o&&e%(2*i.majorPitch)?(u.push({type:"minor",base:e-1,index:d}),d+=1):!r||e%(2*i.majorPitch)||(u.push({type:"major",base:e-1,index:d}),d+=1);return u}async function i({regions:e,assemblyManager:t,assemblyName:n,grow:r}){return Promise.all(e.map(async e=>{const a=e.assemblyName||n;if(!a)throw new Error("no assembly provided");const o=await t.waitForAssembly(a),{refName:i}=e;if(!o)throw new Error(`assembly ${a} not found`);const{regions:s}=o;if(!s)throw new Error(`regions not loaded yet for ${a}`);const l=o.getCanonicalRefName(e.refName);if(!l)throw new Error(`Could not find refName ${i} in ${o.name}`);const c=s.find(e=>e.refName===l);if(!c)throw new Error(`Could not find refName ${i} in ${a}`);const{start:d,end:u}=e;if(r&&d&&u){const t=(u-d)*r;return{...e,start:Math.max(0,d-t),end:u+t,assemblyName:a,parentRegion:c}}return{...e,assemblyName:a,parentRegion:c}}))}function s(e,t,n){const a=e.split(/(\s+)/).map(e=>e.trim()).filter(e=>!!e);try{return a.map(e=>(0,r.parseLocString)(e,e=>n(e,t)))}catch(e){const[o,i,s]=a;if(/Unknown reference sequence/.exec(`${e}`)&&Number.isInteger(+i)&&Number.isInteger(+s))return[(0,r.parseLocString)(`${o}:${i}..${s}`,e=>n(e,t))];throw e}}function l(e){if(e.length){const t=e.every(t=>t.assemblyName===e[0].assemblyName);return e.map(e=>(0,r.assembleLocString)({...e,start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName})).join(" ")}return""}},31415:(e,t,n)=>{n.d(t,{h:()=>l});var r=n(41365),a=n.n(r),o=n(68584),i=n(85012),s=n(2265);class l{constructor(e){this.props=e}update(e){return this.props=e,this}makeLayout(){return new s.A(i.A,{maxHeight:(0,o.readConfObject)(this.props.config,"maxHeight"),displayMode:(0,o.readConfObject)(this.props.config,"displayMode"),pitchX:this.props.bpPerPx,pitchY:(0,o.readConfObject)(this.props.config,"noSpacing")?1:3})}cachedLayoutIsValid(e){return e.props.bpPerPx===this.props.bpPerPx&&a()((0,o.readConfObject)(this.props.config),(0,o.readConfObject)(e.props.config))&&a()(this.props.filters,e.props.filters)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),props:this.props}),this.cachedLayout.layout}}},31673:(e,t,n)=>{function r(e){const t=new FileReader;return new Promise((n,r)=>{t.onload=e=>{e.target?n(e.target.result):r(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)})}n.d(t,{y:()=>r})},31813:(e,t,n)=>{n.d(t,{E:()=>a});var r=n(373);function a({cds:e,sequence:t,codonTable:n}){const a=(0,r.o9)(e,t);let o="";for(let e=0;e<a.length;e+=3)o+=n[a.slice(e,e+3)]||"&";return o}},32474:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(99546),a=n(62266),o=n(51414),i=n(68446),s=n(76239),l=n(69500);const c=(0,i.observer)(function({model:e,overview:t,useOffset:n=!0}){const i=(0,o.A)(),c=Number(n),{interRegionPaddingWidth:d,offsetPx:u,dynamicBlocks:p,cytobandOffset:h}=e,{contentBlocks:g,totalWidthPxWithoutBorders:m}=p,f=i.palette.tertiary.light;if(!g.length)return null;const y=g.at(0),b=g.at(-1),w=(t.bpToPx({...y,coord:y.reversed?y.end:y.start})||0)+h*c,v=(t.bpToPx({...b,coord:b.reversed?b.start:b.end})||0)+h*c,S=Math.max(0,-u),x=S+m+g.length*d/2,C=[[S,s.Ij],[x,s.Ij],[v,0],[w,0]];return(0,l.jsx)("polygon",{points:C.toString(),...(0,r.getFillProps)((0,a.X4)(f,.3)),...(0,r.getStrokeProps)((0,a.X4)(f,.8))})})},32595:(e,t,n)=>{function r(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}function a(e,t,n,r){return t>n&&e<r}function o(e,t,n,r){return n<=e&&r>=t}n.d(t,{R6:()=>a,Xx:()=>o,ky:()=>r})},32761:(e,t,n)=>{n.d(t,{Ak:()=>r});const r=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"")},32767:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel}}},33935:(e,t,n)=>{n.d(t,{L$:()=>C,qe:()=>T,RI:()=>x});var r=n(7552),a=n(67112),o=n(76218),i=n(30698),s=n(69092),l=n(68446),c=n(36422),d=n(67758),u=n(22762),p=n(7946),h=n(75785),g=n(69500);const m=(0,h.n9)()({block:{display:"block"}});function f(e){const t=(0,d.c)(8),{checked:n,disabled:r,label:a,onChange:o}=e,{classes:i}=m();let s,l;return t[0]!==n||t[1]!==o?(s=(0,g.jsx)(u.A,{checked:n,onChange:o}),t[0]=n,t[1]=o,t[2]=s):s=t[2],t[3]!==i.block||t[4]!==r||t[5]!==a||t[6]!==s?(l=(0,g.jsx)(p.A,{disabled:r,className:i.block,control:s,label:a}),t[3]=i.block,t[4]=r,t[5]=a,t[6]=s,t[7]=l):l=t[7],l}var y=n(99546),b=n(350);function w({feature:e,assembly:t}){const n=e.get("ALT")?.[0],r=n?(0,b.h)(n):void 0,a=e.get("start"),o=e.get("refName"),i=e=>t.getCanonicalRefName(e)||e;if("<TRA>"===n){const t=e.get("INFO");return{pos:a,refName:i(o),mateRefName:i(t.CHR2[0]),matePos:t.END[0]-1}}if(r?.MatePosition){const e=r.MatePosition.split(":");return{pos:a,refName:i(o),mateRefName:i(e[0]),matePos:+e[1]-1}}if(e.get("mate")){const t=e.get("mate");return{pos:a,refName:i(o),mateRefName:i(t.refName),matePos:t.start}}return{pos:a,refName:i(o),mateRefName:i(o),matePos:e.get("end")}}function v(e){return e.map(({id:e,displays:t,...n})=>({...n,displays:t.map(({id:e,...t})=>t)}))}function S(e){return`${e.get("name")||e.get("id")||"breakend"} split detail`}async function x({stableViewId:e,feature:t,assemblyName:n,session:r,mirror:a,tracks:o=[]}){const{assemblyManager:i}=r,s=await i.waitForAssembly(n);if(!s)throw new Error(`assembly ${n} not found`);const{refName:l,pos:c,mateRefName:d,matePos:u}=w({feature:t,assembly:s});let p=r.views.find(t=>t.id===e);p||(p=r.addView("BreakpointSplitView",{id:e,type:"BreakpointSplitView",displayName:S(t),views:[{type:"LinearGenomeView",hideHeader:!0,tracks:v(o)},{type:"LinearGenomeView",hideHeader:!0,tracks:v(a?[...o].reverse():o)}]})),p.setDisplayName(S(t));const h=s.regions.find(e=>e.refName===l),g=s.regions.find(e=>e.refName===d);if(!h||!g)throw new Error("can't find regions");await Promise.all([p.views[0].navToLocations([{refName:l,start:h.start,end:c,assemblyName:n},{refName:l,start:c+1,end:h.end,assemblyName:n}]),p.views[1].navToLocations([{refName:d,start:g.start,end:u,assemblyName:n},{refName:d,start:u+1,end:g.end,assemblyName:n}])]),await(0,y.when)(()=>p.views[1].initialized&&p.views[0].initialized),p.views[1].zoomTo(10),p.views[0].zoomTo(10),p.views[1].centerAt(u,d),p.views[0].centerAt(c,l)}const C=(0,l.observer)(function({session:e,handleClose:t,feature:n,assemblyName:l,stableViewId:d,view:u}){const[p,h]=(0,r.useState)(!0),[m,y]=(0,r.useState)(!0);return(0,g.jsxs)(a.Dialog,{open:!0,onClose:t,title:"Multi-level breakpoint split view options",children:[(0,g.jsxs)(o.A,{children:[(0,g.jsx)("div",{children:"Launch multi-level breakpoint split view"}),u?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(f,{checked:p,label:"Copy tracks into the new view",onChange:e=>{h(e.target.checked)}}),p?(0,g.jsx)(f,{checked:m,disabled:!p,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:e=>{y(e.target.checked)}}):null]}):null]}),(0,g.jsxs)(i.A,{children:[(0,g.jsx)(s.A,{onClick:()=>{(async()=>{try{await x({stableViewId:d,session:e,tracks:p&&u?(0,c.getSnapshot)(u.tracks):[],mirror:m,feature:n,assemblyName:l})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,g.jsx)(s.A,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})});var k=n(93062);const T=(0,l.observer)(function({session:e,handleClose:t,feature:n,stableViewId:l,assemblyName:d,view:u}){const[p,h]=(0,r.useState)(!0),[m,b]=(0,r.useState)(!0),[x,C]=(0,y.useLocalStorage)("breakpointWindowSize","5000");return(0,g.jsxs)(a.Dialog,{open:!0,onClose:t,title:"Single-level breakpoint split view options",children:[(0,g.jsxs)(o.A,{children:[u?(0,g.jsx)(f,{checked:p,label:"Copy tracks into the new view",onChange:e=>{h(e.target.checked)}}):null,(0,g.jsx)(f,{checked:p,label:"Focus on breakends",onChange:e=>{b(e.target.checked)}}),(0,g.jsx)(k.A,{label:"Window size (bp)",value:x,onChange:e=>{C(e.target.value)}})]}),(0,g.jsxs)(i.A,{children:[(0,g.jsx)(s.A,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e;if(!await t.waitForAssembly(d))throw new Error(`assembly ${d} not found`);await async function({stableViewId:e,feature:t,assemblyName:n,session:r,tracks:a,windowSize:o=0,focusOnBreakends:i}){const{snap:s,coverage:l}=i?function({feature:e,session:t,assemblyName:n,windowSize:r=0}){const{assemblyManager:a}=t,o=a.get(n);if(!o)throw new Error(`assembly ${n} not found`);if(!o.regions)throw new Error(`assembly ${n} regions not loaded`);const i=w({feature:e,assembly:o}),{refName:s,mateRefName:l}=i,c=o.regions.find(e=>e.refName===s),d=o.regions.find(e=>e.refName===l);return{coverage:i,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,y.gatherOverlaps)([{...c,end:i.pos+r,assemblyName:n},{...d,start:i.matePos-r,assemblyName:n}])}],displayName:S(e)}}}({feature:t,assemblyName:n,session:r,windowSize:o}):function({feature:e,session:t,assemblyName:n}){const{assemblyManager:r}=t,a=r.get(n);if(!a)throw new Error(`assembly ${n} not found`);if(!a.regions)throw new Error(`assembly ${n} regions not loaded`);const o=w({feature:e,assembly:a}),{refName:i,mateRefName:s}=o,l=a.regions.find(e=>e.refName===i),c=a.regions.find(e=>e.refName===s);return{coverage:o,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,y.gatherOverlaps)([{...l,assemblyName:n},{...c,assemblyName:n}])}],displayName:S(e)}}}({feature:t,assemblyName:n,session:r}),{refName:d,pos:u,mateRefName:p,matePos:h}=l;let g=r.views.find(t=>t.id===e);g?(g.views[0]?.setDisplayedRegions(s.views[0].displayedRegions),g.setDisplayName(s.displayName)):g=r.addView("BreakpointSplitView",{...s,views:[{...s.views[0],tracks:a?v((0,c.getSnapshot)(a)):[]}]});const m=g.views[0];await(0,y.when)(()=>m.initialized);const f=m.bpToPx({coord:Math.max(0,u-o),refName:d}),b=m.bpToPx({coord:h+o,refName:p});f&&b?m.moveTo({...f,offset:f.offsetPx},{...b,offset:b.offsetPx}):(0,y.getSession)(m).notify("Unable to navigate to breakpoint")}({feature:n,assemblyName:d,focusOnBreakends:m,session:e,stableViewId:l,tracks:u?.tracks,windowSize:+x||0})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,g.jsx)(s.A,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})})},35248:(e,t,n)=>{n.d(t,{A:()=>f});var r=n(67758),a=n(7552),o=n(69092),i=n(59130),s=n(76218),l=n(30698),c=n(48768),d=n(38033),u=n(92562),p=n(31378),h=n(69500);function g(e){const t=(0,r.c)(17),{onClose:n,open:a,onFactoryReset:i}=e;let c;t[0]!==n||t[1]!==i?(c=function(e){"reset"===e&&i(),n()},t[0]=n,t[1]=i,t[2]=c):c=t[2];const d=c;let g,m,f,y,b,w;return t[3]!==d?(g=()=>{d()},t[3]=d,t[4]=g):g=t[4],t[5]===Symbol.for("react.memo_cache_sentinel")?(m=(0,h.jsx)(s.A,{children:(0,h.jsx)(p.A,{children:"Are you sure you want to reset? This will restore the default configuration."})}),t[5]=m):m=t[5],t[6]!==d?(f=(0,h.jsx)(o.A,{onClick:()=>{d()},color:"primary",children:"Cancel"}),t[6]=d,t[7]=f):f=t[7],t[8]!==d?(y=(0,h.jsx)(o.A,{onClick:()=>{d("reset")},color:"primary",variant:"contained",children:"OK"}),t[8]=d,t[9]=y):y=t[9],t[10]!==f||t[11]!==y?(b=(0,h.jsxs)(l.A,{children:[f,y]}),t[10]=f,t[11]=y,t[12]=b):b=t[12],t[13]!==a||t[14]!==g||t[15]!==b?(w=(0,h.jsxs)(u.A,{title:"Reset",onClose:g,open:a,children:[m,b]}),t[13]=a,t[14]=g,t[15]=b,t[16]=w):w=t[16],w}const m=e=>{const t=(0,r.c)(10),{onFactoryReset:n,resetButtonText:i}=e,[s,l]=(0,a.useState)(!1);let c,d,u,p,m;return t[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{l(!0)},t[0]=c):c=t[0],t[1]!==i?(d=(0,h.jsx)(o.A,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:c,children:i}),t[1]=i,t[2]=d):d=t[2],t[3]===Symbol.for("react.memo_cache_sentinel")?(u=()=>{l(!1)},t[3]=u):u=t[3],t[4]!==s||t[5]!==n?(p=(0,h.jsx)(g,{onClose:u,open:s,onFactoryReset:n}),t[4]=s,t[5]=n,t[6]=p):p=t[6],t[7]!==d||t[8]!==p?(m=(0,h.jsxs)(h.Fragment,{children:[d,p]}),t[7]=d,t[8]=p,t[9]=m):m=t[9],m};function f(e){const t=(0,r.c)(15),{componentStack:n,error:a,onFactoryReset:u,resetButtonText:p}=e,g=void 0===a?"No error message provided":a,f=void 0===p?"Factory Reset":p;let b,w,v,S,x,C,k;return t[0]===Symbol.for("react.memo_cache_sentinel")?(b=(0,h.jsx)(i.A,{children:"Fatal error"}),t[0]=b):b=t[0],t[1]!==g?(w=(0,h.jsx)(d.A,{error:g}),t[1]=g,t[2]=w):w=t[2],t[3]!==n?(v=(0,h.jsx)("pre",{children:n}),t[3]=n,t[4]=v):v=t[4],t[5]!==w||t[6]!==v?(S=(0,h.jsxs)(s.A,{children:[w,v]}),t[5]=w,t[6]=v,t[7]=S):S=t[7],t[8]===Symbol.for("react.memo_cache_sentinel")?(x=(0,h.jsx)(o.A,{color:"secondary",variant:"contained",onClick:y,children:"Refresh"}),t[8]=x):x=t[8],t[9]!==u||t[10]!==f?(C=(0,h.jsxs)(l.A,{children:[x,(0,h.jsx)(m,{onFactoryReset:u,resetButtonText:f})]}),t[9]=u,t[10]=f,t[11]=C):C=t[11],t[12]!==S||t[13]!==C?(k=(0,h.jsxs)(c.A,{maxWidth:"xl",open:!0,children:[b,S,C]}),t[12]=S,t[13]=C,t[14]=k):k=t[14],k}function y(){window.location.reload()}},35254:(e,t,n)=>{n.d(t,{C$:()=>l,FI:()=>i,JC:()=>s,QZ:()=>o,Rg:()=>u,oG:()=>c,wo:()=>d});var r=n(36422),a=n(23550);function o(e,t,n={}){if(!t)return structuredClone((0,r.getSnapshot)(e));if("string"==typeof t){let a=e[t];if(!a&&(0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(a=e.get(t)),a){const e=a.expr?a.expr.evalSync(n):a;return(0,r.isStateTreeNode)(e)?JSON.parse(JSON.stringify((0,r.getSnapshot)(e))):e}return}if(Array.isArray(t)){const a=t[0];if(t.length>1){const i=t.slice(1);let s=e[a];return!s&&(0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(s=e.get(a)),s?o(s,i,n):void 0}return o(e,a,n)}throw new TypeError("slotPath must be a string or array")}function i(e,t,n){const{configuration:r}=e;if(d(r))return o(r,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if((0,r.isType)(e)&&(e=(0,a.resolveLateType)(e),(0,r.isUnionType)(e))){const t=[];for(let n of(0,a.getUnionSubTypes)(e)){n=(0,a.resolveLateType)(n);let e=s(n);if(e.length||(e=[(0,a.getDefaultValue)(n).type]),!e[0])throw new Error(`invalid config schema type ${n}`);t.push(...e)}return t}return[]}function l(e){if((0,r.isType)(e)){if((0,r.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,r.isLateType)(e))return!0}return!1}function c(e){return!!(0,r.isType)(e)&&(!!l(e)||((0,r.isUnionType)(e)?(0,a.getUnionSubTypes)(e).every(e=>c(e)||"undefined"===e.name):!(!(0,r.isOptionalType)(e)||!c((0,a.getSubType)(e)))||!(!(0,r.isArrayType)(e)||!c((0,a.getSubType)(e)))||!(!(0,r.isMapType)(e)||!c((0,a.getSubType)(e)))))}function d(e){return(0,r.isStateTreeNode)(e)&&c((0,r.getType)(e))}function u(e){return"object"==typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},35470:(e,t,n)=>{n.d(t,{A:()=>r});class r{constructor(e){this.name=e?.name||"UNKNOWN",this.maybeDisplayName=e?.displayName}get displayName(){return this.maybeDisplayName||this.name}}},37205:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(67758),a=n(37962),o=n(28194),i=n(75785),s=n(69500);const l=(0,i.n9)()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"}});function c(e){const t=(0,r.c)(12),{message:n,severity:i,action:c}=e,{classes:p}=l();let h,g,m,f;return t[0]!==p.ellipses?(h={message:p.ellipses},t[0]=p.ellipses,t[1]=h):h=t[1],t[2]!==n?(g=(0,s.jsx)("div",{children:n}),t[2]=n,t[3]=g):g=t[3],t[4]!==n||t[5]!==g?(m=(0,s.jsx)(a.A,{title:n,children:g}),t[4]=n,t[5]=g,t[6]=m):m=t[6],t[7]!==c||t[8]!==i||t[9]!==h||t[10]!==m?(f=(0,s.jsx)(o.A,{severity:i,action:c,classes:h,onMouseDown:u,onClick:d,children:m}),t[7]=c,t[8]=i,t[9]=h,t[10]=m,t[11]=f):f=t[11],f}function d(e){e.stopPropagation()}function u(e){e.stopPropagation()}},37347:(e,t,n)=>{function r(){return URL.createObjectURL?.(new Blob)||`${Math.random()}`}function a(e){URL.revokeObjectURL?.(e)}function o(e){if("undefined"==typeof jest&&void 0!==e&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){const t=new XMLHttpRequest;t.open("GET",e,!1);try{t.send(null)}catch(e){throw new Error("aborted")}}}n.d(t,{CF:()=>a,SW:()=>o,y5:()=>r})},37934:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var r=n(67758),a=n(7552),o=n(99546),i=n(62266),s=n(61282),l=n(75785),c=n(37962),d=n(69500);function u(e){const t=(0,r.c)(8),{anchorEl:n,side:a,text:o}=e,i="left"===a?"left-start":"right-start";let s,l,u,p;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s=[{name:"offset",options:{offset:[-30,-10]}}],t[0]=s):s=t[0],t[1]!==n?(l={popper:{anchorEl:n,modifiers:s}},t[1]=n,t[2]=l):l=t[2],t[3]===Symbol.for("react.memo_cache_sentinel")?(u=(0,d.jsx)("span",{}),t[3]=u):u=t[3],t[4]!==i||t[5]!==l||t[6]!==o?(p=(0,d.jsx)(c.A,{title:o,open:!0,placement:i,slotProps:l,children:u}),t[4]=i,t[5]=l,t[6]=o,t[7]=p):p=t[7],p}const p=(0,l.n9)()(e=>{const{tertiary:t}=e.palette;return{rubberband:{height:"100%",background:(0,i.X4)(t.light,.7),position:"absolute",zIndex:830,textAlign:"center",cursor:"crosshair"},rubberbandText:{color:e.palette.tertiary.contrastText}}});function h(e){const t=(0,r.c)(19),{leftBpOffset:n,rightBpOffset:i,numOfBpSelected:l,left:c,width:h,top:g,sticky:m}=e,f=void 0===g?0:g,y=void 0!==m&&m,{classes:b}=p(),[w,v]=(0,a.useState)(null);let S,x,C,k,T;return t[0]!==w||t[1]!==n||t[2]!==i?(S=w?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{side:"left",anchorEl:w,text:(0,o.stringify)(n)}),(0,d.jsx)(u,{side:"right",anchorEl:w,text:(0,o.stringify)(i)})]}):null,t[0]=w,t[1]=n,t[2]=i,t[3]=S):S=t[3],t[4]!==c||t[5]!==h?(x={left:c,width:h},t[4]=c,t[5]=h,t[6]=x):x=t[6],t[7]!==b.rubberbandText||t[8]!==l||t[9]!==y||t[10]!==f?(C=l?(0,d.jsx)(s.A,{ref:e=>{v(e)},variant:"h6",className:b.rubberbandText,style:{top:f,position:y?"sticky":void 0},children:(0,o.getBpDisplayStr)(l)}):null,t[7]=b.rubberbandText,t[8]=l,t[9]=y,t[10]=f,t[11]=C):C=t[11],t[12]!==b.rubberband||t[13]!==x||t[14]!==C?(k=(0,d.jsx)("div",{className:b.rubberband,style:x,children:C}),t[12]=b.rubberband,t[13]=x,t[14]=C,t[15]=k):k=t[15],t[16]!==S||t[17]!==k?(T=(0,d.jsxs)(d.Fragment,{children:[S,k]}),t[16]=S,t[17]=k,t[18]=T):T=t[18],T}},37957:(e,t,n)=>{n.d(t,{WD:()=>i,Yv:()=>l,qn:()=>s});var r=n(44728),a=n(69652);function o(e,t,n,r=!1){if(0===n)return 0;let a;return r?a=t/n-e*e/(n*n):(a=t-e*e/n,n>1&&(a/=n-1)),a<0?0:Math.sqrt(a)}function i(e){return{...e,scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:o(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered}}async function s(e,t){const{start:n,end:o}=e,s={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0};let l=!1;const{scoreMin:c,scoreMax:d,scoreSum:u,scoreSumSquares:p,featureCount:h}=await(0,r._)(t.pipe((0,a.T)((e,t)=>{const n=t.get("score"),r=t.get("summary"),{scoreMax:a,scoreMin:o}=e;return e.scoreMax=Math.max(a,r?t.get("maxScore"):n),e.scoreMin=Math.min(o,r?t.get("minScore"):n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,l=!0,e},s)));return l?i({scoreMax:d,scoreMin:c,scoreSum:u,scoreSumSquares:p,featureCount:h,basesCovered:o-n+1}):{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}function l(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},38418:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(58921),a=n(68584),o=n(1622);const i=(0,a.ConfigurationSchema)("JB2TrackHubConnection",{configJsonLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/config.json",locationType:"UriLocation"},description:"location of the jb2 config file (usually called config.json)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this config.json, if empty all genomes will be imported"}},{baseConfiguration:o.baseConnectionConfig,preProcessSnapshot:e=>e.uri?{...e,configJsonLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=n(36422);function l(e){return s.types.compose("JB2TrackHubConnection",(0,o.BaseConnectionModelFactory)(e),s.types.model({configuration:(0,a.ConfigurationReference)(i),type:s.types.literal("JB2TrackHubConnection")})).actions(e=>({async connect(){const{doConnect:t}=await n.e(583).then(n.bind(n,60583));t(e)}}))}function c(e){e.addConnectionType(()=>new r.ConnectionType({name:"JB2TrackHubConnection",configSchema:i,stateModel:l(e),displayName:"JB2 Track Hub",description:"A JBrowse 2 config file based trackhub",url:"https://jbrowse.org/jb2/"}))}},40085:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(67758),a=n(7552);function o(){const e=(0,r.c)(5),t=(0,a.useRef)(null);let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={width:void 0,height:void 0},e[0]=n):n=e[0];const[o,i]=(0,a.useState)(n);let s,l,c;return e[1]===Symbol.for("react.memo_cache_sentinel")?(s=()=>{if(!t.current)return;const e="undefined"!=typeof window&&"ResizeObserver"in window?window.ResizeObserver:void 0;if(!e)return;const n=new e(e=>{i({width:e[0].contentRect.width,height:e[0].contentRect.height})});return n.observe(t.current),()=>{n.disconnect()}},l=[],e[1]=s,e[2]=l):(s=e[1],l=e[2]),(0,a.useEffect)(s,l),e[3]!==o?(c=[t,o],e[3]=o,e[4]=c):c=e[4],c}},40898:(e,t,n)=>{n.r(t),n.d(t,{category10:()=>r,dark2:()=>a,ggplot2Colors3:()=>u,ggplot2Colors4:()=>d,ggplot2Colors5:()=>c,ggplot2Colors6:()=>l,set1:()=>o,set2:()=>i,tableau10:()=>s});const r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],o=["#377eb8","#e41a1c","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],i=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],s=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],l=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"],c=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"],d=["#F8766D","#7CAE00","#00BFC4","#C77CFF"],u=["#F8766D","#00BA38","#619CFF"]},42498:(e,t,n)=>{n.d(t,{A:()=>b,S:()=>y});var r=n(36422),a=n(99546),o=n(43283),i=n(8832);const s={stringArray:r.types.array(r.types.string),stringArrayMap:r.types.map(r.types.array(r.types.string)),numberMap:r.types.map(r.types.number),boolean:r.types.boolean,color:r.types.refinement("Color",r.types.string,function(){return!0}),integer:r.types.integer,number:r.types.number,string:r.types.string,text:r.types.string,fileLocation:i.FileLocation,frozen:r.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},c=e=>({views:{get valueJSON(){return e.value}}}),d=e=>({views:{get valueJSON(){return JSON.stringify(e.value)}}}),u={fileLocation:d,number:c,integer:c,boolean:c,frozen:d,stringArray:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t){e.value.push(t)},removeAtIndex(t){e.value.splice(t,1)},setAtIndex(t,n){e.value[t]=n}}}),stringArrayMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)},addToKey(t,n){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.push(n)},removeAtKeyIndex(t,n){const r=e.value.get(t);if(!r)throw new Error(`${t} not found`);r.splice(n,1)},setAtKeyIndex(t,n,r){const a=e.value.get(t);if(!a)throw new Error(`${t} not found`);a[n]=r}}}),numberMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)}}})},p=r.types.refinement("JexlString",r.types.string,e=>e.startsWith("jexl:"));function h(e,{description:t="",model:n,type:i,defaultValue:c,contextVariable:d=[]}){if(!i)throw new Error("type name required");if(n||(n=s[i]),!n)throw new Error(`no builtin config slot type "${i}", and no 'model' param provided`);if(void 0===c)throw new Error("no 'defaultValue' provided");const h=`${e.charAt(0).toUpperCase()}${e.slice(1)}ConfigSlot`;let g=r.types.model(h,{name:r.types.literal(e),description:r.types.literal(t),type:r.types.literal(i),value:r.types.optional(r.types.union(p,n),c)}).volatile(()=>({contextVariable:d})).views(e=>({get isCallback(){return String(e.value).startsWith("jexl:")}})).views(e=>({get expr(){if(e.isCallback){const{pluginManager:t}=(0,a.getEnv)(e);return t||"undefined"!=typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,o.A)(String(e.value),t?.jexl)}return{evalSync:()=>e.value}},get valueJSON(){var t;if(!e.isCallback)return t=e.value,t?.toJSON?t.toJSON():`"${t}"`}})).preProcessSnapshot(n=>"object"==typeof n&&n.name===e?n:{name:e,description:t,type:i,value:n}).postProcessSnapshot(e=>"object"==typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0).actions(e=>({set(t){e.value=t},reset(){e.value=c},convertToCallback(){e.isCallback||(e.value=`jexl:${e.valueJSON||"''"}`)},convertToValue(){if(e.isCallback){try{const t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(e){}if(e.value=c,!(i in l))throw new Error(`no fallbackDefault defined for type ${i}`);e.value=l[i]}}}));u[i]&&(g=g.extend(u[i]));const m=r.types.optional(g,{name:e,type:i,description:t,value:c});return Object.defineProperty(m,"isJBrowseConfigurationSlot",{value:!0}),m}var g=n(35254);function m(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e&&0===Object.keys(e).length}function f(e){return Array.isArray(e)&&0===e.length}function y(e,t,n){const{schemaDefinition:a,options:o}=function(e,t,n={}){if("string"!=typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");let r=t,a=n;return n.baseConfiguration?.jbrowseSchemaDefinition&&(r={...n.baseConfiguration.jbrowseSchemaDefinition,...r},a={...n.baseConfiguration.jbrowseSchemaOptions,...n,baseConfiguration:void 0}),{schemaDefinition:r,options:a}}(e,t,n),s=function(e,t,n){const a={};let o;if(n.explicitlyTyped&&(a.type=r.types.optional(r.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error(`Cannot have both explicit and implicit identifiers in ${e}`);n.explicitIdentifier?"string"==typeof n.explicitIdentifier?(a[n.explicitIdentifier]=r.types.identifier,o=n.explicitIdentifier):(a.id=r.types.identifier,o="id"):n.implicitIdentifier&&("string"==typeof n.implicitIdentifier?(a[n.implicitIdentifier]=i.ElementId,o=n.implicitIdentifier):(a.id=i.ElementId,o="id"));const s={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};for(const[n,o]of Object.entries(t))if((0,r.isType)(o)&&(0,r.isLateType)(o)||(0,g.oG)(o))a[n]=o;else if("string"==typeof o||"number"==typeof o)s[n]=o;else{if("object"!=typeof o)throw new Error(`invalid configuration schema definition, "${n}" must be either a valid configuration slot definition, a constant, or a nested configuration schema`);if(!o.type)throw new Error(`no type set for config slot ${e}.${n}`);try{a[n]=h(n,o)}catch(t){throw new Error(`invalid config slot definition for ${e}.${n}: ${t}`)}}let l=r.types.model(`${e}ConfigurationSchema`,a).actions(e=>({setSubschema(t,n){if(!(0,g.oG)(a[t]))throw new Error(`${t} is not a subschema, cannot replace`);const o=(0,r.isStateTreeNode)(n)?n:a[t].create(n);return e[t]=o,o}}));Object.keys(s).length&&(l=l.volatile(()=>s)),n.actions&&(l=l.actions(n.actions)),n.views&&(l=l.views(n.views)),n.extend&&(l=l.extend(n.extend));const c=o?{[o]:"placeholderId"}:{},d=n.explicitlyTyped?{type:e,...c}:c,u=(0,r.getSnapshot)(l.create(d));return l=l.postProcessSnapshot(e=>{const t={};let n=!0;for(const[r,a]of Object.entries(e))n&&("object"==typeof u[r]&&"object"==typeof a?JSON.stringify(u[r])!==JSON.stringify(a)&&(n=!1):u[r]!==a&&(n=!1)),void 0===a||void 0!==s[r]||m(a)||f(a)||(t[r]=a);return n?{}:t}),n.preProcessSnapshot&&(l=l.preProcessSnapshot(n.preProcessSnapshot)),r.types.optional(l,d)}(e,a,o);return s.isJBrowseConfigurationSchema=!0,s.jbrowseSchemaDefinition=a,s.jbrowseSchemaOptions=o,s}function b(e){return r.types.union(r.types.reference(e),e)}},42752:(e,t,n)=>{n.d(t,{$G:()=>l,Db:()=>c,fK:()=>d});var r=n(67758),a=n(68446),o=n(75785),i=n(69500);const s=(0,o.n9)()(e=>({contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.disabled},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}})),l=(0,a.observer)(function({block:e,children:t}){const{classes:n}=s(),{widthPx:r}=e;return(0,i.jsx)("div",{style:{width:r},className:n.contentBlock,children:t})});function c(e){const t=(0,r.c)(5),{width:n}=e,{classes:a}=s();let o,l;return t[0]!==n?(o={width:n},t[0]=n,t[1]=o):o=t[1],t[2]!==a.elidedBlock||t[3]!==o?(l=(0,i.jsx)("div",{className:a.elidedBlock,style:o}),t[2]=a.elidedBlock,t[3]=o,t[4]=l):l=t[4],l}function d(e){const t=(0,r.c)(8),{boundary:n,width:a,style:o}=e;let l;t[0]!==o?(l=void 0===o?{}:o,t[0]=o,t[1]=l):l=t[1];const c=l,{classes:d}=s();let u;t[2]!==c||t[3]!==a?(u={...c,width:a},t[2]=c,t[3]=a,t[4]=u):u=t[4];const p=n?d.boundaryPaddingBlock:d.interRegionPaddingBlock;let h;return t[5]!==u||t[6]!==p?(h=(0,i.jsx)("div",{style:u,className:p}),t[5]=u,t[6]=p,t[7]=h):h=t[7],h}},43283:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(53085);const a={};function o(e,t){const n=`nosig|${e}`;if(!a[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");const o=e.split("jexl:")[1],i=t?t.compile(o):(0,r.A)().compile(o);a[n]=i}return a[n]}},43350:(e,t,n)=>{n.d(t,{A:()=>G});var r={};n.r(r),n.d(r,{CoreFreeResources:()=>A,CoreGetFeatureDensityStats:()=>M,CoreGetFeatureDetails:()=>y,CoreGetFeatures:()=>C,CoreGetFileInfo:()=>w,CoreGetMetadata:()=>b,CoreGetRefNames:()=>m,CoreRender:()=>T});var a=n(36422),o=n(7552),i=n(9342),s=n(12678),l=n(68584);const c=(0,l.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,cytobandLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var d=n(58921),u=n(67736),p=n(46377),h=n(3496),g=n(2406);class m extends g.A{name="CoreGetRefNames";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,h.cK)(n,a,o);return(0,p.isFeatureAdapter)(i)?i.getRefNames(r):[]}}var f=n(99546);class y extends g.A{name="CoreGetFeatureDetails";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,f.renameRegionsIfNeeded)(r,e),o=await super.serializeArguments(a,t);if("MainThreadRpcDriver"===t)return o;const{rendererType:i}=e;return this.pluginManager.getRendererType(i).serializeArgsInClient(o)}async execute(e,t){let n=e;"MainThreadRpcDriver"!==t&&(n=await this.deserializeArguments(e,t));const{rendererType:r,featureId:a}=n,o=this.pluginManager.getRendererType(r);return{feature:o.getLayoutSession(e)?.cachedLayout.layout.getDataByID(a)?.toJSON()}}}class b extends g.A{name="CoreGetMetadata";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,h.cK)(n,a,o);return(0,p.isFeatureAdapter)(i)?i.getMetadata(r):null}}class w extends g.A{name="CoreGetInfo";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,h.cK)(n,a,o);return(0,p.isFeatureAdapter)(i)?i.getHeader(r):null}}var v=n(44728),S=n(82088),x=n(6434);class C extends g.A{name="CoreGetFeatures";async deserializeReturn(e,t,n){return(await super.deserializeReturn(e,t,n)).map(e=>new x.A(e))}async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,f.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}async execute(e,t){const{stopToken:n,statusCallback:r,sessionId:a,adapterConfig:o,regions:i,opts:s}=await this.deserializeArguments(e,t),l=(await(0,h.cK)(this.pluginManager,a,o)).dataAdapter;return(await(0,v._)(l.getFeaturesInMultipleRegions(i,{...s,statusCallback:r,stopToken:n}).pipe((0,S.$)()))).map(e=>e.toJSON())}}function k(e,t){if(!t.ReactComponent)throw new Error(`renderer ${e} has no ReactComponent, it may not be completely implemented yet`);return t}class T extends g.A{name="CoreRender";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,f.renameRegionsIfNeeded)(r,e),o=await super.serializeArguments(a,t);return"MainThreadRpcDriver"===t?o:k(e.rendererType,this.pluginManager.getRendererType(e.rendererType)).serializeArgsInClient(o)}async execute(e,t){let n=e;"MainThreadRpcDriver"!==t&&(n=await this.deserializeArguments(e,t));const{sessionId:r,rendererType:a}=n;if(!r)throw new Error("must pass a unique session id");const o=k(a,this.pluginManager.getRendererType(a));return"MainThreadRpcDriver"===t?await o.render(n):await o.renderInWorker(n)}async deserializeReturn(e,t,n){const r=await super.deserializeReturn(e,t,n);return"MainThreadRpcDriver"===n?r:k(t.rendererType,this.pluginManager.getRendererType(t.rendererType)).deserializeResultsInClient(r,t)}}class A extends g.A{name="CoreFreeResources";async execute(e){await(0,h.pZ)(e);for(const t of this.pluginManager.getRendererTypes())t.freeResources(e)}async serializeArguments(e,t){return e}}class M extends g.A{name="CoreGetFeatureDensityStats";async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,f.renameRegionsIfNeeded)(r,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(a,t)}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:o,regions:i}=r,{dataAdapter:s}=await(0,h.cK)(n,o,a);if(!(0,p.isFeatureAdapter)(s))throw new Error("Adapter does not support retrieving features");return s.getMultiRegionFeatureDensityStats(i,r)}}class P extends s.A{name="CorePlugin";install(e){for(const t of Object.values(r))e.addRpcMethod(()=>new t(e));!function(e){e.addAdapterType(()=>new d.AdapterType({name:"CytobandAdapter",configSchema:c,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(4284).then(n.bind(n,94284)).then(e=>e.default)}))}(e),e.addWidgetType(()=>new u.A({name:"BaseFeatureWidget",heading:"Feature details",configSchema:i.Q,stateModel:(0,i.n)(e),ReactComponent:(0,o.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6386),n.e(1475),n.e(5300),n.e(3300)]).then(n.bind(n,93300)))}))}}class R{phaseCallbacks=new Map;phaseOrder=[];constructor(...e){this.phaseOrder=e}add(e,t){if(!this.phaseOrder.includes(e))throw new Error(`unknown phase ${e}`);let n=this.phaseCallbacks.get(e);n||(n=[],this.phaseCallbacks.set(e,n)),n.push(t)}run(){for(const e of this.phaseOrder)for(const t of this.phaseCallbacks.get(e)||[])t()}}var I=n(44278),L=n(47369),F=n(32767),N=n(91612),D=n(56328),B=n(92070),j=n(8024),V=n(58273),E=n(63589),z=n(95742),O=n(53085);class H{registeredTypes={};constructor(e,t){this.typeName=e,this.baseClass=t}add(e,t){this.registeredTypes[e]=t}has(e){return e in this.registeredTypes}get(e){if(!this.has(e))throw new Error(`${this.typeName} '${e}' not found, perhaps its plugin is not loaded or its plugin has not added it.`);return this.registeredTypes[e]}all(){return Object.values(this.registeredTypes)}}class G{plugins=[];jexl=(0,O.A)();pluginMetadata={};runtimePluginDefinitions=[];elementCreationSchedule=new R("renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account","add track workflow");rendererTypes=new H("RendererType",z.default);adapterTypes=new H("AdapterType",L.A);textSearchAdapterTypes=new H("TextSearchAdapterType",j.A);trackTypes=new H("TrackType",V.A);displayTypes=new H("DisplayType",D.A);connectionTypes=new H("ConnectionType",N.A);viewTypes=new H("ViewType",E.A);widgetTypes=new H("WidgetType",u.A);rpcMethods=new H("RpcMethodType",g.A);addTrackWidgets=new H("AddTrackWorkflow",F.A);internetAccountTypes=new H("InternetAccountType",B.A);configured=!1;extensionPoints=new Map;constructor(e=[]){this.addPlugin({plugin:new P,metadata:{isCore:!0}});for(const t of e)this.addPlugin(t)}pluginConfigurationNamespacedSchemas(){const e={};for(const t of this.plugins)t.configurationSchema&&(e[t.name]=t.configurationSchema);return e}pluginConfigurationUnnamespacedSchemas(){let e={};for(const t of this.plugins)t.configurationSchemaUnnamespaced&&(e={...e,...t.configurationSchemaUnnamespaced});return e}pluginConfigurationRootSchemas(){let e={};for(const t of this.plugins)t.rootConfigurationSchema&&(e={...e,...t.rootConfigurationSchema(this)});return e}addPlugin(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");const[t,n={}]="install"in e&&"configure"in e?[e,{}]:[e.plugin,e.metadata];if(this.plugins.includes(t))throw new Error("plugin already installed");return this.pluginMetadata[t.name]=n,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),t.install(this),this.plugins.push(t),this}getPlugin(e){return this.plugins.find(t=>t.name===e)}hasPlugin(e){return void 0!==this.getPlugin(e)}createPluggableElements(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),this.elementCreationSchedule=void 0),this}setRootModel(e){return this.rootModel=e,this}configure(){if(this.configured)throw new Error("already configured");for(const e of this.plugins)e.configure(this);return this.configured=!0,this}getElementTypeRecord(e){switch(e){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;case"add track workflow":return this.addTrackWidgets;default:throw new Error(`invalid element type '${e}'`)}}addElementType(e,t){if("function"!=typeof t)throw new Error("must provide a callback function that returns the new type object");const n=this.getElementTypeRecord(e);return this.elementCreationSchedule?.add(e,()=>{const r=t(this);if(!r.name)throw new Error(`cannot add a ${e} with no name`);n.has(r.name)?console.warn(`${e} ${r.name} already registered, cannot register it again`):n.add(r.name,this.evaluateExtensionPoint("Core-extendPluggableElement",r))}),this}getElementType(e,t){return this.getElementTypeRecord(e).get(t)}getElementTypesInGroup(e){return this.getElementTypeRecord(e).all()}getViewElements(){return this.getElementTypesInGroup("view")}getTrackElements(){return this.getElementTypesInGroup("track")}getConnectionElements(){return this.getElementTypesInGroup("connection")}getAddTrackWorkflowElements(){return this.getElementTypesInGroup("add track workflow")}getRpcElements(){return this.getElementTypesInGroup("rpc method")}getDisplayElements(){return this.getElementTypesInGroup("display")}getAdapterElements(){return this.getElementTypesInGroup("adapter")}pluggableMstType(e,t,n=a.types.maybe(a.types.null)){const r=this.getElementTypeRecord(e).all().map(e=>e[t]).filter(e=>(0,a.isType)(e)&&(0,a.isModelType)(e));return 0===r.length&&"undefined"==typeof jest?(console.warn(`No pluggable types found matching ('${e}','${t}')`),n):a.types.union(...r)}pluggableConfigSchemaType(e,t="configSchema"){const n=this.getElementTypeRecord(e).all().map(e=>e[t]).filter(e=>(0,l.isBareConfigurationSchemaType)(e));return 0===n.length&&n.push((0,l.ConfigurationSchema)("Null",{})),a.types.union(...n)}jbrequireCache=new Map;lib=I.A;load=e=>(this.jbrequireCache.has(e)||this.jbrequireCache.set(e,e(this)),this.jbrequireCache.get(e));jbrequire=e=>{if("string"==typeof e){const t=this.lib[e];if(!t)throw new TypeError(`No jbrequire re-export defined for package '${e}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`);return t}if("function"==typeof e)return this.load(e);if(e.default)return console.warn("initiated jbrequire on a {default:Function}"),this.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")};getRendererType(e){return this.rendererTypes.get(e)}getRendererTypes(){return this.rendererTypes.all()}getAdapterType(e){return this.adapterTypes.get(e)}getTextSearchAdapterType(e){return this.textSearchAdapterTypes.get(e)}getTrackType(e){return this.trackTypes.get(e)}getDisplayType(e){return this.displayTypes.get(e)}getViewType(e){return this.viewTypes.get(e)}getAddTrackWorkflow(e){return this.addTrackWidgets.get(e)}getWidgetType(e){return this.widgetTypes.get(e)}getConnectionType(e){return this.connectionTypes.get(e)}getRpcMethodType(e){return this.rpcMethods.get(e)}getInternetAccountType(e){return this.internetAccountTypes.get(e)}addRendererType(e){return this.addElementType("renderer",e)}addAdapterType(e){return this.addElementType("adapter",e)}addTextSearchAdapterType(e){return this.addElementType("text search adapter",e)}addTrackType(e){return this.addElementType("track",()=>{const t=e(this),n=this.getElementTypesInGroup("display");for(const e of n)e.trackType!==t.name||t.displayTypes.includes(e)||t.addDisplayType(e);return t})}addDisplayType(e){return this.addElementType("display",e)}addViewType(e){return this.addElementType("view",()=>{const t=e(this),n=this.getElementTypesInGroup("display");for(const e of n)e.viewType!==t.name&&e.viewType!==t.extendedName||t.displayTypes.includes(e)||t.addDisplayType(e);return t})}addWidgetType(e){return this.addElementType("widget",e)}addConnectionType(e){return this.addElementType("connection",e)}addRpcMethod(e){return this.addElementType("rpc method",e)}addInternetAccountType(e){return this.addElementType("internet account",e)}addAddTrackWorkflowType(e){return this.addElementType("add track workflow",e)}addToExtensionPoint(e,t){let n=this.extensionPoints.get(e);n||(n=[],this.extensionPoints.set(e,n)),n.push(t)}evaluateExtensionPoint(e,t,n){const r=this.extensionPoints.get(e);let a=t;if(r)for(const e of r)try{a=e(a,n)}catch(e){console.error(e)}return a}async evaluateAsyncExtensionPoint(e,t,n){const r=this.extensionPoints.get(e);let a=t;if(r)for(const e of r)try{a=await e(a,n)}catch(e){console.error(e)}return a}}},43550:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(67758),a=n(28097),o=n(91818),i=n(69092),s=n(61282),l=n(75785),c=n(99546),d=n(91468),u=n(69500);function p(e){return"blobId"in e}const h=(0,l.n9)()(e=>({filename:{marginLeft:e.spacing(1)}})),g=function(e){const t=(0,r.c)(18),{location:n,setLocation:l}=e,{classes:g}=h();let m;t[0]!==n?(m=n&&(p(n)&&n.name||"localPath"in n&&n.localPath),t[0]=n,t[1]=m):m=t[1];const f=m;let y;t[2]!==n?(y=n&&p(n)&&!(0,d.getBlob)(n.blobId),t[2]=n,t[3]=y):y=t[3];const b=y;let w;t[4]!==l?(w=(0,u.jsx)(a.A,{children:(0,u.jsx)(o.A,{fullWidth:!0,children:(0,u.jsxs)(i.A,{variant:"outlined",component:"label",children:["Choose File",(0,u.jsx)("input",{type:"file",hidden:!0,onChange:e=>{const{target:t}=e,n=t.files?.[0];if(n)if(c.isElectron){const{webUtils:e}=window.require("electron");l({localPath:e.getPathForFile(n),locationType:"LocalPathLocation"})}else l((0,d.storeBlobLocation)({blob:n}))}})]})})}),t[4]=l,t[5]=w):w=t[5];const v=f?"initial":"textSecondary",S=f||"No file chosen";let x,C,k,T;return t[6]!==g.filename||t[7]!==v||t[8]!==S?(x=(0,u.jsx)(s.A,{component:"span",className:g.filename,color:v,children:S}),t[6]=g.filename,t[7]=v,t[8]=S,t[9]=x):x=t[9],t[10]!==b?(C=b?(0,u.jsx)(s.A,{color:"error",children:"(need to reload)"}):null,t[10]=b,t[11]=C):C=t[11],t[12]!==x||t[13]!==C?(k=(0,u.jsxs)(a.A,{children:[x,C]}),t[12]=x,t[13]=C,t[14]=k):k=t[14],t[15]!==w||t[16]!==k?(T=(0,u.jsxs)(a.A,{display:"flex",flexDirection:"row",alignItems:"center",children:[w,k]}),t[15]=w,t[16]=k,t[17]=T):T=t[17],T}},44278:(e,t,n)=>{n.d(t,{A:()=>oe});var r=n(7552),a=n.t(r,2),o=n(51414),i=n(62266),s=n(18457),l=n(67485),c=n(90864),d=n(9767),u=n(51097),p=n(72568),h=n(42489),g=n(68446),m=n(36422),f=n(69500),y=n.t(f,2),b=n(28485),w=n.t(b,2),v=n(81886),S=n.t(v,2),x=n(75785),C=n(12678),k=n(68584),T=n(46377),A=n(58921),M=n(67758);function P(e,t=""){return Object.fromEntries(Object.entries(e).map(([e,n])=>function(e,t){const n=(0,r.forwardRef)((e,n)=>{const a=(0,M.c)(3);let o;return a[0]!==e||a[1]!==n?(o=(0,f.jsx)(r.Suspense,{fallback:null,children:(0,f.jsx)(t,{...e,ref:n})}),a[0]=e,a[1]=n,a[2]=o):o=a[2],o});return n.displayName=e,[e,n]}(`${t}${e}`,n)))}const R=P({Attributes:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5300),n.e(7105)]).then(n.bind(n,35300))),FeatureDetails:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6386),n.e(1475),n.e(5300),n.e(4144)]).then(n.bind(n,84144))),BaseCard:(0,r.lazy)(()=>Promise.all([n.e(6386),n.e(7083)]).then(n.bind(n,87083))),BaseAttributes:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6386),n.e(5300),n.e(9912)]).then(n.bind(n,71610))),BaseCoreDetails:(0,r.lazy)(()=>Promise.all([n.e(6386),n.e(4788)]).then(n.bind(n,94788)))},"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail/"),I={DataGrid:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.DataGrid}))),GridActionsCellItem:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridActionsCellItem}))),GridAddIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridAddIcon}))),GridArrowDownwardIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridArrowDownwardIcon}))),GridArrowUpwardIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridArrowUpwardIcon}))),GridCellCheckboxForwardRef:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridCellCheckboxForwardRef}))),GridCellCheckboxRenderer:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridCellCheckboxRenderer}))),GridCheckCircleIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridCheckCircleIcon}))),GridCheckIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridCheckIcon}))),GridCloseIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridCloseIcon}))),GridColumnHeaderSeparator:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridColumnHeaderSeparator}))),GridColumnHeaderSortIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridColumnHeaderSortIcon}))),GridColumnIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridColumnIcon}))),GridColumnMenu:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridColumnMenu}))),GridColumnMenuContainer:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridColumnMenuContainer}))),GridDragIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridDragIcon}))),GridExpandMoreIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridExpandMoreIcon}))),GridFilterAltIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridFilterAltIcon}))),GridFilterForm:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridFilterForm}))),GridFilterListIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridFilterListIcon}))),GridFilterPanel:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridFilterPanel}))),GridFooter:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridFooter}))),GridFooterContainer:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridFooterContainer}))),GridHeader:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridHeader}))),GridHeaderCheckbox:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridHeaderCheckbox}))),GridKeyboardArrowRight:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridKeyboardArrowRight}))),GridLoadIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridLoadIcon}))),GridLoadingOverlay:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridLoadingOverlay}))),GridMenuIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridMenuIcon}))),GridMoreVertIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridMoreVertIcon}))),GridNoRowsOverlay:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridNoRowsOverlay}))),GridOverlay:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridOverlay}))),GridPagination:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridPagination}))),GridPanel:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridPanel}))),GridPanelWrapper:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridPanelWrapper}))),GridRemoveIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridRemoveIcon}))),GridRoot:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridRoot}))),GridRowCount:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridRowCount}))),GridSearchIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridSearchIcon}))),GridSelectedRowCount:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridSelectedRowCount}))),GridSeparatorIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridSeparatorIcon}))),GridTableRowsIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridTableRowsIcon}))),GridToolbarExportContainer:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridToolbarExportContainer}))),GridTripleDotsVerticalIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridTripleDotsVerticalIcon}))),GridViewHeadlineIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridViewHeadlineIcon}))),GridViewStreamIcon:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(5982)]).then(n.bind(n,85678)).then(e=>({default:e.GridViewStreamIcon})))},L={Accordion:(0,r.lazy)(()=>Promise.all([n.e(6386),n.e(1768)]).then(n.bind(n,81768))),AccordionActions:(0,r.lazy)(()=>n.e(4781).then(n.bind(n,34781))),AccordionDetails:(0,r.lazy)(()=>n.e(3106).then(n.bind(n,83106))),AccordionSummary:(0,r.lazy)(()=>n.e(6192).then(n.bind(n,26192))),Alert:(0,r.lazy)(()=>n.e(6336).then(n.bind(n,36336))),AlertTitle:(0,r.lazy)(()=>n.e(5214).then(n.bind(n,5214))),Autocomplete:(0,r.lazy)(()=>n.e(3766).then(n.bind(n,43766))),Avatar:(0,r.lazy)(()=>n.e(5703).then(n.bind(n,5703))),AvatarGroup:(0,r.lazy)(()=>n.e(2901).then(n.bind(n,62901))),Backdrop:(0,r.lazy)(()=>n.e(2648).then(n.bind(n,2648))),Badge:(0,r.lazy)(()=>n.e(2969).then(n.bind(n,22969))),Box:(0,r.lazy)(()=>n.e(6219).then(n.bind(n,56219))),Breadcrumbs:(0,r.lazy)(()=>n.e(2655).then(n.bind(n,2655))),Button:(0,r.lazy)(()=>n.e(4646).then(n.bind(n,74646))),ButtonGroup:(0,r.lazy)(()=>n.e(3669).then(n.bind(n,33669))),Card:(0,r.lazy)(()=>n.e(9712).then(n.bind(n,9712))),CardActions:(0,r.lazy)(()=>n.e(1247).then(n.bind(n,71247))),CardActionArea:(0,r.lazy)(()=>n.e(9883).then(n.bind(n,59883))),CardContent:(0,r.lazy)(()=>n.e(8853).then(n.bind(n,38853))),CardHeader:(0,r.lazy)(()=>n.e(7621).then(n.bind(n,97621))),CardMedia:(0,r.lazy)(()=>n.e(6075).then(n.bind(n,6075))),CircularProgress:(0,r.lazy)(()=>n.e(1728).then(n.bind(n,1728))),Collapse:(0,r.lazy)(()=>n.e(1181).then(n.bind(n,71181))),ClickAwayListener:(0,r.lazy)(()=>n.e(6832).then(n.bind(n,76832))),Chip:(0,r.lazy)(()=>n.e(6936).then(n.bind(n,16936))),Checkbox:(0,r.lazy)(()=>n.e(219).then(n.bind(n,80219))),Container:(0,r.lazy)(()=>n.e(7037).then(n.bind(n,87037))),Dialog:(0,r.lazy)(()=>n.e(678).then(n.bind(n,30678))),DialogActions:(0,r.lazy)(()=>n.e(5913).then(n.bind(n,55913))),DialogTitle:(0,r.lazy)(()=>n.e(5412).then(n.bind(n,85412))),DialogContent:(0,r.lazy)(()=>n.e(9383).then(n.bind(n,79383))),DialogContentText:(0,r.lazy)(()=>n.e(8660).then(n.bind(n,88660))),Divider:(0,r.lazy)(()=>n.e(1035).then(n.bind(n,31035))),Drawer:(0,r.lazy)(()=>n.e(9421).then(n.bind(n,49421))),Fab:(0,r.lazy)(()=>n.e(7419).then(n.bind(n,37419))),Fade:(0,r.lazy)(()=>n.e(2836).then(n.bind(n,92836))),FilledInput:(0,r.lazy)(()=>n.e(9598).then(n.bind(n,59598))),FormLabel:(0,r.lazy)(()=>n.e(4446).then(n.bind(n,64446))),FormControl:(0,r.lazy)(()=>n.e(1).then(n.bind(n,10001))),FormControlLabel:(0,r.lazy)(()=>n.e(8921).then(n.bind(n,78921))),FormHelperText:(0,r.lazy)(()=>n.e(6535).then(n.bind(n,6535))),FormGroup:(0,r.lazy)(()=>n.e(5867).then(n.bind(n,75867))),Grid:(0,r.lazy)(()=>Promise.all([n.e(2826),n.e(6294)]).then(n.bind(n,46294))),Grid2:(0,r.lazy)(()=>Promise.all([n.e(2826),n.e(6294)]).then(n.bind(n,46294))),Grow:(0,r.lazy)(()=>n.e(525).then(n.bind(n,30525))),Icon:(0,r.lazy)(()=>n.e(4757).then(n.bind(n,84757))),IconButton:(0,r.lazy)(()=>n.e(7715).then(n.bind(n,87715))),Input:(0,r.lazy)(()=>n.e(9154).then(n.bind(n,79154))),InputBase:(0,r.lazy)(()=>n.e(9783).then(n.bind(n,19783))),InputLabel:(0,r.lazy)(()=>n.e(7924).then(n.bind(n,27924))),InputAdornment:(0,r.lazy)(()=>n.e(9512).then(n.bind(n,49512))),Link:(0,r.lazy)(()=>n.e(4542).then(n.bind(n,14542))),LinearProgress:(0,r.lazy)(()=>n.e(2020).then(n.bind(n,32020))),List:(0,r.lazy)(()=>n.e(6698).then(n.bind(n,6698))),ListItem:(0,r.lazy)(()=>n.e(8669).then(n.bind(n,18669))),ListItemAvatar:(0,r.lazy)(()=>n.e(769).then(n.bind(n,30769))),ListItemSecondaryAction:(0,r.lazy)(()=>n.e(5831).then(n.bind(n,25831))),ListItemIcon:(0,r.lazy)(()=>n.e(2336).then(n.bind(n,99955))),ListSubheader:(0,r.lazy)(()=>n.e(5105).then(n.bind(n,15105))),ListItemText:(0,r.lazy)(()=>n.e(4370).then(n.bind(n,14370))),Menu:(0,r.lazy)(()=>n.e(1370).then(n.bind(n,48989))),MenuItem:(0,r.lazy)(()=>n.e(1386).then(n.bind(n,61386))),MenuList:(0,r.lazy)(()=>n.e(5438).then(n.bind(n,89409))),Modal:(0,r.lazy)(()=>n.e(6775).then(n.bind(n,16775))),NativeSelect:(0,r.lazy)(()=>n.e(9074).then(n.bind(n,9074))),OutlinedInput:(0,r.lazy)(()=>n.e(7596).then(n.bind(n,17596))),Pagination:(0,r.lazy)(()=>n.e(1244).then(n.bind(n,11244))),PaginationItem:(0,r.lazy)(()=>n.e(9689).then(n.bind(n,19689))),Paper:(0,r.lazy)(()=>n.e(3052).then(n.bind(n,53052))),Popover:(0,r.lazy)(()=>n.e(7983).then(n.bind(n,77983))),Popper:(0,r.lazy)(()=>n.e(2464).then(n.bind(n,42464))),Portal:(0,r.lazy)(()=>n.e(8848).then(n.bind(n,68848))),Radio:(0,r.lazy)(()=>n.e(8249).then(n.bind(n,58249))),RadioGroup:(0,r.lazy)(()=>n.e(6352).then(n.bind(n,6352))),Rating:(0,r.lazy)(()=>n.e(2319).then(n.bind(n,62319))),ScopedCssBaseline:(0,r.lazy)(()=>n.e(3046).then(n.bind(n,43046))),Select:(0,r.lazy)(()=>n.e(7182).then(n.bind(n,27182))),Skeleton:(0,r.lazy)(()=>n.e(1889).then(n.bind(n,81889))),Slider:(0,r.lazy)(()=>n.e(3091).then(n.bind(n,63091))),Snackbar:(0,r.lazy)(()=>Promise.all([n.e(2524),n.e(8557)]).then(n.bind(n,98557))),SnackbarContent:(0,r.lazy)(()=>n.e(1038).then(n.bind(n,61038))),SpeedDial:(0,r.lazy)(()=>n.e(8405).then(n.bind(n,48405))),SpeedDialAction:(0,r.lazy)(()=>n.e(4832).then(n.bind(n,24832))),SpeedDialIcon:(0,r.lazy)(()=>n.e(4350).then(n.bind(n,4350))),Stack:(0,r.lazy)(()=>n.e(7441).then(n.bind(n,49822))),Step:(0,r.lazy)(()=>n.e(9680).then(n.bind(n,49680))),StepButton:(0,r.lazy)(()=>n.e(7565).then(n.bind(n,67565))),StepConnector:(0,r.lazy)(()=>n.e(5415).then(n.bind(n,25415))),StepLabel:(0,r.lazy)(()=>n.e(5402).then(n.bind(n,35402))),StepIcon:(0,r.lazy)(()=>n.e(7857).then(n.bind(n,7857))),Stepper:(0,r.lazy)(()=>n.e(6563).then(n.bind(n,46563))),SvgIcon:(0,r.lazy)(()=>n.e(4353).then(n.bind(n,14353))),Switch:(0,r.lazy)(()=>n.e(2814).then(n.bind(n,22814))),Tab:(0,r.lazy)(()=>n.e(3233).then(n.bind(n,73233))),Table:(0,r.lazy)(()=>n.e(4418).then(n.bind(n,34418))),TableBody:(0,r.lazy)(()=>n.e(462).then(n.bind(n,40462))),TableCell:(0,r.lazy)(()=>n.e(1874).then(n.bind(n,91874))),TableContainer:(0,r.lazy)(()=>n.e(6381).then(n.bind(n,66381))),TableFooter:(0,r.lazy)(()=>n.e(7979).then(n.bind(n,27979))),TableHead:(0,r.lazy)(()=>n.e(4288).then(n.bind(n,54288))),TablePagination:(0,r.lazy)(()=>Promise.all([n.e(2407),n.e(6338)]).then(n.bind(n,70818))),TableRow:(0,r.lazy)(()=>n.e(6038).then(n.bind(n,66038))),TableSortLabel:(0,r.lazy)(()=>n.e(5050).then(n.bind(n,25050))),Tabs:(0,r.lazy)(()=>Promise.all([n.e(6133),n.e(3130)]).then(n.bind(n,33130))),TextField:(0,r.lazy)(()=>n.e(6631).then(n.bind(n,66631))),TextareaAutosize:(0,r.lazy)(()=>n.e(7898).then(n.bind(n,77898))),ToggleButton:(0,r.lazy)(()=>n.e(8782).then(n.bind(n,38782))),ToggleButtonGroup:(0,r.lazy)(()=>n.e(8821).then(n.bind(n,41202))),Toolbar:(0,r.lazy)(()=>n.e(8945).then(n.bind(n,78945))),Tooltip:(0,r.lazy)(()=>n.e(1113).then(n.bind(n,81113))),Typography:(0,r.lazy)(()=>n.e(3503).then(n.bind(n,13503)))},F=["mobx","mobx-state-tree","react","react/jsx-runtime","react-dom","react-dom/client","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react/mui","@material-ui/core","@mui/material","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/AccordionSummary","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grid2","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/AccordionSummary","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grid2","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/ui/theme","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"];var N=n(47369),D=n(56328),B=n(58273),j=n(63589),V=n(67736),E=n(1622),z=n(98111),O=n(94318),H=n(92880),G=n(95742),$=n(198),W=n(67112),U=n(75397),_=n(99546),q=n(97884),J=n(80208),X=n(99834),Y=n(88217),K=n(23550),Q=n(66885),Z=n(91468),ee=n(8832);const te={mobx:h,"mobx-state-tree":m,react:a,"react/jsx-runtime":y,"react-dom":w,"react-dom/client":S,"mobx-react":g,"@mui/x-data-grid":{useGridApiContext:d.h,useGridApiRef:u.b,useGridRootProps:p.A,...P(I)},"@mui/material/utils":c,"@material-ui/core/utils":c,"tss-react/mui":{makeStyles:x.n9},"@material-ui/core":{...P(L),useTheme:o.A,alpha:i.X4,makeStyles:e=>{const t=(0,x.n9)()(e);return()=>t().classes}},"@mui/material":{...P(L),alpha:i.X4,useTheme:o.A,createTheme:s.A},...P(L,"@mui/material/"),...P(L,"@material-ui/core/"),"@mui/material/styles":{...l,makeStyles:e=>{const t=(0,x.n9)()(e);return()=>t().classes}},"@material-ui/core/styles":{...l,makeStyles:e=>{const t=(0,x.n9)()(e);return()=>t().classes}},"@material-ui/lab/ToggleButton":L.ToggleButton,"@material-ui/lab/ToggleButtonGroup":L.ToggleButtonGroup,"@material-ui/lab/Autocomplete":L.Autocomplete,"@material-ui/lab/Alert":L.Alert,"@material-ui/lab":{Alert:L.Alert,Autocomplete:L.Autocomplete,ToggleButton:L.ToggleButton,ToggleButtonGroup:L.ToggleButtonGroup},"@jbrowse/core/Plugin":C.A,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":G,"@jbrowse/core/configuration":k,"@jbrowse/core/util/types/mst":ee,"@jbrowse/core/ui":W,"@jbrowse/core/ui/theme":U,"@jbrowse/core/util":_,"@jbrowse/core/util/color":J,"@jbrowse/core/util/layouts":Y,"@jbrowse/core/util/tracks":Z,"@jbrowse/core/util/Base1DViewModel":q.A,"@jbrowse/core/util/io":X,"@jbrowse/core/util/mst-reflection":K,"@jbrowse/core/util/rxjs":Q,"@jbrowse/core/pluggableElementTypes":A,"@jbrowse/core/pluggableElementTypes/ViewType":j.A,"@jbrowse/core/pluggableElementTypes/AdapterType":N.A,"@jbrowse/core/pluggableElementTypes/DisplayType":D.A,"@jbrowse/core/pluggableElementTypes/TrackType":B.A,"@jbrowse/core/pluggableElementTypes/WidgetType":V.A,"@jbrowse/core/pluggableElementTypes/models":E,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":$,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":O.A,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":z,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":H,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":R,"@jbrowse/core/data_adapters/BaseAdapter":T},ne=Object.keys(te),re=ne.filter(e=>!F.includes(e));if(re.length>0)throw new Error(`The following modules are in the modules libs, but not the re-exports list: ${re.join(", ")}`);const ae=F.filter(e=>!ne.includes(e));if(ae.length)throw new Error(`The following modules are in the re-exports list, but not the modules libs: ${ae.join(", ")}`);const oe=te},46377:(e,t,n)=>{function r(e){return"getRegions"in e&&"getFeatures"in e}function a(e){return"getRegions"in e}function o(e){return"getFeatures"in e}function i(e){return"getRefNameAliases"in e}function s(e){return"searchIndex"in e}n.r(t),n.d(t,{BaseAdapter:()=>p,BaseFeatureDataAdapter:()=>v,BaseSequenceAdapter:()=>S,isFeatureAdapter:()=>o,isRefNameAliasAdapter:()=>i,isRegionsAdapter:()=>a,isSequenceAdapter:()=>r,isTextSearchAdapter:()=>s});var l=n(36422),c=n(68584),d=n(26257);const u=(0,c.ConfigurationSchema)("empty",{});class p{static capabilities=[];constructor(e=u.create(),t,n){if(this.config=e,this.getSubAdapter=t,this.pluginManager=n,"undefined"==typeof jest){const t=(0,l.isStateTreeNode)(e)?(0,l.getSnapshot)(e):e;this.id=`${(0,d.A)(t)}`}else this.id="test"}getConf(e){return(0,c.readConfObject)(this.config,e)}freeResources(e){}}var h=n(62718),g=n(44728),m=n(82088),f=n(99546),y=n(66885),b=n(37957),w=n(37347);class v extends p{async getHeader(e){return null}async getMetadata(e){return null}getFeaturesInRegion(e,t={}){return(0,y.ObservableCreate)(async n=>{const r=await this.hasDataForRefName(e.refName,t);(0,w.SW)(t.stopToken),r?this.getFeatures(e,t).subscribe(n):n.complete()})}getFeaturesInMultipleRegions(e,t={}){return(0,h.h)(...e.map(e=>this.getFeaturesInRegion(e,t)))}async hasDataForRefName(e,t={}){return(await this.getRefNames(t)).includes(e)}async getRegionQuantitativeStats(e,t){const n=this.getFeatures(e,t);return(0,b.qn)(e,n)}async getMultiRegionQuantitativeStats(e=[],t){if(!e.length)return(0,b.Yv)();const n=await Promise.all(e.map(e=>this.getRegionQuantitativeStats(e,t))),r=(0,f.max)(n.map(e=>e.scoreMax)),a=(0,f.min)(n.map(e=>e.scoreMin)),o=(0,f.sum)(n.map(e=>e.scoreSum)),i=(0,f.sum)(n.map(e=>e.scoreSumSquares)),s=(0,f.sum)(n.map(e=>e.featureCount)),l=(0,f.sum)(n.map(e=>e.basesCovered));return(0,b.WD)({scoreMin:a,scoreMax:r,featureCount:s,basesCovered:l,scoreSumSquares:i,scoreSum:o})}getRegionFeatureDensityStats(e,t){let n=Date.now();const r=async(n,r)=>{const{start:o,end:i}=e,s=.75*o+.25*i,l=await(0,g._)(this.getFeatures({...e,start:Math.max(0,Math.round(s-n/2)),end:Math.min(Math.round(s+n/2),i)},t).pipe((0,m.$)()));return a({interval:n,statsSampleFeatures:l.length,expansionTime:r,stats:{featureDensity:l.length/n}})},a=async({interval:t,stats:a,statsSampleFeatures:o,expansionTime:i})=>{const s=e.end-e.start;if(o>=70||2*t>s)return a;if(i<=5e3){const e=Date.now();return i+=e-n,n=e,r(2*t,i)}return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:Number.POSITIVE_INFINITY}};return r(1e3,0)}async getMultiRegionFeatureDensityStats(e,t){if(!e.length)throw new Error("No regions supplied");return this.getRegionFeatureDensityStats(e[0],t)}async getSources(e){const t=await(0,g._)(this.getFeaturesInMultipleRegions(e).pipe((0,m.$)())),n=new Set;for(const e of t)n.add(e.get("source"));return[...n].map(e=>({name:e}))}}class S extends v{async getMultiRegionFeatureDensityStats(){return{featureDensity:0}}}},47369:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{constructor(e){super(e),this.getAdapterClass="AdapterClass"in e?async()=>e.AdapterClass:e.getAdapterClass,this.configSchema=e.configSchema,this.adapterCapabilities=e.adapterCapabilities||[],this.adapterMetadata=e.adapterMetadata}}},48133:(e,t,n)=>{n.d(t,{DO:()=>R,dg:()=>D,kO:()=>L,Ay:()=>B});var r=n(12678),a=n(99546),o=n(53683),i=n(7552),s=n(63589),l=n(68584),c=n(1622),d=n(90542),u=n(41718),p=n(34727),h=n(45465),g=n(42489),m=n(36422);function f(e,t,n,r,a){const o=Math.abs(e-n);if(o>r)return;o===r&&a.push([t,e]);const i=Math.sqrt(r*r-o*o);a.push([t-i,e],[t+i,e])}function y(e,t,n,r,a){const o=Math.abs(e-t);if(o>r)return;o===r&&a.push([e,n]);const i=Math.sqrt(r*r-o*o);a.push([e,n-i],[e,n+i])}function b(e,t){const n=Math.sqrt(e*e+t*t);if(0===n)return[0,0];const r=function(e,t){let n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t);return[n,r]}const w=2*Math.PI;class v{constructor(e,t,n,r){this.region=t,this.offsetRadians=n,this.radianWidth=r;const{bpPerRadian:o}=e;this.key="regions"in t?JSON.stringify(t.regions):(0,a.assembleLocString)(t),this.bpPerRadian=o,this.flipped=!1,this.startRadians=n,this.endRadians=t.widthBp/this.bpPerRadian+n,Object.freeze(this)}bpToXY(e,t){let n;n=this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start;const r=n/this.bpPerRadian+this.offsetRadians;return(0,a.polarToCartesian)(t,r)}toJSON(){return Object.fromEntries(Object.entries(this))}}const S=(0,i.lazy)(()=>n.e(5243).then(n.bind(n,15243))),x=function(e){return m.types.compose("CircularView",c.BaseViewModel,m.types.model({type:m.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:200,tracks:m.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:m.types.optional(m.types.number,400),displayedRegions:m.types.optional(m.types.frozen(),[]),scrollX:0,scrollY:0,minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,trackSelectorType:"hierarchical"})).volatile(()=>({volatileWidth:void 0,error:void 0})).views(e=>({get width(){if(void 0===e.volatileWidth)throw new Error("wait for view to be initialized first before accessing width");return e.volatileWidth},get visibleSection(){const{scrollX:t,scrollY:n,width:r,height:a}=e;return function(e,t,n){let[r,a,o,i]=e;const[s,l]=t;if(r-=s,a-=s,o-=l,i-=l,r<0&&a>0&&o<0&&i>0){const e=[[r,o],[a,o],[r,i],[a,i]];let t=Number.NEGATIVE_INFINITY;for(const[n,r]of e){const e=Math.sqrt(n*n+r*r);e>t&&(t=e)}return{rho:[0,Math.min(n,t)],theta:[0,2*Math.PI]}}const c=[[r,o],[a,o],[r,i],[a,i]];y(r,0,0,n,c),y(a,0,0,n,c),f(o,0,0,n,c),f(i,0,0,n,c),-r<n&&c.push([r,0]),a<n&&c.push([a,0]),-o<n&&c.push([0,o]),i<n&&c.push([0,i]);const d=r>=0?-1:1;let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(const[e,t]of c)if(e>=r&&e<=a&&t>=o&&t<=i){const[r,a]=b(e*d,t*d);r<=n+.001&&(a<h&&r>1e-4&&(h=a),a>g&&r>1e-4&&(g=a),r<u&&(u=r),r>p&&(p=r))}return-1===d&&(h+=Math.PI,g+=Math.PI),h>2*Math.PI&&g>2*Math.PI&&(h-=2*Math.PI,g-=2*Math.PI),{rho:[u,Math.min(n,p)],theta:[h,g]}}([t,t+r,n,n+a],this.centerXY,this.radiusPx)},get circumferencePx(){let t=0;for(const e of this.elidedRegions)t+=e.widthBp;return t/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){let t=0;for(const n of e.displayedRegions)t+=n.end-n.start;return t},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){const t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){const e=2*Math.PI*this.maximumRadiusPx;return(0,a.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){const t=[];for(const n of e.displayedRegions){const r=n.end-n.start;if(r/e.bpPerPx<e.minVisibleWidth){const e=t.at(-1);e?.elided?(e.regions.push({...n}),e.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[{...n}]})}else t.push({...n,widthBp:r,elided:!1})}for(let e=0;e<t.length;e+=1){const n=t[e];n.elided&&1===n.regions.length&&(t[e]={...n,...n.regions[0],elided:!1})}return t},get assemblyNames(){const t=[];for(const n of e.displayedRegions)t.includes(n.assemblyName)||t.push(n.assemblyName);return t},get initialized(){const{assemblyManager:t}=(0,a.getSession)(e);return void 0!==e.volatileWidth&&this.assemblyNames.every(e=>t.get(e)?.initialized)}})).views(e=>({get staticSlices(){return function(e){const t=[];let n=0;const{bpPerRadian:r,spacingPx:a,pxPerRadian:o}=e;for(const i of e.elidedRegions){const s=i.widthBp/r+a/o;t.push(new v(e,i,n,s)),n+=s}return t}(e)}})).views(e=>({get visibleStaticSlices(){return e.staticSlices.filter(t=>function(e,t){const{theta:[n,r]}=e.visibleSection;return a=t.offsetRadians+e.offsetRadians,i=n,s=r-n,!((o=t.radianWidth)<=0||s<=0)&&(o+1e-4>=w||s+1e-4>=w||(a=(a%w+w)%w+w)<(i=(i%w+w)%w+w)+s&&a+o>i||a<(i-=w)+s&&a+o>i||a<(i+=w+w)+s&&a+o>i);var a,o,i,s}(e,t))}})).actions(t=>({setWidth:e=>(t.volatileWidth=Math.max(e,100),t.volatileWidth),setHeight:e=>(t.height=Math.max(e,40),t.height),resizeHeight(e){const n=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},resizeWidth(e){const n=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},rotateClockwiseButton(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise(e=.17){t.offsetRadians+=e},rotateCounterClockwise(e=.17){t.offsetRadians-=e},zoomInButton(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx(e){t.bpPerPx=(0,a.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},setDisplayedRegions(e){const n=0===t.displayedRegions.length;t.displayedRegions=(0,m.cast)(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector(){if("hierarchical"===t.trackSelectorType){const e=(0,a.getSession)(t);if((0,a.isSessionModelWithWidgets)(e)){const n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error(`invalid track selector type ${t.trackSelectorType}`)},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setError(e){t.error=e},showTrack(n,r={}){const a=e.pluggableConfigSchemaType("track"),o=(0,m.resolveIdentifier)(a,(0,m.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map(e=>e.name)),c=o.displays.find(e=>l.has(e.type)),d=i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:c.type,configuration:c}]});t.tracks.push(d)},addTrackConf(n,r={}){const{type:a}=n,o=(0,l.readConfObject)(n,"name"),i=e.getTrackType(a);if(!i)throw new Error(`unknown track type ${a}`);const s=e.getViewType(t.type),c=new Set(s.displayTypes.map(e=>e.name)),d=n.displays.find(e=>c.has(e.type));t.tracks.push(i.stateModel.create({...r,name:o,type:a,configuration:n,displays:[{type:d.type,configuration:d}]}))},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=(0,m.resolveIdentifier)(r,(0,m.getRoot)(t),n),o=t.tracks.filter(e=>e.configuration===a);return(0,g.transaction)(()=>{for(const e of o)t.tracks.remove(e)}),o.length},toggleFitToWindowLock(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow},async exportSvg(e={}){const{renderToSvg:r}=await n.e(311).then(n.bind(n,60311)),a=await r(t,e),o=new Blob([a],{type:"image/svg+xml"});(0,h.saveAs)(o,e.filename||"image.svg")}})).views(e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{e.setDisplayedRegions([])},icon:u.A},{label:"Export SVG",icon:p.A,onClick:()=>{(0,a.getSession)(e).queueDialog(t=>[S,{model:e,handleClose:t}])}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:d.xU}]}))};var C=n(68446),k=n(69500);const T=(0,C.observer)(function({model:e}){const{renderProps:{radius:t},error:n}=e;return(0,k.jsxs)("g",{children:[(0,k.jsx)("defs",{children:(0,k.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,k.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}})})}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"#ffb4b4"}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),(0,k.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:String(n)})]})}),A=T,M=(0,n(75785).n9)()(e=>{const{primary:t,secondary:n,tertiary:r,quaternary:a}=e.palette;return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash 1.4s ease-in-out infinite, $colors 5.6s ease-in-out infinite"},"@keyframes colors":{"0%":{stroke:t.light},"25%":{stroke:n.light},"50%":{stroke:r.light},"75%":{stroke:a.light},"100%":{stroke:t.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}}),P=(0,C.observer)(function({model:{renderProps:{radius:e}}}){const{classes:t}=M(),[n,r]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{const e=setTimeout(()=>{r(!0)},400);return()=>{clearTimeout(e)}}),n?(0,k.jsxs)("g",{children:[(0,k.jsx)("defs",{children:(0,k.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,k.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}})})}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:e,fill:"#f1f1f1"}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:e,fill:"url(#diagonalHatch)"}),(0,k.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:"Loading…"}),(0,k.jsx)("circle",{className:t.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})]}):null}),R=(0,C.observer)(function({display:e}){return e.error?(0,k.jsx)(A,{model:e}):e.filled?e.reactElement:(0,k.jsx)(P,{model:e})});var I=n(91468);const L=(0,l.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"});function F(e){const t=(0,a.getContainingView)(e),{rendererType:n}=e,{rpcManager:r}=(0,a.getSession)(t);return{rendererType:n,rpcManager:r,renderProps:e.renderProps(),renderArgs:{assemblyName:t.displayedRegions[0].assemblyName,adapterConfig:structuredClone(e.adapterConfig),rendererType:n.name,regions:structuredClone(t.displayedRegions),blockDefinitions:e.blockDefinitions,sessionId:(0,I.getRpcSessionId)(e),timeout:1e6}}}async function N(e,t){if(!e)throw new Error("cannot render with no props");const{rendererType:n,rpcManager:r,cannotBeRenderedReason:a,renderArgs:o,renderProps:i,exportSVG:s}=e;if(a)return{message:a};if(!i.radius||!o.regions?.length)return{message:"Skipping render"};const{html:l,...c}=await n.renderInClient(r,{...o,...i,exportSVG:s,stopToken:t});return{html:l,data:c,reactElement:c.reactElement,renderingComponent:n.ReactComponent}}const D=m.types.compose("BaseChordDisplay",c.BaseDisplay,m.types.model({bezierRadiusRatio:.1,assemblyName:m.types.maybe(m.types.string),configuration:(0,l.ConfigurationReference)(L)})).volatile(()=>({filled:!1,reactElement:void 0,data:void 0,html:void 0,message:"",renderingComponent:void 0,refNameMap:void 0})).actions(e=>{const{pluginManager:t}=(0,a.getEnv)(e),n=e;return{onChordClick(r){(0,l.getConf)(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}}).views(e=>({get blockDefinitions(){const t=(0,a.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;const n=structuredClone(t);for(const t of n){const n=t.region.elided?t.region.regions:[t.region];for(const t of n){const n=e.refNameMap[t.refName];n&&t.refName!==n&&(t.refName=n)}}return n},renderProps(){const t=(0,a.getContainingView)(e);return{...(0,I.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick}},get rendererType(){return(0,a.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName)},get selectedFeatureId(){if(!(0,m.isAlive)(e))return;const{selection:t}=(0,a.getSession)(e);return(0,a.isFeature)(t)?t.id():void 0}})).actions(e=>({renderStarted(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess({message:t,data:n,reactElement:r,html:a,renderingComponent:o}){t?(e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=r,e.data=n,e.html=a,e.error=void 0,e.renderingComponent=o)},renderError(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.html=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap(t){e.refNameMap=t}})).actions(e=>({afterAttach(){(0,a.makeAbortableReaction)(e,F,N,{name:`${e.type} ${e.id} rendering`,fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,a.makeAbortableReaction)(e,()=>({assemblyNames:(0,I.getTrackAssemblyNames)(e.parentTrack),adapter:(0,l.getConf)((0,m.getParent)(e,2),"adapter"),assemblyManager:(0,a.getSession)(e).assemblyManager}),async(t,n)=>t?t.assemblyManager.getRefNameMapForAdapter(t.adapter,t.assemblyNames[0],{stopToken:n,sessionId:(0,I.getRpcSessionId)(e)}):void 0,{name:`${e.type} ${e.id} getting refNames`,fireImmediately:!0},()=>{},t=>{t&&e.setRefNameMap(t)},t=>{console.error(t),e.setError(t)})}})).views(e=>({async renderSvg(t){const n=F(e),r=await N({...n,exportSVG:t,theme:t.theme||n.renderProps.theme});return(0,k.jsx)(a.ReactRendering,{rendering:r})}}));class B extends r.A{name="CircularViewPlugin";install(e){!function(e){e.addViewType(()=>new s.A({ReactComponent:(0,i.lazy)(()=>Promise.all([n.e(2826),n.e(7363)]).then(n.bind(n,37363))),stateModel:x(e),name:"CircularView",displayName:"Circular view"}))}(e),function(e){e.addToExtensionPoint("LaunchView-CircularView",async({session:e,assembly:t,tracks:n=[]})=>{const{assemblyManager:r}=e,a=e.addView("CircularView",{});if(await(0,g.when)(()=>a.initialized),!t)throw new Error("No assembly provided when launching circular genome view");const o=await r.waitForAssembly(t);if(!o)throw new Error(`Assembly "${t}" not found when launching circular genome view`);a.setDisplayedRegions(o.regions||[]);for(const e of n)a.showTrack(e)})}(e)}configure(e){(0,a.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:o.A,onClick:e=>{e.addView("CircularView",{})}})}}},49256:(e,t,n)=>{function r(e,t){let n=0,r=0,a=0;const o=[];for(let i=0;i<e.length&&a<t.length;i+=2){const s=+e[i],l=e[i+1];if("S"===l||"I"===l){for(let e=0;e<s&&a<t.length;e++)t[a]===n+e&&a++;n+=s}else if("D"===l||"N"===l)r+=s;else if("M"===l||"X"===l||"="===l){for(let e=0;e<s&&a<t.length;e++)t[a]===n+e&&(o.push({ref:r+e,idx:a}),a++);n+=s,r+=s}}return o}n.d(t,{h:()=>r})},49473:(e,t,n)=>{n.d(t,{E6:()=>h,Ec:()=>p,JV:()=>f,Tp:()=>u,_u:()=>m,eW:()=>d,y$:()=>g});var r=n(67758),a=n(7552),o=n(68584),i=n(99546),s=n(91468);const[,l,,c]=[0,1,2,3];function d(e,t,n,r){return r?r(t,n):e[n].trackRefs[t]?.getBoundingClientRect().top||0}function u(e,t,n){return(e.bpToPx({refName:t,coord:n})?.offsetPx||0)-e.offsetPx}function p(e,t,n,r,a,o){const s=r[t].displays[0],u=s.height;let p=0;const{SNPCoverageDisplay:h}=s;h&&(p=h.height);const g=o?0:s.scrollTop;return(0,i.clamp)(a[l]-g+((m=a)[c]-m[l])/2+p,0,u)+d(n,e,t,o)+s.scrollTop;var m}const h=e=>{const t=(0,r.c)(5),[,n]=(0,a.useState)();let o,i;t[0]!==n||t[1]!==e?(o=()=>{n(e)},t[0]=n,t[1]=e,t[2]=o):o=t[2],t[3]!==e?(i=[e],t[3]=e,t[4]=i):i=t[4],(0,a.useEffect)(o,i)};function g(e,t=[],n=[],...r){const a=new Set(n.map(t=>e(t))),o=t.filter(t=>a.has(e(t)));return 0===r.length?o:g(e,o,...r)}function m(e,t){return e.displays[0].searchFeatureByID?.(t.id())}async function f(e,t){const{views:n}=e,{rpcManager:r}=(0,i.getSession)(e),a=(0,s.getRpcSessionId)(t);return Promise.all(n.flatMap(async e=>await r.call(a,"CoreGetFeatures",{adapterConfig:(0,o.getConf)(t,["adapter"]),sessionId:a,regions:e.staticBlocks.contentBlocks})))}},49854:(e,t,n)=>{n.d(t,{_:()=>ke.A,A:()=>Te});var r=n(12678),a=n(56328),o=n(48133),i=n(68584),s=n(36422);var l=n(99546),c=n(91468);var d=n(90863);function u(e){return s.types.compose("LinearVariantDisplay",(0,d.bN)(e),s.types.model({type:s.types.literal("LinearVariantDisplay"),configuration:(0,i.ConfigurationReference)(e)})).actions(e=>({async selectFeature(t){const n=(0,l.getSession)(e);if((0,l.isSessionModelWithWidgets)(n)){const{rpcManager:r}=n,a=(0,c.getRpcSessionId)(e),o=(0,l.getContainingTrack)(e),s=(0,l.getContainingView)(e),d=(0,i.getConf)(o,"adapter"),u=await r.call(a,"CoreGetMetadata",{adapterConfig:d});n.showWidget(n.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:s,track:o,descriptions:u}))}n.setSelection(t)}}))}var p=n(7552),h=n(93100),g=n(37347),m=n(18662),f=n(39928),y=n(85857),b=n(71736),w=n(20482),v=n(41365),S=n.n(v);function x({sources:e,layout:t=e,renderingMode:n,sampleInfo:r}){const a=[],o=Object.fromEntries(e.map(e=>[e.name,e]));for(const e of t)if("phased"===n){const t=r?.[e.name];if(t?.isPhased){const n=t.maxPloidy;for(let t=0;t<n;t++){const n=`${e.name} HP${t}`;a.push({...o[e.name],...e,label:n,HP:t,id:n})}}}else a.push({...o[e.name],...e,label:e.name,id:e.name});return a}const C=(0,p.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(3100),n.e(6395),n.e(3526)]).then(n.bind(n,3526))),k=(0,p.lazy)(()=>n.e(8407).then(n.bind(n,38407))),T=(0,p.lazy)(()=>n.e(7239).then(n.bind(n,87239))),A=(0,p.lazy)(()=>n.e(551).then(n.bind(n,90551))),M=(0,p.lazy)(()=>n.e(1204).then(n.bind(n,21204)));function P(e){return s.types.compose("LinearVariantMatrixDisplay",(0,d.Gx)(e),s.types.model({type:s.types.literal("LinearVariantMatrixDisplay"),layout:s.types.optional(s.types.frozen(),[]),configuration:(0,i.ConfigurationReference)(e),minorAlleleFrequencyFilter:s.types.optional(s.types.number,0),showSidebarLabelsSetting:!0,renderingMode:s.types.optional(s.types.string,"alleleCount"),rowHeightSetting:s.types.optional(s.types.number,8),autoHeight:!0,lengthCutoffFilter:Number.MAX_SAFE_INTEGER,jexlFilters:s.types.maybe(s.types.array(s.types.string)),referenceDrawingMode:"skip"})).volatile(()=>({sourcesLoadingStopToken:void 0,simplifiedFeaturesStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0,featuresVolatile:void 0,hasPhased:!1,sampleInfo:void 0,hoveredGenotype:void 0})).actions(e=>({setJexlFilters(t){e.jexlFilters=(0,s.cast)(t)},setRowHeight(t){e.rowHeightSetting=t},setHoveredGenotype(t){e.hoveredGenotype=t},setFeatures(t){e.featuresVolatile=t},setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,g.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setSimplifiedFeaturesLoading(t){e.simplifiedFeaturesStopToken&&(0,g.CF)(e.simplifiedFeaturesStopToken),e.simplifiedFeaturesStopToken=t},setSources(t){S()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setMafFilter(t){e.minorAlleleFrequencyFilter=t},setShowSidebarLabels(t){e.showSidebarLabelsSetting=t},setPhasedMode(t){e.renderingMode=t},setAutoHeight(t){e.autoHeight=t},setHasPhased(t){e.hasPhased=t},setSampleInfo(t){S()(t,e.sampleInfo)||(e.sampleInfo=t)},setReferenceDrawingMode(t){e.referenceDrawingMode=t}})).views(e=>({get activeFilters(){return e.jexlFilters??(0,i.getConf)(e,"jexlFilters").map(e=>`jexl:${e}`)},get preSources(){return e.layout.length?e.layout:e.sourcesVolatile},get sourcesWithoutLayout(){return e.sourcesVolatile?x({sources:e.sourcesVolatile,renderingMode:e.renderingMode,sampleInfo:e.sampleInfo}):void 0},get sources(){const t=e.layout.length?e.layout:e.sourcesVolatile;return t?x({sources:t,renderingMode:e.renderingMode,sampleInfo:e.sampleInfo}):void 0}})).views(e=>{const{trackMenuItems:t,renderProps:n}=e;return{get sourceMap(){return e.sources?Object.fromEntries(e.sources.map(e=>[e.name,e])):void 0},get rowHeight(){const{sources:t,autoHeight:n,rowHeightSetting:r,height:a}=e;return n?a/(t?.length||1):r},adapterProps:()=>({...n(),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig}),trackMenuItems:()=>[...t(),{label:"Show sidebar labels",icon:w.A,type:"checkbox",checked:e.showSidebarLabelsSetting,onClick:()=>{e.setShowSidebarLabels(!e.showSidebarLabelsSetting)}},{label:"Row height",icon:y.A,subMenu:[{label:"Manually set row height",disabled:e.autoHeight,onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[M,{model:e,handleClose:t}])}},{label:"Auto-adjust to display height",type:"checkbox",checked:e.autoHeight,onClick:()=>{e.setAutoHeight(!e.autoHeight)}}]},{label:"Rendering mode",icon:b.A,subMenu:[{label:"Allele count",type:"radio",checked:"alleleCount"===e.renderingMode,onClick:()=>{e.setPhasedMode("alleleCount")}},{label:"Phased"+(e.hasPhased?"":" (disabled, no phased variants found)"),disabled:!e.hasPhased,checked:"phased"===e.renderingMode,type:"radio",onClick:()=>{e.setPhasedMode("phased")}}]},{label:"Reference mode",type:"subMenu",subMenu:[{label:"Fill background grey, skip reference allele mouseovers (helps with large overlapping SVs)",type:"radio",checked:"skip"===e.referenceDrawingMode,onClick:()=>{e.setReferenceDrawingMode("skip")}},{label:"Don't fill background grey, only draw actual reference alleles as grey",type:"radio",checked:"draw"===e.referenceDrawingMode,onClick:()=>{e.setReferenceDrawingMode("draw")}}]},{label:"Filter by",icon:f.A,subMenu:[{label:"Minor allele frequency",onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[k,{model:e,handleClose:t}])}},{label:"Edit filters",onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[T,{model:e,handleClose:t}])}}]},{label:"Cluster by genotype",icon:m.A,onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[A,{model:e,handleClose:t}])}},{label:"Edit group colors/arrangement...",onClick:()=>{(0,l.getSession)(e).queueDialog(t=>[C,{model:e,handleClose:t}])}}]}}).views(e=>({get canDisplayLabels(){return e.rowHeight>=8&&e.showSidebarLabelsSetting},get totalHeight(){return e.rowHeight*(e.sources?.length||1)},get featuresReady(){return!!e.featuresVolatile}})).views(e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.featuresReady,height:e.height,totalHeight:e.totalHeight,renderingMode:e.renderingMode,minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,lengthCutoffFilter:e.lengthCutoffFilter,rowHeight:e.rowHeight,sources:e.sources,scrollTop:e.scrollTop,referenceDrawingMode:e.referenceDrawingMode,filters:new h.A({filters:e.activeFilters})}}}))}const R=function(e){return s.types.compose("MultiLinearVariantDisplay",P(e),s.types.model({type:s.types.literal("MultiLinearVariantDisplay"),rowHeightSetting:s.types.optional(s.types.number,11),minorAlleleFrequencyFilter:s.types.optional(s.types.number,0)})).views(()=>({get rendererTypeName(){return"MultiVariantRenderer"}})).actions(e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const{getMultiVariantSourcesAutorun:t}=await n.e(9222).then(n.bind(n,9222)),{getMultiVariantFeaturesAutorun:r}=await n.e(2303).then(n.bind(n,12303));t(e),r(e)}catch(t){(0,s.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(r){const{renderSvg:a}=await n.e(8178).then(n.bind(n,88178));return a(e,r,t)}}})};var I=n(68446),L=n(73716),F=n(20195),N=n(9669),D=n(69500);const B=(0,I.observer)(function(e){const{model:t}=e,{lineZoneHeight:n}=t,r=(0,p.useRef)(null),[a,o]=(0,p.useState)(),[i,s]=(0,p.useState)();return(0,D.jsxs)("div",{ref:r,onMouseMove:e=>{const t=r.current?.getBoundingClientRect(),n=t?.top||0,a=t?.left||0;o(e.clientY-n),s(e.clientX-a)},onMouseLeave:()=>{o(void 0),s(void 0)},children:[(0,D.jsxs)("div",{style:{position:"relative"},children:[(0,D.jsx)(L.A,{model:t}),(0,D.jsxs)("div",{style:{position:"absolute",top:n},children:[(0,D.jsx)(N.A,{model:t}),(0,D.jsx)(d.GQ,{...e})]})]}),i&&a&&a>n?(0,D.jsx)(F.A,{mouseX:i,mouseY:a,model:t}):null]})}),j=B,V=(0,i.ConfigurationSchema)("LinearVariantMatrixRenderer",{},{explicitlyTyped:!0});function E(e){return(0,i.ConfigurationSchema)("LinearVariantMatrixDisplay",{renderer:V,height:{type:"number",defaultValue:250}},{baseConfiguration:(0,d.lw)(e),explicitlyTyped:!0})}function z(e){return s.types.compose("LinearVariantMatrixDisplay",P(e),s.types.model({type:s.types.literal("LinearVariantMatrixDisplay"),rowHeightSetting:s.types.optional(s.types.number,1),lineZoneHeight:20})).views(e=>({get nrow(){return e.sources?.length||1},get blockType(){return"dynamicBlocks"},get totalHeight(){return e.autoHeight?e.height-e.lineZoneHeight:this.nrow*e.rowHeightSetting},get rowHeight(){return e.autoHeight?e.totalHeight/this.nrow:e.rowHeightSetting},get featuresReady(){return!!e.featuresVolatile}})).views(e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.featuresReady,renderingMode:e.renderingMode,minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,lengthCutoffFilter:e.lengthCutoffFilter,height:e.totalHeight,sources:e.sources}},get canDisplayLabels(){return e.rowHeight>8&&e.showSidebarLabelsSetting}})).actions(e=>({setLineZoneHeight:t=>(e.lineZoneHeight=(0,l.clamp)(t,10,1e3),e.lineZoneHeight)})).actions(e=>{const{renderSvg:t}=e;return{setLineZoneHeight:t=>(e.lineZoneHeight=(0,l.clamp)(t,10,1e3),e.lineZoneHeight),afterAttach(){(async()=>{try{const{getMultiVariantSourcesAutorun:t}=await n.e(9222).then(n.bind(n,9222)),{getMultiVariantFeaturesAutorun:r}=await n.e(2303).then(n.bind(n,12303));t(e),r(e)}catch(t){(0,s.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(r){const{renderSvg:a}=await n.e(9875).then(n.bind(n,59875));return a(e,r,t)}}})}var O=n(98111);class H extends O.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:r,sources:a,regions:o,bpPerPx:i}=e,s=o[0],{end:c,start:d}=s,u=(c-d)/i,{makeImageData:p}=await n.e(2367).then(n.bind(n,22367)),{mafs:h,...g}=await(0,l.renderToAbstractCanvas)(u,r,e,n=>p({ctx:n,canvasWidth:u,canvasHeight:r,renderArgs:{...e,features:t,sources:a}}));return{...await super.render({...e,...g,features:t,height:r,width:u}),...g,features:new Map,simplifiedFeatures:h.map(({feature:e})=>new l.SimpleFeature({id:e.id(),data:{start:e.get("start"),end:e.get("end"),refName:e.get("refName")}})),height:r,width:u}}}var G=n(67112);const $=(0,I.observer)(function(e){const{arr:t,width:n,height:r,displayModel:a}=e,o=(0,p.useRef)(null);return(0,D.jsx)("div",{ref:o,onMouseMove:e=>{a.setHoveredGenotype(function(e,i){if(!o.current)return;const s=o.current.getBoundingClientRect(),l=e-s.left,c=i-s.top,d=t.length,u=t[0]?.length||0,p=a.sources[Math.floor(c/r*u)]?.name,h=t[Math.floor(l/n*d)]?.[Math.floor(c/r*u)];return h&&p?{name:p,genotype:h}:void 0}(e.clientX,e.clientY))},onMouseLeave:()=>{a.setHoveredGenotype(void 0)},onMouseOut:()=>{a.setHoveredGenotype(void 0)},style:{overflow:"visible",position:"relative",height:r},children:(0,D.jsx)(G.PrerenderedCanvas,{...e})})});var W=n(92880);class U extends W.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:r,referenceDrawingMode:a,regions:o,bpPerPx:i}=e,s=o[0],c=(s.end-s.start)/i,{makeImageData:d}=await n.e(9978).then(n.bind(n,99978)),u=await(0,l.renderToAbstractCanvas)(c,r,e,n=>("skip"===a&&(n.fillStyle="#ccc",n.fillRect(0,0,c,r)),d(n,{...e,features:t})));return{...await super.render({...e,...u,features:t,height:r,width:c}),...u,features:new Map,height:r,width:c,containsNoTransferables:!0}}}var _=n(65944),q=n(69566);const J=(0,I.observer)(function(e){const{flatbush:t,items:n,displayModel:r,featureGenotypeMap:a,totalHeight:o,scrollTop:i}=e,s=(0,p.useRef)(null),c=(0,p.useMemo)(()=>_.A.from(t),[t]);return(0,D.jsx)("div",{ref:s,onMouseMove:e=>r.setHoveredGenotype?.(function(e,t){let o=0,i=0;if(!s.current)return;const d=s.current.getBoundingClientRect();o=e-d.left,i=t-d.top-(r?.scrollTop||0);const u=c.search(o,i,o+1,i+1);if(u.length){const e=function(e,t){let n,r=1/0;for(const a of e){const e=t(a);e<r&&(r=e,n=a)}return n}(u,e=>n[e]?.bpLen??0),{bpLen:t,genotype:r,featureId:o,...i}=n[e]??{},s=void 0!==o?a[o]:void 0;if(s&&r){const{ref:e,alt:t,name:n,description:a,length:o}=s;return{...i,genotype:r,alleles:(0,q.Fm)(r,e,t),featureName:n,description:t.length>=3?"multiple ALT alleles":a,length:(0,l.getBpDisplayStr)(o)}}}}(e.clientX,e.clientY)),onMouseLeave:()=>{r.setHoveredGenotype?.(void 0)},onMouseOut:()=>{r.setHoveredGenotype?.(void 0)},style:{overflow:"visible",position:"relative",height:o},children:(0,D.jsx)(G.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:i}})})}),X=(0,i.ConfigurationSchema)("MultiVariantRenderer",{},{explicitlyTyped:!0});var Y=n(47369);const K=(0,i.ConfigurationSchema)("SplitVcfTabixAdapter",{vcfGzLocationMap:{type:"frozen",defaultValue:{}},indexLocationMap:{type:"frozen",defaultValue:{}},indexType:{type:"string",defaultValue:"TBI"},samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:'tsv with header like "name\tpopulation\tetc" where the first column is required, and corresponds to the sample names in the VCF files',locationType:"UriLocation"}}},{explicitlyTyped:!0});var Q=n(94318),Z=n(350);function ee(e,t){const n=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-n)/e.bpPerRadian+e.startRadians}const te=(0,I.observer)(function({feature:e,blocksForRefs:t,radius:n,config:r,bezierRadius:a,selected:o,onClick:s}){const[c,d]=(0,p.useState)(!1),u=t[e.get("refName")];if(!u)return null;let h,g,m;e.get("INFO")?[h]=e.get("INFO").SVTYPE||[]:e.get("mate")&&(h="mate");const f=e.get("ALT")?.[0],y=f&&(0,Z.h)(f),b=e.get("start");if(y){const e=y.MatePosition.split(":");g=+e[1],m=t[e[0]]}else if("<TRA>"===f){const n=e.get("INFO")?.CHR2?.[0],r=e.get("INFO")?.END?.[0];g=Number.parseInt(r,10),m=t[n]}else if("mate"===h){const n=e.get("mate"),r=n.refName;g=n.start,m=t[r]}else m=u,g=e.get("end");if(m){const t=ee(u,b),p=ee(m,g),h=(0,l.polarToCartesian)(n,t),f=(0,l.polarToCartesian)(n,p),y=(0,l.polarToCartesian)(a,(p+t)/2),w=o?(0,i.readConfObject)(r,"strokeColorSelected",{feature:e}):(0,i.readConfObject)(r,"strokeColor",{feature:e}),v=(0,i.readConfObject)(r,"strokeColorHover",{feature:e});return(0,D.jsx)("path",{"data-testid":`chord-${e.id()}`,cursor:"crosshair",fill:"none",d:["M",...h,"Q",...y,...f].join(" "),...(0,l.getStrokeProps)(c?v:w),strokeWidth:c?3:1,onClick:t=>{s(e,u.region,m.region,t)},onMouseOver:()=>{o||d(!0)},onMouseOut:()=>{o||d(!1)}})}return null}),ne=(0,I.observer)(function({features:e,config:t,blockDefinitions:n,radius:r,bezierRadius:a,displayModel:o,onChordClick:i}){const{selectedFeatureId:s}=o||{},l=(0,p.useMemo)(()=>{const e={};for(const t of n){const n=t.region.elided?t.region.regions:[t.region];for(const r of n)e[r.refName]=t}return e},[n]);return(0,D.jsx)("g",{"data-testid":"structuralVariantChordRenderer",children:[...e.values()].map(e=>{const n=e.id(),o=s===n;return(0,D.jsx)(te,{feature:e,config:t,radius:r,bezierRadius:a,blocksForRefs:l,selected:o,onClick:i},n)})})}),re=(0,i.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});var ae=n(67736);const oe=(0,i.ConfigurationSchema)("VariantFeatureWidget",{});var ie=n(9342);function se(e){const t=(0,ie.n)(e);return s.types.compose(t,s.types.model("VariantFeatureWidget",{type:s.types.literal("VariantFeatureWidget"),descriptions:s.types.frozen()}))}var le=n(14129),ce=n(53996),de=n(3496),ue=n(44728),pe=n(82088),he=n(85497);async function ge({pluginManager:e,args:t}){const{sources:n,minorAlleleFrequencyFilter:r,regions:a,adapterConfig:o,sessionId:i,lengthCutoffFilter:s,stopToken:c}=t,d=(await(0,de.cK)(e,i,o)).dataAdapter,u=new Set,p=(0,he.Cg)({minorAlleleFrequencyFilter:r,lengthCutoffFilter:s,stopToken:c,features:await(0,ue._)(d.getFeaturesInMultipleRegions(a,t).pipe((0,pe.$)()))});for(const{alleleCounts:e}of p)for(const t of Object.keys(e))u.add(t);const h={},g={};return(0,l.forEachWithStopTokenCheck)(p,c,({feature:e})=>{const t=e.get("genotypes");for(const{name:e}of n){h[e]||(h[e]=[]);const n=t[e];let r;g[n]?r=g[n]:(r=n.split(/[/|]/),g[n]=r);let a=0,o=0,i=0;for(const e of r)"."===e?i++:"0"!==e&&o++;a=i===r.length?-1:0===o?0:o===r.length?2:1,h[e].push(a)}}),h}class me extends le.A{name="MultiVariantClusterGenotypeMatrix";async execute(e,t){const n=await this.deserializeArguments(e,t),r=await ge({pluginManager:this.pluginManager,args:n});return(0,ce.DV)({data:Object.values(r),stopToken:n.stopToken,onProgress:e=>{n.statusCallback(e)}})}}class fe extends le.A{name="MultiVariantGetGenotypeMatrix";async execute(e,t){return ge({pluginManager:this.pluginManager,args:await this.deserializeArguments(e,t)})}}class ye extends le.A{name="MultiVariantGetSimplifiedFeatures";async execute(e,t){const n=await this.deserializeArguments(e,t),{lengthCutoffFilter:r,minorAlleleFrequencyFilter:a,regions:o,adapterConfig:i,stopToken:s,sessionId:c}=n,{dataAdapter:d}=await(0,de.cK)(this.pluginManager,c,i),u=(0,he.Cg)({minorAlleleFrequencyFilter:a,lengthCutoffFilter:r,stopToken:s,features:await(0,ue._)(d.getFeaturesInMultipleRegions(o,n).pipe((0,pe.$)()))}),p={};let h=!1;return(0,l.forEachWithStopTokenCheck)(u,s,({feature:e})=>{const t=e.get("genotypes");for(const[e,n]of Object.entries(t)){const t=n.includes("|");h||=t,p[e]={maxPloidy:Math.max(p[e]?.maxPloidy||0,n.split("|").length),isPhased:p[e]?.isPhased||t}}}),{hasPhased:h,sampleInfo:p,features:u.map(({feature:e})=>({id:e.id(),data:{start:e.get("start"),end:e.get("end"),refName:e.get("refName"),name:e.get("name")}}))}}}class be extends le.A{name="MultiVariantGetSources";async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:a,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,de.cK)(n,i,o);return s.getSources(a,r)}}var we=n(58273),ve=n(1622),Se=n(58921);const xe=(0,i.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}},samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:"tsv with header like name\tpopulation\tetc. where the first column is required, and is the sample names",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,vcfLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Ce=(0,i.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("VcfIndex",{indexType:{model:s.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}}),samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:"tsv with header like name\tpopulation\tetc. where the first column is required, and is the sample names",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,vcfGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});var ke=n(95600);class Te extends r.A{name="VariantsPlugin";install(e){var t;!function(e){e.addAdapterType(()=>new Y.A({name:"VcfAdapter",displayName:"VCF adapter",configSchema:xe,getAdapterClass:()=>Promise.all([n.e(2598),n.e(5247)]).then(n.bind(n,75247)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new Y.A({name:"VcfTabixAdapter",displayName:"VCF tabix adapter",configSchema:Ce,getAdapterClass:()=>Promise.all([n.e(3085),n.e(6621)]).then(n.bind(n,66621)).then(e=>e.default)}))}(e),function(e){e.addAdapterType(()=>new Y.A({name:"SplitVcfTabixAdapter",displayName:"VCF tabix adapter (split across multiple files)",configSchema:K,getAdapterClass:()=>Promise.all([n.e(3085),n.e(5472)]).then(n.bind(n,85472)).then(e=>e.default)}))}(e),function(e){e.addWidgetType(()=>new ae.A({name:"VariantFeatureWidget",heading:"Feature details",configSchema:oe,stateModel:se(e),ReactComponent:(0,p.lazy)(()=>Promise.all([n.e(6133),n.e(2407),n.e(3435),n.e(6386),n.e(1475),n.e(5300),n.e(4006)]).then(n.bind(n,74006)))}))}(e),(t=e).addTrackType(()=>{const e=(n=t,(0,i.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:(0,Se.createBaseTrackConfig)(n)}));var n;return new we.A({name:"VariantTrack",displayName:"Variant track",configSchema:e,stateModel:(0,ve.createBaseTrackModel)(t,"VariantTrack",e)})}),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",e=>(t,n,r)=>{const a=(0,c.getFileName)(t),o=n&&(0,c.getFileName)(n);return(0,l.testAdapter)(a,/\.vcf\.b?gz$/i,r,"VcfTabixAdapter")?{type:"VcfTabixAdapter",vcfGzLocation:t,index:{location:n||(0,c.makeIndex)(t,".tbi"),indexType:(0,c.makeIndexType)(o,"CSI","TBI")}}:(0,l.testAdapter)(a,/\.vcf(\.gz)?$/i,r,"VcfAdapter")?{type:"VcfAdapter",vcfLocation:t}:e(t,n,r)}),e.addToExtensionPoint("Core-guessTrackTypeForLocation",e=>t=>["VcfTabixAdapter","VcfAdapter"].includes(t)?"VariantTrack":e(t))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:(0,d.lw)(e),explicitlyTyped:!0})}(e);return new a.A({name:"LinearVariantDisplay",displayName:"Variant display",configSchema:t,stateModel:u(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:d.GQ})})}(e),function(e){e.addDisplayType(()=>{const t=E(e);return new a.A({name:"LinearVariantMatrixDisplay",displayName:"Multi-sample variant display (matrix)",configSchema:t,stateModel:z(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:j})})}(e),function(e){e.addDisplayType(()=>{const t=function(e){const t=e.getRendererType("MultiVariantRenderer").configSchema;return(0,i.ConfigurationSchema)("MultiLinearVariantDisplay",{defaultRendering:{type:"stringEnum",model:s.types.enumeration("Rendering",["multivariant"]),defaultValue:"multivariant"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{MultiVariantRenderer:t}),height:{type:"number",defaultValue:200}},{baseConfiguration:(0,i.ConfigurationSchema)("SharedVariantDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:s.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:s.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:d.Ki,explicitlyTyped:!0}),explicitlyTyped:!0})}(e);return new a.A({name:"MultiLinearVariantDisplay",displayName:"Multi-sample variant display (regular)",configSchema:t,stateModel:R(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,p.lazy)(()=>n.e(4699).then(n.bind(n,94699)))})})}(e),function(e){e.addRendererType(()=>new U({name:"MultiVariantRenderer",ReactComponent:J,configSchema:X,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new H({name:"LinearVariantMatrixRenderer",displayName:"Linear variant matrix renderer",ReactComponent:$,configSchema:V,pluginManager:e}))}(e),function(e){e.addRendererType(()=>new Q.A({name:"StructuralVariantChordRenderer",displayName:"SV chord renderer",ReactComponent:ne,configSchema:re,pluginManager:e}))}(e),function(e){e.addDisplayType(()=>{const t=function(e){return(0,i.ConfigurationSchema)("ChordVariantDisplay",{renderer:s.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:o.kO,explicitlyTyped:!0})}(e),n=(e=>s.types.compose("ChordVariantDisplay",o.dg,s.types.model({type:s.types.literal("ChordVariantDisplay"),configuration:(0,i.ConfigurationReference)(e)})).views(e=>({get rendererTypeName(){return e.configuration.renderer.type},renderProps(){const t=(0,l.getContainingView)(e);return{...(0,c.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:e.blockDefinitions,config:e.configuration.renderer,onChordClick:t=>{e.onChordClick(t)}}}})))(t);return new a.A({name:"ChordVariantDisplay",displayName:"Chord variant display",configSchema:t,stateModel:n,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:o.DO})})}(e),e.addRpcMethod(()=>new be(e)),e.addRpcMethod(()=>new fe(e)),e.addRpcMethod(()=>new me(e)),e.addRpcMethod(()=>new ye(e))}}},50574:(e,t,n)=>{n.d(t,{Jf:()=>o,Pn:()=>i,S5:()=>s});var r=n(8656),a=n(99546);async function o({queryString:e,searchType:t,searchScope:n,rankSearchResults:o,textSearchManager:i,assembly:s}){i||console.warn("No text search manager");const l=await(i?.search({queryString:e,searchType:t},n,o))||[],c=s?.allRefNames?.filter(t=>t.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(e=>new r.A({label:e}))||[];return(0,a.dedupe)([...c,...l],e=>e.getId())}function i(e,t){return e.clientX-(t?.getBoundingClientRect().left||0)}function s(e,t){return e?.cytobands?.map(t=>({refName:e.getCanonicalRefName(t.get("refName"))||t.get("refName"),start:t.get("start"),end:t.get("end"),type:t.get("gieStain"),name:t.get("name")})).filter(e=>e.refName===t)||[]}},52119:(e,t,n)=>{n.d(t,{A:()=>w,s:()=>v});var r=n(68584),a=n(99546),o=n(37347),i=n(91468),s=n(92516),l=n(36422),c=n(7552),d=n(68446),u=n(67112),p=n(75785),h=n(69500);const g=(0,p.n9)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}}),m=(0,d.observer)(function({model:e}){const{classes:t}=g(),{status:n}=e,{message:r}=(0,l.getParent)(e,2),a=r||n;return(0,h.jsx)("div",{className:t.loading,children:(0,h.jsx)(u.LoadingEllipses,{message:a})})});var f=n(37205);const y=(0,c.lazy)(()=>Promise.all([n.e(1631),n.e(6839)]).then(n.bind(n,46839))),b=(0,d.observer)(function({model:e}){return e.error?(0,h.jsx)(c.Suspense,{fallback:null,children:(0,h.jsx)(y,{model:e})}):e.message?(0,c.isValidElement)(e.message)?e.message:(0,h.jsx)(f.A,{message:`${e.message}`,severity:"info"}):e.filled?e.reactElement:(0,h.jsx)(m,{model:e})}),w=l.types.model("BlockState",{key:l.types.string,region:l.types.frozen(),reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile(()=>({stopToken:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:b,renderProps:void 0})).actions(e=>({doReload(){e.reloadFlag=e.reloadFlag+1},afterAttach(){const t=(0,a.getContainingDisplay)(e);setTimeout(()=>{(0,l.isAlive)(e)&&(0,a.makeAbortableReaction)(e,v,S,{name:`${t.id}/${(0,a.assembleLocString)(e.region)} rendering`,delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},t.renderDelay)},setStatus(t){e.status=t},setLoading(t){void 0!==e.stopToken&&(0,o.CF)(e.stopToken),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,e.stopToken=t},setMessage(t){void 0!==e.stopToken&&(0,o.CF)(e.stopToken),e.filled=!1,e.message=t,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,e.stopToken=void 0},setRendered(t){if(!t)return;const{reactElement:n,features:r,layout:a,maxHeightReached:o,renderProps:i}=t;e.filled=!0,e.message=void 0,e.reactElement=n,e.features=r,e.layout=a,e.error=void 0,e.maxHeightReached=o,e.renderProps=i,e.stopToken=void 0},setError(t){console.error(t),void 0!==e.stopToken&&(0,o.CF)(e.stopToken),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=t,e.renderProps=void 0,e.stopToken=void 0,(0,s.yH)(t)&&this.reload()},reload(){e.stopToken=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=b,e.renderProps=void 0,(0,l.getParent)(e,2).reload()},beforeDestroy(){(async()=>{try{void 0!==e.stopToken&&(0,o.CF)(e.stopToken);const t=(0,a.getContainingDisplay)(e),{rpcManager:n}=(0,a.getSession)(e),{rendererType:r}=t,{renderArgs:i}=v((0,l.cast)(e));i&&await r.freeResourcesInClient(n,JSON.parse(JSON.stringify(i)))}catch(e){console.error("Error while destroying block",e)}})()}}));function v(e,t){try{const n=t||(0,a.getContainingDisplay)(e),{assemblyManager:o,rpcManager:s}=(0,a.getSession)(n),{adapterConfig:c,rendererType:d,error:u,parentTrack:p}=n,h=(0,i.getTrackAssemblyNames)(p),g=e.region.assemblyName;if(!h.includes(g)&&!h.some(e=>o.get(e)?.hasName(g)))throw new Error(`region assembly (${g}) does not match track assemblies (${h})`);const m=n.renderProps(),{config:f}=m;(0,r.readConfObject)(f);const y=(0,i.getRpcSessionId)(n),b=(0,a.getContainingTrack)(n).id;return{rendererType:d,rpcManager:s,renderProps:m,cannotBeRenderedReason:n.regionCannotBeRendered(e.region),displayError:u,renderArgs:{statusCallback:t=>{(0,l.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:c,rendererType:d.name,sessionId:y,layoutId:b,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(e){return{displayError:e}}}async function S(e,t,n){if(!e)return;const{rendererType:r,renderProps:o,rpcManager:i,renderArgs:s,cannotBeRenderedReason:c,displayError:d}=e;if((0,l.isAlive)(n)){if(d)return void n.setError(d);if(c)return void n.setMessage(c);if(o.notReady)return;{const{reactElement:e,features:l,layout:c,maxHeightReached:d}=await r.renderInClient(i,{...s,...o,viewParams:(0,a.getViewParams)(n),stopToken:t});return{reactElement:e,features:l,layout:c,maxHeightReached:d,renderProps:o}}}}},53085:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(26400),a=n.n(r);function o(){const e=new(a().Jexl);return e.addFunction("get",(e,t)=>e.get(t)),e.addFunction("parent",e=>e.parent()),e.addFunction("id",e=>e.id()),e.addFunction("cast",e=>e),e.addFunction("log",e=>(console.log(e),e)),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",(e,t)=>e.split(t)),e.addFunction("join",(e,...t)=>[...t].filter(e=>!!e).join(e)),e.addFunction("charAt",(e,t)=>e.charAt(t)),e.addFunction("charCodeAt",(e,t)=>e.charCodeAt(t)),e.addFunction("codePointAt",(e,t)=>e.codePointAt(t)),e.addFunction("startsWith",(e,t,n)=>e.startsWith(t,n)),e.addFunction("endsWith",(e,t,n)=>e.endsWith(t,n)),e.addFunction("padEnd",(e,t,n)=>e.padEnd(t,n)),e.addFunction("padStart",(e,t,n)=>e.padStart(t,n)),e.addFunction("repeat",(e,t)=>e.repeat(t)),e.addFunction("replace",(e,t,n)=>e.replace(t,n)),e.addFunction("replaceAll",(e,t,n)=>e.replaceAll(t,n)),e.addFunction("slice",(e,t,n)=>e.slice(t,n)),e.addFunction("startsWith",(e,t,n)=>e.startsWith(t,n)),e.addFunction("substring",(e,t,n)=>e.substring(t,n)),e.addFunction("toLowerCase",e=>e.toLowerCase()),e.addFunction("toUpperCase",e=>e.toUpperCase()),e.addFunction("jsonParse",e=>JSON.parse(e)),e.addFunction("trim",e=>e.trim()),e.addFunction("trimEnd",e=>e.trimEnd()),e.addFunction("trimStart",e=>e.trimStart()),e.addFunction("getTag",(e,t)=>{const n=e.get("tags");return n?n[t]:e.get(t)}),e.addBinaryOp("&",15,(e,t)=>e&t),e}},53996:(e,t,n)=>{n.d(t,{DV:()=>s});var r=n(37347);function a(e){return Number.parseFloat((100*e).toFixed(1))}function o(e,t){const n=Math.min(e.length,t.length);let r=0;for(let a=0;a<n;a++)r+=(e[a]-t[a])*(e[a]-t[a]);return Math.sqrt(r)}function i(e,t,n){let r=0;const a=e.length,o=t.length;for(let i=0;i<a;i++)for(let a=0;a<o;a++)r+=n[e[i]][t[a]];return r/e.length/t.length}function s({data:e,distance:t=o,linkage:n=i,onProgress:s,stopToken:l}){let c=performance.now(),d=performance.now();const u=[];for(let n=0;n<e.length;n++){const o=performance.now();o-c>400&&((0,r.SW)(l),c=performance.now()),o-d>50&&(s?.(`Making distance matrix: ${a(n/(e.length-1))}%`),d=performance.now());const i=[];for(let r=0;r<e.length;r++)i.push(t(e[n],e[r]));u.push(i)}const p=e.map((e,t)=>({height:0,indexes:[t]}));let h=[];c=performance.now(),d=performance.now();for(let t=0;t<e.length;t++){const o=performance.now();if(o-c>400&&((0,r.SW)(l),c=performance.now()),o-d>50&&(s?.(`Clustering: ${a((t+1)/e.length)}%`),d=performance.now()),h.push(p.map(e=>e.indexes)),t>=e.length-1)break;let i=1/0,g=0,m=0;for(let e=0;e<p.length;e++)for(let t=e+1;t<p.length;t++){const r=n(p[e].indexes,p[t].indexes,u);r<i&&(i=r,g=e,m=t)}const f={indexes:[...p[g].indexes,...p[m].indexes],height:i,children:[p[g],p[m]]};p.splice(Math.max(g,m),1),p.splice(Math.min(g,m),1),p.push(f)}return h=[[],...h.reverse()],{clusters:p[0],distances:u,order:p[0].indexes,clustersGivenK:h}}},56133:(e,t,n)=>{n.d(t,{I:()=>s});var r=n(42489),a=n(36422),o=n(20166),i=n(37347);function s(e,t,n,s,l,c,d){let u;function p(t){(0,o.Kp)(t)||(console.error(t),(0,a.isAlive)(e)&&d(t))}(0,a.addDisposer)(e,(0,r.reaction)(()=>{try{return t(e)}catch(e){return void p(e)}},async(t,r)=>{if(u&&(0,i.CF)(u),(0,a.isAlive)(e)){u=(0,i.y5)(),l(u);try{const o=await n(t,u,e,r);(0,a.isAlive)(e)&&c(o)}catch(e){p(e)}}},s)),(0,a.addDisposer)(e,()=>{u&&(0,i.CF)(u)})}},56328:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.subDisplay=e.subDisplay,this.configSchema=e.configSchema,this.ReactComponent=e.ReactComponent,this.trackType=e.trackType,this.viewType=e.viewType}}},57027:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(44728),a=n(27570),o=n(82088),i=n(198),s=n(3496),l=n(99546);class c extends i.default{async renameRegionsIfNeeded(e){return e}serializeArgsInClient(e){const t={...e,displayModel:void 0};return super.serializeArgsInClient(t)}deserializeResultsInClient(e,t){return{...super.deserializeResultsInClient(e,t),blockKey:t.blockKey}}async renderInClient(e,t){const n=await e.call(t.sessionId,"ComparativeRender",t);return"canvasRecordedData"in n&&(n.html=await(0,l.getSerializedSvg)(n),n.reactElement=void 0),n}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async getFeatures(e){const t=this.pluginManager,{regions:n,sessionId:i,adapterConfig:c}=e,{dataAdapter:d}=await(0,s.cK)(t,i,c),u=n.map(e=>{const t={...e};return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t}),p=await(0,r._)(d.getFeaturesInMultipleRegions(u,e).pipe((0,a.p)(t=>this.featurePassesFilters(e,t)),(0,o.$)()));return(0,l.dedupe)(p,e=>e.id())}}},57240:(e,t,n)=>{n.d(t,{R:()=>r,y:()=>a});const r={m:{color:"rgb(255,0,0)",name:"5mC"},h:{color:"rgb(255,0,255)",name:"5hmC"},o:{color:"rgb(111, 78, 129)",name:"8oxoG"},f:{color:"rgb(246, 200, 95)",name:"5fC"},c:{color:"rgb(157, 216, 102)",name:"5cac"},g:{color:"rgb(255, 160, 86)",name:"5hmu"},e:{color:"rgb(141, 221, 208)",name:"5fU"},b:{color:"rgb(0,100,47)",name:"5caU"},a:{color:"rgb(51,0,111)",name:"6mA"},17082:{color:"rgb(51,153,255)",name:"pseU"},17596:{color:"rgb(102,153,0)",name:"inosine"},21839:{color:"rgb(153,0,153)",name:"4mC"}};function a(e){return r[e]?.name||e}},57266:(e,t,n)=>{n.r(t),n.d(t,{Tooltip:()=>i.A,default:()=>u});var r=n(67758),a=n(7552),o=n(68446),i=n(88262),s=n(75429),l=n(69500);const c=e=>e.toLocaleString("en-US"),d=(0,a.forwardRef)(function(e,t){const n=(0,r.c)(17),{feature:a}=e,o=a.get("start")+1;let i,d,u,h;if(n[0]!==a||n[1]!==o){const e=a.get("end");let t;n[5]!==a?(t=a.get("refName"),n[5]=a,n[6]=t):t=n[6];const r=t;let s;n[7]!==a?(s=a.get("name"),n[7]=a,n[8]=s):s=n[8],i=r,d=s,u=o===e?c(o):`${c(o)}..${c(e)}`,n[0]=a,n[1]=o,n[2]=i,n[3]=d,n[4]=u}else i=n[2],d=n[3],u=n[4];n[9]!==i||n[10]!==d||n[11]!==u?(h=[i,d,u].filter(p),n[9]=i,n[10]=d,n[11]=u,n[12]=h):h=n[12];const g=h.join(":");let m;return n[13]!==a||n[14]!==g||n[15]!==t?(m=void 0!==a.get("summary")?(0,l.jsxs)("div",{ref:t,children:[g,(0,l.jsx)("br",{}),"Max: ",(0,s.toP)(a.get("maxScore")),(0,l.jsx)("br",{}),"Avg: ",(0,s.toP)(a.get("score")),(0,l.jsx)("br",{}),"Min: ",(0,s.toP)(a.get("minScore"))]}):(0,l.jsxs)("div",{ref:t,children:[g,(0,l.jsx)("br",{}),`${(0,s.toP)(a.get("score"))}`]}),n[13]=a,n[14]=g,n[15]=t,n[16]=m):m=n[16],m}),u=(0,o.observer)(function(e){return(0,l.jsx)(i.A,{TooltipContents:d,...e})});function p(e){return!!e}},57468:(e,t,n)=>{n.d(t,{t:()=>o});var r=n(7552),a=n(69500);class o extends r.Component{constructor(e){super(e),this.state={error:void 0}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e})}render(){return this.state.error?(0,a.jsx)(this.props.FallbackComponent,{error:this.state.error}):this.props.children}}},58273:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{displayTypes=[];constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}addDisplayType(e){this.displayTypes.push(e)}}},58921:(e,t,n)=>{n.r(t),n.d(t,{AdapterType:()=>u.A,AddTrackWorkflowType:()=>w.A,BaseConnectionModelFactory:()=>d.BaseConnectionModelFactory,BaseDisplay:()=>d.BaseDisplay,BaseInternetAccountConfig:()=>d.BaseInternetAccountConfig,BaseViewModel:()=>d.BaseViewModel,BoxRendererType:()=>r.default,CircularChordRendererType:()=>o.A,ComparativeServerSideRendererType:()=>a.A,ConnectionType:()=>p.A,DisplayType:()=>f.A,FeatureRendererType:()=>s.default,InternetAccount:()=>d.InternetAccount,InternetAccountType:()=>y.A,RendererType:()=>i.default,RpcMethodType:()=>b.A,ServerSideRenderedContent:()=>l.A,ServerSideRendererType:()=>c.default,TextSearchAdapterType:()=>v.A,TrackType:()=>h.A,ViewType:()=>m.A,WidgetType:()=>g.A,baseConnectionConfig:()=>d.baseConnectionConfig,createBaseTrackConfig:()=>d.createBaseTrackConfig,createBaseTrackModel:()=>d.createBaseTrackModel});var r=n(98111),a=n(57027),o=n(94318),i=n(95742),s=n(92880),l=n(25889),c=n(198),d=n(1622),u=n(47369),p=n(91612),h=n(58273),g=n(67736),m=n(63589),f=n(56328),y=n(92070),b=n(2406),w=n(32767),v=n(8024)},59099:(e,t,n)=>{n.d(t,{S:()=>v,A:()=>S});var r=n(7552),a=n(12678),o=n(68584),i=n(58921),s=n(68446),l=n(36422),c=n(69500);const d=(0,s.observer)(function({model:e}){if(e?.target){if(e.target.type)return`${e.target.type} settings`;if((0,l.isStateTreeNode)(e.target)){const t=(0,l.getType)(e.target);if(t.name)return`${t.name.replace("ConfigurationSchema","")} settings`}}return(0,c.jsx)(c.Fragment,{children:"Settings"})});var u=n(8832);function p(e){return l.types.model("ConfigurationEditorWidget",{id:u.ElementId,type:l.types.literal("ConfigurationEditorWidget"),target:l.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions(e=>({setTarget(t){e.target=t}}))}const h=(0,o.ConfigurationSchema)("ConfigurationEditorWidget",{}),g=(0,r.lazy)(()=>Promise.all([n.e(6386),n.e(6511),n.e(6395),n.e(7874)]).then(n.bind(n,57874))),m=(0,o.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),f=(0,o.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),y=(0,o.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),b=(0,o.ConfigurationSchema)("NcbiSequenceReportAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/sequence_report.tsv",locationType:"UriLocation"}},useNameOverride:{type:"boolean",defaultValue:!0,description:"forces usage of the UCSC names over the NCBI style names from a FASTA"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,location:{uri:e.uri,baseUri:e.baseUri}}:e}),w=(0,o.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0},refNameColumnHeaderName:{type:"string",description:"alternative to refNameColumn, instead looks at header (starts with # and finds column name)",defaultValue:""}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,location:{uri:e.uri,baseUri:e.baseUri}}:e}),v=(0,r.lazy)(()=>Promise.all([n.e(6386),n.e(6511),n.e(6395),n.e(7874)]).then(n.bind(n,57874)));class S extends a.A{name="ConfigurationPlugin";install(e){!function(e){e.addAdapterType(()=>new i.AdapterType({name:"FromConfigAdapter",configSchema:m,getAdapterClass:()=>n.e(6833).then(n.bind(n,86833)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addAdapterType(()=>new i.AdapterType({name:"FromConfigRegionsAdapter",configSchema:f,getAdapterClass:()=>n.e(491).then(n.bind(n,80491)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addAdapterType(()=>new i.AdapterType({name:"FromConfigSequenceAdapter",configSchema:y,getAdapterClass:()=>n.e(7013).then(n.bind(n,97013)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addAdapterType(()=>new i.AdapterType({name:"RefNameAliasAdapter",configSchema:w,getAdapterClass:()=>n.e(2249).then(n.bind(n,92249)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e),function(e){e.addWidgetType(()=>new i.WidgetType({name:"ConfigurationEditorWidget",HeadingComponent:d,configSchema:h,stateModel:p(e),ReactComponent:g}))}(e),function(e){e.addAdapterType(()=>new i.AdapterType({name:"NcbiSequenceReportAliasAdapter",configSchema:b,getAdapterClass:()=>n.e(3175).then(n.bind(n,43175)).then(e=>e.default),adapterMetadata:{hiddenFromGUI:!0}}))}(e)}}},62367:(e,t,n)=>{n.d(t,{A:()=>m});var r=n(7552),a=n(68584),o=n(58921),i=n(99546),s=n(91468),l=n(8832),c=n(35068),d=n.n(c),u=n(36422);function p(e=""){try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function h(e){return u.types.model("AddTrackModel",{id:l.ElementId,type:u.types.literal("AddTrackWidget"),view:u.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile(()=>({trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0,mixinData:{}})).actions(e=>({setMixinData(t){e.mixinData=t},setAdapterHint(t){e.adapterHint=t},setTrackSource(t){e.trackSource=t},setTextIndexingConf(t){e.textIndexingConf=t},setTextIndexTrack(t){e.textIndexTrack=t},setTrackData(t){e.trackData=t,e.adapterHint=""},setIndexTrackData(t){e.indexTrackData=t},setAssembly(t){e.altAssemblyName=t},setTrackName(t){e.altTrackName=t},setTrackType(t){e.altTrackType=t},clearData(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0,e.textIndexingConf=void 0,e.textIndexTrack=!0}})).views(e=>({get trackAdapter(){const{trackData:t,indexTrackData:n,adapterHint:r}=e;return t?(0,s.guessAdapter)(t,n,r,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,s.getFileName)(e.trackData):"")},get isFtp(){const{trackData:t,indexTrackData:n}=e;return!(!n?.uri?.startsWith("ftp://")&&!t?.uri?.startsWith("ftp://"))},get isRelativeTrackUrl(){const t=e.trackData?.uri;return!!t&&!p(t)},get isRelativeIndexUrl(){const t=e.indexTrackData?.uri;return!!t&&!p(t)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){return e.trackData?.uri?.startsWith("http://")},get indexHttp(){return e.indexTrackData?.uri?.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){return this.trackAdapter?.type===s.UNSUPPORTED},get assembly(){return e.altAssemblyName||e.view.assemblyNames?.[0]},get trackAdapterType(){return this.trackAdapter?.type},get trackType(){return e.altTrackType||(this.trackAdapterType?(0,s.guessTrackType)(this.trackAdapterType,e):"")}})).views(e=>({getTrackConfig(t){const n=(0,i.getSession)(e),r=n.assemblyManager.get(e.assembly);return r&&e.trackAdapter&&"UNKNOWN"!==e.trackAdapter.type?d()({trackId:[`${e.trackName.toLowerCase().replaceAll(" ","_")}-${t}`,n.adminMode?"":"-sessionTrack"].join(""),type:e.trackType,name:e.trackName,assemblyNames:[e.assembly],adapter:{...e.trackAdapter,sequenceAdapter:(0,a.getConf)(r,["sequence","adapter"])}},e.mixinData):void 0},get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}}))}const g=(0,a.ConfigurationSchema)("AddTrackWidget",{});function m(e){e.addWidgetType(()=>new o.WidgetType({name:"AddTrackWidget",heading:"Add a track",configSchema:g,stateModel:h(e),ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(9721),n.e(4850),n.e(2724)]).then(n.bind(n,72724)))}))}},63589:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{displayTypes=[];viewMetadata={};constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.viewMetadata=e.viewMetadata||{},this.stateModel=e.stateModel,this.extendedName=e.extendedName}addDisplayType(e){this.displayTypes.push(e)}}},65193:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ae});var r=n(7552),a=n(67112),o=n(68446),i=n(99546),s=n(95054),l=n(75785),c=n(57468),d=n(36422),u=n(67758),p=n(42752),h=n(27703),g=n(69500);const m=(0,l.n9)()(e=>({verticalGuidesZoomContainer:{position:"absolute",top:0,height:"100%",width:"100%",pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.action.disabled},minorTick:{background:e.palette.divider}}));function f(e){const t=(0,u.c)(18),{block:n,bpPerPx:r}=e,{classes:a,cx:o}=m();let i,s,l,c;if(t[0]!==n||t[1]!==r||t[2]!==a||t[3]!==o){const e=(0,h.H2)(n.start,n.end,r);let c;i=p.$G,s=n,t[7]!==n.end||t[8]!==n.reversed||t[9]!==n.start||t[10]!==r||t[11]!==a||t[12]!==o?(c=e=>{const{type:t,base:i}=e,s=(n.reversed?n.end-i:i-n.start)/r;return(0,g.jsx)("div",{className:o(a.tick,"major"===t||"labeledMajor"===t?a.majorTick:a.minorTick),style:{left:s}},i)},t[7]=n.end,t[8]=n.reversed,t[9]=n.start,t[10]=r,t[11]=a,t[12]=o,t[13]=c):c=t[13],l=e.map(c),t[0]=n,t[1]=r,t[2]=a,t[3]=o,t[4]=i,t[5]=s,t[6]=l}else i=t[4],s=t[5],l=t[6];return t[14]!==i||t[15]!==s||t[16]!==l?(c=(0,g.jsx)(i,{block:s,children:l}),t[14]=i,t[15]=s,t[16]=l,t[17]=c):c=t[17],c}const y=(0,o.observer)(({model:e})=>{const{staticBlocks:t,bpPerPx:n}=e;return(0,g.jsx)(g.Fragment,{children:t.map((e,t)=>{const r=`${e.key}-${t}`;return"ContentBlock"===e.type?(0,g.jsx)(f,{block:e,bpPerPx:n},r):"ElidedBlock"===e.type?(0,g.jsx)(p.Db,{width:e.widthPx},r):"InterRegionPaddingBlock"===e.type?(0,g.jsx)(p.fK,{width:e.widthPx,boundary:"boundary"===e.variant},r):null})})}),b=(0,o.observer)(function({model:e,offset:t=0}){const{classes:n}=m(),r=e.staticBlocks.offsetPx-e.offsetPx;return(0,g.jsx)("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==e.scaleFactor?`scaleX(${e.scaleFactor})`:void 0},children:(0,g.jsx)("div",{className:n.verticalGuidesContainer,style:{left:r-t,width:e.staticBlocks.totalWidthPx},children:(0,g.jsx)(y,{model:e})})})});var w=n(68584),v=n(91468),S=n(84340),x=n(62266),C=n(89870),k=n(61282),T=n(67555);const A=(0,l.n9)()({dragHandle:{cursor:"grab"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"}}),M=function(e){const t=(0,u.c)(13),{trackId:n,view:r,track:a}=e,{classes:o}=A();let i,s;t[0]!==a||t[1]!==r?(i=e=>{const t=e.currentTarget;if(t.parentNode){const n=t.parentNode;e.dataTransfer.setDragImage(n,20,20),r.setDraggingTrackId(a.id)}},t[0]=a,t[1]=r,t[2]=i):i=t[2],t[3]!==r?(s=()=>{r.setDraggingTrackId(void 0)},t[3]=r,t[4]=s):s=t[4];const l=`dragHandle-${r.id}-${n}`;let c,d;return t[5]!==o.dragHandleIcon?(c=(0,g.jsx)(T.A,{className:o.dragHandleIcon,fontSize:"small"}),t[5]=o.dragHandleIcon,t[6]=c):c=t[6],t[7]!==o.dragHandle||t[8]!==i||t[9]!==s||t[10]!==l||t[11]!==c?(d=(0,g.jsx)("span",{draggable:!0,className:o.dragHandle,onDragStart:i,onDragEnd:s,"data-testid":l,children:c}),t[7]=o.dragHandle,t[8]=i,t[9]=s,t[10]=l,t[11]=c,t[12]=d):d=t[12],d};var P=n(23758),R=n(18423),I=n(5986),L=n(85179),F=n(85161),N=n(11496),D=n(71098),B=n(2020),j=n(80255);const V=(0,o.observer)(function({track:e}){const t=(0,i.getContainingView)(e),n=(0,i.getSession)(e),r=e.configuration,a=e.minimized,o=e.pinned,{isTopLevelView:s}=t,l=[...s?[{label:o?"Unpin track":"Pin track",icon:j.A,onClick:()=>{e.setPinned(!o)}}]:[],{label:"Track order",type:"subMenu",priority:2e3,subMenu:[{label:a?"Restore track":"Minimize track",icon:a?R.A:D.A,onClick:()=>{e.setMinimized(!a)}},...t.tracks.length>2?[{label:"Move track to top",icon:N.A,onClick:()=>{t.moveTrackToTop(e.id)}}]:[],{label:"Move track up",icon:L.A,onClick:()=>{t.moveTrackUp(e.id)}},{label:"Move track down",icon:I.A,onClick:()=>{t.moveTrackDown(e.id)}},...t.tracks.length>2?[{label:"Move track to bottom",icon:F.A,onClick:()=>{t.moveTrackToBottom(e.id)}}]:[]]},...n.getTrackActionMenuItems?.(r)||[],...e.trackMenuItems()].sort((e,t)=>(t?.priority||0)-(e?.priority||0));return(0,g.jsx)(P.A,{menuItems:l,"data-testid":"track_menu_icon",children:(0,g.jsx)(B.A,{fontSize:"small"})})}),E=(0,l.n9)()(e=>({root:{zIndex:200,background:(0,x.X4)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper}},trackName:{fontSize:"0.8rem"},iconButton:{padding:e.spacing(1)}})),z=(0,o.observer)((0,r.forwardRef)(function(e,t){const n=(0,u.c)(38),{track:r,className:o}=e,{classes:l,cx:c}=E();let d;n[0]!==r?(d=(0,i.getContainingView)(r),n[0]=r,n[1]=d):d=n[1];const p=d;let h,m,f;if(n[2]!==r){const e=(0,i.getSession)(r),t=r.configuration;({minimized:h}=r),f=(0,w.getConf)(r,"trackId"),m=(0,v.getTrackName)(t,e),n[2]=r,n[3]=h,n[4]=m,n[5]=f}else h=n[3],m=n[4],f=n[5];const y=m;let b,x,T,A,P;n[6]!==o||n[7]!==l.root||n[8]!==c?(b=c(o,l.root),n[6]=o,n[7]=l.root,n[8]=c,n[9]=b):b=n[9],n[10]!==r||n[11]!==f||n[12]!==p?(x=(0,g.jsx)(M,{track:r,trackId:f,view:p}),n[10]=r,n[11]=f,n[12]=p,n[13]=x):x=n[13],n[14]!==f||n[15]!==p?(T=()=>p.hideTrack(f),n[14]=f,n[15]=p,n[16]=T):T=n[16],n[17]===Symbol.for("react.memo_cache_sentinel")?(A=(0,g.jsx)(S.A,{fontSize:"small"}),n[17]=A):A=n[17],n[18]!==l.iconButton||n[19]!==T?(P=(0,g.jsx)(C.A,{onClick:T,className:l.iconButton,title:"close this track",children:A}),n[18]=l.iconButton,n[19]=T,n[20]=P):P=n[20];const R=l.trackName,I=h?"(minimized)":"";let L;n[21]!==I||n[22]!==y?(L=[y,I].filter(G),n[21]=I,n[22]=y,n[23]=L):L=n[23];const F=L.join(" ");let N,D,B,j;return n[24]!==F?(N=(0,g.jsx)(a.SanitizedHTML,{html:F}),n[24]=F,n[25]=N):N=n[25],n[26]!==l.trackName||n[27]!==N?(D=(0,g.jsx)(k.A,{variant:"body1",component:"span",className:R,onMouseDown:H,children:N}),n[26]=l.trackName,n[27]=N,n[28]=D):D=n[28],n[29]!==r?(B=(0,g.jsx)(V,{track:r}),n[29]=r,n[30]=B):B=n[30],n[31]!==t||n[32]!==D||n[33]!==B||n[34]!==b||n[35]!==x||n[36]!==P?(j=(0,g.jsxs)(s.A,{ref:t,className:b,onClick:O,children:[x,P,D,B]}),n[31]=t,n[32]=D,n[33]=B,n[34]=b,n[35]=x,n[36]=P,n[37]=j):j=n[37],j}));function O(e){e.stopPropagation()}function H(e){e.stopPropagation()}function G(e){return!!e}const $=(0,l.n9)()({trackLabel:{zIndex:2},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"}}),W=(0,o.observer)(function({track:e,view:t}){const{classes:n,cx:r}=$(),a=e.displays[0],{trackLabel:o,trackLabelOverlap:i,trackLabelOffset:s}=n,l="overlapping"!==t.trackLabelsSetting||a.prefersOffset?s:i;return"hidden"!==t.trackLabelsSetting?(0,g.jsx)(z,{track:e,className:r(o,l)}):null}),U=(0,l.n9)()({renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none"}}),_=(0,o.observer)(function({model:e,track:t,onDragEnter:n}){const{classes:o}=U(),i=t.displays[0],{height:s,RenderingComponent:l,DisplayBlurb:c}=i,{trackRefs:d,id:u,scaleFactor:p}=e,h=(0,w.getConf)(t,"trackId"),m=(0,r.useRef)(null),f=t.minimized;return(0,r.useEffect)(()=>(m.current&&(d[h]=m.current),()=>{delete d[h]}),[d,h]),(0,g.jsx)("div",{className:o.trackRenderingContainer,style:{height:f?20:s},onScroll:e=>i.setScrollTop(e.currentTarget.scrollTop),onDragEnter:n,"data-testid":`trackRenderingContainer-${u}-${h}`,children:f?null:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{ref:m,className:o.renderingComponentContainer,style:{transform:1!==p?`scaleX(${p})`:void 0},children:(0,g.jsx)(r.Suspense,{fallback:(0,g.jsx)(a.LoadingEllipses,{}),children:(0,g.jsx)(l,{model:i,onHorizontalScroll:e.horizontalScroll})})}),c?(0,g.jsx)("div",{style:{position:"absolute",left:0,top:i.height-20},children:(0,g.jsx)(c,{model:i})}):null]})})}),q=(0,l.n9)()(e=>({root:{marginTop:2,overflow:"hidden",position:"relative"},unpinnedTrack:{background:"none"},resizeHandle:{height:4,boxSizing:"border-box",position:"relative",background:"transparent","&:hover":{background:e.palette.divider}}})),J=(0,o.observer)(function({model:e,track:t}){const{classes:n,cx:o}=q(),i=t.displays[0],{draggingTrackId:l,showTrackOutlines:u}=e,p=(0,r.useRef)(null);return(0,g.jsxs)(s.A,{ref:p,className:o(n.root,t.pinned?null:n.unpinnedTrack),variant:u?"outlined":void 0,elevation:u?void 0:0,onClick:n=>{if(2===n.detail&&!t.displays[0].featureIdUnderMouse){const t=p.current?.getBoundingClientRect().left||0;e.zoomTo(e.bpPerPx/2,n.clientX-t,!0)}},children:[t.pinned?(0,g.jsx)(b,{model:e,offset:1}):null,(0,g.jsx)(W,{track:t,view:e}),(0,g.jsx)(c.t,{FallbackComponent:e=>(0,g.jsx)(a.ErrorMessage,{error:e.error}),children:(0,g.jsx)(_,{model:e,track:t,onDragEnter:()=>{(0,d.isAlive)(i)&&void 0!==l&&l!==i.id&&e.moveTrack(l,t.id)}})}),(0,g.jsx)(a.ResizeHandle,{onDrag:i.resizeHeight,className:n.resizeHandle})]})});var X=n(37934),Y=n(37962);const K=(0,l.n9)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",background:"red",zIndex:1001},tooltipTarget:{position:"sticky",width:1}}),Q=(0,o.observer)(function({model:e,coordX:t}){const{classes:n}=K(),{stickyViewHeaders:r,rubberbandTop:a}=e;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Y.A,{open:!0,placement:"top",title:(0,i.stringify)(e.pxToBp(t)),arrow:!0,children:(0,g.jsx)("div",{className:n.tooltipTarget,style:{left:t+6,top:a,position:r?"sticky":void 0}})}),(0,g.jsx)("div",{className:n.guide,style:{left:t}})]})});var Z=n(50574);function ee(e,t,n){const a=(0,u.c)(37),[o,i]=(0,r.useState)(),[s,l]=(0,r.useState)(),[c,d]=(0,r.useState)(),[p,h]=(0,r.useState)(),g=void 0!==o&&void 0===c;let m;a[0]===Symbol.for("react.memo_cache_sentinel")?(m=()=>{d(void 0),i(void 0),l(void 0)},a[0]=m):m=a[0];const f=m;let y,b,w;a[1]!==t||a[2]!==g||a[3]!==e||a[4]!==o?(y=()=>{const n=function(t){if(e.current&&g){const n=(0,Z.Pn)(t,e.current);l(n)}},r=function(n){if(void 0!==o&&e.current){const{clientX:r,clientY:a}=n,i=(0,Z.Pn)(n,e.current);if(Math.abs(i-o)<=3)return void f();d({offsetX:i,clientX:r,clientY:a});const s=function(e){if(void 0===o)return;const n=Math.min(o,e),r=Math.max(o,e);return{leftOffset:t.pxToBp(n),rightOffset:t.pxToBp(r)}}(i);s&&t.setOffsets(s.leftOffset,s.rightOffset),h(void 0)}};return g?(window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)}):te},b=[o,g,t,e,f],a[1]=t,a[2]=g,a[3]=e,a[4]=o,a[5]=y,a[6]=b):(y=a[5],b=a[6]),(0,r.useEffect)(y,b),a[7]!==e||a[8]!==n?(w=function(t){if(n&&!t.shiftKey)return;t.preventDefault(),t.stopPropagation();const r=(0,Z.Pn)(t,e.current);i(r),l(r)},a[7]=e,a[8]=n,a[9]=w):w=a[9];const v=w;let S;a[10]!==e||a[11]!==n?(S=function(t){n?t.shiftKey?h((0,Z.Pn)(t,e.current)):h(void 0):h((0,Z.Pn)(t,e.current))},a[10]=e,a[11]=n,a[12]=S):S=a[12];const x=S;let C;a[13]===Symbol.for("react.memo_cache_sentinel")?(C=function(){h(void 0)},a[13]=C):C=a[13];const k=C;let T;a[14]===Symbol.for("react.memo_cache_sentinel")?(T=function(e,t){t(),f()},a[14]=T):T=a[14];const A=T,M=Boolean(c);if(void 0===o){let e;return a[15]!==p||a[16]!==v||a[17]!==x||a[18]!==M?(e={open:M,guideX:p,mouseDown:v,mouseMove:x,mouseOut:k,handleMenuItemClick:A},a[15]=p,a[16]=v,a[17]=x,a[18]=M,a[19]=e):e=a[19],e}const P=c?c.offsetX:s||0,R=Math.min(P,o),I=Math.abs(P-o);let L;a[20]!==R||a[21]!==t?(L=t.pxToBp(R),a[20]=R,a[21]=t,a[22]=L):L=a[22];const F=L;let N;a[23]!==R||a[24]!==t||a[25]!==I?(N=t.pxToBp(R+I),a[23]=R,a[24]=t,a[25]=I,a[26]=N):N=a[26];const D=N,B=Math.ceil(I*t.bpPerPx);let j;return a[27]!==c||a[28]!==R||a[29]!==F||a[30]!==v||a[31]!==x||a[32]!==B||a[33]!==M||a[34]!==D||a[35]!==I?(j={open:M,rubberbandOn:!0,mouseDown:v,mouseMove:x,mouseOut:k,handleClose:f,handleMenuItemClick:A,leftBpOffset:F,rightBpOffset:D,anchorPosition:c,numOfBpSelected:B,width:I,left:R},a[27]=c,a[28]=R,a[29]=F,a[30]=v,a[31]=x,a[32]=B,a[33]=M,a[34]=D,a[35]=I,a[36]=j):j=a[36],j}function te(){}const ne=(0,l.n9)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8,zIndex:825}}),re=(0,o.observer)(function({model:e,ControlComponent:t=(0,g.jsx)("div",{})}){const n=(0,r.useRef)(null),{classes:o}=ne(),{stickyViewHeaders:i,rubberbandTop:s}=e,{guideX:l,rubberbandOn:c,leftBpOffset:d,rightBpOffset:u,numOfBpSelected:p,width:h,left:m,anchorPosition:f,open:y,handleMenuItemClick:b,handleClose:w,mouseMove:v,mouseDown:S,mouseOut:x}=ee(n,e);return(0,g.jsxs)(g.Fragment,{children:[void 0!==l?(0,g.jsx)(Q,{model:e,coordX:l}):c?(0,g.jsx)(X.default,{leftBpOffset:d,rightBpOffset:u,numOfBpSelected:p,width:h,left:m,top:s,sticky:i}):null,f?(0,g.jsx)(a.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:f.clientX,top:f.clientY},onMenuItemClick:b,open:y,onClose:w,menuItems:e.rubberBandMenuItems()}):null,(0,g.jsx)("div",{"data-testid":"rubberband_controls",className:o.rubberbandControl,style:{top:s,position:i?"sticky":void 0},ref:n,onMouseDown:S,onMouseMove:v,onMouseOut:x,children:t})]})}),ae=(0,l.n9)()(e=>({majorTickLabel:{fontSize:11,zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"}})),oe=function(e){const t=(0,u.c)(19),{block:n,bpPerPx:r}=e,{classes:a}=ae(),{reversed:o,start:s,end:l}=n;let c,d,m,f;if(t[0]!==n||t[1]!==r||t[2]!==a||t[3]!==l||t[4]!==o||t[5]!==s){const e=(0,h.H2)(s,l,r,!0,!1);let u;c=p.$G,d=n,t[9]!==r||t[10]!==a||t[11]!==l||t[12]!==o||t[13]!==s?(u=e=>{const{type:t,base:n}=e;if("major"===t){const e=(o?l-n:n-s)/r,t=n+1;return(0,g.jsx)("div",{className:a.tick,style:{left:e},children:t?(0,g.jsx)(k.A,{className:a.majorTickLabel,children:(0,i.getTickDisplayStr)(t,r)}):null},n)}return null},t[9]=r,t[10]=a,t[11]=l,t[12]=o,t[13]=s,t[14]=u):u=t[14],m=e.map(u),t[0]=n,t[1]=r,t[2]=a,t[3]=l,t[4]=o,t[5]=s,t[6]=c,t[7]=d,t[8]=m}else c=t[6],d=t[7],m=t[8];return t[15]!==c||t[16]!==d||t[17]!==m?(f=(0,g.jsx)(c,{block:d,children:m}),t[15]=c,t[16]=d,t[17]=m,t[18]=f):f=t[18],f},ie=(0,o.observer)(function({model:e}){const{staticBlocks:t,bpPerPx:n}=e;return(0,g.jsx)(g.Fragment,{children:t.map((e,t)=>{const{key:r,widthPx:a}=e,o=`${r}-${t}`;return"ContentBlock"===e.type?(0,g.jsx)(oe,{block:e,bpPerPx:n},o):"ElidedBlock"===e.type?(0,g.jsx)(p.Db,{width:a},o):"InterRegionPaddingBlock"===e.type?(0,g.jsx)(p.fK,{width:a,style:{background:"none"},boundary:"boundary"===e.variant},o):null})})}),se=(0,l.n9)()(e=>({refLabel:{fontSize:11,position:"absolute",left:2,top:-1,fontWeight:"bold",lineHeight:"normal",zIndex:1,background:e.palette.background.paper},b0:{left:0,zIndex:100}})),le=(0,o.observer)(function({model:e}){const{classes:t,cx:n}=se(),{staticBlocks:r,offsetPx:a,scaleBarDisplayPrefix:o}=e;let i=0;r.forEach((e,t)=>{e.offsetPx-a<0&&(i=t)});const s=o(),l=r.blocks[0];return(0,g.jsxs)(g.Fragment,{children:["ContentBlock"!==l?.type&&s?(0,g.jsx)(k.A,{className:n(t.b0,t.refLabel),children:s}):null,r.map((e,n)=>{const{offsetPx:r,isLeftEndOfDisplayedRegion:o,key:l,type:c,refName:d}=e,u=n===i;return"ContentBlock"===c&&(o||u)?(0,g.jsxs)(k.A,{style:{left:u?Math.max(0,-a):r-a-1,paddingLeft:u?0:1},className:t.refLabel,"data-testid":`refLabel-${d}`,children:[u&&s?`${s}:`:"",d]},`refLabel-${l}-${n}`):null})]})}),ce=(0,l.n9)()({container:{overflow:"hidden",position:"relative"},zoomContainer:{position:"relative"},scalebar:{position:"absolute",display:"flex",pointerEvents:"none"}}),de=(0,o.observer)((0,r.forwardRef)(function(e,t){const n=(0,u.c)(37);let r,a,o,i;n[0]!==e?(({model:a,style:i,className:r,...o}=e),n[0]=e,n[1]=r,n[2]=a,n[3]=o,n[4]=i):(r=n[1],a=n[2],o=n[3],i=n[4]);const{classes:l,cx:c}=ce(),{staticBlocks:d,offsetPx:p,scaleFactor:h}=a,m=d.offsetPx-p;let f,y;n[5]!==r||n[6]!==l.container||n[7]!==c?(f=c(l.container,r),n[5]=r,n[6]=l.container,n[7]=c,n[8]=f):f=n[8],n[9]!==a?(y=(0,g.jsx)(b,{model:a,offset:1}),n[9]=a,n[10]=y):y=n[10];const w=1!==h?`scaleX(${h})`:void 0;let v;n[11]!==w?(v={transform:w},n[11]=w,n[12]=v):v=n[12];const S=m-1;let x,C,k,T,A,M;return n[13]!==d.totalWidthPx||n[14]!==i||n[15]!==S?(x={left:S,width:d.totalWidthPx,...i},n[13]=d.totalWidthPx,n[14]=i,n[15]=S,n[16]=x):x=n[16],n[17]!==a?(C=(0,g.jsx)(ie,{model:a}),n[17]=a,n[18]=C):C=n[18],n[19]!==l.scalebar||n[20]!==x||n[21]!==C?(k=(0,g.jsx)("div",{className:l.scalebar,style:x,children:C}),n[19]=l.scalebar,n[20]=x,n[21]=C,n[22]=k):k=n[22],n[23]!==l.zoomContainer||n[24]!==v||n[25]!==k?(T=(0,g.jsx)("div",{className:l.zoomContainer,style:v,children:k}),n[23]=l.zoomContainer,n[24]=v,n[25]=k,n[26]=T):T=n[26],n[27]!==a?(A=(0,g.jsx)(le,{model:a}),n[27]=a,n[28]=A):A=n[28],n[29]!==o||n[30]!==t||n[31]!==i||n[32]!==f||n[33]!==A||n[34]!==y||n[35]!==T?(M=(0,g.jsxs)(s.A,{"data-resizer":"true",className:f,variant:"outlined",ref:t,style:i,...o,children:[y,T,A]}),n[29]=o,n[30]=t,n[31]=i,n[32]=f,n[33]=A,n[34]=y,n[35]=T,n[36]=M):M=n[36],M}));var ue=n(76239);function pe(){}function he(){}const ge=(0,r.lazy)(()=>n.e(4895).then(n.bind(n,24895))),me=(0,r.lazy)(()=>n.e(3656).then(n.bind(n,63656))),fe=(0,r.lazy)(()=>Promise.resolve().then(n.bind(n,37934))),ye=(0,l.n9)()({tracksContainer:{position:"relative"}}),be=(0,o.observer)(function({children:e,model:t}){const{classes:n}=ye(),{pluginManager:o}=(0,i.getEnv)(t),{mouseDown:s,mouseUp:l}=function(e){const t=(0,u.c)(6),[n,a]=(0,r.useState)(!1),o=(0,r.useRef)(!1),i=(0,r.useRef)(0);let s,l,c;t[0]!==e||t[1]!==n?(s=()=>{let t=pe;const r=function(t){t.preventDefault();const n=t.clientX-i.current;n&&(o.current||(o.current=!0,window.requestAnimationFrame(()=>{e.horizontalScroll(-n),o.current=!1,i.current=t.clientX})))},s=function(){i.current=0,n&&a(!1)};return n&&(window.addEventListener("mousemove",r,!0),window.addEventListener("mouseup",s,!0),t=()=>{window.removeEventListener("mousemove",r,!0),window.removeEventListener("mouseup",s,!0)}),t},l=[e,n],t[0]=e,t[1]=n,t[2]=s,t[3]=l):(s=t[2],l=t[3]),(0,r.useEffect)(s,l),t[4]===Symbol.for("react.memo_cache_sentinel")?(c=function(e){if(e.shiftKey)return;const t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(i.current=e.clientX,a(!0))},t[4]=c):c=t[4];const d=c;let p;return t[5]===Symbol.for("react.memo_cache_sentinel")?(p={mouseDown:d,mouseUp:function(e){e.preventDefault(),a(!1)}},t[5]=p):p=t[5],p}(t),{stickyViewHeaders:c,rubberbandTop:d,showGridlines:p,showCenterLine:h}=t,m=(0,r.useRef)(null),{guideX:f,rubberbandOn:y,leftBpOffset:w,rightBpOffset:v,numOfBpSelected:S,width:x,left:C,anchorPosition:k,open:T,handleMenuItemClick:A,handleClose:M,mouseMove:P,mouseDown:R}=ee(m,t,!0);!function(e,t){const n=(0,u.c)(4),a=(0,r.useRef)(0),o=(0,r.useRef)(null),s=(0,r.useRef)(!1);let l,c;n[0]!==t||n[1]!==e?(l=()=>{let n=[];const r=e.current,l=function(e){if(e.ctrlKey){e.preventDefault(),n.push(e.deltaY);const s=Math.abs((0,i.sum)(n))/n.length,l=s<6?25:s>30?s>150?500:150:75;a.current=a.current+e.deltaY/l,t.setScaleFactor(a.current<0?1-a.current:1/(1+a.current)),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{t.setScaleFactor(1),t.zoomTo(a.current>0?t.bpPerPx*(1+a.current):t.bpPerPx/(1-a.current),e.clientX-(r?.getBoundingClientRect().left||0)),a.current=0,n=[]},300)}else Math.abs(e.deltaX)>Math.abs(2*e.deltaY)&&e.preventDefault(),a.current=a.current+e.deltaX,s.current||(s.current=!0,window.requestAnimationFrame(()=>{t.horizontalScroll(a.current),a.current=0,s.current=!1}))};return r?(r.addEventListener("wheel",l),()=>{r.removeEventListener("wheel",l)}):he},c=[t,e],n[0]=t,n[1]=e,n[2]=l,n[3]=c):(l=n[2],c=n[3]),(0,r.useEffect)(l,c)}(m,t);const I=o.evaluateExtensionPoint("LinearGenomeView-TracksContainerComponent",void 0,{model:t});return(0,g.jsxs)("div",{ref:m,"data-testid":"tracksContainer",className:n.tracksContainer,onMouseDown:e=>{s(e),R(e)},onMouseMove:P,onMouseUp:l,children:[p?(0,g.jsx)(b,{model:t}):null,(0,g.jsx)(r.Suspense,{fallback:null,children:h?(0,g.jsx)(ge,{model:t}):null}),void 0!==f?(0,g.jsx)(Q,{model:t,coordX:f}):y?(0,g.jsx)(r.Suspense,{fallback:null,children:(0,g.jsx)(fe,{leftBpOffset:w,rightBpOffset:v,numOfBpSelected:S,width:x,left:C,top:d,sticky:c})}):null,k?(0,g.jsx)(a.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:k.clientX,top:k.clientY},onMenuItemClick:A,open:T,onClose:M,menuItems:t.rubberBandMenuItems()}):null,(0,g.jsx)(re,{model:t,ControlComponent:(0,g.jsx)(de,{model:t,style:{height:ue.jE,boxSizing:"border-box"}})}),(0,g.jsx)(we,{model:t}),I,e]})}),we=(0,o.observer)(function({model:e}){return e.highlight.length?(0,g.jsx)(r.Suspense,{fallback:null,children:e.highlight.map((t,n)=>(0,g.jsx)(me,{model:e,highlight:t},`${JSON.stringify(t)}-${n}`))}):null}),ve=be,Se=(0,r.lazy)(()=>n.e(1189).then(n.bind(n,21189))),xe=(0,l.n9)()(e=>({header:{background:e.palette.background.paper,top:a.VIEW_HEADER_HEIGHT,zIndex:850},pinnedTracks:{position:"sticky",zIndex:3},rel:{position:"relative"}})),Ce=(0,o.observer)(function({model:e}){const{pinnedTracks:t,stickyViewHeaders:n,pinnedTracksTop:a,tracks:o,unpinnedTracks:l}=e,{classes:c}=xe(),d=(0,i.getSession)(e),u=(0,r.useRef)(null),p=e.MiniControlsComponent(),h=e.HeaderComponent();return(0,r.useEffect)(()=>{function t(t){t.target instanceof Element&&u.current?.contains(t.target)&&d.setFocusedViewId?.(e.id)}return document.addEventListener("mousedown",t),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",t)}},[d,e]),(0,g.jsxs)("div",{className:c.rel,ref:u,onMouseLeave:()=>{d.setHovered(void 0)},onMouseMove:t=>{const n=u.current;if(!n)return;const{tracks:r}=e,a=t.clientX-n.getBoundingClientRect().left,o=e.pxToBp(a),i=r.find(e=>e.displays[0].featureUnderMouse);d.setHovered({hoverPosition:o,hoverFeature:i})},children:[(0,g.jsxs)("div",{className:c.header,style:{position:n?"sticky":void 0},children:[(0,g.jsx)(h,{model:e}),(0,g.jsx)(p,{model:e})]}),(0,g.jsx)(ve,{model:e,children:o.length?(0,g.jsxs)(g.Fragment,{children:[t.length?(0,g.jsx)(s.A,{elevation:6,className:c.pinnedTracks,style:{top:a},children:t.map(t=>(0,g.jsx)(J,{model:e,track:t},t.id))}):null,l.map(t=>(0,g.jsx)(J,{model:e,track:t},t.id))]}):(0,g.jsx)(r.Suspense,{fallback:null,children:(0,g.jsx)(Se,{model:e})})})]})}),ke=Ce,Te=(0,r.lazy)(()=>Promise.all([n.e(2826),n.e(9372)]).then(n.bind(n,29372))),Ae=(0,o.observer)(function({model:e}){const{error:t,initialized:n,hasDisplayedRegions:r}=e;return n||t?!r||t?(0,g.jsx)(Te,{model:e}):(0,g.jsx)(ke,{model:e}):(0,g.jsx)(a.LoadingEllipses,{variant:"h6"})})},65944:(e,t,n)=>{n.d(t,{A:()=>o});class r{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,t){let n=this.length++;for(;n>0;){const e=n-1>>1,r=this.values[e];if(t>=r)break;this.ids[n]=this.ids[e],this.values[n]=r,n=e}this.ids[n]=e,this.values[n]=t}pop(){if(0===this.length)return;const e=this.ids,t=this.values,n=e[0],r=--this.length;if(r>0){const n=e[r],a=t[r];let o=0;const i=r>>1;for(;o<i;){const n=1+(o<<1),i=n+1,s=n+(+(i<r)&+(t[i]<t[n]));if(t[s]>=a)break;e[o]=e[s],t[o]=t[s],o=s}e[o]=n,t[o]=a}return n}peek(){return this.length>0?this.ids[0]:void 0}peekValue(){return this.length>0?this.values[0]:void 0}shrink(){this.ids.length=this.values.length=this.length}}const a=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class o{static from(e,t=0){if(t%8!=0)throw new Error("byteOffset must be 8-byte aligned.");if(void 0===e?.byteLength||e.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[n,r]=new Uint8Array(e,t+0,2);if(251!==n)throw new Error("Data does not appear to be in a Flatbush format.");const i=r>>4;if(3!==i)throw new Error(`Got v${i} data when expected v3.`);const s=a[15&r];if(!s)throw new Error("Unrecognized array type.");const[l]=new Uint16Array(e,t+2,1),[c]=new Uint32Array(e,t+4,1);return new o(c,l,s,void 0,e,t)}constructor(e,t=16,n=Float64Array,o=ArrayBuffer,i,s=0){if(void 0===e)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.byteOffset=s;let l=e,c=l;this._levelBounds=[4*l];do{l=Math.ceil(l/this.nodeSize),c+=l,this._levelBounds.push(4*c)}while(1!==l);this.ArrayType=n,this.IndexArrayType=c<16384?Uint16Array:Uint32Array;const d=a.indexOf(n),u=4*c*n.BYTES_PER_ELEMENT;if(-1===d)throw new Error(`Unexpected typed array class: ${n}.`);if(i)this.data=i,this._boxes=new n(i,s+8,4*c),this._indices=new this.IndexArrayType(i,s+8+u,c),this._pos=4*c,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1];else{const r=this.data=new o(8+u+c*this.IndexArrayType.BYTES_PER_ELEMENT);this._boxes=new n(r,8,4*c),this._indices=new this.IndexArrayType(r,8+u,c),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(r,0,2).set([251,48+d]),new Uint16Array(r,2,1)[0]=t,new Uint32Array(r,4,1)[0]=e}this._queue=new r}add(e,t,n=e,r=t){const a=this._pos>>2,o=this._boxes;return this._indices[a]=a,o[this._pos++]=e,o[this._pos++]=t,o[this._pos++]=n,o[this._pos++]=r,e<this.minX&&(this.minX=e),t<this.minY&&(this.minY=t),n>this.maxX&&(this.maxX=n),r>this.maxY&&(this.maxY=r),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const e=this._boxes;if(this.numItems<=this.nodeSize)return e[this._pos++]=this.minX,e[this._pos++]=this.minY,e[this._pos++]=this.maxX,void(e[this._pos++]=this.maxY);const t=this.maxX-this.minX||1,n=this.maxY-this.minY||1,r=new Uint32Array(this.numItems);for(let a=0,o=0;a<this.numItems;a++){const i=e[o++],s=e[o++],l=e[o++],d=e[o++],u=Math.floor(65535*((i+l)/2-this.minX)/t),p=Math.floor(65535*((s+d)/2-this.minY)/n);r[a]=c(u,p)}s(r,e,this._indices,0,this.numItems-1,this.nodeSize);for(let t=0,n=0;t<this._levelBounds.length-1;t++){const r=this._levelBounds[t];for(;n<r;){const t=n;let a=e[n++],o=e[n++],i=e[n++],s=e[n++];for(let t=1;t<this.nodeSize&&n<r;t++)a=Math.min(a,e[n++]),o=Math.min(o,e[n++]),i=Math.max(i,e[n++]),s=Math.max(s,e[n++]);this._indices[this._pos>>2]=t,e[this._pos++]=a,e[this._pos++]=o,e[this._pos++]=i,e[this._pos++]=s}}}search(e,t,n,r,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const s=[],l=[];for(;void 0!==o;){const c=Math.min(o+4*this.nodeSize,i(o,this._levelBounds));for(let i=o;i<c;i+=4){const c=this._boxes[i];if(n<c)continue;const d=this._boxes[i+1];if(r<d)continue;const u=this._boxes[i+2];if(e>u)continue;const p=this._boxes[i+3];if(t>p)continue;const h=0|this._indices[i>>2];o>=4*this.numItems?s.push(h):(void 0===a||a(h,c,d,u,p))&&l.push(h)}o=s.pop()}return l}neighbors(e,t,n=1/0,r=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const s=this._queue,l=[],c=r*r;e:for(;void 0!==o;){const r=Math.min(o+4*this.nodeSize,i(o,this._levelBounds));for(let n=o;n<r;n+=4){const r=0|this._indices[n>>2],i=this._boxes[n],l=this._boxes[n+1],d=this._boxes[n+2],u=this._boxes[n+3],p=e<i?i-e:e>d?e-d:0,h=t<l?l-t:t>u?t-u:0,g=p*p+h*h;g>c||(o>=4*this.numItems?s.push(r<<1,g):(void 0===a||a(r))&&s.push(1+(r<<1),g))}for(;s.length&&1&s.peek();){if(s.peekValue()>c)break e;if(l.push(s.pop()>>1),l.length===n)break e}o=s.length?s.pop()>>1:void 0}return s.clear(),l}}function i(e,t){let n=0,r=t.length-1;for(;n<r;){const a=n+r>>1;t[a]>e?r=a:n=a+1}return t[n]}function s(e,t,n,r,a,o){if(Math.floor(r/o)>=Math.floor(a/o))return;const i=e[r],c=e[r+a>>1],d=e[a];let u=d;const p=Math.max(i,c);d>p?u=p:p===i?u=Math.max(c,d):p===c&&(u=Math.max(i,d));let h=r-1,g=a+1;for(;;){do{h++}while(e[h]<u);do{g--}while(e[g]>u);if(h>=g)break;l(e,t,n,h,g)}s(e,t,n,r,g,o),s(e,t,n,g+1,a,o)}function l(e,t,n,r,a){const o=e[r];e[r]=e[a],e[a]=o;const i=4*r,s=4*a,l=t[i],c=t[i+1],d=t[i+2],u=t[i+3];t[i]=t[s],t[i+1]=t[s+1],t[i+2]=t[s+2],t[i+3]=t[s+3],t[s]=l,t[s+1]=c,t[s+2]=d,t[s+3]=u;const p=n[r];n[r]=n[a],n[a]=p}function c(e,t){let n=e^t,r=65535^n,a=65535^(e|t),o=e&(65535^t),i=n|r>>1,s=n>>1^n,l=a>>1^r&o>>1^a,c=n&a>>1^o>>1^o;n=i,r=s,a=l,o=c,i=n&n>>2^r&r>>2,s=n&r>>2^r&(n^r)>>2,l^=n&a>>2^r&o>>2,c^=r&a>>2^(n^r)&o>>2,n=i,r=s,a=l,o=c,i=n&n>>4^r&r>>4,s=n&r>>4^r&(n^r)>>4,l^=n&a>>4^r&o>>4,c^=r&a>>4^(n^r)&o>>4,n=i,r=s,a=l,o=c,l^=n&a>>8^r&o>>8,c^=r&a>>8^(n^r)&o>>8,n=l^l>>1,r=c^c>>1;let d=e^t,u=r|65535^(d|n);return d=16711935&(d|d<<8),d=252645135&(d|d<<4),d=858993459&(d|d<<2),d=1431655765&(d|d<<1),u=16711935&(u|u<<8),u=252645135&(u|u<<4),u=858993459&(u|u<<2),u=1431655765&(u|u<<1),(u<<1|d)>>>0}},66885:(e,t,n)=>{n.r(t),n.d(t,{ObservableCreate:()=>o});var r=n(89592),a=n(37347);function o(e,t){return(0,a.SW)(t),new r.c(t=>{try{const n=e(t);n?.catch&&n.catch(e=>{t.error(e)})}catch(e){t.error(e)}})}},67736:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{constructor(e){super(e),this.heading=e.heading,this.HeadingComponent=e.HeadingComponent,this.configSchema=e.configSchema,this.stateModel=e.stateModel,this.ReactComponent=e.ReactComponent}}},68384:(e,t,n)=>{n.d(t,{Ay:()=>R});var r=n(7552),a=n(58921),o=n(68584);const i=(0,o.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{});var s=n(99546),l=n(8832),c=n(42489),d=n(36422),u=n(91468),p=n(6842);function h(e,t,n){return e.filter(e=>t.map(t=>n(t,e)).filter(e=>!!e).length>5)}function g(e=[],t=[]){if(e[0]===t[0])return!0;{const n=new Set(e);return t.some(e=>n.has(e))}}function m(e,t,n){const r=(0,o.readConfObject)(t,"category")||[],a=e.toLowerCase();return(0,u.getTrackName)(t,n).toLowerCase().includes(a)||!!r.filter(e=>e.toLowerCase().includes(a)).length}function f(e,t,n=0){let r=!1;for(const a of e)a.children.length?f(a.children,t,n+1)&&n>0&&t.push(a.id):r=!0;return r}function y(e,t){for(const n of e)n.children.length&&t.push(n.id)}const b=["category","adapter","description"];function w(e,t){const{assemblyManager:n}=(0,s.getSession)(t),{pluginManager:r}=(0,s.getEnv)(t),{view:a}=t;if(!a)return[];const i=t.assemblyNames.map(e=>n.getCanonicalAssemblyName(e)).filter(s.notEmpty);return e.filter(e=>{const t=(0,o.readConfObject)(e,"assemblyNames"),r=t?.map(e=>n.getCanonicalAssemblyName(e)).filter(s.notEmpty);return a.trackSelectorAnyOverlap?g(r,i):function(e=[],t=[]){const n=new Set(e);return t.every(e=>n.has(e))}(r,i)}).filter(e=>{const{displayTypes:t}=r.getViewType(a.type);return g(t.map(e=>e.name),e.displays.map(e=>e.type))})}function v({model:e,trackConfs:t,extra:n,noCategories:r,menuItems:a}){const i={children:[]},{collapsed:l,filterText:c,activeSortTrackNames:d,activeSortCategories:p,view:h}=e;if(!h)return[];const g=(0,s.getSession)(e),f=h.tracks,y=t.filter(e=>m(c,e,g));for(const e of function(e,t,n){const r=e.map(e=>[e,(0,o.readConfObject)(e,"name"),(0,o.readConfObject)(e,"category")?.[0]||"",(0,o.readConfObject)(e,"category")?.[1]||"",(0,o.readConfObject)(e,"category")?.[2]||""]);return t&&r.sort((e,t)=>e[1].localeCompare(t[1])),n&&r.sort((e,t)=>e[2]!==t[2]?e[2].localeCompare(t[2]):e[3]!==t[3]?e[3].localeCompare(t[3]):e[4]!==t[4]?e[4].localeCompare(t[4]):0),r.map(e=>e[0])}(y,d,p)){const t=[...(0,o.readConfObject)(e,"category")||[]];e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");let s=i;if(!r)for(let e=0;e<t.length;e++){const r=t[e],o=s.children.find(e=>e.name===r),i=[n,t.slice(0,e+1).join(",")].filter(e=>!!e).join("-");if(o)s=o;else{const e={children:[],name:r,id:i,isOpenByDefault:!l.get(i),menuItems:a,type:"category"};s.children.push(e),s=e}}const c=s.children.findIndex(e=>e.children.length),d=-1===c?s.children.length:c;s.children.splice(d,0,{id:[n,e.trackId].filter(e=>!!e).join(","),trackId:e.trackId,name:(0,u.getTrackName)(e,g),conf:e,checked:f.some(t=>t.configuration===e),children:[],type:"track"})}return i.children}function S(){return"undefined"!=typeof window?[window.location.pathname,new URLSearchParams(window.location.search).get("config")].filter(e=>!!e).join("-"):"empty"}function x(e){return["recentlyUsedTracks",S(),e.join(",")].filter(e=>!!e).join("-")}function C(){return`favoriteTracks-${S()}}`}function k(e,t){return["collapsedCategories",S(),e.join(","),t].join("-")}function T(e,t){const n=(0,s.localStorageGetItem)(e);return null!=n&&n?JSON.parse(n):t}function A(e,t){null!=t&&(0,s.localStorageSetItem)(e,JSON.stringify(t))}const M=10;function P(e){return d.types.model("HierarchicalTrackSelectorWidget",{id:l.ElementId,type:d.types.literal("HierarchicalTrackSelectorWidget"),view:d.types.safeReference(e.pluggableMstType("view","stateModel")),faceted:d.types.optional(d.types.model("FacetedModel",{filterText:d.types.optional(d.types.string,""),showSparse:d.types.optional(d.types.boolean,()=>(0,s.localStorageGetBoolean)("facet-showSparse",!1)),showFilters:d.types.optional(d.types.boolean,()=>(0,s.localStorageGetBoolean)("facet-showFilters",!0)),showOptions:d.types.optional(d.types.boolean,()=>(0,s.localStorageGetBoolean)("facet-showTableOptions",!1)),panelWidth:d.types.optional(d.types.number,()=>(0,s.localStorageGetNumber)("facet-panelWidth",400))}).volatile(()=>({visible:{},useShoppingCart:!1,filters:c.observable.map()})).actions(e=>({setFilter(t,n){e.filters.set(t,n)},setPanelWidth:t=>(e.panelWidth=t,e.panelWidth),setUseShoppingCart(t){e.useShoppingCart=t},setFilterText(t){e.filterText=t},setShowSparse(t){e.showSparse=t},setShowOptions(t){e.showOptions=t},setShowFilters(t){e.showFilters=t}})).views(e=>({get allTrackConfigurations(){return(0,d.getParent)(e).allTrackConfigurations}})).views(e=>({get rows(){const t=(0,s.getSession)(e),{allTrackConfigurations:n,filterText:r}=e;return n.filter(e=>m(r,e,t)).map(e=>({id:e.trackId,conf:e,name:(0,u.getTrackName)(e,t),category:(0,o.readConfObject)(e,"category")?.join(", "),adapter:(0,o.readConfObject)(e,"adapter")?.type,description:(0,o.readConfObject)(e,"description"),metadata:(0,o.readConfObject)(e,"metadata")}))}})).views(e=>({get filteredNonMetadataKeys(){return e.showSparse?b:h(b,e.rows,(e,t)=>e[t])},get metadataKeys(){return[...new Set(e.rows.flatMap(e=>{return t=e.metadata,Object.entries(t).map(([e,t])=>"string"==typeof t?e:"").filter(e=>!!e);var t}))]},get filteredMetadataKeys(){return e.showSparse?this.metadataKeys:h(this.metadataKeys,e.rows,(e,t)=>e.metadata[t])},get fields(){return["name",...this.filteredNonMetadataKeys,...this.filteredMetadataKeys.map(e=>`metadata.${e}`)]},get filteredRows(){const t=[...e.filters.entries()].filter(e=>e[1].length>0).map(([e,t])=>[e,new Set(t)]);return e.rows.filter(e=>t.every(([t,n])=>n.has((0,p.a)(t,e))))}})).actions(e=>({setVisible(t){e.visible=t},afterAttach(){(0,d.addDisposer)(e,(0,c.autorun)(()=>{this.setVisible(Object.fromEntries(e.fields.map(e=>[e,!0])))}))}})),{})}).volatile(()=>({favorites:T(C(),[]),recentlyUsed:[],selection:[],sortTrackNames:T("sortTrackNames",void 0),sortCategories:T("sortCategories",void 0),collapsed:c.observable.map(),filterText:"",recentlyUsedCounter:0,favoritesCounter:0})).views(e=>({get shownTrackIds(){return new Set(e.view?.tracks?.map(e=>e.configuration.trackId))},get selectionSet(){return new Set(e.selection)},get favoritesSet(){return new Set(e.favorites)},get recentlyUsedSet(){return new Set(e.recentlyUsed)},get assemblyNames(){return e.view?.assemblyNames||[]}})).actions(e=>({setSortTrackNames(t){e.sortTrackNames=t},setSortCategories(t){e.sortCategories=t},setSelection(t){e.selection=t},addToSelection(t){e.selection=(0,s.dedupe)([...e.selection,...t],e=>e.trackId)},removeFromSelection(t){const n=new Set(t);e.selection=e.selection.filter(e=>!n.has(e))},clearSelection(){e.selection=[]},addToFavorites(t){e.favoritesCounter+=1,e.favorites=[...e.favorites,t]},removeFromFavorites(t){e.favorites=e.favorites.filter(e=>e!==t)},clearFavorites(){e.favorites=[]},setRecentlyUsedCounter(t){e.recentlyUsedCounter=t},setRecentlyUsed(t){e.recentlyUsed=t},setFavorites(t){e.favorites=t},setFavoritesCounter(t){e.favoritesCounter=t},addToRecentlyUsed(t){e.recentlyUsed.includes(t)||(e.recentlyUsedCounter=Math.min(e.recentlyUsedCounter+1,M),e.recentlyUsed=e.recentlyUsed.length>=M?[...e.recentlyUsed.slice(1),t]:[...e.recentlyUsed,t])},clearRecentlyUsed(){e.recentlyUsed=[]},setView(t){e.view=t},toggleCategory(t){e.collapsed.set(t,!e.collapsed.get(t))},setCategoryCollapsed(t,n){e.collapsed.set(t,n)},expandAllCategories(){e.collapsed.clear()},setCollapsedCategories(t){e.collapsed.replace(t)},clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}})).views(t=>({isSelected:e=>t.selectionSet.has(e),isFavorite:e=>t.favoritesSet.has(e),isRecentlyUsed:e=>t.recentlyUsedSet.has(e),getRefSeqTrackConf(n){const{assemblyManager:r}=(0,s.getSession)(t),a=r.get(n),o=a?.configuration.sequence,i=e.getViewType(t.view.type);if(o)for(const e of o.displays)if(i.displayTypes.some(t=>t.name===e.type))return o}})).views(e=>({get activeSortTrackNames(){return e.sortTrackNames??(0,o.getConf)((0,s.getSession)(e),["hierarchical","sort","trackNames"])},get activeSortCategories(){return e.sortCategories??(0,o.getConf)((0,s.getSession)(e),["hierarchical","sort","categories"])},get configAndSessionTrackConfigurations(){return[...e.assemblyNames.map(t=>e.getRefSeqTrackConf(t)),...w((0,s.getSession)(e).tracks,e)].filter(s.notEmpty)},get allTrackConfigurations(){const{connectionInstances:t=[]}=(0,s.getSession)(e);return[...this.configAndSessionTrackConfigurations,...t.flatMap(e=>e.tracks)]},get allTrackConfigurationTrackIdSet(){return new Map(this.allTrackConfigurations.map(e=>[e.trackId,e]))}})).views(e=>({get favoriteTracks(){return e.favorites.filter(t=>e.allTrackConfigurationTrackIdSet.has(t)).map(t=>e.allTrackConfigurationTrackIdSet.get(t))},get recentlyUsedTracks(){return e.recentlyUsed.filter(t=>e.allTrackConfigurationTrackIdSet.has(t)).map(t=>e.allTrackConfigurationTrackIdSet.get(t))}})).views(e=>({get allTracks(){const{connectionInstances:t=[]}=(0,s.getSession)(e);return[{group:"Tracks",tracks:e.configAndSessionTrackConfigurations,noCategories:!1,menuItems:[]},...t.flatMap(t=>({group:(0,o.getConf)(t,"name"),tracks:w(t.tracks,e),noCategories:!1,menuItems:[]}))]}})).views(e=>({get hierarchy(){return{name:"Root",id:"Root",isOpenByDefault:!0,type:"category",children:e.allTracks.map(t=>({name:t.group,id:t.group,type:"category",isOpenByDefault:!e.collapsed.get(t.group),menuItems:t.menuItems,children:v({model:e,trackConfs:t.tracks,extra:t.group,noCategories:t.noCategories})}))}}})).actions(e=>({collapseSubCategories(){const t=[];f(e.hierarchy.children,t);for(const n of t)e.setCategoryCollapsed(n,!0)},collapseTopLevelCategories(){const t=[];for(const n of e.hierarchy.children)n.children.length&&y(n.children,t);for(const n of t)e.setCategoryCollapsed(n,!0)}})).views(e=>({get hasAnySubcategories(){return e.allTracks.some(e=>e.tracks.some(e=>(0,o.readConfObject)(e,"category")?.length>1))}})).actions(e=>({afterAttach(){(0,d.addDisposer)(e,(0,c.autorun)(()=>{const{assemblyNames:t,view:n}=e;if(e.setRecentlyUsed(T(x(t),[])),n){const r=T(k(t,n.type),void 0),a=["hierarchical","defaultCollapsed"],i=(0,s.getSession)(e);if(r)e.setCollapsedCategories(r);else{e.expandAllCategories(),(0,o.getConf)(i,[...a,"topLevelCategories"])&&e.collapseTopLevelCategories(),(0,o.getConf)(i,[...a,"subCategories"])&&e.collapseSubCategories();for(const t of(0,o.getConf)(i,[...a,"categoryNames"]))e.setCategoryCollapsed(`Tracks-${t}`,!0)}}})),(0,d.addDisposer)(e,(0,c.autorun)(()=>{const{sortTrackNames:t,sortCategories:n,favorites:r,recentlyUsed:a,assemblyNames:o,collapsed:i,view:s}=e;A(x(o),a),A(C(),r),A("sortTrackNames",t),A("sortCategories",n),s&&A(k(o,s.type),i)}))}}))}function R(e){e.addWidgetType(()=>new a.WidgetType({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:i,stateModel:P(e),ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(8989),n.e(5331)]).then(n.bind(n,25331)))}))}},69426:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(7552),a=n(68584),o=n(58921),i=n(8832),s=n(36422);const l=s.types.model("AddConnectionModel",{id:i.ElementId,type:s.types.literal("AddConnectionWidget")}),c=(0,a.ConfigurationSchema)("AddConnectionWidget",{});function d(e){e.addWidgetType(()=>new o.WidgetType({name:"AddConnectionWidget",heading:"Add a connection",configSchema:c,stateModel:l,ReactComponent:(0,r.lazy)(()=>Promise.all([n.e(9721),n.e(4456)]).then(n.bind(n,44456)))}))}},69566:(e,t,n)=>{n.d(t,{Fm:()=>u,M_:()=>i,bC:()=>c});var r=n(350),a=n(99546);const o={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted_duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};function i(e,t,n){if(!t||0===t.length)return["remark","no alternative alleles"];const r=new Set;let a=new Set;for(const o of t){let[t,i]=s(o,n);t||([t,i]=l(e,o)),t&&i&&(r.add(t),a.add(i))}if(a.size>1){const e=[...a],t=new Set(e.map(e=>{const t=e.split("->");return t[1]?t[0]:e}).filter(e=>!!e));a=new Set([...t].map(e=>e.trim()).map(t=>{const n=e.map(e=>e.split("->").map(e=>e.trim())).map(e=>e[1]&&e[0]===t?e[1]:"").filter(e=>!!e);return n.length?`${t} -> ${n.join(",")}`:t}))}return r.size?[[...r].join(","),[...a].join(",")]:[]}function s(e,t){if("string"==typeof e&&!e.startsWith("<"))return[];let n=o[e];if(!n&&t.getMetadata("ALT",e)&&(n="sequence_variant"),n)return[n,e];const r=e.split(":");return r.length>1?s(`<${r.slice(0,-1).join(":")}>`,t):[]}function l(e,t){if((0,r.h)(t))return["breakend",t];if(1===e.length&&1===t.length)return["SNV",d("SNV",e,t)];if("<INS>"===t)return["insertion",t];if("<DEL>"===t)return["deletion",t];if("<DUP>"===t)return["duplication",t];if("<CNV>"===t)return["cnv",t];if("<INV>"===t)return["inversion",t];if("<TRA>"===t)return["translocation",t];if(t.includes("<"))return["sv",t];if(e.length===t.length){const n=e.length,r=t.length;if(n>5||r>5){const o=(0,a.getBpDisplayStr)(n),i=(0,a.getBpDisplayStr)(r);return e.split("").reverse().join("")===t?["inverson",d("inv",o,i)]:["substitution",d("substitution",o,i)]}return e.split("").reverse().join("")===t?["inversion",d("inv",e,t)]:["substitution",d("substitution",e,t)]}if(e.length<=t.length){const n=t.length-e.length,r=t.length,o=e.length,i=(0,a.getBpDisplayStr)(n);return["insertion",o>5||r>5?`${i} INS`:d("insertion",n>5?i:e,t)]}if(e.length>t.length){const n=e.length,r=t.length,o=(0,a.getBpDisplayStr)(n-r);return["deletion",n>5||r>5?`${o} DEL`:d("deletion",e,t)]}return["indel",d("indel",e,t)]}function c(e,t){if((0,r.h)(t))return t;if(1===e.length&&1===t.length)return t;if("<INS>"===t)return t;if("<DEL>"===t)return t;if("<DUP>"===t)return t;if("<CNV>"===t)return t;if("<INV>"===t)return t;if("<TRA>"===t)return t;if(t.includes("<"))return t;if(e.length===t.length){const n=e.length,r=t.length;if(n>5||r>5){const o=(0,a.getBpDisplayStr)(n),i=(0,a.getBpDisplayStr)(r);return e.split("").reverse().join("")===t?d("inv",o,i):d("substitution",o,i)}return e.split("").reverse().join("")===t?d("inv",e,t):d("substitution",e,t)}if(e.length<=t.length){const n=t.length-e.length,r=t.length,o=e.length,i=(0,a.getBpDisplayStr)(n);return o>5||r>5?`${i} INS`:d("insertion",n>5?i:e,t)}if(e.length>t.length){const n=e.length,r=t.length,o=(0,a.getBpDisplayStr)(n-r);return n>5||r>5?`${o} DEL`:d("deletion",e,t)}return d("indel",e,t)}function d(e,t,n){return`${e} ${[t,n].join(" -> ")}`}function u(e,t,n){return e.split(/[/|]/).map(e=>"."===e?".":0===+e?`ref(${t.length<10?t:(0,a.getBpDisplayStr)(t.length)})`:c(t,n[+e-1]||"")).join(e.includes("|")?"|":"/")}},73716:(e,t,n)=>{n.d(t,{A:()=>y});var r=n(67758),a=n(7552),o=n(67112),i=n(9236),s=n(99546),l=n(68446),c=n(75785),d=n(69500);const u=(0,c.n9)()({resizeHandle:{height:4,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}),p=(0,l.observer)(function({children:e,model:t,exportSVG:n}){const{height:r}=t,{width:a,offsetPx:o}=(0,s.getContainingView)(t),i=Math.max(0,-o);return n?(0,d.jsx)("g",{transform:`translate(${i})`,children:e}):(0,d.jsx)("svg",{style:{position:"absolute",top:0,left:i,height:r,width:a},children:e})}),h=(0,l.observer)(function({model:e,exportSVG:t}){const{classes:n}=u(),{assemblyManager:r}=(0,s.getSession)(e),i=(0,s.getContainingView)(e),[l,c]=(0,a.useState)(),{lineZoneHeight:h,featuresVolatile:g}=e,{assemblyNames:y,dynamicBlocks:b}=i,w=r.get(y[0]),v=(b.contentBlocks[0]?.widthPx||0)/(g?.length||1);return w&&g?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(p,{exportSVG:t,model:e,children:[(0,d.jsx)(f,{model:e,setMouseOverLine:c}),l?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("line",{stroke:"#f00c",strokeWidth:2,style:{pointerEvents:"none"},x1:l.idx*v+v/2,x2:l.c,y1:h,y2:0,onMouseLeave:()=>{c(void 0)}}),(0,d.jsx)(m,{contents:l.f.get("name")})]}):null]}),t?null:(0,d.jsx)(o.ResizeHandle,{style:{position:"absolute",top:h-4},onDrag:t=>e.setLineZoneHeight(h+t),className:n.resizeHandle})]}):null}),g=(0,a.forwardRef)(function(e,t){const n=(0,r.c)(5),{message:i}=e;let s,l;return n[0]!==i?(s=(0,a.isValidElement)(i)?i:i?(0,d.jsx)(o.SanitizedHTML,{html:String(i)}):null,n[0]=i,n[1]=s):s=n[1],n[2]!==t||n[3]!==s?(l=(0,d.jsx)("div",{ref:t,children:s}),n[2]=t,n[3]=s,n[4]=l):l=n[4],l}),m=(0,l.observer)(function({contents:e}){return e?(0,d.jsx)(i.A,{children:(0,d.jsx)(g,{message:e})}):null}),f=(0,l.observer)(function({model:e,setMouseOverLine:t}){const{assemblyManager:n}=(0,s.getSession)(e),r=(0,s.getContainingView)(e),{lineZoneHeight:a,featuresVolatile:o}=e,{offsetPx:i,assemblyNames:l,dynamicBlocks:c}=r,u=n.get(l[0]),p=(c.contentBlocks[0]?.widthPx||0)/(o?.length||1),h=Math.max(i,0);return u&&o?(0,d.jsx)(d.Fragment,{children:o.map((e,n)=>{const o=e.get("refName"),i=(r.bpToPx({refName:u.getCanonicalRefName(o)||o,coord:e.get("start")})?.offsetPx||0)-h;return(0,d.jsx)("line",{stroke:"#0004",strokeWidth:1,x1:n*p+p/2,x2:i,y1:a,y2:0,onMouseEnter:()=>{t({f:e,idx:n,c:i})},onMouseLeave:()=>{t(void 0)}},e.id())})}):null}),y=h},75429:(e,t,n)=>{n.r(t),n.d(t,{YSCALEBAR_LABEL_OFFSET:()=>i,fillRectCtx:()=>p,getNiceDomain:()=>c,getOrigin:()=>l,getScale:()=>s,round:()=>u,toP:()=>d});var r=n(45824),a=n(35873),o=n(6754);const i=5;function s({domain:e=[],range:t=[],scaleType:n,pivotValue:i,inverted:s}){let l;const[c,d]=e;if(void 0===c||void 0===d)throw new Error("invalid domain");if("linear"===n)l=(0,r.A)();else if("log"===n)l=(0,a.A)().base(2);else{if("quantize"!==n)throw new Error("undefined scaleType");l=(0,o.A)()}l.domain(void 0!==i?[c,i,d]:[c,d]),l.nice();const[u,p]=t;if(void 0===u||void 0===p)throw new Error("invalid range");return l.range(s?t.slice().reverse():t),l}function l(e){return"log"===e?1:0}function c({scaleType:e,domain:t,bounds:n}){const[i,s]=n;let[l,c]=t;"linear"===e&&(c<0&&(c=0),l>0&&(l=0)),"log"===e&&l>=0&&c>1&&(l=1),void 0!==i&&i!==Number.MIN_VALUE&&(l=i),void 0!==s&&s!==Number.MAX_VALUE&&(c=s);const d=(e=>{if("linear"===e)return(0,r.A)();if("log"===e){const e=(0,a.A)();return e.base(2),e}if("quantize"===e)return(0,o.A)();throw new Error(`undefined scaleType ${e}`)})(e);return d.domain([l,c]),d.nice(),d.domain()}function d(e=0){return+e.toPrecision(6)}function u(e){return Math.round(1e5*e)/1e5}function p(e,t,n,r,a,o){n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),o&&(a.fillStyle=o),a.fillRect(e,t,n,r)}},75762:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(65944);class a{indexData=[];constructor({rectangles:e,totalHeight:t,maxHeightReached:n}){this.rectangles=new Map(Object.entries(e)),this.totalHeight=t,this.maxHeightReached=n,this.buildIndex()}buildIndex(){if(0!==this.rectangles.size){this.index=new r.A(this.rectangles.size),this.indexData=[];for(const[e,t]of this.rectangles)this.index.add(t[0],t[1],t[2],t[3]),this.indexData.push({name:e,rect:t});this.index.finish()}}addRect(e){const t=this.rectangles.get(e);if(!t)throw new Error(`id ${e} not found in precomputed feature layout`);return t[1]}getRectangles(){return this.rectangles}getTotalHeight(){return this.totalHeight}collides(e,t){throw new Error("Method not implemented.")}getByCoord(e,t){if(!this.index)return;const n=this.index.search(e,t,e+1,t+1);return n.length>0?this.indexData[n[0]]?.name:void 0}getByID(e){return this.rectangles.get(e)}addRectToBitmap(e,t){throw new Error("Method not implemented.")}discardRange(e,t){throw new Error("Method not implemented.")}serializeRegion(e){throw new Error("Method not implemented.")}toJSON(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}},76239:(e,t,n)=>{n.d(t,{Es:()=>l,Gu:()=>a,Ij:()=>r,P5:()=>c,Rd:()=>s,i3:()=>i,jE:()=>o});const r=48,a=20,o=17,i=3,s=2,l=7,c=32},76530:(e,t,n)=>{n.d(t,{$G:()=>i,Db:()=>s,fK:()=>l,mh:()=>a});var r=n(99546);class a{constructor(e=[]){this.blocks=e}push(e){if("ElidedBlock"===e.type&&this.blocks.length>0){const t=this.blocks.at(-1);if("ElidedBlock"===t?.type)return void t.push(e)}this.blocks.push(e)}getBlocks(){return this.blocks}getRegions(){return this.blocks.map(e=>e.toRegion())}map(e,t){return this.blocks.map(e,t)}forEach(e,t){this.blocks.forEach(e,t)}get length(){return this.blocks.length}get totalWidthPx(){return this.blocks.length>0?(0,r.sum)(this.blocks.map(e=>e.widthPx)):0}get totalWidthPxWithoutBorders(){return this.blocks.length>0?(0,r.sum)(this.blocks.filter(e=>"boundary"!==e.variant).map(e=>e.widthPx)):0}get offsetPx(){return this.blocks.length>0?this.blocks[0].offsetPx:0}get contentBlocks(){return this.blocks.filter(e=>"ContentBlock"===e.type)}get totalBp(){return(0,r.sum)(this.contentBlocks.map(e=>e.end-e.start))}}class o{type="BaseBlock";widthPx=0;constructor(e){Object.assign(this,e),this.assemblyName=e.assemblyName,this.refName=e.refName,this.start=e.start,this.end=e.end,this.key=e.key,this.offsetPx=e.offsetPx}toRegion(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}class i extends o{type="ContentBlock"}class s extends o{type="ElidedBlock";elidedBlockCount=0;constructor(e){super(e),this.widthPx=e.widthPx}push(e){this.elidedBlockCount+=1,this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx}}class l extends o{type="InterRegionPaddingBlock"}},80208:(e,t,n)=>{n.r(t),n.d(t,{contrastingTextColor:()=>s,emphasize:()=>c,isNamedColor:()=>i,makeContrasting:()=>d,namedColorToHex:()=>o,randomColor:()=>u});var r=n(62266);const a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(e){return a[e]}function i(e){return!!a[e]}function s(e){return l(e)>.5?"black":"white"}function l(e){const t=o(e);return(0,r.J1)(t||e)}function c(e,t=.15){const n=o(e);return(0,r.tL)(n||e,t)}function d(e,t="white",n=3){let a=o(e)||e;const i=o(t)||t,s=l(i);let c=(0,r.eM)(a,i);const d=a;let u=.05;for(;c<n;)a=s>.5?(0,r.e$)(d,u):(0,r.a)(d,u),u+=.05,c=(0,r.eM)(a,i);return a}function u(e){let t=0;for(let n=0;n<e.length;n++)t+=e.charCodeAt(n);return`hsl(${10*t}, 50%, 50%)`}},80256:(e,t,n)=>{n.d(t,{X:()=>o});var r=n(99546),a=n(91468);async function o({self:e,tag:t,blocks:n,opts:o}){const{rpcManager:i}=(0,r.getSession)(e),{adapterConfig:s}=e,l=(0,a.getRpcSessionId)(e);return await i.call((0,a.getRpcSessionId)(e),"PileupGetGlobalValueForTag",{adapterConfig:s,tag:t,sessionId:l,regions:n.contentBlocks,...o})}},80703:(e,t,n)=>{n.d(t,{L:()=>a});var r=n(26257);function a(e={}){return`${(0,r.A)(e)}`}},83059:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(69481),a=n(68584),o=n(43334);class i{adapterCache=new o.A({maxSize:15});constructor(e){this.pluginManager=e}loadTextSearchAdapters(e){return Promise.all(this.relevantAdapters(e).map(async e=>{const t=(0,a.readConfObject)(e,"textSearchAdapterId"),n=this.adapterCache.get(t);if(n)return n;{const n=this.pluginManager.getTextSearchAdapterType(e.type),r=new(await n.getAdapterClass())(e,void 0,this.pluginManager);return this.adapterCache.set(t,r),r}}))}relevantAdapters(e){const t=this.pluginManager.rootModel,{aggregateTextSearchAdapters:n}=t?.jbrowse,{tracks:r}=t?.session,{assemblyName:a}=e;return[...this.getAdaptersWithAssembly(a,n),...this.getTrackAdaptersWithAssembly(a,r)]}getAdaptersWithAssembly(e,t){return t.filter(t=>(0,a.readConfObject)(t,"assemblyNames")?.includes(e))}getTrackAdaptersWithAssembly(e,t){return t.filter(t=>(0,a.readConfObject)(t,["textSearching","textSearchAdapter","assemblyNames"])?.includes(e)).map(e=>e.textSearching.textSearchAdapter)}async search(e,t,n){return this.search2({args:e,searchScope:t,rankFn:n})}async search2({args:e,searchScope:t,rankFn:n}){const r=await this.loadTextSearchAdapters(t),a=await Promise.all(r.map(t=>t.searchIndex(e)));return this.sortResults2({args:e,results:a.flat(),rankFn:n})}sortResults2({results:e,rankFn:t,args:n}){const a=new r.A({}),o=e.map(e=>e.getDisplayString()),i=n.queryString,s=a.filter(o,i),l=[];if(null!=s&&s.length>0){const t=a.info(s,o,i),n=a.sort(t,o,i);for(const r of n)l.push(e[t.idx[r]])}return t(l)}}},84481:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(99546),a=n(68446),o=n(50574),i=n(76239),s=n(69500);function l(e,t,n,r,a){return`M${e},${t}h${n-a}a${a},${a} 0 0 1 ${a},${a}v${r-2*a}a${a},${a} 0 0 1 ${-a},${a}h${a-n}z`}function c(e,t,n,r){return[[e,0],[e+n,r/2],[e,r]].toString()}function d(e,t,n,r){return[[e,r/2],[e+n,0],[e+n,r]].toString()}const u={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos33:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos66:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},p=(0,a.observer)(function({overview:e,block:t,assembly:n}){const{offsetPx:a,reversed:p}=t,h=(0,o.S5)(n,t.refName),g=p?h.length-1:0,m=p?0:h.length-1,f=i.Gu;let y=!1,b="",w=0;return(0,s.jsx)("g",{transform:`translate(-${a})`,children:h.map((t,n)=>{const a=JSON.stringify(t),{refName:o,name:i,type:h,start:v,end:S}=t,x=e.bpToPx({refName:o,coord:v})||0,C=e.bpToPx({refName:o,coord:S})||0,k=Math.min(x,C),T=Math.abs(C-x);if("n/a"===h){const e=i?.match(/^(\d+)([A-Za-z])/),t=e[1]+e[2];t&&t!==b&&(b=t,w++)}const A="n/a"===h?w%2?"black":"#a77":u[h]||"black";return"acen"!==h||y?"acen"===h&&y?(0,s.jsx)("polygon",{points:p?c(x-T,0,T,f):d(x,0,T,f),...(0,r.getFillProps)(A)},a):g===n?(0,s.jsx)("path",{d:(M=k,P=T,R=f,`M${M+8},0h${P-8}v${R}h${8-P}a8,8 0 0 1 -8,-8v${16-R}a8,8 0 0 1 8,-8z`),...(0,r.getFillProps)(A)},a):m===n?(0,s.jsx)("path",{d:l(k,0,T,f,8),...(0,r.getFillProps)(A)},a):(0,s.jsx)("rect",{x:k,y:0,width:T,height:f,...(0,r.getFillProps)(A)},a):(y=!0,(0,s.jsx)("polygon",{points:p?d(x-T,0,T,f):c(x,0,T,f),...(0,r.getFillProps)(A)},a));var M,P,R})})})},85012:(e,t,n)=>{n.d(t,{A:()=>i});const r=1e4;function a(e,t,n,r){return t>=n&&r>=e}class o{padding=1;widthLimit=1e6;setAllFilled(e){this.allFilled=e}getItemAt(e){return this.allFilled?this.allFilled:void 0===this.rowState?.min||e<this.rowState.min||e>=this.rowState.max?void 0:this.rowState.bits[e-this.rowState.offset]}isRangeClear(e,t){if(this.allFilled)return!1;if(void 0===this.rowState||t<=this.rowState.min||e>=this.rowState.max)return!0;const{min:n,max:r,offset:a,bits:o}=this.rowState,i=Math.min(r,t)-a;let s=!0;for(let t=Math.max(n,e)-a;t<i&&s;t++)s=void 0===o[t];return s}initialize(e,t){const n=t-e;return{offset:e-n,min:e,max:t,bits:Array.from({length:3*n})}}addRect(e,t){const n=e.l,r=e.r+this.padding;this.rowState||(this.rowState=this.initialize(n,r));let a=n-this.rowState.offset,o=r-this.rowState.offset;const i=this.rowState.bits.length;if(o>=this.rowState.bits.length){const e=o+1;this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):e>0&&(this.rowState.bits=[...this.rowState.bits,...Array.from({length:e})])}if(n<this.rowState.offset){const e=Math.min(i-a,this.rowState.offset);this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):(this.rowState.bits=[...Array.from({length:e}),...this.rowState.bits],this.rowState.offset-=e)}o=r-this.rowState.offset,a=n-this.rowState.offset;const s=o-a;s>2e4&&console.warn(`Layout X pitch set too low, feature spans ${s} bits in a single row.`,e,t);for(let e=a;e<o;e+=1)this.rowState.bits[e]=t;n<this.rowState.min&&(this.rowState.min=n),r>this.rowState.max&&(this.rowState.max=r)}discardRange(e,t){if(this.allFilled)return;if(!this.rowState)return;if(t<=this.rowState.min||e>=this.rowState.max)return;if(e<=this.rowState.min&&t>=this.rowState.max)return void(this.rowState=void 0);if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-r&&this.rowState.bits.length>this.rowState.max+r-this.rowState.offset){const e=this.rowState.min-this.rowState.offset,t=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(e,this.rowState.bits.length-t),this.rowState.offset+=e}else if(this.rowState.offset<this.rowState.min-r){const e=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,e),this.rowState.offset+=e}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+r){const e=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=e}const n=Math.max(this.rowState.min,e)-this.rowState.offset,a=Math.min(t,this.rowState.max)-this.rowState.offset;for(let e=n;e>=0&&e<a;e+=1)this.rowState.bits[e]=void 0}}class i{constructor({pitchX:e=10,pitchY:t=10,maxHeight:n=1e4,hardRowLimit:r=1e4,displayMode:a="normal"}={}){this.pitchX=e,this.pitchY=t,this.hardRowLimit=r,this.maxHeightReached=!1,this.displayMode=a,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(n/this.pitchY),this.pTotalHeight=0}addRect(e,t,n,r,a){const o=this.rectangles.get(e);if(o)return null===o.top?null:(this.addRectToBitmap(o),o.top*this.pitchY);const i=Math.floor(t/this.pitchX),s=Math.floor(n/this.pitchX),l=Math.ceil(r/this.pitchY),c={id:e,l:i,r:s,top:null,h:l,originalHeight:r,data:a},d=this.maxHeight-l;let u=0;if("collapse"!==this.displayMode){for(;u<=d&&this.collides(c,u);u+=1);if(u>d)return c.top=null,this.rectangles.set(e,c),this.maxHeightReached=!0,null}return c.top=u,this.addRectToBitmap(c),this.rectangles.set(e,c),this.pTotalHeight=Math.max(this.pTotalHeight||0,u+l),u*this.pitchY}collides(e,t){const{bitmap:n}=this,r=t+e.h;for(let a=t;a<r;a+=1){const t=n[a];if(void 0!==t&&!t.isRangeClear(e.l,e.r))return!0}return!1}autovivifyRow(e,t){let n=e[t];if(!n){if(t>this.hardRowLimit)throw new Error(`layout hard limit (${this.hardRowLimit*this.pitchY}px) exceeded, aborting layout`);n=new o,e[t]=n}return n}addRectToBitmap(e){if(null===e.top)return;const t=e.id,n=e.top+e.h;if(e.r-e.l>2e4)for(let r=e.top;r<n;r+=1)this.autovivifyRow(this.bitmap,r).setAllFilled(t);else for(let r=e.top;r<n;r+=1)this.autovivifyRow(this.bitmap,r).addRect(e,t)}discardRange(e,t){const n=Math.floor(e/this.pitchX),r=Math.floor(t/this.pitchX),{bitmap:a}=this;for(const e of a)e.discardRange(n,r)}hasSeen(e){return this.rectangles.has(e)}getByCoord(e,t){const n=Math.floor(t/this.pitchY),r=this.bitmap[n];if(!r)return;const a=Math.floor(e/this.pitchX);return r.getItemAt(a)}getByID(e){const t=this.rectangles.get(e);if(t){const e=t.top*this.pitchY;return[t.l*this.pitchX,e,t.r*this.pitchX,e+t.originalHeight]}}getDataByID(e){return this.rectangles.get(e)?.data}cleanup(){}getTotalHeight(){return this.pTotalHeight*this.pitchY}get totalHeight(){return this.getTotalHeight()}getRectangles(){return new Map([...this.rectangles.entries()].map(([e,t])=>{const{l:n,r,originalHeight:a,top:o}=t,i=(o||0)*this.pitchY,s=i+a;return[e,[n*this.pitchX,i,r*this.pitchX,s]]}))}serializeRegion(e){const t={};let n=!1;for(const[r,o]of this.rectangles.entries()){const{l:i,r:s,originalHeight:l,top:c}=o;if(null===o.top)n=!0;else{const n=(c||0)*this.pitchY,o=n+l,d=i*this.pitchX,u=s*this.pitchX;a(e.start,e.end,d-this.pitchX,u+this.pitchX)&&(t[r]=[d,n,u,o])}}return{rectangles:t,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:n}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}},85497:(e,t,n)=>{n.d(t,{Cg:()=>o});var r=n(99546);function a(e){let t,n=0;for(const[r,a]of Object.entries(e))"."!==r&&"0"!==r&&a>n&&(t=r,n=a);return t}function o({features:e,minorAlleleFrequencyFilter:t,lengthCutoffFilter:n,stopToken:o}){const i=[];return(0,r.forEachWithStopTokenCheck)(e,o,e=>{if(e.get("end")-e.get("start")<=n){const n=function(e){const t=e.get("genotypes"),n={0:0,1:0,".":0},r={},a=Object.values(t),o=a.length;for(let e=0;e<o;e++){const t=a[e],o=r[t]||(r[t]=t.split(/[/|]/));for(let e=0,t=o.length;e<t;e++){const t=o[e];n[t]=(n[t]??0)+1}}return n}(e);(function(e){return function(e){let t=0,n=0;for(const r of e)r>t?(n=t,t=r):r>n&&r!==t&&(n=r);return n}(Object.values(e))/((0,r.sum)(Object.values(e))||1)})(n)>=t&&i.push({feature:e,mostFrequentAlt:a(n),alleleCounts:n})}}),i}},86576:(e,t,n)=>{n.d(t,{Iw:()=>u,c$:()=>l,il:()=>c,rT:()=>h,rr:()=>d,vi:()=>p});var r=n(42489),a=n(36422),o=n(44728),i=n(82088),s=n(57240);function l(e,t,n){const r=e.get("tags");return r[t]??r[n]}const c={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}},d={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"};async function u(e,t){const{start:n,end:r,originalRefName:a,refName:s}=e,l=await(0,o._)(t.getFeatures({...e,refName:a||s,end:r,start:n}).pipe((0,i.$)()));return l[0]?.get("seq")}function p(e,t,n){(0,a.addDisposer)(e,(0,r.autorun)(async()=>{try{await t()}catch(t){(0,a.isAlive)(e)&&e.setError(t)}},n))}function h(e){return s.R[e]?.color||function(e){let t=0;for(let n=0;n<e.length;n++)t+=e.charCodeAt(n);return`hsl(${10*t}, 20%, 50%)`}(e)}},87485:(e,t,n)=>{n.d(t,{M:()=>r.Mj});var r=n(76958),a=n(8145),o=n(81687);(0,r.X$)([a.A,o.A])},88217:(e,t,n)=>{n.r(t),n.d(t,{GranularRectLayout:()=>r.A,MultiLayout:()=>a.A,PrecomputedLayout:()=>o.A,PrecomputedMultiLayout:()=>s,SceneGraph:()=>l});var r=n(85012),a=n(2265),o=n(75762);class i{constructor(){throw new Error("invalid layout name")}}class s extends a.A{constructor(e){super(i);for(const[t,n]of Object.entries(e))this.subLayouts.set(t,new o.A(n))}}class l{constructor(e,t,n,r,a,o){this.name=e,this.left=t,this.top=n,this.width=r,this.height=a,this.data=o,this.children=new Map,this.absoluteCache={dirty:!0}}addChild(e,t,n,r,a,o){const i=e instanceof l?e:new l(e,t,n,r,a,o);if(!(i instanceof l))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(i.name))throw new Error(`child named "${i.name}" already exists`);i.parent=this;const{left:s,right:c,top:d,bottom:u}=i.absolute;return void 0!==s&&void 0!==c&&void 0!==d&&void 0!==u&&(this.expand(s,c,d,u),this.children.set(i.name,i)),i}getSubRecord(e){return this.children.get(e)}expand(e,t,n,r){const{left:a,right:o,top:i,bottom:s}=this.absolute;if(void 0!==a&&e<a){const t=a-e;this.width+=t,this.left-=t}if(void 0!==o&&t>o&&(this.width+=t-o),void 0!==i&&n<i){const e=i-n;this.height+=e,this.top-=e}void 0!==s&&r>s&&(this.height+=r-s),this.parent&&this.parent.expand(e,t,n,r),this.absoluteCache.dirty=!0}get bottom(){return this.top+this.height}get right(){return this.left+this.width}walkParents(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}walkChildren(e){for(const t of this.children.values())e(t),t.walkChildren(e)}get absolute(){if(this.absoluteCache.dirty){let e=0,t=0;this.walkParents(n=>{e+=n.left,t+=n.top}),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}move(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren(e=>{e.absoluteCache.dirty=!0});const{left:n,right:r,top:a,bottom:o}=this.absolute;void 0!==n&&void 0!==r&&void 0!==a&&void 0!==o&&this.expand(n,r,a,o)}}},88262:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(7552),a=n(9236),o=n(68446),i=n(75785),s=n(75429),l=n(69500);const c=(0,i.n9)()({hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:s.YSCALEBAR_LABEL_OFFSET,cursor:"default",position:"absolute",pointerEvents:"none"}}),d=(0,o.observer)(function({model:e,height:t,clientMouseCoord:n,offsetMouseCoord:o,clientRect:i,TooltipContents:d,useClientY:u}){const{featureUnderMouse:p}=e,{classes:h}=c(),g=n[0]+5,m=u?n[1]:i?.top||0;return p?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Suspense,{fallback:null,children:(0,l.jsx)(a.A,{clientPoint:{x:g,y:m},children:(0,l.jsx)(d,{model:e,feature:p})})}),(0,l.jsx)("div",{className:h.hoverVertical,style:{left:o[0],height:t-2*s.YSCALEBAR_LABEL_OFFSET}})]}):null})},88530:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(36422),a=n(99546),o=n(76530);function i(e,t=!0,n=!0,i=0,s=800){const{offsetPx:l,displayedRegions:c,bpPerPx:d,minimumBlockWidth:u,interRegionPaddingWidth:p,width:h}=e,g=l*d,m=(l+h)*d,f=s,y=Math.ceil(f*d);let b=0;const w=new o.mh;for(let e=0;e<c.length;e++){const l=c[e],{assemblyName:h,refName:f,start:v,end:S,reversed:x}=l,C=Math.ceil((S-v)/y),k=(0,r.isStateTreeNode)(l)?(0,r.getSnapshot)(l):l;let T=Math.floor((m-b)/y)+i;T>=C&&(T=C-1);let A=Math.floor((g-b)/y)-i;A<0&&(A=0);const M=(S-v)/d;for(let r=A;r<=T;r+=1){let i,l,g,m;x?(i=Math.max(v,S-(r+1)*y),l=S-r*y,g=l===S,m=i===v):(i=v+r*y,l=Math.min(S,v+(r+1)*y),g=i===v,m=l===S);const C={assemblyName:h,refName:f,start:i,end:l,reversed:x,offsetPx:(b+r*y)/d,parentRegion:k,regionNumber:e,widthPx:(l-i)/d,isLeftEndOfDisplayedRegion:g,isRightEndOfDisplayedRegion:m,key:""};C.key=`${(0,a.assembleLocStringFast)(C)}-${e}${x?"-reversed":""}`,t&&0===e&&0===r&&w.push(new o.fK({key:`${C.key}-beforeFirstRegion`,widthPx:s,offsetPx:C.offsetPx-s,variant:"boundary"})),n&&M<u?w.push(new o.Db(C)):w.push(new o.$G(C)),t&&(M>=u&&C.isRightEndOfDisplayedRegion&&e<c.length-1&&(b+=p*d,w.push(new o.fK({key:`${C.key}-rightpad`,widthPx:p,offsetPx:C.offsetPx+C.widthPx}))),e===c.length-1&&C.isRightEndOfDisplayedRegion&&(b+=p*d,w.push(new o.fK({key:`${C.key}-afterLastRegion`,widthPx:s,offsetPx:C.offsetPx+C.widthPx,variant:"boundary"}))))}b+=S-v}return w}},90257:(e,t,n)=>{function r(e,t,n=!0){const{assemblyName:r,refName:a,start:o,offset:i,oob:s}=t.pxToBp(e),l=Math.floor(o+i);return s?"out of bounds":`${n?`{${r}}`:""}${a}:${l.toLocaleString("en-US")}`}function a(e,t,n){const r=new Set,a=[...e].sort((e,t)=>{const n=e.end-e.start;return t.end-t.start-n}),o=Array.from({length:Math.round(t)});for(const{key:e,offsetPx:i}of a){const a=Math.round(t-i+n),s=[Math.max(a-12,0),a];0===a||o.slice(...s).some(Boolean)?r.add(e):o.fill(!0,...s)}return r}function o(e,t,n=!0,r=!0){const a=[],o=function(e){const t=60*(e=Math.abs(e));let n=10**+t.toExponential().split(/e/i)[1];for(;n<t&&(n*=2,!(n>=t));)n*=2.5;n=Math.max(n,5);const r=n/e;let a=0;return!(n%10)&&r/10>=15?a=n/10:!(n%5)&&r/5>=15?a=n/5:!(n%2)&&r/2>=15&&(a=n/2),{majorPitch:n,minorPitch:a}}(t),i=o.minorPitch||o.majorPitch;for(const{start:t,end:s,refName:l}of e){let e=0;const c=t,d=s;for(let s=Math.floor(c/i)*i;s<Math.ceil(d/i)*i+1;s+=i)r&&s%o.majorPitch?(a.push({type:"minor",base:s-1,index:e,refName:l}),e+=1):n&&Math.abs(s-t)>o.minorPitch&&(a.push({type:"major",base:s-1,index:e,refName:l}),e+=1)}return a}n.d(t,{H2:()=>o,rQ:()=>a,wJ:()=>r})},90461:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(51414),a=n(68446),o=n(77126),i=n(69500);const s=(0,a.observer)(function({model:e,orientation:t}){const{ticks:n}=e,a=(0,r.A)();return n?(0,i.jsx)(o.Axis,{...n,shadow:2,format:e=>e,style:{orient:"left"===t?o.LEFT:o.RIGHT},bg:a.palette.background.default,fg:a.palette.text.primary}):null})},90863:(e,t,n)=>{n.d(t,{Lr:()=>L,GQ:()=>q,LW:()=>x.A,e6:()=>A,$m:()=>Dt.$,zh:()=>Dt.z,Gd:()=>Ct,_e:()=>P,Ki:()=>l,Ay:()=>Gt,Gx:()=>Q,lw:()=>Z,bN:()=>ae,mJ:()=>Ht.m});var r=n(12678),a=n(68584),o=n(99546),i=n(97539),s=n(36422);const l=(0,a.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"},height:{type:"number",defaultValue:100,description:"default height for the track"},mouseover:{type:"string",description:"text to display when the cursor hovers over a feature",defaultValue:"jexl:join('<br/>',get(feature,'_mouseOver')||get(feature,'name')||get(feature,'id'),mouseoverExtraInformation||'')",contextVariable:["feature","mouseoverExtraInformation"]},jexlFilters:{type:"stringArray",description:"default set of jexl filters to apply to a track. note: these do not use the jexl prefix because they have a deferred evaluation system",defaultValue:[]}},{explicitIdentifier:"displayId"});var c=n(7552),d=n(1622);class u{constructor(e){this.submaps=e}has(e){for(const t of this.submaps.values())if(t.has(e))return!0;return!1}get(e){for(const t of this.submaps.values())if(t.has(e))return t.get(e)}*values(){for(const e of this.keys())yield this.get(e)}*keys(){const e=new Set;for(const t of this.submaps.values())for(const n of t.keys())e.add(n);for(const t of e)yield t}find(e){for(const t of this.submaps.values())for(const n of t.values())if(e(n))return n}*[Symbol.iterator](){for(const e of this.keys())yield[e,this.get(e)]}*entries(){for(const e of this.keys())yield[e,this.get(e)]}}var p=n(91468),h=n(12196),g=n(8328),m=n(28129),f=n(31409),y=n.n(f),b=n(42489),w=n(21479),v=n(69092),S=n(68446),x=n(37205),C=n(69500);const k=(0,S.observer)(function({model:e}){const{regionTooLargeReason:t}=e;return(0,C.jsx)(x.A,{severity:"warning",action:(0,C.jsx)(v.A,{onClick:()=>{(0,s.isAlive)(e)&&(e.setFeatureDensityStatsLimit(e.featureDensityStats),e.reload())},children:"Force load"}),message:[t,"Zoom in to see features or force load (may be slow)"].filter(e=>!!e).join(". ")})}),T=k;function A(){return s.types.model({userBpPerPxLimit:s.types.maybe(s.types.number),userByteSizeLimit:s.types.maybe(s.types.number)}).volatile(()=>({featureDensityStatsP:void 0,featureDensityStats:void 0,currStatsBpPerPx:0})).views(e=>({get currentBytesRequested(){return e.featureDensityStats?.bytes||0},get currentFeatureScreenDensity(){const t=(0,o.getContainingView)(e);return(e.featureDensityStats?.featureDensity||0)*t.bpPerPx},get maxFeatureScreenDensity(){return(0,a.getConf)(e,"maxFeatureScreenDensity")},get featureDensityStatsReady(){const t=(0,o.getContainingView)(e);return!(e.currStatsBpPerPx!==t.bpPerPx||!e.featureDensityStats&&!e.userBpPerPxLimit)},get maxAllowableBytes(){return e.userByteSizeLimit||e.featureDensityStats?.fetchSizeLimit||(0,a.getConf)(e,"fetchSizeLimit")}})).actions(e=>({afterAttach(){(0,s.addDisposer)(e,(0,b.autorun)(()=>async function(e){try{const t=(0,o.getContainingView)(e);if(!t.initialized||!t.staticBlocks.contentBlocks.length||t.bpPerPx===e.currStatsBpPerPx||e.error)return;if(void 0!==e.featureDensityStats?.featureDensity)return void e.setCurrStatsBpPerPx(t.bpPerPx);e.clearFeatureDensityStats(),e.setCurrStatsBpPerPx(t.bpPerPx);const n=await e.getFeatureDensityStats();(0,s.isAlive)(e)&&e.setFeatureDensityStats(n)}catch(t){console.error(t),(0,s.isAlive)(e)&&!(0,o.isAbortException)(t)&&e.setError(t)}}(e)))}})).actions(e=>({setCurrStatsBpPerPx(t){e.currStatsBpPerPx=t},setFeatureDensityStatsLimit(t){const n=(0,o.getContainingView)(e);t?.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=n.bpPerPx},getFeatureDensityStats(){return e.featureDensityStatsP||(e.featureDensityStatsP=(0,w.bf)(e).catch(t=>{throw(0,s.isAlive)(e)&&this.setFeatureDensityStatsP(void 0),t})),e.featureDensityStatsP},setFeatureDensityStatsP(t){e.featureDensityStatsP=t},setFeatureDensityStats(t){e.featureDensityStats=t},clearFeatureDensityStats(){e.featureDensityStatsP=void 0,e.featureDensityStats=void 0}})).views(e=>({get regionTooLarge(){const t=(0,o.getContainingView)(e);return!(!e.featureDensityStatsReady||t.dynamicBlocks.totalBp<2e4)&&(e.currentBytesRequested>e.maxAllowableBytes||(e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity))},get regionTooLargeReason(){const t=e.currentBytesRequested,n=e.maxAllowableBytes;return t&&t>n?`Requested too much data (${(0,w.W7)(t)})`:""}})).views(e=>({get statsReadyAndRegionNotTooLarge(){return e.featureDensityStatsReady&&!e.regionTooLarge},regionCannotBeRenderedText:t=>e.regionTooLarge?"Force load to see features":"",regionCannotBeRendered:t=>e.regionTooLarge?(0,C.jsx)(T,{model:e}):null}))}const M=20;function P(){return s.types.model({heightPreConfig:s.types.maybe(s.types.refinement("displayHeight",s.types.number,e=>e>=M))}).volatile(()=>({scrollTop:0})).views(e=>({get height(){return e.heightPreConfig??(0,a.getConf)(e,"height")}})).actions(e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,M),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n}}))}var R=n(52119);const I=(0,c.lazy)(()=>Promise.resolve().then(n.bind(n,2286))),L=s.types.compose("BaseLinearDisplay",d.BaseDisplay,P(),A(),s.types.model({blockState:s.types.map(R.A),configuration:(0,a.ConfigurationReference)(l)})).volatile(()=>({mouseoverExtraInformation:void 0,featureIdUnderMouse:void 0,contextMenuFeature:void 0})).views(e=>({get DisplayMessageComponent(){},get blockType(){return"staticBlocks"},get blockDefinitions(){const t=(0,o.getContainingView)(e);if(!t.initialized)throw new Error("view not initialized yet");return t[this.blockType]}})).views(e=>({get renderDelay(){return 50},get TooltipComponent(){return I},get selectedFeatureId(){if((0,s.isAlive)(e)){const{selection:t}=(0,o.getSession)(e);if((0,o.isFeature)(t))return t.id()}},copyInfoToClipboard(t){const{uniqueId:n,...r}=t.toJSON(),a=(0,o.getSession)(e);y()(JSON.stringify(r,null,4)),a.notify("Copied to clipboard","success")}})).views(e=>({get features(){const t=[];for(const n of e.blockState.values())n.features&&t.push(n.features);return new u(t)},get featureUnderMouse(){const t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},get layoutFeatures(){const t=[];for(const n of e.blockState.values())n.layout&&t.push(n.layout.rectangles);return new u(t)},getFeatureOverlapping:(t,n,r)=>e.blockState.get(t)?.layout?.getByCoord(n,r),getFeatureByID:(t,n)=>e.blockState.get(t)?.layout?.getByID(n),searchFeatureByID(t){let n;for(const r of e.blockState.values()){const e=r.layout?.getByID(t);e&&(n=e)}return n}})).actions(e=>({addBlock(t,n){e.blockState.set(t,R.A.create({key:t,region:n.toRegion()}))},deleteBlock(t){e.blockState.delete(t)},selectFeature(t){const n=(0,o.getSession)(e);if((0,o.isSessionModelWithWidgets)(n)){const{rpcManager:r}=n,i=(0,p.getRpcSessionId)(e),s=(0,o.getContainingTrack)(e),l=(0,o.getContainingView)(e),c=(0,a.getConf)(s,"adapter");(async()=>{try{const e=await r.call(i,"CoreGetMetadata",{adapterConfig:c});n.showWidget(n.addWidget("BaseFeatureWidget","baseFeature",{featureData:t.toJSON(),view:l,track:s,descriptions:e}))}catch(e){console.error(e),(0,o.getSession)(e).notifyError(`${e}`,e)}})()}(0,o.isSelectionContainer)(n)&&n.setSelection(t)},navToFeature(t){(0,o.getContainingView)(e).navTo({refName:t.get("refName"),start:t.get("start"),end:t.get("end")})},clearFeatureSelection(){(0,o.getSession)(e).clearSelection()},setFeatureIdUnderMouse(t){e.featureIdUnderMouse=t},setContextMenuFeature(t){e.contextMenuFeature=t},setMouseoverExtraInformation(t){e.mouseoverExtraInformation=t}})).actions(e=>{const{reload:t}=e;return{async reload(){e.setError(),e.setCurrStatsBpPerPx(0),e.clearFeatureDensityStats();for(const t of e.blockState.values())t.doReload();t()}}}).views(e=>({trackMenuItems:()=>[],contextMenuItems(){const t=e.contextMenuFeature;return t?[{label:"Open feature details",icon:m.A,onClick:()=>{e.selectFeature(t)}},{label:"Zoom to feature",icon:h.A,onClick:()=>{e.navToFeature(t)}},{label:"Copy info to clipboard",icon:g.A,onClick:()=>{e.copyInfoToClipboard(t)}}]:[]},renderProps:()=>({...(0,p.getParentRenderProps)(e),notReady:!e.featureDensityStatsReady,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick(t,n){const r=n||e.featureIdUnderMouse;if(r){const t=e.features.get(r);t&&e.selectFeature(t)}else e.clearFeatureSelection()},onClick(){e.clearFeatureSelection()},onFeatureContextMenu(t,n){const r=n||e.featureIdUnderMouse;r?e.setContextMenuFeature(e.features.get(r)):e.clearFeatureSelection()},onMouseMove(t,n,r){e.setFeatureIdUnderMouse(n),e.setMouseoverExtraInformation(r)},onMouseLeave(t){e.setFeatureIdUnderMouse(void 0),e.setMouseoverExtraInformation(void 0)},onContextMenu(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})})).actions(e=>({async renderSvg(t){const{renderBaseLinearDisplaySvg:r}=await n.e(3311).then(n.bind(n,23311));return r(e,t)},afterAttach(){(0,s.addDisposer)(e,(0,b.autorun)(()=>{const t={};if((0,o.getContainingView)(e).initialized){for(const n of e.blockDefinitions.contentBlocks)t[n.key]=!0,e.blockState.has(n.key)||e.addBlock(n.key,n);for(const n of e.blockState.keys())t[n]||e.deleteBlock(n)}}))}})).preProcessSnapshot(e=>{if(!e)return e;const{height:t,...n}=e;return{heightPreConfig:t,...n}}).postProcessSnapshot(e=>{const t=e,{blockState:n,...r}=t;return r});var F=n(75785),N=n(42752),D=n(67758);const B=(0,F.n9)()({heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:999,boxSizing:"border-box"}});function j(e){const t=(0,D.c)(5),{top:n}=e,{classes:r}=B();let a,o;return t[0]!==n?(a={top:n,pointerEvents:"none",height:16},t[0]=n,t[1]=a):a=t[1],t[2]!==r.heightOverflowed||t[3]!==a?(o=(0,C.jsx)("div",{className:r.heightOverflowed,style:a,children:"Max height reached"}),t[2]=r.heightOverflowed,t[3]=a,t[4]=o):o=t[4],o}const V=(0,S.observer)(function({model:e}){const{blockDefinitions:t,blockState:n}=e;return t.map(t=>{const r=`${e.id}-${t.key}`;if("ContentBlock"===t.type){const e=n.get(t.key);return(0,C.jsxs)(N.$G,{block:t,children:[e?.ReactComponent?(0,C.jsx)(e.ReactComponent,{model:e}):null,e?.maxHeightReached?(0,C.jsx)(j,{top:e.layout.getTotalHeight()-16}):null]},r)}if("ElidedBlock"===t.type)return(0,C.jsx)(N.Db,{width:t.widthPx},r);if("InterRegionPaddingBlock"===t.type)return(0,C.jsx)(N.fK,{width:t.widthPx,style:{background:"none"},boundary:"boundary"===t.variant},r);throw new Error(`invalid block type ${JSON.stringify(t)}`)})}),E=V,z=(0,F.n9)()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"}}),O=(0,S.observer)(function({model:e}){const{classes:t}=z(),{blockDefinitions:n}=e,r=(0,o.getContainingView)(e);return(0,C.jsx)("div",{className:t.linearBlocks,style:{left:n.offsetPx-r.offsetPx},children:(0,C.jsx)(E,{model:e})})}),H=O;var G=n(67112);const $=(0,S.observer)(function({onClose:e,contextCoord:t,model:n}){const r=n.contextMenuItems();return(0,C.jsx)(G.Menu,{open:r.length>0,onMenuItemClick:(t,n)=>{n(),e()},onClose:()=>{e(),n.setContextMenuFeature(void 0)},slotProps:{transition:{onExit:()=>{e(),n.setContextMenuFeature(void 0)}}},anchorReference:"anchorPosition",anchorPosition:{top:t[1],left:t[0]},menuItems:r})}),W=$;n(2286);const U=(0,F.n9)()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),_=(0,S.observer)(function(e){const{classes:t}=U(),n=(0,c.useRef)(null),[r,o]=(0,c.useState)(),[i,s]=(0,c.useState)([0,0]),[l,d]=(0,c.useState)([0,0]),[u,p]=(0,c.useState)(),{model:h,children:g}=e,{TooltipComponent:m,DisplayMessageComponent:f,height:y}=h;return(0,C.jsxs)("div",{ref:n,"data-testid":`display-${(0,a.getConf)(h,"displayId")}`,className:t.display,onContextMenu:e=>{e.preventDefault(),u?p(void 0):n.current&&p([e.clientX,e.clientY])},onMouseMove:e=>{if(!n.current)return;const t=n.current.getBoundingClientRect(),{left:r,top:a}=t;s([e.clientX-r,e.clientY-a]),d([e.clientX,e.clientY]),o(t)},children:[f?(0,C.jsx)(f,{model:h}):(0,C.jsx)(H,{...e}),g,(0,C.jsx)(c.Suspense,{fallback:null,children:(0,C.jsx)(m,{model:h,height:y,offsetMouseCoord:i,clientMouseCoord:l,clientRect:r,mouseCoord:i})}),u?(0,C.jsx)(W,{contextCoord:u,model:h,onClose:()=>{p(void 0)}}):null]})}),q=_;var J=n(58921);var X=n(6184);function Y(e,t,n){try{e.showTrack(t)}catch(e){if(!/Could not resolve identifier/.exec(`${e}`))throw e;n.push(t)}}function K(e){return(0,a.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})}function Q(e){return s.types.compose("LinearBareDisplay",L,s.types.model({type:s.types.literal("LinearBareDisplay"),configuration:(0,a.ConfigurationReference)(e)})).views(e=>({get rendererConfig(){const t=(0,a.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create(t,(0,o.getEnv)(e))},get rendererTypeName(){return(0,a.getConf)(e,["renderer","type"])}})).views(e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),...(0,p.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,config:e.rendererConfig})}})}const Z=function(e){return(0,a.ConfigurationSchema)("LinearBasicDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})};var ee=n(93100),te=n(20482);const ne=(0,c.lazy)(()=>n.e(4033).then(n.bind(n,34033))),re=(0,c.lazy)(()=>n.e(2412).then(n.bind(n,92412))),ae=function(e){return s.types.compose("LinearBasicDisplay",L,s.types.model({type:s.types.literal("LinearBasicDisplay"),trackShowLabels:s.types.maybe(s.types.boolean),trackShowDescriptions:s.types.maybe(s.types.boolean),trackDisplayMode:s.types.maybe(s.types.string),trackMaxHeight:s.types.maybe(s.types.number),configuration:(0,a.ConfigurationReference)(e),jexlFilters:s.types.maybe(s.types.array(s.types.string))})).views(e=>({get activeFilters(){return e.jexlFilters??(0,a.getConf)(e,"jexlFilters").map(e=>`jexl:${e}`)},get rendererTypeName(){return(0,a.getConf)(e,["renderer","type"])},get showLabels(){return e.trackShowLabels??(0,a.getConf)(e,["renderer","showLabels"])},get showDescriptions(){return e.trackShowDescriptions??(0,a.getConf)(e,["renderer","showDescriptions"])},get maxHeight(){return e.trackMaxHeight??(0,a.getConf)(e,["renderer","maxHeight"])},get displayMode(){return e.trackDisplayMode??(0,a.getConf)(e,["renderer","displayMode"])}})).views(e=>({get rendererConfig(){const t=(0,a.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,showLabels:e.showLabels,showDescriptions:e.showDescriptions,displayMode:e.displayMode,maxHeight:e.maxHeight},(0,s.getEnv)(e))}})).actions(e=>({setJexlFilters(t){e.jexlFilters=(0,s.cast)(t)},toggleShowLabels(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode(t){e.trackDisplayMode=t},setMaxHeight(t){e.trackMaxHeight=t}})).views(e=>{const{trackMenuItems:t,renderProps:n}=e;return{renderProps:()=>({...n(),config:e.rendererConfig,filters:new ee.A({filters:e.activeFilters})}),trackMenuItems:()=>[...t(),{label:"Show labels",icon:te.A,type:"checkbox",checked:e.showLabels,onClick:()=>{e.toggleShowLabels()}},{label:"Show descriptions",icon:te.A,type:"checkbox",checked:e.showDescriptions,onClick:()=>{e.toggleShowDescriptions()}},{label:"Display mode",icon:te.A,subMenu:["compact","reducedRepresentation","normal","collapse"].map(t=>({label:t,onClick:()=>{e.setDisplayMode(t)}}))},{label:"Set max height",onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[ne,{model:e,handleClose:t}])}},{label:"Edit filters",onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[re,{model:e,handleClose:t}])}}]}})};var oe=n(90542),ie=n(95095),se=n(97884),le=n(93707),ce=n(88530),de=n(8832),ue=n(83567),pe=n(41718),he=n(41562),ge=n(48747),me=n(34727),fe=n(31294),ye=n(66670),be=n(17914),we=n(45465),ve=n(36866),Se=n(12818),xe=n(52988),Ce=n(62266),ke=n(76239);const Te=(0,F.n9)()(e=>({panButton:{background:(0,Ce.X4)(e.palette.background.paper,.8),color:e.palette.text.primary,margin:ke.Es}}));function Ae(e){const t=(0,D.c)(15),{model:n}=e,{classes:r}=Te();let a,o,i,s,l,c,d;return t[0]!==n?(a=()=>{n.slide(-.9)},t[0]=n,t[1]=a):a=t[1],t[2]===Symbol.for("react.memo_cache_sentinel")?(o=(0,C.jsx)(Se.A,{}),t[2]=o):o=t[2],t[3]!==r.panButton||t[4]!==a?(i=(0,C.jsx)(v.A,{variant:"outlined",className:r.panButton,onClick:a,children:o}),t[3]=r.panButton,t[4]=a,t[5]=i):i=t[5],t[6]!==n?(s=()=>{n.slide(.9)},t[6]=n,t[7]=s):s=t[7],t[8]===Symbol.for("react.memo_cache_sentinel")?(l=(0,C.jsx)(xe.A,{}),t[8]=l):l=t[8],t[9]!==r.panButton||t[10]!==s?(c=(0,C.jsx)(v.A,{variant:"outlined",className:r.panButton,onClick:s,children:l}),t[9]=r.panButton,t[10]=s,t[11]=c):c=t[11],t[12]!==i||t[13]!==c?(d=(0,C.jsxs)(C.Fragment,{children:[i,c]}),t[12]=i,t[13]=c,t[14]=d):d=t[14],d}var Me=n(61282);const Pe=(0,F.n9)()({bp:{display:"flex",alignItems:"center",marginLeft:5,cursor:"pointer"}}),Re=(0,S.observer)(function({model:e}){const{classes:t}=Pe(),{coarseTotalBp:n}=e;return(0,C.jsx)(Me.A,{variant:"body2",color:"textSecondary",className:t.bp,children:(0,o.getBpDisplayStr)(n)})}),Ie=Re;var Le=n(89870);const Fe=(0,F.n9)()(e=>({toggleButton:{height:44,border:"none",marginLeft:e.spacing(4)}})),Ne=(0,S.observer)(function({model:e}){const{classes:t}=Fe();return(0,C.jsx)(Le.A,{onClick:e.activateTrackSelector,className:t.toggleButton,title:"Open track selector",value:"track_select",children:(0,C.jsx)(oe.xU,{})})}),De=Ne;var Be=n(23758),je=n(2020),Ve=n(1485),Ee=n(37962),ze=n(14332);const Oe=(0,c.lazy)(()=>n.e(3448).then(n.bind(n,27419))),He=(0,F.n9)()(e=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:100,color:e.palette.text.secondary}}));function Ge(e){const t=(0,D.c)(4),{children:n,open:r,value:a}=e;let o;return t[0]!==n||t[1]!==r||t[2]!==a?(o=(0,C.jsx)(Ee.A,{open:r,enterTouchDelay:0,placement:"top",title:a,arrow:!0,children:n}),t[0]=n,t[1]=r,t[2]=a,t[3]=o):o=t[3],o}const $e=(0,S.observer)(function({model:e}){const{classes:t}=He(),{width:n,maxBpPerPx:r,minBpPerPx:a,bpPerPx:i}=e,[s,l]=(0,c.useState)(100*-Math.log2(i));(0,c.useEffect)(()=>{l(100*-Math.log2(i))},[i]);const d=i<=a+1e-4,u=i>=r-1e-4;return(0,C.jsxs)("div",{className:t.container,children:[(0,C.jsx)(Ee.A,{title:"Zoom out 2x",children:(0,C.jsx)("span",{children:(0,C.jsx)(Le.A,{"data-testid":"zoom_out",disabled:u,onClick:()=>{e.zoom(2*i)},children:(0,C.jsx)(Ve.A,{})})})}),(0,C.jsx)(ze.Ay,{size:"small",className:t.slider,value:s,min:100*-Math.log2(r),max:100*-Math.log2(a),onChangeCommitted:()=>e.zoomTo(2**(-s/100)),valueLabelDisplay:"auto",valueLabelFormat:e=>`Window size: ${(0,o.getBpDisplayStr)(2**(-e/100)*n)}`,slots:{valueLabel:Ge},onChange:(e,t)=>{l(t)}}),(0,C.jsx)(Ee.A,{title:"Zoom in 2x",children:(0,C.jsx)("span",{children:(0,C.jsx)(Le.A,{"data-testid":"zoom_in",disabled:d,onClick:()=>{e.zoom(e.bpPerPx/2)},children:(0,C.jsx)(be.A,{})})})}),(0,C.jsx)(Be.A,{menuItems:[...[100,50,10].map(t=>({label:`Zoom in ${t}x`,onClick:()=>{e.zoom(e.bpPerPx/t)}})),...[10,50,100].map(t=>({label:`Zoom out ${t}x`,onClick:()=>{e.zoom(e.bpPerPx*t)}})),{label:"Custom zoom",onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[Oe,{model:e,handleClose:t}])}}],children:(0,C.jsx)(je.A,{})})]})}),We=$e;var Ue=n(51414),_e=n(84481),qe=n(87485);const Je=(0,F.n9)()(e=>({highlight:{height:"100%",position:"absolute",background:(0,qe.M)(e.palette.highlight.main).alpha(.35).toRgbString(),borderLeft:`1px solid ${e.palette.highlight.main}`,borderRight:`1px solid ${e.palette.highlight.main}`}})),Xe=(0,S.observer)(function({model:e,overview:t}){const{classes:n}=Je(),{highlight:r,cytobandOffset:a}=e,i=(0,o.getSession)(e),{assemblyManager:s}=i;return r.map(e=>{const n=s.get(e.assemblyName),r=n?.getCanonicalRefName(e.refName)??e.refName,o=t.bpToPx({...e,refName:r,coord:e.start}),i=t.bpToPx({...e,refName:r,coord:e.end});return void 0!==o&&void 0!==i?{width:Math.abs(i-o),left:o+a}:void 0}).filter(o.notEmpty).map(({left:e,width:t},r)=>(0,C.jsx)("div",{className:n.highlight,style:{width:t,left:e}},`${e}_${t}_${r}`))}),Ye=Xe,Ke=(0,F.n9)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute"}}),Qe=(0,S.observer)(function({model:e,open:t,guideX:n,overview:r}){const{classes:a}=Ke(),{cytobandOffset:i}=e,{assemblyManager:s}=(0,o.getSession)(e),l=r.pxToBp(n-i),c=s.get(l.assemblyName),d=c?.cytobands?.find(e=>l.coord>e.get("start")&&l.coord<e.get("end")&&l.refName===c.getCanonicalRefName(e.get("refName")));return(0,C.jsx)(Ee.A,{open:t,placement:"top",title:[(0,o.stringify)(l),d?.get("name"),d?.get("type")].join(" "),arrow:!0,children:(0,C.jsx)("div",{className:a.guide,style:{left:n}})})}),Ze=Qe;var et=n(37934),tt=n(50574);const nt=(0,F.n9)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rel:{position:"relative"}}),rt=(0,S.observer)(function({model:e,overview:t,ControlComponent:n=(0,C.jsx)("div",{})}){const{cytobandOffset:r}=e,[a,i]=(0,c.useState)(),[s,l]=(0,c.useState)(),[d,u]=(0,c.useState)(),p=(0,c.useRef)(null),{classes:h}=nt(),g=void 0!==a;function m(e){e.preventDefault(),e.stopPropagation(),i((0,tt.Pn)(e,p.current))}function f(e){u((0,tt.Pn)(e,p.current))}function y(){u(void 0)}if((0,c.useEffect)(()=>{function n(e){const t=p.current;t&&g&&l((0,tt.Pn)(e,t))}function c(){if(void 0!==a&&void 0!==s&&Math.abs(s-a)>3){const n=Math.min(a,s),o=Math.max(a,s);e.moveTo(t.pxToBp(n-r),t.pxToBp(o-r))}if(void 0!==a&&void 0===s){const n=t.pxToBp(a-r);n.refName?e.centerAt(Math.round(n.coord),n.refName,n.index):((0,o.getSession)(e).notify("unknown position clicked"),console.error("unknown position clicked",n))}i(void 0),l(void 0),void 0!==a&&u(void 0)}function d(e){"Escape"===e.key&&(i(void 0),l(void 0))}return g?(window.addEventListener("mousemove",n,!0),window.addEventListener("mouseup",c,!0),window.addEventListener("keydown",d,!0),()=>{window.removeEventListener("mousemove",n,!0),window.removeEventListener("mouseup",c,!0),window.removeEventListener("keydown",d,!0)}):()=>{}},[g,s,a,e,t,r]),void 0===a)return(0,C.jsxs)("div",{className:h.rel,children:[void 0!==d?(0,C.jsx)(Ze,{model:e,open:!g,overview:t,guideX:d}):null,(0,C.jsx)("div",{className:h.rubberbandControl,ref:p,onMouseDown:m,onMouseOut:y,onMouseMove:f,children:n})]});let b,w,v=a||0,S=0;return void 0!==s&&(v=Math.min(s,a),S=s-a),a&&(b=t.pxToBp(a-r),w=t.pxToBp(a+S-r),void 0!==s&&s<a&&([b,w]=[w,b])),(0,C.jsxs)("div",{className:h.rel,children:[b&&w?(0,C.jsx)(et.default,{leftBpOffset:b,rightBpOffset:w,width:Math.abs(S),left:v}):null,(0,C.jsx)("div",{"data-testid":"rubberband_controls",className:h.rubberbandControl,ref:p,onMouseDown:m,onMouseOut:y,onMouseMove:f,children:n})]})}),at=rt;var ot=n(32474),it=n(27703);const st=(0,F.n9)()({scalebarLabel:{height:ke.Gu,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"}}),lt=(0,S.observer)(function({block:e,scale:t,overview:n,model:r}){const{classes:a}=st(),{start:i,end:s,reversed:l,refName:c,assemblyName:d}=e,{majorPitch:u}=(0,it.i3)(t,120,15),{assemblyManager:p}=(0,o.getSession)(r),h=p.get(d),g=h?.getRefNameColor(c),m=[];for(let e=0;e<Math.floor((s-i)/u);e++){const t=(e+1)*u;m.push(l?s-t:i+t)}return m.map((r,i)=>(0,C.jsx)(Me.A,{className:a.scalebarLabel,variant:"body2",style:{left:(i+1)*u/t,pointerEvents:"none",color:g},children:(0,o.getTickDisplayStr)(r,n.bpPerPx)},`${JSON.stringify(e)}-${r}-${i}`))}),ct=lt,dt=(0,F.n9)()(e=>({scalebar:{height:ke.Gu},scalebarBorder:{border:"1px solid"},scalebarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:ke.Gu,overflow:"hidden"},scalebarContigForward:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarContigReverse:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scalebarVisibleRegion:{position:"absolute",height:ke.Gu,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:ke.Ij,position:"relative"},overviewSvg:{pointerEvents:"none",width:"100%",position:"absolute"}})),ut=(0,S.observer)(function({scale:e,model:t,block:n,overview:r}){const{classes:a,cx:i}=dt(),s=(0,Ue.A)(),{cytobandOffset:l,showCytobands:c}=t,{reversed:d,refName:u,assemblyName:p}=n,{assemblyManager:h}=(0,o.getSession)(t),g=h.get(p),m=g?.getRefNameColor(u),f=c&&(0,tt.S5)(g,n.refName).length;return(0,C.jsxs)("div",{children:[(0,C.jsx)(Me.A,{style:{left:n.offsetPx+3,color:f?s.palette.text.primary:m},className:a.scalebarRefName,children:u}),(0,C.jsx)("div",{className:i(a.scalebarContig,f?void 0:d?a.scalebarContigReverse:a.scalebarContigForward,f?void 0:a.scalebarBorder),style:{left:n.offsetPx+l,width:n.widthPx,borderColor:m},children:f?(0,C.jsx)("svg",{style:{width:"100%"},children:(0,C.jsx)(_e.A,{overview:r,assembly:g,block:n})}):(0,C.jsx)(ct,{model:t,overview:r,scale:e,block:n})})]})}),pt=(0,S.observer)(function({model:e,scale:t,overview:n}){const{classes:r}=dt(),a=(0,Ue.A)(),{dynamicBlocks:i,showCytobands:s,cytobandOffset:l}=e,{pluginManager:c}=(0,o.getEnv)(e),d=i.contentBlocks,u=n.dynamicBlocks,p=a.palette.tertiary.light;if(!d.length)return null;const h=d.at(0),g=d.at(-1),m=n.bpToPx({...h,coord:h.reversed?h.end:h.start})||0,f=n.bpToPx({...g,coord:g.reversed?g.start:g.end})||0,y=s?"#f00":p,b=s?.1:.3,w=c.evaluateExtensionPoint("LinearGenomeView-OverviewScalebarComponent",void 0,{model:e,overview:n});return(0,C.jsxs)("div",{className:r.scalebar,children:[(0,C.jsx)("div",{className:r.scalebarVisibleRegion,style:{width:f-m,left:m+l,background:(0,Ce.X4)(y,b),borderColor:y}}),u.map((a,o)=>"ContentBlock"!==a.type?(0,C.jsx)("div",{className:r.scalebarContig,style:{width:a.widthPx,left:a.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}},`${JSON.stringify(a)}-${o}`):(0,C.jsx)(ut,{scale:t,block:a,model:e,overview:n},`${JSON.stringify(a)}-${o}`)),(0,C.jsx)(Ye,{model:e,overview:n}),w]})}),ht=(0,S.observer)(function({model:e,children:t}){const{classes:n}=dt(),{minimumBlockWidth:r,totalBp:a,width:o,cytobandOffset:i,displayedRegions:s}=e,l=o-i,d=JSON.stringify(s),u=(0,c.useMemo)(()=>{const e=se.A.create({displayedRegions:JSON.parse(d),interRegionPaddingWidth:0,minimumBlockWidth:r});return e.setVolatileWidth(l),e.showAllRegions(),e},[d,r,l]),p=a/(l-2*(s.length-1));return(0,C.jsxs)("div",{children:[(0,C.jsx)(at,{model:e,overview:u,ControlComponent:(0,C.jsx)(pt,{model:e,overview:u,scale:p})}),(0,C.jsxs)("div",{className:n.overview,children:[(0,C.jsx)("svg",{height:ke.Ij,className:n.overviewSvg,children:(0,C.jsx)(ot.A,{model:e,overview:u})}),t]})]})}),gt=ht;var mt=n(96480),ft=n(15897),yt=n(33896);const bt=(0,c.lazy)(()=>n.e(9374).then(n.bind(n,39374)));function wt(){const e=(0,D.c)(6),[t,n]=(0,c.useState)(!1);let r,a,o,i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{n(!0)},e[0]=r):r=e[0],e[1]===Symbol.for("react.memo_cache_sentinel")?(a=(0,C.jsx)(Le.A,{onClick:r,size:"small",children:(0,C.jsx)(ft.A,{fontSize:"small"})}),e[1]=a):a=e[1],e[2]!==t?(o=t?(0,C.jsx)(c.Suspense,{fallback:null,children:(0,C.jsx)(bt,{handleClose:()=>{n(!1)}})}):null,e[2]=t,e[3]=o):o=e[3],e[4]!==o?(i=(0,C.jsxs)(C.Fragment,{children:[a,o]}),e[4]=o,e[5]=i):i=e[5],i}function vt(e){const t=(0,D.c)(6),{showHelp:n}=e;let r,a,o,i;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r={marginRight:7},a=(0,C.jsx)(fe.A,{fontSize:"small"}),t[0]=r,t[1]=a):(r=t[0],a=t[1]),t[2]!==n?(o=n?(0,C.jsx)(wt,{}):null,t[2]=n,t[3]=o):o=t[3],t[4]!==o?(i=(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(yt.A,{position:"end",style:r,children:[a,o]})}),t[4]=o,t[5]=i):i=t[5],i}const St=(0,F.n9)()({headerRefName:{minWidth:100}}),xt=(0,S.observer)(function({model:e,showHelp:t=!0}){const{classes:n}=St(),r=(0,Ue.A)(),a=(0,o.getSession)(e),{textSearchManager:i,assemblyManager:s}=a,{assemblyNames:l,rankSearchResults:c}=e,d=l[0],u=s.get(d),p=e.searchScope(d);return(0,C.jsx)(mt.A,{onSelect:async t=>{try{await async function({option:e,model:t,assemblyName:n}){const{assemblyManager:r}=(0,o.getSession)(t),a=r.get(n);e.hasLocation()?await(0,X.Kd)({option:e,model:t,assemblyName:n}):e.results?.length?t.setSearchResults(e.results,e.getLabel()):a&&await(0,X.cm)({input:e.getLabel(),assembly:a,model:t})}({model:e,assemblyName:d,option:t})}catch(t){console.error(t),(0,o.getSession)(e).notify(`${t}`,"warning")}},assemblyName:d,fetchResults:e=>(0,tt.Jf)({queryString:e,searchScope:p,rankSearchResults:c,textSearchManager:i,assembly:u}),model:e,minWidth:175,TextFieldProps:{variant:"outlined",className:n.headerRefName,style:{margin:ke.Es},slotProps:{input:{style:{padding:0,height:ke.P5,background:(0,Ce.X4)(r.palette.background.paper,.8)},endAdornment:(0,C.jsx)(vt,{showHelp:t})}}}})}),Ct=xt,kt=(0,F.n9)()({headerBar:{display:"flex",height:ke.Ij},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1}}),Tt=function(e){const t=(0,D.c)(24),{model:n}=e,{classes:r}=kt();let a,o,i,s,l,c,d,u,p;return t[0]!==n?(a=(0,C.jsx)(De,{model:n}),t[0]=n,t[1]=a):a=t[1],t[2]!==r.spacer?(o=(0,C.jsx)("div",{className:r.spacer}),t[2]=r.spacer,t[3]=o):o=t[3],t[4]!==n?(i=(0,C.jsx)(Ae,{model:n}),s=(0,C.jsx)(Ct,{model:n}),t[4]=n,t[5]=i,t[6]=s):(i=t[5],s=t[6]),t[7]!==r.headerForm||t[8]!==i||t[9]!==s?(l=(0,C.jsxs)(ve.A,{row:!0,className:r.headerForm,children:[i,s]}),t[7]=r.headerForm,t[8]=i,t[9]=s,t[10]=l):l=t[10],t[11]!==n?(c=(0,C.jsx)(Ie,{model:n}),d=(0,C.jsx)(We,{model:n}),t[11]=n,t[12]=c,t[13]=d):(c=t[12],d=t[13]),t[14]!==r.spacer?(u=(0,C.jsx)("div",{className:r.spacer}),t[14]=r.spacer,t[15]=u):u=t[15],t[16]!==r.headerBar||t[17]!==a||t[18]!==o||t[19]!==l||t[20]!==c||t[21]!==d||t[22]!==u?(p=(0,C.jsxs)("div",{className:r.headerBar,children:[a,o,l,c,d,u]}),t[16]=r.headerBar,t[17]=a,t[18]=o,t[19]=l,t[20]=c,t[21]=d,t[22]=u,t[23]=p):p=t[23],p},At=(0,S.observer)(function({model:e}){const{hideHeader:t,hideHeaderOverview:n}=e;return t?null:n?(0,C.jsx)(Tt,{model:e}):(0,C.jsx)(gt,{model:e,children:(0,C.jsx)(Tt,{model:e})})}),Mt=At;var Pt=n(5986),Rt=n(95054);const It=(0,F.n9)()(e=>({background:{position:"absolute",right:0,background:e.palette.background.paper,zIndex:2},focusedBackground:{background:(0,Ce.X4)(e.palette.secondary.light,.2)}})),Lt=(0,S.observer)(function({model:e}){const{classes:t}=It(),{id:n,bpPerPx:r,maxBpPerPx:a,minBpPerPx:i,scaleFactor:s,hideHeader:l}=e,{focusedViewId:c}=(0,o.getSession)(e);return l?(0,C.jsx)(Rt.A,{className:t.background,children:(0,C.jsxs)(Rt.A,{className:c===n?t.focusedBackground:void 0,children:[(0,C.jsx)(Be.A,{menuItems:e.menuItems(),children:(0,C.jsx)(Pt.A,{fontSize:"small"})}),(0,C.jsx)(Le.A,{"data-testid":"zoom_out",onClick:()=>{e.zoom(2*r)},disabled:r>=a-1e-4||1!==s,children:(0,C.jsx)(Ve.A,{fontSize:"small"})}),(0,C.jsx)(Le.A,{"data-testid":"zoom_in",onClick:()=>{e.zoom(r/2)},disabled:r<=i+1e-4||1!==s,children:(0,C.jsx)(be.A,{fontSize:"small"})})]})}):null}),Ft=Lt;var Nt=n(65193),Dt=n(98753);const Bt=(0,c.lazy)(()=>n.e(7686).then(n.bind(n,87686))),jt=(0,c.lazy)(()=>n.e(1281).then(n.bind(n,61281))),Vt=(0,c.lazy)(()=>n.e(8528).then(n.bind(n,98528))),Et=(0,c.lazy)(()=>n.e(3523).then(n.bind(n,83523))),zt=(0,c.lazy)(()=>n.e(9067).then(n.bind(n,79067)));function Ot(e){return s.types.compose("LinearGenomeView",d.BaseViewModel,s.types.model({id:de.ElementId,type:s.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:s.types.optional(s.types.frozen(),[]),tracks:s.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:s.types.optional(s.types.enumeration(["hierarchical"]),"hierarchical"),showCenterLine:s.types.optional(s.types.boolean,()=>(0,o.localStorageGetBoolean)("lgv-showCenterLine",!1)),showCytobandsSetting:s.types.optional(s.types.boolean,()=>(0,o.localStorageGetBoolean)("lgv-showCytobands",!0)),trackLabels:s.types.optional(s.types.string,()=>(0,o.localStorageGetItem)("lgv-trackLabels")||""),showGridlines:!0,highlight:s.types.optional(s.types.array(s.types.frozen()),[]),colorByCDS:s.types.optional(s.types.boolean,()=>(0,o.localStorageGetBoolean)("lgv-colorByCDS",!1)),showTrackOutlines:s.types.optional(s.types.boolean,()=>(0,o.localStorageGetBoolean)("lgv-showTrackOutlines",!0)),init:s.types.frozen()})).volatile(()=>({volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0})).views(e=>({get pinnedTracks(){return e.tracks.filter(e=>e.pinned)},get unpinnedTracks(){return e.tracks.filter(e=>!e.pinned)},get trackLabelsSetting(){const t=(0,a.getConf)((0,o.getSession)(e),["LinearGenomeViewPlugin","trackLabels"]);return e.trackLabels||t},get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return ke.Rd},get assemblyNames(){return[...new Set(e.displayedRegions.map(e=>e.assemblyName))]},get assemblyDisplayNames(){const{assemblyManager:t}=(0,o.getSession)(e);return this.assemblyNames.map(e=>{const n=t.get(e);return n?.displayName??e})},get isTopLevelView(){return(0,o.getSession)(e).views.some(t=>t.id===e.id)},get stickyViewHeaders(){const t=(0,o.getSession)(e);return!!(0,ue.X)(t)&&this.isTopLevelView&&t.stickyViewHeaders},get rubberbandTop(){let t=0;return this.stickyViewHeaders&&(t=G.VIEW_HEADER_HEIGHT,e.hideHeader||(t+=ke.Ij,e.hideHeaderOverview||(t+=ke.Gu))),t},get pinnedTracksTop(){return this.rubberbandTop+ke.jE}})).views(e=>({scaleBarDisplayPrefix:()=>"LinearSyntenyView"===(0,s.getParent)(e,2).type?e.assemblyDisplayNames[0]:"",MiniControlsComponent:()=>Ft,HeaderComponent:()=>Mt,get assembliesNotFound(){const{assemblyManager:t}=(0,o.getSession)(e),n=e.assemblyNames.map(e=>t.get(e)?void 0:e).filter(e=>!!e).join(",");return n?`Assemblies ${n} not found`:void 0},get assemblyErrors(){const{assemblyManager:t}=(0,o.getSession)(e);return e.assemblyNames.map(e=>t.get(e)?.error).filter(e=>!!e).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,o.getSession)(e);return e.assemblyNames.every(e=>t.get(e)?.initialized)},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get scaleBarHeight(){return ke.jE+ke.i3},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?ke.Ij:ke.Ij+ke.Gu},get trackHeights(){return(0,o.sum)(e.tracks.map(e=>e.displays[0].height))},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*ke.i3},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return(0,o.sum)(e.displayedRegions.map(e=>e.end-e.start))},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors||this.assembliesNotFound},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:()=>({...(0,p.getParentRenderProps)(e),bpPerPx:e.bpPerPx,colorByCDS:e.colorByCDS}),searchScope:t=>({assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}),getTrack:t=>e.tracks.find(e=>e.configuration.trackId===t),rankSearchResults:e=>e,rewriteOnClicks(t,n){for(const r of n)if("subMenu"in r&&this.rewriteOnClicks(t,r.subMenu),"onClick"in r){const n=r.onClick;r.onClick=(...r)=>{for(const a of e.tracks)a.type===t&&n.apply(a,[a,...r])}}},get trackTypeActions(){const t=new Map;for(const n of e.tracks)if(!t.get(n.type)){const e=structuredClone(n.viewMenuActions);this.rewriteOnClicks(n.type,e),t.set(n.type,e)}return t}})).actions(t=>({setShowTrackOutlines(e){t.showTrackOutlines=e},setColorByCDS(e){t.colorByCDS=e},setShowCytobands(e){t.showCytobandsSetting=e},setWidth(e){t.volatileWidth=e},setError(e){t.volatileError=e},setHideHeader(e){t.hideHeader=e},setHideHeaderOverview(e){t.hideHeaderOverview=e},setHideNoTracksActive(e){t.hideNoTracksActive=e},setShowGridlines(e){t.showGridlines=e},addToHighlights(e){t.highlight.push(e)},setHighlight(e){t.highlight=(0,s.cast)(e)},removeHighlight(e){t.highlight.remove(e)},scrollTo(e){const n=(0,o.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=n,n},zoomTo(e,n=t.width/2,r=!1){const a=(0,o.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(a===t.bpPerPx)return a;const i=t.bpPerPx;return Math.abs(i-a)<1e-6?(console.warn("zoomTo bpPerPx rounding error"),i):(t.bpPerPx=a,this.scrollTo(Math.round((t.offsetPx+n)*i/a-(r?t.width/2:n))),a)},setOffsets(e,n){t.leftOffset=e,t.rightOffset=n},setSearchResults(e,n,r){(0,o.getSession)(t).queueDialog(a=>[zt,{model:t,searchResults:e,searchQuery:n,handleClose:a,assemblyName:r}])},setNewView(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip(){t.displayedRegions=(0,s.cast)([...t.displayedRegions].reverse().map(e=>({...e,reversed:!e.reversed}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack(n,r={},a={}){const o=e.pluggableConfigSchemaType("track"),i=(0,s.resolveIdentifier)(o,(0,s.getRoot)(t),n);if(!i)throw new Error(`Could not resolve identifier "${n}"`);const l=e.getTrackType(i?.type);if(!l)throw new Error(`Unknown track type ${i.type}`);const c=e.getViewType(t.type),d=new Set(c.displayTypes.map(e=>e.name)),u=i.displays.find(e=>d.has(e.type));if(!u)throw new Error(`Could not find a compatible display for view type ${t.type}`);const p=t.tracks.filter(e=>e.configuration===i);if(0===p.length){const e=l.stateModel.create({...r,type:i.type,configuration:i,displays:[{type:u.type,configuration:u,...a}]});return t.tracks.push(e),e}return p[0]},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=(0,s.resolveIdentifier)(r,(0,s.getRoot)(t),n),o=t.tracks.filter(e=>e.configuration===a);return(0,b.transaction)(()=>{for(const e of o)t.tracks.remove(e)}),o.length}})).actions(e=>({moveTrackDown(t){const n=e.tracks.findIndex(e=>e.id===t);-1!==n&&-1!==n&&n<e.tracks.length-1&&e.tracks.splice(n,2,e.tracks[n+1],e.tracks[n])},moveTrackUp(t){const n=e.tracks.findIndex(e=>e.id===t);n>0&&e.tracks.splice(n-1,2,e.tracks[n],e.tracks[n-1])},moveTrackToTop(t){const n=e.tracks.findIndex(e=>e.id===t);e.tracks=(0,s.cast)([e.tracks[n],...e.tracks.filter(e=>e.id!==t)])},moveTrackToBottom(t){const n=e.tracks.findIndex(e=>e.id===t);e.tracks=(0,s.cast)([...e.tracks.filter(e=>e.id!==t),e.tracks[n]])},moveTrack(t,n){const r=e.tracks.findIndex(e=>e.id===t);if(-1===r)throw new Error(`Track ID ${t} not found`);const a=e.tracks.findIndex(e=>e.id===n);if(-1===a)throw new Error(`Track ID ${n} not found`);const o=e.tracks.filter((e,t)=>t!==r);o.splice(a,0,e.tracks[r]),e.tracks=(0,s.cast)(o)},toggleTrack:t=>!e.hideTrack(t)&&(e.showTrack(t),!0),setTrackLabels(t){localStorage.setItem("lgv-trackLabels",t),e.trackLabels=t},setShowCenterLine(t){e.showCenterLine=t},setDisplayedRegions(t){e.displayedRegions=(0,s.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,o.getSession)(e);if((0,o.isSessionModelWithWidgets)(t)){const n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},getSelectedRegions(t,n){const r=(0,s.getSnapshot)(e),a=se.A.create({...r,interRegionPaddingWidth:e.interRegionPaddingWidth});return a.setVolatileWidth(e.width),a.moveTo(t,n),a.dynamicBlocks.contentBlocks.map(e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)}))},afterDisplayedRegionsSet(t){e.afterDisplayedRegionsSetCallbacks.push(t)},horizontalScroll(t){const n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(Math.round(t-e.width/2))},showAllRegions(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly(t){const n=(0,o.getSession)(e),{assemblyManager:r}=n;if(!t){const r=new Set(e.displayedRegions.map(e=>e.assemblyName));if(r.size>1)return void n.notify("Can't perform operation with multiple assemblies currently");[t]=[...r]}const a=r.get(t);if(a){const{regions:t}=a;t&&(this.setDisplayedRegions(t),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId(t){e.draggingTrackId=t},setScaleFactor(t){e.scaleFactor=t},clearView(){this.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setInit(t){e.init=t},async exportSvg(t={}){const{renderToSvg:r}=await Promise.resolve().then(n.bind(n,98753)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,we.saveAs)(o,t.filename||"image.svg")}})).actions(e=>{let t=()=>{};return{slide:function(n){const[r,a]=(0,o.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo,void 0,void 0,200);t(),t=a,r()}}}).actions(e=>{let t=()=>{};return{zoom:function(n){if(e.zoomTo(e.bpPerPx),n<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||n>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)return;const r=e.bpPerPx/n,[a,i]=(0,o.springAnimate)(1,r,e.setScaleFactor,()=>{e.zoomTo(n),e.setScaleFactor(1)});t(),t=i,a()}}}).views(e=>({get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){const{assemblyManager:t}=(0,o.getSession)(e);return e.assemblyNames.some(e=>t.get(e)?.cytobands?.length)},get cytobandOffset(){return this.showCytobands?(0,o.measureText)(e.displayedRegions[0]?.refName||"",12)+15:0}})).views(e=>({menuItems(){const{canShowCytobands:t,showCytobands:n}=e,r=(0,o.getSession)(e),a=[{label:"Return to import form",onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[Bt,{model:e,handleClose:t}])},icon:pe.A},...(0,o.isSessionWithAddTracks)(r)?[{label:"Sequence search",icon:fe.A,onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[jt,{model:e,handleClose:t}])}}]:[],{label:"Export SVG",icon:me.A,onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[Vt,{model:e,handleClose:t}])}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:oe.xU},{label:"Horizontally flip",icon:ye.A,onClick:e.horizontallyFlip},{label:"Color by CDS and draw amino acids",type:"checkbox",checked:e.colorByCDS,icon:ge.A,onClick:()=>{e.setColorByCDS(!e.colorByCDS)}},{label:"Show...",icon:te.A,subMenu:[{label:"Show all regions in assembly",onClick:e.showAllRegionsInAssembly},{label:"Show center line",type:"checkbox",checked:e.showCenterLine,onClick:()=>{e.setShowCenterLine(!e.showCenterLine)}},{label:"Show header",type:"checkbox",checked:!e.hideHeader,onClick:()=>{e.setHideHeader(!e.hideHeader)}},{label:"Show track outlines",type:"checkbox",checked:e.showTrackOutlines,onClick:()=>{e.setShowTrackOutlines(!e.showTrackOutlines)}},{label:"Show header overview",type:"checkbox",checked:!e.hideHeaderOverview,onClick:()=>{e.setHideHeaderOverview(!e.hideHeaderOverview)},disabled:e.hideHeader},{label:"Show no tracks active button",type:"checkbox",checked:!e.hideNoTracksActive,onClick:()=>{e.setHideNoTracksActive(!e.hideNoTracksActive)}},{label:"Show guidelines",type:"checkbox",checked:e.showGridlines,onClick:()=>{e.setShowGridlines(!e.showGridlines)}},...t?[{label:"Show ideogram",type:"checkbox",checked:e.showCytobands,onClick:()=>{e.setShowCytobands(!n)}}]:[]]},{label:"Track labels",icon:he.A,subMenu:[{label:"Overlapping",icon:te.A,type:"radio",checked:"overlapping"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("overlapping")}},{label:"Offset",icon:te.A,type:"radio",checked:"offset"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("offset")}},{label:"Hidden",icon:te.A,type:"radio",checked:"hidden"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("hidden")}}]}];for(const[t,n]of e.trackTypeActions.entries())if(n.length){a.push({type:"divider"},{type:"subHeader",label:t});for(const e of n)a.push(e)}return a}})).views(e=>{let t,n="";return{get staticBlocks(){const r=(0,ce.A)(e),a=JSON.stringify(r);return n!==a&&(t=r,n=a),t},get dynamicBlocks(){return(0,le.A)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map(e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)}))},get visibleLocStrings(){return(0,it.H4)(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return(0,it.H4)(e.coarseDynamicBlocks)}}}).actions(e=>({setCoarseDynamicBlocks(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp}})).actions(e=>({moveTo(t,n){(0,ie.tw)(e,t,n)},async navToLocString(t,n,r){const{assemblyNames:a}=e,{assemblyManager:i}=(0,o.getSession)(e),s=n||a[0];return s&&await i.waitForAssembly(s),this.navToLocations((0,it.CU)(t,s,(e,t)=>i.isValidRefName(e,t)),s,r)},async navToSearchString({input:t,assembly:n}){await(0,X.cm)({input:t,assembly:n,model:e})},async navToLocation(e,t,n){return this.navToLocations([e],t,n)},async navToLocations(t,n,r){const{assemblyManager:a}=(0,o.getSession)(e);await(0,b.when)(()=>void 0!==e.volatileWidth);const i=await(0,it.Cz)({regions:t,assemblyManager:a,assemblyName:n,grow:r});if(1===i.length){const t=i[0],{reversed:n,parentRegion:r,start:a,end:s}=t;e.setDisplayedRegions([{reversed:n,...r}]),this.navTo({...t,start:(0,o.clamp)(a??0,0,r.end),end:(0,o.clamp)(s??r.end,0,r.end)})}else e.setDisplayedRegions(i.map(e=>{const{start:t,end:n}=e;return void 0===t||void 0===n?e.parentRegion:{...e,start:t,end:n}})),e.showAllRegions()},navTo(e){this.navToMultiple([e])},navToMultiple(t){if(t.some(e=>void 0!==e.start&&void 0!==e.end&&e.start>e.end))throw new Error("found start greater than end");const n=t.at(0),r=t.at(-1);if(!n||!r)return;const a=e.assemblyNames[0],{assemblyManager:i}=(0,o.getSession)(e),s=i.get(n.assemblyName||a),l=s?.getCanonicalRefName(n.refName)||n.refName,c=e.displayedRegions.find(e=>e.refName===l),d=i.get(r.assemblyName||a),u=d?.getCanonicalRefName(r.refName)||r.refName,p=(0,o.findLast)(e.displayedRegions,e=>e.refName===u);if(!c)throw new Error(`could not find a region with refName "${l}"`);if(!p)throw new Error(`could not find a region with refName "${u}"`);const h=void 0===n.start?c.start:n.start,g=void 0===n.end?c.end:n.end,m=void 0===r.start?p.start:r.start,f=void 0===r.end?p.end:r.end,y=e.displayedRegions.findIndex(e=>l===e.refName&&h>=e.start&&h<=e.end&&g<=e.end&&g>=e.start),b=e.displayedRegions.findIndex(e=>u===e.refName&&m>=e.start&&m<=e.end&&f<=e.end&&f>=e.start);if(-1===y||-1===b)throw new Error(`could not find a region that contained "${t.map(e=>(0,o.assembleLocString)(e))}"`);const w=e.displayedRegions[y],v=e.displayedRegions[b],S=w.reversed?w.end-g:h-w.start,x=v.reversed?v.end-m:f-v.start;this.moveTo({index:y,offset:S},{index:b,offset:x})}})).views(e=>({rubberBandMenuItems:()=>[{label:"Zoom to region",icon:be.A,onClick:()=>{e.moveTo(e.leftOffset,e.rightOffset)}},{label:"Get sequence",icon:m.A,onClick:()=>{(0,o.getSession)(e).queueDialog(t=>[Et,{model:e,handleClose:t}])}}],bpToPx:({refName:t,coord:n,regionNumber:r})=>(0,ie.eB)({refName:t,coord:n,regionNumber:r,self:e}),centerAt(t,n,r){const a=this.bpToPx({refName:n,coord:t,regionNumber:r});void 0!==a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},pxToBp:t=>(0,ie.Ii)(e,t),get centerLineInfo(){return e.displayedRegions.length>0?this.pxToBp(e.width/2):void 0}})).actions(e=>({afterCreate(){function t(t){(0,o.getSession)(e).focusedViewId===e.id&&(t.ctrlKey||t.metaKey)&&("ArrowLeft"===t.code?(t.preventDefault(),e.slide(-.9)):"ArrowRight"===t.code?(t.preventDefault(),e.slide(.9)):"ArrowUp"===t.code&&1===e.scaleFactor?(t.preventDefault(),e.zoom(e.bpPerPx/2)):"ArrowDown"===t.code&&1===e.scaleFactor&&(t.preventDefault(),e.zoom(2*e.bpPerPx)))}document.addEventListener("keydown",t),(0,s.addDisposer)(e,()=>{document.removeEventListener("keydown",t)})},afterAttach(){(0,s.addDisposer)(e,(0,b.autorun)(()=>{const{init:t}=e;t&&(e.navToLocString(t.loc,t.assembly).catch(n=>{console.error(t,n),(0,o.getSession)(e).notifyError(`${n}`,n)}),t.tracks?.map(t=>e.showTrack(t)),e.setInit(void 0))})),(0,s.addDisposer)(e,(0,b.autorun)(()=>{e.initialized&&e.setCoarseDynamicBlocks(e.dynamicBlocks)},{delay:150})),(0,s.addDisposer)(e,(0,b.autorun)(()=>{const t=e=>JSON.stringify(e),{showCytobandsSetting:n,showCenterLine:r,colorByCDS:a}=e;(0,o.localStorageSetItem)("lgv-showCytobands",t(n)),(0,o.localStorageSetItem)("lgv-showCenterLine",t(r)),(0,o.localStorageSetItem)("lgv-colorByCDS",t(a))}))}})).preProcessSnapshot(e=>{if(!e)return e;const{highlight:t,...n}=e;return{highlight:Array.isArray(t)||void 0===t?t:[t],...n}}).postProcessSnapshot(e=>{if(e){const{init:t,...n}=e;return n}return e})}var Ht=n(26612);class Gt extends r.A{name="LinearGenomeViewPlugin";exports={BaseLinearDisplayComponent:q,BaseLinearDisplay:L,baseLinearDisplayConfigSchema:l,SearchBox:Ct,ZoomControls:We,LinearGenomeView:Nt.default};configurationSchema=(0,a.ConfigurationSchema)("LinearGenomeViewConfigSchema",{trackLabels:{type:"string",defaultValue:"overlapping",model:s.types.enumeration("trackLabelOptions",["offset","overlapping","hidden"])}});install(e){var t;(t=e).addTrackType(()=>{const e=(e=>(0,a.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:(0,J.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(t);return new J.TrackType({name:"FeatureTrack",displayName:"Feature track",configSchema:e,stateModel:(0,J.createBaseTrackModel)(t,"FeatureTrack",e)})}),function(e){e.addTrackType(()=>{const t=(e=>(0,a.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:(0,J.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(e);return new J.TrackType({name:"BasicTrack",configSchema:t,stateModel:(0,J.createBaseTrackModel)(e,"BasicTrack",t)})})}(e),function(e){e.addDisplayType(()=>{const t=Z(e);return new J.DisplayType({name:"LinearBasicDisplay",displayName:"Basic feature display",configSchema:t,stateModel:ae(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:q})})}(e),function(e){e.addViewType(()=>new J.ViewType({name:"LinearGenomeView",displayName:"Linear genome view",stateModel:Ot(e),ReactComponent:(0,c.lazy)(()=>Promise.resolve().then(n.bind(n,65193)))}))}(e),function(e){e.addDisplayType(()=>{const t=K(e);return new J.DisplayType({name:"LinearBareDisplay",configSchema:t,displayName:"Bare feature display",stateModel:Q(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:q})})}(e),function(e){e.addToExtensionPoint("LaunchView-LinearGenomeView",async({session:e,assembly:t,loc:n,tracks:r=[],tracklist:a,nav:i,highlight:s})=>{try{const{assemblyManager:l}=e,c=e.addView("LinearGenomeView",{});if(await(0,o.when)(()=>!!c.volatileWidth),!t)throw new Error("No assembly provided when launching linear genome view");const d=await l.waitForAssembly(t);if(!d)throw new Error(`Assembly "${t}" not found when launching linear genome view`);if(a&&c.activateTrackSelector(),void 0!==i&&c.setHideHeader(!i),void 0!==s)for(const e of s){const n=(0,o.parseLocString)(e,e=>l.isValidRefName(e,t)),{start:r,end:a}=n;void 0!==r&&void 0!==a&&c.addToHighlights({...n,start:r,end:a,assemblyName:t})}await(0,X.cm)({input:n,model:c,assembly:d});const u=[];for(const e of r)Y(c,e,u);if(u.length)throw new Error(`Could not resolve identifiers: ${u.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}})}(e)}configure(e){(0,o.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:i.A,onClick:e=>{e.addView("LinearGenomeView",{})}})}}},91476:(e,t,n)=>{n.d(t,{Ar:()=>l,CQ:()=>s,Fz:()=>h,JD:()=>i,Kl:()=>u,Kt:()=>c,SP:()=>p,dv:()=>a,lE:()=>d,yr:()=>o});var r=n(87485);function a(e){for(const t of e.chains.values())if(1&t[0].flags)return!0;return!1}function o(e,t){return 1!==t?(0,r.M)(e).alpha(Math.min(1,t*t+.1)).toHslString():e}const i={flagInclude:0,flagExclude:1540},s={flagInclude:16,flagExclude:1540},l={flagInclude:0,flagExclude:1556};function c(e,t){const n=Object.getOwnPropertyDescriptor(e.prototype,t).get;Object.defineProperty(e.prototype,t,{get(){const e=n.call(this);return Object.defineProperty(this,t,{value:e}),e}})}function d(e,t,n){return(e&t)!==t||!!(e&n)}function u(e,t){return"*"===t?void 0===e:`${e}`!=`${t}`}function p(e,t){return e<50&&t>=3}const h=5},91612:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema,this.description=e.description,this.url=e.url,this.configEditorComponent=e.configEditorComponent}}},92070:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(35470);class a extends r.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}}},92516:(e,t,n)=>{n.d(t,{BY:()=>u,C1:()=>x,DW:()=>o,EO:()=>b,EV:()=>C,J_:()=>A,Nh:()=>S,QW:()=>l,Tl:()=>m,Uy:()=>y,Y$:()=>i,ZL:()=>M,_u:()=>T,bV:()=>w,gx:()=>p,lL:()=>v,lO:()=>d,mY:()=>g,rF:()=>k,rz:()=>a.A,u3:()=>s,xU:()=>f,xv:()=>c,yH:()=>P,zA:()=>h});var r=n(36422),a=n(83059);function o(e){return(0,r.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function i(e){return"object"==typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function s(e){return i(e)&&"editConfiguration"in e}function l(e){return i(e)&&"addTrackConf"in e&&!e.disableAddTracks}function c(e){return i(e)&&"shareURL"in e&&!!e.shareURL}function d(e){return i(e)&&"widgets"in e}function u(e){return i(e)&&"makeConnection"in e}function p(e){return i(e)&&"addConnectionConf"in e}function h(e){return i(e)&&"sessionPlugins"in e}function g(e){return"object"==typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function m(e){return"object"==typeof e&&null!==e&&"width"in e&&"setWidth"in e}function f(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function y(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function b(e){return"object"==typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function w(e){return"object"==typeof e&&null!==e&&"findAppropriateInternetAccount"in e}function v(e){return"object"==typeof e&&null!==e&&"internetAccounts"in e&&"findAppropriateInternetAccount"in e}function S(e){return"object"==typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}function x(e){return"object"==typeof e&&null!==e&&"uri"in e&&!!e.uri}function C(e){return"object"==typeof e&&null!==e&&"localPath"in e&&!!e.localPath}function k(e){return"object"==typeof e&&null!==e&&"blobId"in e&&!!e.blobId}class T extends Error{constructor(e,t){super(e),this.message=e,this.url=t,this.name="AuthNeededError",Object.setPrototypeOf(this,T.prototype)}}class A extends Error{constructor(e,t){super(e),this.message=e,this.internetAccountId=t,this.name="RetryError"}}function M(e){return e instanceof Error&&("AuthNeededError"===e.name||void 0!==e.url)}function P(e){return"RetryError"===e.name||void 0!==e.internetAccountId}},92880:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var r=n(44728),a=n(82088),o=n(198),i=n(46377),s=n(3496),l=n(99546),c=n(6434),d=n(37347);class u extends o.default{serializeArgsInClient(e){return super.serializeArgsInClient({...e,displayModel:void 0,regions:structuredClone(e.regions)})}deserializeResultsInClient(e,t){const n=new Map(e.features.map(e=>c.A.fromJSON(e)).map(e=>[e.id(),e]));return{...super.deserializeResultsInClient({...e,features:n},t),blockKey:t.blockKey,features:n}}serializeResultsInWorker(e,t){const n=super.serializeResultsInWorker(e,t),{features:r}=e;return{...n,features:(0,l.iterMap)(r.values(),e=>e.toJSON(),r.size)}}getExpandedRegion(e,t){return e}async getFeatures(e){const t=this.pluginManager,{stopToken:n,regions:o,sessionId:l,adapterConfig:c}=e,{dataAdapter:u}=await(0,s.cK)(t,l,c);if(!(0,i.isFeatureAdapter)(u))throw new Error("Adapter does not support retrieving features");(0,d.SW)(n);const p=o.map(e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})),h=p[0],g=1===p.length?u.getFeatures(this.getExpandedRegion(h,e),e):u.getFeaturesInMultipleRegions(p,e),m=await(0,r._)(g.pipe((0,a.$)()));return(0,d.SW)(n),new Map(m.filter(t=>this.featurePassesFilters(e,t)).map(e=>[e.id(),e]))}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async render(e){const t=e.features||await this.getFeatures(e);return{...await super.render({...e,features:t}),features:t}}}},93100:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(43283);class a{constructor({filters:e=[]}){this.filterChain=e.map(e=>e.trim()).filter(e=>!!e).map(e=>{if("string"==typeof e)return{expr:(0,r.A)(e),string:e};throw new Error(`invalid inputFilter string "${e}"`)})}passes(...e){for(const t of this.filterChain)if(!t.expr.evalSync({feature:e[0]}))return!1;return!0}toJSON(){return{filters:this.filterChain.map(e=>e.string)}}static fromJSON(e){return new a(e)}}},93707:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(36422),a=n(99546),o=n(76530),i=n(32595);function s(e,t=!0,n=!0){const{offsetPx:s,displayedRegions:l,bpPerPx:c,width:d,minimumBlockWidth:u,interRegionPaddingWidth:p}=e;if(!d)throw new Error("view has no width, cannot calculate displayed blocks");const h=new o.mh;let g=0;const m=s,f=m+d;for(let e=0;e<l.length;e++){const y=l[e],{assemblyName:b,refName:w,start:v,end:S,reversed:x}=y,C=g+(S-v)/c,k=(S-v)/c,T=(0,r.isStateTreeNode)(y)?(0,r.getSnapshot)(y):y,[A,M]=(0,i.ky)(m,f,g,C);if(void 0!==A&&void 0!==M){let r,i,m,f,y;x?(r=Math.max(v,S-(M-g)*c),i=S-(A-g)*c,m=i===S,f=r===v,y=g+(S-i)/c):(r=(A-g)*c+v,i=Math.min(S,(M-g)*c+v),m=r===v,f=i===S,y=g+(r-v)/c);const C={assemblyName:b,refName:w,start:r,end:i,reversed:x,offsetPx:y,parentRegion:T,regionNumber:e,widthPx:(i-r)/c,isLeftEndOfDisplayedRegion:m,isRightEndOfDisplayedRegion:f,key:""};C.key=`${(0,a.assembleLocStringFast)(C)}-${e}${x?"-reversed":""}`,t&&0===h.length&&m&&h.push(new o.fK({key:`${C.key}-beforeFirstRegion`,widthPx:-s,offsetPx:C.offsetPx+s,variant:"boundary"})),n&&k<u?h.push(new o.Db(C)):h.push(new o.$G(C)),t&&(k>=u&&C.isRightEndOfDisplayedRegion&&e<l.length-1&&(h.push(new o.fK({key:`${C.key}-rightpad`,widthPx:p,offsetPx:C.offsetPx+C.widthPx})),g+=p),e===l.length-1&&C.isRightEndOfDisplayedRegion&&(y=C.offsetPx+C.widthPx,h.push(new o.fK({key:`${C.key}-afterLastRegion`,widthPx:d-y+s,offsetPx:y,variant:"boundary"}))))}g+=(S-v)/c}return h}},94026:(e,t,n)=>{n.d(t,{k:()=>r});const r=new RegExp(/([A-Z])([-+])([a-z]+|[0-9]+)([.?]?)/)},94318:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(92880),a=n(68446),o=n(69500);const i=(0,a.observer)(function(e){const{html:t,RenderingComponent:n,...r}=e;return(0,o.jsx)(n,{...r})});var s=n(99546);class l extends r.default{supportsSVG=!0;deserializeResultsInClient(e,t){const n=new Map(e.features.map(e=>s.SimpleFeature.fromJSON(e)).map(e=>[e.id(),e]));return t.exportSVG?{...e,features:n,blockKey:"circularChord",html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,features:n,blockKey:"circularChord",reactElement:(0,o.jsx)(i,{...t,...e,features:n,RenderingComponent:this.ReactComponent})}}}},95095:(e,t,n)=>{function r(e,t,n){if(!t||!n)return;const{width:r,interRegionPaddingWidth:a,displayedRegions:o,bpPerPx:i,minimumBlockWidth:s}=e,l=function(e,t,n){let r=0;const{displayedRegions:a}=e;if(t.index===n.index)r+=n.offset-t.offset;else{const e=a[t.index];if(r+=e.end-e.start-t.offset,n.index-t.index>=2)for(let e=t.index+1;e<n.index;e++){const t=a[e];r+=t.end-t.start}r+=n.offset}return r}(e,t,n);let c=0;for(let e=t.index;e<n.index;e++){const t=o[e];(t.end-t.start)/i>s&&c++}const d=l/(r-a*c),u=e.zoomTo(d);let p=0;d<u&&(p=(u-d)*e.width/2);let h=-p;for(let n=0;n<e.displayedRegions.length;n++){const r=e.displayedRegions[n];if(t.index===n){h+=t.offset;break}h+=r.end-r.start}e.scrollTo(Math.round(h/e.bpPerPx))}function a(e,t){return Math.floor(e.reversed?e.end-t:e.start+t)+1}function o(e,t){let n=0;const{bpPerPx:r,offsetPx:o,displayedRegions:i,interRegionPaddingWidth:s,staticBlocks:l}=e,c=l.contentBlocks,d=(o+t)*r;if(d<0){const e=i[0];return{...e,oob:!0,coord:a(e,d),offset:d,index:0}}const u=s*r;let p=0;for(let e=0;e<i.length;e++){const t=i[e],r=t.end-t.start,o=d-n;if(r+n>d&&n<=d)return{...t,oob:!1,offset:o,coord:a(t,o),index:e};c[p]?.regionNumber===e?(n+=r+u,p++):n+=r}if(d>=n&&i.length>0){const e=i.at(-1),t=d-n+(e.end-e.start);return{...e,oob:!0,offset:t,coord:a(e,t),index:i.length-1}}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}function i({refName:e,coord:t,regionNumber:n,self:r}){let a=0;const{interRegionPaddingWidth:o,bpPerPx:i,displayedRegions:s,staticBlocks:l}=r,c=l.contentBlocks,d=o*i;let u=0,p=0;for(;p<s.length;p++){const r=s[p],o=r.end-r.start;if(e===r.refName&&t>=r.start&&t<=r.end&&(!n||n===p)){a+=r.reversed?r.end-t:t-r.start;break}c[u]?.regionNumber===p?(a+=o+d,u++):a+=o}if(s[p])return{index:p,offsetPx:Math.round(a/i)}}n.d(t,{Ii:()=>o,eB:()=>i,tw:()=>r})},95600:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(99546),a=n(69566);function o(e){const{POS:t,REF:n="",ALT:a=[]}=e,o=a.includes("<TRA>"),i=t-1;if(a.some(e=>e.includes("<"))){const t=e.INFO;if(t.END&&!o)return+t.END[0];const n=[];if(t.SVLEN&&!o){const e=t.SVLEN;for(let t=0;t<e.length;t++){const r=e[t];a[t]?.startsWith("<INS")?n.push(1):n.push(Math.abs(+r))}return i+(0,r.max)(n)}}return i+n.length}class i{constructor(e){this.variant=e.variant,this.parser=e.parser,this.data=function(e,t){const{REF:n="",ALT:r,POS:i,CHROM:s,ID:l}=e,c=i-1,[d,u]=(0,a.M_)(n,r,t);return{refName:s,start:c,end:o(e),description:u,type:d,name:l?.join(",")}}(this.variant,this.parser),this._id=e.id}get(e){return"samples"===e?this.variant.SAMPLES():"genotypes"===e?this.variant.GENOTYPES():this.data[e]??this.variant[e]}parent(){}children(){}id(){return this._id}toJSON(){const{SAMPLES:e,GENOTYPES:t,...n}=this.variant;return{uniqueId:this._id,...n,...this.data,samples:this.variant.SAMPLES()}}}},95742:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var r=n(35470),a=n(69500);class o extends r.A{supportsSVG=!0;constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.configSchema=e.configSchema,this.pluginManager=e.pluginManager}async render(e){return{reactElement:(0,a.jsx)(this.ReactComponent,{...e})}}freeResources(e){}}},95805:(e,t,n)=>{function r(e,t,n,r){let a=0,o=0;const i=[],s=n&&t;for(let l=0;l<e.length;l+=2){const c=+e[l],d=e[l+1];if("M"===d||"="===d||"E"===d){if(s)for(let e=0;e<c;e++)t[o+e].toUpperCase()!==n[a+e].toUpperCase()&&i.push({start:a+e,type:"mismatch",base:t[o+e],altbase:n[a+e],length:1});o+=c}if("I"===d)i.push({start:a,type:"insertion",base:`${c}`,insertedBases:t?.slice(o,o+c),length:0}),o+=c;else if("D"===d)i.push({start:a,type:"deletion",base:"*",length:c});else if("N"===d)i.push({start:a,type:"skip",base:"N",length:c});else if("X"===d){const e=t?.slice(o,o+c)||[],n=r?.subarray(o,o+c)||[];for(let t=0;t<c;t++)i.push({start:a+t,type:"mismatch",base:e[t]||"X",qual:n[t],length:1});o+=c}else"H"===d?i.push({start:a,type:"hardclip",base:`H${c}`,cliplen:c,length:1}):"S"===d&&(i.push({start:a,type:"softclip",base:`S${c}`,cliplen:c,length:1}),o+=c);"I"!==d&&"S"!==d&&"H"!==d&&(a+=c)}return i}n.r(t),n.d(t,{featurizeSA:()=>y,getClip:()=>m,getLength:()=>h,getLengthOnRef:()=>p,getLengthSansClipping:()=>g,getMismatches:()=>c,getNextRefPos:()=>o.h,getOrientedCigar:()=>d,getOrientedMismatches:()=>u,getTag:()=>f,parseCigar:()=>l});const a=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi);var o=n(49256);const i=new RegExp(/(\d+)[SH]$/),s=new RegExp(/^(\d+)([SH])/);function l(e=""){let t,n,r="";const a=[];for(let o=0,i=e.length;o<i;o++){const i=e[o];i>="0"&&i<="9"?r+=i:(t=r,n=i,r="",a.push(t,n))}return a}function c(e,t,n,o,i){let s=[];const c=l(e);return e&&(s=s.concat(r(c,n,o,i))),t&&n&&(s=s.concat(function(e,t,n,r,o){let i={start:0,base:"",length:0,type:"mismatch"},s=0,l=0,c=0,d=0;const u=[],p=n.filter(e=>"skip"===e.type);function h(){u.push(i),i={start:i.start+i.length,length:0,base:"",type:"mismatch"}}function g(e){let n=l,r=c;for(let a=s;a<t.length&&r<=e;a+=2,s=a){const e=+t[a],o=t[a+1];"S"===o||"I"===o?n+=e:"D"===o||"P"===o||"N"===o?r+=e:"H"!==o&&(n+=e,r+=e)}return l=n,c=r,n-(r-e)}const m=e.match(a)||[];for(const e of m){const t=+e;if(Number.isNaN(t))if(e.startsWith("^"))i.start+=e.length-1;else for(let t=0;t<e.length;t+=1){for(i.length=1;d<p.length;){const e=p[d];if(!(i.start>=e.start))break;i.start+=e.length,d++}const t=g(i.start);i.base=r[t]||"X",i.qual=o?.[t],i.altbase=e,h()}else i.start+=t}return u}(t,c,s,n,i))),s}function d(e,t){if(e){const e=[];for(let n=0;n<t.length;n+=2){const r=t[n];let a=t[n+1];"D"===a?a="I":"I"===a&&(a="D"),e.push(r,a)}return e}return t}function u(e,t){const n=l(t);return r(e?d(e,n):n)}function p(e){const t=l(e);let n=0;for(let e=0;e<t.length;e+=2){const r=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"I"!==a&&(n+=r)}return n}function h(e){const t=l(e);let n=0;for(let e=0;e<t.length;e+=2){const r=+t[e],a=t[e+1];"D"!==a&&"N"!==a&&(n+=r)}return n}function g(e){const t=l(e);let n=0;for(let e=0;e<t.length;e+=2){const r=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"D"!==a&&"N"!==a&&(n+=r)}return n}function m(e,t){return-1===t?+(i.exec(e)||[])[1]||0:+(s.exec(e)||[])[1]||0}function f(e,t){return e.get("tags")[t]}function y(e,t,n,r,a){return e?.split(";").filter(e=>!!e).map((e,o)=>{const i=e.split(","),s=i[0],l=i[1],c=i[2],d=i[3],u=p(d),f=h(d),y=g(d),b="-"===c?-1:1,w=m(d,(a?n:1)*b),v=+l-1;return{refName:s,start:v,end:v+u,seqLength:f,clipPos:w,CIGAR:d,strand:(a?n:1)*b,uniqueId:`${t}_SA${o}`,mate:{start:w,end:w+y,refName:r}}})||[]}},96480:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(7552),a=n(8656),o=n(99546),i=n(77888),s=n(68446),l=n(67758),c=n(93062),d=n(69500);function u(e){const t=(0,l.c)(17),{TextFieldProps:n,inputBoxVal:r,params:a,setInputValue:o,setCurrentSearch:i}=e,{helperText:s,slotProps:u}=n;let p;t[0]!==u?(p=void 0===u?{}:u,t[0]=u,t[1]=p):p=t[1];const h=p;let g,m,f,y;return t[2]!==r||t[3]!==o?(g=()=>{o(r)},t[2]=r,t[3]=o,t[4]=g):g=t[4],t[5]!==a.InputProps||t[6]!==h.input?(m={input:{...a.InputProps,...h.input}},t[5]=a.InputProps,t[6]=h.input,t[7]=m):m=t[7],t[8]!==i?(f=e=>{i(e.target.value)},t[8]=i,t[9]=f):f=t[9],t[10]!==n||t[11]!==s||t[12]!==a||t[13]!==g||t[14]!==m||t[15]!==f?(y=(0,d.jsx)(c.A,{onBlur:g,...a,...n,size:"small",helperText:s,slotProps:m,placeholder:"Search for location",onChange:f}),t[10]=n,t[11]=s,t[12]=a,t[13]=g,t[14]=m,t[15]=f,t[16]=y):y=t[16],y}const p=(0,s.observer)(function({model:e,onSelect:t,assemblyName:n,style:s,fetchResults:l,onChange:c,value:p,minWidth:h=200,maxWidth:g=550,TextFieldProps:m={}}){const f=(0,o.getSession)(e),{assemblyManager:y}=f,[b,w]=(0,r.useState)(!1),[v,S]=(0,r.useState)(!0),[x,C]=(0,r.useState)(""),[k,T]=(0,r.useState)(""),[A,M]=(0,r.useState)(),P=(0,o.useDebounce)(x,50),R=n?y.get(n):void 0,{coarseVisibleLocStrings:I,hasDisplayedRegions:L}=e;(0,r.useEffect)(()=>{const e={cancelled:!1};return(async()=>{try{if(""===P||!n)return;S(!1);const t=await l(P);e.cancelled||M(function(e){return Object.entries(function(e){const t={};for(const n of e){const e=n.getDisplayString();t[e]||(t[e]=[]),t[e].push(n)}return t}(e)).map(([e,t])=>1===t.length?{result:t[0]}:{result:new a.A({displayString:e,results:t,label:e})})}(t))}catch(t){console.error(t),e.cancelled||f.notifyError(`${t}`,t)}finally{e.cancelled||S(!0)}})(),()=>{e.cancelled=!0}},[n,l,P,f]);const F=I||p||"",N=R?.regions,D=(0,r.useMemo)(()=>N?.map(e=>({result:new a.S({refName:e.refName,label:e.refName,displayString:e.refName,matchedAttribute:"refName"})}))||[],[N]);return(0,d.jsx)(i.A,{"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!n,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:{...s,width:Math.min(Math.max((0,o.measureText)(F,14)+100,h),g)},value:F,loading:!v,inputValue:k,onInputChange:(e,t)=>{T(t),c?.(t)},loadingText:"loading results",open:b,onOpen:()=>{w(!0)},onClose:()=>{w(!1),S(!0),L&&(C(""),M(void 0))},onChange:(e,r)=>{r&&n&&(t?.("string"==typeof r?new a.A({label:r}):r.result),T(F))},options:A?.length?A:D,getOptionDisabled:e=>"limitOption"===e.group,filterOptions:(e,{inputValue:t})=>function(e,t){const n=(r=e,o=t.toLocaleLowerCase(),r.filter(({result:e})=>e.getLabel().toLowerCase().includes(o)||e.matchedObject));var r,o;return[...n.slice(0,100),...n.length>100?[{group:"limitOption",result:new a.A({label:"keep typing for more results"})}]:[]]}(e,t),renderInput:e=>(0,d.jsx)(u,{params:e,inputBoxVal:F,TextFieldProps:m,setCurrentSearch:C,setInputValue:T}),getOptionLabel:e=>"string"==typeof e?e:e.result.getDisplayString()})})},97884:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(36422),a=n(95095),o=n(93707),i=n(88530),s=n(99546),l=n(8832);const c=r.types.model("Base1DView",{id:l.ElementId,displayedRegions:r.types.optional(r.types.frozen(),[]),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:r.types.optional(r.types.number,0),minimumBlockWidth:r.types.optional(r.types.number,0)}).volatile(()=>({features:void 0,volatileWidth:0})).actions(e=>({setDisplayedRegions(t){e.displayedRegions=(0,r.cast)(t)},setBpPerPx(t){e.bpPerPx=t},setVolatileWidth(t){e.volatileWidth=t}})).views(e=>({get width(){return e.volatileWidth},get assemblyNames(){return[...new Set(e.displayedRegions.map(e=>e.assemblyName))]},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return(0,s.sum)(e.displayedRegions.map(e=>e.end-e.start))}})).views(e=>({get dynamicBlocks(){return(0,o.A)(e)},get staticBlocks(){return(0,i.A)(e)},get currBp(){return(0,s.sum)(this.dynamicBlocks.map(e=>e.end-e.start))}})).views(e=>({pxToBp:t=>(0,a.Ii)(e,t),bpToPx:({refName:t,coord:n,regionNumber:r})=>(0,a.eB)({refName:t,coord:n,regionNumber:r,self:e})?.offsetPx})).actions(e=>({setFeatures(t){e.features=t},showAllRegions(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut(){this.zoomTo(2*e.bpPerPx)},zoomIn(){this.zoomTo(e.bpPerPx/2)},zoomTo(t,n=e.width/2){const r=(0,s.clamp)(t,"minBpPerPx"in e?e.minBpPerPx:0,"maxBpPerPx"in e?e.maxBpPerPx:Number.POSITIVE_INFINITY),a=e.bpPerPx;return Math.abs(a-r)<1e-6?a:(e.bpPerPx=r,e.offsetPx=(0,s.clamp)(Math.round((e.offsetPx+n)*a/r-n),e.minOffset,e.maxOffset),e.bpPerPx)},scrollTo(t){const n=(0,s.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},centerAt(t,n,r){if(!n)return;const a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&this.scrollTo(Math.round(a-e.width/2))},scroll(t){const n=e.offsetPx,r=(0,s.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}})).actions(e=>({moveTo(t,n){(0,a.tw)(e,t,n)}}))},98111:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(92880),a=n(31415),o=n(68584),i=n(99546),s=n(75762);class l extends r.default{layoutSessions={};createLayoutSession(e){return new a.h(e)}getLayoutSession(e){return this.layoutSessions[(0,i.getLayoutId)(e)]}getWorkerSession(e){const t=(0,i.getLayoutId)(e);return this.layoutSessions[t]||(this.layoutSessions[t]=this.createLayoutSession(e)),this.layoutSessions[t].update(e)}getExpandedRegion(e,t){const{bpPerPx:n,config:r}=t,a=(0,o.readConfObject)(r,"maxFeatureGlyphExpansion")||0,i=Math.round(a*n);return{...e,start:Math.floor(Math.max(e.start-i,0)),end:Math.ceil(e.end+i)}}freeResources(e){this.freeResourcesInWorker(e)}freeResourcesInWorker(e){const{regions:t}=e,n=(0,i.getLayoutId)(e),r=this.layoutSessions[n];if(r){const e=t[0];r.layout.discardRange(e.refName,e.start,e.end)}}async freeResourcesInClient(e,t){const{regions:n}=t,r=(0,i.getLayoutId)(t),a=this.layoutSessions[r];if(a){const e=n[0];a.layout.discardRange(e.refName,e.start,e.end)}return super.freeResourcesInClient(e,t)}deserializeLayoutInClient(e){return new s.A(e)}deserializeResultsInClient(e,t){const n=this.deserializeLayoutInClient(e.layout);return super.deserializeResultsInClient({...e,layout:n},t)}createLayoutInWorker(e){const{regions:t}=e,{layout:n}=this.getWorkerSession(e);return n.getSublayout(t[0].refName)}serializeResultsInWorker(e,t){const{features:n,...r}=super.serializeResultsInWorker(e,t),a=t.regions[0],o=e.layout.serializeRegion(this.getExpandedRegion(a,t));return{...r,layout:o,maxHeightReached:o.maxHeightReached,features:void 0!==o.rectangles?n.filter(e=>!!o.rectangles[e.uniqueId]):n}}async render(e){const t=e.layout||this.createLayoutInWorker(e);return{...await super.render({...e,layout:t}),layout:t}}}},98506:(e,t,n)=>{n.d(t,{Jy:()=>d,aE:()=>u,u1:()=>c});var r=n(67758),a=n(7552),o=n(13862),i=n(31673),s=n(18010),l=n(69500);async function c(e,t,n,r){const{exportSVG:a,highResolutionScaling:c=1}=n;if(a){if(a.rasterizeLayers){const n=a.scale||c,o=(0,s.Nw)(Math.ceil(e*n),t*n),d=o.getContext("2d");if(!d)throw new Error("2d canvas rendering not supported on this platform");return d.scale(n,n),{...await r(d),reactElement:(0,l.jsx)("image",{width:e,height:t,xlinkHref:"convertToBlob"in o?await(0,i.y)(await o.convertToBlob({type:"image/png"})):o.toDataURL("image/png")})}}{const e=new o.CanvasSequence;return{...await r(e),canvasRecordedData:e.toJSON()}}}{const n=c,a=(0,s.Nw)(Math.ceil(e*n),t*n),o=a.getContext("2d");if(!o)throw new Error("2d canvas rendering not supported on this platform");return o.scale(n,n),{...await r(o),imageData:await(0,s.T9)(a)}}}async function d(e){const{width:t,height:r,canvasRecordedData:a}=e,i=new((await n.e(3109).then(n.t.bind(n,63109,23))).default)(t,r);return new o.CanvasSequence(a).execute(i),i.getSvg().innerHTML}function u(e){const t=(0,r.c)(3),{rendering:n}=e;let o;return t[0]!==n.html||t[1]!==n.reactElement?(o=(0,a.isValidElement)(n.reactElement)?n.reactElement:(0,l.jsx)("g",{dangerouslySetInnerHTML:{__html:n.html||""}}),t[0]=n.html,t[1]=n.reactElement,t[2]=o):o=t[2],o}},98753:(e,t,n)=>{n.d(t,{$:()=>y,z:()=>k,renderToSvg:()=>A});var r=n(67112),a=n(99546),o=n(91468),i=n(91063),s=n(42489),l=n(67758),c=n(51414),d=n(69500);function u(e){const t=(0,l.c)(6),{width:n,height:r,shift:o}=e,i=(0,c.A)(),s=n+2*o;let u,p;return t[0]!==i.palette.background.default?(u=(0,a.stripAlpha)(i.palette.background.default),t[0]=i.palette.background.default,t[1]=u):u=t[1],t[2]!==r||t[3]!==s||t[4]!==u?(p=(0,d.jsx)("rect",{width:s,height:r,fill:u}),t[2]=r,t[3]=s,t[4]=u,t[5]=p):p=t[5],p}var p=n(97884),h=n(27703);function g(e){const t=(0,l.c)(11),{model:n,height:r}=e,{dynamicBlocks:a,offsetPx:o,interRegionPaddingWidth:i}=n;let s,c;if(t[0]!==a.contentBlocks||t[1]!==r||t[2]!==i||t[3]!==o){let e;t[5]!==r||t[6]!==i||t[7]!==o?(e=e=>(0,d.jsx)("rect",{x:e.offsetPx-o-i,width:i,y:0,height:r,fill:"grey"},e.key),t[5]=r,t[6]=i,t[7]=o,t[8]=e):e=t[8],s=a.contentBlocks.slice(1).map(e),t[0]=a.contentBlocks,t[1]=r,t[2]=i,t[3]=o,t[4]=s}else s=t[4];return t[9]!==s?(c=(0,d.jsx)(d.Fragment,{children:s}),t[9]=s,t[10]=c):c=t[10],c}function m(e){const t=(0,l.c)(11),{start:n,end:r,bpPerPx:o,reversed:i,major:s,minor:u,hideText:p}=e,g=void 0!==i&&i,m=void 0===s||s,y=void 0===u||u,b=void 0!==p&&p,w=(0,h.H2)(n,r,o,m,y),v=(0,c.A)();let S;t[0]!==v.palette.text.secondary?(S=(0,a.stripAlpha)(v.palette.text.secondary),t[0]=v.palette.text.secondary,t[1]=S):S=t[1];const x=S;let C;t[2]!==o||t[3]!==x||t[4]!==r||t[5]!==g||t[6]!==n?(C=e=>{const t=(g?r-e.base:e.base-n)/o;return(0,d.jsx)("line",{x1:t,x2:t,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:x},`tick-${e.base}`)},t[2]=o,t[3]=x,t[4]=r,t[5]=g,t[6]=n,t[7]=C):C=t[7];const k=w.map(C),T=b?null:w.filter(f).map(e=>{const t=(g?r-e.base:e.base-n)/o;return(0,d.jsx)("text",{x:t-3,y:18,fontSize:11,fill:x,children:(0,a.getTickDisplayStr)(e.base+1,o)},`label-${e.base}`)});let A;return t[8]!==k||t[9]!==T?(A=(0,d.jsxs)(d.Fragment,{children:[k,T]}),t[8]=k,t[9]=T,t[10]=A):A=t[10],A}function f(e){return"major"===e.type}function y(e){const t=(0,l.c)(20),{model:n,fontSize:r}=e,{dynamicBlocks:o,offsetPx:i,bpPerPx:s}=n,{contentBlocks:u}=o,p=u.length<5,h=(0,c.A)();let f;t[0]!==h.palette.text.primary?(f=(0,a.stripAlpha)(h.palette.text.primary),t[0]=h.palette.text.primary,t[1]=f):f=t[1];const y=f;let b,w,v;if(t[2]!==n?(b=(0,d.jsx)(g,{model:n,height:30}),t[2]=n,t[3]=b):b=t[3],t[4]!==s||t[5]!==y||t[6]!==u||t[7]!==r||t[8]!==p||t[9]!==i){let e;t[11]!==s||t[12]!==y||t[13]!==r||t[14]!==p||t[15]!==i?(e=e=>{const{start:t,end:n,key:a,reversed:o,offsetPx:l,refName:c,widthPx:u}=e,h=l-i,g=`clip-${a}`;return(0,d.jsxs)("g",{children:[(0,d.jsx)("defs",{children:(0,d.jsx)("clipPath",{id:g,children:(0,d.jsx)("rect",{x:0,y:0,width:u,height:100})})}),(0,d.jsx)("g",{transform:`translate(${h} 0)`,children:(0,d.jsxs)("g",{clipPath:`url(#${g})`,children:[(0,d.jsx)("text",{x:4,y:r,fontSize:r,fill:y,children:c}),(0,d.jsx)("g",{transform:"translate(0 20)",children:(0,d.jsx)(m,{hideText:!p,start:t,end:n,bpPerPx:s,reversed:o})})]})})]},a)},t[11]=s,t[12]=y,t[13]=r,t[14]=p,t[15]=i,t[16]=e):e=t[16],w=u.map(e),t[4]=s,t[5]=y,t[6]=u,t[7]=r,t[8]=p,t[9]=i,t[10]=w}else w=t[10];return t[17]!==b||t[18]!==w?(v=(0,d.jsxs)(d.Fragment,{children:[b,w]}),t[17]=b,t[18]=w,t[19]=v):v=t[19],v}function b(e){const t=(0,l.c)(25),{model:n,fontSize:r}=e,{offsetPx:o,dynamicBlocks:i}=n,{totalWidthPxWithoutBorders:s,totalBp:u}=i,p=(0,c.A)();let h;t[0]!==u?(h=(0,a.getBpDisplayStr)(u),t[0]=u,t[1]=h):h=t[1];const g=h,m=Math.max(-o,0),f=m+s;let y;t[2]!==p.palette.text.secondary?(y=(0,a.stripAlpha)(p.palette.text.secondary),t[2]=p.palette.text.secondary,t[3]=y):y=t[3];const b=y,w=m+(f-m)/2,v=r;let S,x,C,k,T;return t[4]!==b||t[5]!==m||t[6]!==f?(S=(0,d.jsx)("line",{x1:m,x2:f,y1:10,y2:10,stroke:b}),t[4]=b,t[5]=m,t[6]=f,t[7]=S):S=t[7],t[8]!==b||t[9]!==m?(x=(0,d.jsx)("line",{x1:m,x2:m,y1:5,y2:15,stroke:b}),t[8]=b,t[9]=m,t[10]=x):x=t[10],t[11]!==b||t[12]!==f?(C=(0,d.jsx)("line",{x1:f,x2:f,y1:5,y2:15,stroke:b}),t[11]=b,t[12]=f,t[13]=C):C=t[13],t[14]!==b||t[15]!==g||t[16]!==r||t[17]!==w||t[18]!==v?(k=(0,d.jsx)("text",{x:w,y:v,textAnchor:"middle",dominantBaseline:"hanging",fontSize:r,fill:b,children:g}),t[14]=b,t[15]=g,t[16]=r,t[17]=w,t[18]=v,t[19]=k):k=t[19],t[20]!==S||t[21]!==x||t[22]!==C||t[23]!==k?(T=(0,d.jsxs)(d.Fragment,{children:[S,x,C,k]}),t[20]=S,t[21]=x,t[22]=C,t[23]=k,t[24]=T):T=t[24],T}var w=n(84481),v=n(32474),S=n(76239);function x(e){const t=(0,l.c)(46),{model:n,fontSize:r,cytobandHeight:o,rulerHeight:i}=e,{width:s,assemblyNames:u,showCytobands:h,displayedRegions:g}=n;let m,f;if(t[0]!==u[0]||t[1]!==u.length||t[2]!==n){const{assemblyManager:e}=(0,a.getSession)(n);m=u.length>1?"":u[0],f=e.get(m),t[0]=u[0],t[1]=u.length,t[2]=n,t[3]=m,t[4]=f}else m=t[3],f=t[4];const x=f,C=(0,c.A)();let k;t[5]!==C.palette.text.primary?(k=(0,a.stripAlpha)(C.palette.text.primary),t[5]=C.palette.text.primary,t[6]=k):k=t[6];const T=k;let A,M,P,R,I;if(t[7]!==g||t[8]!==n.dynamicBlocks.contentBlocks||t[9]!==n.minimumBlockWidth||t[10]!==s){I=Symbol.for("react.early_return_sentinel");e:{P=p.A.create({displayedRegions:JSON.parse(JSON.stringify(g)),interRegionPaddingWidth:0,minimumBlockWidth:n.minimumBlockWidth});const e=n.dynamicBlocks.contentBlocks;if(!e.length){I=null;break e}P.setVolatileWidth(s),P.showAllRegions(),A=P.dynamicBlocks.contentBlocks[0];const t=e.at(0),r=e.at(-1);M=P.bpToPx({...t,coord:t.reversed?t.end:t.start})||0,R=P.bpToPx({...r,coord:r.reversed?r.start:r.end})||0}t[7]=g,t[8]=n.dynamicBlocks.contentBlocks,t[9]=n.minimumBlockWidth,t[10]=s,t[11]=A,t[12]=M,t[13]=P,t[14]=R,t[15]=I}else A=t[11],M=t[12],P=t[13],R=t[14],I=t[15];if(I!==Symbol.for("react.early_return_sentinel"))return I;const L=R,F=+h*o;let N,D;t[16]!==m||t[17]!==T||t[18]!==r?(N=(0,d.jsx)("text",{x:0,y:0,dominantBaseline:"hanging",fontSize:r,fill:T,children:m}),t[16]=m,t[17]=T,t[18]=r,t[19]=N):N=t[19],t[20]!==x||t[21]!==A||t[22]!==M||t[23]!==L||t[24]!==n||t[25]!==P||t[26]!==i||t[27]!==h?(D=h?(0,d.jsxs)("g",{transform:`translate(0 ${i})`,children:[(0,d.jsx)(w.A,{overview:P,assembly:x,block:A}),(0,d.jsx)("rect",{stroke:"red",fill:"rgb(255,0,0)",fillOpacity:.1,width:Math.max(L-M,.5),height:S.Gu-1,x:M,y:.5}),(0,d.jsx)("g",{transform:`translate(0,${S.Gu})`,children:(0,d.jsx)(v.A,{overview:P,model:n,useOffset:!1})})]}):null,t[20]=x,t[21]=A,t[22]=M,t[23]=L,t[24]=n,t[25]=P,t[26]=i,t[27]=h,t[28]=D):D=t[28];const B=`translate(0 ${r+F})`;let j,V;t[29]!==r||t[30]!==n?(j=(0,d.jsx)(b,{model:n,fontSize:r}),t[29]=r,t[30]=n,t[31]=j):j=t[31],t[32]!==B||t[33]!==j?(V=(0,d.jsx)("g",{transform:B,children:j}),t[32]=B,t[33]=j,t[34]=V):V=t[34];const E=`translate(0 ${i+F})`;let z,O,H;return t[35]!==r||t[36]!==n?(z=(0,d.jsx)(y,{model:n,fontSize:r}),t[35]=r,t[36]=n,t[37]=z):z=t[37],t[38]!==E||t[39]!==z?(O=(0,d.jsx)("g",{transform:E,children:z}),t[38]=E,t[39]=z,t[40]=O):O=t[40],t[41]!==O||t[42]!==N||t[43]!==D||t[44]!==V?(H=(0,d.jsxs)("g",{id:"header",children:[N,D,V,O]}),t[41]=O,t[42]=N,t[43]=D,t[44]=V,t[45]=H):H=t[45],H}function C(e){const t=(0,l.c)(13),{trackLabels:n,trackName:r,fontSize:o,trackLabelOffset:i,x:s}=e,u=(0,c.A)();let p;t[0]!==u.palette.text.primary?(p=(0,a.stripAlpha)(u.palette.text.primary),t[0]=u.palette.text.primary,t[1]=p):p=t[1];const h=p,g="overlay"===n?5:0,m="offset"===n?5:0;let f;t[2]!==r?(f=(0,a.coarseStripHTML)(r),t[2]=r,t[3]=f):f=t[3];const y=f;let b;return t[4]!==h||t[5]!==o||t[6]!==y||t[7]!==i||t[8]!==n||t[9]!==s||t[10]!==g||t[11]!==m?(b="none"!==n?(0,d.jsx)("g",{children:"left"===n?(0,d.jsx)("text",{x:i-40,y:20,fill:h,fontSize:o,dominantBaseline:"hanging",textAnchor:"end",children:y}):(0,d.jsx)("text",{x:s+g,y:m,fill:h,fontSize:o,dominantBaseline:"hanging",children:y})}):null,t[4]=h,t[5]=o,t[6]=y,t[7]=i,t[8]=n,t[9]=s,t[10]=g,t[11]=m,t[12]=b):b=t[12],b}function k(e){const t=(0,l.c)(9),{displayResults:n,model:r,textHeight:i,fontSize:s,trackLabels:c,trackLabelOffset:u}=e,p=void 0===c?"offset":c,h=void 0===u?0:u;let m,f;if(t[0]!==n||t[1]!==s||t[2]!==r||t[3]!==i||t[4]!==h||t[5]!==p){const e=(0,a.getSession)(r),l="offset"===p?i:0;m=n.reduce((t,n)=>{const{prevOffset:a,reactElements:i}=t,{track:c,result:u}=n,m=c.configuration,f=(0,o.getTrackName)(m,e),y=c.displays[0],b=Math.max(-r.offsetPx,0);return{prevOffset:a+y.height+l,reactElements:[...i,(0,d.jsxs)("g",{transform:`translate(0 ${a})`,children:[(0,d.jsxs)("g",{transform:`translate(${h} ${l})`,children:[(0,d.jsx)(g,{model:r,height:y.height}),u]}),(0,d.jsx)(C,{trackName:f,fontSize:s,trackLabels:p,trackLabelOffset:h,x:b})]},m.trackId)]}},{prevOffset:0,reactElements:[]}),t[0]=n,t[1]=s,t[2]=r,t[3]=i,t[4]=h,t[5]=p,t[6]=m}else m=t[6];return t[7]!==m.reactElements?(f=(0,d.jsx)(d.Fragment,{children:m.reactElements}),t[7]=m.reactElements,t[8]=f):f=t[8],f}var T=n(26612);async function A(e,t){await(0,s.when)(()=>e.initialized);const{textHeight:n=18,headerHeight:l=40,rulerHeight:c=50,fontSize:p=13,cytobandHeight:h=100,trackLabels:g="offset",themeName:m="default",Wrapper:f=({children:e})=>e}=t,y=(0,a.getSession)(e),{allThemes:b}=y,w=b?.()[m],{width:v,pinnedTracks:S,unpinnedTracks:C,tracks:A,showCytobands:M}=e,P=l+c+ +M*h+10,R=(0,T.m)(A,n,g)+P+100,I=await Promise.all([...S,...C].map(async e=>{const n=e.displays[0];return await(0,s.when)(()=>!n.renderProps().notReady),{track:e,result:await n.renderSvg({...t,theme:w})}})),L=(0,a.max)(A.map(e=>(0,a.measureText)((0,o.getTrackName)(e.configuration,y),p)),0)+40,F="left"===g?L:0,N=v+F;return(0,a.renderToStaticMarkup)((0,d.jsx)(i.A,{theme:(0,r.createJBrowseTheme)(w),children:(0,d.jsx)(f,{children:(0,d.jsxs)("svg",{width:N,height:R,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,N+100,R].toString(),children:[(0,d.jsx)(u,{width:N,height:R,shift:50}),(0,d.jsxs)("g",{transform:"translate(50 0)",children:[(0,d.jsx)("g",{transform:`translate(${F})`,children:(0,d.jsx)(x,{model:e,fontSize:p,rulerHeight:c,cytobandHeight:h})}),(0,d.jsx)("g",{transform:`translate(0 ${P})`,children:(0,d.jsx)(k,{textHeight:n,fontSize:p,model:e,displayResults:I,trackLabels:g,trackLabelOffset:F})})]})]})})}))}},98911:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var r=n(68584),a=n(99546),o=n(90863),i=n(68446),s=n(90461),l=n(69500);const c=(0,i.observer)(function(e){const{model:t}=e,{stats:n,height:i,graphType:c}=t,{trackLabels:d}=(0,a.getContainingView)(t),u=(0,a.getContainingTrack)(t);return(0,l.jsxs)("div",{children:[(0,l.jsx)(o.GQ,{...e}),n&&c?(0,l.jsx)("svg",{style:{position:"absolute",top:0,left:"overlapping"===d?(0,a.measureText)((0,r.getConf)(u,"name"),12.8)+100:50,pointerEvents:"none",height:i,width:50},children:(0,l.jsx)(s.A,{model:t})}):null]})})},99412:(e,t,n)=>{n.d(t,{D:()=>i});var r=n(99546),a=n(91468),o=n(36422);async function i({model:e,adapterConfig:t,blocks:n,opts:i}){const{rpcManager:s}=(0,r.getSession)(e),l=(0,a.getRpcSessionId)(e);return await s.call(l,"PileupGetVisibleModifications",{adapterConfig:t,sessionId:l,regions:n.contentBlocks,statusCallback:t=>{(0,o.isAlive)(e)&&e.setMessage(t)},...i})}},99834:(e,t,n)=>{n.r(t),n.d(t,{RemoteFileWithRangeCache:()=>u,getFetcher:()=>y,openLocation:()=>f,resolveUriLocation:()=>m});var r=n(70777),a=n.n(r),o=n(25604),i=n(42307),s=n(1520),l=n(58230);const c={},d=new s.j({fetch:function(e,t,n,r={}){const a=c[e];if(!a)throw new Error(`fetch not registered for ${e}`);return a(e,t,n,r)},size:524288e3,chunkSize:131072,maxFetchSize:104857600,minimumTTL:864e5});class u extends l.A{async fetch(e,t){const n=String(e);c[n]||(c[n]=this.fetchBinaryRange.bind(this));const r=new Headers(t?.headers).get("range");if(r){const t=/bytes=(\d+)-(\d+)/.exec(r);if(t){const[,n,r]=t,a=Number.parseInt(n,10),o=Number.parseInt(r,10)-a,{buffer:i,headers:s}=await d.getRange(`${e}`,a,o+1);return new Response(i,{status:206,headers:s})}}return super.fetch(e,t)}async fetchBinaryRange(e,t,n,r={}){const a=new Date,o=await super.fetch(e,{...r,headers:{...r.headers,range:`bytes=${t}-${n}`}}),i=new Date;if(!o.ok){const r=`HTTP ${o.status} fetching ${e} bytes ${t}-${n}`,a=" (should be 206 for range requests)";throw new Error(`${r}${200===o.status?a:""}`)}const s={};for(const[e,t]of o.headers.entries())s[e]=t;const l=await o.arrayBuffer();return{headers:s,requestDate:a,responseDate:i,buffer:new Uint8Array(l)}}}var p=n(99546),h=n(91468),g=n(92516);function m(e){return e.baseUri?{...e,uri:new URL(e.uri,e.baseUri).href}:e}function f(e,t){if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(a()||p.isElectron)return new o.EY(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){const t=(0,h.getBlob)(e.blobId);if(!t)throw new Error(`file ("${e.name}") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);return new i.A(t)}if((0,g.C1)(e)){if(!e.uri)throw new Error("No URI provided");const n=m(e);if(t){const r=b(e,t);if(r)return r.openLocation(n)}return new u(n.uri,{fetch:w})}throw new Error("invalid fileLocation")}function y(e,t){if(!(0,g.C1)(e))throw new Error(`Not a valid UriLocation: ${JSON.stringify(e)}`);if(t){const n=b(e,t);if(n)return n.getFetcher(e)}return w}function b(e,t){const{rootModel:n}=t;if(n&&(0,g.lL)(n))return n.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}async function w(e,t){const n=await fetch(e,t);if(401===n.status&&n.headers.get("WWW-Authenticate")?.includes("Basic"))throw new g._u("Accessing HTTPBasic resource without authentication",e.toString());return n}}}]);
//# sourceMappingURL=7258.12f6199e.chunk.js.map