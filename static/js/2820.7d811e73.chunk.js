"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2820,5904],{12820:(e,t,n)=>{n.d(t,{default:()=>c});var s=n(99546),a=n(99834),r=n(18340),o=n(35904);class c extends o.default{async setupPre(e){return function(e,t){const{statusCallback:n=()=>{}}=t||{};let s="",a="",o=0,c=0,i=0,l=0,u=0,m=0,h=[],f=0,p=0,g=!1;const d=[],b=new RegExp(/^>(\S+)\s+(\S+)\s+(\d+)\s+(\d+)/);return(0,r.P)(e,e=>{const t=b.exec(e);if(null!==t)return s=t[1],a=t[2],g=!0,!0;if(!g)return!0;const n=e.split(" ");if(7===n.length){const e=+n[0],t=+n[1],s=+n[2],a=+n[3],r=+n[4];u=e<t&&s<a||e>t&&s>a?1:-1,i=Math.min(e,t)-1,l=Math.max(t,e),o=Math.min(s,a)-1,c=Math.max(a,s),f=p=0,m=r,h=[]}else if(1===n.length){const t=+n[0];if(0===t){let t=0;const n=[];if(l-i-f!==c-o-p)throw new Error(`inconsistent alignment on line ${e}`);h.push(l-i-f<<4);for(const e of h){const s=e>>4;t+=s,n.push(s+"MID".charAt(15&e))}d.push({qname:a,qstart:o,qend:c,tname:s,tstart:i,tend:l,strand:u,extra:{numMatches:t-m,blockLen:t,mappingQual:0,NM:m,cg:n.join("")}})}else if(t>0){const e=t-1;f+=e+1,p+=e,e>0&&h.push(e<<4),h.length>0&&2==(15&h[h.length-1])?h[h.length-1]+=16:h.push(18)}else{const e=-t-1;f+=e,p+=e+1,e>0&&h.push(e<<4),h.length>0&&1==(15&h[h.length-1])?h[h.length-1]+=16:h.push(17)}}return!0},n),d}(await(0,s.fetchAndMaybeUnzip)((0,a.openLocation)(this.getConf("deltaLocation"),this.pluginManager),e),e)}}},18340:(e,t,n)=>{n.d(t,{P:()=>a});var s=n(99546);function a(e,t,n=()=>{}){const a=new TextDecoder("utf8");let r=0,o=0;for(;r<e.length;){const c=e.indexOf(10,r),i=-1===c?e.length:c,l=e.subarray(r,i),u=a.decode(l).trim();if(u&&!1===t(u,o))break;o++%1e4==0&&n(`Loading ${(0,s.getProgressDisplayStr)(r,e.length)}`),r=i+1}}},35904:(e,t,n)=>{n.d(t,{default:()=>p});var s=n(46377),a=n(99546),r=n(99834),o=n(18340),c=n(32595),i=n(66885),l=n(16062),u=n(72147),m=n(78054);function h(e){const[t,n]=e.reduce(([e,t],[n,s])=>[e+n*s,t+s],[0,0]);return t/n}const{parseCigar:f}=l.aF;class p extends s.BaseFeatureDataAdapter{static capabilities=["getFeatures","getRefNames"];async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async setupPre(e){const t=[];return(0,o.P)(await(0,a.fetchAndMaybeUnzip)((0,r.openLocation)(this.getConf("pafLocation"),this.pluginManager),e),e=>(t.push((0,m.xI)(e)),!0),e?.statusCallback),t}async hasDataForRefName(){return!0}getAssemblyNames(){const e=this.getConf("assemblyNames");return 0===e.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}async getRefNames(e={}){const t=e.regions?.[0].assemblyName,n=await this.setup(e),s=this.getAssemblyNames().indexOf(t);if(-1!==s){const e=new Set;for(const t of n)e.add(0===s?t.qname:t.tname);return[...e]}return console.warn("Unable to do ref renaming on adapter"),[]}getFeatures(e,t={}){return(0,i.ObservableCreate)(async n=>{const s=function(e){const t={};for(const n of e){const e=`${n.qname}-${n.tname}`;t[e]||(t[e]={quals:[],len:[]}),t[e].quals.push(n.extra.mappingQual||1),t[e].len.push(n.extra.blockLen||1)}const n=Object.fromEntries(Object.entries(t).map(([e,t])=>[e,h((0,m.yU)(t.quals,t.len))]));for(const t of e){const e=`${t.qname}-${t.tname}`;t.extra.meanScore=n[e]}let s=1e4,a=0;for(const t of e)s=Math.min(t.extra.meanScore||0,s),a=Math.max(t.extra.meanScore||0,a);for(const t of e){const e=t.extra.meanScore||0;t.extra.meanScore=(e-s)/(a-s)}return e}(await this.setup(t)),a=this.getAssemblyNames(),{start:r,end:o,refName:i,assemblyName:l}=e,p=a.indexOf(l),g=0===p;-1===p&&(console.warn(`${l} not found in this adapter`),n.complete());for(let e=0;e<s.length;e++){const t=s[e];let h=0,p=0,d="",b="",y=0,x=0;g?(h=t.qstart,p=t.qend,d=t.qname,b=t.tname,y=t.tstart,x=t.tend):(h=t.tstart,p=t.tend,d=t.tname,b=t.qname,y=t.qstart,x=t.qend);const{extra:q,strand:w}=t;if(d===i&&(0,c.R6)(r,o,h,p)){const{numMatches:t=0,blockLen:s=1,cg:r,...o}=q;let c=q.cg;q.cg&&(g&&-1===w?c=(0,m.qm)(f(q.cg)).join(""):g&&(c=(0,m.gJ)(q.cg))),n.next(new u.A({uniqueId:e+l,assemblyName:l,start:h,end:p,type:"match",refName:d,strand:w,...o,CIGAR:c,syntenyId:e,identity:t/s,numMatches:t,blockLen:s,mate:{start:y,end:x,refName:b,assemblyName:a[+g]}}))}}n.complete()})}}},72147:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(99546),a=n(16062);const{getMismatches:r}=a.aF;class o extends s.SimpleFeature{get(e){return"mismatches"===e?r(this.get("CIGAR")):super.get(e)}}},78054:(e,t,n)=>{n.d(t,{TA:()=>r,fY:()=>a,gJ:()=>l,qm:()=>i,xI:()=>c,yU:()=>o});var s=n(99546);function a(e){return new Map(e.split(/\n|\r\n|\r/).filter(e=>!!e||e.startsWith("#")).map(e=>{const[t,n,s,a,r,o]=e.split("\t");return[a,{refName:t,start:+n,end:+s,score:+r,name:a,strand:"-"===o?-1:1}]}))}async function r(e,t){return(0,s.fetchAndMaybeUnzipText)(e,t)}function o(e,t){return e.map((e,n)=>[e,t[n]])}function c(e){const t=e.split("\t"),n=t.slice(12),s={numMatches:+t[9],blockLen:+t[10],mappingQual:+t[11]};if(n.length)for(const e of n){const t=e.indexOf(":");s[e.slice(0,t)]=e.slice(t+3)}return{tname:t[5],tstart:+t[7],tend:+t[8],qname:t[0],qstart:+t[2],qend:+t[3],strand:"-"===t[4]?-1:1,extra:s}}function i(e){const t=[];for(let n=e.length-2;n>=0;n-=2){t.push(e[n]);const s=e[n+1];"D"===s?t.push("I"):"I"===s?t.push("D"):t.push(s)}return t}function l(e){return e.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}}}]);
//# sourceMappingURL=2820.7d811e73.chunk.js.map