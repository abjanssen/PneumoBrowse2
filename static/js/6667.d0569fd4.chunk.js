"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6667,7396],{3571(e,t,o){o.d(t,{A:()=>a,q:()=>s});var r=o(99287),n=o(47739);function s(e){return(0,n.Ay)("MuiRadio",e)}const a=(0,r.A)("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"])},4149(e,t,o){o.d(t,{A:()=>h});var r=o(42918),n=o(77710),s=o(62981),a=o(58919),l=o(47405),i=o(95660),c=o(6335),d=o(68654),u=o(77500),p=o(32118);const h=r.forwardRef(function(e,t){const{actions:o,children:h,className:m,defaultValue:b,name:v,onChange:A,value:g,...f}=e,y=r.useRef(null),x=(e=>{const{classes:t,row:o,error:r}=e,n={root:["root",o&&"row",r&&"error"]};return(0,s.A)(n,l.B,t)})(e),[C,j]=(0,c.A)({controlled:g,default:b,name:"RadioGroup"});r.useImperativeHandle(o,()=>({focus:()=>{let e=y.current.querySelector("input:not(:disabled):checked");e||(e=y.current.querySelector("input:not(:disabled)")),e&&e.focus()}}),[]);const w=(0,i.A)(t,y),k=(0,u.A)(v),S=r.useMemo(()=>({name:k,onChange(e){j(e.target.value),A&&A(e,e.target.value)},value:C}),[k,A,j,C]);return(0,p.jsx)(d.A.Provider,{value:S,children:(0,p.jsx)(a.A,{role:"radiogroup",ref:w,className:(0,n.A)(x.root,m),...f,children:h})})})},5106(e,t,o){o.d(t,{A:()=>F});var r=o(42918),n=o(77710),s=o(62981),a=o(94116),l=o(63881),i=o(32118);const c=(0,l.A)((0,i.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),d=(0,l.A)((0,i.jsx)("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked");var u=o(62466),p=o(41680),h=o(711);const m=(0,p.Ay)("span",{name:"MuiRadioButtonIcon",shouldForwardProp:u.A})({position:"relative",display:"flex"}),b=(0,p.Ay)(c,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),v=(0,p.Ay)(d,{name:"MuiRadioButtonIcon"})((0,h.A)(({theme:e})=>({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}}]}))),A=function(e){const{checked:t=!1,classes:o={},fontSize:r}=e,n={...e,checked:t};return(0,i.jsxs)(m,{className:o.root,ownerState:n,children:[(0,i.jsx)(b,{fontSize:r,className:o.background,ownerState:n}),(0,i.jsx)(v,{fontSize:r,className:o.dot,ownerState:n})]})};var g=o(88842),f=o(19046),y=o(74620),x=o(70690),C=o(3571),j=o(70668),w=o(53137),k=o(32717);const S=(0,p.Ay)(a.A,{shouldForwardProp:e=>(0,u.A)(e)||"classes"===e,name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,"medium"!==o.size&&t[`size${(0,g.A)(o.size)}`],t[`color${(0,g.A)(o.color)}`]]}})((0,h.A)(({theme:e})=>({color:(e.vars||e).palette.text.secondary,[`&.${C.A.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter((0,j.A)()).map(([t])=>({props:{color:t,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter((0,j.A)()).map(([t])=>({props:{color:t,disabled:!1},style:{[`&.${C.A.checked}`]:{color:(e.vars||e).palette[t].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),R=(0,i.jsx)(A,{checked:!0}),P=(0,i.jsx)(A,{}),F=r.forwardRef(function(e,t){const o=(0,k.b)({props:e,name:"MuiRadio"}),{checked:a,checkedIcon:l=R,color:c="primary",icon:d=P,name:u,onChange:p,size:h="medium",className:m,disabled:b,disableRipple:v=!1,slots:A={},slotProps:j={},inputProps:F,...M}=o,B=(0,y.A)();let z=b;B&&void 0===z&&(z=B.disabled),z??=!1;const $={...o,disabled:z,disableRipple:v,color:c,size:h},I=(e=>{const{classes:t,color:o,size:r}=e,n={root:["root",`color${(0,g.A)(o)}`,"medium"!==r&&`size${(0,g.A)(r)}`]};return{...t,...(0,s.A)(n,C.q,t)}})($),q=(0,x.A)();let L=a;const N=(0,f.A)(p,q&&q.onChange);let T=u;var O,E;q&&(void 0===L&&(O=q.value,L="object"==typeof(E=o.value)&&null!==E?O===E:String(O)===String(E)),void 0===T&&(T=q.name));const _=j.input??F,[G,V]=(0,w.A)("root",{ref:t,elementType:S,className:(0,n.A)(I.root,m),shouldForwardComponentProp:!0,externalForwardedProps:{slots:A,slotProps:j,...M},getSlotProps:e=>({...e,onChange:(t,...o)=>{e.onChange?.(t,...o),N(t,...o)}}),ownerState:$,additionalProps:{type:"radio",icon:r.cloneElement(d,{fontSize:d.props.fontSize??h}),checkedIcon:r.cloneElement(l,{fontSize:l.props.fontSize??h}),disabled:z,name:T,checked:L,slots:A,slotProps:{input:"function"==typeof _?_($):_}}});return(0,i.jsx)(G,{...V,classes:I})})},18403(e,t,o){o.d(t,{A:()=>a,u:()=>s});var r=o(99287),n=o(47739);function s(e){return(0,n.Ay)("MuiFormControlLabel",e)}const a=(0,r.A)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"])},37015(e,t,o){o.d(t,{A:()=>g});var r=o(42918),n=o(77710),s=o(62981),a=o(74620),l=o(41680),i=o(711),c=o(32717),d=o(1591),u=o(88842),p=o(18403),h=o(89278),m=o(53137),b=o(32118);const v=(0,l.Ay)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${p.A.label}`]:t.label},t.root,t[`labelPlacement${(0,u.A)(o.labelPlacement)}`]]}})((0,i.A)(({theme:e})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${p.A.disabled}`]:{cursor:"default"},[`& .${p.A.label}`]:{[`&.${p.A.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:e})=>"start"===e||"top"===e||"bottom"===e,style:{marginLeft:16}}]}))),A=(0,l.Ay)("span",{name:"MuiFormControlLabel",slot:"Asterisk"})((0,i.A)(({theme:e})=>({[`&.${p.A.error}`]:{color:(e.vars||e).palette.error.main}}))),g=r.forwardRef(function(e,t){const o=(0,c.b)({props:e,name:"MuiFormControlLabel"}),{checked:l,className:i,componentsProps:g={},control:f,disabled:y,disableTypography:x,inputRef:C,label:j,labelPlacement:w="end",name:k,onChange:S,required:R,slots:P={},slotProps:F={},value:M,...B}=o,z=(0,a.A)(),$=y??f.props.disabled??z?.disabled,I=R??f.props.required,q={disabled:$,required:I};["checked","name","onChange","value","inputRef"].forEach(e=>{void 0===f.props[e]&&void 0!==o[e]&&(q[e]=o[e])});const L=(0,h.A)({props:o,muiFormControl:z,states:["error"]}),N={...o,disabled:$,labelPlacement:w,required:I,error:L.error},T=(e=>{const{classes:t,disabled:o,labelPlacement:r,error:n,required:a}=e,l={root:["root",o&&"disabled",`labelPlacement${(0,u.A)(r)}`,n&&"error",a&&"required"],label:["label",o&&"disabled"],asterisk:["asterisk",n&&"error"]};return(0,s.A)(l,p.u,t)})(N),O={slots:P,slotProps:{...g,...F}},[E,_]=(0,m.A)("typography",{elementType:d.A,externalForwardedProps:O,ownerState:N});let G=j;return null==G||G.type===d.A||x||(G=(0,b.jsx)(E,{component:"span",..._,className:(0,n.A)(T.label,_?.className),children:G})),(0,b.jsxs)(v,{className:(0,n.A)(T.root,i),ownerState:N,ref:t,...B,children:[r.cloneElement(f,q),I?(0,b.jsxs)("div",{children:[G,(0,b.jsxs)(A,{ownerState:N,"aria-hidden":!0,className:T.asterisk,children:["â€‰","*"]})]}):G]})})},47405(e,t,o){o.d(t,{A:()=>a,B:()=>s});var r=o(99287),n=o(47739);function s(e){return(0,n.Ay)("MuiRadioGroup",e)}const a=(0,r.A)("MuiRadioGroup",["root","row","error"])},68654(e,t,o){o.d(t,{A:()=>r});const r=o(42918).createContext(void 0)},70690(e,t,o){o.d(t,{A:()=>s});var r=o(42918),n=o(68654);function s(){return r.useContext(n.A)}},86667(e,t,o){o.r(t),o.d(t,{default:()=>M});var r=o(30936),n=o(42918),s=o(85787),a=o(1591),l=o(4149),i=o(37015),c=o(5106),d=o(64074),u=o(27351),p=o(77251),h=o(8201),m=o(52901),b=o(70203),v=o(99226),A=o(24215),g=o(65525),f=o(11543),y=o(23628),x=o(32118);const C=(0,d.observer)(function({model:e,children:t,handleClose:o}){const[r,s]=(0,n.useState)(""),[a,l]=(0,n.useState)(!1),[i,c]=(0,n.useState)(),[d,C]=(0,n.useState)(),{rpcManager:j}=(0,p.getSession)(e),{sourcesVolatile:w,minorAlleleFrequencyFilter:k,lengthCutoffFilter:S,adapterConfig:R,renderingMode:P,sampleInfo:F}=e,M="phased"===P;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(A.A,{children:[t,M?(0,x.jsx)("div",{style:{marginTop:8,fontStyle:"italic"},children:"Note: Clustering by individual haplotypes (phased mode)"}):null,(0,x.jsxs)("div",{children:[a?(0,x.jsxs)("div",{style:{padding:50},children:[(0,x.jsx)("span",{children:r||"Loading..."}),(0,x.jsx)(g.A,{onClick:()=>{(0,m.CF)(d)},children:"Stop"})]}):null,i?(0,x.jsx)(u.A,{error:i}):null]})]}),(0,x.jsxs)(f.A,{children:[(0,x.jsx)(g.A,{variant:"contained",disabled:a||!w,onClick:async()=>{try{c(void 0),s("Initializing"),l(!0);const t=(0,p.getContainingView)(e);if(!t.initialized)return;if(w){const o=(0,b.getRpcSessionId)(e),r=(0,m.y5)();C(r);const n=await j.call(o,"MultiVariantClusterGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:w,minorAlleleFrequencyFilter:k,lengthCutoffFilter:S,sessionId:o,adapterConfig:R,stopToken:r,renderingMode:P,sampleInfo:F,statusCallback:e=>{s(e)}});if(M&&F){const t=(0,y.d)({sources:w,sampleInfo:F});e.setLayout(n.order.map(e=>t[e]),!1)}else e.setLayout(n.order.map(e=>w[e]),!1);e.setClusterTree(n.tree)}o()}catch(t){!(0,h.Kp)(t)&&(0,v.isAlive)(e)&&(console.error(t),c(t))}finally{l(!1),s(""),C(void 0)}},children:"Run clustering"}),(0,x.jsx)(g.A,{variant:"contained",color:"secondary",onClick:()=>{o(),d&&(0,m.CF)(d)},children:"Cancel"})]})]})});var j=o(87574),w=o(65045),k=o(58955),S=o(15675);const R=(0,w.n)()({textAreaFont:{fontFamily:"Courier New"}}),P=(0,d.observer)(function({model:e,handleClose:t,children:r}){const{classes:s}=R(),[d,m]=(0,n.useState)(""),[y,C]=(0,n.useState)(),[w,P]=(0,n.useState)(),[F,M]=(0,n.useState)(!1),[B,z]=(0,p.useLocalStorage)("cluster-showAdvanced",!1),[$,I]=(0,n.useState)("single");(0,n.useEffect)(()=>{(async()=>{try{P(void 0),C(void 0),M(!0);const t=(0,p.getContainingView)(e);if(!t.initialized)return;const{rpcManager:o}=(0,p.getSession)(e),{sourcesWithoutLayout:r,minorAlleleFrequencyFilter:n,lengthCutoffFilter:s,adapterConfig:a}=e,l=(0,b.getRpcSessionId)(e),i=await o.call(l,"MultiVariantGetGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:r,minorAlleleFrequencyFilter:n,lengthCutoffFilter:s,sessionId:l,adapterConfig:a});C(i)}catch(t){!(0,h.Kp)(t)&&(0,v.isAlive)(e)&&(console.error(t),P(t))}finally{M(!1)}})()},[e]);const q=y?String.raw`inputMatrix<-matrix(c(${Object.values(y).map(e=>e.join(",")).join(",\n")}
),nrow=${Object.values(y).length},byrow=TRUE)
rownames(inputMatrix)<-c(${Object.keys(y).map(e=>`'${e}'`).join(",")})
resultClusters<-hclust(dist(inputMatrix), method='${$}')
cat(resultClusters$order,sep='\n')`:void 0,L=y?Object.entries(y).map(([e,t])=>[e,...t].join("\t")).join("\n"):void 0;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(A.A,{children:[r,(0,x.jsxs)(k.A,{style:{padding:16},children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"16px"},children:[(0,x.jsx)(g.A,{variant:"contained",onClick:async()=>{const{saveAs:e}=await o.e(9044).then(o.bind(o,99044));e(new Blob([q||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,x.jsx)(g.A,{variant:"contained",onClick:async()=>{const{default:e}=await o.e(8284).then(o.t.bind(o,88284,23));e(q||"")},children:"Copy Rscript to clipboard"})," ","or"," ",(0,x.jsx)(g.A,{variant:"contained",onClick:async()=>{const{saveAs:e}=await o.e(9044).then(o.bind(o,99044));e(new Blob([L||""],{type:"text/plain;charset=utf-8"}),"genotypes.tsv")},children:"Download TSV"}),(0,x.jsx)("div",{children:(0,x.jsx)(g.A,{variant:"contained",onClick:()=>{z(!B)},children:B?"Hide advanced options":"Show advanced options"})})]}),B?(0,x.jsxs)("div",{children:[(0,x.jsx)(a.A,{variant:"h6",children:"Advanced options"}),(0,x.jsx)(l.A,{children:Object.entries({single:"Single",complete:"Complete"}).map(([e,t])=>(0,x.jsx)(i.A,{control:(0,x.jsx)(c.A,{checked:$===e,onChange:()=>{I(e)}}),label:t},e))})]}):null,q?(0,x.jsx)("div",{}):F?(0,x.jsx)(j.A,{variant:"h6",message:"Generating genotype matrix"}):w?(0,x.jsx)(u.A,{error:w}):null]}),(0,x.jsxs)("div",{children:[(0,x.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,style:{marginTop:"16px"},children:"Clustering Results:"}),(0,x.jsx)(S.A,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:d,onChange:e=>{m(e.target.value)},slotProps:{input:{classes:{input:s.textAreaFont}}}})]})]})]}),(0,x.jsxs)(f.A,{children:[(0,x.jsx)(g.A,{variant:"contained",onClick:()=>{const{sourcesWithoutLayout:o}=e;if(o)try{e.setLayout(d.split("\n").map(e=>e.trim()).filter(e=>!!e).map(e=>+e).map(e=>{const t=o[e-1];if(!t)throw new Error(`out of bounds at ${e}`);return t}))}catch(t){console.error(t),(0,p.getSession)(e).notifyError(`${t}`,t)}t()},children:"Apply clustering"}),(0,x.jsx)(g.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})});function F(e){const t=(0,r.c)(5),{activeMode:o,setActiveMode:n}=e;let s,d,u;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,x.jsx)(a.A,{style:{marginBottom:30},children:"This procedure will cluster the visible genotype data using hierarchical clustering"}),t[0]=s):s=t[0],t[1]===Symbol.for("react.memo_cache_sentinel")?(d=Object.entries({auto:(0,x.jsx)("div",{children:"Run in-app clustering (slower, particularly for large numbers of samples, uses JS implementation of hclust)"}),manual:(0,x.jsx)("div",{children:"Download R script to run clustering (faster, uses R implementation of hclust)"})}),t[1]=d):d=t[1],t[2]!==o||t[3]!==n?(u=(0,x.jsxs)("div",{children:[s,(0,x.jsx)(l.A,{children:d.map(e=>{const[t,r]=e;return(0,x.jsx)(i.A,{control:(0,x.jsx)(c.A,{checked:o===t,onChange:()=>{n(t)}}),label:r},t)})})]}),t[2]=o,t[3]=n,t[4]=u):u=t[4],u}const M=(0,d.observer)(function({model:e,handleClose:t}){const[o,r]=(0,n.useState)("auto");return(0,x.jsx)(s.A,{open:!0,title:"Cluster by genotype",onClose:(e,o)=>{"backdropClick"!==o&&t()},children:"auto"===o?(0,x.jsx)(C,{model:e,handleClose:t,children:(0,x.jsx)(F,{activeMode:o,setActiveMode:r})}):(0,x.jsx)(P,{model:e,handleClose:t,children:(0,x.jsx)(F,{activeMode:o,setActiveMode:r})})})})},94116(e,t,o){o.d(t,{A:()=>g});var r=o(42918),n=o(62981),s=o(88842),a=o(62466),l=o(41680),i=o(6335),c=o(74620),d=o(61302),u=o(99287),p=o(47739);function h(e){return(0,p.Ay)("PrivateSwitchBase",e)}(0,u.A)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);var m=o(53137),b=o(32118);const v=(0,l.Ay)(d.A,{name:"MuiSwitchBase"})({padding:9,borderRadius:"50%",variants:[{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>"start"===e&&"small"!==t.size,style:{marginLeft:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>"end"===e&&"small"!==t.size,style:{marginRight:-12}}]}),A=(0,l.Ay)("input",{name:"MuiSwitchBase",shouldForwardProp:a.A})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),g=r.forwardRef(function(e,t){const{autoFocus:o,checked:r,checkedIcon:a,defaultChecked:l,disabled:d,disableFocusRipple:u=!1,edge:p=!1,icon:g,id:f,inputProps:y,inputRef:x,name:C,onBlur:j,onChange:w,onFocus:k,readOnly:S,required:R=!1,tabIndex:P,type:F,value:M,slots:B={},slotProps:z={},...$}=e,[I,q]=(0,i.A)({controlled:r,default:Boolean(l),name:"SwitchBase",state:"checked"}),L=(0,c.A)();let N=d;L&&void 0===N&&(N=L.disabled);const T="checkbox"===F||"radio"===F,O={...e,checked:I,disabled:N,disableFocusRipple:u,edge:p},E=(e=>{const{classes:t,checked:o,disabled:r,edge:a}=e,l={root:["root",o&&"checked",r&&"disabled",a&&`edge${(0,s.A)(a)}`],input:["input"]};return(0,n.A)(l,h,t)})(O),_={slots:B,slotProps:{input:y,...z}},[G,V]=(0,m.A)("root",{ref:t,elementType:v,className:E.root,shouldForwardComponentProp:!0,externalForwardedProps:{..._,component:"span",...$},getSlotProps:e=>({...e,onFocus:t=>{e.onFocus?.(t),(e=>{k&&k(e),L&&L.onFocus&&L.onFocus(e)})(t)},onBlur:t=>{e.onBlur?.(t),(e=>{j&&j(e),L&&L.onBlur&&L.onBlur(e)})(t)}}),ownerState:O,additionalProps:{centerRipple:!0,focusRipple:!u,disabled:N,role:void 0,tabIndex:null}}),[D,W]=(0,m.A)("input",{ref:x,elementType:A,className:E.input,externalForwardedProps:_,getSlotProps:e=>({...e,onChange:t=>{e.onChange?.(t),(e=>{if(e.nativeEvent.defaultPrevented||S)return;const t=e.target.checked;q(t),w&&w(e,t)})(t)}}),ownerState:O,additionalProps:{autoFocus:o,checked:r,defaultChecked:l,disabled:N,id:T?f:void 0,name:C,readOnly:S,required:R,tabIndex:P,type:F,..."checkbox"===F&&void 0===M?{}:{value:M}}});return(0,b.jsxs)(G,{...V,children:[(0,b.jsx)(D,{...W}),I?a:g]})})}}]);
//# sourceMappingURL=6667.d0569fd4.chunk.js.map