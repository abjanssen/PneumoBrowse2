{"version":3,"file":"static/js/9261.cf149007.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../plugins/hic/src/LinearHicDisplay/components/HicSVGColorLegend.tsx","webpack://@jbrowse/web/../../plugins/hic/src/LinearHicDisplay/renderSvg.tsx"],"sourcesContent":["import { toLocale } from '@jbrowse/core/util'\nimport { scaleLinear, scaleLog } from '@mui/x-charts-vendor/d3-scale'\n\nconst colorStops: Record<string, { offset: string; color: string }[]> = {\n  juicebox: [\n    { offset: '0%', color: 'rgba(0,0,0,0)' },\n    { offset: '100%', color: 'red' },\n  ],\n  fall: [\n    { offset: '0%', color: 'rgb(255,255,255)' },\n    { offset: '10%', color: 'rgb(255,255,204)' },\n    { offset: '20%', color: 'rgb(255,237,160)' },\n    { offset: '30%', color: 'rgb(254,217,118)' },\n    { offset: '40%', color: 'rgb(254,178,76)' },\n    { offset: '50%', color: 'rgb(253,141,60)' },\n    { offset: '60%', color: 'rgb(252,78,42)' },\n    { offset: '70%', color: 'rgb(227,26,28)' },\n    { offset: '80%', color: 'rgb(189,0,38)' },\n    { offset: '90%', color: 'rgb(128,0,38)' },\n    { offset: '100%', color: 'rgb(0,0,0)' },\n  ],\n  viridis: [\n    { offset: '0%', color: '#440154' },\n    { offset: '11%', color: '#482878' },\n    { offset: '22%', color: '#3e4a89' },\n    { offset: '33%', color: '#31688e' },\n    { offset: '44%', color: '#26828e' },\n    { offset: '55%', color: '#1f9e89' },\n    { offset: '66%', color: '#35b779' },\n    { offset: '77%', color: '#6ece58' },\n    { offset: '88%', color: '#b5de2b' },\n    { offset: '100%', color: '#fde725' },\n  ],\n}\n\nfunction getNiceScale(maxScore: number, useLogScale?: boolean) {\n  if (useLogScale) {\n    // Use base 2 for log scale like wiggle plugin does\n    const scale = scaleLog().base(2).domain([1, maxScore]).nice()\n    const [min, max] = scale.domain()\n    return { min, max }\n  }\n  const scale = scaleLinear().domain([0, maxScore]).nice()\n  const [min, max] = scale.domain()\n  return { min, max }\n}\n\nexport default function HicSVGColorLegend({\n  maxScore,\n  colorScheme = 'juicebox',\n  useLogScale,\n  width,\n  legendAreaWidth,\n}: {\n  maxScore: number\n  colorScheme?: string\n  useLogScale?: boolean\n  width: number\n  legendAreaWidth?: number\n}) {\n  const gradientId = `hic-gradient-${colorScheme}`\n  const stops = colorStops[colorScheme] || colorStops.juicebox!\n  const { min, max } = getNiceScale(maxScore, useLogScale)\n  const minLabel = min !== undefined ? toLocale(min) : ''\n  const maxLabel = `${max !== undefined ? toLocale(max) : ''}${useLogScale ? ' (log)' : ''}`\n\n  const legendWidth = 120\n  const legendHeight = 40\n  const barWidth = 100\n  const barHeight = 12\n  const padding = 8\n  const fontSize = 10\n\n  // Position legend to the right if legendAreaWidth is provided, otherwise top-right inside\n  const x = legendAreaWidth ? width + 10 : width - legendWidth - 10\n  const y = 10\n\n  return (\n    <g transform={`translate(${x}, ${y})`}>\n      <defs>\n        <linearGradient id={gradientId} x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n          {stops.map((stop, idx) => (\n            <stop\n              key={idx}\n              offset={stop.offset}\n              style={{ stopColor: stop.color, stopOpacity: 1 }}\n            />\n          ))}\n        </linearGradient>\n      </defs>\n      <rect\n        x={0}\n        y={0}\n        width={legendWidth}\n        height={legendHeight}\n        fill=\"rgba(255,255,255,0.9)\"\n        stroke=\"#ccc\"\n        strokeWidth={1}\n        rx={4}\n      />\n      <rect\n        x={padding}\n        y={padding}\n        width={barWidth}\n        height={barHeight}\n        fill={`url(#${gradientId})`}\n        rx={2}\n      />\n      <text\n        x={padding}\n        y={padding + barHeight + fontSize + 2}\n        fontSize={fontSize}\n        fill=\"black\"\n      >\n        {minLabel}\n      </text>\n      <text\n        x={padding + barWidth}\n        y={padding + barHeight + fontSize + 2}\n        fontSize={fontSize}\n        fill=\"black\"\n        textAnchor=\"end\"\n      >\n        {maxLabel}\n      </text>\n    </g>\n  )\n}\n","import type React from 'react'\n\nimport {\n  getContainingView,\n  getRpcSessionId,\n  getSession,\n} from '@jbrowse/core/util'\nimport {\n  ReactRendering,\n  renderingToSvg,\n} from '@jbrowse/core/util/offscreenCanvasUtils'\n\nimport HicSVGColorLegend from './components/HicSVGColorLegend.tsx'\n\nimport type { LinearHicDisplayModel } from './model.ts'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface RenderingResult {\n  reactElement?: React.ReactNode\n  html?: string\n  canvasRecordedData?: unknown\n  maxScore?: number\n}\n\nexport async function renderSvg(\n  self: LinearHicDisplayModel,\n  opts: ExportSvgDisplayOptions,\n) {\n  const view = getContainingView(self) as LGV\n  const session = getSession(self)\n  const { rpcManager } = session\n  const height = opts.overrideHeight ?? self.height\n\n  const { useLogScale, colorScheme, showLegend, adapterConfig } = self\n  const { bpPerPx, dynamicBlocks } = view\n  const regions = dynamicBlocks.contentBlocks\n\n  if (!regions.length) {\n    return null\n  }\n\n  const renderProps = self.renderProps()\n\n  // Call CoreRender RPC method (same as afterAttach uses)\n  // Use getRpcSessionId to ensure we use the same worker as normal rendering\n  const rpcSessionId = getRpcSessionId(self)\n  const rendering = (await rpcManager.call(rpcSessionId, 'CoreRender', {\n    sessionId: rpcSessionId,\n    rendererType: 'HicRenderer',\n    regions: [...regions],\n    adapterConfig,\n    bpPerPx,\n    ...renderProps,\n    exportSVG: opts,\n  })) as RenderingResult\n\n  const finalRendering = await renderingToSvg(\n    rendering,\n    view.staticBlocks.totalWidthPx,\n    height,\n  )\n\n  // Clip to the visible region (view width), not the full staticBlocks width\n  const visibleWidth = view.width\n\n  // Create a clip path to clip to the visible region\n  const clipId = `clip-${self.id}-svg`\n\n  // Use maxScore from rendering result or from model\n  const maxScore = rendering.maxScore ?? self.maxScore\n\n  return (\n    <>\n      <defs>\n        <clipPath id={clipId}>\n          <rect x={0} y={0} width={visibleWidth} height={height} />\n        </clipPath>\n      </defs>\n      <g clipPath={`url(#${clipId})`}>\n        <g transform={`translate(${Math.max(0, -view.offsetPx)} 0)`}>\n          <ReactRendering rendering={finalRendering} />\n        </g>\n      </g>\n      {showLegend && maxScore > 0 ? (\n        <HicSVGColorLegend\n          maxScore={maxScore}\n          colorScheme={colorScheme}\n          useLogScale={useLogScale}\n          width={visibleWidth}\n          legendAreaWidth={opts.legendWidth}\n        />\n      ) : null}\n    </>\n  )\n}\n"],"names":["colorStops","juicebox","offset","color","fall","viridis","HicSVGColorLegend","t0","$","_c","maxScore","colorScheme","t1","useLogScale","width","legendAreaWidth","undefined","gradientId","stops","minLabel","t2","min","max","scale","scaleLog","base","domain","nice","scaleLinear","getNiceScale","toLocale","maxLabel","t3","t4","t5","t6","map","_temp","_jsx","children","x1","y1","x2","y2","Symbol","for","x","y","legendWidth","legendHeight","fill","stroke","strokeWidth","rx","t7","t8","t9","t10","t11","padding","barWidth","barHeight","fontSize","textAnchor","_jsxs","transform","stop","idx","style","stopColor","stopOpacity","async","renderSvg","self","opts","view","getContainingView","session","getSession","rpcManager","height","overrideHeight","showLegend","adapterConfig","bpPerPx","dynamicBlocks","regions","contentBlocks","length","renderProps","rpcSessionId","getRpcSessionId","rendering","call","sessionId","rendererType","exportSVG","finalRendering","renderingToSvg","staticBlocks","totalWidthPx","visibleWidth","clipId","id","_Fragment","clipPath","Math","offsetPx","ReactRendering"],"sourceRoot":""}