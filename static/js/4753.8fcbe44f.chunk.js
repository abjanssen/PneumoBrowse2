"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4753],{44753:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var o=n(7552),a=n(75785),r=n(68446),s=n(49823),i=n(99546),c=n(42489),l=n(30385),f=n(36422);function u({model:e,onClose:t,anchorEl:n}){const a=(0,i.getContainingView)(e),{clientX:r,clientY:c,feature:l}=n;return o.createElement(s.Menu,{onMenuItemClick:(e,n)=>{n(e),t()},anchorEl:{nodeType:1,getBoundingClientRect:()=>({top:c,left:r,bottom:c,right:r,width:0,height:0,x:r,y:c,toJSON(){}})},onClose:t,open:Boolean(n),menuItems:[{label:"Center on feature",onClick:()=>{const{f:t}=l,n=(0,f.getParent)(e,4),o=t.get("start"),r=t.get("end"),s=t.get("refName"),c=t.get("mate"),u=a.views[n.level],d=a.views[n.level+1];u.navToLocString(`${s}:${o}-${r}`).catch((t=>{const n=`${u.assemblyNames[0]}:${t}`;console.error(n),(0,i.getSession)(e).notifyError(n,t)})),d.navToLocString(`${c.refName}:${c.start}-${c.end}`).catch((t=>{const n=`${d.assemblyNames[0]}:${t}`;console.error(n),(0,i.getSession)(e).notifyError(n,t)}))}}]})}var d=n(79610);const g=(0,o.lazy)((()=>n.e(7831).then(n.bind(n,47831)))),h=(0,a.n9)()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},mouseoverCanvas:{position:"absolute",pointEvents:"none"},mainCanvas:{position:"absolute"}}),m=(0,r.observer)((function({model:e}){const{classes:t}=h(),n=(0,o.useRef)(0),a=(0,i.getContainingView)(e),r=a.width,s=(0,o.useRef)(0),f=(0,o.useRef)(!1),m=(0,o.useRef)(),[v,b]=(0,o.useState)(),[C,p]=(0,o.useState)(""),[M,w]=(0,o.useState)(),[x,k]=(0,o.useState)(),[S,P]=(0,o.useState)(),[E,T]=(0,o.useState)(),{mouseoverId:$,height:y}=e,I=(0,o.useRef)(),X=(0,o.useCallback)((t=>{e.setMouseoverCanvasRef(t)}),[e,y,r]),N=(0,o.useCallback)((t=>{e.setMainCanvasRef(t),I.current=t}),[e,y,r]);(0,o.useEffect)((()=>{function e(e){if(e.preventDefault(),e.ctrlKey){s.current+=e.deltaY/500;for(const e of a.views)e.setScaleFactor(s.current<0?1-s.current:1/(1+s.current));m.current&&clearTimeout(m.current),m.current=setTimeout((()=>{for(const t of a.views)t.setScaleFactor(1),t.zoomTo(s.current>0?t.bpPerPx*(1+s.current):t.bpPerPx/(1-s.current),e.clientX-(I.current?.getBoundingClientRect().left||0));s.current=0}),300)}else Math.abs(e.deltaY)<Math.abs(e.deltaX)&&(n.current+=e.deltaX/2),f.current||(f.current=!0,window.requestAnimationFrame((()=>{(0,c.transaction)((()=>{for(const e of a.views)e.horizontalScroll(n.current);n.current=0,f.current=!1}))})))}return I.current?.addEventListener("wheel",e),()=>{I.current?.removeEventListener("wheel",e)}}),[e,y,r]);const R=(0,o.useCallback)((t=>{e.setClickMapCanvasRef(t)}),[e,y,r]),L=(0,o.useCallback)((t=>{e.setCigarClickMapCanvasRef(t)}),[e,y,r]);return o.createElement("div",{className:t.rel},o.createElement("canvas",{ref:X,width:r,height:y,className:t.mouseoverCanvas}),o.createElement("canvas",{ref:N,onMouseMove:t=>{if(void 0!==x)n.current+=x-t.clientX,k(t.clientX),f.current||(f.current=!0,window.requestAnimationFrame((()=>{(0,c.transaction)((()=>{for(const e of a.views)e.horizontalScroll(n.current);n.current=0,f.current=!1}))})));else{const n=e.clickMapCanvas,o=e.cigarClickMapCanvas;if(!n||!o)return;const a=n.getBoundingClientRect(),r=n.getContext("2d"),s=o.getContext("2d");if(!r||!s)return;const{clientX:i,clientY:c}=t,f=i-a.left,u=c-a.top;w(i),T(c);const[g,h,m]=r.getImageData(f,u,1,1).data,[v,b,C]=s.getImageData(f,u,1,1).data,M=Math.floor(l.xx/e.numFeats),x=(0,l.OX)(g,h,m,M);if(e.setMouseoverId(e.featPositions[x]?.f.id()),-1===x)p("");else if(e.featPositions[x]){const{f:t,cigar:n}=e.featPositions[x],o=Math.floor(l.xx/n.length),a=(0,l.OX)(v,b,C,o);p((0,d.Eg)(t,n[a],n[a+1]))}}},onMouseLeave:()=>{e.setMouseoverId(void 0),P(void 0),k(void 0)},onMouseDown:e=>{k(e.clientX),P(e.clientX)},onMouseUp:t=>{k(void 0),void 0!==S&&Math.abs(t.clientX-S)<5&&(0,d.WT)(t,e)},onContextMenu:t=>{(0,d.f0)(t,e,b)},"data-testid":"synteny_canvas",className:t.mainCanvas,width:r,height:y}),o.createElement("canvas",{ref:R,className:t.pix,width:r,height:y}),o.createElement("canvas",{ref:L,className:t.pix,width:r,height:y}),$&&C&&M&&E?o.createElement(g,{title:C}):null,v?o.createElement(u,{model:e,anchorEl:v,onClose:()=>{b(void 0)}}):null)})),v=(0,a.n9)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10},blockError:{background:"#f1f1f1",padding:10,color:"red"}}}));function b(){const[e,t]=(0,o.useState)(!1),{classes:n}=v();return(0,o.useEffect)((()=>{const e=setTimeout((()=>{t(!0)}),300);return()=>{clearTimeout(e)}})),e?o.createElement("div",{className:n.loading},o.createElement(s.LoadingEllipses,null)):null}function C({messageText:e}){const{classes:t}=v();return o.createElement("div",{className:t.blockMessage},e)}function p({error:e}){const{classes:t}=v();return o.createElement("div",{className:t.blockError},`${e}`)}const M=(0,r.observer)((function({model:e}){return e.error?o.createElement(p,{error:e.error}):e.message?o.createElement(C,{messageText:e.message}):e.features?o.createElement(m,{model:e}):o.createElement(b,null)}))},79610:(e,t,n)=>{n.d(t,{$2:()=>s,Eg:()=>l,WT:()=>i,f0:()=>c,mr:()=>r});var o=n(99546),a=n(30385);function r({feature:e,ctx:t,offsets:n,level:a,cb:r,height:i,drawCurves:c,oobLimit:l,viewWidth:f,hideTiny:u}){const{p11:d,p12:g,p21:h,p22:m}=e,v=d.offsetPx-n[a],b=g.offsetPx-n[a],C=h.offsetPx-n[a+1],p=m.offsetPx-n[a+1],M=Math.abs(b-v),w=Math.abs(p-C),x=i,k=(x-0)/2,S=Math.min(C,p),P=Math.max(C,p);(0,o.doesIntersect2)(S,P,-l,f+l)&&(M<=1&&w<=1?u||(t.beginPath(),t.moveTo(v,0),c?t.bezierCurveTo(v,k,C,k,C,x):t.lineTo(C,x),t.stroke()):(s(t,v,b,0,p,C,x,k,c),r(t)))}function s(e,t,n,o,a,r,s,i,c){c?function(e,t,n,o,a,r,s,i){const c=Math.abs(t-n),l=Math.abs(t-n);if(c<5&&l<5&&n<t&&Math.abs(t-a)>100){const e=t;t=n,n=e}e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.bezierCurveTo(n,i,a,i,a,s),e.lineTo(r,s),e.bezierCurveTo(r,i,t,i,t,o),e.closePath(),e.fill()}(e,t,n,o,a,r,s,i):function(e,t,n,o,a,r,s){e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.lineTo(a,s),e.lineTo(r,s),e.closePath(),e.fill()}(e,t,n,o,a,r,s)}function i(e,t){const n=(0,o.getContainingView)(t),r=(0,o.getContainingTrack)(t),s=t.clickMapCanvas,i=t.cigarClickMapCanvas;if(!s||!i)return;const c=s.getBoundingClientRect(),l=s.getContext("2d"),f=i.getContext("2d");if(!l||!f)return;const u=e.clientX-c.left,d=e.clientY-c.top,[g,h,m]=l.getImageData(u,d,1,1).data,v=Math.floor(a.xx/t.numFeats),b=(0,a.OX)(g,h,m,v),C=t.featPositions[b];if(C){const{f:e}=C;t.setClickId(e.id());const a=(0,o.getSession)(t);(0,o.isSessionModelWithWidgets)(a)&&a.showWidget(a.addWidget("BaseFeatureWidget","baseFeature",{view:n,track:r,featureData:e.toJSON()}))}return C}function c(e,t,n){e.preventDefault();const o=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(!o||!r)return;const s=o.getBoundingClientRect(),i=o.getContext("2d"),c=r.getContext("2d");if(!i||!c)return;const{clientX:l,clientY:f}=e,u=l-s.left,d=f-s.top,[g,h,m]=i.getImageData(u,d,1,1).data,v=Math.floor(a.xx/t.numFeats),b=(0,a.OX)(g,h,m,v),C=t.featPositions[b];C&&(t.setClickId(C.f.id()),n({clientX:l,clientY:f,feature:C}))}function l(e,t,n){const a=e.toJSON(),r=a.mate,s=a.end-a.start,i=r.end-r.start,c=a.identity,l=a.name,f=r.name;return[`Loc1: ${(0,o.assembleLocString)(a)}`,`Loc2: ${(0,o.assembleLocString)(r)}`,`Inverted: ${-1===a.strand}`,`Query len: ${s.toLocaleString("en-US")}`,`Target len: ${i.toLocaleString("en-US")}`,c?`Identity: ${c.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${n}`:"",l?`Name 1: ${l}`:"",f?`Name 1: ${f}`:""].filter((e=>!!e)).join("<br/>")}},30385:(e,t,n)=>{n.d(t,{C4:()=>g,OX:()=>u,Ww:()=>d,xx:()=>s});var o=n(99546),a=n(79610),r=n(36422);const s=16581375;function i(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const c={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},l=3,f=1600;function u(e,t,n,o){return Math.floor((255*e*255+255*t+n-1)/o)}function d(e,t,n){const u=(0,o.getContainingView)(e),d=(0,r.getParent)(e,4).level,g=u.drawCurves,h=u.drawCIGAR,{height:m,featPositions:v}=e,b=u.width,C=u.views.map((e=>e.bpPerPx));n&&(n.imageSmoothingEnabled=!1),t.beginPath();const p=u.views.map((e=>e.offsetPx)),M=Math.floor(s/v.length);t.fillStyle=c.M,t.strokeStyle=c.M;for(const{p11:e,p12:n,p21:o,p22:a}of v){const r=e.offsetPx-p[d],s=n.offsetPx-p[d],i=o.offsetPx-p[d+1],c=a.offsetPx-p[d+1],u=Math.abs(s-r),h=Math.abs(c-i),v=0,C=m,M=(C-v)/2;u<=l&&h<=l&&i<b+f&&i>-f&&(t.moveTo(r,v),g?t.bezierCurveTo(r,M,i,M,i,C):t.lineTo(i,C))}t.stroke(),t.fillStyle=c.M,t.strokeStyle=c.M;for(const{p11:e,p12:r,p21:M,p22:w,f:x,cigar:k}of v){const v=e.offsetPx-p[d],S=r.offsetPx-p[d],P=M.offsetPx-p[d+1],E=w.offsetPx-p[d+1],T=Math.abs(S-v),$=Math.abs(E-P),y=Math.min(P,E),I=Math.max(P,E),X=0,N=m,R=(N-X)/2;if(!(T<=l&&$<=l)&&(0,o.doesIntersect2)(y,I,-f,u.width+f)){const e=x.get("strand"),o=-1===e?S:v,r=o<(-1===e?v:S)?1:-1,l=(P<E?1:-1)*e;let f=o,u=-1===e?E:P;if(k.length&&h){let e=!1,o=0,h=0;const m=Math.floor(s/k.length);for(let s=0;s<k.length;s+=2){const v=s*m+1,p=+k[s],M=k[s+1];e||(o=f,h=u);const w=p/C[d],x=p/C[d+1];if("M"===M||"="===M||"X"===M?(f+=w*r,u+=x*l):"D"===M||"N"===M?f+=w*r:"I"===M&&(u+=x*l),!(Math.max(o,h,f,u)<0||Math.min(o,h,f,u)>b)){const r=s<k.length-2;Math.abs(f-o)<=1&&Math.abs(u-h)<=1&&r?e=!0:(t.fillStyle=c[e&&w>1||x>1?M:"M"],e=!1,(0,a.$2)(t,o,f,X,u,h,N,R,g),n&&(n.fillStyle=i(v),(0,a.$2)(n,o,f,X,u,h,N,R,g)))}}}else(0,a.$2)(t,v,S,X,E,P,N,R,g)}}const w=e.clickMapCanvas?.getContext("2d");if(w){w.imageSmoothingEnabled=!1,w.clearRect(0,0,b,m);for(let e=0;e<v.length;e++){const t=v[e],n=e*M+1;w.fillStyle=i(n),(0,a.mr)({cb:e=>{e.fill()},feature:t,ctx:w,drawCurves:g,level:d,offsets:p,oobLimit:f,viewWidth:u.width,hideTiny:!0,height:m})}}}function g(e){const{clickId:t,mouseoverId:n}=e,s=(0,o.getContainingView)(e),i=s.drawCurves,c=e.height,l=s.width,u=e.mouseoverCanvas?.getContext("2d"),d=s.views.map((e=>e.offsetPx)),g=(0,r.getParent)(e,4).level;if(!u)return;u.resetTransform(),u.scale(1,1),u.clearRect(0,0,l,c);const h=e.featMap[n||""];h&&(u.fillStyle="rgb(0,0,0,0.1)",(0,a.mr)({cb:e=>{e.fill()},feature:h,level:g,ctx:u,oobLimit:f,viewWidth:s.width,drawCurves:i,offsets:d,height:c}));const m=e.featMap[t||""];m&&(u.strokeStyle="rgb(0, 0, 0, 0.9)",(0,a.mr)({cb:e=>{e.stroke()},feature:m,ctx:u,level:g,oobLimit:f,viewWidth:s.width,drawCurves:i,offsets:d,height:c}))}}}]);
//# sourceMappingURL=4753.8fcbe44f.chunk.js.map