{"version":3,"file":"static/js/7561.5aa1db69.chunk.js","mappings":"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","sources":["../../../plugins/linear-genome-view/src/BaseLinearDisplay/SVGLegend.tsx","../../../plugins/alignments/src/LinearReadCloudDisplay/renderSvg.tsx","../../../plugins/alignments/src/LinearReadCloudDisplay/components/CloudYScaleBar.tsx"],"sourcesContent":["import { measureText } from '@jbrowse/core/util'\n\nimport type { LegendItem } from './components/FloatingLegend.tsx'\n\nconst LEGEND_FONT_SIZE = 10\nconst LEGEND_BOX_SIZE = 12\nconst LEGEND_PADDING = 3\n\nexport default function SVGLegend({\n  items,\n  width,\n  legendAreaWidth,\n}: {\n  items: LegendItem[]\n  width: number\n  legendAreaWidth?: number\n}) {\n  if (items.length === 0) {\n    return null\n  }\n\n  const itemHeight = LEGEND_BOX_SIZE + 2\n  const legendHeight = items.length * itemHeight + LEGEND_PADDING * 2\n\n  // Calculate legend width based on longest label\n  const maxLabelWidth = Math.max(\n    ...items.map(item => measureText(item.label, LEGEND_FONT_SIZE)),\n  )\n  const legendWidth = LEGEND_BOX_SIZE + 8 + maxLabelWidth + LEGEND_PADDING * 2\n\n  // If legendAreaWidth is provided, position legend to the right of the figure\n  // Otherwise, position it inside the figure area (top-right corner)\n  const x = legendAreaWidth ? width + 10 : width - legendWidth - 10\n  const y = 10\n\n  return (\n    <g transform={`translate(${x}, ${y})`}>\n      <rect\n        x={0}\n        y={0}\n        width={legendWidth}\n        height={legendHeight}\n        fill=\"rgba(255,255,255,0.9)\"\n        stroke=\"#ccc\"\n        strokeWidth={1}\n        rx={4}\n      />\n      {items.map((item, idx) => (\n        <g\n          key={`legend-${idx}`}\n          transform={`translate(${LEGEND_PADDING}, ${LEGEND_PADDING + idx * itemHeight})`}\n        >\n          {item.color ? (\n            <rect\n              x={0}\n              y={0}\n              width={LEGEND_BOX_SIZE}\n              height={LEGEND_BOX_SIZE}\n              fill={item.color}\n            />\n          ) : null}\n          <text\n            x={LEGEND_BOX_SIZE + 6}\n            y={LEGEND_BOX_SIZE - 2}\n            fontSize={LEGEND_FONT_SIZE}\n            fill=\"black\"\n          >\n            {item.label}\n          </text>\n        </g>\n      ))}\n    </g>\n  )\n}\n","import type React from 'react'\n\nimport {\n  getContainingView,\n  getRpcSessionId,\n  getSession,\n} from '@jbrowse/core/util'\nimport {\n  ReactRendering,\n  renderingToSvg,\n} from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { getSnapshot } from '@jbrowse/mobx-state-tree'\nimport { SVGLegend } from '@jbrowse/plugin-linear-genome-view'\n\nimport { calculateCloudTicks } from '../RenderLinearReadCloudDisplayRPC/drawFeatsCloud.ts'\nimport CloudYScaleBar from './components/CloudYScaleBar.tsx'\n\nimport type { LinearReadCloudDisplayModel } from './model.ts'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface RenderingResult {\n  reactElement?: React.ReactNode\n  html?: string\n  canvasRecordedData?: unknown\n  layoutHeight?: number\n  featuresForFlatbush?: unknown\n  cloudMaxDistance?: number\n}\n\nexport async function renderSvg(\n  self: LinearReadCloudDisplayModel,\n  opts: ExportSvgDisplayOptions,\n) {\n  const view = getContainingView(self) as LGV\n  const session = getSession(self)\n  const { rpcManager, assemblyManager } = session\n  const height = opts.overrideHeight ?? self.height\n\n  const assemblyName = view.assemblyNames[0]\n  const assembly = assemblyName ? assemblyManager.get(assemblyName) : undefined\n  const sequenceAdapterConfig = assembly?.configuration?.sequence?.adapter\n  const sequenceAdapter = sequenceAdapterConfig\n    ? getSnapshot(sequenceAdapterConfig)\n    : undefined\n\n  // Serialize the full view snapshot for RPC\n  // Include staticBlocks and width which are not part of the regular snapshot\n  const viewSnapshot = structuredClone({\n    ...getSnapshot(view),\n    staticBlocks: view.staticBlocks,\n    width: view.width,\n  })\n\n  // Call RPC method with exportSVG options\n  // Use getRpcSessionId to ensure we use the same worker as normal rendering\n  const rpcSessionId = getRpcSessionId(self)\n  const rendering = (await rpcManager.call(\n    rpcSessionId,\n    'RenderLinearReadCloudDisplay',\n    {\n      sessionId: rpcSessionId,\n      view: viewSnapshot,\n      adapterConfig: self.adapterConfig,\n      sequenceAdapter,\n      config: getSnapshot(self.configuration),\n      ...self.renderProps(),\n      cloudModeHeight: height,\n      exportSVG: opts,\n      theme: opts.theme,\n    },\n  )) as RenderingResult\n\n  const finalRendering = await renderingToSvg(\n    rendering,\n    view.staticBlocks.totalWidthPx,\n    height,\n  )\n\n  // Clip to the visible region (view width), not the full staticBlocks width\n  const visibleWidth = view.width\n\n  // Create a clip path to clip to the visible region\n  const clipId = `clip-${self.id}-svg`\n\n  // Get legend items if legend is enabled\n  const legendItems = self.showLegend ? self.legendItems() : []\n\n  // Compute cloudTicks for SVG export if in cloud mode\n  // Use [1, maxDistance] as domain since it's a log scale\n  const cloudDomain =\n    rendering.cloudMaxDistance !== undefined && self.drawCloud\n      ? ([1, rendering.cloudMaxDistance] as [number, number])\n      : null\n  const cloudTicks =\n    cloudDomain && self.showYScalebar\n      ? calculateCloudTicks(cloudDomain, height)\n      : null\n\n  return (\n    <>\n      <defs>\n        <clipPath id={clipId}>\n          <rect x={0} y={0} width={visibleWidth} height={height} />\n        </clipPath>\n      </defs>\n      <g clipPath={`url(#${clipId})`}>\n        <g transform={`translate(${Math.max(0, -view.offsetPx)} 0)`}>\n          <ReactRendering rendering={finalRendering} />\n        </g>\n      </g>\n      {cloudTicks ? (\n        <g transform={`translate(${Math.max(-view.offsetPx, 0)})`}>\n          <CloudYScaleBar model={{ cloudTicks }} orientation=\"left\" />\n        </g>\n      ) : null}\n      {legendItems.length > 0 ? (\n        <SVGLegend\n          items={legendItems}\n          width={visibleWidth}\n          legendAreaWidth={opts.legendWidth}\n        />\n      ) : null}\n    </>\n  )\n}\n","import { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { CloudTicks } from '../../RenderLinearReadCloudDisplayRPC/drawFeatsCloud.ts'\n\nfunction formatTickValue(value: number): string {\n  if (value >= 1000000) {\n    return `${(value / 1000000).toFixed(1)}M`\n  }\n  if (value >= 1000) {\n    return `${(value / 1000).toFixed(0)}k`\n  }\n  return `${value}`\n}\n\nconst CloudYScaleBar = observer(function CloudYScaleBar({\n  model,\n  orientation,\n}: {\n  model: { cloudTicks?: CloudTicks }\n  orientation?: 'left' | 'right'\n}) {\n  const theme = useTheme()\n  const cloudTicks = model.cloudTicks\n\n  if (!cloudTicks) {\n    return null\n  }\n\n  const { ticks, height } = cloudTicks\n  const bg = theme.palette.background.default\n  const fg = theme.palette.text.primary\n  const isLeft = orientation === 'left'\n  const k = isLeft ? -1 : 1\n  const tickLength = 6\n\n  return (\n    <g\n      fill=\"none\"\n      fontSize={10}\n      fontFamily=\"sans-serif\"\n      textAnchor={isLeft ? 'end' : 'start'}\n      strokeWidth={1}\n    >\n      {/* Axis line */}\n      <path\n        stroke={fg}\n        d={`M${k * tickLength},0H0.5V${height}H${k * tickLength}`}\n      />\n      {/* Ticks and labels */}\n      {ticks.map(({ value, y }) => (\n        <g key={value} transform={`translate(0,${y})`}>\n          <line stroke={fg} x2={k * tickLength} y1={0.5} y2={0.5} />\n          <text\n            stroke={bg}\n            strokeWidth={2.5}\n            paintOrder=\"stroke\"\n            fill={fg}\n            dy=\"0.32em\"\n            x={k * 9}\n            y={0.5}\n          >\n            {formatTickValue(value)}\n          </text>\n        </g>\n      ))}\n      {/* Axis label */}\n      <text\n        stroke={bg}\n        strokeWidth={2.5}\n        paintOrder=\"stroke\"\n        fill={fg}\n        fontSize={10}\n        textAnchor=\"middle\"\n        transform={`translate(${isLeft ? -30 : 30}, ${height / 2}) rotate(-90)`}\n      >\n        Insert size (bp)\n      </text>\n    </g>\n  )\n})\n\nexport default CloudYScaleBar\n"],"names":["SVGLegend","t0","$","_c","items","width","legendAreaWidth","length","legendHeight","LEGEND_BOX_SIZE","LEGEND_PADDING","t1","Math","max","map","_temp","legendWidth","t2","t3","t4","t5","_jsx","x","y","fill","stroke","strokeWidth","rx","Symbol","for","item_0","idx","_jsxs","transform","children","item","color","LEGEND_FONT_SIZE","label","measureText","async","renderSvg","self","opts","view","getContainingView","session","getSession","rpcManager","assemblyManager","height","overrideHeight","assemblyName","assemblyNames","assembly","get","undefined","sequenceAdapterConfig","configuration","sequence","adapter","sequenceAdapter","getSnapshot","viewSnapshot","structuredClone","staticBlocks","rpcSessionId","getRpcSessionId","rendering","call","sessionId","adapterConfig","config","renderProps","cloudModeHeight","exportSVG","theme","finalRendering","renderingToSvg","totalWidthPx","visibleWidth","clipId","id","legendItems","showLegend","cloudDomain","cloudMaxDistance","drawCloud","cloudTicks","showYScalebar","calculateCloudTicks","_Fragment","clipPath","offsetPx","ReactRendering","CloudYScaleBar","model","orientation","formatTickValue","value","toFixed","observer","useTheme","ticks","bg","palette","background","default","fg","text","primary","isLeft","k","fontSize","fontFamily","textAnchor","d","x2","y1","y2","paintOrder","dy"],"ignoreList":[],"sourceRoot":""}