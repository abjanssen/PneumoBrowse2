{"version":3,"file":"static/js/2146.d3e932f9.chunk.js","mappings":"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A,yBACA,6BACA,8BACA,2BACA,kCACA,gCACA,kCACA,sCACA,4BACA,2BACA,wBACA,yBACA,gCACA,8BACA,gCACA,qCACA,mCACA,8BACA,yBACA,0BACA,yBACA,yBACA,+BACA,0BACA,8BACA,+BACA,mCACA,yBACA,mCACA,yBACA,6BACA,mCACA,4CACA,iCACA,kCACA,iCACA,yBACA,6BACA,6BACA,0BACA,iCACA,kCACA,+BACA,mCACA,0BACA,4BACA,2BACA,2BACA,0BACA,+BACA,2BACA,sCACA,2BACA,6BACA,2BACA,6BACA,oCACA,8BACA,oCACA,kCACA,0BACA,yBACA,+BACA,kCACA,8BACA,6BACA,4BACA,4BACA,2BACA,wBACA,0BACA,8BACA,8BACA,mCACA,gCACA,8BACA,oCACA,6BACA,mCACA,yBACA,8BACA,qCACA,iCACA,sCACA,4BACA,4BACA,+BAEA,0BACA,iCACA,iCACA,iCACA,sBACA,2BACA,6BACA,uBACA,4BACA,yBACA,sBACA,oBACA,4BACA,uBACA,4BACA,qBACA,4BACA,+BACA,4BACA,2BACA,0BACA,iCACA,yBACA,kCACA,qBACA,yBACA,0BACA,uBACA,8BACA,4BACA,8BACA,kCACA,wBACA,uBACA,oBACA,qBACA,4BACA,0BACA,4BACA,iCACA,+BACA,0BACA,qBACA,sBACA,qBACA,qBACA,2BACA,sBACA,0BACA,2BACA,+BACA,qBACA,+BACA,qBACA,yBACA,+BACA,wCACA,6BACA,8BACA,6BACA,qBACA,yBACA,yBACA,sBACA,6BACA,8BACA,2BACA,+BACA,sBACA,wBACA,uBACA,uBACA,sBACA,2BACA,uBACA,kCACA,uBACA,yBACA,uBACA,yBACA,gCACA,0BACA,gCACA,8BACA,sBACA,qBACA,2BACA,8BACA,0BACA,yBACA,wBACA,wBACA,uBACA,oBACA,sBACA,0BACA,0BACA,+BACA,4BACA,0BACA,gCACA,yBACA,+BACA,qBACA,0BACA,iCACA,6BACA,kCACA,wBACA,wBACA,2BAEA,gCACA,qCAC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","sources":["../../../packages/core/pluggableElementTypes/renderers/ServerSideRendererType.tsx","../../../packages/core/BaseFeatureWidget/util.tsx","../../../plugins/data-management/src/PluginStoreWidget/model.ts","../../../plugins/data-management/src/PluginStoreWidget/index.ts","../../../packages/core/pluggableElementTypes/models/baseConnectionConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseConnectionModelFactory.ts","../../../packages/core/pluggableElementTypes/models/BaseDisplayModel.tsx","../../../packages/core/pluggableElementTypes/models/baseInternetAccountConfig.ts","../../../packages/core/pluggableElementTypes/models/InternetAccountModel.ts","../../../packages/core/pluggableElementTypes/models/BaseTrackModel.ts","../../../packages/core/pluggableElementTypes/models/baseTrackConfig.ts","../../../packages/core/util/layouts/MultiLayout.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Tooltip.tsx","../../../packages/core/util/map-obj.ts","../../../packages/core/pluggableElementTypes/RpcMethodType.ts","../../../packages/core/data_adapters/dataAdapterCache.ts","../../../packages/core/util/dedupe.ts","../../../plugins/linear-genome-view/src/searchUtils.ts","../../../packages/core/util/simpleFeature.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/components/faceted/util.ts","../../../packages/core/pluggableElementTypes/models/BaseViewModel.ts","../../../packages/core/pluggableElementTypes/TextSearchAdapterType.ts","../../../packages/core/TextSearch/BaseResults.ts","../../../packages/core/BaseFeatureWidget/configSchema.ts","../../../packages/core/BaseFeatureWidget/SequenceFeatureDetails/model.ts","../../../packages/core/BaseFeatureWidget/stateModelFactory.ts","../../../plugins/variants/src/shared/components/RectBg.tsx","../../../plugins/variants/src/shared/components/MultiVariantColorLegend.tsx","../../../plugins/variants/src/shared/components/MultiVariantLegendBar.tsx","../../../plugins/wiggle/src/BigWigAdapter/configSchema.ts","../../../plugins/wiggle/src/CreateMultiWiggleExtension/index.ts","../../../plugins/wiggle/src/WiggleBaseRenderer.tsx","../../../plugins/wiggle/src/DensityRenderer/DensityRenderer.ts","../../../plugins/wiggle/src/configSchema.ts","../../../plugins/wiggle/src/DensityRenderer/configSchema.ts","../../../plugins/wiggle/src/WiggleRendering.tsx","../../../plugins/wiggle/src/LinePlotRenderer/configSchema.ts","../../../plugins/wiggle/src/LinePlotRenderer/LinePlotRenderer.ts","../../../plugins/wiggle/src/shared/SharedWiggleConfigSchema.ts","../../../plugins/wiggle/src/shared/SharedWiggleMixin.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/model.ts","../../../plugins/wiggle/src/MultiDensityRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiWiggleRendering.tsx","../../../plugins/wiggle/src/MultiDensityRenderer/MultiDensityRenderer.ts","../../../plugins/wiggle/src/MultiLineRenderer/MultiLineRenderer.ts","../../../plugins/wiggle/src/MultiLineRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/model.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/MultiRowLineRenderer.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/MultiRowXYPlotRenderer.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiWiggleAdapter/configSchema.ts","../../../plugins/wiggle/src/MultiXYPlotRenderer/MultiXYPlotRenderer.ts","../../../plugins/wiggle/src/MultiXYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/WiggleRPC/MultiWiggleGetSources.ts","../../../plugins/wiggle/src/WiggleRPC/WiggleGetMultiRegionQuantitativeStats.ts","../../../plugins/wiggle/src/WiggleRPC/WiggleGetGlobalQuantitativeStats.ts","../../../plugins/wiggle/src/WiggleRPC/getScoreMatrix.ts","../../../plugins/wiggle/src/WiggleRPC/MultiWiggleGetScoreMatrix.ts","../../../plugins/wiggle/src/WiggleRPC/MultiWiggleClusterScoreMatrix.ts","../../../plugins/wiggle/src/XYPlotRenderer/XYPlotRenderer.ts","../../../plugins/wiggle/src/XYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/index.ts","../../../plugins/wiggle/src/MultiWiggleAdapter/index.ts","../../../plugins/wiggle/src/BigWigAdapter/index.ts","../../../plugins/wiggle/src/QuantitativeTrack/index.ts","../../../plugins/wiggle/src/QuantitativeTrack/configSchema.ts","../../../plugins/wiggle/src/MultiQuantitativeTrack/index.ts","../../../plugins/wiggle/src/MultiQuantitativeTrack/configSchema.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/configSchema.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/index.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/configSchema.ts","../../../plugins/wiggle/src/LinePlotRenderer/index.ts","../../../plugins/wiggle/src/XYPlotRenderer/index.ts","../../../plugins/wiggle/src/DensityRenderer/index.ts","../../../plugins/wiggle/src/MultiXYPlotRenderer/index.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/index.ts","../../../plugins/wiggle/src/MultiDensityRenderer/index.ts","../../../plugins/wiggle/src/MultiLineRenderer/index.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/index.ts","../../../plugins/wiggle/src/MultiWiggleAddTrackWorkflow/index.ts","../../../plugins/wiggle/src/GuessAdapter/index.ts","../../../packages/core/Plugin.ts","../../../packages/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions.ts","../../../packages/core/ui/FileSelector/UrlChooser.tsx","../../../packages/core/util/offscreenCanvasPonyfill.tsx","../../../packages/core/util/aborting.ts","../../../plugins/variants/src/shared/components/MultiVariantTooltip.tsx","../../../plugins/variants/src/shared/components/MultiVariantCrosshairs.tsx","../../../packages/core/ui/RedErrorMessageBox.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/util.ts","../../../packages/core/util/mst-reflection.ts","../../../packages/core/pluggableElementTypes/renderers/ServerSideRenderedContent.tsx","../../../packages/core/util/idMaker.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/util.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/configSchema.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/stateModelFactory.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/index.ts","../../../plugins/alignments/src/AlignmentsTrack/index.ts","../../../plugins/alignments/src/AlignmentsTrack/configSchemaF.ts","../../../plugins/alignments/src/BamAdapter/configSchema.ts","../../../plugins/alignments/src/BamAdapter/index.ts","../../../plugins/alignments/src/CramAdapter/configSchema.ts","../../../plugins/alignments/src/CramAdapter/index.ts","../../../plugins/alignments/src/GuessAlignmentsTypes/index.ts","../../../plugins/alignments/src/HtsgetBamAdapter/configSchema.ts","../../../plugins/alignments/src/HtsgetBamAdapter/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/components/AlignmentsDisplay.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/util.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/model.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/alignmentsModel.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/LinearPileupDisplayBlurb.tsx","../../../plugins/alignments/src/LinearPileupDisplay/SharedLinearPileupDisplayMixin.ts","../../../plugins/alignments/src/LinearPileupDisplay/model.ts","../../../plugins/alignments/src/LinearPileupDisplay/index.ts","../../../plugins/alignments/src/LinearReadArcsDisplay/model.ts","../../../plugins/alignments/src/LinearReadArcsDisplay/index.ts","../../../plugins/alignments/src/LinearReadArcsDisplay/configSchema.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/configSchema.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/model.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/model.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/configSchema.ts","../../../plugins/alignments/src/PileupRPC/base.ts","../../../plugins/alignments/src/PileupRPC/methods/GetReducedFeatures.ts","../../../plugins/alignments/src/PileupRPC/util.ts","../../../plugins/alignments/src/PileupRPC/methods/GetVisibleModifications.ts","../../../plugins/alignments/src/PileupRPC/methods/GetGlobalValueForTag.ts","../../../plugins/alignments/src/PileupRPC/index.ts","../../../plugins/alignments/src/PileupRenderer/PileupLayoutSession.ts","../../../plugins/alignments/src/PileupRenderer/PileupRenderer.ts","../../../plugins/alignments/src/PileupRenderer/layoutFeatures.ts","../../../plugins/alignments/src/PileupRenderer/sortUtil.ts","../../../plugins/alignments/src/PileupRenderer/layoutFeature.ts","../../../plugins/alignments/src/PileupRenderer/components/PileupRendering.tsx","../../../plugins/alignments/src/PileupRenderer/configSchema.ts","../../../plugins/alignments/src/PileupRenderer/index.ts","../../../plugins/alignments/src/SNPCoverageAdapter/configSchema.ts","../../../plugins/alignments/src/SNPCoverageAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageRenderer/SNPCoverageRenderer.ts","../../../plugins/alignments/src/SNPCoverageRenderer/configSchema.ts","../../../plugins/alignments/src/SNPCoverageRenderer/index.ts","../../../plugins/alignments/src/index.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/util.ts","../../../packages/core/pluggableElementTypes/renderers/LayoutSession.ts","../../../packages/core/util/blobToDataURL.ts","../../../plugins/data-management/src/UCSCTrackHub/configSchema.ts","../../../plugins/data-management/src/UCSCTrackHub/model.ts","../../../plugins/data-management/src/UCSCTrackHub/index.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScalebarPolygon.tsx","../../../packages/core/util/range.ts","../../../packages/core/util/nanoid.js","../../../packages/core/pluggableElementTypes/AddTrackWorkflowType.ts","../../../packages/sv-core/src/Checkbox2.tsx","../../../packages/sv-core/src/util.ts","../../../packages/sv-core/src/navToMultiLevelBreak.ts","../../../packages/sv-core/src/BreakendMultiLevelOptionDialog.tsx","../../../packages/sv-core/src/BreakendSingleLevelOptionDialog.tsx","../../../packages/sv-core/src/navToSingleLevelBreak.ts","../../../packages/core/ui/FactoryResetDialog.tsx","../../../packages/core/ui/FatalErrorDialog.tsx","../../../packages/core/configuration/util.ts","../../../packages/core/pluggableElementTypes/PluggableElementBase.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BlockMsg.tsx","../../../packages/core/util/stopToken.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RubberbandTooltip.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RubberbandSpan.tsx","../../../packages/core/util/stats.ts","../../../packages/core/util/useMeasure.ts","../../../packages/core/ui/colors.ts","../../../packages/core/configuration/configurationSlot.ts","../../../packages/core/configuration/configurationSchema.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Block.tsx","../../../packages/core/util/jexlStrings.ts","../../../packages/core/ui/FileSelector/LocalFileChooser.tsx","../../../packages/core/ReExports/lazify.tsx","../../../packages/core/ReExports/BaseFeatureDetails.tsx","../../../packages/core/ReExports/MuiDataGridReExports.ts","../../../packages/core/ReExports/MuiReExports.ts","../../../packages/core/ReExports/list.ts","../../../packages/core/ReExports/modules.ts","../../../packages/core/data_adapters/BaseAdapter/util.ts","../../../packages/core/data_adapters/BaseAdapter/BaseAdapter.ts","../../../packages/core/data_adapters/BaseAdapter/BaseFeatureDataAdapter.ts","../../../packages/core/data_adapters/BaseAdapter/BaseSequenceAdapter.ts","../../../packages/core/pluggableElementTypes/AdapterType.ts","../../../plugins/circular-view/src/CircularView/viewportVisibleRegion.ts","../../../plugins/circular-view/src/CircularView/slices.ts","../../../plugins/circular-view/src/CircularView/model.ts","../../../plugins/circular-view/src/BaseChordDisplay/components/DisplayError.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/Loading.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/BaseChordDisplay.tsx","../../../plugins/circular-view/src/BaseChordDisplay/configSchema.ts","../../../plugins/circular-view/src/BaseChordDisplay/renderReaction.ts","../../../plugins/circular-view/src/BaseChordDisplay/model.tsx","../../../plugins/circular-view/src/index.ts","../../../plugins/circular-view/src/CircularView/index.ts","../../../plugins/circular-view/src/LaunchCircularView/index.ts","../../../plugins/alignments/src/MismatchParser/getNextRefPos.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/util.ts","../../../plugins/variants/src/LinearVariantDisplay/model.ts","../../../plugins/variants/src/shared/getSources.ts","../../../plugins/variants/src/shared/MultiVariantBaseModel.tsx","../../../plugins/variants/src/MultiLinearVariantDisplay/model.ts","../../../plugins/variants/src/MultiLinearVariantMatrixDisplay/components/VariantDisplayComponent.tsx","../../../plugins/variants/src/MultiLinearVariantMatrixRenderer/configSchema.ts","../../../plugins/variants/src/MultiLinearVariantMatrixDisplay/configSchema.ts","../../../plugins/variants/src/MultiLinearVariantMatrixDisplay/model.ts","../../../plugins/variants/src/MultiLinearVariantMatrixRenderer/MultiLinearVariantMatrixRenderer.ts","../../../plugins/variants/src/MultiLinearVariantMatrixRenderer/components/MultiLinearVariantMatrixRendering.tsx","../../../plugins/variants/src/MultiLinearVariantRenderer/MultiVariantRenderer.ts","../../../plugins/variants/src/MultiLinearVariantRenderer/components/MultiLinearVariantRendering.tsx","../../../plugins/variants/src/MultiLinearVariantRenderer/components/util.ts","../../../plugins/variants/src/MultiLinearVariantRenderer/configSchema.ts","../../../plugins/variants/src/SplitVcfTabixAdapter/configSchema.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/Chord.tsx","../../../plugins/variants/src/StructuralVariantChordRenderer/ReactComponent.tsx","../../../plugins/variants/src/StructuralVariantChordRenderer/configSchema.ts","../../../plugins/variants/src/VariantFeatureWidget/configSchema.ts","../../../plugins/variants/src/VariantFeatureWidget/stateModelFactory.ts","../../../plugins/variants/src/VariantRPC/getGenotypeMatrix.ts","../../../plugins/variants/src/VariantRPC/MultiVariantClusterGenotypeMatrix.ts","../../../plugins/variants/src/VariantRPC/MultiVariantGetGenotypeMatrix.ts","../../../plugins/variants/src/VariantRPC/MultiVariantGetSimplifiedFeatures.ts","../../../plugins/variants/src/VariantRPC/MultiVariantGetSources.ts","../../../plugins/variants/src/VcfAdapter/configSchema.ts","../../../plugins/variants/src/VcfTabixAdapter/configSchema.ts","../../../plugins/variants/src/index.ts","../../../plugins/variants/src/VariantTrack/index.ts","../../../plugins/variants/src/VcfAdapter/index.ts","../../../plugins/variants/src/VcfTabixAdapter/index.ts","../../../plugins/variants/src/SplitVcfTabixAdapter/index.ts","../../../plugins/variants/src/VariantFeatureWidget/index.ts","../../../plugins/variants/src/VariantTrack/configSchema.ts","../../../plugins/variants/src/extensionPoints.ts","../../../plugins/variants/src/LinearVariantDisplay/index.ts","../../../plugins/variants/src/LinearVariantDisplay/configSchema.ts","../../../plugins/variants/src/MultiLinearVariantMatrixDisplay/index.ts","../../../plugins/variants/src/MultiLinearVariantDisplay/index.ts","../../../plugins/variants/src/MultiLinearVariantDisplay/configSchema.ts","../../../plugins/variants/src/shared/SharedVariantConfigSchema.ts","../../../plugins/variants/src/MultiLinearVariantRenderer/index.ts","../../../plugins/variants/src/MultiLinearVariantMatrixRenderer/index.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/index.ts","../../../plugins/variants/src/ChordVariantDisplay/index.ts","../../../plugins/variants/src/ChordVariantDisplay/models/configSchema.ts","../../../plugins/variants/src/ChordVariantDisplay/models/stateModelFactory.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/util.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BlockLoadingMessage.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/serverSideRenderedBlock.ts","../../../packages/core/util/jexl.ts","../../../packages/core/util/cluster.ts","../../../packages/core/util/makeAbortableReaction.ts","../../../packages/core/pluggableElementTypes/DisplayType.ts","../../../packages/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/components/Tooltip.tsx","../../../packages/core/ui/ErrorBoundary.tsx","../../../packages/core/pluggableElementTypes/TrackType.ts","../../../plugins/config/src/ConfigurationEditorWidget/components/HeadingComponent.tsx","../../../plugins/config/src/ConfigurationEditorWidget/model.ts","../../../plugins/config/src/ConfigurationEditorWidget/index.ts","../../../plugins/config/src/FromConfigAdapter/configSchema.ts","../../../plugins/config/src/FromConfigRegionsAdapter/configSchema.ts","../../../plugins/config/src/FromConfigSequenceAdapter/configSchema.ts","../../../plugins/config/src/NcbiSequenceReportAliasAdapter/configSchema.ts","../../../plugins/config/src/RefNameAliasAdapter/configSchema.ts","../../../plugins/config/src/index.ts","../../../plugins/config/src/FromConfigAdapter/index.ts","../../../plugins/config/src/FromConfigRegionsAdapter/index.ts","../../../plugins/config/src/FromConfigSequenceAdapter/index.ts","../../../plugins/config/src/RefNameAliasAdapter/index.ts","../../../plugins/config/src/NcbiSequenceReportAliasAdapter/index.ts","../../../plugins/data-management/src/AddTrackWidget/model.ts","../../../plugins/data-management/src/AddTrackWidget/index.ts","../../../packages/core/pluggableElementTypes/ViewType.ts","../../../plugins/arc/src/ArcRenderer/ArcRenderer.ts","../../../plugins/arc/src/ArcRenderer/ArcRendering.tsx","../../../plugins/arc/src/ArcRenderer/configSchema.ts","../../../plugins/arc/src/LinearArcDisplay/model.ts","../../../plugins/arc/src/LinearPairedArcDisplay/model.ts","../../../plugins/arc/src/index.ts","../../../plugins/arc/src/ArcRenderer/index.ts","../../../plugins/arc/src/LinearArcDisplay/index.ts","../../../plugins/arc/src/LinearArcDisplay/configSchema.ts","../../../plugins/arc/src/LinearPairedArcDisplay/index.ts","../../../plugins/arc/src/LinearPairedArcDisplay/configSchema.ts","../../../plugins/authentication/src/OAuthModel/configSchema.ts","../../../plugins/authentication/src/DropboxOAuthModel/configSchema.ts","../../../plugins/authentication/src/OAuthModel/util.ts","../../../plugins/authentication/src/util.ts","../../../plugins/authentication/src/OAuthModel/model.tsx","../../../plugins/authentication/src/DropboxOAuthModel/DropboxIcon.tsx","../../../plugins/authentication/src/DropboxOAuthModel/util.ts","../../../plugins/authentication/src/DropboxOAuthModel/model.tsx","../../../plugins/authentication/src/ExternalTokenModel/configSchema.ts","../../../plugins/authentication/src/ExternalTokenModel/ExternalTokenEntryForm.tsx","../../../plugins/authentication/src/ExternalTokenModel/model.tsx","../../../plugins/authentication/src/GoogleDriveOAuthModel/configSchema.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/GoogleDriveFilehandle.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/GoogleDriveIcon.tsx","../../../plugins/authentication/src/GoogleDriveOAuthModel/util.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/model.tsx","../../../plugins/authentication/src/HTTPBasicModel/configSchema.ts","../../../plugins/authentication/src/HTTPBasicModel/HTTPBasicLoginForm.tsx","../../../plugins/authentication/src/HTTPBasicModel/model.tsx","../../../plugins/authentication/src/index.ts","../../../plugins/bed/src/BedAdapter/configSchema.ts","../../../plugins/bed/src/BedGraphAdapter/configSchema.ts","../../../plugins/bed/src/BedGraphTabixAdapter/configSchema.ts","../../../plugins/bed/src/BedTabixAdapter/configSchema.ts","../../../plugins/bed/src/BedpeAdapter/configSchema.ts","../../../plugins/bed/src/BigBedAdapter/configSchema.ts","../../../plugins/bed/src/index.ts","../../../plugins/bed/src/BigBedAdapter/index.ts","../../../plugins/bed/src/BedAdapter/index.ts","../../../plugins/bed/src/BedpeAdapter/index.ts","../../../plugins/bed/src/BedTabixAdapter/index.ts","../../../plugins/bed/src/BedGraphAdapter/index.ts","../../../plugins/bed/src/BedGraphTabixAdapter/index.ts","../../../plugins/bed/src/GuessAdapter/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointAlignmentsFeatureDetail/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/getClip.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/model.ts","../../../plugins/breakpoint-split-view/src/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/index.ts","../../../plugins/comparative-adapters/src/BlastTabularAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/ChainAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/syntenyTypes.ts","../../../plugins/comparative-adapters/src/ComparativeAddTrackComponent/index.tsx","../../../plugins/comparative-adapters/src/DeltaAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MCScanAddTrackComponent/index.tsx","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/PAFAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/PairwiseIndexedPAFAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/index.ts","../../../plugins/comparative-adapters/src/PAFAdapter/index.ts","../../../plugins/comparative-adapters/src/PairwiseIndexedPAFAdapter/index.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/index.ts","../../../plugins/comparative-adapters/src/ChainAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/index.ts","../../../plugins/comparative-adapters/src/BlastTabularAdapter/index.ts","../../../plugins/comparative-adapters/src/GuessAdapter/index.ts","../../../plugins/dotplot-view/src/ComparativeRenderer/index.ts","../../../plugins/dotplot-view/src/DotplotDisplay/components/DotplotDisplay.tsx","../../../plugins/dotplot-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/renderDotplotBlock.ts","../../../plugins/dotplot-view/src/DotplotDisplay/stateModelFactory.tsx","../../../plugins/dotplot-view/src/DotplotReadVsRef/DotplotReadVsRef.ts","../../../plugins/dotplot-view/src/DotplotView/1dview.ts","../../../plugins/dotplot-view/src/DotplotView/model.ts","../../../plugins/dotplot-view/src/DotplotRenderer/DotplotRenderer.ts","../../../plugins/dotplot-view/src/DotplotRenderer/components/DotplotRendering.tsx","../../../plugins/dotplot-view/src/DotplotRenderer/configSchema.ts","../../../plugins/dotplot-view/src/LaunchDotplotView.ts","../../../plugins/dotplot-view/src/index.ts","../../../plugins/dotplot-view/src/DotplotDisplay/index.ts","../../../plugins/dotplot-view/src/DotplotView/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/index.ts","../../../plugins/dotplot-view/src/DotplotReadVsRef/index.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/shared.ts","../../../plugins/gccontent/src/index.ts","../../../plugins/gccontent/src/GCContentTrack/index.ts","../../../plugins/gccontent/src/GCContentAdapter/index.ts","../../../plugins/gccontent/src/GCContentAdapter/configSchema.ts","../../../plugins/gccontent/src/GCContentTrack/configSchema.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/index.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/config1.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/stateModel1.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/config2.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/stateModel2.ts","../../../plugins/gff3/src/Gff3Adapter/configSchema.ts","../../../plugins/gff3/src/Gff3TabixAdapter/configSchema.ts","../../../plugins/gff3/src/index.ts","../../../plugins/gff3/src/Gff3TabixAdapter/index.ts","../../../plugins/gff3/src/Gff3Adapter/index.ts","../../../plugins/gff3/src/GuessGff3/index.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/Highlight/Highlight.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/Highlight/OverviewHighlight.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/model.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/index.ts","../../../plugins/grid-bookmark/src/index.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/Highlight/index.tsx","../../../plugins/gtf/src/GtfAdapter/configSchema.ts","../../../plugins/gtf/src/index.ts","../../../plugins/gtf/src/GtfAdapter/index.ts","../../../plugins/gtf/src/GuessAdapter/index.ts","../../../plugins/hic/src/HicAdapter/configSchema.ts","../../../plugins/hic/src/HicRenderer/HicRenderer.tsx","../../../plugins/hic/src/HicRenderer/components/HicRendering.tsx","../../../plugins/hic/src/HicRenderer/configSchema.ts","../../../plugins/hic/src/LinearHicDisplay/model.ts","../../../plugins/hic/src/index.ts","../../../plugins/hic/src/HicAdapter/index.ts","../../../plugins/hic/src/HicRenderer/index.ts","../../../plugins/hic/src/HicTrack/index.ts","../../../plugins/hic/src/HicTrack/configSchema.ts","../../../plugins/hic/src/LinearHicDisplay/index.ts","../../../plugins/hic/src/LinearHicDisplay/configSchema.ts","../../../plugins/hic/src/GuessAdapter/index.ts","../../../plugins/jobs-management/src/JobsListWidget/jobModel.ts","../../../plugins/jobs-management/src/JobsListWidget/index.ts","../../../plugins/jobs-management/src/index.ts","../../../plugins/jobs-management/src/JobsListWidget/model.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/model.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSearchAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/index.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/index.ts","../../../plugins/legacy-jbrowse/src/GuessNCList/index.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSearchAdapter/index.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/index.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/model.ts","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/stateModelFactory.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/model.ts","../../../plugins/linear-comparative-view/src/LinearReadVsRef/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/components/Icons.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyView/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyViewHelper/stateModelFactory.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyViewHelper/index.tsx","../../../plugins/linear-comparative-view/src/SyntenyFeatureDetail/index.ts","../../../plugins/linear-comparative-view/src/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/LaunchLinearSyntenyView.ts","../../../plugins/linear-comparative-view/src/SyntenyTrack/index.tsx","../../../plugins/linear-comparative-view/src/SyntenyTrack/configSchema.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/model.ts","../../../plugins/lollipop/src/LollipopRenderer/Layout.ts","../../../plugins/lollipop/src/LollipopRenderer/FloatingLayoutSession.ts","../../../plugins/lollipop/src/LollipopRenderer/LollipopRenderer.ts","../../../plugins/lollipop/src/LollipopRenderer/components/ScoreText.tsx","../../../plugins/lollipop/src/LollipopRenderer/components/Lollipop.tsx","../../../plugins/lollipop/src/LollipopRenderer/components/Stick.tsx","../../../plugins/lollipop/src/LollipopRenderer/components/LollipopRendering.tsx","../../../plugins/lollipop/src/LollipopRenderer/configSchema.ts","../../../plugins/lollipop/src/index.ts","../../../plugins/lollipop/src/LollipopRenderer/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/configSchema.ts","../../../plugins/menus/src/AboutWidget/index.ts","../../../plugins/menus/src/HelpWidget/index.ts","../../../plugins/menus/src/ImportSessionWidget/index.ts","../../../plugins/menus/src/SessionManager/index.ts","../../../plugins/menus/src/index.ts","../../../plugins/rdf/src/SPARQLAdapter/configSchema.ts","../../../plugins/rdf/src/index.ts","../../../plugins/rdf/src/SPARQLAdapter/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/configSchema.ts","../../../plugins/sequence/src/ChromSizesAdapter/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/components/DivSequenceRendering.tsx","../../../plugins/sequence/src/DivSequenceRenderer/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/index.ts","../../../plugins/sequence/src/IndexedFastaAdapter/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/configSchema.ts","../../../plugins/sequence/src/SequenceSearchAdapter/configSchema.ts","../../../plugins/sequence/src/TwoBitAdapter/configSchema.ts","../../../plugins/sequence/src/UnindexedFastaAdapter/configSchema.ts","../../../plugins/sequence/src/index.ts","../../../plugins/sequence/src/TwoBitAdapter/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/index.ts","../../../plugins/sequence/src/ChromSizesAdapter/index.ts","../../../plugins/sequence/src/IndexedFastaAdapter/index.ts","../../../plugins/sequence/src/UnindexedFastaAdapter/index.ts","../../../plugins/sequence/src/SequenceSearchAdapter/index.ts","../../../plugins/sequence/src/ReferenceSequenceTrack/index.ts","../../../plugins/sequence/src/ReferenceSequenceTrack/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/index.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/model.ts","../../../plugins/sequence/src/createExtensionPoints.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/ImportWizard.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/util.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/FeatureMenu.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/LocationCell.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/SpreadsheetViewModel.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/SpreadsheetModel.tsx","../../../plugins/spreadsheet-view/src/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/index.ts","../../../plugins/spreadsheet-view/src/LaunchSpreadsheetView/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/index.ts","../../../plugins/sv-inspector/src/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/model.ts","../../../plugins/sv-inspector/src/LaunchSvInspectorView/index.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureLabel.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureGlyph.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgOverlay.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Arrow.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Box.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Segments.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/ProcessedTranscript.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Subfeatures.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/util.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgFeatureRendering.tsx","../../../plugins/svg/src/SvgFeatureRenderer/configSchema.ts","../../../plugins/svg/src/index.ts","../../../plugins/trix/src/TrixTextSearchAdapter/configSchema.ts","../../../plugins/trix/src/index.ts","corePlugins.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Gridlines.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabelDragHandle.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabelMenu.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabelContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackRenderingContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/VerticalGuide.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/useRangeSelect.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Rubberband.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ScalebarCoordinateTicks.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ScalebarCoordinateLabels.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ScalebarRefNameLabels.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Scalebar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TracksContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/useSideScroll.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/useWheelScroll.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeViewContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeView.tsx","../../../packages/core/util/rxjs.ts","../../../packages/core/pluggableElementTypes/WidgetType.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/configSchema.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/facetedUtil.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/util.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/facetedModel.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/filterTracks.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/generateHierarchy.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/model.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/index.ts","../../../plugins/data-management/src/AddConnectionWidget/model.ts","../../../plugins/data-management/src/AddConnectionWidget/index.ts","../../../plugins/variants/src/VcfFeature/util.ts","../../../packages/core/data_adapters/CytobandAdapter/configSchema.ts","../../../packages/core/rpc/methods/CoreGetRefNames.ts","../../../packages/core/rpc/methods/CoreGetFeatureDetails.ts","../../../packages/core/rpc/methods/CoreGetMetadata.ts","../../../packages/core/rpc/methods/CoreGetFileInfo.ts","../../../packages/core/rpc/methods/CoreGetFeatures.ts","../../../packages/core/rpc/methods/util.ts","../../../packages/core/rpc/methods/CoreRender.ts","../../../packages/core/rpc/methods/CoreFreeResources.ts","../../../packages/core/rpc/methods/CoreGetFeatureDensityStats.ts","../../../packages/core/CorePlugin.ts","../../../packages/core/data_adapters/CytobandAdapter/index.ts","../../../packages/core/PluginManager.ts","../../../plugins/variants/src/MultiLinearVariantMatrixDisplay/components/LinesConnectingMatrixToGenomicPosition.tsx","../../../plugins/wiggle/src/util.ts","../../../packages/core/util/layouts/PrecomputedLayout.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/consts.ts","../../../packages/core/util/blockTypes.ts","../../../packages/core/util/color/cssColorsLevel4.ts","../../../packages/core/util/color/index.ts","../../../plugins/alignments/src/shared/getUniqueTags.ts","../../../packages/core/data_adapters/util.ts","../../../packages/core/TextSearch/TextSearchManager.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Cytobands.tsx","../../../packages/core/util/layouts/GranularRectLayout.ts","../../../plugins/variants/src/shared/minorAlleleFrequencyUtils.ts","../../../plugins/alignments/src/util.ts","../../../packages/core/util/colord.ts","../../../packages/core/util/layouts/PrecomputedMultiLayout.js","../../../packages/core/util/layouts/SceneGraph.ts","../../../plugins/wiggle/src/Tooltip.tsx","../../../packages/core/util/calculateStaticBlocks.ts","../../../plugins/dotplot-view/src/DotplotView/components/util.ts","../../../plugins/wiggle/src/shared/YScaleBar.tsx","../../../plugins/alignments/src/shared/util.ts","../../../packages/core/pluggableElementTypes/ConnectionType.ts","../../../packages/core/pluggableElementTypes/InternetAccountType.ts","../../../packages/core/util/types/index.ts","../../../packages/core/pluggableElementTypes/renderers/FeatureRendererType.ts","../../../plugins/alignments/src/ModificationParser/index.ts","../../../packages/core/pluggableElementTypes/renderers/util/serializableFilterChain.ts","../../../packages/core/util/calculateDynamicBlocks.ts","../../../packages/core/pluggableElementTypes/renderers/RpcRenderedSvgGroup.tsx","../../../packages/core/pluggableElementTypes/renderers/CircularChordRendererType.tsx","../../../packages/core/util/Base1DUtils.ts","../../../plugins/variants/src/VcfFeature/index.ts","../../../packages/core/pluggableElementTypes/renderers/RendererType.tsx","../../../plugins/alignments/src/MismatchParser/cigarToMismatches.ts","../../../plugins/alignments/src/MismatchParser/mdToMismatches.ts","../../../plugins/alignments/src/MismatchParser/index.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/AutocompleteTextField.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/index.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/util.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/configSchema.ts","../../../packages/core/util/compositeMap.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/TooLargeMessage.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/FeatureDensityMixin.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/autorunFeatureDensityStats.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/TrackHeightMixin.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/BaseLinearDisplayModel.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/LinearBlocks.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BaseLinearDisplay.tsx","../../../plugins/linear-genome-view/src/LaunchLinearGenomeView/index.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/HeaderPanControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/HeaderRegionWidth.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/HeaderTrackSelectorButton.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/HeaderZoomControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewHighlight.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewRubberbandHoverTooltip.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewRubberband.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScalebarTickLabels.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScalebar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/EndAdornment.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SearchBox.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Header.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/MiniControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/model.ts","../../../plugins/linear-genome-view/src/index.ts","../../../plugins/linear-genome-view/src/FeatureTrack/index.ts","../../../plugins/linear-genome-view/src/FeatureTrack/configSchema.ts","../../../plugins/linear-genome-view/src/BasicTrack/index.ts","../../../plugins/linear-genome-view/src/BasicTrack/configSchema.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/index.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/index.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/index.ts","../../../packages/core/util/Base1DViewModel.ts","../../../packages/core/pluggableElementTypes/renderers/BoxRendererType.ts","../../../packages/core/util/offscreenCanvasUtils.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGBackground.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGRegionSeparators.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGRuler.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGScalebar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGHeader.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGTrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGTracks.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGLinearGenomeView.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/WiggleDisplayComponent.tsx","../../../plugins/alignments/src/shared/getUniqueModifications.ts","../../../packages/core/util/io/RemoteFileWithRangeCache.ts","../../../packages/core/util/io/index.ts"],"sourcesContent":["import { ThemeProvider } from '@mui/material/styles'\nimport { getSnapshot, isStateTreeNode } from 'mobx-state-tree'\nimport { renderToString } from 'react-dom/server'\n\nimport RendererType from './RendererType'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\nimport { createJBrowseTheme } from '../../ui'\nimport SerializableFilterChain from './util/serializableFilterChain'\nimport { getSerializedSvg, updateStatus } from '../../util'\nimport { checkStopToken } from '../../util/stopToken'\n\nimport type { RenderProps, RenderResults } from './RendererType'\nimport type { AnyConfigurationModel } from '../../configuration'\nimport type { SerializedFilterChain } from './util/serializableFilterChain'\nimport type RpcManager from '../../rpc/RpcManager'\nimport type { ThemeOptions } from '@mui/material'\nimport type { SnapshotIn, SnapshotOrInstance } from 'mobx-state-tree'\n\ninterface BaseRenderArgs extends RenderProps {\n  sessionId: string\n  // Note that stopToken serialization happens after serializeArgsInClient and\n  // deserialization happens before deserializeArgsInWorker\n  stopToken?: string\n  theme: ThemeOptions\n  exportSVG?: {\n    rasterizeLayers?: boolean\n  }\n}\n\nexport interface RenderArgs extends BaseRenderArgs {\n  config: SnapshotOrInstance<AnyConfigurationModel>\n  filters?: SerializableFilterChain\n}\n\nexport interface RenderArgsSerialized extends BaseRenderArgs {\n  statusCallback?: (arg: string) => void\n  config: SnapshotIn<AnyConfigurationModel>\n  filters?: SerializedFilterChain\n}\nexport interface RenderArgsDeserialized extends BaseRenderArgs {\n  config: AnyConfigurationModel\n  filters?: SerializableFilterChain\n}\n\nexport interface ResultsSerialized extends Omit<RenderResults, 'reactElement'> {\n  html: string\n}\n\nexport interface ResultsSerializedSvgExport extends ResultsSerialized {\n  canvasRecordedData: unknown\n  width: number\n  height: number\n  reactElement: unknown\n}\n\nexport type ResultsDeserialized = RenderResults\n\nfunction isSvgExport(e: ResultsSerialized): e is ResultsSerializedSvgExport {\n  return 'canvasRecordedData' in e\n}\n\nexport default class ServerSideRenderer extends RendererType {\n  /**\n   * directly modifies the render arguments to prepare them to be serialized and\n   * sent to the worker.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs): RenderArgsSerialized {\n    return {\n      ...args,\n      config: isStateTreeNode(args.config)\n        ? getSnapshot(args.config)\n        : args.config,\n      filters: args.filters?.toJSON().filters,\n    }\n  }\n\n  /**\n   * Deserialize the render results from the worker in the client. Includes\n   * hydrating of the React HTML string, and not hydrating the result if SVG is\n   * being rendered\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    res: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    return args.exportSVG\n      ? {\n          ...res,\n          html: this.supportsSVG\n            ? res.html\n            : '<text y=\"12\" fill=\"black\">SVG export not supported for this track</text>',\n        }\n      : {\n          ...res,\n          reactElement: (\n            <ServerSideRenderedContent\n              {...args}\n              {...res}\n              RenderingComponent={this.ReactComponent}\n            />\n          ),\n        }\n  }\n\n  /**\n   * modifies the passed arguments object to inflate arguments as necessary.\n   * called in the worker process.\n   *\n   * @param args - the converted arguments to modify\n   */\n  deserializeArgsInWorker(args: RenderArgsSerialized): RenderArgsDeserialized {\n    const deserialized = { ...args } as unknown as RenderArgsDeserialized\n    deserialized.config = this.configSchema.create(args.config || {}, {\n      pluginManager: this.pluginManager,\n    })\n    deserialized.filters = args.filters\n      ? new SerializableFilterChain({\n          filters: args.filters,\n        })\n      : undefined\n\n    return deserialized\n  }\n\n  /**\n   * Serialize results of the render to send them to the client. Includes\n   * rendering React to an HTML string.\n   *\n   * @param results - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const html = renderToString(\n      <ThemeProvider theme={createJBrowseTheme(args.theme)}>\n        {results.reactElement}\n      </ThemeProvider>,\n    )\n    results.reactElement = undefined\n    return { ...results, html }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then calls\n   * \"CoreRender\" with the RPC manager.\n   *\n   * @param rpcManager - RPC manager\n   * @param args - render args\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const results = (await rpcManager.call(\n      args.sessionId,\n      'CoreRender',\n      args,\n    )) as ResultsSerialized\n\n    if (isSvgExport(results)) {\n      results.html = await getSerializedSvg(results)\n      results.reactElement = undefined\n    }\n    return results\n  }\n\n  /**\n   * Render method called on the worker. `render` is called here in server-side\n   * rendering\n   *\n   * @param args - serialized render args\n   */\n  async renderInWorker(args: RenderArgsSerialized): Promise<ResultsSerialized> {\n    const { stopToken, statusCallback = () => {} } = args\n    const deserializedArgs = this.deserializeArgsInWorker(args)\n\n    const results = await updateStatus('Rendering plot', statusCallback, () =>\n      this.render(deserializedArgs),\n    )\n    checkStopToken(stopToken)\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    return updateStatus('Serializing results', statusCallback, () =>\n      this.serializeResultsInWorker(results, deserializedArgs),\n    )\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n    const { sessionId } = args\n\n    await rpcManager.call(sessionId, 'CoreFreeResources', serializedArgs)\n  }\n}\n\nexport { type RenderResults } from './RendererType'\n","import type { SimpleFeatureSerialized } from '../util'\nimport type { SerializedFeat } from './types'\n\nexport interface Feat {\n  start: number\n  end: number\n  type?: string\n  name?: string\n  id?: string\n}\nexport interface ParentFeat extends Feat {\n  uniqueId: string\n  strand?: number\n  refName: string\n  subfeatures?: Feat[]\n  parentId?: string\n}\nexport interface SeqState {\n  seq: string\n  upstream?: string\n  downstream?: string\n}\n\nexport interface ErrorState {\n  error: string\n}\n\nexport function stitch(subfeats: Feat[], sequence: string) {\n  return subfeats.map(sub => sequence.slice(sub.start, sub.end)).join('')\n}\n\n// filter items if they have the same \"ID\" or location\nfunction getItemId(feat: Feat) {\n  return `${feat.start}-${feat.end}`\n}\n\n// filters if successive elements share same start/end\nexport function dedupe(list: Feat[]) {\n  return list.filter(\n    (item, pos, ary) => !pos || getItemId(item) !== getItemId(ary[pos - 1]!),\n  )\n}\n\nexport function revlist(list: Feat[], seqlen: number) {\n  return list\n    .map(sub => ({\n      ...sub,\n      start: seqlen - sub.end,\n      end: seqlen - sub.start,\n    }))\n    .sort((a, b) => a.start - b.start)\n}\n\nexport function calculateUTRs(cds: Feat[], exons: Feat[]) {\n  // checking length ensures the .at below are valid\n  if (!cds.length) {\n    return []\n  }\n\n  const firstCds = cds.at(0)!\n\n  const lastCds = cds.at(-1)!\n  const firstCdsIdx = exons.findIndex(\n    exon => exon.end >= firstCds.start && exon.start <= firstCds.start,\n  )\n  const lastCdsIdx = exons.findIndex(\n    exon => exon.end >= lastCds.end && exon.start <= lastCds.end,\n  )\n  const lastCdsExon = exons[lastCdsIdx]!\n  const firstCdsExon = exons[firstCdsIdx]!\n\n  const fiveUTRs = [\n    ...exons.slice(0, firstCdsIdx),\n    { start: firstCdsExon.start, end: firstCds.start },\n  ].map(elt => ({ ...elt, type: 'five_prime_UTR' }))\n\n  const threeUTRs = [\n    { start: lastCds.end, end: lastCdsExon.end },\n    ...exons.slice(lastCdsIdx + 1),\n  ].map(elt => ({ ...elt, type: 'three_prime_UTR' }))\n\n  return [...fiveUTRs, ...threeUTRs]\n}\n\n// calculates UTRs using impliedUTRs logic, but there are no exon subfeatures\nexport function calculateUTRs2(cds: Feat[], parentFeat: Feat) {\n  if (!cds.length) {\n    return []\n  }\n\n  const firstCds = cds.at(0)!\n  const lastCds = cds.at(-1)!\n  const fiveUTRs = [{ start: parentFeat.start, end: firstCds.start }].map(\n    elt => ({ ...elt, type: 'five_prime_UTR' }),\n  )\n\n  const threeUTRs = [{ start: lastCds.end, end: parentFeat.end }].map(elt => ({\n    ...elt,\n    type: 'three_prime_UTR',\n  }))\n\n  return [...fiveUTRs, ...threeUTRs]\n}\n\nexport function ellipses(slug: string) {\n  return slug.length > 20 ? `${slug.slice(0, 20)}...` : slug\n}\n\nexport function replaceUndefinedWithNull(obj: SimpleFeatureSerialized) {\n  return JSON.parse(JSON.stringify(obj, (_, v) => (v === undefined ? null : v)))\n}\n\nexport function formatSubfeatures(\n  obj: SerializedFeat,\n  depth: number,\n  parse: (obj: Record<string, unknown>) => void,\n  currentDepth = 0,\n  returnObj = {} as Record<string, unknown>,\n) {\n  if (depth <= currentDepth) {\n    return\n  }\n  obj.subfeatures?.map(sub => {\n    formatSubfeatures(sub, depth, parse, currentDepth + 1, returnObj)\n    parse(sub)\n  })\n}\n","import { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Instance } from 'mobx-state-tree'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('PluginStoreModel', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('PluginStoreWidget'),\n      /**\n       * #property\n       */\n      filterText: '',\n      /**\n       * #property\n       */\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      clearFilterText() {\n        self.filterText = ''\n      },\n      /**\n       * #action\n       */\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n}\n\nexport type PluginStoreStateModel = ReturnType<typeof stateModelFactory>\nexport type PluginStoreModel = Instance<PluginStoreStateModel>\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('PluginStoreWidget', {})\n\nexport default function PluginStoreWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'PluginStoreWidget',\n      heading: 'Plugin store',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/PluginStoreWidget')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '../../configuration'\n\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config BaseConnection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseConnectionConfig = ConfigurationSchema(\n  'BaseConnection',\n  {\n    /**\n     * #slot\n     */\n    name: {\n      type: 'string',\n      defaultValue: 'nameOfConnection',\n      description: 'a unique name for this connection',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'optional list of names of assemblies in this connection',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'connectionId',\n  },\n)\n\nexport default BaseConnectionConfig\nexport type BaseConnectionConfigSchema = typeof BaseConnectionConfig\nexport type BaseConnectionConfigModel = Instance<BaseConnectionConfigSchema>\n","import { cast, types } from 'mobx-state-tree'\n\nimport configSchema from './baseConnectionConfig'\nimport { ConfigurationReference } from '../../configuration'\n\nimport type PluginManager from '../../PluginManager'\nimport type { AnyConfigurationModel } from '../../configuration'\n\ntype TrackConf = AnyConfigurationModel | Record<string, unknown>\n\n/**\n * #stateModel BaseConnectionModel\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('Connection', {\n      /**\n       * #property\n       */\n      name: types.identifier,\n      /**\n       * #property\n       */\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .actions(() => ({\n      /**\n       * #action\n       */\n      connect(_arg: AnyConfigurationModel) {},\n    }))\n    .actions(self => ({\n      afterAttach() {\n        if (self.tracks.length === 0) {\n          self.connect(self.configuration)\n        }\n      },\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: TrackConf) {\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      /**\n       * #action\n       */\n      addTrackConfs(trackConfs: TrackConf[]) {\n        self.tracks.push(...trackConfs)\n      },\n      /**\n       * #action\n       */\n      setTrackConfs(trackConfs: AnyConfigurationModel[]) {\n        self.tracks = cast(trackConfs)\n      },\n      /**\n       * #action\n       */\n      clear() {},\n    }))\n}\n\nexport type BaseConnectionModel = ReturnType<typeof stateModelFactory>\nexport default stateModelFactory\n","import type React from 'react'\n\nimport { getParent, isRoot, types } from 'mobx-state-tree'\n\nimport { getConf } from '../../configuration'\nimport { getContainingView, getEnv } from '../../util'\nimport { getParentRenderProps } from '../../util/tracks'\nimport { ElementId } from '../../util/types/mst'\n\nimport type { MenuItem } from '../../ui'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel BaseDisplay\n * #category display\n */\nfunction stateModelFactory() {\n  return types\n    .model('BaseDisplay', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.string,\n      /**\n       * #property\n       */\n      rpcDriverName: types.maybe(types.string),\n    })\n    .volatile(() => ({\n      rendererTypeName: '',\n      error: undefined as unknown,\n      message: undefined as string | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get RenderingComponent(): React.FC<{\n        model: typeof self\n        onHorizontalScroll?: () => void\n        blockState?: Record<string, any>\n      }> {\n        const { pluginManager } = getEnv(self)\n        return pluginManager.getDisplayType(self.type)!\n          .ReactComponent as React.FC<{\n          model: typeof self\n          onHorizontalScroll?: () => void\n          blockState?: Record<string, any>\n        }>\n      },\n\n      /**\n       * #getter\n       */\n      get DisplayBlurb(): React.FC<{ model: typeof self }> | null {\n        return null\n      },\n\n      /**\n       * #getter\n       */\n      get adapterConfig() {\n        return getConf(this.parentTrack, 'adapter')\n      },\n\n      /**\n       * #getter\n       */\n      get parentTrack() {\n        let track = getParent<any>(self)\n        while (!(track.configuration && getConf(track, 'trackId'))) {\n          if (isRoot(track)) {\n            throw new Error(`No parent track found for ${self.type} ${self.id}`)\n          }\n          track = getParent<any>(track)\n        }\n        return track\n      },\n\n      /**\n       * #method\n       * the react props that are passed to the Renderer when data\n       * is rendered in this display\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          notReady: getContainingView(self).minimized,\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n        }\n      },\n\n      /**\n       * #getter\n       * the pluggable element type object for this display's renderer\n       */\n      get rendererType() {\n        const { pluginManager } = getEnv(self)\n        return pluginManager.getRendererType(self.rendererTypeName)!\n      },\n\n      /**\n       * #getter\n       * if a display-level message should be displayed instead, make this\n       * return a react component\n       */\n      get DisplayMessageComponent() {\n        return undefined as undefined | React.FC<any>\n      },\n      /**\n       * #method\n       */\n      trackMenuItems(): MenuItem[] {\n        return []\n      },\n\n      /**\n       * #getter\n       */\n      get viewMenuActions(): MenuItem[] {\n        return []\n      },\n      /**\n       * #method\n       * @param region -\n       * @returns falsy if the region is fine to try rendering. Otherwise,\n       * return a react node + string of text. string of text describes why it\n       * cannot be rendered react node allows user to force load at current\n       * setting\n       */\n      regionCannotBeRendered(/* region */) {\n        return null\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setMessage(arg?: string) {\n        self.message = arg\n      },\n      /**\n       * #action\n       */\n      setError(error?: unknown) {\n        self.error = error\n      },\n      /**\n       * #action\n       */\n      setRpcDriverName(rpcDriverName: string) {\n        self.rpcDriverName = rpcDriverName\n      },\n      /**\n       * #action\n       * base display reload does nothing, see specialized displays for details\n       */\n      reload() {},\n    }))\n}\n\nexport const BaseDisplay = stateModelFactory()\nexport type BaseDisplayStateModel = typeof BaseDisplay\nexport type BaseDisplayModel = Instance<BaseDisplayStateModel>\n","import { ConfigurationSchema } from '../../configuration'\n\n/**\n * #config BaseInternetAccount\n * the \"base\" internet account type\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const BaseInternetAccountConfig = ConfigurationSchema(\n  'InternetAccount',\n  {\n    /**\n     * #slot\n     */\n    name: {\n      description: 'descriptive name of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    description: {\n      description: 'a description of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    authHeader: {\n      description: 'request header for credentials',\n      type: 'string',\n      defaultValue: 'Authorization',\n    },\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'internetAccountId',\n    explicitlyTyped: true,\n  },\n)\n","import type React from 'react'\n\nimport { types } from 'mobx-state-tree'\n\nimport { BaseInternetAccountConfig } from './baseInternetAccountConfig'\nimport { ConfigurationReference, getConf } from '../../configuration'\nimport { RemoteFileWithRangeCache } from '../../util/io'\nimport { ElementId } from '../../util/types/mst'\n\nimport type { AnyReactComponentType, UriLocation } from '../../util/types'\nimport type { Instance } from 'mobx-state-tree'\n\nconst inWebWorker = typeof sessionStorage === 'undefined'\n\n/**\n * #stateModel BaseInternetAccountModel\n * #category internetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const InternetAccount = types\n  .model('InternetAccount', {\n    /**\n     * #property\n     */\n    id: ElementId,\n    /**\n     * #property\n     */\n    type: types.string,\n    /**\n     * #property\n     */\n    configuration: ConfigurationReference(BaseInternetAccountConfig),\n  })\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get name(): string {\n      return getConf(self, 'name')\n    },\n    /**\n     * #getter\n     */\n    get description(): string {\n      return getConf(self, 'description')\n    },\n    /**\n     * #getter\n     */\n    get internetAccountId(): string {\n      return getConf(self, 'internetAccountId') // NOTE: this is the explicitIdentifier of the config schema\n    },\n    /**\n     * #getter\n     */\n    get authHeader(): string {\n      return getConf(self, 'authHeader')\n    },\n    /**\n     * #getter\n     */\n    get tokenType(): string {\n      return getConf(self, 'tokenType')\n    },\n    /**\n     * #getter\n     */\n    get domains(): string[] {\n      return getConf(self, 'domains')\n    },\n    /**\n     * #getter\n     * Can use this to customize what is displayed in fileSelector's toggle box\n     */\n    get toggleContents(): React.ReactNode {\n      return null\n    },\n    /**\n     * #getter\n     * Can use this to customize what the fileSelector. It takes a prop called\n     * `setLocation` that should be used to set a UriLocation\n     */\n    get SelectorComponent(): AnyReactComponentType | undefined {\n      return undefined\n    },\n    /**\n     * #getter\n     * Can use this to add a label to the UrlChooser. Has no effect if a custom\n     * SelectorComponent is supplied\n     */\n    get selectorLabel(): string | undefined {\n      return undefined\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     * Determine whether this internetAccount provides credentials for a URL\n     * @param location  - UriLocation of resource\n     * @returns true or false\n     */\n    handlesLocation(location: UriLocation) {\n      return self.domains.some(domain => location.uri.includes(domain))\n    },\n    /**\n     * #getter\n     * The key used to store this internetAccount's token in sessionStorage\n     */\n    get tokenKey() {\n      return `${self.internetAccountId}-token`\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Must be implemented by a model extending or composing this one. Pass the\n     * user's token to `resolve`.\n     * @param resolve - Pass the token to this function\n     * @param reject - If there is an error getting the token, call this function\n     */\n    getTokenFromUser(\n      _resolve: (token: string) => void,\n      _reject: (error: Error) => void,\n    ): void {\n      throw new Error('getTokenFromUser must be implemented by extending model')\n    },\n    /**\n     * #action\n     */\n    storeToken(token: string) {\n      sessionStorage.setItem(self.tokenKey, token)\n    },\n    /**\n     * #action\n     */\n    removeToken() {\n      sessionStorage.removeItem(self.tokenKey)\n    },\n    /**\n     * #action\n     */\n    retrieveToken() {\n      return sessionStorage.getItem(self.tokenKey)\n    },\n    /**\n     * #action\n     * This can be used by an internetAccount to validate a token works before\n     * it is used. This is run when preAuthorizationInformation is requested,\n     * so it can be used to check that a token is valid before sending it to a\n     * worker thread. It expects the token to be returned so that this action\n     * can also be used to generate a new token (e.g. by using a refresh token)\n     * if the original one was invalid. Should throw an error if a token is\n     * invalid.\n     *\n     * @param token - Auth token\n     * @param loc - UriLocation of the resource\n     * @returns - Valid auth token\n     */\n    async validateToken(token: string, _loc: UriLocation) {\n      return token\n    },\n  }))\n  .actions(self => {\n    let tokenPromise: Promise<string> | undefined = undefined\n    return {\n      /**\n       * #action\n       * Try to get the token from the location pre-auth, from local storage,\n       * or from a previously cached promise. If token is not available, uses\n       * `getTokenFromUser`.\n       *\n       * @param location - UriLocation of the resource\n       * @returns A promise for the token\n       */\n      async getToken(location?: UriLocation): Promise<string> {\n        if (tokenPromise) {\n          return tokenPromise\n        }\n        let token = location?.internetAccountPreAuthorization?.authInfo?.token\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        if (inWebWorker) {\n          throw new Error(\n            'Did not get internet account pre-authorization info in worker',\n          )\n        }\n        token = self.retrieveToken()\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        tokenPromise = new Promise((resolve, reject) => {\n          self.getTokenFromUser(\n            token => {\n              self.storeToken(token)\n              resolve(token)\n            },\n            error => {\n              self.removeToken()\n              reject(error)\n            },\n          )\n        })\n        return tokenPromise\n      },\n    }\n  })\n  .actions(self => ({\n    /**\n     * #action\n     */\n    addAuthHeaderToInit(init?: RequestInit, token?: string) {\n      return {\n        ...init,\n        headers: new Headers({\n          // eslint-disable-next-line @typescript-eslint/no-misused-spread\n          ...init?.headers,\n          ...(token\n            ? {\n                [self.authHeader]: self.tokenType\n                  ? `${self.tokenType} ${token}`\n                  : token,\n              }\n            : {}),\n        }),\n      }\n    },\n    /**\n     * #action\n     * Gets the token and returns it along with the information needed to\n     * create a new internetAccount.\n     *\n     * @param location - UriLocation of the resource\n     * @returns\n     */\n    async getPreAuthorizationInformation(location: UriLocation) {\n      const authToken = await self.getToken(location)\n      let validatedToken: string | undefined\n      try {\n        validatedToken = await self.validateToken(authToken, location)\n      } catch (error) {\n        self.removeToken()\n        throw error\n      }\n      return {\n        internetAccountType: self.type,\n        authInfo: {\n          token: validatedToken,\n          configuration: getConf(self),\n        },\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Get a fetch method that will add any needed authentication headers to\n     * the request before sending it. If location is provided, it will be\n     * checked to see if it includes a token in it pre-auth information.\n     *\n     * @param loc - UriLocation of the resource\n     * @returns A function that can be used to fetch\n     */\n    getFetcher(loc?: UriLocation) {\n      return async (input: RequestInfo, init?: RequestInit) => {\n        const authToken = await self.getToken(loc)\n        const newInit = self.addAuthHeaderToInit(init, authToken)\n        return fetch(input, newInit)\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Gets a filehandle that uses a fetch that adds auth headers\n     * @param location - UriLocation of the resource\n     * @returns A filehandle\n     */\n    openLocation(location: UriLocation) {\n      return new RemoteFileWithRangeCache(location.uri, {\n        fetch: self.getFetcher(location),\n      })\n    },\n  }))\n\nexport type BaseInternetAccountStateModel = typeof InternetAccount\nexport type BaseInternetAccountModel = Instance<BaseInternetAccountStateModel>\n","import { transaction } from 'mobx'\nimport { getRoot, resolveIdentifier, types } from 'mobx-state-tree'\n\nimport { ConfigurationReference, getConf } from '../../configuration'\nimport { adapterConfigCacheKey } from '../../data_adapters/util'\nimport { getContainingView, getEnv, getSession } from '../../util'\nimport { isSessionModelWithConfigEditing } from '../../util/types'\nimport { ElementId } from '../../util/types/mst'\n\nimport type PluginManager from '../../PluginManager'\nimport type {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from '../../configuration'\nimport type { MenuItem } from '../../ui'\nimport type { IAnyStateTreeNode, Instance } from 'mobx-state-tree'\n\nexport function getCompatibleDisplays(self: IAnyStateTreeNode) {\n  const { pluginManager } = getEnv(self)\n  const view = getContainingView(self)\n  const viewType = pluginManager.getViewType(view.type)!\n  const compatTypes = new Set(viewType.displayTypes.map(d => d.name))\n  const displays = self.configuration.displays as AnyConfigurationModel[]\n  return displays.filter(d => compatTypes.has(d.type))\n}\n\n/**\n * #stateModel BaseTrackModel\n * #category track\n *\n * these MST models only exist for tracks that are *shown*. they should contain\n * only UI state for the track, and have a reference to a track configuration.\n * note that multiple displayed tracks could use the same configuration.\n */\nexport function createBaseTrackModel(\n  pm: PluginManager,\n  trackType: string,\n  baseTrackConfig: AnyConfigurationSchemaType,\n) {\n  return types\n    .model(trackType, {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal(trackType),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(baseTrackConfig),\n      /**\n       * #property\n       */\n      minimized: false,\n      /**\n       * #property\n       */\n      pinned: false,\n      /**\n       * #property\n       */\n      displays: types.array(pm.pluggableMstType('display', 'stateModel')),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       * determines which webworker to send the track to, currently based on trackId\n       */\n      get rpcSessionId() {\n        const adapter = getConf(self, 'adapter')\n        return adapter\n          ? adapterConfigCacheKey(adapter)\n          : self.configuration.trackId\n      },\n      /**\n       * #getter\n       */\n      get name() {\n        return getConf(self, 'name')\n      },\n      /**\n       * #getter\n       */\n      get textSearchAdapter() {\n        return getConf(self, 'textSearchAdapter')\n      },\n\n      /**\n       * #getter\n       */\n      get adapterConfig() {\n        return getConf(self, 'adapter')\n      },\n\n      /**\n       * #getter\n       */\n      get adapterType() {\n        const adapterConfig = getConf(self, 'adapter')\n        if (!adapterConfig) {\n          throw new Error(`no adapter configuration provided for ${self.type}`)\n        }\n        const adapterType = pm.getAdapterType(adapterConfig.type)\n        if (!adapterType) {\n          throw new Error(`unknown adapter type ${adapterConfig.type}`)\n        }\n        return adapterType\n      },\n\n      /**\n       * #getter\n       */\n      get viewMenuActions(): MenuItem[] {\n        return self.displays.flatMap(d => d.viewMenuActions)\n      },\n\n      /**\n       * #getter\n       */\n      get canConfigure() {\n        const session = getSession(self)\n        const { sessionTracks, adminMode } = session\n        return (\n          isSessionModelWithConfigEditing(session) &&\n          (adminMode ||\n            sessionTracks?.find(t => t.trackId === self.configuration.trackId))\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setPinned(flag: boolean) {\n        self.pinned = flag\n      },\n      /**\n       * #action\n       */\n      setMinimized(flag: boolean) {\n        self.minimized = flag\n      },\n\n      /**\n       * #action\n       */\n      showDisplay(displayId: string, initialSnapshot = {}) {\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), displayId)\n        const displayType = pm.getDisplayType(conf.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${conf.type}`)\n        }\n        const display = displayType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n        })\n        self.displays.push(display)\n      },\n\n      /**\n       * #action\n       */\n      hideDisplay(displayId: string) {\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), displayId)\n        const t = self.displays.filter(d => d.configuration === conf)\n        transaction(() => {\n          for (const d of t) {\n            self.displays.remove(d)\n          }\n        })\n        return t.length\n      },\n\n      /**\n       * #action\n       */\n      replaceDisplay(oldId: string, newId: string, initialSnapshot = {}) {\n        const idx = self.displays.findIndex(\n          d => d.configuration.displayId === oldId,\n        )\n        if (idx === -1) {\n          throw new Error(`could not find display id ${oldId} to replace`)\n        }\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), newId)\n        const displayType = pm.getDisplayType(conf.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${conf.type}`)\n        }\n        self.displays.splice(idx, 1, {\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n        })\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      trackMenuItems() {\n        const menuItems: MenuItem[] = self.displays.flatMap(d =>\n          d.trackMenuItems(),\n        )\n        const shownId = self.displays[0].configuration.displayId\n        const compatDisp = getCompatibleDisplays(self)\n\n        return [\n          ...menuItems,\n          ...(compatDisp.length > 1\n            ? [\n                {\n                  type: 'subMenu',\n                  label: 'Display types',\n                  priority: -1000,\n                  subMenu: compatDisp.map(d => ({\n                    type: 'radio',\n                    label: pm.getDisplayType(d.type)!.displayName,\n                    checked: d.displayId === shownId,\n                    onClick: () => {\n                      self.replaceDisplay(shownId, d.displayId)\n                    },\n                  })),\n                },\n              ]\n            : []),\n        ]\n      },\n    }))\n}\n\nexport type BaseTrackStateModel = ReturnType<typeof createBaseTrackModel>\nexport type BaseTrackModel = Instance<BaseTrackStateModel>\n","import { types } from 'mobx-state-tree'\n\nimport { ConfigurationSchema } from '../../configuration'\n\nimport type PluginManager from '../../PluginManager'\nimport type { Instance } from 'mobx-state-tree'\n\ninterface BasicTrack {\n  trackId: string\n  name: string\n  type: string\n  displays: {\n    type: string\n    displayId?: string\n  }[]\n}\n\n/**\n * #config BaseTrack\n */\nexport function createBaseTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseTrack',\n    {\n      /**\n       * #slot\n       */\n      name: {\n        description: 'descriptive name of the track',\n        type: 'string',\n        defaultValue: 'Track',\n      },\n      /**\n       * #slot\n       */\n      assemblyNames: {\n        description: 'name of the assembly (or assemblies) track belongs to',\n        type: 'stringArray',\n        defaultValue: ['assemblyName'],\n      },\n      /**\n       * #slot\n       */\n      description: {\n        description: 'a description of the track',\n        type: 'string',\n        defaultValue: '',\n      },\n      /**\n       * #slot\n       */\n      category: {\n        description: 'the category and sub-categories of a track',\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      /**\n       * #slot\n       */\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n      /**\n       * #slot\n       */\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n\n      textSearching: ConfigurationSchema('textSearching', {\n        /**\n         * #slot textSearching.indexedAttributes\n         */\n        indexingAttributes: {\n          type: 'stringArray',\n          description:\n            'list of which feature attributes to index for text searching',\n          defaultValue: ['Name', 'ID'],\n        },\n        /**\n         * #slot textSearching.indexingFeatureTypesToExclude\n         */\n        indexingFeatureTypesToExclude: {\n          type: 'stringArray',\n          description: 'list of feature types to exclude in text search index',\n          defaultValue: ['CDS', 'exon'],\n        },\n\n        /**\n         * #slot textSearching.textSearchAdapter\n         */\n        textSearchAdapter: pluginManager.pluggableConfigSchemaType(\n          'text search adapter',\n        ),\n      }),\n\n      /**\n       * #slot\n       */\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n\n      formatDetails: ConfigurationSchema('FormatDetails', {\n        /**\n         * #slot formatDetails.feature\n         */\n        feature: {\n          type: 'frozen',\n          description: 'adds extra fields to the feature details',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n        /**\n         * #slot formatDetails.subfeatures\n         */\n        subfeatures: {\n          type: 'frozen',\n          description: 'adds extra fields to the subfeatures of a feature',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n        /**\n         * #slot formatDetails.depth\n         */\n        depth: {\n          type: 'number',\n          defaultValue: 2,\n          description:\n            'depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2',\n        },\n        /**\n         * #slot formatDetails.maxDepth\n         */\n        maxDepth: {\n          type: 'number',\n          defaultValue: 99999,\n          description: 'Maximum depth to render subfeatures',\n        },\n      }),\n      formatAbout: ConfigurationSchema('FormatAbout', {\n        /**\n         * #slot formatAbout.config\n         */\n        config: {\n          type: 'frozen',\n          description: 'formats configuration object in about dialog',\n          defaultValue: {},\n          contextVariable: ['config'],\n        },\n\n        /**\n         * #slot formatAbout.hideUris\n         */\n        hideUris: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n      }),\n    },\n    {\n      preProcessSnapshot: s2 => {\n        const snap = pluginManager.evaluateExtensionPoint(\n          'Core-preProcessTrackConfig',\n          structuredClone(s2),\n        ) as BasicTrack\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          try {\n            const configDisplayTypes = new Set(displays.map(d => d.type))\n            for (const d of pluginManager.getTrackType(snap.type)!\n              .displayTypes) {\n              if (!configDisplayTypes.has(d.name)) {\n                displays.push({\n                  displayId: `${snap.trackId}-${d.name}`,\n                  type: d.name,\n                })\n              }\n            }\n          } catch (e) {\n            throw new Error(\n              `Unknown track type \"${snap.type}\" in ${JSON.stringify(snap)}`,\n              {\n                cause: e,\n              },\n            )\n          }\n        }\n        return {\n          ...snap,\n          displays: displays.map(d => ({\n            ...d,\n            // synthesize displayId if none provided\n            displayId: d.displayId ?? `${snap.trackId}-${d.type}`,\n          })),\n        }\n      },\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n\n      actions: (self: any) => ({\n        addDisplayConf(conf: { type: string; displayId: string }) {\n          const { type } = conf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d?.displayId === conf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(conf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n\nexport type BaseTrackConfigSchema = ReturnType<typeof createBaseTrackConfig>\nexport type BaseTrackConfig = Instance<BaseTrackConfigSchema>\n","import type { BaseLayout, SerializedLayout } from './BaseLayout'\n\nexport default class MultiLayout<SUB_LAYOUT_CLASS extends BaseLayout<T>, T> {\n  subLayouts = new Map<string, SUB_LAYOUT_CLASS>()\n\n  /**\n   * layout class that just keeps a number of named sub-layouts.\n   * basically just a fancier\n   * `{ layout1: new GranularRectLayout(), layout2: new GranularRectLayout() ...}`\n   */\n  constructor(\n    public SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS,\n    public subLayoutConstructorArgs: Record<string, any> = {},\n  ) {}\n\n  getDataByID(id: string): unknown {\n    for (const layout of this.subLayouts.values()) {\n      // @ts-expect-error\n      const r = layout.getDataByID(id)\n      if (r) {\n        return r\n      }\n    }\n    return undefined\n  }\n\n  getSublayout(layoutName: string): SUB_LAYOUT_CLASS {\n    let subLayout = this.subLayouts.get(layoutName)\n    if (subLayout === undefined) {\n      subLayout = new this.SubLayoutClass(this.subLayoutConstructorArgs)\n      this.subLayouts.set(layoutName, subLayout)\n      return subLayout\n    }\n\n    return subLayout\n  }\n\n  addRect(\n    layoutName: string,\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data: Record<string, T> = {},\n  ) {\n    return this.getSublayout(layoutName).addRect(id, left, right, height, data)\n  }\n\n  discardRange(layoutName: string, left: number, right: number) {\n    return this.subLayouts.get(layoutName)?.discardRange(left, right)\n  }\n\n  toJSON() {\n    const data: Record<string, SerializedLayout> = {}\n    for (const [layoutName, sublayout] of this.subLayouts.entries()) {\n      data[layoutName] = sublayout.toJSON()\n    }\n    return data\n  }\n}\n","import { forwardRef, isValidElement } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { SanitizedHTML } from '@jbrowse/core/ui'\nimport BaseTooltip from '@jbrowse/core/ui/BaseTooltip'\nimport { observer } from 'mobx-react'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\ninterface Props {\n  message: React.ReactNode | string\n}\nconst TooltipContents = forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ message }, ref) {\n    return (\n      <div ref={ref}>\n        {isValidElement(message) ? (\n          message\n        ) : message ? (\n          <SanitizedHTML html={String(message)} />\n        ) : null}\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst Tooltip = observer(function ({\n  model,\n  clientMouseCoord,\n}: {\n  model: {\n    featureUnderMouse: Feature | undefined\n    configuration: AnyConfigurationModel\n  }\n  clientMouseCoord: Coord\n}) {\n  const { featureUnderMouse } = model\n  const x = clientMouseCoord[0] + 15\n  const y = clientMouseCoord[1]\n\n  const contents = featureUnderMouse\n    ? getConf(model, 'mouseover', { feature: featureUnderMouse })\n    : undefined\n\n  return featureUnderMouse && contents ? (\n    <BaseTooltip clientPoint={{ x, y }}>\n      <TooltipContents message={contents} />\n    </BaseTooltip>\n  ) : null\n})\n\nexport default Tooltip\n","// adapted from map-obj (MIT), with modifications to pass the \"whole object\"\n// from an array of objects into itself\nconst isObject = (value: unknown) => typeof value === 'object' && value !== null\n\n// Customized for this use-case\nconst isObjectCustom = (value: unknown) =>\n  isObject(value) &&\n  !(value instanceof RegExp) &&\n  !(value instanceof Error) &&\n  !(value instanceof Date) &&\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  !(globalThis.Blob && value instanceof globalThis.Blob)\n\ntype Obj = Record<string, unknown>\n\nexport default function map(\n  object: Obj,\n  mapper: (val: unknown) => void,\n  isSeen = new WeakSet(),\n) {\n  if (isSeen.has(object)) {\n    return\n  }\n\n  isSeen.add(object)\n\n  const mapArray = (array: unknown[]) => {\n    for (const element of array) {\n      mapper(element)\n      if (isObject(element)) {\n        map(element as Record<string, unknown>, mapper, isSeen)\n      }\n    }\n  }\n\n  if (Array.isArray(object)) {\n    mapArray(object)\n  }\n\n  for (const value of Object.values(object)) {\n    mapper(value)\n\n    if (isObjectCustom(value)) {\n      if (Array.isArray(value)) {\n        mapArray(value)\n      } else {\n        map(value as Obj, mapper, isSeen)\n      }\n    }\n  }\n}\n","import PluggableElementBase from './PluggableElementBase'\nimport mapObject from '../util/map-obj'\nimport { getBlobMap, setBlobMap } from '../util/tracks'\nimport {\n  RetryError,\n  isAppRootModel,\n  isAuthNeededException,\n  isUriLocation,\n} from '../util/types'\n\nimport type PluginManager from '../PluginManager'\nimport type { UriLocation } from '../util/types'\n\nexport type RpcMethodConstructor = new (pm: PluginManager) => RpcMethodType\n\nexport default abstract class RpcMethodType extends PluggableElementBase {\n  constructor(public pluginManager: PluginManager) {\n    super()\n  }\n\n  async serializeArguments(\n    args: Record<string, unknown>,\n    rpcDriverClassName: string,\n  ): Promise<Record<string, unknown>> {\n    const blobMap = getBlobMap()\n    await this.augmentLocationObjects(args, rpcDriverClassName)\n    return { ...args, blobMap }\n  }\n\n  async serializeNewAuthArguments(\n    loc: UriLocation,\n    rpcDriverClassName: string,\n  ) {\n    const rootModel = this.pluginManager.rootModel\n\n    // args dont need auth or already have auth\n    if (!isAppRootModel(rootModel) || loc.internetAccountPreAuthorization) {\n      return loc\n    }\n\n    const account = rootModel.findAppropriateInternetAccount(loc)\n\n    // mutating loc object is not allowed in MainThreadRpcDriver, and is only\n    // needed for web worker RPC\n    if (account && rpcDriverClassName !== 'MainThreadRpcDriver') {\n      loc.internetAccountPreAuthorization =\n        await account.getPreAuthorizationInformation(loc)\n    }\n    return loc\n  }\n\n  async deserializeArguments<T>(\n    args: T & { blobMap?: Record<string, File> },\n    _rpcDriverClassName: string,\n  ): Promise<T> {\n    if (args.blobMap) {\n      setBlobMap(args.blobMap)\n    }\n\n    return args\n  }\n\n  abstract execute(\n    serializedArgs: unknown,\n    rpcDriverClassName: string,\n  ): Promise<unknown>\n\n  async serializeReturn(\n    originalReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ) {\n    return originalReturn\n  }\n\n  async deserializeReturn(\n    serializedReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ) {\n    let r: unknown\n    try {\n      r = await serializedReturn\n    } catch (error) {\n      if (isAuthNeededException(error)) {\n        const retryAccount = // @ts-expect-error\n          this.pluginManager.rootModel?.createEphemeralInternetAccount(\n            `HTTPBasicInternetAccount-${new URL(error.url).origin}`,\n            {},\n            error.url,\n          )\n        throw new RetryError(\n          'Retrying with created internet account',\n          retryAccount.internetAccountId,\n        )\n      }\n      throw error\n    }\n    return r\n  }\n\n  private async augmentLocationObjects(\n    thing: Record<string, unknown>,\n    rpcDriverClassName: string,\n  ) {\n    const uris = [] as UriLocation[]\n\n    // using map-obj avoids cycles, seen in circular view svg export\n    mapObject(thing, val => {\n      if (isUriLocation(val)) {\n        uris.push(val)\n      }\n    })\n    for (const uri of uris) {\n      await this.serializeNewAuthArguments(uri, rpcDriverClassName)\n    }\n    return thing\n  }\n}\n","import { adapterConfigCacheKey } from './util'\n\nimport type PluginManager from '../PluginManager'\nimport type { AnyConfigurationSchemaType } from '../configuration'\nimport type { AnyDataAdapter } from './BaseAdapter'\nimport type { SnapshotIn } from 'mobx-state-tree'\n\ntype ConfigSnap = SnapshotIn<AnyConfigurationSchemaType>\n\ninterface AdapterCacheEntry {\n  dataAdapter: AnyDataAdapter\n  sessionIds: Set<string>\n}\n\nlet adapterCache: Record<string, AdapterCacheEntry> = {}\n\n/**\n * instantiate a data adapter, or return an already-instantiated one if we have\n * one with the same configuration\n *\n * @param pluginManager\n *\n * @param sessionId - session ID of the associated worker session. used for\n * reference counting\n *\n * @param adapterConfigSnapshot - plain-JS configuration snapshot for the\n * adapter\n */\nexport async function getAdapter(\n  pluginManager: PluginManager,\n  sessionId: string,\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n): Promise<AdapterCacheEntry> {\n  // cache the adapter object\n  const cacheKey = adapterConfigCacheKey(adapterConfigSnapshot)\n  if (!adapterCache[cacheKey]) {\n    const adapterType = adapterConfigSnapshot?.type\n\n    if (!adapterType) {\n      throw new Error(\n        `could not determine adapter type from adapter config snapshot ${JSON.stringify(\n          adapterConfigSnapshot,\n        )}`,\n      )\n    }\n    const dataAdapterType = pluginManager.getAdapterType(adapterType)\n    if (!dataAdapterType) {\n      throw new Error(`unknown data adapter type ${adapterType}`)\n    }\n\n    // instantiate the data adapter's config schema so it gets its defaults,\n    // callbacks, etc\n    const adapterConfig = dataAdapterType.configSchema.create(\n      adapterConfigSnapshot,\n      { pluginManager },\n    )\n\n    const getSubAdapter = getAdapter.bind(null, pluginManager, sessionId)\n    const CLASS = await dataAdapterType.getAdapterClass()\n    const dataAdapter = new CLASS(adapterConfig, getSubAdapter, pluginManager)\n\n    // store it in our cache\n    adapterCache[cacheKey] = {\n      dataAdapter,\n      sessionIds: new Set([sessionId]),\n    }\n  }\n\n  const cacheEntry = adapterCache[cacheKey]\n  cacheEntry.sessionIds.add(sessionId)\n\n  return cacheEntry\n}\n\n/**\n * this is a callback that is passed to adapters that allows them to get any\n * sub-adapters that they need internally, staying with the same worker session\n * ID\n */\nexport type getSubAdapterType = (\n  adapterConfigSnap: ConfigSnap,\n) => ReturnType<typeof getAdapter>\n\nexport function freeAdapterResources(args: Record<string, any>) {\n  const specKeys = Object.keys(args)\n\n  // TODO: little hacky...should make it an explicit command but:\n  // if we don't specify a range, delete any adapters that are only associated\n  // with that session\n  if (specKeys.length === 1 && specKeys[0] === 'sessionId') {\n    const { sessionId } = args\n    for (const [cacheKey, cacheEntry] of Object.entries(adapterCache)) {\n      cacheEntry.sessionIds.delete(sessionId)\n      if (cacheEntry.sessionIds.size === 0) {\n        delete adapterCache[cacheKey]\n      }\n    }\n  } else {\n    // otherwise call freeResources on all the cached data adapters\n    for (const cacheEntry of Object.values(adapterCache)) {\n      const regions = args.regions || (args.region ? [args.region] : [])\n      for (const region of regions) {\n        if (region.refName !== undefined) {\n          cacheEntry.dataAdapter.freeResources(region)\n        }\n      }\n    }\n  }\n}\n\nexport function clearAdapterCache() {\n  adapterCache = {}\n}\n","type Hasher<T> = (input: T) => string\n\n// from https://github.com/seriousManual/dedupe/blob/master/LICENSE\nexport function dedupe<T>(list: T[], hasher: Hasher<T> = JSON.stringify) {\n  const clone: T[] = []\n  const lookup = new Set<string>()\n\n  for (const entry of list) {\n    const hashed = hasher(entry)\n\n    if (!lookup.has(hashed)) {\n      clone.push(entry)\n      lookup.add(hashed)\n    }\n  }\n\n  return clone\n}\n","import BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { dedupe, getSession } from '@jbrowse/core/util'\n\nimport type { LinearGenomeViewModel } from './LinearGenomeView'\nimport type { SearchScope } from '@jbrowse/core/TextSearch/TextSearchManager'\nimport type { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport type { SearchType } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { TextSearchManager } from '@jbrowse/core/util'\n\nexport async function navToOption({\n  option,\n  model,\n  assemblyName,\n}: {\n  model: LinearGenomeViewModel\n  option: BaseResult\n  assemblyName: string\n}) {\n  const location = option.getLocation()\n  const trackId = option.getTrackId()\n  if (location) {\n    await model.navToLocString(location, assemblyName, 0.2)\n    if (trackId) {\n      model.showTrack(trackId)\n    }\n  }\n}\n\n// gets a string as input, or use stored option results from previous query,\n// then re-query and\n// 1) if it has multiple results: pop a dialog\n// 2) if it's a single result navigate to it\n// 3) else assume it's a locstring and navigate to it\nexport async function handleSelectedRegion({\n  input,\n  model,\n  assembly,\n}: {\n  input: string\n  model: LinearGenomeViewModel\n  assembly: Assembly\n}) {\n  const allRefs = assembly.allRefNamesWithLowerCase || []\n  const assemblyName = assembly.name\n  if (input.split(' ').every(entry => checkRef(entry, allRefs))) {\n    await model.navToLocString(input, assembly.name)\n  } else {\n    const searchScope = model.searchScope(assemblyName)\n    const { textSearchManager } = getSession(model)\n    const results = await fetchResults({\n      queryString: input,\n      searchType: 'exact',\n      searchScope,\n      rankSearchResults: model.rankSearchResults,\n      textSearchManager,\n      assembly,\n    })\n\n    if (results.length > 1) {\n      model.setSearchResults(results, input.toLowerCase(), assemblyName)\n    } else if (results.length === 1) {\n      await navToOption({\n        option: results[0]!,\n        model,\n        assemblyName,\n      })\n    } else {\n      await model.navToLocString(input, assemblyName)\n    }\n  }\n}\n\nexport function checkRef(str: string, allRefs: string[]) {\n  const [ref, rest] = splitLast(str, ':')\n  return (\n    allRefs.includes(str) ||\n    (allRefs.includes(ref) && !Number.isNaN(Number.parseInt(rest, 10)))\n  )\n}\n\nexport async function fetchResults({\n  queryString,\n  searchType,\n  searchScope,\n  rankSearchResults,\n  textSearchManager,\n  assembly,\n}: {\n  queryString: string\n  searchScope: SearchScope\n  rankSearchResults: (results: BaseResult[]) => BaseResult[]\n  searchType?: SearchType\n  textSearchManager?: TextSearchManager\n  assembly?: Assembly\n}) {\n  if (!textSearchManager) {\n    console.warn('No text search manager')\n  }\n\n  const textSearchResults = await textSearchManager?.search(\n    {\n      queryString,\n      searchType,\n    },\n    searchScope,\n    rankSearchResults,\n  )\n\n  const refNameResults = assembly?.allRefNames\n    ?.filter(ref => ref.toLowerCase().startsWith(queryString.toLowerCase()))\n    .slice(0, 10)\n    .map(r => new BaseResult({ label: r }))\n\n  return dedupe(\n    [...(refNameResults || []), ...(textSearchResults || [])],\n    elt => elt.getId(),\n  )\n}\n\n// splits on the last instance of a character\nexport function splitLast(str: string, split: string): [string, string] {\n  const lastIndex = str.lastIndexOf(split)\n  if (lastIndex === -1) {\n    return [str, '']\n  }\n  const before = str.slice(0, lastIndex)\n  const after = str.slice(lastIndex + 1)\n  return [before, after]\n}\n","/**\n * Abstract feature object\n */\nexport interface Feature {\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  get(name: 'refName'): string\n  get(name: 'start' | 'end'): number\n  get(name: 'subfeatures'): Feature[] | undefined\n\n  get(name: string): any\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined\n\n  /**\n   * Convert to JSON\n   */\n  toJSON(): SimpleFeatureSerialized\n}\n\nexport function isFeature(thing: unknown): thing is Feature {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    typeof (thing as Feature).get === 'function' &&\n    typeof (thing as Feature).id === 'function'\n  )\n}\n\nexport interface SimpleFeatureArgs {\n  /** key-value data, must include 'start' and 'end' */\n  data: Record<string, unknown>\n  /** optional parent feature */\n  parent?: Feature\n  /** unique identifier. can also be in data.uniqueId */\n  id: string | number // thing that can be stringified easily\n}\n\n// subfeatures do not have to have uniqueId\nexport interface SimpleFeatureSerializedNoId {\n  [key: string]: unknown\n  parentId?: string\n  start: number\n  end: number\n  refName: string\n  type?: string\n  subfeatures?: SimpleFeatureSerializedNoId[]\n}\n\n// base serialized feature has to have a uniqueId\nexport interface SimpleFeatureSerialized extends SimpleFeatureSerializedNoId {\n  subfeatures?: SimpleFeatureSerializedNoId[]\n  uniqueId: string\n}\n\nfunction isSimpleFeatureSerialized(\n  args: SimpleFeatureSerialized | SimpleFeatureArgs,\n): args is SimpleFeatureSerialized {\n  return 'uniqueId' in args && typeof args.data !== 'object'\n}\n\n/**\n * Simple implementation of a feature object.\n */\nexport default class SimpleFeature implements Feature {\n  private data: Record<string, any>\n\n  private subfeatures?: SimpleFeature[]\n\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  /**\n   * @param args - SimpleFeature args\n   *\n   * Note: args.data.subfeatures can be an array of these same args,\n   * which will be inflated to more instances of this class.\n   */\n  public constructor(args: SimpleFeatureArgs | SimpleFeatureSerialized) {\n    if (isSimpleFeatureSerialized(args)) {\n      this.data = args\n    } else {\n      this.data = args.data\n      // load handle from args.parent (not args.data.parent) this reason is\n      // because if args is an object, it likely isn't properly loaded with\n      // parent as a Feature reference (probably a raw parent ID or something\n      // instead)\n      this.parentHandle = args.parent\n    }\n\n    // the feature id comes from args.id, args.data.uniqueId, or args.uniqueId\n    // due to this initialization\n    const id = isSimpleFeatureSerialized(args) ? args.uniqueId : args.id\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    if (id === undefined || id === null) {\n      throw new Error(\n        'SimpleFeature requires a unique `id` or `data.uniqueId` attribute',\n      )\n    }\n    this.uniqueId = String(id)\n\n    if (!(this.data.aliases || this.data.end - this.data.start >= 0)) {\n      throw new Error(\n        `invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`,\n      )\n    }\n    if (this.data.subfeatures) {\n      this.subfeatures = this.data.subfeatures?.map((f: any, i: number) =>\n        typeof f.get !== 'function'\n          ? new SimpleFeature({\n              id: f.uniqueId || `${id}-${i}`,\n              data: {\n                strand: this.data.strand,\n                ...f,\n              } as Record<string, any>,\n              parent: this,\n            })\n          : f,\n      )\n    }\n  }\n\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n\n  public get(name: string): any {\n    return name === 'subfeatures'\n      ? this.subfeatures\n      : name === 'parent'\n        ? this.parent()\n        : this.data[name]\n  }\n\n  /**\n   * Set an item of data.\n   */\n\n  public set(name: string, val: any): void {\n    this.data[name] = val\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  public tags(): string[] {\n    return Object.keys(this.data)\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  public id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  public parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  public children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  public toJSON(): SimpleFeatureSerialized {\n    const d = { ...this.data, uniqueId: this.id() } as SimpleFeatureSerialized\n    const p = this.parent()\n    if (p) {\n      d.parentId = p.id()\n    }\n    const c = this.children()\n    if (c) {\n      d.subfeatures = c.map(child => child.toJSON())\n    }\n    return d\n  }\n\n  public static fromJSON(json: SimpleFeatureSerialized) {\n    return new SimpleFeature({ ...json })\n  }\n}\n","export interface Row {\n  id: string\n  metadata?: Record<string, unknown>\n  [key: string]: unknown\n}\n\nexport function getRowStr(facet: string, row: Row) {\n  return `${\n    (facet.startsWith('metadata.')\n      ? row.metadata?.[facet.replace('metadata.', '')]\n      : row[facet]) || ''\n  }`\n}\n","import { types } from 'mobx-state-tree'\n\nimport { ElementId, Region } from '../../util/types/mst'\n\nimport type { MenuItem } from '../../ui'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel BaseViewModel\n * #category view\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseViewModel = types\n  .model('BaseView', {\n    /**\n     * #property\n     */\n    id: ElementId,\n\n    /**\n     * #property\n     * displayName is displayed in the header of the view, or assembly names\n     * being used if none is specified\n     */\n    displayName: types.maybe(types.string),\n\n    /**\n     * #property\n     */\n    minimized: false,\n  })\n  .volatile(() => ({\n    width: 800,\n  }))\n  .views(() => ({\n    /**\n     * #getter\n     */\n    menuItems(): MenuItem[] {\n      return []\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setDisplayName(name: string) {\n      self.displayName = name\n    },\n\n    /**\n     * #action\n     * width is an important attribute of the view model, when it becomes set,\n     * it often indicates when the app can start drawing to it. certain views\n     * like lgv are strict about this because if it tries to draw before it\n     * knows the width it should draw to, it may start fetching data for\n     * regions it doesn't need to\n     *\n     * setWidth is updated by a ResizeObserver generally, the views often need\n     * to know how wide they are to properly draw genomic regions\n     */\n    setWidth(newWidth: number) {\n      self.width = newWidth\n    },\n\n    /**\n     * #action\n     */\n    setMinimized(flag: boolean) {\n      self.minimized = flag\n    },\n  }))\n\nexport default BaseViewModel\n\nexport type IBaseViewModel = Instance<typeof BaseViewModel>\n\nexport const BaseViewModelWithDisplayedRegions = BaseViewModel.props({\n  displayedRegions: types.array(Region),\n})\nexport type IBaseViewModelWithDisplayedRegions = Instance<\n  typeof BaseViewModelWithDisplayedRegions\n>\n","import PluggableElementBase from './PluggableElementBase'\n\nimport type { AnyConfigurationSchemaType } from '../configuration'\nimport type { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport default class TextSearchAdapterType extends PluggableElementBase {\n  getAdapterClass: () => Promise<AnyAdapter>\n\n  configSchema: AnyConfigurationSchemaType\n\n  description?: string\n\n  constructor(\n    stuff: {\n      name: string\n      displayName?: string\n      description?: string\n      configSchema: AnyConfigurationSchemaType\n    } & (\n      | {\n          AdapterClass: AnyAdapter\n        }\n      | {\n          getAdapterClass: () => Promise<AnyAdapter>\n        }\n    ),\n  ) {\n    super(stuff)\n    this.description = stuff.description\n    this.configSchema = stuff.configSchema\n    this.getAdapterClass =\n      'getAdapterClass' in stuff\n        ? stuff.getAdapterClass\n        : async () => stuff.AdapterClass\n  }\n}\n","import type React from 'react'\n\nimport type { SearchType } from '../data_adapters/BaseAdapter'\nimport type TextSearchAdapterType from '../pluggableElementTypes/TextSearchAdapterType'\n\nexport interface BaseResultArgs {\n  label: string\n\n  displayString?: string\n\n  renderingComponent?: React.ReactElement\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  locString?: string\n\n  refName?: string\n\n  trackId?: string\n\n  score?: number\n\n  results?: BaseResult[]\n}\n\nexport default class BaseResult {\n  label: string\n\n  renderingComponent?: React.ReactElement\n\n  displayString?: string\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  trackId?: string\n\n  score: number\n\n  locString?: string\n\n  results?: BaseResult[]\n\n  constructor(args: BaseResultArgs) {\n    this.label = args.label\n    this.locString = args.locString\n    this.renderingComponent = args.renderingComponent\n    this.displayString = args.displayString\n    this.matchedAttribute = args.matchedAttribute\n    this.matchedObject = args.matchedObject\n    this.textSearchAdapter = args.textSearchAdapter\n    this.relevance = args.relevance\n    this.trackId = args.trackId\n    this.score = args.score || 1\n    this.results = args.results || []\n  }\n\n  getLabel() {\n    return this.label\n  }\n\n  getDisplayString() {\n    return this.displayString || this.label\n  }\n\n  getRenderingComponent() {\n    return this.renderingComponent\n  }\n\n  getTrackId() {\n    return this.trackId\n  }\n\n  getScore() {\n    return this.score\n  }\n\n  updateScore(newScore: number) {\n    this.score = newScore\n    return this.score\n  }\n\n  getId() {\n    return `${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`\n  }\n\n  hasLocation() {\n    return !!this.locString\n  }\n\n  getLocation() {\n    return this.locString\n  }\n\n  getComboResults() {\n    return this.results\n  }\n}\n\nexport class RefSequenceResult extends BaseResult {\n  refName: string\n\n  constructor(args: BaseResultArgs) {\n    super(args)\n    this.refName = args.refName ?? ''\n  }\n\n  getLocation() {\n    return this.refName\n  }\n}\n","import { ConfigurationSchema } from '../configuration'\n\nconst configSchema = ConfigurationSchema('BaseFeatureWidget', {})\nexport { configSchema }\n","import { autorun } from 'mobx'\nimport { addDisposer, types } from 'mobx-state-tree'\n\nimport {\n  localStorageGetBoolean,\n  localStorageGetItem,\n  localStorageGetNumber,\n  localStorageSetItem,\n} from '../../util'\n\nimport type { SimpleFeatureSerialized } from '../../util'\nimport type { Instance } from 'mobx-state-tree'\n\nfunction localStorageSetNumber(key: string, value: number) {\n  localStorageSetItem(key, JSON.stringify(value))\n}\n\nfunction localStorageSetBoolean(key: string, value: boolean) {\n  localStorageSetItem(key, JSON.stringify(value))\n}\n\nconst p = 'sequenceFeatureDetails'\n\nexport function SequenceFeatureDetailsF() {\n  return types\n    .model('SequenceFeatureDetails')\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      showCoordinatesSetting:\n        localStorageGetItem(`${p}-showCoordinatesSetting`) || 'none',\n      /**\n       * #volatile\n       */\n      intronBp: localStorageGetNumber(`${p}-intronBp`, 10),\n      /**\n       * #volatile\n       */\n      upDownBp: localStorageGetNumber(`${p}-upDownBp`, 100),\n      /**\n       * #volatile\n       */\n      upperCaseCDS: localStorageGetBoolean(`${p}-upperCaseCDS`, true),\n      /**\n       * #volatile\n       */\n      charactersPerRow: 100,\n      /**\n       * #volatile\n       */\n      feature: undefined as SimpleFeatureSerialized | undefined,\n      /**\n       * #volatile\n       */\n      mode: '',\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFeature(f: SimpleFeatureSerialized) {\n        self.feature = f\n      },\n      /**\n       * #action\n       */\n      setUpDownBp(f: number) {\n        self.upDownBp = f\n      },\n      /**\n       * #action\n       */\n      setIntronBp(f: number) {\n        self.intronBp = f\n      },\n      /**\n       * #action\n       */\n      setUpperCaseCDS(f: boolean) {\n        self.upperCaseCDS = f\n      },\n      /**\n       * #action\n       */\n      setShowCoordinates(f: 'none' | 'relative' | 'genomic') {\n        self.showCoordinatesSetting = f\n      },\n      /**\n       * #action\n       */\n      setMode(mode: string) {\n        self.mode = mode\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get showCoordinates() {\n        return self.showCoordinatesSetting !== 'none'\n      },\n      /**\n       * #getter\n       */\n      get showGenomicCoordsOption() {\n        return (\n          self.mode === 'gene' ||\n          self.mode === 'gene_updownstream' ||\n          self.mode === 'genomic' ||\n          self.mode === 'genomic_sequence_updownstream'\n        )\n      },\n      /**\n       * #getter\n       */\n      get hasCDS() {\n        return self.feature?.subfeatures?.some(sub => sub.type === 'CDS')\n      },\n      /**\n       * #getter\n       */\n      get hasExon() {\n        return self.feature?.subfeatures?.some(sub => sub.type === 'exon')\n      },\n      /**\n       * #getter\n       */\n      get hasExonOrCDS() {\n        return this.hasExon || this.hasCDS\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            localStorageSetNumber(`${p}-upDownBp`, self.upDownBp)\n            localStorageSetNumber(`${p}-intronBp`, self.intronBp)\n            localStorageSetBoolean(`${p}-upperCaseCDS`, self.upperCaseCDS)\n            localStorageSetItem(\n              `${p}-showCoordinatesSetting`,\n              self.showCoordinatesSetting,\n            )\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setMode(\n              self.hasCDS ? 'cds' : self.hasExon ? 'cdna' : 'genomic',\n            )\n          }),\n        )\n      },\n    }))\n}\n\nexport type SequenceFeatureDetailsStateModel = ReturnType<\n  typeof SequenceFeatureDetailsF\n>\nexport type SequenceFeatureDetailsModel =\n  Instance<SequenceFeatureDetailsStateModel>\n","import { autorun } from 'mobx'\nimport { addDisposer, types } from 'mobx-state-tree'\n\nimport { getConf } from '../configuration'\nimport { getSession } from '../util'\nimport { SequenceFeatureDetailsF } from './SequenceFeatureDetails/model'\nimport { formatSubfeatures } from './util'\nimport { ElementId } from '../util/types/mst'\n\nimport type PluginManager from '../PluginManager'\nimport type { SimpleFeatureSerialized } from '../util'\nimport type { MaybeSerializedFeat } from './types'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel BaseFeatureWidget\n * displays data about features, allowing configuration callbacks to modify the\n * contents of what is displayed\n *\n * see: formatDetails-\\>feature,formatDetails-\\>subfeatures\n */\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('BaseFeatureWidget', {\n      /**\n       * #property\n       */\n      id: ElementId,\n\n      /**\n       * #property\n       */\n      type: types.literal('BaseFeatureWidget'),\n\n      /**\n       * #property\n       */\n      featureData: types.frozen<MaybeSerializedFeat>(),\n\n      /**\n       * #property\n       */\n      formattedFields: types.frozen(),\n\n      /**\n       * #property\n       */\n      unformattedFeatureData: types.frozen<MaybeSerializedFeat>(),\n\n      /**\n       * #property\n       */\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n\n      /**\n       * #property\n       */\n      track: types.safeReference(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n\n      /**\n       * #property\n       */\n      trackId: types.maybe(types.string),\n\n      /**\n       * #property\n       */\n      trackType: types.maybe(types.string),\n\n      /**\n       * #property\n       */\n      maxDepth: types.maybe(types.number),\n\n      /**\n       * #property\n       */\n      sequenceFeatureDetails: types.optional(SequenceFeatureDetailsF(), {}),\n\n      /**\n       * #property\n       */\n      descriptions: types.frozen<Record<string, unknown> | undefined>(),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      error: undefined as unknown,\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFeatureData(featureData: SimpleFeatureSerialized) {\n        self.unformattedFeatureData = featureData\n      },\n      /**\n       * #action\n       */\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n      /**\n       * #action\n       */\n      setFormattedData(feat: SimpleFeatureSerialized) {\n        self.featureData = feat\n      },\n      /**\n       * #action\n       */\n      setExtra(type?: string, trackId?: string, maxDepth?: number) {\n        self.trackId = trackId\n        self.trackType = type\n        self.maxDepth = maxDepth\n      },\n      /**\n       * #action\n       */\n      setError(e: unknown) {\n        self.error = e\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        addDisposer(\n          self,\n          autorun(() => {\n            try {\n              const { unformattedFeatureData, track } = self\n              const session = getSession(self)\n              if (track) {\n                self.setExtra(\n                  track.type,\n                  track.configuration.trackId,\n                  getConf(track, ['formatDetails', 'maxDepth']),\n                )\n              }\n              if (unformattedFeatureData) {\n                const feature = structuredClone(unformattedFeatureData)\n\n                const combine = (\n                  arg2: string,\n                  feature: Record<string, unknown>,\n                ) => ({\n                  ...getConf(session, ['formatDetails', arg2], { feature }),\n                  ...getConf(track, ['formatDetails', arg2], { feature }),\n                })\n\n                if (track) {\n                  feature.__jbrowsefmt = combine('feature', feature)\n\n                  formatSubfeatures(\n                    feature,\n                    getConf(track, ['formatDetails', 'depth']),\n                    sub => {\n                      sub.__jbrowsefmt = combine('subfeatures', sub)\n                    },\n                  )\n                }\n\n                self.setFormattedData(feature)\n              }\n            } catch (e) {\n              console.error(e)\n              self.setError(e)\n            }\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // @ts-expect-error\n      const { featureData, finalizedFeatureData, ...rest } = snap\n      return {\n        unformattedFeatureData: featureData,\n        featureData: finalizedFeatureData,\n        ...rest,\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const { unformattedFeatureData, featureData, ...rest } = snap as Omit<\n        typeof snap,\n        symbol\n      >\n\n      const s2 = JSON.stringify(featureData, (_, v) =>\n        v === undefined ? null : v,\n      )\n\n      // JSON.stringify can return empty if too large\n\n      const featureTooLargeToBeSerialized = !s2 || s2.length > 2_000_000\n\n      // The concept of using `finalizedFeatureData` is to avoid running\n      // formatter twice if loading from snapshot\n      return {\n        // We replace undefined with null to help with allowing fields to be\n        // hidden, setting null is not allowed by jexl so we set it to\n        // undefined to hide, but JSON only allows serializing null\n        finalizedFeatureData: featureTooLargeToBeSerialized\n          ? undefined\n          : JSON.parse(s2),\n        ...rest,\n      }\n    })\n}\n\nexport type BaseFeatureWidgetStateModel = ReturnType<typeof stateModelFactory>\nexport type BaseFeatureWidgetModel = Instance<BaseFeatureWidgetStateModel>\n","import { getFillProps } from '@jbrowse/core/util'\nimport { alpha, useTheme } from '@mui/material'\n\nconst RectBg = ({\n  x,\n  y,\n  width,\n  height,\n  color,\n}: {\n  x: number\n  y: number\n  width: number\n  height: number\n  color?: string\n}) => {\n  const theme = useTheme()\n  return (\n    <rect\n      pointerEvents=\"auto\"\n      x={x}\n      y={y}\n      width={width}\n      height={height}\n      {...getFillProps(color || alpha(theme.palette.background.paper, 0.3))}\n    />\n  )\n}\n\nexport default RectBg\n","import { Fragment } from 'react'\n\nimport { clamp, getFillProps } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport RectBg from './RectBg'\n\nimport type { Source } from '../types'\n\nconst MultiVariantColorLegend = observer(function ({\n  model,\n  labelWidth,\n}: {\n  model: {\n    canDisplayLabels: boolean\n    rowHeight: number\n    sources?: Source[]\n  }\n  labelWidth: number\n}) {\n  const { canDisplayLabels, rowHeight, sources } = model\n  const svgFontSize = clamp(rowHeight, 8, 12)\n  const colorBoxWidth = 15\n  const hasColors = sources?.some(s => s.color)\n  const legendWidth = labelWidth + (hasColors ? colorBoxWidth + 5 : 0)\n  const theme = useTheme()\n\n  return sources ? (\n    <>\n      {canDisplayLabels ? (\n        <RectBg\n          y={0}\n          x={0}\n          width={legendWidth}\n          height={(sources.length + 0.25) * rowHeight}\n        />\n      ) : null}\n      {sources.map((source, idx) => {\n        const { color, name, label } = source\n        return (\n          <Fragment key={`${label}-${idx}`}>\n            {color ? (\n              <RectBg\n                y={idx * rowHeight}\n                x={0}\n                width={colorBoxWidth + 0.5}\n                height={rowHeight + 0.5}\n                color={color}\n              />\n            ) : null}\n            {canDisplayLabels ? (\n              <text\n                y={idx * rowHeight + svgFontSize}\n                x={color ? colorBoxWidth + 2 : 0}\n                fontSize={svgFontSize}\n                {...getFillProps(theme.palette.text.primary)}\n              >\n                {label || name}\n              </text>\n            ) : null}\n          </Fragment>\n        )\n      })}\n    </>\n  ) : null\n})\n\nexport default MultiVariantColorLegend\n","import { clamp, getContainingView, max, measureText } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport ColorLegend from './MultiVariantColorLegend'\n\nimport type { MultiVariantBaseModel } from '../MultiVariantBaseModel'\n\nconst Wrapper = observer(function ({\n  children,\n  model,\n  exportSVG,\n}: {\n  model: MultiVariantBaseModel\n  children: React.ReactNode\n  exportSVG?: boolean\n}) {\n  const { id, scrollTop, height } = model\n  const clipid = `legend-${id}`\n  return exportSVG ? (\n    <>\n      <defs>\n        <clipPath id={clipid}>\n          <rect x={0} y={0} width={1000} height={height} />\n        </clipPath>\n      </defs>\n      <g clipPath={`url(#${clipid})`}>\n        <g transform={`translate(0,${-scrollTop})`}>{children}</g>\n      </g>\n    </>\n  ) : (\n    <svg\n      style={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        zIndex: 100,\n        pointerEvents: 'none',\n        height: model.totalHeight,\n        width: getContainingView(model).width,\n      }}\n    >\n      {children}\n    </svg>\n  )\n})\n\nexport const LegendBar = observer(function (props: {\n  model: MultiVariantBaseModel\n  orientation?: string\n  exportSVG?: boolean\n}) {\n  const { model } = props\n  const { canDisplayLabels, rowHeight, sources } = model\n  const svgFontSize = clamp(rowHeight, 8, 12)\n  return sources ? (\n    <Wrapper {...props}>\n      <ColorLegend\n        model={model}\n        labelWidth={max(\n          sources\n            .map(s => measureText(s.label, svgFontSize) + 10)\n            .map(width => (canDisplayLabels ? width : 20)),\n          0,\n        )}\n      />\n    </Wrapper>\n  ) : null\n})\n\nexport default LegendBar\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BigWigAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BigWigAdapter = ConfigurationSchema(\n  'BigWigAdapter',\n  {\n    /**\n     * #slot\n     */\n    bigWigLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bw',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    source: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Used for multiwiggle',\n    },\n\n    /**\n     * #slot\n     */\n    resolutionMultiplier: {\n      type: 'number',\n      defaultValue: 1,\n      description: 'Initial resolution multiplier',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"BigWigAdapter\",\n     *   \"uri\": \"yourfile.bw\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      return snap.uri\n        ? {\n            ...snap,\n            bigWigLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default BigWigAdapter\n","import { lazy } from 'react'\n\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession, isSessionWithAddTracks } from '@jbrowse/core/util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { HierarchicalTrackSelectorModel } from '@jbrowse/plugin-data-management'\n\n// lazies\nconst ConfirmDialog = lazy(() => import('./ConfirmDialog'))\n\nfunction makeTrack({\n  model,\n  arg,\n}: {\n  model: HierarchicalTrackSelectorModel\n  arg: {\n    name: string\n  }\n}) {\n  const tracks = model.selection\n  const trackIds = tracks.map(c => readConfObject(c, 'name'))\n  const subadapters = tracks\n    .map(c => readConfObject(c, 'adapter'))\n    .map((c, idx) => ({ ...c, source: trackIds[idx] }))\n  const now = +Date.now()\n  const trackId = `multitrack-${now}-sessionTrack`\n\n  const session = getSession(model)\n  if (isSessionWithAddTracks(session)) {\n    session.addTrackConf({\n      type: 'MultiQuantitativeTrack',\n      trackId,\n      name: arg.name,\n      assemblyNames: [\n        ...new Set(tracks.flatMap(c => readConfObject(c, 'assemblyNames'))),\n      ],\n      adapter: {\n        type: 'MultiWiggleAdapter',\n        subadapters,\n      },\n    })\n    model.view.showTrack(trackId)\n  }\n}\n\nexport default function CreateMultiWiggleExtensionF(pm: PluginManager) {\n  pm.addToExtensionPoint(\n    'TrackSelector-multiTrackMenuItems',\n    (items: unknown[], props: Record<string, unknown>) => {\n      const { session } = props\n      return [\n        ...items,\n        ...(isSessionWithAddTracks(session)\n          ? [\n              {\n                label: 'Create multi-wiggle track',\n                onClick: (model: HierarchicalTrackSelectorModel) => {\n                  const tracks = model.selection\n\n                  getSession(model).queueDialog(handleClose => [\n                    ConfirmDialog,\n                    {\n                      tracks,\n                      onClose: (arg: boolean, arg1?: { name: string }) => {\n                        if (arg && arg1) {\n                          makeTrack({ model, arg: arg1 })\n                        }\n                        handleClose()\n                      },\n                    },\n                  ])\n                },\n              },\n            ]\n          : []),\n      ]\n    },\n  )\n}\n","import FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport { renderToAbstractCanvas, updateStatus } from '@jbrowse/core/util'\n\nimport type { ScaleOpts, Source } from './util'\nimport type {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { ThemeOptions } from '@mui/material'\n\nexport interface RenderArgs extends FeatureRenderArgs {\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n  displayCrossHatches: boolean\n  ticks: { values: number[] }\n  inverted: boolean\n  themeOptions: ThemeOptions\n  statusCallback?: (arg: string) => void\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  inverted: boolean\n}\n\nexport interface MultiRenderArgsDeserialized\n  extends RenderArgsDeserializedWithFeatures {\n  sources: Source[]\n}\n\nexport default abstract class WiggleBaseRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const {\n      inverted,\n      height,\n      regions,\n      bpPerPx,\n      statusCallback = () => {},\n    } = renderProps\n\n    const region = regions[0]!\n    const width = (region.end - region.start) / bpPerPx\n\n    const { reducedFeatures, ...rest } = await updateStatus(\n      'Rendering plot',\n      statusCallback,\n      () =>\n        renderToAbstractCanvas(\n          width,\n          height,\n          renderProps,\n          ctx =>\n            this.draw(ctx, {\n              ...renderProps,\n              features,\n              inverted,\n            }) as Promise<{ reducedFeatures: Feature[] | undefined }>,\n        ),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...rest,\n      features,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...rest,\n      features: reducedFeatures\n        ? new Map<string, Feature>(reducedFeatures.map(r => [r.id(), r]))\n        : results.features,\n      height,\n      width,\n      containsNoTransferables: true,\n    }\n  }\n\n  /**\n   * draw features to context given props, to be used by derived renderer\n   * classes\n   */\n  abstract draw<T extends RenderArgsDeserializedWithFeatures>(\n    ctx: CanvasRenderingContext2D,\n    props: T,\n  ): Promise<Record<string, unknown> | undefined>\n}\n\nexport type {\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsDeserialized,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\n","import WiggleBaseRenderer from '../WiggleBaseRenderer'\n\nimport type { RenderArgsDeserializedWithFeatures } from '../WiggleBaseRenderer'\n\nexport default class DensityRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { drawDensity } = await import('../drawDensity')\n    return drawDensity(ctx, props)\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config WiggleRenderer\n * this is the \"base wiggle renderer config schema\"\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst WiggleRenderer = ConfigurationSchema(\n  'WiggleRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of track, overrides posColor and negColor',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    posColor: {\n      type: 'color',\n      description: 'the color to use when the score is positive',\n      defaultValue: 'blue',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    negColor: {\n      type: 'color',\n      description: 'the color to use when the score is negative',\n      defaultValue: 'red',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    bicolorPivot: {\n      type: 'stringEnum',\n      model: types.enumeration('Scale type', [\n        'numeric',\n        'mean',\n        'z_score',\n        'none',\n      ]),\n      description: 'type of bicolor pivot',\n      defaultValue: 'numeric',\n    },\n    /**\n     * #slot\n     */\n    bicolorPivotValue: {\n      type: 'number',\n      defaultValue: 0,\n      description: 'value to use for bicolor pivot',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default WiggleRenderer\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config DensityRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'DensityRenderer',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { useRef } from 'react'\n\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Region } from '@jbrowse/core/util/types'\n\nconst WiggleRendering = observer(function (props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  blockKey: string\n  onMouseLeave?: (event: React.MouseEvent) => void\n  onMouseMove?: (event: React.MouseEvent, arg?: string) => void\n  onFeatureClick?: (event: React.MouseEvent, arg?: string) => void\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    onMouseLeave,\n    onMouseMove,\n    onFeatureClick,\n  } = props\n  const region = regions[0]!\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number) {\n    // calculates feature under mouse\n    let offset = 0\n    if (ref.current) {\n      offset = ref.current.getBoundingClientRect().left\n    }\n    const offsetX = eventClientX - offset\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n    let featureUnderMouse: Feature | undefined\n    for (const feature of features.values()) {\n      // bpPerPx added to the end to accommodate \"reduced features\" (one feature per px)\n      if (\n        clientBp <= feature.get('end') + bpPerPx &&\n        clientBp >= feature.get('start')\n      ) {\n        featureUnderMouse = feature\n        break\n      }\n    }\n    return featureUnderMouse\n  }\n  return (\n    <div\n      ref={ref}\n      data-testid=\"wiggle-rendering-test\"\n      onMouseMove={e => onMouseMove?.(e, getFeatureUnderMouse(e.clientX)?.id())}\n      onClick={e => onFeatureClick?.(e, getFeatureUnderMouse(e.clientX)?.id())}\n      onMouseLeave={e => onMouseLeave?.(e)}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n})\n\nexport default WiggleRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config LinePlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'LinePlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { readConfObject } from '@jbrowse/core/configuration'\n\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\n\nimport type { RenderArgsDeserializedWithFeatures } from '../WiggleBaseRenderer'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class LinePlotRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { config } = props\n    const c = readConfObject(config, 'color')\n    const { drawLine } = await import('../drawLine')\n\n    return drawLine(ctx, {\n      ...props,\n      offset: YSCALEBAR_LABEL_OFFSET,\n      colorCallback:\n        c === '#f0f'\n          ? () => 'grey'\n          : (feature: Feature) => readConfObject(config, 'color', { feature }),\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config SharedWiggleDisplay\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport default function sharedWiggleConfigFactory() {\n  return ConfigurationSchema(\n    'SharedWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n\n      /**\n       * #slot\n       */\n      minimalTicks: {\n        type: 'boolean',\n        defaultValue: false,\n        description: 'use the minimal amount of ticks',\n      },\n\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n\n      /**\n       * #slot\n       */\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport {\n  ConfigurationReference,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getEnv, getSession, isSelectionContainer } from '@jbrowse/core/util'\nimport { stopStopToken } from '@jbrowse/core/util/stopToken'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport { getNiceDomain } from '../util'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\n// lazies\nconst SetMinMaxDialog = lazy(() => import('./SetMinMaxDialog'))\n\n/**\n * #stateModel SharedWiggleMixin\n */\nexport default function SharedWiggleMixin(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        selectedRendering: types.optional(types.string, ''),\n        /**\n         * #property\n         */\n        resolution: types.optional(types.number, 1),\n        /**\n         * #property\n         */\n        fill: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        minSize: types.maybe(types.number),\n        /**\n         * #property\n         */\n        color: types.maybe(types.string),\n        /**\n         * #property\n         */\n        posColor: types.maybe(types.string),\n        /**\n         * #property\n         */\n        negColor: types.maybe(types.string),\n        /**\n         * #property\n         */\n        summaryScoreMode: types.maybe(types.string),\n        /**\n         * #property\n         */\n        rendererTypeNameState: types.maybe(types.string),\n        /**\n         * #property\n         */\n        scale: types.maybe(types.string),\n        /**\n         * #property\n         */\n        autoscale: types.maybe(types.string),\n        /**\n         * #property\n         */\n        displayCrossHatches: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        constraints: types.optional(\n          types.model({\n            max: types.maybe(types.number),\n            min: types.maybe(types.number),\n          }),\n          {},\n        ),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      message: undefined as undefined | string,\n      /**\n       * #volatile\n       */\n      stats: undefined as\n        | { currStatsBpPerPx: number; scoreMin: number; scoreMax: number }\n        | undefined,\n      /**\n       * #volatile\n       */\n      statsFetchInProgress: undefined as undefined | string,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      updateQuantitativeStats(stats: {\n        currStatsBpPerPx: number\n        scoreMin: number\n        scoreMax: number\n      }) {\n        const { currStatsBpPerPx, scoreMin, scoreMax } = stats\n        const EPSILON = 0.000001\n        if (\n          !self.stats ||\n          Math.abs(self.stats.scoreMax - scoreMax) > EPSILON ||\n          Math.abs(self.stats.scoreMin - scoreMin) > EPSILON\n        ) {\n          self.stats = {\n            currStatsBpPerPx,\n            scoreMin,\n            scoreMax,\n          }\n        }\n      },\n      /**\n       * #action\n       */\n      setColor(color?: string) {\n        self.color = color\n      },\n      /**\n       * #action\n       */\n      setPosColor(color?: string) {\n        self.posColor = color\n      },\n      /**\n       * #action\n       */\n      setNegColor(color?: string) {\n        self.negColor = color\n      },\n\n      /**\n       * #action\n       */\n      setStatsLoading(arg?: string) {\n        if (self.statsFetchInProgress) {\n          stopStopToken(self.statsFetchInProgress)\n        }\n        self.statsFetchInProgress = arg\n      },\n\n      /**\n       * #action\n       * this overrides the BaseLinearDisplayModel to avoid popping up a\n       * feature detail display, but still sets the feature selection on the\n       * model so listeners can detect a click\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n\n      /**\n       * #action\n       */\n      setResolution(res: number) {\n        self.resolution = res\n      },\n\n      /**\n       * #action\n       */\n      setFill(fill: number) {\n        if (fill === 0) {\n          self.fill = true\n          self.minSize = 0\n        } else if (fill === 1) {\n          self.fill = false\n          self.minSize = 1\n        } else if (fill === 2) {\n          self.fill = false\n          self.minSize = 2\n        }\n      },\n\n      /**\n       * #action\n       */\n      toggleLogScale() {\n        self.scale = self.scale === 'log' ? 'linear' : 'log'\n      },\n\n      /**\n       * #action\n       */\n      setScaleType(scale?: string) {\n        self.scale = scale\n      },\n\n      /**\n       * #action\n       */\n      setSummaryScoreMode(val: string) {\n        self.summaryScoreMode = val\n      },\n\n      /**\n       * #action\n       */\n      setAutoscale(val: string) {\n        self.autoscale = val\n      },\n\n      /**\n       * #action\n       */\n      setMaxScore(val?: number) {\n        self.constraints.max = val\n      },\n\n      /**\n       * #action\n       */\n      setRendererType(val: string) {\n        self.rendererTypeNameState = val\n      },\n\n      /**\n       * #action\n       */\n      setMinScore(val?: number) {\n        self.constraints.min = val\n      },\n\n      /**\n       * #action\n       */\n      toggleCrossHatches() {\n        self.displayCrossHatches = !self.displayCrossHatches\n      },\n\n      /**\n       * #action\n       */\n      setCrossHatches(cross: boolean) {\n        self.displayCrossHatches = cross\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get adapterTypeName() {\n        return self.adapterConfig.type\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeNameSimple() {\n        return (\n          self.rendererTypeNameState ??\n          (getConf(self, 'defaultRendering') as string)\n        )\n      },\n\n      /**\n       * #getter\n       * subclasses can define these, as snpcoverage track does\n       */\n      get filters() {\n        return undefined\n      },\n\n      /**\n       * #getter\n       */\n      get scaleType() {\n        return self.scale ?? (getConf(self, 'scaleType') as string)\n      },\n\n      /**\n       * #getter\n       */\n      get maxScore() {\n        return self.constraints.max ?? (getConf(self, 'maxScore') as number)\n      },\n\n      /**\n       * #getter\n       */\n      get minScore() {\n        return self.constraints.min ?? (getConf(self, 'minScore') as number)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get adapterCapabilities() {\n        const type = self.adapterTypeName\n        const { pluginManager } = getEnv(self)\n        return pluginManager.getAdapterType(type)!.adapterCapabilities\n      },\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const {\n          color,\n          displayCrossHatches,\n          fill,\n          minSize,\n          negColor,\n          posColor,\n          summaryScoreMode,\n          scaleType,\n          rendererTypeName,\n        } = self\n        const configBlob = getConf(self, ['renderers', rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(scaleType ? { scaleType } : {}),\n            ...(fill !== undefined ? { filled: fill } : {}),\n            ...(displayCrossHatches !== undefined\n              ? { displayCrossHatches }\n              : {}),\n            ...(summaryScoreMode !== undefined ? { summaryScoreMode } : {}),\n            ...(color !== undefined ? { color } : {}),\n            ...(negColor !== undefined ? { negColor } : {}),\n            ...(posColor !== undefined ? { posColor } : {}),\n            ...(minSize !== undefined ? { minSize } : {}),\n          },\n          getEnv(self),\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get autoscaleType() {\n        return self.autoscale ?? (getConf(self, 'autoscale') as string)\n      },\n    }))\n    .views(self => {\n      let oldDomain: [number, number] = [0, 0]\n      return {\n        /**\n         * #getter\n         */\n        get domain() {\n          const { stats, scaleType, minScore, maxScore } = self\n          if (!stats) {\n            return undefined\n          }\n\n          const ret = getNiceDomain({\n            domain: [stats.scoreMin, stats.scoreMax],\n            bounds: [minScore, maxScore],\n            scaleType,\n          })\n\n          // avoid weird scalebar if log value and empty region displayed\n          if (scaleType === 'log' && ret[1] === Number.MIN_VALUE) {\n            return [0, Number.MIN_VALUE]\n          }\n\n          // avoid returning a new object if it matches the old value\n          if (JSON.stringify(oldDomain) !== JSON.stringify(ret)) {\n            oldDomain = ret\n          }\n\n          return oldDomain\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get filled() {\n        return (\n          self.fill ??\n          (readConfObject(self.rendererConfig, 'filled') as boolean)\n        )\n      },\n      /**\n       * #getter\n       */\n      get summaryScoreModeSetting() {\n        return (\n          self.summaryScoreMode ??\n          (readConfObject(self.rendererConfig, 'summaryScoreMode') as string)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get scaleOpts() {\n        return {\n          domain: self.domain,\n          stats: self.stats,\n          autoscaleType: self.autoscaleType,\n          scaleType: self.scaleType,\n          inverted: getConf(self, 'inverted') as boolean,\n        }\n      },\n\n      /**\n       * #getter\n       */\n      get canHaveFill() {\n        return self.rendererTypeName === 'XYPlotRenderer'\n      },\n\n      /**\n       * #getter\n       */\n      get displayCrossHatchesSetting() {\n        return (\n          self.displayCrossHatches ??\n          (readConfObject(\n            self.rendererConfig,\n            'displayCrossHatches',\n          ) as boolean)\n        )\n      },\n      /**\n       * #getter\n       */\n      get hasResolution() {\n        return self.adapterCapabilities.includes('hasResolution')\n      },\n\n      /**\n       * #getter\n       */\n      get hasGlobalStats() {\n        return self.adapterCapabilities.includes('hasGlobalStats')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      scoreTrackMenuItems() {\n        return [\n          ...(self.hasResolution\n            ? [\n                {\n                  label: 'Resolution',\n                  subMenu: [\n                    {\n                      label: 'Finer resolution',\n                      onClick: () => {\n                        self.setResolution(self.resolution * 5)\n                      },\n                    },\n                    {\n                      label: 'Coarser resolution',\n                      onClick: () => {\n                        self.setResolution(self.resolution / 5)\n                      },\n                    },\n                  ],\n                },\n                {\n                  label: 'Summary score mode',\n                  subMenu: ['min', 'max', 'avg', 'whiskers'].map(elt => ({\n                    label: elt,\n                    type: 'radio',\n                    checked: self.summaryScoreModeSetting === elt,\n                    onClick: () => {\n                      self.setSummaryScoreMode(elt)\n                    },\n                  })),\n                },\n              ]\n            : []),\n          {\n            label:\n              self.scaleType === 'log' ? 'Set linear scale' : 'Set log scale',\n            onClick: () => {\n              self.toggleLogScale()\n            },\n          },\n          {\n            label: 'Autoscale type',\n            subMenu: [\n              ['local', 'Local'],\n              ...(self.hasGlobalStats\n                ? ([\n                    ['global', 'Global'],\n                    ['globalsd', 'Global ± 3σ'],\n                  ] as const)\n                : []),\n              ['localsd', 'Local ± 3σ'],\n            ].map(([val, label]) => ({\n              label,\n              type: 'radio',\n              checked: self.autoscaleType === val,\n              onClick: () => {\n                self.setAutoscale(val)\n              },\n            })),\n          },\n          {\n            label: 'Set min/max score',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                SetMinMaxDialog,\n                {\n                  model: self,\n                  handleClose,\n                },\n              ])\n            },\n          },\n        ]\n      },\n    }))\n    .actions(self => {\n      const { reload: superReload } = self\n      return {\n        /**\n         * #action\n         */\n        async reload() {\n          self.setError()\n          superReload()\n        },\n      }\n    })\n}\n","import { lazy } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\nimport EqualizerIcon from '@mui/icons-material/Equalizer'\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport { types } from 'mobx-state-tree'\nimport { axisPropsFromTickScale } from 'react-d3-axis-mod'\n\nimport SharedWiggleMixin from '../shared/SharedWiggleMixin'\nimport { YSCALEBAR_LABEL_OFFSET, getScale } from '../util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { AnyReactComponentType } from '@jbrowse/core/util'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst Tooltip = lazy(() => import('./components/Tooltip'))\nconst SetColorDialog = lazy(() => import('./components/SetColorDialog'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'XYPlotRenderer'],\n  ['density', 'DensityRenderer'],\n  ['line', 'LinePlotRenderer'],\n])\n\n/**\n * #stateModel LinearWiggleDisplay\n * extends\n * - [SharedWiggleMixin](../sharedwigglemixin)\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearWiggleDisplay',\n      SharedWiggleMixin(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearWiggleDisplay'),\n        /**\n         * #property\n         */\n        invertedSetting: types.maybe(types.boolean),\n      }),\n    )\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setInverted(arg: boolean) {\n        self.invertedSetting = arg\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get TooltipComponent() {\n        return Tooltip as AnyReactComponentType\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        const name = self.rendererTypeNameSimple\n        const rendererType = rendererTypes.get(name)\n        if (!rendererType) {\n          throw new Error(`unknown renderer ${name}`)\n        }\n        return rendererType\n      },\n      /**\n       * #getter\n       * unused currently\n       */\n      get quantitativeStatsRelevantToCurrentZoom() {\n        const view = getContainingView(self) as LinearGenomeViewModel\n        return self.stats?.currStatsBpPerPx === view.bpPerPx\n      },\n\n      /**\n       * #getter\n       */\n      get graphType() {\n        return (\n          self.rendererTypeName === 'XYPlotRenderer' ||\n          self.rendererTypeName === 'LinePlotRenderer'\n        )\n      },\n      /**\n       * #getter\n       */\n      get inverted() {\n        return self.invertedSetting ?? (getConf(self, 'inverted') as boolean)\n      },\n    }))\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        adapterProps() {\n          const superProps = superRenderProps()\n          const { filters, resolution, scaleOpts } = self\n          return {\n            ...superProps,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            config: self.rendererConfig,\n            displayCrossHatches: self.displayCrossHatchesSetting,\n            scaleOpts,\n            resolution,\n            filters,\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get ticks() {\n          const { inverted, scaleType, domain, height } = self\n          const minimalTicks = getConf(self, 'minimalTicks')\n          if (domain) {\n            const ticks = axisPropsFromTickScale(\n              getScale({\n                scaleType,\n                domain,\n                range: [\n                  height - YSCALEBAR_LABEL_OFFSET,\n                  YSCALEBAR_LABEL_OFFSET,\n                ],\n                inverted,\n              }),\n              4,\n            )\n            return height < 100 || minimalTicks\n              ? { ...ticks, values: domain }\n              : ticks\n          } else {\n            return undefined\n          }\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #method\n       */\n      renderProps() {\n        const { inverted, ticks, height } = self\n        const superProps = self.adapterProps()\n        return {\n          ...self.adapterProps(),\n          notReady: superProps.notReady || !self.stats,\n          height,\n          ticks,\n          inverted,\n        }\n      },\n\n      /**\n       * #getter\n       */\n      get fillSetting() {\n        if (self.filled) {\n          return 0\n        } else if (self.minSize === 1) {\n          return 1\n        } else {\n          return 2\n        }\n      },\n      /**\n       * #getter\n       */\n      get quantitativeStatsReady() {\n        const view = getContainingView(self) as LinearGenomeViewModel\n        return (\n          view.initialized && self.statsReadyAndRegionNotTooLarge && !self.error\n        )\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      const hasRenderings = getConf(self, 'defaultRendering')\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Score',\n              icon: EqualizerIcon,\n              subMenu: self.scoreTrackMenuItems(),\n            },\n            ...(self.graphType\n              ? [\n                  {\n                    label: 'Inverted',\n                    type: 'checkbox',\n                    checked: self.inverted,\n                    onClick: () => {\n                      self.setInverted(!self.inverted)\n                    },\n                  },\n                ]\n              : []),\n\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: 'Fill mode',\n                    subMenu: ['filled', 'no fill', 'no fill w/ emphasis'].map(\n                      (elt, idx) => ({\n                        label: elt,\n                        type: 'radio',\n                        checked: self.fillSetting === idx,\n                        onClick: () => {\n                          self.setFill(idx)\n                        },\n                      }),\n                    ),\n                  },\n                ]\n              : []),\n\n            ...(hasRenderings\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: ['xyplot', 'density', 'line'].map(key => ({\n                      label: key,\n                      type: 'radio',\n                      checked: self.rendererTypeNameSimple === key,\n                      onClick: () => {\n                        self.setRendererType(key)\n                      },\n                    })),\n                  },\n                ]\n              : []),\n\n            {\n              label: 'Color',\n              icon: PaletteIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetColorDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n\n            ...(self.graphType\n              ? [\n                  {\n                    type: 'checkbox',\n                    icon: VisibilityIcon,\n                    label: 'Show cross hatches',\n                    checked: self.displayCrossHatchesSetting,\n                    onClick: () => {\n                      self.toggleCrossHatches()\n                    },\n                  },\n                ]\n              : []),\n          ]\n        },\n      }\n    })\n    .actions(self => {\n      const { renderSvg: superRenderSvg } = self\n\n      return {\n        afterAttach() {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          ;(async () => {\n            const { getQuantitativeStatsAutorun } = await import(\n              '../getQuantitativeStatsAutorun'\n            )\n            getQuantitativeStatsAutorun(self)\n          })()\n        },\n        /**\n         * #action\n         */\n        async renderSvg(opts: ExportSvgDisplayOptions) {\n          const { renderSvg } = await import('./renderSvg')\n          return renderSvg(self, opts, superRenderSvg)\n        },\n      }\n    })\n}\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiDensityRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiDensityRenderer',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { useRef } from 'react'\n\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { SimpleFeature } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { Source } from './util'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Region } from '@jbrowse/core/util/types'\n\nconst MultiWiggleRendering = observer(function (props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  blockKey: string\n  sources: Source[]\n  displayModel?: { isMultiRow: boolean }\n  onMouseLeave?: (event: React.MouseEvent) => void\n  onMouseMove?: (event: React.MouseEvent, arg?: Feature) => void\n  onFeatureClick?: (event: React.MouseEvent, arg?: Feature) => void\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    sources,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n    onFeatureClick = () => {},\n    displayModel,\n  } = props\n  const region = regions[0]!\n  const ref = useRef<HTMLDivElement>(null)\n  const { isMultiRow } = displayModel || {}\n\n  function getFeatureUnderMouse(eventClientX: number, eventClientY: number) {\n    if (!ref.current) {\n      return\n    }\n    const rect = ref.current.getBoundingClientRect()\n    const offsetX = eventClientX - rect.left\n    const offsetY = eventClientY - rect.top\n    const source = sources[Math.floor((offsetY / height) * sources.length)]\n    if (!source) {\n      return\n    }\n    const px = region.reversed ? width - offsetX : offsetX\n    const mouseoverBp = region.start + bpPerPx * px\n    let featureUnderMouse: Feature | undefined\n    if (isMultiRow) {\n      for (const feature of features.values()) {\n        if (feature.get('source') !== source.name) {\n          continue\n        }\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featureUnderMouse = feature\n          break\n        }\n      }\n    } else {\n      const featuresUnderMouse = []\n      for (const feature of features.values()) {\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featuresUnderMouse.push(feature)\n        }\n      }\n\n      if (featuresUnderMouse.length) {\n        const pos = Math.floor(mouseoverBp)\n        featureUnderMouse = new SimpleFeature({\n          uniqueId: 'mouseoverfeat',\n          sources: Object.fromEntries(\n            featuresUnderMouse\n              .map(f => f.toJSON())\n              .map(f => {\n                const { refName, start, end, source, ...rest } = f\n                return [source, rest]\n              }),\n          ),\n          ...region,\n          start: pos,\n          end: pos + 1,\n        })\n      }\n    }\n    return featureUnderMouse\n  }\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={event => {\n        const { clientX, clientY } = event\n        const featureUnderMouse = getFeatureUnderMouse(clientX, clientY)\n        onMouseMove(event, featureUnderMouse)\n      }}\n      onClick={event => {\n        const { clientX, clientY } = event\n        const featureUnderMouse = getFeatureUnderMouse(clientX, clientY)\n        onFeatureClick(event, featureUnderMouse)\n      }}\n      onMouseLeave={event => {\n        onMouseLeave(event)\n      }}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n})\n\nexport default MultiWiggleRendering\n","import { forEachWithStopTokenCheck, groupBy } from '@jbrowse/core/util'\n\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\n\nimport type { MultiRenderArgsDeserialized as MultiArgs } from '../WiggleBaseRenderer'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class MultiDensityPlotRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { stopToken, sources, features } = props\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const height = props.height / sources.length\n    let feats = [] as Feature[]\n    const { drawDensity } = await import('../drawDensity')\n    ctx.save()\n    forEachWithStopTokenCheck(sources, stopToken, source => {\n      const features = groups[source.name] || []\n      const { reducedFeatures } = drawDensity(ctx, {\n        ...props,\n        features,\n        height,\n      })\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return {\n      reducedFeatures: feats,\n    }\n  }\n}\n","import { forEachWithStopTokenCheck, groupBy } from '@jbrowse/core/util'\n\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\n\nimport type { MultiRenderArgsDeserialized as MultiArgs } from '../WiggleBaseRenderer'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class MultiLineRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { stopToken, sources, features } = props\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const { drawLine } = await import('../drawLine')\n    let feats = [] as Feature[]\n    forEachWithStopTokenCheck(sources, stopToken, source => {\n      const { reducedFeatures } = drawLine(ctx, {\n        ...props,\n        features: groups[source.name] || [],\n        colorCallback: () => source.color || 'blue',\n      })\n      feats = feats.concat(reducedFeatures)\n    })\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n/**\n * #config MultiLineRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiLineRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default configSchema\n","import { lazy } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { set1 as colors } from '@jbrowse/core/ui/colors'\nimport {\n  getContainingView,\n  getSession,\n  max,\n  measureText,\n} from '@jbrowse/core/util'\nimport { stopStopToken } from '@jbrowse/core/util/stopToken'\nimport deepEqual from 'fast-deep-equal'\nimport { isAlive, types } from 'mobx-state-tree'\nimport { axisPropsFromTickScale } from 'react-d3-axis-mod'\n\nimport SharedWiggleMixin from '../shared/SharedWiggleMixin'\nimport { YSCALEBAR_LABEL_OFFSET, getScale } from '../util'\n\nimport type { Source } from '../util'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { AnyReactComponentType, Feature } from '@jbrowse/core/util'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance } from 'mobx-state-tree'\n\nconst randomColor = () =>\n  '#000000'.replaceAll('0', () => (~~(Math.random() * 16)).toString(16))\n\n// lazies\nconst Tooltip = lazy(() => import('./components/Tooltip'))\nconst SetColorDialog = lazy(() => import('./components/SetColorDialog'))\nconst WiggleClusterDialog = lazy(\n  () => import('./components/WiggleClusterDialog/WiggleClusterDialog'),\n)\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'MultiXYPlotRenderer'],\n  ['multirowxy', 'MultiRowXYPlotRenderer'],\n  ['multirowdensity', 'MultiDensityRenderer'],\n  ['multiline', 'MultiLineRenderer'],\n  ['multirowline', 'MultiRowLineRenderer'],\n])\n\n/**\n * #stateModel MultiLinearWiggleDisplay\n * extends\n * - [SharedWiggleMixin](../sharedwigglemixin)\n */\nexport function stateModelFactory(\n  _pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'MultiLinearWiggleDisplay',\n      SharedWiggleMixin(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('MultiLinearWiggleDisplay'),\n\n        /**\n         * #property\n         */\n        layout: types.optional(types.frozen<Source[]>(), []),\n        /**\n         * #property\n         */\n        showSidebar: true,\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      sourcesLoadingStopToken: undefined as string | undefined,\n      /**\n       * #volatile\n       */\n      featureUnderMouseVolatile: undefined as Feature | undefined,\n      /**\n       * #volatile\n       */\n      sourcesVolatile: undefined as Source[] | undefined,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setShowSidebar(arg: boolean) {\n        self.showSidebar = arg\n      },\n      /**\n       * #action\n       */\n      setSourcesLoading(str: string) {\n        if (self.sourcesLoadingStopToken) {\n          stopStopToken(self.sourcesLoadingStopToken)\n        }\n        self.sourcesLoadingStopToken = str\n      },\n      /**\n       * #action\n       */\n      setLayout(layout: Source[]) {\n        self.layout = layout\n      },\n      /**\n       * #action\n       */\n      clearLayout() {\n        self.layout = []\n      },\n\n      /**\n       * #action\n       */\n      setSources(sources: Source[]) {\n        if (!deepEqual(sources, self.sourcesVolatile)) {\n          self.sourcesVolatile = sources\n        }\n      },\n\n      /**\n       * #action\n       */\n      setFeatureUnderMouse(f?: Feature) {\n        self.featureUnderMouseVolatile = f\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        return self.featureUnderMouseVolatile\n      },\n      /**\n       * #getter\n       */\n      get TooltipComponent() {\n        return Tooltip as AnyReactComponentType\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        const name = self.rendererTypeNameSimple\n        const rendererType = rendererTypes.get(name)\n        if (!rendererType) {\n          throw new Error(`unknown renderer ${name}`)\n        }\n        return rendererType\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get graphType() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiLineRenderer' ||\n          self.rendererTypeName === 'MultiRowLineRenderer'\n        )\n      },\n      /**\n       * #getter\n       */\n      get needsFullHeightScalebar() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiLineRenderer'\n        )\n      },\n      /**\n       * #getter\n       */\n      get isMultiRow() {\n        return (\n          self.rendererTypeName === 'MultiRowXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowLineRenderer' ||\n          self.rendererTypeName === 'MultiDensityRenderer'\n        )\n      },\n      /**\n       * #getter\n       * can be used to give it a \"color scale\" like a R heatmap, not\n       * implemented like this yet but flag can be used for this\n       */\n      get needsCustomLegend() {\n        return self.rendererTypeName === 'MultiDensityRenderer'\n      },\n\n      /**\n       * #getter\n       */\n      get canHaveFill() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer'\n        )\n      },\n      /**\n       * #getter\n       * the multirowxy and multiline don't need to use colors on the legend\n       * boxes since their track is drawn with the color. sort of a stylistic\n       * choice\n       */\n      get renderColorBoxes() {\n        return !(\n          self.rendererTypeName === 'MultiRowLineRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer'\n        )\n      },\n      /**\n       * #getter\n       * positions multi-row below the tracklabel even if using overlap\n       * tracklabels for everything else\n       */\n      get prefersOffset() {\n        return this.isMultiRow\n      },\n\n      /**\n       * #getter\n       */\n      get sourcesWithoutLayout() {\n        const sources = Object.fromEntries(\n          self.sourcesVolatile?.map(s => [s.name, s]) || [],\n        )\n        const iter = self.sourcesVolatile\n        return iter\n          ?.map(s => ({\n            ...sources[s.name],\n            ...s,\n          }))\n          .map((s, i) => ({\n            ...s,\n            color:\n              s.color ||\n              (!this.isMultiRow ? colors[i] || randomColor() : 'blue'),\n          }))\n      },\n\n      /**\n       * #getter\n       */\n      get sources() {\n        const sources = Object.fromEntries(\n          self.sourcesVolatile?.map(s => [s.name, s]) || [],\n        )\n        const iter = self.layout.length ? self.layout : self.sourcesVolatile\n        return iter\n          ?.map(s => ({\n            ...sources[s.name],\n            ...s,\n          }))\n          .map((s, i) => ({\n            ...s,\n            color:\n              s.color ||\n              (!this.isMultiRow ? colors[i] || randomColor() : 'blue'),\n          }))\n      },\n      /**\n       * #getter\n       */\n      get quantitativeStatsReady() {\n        const view = getContainingView(self) as LinearGenomeViewModel\n        return (\n          view.initialized && self.statsReadyAndRegionNotTooLarge && !self.error\n        )\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rowHeight() {\n        const { sources, height, isMultiRow } = self\n        return isMultiRow ? height / (sources?.length || 1) : height\n      },\n      /**\n       * #getter\n       */\n      get rowHeightTooSmallForScalebar() {\n        return this.rowHeight < 70\n      },\n\n      /**\n       * #getter\n       */\n      get useMinimalTicks() {\n        return (\n          (getConf(self, 'minimalTicks') as boolean) ||\n          this.rowHeightTooSmallForScalebar\n        )\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        adapterProps() {\n          const superProps = superRenderProps()\n          return {\n            ...superProps,\n            displayModel: self,\n            config: self.rendererConfig,\n            filters: self.filters,\n            resolution: self.resolution,\n            rpcDriverName: self.rpcDriverName,\n            sources: self.sources,\n          }\n        },\n        /**\n         * #getter\n         */\n        get ticks() {\n          const { scaleType, domain, isMultiRow, rowHeight, useMinimalTicks } =\n            self\n\n          if (!domain) {\n            return undefined\n          }\n\n          const offset = isMultiRow ? 0 : YSCALEBAR_LABEL_OFFSET\n          const ticks = axisPropsFromTickScale(\n            getScale({\n              scaleType,\n              domain,\n              range: [rowHeight - offset, offset],\n              inverted: getConf(self, 'inverted') as boolean,\n            }),\n            4,\n          )\n          return useMinimalTicks ? { ...ticks, values: domain } : ticks\n        },\n\n        /**\n         * #getter\n         */\n        get colors() {\n          return [\n            'red',\n            'blue',\n            'green',\n            'orange',\n            'purple',\n            'cyan',\n            'pink',\n            'darkblue',\n            'darkred',\n            'pink',\n          ]\n        },\n        /**\n         * #getter\n         * unused currently\n         */\n        get quantitativeStatsRelevantToCurrentZoom() {\n          const view = getContainingView(self) as LinearGenomeViewModel\n          return self.stats?.currStatsBpPerPx === view.bpPerPx\n        },\n      }\n    })\n    .views(self => ({\n      get legendFontSize() {\n        return Math.min(self.rowHeight, 12)\n      },\n\n      get canDisplayLegendLabels() {\n        return self.rowHeight > 11\n      },\n\n      get labelWidth() {\n        const minWidth = 20\n        return max(\n          self.sources\n            ?.map(s => measureText(s.name, this.legendFontSize))\n            .map(width => (this.canDisplayLegendLabels ? width : minWidth)) ||\n            [],\n        )\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        const superProps = self.adapterProps()\n        return {\n          ...superProps,\n          notReady: superProps.notReady || !self.sources || !self.stats,\n          displayModel: self,\n          rpcDriverName: self.rpcDriverName,\n          displayCrossHatches: self.displayCrossHatches,\n          height: self.height,\n          ticks: self.ticks,\n          stats: self.stats,\n          scaleOpts: self.scaleOpts,\n          onMouseMove: (_: unknown, f: Feature) => {\n            self.setFeatureUnderMouse(f)\n          },\n          onMouseLeave: () => {\n            self.setFeatureUnderMouse(undefined)\n          },\n        }\n      },\n\n      /**\n       * #getter\n       */\n      get hasResolution() {\n        return self.adapterCapabilities.includes('hasResolution')\n      },\n\n      /**\n       * #getter\n       */\n      get hasGlobalStats() {\n        return self.adapterCapabilities.includes('hasGlobalStats')\n      },\n\n      /**\n       * #getter\n       */\n      get fillSetting() {\n        if (self.filled) {\n          return 0\n        } else if (self.minSize === 1) {\n          return 1\n        } else {\n          return 2\n        }\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      const hasRenderings = getConf(self, 'defaultRendering')\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Score',\n              subMenu: self.scoreTrackMenuItems(),\n            },\n\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: 'Fill mode',\n                    subMenu: ['filled', 'no fill', 'no fill w/ emphasis'].map(\n                      (elt, idx) => ({\n                        label: elt,\n                        type: 'radio',\n                        checked: self.fillSetting === idx,\n                        onClick: () => {\n                          self.setFill(idx)\n                        },\n                      }),\n                    ),\n                  },\n                ]\n              : []),\n\n            ...(hasRenderings\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: [\n                      'xyplot',\n                      'multirowxy',\n                      'multirowdensity',\n                      'multiline',\n                      'multirowline',\n                    ].map(key => ({\n                      label: key,\n                      type: 'radio',\n                      checked: self.rendererTypeNameSimple === key,\n                      onClick: () => {\n                        self.setRendererType(key)\n                      },\n                    })),\n                  },\n                ]\n              : []),\n            ...(self.graphType\n              ? [\n                  {\n                    type: 'checkbox',\n                    label: 'Draw cross hatches',\n                    checked: self.displayCrossHatchesSetting,\n                    onClick: () => {\n                      self.toggleCrossHatches()\n                    },\n                  },\n                ]\n              : []),\n            {\n              label: 'Cluster by score',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  WiggleClusterDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n            {\n              label: 'Show sidebar',\n              type: 'checkbox',\n              checked: self.showSidebar,\n              onClick: () => {\n                self.setShowSidebar(!self.showSidebar)\n              },\n            },\n            {\n              label: 'Edit colors/arrangement...',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetColorDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => {\n      const { renderSvg: superRenderSvg } = self\n      return {\n        afterAttach() {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          ;(async () => {\n            try {\n              const [\n                { getMultiWiggleSourcesAutorun },\n                { getQuantitativeStatsAutorun },\n              ] = await Promise.all([\n                import('../getMultiWiggleSourcesAutorun'),\n                import('../getQuantitativeStatsAutorun'),\n              ])\n              getQuantitativeStatsAutorun(self)\n              getMultiWiggleSourcesAutorun(self)\n            } catch (e) {\n              if (isAlive(self)) {\n                console.error(e)\n                getSession(self).notifyError(`${e}`, e)\n              }\n            }\n          })()\n        },\n\n        /**\n         * #action\n         */\n        async renderSvg(opts: ExportSvgDisplayOptions) {\n          const { renderSvg } = await import('./renderSvg')\n          return renderSvg(self, opts, superRenderSvg)\n        },\n      }\n    })\n}\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import { forEachWithStopTokenCheck, groupBy } from '@jbrowse/core/util'\n\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\n\nimport type { MultiRenderArgsDeserialized as MultiArgs } from '../WiggleBaseRenderer'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class MultiRowLineRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { stopToken, bpPerPx, sources, regions, features } = props\n    const region = regions[0]!\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const height = props.height / sources.length\n    const width = (region.end - region.start) / bpPerPx\n    const { drawLine } = await import('../drawLine')\n    let feats = [] as Feature[]\n    ctx.save()\n    forEachWithStopTokenCheck(sources, stopToken, source => {\n      const { reducedFeatures } = drawLine(ctx, {\n        ...props,\n        features: groups[source.name] || [],\n        height,\n        colorCallback: () => source.color || 'blue',\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiRowLineRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiRowLineRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { forEachWithStopTokenCheck, groupBy } from '@jbrowse/core/util'\n\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\n\nimport type { MultiRenderArgsDeserialized as MultiArgs } from '../WiggleBaseRenderer'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { stopToken, bpPerPx, sources, regions, features } = props\n    const region = regions[0]!\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const height = props.height / sources.length\n    const width = (region.end - region.start) / bpPerPx\n    const { drawXY } = await import('../drawXY')\n    let feats = [] as Feature[]\n    ctx.save()\n    forEachWithStopTokenCheck(sources, stopToken, source => {\n      const { reducedFeatures } = drawXY(ctx, {\n        ...props,\n        features: groups[source.name] || [],\n        height,\n        colorCallback: () => source.color || 'blue',\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiRowXYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiRowXYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0.7,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MultiWiggleAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MultiWiggleAdapter = ConfigurationSchema(\n  'MultiWiggleAdapter',\n  {\n    /**\n     * #slot\n     */\n    subadapters: {\n      type: 'frozen',\n      defaultValue: [],\n      description: 'array of subadapter JSON objects',\n    },\n    /**\n     * #slot\n     */\n    bigWigs: {\n      type: 'frozen',\n      description:\n        'array of bigwig filenames, alternative to the subadapters slot',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default MultiWiggleAdapter\n","import { forEachWithStopTokenCheck, groupBy } from '@jbrowse/core/util'\n\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\n\nimport type { MultiRenderArgsDeserialized as MultiArgs } from '../WiggleBaseRenderer'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { stopToken, sources, features } = props\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const { drawXY } = await import('../drawXY')\n    let feats = [] as Feature[]\n    forEachWithStopTokenCheck(sources, stopToken, source => {\n      const features = groups[source.name] || []\n      const { reducedFeatures } = drawXY(ctx, {\n        ...props,\n        features,\n        offset: YSCALEBAR_LABEL_OFFSET,\n        colorCallback: () => source.color || 'blue',\n      })\n      feats = feats.concat(reducedFeatures)\n    })\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiXYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiXYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0.7,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default configSchema\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Region } from '@jbrowse/core/util'\n\nexport class MultiWiggleGetSources extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'MultiWiggleGetSources'\n\n  async execute(\n    args: {\n      adapterConfig: AnyConfigurationModel\n      stopToken?: string\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-expect-error\n    return dataAdapter.getSources(regions, deserializedArgs)\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\n\nimport type { Region } from '@jbrowse/core/util'\n\nexport class WiggleGetMultiRegionQuantitativeStats extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'WiggleGetMultiRegionQuantitativeStats'\n\n  async execute(\n    args: {\n      adapterConfig: Record<string, unknown>\n      stopToken?: string\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-expect-error\n    return dataAdapter.getMultiRegionQuantitativeStats(\n      regions,\n      deserializedArgs,\n    )\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { QuantitativeStats } from '@jbrowse/core/util/stats'\n\nexport class WiggleGetGlobalQuantitativeStats extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'WiggleGetGlobalQuantitativeStats'\n\n  async execute(\n    args: {\n      adapterConfig: AnyConfigurationModel\n      stopToken?: string\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriverClassName: string,\n  ): Promise<QuantitativeStats> {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-expect-error\n    return dataAdapter.getGlobalStats(deserializedArgs)\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { groupBy } from '@jbrowse/core/util'\nimport { firstValueFrom, toArray } from 'rxjs'\n\nimport type { GetScoreMatrixArgs } from './types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nexport async function getScoreMatrix({\n  pluginManager,\n  args,\n}: {\n  args: GetScoreMatrixArgs\n  pluginManager: PluginManager\n}) {\n  const { sources, regions, adapterConfig, sessionId, bpPerPx } = args\n  const adapter = await getAdapter(pluginManager, sessionId, adapterConfig)\n  const dataAdapter = adapter.dataAdapter as BaseFeatureDataAdapter\n\n  const r0 = regions[0]!\n  const r0len = r0.end - r0.start\n  const w = Math.floor(r0len / bpPerPx)\n  const feats = await firstValueFrom(\n    dataAdapter.getFeatures(r0, args).pipe(toArray()),\n  )\n\n  const groups = groupBy(feats, f => f.get('source'))\n  const rows = {} as Record<string, number[]>\n\n  for (const source of sources) {\n    const { name } = source\n    const features = groups[name] || []\n\n    const arr = new Array(w).fill(0)\n    for (const feat of features) {\n      const fstart = feat.get('start')\n      const fend = feat.get('end')\n      const score = feat.get('score')\n      for (let i = fstart; i < fend; i += bpPerPx) {\n        const x = Math.floor((i - r0.start) / bpPerPx)\n        if (x >= 0 && x < w) {\n          arr[x] ||= score\n        }\n      }\n    }\n    rows[name] = arr\n  }\n\n  return rows\n}\n","import RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\n\nimport { getScoreMatrix } from './getScoreMatrix'\n\nimport type { GetScoreMatrixArgs } from './types'\n\nexport class MultiWiggleGetScoreMatrix extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'MultiWiggleGetScoreMatrix'\n\n  async execute(args: GetScoreMatrixArgs, rpcDriverClassName: string) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n\n    return getScoreMatrix({\n      args: deserializedArgs,\n      pluginManager: this.pluginManager,\n    })\n  }\n}\n","import RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\nimport { clusterData } from '@jbrowse/core/util/cluster'\n\nimport { getScoreMatrix } from './getScoreMatrix'\n\nimport type { GetScoreMatrixArgs } from './types'\n\nexport class MultiWiggleClusterScoreMatrix extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'MultiWiggleClusterScoreMatrix'\n\n  async execute(args: GetScoreMatrixArgs, rpcDriverClassName: string) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const matrix = await getScoreMatrix({\n      pluginManager: this.pluginManager,\n      args: deserializedArgs,\n    })\n    return clusterData({\n      data: Object.values(matrix),\n      stopToken: deserializedArgs.stopToken,\n      onProgress: a => {\n        deserializedArgs.statusCallback?.(a)\n      },\n    })\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\n\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\n\nimport type { RenderArgsDeserializedWithFeatures } from '../WiggleBaseRenderer'\n\nexport default class XYPlotRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { inverted, stopToken, features, config } = props\n    const { drawXY } = await import('../drawXY')\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n\n    return drawXY(ctx, {\n      ...props,\n      colorCallback: !config.color.isCallback\n        ? (_feature, score) => (score < pivotValue ? negColor : posColor)\n        : (feature, _score) => readConfObject(config, 'color', { feature }),\n      offset: YSCALEBAR_LABEL_OFFSET,\n      features: [...features.values()],\n      inverted,\n      stopToken,\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config XYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'XYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0.7,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport BigWigAdapterF from './BigWigAdapter'\nimport CreateMultiWiggleExtensionF from './CreateMultiWiggleExtension'\nimport DensityRendererF from './DensityRenderer'\nimport GuessAdapterF from './GuessAdapter'\nimport LinePlotRendererF from './LinePlotRenderer'\nimport LinearWiggleDisplayF, {\n  ReactComponent as LinearWiggleDisplayReactComponent,\n  modelFactory as linearWiggleDisplayModelFactory,\n} from './LinearWiggleDisplay'\nimport MultiDensityRendererF from './MultiDensityRenderer'\nimport MultiLineRendererF from './MultiLineRenderer'\nimport MultiLinearWiggleDisplayF from './MultiLinearWiggleDisplay'\nimport MultiQuantitativeTrackF from './MultiQuantitativeTrack'\nimport MultiRowLineRendererF from './MultiRowLineRenderer'\nimport MultiRowXYPlotRendererF from './MultiRowXYPlotRenderer'\nimport MultiWiggleAdapterF from './MultiWiggleAdapter'\nimport MultiWiggleAddTrackWorkflowF from './MultiWiggleAddTrackWorkflow'\nimport MultiXYPlotRendererF from './MultiXYPlotRenderer'\nimport QuantitativeTrackF from './QuantitativeTrack'\nimport WiggleBaseRenderer from './WiggleBaseRenderer'\nimport {\n  MultiWiggleClusterScoreMatrix,\n  MultiWiggleGetScoreMatrix,\n  MultiWiggleGetSources,\n  WiggleGetGlobalQuantitativeStats,\n  WiggleGetMultiRegionQuantitativeStats,\n} from './WiggleRPC/rpcMethods'\nimport XYPlotRendererF, {\n  ReactComponent as XYPlotRendererReactComponent,\n  XYPlotRenderer,\n  configSchema as xyPlotRendererConfigSchema,\n} from './XYPlotRenderer'\nimport * as utils from './util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class WigglePlugin extends Plugin {\n  name = 'WigglePlugin'\n\n  install(pm: PluginManager) {\n    MultiWiggleAdapterF(pm)\n    BigWigAdapterF(pm)\n    QuantitativeTrackF(pm)\n    MultiQuantitativeTrackF(pm)\n    LinearWiggleDisplayF(pm)\n    MultiLinearWiggleDisplayF(pm)\n    LinePlotRendererF(pm)\n    XYPlotRendererF(pm)\n    DensityRendererF(pm)\n    MultiXYPlotRendererF(pm)\n    MultiRowXYPlotRendererF(pm)\n    MultiDensityRendererF(pm)\n    MultiLineRendererF(pm)\n    MultiRowLineRendererF(pm)\n    MultiWiggleAddTrackWorkflowF(pm)\n    CreateMultiWiggleExtensionF(pm)\n    GuessAdapterF(pm)\n\n    pm.addRpcMethod(() => new WiggleGetGlobalQuantitativeStats(pm))\n    pm.addRpcMethod(() => new WiggleGetMultiRegionQuantitativeStats(pm))\n    pm.addRpcMethod(() => new MultiWiggleGetSources(pm))\n    pm.addRpcMethod(() => new MultiWiggleGetScoreMatrix(pm))\n    pm.addRpcMethod(() => new MultiWiggleClusterScoreMatrix(pm))\n  }\n\n  exports = {\n    LinearWiggleDisplayReactComponent,\n    XYPlotRendererReactComponent,\n    XYPlotRenderer,\n    WiggleBaseRenderer,\n    linearWiggleDisplayModelFactory,\n    xyPlotRendererConfigSchema,\n    utils,\n  }\n}\n\nexport * from './util'\n\nexport { default as WiggleRendering } from './WiggleRendering'\nexport {\n  ReactComponent as LinearWiggleDisplayReactComponent,\n  Tooltip,\n  modelFactory as linearWiggleDisplayModelFactory,\n} from './LinearWiggleDisplay'\nexport type { TooltipContentsComponent } from './Tooltip'\n\nexport { default as WiggleBaseRenderer } from './WiggleBaseRenderer'\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiWiggleAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MultiWiggleAdapter',\n        displayName: 'Multi-wiggle adapter',\n        configSchema,\n        adapterCapabilities: [\n          'hasResolution',\n          'hasLocalStats',\n          'hasGlobalStats',\n        ],\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./MultiWiggleAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BigWigAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BigWigAdapter',\n        displayName: 'BigWig adapter',\n        configSchema,\n        adapterCapabilities: [\n          'hasResolution',\n          'hasLocalStats',\n          'hasGlobalStats',\n        ],\n        getAdapterClass: () => import('./BigWigAdapter').then(r => r.default),\n      }),\n  )\n}\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function QuantitativeTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'QuantitativeTrack',\n      displayName: 'Quantitative track',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'QuantitativeTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config QuantitativeTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'QuantitativeTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiQuantitativeTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'MultiQuantitativeTrack',\n      displayName: 'Multi-quantitative track',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'MultiQuantitativeTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config MultiQuantitativeTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'MultiQuantitativeTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n\nexport default configSchema\n","import { lazy } from 'react'\n\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearWiggleDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    const stateModel = modelFactory(pluginManager, configSchema)\n    return new DisplayType({\n      name: 'LinearWiggleDisplay',\n      displayName: 'Wiggle display',\n      configSchema,\n      stateModel,\n      trackType: 'QuantitativeTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: lazy(() => import('./components/WiggleDisplayComponent')),\n    })\n  })\n}\n\nexport { default as Tooltip } from './components/Tooltip'\nexport { default as ReactComponent } from './components/WiggleDisplayComponent'\nexport { default as modelFactory } from './model'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport sharedWiggleConfigFactory from '../shared/SharedWiggleConfigSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearWiggleDisplay\n * extends\n * - [SharedWiggleDisplay](../sharedwiggledisplay)\n */\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const XYPlotRendererConfigSchema =\n    pluginManager.getRendererType('XYPlotRenderer')!.configSchema\n  const DensityRendererConfigSchema =\n    pluginManager.getRendererType('DensityRenderer')!.configSchema\n  const LinePlotRendererConfigSchema =\n    pluginManager.getRendererType('LinePlotRenderer')!.configSchema\n\n  return ConfigurationSchema(\n    'LinearWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['density', 'xyplot', 'line']),\n        defaultValue: 'xyplot',\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        DensityRenderer: DensityRendererConfigSchema,\n        XYPlotRenderer: XYPlotRendererConfigSchema,\n        LinePlotRenderer: LinePlotRendererConfigSchema,\n      }),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: sharedWiggleConfigFactory(),\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiLinearWiggleDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'MultiLinearWiggleDisplay',\n      displayName: 'Multi-wiggle display',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'MultiQuantitativeTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: lazy(() => import('./components/WiggleDisplayComponent')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport sharedWiggleConfigFactory from '../shared/SharedWiggleConfigSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config MultiLinearWiggleDisplay\n * extends\n * - [SharedWiggleDisplay](../sharedwiggledisplay)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const MultiXYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'MultiXYPlotRenderer',\n  )!.configSchema\n  const MultiDensityRendererConfigSchema = pluginManager.getRendererType(\n    'MultiDensityRenderer',\n  )!.configSchema\n  const MultiRowXYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'MultiRowXYPlotRenderer',\n  )!.configSchema\n  const MultiLineRendererConfigSchema =\n    pluginManager.getRendererType('MultiLineRenderer')!.configSchema\n  const MultiRowLineRendererConfigSchema = pluginManager.getRendererType(\n    'MultiRowLineRenderer',\n  )!.configSchema\n\n  return ConfigurationSchema(\n    'MultiLinearWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', [\n          'multirowxy',\n          'xyplot',\n          'multirowdensity',\n          'multiline',\n          'multirowline',\n        ]),\n        defaultValue: 'multirowxy',\n      },\n\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        MultiXYPlotRenderer: MultiXYPlotRendererConfigSchema,\n        MultiDensityRenderer: MultiDensityRendererConfigSchema,\n        MultiRowXYPlotRenderer: MultiRowXYPlotRendererConfigSchema,\n        MultiLineRenderer: MultiLineRendererConfigSchema,\n        MultiRowLineRenderer: MultiRowLineRendererConfigSchema,\n      }),\n\n      /**\n       * #slot\n       */\n      height: {\n        type: 'number',\n        defaultValue: 200,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: sharedWiggleConfigFactory(),\n      explicitlyTyped: true,\n    },\n  )\n}\n","import configSchema from './configSchema'\nimport ReactComponent from '../WiggleRendering'\nimport LinePlotRenderer from './LinePlotRenderer'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinePlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new LinePlotRenderer({\n        name: 'LinePlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import ReactComponent from '../WiggleRendering'\nimport XYPlotRenderer from './XYPlotRenderer'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function XYPlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new XYPlotRenderer({\n        name: 'XYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n\nexport { default as XYPlotRenderer } from './XYPlotRenderer'\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default as configSchema } from './configSchema'\n","import DensityRenderer from './DensityRenderer'\nimport configSchema from './configSchema'\nimport ReactComponent from '../WiggleRendering'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function DensityRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new DensityRenderer({\n        name: 'DensityRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import ReactComponent from '../MultiWiggleRendering'\nimport MultiXYPlotRenderer from './MultiXYPlotRenderer'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiXYPlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiXYPlotRenderer({\n        name: 'MultiXYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import ReactComponent from '../MultiWiggleRendering'\nimport MultiRowXYPlotRenderer from './MultiRowXYPlotRenderer'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiRowXYPlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiRowXYPlotRenderer({\n        name: 'MultiRowXYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import configSchema from './configSchema'\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiDensityRenderer from './MultiDensityRenderer'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiDensityRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiDensityRenderer({\n        name: 'MultiDensityRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import ReactComponent from '../MultiWiggleRendering'\nimport MultiLineRenderer from './MultiLineRenderer'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiLineRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiLineRenderer({\n        name: 'MultiLineRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import ReactComponent from '../MultiWiggleRendering'\nimport MultiRowLineRenderer from './MultiRowLineRenderer'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiRowLineRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiRowLineRenderer({\n        name: 'MultiRowLineRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import { lazy } from 'react'\n\nimport { AddTrackWorkflowType } from '@jbrowse/core/pluggableElementTypes'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiWiggleAddTrackWorkflowF(pm: PluginManager) {\n  pm.addAddTrackWorkflowType(\n    () =>\n      new AddTrackWorkflowType({\n        name: 'Multi-wiggle track',\n        ReactComponent: lazy(() => import('./AddTrackWorkflow')),\n        stateModel: types.model({}),\n      }),\n  )\n}\n","import { testAdapter } from '@jbrowse/core/util'\nimport { getFileName } from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessAdapterF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (cb: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        return testAdapter(\n          fileName,\n          /\\.(bw|bigwig)$/i,\n          adapterHint,\n          'BigWigAdapter',\n        )\n          ? {\n              type: 'BigWigAdapter',\n              bigWigLocation: file,\n            }\n          : cb(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        return adapterName === 'BigWigAdapter'\n          ? 'QuantitativeTrack'\n          : trackTypeGuesser(adapterName)\n      }\n    },\n  )\n}\n","import type PluginManager from './PluginManager'\nimport type { AnyConfigurationSchemaType } from './configuration'\n\n/**\n * base class for a JBrowse plugin\n */\nexport default abstract class Plugin {\n  abstract name: string\n\n  url?: string\n\n  version?: string\n\n  install(_pluginManager: PluginManager): void {}\n\n  configure(_pluginManager: PluginManager): void {}\n\n  configurationSchema?: AnyConfigurationSchemaType\n}\n\nexport type PluginConstructor = new (...args: unknown[]) => Plugin\n","import RpcMethodType from './RpcMethodType'\nimport { renameRegionsIfNeeded } from '../util'\nimport SerializableFilterChain from './renderers/util/serializableFilterChain'\n\nimport type { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\n\nexport default abstract class RpcMethodTypeWithFiltersAndRenameRegions extends RpcMethodType {\n  async deserializeArguments<T>(\n    args: T & { filters?: any },\n    rpcDriverClassName: string,\n  ): Promise<T> {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async serializeArguments(\n    args: RenderArgs & {\n      stopToken?: string\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager')\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n}\n","import { TextField } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { isUriLocation } from '../../util/types'\n\nimport type { FileLocation } from '../../util/types'\n\nconst UrlChooser = observer(function ({\n  location,\n  label,\n  style,\n  setLocation,\n}: {\n  location?: FileLocation\n  label?: string\n  style?: Record<string, unknown>\n  setLocation: (arg: FileLocation) => void\n}) {\n  return (\n    <TextField\n      variant=\"outlined\"\n      fullWidth\n      defaultValue={location && isUriLocation(location) ? location.uri : ''}\n      label={label || 'Enter URL'}\n      style={style}\n      onChange={event => {\n        setLocation({\n          uri: event.target.value.trim(),\n          locationType: 'UriLocation',\n        })\n      }}\n      slotProps={{\n        htmlInput: {\n          'data-testid': 'urlInput',\n        },\n      }}\n    />\n  )\n})\n\nexport default UrlChooser\n","/* eslint-disable react-refresh/only-export-components */\n// This file is a ponyfill for the HTML5 OffscreenCanvas API.\n\nimport { CanvasSequence } from 'canvas-sequencer'\nimport isNode from 'detect-node'\n\ntype AbstractCanvas = any\n\ntype AbstractImageBitmap = any\n\nexport let createCanvas: (width: number, height: number) => AbstractCanvas\nexport let createImageBitmap: (\n  canvas: AbstractCanvas,\n) => Promise<AbstractImageBitmap>\n\n/** the JS class (constructor) for offscreen-generated image bitmap data */\nexport let ImageBitmapType: unknown\n\nexport function drawImageOntoCanvasContext(\n  imageData: any,\n  context: CanvasRenderingContext2D,\n) {\n  if (imageData.serializedCommands) {\n    const seq = new CanvasSequence(imageData.serializedCommands)\n    seq.execute(context)\n  } else {\n    context.drawImage(imageData as CanvasImageSource, 0, 0)\n  }\n}\n\nconst weHave = {\n  realOffscreenCanvas: typeof OffscreenCanvas === 'function',\n  node: isNode,\n}\n\nif (weHave.realOffscreenCanvas) {\n  createCanvas = (width, height) => new OffscreenCanvas(width, height)\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  createImageBitmap = window.createImageBitmap || self.createImageBitmap\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  ImageBitmapType = window.ImageBitmap || self.ImageBitmap\n} else if (weHave.node) {\n  // use node-canvas if we are running in node (i.e. automated tests)\n  createCanvas = (...args) => {\n    // @ts-expect-error\n    return nodeCreateCanvas(...args)\n  }\n  createImageBitmap = async canvas => {\n    const dataUri = canvas.toDataURL()\n    // @ts-expect-error\n    const img = new nodeImage()\n    return new Promise((resolve, reject) => {\n      // need onload for jest\n      img.onload = () => {\n        resolve(img)\n      }\n      img.onerror = reject\n      img.src = dataUri\n    })\n  }\n} else {\n  createCanvas = (width: number, height: number) => {\n    const context = new CanvasSequence()\n    return {\n      width,\n      height,\n      getContext() {\n        return context\n      },\n    }\n  }\n  createImageBitmap = async canvas => {\n    const ctx = canvas.getContext('2d')\n    return {\n      height: canvas.height,\n      width: canvas.width,\n      serializedCommands: ctx.toJSON(),\n      containsNoTransferables: true,\n    }\n  }\n  ImageBitmapType = String\n}\n","import { Observable, fromEvent } from 'rxjs'\n\nclass AbortError extends Error {\n  public code: string | undefined\n}\n\n/**\n * properly check if the given AbortSignal is aborted. per the standard, if the\n * signal reads as aborted, this function throws either a DOMException\n * AbortError, or a regular error with a `code` attribute set to `ERR_ABORTED`.\n *\n * for convenience, passing `undefined` is a no-op\n *\n * @param signal -\n * @returns nothing\n */\nexport function checkAbortSignal(signal?: AbortSignal): void {\n  if (!signal) {\n    return\n  }\n\n  if (!(signal instanceof AbortSignal)) {\n    throw new TypeError('must pass an AbortSignal')\n  }\n\n  if (signal.aborted) {\n    throw makeAbortError()\n  }\n}\n\nfunction timeout(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n/**\n * Skips to the next tick, then runs `checkAbortSignal`.\n * Await this to inside an otherwise synchronous loop to\n * provide a place to break when an abort signal is received.\n */\nexport async function abortBreakPoint(signal?: AbortSignal) {\n  // it was observed that an actual timeout is needed to get the aborting (wrap\n  // hicrenderer in a try catch, console.error the error, and rethrow the error\n  // to see). using await Promise.resolve() did not appear to allow aborting to\n  // occur\n  await timeout(1)\n  checkAbortSignal(signal)\n}\n\nexport function makeAbortError() {\n  if (typeof DOMException !== 'undefined') {\n    return new DOMException('aborted', 'AbortError')\n  }\n  const e = new AbortError('aborted')\n  e.code = 'ERR_ABORTED'\n  return e\n}\n\nexport function observeAbortSignal(signal?: AbortSignal): Observable<Event> {\n  if (!signal) {\n    return new Observable()\n  }\n  return fromEvent(signal, 'abort')\n}\n\n/**\n * check if the given exception was caused by an operation being intentionally aborted\n * @param exception -\n */\nexport function isAbortException(exception: unknown): boolean {\n  return (\n    exception instanceof Error &&\n    // DOMException\n    (exception.name === 'AbortError' ||\n      // standard-ish non-DOM abort exception\n      (exception as AbortError).code === 'ERR_ABORTED' ||\n      // message contains aborted for bubbling through RPC\n      // things we have seen that we want to catch here\n      // Error: aborted\n      // AbortError: aborted\n      // AbortError: The user aborted a request.\n      !!/\\b(aborted|aborterror)\\b/i.test(exception.message))\n  )\n}\n","import { SanitizedHTML } from '@jbrowse/core/ui'\nimport BaseTooltip from '@jbrowse/core/ui/BaseTooltip'\nimport escapeHTML from 'escape-html'\n\nexport default function MultiVariantTooltip({\n  source,\n}: {\n  source: {\n    color?: string\n    hoveredGenotype?: { genotype: string; name: string }\n    [key: string]: unknown\n  }\n}) {\n  return (\n    <BaseTooltip>\n      {source.color ? (\n        <div\n          style={{\n            width: 10,\n            height: 10,\n            backgroundColor: source.color,\n          }}\n        />\n      ) : null}\n      <SanitizedHTML\n        html={Object.entries(source)\n          .filter(\n            ([key, val]) =>\n              key !== 'color' &&\n              key !== 'HP' &&\n              key !== 'name' &&\n              key !== 'id' &&\n              val !== undefined,\n          )\n          .map(([key, value]) => `${key}:${escapeHTML(`${value}`)}`)\n          .join('<br/>')}\n      />\n    </BaseTooltip>\n  )\n}\n","import { getContainingView } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport MultiVariantTooltip from './MultiVariantTooltip'\n\nimport type { MultiVariantBaseModel } from '../MultiVariantBaseModel'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst useStyles = makeStyles()({\n  rel: {\n    position: 'relative',\n  },\n  cursor: {\n    pointerEvents: 'none',\n    zIndex: 800,\n    position: 'absolute',\n  },\n  color: {\n    width: 10,\n    height: 10,\n  },\n})\n\nconst MultiVariantCrosshairs = observer(function ({\n  mouseX,\n  mouseY,\n  model,\n}: {\n  mouseX: number\n  mouseY: number\n  model: MultiVariantBaseModel\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const { hoveredGenotype, height, scrollTop, sourceMap } = model\n  const { width } = getContainingView(model) as LinearGenomeViewModel\n  const source = hoveredGenotype ? sourceMap?.[hoveredGenotype.name] : undefined\n  const y = mouseY - scrollTop\n  return (\n    <div className={classes.rel}>\n      <svg\n        className={classes.cursor}\n        width={width}\n        height={height}\n        style={{\n          top: scrollTop,\n        }}\n      >\n        <line\n          x1={0}\n          x2={width}\n          y1={y}\n          y2={y}\n          stroke={theme.palette.text.primary}\n        />\n        <line\n          x1={mouseX}\n          x2={mouseX}\n          y1={0}\n          y2={height}\n          stroke={theme.palette.text.primary}\n        />\n      </svg>\n\n      {source ? (\n        <MultiVariantTooltip\n          source={{\n            ...source,\n            ...hoveredGenotype,\n          }}\n        />\n      ) : null}\n    </div>\n  )\n})\n\nexport default MultiVariantCrosshairs\n","import { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()(theme => ({\n  bg: {\n    padding: 4,\n    margin: 4,\n    overflow: 'auto',\n    maxHeight: 200,\n    background: theme.palette.mode === 'dark' ? '#833' : '#f88',\n    border: `1px solid ${theme.palette.divider}`,\n  },\n}))\n\nexport default function RedErrorMessageBox({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  return <div className={classes.bg}>{children}</div>\n}\n","import { getContainingView, getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { isAlive } from 'mobx-state-tree'\n\nimport type { LinearGenomeViewModel } from '../../LinearGenomeView'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { IAnyStateTreeNode } from 'mobx-state-tree'\n\nexport interface RenderProps {\n  rendererType: any\n  renderArgs: Record<string, any>\n  renderProps: Record<string, any>\n  displayError: unknown\n  rpcManager: { call: (...args: unknown[]) => void }\n  cannotBeRenderedReason: string\n}\n\nexport interface ErrorProps {\n  displayError: string\n}\n\nexport function getDisplayStr(totalBytes: number) {\n  if (Math.floor(totalBytes / 1000000) > 0) {\n    return `${Number.parseFloat((totalBytes / 1000000).toPrecision(3))} Mb`\n  } else if (Math.floor(totalBytes / 1000) > 0) {\n    return `${Number.parseFloat((totalBytes / 1000).toPrecision(3))} Kb`\n  } else {\n    return `${Math.floor(totalBytes)} bytes`\n  }\n}\n\n// stabilize clipid under test for snapshot\nexport function getId(id: string, index: number) {\n  const notJest = typeof jest === 'undefined'\n  return ['clip', notJest ? id : 'jest', index, notJest ? Math.random() : '']\n    .filter(f => !!f)\n    .join('-')\n}\n\nexport async function getFeatureDensityStatsPre(\n  self: IAnyStateTreeNode & {\n    adapterConfig?: AnyConfigurationModel\n    setMessage: (arg: string) => void\n  },\n) {\n  const view = getContainingView(self) as LinearGenomeViewModel\n  const regions = view.staticBlocks.contentBlocks\n\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  if (!adapterConfig) {\n    // A track extending the base track might not have an adapter config\n    // e.g. Apollo tracks don't use adapters\n    return {}\n  }\n  const sessionId = getRpcSessionId(self)\n\n  return rpcManager.call(sessionId, 'CoreGetFeatureDensityStats', {\n    sessionId,\n    regions,\n    adapterConfig,\n    statusCallback: (message: string) => {\n      if (isAlive(self)) {\n        self.setMessage(message)\n      }\n    },\n  }) as Promise<FeatureDensityStats>\n}\n","import {\n  isArrayType,\n  isLateType,\n  isMapType,\n  isOptionalType,\n  isUnionType,\n} from 'mobx-state-tree'\n\nimport type {\n  IAnyComplexType,\n  IAnyType,\n  IModelReflectionPropertiesData,\n  ISimpleType,\n  UnionStringArray,\n} from 'mobx-state-tree'\n\nexport interface ILiteralType<T> extends ISimpleType<T> {\n  value: T\n}\n\n/**\n * get the inner type of an MST optional, array, or late type object\n */\nexport function getSubType(type: IAnyType): IAnyType {\n  let t: IAnyType\n  if (isOptionalType(type)) {\n    // @ts-expect-error\n    t = type._subtype || type.type\n  } else if (isArrayType(type) || isMapType(type)) {\n    // @ts-expect-error\n    t = type._subtype || type._subType || type.subType\n    // @ts-expect-error\n  } else if (typeof type.getSubType === 'function') {\n    // @ts-expect-error\n    return type.getSubType()\n  } else {\n    throw new TypeError('unsupported mst type')\n  }\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (!t) {\n    throw new Error('failed to get subtype')\n  }\n  return t\n}\n\n/**\n * get the array of the subtypes in a union\n */\nexport function getUnionSubTypes(unionType: IAnyType): IAnyType[] {\n  if (!isUnionType(unionType)) {\n    throw new TypeError('not an MST union type')\n  }\n  const t =\n    // @ts-expect-error\n    unionType._types ||\n    // @ts-expect-error\n    unionType.types ||\n    // @ts-expect-error\n    getSubType(unionType)._types ||\n    // @ts-expect-error\n    getSubType(unionType).types\n  if (!t) {\n    // debugger\n    throw new Error('failed to extract subtypes from mst union')\n  }\n  return t\n}\n\n/**\n * get the type of one of the properties of the given MST model type\n */\nexport function getPropertyType(\n  type: IModelReflectionPropertiesData,\n  propertyName: string,\n) {\n  return type.properties[propertyName]!\n}\n\n/**\n * get the base type from inside an MST optional type\n */\nexport function getDefaultValue(type: IAnyType) {\n  if (!isOptionalType(type)) {\n    throw new TypeError('type must be an optional type')\n  }\n  // @ts-expect-error\n  return type._defaultValue || type.defaultValue\n}\n\nexport type IEnumerationType<T extends string> = ISimpleType<\n  UnionStringArray<T[]>\n>\n\n/** get the string values of an MST enumeration type */\nexport function getEnumerationValues(type: IAnyComplexType) {\n  const subtypes = getUnionSubTypes(type) as ILiteralType<string>[]\n  // the subtypes should all be literals with a value member\n  return subtypes.map(t => t.value)\n}\n\nexport function resolveLateType(maybeLate: IAnyType) {\n  if (\n    !isUnionType(maybeLate) &&\n    !isArrayType(maybeLate) &&\n    isLateType(maybeLate)\n  ) {\n    // @ts-expect-error\n    return maybeLate.getSubType()\n  }\n  return maybeLate\n}\n","import { observer } from 'mobx-react'\n\nimport type { RenderArgs, ResultsSerialized } from './ServerSideRendererType'\n\ninterface Props extends ResultsSerialized, RenderArgs {\n  RenderingComponent: React.ComponentType<any>\n}\n\nconst ServerSideRenderedContent = observer(function ServerSideRenderedContent({\n  html,\n  RenderingComponent,\n  ...props\n}: Props) {\n  return <RenderingComponent {...props} />\n})\n\nexport default ServerSideRenderedContent\n","import { hashCode } from './'\n\n// generates a short \"id fingerprint\" from the config passed to the base\n// feature adapter by recursively enumerating props, but if config is too big\n// does not process entire config (FromConfigAdapter for example can be large)\nexport default function idMaker(\n  args: Record<string, unknown>,\n  id = '',\n  len = 5000,\n) {\n  const stack = [args]\n\n  // while not empty\n  while (stack.length) {\n    const obj = stack.pop()!\n    for (const [key, val] of Object.entries(obj)) {\n      if (id.length > len) {\n        return hashCode(id)\n      } else {\n        if (typeof val === 'object' && val !== null) {\n          stack.push(val as Record<string, unknown>)\n        } else {\n          id += `${key}-${val}`\n        }\n      }\n    }\n  }\n\n  return `adp-${hashCode(id)}`\n}\n","import { sum } from '@jbrowse/core/util'\n\ninterface Display {\n  height: number\n}\ninterface Track {\n  displays: Display[]\n}\n\nexport function totalHeight(\n  tracks: Track[],\n  textHeight: number,\n  trackLabels: string,\n) {\n  return sum(\n    tracks.map(\n      t =>\n        t.displays[0]!.height +\n        (['none', 'left'].includes(trackLabels) ? 0 : textHeight),\n    ),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const configSchema = ConfigurationSchema('AlignmentsFeatureWidget', {})\n","import { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Instance } from 'mobx-state-tree'\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types.compose(\n    baseModelFactory(pluginManager),\n    types.model('AlignmentsFeatureWidget', {\n      type: types.literal('AlignmentsFeatureWidget'),\n    }),\n  )\n}\n\nexport type AlignmentFeatureWidgetStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type AlignmentFeatureWidgetModel =\n  Instance<AlignmentFeatureWidgetStateModel>\n","import { lazy } from 'react'\n\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\n\nimport { configSchema } from './configSchema'\nimport { stateModelFactory } from './stateModelFactory'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function AlignmentFeatureDetailsF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'AlignmentsFeatureWidget',\n        heading: 'Feature details',\n        configSchema: configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(() => import('./AlignmentsFeatureDetail')),\n      }),\n  )\n}\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport configSchemaF from './configSchemaF'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function register(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    const track = new TrackType({\n      name: 'AlignmentsTrack',\n      displayName: 'Alignments track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'AlignmentsTrack', configSchema),\n    })\n    const linearAlignmentsDisplay = pm.getDisplayType(\n      'LinearAlignmentsDisplay',\n    )!\n    // Add LinearAlignmentsDisplay here so that it has priority over the other\n    // linear displays (defaults to order the displays are added, but we have\n    // to add the Pileup and SNPCoverage displays first).\n    track.addDisplayType(linearAlignmentsDisplay)\n    return track\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config AlignmentsTrack\n * has very little config; most config and state logic is on the display\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'AlignmentsTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config BamAdapter\n * used to configure BAM adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'BamAdapter',\n  {\n    /**\n     * #slot\n     */\n    bamLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bam',\n        locationType: 'UriLocation',\n      },\n    },\n\n    index: ConfigurationSchema('BamIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['BAI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'BAI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.bam.bai',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      description:\n        'size to fetch in bytes over which to display a warning to the user that too much data will be fetched',\n      defaultValue: 5_000_000,\n    },\n    /**\n     * #slot\n     * generally refers to the reference genome assembly's sequence adapter\n     * currently needs to be manually added\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description:\n        'sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags',\n      defaultValue: null,\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes yourfile.bam.bai:\n     * ```json\n     * {\n     *   \"type\": \"BamAdapter\",\n     *   \"uri\": \"yourfile.bam\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            bamLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            index: {\n              location: {\n                uri: `${snap.uri}.bai`,\n                baseUri: snap.baseUri,\n              },\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default configSchema\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BamAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'BamAdapter',\n      displayName: 'BAM adapter',\n      configSchema,\n      getAdapterClass: () => import('./BamAdapter').then(r => r.default),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config CramAdapter\n * used to configure CRAM adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'CramAdapter',\n  {\n    /**\n     * #slot fetchSizeLimit\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      description:\n        'size in bytes over which to display a warning to the user that too much data will be fetched',\n      defaultValue: 3_000_000,\n    },\n\n    /**\n     * #slot cramLocation\n     */\n    cramLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.cram',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot craiLocation\n     */\n    craiLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.cram.crai',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot sequenceAdapter\n     * generally refers to the reference genome assembly's sequence adapter\n     * currently needs to be manually added\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description: 'sequence data adapter',\n      defaultValue: null,\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes yourfile.cram.crai, note\n     * that sequenceAdapter required:\n     *\n     * ```json\n     * {\n     *   \"type\": \"CramAdapter\",\n     *   \"uri\": \"yourfile.cram\",\n     *   \"sequenceAdapter\":{\n     *     \"type\":\"TwoBitAdapter\",\n     *     \"uri\":\"genome.2bit\"\n     *   }\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            cramLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            craiLocation: {\n              uri: `${snap.uri}.crai`,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default configSchema\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function CramAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'CramAdapter',\n      displayName: 'CRAM adapter',\n      configSchema,\n      getAdapterClass: () => import('./CramAdapter').then(r => r.default),\n    })\n  })\n}\n","import { testAdapter } from '@jbrowse/core/util'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n} from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessAlignmentsTypesF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n\n        if (testAdapter(fileName, /\\.bam$/i, adapterHint, 'BamAdapter')) {\n          return {\n            type: 'BamAdapter',\n            bamLocation: file,\n            index: {\n              location: index || makeIndex(file, '.bai'),\n              indexType: makeIndexType(indexName, 'CSI', 'BAI'),\n            },\n          }\n        } else if (\n          testAdapter(fileName, /\\.cram$/i, adapterHint, 'CramAdapter')\n        ) {\n          return {\n            type: 'CramAdapter',\n            cramLocation: file,\n            craiLocation: index || makeIndex(file, '.crai'),\n          }\n        } else {\n          return adapterGuesser(file, index, adapterHint)\n        }\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'BamAdapter' || adapterName === 'CramAdapter') {\n          return 'AlignmentsTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config HtsgetBamAdapter\n * Used to fetch data from Htsget endpoints in BAM format, using the gmod/bam library\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HtsgetBamAdapter = ConfigurationSchema(\n  'HtsgetBamAdapter',\n  {\n    /**\n     * #slot\n     */\n    htsgetBase: {\n      type: 'string',\n      description: 'the base URL to fetch from',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    htsgetTrackId: {\n      type: 'string',\n      description: 'the trackId, which is appended to the base URL',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description:\n        'sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HtsgetBamAdapter\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function HtsgetBamAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'HtsgetBamAdapter',\n      displayName: 'Htsget BAM adapter',\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n      configSchema,\n      getAdapterClass: () => import('./HtsgetBamAdapter').then(r => r.default),\n    })\n  })\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearAlignmentsDisplayModel } from '../model'\n\nconst useStyles = makeStyles()({\n  resizeHandle: {\n    height: 5,\n    position: 'absolute',\n    zIndex: 2,\n  },\n})\n\nconst AlignmentsDisplay = observer(function AlignmentsDisplay({\n  model,\n}: {\n  model: LinearAlignmentsDisplayModel\n}) {\n  const { PileupDisplay, SNPCoverageDisplay } = model\n  const { classes } = useStyles()\n  if (!SNPCoverageDisplay) {\n    return null\n  }\n  const top = SNPCoverageDisplay.height ?? 100\n  return (\n    <div\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      style={{ position: 'relative' }}\n    >\n      <div data-testid=\"Blockset-snpcoverage\">\n        <SNPCoverageDisplay.RenderingComponent model={SNPCoverageDisplay} />\n      </div>\n      <ResizeHandle\n        onDrag={delta => {\n          SNPCoverageDisplay.setHeight(SNPCoverageDisplay.height + delta)\n          return delta\n        }}\n        className={classes.resizeHandle}\n        style={{ top: top - 4 }}\n      />\n\n      <div\n        data-testid=\"Blockset-pileup\"\n        style={{\n          position: 'absolute',\n          top,\n        }}\n      >\n        <PileupDisplay.RenderingComponent model={PileupDisplay} />\n      </div>\n    </div>\n  )\n})\n\nexport default AlignmentsDisplay\n","import type PluginManager from '@jbrowse/core/PluginManager'\n\nexport function getLowerPanelDisplays(pluginManager: PluginManager) {\n  return pluginManager\n    .getDisplayElements()\n    .filter(f => f.subDisplay?.type === 'LinearAlignmentsDisplay')\n    .filter(f => f.subDisplay?.lowerPanel)\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport deepEqual from 'fast-deep-equal'\nimport { autorun, when } from 'mobx'\nimport { addDisposer, getSnapshot, isAlive, types } from 'mobx-state-tree'\n\nimport { LinearAlignmentsDisplayMixin } from './alignmentsModel'\nimport { getLowerPanelDisplays } from './util'\n\nimport type { FilterBy } from '../shared/types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport type { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type { Instance } from 'mobx-state-tree'\n\nconst minDisplayHeight = 20\n\nfunction preCheck(self: LinearAlignmentsDisplayModel) {\n  const { PileupDisplay, SNPCoverageDisplay } = self\n  return (\n    PileupDisplay ||\n    isAlive(PileupDisplay) ||\n    SNPCoverageDisplay ||\n    isAlive(SNPCoverageDisplay)\n  )\n}\n\nfunction propagateColorBy(self: LinearAlignmentsDisplayModel) {\n  const { PileupDisplay, SNPCoverageDisplay } = self\n  if (!preCheck(self) || !PileupDisplay.colorBy) {\n    return\n  }\n  if (!deepEqual(PileupDisplay.colorBy, SNPCoverageDisplay.colorBy)) {\n    SNPCoverageDisplay.setColorScheme({\n      ...PileupDisplay.colorBy,\n    })\n  }\n}\n\nfunction propagateFilterBy(self: LinearAlignmentsDisplayModel) {\n  const { PileupDisplay, SNPCoverageDisplay } = self\n  if (!preCheck(self) || !PileupDisplay.filterBy) {\n    return\n  }\n  if (!deepEqual(PileupDisplay.filterBy, SNPCoverageDisplay.filterBy)) {\n    SNPCoverageDisplay.setFilterBy({\n      ...PileupDisplay.filterBy,\n    })\n  }\n}\n\n/**\n * #stateModel LinearAlignmentsDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [LinearAlignmentsDisplayMixin](../linearalignmentsdisplaymixin)\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearAlignmentsDisplay',\n      BaseDisplay,\n      LinearAlignmentsDisplayMixin(pluginManager, configSchema),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      scrollTop: 0,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n\n      /**\n       * #action\n       */\n      setSNPCoverageHeight(n: number) {\n        self.snpCovHeight = n\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get height() {\n        return self.heightPreConfig ?? getConf(self, 'height')\n      },\n\n      /**\n       * #getter\n       */\n      get featureIdUnderMouse() {\n        return (\n          self.PileupDisplay.featureIdUnderMouse ||\n          self.SNPCoverageDisplay.featureIdUnderMouse\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get pileupConf() {\n        const conf = getConf(self, 'pileupDisplay')\n        return {\n          ...conf,\n          type: self.lowerPanelType,\n          displayId: `${self.configuration.displayId}_${self.lowerPanelType}_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n        }\n      },\n\n      /**\n       * #method\n       */\n      getFeatureByID(blockKey: string, id: string) {\n        return self.PileupDisplay.getFeatureByID(blockKey, id)\n      },\n      /**\n       * #method\n       */\n      searchFeatureByID(id: string) {\n        return self.PileupDisplay.searchFeatureByID?.(id)\n      },\n\n      /**\n       * #getter\n       */\n      get features() {\n        return self.PileupDisplay.features\n      },\n\n      /**\n       * #getter\n       */\n      get DisplayBlurb() {\n        return self.PileupDisplay?.DisplayBlurb\n      },\n\n      /**\n       * #getter\n       */\n      get sortedBy() {\n        return self.PileupDisplay.sortedBy\n      },\n\n      /**\n       * #getter\n       */\n      get coverageConf() {\n        const conf = getConf(self, 'snpCoverageDisplay')\n        return {\n          ...conf,\n          displayId: `${self.configuration.displayId}_snpcoverage_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n        }\n      },\n\n      /**\n       * #method\n       */\n      notReady() {\n        return (\n          self.PileupDisplay.renderProps().notReady ||\n          self.SNPCoverageDisplay.renderProps().notReady\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSNPCoverageDisplay(configuration: AnyConfigurationModel) {\n        self.SNPCoverageDisplay = {\n          type: 'LinearSNPCoverageDisplay',\n          configuration,\n          height: self.snpCovHeight,\n        }\n      },\n      /**\n       * #action\n       */\n      setFeatureDensityStatsLimit(stats?: FeatureDensityStats) {\n        self.PileupDisplay.setFeatureDensityStatsLimit(stats)\n        self.SNPCoverageDisplay.setFeatureDensityStatsLimit(stats)\n      },\n\n      /**\n       * #action\n       */\n      setPileupDisplay(configuration: AnyConfigurationModel) {\n        self.PileupDisplay = {\n          type: configuration.type || 'LinearPileupDisplay',\n          configuration,\n        }\n      },\n      /**\n       * #action\n       */\n      setHeight(n: number) {\n        self.heightPreConfig = Math.max(n, minDisplayHeight)\n        return self.heightPreConfig\n      },\n      /**\n       * #action\n       */\n      setFilterBy(filter: FilterBy) {\n        self.PileupDisplay.setFilterBy(filter)\n        self.SNPCoverageDisplay.setFilterBy(filter)\n      },\n      /**\n       * #action\n       */\n      setLowerPanelType(type: string) {\n        self.lowerPanelType = type\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const {\n              SNPCoverageDisplay,\n              PileupDisplay,\n              coverageConf,\n              pileupConf,\n            } = self\n\n            if (!SNPCoverageDisplay) {\n              self.setSNPCoverageDisplay(coverageConf)\n            } else if (\n              !deepEqual(\n                coverageConf,\n                getSnapshot(SNPCoverageDisplay.configuration),\n              )\n            ) {\n              SNPCoverageDisplay.setHeight(self.snpCovHeight)\n              SNPCoverageDisplay.setConfig(self.coverageConf)\n            }\n\n            if (!PileupDisplay || self.lowerPanelType !== PileupDisplay.type) {\n              self.setPileupDisplay(pileupConf)\n            } else if (\n              !deepEqual(pileupConf, getSnapshot(PileupDisplay.configuration))\n            ) {\n              PileupDisplay.setConfig(self.pileupConf)\n            }\n\n            propagateColorBy(self as LinearAlignmentsDisplayModel)\n            propagateFilterBy(self as LinearAlignmentsDisplayModel)\n          }),\n        )\n\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setSNPCoverageHeight(self.SNPCoverageDisplay.height)\n          }),\n        )\n\n        addDisposer(\n          self,\n          autorun(() => {\n            self.PileupDisplay.setHeight(\n              self.height - self.SNPCoverageDisplay.height,\n            )\n          }),\n        )\n      },\n      /**\n       * #action\n       */\n      async renderSvg(opts: { rasterizeLayers?: boolean }) {\n        const pileupHeight = self.height - self.SNPCoverageDisplay.height\n        await when(() => !self.notReady())\n        return (\n          <>\n            <g>{await self.SNPCoverageDisplay.renderSvg(opts)}</g>\n            <g transform={`translate(0 ${self.SNPCoverageDisplay.height})`}>\n              {await self.PileupDisplay.renderSvg({\n                ...opts,\n                overrideHeight: pileupHeight,\n              })}\n            </g>\n          </>\n        )\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems(): MenuItem[] {\n          if (!self.PileupDisplay) {\n            return []\n          }\n          const extra = getLowerPanelDisplays(pluginManager).map(d => ({\n            type: 'radio',\n            label: d.displayName,\n            checked: d.name === self.PileupDisplay.type,\n            onClick: () => {\n              self.setLowerPanelType(d.name)\n            },\n          }))\n          return [\n            ...superTrackMenuItems(),\n            {\n              type: 'subMenu',\n              label: 'Pileup settings',\n              subMenu: self.PileupDisplay.trackMenuItems(),\n            },\n            {\n              type: 'subMenu',\n              label: 'SNPCoverage settings',\n              subMenu: self.SNPCoverageDisplay.trackMenuItems(),\n            },\n            {\n              type: 'subMenu',\n              label: 'Replace lower panel with...',\n              subMenu: extra,\n            },\n          ]\n        },\n      }\n    })\n    .preProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      // @ts-expect-error\n      const { height, ...rest } = snap\n      return { heightPreConfig: height, ...rest }\n    })\n}\n\nexport default stateModelFactory\n\nexport type LinearAlignmentsDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearAlignmentsDisplayModel =\n  Instance<LinearAlignmentsDisplayStateModel>\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport { getLowerPanelDisplays } from './util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearAlignmentsDisplayMixin\n */\nexport function LinearAlignmentsDisplayMixin(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types.model({\n    /**\n     * #property\n     * refers to LinearPileupDisplay sub-display model\n     */\n    PileupDisplay: types.maybe(\n      types.union(\n        ...getLowerPanelDisplays(pluginManager).map(f => f.stateModel),\n      ),\n    ),\n    /**\n     * #property\n     * refers to LinearSNPCoverageDisplay sub-display model\n     */\n    SNPCoverageDisplay: types.maybe(\n      pluginManager.getDisplayType('LinearSNPCoverageDisplay')!.stateModel,\n    ),\n    /**\n     * #property\n     */\n    snpCovHeight: 45,\n    /**\n     * #property\n     */\n    type: types.literal('LinearAlignmentsDisplay'),\n    /**\n     * #property\n     */\n    configuration: ConfigurationReference(configSchema),\n    /**\n     * #property\n     */\n    heightPreConfig: types.maybe(types.number),\n    /**\n     * #property\n     */\n    userFeatureScreenDensity: types.maybe(types.number),\n    /**\n     * #property\n     */\n    lowerPanelType: 'LinearPileupDisplay',\n  })\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport ReactComponent from './components/AlignmentsDisplay'\nimport configSchemaFactory from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearAlignmentsDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearAlignmentsDisplay',\n      displayName: 'Alignments display (combination)',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearAlignmentsDisplay\n * has a \"pileup\" sub-display, where you can see individual reads and a\n * quantitative \"snpcoverage\" sub-display track showing SNP frequencies\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport default function configModelFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearAlignmentsDisplay',\n    {\n      /**\n       * #slot\n       */\n      pileupDisplay: pluginManager.getDisplayType('LinearPileupDisplay')!\n        .configSchema,\n\n      /**\n       * #slot\n       */\n      snpCoverageDisplay: pluginManager.getDisplayType(\n        'LinearSNPCoverageDisplay',\n      )!.configSchema,\n\n      /**\n       * #slot\n       */\n      height: {\n        type: 'number',\n        defaultValue: 250,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport { defaultFilterFlags } from '../shared/util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearPileupDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearPileupDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup']),\n        defaultValue: 'pileup',\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer:\n          pluginManager.getRendererType('PileupRenderer')!.configSchema,\n      }),\n      /**\n       * #slot\n       */\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n\n      /**\n       * #slot\n       */\n      colorBy: {\n        type: 'frozen',\n        description: 'color scheme to use',\n        defaultValue: {\n          type: 'normal',\n        },\n      },\n\n      /**\n       * #slot\n       */\n      filterBy: {\n        type: 'frozen',\n        description: 'default filters to use',\n        defaultValue: defaultFilterFlags,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import { Typography } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { SortedBy } from '../../shared/types'\n\nconst LinearPileupDisplayBlurb = observer(function ({\n  model,\n}: {\n  model: {\n    sortedBy?: SortedBy\n  }\n}) {\n  const { sortedBy } = model\n  return sortedBy ? (\n    <div data-testid={`blurb-${sortedBy}`}>\n      <Typography color=\"secondary\" variant=\"caption\">\n        {`Sorted by ${sortedBy.tag ?? sortedBy.type} at ${\n          sortedBy.refName\n        }:${sortedBy.pos}`}\n      </Typography>\n    </div>\n  ) : null\n})\n\nexport default LinearPileupDisplayBlurb\n","import { lazy } from 'react'\n\nimport {\n  ConfigurationReference,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  SimpleFeature,\n  getContainingTrack,\n  getContainingView,\n  getEnv,\n  getSession,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport FilterListIcon from '@mui/icons-material/ClearAll'\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\nimport copy from 'copy-to-clipboard'\nimport { autorun, observable } from 'mobx'\nimport { addDisposer, cast, isAlive, types } from 'mobx-state-tree'\n\nimport { createAutorun } from '../util'\nimport LinearPileupDisplayBlurb from './components/LinearPileupDisplayBlurb'\nimport { getUniqueTags } from '../shared/getUniqueTags'\n\nimport type { ColorBy, FilterBy } from '../shared/types'\nimport type {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport type { Feature, SimpleFeatureSerialized } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// lazies\nconst FilterByTagDialog = lazy(\n  () => import('../shared/components/FilterByTagDialog'),\n)\nconst ColorByTagDialog = lazy(() => import('./components/ColorByTagDialog'))\nconst SetFeatureHeightDialog = lazy(\n  () => import('./components/SetFeatureHeightDialog'),\n)\nconst SetMaxHeightDialog = lazy(() => import('./components/SetMaxHeightDialog'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel SharedLinearPileupDisplayMixin\n * #category display\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport function SharedLinearPileupDisplayMixin(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        featureHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        noSpacing: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        fadeLikelihood: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackMaxHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        colorBySetting: types.frozen<ColorBy | undefined>(),\n        /**\n         * #property\n         */\n        filterBySetting: types.frozen<FilterBy | undefined>(),\n        /**\n         * #property\n         */\n        jexlFilters: types.optional(types.array(types.string), []),\n        /**\n         * #property\n         */\n        hideSmallIndelsSetting: types.maybe(types.boolean),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      colorTagMap: observable.map<string, string>({}),\n      /**\n       * #volatile\n       */\n      featureUnderMouseVolatile: undefined as undefined | Feature,\n      /**\n       * #volatile\n       */\n      tagsReady: false,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get colorBy() {\n        return self.colorBySetting ?? getConf(self, 'colorBy')\n      },\n\n      /**\n       * #getter\n       */\n      get filterBy() {\n        return self.filterBySetting ?? getConf(self, 'filterBy')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get autorunReady() {\n        const view = getContainingView(self) as LGV\n        return view.initialized && self.statsReadyAndRegionNotTooLarge\n      },\n\n      /**\n       * #getter\n       */\n      get hideSmallIndels() {\n        return self.hideSmallIndelsSetting\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setTagsReady(flag: boolean) {\n        self.tagsReady = flag\n      },\n\n      /**\n       * #action\n       */\n      setMaxHeight(n?: number) {\n        self.trackMaxHeight = n\n      },\n\n      /**\n       * #action\n       */\n      setFeatureHeight(n?: number) {\n        self.featureHeight = n\n      },\n\n      /**\n       * #action\n       */\n      setNoSpacing(flag?: boolean) {\n        self.noSpacing = flag\n      },\n\n      /**\n       * #action\n       */\n      setColorScheme(colorScheme: ColorBy) {\n        self.colorTagMap = observable.map({})\n        self.colorBySetting = {\n          ...colorScheme,\n        }\n        if (colorScheme.tag) {\n          self.tagsReady = false\n        }\n      },\n\n      /**\n       * #action\n       */\n      updateColorTagMap(uniqueTag: string[]) {\n        // pale color scheme\n        // https://cran.r-project.org/web/packages/khroma/vignettes/tol.html\n        // e.g. \"tol_light\"\n        const colorPalette = [\n          '#BBCCEE',\n          'pink',\n          '#CCDDAA',\n          '#EEEEBB',\n          '#FFCCCC',\n          'lightblue',\n          'lightgreen',\n          'tan',\n          '#CCEEFF',\n          'lightsalmon',\n        ]\n\n        for (const value of uniqueTag) {\n          if (!self.colorTagMap.has(value)) {\n            const totalKeys = [...self.colorTagMap.keys()].length\n            self.colorTagMap.set(value, colorPalette[totalKeys]!)\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setFeatureUnderMouse(feat?: Feature) {\n        self.featureUnderMouseVolatile = feat\n      },\n\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'AlignmentsFeatureWidget',\n            'alignmentFeature',\n            {\n              featureData: feature.toJSON(),\n              view: getContainingView(self),\n              track: getContainingTrack(self),\n            },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n\n      /**\n       * #action\n       * uses copy-to-clipboard and generates notification\n       */\n      copyFeatureToClipboard(feature: Feature) {\n        const { uniqueId, ...rest } = feature.toJSON()\n        const session = getSession(self)\n        copy(JSON.stringify(rest, null, 4))\n        session.notify('Copied to clipboard', 'success')\n      },\n\n      /**\n       * #action\n       */\n      setConfig(conf: AnyConfigurationModel) {\n        self.configuration = conf\n      },\n\n      /**\n       * #action\n       */\n      setFilterBy(filter: FilterBy) {\n        self.filterBySetting = {\n          ...filter,\n        }\n      },\n\n      /**\n       * #action\n       */\n      setJexlFilters(filters: string[]) {\n        self.jexlFilters = cast(filters)\n      },\n\n      /**\n       * #action\n       */\n      setHideSmallIndels(arg: boolean) {\n        self.hideSmallIndelsSetting = arg\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const {\n          featureHeight: height,\n          noSpacing,\n          hideSmallIndels,\n          trackMaxHeight: maxHeight,\n          rendererTypeName,\n        } = self\n        const configBlob = getConf(self, ['renderers', rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(hideSmallIndels !== undefined ? { hideSmallIndels } : {}),\n            ...(height !== undefined ? { height } : {}),\n            ...(noSpacing !== undefined ? { noSpacing } : {}),\n            ...(maxHeight !== undefined ? { maxHeight } : {}),\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get maxHeight() {\n        return readConfObject(self.rendererConfig, 'maxHeight')\n      },\n\n      /**\n       * #getter\n       */\n      get featureHeightSetting() {\n        return readConfObject(self.rendererConfig, 'height')\n      },\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        return self.featureUnderMouseVolatile\n      },\n      /**\n       * #getter\n       */\n      renderReady() {\n        return self.tagsReady\n      },\n      /**\n       * #getter\n       */\n      get filters() {\n        return new SerializableFilterChain({ filters: self.jexlFilters })\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n\n      return {\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType) {\n            throw new Error(`unknown alignments view name ${viewName}`)\n          }\n          return rendererType\n        },\n\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          const feat = self.contextMenuFeature\n          return feat\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    self.clearFeatureSelection()\n                    self.selectFeature(feat)\n                  },\n                },\n                {\n                  label: 'Copy info to clipboard',\n                  icon: ContentCopyIcon,\n                  onClick: () => {\n                    self.copyFeatureToClipboard(feat)\n                  },\n                },\n              ]\n            : []\n        },\n\n        /**\n         * #getter\n         */\n        get DisplayBlurb() {\n          return LinearPileupDisplayBlurb\n        },\n        /**\n         * #method\n         */\n        renderPropsPre() {\n          const { colorTagMap, colorBy, filterBy, rpcDriverName } = self\n          const superProps = superRenderProps()\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !self.renderReady(),\n            rpcDriverName,\n            displayModel: self,\n            colorBy,\n            filterBy,\n            filters: self.filters,\n            colorTagMap: Object.fromEntries(colorTagMap.toJSON()),\n            config: self.rendererConfig,\n            async onFeatureClick(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingTrack(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: SimpleFeatureSerialized | undefined }\n\n                  if (isAlive(self) && feature) {\n                    self.selectFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notifyError(`${e}`, e)\n              }\n            },\n\n            onClick() {\n              self.clearFeatureSelection()\n            },\n            // similar to click but opens a menu with further options\n            async onFeatureContextMenu(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingTrack(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: SimpleFeatureSerialized | undefined }\n\n                  if (feature) {\n                    self.setContextMenuFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notifyError(`${e}`, e)\n              }\n            },\n          }\n        },\n\n        /**\n         * #method\n         */\n        colorSchemeSubMenuItems() {\n          return [\n            {\n              label: 'Normal',\n              onClick: () => {\n                self.setColorScheme({\n                  type: 'normal',\n                })\n              },\n            },\n            {\n              label: 'Mapping quality',\n              onClick: () => {\n                self.setColorScheme({\n                  type: 'mappingQuality',\n                })\n              },\n            },\n            {\n              label: 'Strand',\n              onClick: () => {\n                self.setColorScheme({\n                  type: 'strand',\n                })\n              },\n            },\n            {\n              label: 'Per-base quality',\n              onClick: () => {\n                self.setColorScheme({\n                  type: 'perBaseQuality',\n                })\n              },\n            },\n            {\n              label: 'Per-base lettering',\n              onClick: () => {\n                self.setColorScheme({\n                  type: 'perBaseLettering',\n                })\n              },\n            },\n            {\n              label: 'First-of-pair strand',\n              onClick: () => {\n                self.setColorScheme({\n                  type: 'stranded',\n                })\n              },\n            },\n            {\n              label: 'Color by tag...',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  ColorByTagDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n          ]\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Set feature height...',\n              priority: 1,\n              subMenu: [\n                {\n                  label: 'Normal',\n                  onClick: () => {\n                    self.setFeatureHeight(7)\n                    self.setNoSpacing(false)\n                  },\n                },\n                {\n                  label: 'Compact',\n                  onClick: () => {\n                    self.setFeatureHeight(2)\n                    self.setNoSpacing(true)\n                  },\n                },\n                {\n                  label: 'Manually set height',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SetFeatureHeightDialog,\n                      {\n                        model: self,\n                        handleClose,\n                      },\n                    ])\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Hide small indels (<10bp)',\n              priority: -1,\n              type: 'checkbox',\n              checked: self.hideSmallIndels,\n              onClick: () => {\n                self.setHideSmallIndels(!self.hideSmallIndels)\n              },\n            },\n            {\n              label: 'Set max height...',\n              priority: -1,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetMaxHeightDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n            {\n              label: 'Filter by...',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  FilterByTagDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .views(self => ({\n      renderProps() {\n        return self.renderPropsPre()\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        createAutorun(\n          self,\n          async () => {\n            const view = getContainingView(self) as LGV\n            if (!self.autorunReady) {\n              return\n            }\n\n            const { colorBy, tagsReady } = self\n            const { staticBlocks } = view\n            if (colorBy?.tag && !tagsReady) {\n              const vals = await getUniqueTags({\n                self,\n                tag: colorBy.tag,\n                blocks: staticBlocks,\n              })\n              if (isAlive(self)) {\n                self.updateColorTagMap(vals)\n                self.setTagsReady(true)\n              }\n            } else {\n              self.setTagsReady(true)\n            }\n          },\n          { delay: 1000 },\n        )\n\n        // autorun synchronizes featureUnderMouse with featureIdUnderMouse\n        // asynchronously. this is needed due to how we do not serialize all\n        // features from the BAM/CRAM over the rpc\n        addDisposer(\n          self,\n          autorun(async () => {\n            const session = getSession(self)\n            try {\n              const featureId = self.featureIdUnderMouse\n              if (self.featureUnderMouse?.id() !== featureId) {\n                if (!featureId) {\n                  self.setFeatureUnderMouse(undefined)\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await session.rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId,\n                      sessionId,\n                      layoutId: getContainingTrack(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: SimpleFeatureSerialized | undefined }\n\n                  // check featureIdUnderMouse is still the same as the\n                  // feature.id that was returned e.g. that the user hasn't\n                  // moused over to a new position during the async operation\n                  // above\n                  if (\n                    isAlive(self) &&\n                    feature &&\n                    self.featureIdUnderMouse === feature.uniqueId\n                  ) {\n                    self.setFeatureUnderMouse(new SimpleFeature(feature))\n                  }\n                }\n              }\n            } catch (e) {\n              console.error(e)\n              session.notifyError(`${e}`, e)\n            }\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (snap) {\n        // @ts-expect-error\n        const { colorBy, colorBySetting, filterBySetting, filterBy, ...rest } =\n          snap\n        return {\n          ...rest,\n          filterBySetting: filterBySetting || filterBy,\n          colorBySetting: colorBySetting || colorBy,\n        }\n      }\n      return snap\n    })\n}\n","import { lazy } from 'react'\n\nimport {\n  ConfigurationReference,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getContainingView, getEnv, getSession } from '@jbrowse/core/util'\nimport ColorLensIcon from '@mui/icons-material/ColorLens'\nimport SwapVertIcon from '@mui/icons-material/SwapVert'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport WorkspacesIcon from '@mui/icons-material/Workspaces'\nimport { observable } from 'mobx'\nimport { types } from 'mobx-state-tree'\n\nimport { SharedLinearPileupDisplayMixin } from './SharedLinearPileupDisplayMixin'\nimport { getColorForModification, modificationData } from '../util'\n\nimport type {\n  ModificationType,\n  ModificationTypeWithColor,\n  SortedBy,\n} from '../shared/types'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst SortByTagDialog = lazy(() => import('./components/SortByTagDialog'))\nconst GroupByDialog = lazy(() => import('./components/GroupByDialog'))\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearPileupDisplay\n * #category display\n * extends\n * - [SharedLinearPileupDisplayMixin](../sharedlinearpileupdisplaymixin)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearPileupDisplay',\n      SharedLinearPileupDisplayMixin(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearPileupDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        showSoftClipping: false,\n        /**\n         * #property\n         */\n        mismatchAlpha: types.maybe(types.boolean),\n\n        /**\n         * #property\n         */\n        sortedBy: types.frozen<SortedBy | undefined>(),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      sortReady: false,\n      /**\n       * #volatile\n       */\n      currSortBpPerPx: 0,\n      /**\n       * #volatile\n       */\n      visibleModifications: observable.map<string, ModificationTypeWithColor>(\n        {},\n      ),\n      /**\n       * #volatile\n       */\n      modificationsReady: false,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCurrSortBpPerPx(n: number) {\n        self.currSortBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      updateVisibleModifications(uniqueModifications: ModificationType[]) {\n        for (const value of uniqueModifications) {\n          if (!self.visibleModifications.has(value.type)) {\n            self.visibleModifications.set(value.type, {\n              ...value,\n              color: getColorForModification(value.type),\n            })\n          }\n        }\n      },\n      /**\n       * #action\n       */\n      setModificationsReady(flag: boolean) {\n        self.modificationsReady = flag\n      },\n      /**\n       * #action\n       */\n      setSortReady(flag: boolean) {\n        self.sortReady = flag\n      },\n      /**\n       * #action\n       */\n      clearSelected() {\n        self.sortedBy = undefined\n      },\n      /**\n       * #action\n       */\n      toggleSoftClipping() {\n        self.showSoftClipping = !self.showSoftClipping\n      },\n      /**\n       * #action\n       */\n      toggleMismatchAlpha() {\n        self.mismatchAlpha = !self.mismatchAlpha\n      },\n      /**\n       * #action\n       */\n      setSortedBy(type: string, tag?: string) {\n        const { centerLineInfo } = getContainingView(self) as LGV\n        if (!centerLineInfo) {\n          return\n        }\n        const { refName, assemblyName, offset } = centerLineInfo\n        const centerBp = Math.round(offset) + 1\n\n        if (centerBp < 0 || !refName) {\n          return\n        }\n\n        self.sortReady = false\n        self.sortedBy = {\n          type,\n          pos: centerBp,\n          refName,\n          assemblyName,\n          tag,\n        }\n      },\n      /**\n       * #action\n       * overrides base from SharedLinearPileupDisplay to make sortReady false\n       * since changing feature height destroys the sort-induced layout\n       */\n      setFeatureHeight(n?: number) {\n        self.sortReady = false\n        self.featureHeight = n\n      },\n    }))\n    .actions(self => {\n      // resets the sort object and refresh whole display on reload\n      const superReload = self.reload\n\n      return {\n        /**\n         * #action\n         */\n        reload() {\n          self.clearSelected()\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get visibleModificationTypes() {\n        return [...self.visibleModifications.keys()]\n      },\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const {\n          featureHeight,\n          noSpacing,\n          trackMaxHeight,\n          mismatchAlpha,\n          rendererTypeName,\n          hideSmallIndels,\n        } = self\n        const configBlob = getConf(self, ['renderers', rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(featureHeight !== undefined ? { height: featureHeight } : {}),\n            ...(hideSmallIndels !== undefined ? { hideSmallIndels } : {}),\n            ...(noSpacing !== undefined ? { noSpacing } : {}),\n            ...(mismatchAlpha !== undefined ? { mismatchAlpha } : {}),\n            ...(trackMaxHeight !== undefined\n              ? { maxHeight: trackMaxHeight }\n              : {}),\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => {\n      const { renderReady: superRenderReady } = self\n      return {\n        /**\n         * #getter\n         */\n        get mismatchAlphaSetting() {\n          return readConfObject(self.rendererConfig, 'mismatchAlpha')\n        },\n        /**\n         * #method\n         */\n        renderReady() {\n          const view = getContainingView(self) as LGV\n          return (\n            self.modificationsReady &&\n            self.currSortBpPerPx === view.bpPerPx &&\n            superRenderReady()\n          )\n        },\n      }\n    })\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderPropsPre: superRenderPropsPre,\n        renderProps: superRenderProps,\n        colorSchemeSubMenuItems: superColorSchemeSubMenuItems,\n      } = self\n\n      return {\n        /**\n         * #method\n         */\n        renderPropsPre() {\n          const { sortedBy, showSoftClipping, visibleModifications } = self\n          const superProps = superRenderPropsPre()\n          return {\n            ...superProps,\n            showSoftClip: showSoftClipping,\n            sortedBy,\n            visibleModifications: Object.fromEntries(\n              visibleModifications.toJSON(),\n            ),\n          }\n        },\n        /**\n         * #method\n         */\n        renderProps() {\n          const { sortReady } = self\n          const result = superRenderProps()\n          return {\n            ...result,\n            notReady: result.notReady || !sortReady,\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Sort by...',\n              icon: SwapVertIcon,\n              disabled: self.showSoftClipping,\n              subMenu: [\n                ...['Start location', 'Read strand', 'Base pair'].map(\n                  option => ({\n                    label: option,\n                    onClick: () => {\n                      self.setSortedBy(option)\n                    },\n                  }),\n                ),\n                {\n                  label: 'Sort by tag...',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SortByTagDialog,\n                      {\n                        model: self,\n                        handleClose,\n                      },\n                    ])\n                  },\n                },\n                {\n                  label: 'Clear sort',\n                  onClick: () => {\n                    self.clearSelected()\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Color by...',\n              icon: ColorLensIcon,\n              subMenu: [\n                {\n                  label: 'Pair orientation',\n                  onClick: () => {\n                    self.setColorScheme({\n                      type: 'pairOrientation',\n                    })\n                  },\n                },\n                {\n                  label: 'Modifications',\n                  type: 'subMenu',\n                  subMenu: self.modificationsReady\n                    ? [\n                        {\n                          label: 'All modifications',\n                          onClick: () => {\n                            self.setColorScheme({\n                              type: 'modifications',\n                            })\n                          },\n                        },\n                        ...self.visibleModificationTypes.map(key => ({\n                          label: `Show only ${modificationData[key]?.name || key}`,\n                          onClick: () => {\n                            self.setColorScheme({\n                              type: 'modifications',\n                              modifications: {\n                                isolatedModification: key,\n                              },\n                            })\n                          },\n                        })),\n                        { type: 'divider' },\n                        {\n                          label: 'All modifications (<50% prob colored blue)',\n                          onClick: () => {\n                            self.setColorScheme({\n                              type: 'modifications',\n                              modifications: {\n                                twoColor: true,\n                              },\n                            })\n                          },\n                        },\n                        ...self.visibleModificationTypes.map(key => ({\n                          label: `Show only ${modificationData[key]?.name || key} (<50% prob colored blue)`,\n                          onClick: () => {\n                            self.setColorScheme({\n                              type: 'modifications',\n                              modifications: {\n                                isolatedModification: key,\n                                twoColor: true,\n                              },\n                            })\n                          },\n                        })),\n                        { type: 'divider' },\n                        {\n                          label: 'All reference CpGs',\n                          onClick: () => {\n                            self.setColorScheme({\n                              type: 'methylation',\n                            })\n                          },\n                        },\n                      ]\n                    : [\n                        {\n                          label: 'Loading modifications...',\n                          onClick: () => {},\n                        },\n                      ],\n                },\n                {\n                  label: 'Insert size',\n                  onClick: () => {\n                    self.setColorScheme({\n                      type: 'insertSize',\n                    })\n                  },\n                },\n                ...superColorSchemeSubMenuItems(),\n              ],\n            },\n            {\n              label: 'Group by...',\n              icon: WorkspacesIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  GroupByDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n            {\n              label: 'Show soft clipping',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSoftClipping,\n              onClick: () => {\n                self.toggleSoftClipping()\n                // if toggling from off to on, will break sort for this track\n                // so clear it\n                if (self.showSoftClipping) {\n                  self.clearSelected()\n                }\n              },\n            },\n            {\n              label: 'Fade mismatches by quality',\n              type: 'checkbox',\n              checked: self.mismatchAlphaSetting,\n              onClick: () => {\n                self.toggleMismatchAlpha()\n              },\n            },\n          ] as const\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('./doAfterAttach')\n            doAfterAttach(self)\n          } catch (e) {\n            getSession(self).notifyError(`${e}`, e)\n            console.error(e)\n          }\n        })()\n      },\n    }))\n}\n\nexport type LinearPileupDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearPileupDisplayModel = Instance<LinearPileupDisplayStateModel>\nexport default stateModelFactory\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport configSchemaFactory from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearPileupDisplay',\n      displayName: 'Pileup display',\n      configSchema,\n      stateModel: modelFactory(configSchema),\n      subDisplay: { type: 'LinearAlignmentsDisplay', lowerPanel: true },\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n\nexport { default as linearPileupDisplayStateModelFactory } from './model'\nexport { default as linearPileupDisplayConfigSchemaFactory } from './configSchema'\nexport { SharedLinearPileupDisplayMixin } from './SharedLinearPileupDisplayMixin'\n","import type React from 'react'\nimport { lazy } from 'react'\n\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  FeatureDensityMixin,\n  TrackHeightMixin,\n} from '@jbrowse/plugin-linear-genome-view'\nimport FilterListIcon from '@mui/icons-material/ClearAll'\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport { types } from 'mobx-state-tree'\n\nimport type { ChainData } from '../shared/fetchChains'\nimport type { ColorBy, FilterBy } from '../shared/types'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst FilterByTagDialog = lazy(\n  () => import('../shared/components/FilterByTagDialog'),\n)\n\n/**\n * #stateModel LinearReadArcsDisplay\n * the arc display is a non-block-based track, so draws to a single canvas and\n * can connect multiple regions\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReadArcsDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearReadArcsDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n\n        /**\n         * #property\n         */\n        lineWidth: types.maybe(types.number),\n\n        /**\n         * #property\n         */\n        jitter: types.maybe(types.number),\n\n        /**\n         * #property\n         */\n        colorBySetting: types.frozen<ColorBy | undefined>(),\n\n        /**\n         * #property\n         */\n        filterBySetting: types.frozen<FilterBy | undefined>(),\n\n        /**\n         * #property\n         */\n        drawInter: true,\n\n        /**\n         * #property\n         */\n        drawLongRange: true,\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      loading: false,\n      /**\n       * #volatile\n       */\n      chainData: undefined as ChainData | undefined,\n      /**\n       * #volatile\n       */\n      lastDrawnOffsetPx: undefined as number | undefined,\n      /**\n       * #volatile\n       */\n      lastDrawnBpPerPx: 0,\n      /**\n       * #volatile\n       */\n      ref: null as HTMLCanvasElement | null,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get colorBy() {\n        return self.colorBySetting ?? getConf(self, 'colorBy')\n      },\n      /**\n       * #getter\n       */\n      get filterBy() {\n        return self.filterBySetting ?? getConf(self, 'filterBy')\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setLastDrawnOffsetPx(n: number) {\n        self.lastDrawnOffsetPx = n\n      },\n      /**\n       * #action\n       */\n      setLastDrawnBpPerPx(n: number) {\n        self.lastDrawnBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      setLoading(f: boolean) {\n        self.loading = f\n      },\n\n      /**\n       * #action\n       */\n      reload() {\n        self.error = undefined\n      },\n      /**\n       * #action\n       * internal, a reference to a HTMLCanvas because we use a autorun to draw\n       * the canvas\n       */\n      setRef(ref: HTMLCanvasElement | null) {\n        self.ref = ref\n      },\n\n      /**\n       * #action\n       */\n      setColorScheme(colorBy: { type: string }) {\n        self.colorBySetting = {\n          ...colorBy,\n        }\n      },\n\n      /**\n       * #action\n       */\n      setChainData(args: ChainData) {\n        self.chainData = args\n      },\n\n      /**\n       * #action\n       */\n      setDrawInter(f: boolean) {\n        self.drawInter = f\n      },\n\n      /**\n       * #action\n       */\n      setDrawLongRange(f: boolean) {\n        self.drawLongRange = f\n      },\n\n      /**\n       * #action\n       */\n      setFilterBy(filter: FilterBy) {\n        self.filterBySetting = {\n          ...filter,\n        }\n      },\n\n      /**\n       * #action\n       * thin, bold, extrabold, etc\n       */\n      setLineWidth(n: number) {\n        self.lineWidth = n\n      },\n\n      /**\n       * #action\n       * jitter val, helpful to jitter the x direction so you see better\n       * evidence when e.g. 100 long reads map to same x position\n       */\n      setJitter(n: number) {\n        self.jitter = n\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get drawn() {\n        return self.lastDrawnOffsetPx !== undefined\n      },\n      /**\n       * #getter\n       */\n      get lineWidthSetting() {\n        return self.lineWidth ?? getConf(self, 'lineWidth')\n      },\n\n      /**\n       * #getter\n       */\n      get jitterVal(): number {\n        return self.jitter ?? getConf(self, 'jitter')\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n      return {\n        /**\n         * #method\n         * only used to tell system it's ready for export\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            notReady: !self.chainData,\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  FilterByTagDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n            {\n              label: 'Line width',\n              subMenu: [\n                {\n                  label: 'Thin',\n                  onClick: () => {\n                    self.setLineWidth(1)\n                  },\n                },\n                {\n                  label: 'Bold',\n                  onClick: () => {\n                    self.setLineWidth(2)\n                  },\n                },\n                {\n                  label: 'Extra bold',\n                  onClick: () => {\n                    self.setLineWidth(5)\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Jitter x-positions',\n              subMenu: [\n                {\n                  type: 'checkbox',\n                  checked: self.jitterVal === 0,\n                  label: 'None',\n                  onClick: () => {\n                    self.setJitter(0)\n                  },\n                },\n                {\n                  type: 'checkbox',\n                  checked: self.jitterVal === 2,\n                  label: 'Small',\n                  onClick: () => {\n                    self.setJitter(2)\n                  },\n                },\n                {\n                  type: 'checkbox',\n                  checked: self.jitterVal === 10,\n                  label: 'Large',\n                  onClick: () => {\n                    self.setJitter(10)\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Draw inter-region vertical lines',\n              type: 'checkbox',\n              checked: self.drawInter,\n              onClick: () => {\n                self.setDrawInter(!self.drawInter)\n              },\n            },\n            {\n              label: 'Draw long range connections',\n              type: 'checkbox',\n              checked: self.drawLongRange,\n              onClick: () => {\n                self.setDrawLongRange(!self.drawLongRange)\n              },\n            },\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Insert size ± 3σ and orientation',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'insertSizeAndOrientation' })\n                  },\n                },\n                {\n                  label: 'Insert size ± 3σ',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'insertSize' })\n                  },\n                },\n                {\n                  label: 'Orientation',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'orientation' })\n                  },\n                },\n                {\n                  label: 'Insert size gradient',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'gradient' })\n                  },\n                },\n              ],\n            },\n          ]\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #method\n       */\n      async renderSvg(opts: {\n        rasterizeLayers?: boolean\n      }): Promise<React.ReactNode> {\n        const { renderSvg } = await import('../shared/renderSvgUtil')\n        const { drawFeats } = await import('./drawFeats')\n        return renderSvg(self as LinearReadArcsDisplayModel, opts, drawFeats)\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('../shared/afterAttach')\n            const { drawFeats } = await import('./drawFeats')\n            doAfterAttach(self, drawFeats)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n    }))\n}\n\nexport type LinearReadArcsDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearReadArcsDisplayModel =\n  Instance<LinearReadArcsDisplayStateModel>\n\nexport default stateModelFactory\n","import { lazy } from 'react'\n\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaF from './configSchema'\nimport stateModelF from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearReadArcsDisplay',\n      displayName: 'Arc display',\n      configSchema,\n      stateModel: stateModelF(configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      subDisplay: { type: 'LinearAlignmentsDisplay', lowerPanel: true },\n      ReactComponent: lazy(() => import('./components/ReactComponent')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\nimport { defaultFilterFlags } from '../shared/util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearReadArcsDisplay\n */\nfunction configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearReadArcsDisplay',\n    {\n      /**\n       * #slot\n       */\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n\n      /**\n       * #slot\n       */\n      lineWidth: {\n        type: 'number',\n        description: 'set arc line width',\n        defaultValue: 1,\n      },\n\n      /**\n       * #slot\n       */\n      jitter: {\n        type: 'number',\n        description:\n          'jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them',\n        defaultValue: 0,\n      },\n\n      /**\n       * #slot\n       */\n      colorBy: {\n        type: 'frozen',\n        defaultValue: { type: 'insertSizeAndOrientation' },\n      },\n      /**\n       * #slot\n       */\n      filterBy: {\n        type: 'frozen',\n        defaultValue: defaultFilterFlags,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearReadCloudDisplay\n */\nfunction configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearReadCloudDisplay',\n    {\n      /**\n       * #slot\n       */\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n\n      /**\n       * #slot\n       */\n      featureHeight: {\n        type: 'number',\n        defaultValue: 7,\n      },\n\n      /**\n       * #slot\n       */\n      colorBy: {\n        type: 'frozen',\n        defaultValue: { type: 'insertSizeAndOrientation' },\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import type React from 'react'\nimport { lazy } from 'react'\n\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  FeatureDensityMixin,\n  TrackHeightMixin,\n} from '@jbrowse/plugin-linear-genome-view'\nimport FilterListIcon from '@mui/icons-material/ClearAll'\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport { types } from 'mobx-state-tree'\n\nimport type { ChainData } from '../shared/fetchChains'\nimport type { ColorBy, FilterBy } from '../shared/types'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Instance } from 'mobx-state-tree'\n\n// async\nconst FilterByTagDialog = lazy(\n  () => import('../shared/components/FilterByTagDialog'),\n)\n\n/**\n * #stateModel LinearReadCloudDisplay\n * it is not a block based track, hence not BaseLinearDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReadCloudDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearReadCloudDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n\n        /**\n         * #property\n         */\n        filterBySetting: types.frozen<FilterBy | undefined>(),\n\n        /**\n         * #property\n         */\n        colorBySetting: types.frozen<ColorBy | undefined>(),\n\n        /**\n         * #property\n         */\n        drawSingletons: true,\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      loading: false,\n      /**\n       * #volatile\n       */\n      chainData: undefined as ChainData | undefined,\n      /**\n       * #volatile\n       */\n      lastDrawnOffsetPx: undefined as number | undefined,\n      /**\n       * #volatile\n       */\n      lastDrawnBpPerPx: 0,\n      /**\n       * #volatile\n       */\n      ref: null as HTMLCanvasElement | null,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get colorBy() {\n        return self.colorBySetting ?? getConf(self, 'colorBy')\n      },\n      /**\n       * #getter\n       */\n      get filterBy() {\n        return self.filterBySetting ?? getConf(self, 'filterBy')\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setDrawSingletons(f: boolean) {\n        self.drawSingletons = f\n      },\n      /**\n       * #action\n       */\n      setLastDrawnOffsetPx(n: number) {\n        self.lastDrawnOffsetPx = n\n      },\n      /**\n       * #action\n       */\n      setLastDrawnBpPerPx(n: number) {\n        self.lastDrawnBpPerPx = n\n      },\n\n      /**\n       * #action\n       */\n      setLoading(f: boolean) {\n        self.loading = f\n      },\n      /**\n       * #action\n       */\n      reload() {\n        self.error = undefined\n      },\n      /**\n       * #action\n       * internal, a reference to a HTMLCanvas because we use a autorun to draw\n       * the canvas\n       */\n      setRef(ref: HTMLCanvasElement | null) {\n        self.ref = ref\n      },\n\n      setColorScheme(colorBy: { type: string }) {\n        self.colorBySetting = {\n          ...colorBy,\n        }\n      },\n\n      /**\n       * #action\n       */\n      setChainData(args: ChainData) {\n        self.chainData = args\n      },\n\n      /**\n       * #action\n       */\n      setFilterBy(filter: FilterBy) {\n        self.filterBySetting = {\n          ...filter,\n        }\n      },\n    }))\n    .views(self => ({\n      get drawn() {\n        return self.lastDrawnOffsetPx !== undefined\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n\n      return {\n        // we don't use a server side renderer, so this fills in minimal\n        // info so as not to crash\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            notReady: !self.chainData,\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Draw singletons',\n              type: 'checkbox',\n              checked: self.drawSingletons,\n              onClick: () => {\n                self.setDrawSingletons(!self.drawSingletons)\n              },\n            },\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  FilterByTagDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Insert size ± 3σ and orientation',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'insertSizeAndOrientation' })\n                  },\n                },\n                {\n                  label: 'Insert size ± 3σ',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'insertSize' })\n                  },\n                },\n                {\n                  label: 'Orientation',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'orientation' })\n                  },\n                },\n                {\n                  label: 'Insert size gradient',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'gradient' })\n                  },\n                },\n              ],\n            },\n          ]\n        },\n\n        /**\n         * #method\n         */\n        async renderSvg(opts: {\n          rasterizeLayers?: boolean\n        }): Promise<React.ReactNode> {\n          const { renderSvg } = await import('../shared/renderSvgUtil')\n          const { drawFeats } = await import('./drawFeats')\n          return renderSvg(self as LinearReadCloudDisplayModel, opts, drawFeats)\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('../shared/afterAttach')\n            const { drawFeats } = await import('./drawFeats')\n            doAfterAttach(self, drawFeats)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n    }))\n}\n\nexport type LinearReadCloudDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearReadCloudDisplayModel =\n  Instance<LinearReadCloudDisplayStateModel>\n\nexport default stateModelFactory\n","import { lazy } from 'react'\n\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaF from './configSchema'\nimport stateModelF from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearReadCloudDisplay',\n      displayName: 'Read cloud display',\n      configSchema,\n      stateModel: stateModelF(configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      subDisplay: { type: 'LinearAlignmentsDisplay', lowerPanel: true },\n      ReactComponent: lazy(() => import('./components/ReactComponent')),\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport { observable } from 'mobx'\nimport { cast, getEnv, isAlive, types } from 'mobx-state-tree'\n\nimport { getUniqueModifications } from '../shared/getUniqueModifications'\nimport { createAutorun, getColorForModification } from '../util'\n\nimport type {\n  ColorBy,\n  FilterBy,\n  ModificationType,\n  ModificationTypeWithColor,\n} from '../shared/types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// lazies\nconst Tooltip = lazy(() => import('./components/Tooltip'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([['snpcoverage', 'SNPCoverageRenderer']])\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearSNPCoverageDisplay\n * extends\n * - [LinearWiggleDisplay](../linearwiggledisplay)\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearSNPCoverageDisplay',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSNPCoverageDisplay'),\n        /**\n         * #property\n         */\n        showInterbaseCounts: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        showInterbaseIndicators: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        showArcs: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        filterBySetting: types.frozen<FilterBy | undefined>(),\n        /**\n         * #property\n         */\n        colorBySetting: types.frozen<ColorBy | undefined>(),\n        /**\n         * #property\n         */\n        jexlFilters: types.optional(types.array(types.string), []),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      visibleModifications: observable.map<string, ModificationTypeWithColor>(\n        {},\n      ),\n      /**\n       * #volatile\n       */\n      modificationsReady: false,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get colorBy() {\n        return self.colorBySetting ?? getConf(self, 'colorBy')\n      },\n\n      /**\n       * #getter\n       */\n      get filterBy() {\n        return self.filterBySetting ?? getConf(self, 'filterBy')\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n      /**\n       * #action\n       */\n      setFilterBy(filter: FilterBy) {\n        self.filterBySetting = {\n          ...filter,\n        }\n      },\n      /**\n       * #action\n       */\n      setColorScheme(colorBy?: ColorBy) {\n        self.colorBySetting = colorBy\n          ? {\n              ...colorBy,\n            }\n          : undefined\n      },\n      /**\n       * #action\n       */\n      setJexlFilters(filters: string[]) {\n        self.jexlFilters = cast(filters)\n      },\n\n      /**\n       * #action\n       */\n      updateVisibleModifications(uniqueModifications: ModificationType[]) {\n        for (const modification of uniqueModifications) {\n          if (!self.visibleModifications.has(modification.type)) {\n            self.visibleModifications.set(modification.type, {\n              ...modification,\n              color: getColorForModification(modification.type),\n            })\n          }\n        }\n      },\n    }))\n    .views(self => {\n      const { adapterProps: superAdapterProps } = self\n      return {\n        /**\n         * #getter\n         */\n        get rendererConfig() {\n          const configBlob =\n            getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n          const { showArcs, showInterbaseCounts, showInterbaseIndicators } =\n            self\n          return self.rendererType.configSchema.create(\n            {\n              ...configBlob,\n              showInterbaseCounts:\n                showInterbaseCounts ?? configBlob.showInterbaseCounts,\n              showInterbaseIndicators:\n                showInterbaseIndicators ?? configBlob.showInterbaseIndicators,\n              showArcs: showArcs ?? configBlob.showArcs,\n            },\n            getEnv(self),\n          )\n        },\n        /**\n         * #getter\n         */\n        get showArcsSetting() {\n          return (\n            self.showArcs ?? readConfObject(this.rendererConfig, 'showArcs')\n          )\n        },\n        /**\n         * #getter\n         */\n        get showInterbaseCountsSetting() {\n          return (\n            self.showInterbaseCounts ??\n            readConfObject(this.rendererConfig, 'showInterbaseCounts')\n          )\n        },\n        /**\n         * #getter\n         */\n        get showInterbaseIndicatorsSetting() {\n          return (\n            self.showInterbaseIndicators ??\n            readConfObject(this.rendererConfig, 'showInterbaseIndicators')\n          )\n        },\n\n        /**\n         * #getter\n         */\n        get autorunReady() {\n          const view = getContainingView(self) as LGV\n          return (\n            view.initialized &&\n            self.statsReadyAndRegionNotTooLarge &&\n            !self.error\n          )\n        },\n\n        /**\n         * #method\n         */\n        adapterProps() {\n          const superProps = superAdapterProps()\n          const { filters, filterBy } = self\n          return {\n            ...superProps,\n            filters,\n            filterBy,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setModificationsReady(flag: boolean) {\n        self.modificationsReady = flag\n      },\n      /**\n       * #action\n       */\n      setShowInterbaseIndicators(arg: boolean) {\n        self.showInterbaseIndicators = arg\n      },\n      /**\n       * #action\n       */\n      setShowInterbaseCounts(arg: boolean) {\n        self.showInterbaseCounts = arg\n      },\n      /**\n       * #action\n       */\n      setShowArcs(arg: boolean) {\n        self.showArcs = arg\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        createAutorun(\n          self,\n          async () => {\n            self.setModificationsReady(false)\n            if (!self.autorunReady) {\n              return\n            }\n            const view = getContainingView(self) as LGV\n            const { staticBlocks } = view\n            const { colorBy } = self\n            if (colorBy?.type === 'modifications') {\n              const vals = await getUniqueModifications({\n                model: self,\n                adapterConfig: getConf(self.parentTrack, 'adapter'),\n                blocks: staticBlocks,\n              })\n              if (isAlive(self)) {\n                self.updateVisibleModifications(vals)\n                self.setModificationsReady(true)\n              }\n            } else {\n              self.setModificationsReady(true)\n            }\n          },\n          { delay: 1000 },\n        )\n      },\n    }))\n\n    .views(self => {\n      const {\n        renderProps: superRenderProps,\n        trackMenuItems: superTrackMenuItems,\n      } = self\n      return {\n        /**\n         * #getter\n         */\n        renderReady() {\n          const superProps = superRenderProps()\n          return !superProps.notReady && self.modificationsReady\n        },\n\n        /**\n         * #method\n         */\n        renderProps() {\n          const { colorBy, visibleModifications } = self\n          return {\n            ...superRenderProps(),\n            notReady: !this.renderReady(),\n            colorBy,\n            visibleModifications: Object.fromEntries(\n              visibleModifications.toJSON(),\n            ),\n          }\n        },\n        /**\n         * #getter\n         */\n        get TooltipComponent() {\n          return Tooltip\n        },\n\n        /**\n         * #getter\n         */\n        get adapterConfig() {\n          const subadapter = getConf(self.parentTrack, 'adapter')\n          return {\n            type: 'SNPCoverageAdapter',\n            subadapter,\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return rendererTypes.get('snpcoverage')\n        },\n\n        /**\n         * #getter\n         */\n        get graphType() {\n          return true\n        },\n\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          return []\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show insertion/clipping indicators',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showInterbaseIndicatorsSetting,\n              onClick: () => {\n                self.setShowInterbaseIndicators(\n                  !self.showInterbaseIndicatorsSetting,\n                )\n              },\n            },\n            {\n              label: 'Show insertion/clipping counts',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showInterbaseCountsSetting,\n              onClick: () => {\n                self.setShowInterbaseCounts(!self.showInterbaseCountsSetting)\n              },\n            },\n            {\n              label: 'Show arcs',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showArcsSetting,\n              onClick: () => {\n                self.setShowArcs(!self.showArcsSetting)\n              },\n            },\n          ]\n        },\n\n        /**\n         * #getter\n         */\n        get filters() {\n          return new SerializableFilterChain({ filters: self.jexlFilters })\n        },\n      }\n    })\n}\n\nexport type SNPCoverageDisplayModel = ReturnType<typeof stateModelFactory>\n\nexport default stateModelFactory\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\n\nimport configSchemaFactory from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearSNPCoverageDisplay',\n      displayName: 'SNPCoverage display',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport { defaultFilterFlags } from '../shared/util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearSNPCoverageDisplay\n *\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function SNPCoverageConfigFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSNPCoverageDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description:\n          'performs local autoscaling (no other options for SNP Coverage available)',\n      },\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      /**\n       * #slot\n       */\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n      /**\n       * #slot\n       */\n      multiTicks: {\n        type: 'boolean',\n        description: 'Display multiple values for the ticks',\n        defaultValue: false,\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        SNPCoverageRenderer: pluginManager.getRendererType(\n          'SNPCoverageRenderer',\n        )!.configSchema,\n      }),\n      /**\n       * #slot\n       */\n      colorBy: {\n        type: 'frozen',\n        description: 'color scheme to use',\n        defaultValue: {\n          type: 'normal',\n        },\n      },\n\n      /**\n       * #slot\n       */\n      filterBy: {\n        type: 'frozen',\n        description: 'default filters to use',\n        defaultValue: defaultFilterFlags,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\n\nimport type { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\n\n// specialized get features to return limited data about alignments\nexport default abstract class PileupBaseRPC extends RpcMethodType {\n  async serializeArguments(\n    args: RenderArgs & {\n      stopToken?: string\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriver: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    return super.serializeArguments(renamedArgs, rpcDriver)\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { dedupe, groupBy } from '@jbrowse/core/util'\nimport { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport { getClip } from '../../MismatchParser'\nimport PileupBaseRPC from '../base'\nimport { filterForPairs, getInsertSizeStats } from '../util'\n\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { Region } from '@jbrowse/core/util'\n\n// specialized get features to return limited data about alignments\nexport default class PileupGetReducedFeatures extends PileupBaseRPC {\n  name = 'PileupGetReducedFeatures'\n\n  async execute(\n    args: {\n      adapterConfig: Record<string, unknown>\n      stopToken?: string\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriver: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const featuresArray = await firstValueFrom(\n      dataAdapter\n        .getFeaturesInMultipleRegions(regions, deserializedArgs)\n        .pipe(toArray()),\n    )\n\n    const reduced = dedupe(\n      featuresArray.map(f => ({\n        id: f.id(),\n        refName: f.get('refName'),\n        name: f.get('name'),\n        start: f.get('start'),\n        strand: f.get('strand'),\n        end: f.get('end'),\n        flags: f.get('flags'),\n        tlen: f.get('template_length'),\n        pair_orientation: f.get('pair_orientation'),\n        next_ref: f.get('next_ref'),\n        next_pos: f.get('next_pos'),\n        clipPos: getClip(f.get('CIGAR'), f.get('strand')),\n        SA: f.get('tags')?.SA,\n      })),\n      f => f.id,\n    )\n\n    const filtered = filterForPairs(reduced)\n    const stats = filtered.length ? getInsertSizeStats(filtered) : undefined\n    const chains = groupBy(reduced, f => f.name)\n\n    return {\n      chains: Object.values(chains),\n      stats,\n      hasPaired: !!stats,\n      containsNoTransferables: true,\n    }\n  }\n}\n","import type { ReducedFeature } from '../shared/fetchChains'\n\nexport function getInsertSizeStats(features: ReducedFeature[]) {\n  const filtered = features.map(f => Math.abs(f.tlen))\n  const sum = filtered.reduce((a, b) => a + b, 0)\n  const sum2 = filtered.map(a => a * a).reduce((a, b) => a + b, 0)\n  const total = filtered.length\n  const avg = sum / total\n  const sd = Math.sqrt((total * sum2 - sum * sum) / (total * total))\n  const upper = avg + 4 * sd\n  const lower = avg - 3 * sd\n  return { upper, lower, avg, sd }\n}\n\nexport function filterForPairs(features: ReducedFeature[]) {\n  return features.filter(\n    f => f.flags & 2 && !(f.flags & 256) && !(f.flags & 2048),\n  )\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport { getModTypes } from '../../ModificationParser'\nimport { getTagAlt } from '../../util'\nimport PileupBaseRPC from '../base'\n\nimport type { ModificationType } from '../../shared/types'\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { Region } from '@jbrowse/core/util'\n\nexport default class PileupGetVisibleModifications extends PileupBaseRPC {\n  name = 'PileupGetVisibleModifications'\n\n  async execute(\n    args: {\n      adapterConfig: Record<string, unknown>\n      stopToken?: string\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriver: string,\n  ) {\n    const deserializeArguments = await this.deserializeArguments(\n      args,\n      rpcDriver,\n    )\n    const { adapterConfig, sessionId, regions } = deserializeArguments\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const featuresArray = await firstValueFrom(\n      dataAdapter\n        .getFeaturesInMultipleRegions(regions, deserializeArguments)\n        .pipe(toArray()),\n    )\n\n    const uniqueModifications = new Map<string, ModificationType>()\n    for (const feat of featuresArray) {\n      for (const mod of getModTypes(getTagAlt(feat, 'MM', 'Mm') || '')) {\n        if (!uniqueModifications.has(mod.type)) {\n          uniqueModifications.set(mod.type, mod)\n        }\n      }\n    }\n    return [...uniqueModifications.values()]\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport PileupBaseRPC from '../base'\n\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { Region } from '@jbrowse/core/util'\n\nexport default class PileupGetGlobalValueForTag extends PileupBaseRPC {\n  name = 'PileupGetGlobalValueForTag'\n\n  async execute(\n    args: {\n      adapterConfig: Record<string, unknown>\n      stopToken?: string\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriver: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { adapterConfig, sessionId, regions, tag } = deserializedArgs\n\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(\n      regions,\n      deserializedArgs,\n    )\n    const featuresArray = await firstValueFrom(features.pipe(toArray()))\n    return [\n      ...new Set(\n        featuresArray\n          .map(feature => feature.get('tags')?.[tag])\n          .filter(f => f !== undefined)\n          .map(f => `${f}`),\n      ),\n    ]\n  }\n}\n","import {\n  PileupGetGlobalValueForTag,\n  PileupGetReducedFeatures,\n  PileupGetVisibleModifications,\n} from './rpcMethods'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function PileupRPCMethodsF(pm: PluginManager) {\n  pm.addRpcMethod(() => new PileupGetGlobalValueForTag(pm))\n  pm.addRpcMethod(() => new PileupGetVisibleModifications(pm))\n  pm.addRpcMethod(() => new PileupGetReducedFeatures(pm))\n}\n","import { LayoutSession } from '@jbrowse/core/pluggableElementTypes/renderers/LayoutSession'\nimport deepEqual from 'fast-deep-equal'\n\nimport type { FilterBy, SortedBy } from '../shared/types'\nimport type {\n  CachedLayout,\n  LayoutSessionProps,\n} from '@jbrowse/core/pluggableElementTypes/renderers/LayoutSession'\nimport type GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\nimport type MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\n\nexport interface PileupLayoutSessionProps extends LayoutSessionProps {\n  filterBy: FilterBy\n  sortedBy: SortedBy\n  showSoftClip: boolean\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\n\ninterface CachedPileupLayout extends CachedLayout {\n  props: PileupLayoutSessionProps\n}\n\nexport class PileupLayoutSession extends LayoutSession {\n  props: PileupLayoutSessionProps\n\n  cachedLayout: CachedPileupLayout | undefined\n\n  constructor(props: PileupLayoutSessionProps) {\n    super(props)\n    this.props = props\n  }\n\n  update(props: PileupLayoutSessionProps) {\n    super.update(props)\n    this.props = props\n    return this\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedPileupLayout) {\n    return (\n      super.cachedLayoutIsValid(cachedLayout) &&\n      this.props.showSoftClip === cachedLayout.props.showSoftClip &&\n      deepEqual(this.props.sortedBy, cachedLayout.props.sortedBy) &&\n      deepEqual(this.props.filterBy, cachedLayout.props.filterBy)\n    )\n  }\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        props: this.props,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { renderToAbstractCanvas, updateStatus } from '@jbrowse/core/util'\n\nimport { PileupLayoutSession } from './PileupLayoutSession'\nimport { fetchSequence } from '../util'\nimport { layoutFeats } from './layoutFeatures'\n\nimport type { PileupLayoutSessionProps } from './PileupLayoutSession'\nimport type { RenderArgsDeserialized } from './types'\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { Region } from '@jbrowse/core/util'\n\nexport default class PileupRenderer extends BoxRendererType {\n  supportsSVG = true\n\n  async fetchSequence(renderProps: RenderArgsDeserialized, region: Region) {\n    const { sessionId, adapterConfig } = renderProps\n    const { sequenceAdapter } = adapterConfig\n    if (!sequenceAdapter) {\n      return undefined\n    }\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      sequenceAdapter,\n    )\n    return fetchSequence(\n      {\n        ...region,\n        start: Math.max(0, region.start - 1),\n        end: region.end + 1,\n      },\n      dataAdapter as BaseFeatureDataAdapter,\n    )\n  }\n\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    const { config, showSoftClip } = renderArgs\n    const { start, end } = region\n    const maxClippingSize = readConfObject(config, 'maxClippingSize')\n    const bpExpansion = showSoftClip ? Math.round(maxClippingSize) : 0\n\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(region as Omit<typeof region, symbol>),\n      start: Math.floor(Math.max(start - bpExpansion, 0)),\n      end: Math.ceil(end + bpExpansion),\n    }\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const layout = this.createLayoutInWorker(renderProps)\n    const { statusCallback = () => {}, colorBy, regions, bpPerPx } = renderProps\n    const region = regions[0]!\n    const width = (region.end - region.start) / bpPerPx\n    const { layoutRecords, height } = await updateStatus(\n      'Creating layout',\n      statusCallback,\n      () =>\n        layoutFeats({\n          ...renderProps,\n          features,\n          layout,\n        }),\n    )\n\n    const res = await updateStatus(\n      'Rendering alignments',\n      statusCallback,\n      async () => {\n        const regionSequence =\n          colorBy?.type === 'methylation' && features.size\n            ? await this.fetchSequence(renderProps, region)\n            : undefined\n        const { makeImageData } = await import('./makeImageData')\n\n        return renderToAbstractCanvas(width, height, renderProps, ctx => {\n          makeImageData({\n            ctx,\n            layoutRecords,\n            canvasWidth: width,\n            renderArgs: {\n              ...renderProps,\n              layout,\n              features,\n              regionSequence,\n            },\n          })\n          return undefined\n        })\n      },\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features: new Map(),\n      layout,\n      height,\n      width,\n      maxHeightReached: layout.maxHeightReached,\n      containsNoTransferables: true,\n    }\n  }\n\n  createLayoutSession(args: PileupLayoutSessionProps) {\n    return new PileupLayoutSession(args)\n  }\n}\n\nexport type {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsDeserialized,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { iterMap, notEmpty } from '@jbrowse/core/util'\n\nimport { layoutFeature } from './layoutFeature'\nimport { sortFeature } from './sortUtil'\n\nimport type { PreProcessedRenderArgs } from './types'\n\n// layout determines the height of the canvas that we use to render\nexport function layoutFeats(props: PreProcessedRenderArgs) {\n  const { layout, features, sortedBy, config, bpPerPx, showSoftClip, regions } =\n    props\n  const region = regions[0]!\n  const featureMap =\n    sortedBy?.type && region.start === sortedBy.pos\n      ? sortFeature(features, sortedBy)\n      : features\n\n  const heightPx = readConfObject(config, 'height')\n  const displayMode = readConfObject(config, 'displayMode')\n  const layoutRecords = iterMap(\n    featureMap.values(),\n    feature =>\n      layoutFeature({\n        feature,\n        layout,\n        bpPerPx,\n        region,\n        showSoftClip,\n        heightPx,\n        displayMode,\n      }),\n    featureMap.size,\n  ).filter(notEmpty)\n\n  return {\n    layoutRecords,\n    height: Math.max(layout.getTotalHeight(), 1),\n  }\n}\n","import { doesIntersect2 } from '@jbrowse/core/util'\n\nimport type { Mismatch, SortedBy } from '../shared/types'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport const sortFeature = (\n  features: Map<string, Feature>,\n  sortedBy: SortedBy,\n) => {\n  const featureArray = Array.from(features.values())\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // only sort on features that intersect center line, append those outside post-sort\n  for (const innerArray of featureArray) {\n    const feature = innerArray\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(innerArray)\n    } else {\n      featuresOutsideCenter.push(innerArray)\n    }\n  }\n\n  const isCram = featureArray.length ? featureArray[0]!.get('tags') : false\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    case 'tag': {\n      const tag = sortedBy.tag!\n      const getTag = (f: Feature, t: string) => {\n        return isCram ? f.get('tags')[t] : f.get(t)\n      }\n      const isString =\n        featuresInCenterLine[0] &&\n        typeof getTag(featuresInCenterLine[0], tag) === 'string'\n      if (isString) {\n        featuresInCenterLine.sort((a, b) =>\n          getTag(b, tag).localeCompare(getTag(a, tag)),\n        )\n      } else {\n        featuresInCenterLine.sort(\n          (a, b) => (getTag(b, tag) || 0) - (getTag(a, tag) || 0),\n        )\n      }\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseSortArray: [string, Mismatch][] = []\n      for (const feature of featuresInCenterLine) {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        for (const m of mismatches) {\n          const start = feature.get('start')\n          const offset = start + m.start + 1\n          const consuming = m.type === 'insertion' || m.type === 'softclip'\n          const len = consuming ? 0 : m.length\n          if (pos >= offset && pos < offset + len) {\n            baseSortArray.push([feature.id(), m])\n          }\n        }\n      }\n\n      const baseMap = new Map(baseSortArray)\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode = bMismatch?.base.toUpperCase()\n        const bcode = aMismatch?.base.toUpperCase()\n        return acode === bcode && acode === '*'\n          ? // @ts-expect-error\n            aMismatch.length - bMismatch.length\n          : (acode ? acode.charCodeAt(0) : 0) -\n              (bcode ? bcode.charCodeAt(0) : 0)\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  return new Map(\n    [...featuresInCenterLine, ...featuresOutsideCenter].map(feature => [\n      feature.id(),\n      feature,\n    ]),\n  )\n}\n","import { bpSpanPx } from '@jbrowse/core/util'\n\nimport type { Mismatch } from '../shared/types'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type { BaseLayout } from '@jbrowse/core/util/layouts'\n\nexport interface LayoutRecord {\n  feature: Feature\n  leftPx: number\n  rightPx: number\n  topPx: number\n  heightPx: number\n}\n\nexport function layoutFeature({\n  feature,\n  layout,\n  bpPerPx,\n  region,\n  showSoftClip,\n  heightPx,\n  displayMode,\n}: {\n  feature: Feature\n  layout: BaseLayout<Feature>\n  bpPerPx: number\n  region: Region\n  showSoftClip?: boolean\n  heightPx: number\n  displayMode: string\n}): LayoutRecord | null {\n  let expansionBefore = 0\n  let expansionAfter = 0\n\n  // Expand the start and end of feature when softclipping enabled\n  if (showSoftClip) {\n    const mismatches = feature.get('mismatches') as Mismatch[]\n    const seq = feature.get('seq') as string\n    if (seq) {\n      for (const { type, start, cliplen = 0 } of mismatches) {\n        if (type === 'softclip') {\n          if (start === 0) {\n            expansionBefore = cliplen\n          } else {\n            expansionAfter = cliplen\n          }\n        }\n      }\n    }\n  }\n\n  const [leftPx, rightPx] = bpSpanPx(\n    feature.get('start') - expansionBefore,\n    feature.get('end') + expansionAfter,\n    region,\n    bpPerPx,\n  )\n\n  if (displayMode === 'compact') {\n    heightPx /= 3\n  }\n  if (feature.get('refName') !== region.refName) {\n    throw new Error(\n      `feature ${feature.id()} is not on the current region's reference sequence ${\n        region.refName\n      }`,\n    )\n  }\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start') - expansionBefore,\n    feature.get('end') + expansionAfter,\n    heightPx,\n    feature,\n  )\n  if (topPx === null) {\n    return null\n  }\n\n  return {\n    feature,\n    leftPx,\n    rightPx,\n    topPx: displayMode === 'collapse' ? 0 : topPx,\n    heightPx,\n  }\n}\n","import { useEffect, useRef, useState } from 'react'\n\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { Region } from '@jbrowse/core/util/types'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst PileupRendering = observer(function (props: {\n  blockKey: string\n  displayModel?: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: {\n    type: string\n    pos: number\n    refName: string\n  }\n  colorBy?: {\n    type: string\n    tag?: string\n  }\n  filterBy?: {\n    tagFilter?: { tag: string }\n  }\n  onMouseMove?: (event: React.MouseEvent, featureId?: string) => void\n}) {\n  const {\n    onMouseMove,\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n    colorBy,\n    filterBy,\n  } = props\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel || {}\n  const [firstRender, setFirstRender] = useState(false)\n  useEffect(() => {\n    setFirstRender(true)\n  }, [])\n\n  const region = regions[0]!\n  const ref = useRef<HTMLDivElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n  const selectedRect = selectedFeatureId\n    ? displayModel?.getFeatureByID(blockKey, selectedFeatureId)\n    : undefined\n\n  const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n  const highlightedRect = highlightedFeature\n    ? displayModel?.getFeatureByID(blockKey, highlightedFeature)\n    : undefined\n\n  function makeRect(r: [number, number, number, number], offset = 2) {\n    const [leftBp, topPx, rightBp, bottomPx] = r\n    const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n    const rectTop = Math.round(topPx)\n    const rectHeight = Math.round(bottomPx - topPx)\n    return {\n      left: leftPx - offset,\n      top: rectTop - offset,\n      width: rightPx - leftPx,\n      height: rectHeight,\n    }\n  }\n  const selected = selectedRect ? makeRect(selectedRect) : undefined\n  const highlight = highlightedRect ? makeRect(highlightedRect, 0) : undefined\n\n  function onMouseDown(event: React.MouseEvent) {\n    setMouseIsDown(true)\n    setMovedDuringLastMouseDown(false)\n    callMouseHandler('MouseDown', event)\n  }\n\n  function onMouseEnter(event: React.MouseEvent) {\n    callMouseHandler('MouseEnter', event)\n  }\n\n  function onMouseOut(event: React.MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onMouseOver(event: React.MouseEvent) {\n    callMouseHandler('MouseOver', event)\n  }\n\n  function onMouseUp(event: React.MouseEvent) {\n    setMouseIsDown(false)\n    callMouseHandler('MouseUp', event)\n  }\n\n  function onClick(event: React.MouseEvent) {\n    if (!movedDuringLastMouseDown) {\n      callMouseHandler('Click', event)\n    }\n  }\n\n  function onMouseLeave(event: React.MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onContextMenu(event: React.MouseEvent) {\n    callMouseHandler('ContextMenu', event)\n  }\n\n  function mouseMove(event: React.MouseEvent) {\n    if (!ref.current) {\n      return\n    }\n    if (mouseIsDown) {\n      setMovedDuringLastMouseDown(true)\n    }\n    const rect = ref.current.getBoundingClientRect()\n    const offsetX = event.clientX - rect.left\n    const offsetY = event.clientY - rect.top\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n\n    onMouseMove?.(\n      event,\n      displayModel?.getFeatureOverlapping(blockKey, clientBp, offsetY),\n    )\n  }\n\n  function callMouseHandler(handlerName: string, event: React.MouseEvent) {\n    // @ts-expect-error\n    const featureHandler = props[`onFeature${handlerName}`]\n    // @ts-expect-error\n    const canvasHandler = props[`on${handlerName}`]\n    if (featureHandler && featureIdUnderMouse) {\n      featureHandler(event, featureIdUnderMouse)\n    } else if (canvasHandler) {\n      canvasHandler(event, featureIdUnderMouse)\n    }\n  }\n\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      ref={ref}\n      data-testid={[\n        'pileup-overlay',\n        sortedBy?.type,\n        colorBy?.type,\n        colorBy?.tag,\n        filterBy?.tagFilter?.tag,\n      ]\n        .filter(f => !!f)\n        .join('-')}\n      style={{ position: 'relative', width: canvasWidth, height }}\n      onMouseDown={event => {\n        onMouseDown(event)\n      }}\n      onMouseEnter={event => {\n        onMouseEnter(event)\n      }}\n      onMouseOut={event => {\n        onMouseOut(event)\n      }}\n      onMouseOver={event => {\n        onMouseOver(event)\n      }}\n      onMouseUp={event => {\n        onMouseUp(event)\n      }}\n      onMouseLeave={event => {\n        onMouseLeave(event)\n      }}\n      onMouseMove={event => {\n        mouseMove(event)\n      }}\n      onClick={event => {\n        onClick(event)\n      }}\n      onContextMenu={event => {\n        onContextMenu(event)\n      }}\n      onFocus={() => {}}\n      onBlur={() => {}}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n      {firstRender && highlight ? (\n        <div\n          style={{\n            position: 'absolute',\n            backgroundColor: '#0003',\n            pointerEvents: 'none',\n            ...highlight,\n          }}\n        />\n      ) : null}\n      {firstRender && selected ? (\n        <div\n          style={{\n            position: 'absolute',\n            border: '2px solid #00b8ff',\n            boxSizing: 'content-box',\n            pointerEvents: 'none',\n            ...selected,\n          }}\n        />\n      ) : null}\n    </div>\n  )\n})\n\nexport default PileupRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config PileupRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PileupRenderer = ConfigurationSchema(\n  'PileupRenderer',\n  {\n    /**\n     * #slot\n     * default magenta here is used to detect the user has not customized this\n     */\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a pileup alignment',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    orientationType: {\n      type: 'stringEnum',\n      model: types.enumeration('orientationType', ['fr', 'rf', 'ff']),\n      defaultValue: 'fr',\n      description:\n        'read sequencer orientation. fr is normal \"reads pointing at each other ---> <--- while some other sequencers can use other options',\n    },\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    /**\n     * #slot\n     */\n    minSubfeatureWidth: {\n      type: 'number',\n      description:\n        'the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1',\n      defaultValue: 1,\n    },\n    /**\n     * #slot\n     */\n    hideSmallIndels: {\n      type: 'boolean',\n      description:\n        'Hides small indels, sometimes occurring in long read sequencing',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a pileup rendering',\n      defaultValue: 1200,\n    },\n    /**\n     * #slot\n     */\n    maxClippingSize: {\n      type: 'integer',\n      description: 'the max clip size to be used in a pileup rendering',\n      defaultValue: 10000,\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'the height of each feature in a pileup alignment',\n      defaultValue: 7,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    noSpacing: {\n      type: 'boolean',\n      description: 'remove spacing between features',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    largeInsertionIndicatorScale: {\n      type: 'number',\n      description:\n        'scale at which to draw the large insertion indicators (bp/pixel)',\n      defaultValue: 10,\n    },\n    /**\n     * #slot\n     */\n    mismatchAlpha: {\n      type: 'boolean',\n      defaultValue: false,\n      description: 'Fade low quality mismatches',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default PileupRenderer\n","import PileupRenderer from './PileupRenderer'\nimport ReactComponent from './components/PileupRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(() => {\n    return new PileupRenderer({\n      name: 'PileupRenderer',\n      displayName: 'Pileup renderer',\n      ReactComponent,\n      configSchema,\n      pluginManager,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SNPCoverageAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'SNPCoverageAdapter',\n  {\n    /**\n     * #slot\n     * normally refers to a BAM or CRAM adapter\n     */\n    subadapter: {\n      type: 'frozen',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SNPCoverageAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'SNPCoverageAdapter',\n      displayName: 'SNPCoverage adapter',\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n      getAdapterClass: () =>\n        import('./SNPCoverageAdapter').then(r => r.default),\n      configSchema,\n    })\n  })\n}\n","import { updateStatus } from '@jbrowse/core/util'\nimport { WiggleBaseRenderer } from '@jbrowse/plugin-wiggle'\n\nimport type { RenderArgsDeserializedWithFeatures } from './types'\n\nexport default class SNPCoverageRenderer extends WiggleBaseRenderer {\n  // note: the snps are drawn on linear scale even if the data is drawn in log\n  // scape hence the two different scales being used\n  // @ts-expect-error\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { statusCallback = () => {} } = props\n    const { makeImage } = await import('./makeImage')\n    await updateStatus('Rendering coverage', statusCallback, () =>\n      makeImage(ctx, props),\n    )\n    return undefined\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SNPCoverageRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst SNPCoverageRenderer = ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {\n    /**\n     * #slot\n     */\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    indicatorThreshold: {\n      type: 'number',\n      description:\n        'the proportion of reads containing a insertion/clip indicator',\n      defaultValue: 0.4,\n    },\n    /**\n     * #slot\n     */\n    showArcs: {\n      type: 'boolean',\n      description: 'Draw sashimi-style arcs for intron features',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    showInterbaseCounts: {\n      type: 'boolean',\n      description:\n        'draw count \"upsidedown histogram\" of the interbase events that don\\'t contribute to the coverage count so are not drawn in the normal histogram',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    showInterbaseIndicators: {\n      type: 'boolean',\n      description:\n        'draw a triangular indicator where an event has been detected',\n      defaultValue: true,\n    },\n\n    color: {\n      type: 'color',\n      description: 'Background color for the SNPCoverage renderer',\n      defaultValue: '#d3d3d3',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default SNPCoverageRenderer\n","import { WiggleRendering } from '@jbrowse/plugin-wiggle'\n\nimport SNPCoverageRenderer from './SNPCoverageRenderer'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new SNPCoverageRenderer({\n        name: 'SNPCoverageRenderer',\n        ReactComponent: WiggleRendering,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport AlignmentsFeatureWidgetF from './AlignmentsFeatureDetail'\nimport AlignmentsTrackF from './AlignmentsTrack'\nimport CramAdapterF from './BamAdapter'\nimport BamAdapterF from './CramAdapter'\nimport GuessAlignmentsTypesF from './GuessAlignmentsTypes'\nimport HtsgetBamAdapterF from './HtsgetBamAdapter'\nimport LinearAlignmentsDisplayF from './LinearAlignmentsDisplay'\nimport LinearPileupDisplayF from './LinearPileupDisplay'\nimport LinearReadArcsDisplayF from './LinearReadArcsDisplay'\nimport LinearReadCloudDisplayF from './LinearReadCloudDisplay'\nimport LinearSNPCoverageDisplayF from './LinearSNPCoverageDisplay'\nimport PileupRPCMethodsF from './PileupRPC'\nimport PileupRendererF from './PileupRenderer'\nimport SNPCoverageAdapterF from './SNPCoverageAdapter'\nimport SNPCoverageRendererF from './SNPCoverageRenderer'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class AlignmentsPlugin extends Plugin {\n  name = 'AlignmentsPlugin'\n\n  install(pluginManager: PluginManager) {\n    ;[\n      CramAdapterF,\n      BamAdapterF,\n      LinearPileupDisplayF,\n      LinearSNPCoverageDisplayF,\n      AlignmentsTrackF,\n      SNPCoverageAdapterF,\n      HtsgetBamAdapterF,\n      PileupRendererF,\n      PileupRPCMethodsF,\n      SNPCoverageRendererF,\n      LinearReadArcsDisplayF,\n      LinearReadCloudDisplayF,\n      LinearAlignmentsDisplayF,\n      AlignmentsFeatureWidgetF,\n      GuessAlignmentsTypesF,\n    ].map(f => {\n      f(pluginManager)\n    })\n  }\n}\n\nexport {\n  SharedLinearPileupDisplayMixin,\n  linearPileupDisplayConfigSchemaFactory,\n  linearPileupDisplayStateModelFactory,\n} from './LinearPileupDisplay'\nexport { type LinearPileupDisplayModel } from './LinearPileupDisplay/model'\nexport * as MismatchParser from './MismatchParser'\n","import { assembleLocString, parseLocString } from '@jbrowse/core/util'\n\nimport type { AssemblyManager, ParsedLocString } from '@jbrowse/core/util'\nimport type { BaseBlock } from '@jbrowse/core/util/blockTypes'\n\n/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = Number.parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1]!,\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  start: number,\n  end: number,\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n\n  let minBase = start\n  let maxBase = end\n\n  if (bpPerPx < 0) {\n    ;[minBase, maxBase] = [maxBase, minBase]\n  }\n\n  // add 20px additional on the right and left to allow us to draw the ends\n  // of labels that lie a little outside our region\n  minBase -= Math.abs(20 * bpPerPx) - 1\n  maxBase += Math.abs(20 * bpPerPx) + 1\n\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  let index = 0\n  const ticks = []\n  for (\n    let base = Math.floor(minBase / iterPitch) * iterPitch;\n    base < Math.ceil(maxBase / iterPitch) * iterPitch + 1;\n    base += iterPitch\n  ) {\n    if (emitMinor && base % (gridPitch.majorPitch * 2)) {\n      ticks.push({ type: 'minor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor && !(base % (gridPitch.majorPitch * 2))) {\n      ticks.push({ type: 'major', base: base - 1, index })\n      index += 1\n    }\n  }\n  return ticks\n}\n\n/**\n * Generate location objects for a set of parsed locstrings, which includes\n * translating the refNames to assembly-canonical refNames and adding the\n * 'parentRegion'\n *\n * Used by navToLocations and navToLocString\n */\nexport async function generateLocations({\n  regions,\n  assemblyManager,\n  assemblyName,\n  grow,\n}: {\n  regions: ParsedLocString[]\n  assemblyManager: AssemblyManager\n  assemblyName?: string\n  grow?: number\n}) {\n  return Promise.all(\n    regions.map(async region => {\n      const asmName = region.assemblyName || assemblyName\n      if (!asmName) {\n        throw new Error('no assembly provided')\n      }\n      const asm = await assemblyManager.waitForAssembly(asmName)\n      const { refName } = region\n      if (!asm) {\n        throw new Error(`assembly ${asmName} not found`)\n      }\n      const { regions } = asm\n      if (!regions) {\n        throw new Error(`regions not loaded yet for ${asmName}`)\n      }\n      const canonicalRefName = asm.getCanonicalRefName(region.refName)\n      if (!canonicalRefName) {\n        throw new Error(`Could not find refName ${refName} in ${asm.name}`)\n      }\n      const parentRegion = regions.find(r => r.refName === canonicalRefName)\n      if (!parentRegion) {\n        throw new Error(`Could not find refName ${refName} in ${asmName}`)\n      }\n\n      const { start, end } = region\n      if (grow && start && end) {\n        const len = end - start\n        const margin = len * grow\n        return {\n          ...(region as Omit<typeof region, symbol>),\n          start: Math.max(0, start - margin),\n          end: end + margin,\n          assemblyName: asmName,\n          parentRegion,\n        }\n      } else {\n        return {\n          ...(region as Omit<typeof region, symbol>),\n          assemblyName: asmName,\n          parentRegion,\n        }\n      }\n    }),\n  )\n}\n\n/**\n * Parses locString or space separated set of locStrings into location objects\n * Example inputs:\n * \"chr1\"\n * \"chr1:1-100\"\n * \"chr1:1..100\"\n * \"chr1 chr2\"\n * \"chr1:1-100 chr2:1-100\"\n * \"chr1 100 200\" equivalent to \"chr1:1-100\"\n *\n * Used by navToLocString\n */\nexport function parseLocStrings(\n  input: string,\n  assemblyName: string,\n  isValidRefName: (str: string, assemblyName: string) => boolean,\n) {\n  const inputs = input\n    .split(/(\\s+)/)\n    .map(f => f.trim())\n    .filter(f => !!f)\n  // first try interpreting as a whitespace-separated sequence of\n  // multiple locstrings\n  try {\n    return inputs.map(loc =>\n      parseLocString(loc, ref => isValidRefName(ref, assemblyName)),\n    )\n  } catch (e) {\n    // if this fails, try interpreting as a whitespace-separated refname,\n    // start, end if start and end are integer inputs\n    const [refName, start, end] = inputs\n    if (\n      /Unknown reference sequence/.exec(`${e}`) &&\n      Number.isInteger(+start!) &&\n      Number.isInteger(+end!)\n    ) {\n      return [\n        parseLocString(`${refName}:${start}..${end}`, ref =>\n          isValidRefName(ref, assemblyName),\n        ),\n      ]\n    }\n    throw e\n  }\n}\n\nexport function calculateVisibleLocStrings(contentBlocks: BaseBlock[]) {\n  if (!contentBlocks.length) {\n    return ''\n  } else {\n    const isSingleAssemblyName = contentBlocks.every(\n      b => b.assemblyName === contentBlocks[0]!.assemblyName,\n    )\n    const locs = contentBlocks.map(block =>\n      assembleLocString({\n        // eslint-disable-next-line @typescript-eslint/no-misused-spread\n        ...block,\n        start: Math.round(block.start),\n        end: Math.round(block.end),\n        assemblyName: isSingleAssemblyName ? undefined : block.assemblyName,\n      }),\n    )\n    return locs.join(' ')\n  }\n}\n","import deepEqual from 'fast-deep-equal'\n\nimport { readConfObject } from '../../configuration'\nimport GranularRectLayout from '../../util/layouts/GranularRectLayout'\nimport MultiLayout from '../../util/layouts/MultiLayout'\n\nimport type { AnyConfigurationModel } from '../../configuration'\nimport type { Region } from '../../util'\nimport type SerializableFilterChain from './util/serializableFilterChain'\n\nexport interface LayoutSessionProps {\n  regions: Region[]\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters?: SerializableFilterChain\n}\n\nexport type MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\n\nexport interface CachedLayout {\n  layout: MyMultiLayout\n  props: LayoutSessionProps\n}\n\nexport class LayoutSession {\n  props: LayoutSessionProps\n\n  cachedLayout: CachedLayout | undefined\n\n  constructor(props: LayoutSessionProps) {\n    this.props = props\n  }\n\n  update(props: LayoutSessionProps) {\n    this.props = props\n    return this\n  }\n\n  makeLayout() {\n    return new MultiLayout(GranularRectLayout, {\n      maxHeight: readConfObject(this.props.config, 'maxHeight'),\n      displayMode: readConfObject(this.props.config, 'displayMode'),\n      pitchX: this.props.bpPerPx,\n      pitchY: readConfObject(this.props.config, 'noSpacing') ? 1 : 3,\n    })\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedLayout) {\n    return (\n      cachedLayout.props.bpPerPx === this.props.bpPerPx &&\n      deepEqual(\n        readConfObject(this.props.config),\n        readConfObject(cachedLayout.props.config),\n      ) &&\n      deepEqual(this.props.filters, cachedLayout.props.filters)\n    )\n  }\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        props: this.props,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n","export function blobToDataURL(blob: Blob): Promise<string> {\n  const a = new FileReader()\n  return new Promise((resolve, reject) => {\n    a.onload = e => {\n      if (e.target) {\n        resolve(e.target.result as string)\n      } else {\n        reject(new Error('unknown result reading blob from canvas'))\n      }\n    }\n    a.readAsDataURL(blob)\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config UCSCTrackHubConnection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst UCSCTrackHubConnection = ConfigurationSchema(\n  'UCSCTrackHubConnection',\n  {\n    /**\n     * #slot\n     */\n    hubTxtLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/path/to/hub.txt',\n        locationType: 'UriLocation',\n      },\n      description: 'location of the hub file (usually called hub.txt)',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'optional list of genomes to import from this track hub, if empty all genomes will be imported',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseConnectionConfig,\n    preProcessSnapshot: snap => {\n      return snap.uri\n        ? {\n            ...snap,\n            hubTxtLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default UCSCTrackHubConnection\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types } from 'mobx-state-tree'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #stateModel UCSCTrackHubConnection\n * extends BaseConnectionModel\n */\nexport default function UCSCTrackHubConnection(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'UCSCTrackHubConnection',\n      BaseConnectionModelFactory(pluginManager),\n      types.model({\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        type: types.literal('UCSCTrackHubConnection'),\n      }),\n    )\n    .actions(self => ({\n      /**\n       * #action\n       */\n      async connect() {\n        const { doConnect } = await import('./doConnect')\n\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        doConnect(self)\n      },\n    }))\n}\n","import { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function UCSCTrackHubConnectionF(pluginManager: PluginManager) {\n  pluginManager.addConnectionType(() => {\n    return new ConnectionType({\n      name: 'UCSCTrackHubConnection',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      displayName: 'UCSC Track Hub',\n      description: 'A track or assembly hub in the Track Hub format',\n      url: 'https://genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro',\n    })\n  })\n}\n","import { getFillProps, getStrokeProps } from '@jbrowse/core/util'\nimport { alpha, useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\n// core\nimport { HEADER_BAR_HEIGHT } from '../consts'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\nconst OverviewScalebarPolygon = observer(function ({\n  model,\n  overview,\n  useOffset = true,\n}: {\n  model: LinearGenomeViewModel\n  overview: Base1DViewModel\n  useOffset?: boolean\n}) {\n  const theme = useTheme()\n  const multiplier = Number(useOffset)\n  const { interRegionPaddingWidth, offsetPx, dynamicBlocks, cytobandOffset } =\n    model\n  const { contentBlocks, totalWidthPxWithoutBorders } = dynamicBlocks\n  const polygonColor = theme.palette.tertiary.light\n\n  // catches possible null from at's below\n  if (!contentBlocks.length) {\n    return null\n  }\n  const first = contentBlocks.at(0)!\n  const last = contentBlocks.at(-1)!\n  const topLeft =\n    (overview.bpToPx({\n      // eslint-disable-next-line @typescript-eslint/no-misused-spread\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0) +\n    cytobandOffset * multiplier\n  const topRight =\n    (overview.bpToPx({\n      // eslint-disable-next-line @typescript-eslint/no-misused-spread\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0) +\n    cytobandOffset * multiplier\n\n  const startPx = Math.max(0, -offsetPx)\n  const endPx =\n    startPx +\n    totalWidthPxWithoutBorders +\n    (contentBlocks.length * interRegionPaddingWidth) / 2\n\n  const points = [\n    [startPx, HEADER_BAR_HEIGHT],\n    [endPx, HEADER_BAR_HEIGHT],\n    [topRight, 0],\n    [topLeft, 0],\n  ]\n\n  return (\n    <polygon\n      points={points.toString()}\n      {...getFillProps(alpha(polygonColor, 0.3))}\n      {...getStrokeProps(alpha(polygonColor, 0.8))}\n    />\n  )\n})\n\nexport default OverviewScalebarPolygon\n","/**\n * fast low-level intersection of 2 coordinate ranges. assumes interbase coordinates.\n *\n * assumes `left <= right` for both ranges\n *\n * @returns array of [left, right], or [] if the ranges do not intersect. the choice of [] is because it allows destructuring array assignment without check for undefined return\n */\nexport function intersection2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n): [number, number] | [] {\n  // this code is verbose because \"if\" statements are faster than Math.min and Math.max\n  if (right1 > left2 && left1 < right2 && right2 - left2 && right1 - left1) {\n    if (left1 > left2) {\n      if (right1 < right2) {\n        // 1     |-------|\n        //     |------------|\n        return [left1, right1]\n      }\n      // 2         |----|\n      //      |------|\n      return [left1, right2]\n    }\n    if (right1 < right2) {\n      // 3  |-----|\n      //       |------|\n      return [left2, right1]\n    }\n    // 4     |------------|\n    //         |-------|\n    return [left2, right2]\n  }\n  return []\n}\n\n/**\n * Return whether 2 interbase coordinate ranges intersect.\n *\n * @param left1 -\n * @param right1 -\n * @param left2 -\n * @param right2 -\n *\n * @returns true if the two ranges intersect\n */\nexport function doesIntersect2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return right1 > left2 && left1 < right2\n}\n\n/**\n * Return whether the first region is completely contained within the second region\n *\n * @param left1 - candidate inner region left\n * @param right1 - candidate inner region right\n * @param left2 - candidate outer region left\n * @param right2 - candidate outer region right\n */\nexport function isContainedWithin(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return left2 <= left1 && right2 >= right1\n}\n","// This file replaces `index.js` in bundlers like webpack or Rollup,\n// according to `browser` config in `package.json`.\n\n// This alphabet uses `A-Za-z0-9_-` symbols.\n// The order of characters is optimized for better gzip and brotli compression.\n// Same as in non-secure/index.js\nexport const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n\nexport const random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\n\nexport const customRandom = (alphabet, defaultSize, getRandom) => {\n  // First, a bitmask is necessary to generate the ID. The bitmask makes bytes\n  // values closer to the alphabet size. The bitmask calculates the closest\n  // `2^31 - 1` number, which exceeds the alphabet size.\n  // For example, the bitmask for the alphabet size 30 is 31 (00011111).\n  // `Math.clz32` is not used, because it is not available in browsers.\n  const mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  // Though, the bitmask solution is not perfect since the bytes exceeding\n  // the alphabet size are refused. Therefore, to reliably generate the ID,\n  // the random bytes redundancy has to be satisfied.\n\n  // Note: every hardware random generator call is performance expensive,\n  // because the system call for entropy collection takes a lot of time.\n  // So, to avoid additional system calls, extra bytes are requested in advance.\n\n  // Next, a step determines how many random bytes to generate.\n  // The number of random bytes gets decided upon the ID size, mask,\n  // alphabet size, and magic number 1.6 (using 1.6 peaks at performance\n  // according to benchmarks).\n\n  // `-~f => Math.ceil(f)` if f is a float\n  // `-~i => i + 1` if i is an integer\n  const step = -~((1.6 * mask * defaultSize) / alphabet.length)\n\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      const bytes = getRandom(step)\n      // A compact alternative for `for (var i = 0; i < step; i++)`.\n      let j = step\n      while (j--) {\n        // Adding `|| ''` refuses a random byte that exceeds the alphabet size.\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) {\n          return id\n        }\n      }\n    }\n  }\n}\n\nexport const customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\n\nexport const nanoid = (size = 21) =>\n  crypto.getRandomValues(new Uint8Array(size)).reduce((id, byte) => {\n    // It is incorrect to use bytes exceeding the alphabet size.\n    // The following mask reduces the random byte in the 0-255 value\n    // range to the 0-63 value range. Therefore, adding hacks, such\n    // as empty string fallback or magic numbers, is unnecessary because\n    // the bitmask trims bytes down to the alphabet size.\n    byte &= 63\n    if (byte < 36) {\n      // `0-9a-z`\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      // `A-Z`\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte > 62) {\n      id += '-'\n    } else {\n      id += '_'\n    }\n    return id\n  }, '')\n","import type React from 'react'\n\nimport PluggableElementBase from './PluggableElementBase'\n\nimport type { IAnyModelType } from 'mobx-state-tree'\n\ntype BasicComponent = React.ComponentType<{\n  model: any\n}>\ntype AddTrackWorkflowComponentType =\n  | React.LazyExoticComponent<BasicComponent>\n  | BasicComponent\n\nexport default class AddTrackWorkflow extends PluggableElementBase {\n  ReactComponent: AddTrackWorkflowComponentType\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AddTrackWorkflowComponentType\n    stateModel: IAnyModelType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n  }\n}\n","import { Checkbox, FormControlLabel } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()({\n  block: {\n    display: 'block',\n  },\n})\n\nexport default function Checkbox2({\n  checked,\n  disabled,\n  label,\n  onChange,\n}: {\n  checked: boolean\n  disabled?: boolean\n  label: string\n  onChange: (event: React.ChangeEvent<HTMLInputElement>) => void\n}) {\n  const { classes } = useStyles()\n  return (\n    <FormControlLabel\n      disabled={disabled}\n      className={classes.block}\n      control={<Checkbox checked={checked} onChange={onChange} />}\n      label={label}\n    />\n  )\n}\n","import { parseBreakend } from '@gmod/vcf'\n\nimport type { Track } from './types'\nimport type { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport function getBreakendCoveringRegions({\n  feature,\n  assembly,\n}: {\n  feature: Feature\n  assembly: Assembly\n}) {\n  const alt = feature.get('ALT')?.[0]\n  const bnd = alt ? parseBreakend(alt) : undefined\n  const startPos = feature.get('start')\n  const refName = feature.get('refName')\n  const f = (ref: string) => assembly.getCanonicalRefName(ref) || ref\n\n  if (alt === '<TRA>') {\n    const INFO = feature.get('INFO')\n    return {\n      pos: startPos,\n      refName: f(refName),\n      mateRefName: f(INFO.CHR2[0]),\n      matePos: INFO.END[0] - 1,\n    }\n  } else if (bnd?.MatePosition) {\n    const matePosition = bnd.MatePosition.split(':')\n    return {\n      pos: startPos,\n      refName: f(refName),\n      mateRefName: f(matePosition[0]!),\n      matePos: +matePosition[1]! - 1,\n    }\n  } else if (feature.get('mate')) {\n    const mate = feature.get('mate')\n    return {\n      pos: startPos,\n      refName: f(refName),\n      mateRefName: f(mate.refName),\n      matePos: mate.start,\n    }\n  } else {\n    return {\n      pos: startPos,\n      refName: f(refName),\n      mateRefName: f(refName),\n      matePos: feature.get('end'),\n    }\n  }\n}\n\nexport function stripIds(arr: Track[]) {\n  return arr.map(({ id, displays, ...rest }) => ({\n    ...rest,\n    displays: displays.map(({ id, ...rest }) => rest),\n  }))\n}\n\nexport function makeTitle(f: Feature) {\n  return `${f.get('name') || f.get('id') || 'breakend'} split detail`\n}\n","import { when } from '@jbrowse/core/util'\n\nimport { getBreakendCoveringRegions, makeTitle, stripIds } from './util'\n\nimport type { BreakpointSplitView, Track } from './types'\nimport type { AbstractSessionModel, Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport async function navToMultiLevelBreak({\n  stableViewId,\n  feature,\n  assemblyName,\n  session,\n  mirror,\n  tracks: viewTracks = [],\n}: {\n  stableViewId?: string\n  feature: Feature\n  assemblyName: string\n  windowSize?: number\n  session: AbstractSessionModel\n  mirror?: boolean\n  tracks?: Track[]\n}) {\n  const { assemblyManager } = session\n  const assembly = await assemblyManager.waitForAssembly(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n\n  const { refName, pos, mateRefName, matePos } = getBreakendCoveringRegions({\n    feature,\n    assembly: assembly,\n  })\n\n  let view = session.views.find(f => f.id === stableViewId) as\n    | BreakpointSplitView\n    | undefined\n  if (!view) {\n    view = session.addView('BreakpointSplitView', {\n      id: stableViewId,\n      type: 'BreakpointSplitView',\n      displayName: makeTitle(feature),\n      views: [\n        {\n          type: 'LinearGenomeView',\n          hideHeader: true,\n          tracks: stripIds(viewTracks),\n        },\n        {\n          type: 'LinearGenomeView',\n          hideHeader: true,\n          tracks: stripIds(mirror ? [...viewTracks].reverse() : viewTracks),\n        },\n      ],\n    }) as unknown as { views: LinearGenomeViewModel[] }\n  }\n  // @ts-expect-error\n  view.setDisplayName(makeTitle(feature))\n  const r1 = assembly.regions!.find(r => r.refName === refName)\n  const r2 = assembly.regions!.find(r => r.refName === mateRefName)\n  if (!r1 || !r2) {\n    throw new Error(\"can't find regions\")\n  }\n  await Promise.all([\n    view.views[0]!.navToLocations([\n      {\n        refName,\n        start: r1.start,\n        end: pos,\n        assemblyName,\n      },\n      {\n        refName,\n        start: pos + 1,\n        end: r1.end,\n        assemblyName,\n      },\n    ]),\n    view.views[1]!.navToLocations([\n      {\n        refName: mateRefName,\n        start: r2.start,\n        end: matePos,\n        assemblyName,\n      },\n      {\n        refName: mateRefName,\n        start: matePos + 1,\n        end: r2.end,\n        assemblyName,\n      },\n    ]),\n  ])\n  await when(() => view.views[1]!.initialized && view.views[0]!.initialized)\n  view.views[1]!.zoomTo(10)\n  view.views[0]!.zoomTo(10)\n  view.views[1]!.centerAt(matePos, mateRefName)\n  view.views[0]!.centerAt(pos, refName)\n}\n","import { useState } from 'react'\n\nimport { Dialog } from '@jbrowse/core/ui'\nimport { Button, DialogActions, DialogContent } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\n\nimport Checkbox2 from './Checkbox2'\nimport { navToMultiLevelBreak } from './navToMultiLevelBreak'\n\nimport type { Track } from './types'\nimport type { AbstractSessionModel, Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst BreakendMultiLevelOptionDialog = observer(function ({\n  session,\n  handleClose,\n  feature,\n  assemblyName,\n  stableViewId,\n  view,\n}: {\n  session: AbstractSessionModel\n  handleClose: () => void\n  feature: Feature\n  view?: LinearGenomeViewModel\n  assemblyName: string\n  stableViewId?: string\n}) {\n  const [copyTracks, setCopyTracks] = useState(true)\n  const [mirror, setMirror] = useState(true)\n\n  return (\n    <Dialog\n      open\n      onClose={handleClose}\n      title=\"Multi-level breakpoint split view options\"\n    >\n      <DialogContent>\n        <div>Launch multi-level breakpoint split view</div>\n        {view ? (\n          <>\n            <Checkbox2\n              checked={copyTracks}\n              label=\"Copy tracks into the new view\"\n              onChange={event => {\n                setCopyTracks(event.target.checked)\n              }}\n            />\n\n            {copyTracks ? (\n              <Checkbox2\n                checked={mirror}\n                disabled={!copyTracks}\n                label=\"Mirror the copied tracks (only available if copying tracks and using two level)\"\n                onChange={event => {\n                  setMirror(event.target.checked)\n                }}\n              />\n            ) : null}\n          </>\n        ) : null}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            ;(async () => {\n              try {\n                await navToMultiLevelBreak({\n                  stableViewId,\n                  session,\n                  tracks:\n                    copyTracks && view\n                      ? (getSnapshot(view.tracks) as Track[])\n                      : [],\n                  mirror,\n                  feature,\n                  assemblyName,\n                })\n              } catch (e) {\n                console.error(e)\n                session.notifyError(`${e}`, e)\n              }\n            })()\n            handleClose()\n          }}\n          variant=\"contained\"\n          color=\"primary\"\n          autoFocus\n        >\n          OK\n        </Button>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => {\n            handleClose()\n          }}\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default BreakendMultiLevelOptionDialog\n","import { useState } from 'react'\n\nimport { Dialog } from '@jbrowse/core/ui'\nimport { useLocalStorage } from '@jbrowse/core/util'\nimport { Button, DialogActions, DialogContent, TextField } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport Checkbox2 from './Checkbox2'\nimport { navToSingleLevelBreak } from './navToSingleLevelBreak'\n\nimport type { AbstractSessionModel, Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst BreakendSingleLevelOptionDialog = observer(function ({\n  session,\n  handleClose,\n  feature,\n  stableViewId,\n  assemblyName,\n  view,\n}: {\n  session: AbstractSessionModel\n  handleClose: () => void\n  stableViewId?: string\n  feature: Feature\n  view?: LinearGenomeViewModel\n  assemblyName: string\n}) {\n  const [copyTracks, setCopyTracks] = useState(true)\n  const [focusOnBreakends, setFocusOnBreakends] = useState(true)\n  const [windowSize, setWindowSize] = useLocalStorage(\n    'breakpointWindowSize',\n    '5000',\n  )\n\n  return (\n    <Dialog\n      open\n      onClose={handleClose}\n      title=\"Single-level breakpoint split view options\"\n    >\n      <DialogContent>\n        {view ? (\n          <Checkbox2\n            checked={copyTracks}\n            label=\"Copy tracks into the new view\"\n            onChange={event => {\n              setCopyTracks(event.target.checked)\n            }}\n          />\n        ) : null}\n        <Checkbox2\n          checked={copyTracks}\n          label=\"Focus on breakends\"\n          onChange={event => {\n            setFocusOnBreakends(event.target.checked)\n          }}\n        />\n\n        <TextField\n          label=\"Window size (bp)\"\n          value={windowSize}\n          onChange={event => {\n            setWindowSize(event.target.value)\n          }}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            ;(async () => {\n              try {\n                const { assemblyManager } = session\n                const assembly =\n                  await assemblyManager.waitForAssembly(assemblyName)\n                if (!assembly) {\n                  throw new Error(`assembly ${assemblyName} not found`)\n                }\n                await navToSingleLevelBreak({\n                  feature,\n                  assemblyName,\n                  focusOnBreakends,\n                  session,\n                  stableViewId,\n                  tracks: view?.tracks,\n                  windowSize: +windowSize || 0,\n                })\n              } catch (e) {\n                console.error(e)\n                session.notifyError(`${e}`, e)\n              }\n            })()\n            handleClose()\n          }}\n          variant=\"contained\"\n          color=\"primary\"\n          autoFocus\n        >\n          OK\n        </Button>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => {\n            handleClose()\n          }}\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default BreakendSingleLevelOptionDialog\n","import { gatherOverlaps, getSession, when } from '@jbrowse/core/util'\nimport { getSnapshot } from 'mobx-state-tree'\n\nimport { getBreakendCoveringRegions, makeTitle, stripIds } from './util'\n\nimport type { BreakpointSplitView } from './types'\nimport type { AbstractSessionModel, Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function singleLevelFocusedSnapshotFromBreakendFeature({\n  feature,\n  session,\n  assemblyName,\n  windowSize = 0,\n}: {\n  feature: Feature\n  session: AbstractSessionModel\n  assemblyName: string\n  windowSize?: number\n}) {\n  const { assemblyManager } = session\n  const assembly = assemblyManager.get(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n  if (!assembly.regions) {\n    throw new Error(`assembly ${assemblyName} regions not loaded`)\n  }\n  const coverage = getBreakendCoveringRegions({\n    feature,\n    assembly,\n  })\n  const { refName, mateRefName } = coverage\n  const topRegion = assembly.regions.find(f => f.refName === refName)!\n  const bottomRegion = assembly.regions.find(f => f.refName === mateRefName)!\n  return {\n    coverage,\n    snap: {\n      type: 'BreakpointSplitView',\n      views: [\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: gatherOverlaps([\n            {\n              ...topRegion,\n              end: coverage.pos + windowSize,\n              assemblyName,\n            },\n            {\n              ...bottomRegion,\n              start: coverage.matePos - windowSize,\n              assemblyName,\n            },\n          ]),\n        },\n      ],\n      displayName: makeTitle(feature),\n    },\n  }\n}\n\nexport function singleLevelEncompassingSnapshotFromBreakendFeature({\n  feature,\n  session,\n  assemblyName,\n}: {\n  feature: Feature\n  session: AbstractSessionModel\n  assemblyName: string\n}) {\n  const { assemblyManager } = session\n  const assembly = assemblyManager.get(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n  if (!assembly.regions) {\n    throw new Error(`assembly ${assemblyName} regions not loaded`)\n  }\n  const coverage = getBreakendCoveringRegions({\n    feature,\n    assembly,\n  })\n  const { refName, mateRefName } = coverage\n  const topRegion = assembly.regions.find(f => f.refName === refName)!\n  const bottomRegion = assembly.regions.find(f => f.refName === mateRefName)!\n  return {\n    coverage,\n    snap: {\n      type: 'BreakpointSplitView',\n      views: [\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: gatherOverlaps([\n            { ...topRegion, assemblyName },\n            { ...bottomRegion, assemblyName },\n          ]),\n        },\n      ],\n      displayName: makeTitle(feature),\n    },\n  }\n}\n\nexport async function navToSingleLevelBreak({\n  stableViewId,\n  feature,\n  assemblyName,\n  session,\n  tracks,\n  windowSize = 0,\n  focusOnBreakends,\n}: {\n  stableViewId?: string\n  feature: Feature\n  assemblyName: string\n  windowSize?: number\n  session: AbstractSessionModel\n  tracks?: any\n  focusOnBreakends?: boolean\n}) {\n  const { snap, coverage } = focusOnBreakends\n    ? singleLevelFocusedSnapshotFromBreakendFeature({\n        feature,\n        assemblyName,\n        session,\n        windowSize,\n      })\n    : singleLevelEncompassingSnapshotFromBreakendFeature({\n        feature,\n        assemblyName,\n        session,\n      })\n  const { refName, pos: startPos, mateRefName, matePos: endPos } = coverage\n  let view = session.views.find(f => f.id === stableViewId) as\n    | BreakpointSplitView\n    | undefined\n  if (!view) {\n    view = session.addView('BreakpointSplitView', {\n      ...snap,\n      views: [\n        {\n          ...snap.views[0],\n          tracks: tracks ? stripIds(getSnapshot(tracks)) : [],\n        },\n      ],\n    }) as unknown as { views: LinearGenomeViewModel[] }\n  } else {\n    view.views[0]?.setDisplayedRegions(snap.views[0]!.displayedRegions)\n    // @ts-expect-error\n    view.setDisplayName(snap.displayName)\n  }\n  const lgv = view.views[0]!\n  await when(() => lgv.initialized)\n\n  const l0 = lgv.bpToPx({\n    coord: Math.max(0, startPos - windowSize),\n    refName,\n  })\n  const r0 = lgv.bpToPx({\n    coord: endPos + windowSize,\n    refName: mateRefName,\n  })\n  if (l0 && r0) {\n    lgv.moveTo(\n      {\n        ...l0,\n        offset: l0.offsetPx,\n      },\n      {\n        ...r0,\n        offset: r0.offsetPx,\n      },\n    )\n  } else {\n    getSession(lgv).notify('Unable to navigate to breakpoint')\n  }\n}\n","import Dialog from '@jbrowse/core/ui/Dialog'\nimport {\n  Button,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n} from '@mui/material'\n\nexport default function FactoryResetDialog({\n  onClose,\n  open,\n  onFactoryReset,\n}: {\n  onClose: () => void\n  open: boolean\n  onFactoryReset: () => void\n}) {\n  function handleDialogClose(action?: string) {\n    if (action === 'reset') {\n      onFactoryReset()\n    }\n    onClose()\n  }\n\n  return (\n    <Dialog\n      title=\"Reset\"\n      onClose={() => {\n        handleDialogClose()\n      }}\n      open={open}\n    >\n      <DialogContent>\n        <DialogContentText>\n          Are you sure you want to reset? This will restore the default\n          configuration.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            handleDialogClose()\n          }}\n          color=\"primary\"\n        >\n          Cancel\n        </Button>\n        <Button\n          onClick={() => {\n            handleDialogClose('reset')\n          }}\n          color=\"primary\"\n          variant=\"contained\"\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import { useState } from 'react'\n\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n} from '@mui/material'\n\nimport ErrorMessage from './ErrorMessage'\nimport FactoryResetDialog from './FactoryResetDialog'\n\nconst ResetComponent = ({\n  onFactoryReset,\n  resetButtonText,\n}: {\n  onFactoryReset: () => void\n  resetButtonText: string\n}) => {\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  return (\n    <>\n      <Button\n        data-testid=\"fatal-error\"\n        color=\"primary\"\n        variant=\"contained\"\n        onClick={() => {\n          setDialogOpen(true)\n        }}\n      >\n        {resetButtonText}\n      </Button>\n      <FactoryResetDialog\n        onClose={() => {\n          setDialogOpen(false)\n        }}\n        open={dialogOpen}\n        onFactoryReset={onFactoryReset}\n      />\n    </>\n  )\n}\n\nexport default function FatalErrorDialog({\n  componentStack,\n  error = 'No error message provided',\n  onFactoryReset,\n  resetButtonText = 'Factory Reset',\n}: {\n  componentStack?: string\n  error?: unknown\n  onFactoryReset: () => void\n  resetButtonText?: string\n}) {\n  return (\n    <Dialog maxWidth=\"xl\" open>\n      <DialogTitle>Fatal error</DialogTitle>\n      <DialogContent>\n        <ErrorMessage error={error} />\n        <pre>{componentStack}</pre>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => {\n            window.location.reload()\n          }}\n        >\n          Refresh\n        </Button>\n        <ResetComponent\n          onFactoryReset={onFactoryReset}\n          resetButtonText={resetButtonText}\n        />\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import {\n  getSnapshot,\n  getType,\n  isArrayType,\n  isLateType,\n  isMapType,\n  isModelType,\n  isOptionalType,\n  isStateTreeNode,\n  isType,\n  isUnionType,\n} from 'mobx-state-tree'\n\nimport {\n  getDefaultValue,\n  getSubType,\n  getUnionSubTypes,\n  resolveLateType,\n} from '../util/mst-reflection'\n\nimport type {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  ConfigurationSchemaForModel,\n  ConfigurationSlotName,\n} from './types'\n\n/**\n * given a configuration model (an instance of a ConfigurationSchema),\n * read the configuration variable at the given path\n *\n * @param model - instance of ConfigurationSchema\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *  will be sent to each of the slotNames\n */\nexport function readConfObject<CONFMODEL extends AnyConfigurationModel>(\n  confObject: CONFMODEL,\n  slotPath?:\n    | ConfigurationSlotName<ConfigurationSchemaForModel<CONFMODEL>>\n    | string[],\n  args: Record<string, unknown> = {},\n): any {\n  if (!slotPath) {\n    return structuredClone(getSnapshot(confObject))\n  } else if (typeof slotPath === 'string') {\n    let slot = confObject[slotPath]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !slot &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      slot = confObject.get(slotPath)\n    }\n    if (!slot) {\n      return undefined\n      // if we want to be very strict about config slots, we could uncomment the below\n      // instead of returning undefined\n      //\n      // const modelType = getType(model)\n      // const schemaType = model.configuration && getType(model.configuration)\n      // throw new Error(\n      //   `no slot \"${slotName}\" found in ${modelType.name} configuration (${\n      //     schemaType.name\n      //   })`,\n      // )\n    } else {\n      const val = slot.expr ? slot.expr.evalSync(args) : slot\n      return isStateTreeNode(val)\n        ? JSON.parse(JSON.stringify(getSnapshot(val)))\n        : val\n    }\n  } else if (Array.isArray(slotPath)) {\n    const slotName = slotPath[0]!\n    if (slotPath.length > 1) {\n      const newPath = slotPath.slice(1)\n      let subConf = confObject[slotName]\n      // check for the subconf being a map if we don't find it immediately\n      if (\n        !subConf &&\n        isStateTreeNode(confObject) &&\n        isMapType(getType(confObject))\n      ) {\n        subConf = confObject.get(slotName)\n      }\n      return subConf ? readConfObject(subConf, newPath, args) : undefined\n    }\n    return readConfObject(\n      confObject,\n      slotName as ConfigurationSlotName<ConfigurationSchemaForModel<CONFMODEL>>,\n      args,\n    )\n  }\n  throw new TypeError('slotPath must be a string or array')\n}\n\n/**\n * helper method for readConfObject, reads the config from a mst model\n *\n * @param model - object containing a 'configuration' member\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *   will be sent to each of the slotNames\n */\nexport function getConf<CONFMODEL extends AnyConfigurationModel>(\n  model: { configuration: CONFMODEL },\n  slotPath?: Parameters<typeof readConfObject<CONFMODEL>>[1],\n  args?: Parameters<typeof readConfObject<CONFMODEL>>[2],\n) {\n  const { configuration } = model\n  if (isConfigurationModel(configuration)) {\n    return readConfObject<CONFMODEL>(configuration, slotPath, args)\n  }\n  throw new TypeError('cannot getConf on this model, it has no configuration')\n}\n\n/**\n * given a union of explicitly typed configuration schema types,\n * extract an array of the type names contained in the union\n *\n * @param unionType -\n * @returns Array of type names contained in the union\n */\nexport function getTypeNamesFromExplicitlyTypedUnion(maybeUnionType: unknown) {\n  if (isType(maybeUnionType)) {\n    maybeUnionType = resolveLateType(maybeUnionType)\n    // @ts-expect-error\n    if (isUnionType(maybeUnionType)) {\n      const typeNames: string[] = []\n      for (let type of getUnionSubTypes(maybeUnionType)) {\n        type = resolveLateType(type)\n        let typeName = getTypeNamesFromExplicitlyTypedUnion(type)\n        if (!typeName.length) {\n          const def = getDefaultValue(type)\n          typeName = [def.type]\n        }\n        if (!typeName[0]) {\n          // debugger\n          throw new Error(`invalid config schema type ${type}`)\n        }\n        typeNames.push(...typeName)\n      }\n      return typeNames\n    }\n  }\n  return []\n}\n\nexport function isBareConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (isType(thing)) {\n    if (\n      isModelType(thing) &&\n      ('isJBrowseConfigurationSchema' in thing ||\n        thing.name.includes('ConfigurationSchema'))\n    ) {\n      return true\n    }\n    // if it's a late type, assume its a config schema\n    if (isLateType(thing)) {\n      return true\n    }\n  }\n  return false\n}\n\nexport function isConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  // written as a series of if-statements instead of a big logical because this\n  // construction gives much better debugging backtraces.\n\n  // also, note that the order of these statements matters, because for example\n  // some union types are also optional types\n\n  if (!isType(thing)) {\n    return false\n  } else if (isBareConfigurationSchemaType(thing)) {\n    return true\n  } else if (isUnionType(thing)) {\n    return getUnionSubTypes(thing).every(\n      t => isConfigurationSchemaType(t) || t.name === 'undefined',\n    )\n  } else if (\n    isOptionalType(thing) &&\n    isConfigurationSchemaType(getSubType(thing))\n  ) {\n    return true\n  } else if (\n    isArrayType(thing) &&\n    isConfigurationSchemaType(getSubType(thing))\n  ) {\n    return true\n  } else if (isMapType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  } else {\n    return false\n  }\n}\n\nexport function isConfigurationModel(\n  thing: unknown,\n): thing is AnyConfigurationModel {\n  return isStateTreeNode(thing) && isConfigurationSchemaType(getType(thing))\n}\n\nexport function isConfigurationSlotType(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'isJBrowseConfigurationSlot' in thing\n  )\n}\n","export default abstract class PluggableElementBase {\n  name: string\n  maybeDisplayName?: string\n\n  constructor(args?: { name?: string; displayName?: string }) {\n    this.name = args?.name || 'UNKNOWN'\n    this.maybeDisplayName = args?.displayName\n  }\n\n  get displayName() {\n    return this.maybeDisplayName || this.name\n  }\n}\n","import { Alert, Tooltip } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { AlertColor } from '@mui/material'\n\nconst useStyles = makeStyles()({\n  ellipses: {\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n  },\n})\n\nexport default function BlockMsg({\n  message,\n  severity,\n  action,\n}: {\n  message: string\n  severity?: AlertColor\n  action?: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  return (\n    <Alert\n      severity={severity}\n      action={action}\n      classes={{\n        message: classes.ellipses,\n      }}\n      onMouseDown={event => {\n        event.stopPropagation()\n      }}\n    >\n      <Tooltip title={message}>\n        <div>{message}</div>\n      </Tooltip>\n    </Alert>\n  )\n}\n","/**\n * source https://github.com/panstromek/zebra-rs/blob/82d616225930b3ad423a2c6d883c79b94ee08ba6/webzebra/src/stopToken.ts#L34C1-L57C16\n *\n * blogpost https://yoyo-code.com/how-to-stop-synchronous-web-worker/\n *\n * license \"I explicitly added MIT license to the stopToken file to make it more\n * permissive\"\n *\n * Copyright (c) 2022 Matyáš Racek\n *\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to\n * deal in the Software without restriction, including without limitation the\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n * sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n */\n\nfunction isWebWorker() {\n  return (\n    // @ts-expect-error\n    typeof WorkerGlobalScope !== 'undefined' &&\n    // @ts-expect-error\n    self instanceof WorkerGlobalScope\n  )\n}\nexport function createStopToken() {\n  // URL not available in jest and can't properly mock it\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  return URL.createObjectURL?.(new Blob()) || `${Math.random()}`\n}\n\nexport function stopStopToken(stopToken: string) {\n  // URL not available in jest and can't properly mock it\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  URL.revokeObjectURL?.(stopToken)\n}\n\nexport function checkStopToken(stopToken: string | undefined) {\n  // avoid doing synchronous XHR on main thread\n  if (typeof jest === 'undefined' && stopToken !== undefined && isWebWorker()) {\n    const xhr = new XMLHttpRequest()\n\n    // synchronous XHR usage to check the token\n    xhr.open('GET', stopToken, false)\n    try {\n      xhr.send(null)\n    } catch (e) {\n      throw new Error('aborted')\n    }\n  }\n}\n","import { Popover, Typography } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()(theme => {\n  return {\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n  }\n})\n\nexport default function RubberbandTooltip({\n  anchorEl,\n  side,\n  text,\n}: {\n  anchorEl: HTMLSpanElement\n  side: string\n  text: string\n}) {\n  const { classes } = useStyles()\n  return (\n    <Popover\n      className={classes.popover}\n      classes={{ paper: classes.paper }}\n      open\n      anchorEl={anchorEl}\n      anchorOrigin={{\n        vertical: 'top',\n        horizontal: side === 'left' ? 'left' : 'right',\n      }}\n      transformOrigin={{\n        vertical: 'bottom',\n        horizontal: side === 'left' ? 'right' : 'left',\n      }}\n      keepMounted\n      disableRestoreFocus\n    >\n      <Typography>{text}</Typography>\n    </Popover>\n  )\n}\n","import { useState } from 'react'\n\nimport { getBpDisplayStr, stringify } from '@jbrowse/core/util'\nimport { Typography, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nimport RubberbandTooltip from './RubberbandTooltip'\n\nconst useStyles = makeStyles()(theme => {\n  const { tertiary } = theme.palette\n  const background = alpha(tertiary.light, 0.7)\n  return {\n    rubberband: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 830,\n      textAlign: 'center',\n    },\n    rubberbandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberbandText: {\n      color: theme.palette.tertiary.contrastText,\n    },\n  }\n})\n\ninterface Offset {\n  coord: number\n  refName?: string\n  oob?: boolean\n}\n\nexport default function RubberbandSpan({\n  leftBpOffset,\n  rightBpOffset,\n  numOfBpSelected,\n  left,\n  width,\n  top = 0,\n  sticky = false,\n}: {\n  leftBpOffset: Offset\n  rightBpOffset: Offset\n  numOfBpSelected?: number\n  left: number\n  width: number\n  top?: number\n  sticky?: boolean\n}) {\n  const { classes } = useStyles()\n  const [anchorEl, setAnchorEl] = useState<HTMLSpanElement | null>(null)\n  return (\n    <>\n      {anchorEl ? (\n        <>\n          <RubberbandTooltip\n            side=\"left\"\n            anchorEl={anchorEl}\n            text={stringify(leftBpOffset)}\n          />\n          <RubberbandTooltip\n            side=\"right\"\n            anchorEl={anchorEl}\n            text={stringify(rightBpOffset)}\n          />\n        </>\n      ) : null}\n      <div className={classes.rubberband} style={{ left, width }}>\n        {numOfBpSelected ? (\n          <Typography\n            ref={el => {\n              setAnchorEl(el)\n            }}\n            variant=\"h6\"\n            className={classes.rubberbandText}\n            style={{\n              top,\n              position: sticky ? 'sticky' : undefined,\n            }}\n          >\n            {getBpDisplayStr(numOfBpSelected)}\n          </Typography>\n        ) : null}\n      </div>\n    </>\n  )\n}\n","import { firstValueFrom } from 'rxjs'\nimport { reduce } from 'rxjs/operators'\n\nimport type { Feature } from './simpleFeature'\nimport type { NoAssemblyRegion } from './types'\nimport type { Observable } from 'rxjs'\n\nexport interface UnrectifiedQuantitativeStats {\n  scoreMin: number\n  scoreMax: number\n  scoreSum: number\n  scoreSumSquares: number\n  featureCount: number\n  basesCovered: number\n}\nexport interface QuantitativeStats extends UnrectifiedQuantitativeStats {\n  currStatsBpPerPx: number\n  featureDensity: number\n  scoreMean: number\n  scoreStdDev: number\n}\n\n/**\n * calculate standard deviation using the 'shortcut method' that accepts\n * the sum and the sum squares of the elements\n *\n * @param sum - sum(i, 1..n)\n * @param sumSquares - sum(i^2, 1..n)\n * @param n - number of elements\n * @param population - boolean: use population instead of sample correction\n * @returns - the estimated std deviation\n */\nexport function calcStdFromSums(\n  sum: number,\n  sumSquares: number,\n  n: number,\n  population = false,\n): number {\n  if (n === 0) {\n    return 0\n  }\n  let variance: number\n  if (population) {\n    variance = sumSquares / n - (sum * sum) / (n * n)\n  } else {\n    // sample correction is n-1\n    variance = sumSquares - (sum * sum) / n\n    if (n > 1) {\n      variance /= n - 1\n    }\n  }\n\n  return variance < 0 ? 0 : Math.sqrt(variance)\n}\n\n/**\n * @param stats - a summary stats object with scoreSum, featureCount,\n * scoreSumSquares, and basesCovered\n * @returns - a summary stats object with\n * scoreMean, scoreStdDev, and featureDensity added\n */\nexport function rectifyStats(s: UnrectifiedQuantitativeStats) {\n  return {\n    ...s,\n    scoreMean: (s.scoreSum || 0) / (s.featureCount || s.basesCovered || 1),\n    scoreStdDev: calcStdFromSums(\n      s.scoreSum,\n      s.scoreSumSquares,\n      s.featureCount || s.basesCovered,\n    ),\n    featureDensity: (s.featureCount || 1) / s.basesCovered,\n  } as QuantitativeStats\n}\n\n/**\n * transform a list of scores to summary statistics\n *\n * @param region - object with start, end\n * @param features - array of features which are possibly summary features\n * @returns - object with scoreMax, scoreMin, scoreSum, scoreSumSquares, etc\n */\nexport async function scoresToStats(\n  region: NoAssemblyRegion,\n  feats: Observable<Feature>,\n) {\n  const { start, end } = region\n  const seed = {\n    scoreMin: Number.MAX_VALUE,\n    scoreMax: Number.MIN_VALUE,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n  }\n  let found = false\n\n  const { scoreMin, scoreMax, scoreSum, scoreSumSquares, featureCount } =\n    await firstValueFrom(\n      feats.pipe(\n        reduce((acc, f) => {\n          const s = f.get('score')\n          const summary = f.get('summary')\n          const { scoreMax, scoreMin } = acc\n          acc.scoreMax = Math.max(scoreMax, summary ? f.get('maxScore') : s)\n          acc.scoreMin = Math.min(scoreMin, summary ? f.get('minScore') : s)\n          acc.scoreSum += s\n          acc.scoreSumSquares += s * s\n          acc.featureCount += 1\n          found = true\n\n          return acc\n        }, seed),\n      ),\n    )\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  return found\n    ? rectifyStats({\n        scoreMax,\n        scoreMin,\n        scoreSum,\n        scoreSumSquares,\n        featureCount,\n        basesCovered: end - start + 1,\n      })\n    : blankStats()\n}\n\nexport function blankStats() {\n  return {\n    scoreMin: 0,\n    scoreMax: 0,\n    scoreMean: 0,\n    scoreStdDev: 0,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n    featureDensity: 0,\n    basesCovered: 0,\n  } as QuantitativeStats\n}\n","import { useEffect, useRef, useState } from 'react'\n\nexport default function useMeasure() {\n  const ref = useRef<HTMLDivElement>(null)\n  const [dims, setDims] = useState<{ width?: number; height?: number }>({\n    width: undefined,\n    height: undefined,\n  })\n  useEffect(() => {\n    if (!ref.current) {\n      return\n    }\n    const RS =\n      typeof window !== 'undefined' && 'ResizeObserver' in window\n        ? window.ResizeObserver\n        : undefined\n\n    if (!RS) {\n      return\n    }\n    const observer = new RS(entries => {\n      setDims({\n        width: entries[0]!.contentRect.width,\n        height: entries[0]!.contentRect.height,\n      })\n    })\n    observer.observe(ref.current)\n\n    // Callback fired when component is unmounted\n    return () => {\n      observer.disconnect()\n    }\n  }, [])\n\n  return [ref, dims] as const\n}\n","const category10 = [\n  '#1f77b4',\n  '#ff7f0e',\n  '#2ca02c',\n  '#d62728',\n  '#9467bd',\n  '#8c564b',\n  '#e377c2',\n  '#7f7f7f',\n  '#bcbd22',\n  '#17becf',\n]\nconst dark2 = [\n  '#1b9e77',\n  '#d95f02',\n  '#7570b3',\n  '#e7298a',\n  '#66a61e',\n  '#e6ab02',\n  '#a6761d',\n  '#666666',\n]\nconst set1 = [\n  '#377eb8',\n  '#e41a1c',\n  '#4daf4a',\n  '#984ea3',\n  '#ff7f00',\n  '#ffff33',\n  '#a65628',\n  '#f781bf',\n  '#999999',\n]\nconst set2 = [\n  '#66c2a5',\n  '#fc8d62',\n  '#8da0cb',\n  '#e78ac3',\n  '#a6d854',\n  '#ffd92f',\n  '#e5c494',\n  '#b3b3b3',\n]\nconst tableau10 = [\n  '#4e79a7',\n  '#f28e2c',\n  '#e15759',\n  '#76b7b2',\n  '#59a14f',\n  '#edc949',\n  '#af7aa1',\n  '#ff9da7',\n  '#9c755f',\n  '#bab0ab',\n]\n\nconst ggplot2Colors6 = [\n  '#F8766D',\n  '#B79F00',\n  '#00BA38',\n  '#00BFC4',\n  '#619CFF',\n  '#F564E3',\n]\n\nconst ggplot2Colors5 = ['#F8766D', '#A3A500', '#00BF7D', '#00B0F6', '#E76BF3']\nconst ggplot2Colors4 = ['#F8766D', '#7CAE00', '#00BFC4', '#C77CFF']\nconst ggplot2Colors3 = ['#F8766D', '#00BA38', '#619CFF']\n\nexport {\n  category10,\n  dark2,\n  ggplot2Colors3,\n  ggplot2Colors4,\n  ggplot2Colors5,\n  ggplot2Colors6,\n  set1,\n  set2,\n  tableau10,\n}\n","import { types } from 'mobx-state-tree'\n\nimport { getEnv } from '../util'\nimport { stringToJexlExpression } from '../util/jexlStrings'\nimport { FileLocation } from '../util/types/mst'\n\nimport type { IAnyComplexType, IAnyModelType } from 'mobx-state-tree'\n\nfunction isValidColorString(/* str */) {\n  // TODO: check all the crazy cases for whether it's a valid HTML/CSS color string\n  return true\n}\nconst typeModels: Record<string, any> = {\n  stringArray: types.array(types.string),\n  stringArrayMap: types.map(types.array(types.string)),\n  numberMap: types.map(types.number),\n  boolean: types.boolean,\n  color: types.refinement('Color', types.string, isValidColorString),\n  integer: types.integer,\n  number: types.number,\n  string: types.string,\n  text: types.string,\n  fileLocation: FileLocation,\n  frozen: types.frozen(),\n}\n\n// default values we use if the defaultValue is malformed or does not work\nconst fallbackDefaults: Record<string, any> = {\n  stringArray: [],\n  stringArrayMap: {},\n  numberMap: {},\n  boolean: true,\n  color: 'black',\n  integer: 1,\n  number: 1,\n  string: '',\n  text: '',\n  fileLocation: { uri: '/path/to/resource.txt', locationType: 'UriLocation' },\n  frozen: {},\n}\n\nconst literalJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return self.value\n    },\n  },\n})\n\nconst objectJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return JSON.stringify(self.value)\n    },\n  },\n})\n\n// custom actions for modifying the value models\nconst typeModelExtensions: Record<string, (self: any) => any> = {\n  fileLocation: objectJSON,\n  number: literalJSON,\n  integer: literalJSON,\n  boolean: literalJSON,\n  frozen: objectJSON,\n  // special actions for working with stringArray slots\n  stringArray: (self: { value: string[] }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(val: string) {\n        self.value.push(val)\n      },\n      removeAtIndex(idx: number) {\n        self.value.splice(idx, 1)\n      },\n      setAtIndex(idx: number, val: string) {\n        self.value[idx] = val\n      },\n    },\n  }),\n  stringArrayMap: (self: { value: Map<string, string[]> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: any) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n      addToKey(key: string, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.push(val)\n      },\n      removeAtKeyIndex(key: string, idx: number) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.splice(idx, 1)\n      },\n      setAtKeyIndex(key: string, idx: number, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar[idx] = val\n      },\n    },\n  }),\n  numberMap: (self: { value: Map<string, number> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: number) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n    },\n  }),\n}\n\n// const FunctionStringType = types.refinement(\n//   'FunctionString',\n//   types.string,\n//   str => functionRegexp.test(str),\n// )\n\nconst JexlStringType = types.refinement('JexlString', types.string, str =>\n  str.startsWith('jexl:'),\n)\nfunction json(value: any) {\n  return value?.toJSON ? value.toJSON() : `\"${value}\"`\n}\nexport interface ConfigSlotDefinition {\n  /** human-readable description of the slot's meaning */\n  description?: string\n  /** custom base MST model for the slot's value */\n  model?: IAnyModelType | IAnyComplexType\n  /** name of the type of slot, e.g. \"string\", \"number\", \"stringArray\" */\n  type: string\n  /** default value of the slot */\n  defaultValue: any\n  /** parameter names of the function callback */\n  contextVariable?: string[]\n}\n\n/**\n * builds a MST model for a configuration slot\n *\n * @param slotName -\n * @param  definition -\n */\nexport default function ConfigSlot(\n  slotName: string,\n  {\n    description = '',\n    model,\n    type,\n    defaultValue,\n    contextVariable = [],\n  }: ConfigSlotDefinition,\n) {\n  if (!type) {\n    throw new Error('type name required')\n  }\n  if (!model) {\n    model = typeModels[type]\n  }\n  if (!model) {\n    throw new Error(\n      `no builtin config slot type \"${type}\", and no 'model' param provided`,\n    )\n  }\n\n  if (defaultValue === undefined) {\n    throw new Error(\"no 'defaultValue' provided\")\n  }\n\n  // if the `type` is something like `color`, then the model name\n  // here will be `ColorConfigSlot`\n  const configSlotModelName = `${slotName\n    .charAt(0)\n    .toUpperCase()}${slotName.slice(1)}ConfigSlot`\n  let slot = types\n    .model(configSlotModelName, {\n      name: types.literal(slotName),\n      description: types.literal(description),\n      type: types.literal(type),\n      value: types.optional(types.union(JexlStringType, model), defaultValue),\n    })\n    .volatile(() => ({\n      contextVariable,\n    }))\n    .views(self => ({\n      get isCallback() {\n        return String(self.value).startsWith('jexl:')\n      },\n    }))\n    .views(self => ({\n      get expr() {\n        if (self.isCallback) {\n          // compile as jexl function\n          const { pluginManager } = getEnv(self)\n          // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n          if (!pluginManager && typeof jest === 'undefined') {\n            console.warn(\n              'no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)',\n            )\n          }\n          // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n          return stringToJexlExpression(String(self.value), pluginManager?.jexl)\n        }\n        return { evalSync: () => self.value }\n      },\n\n      // JS representation of the value of this slot, suitable\n      // for embedding in either JSON or a JS function string.\n      // many of the data types override this in typeModelExtensions\n      get valueJSON(): any[] | Record<string, any> | string | undefined {\n        if (self.isCallback) {\n          return undefined\n        }\n\n        return json(self.value)\n      },\n    }))\n    .preProcessSnapshot(val =>\n      typeof val === 'object' && val.name === slotName\n        ? val\n        : {\n            name: slotName,\n            description,\n            type,\n            value: val,\n          },\n    )\n    .postProcessSnapshot(snap => {\n      if (typeof snap.value === 'object') {\n        return JSON.stringify(snap.value) !== JSON.stringify(defaultValue)\n          ? snap.value\n          : undefined\n      }\n      return snap.value !== defaultValue ? snap.value : undefined\n    })\n    .actions(self => ({\n      set(newVal: any) {\n        self.value = newVal\n      },\n      reset() {\n        self.value = defaultValue\n      },\n      convertToCallback() {\n        if (self.isCallback) {\n          return\n        }\n        self.value = `jexl:${self.valueJSON || \"''\"}`\n      },\n      convertToValue() {\n        if (!self.isCallback) {\n          return\n        }\n        // try calling it with no arguments\n        try {\n          const funcResult = self.expr.evalSync()\n          if (funcResult !== undefined) {\n            self.value = funcResult\n            return\n          }\n        } catch (e) {\n          /* ignore */\n        }\n        self.value = defaultValue\n        // if it is still a callback (happens if the defaultValue is a\n        // callback), then use the last-resort fallback default\n        // if defaultValue has jexl: string, run this part\n        if (!(type in fallbackDefaults)) {\n          throw new Error(`no fallbackDefault defined for type ${type}`)\n        }\n        self.value = fallbackDefaults[type]\n      },\n    }))\n\n  // if there are any type-specific extensions (views or actions)\n  //  to the slot, add those in\n  if (typeModelExtensions[type]) {\n    slot = slot.extend(typeModelExtensions[type])\n  }\n\n  const completeModel = types.optional(slot, {\n    name: slotName,\n    type,\n    description,\n    value: defaultValue,\n  })\n  const m = completeModel\n  Object.defineProperty(m, 'isJBrowseConfigurationSlot', { value: true })\n  return m\n}\n","import {\n  getSnapshot,\n  isLateType,\n  isStateTreeNode,\n  isType,\n  types,\n} from 'mobx-state-tree'\n\nimport ConfigSlot from './configurationSlot'\nimport { isConfigurationSchemaType } from './util'\nimport { ElementId } from '../util/types/mst'\n\nimport type { ConfigSlotDefinition } from './configurationSlot'\nimport type { AnyConfigurationSchemaType } from './types'\nimport type { IAnyType, SnapshotOut } from 'mobx-state-tree'\n\nexport type {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  AnyConfigurationSlot,\n  AnyConfigurationSlotType,\n} from './types'\n\nfunction isEmptyObject(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    !Array.isArray(thing) &&\n    thing !== null &&\n    Object.keys(thing).length === 0\n  )\n}\n\nfunction isEmptyArray(thing: unknown) {\n  return Array.isArray(thing) && thing.length === 0\n}\n\nexport interface ConfigurationSchemaDefinition {\n  [n: string]:\n    | ConfigSlotDefinition\n    | ConfigurationSchemaDefinition\n    | string\n    | number\n    | IAnyType\n}\n\nexport interface ConfigurationSchemaOptions<\n  BASE_SCHEMA extends AnyConfigurationSchemaType | undefined,\n  EXPLICIT_IDENTIFIER extends string | undefined,\n> {\n  explicitlyTyped?: boolean\n  explicitIdentifier?: EXPLICIT_IDENTIFIER\n  implicitIdentifier?: string | boolean\n  baseConfiguration?: BASE_SCHEMA\n\n  actions?: (self: unknown) => any\n  views?: (self: unknown) => any\n  extend?: (self: unknown) => any\n  preProcessSnapshot?: (\n    snapshot: Record<string, unknown>,\n  ) => Record<string, unknown>\n}\n\nfunction preprocessConfigurationSchemaArguments(\n  modelName: string,\n  inputSchemaDefinition: ConfigurationSchemaDefinition,\n  inputOptions: ConfigurationSchemaOptions<any, any> = {},\n) {\n  if (typeof modelName !== 'string') {\n    throw new Error(\n      'first arg must be string name of the model that this config schema goes with',\n    )\n  }\n\n  // if we have a base configuration schema that we are\n  // extending, grab the slot definitions from that\n  let schemaDefinition = inputSchemaDefinition\n  let options = inputOptions\n  if (inputOptions.baseConfiguration?.jbrowseSchemaDefinition) {\n    schemaDefinition = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaDefinition,\n      ...schemaDefinition,\n    }\n    options = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaOptions,\n      ...inputOptions,\n    }\n    options.baseConfiguration = undefined\n  }\n  return { schemaDefinition, options }\n}\n\nfunction makeConfigurationSchemaModel<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions<any, any>,\n>(modelName: string, schemaDefinition: DEFINITION, options: OPTIONS) {\n  // now assemble the MST model of the configuration schema\n  const modelDefinition: Record<string, any> = {}\n  let identifier: string | undefined\n\n  if (options.explicitlyTyped) {\n    modelDefinition.type = types.optional(types.literal(modelName), modelName)\n  }\n\n  if (options.explicitIdentifier && options.implicitIdentifier) {\n    throw new Error(\n      `Cannot have both explicit and implicit identifiers in ${modelName}`,\n    )\n  }\n  if (options.explicitIdentifier) {\n    if (typeof options.explicitIdentifier === 'string') {\n      modelDefinition[options.explicitIdentifier] = types.identifier\n      identifier = options.explicitIdentifier\n    } else {\n      modelDefinition.id = types.identifier\n      identifier = 'id'\n    }\n  } else if (options.implicitIdentifier) {\n    if (typeof options.implicitIdentifier === 'string') {\n      modelDefinition[options.implicitIdentifier] = ElementId\n      identifier = options.implicitIdentifier\n    } else {\n      modelDefinition.id = ElementId\n      identifier = 'id'\n    }\n  }\n\n  const volatileConstants: Record<string, any> = {\n    isJBrowseConfigurationSchema: true,\n    jbrowseSchema: {\n      modelName,\n      definition: schemaDefinition,\n      options,\n    },\n  }\n  for (const [slotName, slotDefinition] of Object.entries(schemaDefinition)) {\n    if (\n      (isType(slotDefinition) && isLateType(slotDefinition)) ||\n      isConfigurationSchemaType(slotDefinition)\n    ) {\n      // this is either an MST late() type (which we assume to be a sub-configuration),\n      // or an actual sub-configuration\n      modelDefinition[slotName] = slotDefinition\n    } else if (\n      typeof slotDefinition === 'string' ||\n      typeof slotDefinition === 'number'\n    ) {\n      volatileConstants[slotName] = slotDefinition\n    } else if (typeof slotDefinition === 'object') {\n      // this is a slot definition\n      if (!slotDefinition.type) {\n        throw new Error(`no type set for config slot ${modelName}.${slotName}`)\n      }\n      try {\n        modelDefinition[slotName] = ConfigSlot(\n          slotName,\n          slotDefinition as ConfigSlotDefinition,\n        )\n      } catch (e) {\n        throw new Error(\n          `invalid config slot definition for ${modelName}.${slotName}: ${e}`,\n        )\n      }\n    } else {\n      throw new Error(\n        `invalid configuration schema definition, \"${slotName}\" must be either a valid configuration slot definition, a constant, or a nested configuration schema`,\n      )\n    }\n  }\n\n  let completeModel = types\n    .model(`${modelName}ConfigurationSchema`, modelDefinition)\n    .actions(self => ({\n      setSubschema(slotName: string, data: Record<string, unknown>) {\n        if (!isConfigurationSchemaType(modelDefinition[slotName])) {\n          throw new Error(`${slotName} is not a subschema, cannot replace`)\n        }\n        const newSchema = isStateTreeNode(data)\n          ? data\n          : modelDefinition[slotName].create(data)\n        self[slotName] = newSchema\n        return newSchema\n      },\n    }))\n\n  if (Object.keys(volatileConstants).length) {\n    completeModel = completeModel.volatile((/* self */) => volatileConstants)\n  }\n  if (options.actions) {\n    completeModel = completeModel.actions(options.actions)\n  }\n  if (options.views) {\n    completeModel = completeModel.views(options.views)\n  }\n  if (options.extend) {\n    completeModel = completeModel.extend(options.extend)\n  }\n\n  const identifierDefault = identifier ? { [identifier]: 'placeholderId' } : {}\n  const modelDefault = options.explicitlyTyped\n    ? { type: modelName, ...identifierDefault }\n    : identifierDefault\n\n  const defaultSnap = getSnapshot(completeModel.create(modelDefault))\n  completeModel = completeModel.postProcessSnapshot(snap => {\n    const newSnap: SnapshotOut<typeof completeModel> = {}\n    let matchesDefault = true\n    // let keyCount = 0\n    for (const [key, value] of Object.entries(snap)) {\n      if (matchesDefault) {\n        if (typeof defaultSnap[key] === 'object' && typeof value === 'object') {\n          if (JSON.stringify(defaultSnap[key]) !== JSON.stringify(value)) {\n            matchesDefault = false\n          }\n        } else if (defaultSnap[key] !== value) {\n          matchesDefault = false\n        }\n      }\n      if (\n        value !== undefined &&\n        volatileConstants[key] === undefined &&\n        !isEmptyObject(value) &&\n        !isEmptyArray(value)\n      ) {\n        // keyCount += 1\n        newSnap[key] = value\n      }\n    }\n    if (matchesDefault) {\n      return {}\n    }\n    return newSnap\n  })\n\n  if (options.preProcessSnapshot) {\n    completeModel = completeModel.preProcessSnapshot(options.preProcessSnapshot)\n  }\n\n  return types.optional(completeModel, modelDefault)\n}\n\nexport interface ConfigurationSchemaType<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions<any, any>,\n> extends ReturnType<typeof makeConfigurationSchemaModel<DEFINITION, OPTIONS>> {\n  isJBrowseConfigurationSchema: boolean\n  jbrowseSchemaDefinition: DEFINITION\n  jbrowseSchemaOptions: OPTIONS\n  type: string\n  [key: string]: unknown\n}\n\nexport function ConfigurationSchema<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions<BASE_SCHEMA, EXPLICIT_IDENTIFIER>,\n  BASE_SCHEMA extends AnyConfigurationSchemaType | undefined = undefined,\n  EXPLICIT_IDENTIFIER extends string | undefined = undefined,\n>(\n  modelName: string,\n  inputSchemaDefinition: DEFINITION,\n  inputOptions?: ConfigurationSchemaOptions<BASE_SCHEMA, EXPLICIT_IDENTIFIER>,\n): ConfigurationSchemaType<DEFINITION, OPTIONS> {\n  const { schemaDefinition, options } = preprocessConfigurationSchemaArguments(\n    modelName,\n    inputSchemaDefinition,\n    inputOptions,\n  )\n  const schemaType = makeConfigurationSchemaModel(\n    modelName,\n    schemaDefinition,\n    options,\n  ) as AnyConfigurationSchemaType\n  // saving a couple of jbrowse-specific things in the type object. hope nobody gets mad.\n  schemaType.isJBrowseConfigurationSchema = true\n  schemaType.jbrowseSchemaDefinition = schemaDefinition\n  schemaType.jbrowseSchemaOptions = options\n  return schemaType\n}\n\nexport function ConfigurationReference<\n  SCHEMATYPE extends AnyConfigurationSchemaType,\n>(schemaType: SCHEMATYPE) {\n  // we cast this to SCHEMATYPE, because the reference *should* behave just\n  // like the object it points to. It won't be undefined (this is a\n  // `reference`, not a `safeReference`)\n  return types.union(types.reference(schemaType), schemaType) as SCHEMATYPE\n}\n","import { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { BaseBlock } from '@jbrowse/core/util/blockTypes'\n\nconst useStyles = makeStyles()(theme => ({\n  contentBlock: {\n    position: 'relative',\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n  },\n  elidedBlock: {\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    backgroundColor: '#999',\n    backgroundImage:\n      'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n  },\n  interRegionPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.text.disabled,\n  },\n  boundaryPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.action.disabledBackground,\n  },\n}))\n\nconst ContentBlock = observer(function ({\n  block,\n  children,\n}: {\n  block: BaseBlock\n  children: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  const { widthPx } = block\n  return (\n    <div style={{ width: widthPx }} className={classes.contentBlock}>\n      {children}\n    </div>\n  )\n})\n\nfunction ElidedBlock({ width }: { width: number }) {\n  const { classes } = useStyles()\n  return <div className={classes.elidedBlock} style={{ width }} />\n}\n\nfunction InterRegionPaddingBlock({\n  boundary,\n  width,\n  style = {},\n}: {\n  boundary: boolean\n  width: number\n  style?: React.CSSProperties\n}) {\n  const { classes } = useStyles()\n  return (\n    <div\n      style={{\n        ...style,\n        width,\n      }}\n      className={\n        boundary\n          ? classes.boundaryPaddingBlock\n          : classes.interRegionPaddingBlock\n      }\n    />\n  )\n}\n\nexport { ContentBlock, ElidedBlock, InterRegionPaddingBlock }\n","import createJexlInstance from './jexl'\n\nconst compilationCache: Record<string, any> = {}\n\n// revert function strings back to main, create a different file for\n// jexlStrings.ts pass the jexl property of the pluginManager as a param\n\n/**\n * compile a jexlExpression to a string\n *\n * @param str - string of code like `jexl:...`\n * @param options -\n */\nexport function stringToJexlExpression(str: string, jexl?: any) {\n  const cacheKey = `nosig|${str}`\n  if (!compilationCache[cacheKey]) {\n    const match = str.startsWith('jexl:')\n    if (!match) {\n      throw new Error('string does not appear to be in jexl format')\n    }\n    const code = str.split('jexl:')[1]!\n    const compiled = jexl\n      ? jexl.compile(code)\n      : createJexlInstance().compile(code)\n    compilationCache[cacheKey] = compiled\n  }\n\n  return compilationCache[cacheKey]\n}\n","import { Box, Button, FormControl, Typography } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nimport { isElectron } from '../../util'\nimport { getBlob, storeBlobLocation } from '../../util/tracks'\n\nimport type {\n  BlobLocation,\n  FileLocation,\n  LocalPathLocation,\n} from '../../util/types'\n\nfunction isLocalPathLocation(loc: FileLocation): loc is LocalPathLocation {\n  return 'localPath' in loc\n}\n\nfunction isBlobLocation(loc: FileLocation): loc is BlobLocation {\n  return 'blobId' in loc\n}\n\nconst useStyles = makeStyles()(theme => ({\n  filename: {\n    marginLeft: theme.spacing(1),\n  },\n}))\n\nfunction LocalFileChooser({\n  location,\n  setLocation,\n}: {\n  location?: FileLocation\n  setLocation: (arg: FileLocation) => void\n}) {\n  const { classes } = useStyles()\n  const filename =\n    location &&\n    ((isBlobLocation(location) && location.name) ||\n      (isLocalPathLocation(location) && location.localPath))\n\n  const needToReload =\n    location && isBlobLocation(location) && !getBlob(location.blobId)\n\n  return (\n    <Box display=\"flex\" flexDirection=\"row\" alignItems=\"center\">\n      <Box>\n        <FormControl fullWidth>\n          <Button variant=\"outlined\" component=\"label\">\n            Choose File\n            <input\n              type=\"file\"\n              hidden\n              onChange={({ target }) => {\n                const file = target.files?.[0]\n                if (file) {\n                  if (isElectron) {\n                    const { webUtils } = window.require('electron')\n                    setLocation({\n                      localPath: webUtils.getPathForFile(file),\n                      locationType: 'LocalPathLocation',\n                    })\n                  } else {\n                    // @ts-expect-error\n                    setLocation(storeBlobLocation({ blob: file }))\n                  }\n                }\n              }}\n            />\n          </Button>\n        </FormControl>\n      </Box>\n      <Box>\n        <Typography\n          component=\"span\"\n          className={classes.filename}\n          color={filename ? 'initial' : 'textSecondary'}\n        >\n          {filename || 'No file chosen'}\n        </Typography>\n        {needToReload ? (\n          <Typography color=\"error\">(need to reload)</Typography>\n        ) : null}\n      </Box>\n    </Box>\n  )\n}\n\nexport default LocalFileChooser\n","import { Suspense, forwardRef } from 'react'\n\nexport function lazyifyComponent(key: string, ReactComponent: any) {\n  const Component = forwardRef((props: any, ref) => (\n    <Suspense fallback={null}>\n      <ReactComponent {...props} ref={ref} />\n    </Suspense>\n  ))\n  Component.displayName = key\n  return [key, Component]\n}\n\nexport function lazyMap(obj: Record<string, React.FC<any>>, prefix = '') {\n  return Object.fromEntries(\n    Object.entries(obj).map(([key, ReactComponent]) =>\n      lazyifyComponent(`${prefix}${key}`, ReactComponent),\n    ),\n  )\n}\n","import { lazy } from 'react'\n\nimport { lazyMap } from './lazify'\n\nexport const BaseFeatureDetail = lazyMap(\n  {\n    Attributes: lazy(\n      () => import('../BaseFeatureWidget/BaseFeatureDetail/Attributes'),\n    ),\n    FeatureDetails: lazy(\n      () => import('../BaseFeatureWidget/BaseFeatureDetail/FeatureDetails'),\n    ),\n    BaseCard: lazy(\n      () => import('../BaseFeatureWidget/BaseFeatureDetail/BaseCard'),\n    ),\n    BaseAttributes: lazy(\n      () => import('../BaseFeatureWidget/BaseFeatureDetail/BaseAttributes'),\n    ),\n    BaseCoreDetails: lazy(\n      () => import('../BaseFeatureWidget/BaseFeatureDetail/BaseCoreDetails'),\n    ),\n  },\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail/',\n)\n","import { type LazyExoticComponent, lazy } from 'react'\n\nexport const DataGridEntries: Record<string, LazyExoticComponent<any>> = {\n  DataGrid: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.DataGrid })),\n  ),\n  GridActionsCellItem: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridActionsCellItem,\n    })),\n  ),\n  GridAddIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridAddIcon,\n    })),\n  ),\n  GridArrowDownwardIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridArrowDownwardIcon,\n    })),\n  ),\n  GridArrowUpwardIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridArrowUpwardIcon,\n    })),\n  ),\n  GridCellCheckboxForwardRef: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCellCheckboxForwardRef,\n    })),\n  ),\n  GridCellCheckboxRenderer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCellCheckboxRenderer,\n    })),\n  ),\n  GridCheckCircleIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCheckCircleIcon,\n    })),\n  ),\n  GridCheckIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCheckIcon,\n    })),\n  ),\n  GridCloseIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCloseIcon,\n    })),\n  ),\n  GridColumnHeaderSeparator: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnHeaderSeparator,\n    })),\n  ),\n  GridColumnHeaderSortIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnHeaderSortIcon,\n    })),\n  ),\n  GridColumnIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnIcon,\n    })),\n  ),\n  GridColumnMenu: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnMenu,\n    })),\n  ),\n  GridColumnMenuContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnMenuContainer,\n    })),\n  ),\n  GridDragIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridDragIcon,\n    })),\n  ),\n  GridExpandMoreIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridExpandMoreIcon,\n    })),\n  ),\n  GridFilterAltIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterAltIcon,\n    })),\n  ),\n  GridFilterForm: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterForm,\n    })),\n  ),\n  GridFilterListIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterListIcon,\n    })),\n  ),\n  GridFilterPanel: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterPanel,\n    })),\n  ),\n  GridFooter: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridFooter })),\n  ),\n  GridFooterContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFooterContainer,\n    })),\n  ),\n  GridHeader: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridHeader })),\n  ),\n  GridHeaderCheckbox: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridHeaderCheckbox,\n    })),\n  ),\n  GridKeyboardArrowRight: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridKeyboardArrowRight,\n    })),\n  ),\n  GridLoadIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridLoadIcon,\n    })),\n  ),\n  GridLoadingOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridLoadingOverlay,\n    })),\n  ),\n  GridMenuIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridMenuIcon,\n    })),\n  ),\n  GridMoreVertIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridMoreVertIcon,\n    })),\n  ),\n  GridNoRowsOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridNoRowsOverlay,\n    })),\n  ),\n  GridOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridOverlay,\n    })),\n  ),\n  GridPagination: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridPagination,\n    })),\n  ),\n  GridPanel: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridPanel })),\n  ),\n  GridPanelWrapper: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridPanelWrapper,\n    })),\n  ),\n  GridRemoveIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridRemoveIcon,\n    })),\n  ),\n  GridRoot: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridRoot })),\n  ),\n  GridRowCount: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridRowCount,\n    })),\n  ),\n  GridSearchIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSearchIcon,\n    })),\n  ),\n  GridSelectedRowCount: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSelectedRowCount,\n    })),\n  ),\n  GridSeparatorIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSeparatorIcon,\n    })),\n  ),\n  GridTableRowsIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridTableRowsIcon,\n    })),\n  ),\n  GridToolbarExportContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarExportContainer,\n    })),\n  ),\n\n  GridTripleDotsVerticalIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridTripleDotsVerticalIcon,\n    })),\n  ),\n  GridViewHeadlineIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridViewHeadlineIcon,\n    })),\n  ),\n  GridViewStreamIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridViewStreamIcon,\n    })),\n  ),\n}\n","import { lazy } from 'react'\n\nexport const Entries = {\n  Accordion: lazy(() => import('@mui/material/Accordion')),\n  AccordionActions: lazy(() => import('@mui/material/AccordionActions')),\n  AccordionDetails: lazy(() => import('@mui/material/AccordionDetails')),\n  AccordionSummary: lazy(() => import('@mui/material/AccordionSummary')),\n  Alert: lazy(() => import('@mui/material/Alert')),\n  AlertTitle: lazy(() => import('@mui/material/AlertTitle')),\n  Autocomplete: lazy(() => import('@mui/material/Autocomplete')),\n  Avatar: lazy(() => import('@mui/material/Avatar')),\n  AvatarGroup: lazy(() => import('@mui/material/AvatarGroup')),\n  Backdrop: lazy(() => import('@mui/material/Backdrop')),\n  Badge: lazy(() => import('@mui/material/Badge')),\n  Box: lazy(() => import('@mui/material/Box')),\n  Breadcrumbs: lazy(() => import('@mui/material/Breadcrumbs')),\n  Button: lazy(() => import('@mui/material/Button')),\n  ButtonGroup: lazy(() => import('@mui/material/ButtonGroup')),\n  Card: lazy(() => import('@mui/material/Card')),\n  CardActions: lazy(() => import('@mui/material/CardActions')),\n  CardActionArea: lazy(() => import('@mui/material/CardActionArea')),\n  CardContent: lazy(() => import('@mui/material/CardContent')),\n  CardHeader: lazy(() => import('@mui/material/CardHeader')),\n  CardMedia: lazy(() => import('@mui/material/CardMedia')),\n  CircularProgress: lazy(() => import('@mui/material/CircularProgress')),\n  Collapse: lazy(() => import('@mui/material/Collapse')),\n  ClickAwayListener: lazy(() => import('@mui/material/ClickAwayListener')),\n  Chip: lazy(() => import('@mui/material/Chip')),\n  Checkbox: lazy(() => import('@mui/material/Checkbox')),\n  Container: lazy(() => import('@mui/material/Container')),\n  Dialog: lazy(() => import('@mui/material/Dialog')),\n  DialogActions: lazy(() => import('@mui/material/DialogActions')),\n  DialogTitle: lazy(() => import('@mui/material/DialogTitle')),\n  DialogContent: lazy(() => import('@mui/material/DialogContent')),\n  DialogContentText: lazy(() => import('@mui/material/DialogContentText')),\n  Divider: lazy(() => import('@mui/material/Divider')),\n  Drawer: lazy(() => import('@mui/material/Drawer')),\n  Fab: lazy(() => import('@mui/material/Fab')),\n  Fade: lazy(() => import('@mui/material/Fade')),\n  FilledInput: lazy(() => import('@mui/material/FilledInput')),\n  FormLabel: lazy(() => import('@mui/material/FormLabel')),\n  FormControl: lazy(() => import('@mui/material/FormControl')),\n  FormControlLabel: lazy(() => import('@mui/material/FormControlLabel')),\n  FormHelperText: lazy(() => import('@mui/material/FormHelperText')),\n  FormGroup: lazy(() => import('@mui/material/FormGroup')),\n  Grid: lazy(() => import('@mui/material/Grid')),\n  Grid2: lazy(() => import('@mui/material/Grid')),\n  Grow: lazy(() => import('@mui/material/Grow')),\n  Icon: lazy(() => import('@mui/material/Icon')),\n  IconButton: lazy(() => import('@mui/material/IconButton')),\n  Input: lazy(() => import('@mui/material/Input')),\n  InputBase: lazy(() => import('@mui/material/InputBase')),\n  InputLabel: lazy(() => import('@mui/material/InputLabel')),\n  InputAdornment: lazy(() => import('@mui/material/InputAdornment')),\n  Link: lazy(() => import('@mui/material/Link')),\n  LinearProgress: lazy(() => import('@mui/material/LinearProgress')),\n  List: lazy(() => import('@mui/material/List')),\n  ListItem: lazy(() => import('@mui/material/ListItem')),\n  ListItemAvatar: lazy(() => import('@mui/material/ListItemAvatar')),\n  ListItemSecondaryAction: lazy(\n    () => import('@mui/material/ListItemSecondaryAction'),\n  ),\n  ListItemIcon: lazy(() => import('@mui/material/ListItemIcon')),\n  ListSubheader: lazy(() => import('@mui/material/ListSubheader')),\n  ListItemText: lazy(() => import('@mui/material/ListItemText')),\n  Menu: lazy(() => import('@mui/material/Menu')),\n  MenuItem: lazy(() => import('@mui/material/MenuItem')),\n  MenuList: lazy(() => import('@mui/material/MenuList')),\n  Modal: lazy(() => import('@mui/material/Modal')),\n  NativeSelect: lazy(() => import('@mui/material/NativeSelect')),\n  OutlinedInput: lazy(() => import('@mui/material/OutlinedInput')),\n  Pagination: lazy(() => import('@mui/material/Pagination')),\n  PaginationItem: lazy(() => import('@mui/material/PaginationItem')),\n  Paper: lazy(() => import('@mui/material/Paper')),\n  Popover: lazy(() => import('@mui/material/Popover')),\n  Popper: lazy(() => import('@mui/material/Popper')),\n  Portal: lazy(() => import('@mui/material/Portal')),\n  Radio: lazy(() => import('@mui/material/Radio')),\n  RadioGroup: lazy(() => import('@mui/material/RadioGroup')),\n  Rating: lazy(() => import('@mui/material/Rating')),\n  ScopedCssBaseline: lazy(() => import('@mui/material/ScopedCssBaseline')),\n  Select: lazy(() => import('@mui/material/Select')),\n  Skeleton: lazy(() => import('@mui/material/Skeleton')),\n  Slider: lazy(() => import('@mui/material/Slider')),\n  Snackbar: lazy(() => import('@mui/material/Snackbar')),\n  SnackbarContent: lazy(() => import('@mui/material/SnackbarContent')),\n  SpeedDial: lazy(() => import('@mui/material/SpeedDial')),\n  SpeedDialAction: lazy(() => import('@mui/material/SpeedDialAction')),\n  SpeedDialIcon: lazy(() => import('@mui/material/SpeedDialIcon')),\n  Stack: lazy(() => import('@mui/material/Stack')),\n  Step: lazy(() => import('@mui/material/Step')),\n  StepButton: lazy(() => import('@mui/material/StepButton')),\n  StepConnector: lazy(() => import('@mui/material/StepConnector')),\n  StepLabel: lazy(() => import('@mui/material/StepLabel')),\n  StepIcon: lazy(() => import('@mui/material/StepIcon')),\n  Stepper: lazy(() => import('@mui/material/Stepper')),\n  SvgIcon: lazy(() => import('@mui/material/SvgIcon')),\n  Switch: lazy(() => import('@mui/material/Switch')),\n  Tab: lazy(() => import('@mui/material/Tab')),\n  Table: lazy(() => import('@mui/material/Table')),\n  TableBody: lazy(() => import('@mui/material/TableBody')),\n  TableCell: lazy(() => import('@mui/material/TableCell')),\n  TableContainer: lazy(() => import('@mui/material/TableContainer')),\n  TableFooter: lazy(() => import('@mui/material/TableFooter')),\n  TableHead: lazy(() => import('@mui/material/TableHead')),\n  TablePagination: lazy(() => import('@mui/material/TablePagination')),\n  TableRow: lazy(() => import('@mui/material/TableRow')),\n  TableSortLabel: lazy(() => import('@mui/material/TableSortLabel')),\n  Tabs: lazy(() => import('@mui/material/Tabs')),\n  TextField: lazy(() => import('@mui/material/TextField')),\n  TextareaAutosize: lazy(() => import('@mui/material/TextareaAutosize')),\n  ToggleButton: lazy(() => import('@mui/material/ToggleButton')),\n  ToggleButtonGroup: lazy(() => import('@mui/material/ToggleButtonGroup')),\n  Toolbar: lazy(() => import('@mui/material/Toolbar')),\n  Tooltip: lazy(() => import('@mui/material/Tooltip')),\n  Typography: lazy(() => import('@mui/material/Typography')),\n}\n","/**\n * Used by plugin build systems to determine if a module is provided by JBrowse\n * globally and thus doesn't need to be bundled. A check in ./modules.tsx makes\n * sure this is in sync with the re-exported modules.\n *\n * Using this instead of just Object.keys(modules) allows this file to be\n * easily used by downstream tooling like simple esbuild scripts, rollup\n * configs, etc. without actually importing all the modules in modules.tsx,\n * which a Object.keys(modules) would do\n */\nexport default [\n  'mobx',\n  'mobx-state-tree',\n  'react',\n  'react/jsx-runtime',\n  'react-dom',\n  'react-dom/client',\n  'mobx-react',\n  '@mui/x-data-grid',\n  '@mui/material/utils',\n  '@material-ui/core/utils',\n  'tss-react/mui',\n  '@material-ui/core',\n  '@mui/material',\n\n  '@mui/material/styles',\n  '@material-ui/core/styles',\n  '@material-ui/core/Accordion',\n  '@material-ui/core/AccordionActions',\n  '@material-ui/core/AccordionDetails',\n  '@material-ui/core/AccordionSummary',\n  '@material-ui/core/Alert',\n  '@material-ui/core/AlertTitle',\n  '@material-ui/core/Autocomplete',\n  '@material-ui/core/Avatar',\n  '@material-ui/core/AvatarGroup',\n  '@material-ui/core/Backdrop',\n  '@material-ui/core/Badge',\n  '@material-ui/core/Box',\n  '@material-ui/core/Breadcrumbs',\n  '@material-ui/core/Button',\n  '@material-ui/core/ButtonGroup',\n  '@material-ui/core/Card',\n  '@material-ui/core/CardActions',\n  '@material-ui/core/CardActionArea',\n  '@material-ui/core/CardContent',\n  '@material-ui/core/CardHeader',\n  '@material-ui/core/CardMedia',\n  '@material-ui/core/CircularProgress',\n  '@material-ui/core/Collapse',\n  '@material-ui/core/ClickAwayListener',\n  '@material-ui/core/Chip',\n  '@material-ui/core/Checkbox',\n  '@material-ui/core/Container',\n  '@material-ui/core/Dialog',\n  '@material-ui/core/DialogActions',\n  '@material-ui/core/DialogTitle',\n  '@material-ui/core/DialogContent',\n  '@material-ui/core/DialogContentText',\n  '@material-ui/core/Divider',\n  '@material-ui/core/Drawer',\n  '@material-ui/core/Fab',\n  '@material-ui/core/Fade',\n  '@material-ui/core/FilledInput',\n  '@material-ui/core/FormLabel',\n  '@material-ui/core/FormControl',\n  '@material-ui/core/FormControlLabel',\n  '@material-ui/core/FormHelperText',\n  '@material-ui/core/FormGroup',\n  '@material-ui/core/Grid',\n  '@material-ui/core/Grid2',\n  '@material-ui/core/Grow',\n  '@material-ui/core/Icon',\n  '@material-ui/core/IconButton',\n  '@material-ui/core/Input',\n  '@material-ui/core/InputBase',\n  '@material-ui/core/InputLabel',\n  '@material-ui/core/InputAdornment',\n  '@material-ui/core/Link',\n  '@material-ui/core/LinearProgress',\n  '@material-ui/core/List',\n  '@material-ui/core/ListItem',\n  '@material-ui/core/ListItemAvatar',\n  '@material-ui/core/ListItemSecondaryAction',\n  '@material-ui/core/ListItemIcon',\n  '@material-ui/core/ListSubheader',\n  '@material-ui/core/ListItemText',\n  '@material-ui/core/Menu',\n  '@material-ui/core/MenuItem',\n  '@material-ui/core/MenuList',\n  '@material-ui/core/Modal',\n  '@material-ui/core/NativeSelect',\n  '@material-ui/core/OutlinedInput',\n  '@material-ui/core/Pagination',\n  '@material-ui/core/PaginationItem',\n  '@material-ui/core/Paper',\n  '@material-ui/core/Popover',\n  '@material-ui/core/Popper',\n  '@material-ui/core/Portal',\n  '@material-ui/core/Radio',\n  '@material-ui/core/RadioGroup',\n  '@material-ui/core/Rating',\n  '@material-ui/core/ScopedCssBaseline',\n  '@material-ui/core/Select',\n  '@material-ui/core/Skeleton',\n  '@material-ui/core/Slider',\n  '@material-ui/core/Snackbar',\n  '@material-ui/core/SnackbarContent',\n  '@material-ui/core/SpeedDial',\n  '@material-ui/core/SpeedDialAction',\n  '@material-ui/core/SpeedDialIcon',\n  '@material-ui/core/Stack',\n  '@material-ui/core/Step',\n  '@material-ui/core/StepButton',\n  '@material-ui/core/StepConnector',\n  '@material-ui/core/StepLabel',\n  '@material-ui/core/StepIcon',\n  '@material-ui/core/Stepper',\n  '@material-ui/core/SvgIcon',\n  '@material-ui/core/Switch',\n  '@material-ui/core/Tab',\n  '@material-ui/core/Table',\n  '@material-ui/core/TableBody',\n  '@material-ui/core/TableCell',\n  '@material-ui/core/TableContainer',\n  '@material-ui/core/TableFooter',\n  '@material-ui/core/TableHead',\n  '@material-ui/core/TablePagination',\n  '@material-ui/core/TableRow',\n  '@material-ui/core/TableSortLabel',\n  '@material-ui/core/Tabs',\n  '@material-ui/core/TextField',\n  '@material-ui/core/TextareaAutosize',\n  '@material-ui/core/ToggleButton',\n  '@material-ui/core/ToggleButtonGroup',\n  '@material-ui/core/Toolbar',\n  '@material-ui/core/Tooltip',\n  '@material-ui/core/Typography',\n\n  '@mui/material/Accordion',\n  '@mui/material/AccordionActions',\n  '@mui/material/AccordionDetails',\n  '@mui/material/AccordionSummary',\n  '@mui/material/Alert',\n  '@mui/material/AlertTitle',\n  '@mui/material/Autocomplete',\n  '@mui/material/Avatar',\n  '@mui/material/AvatarGroup',\n  '@mui/material/Backdrop',\n  '@mui/material/Badge',\n  '@mui/material/Box',\n  '@mui/material/Breadcrumbs',\n  '@mui/material/Button',\n  '@mui/material/ButtonGroup',\n  '@mui/material/Card',\n  '@mui/material/CardActions',\n  '@mui/material/CardActionArea',\n  '@mui/material/CardContent',\n  '@mui/material/CardHeader',\n  '@mui/material/CardMedia',\n  '@mui/material/CircularProgress',\n  '@mui/material/Collapse',\n  '@mui/material/ClickAwayListener',\n  '@mui/material/Chip',\n  '@mui/material/Checkbox',\n  '@mui/material/Container',\n  '@mui/material/Dialog',\n  '@mui/material/DialogActions',\n  '@mui/material/DialogTitle',\n  '@mui/material/DialogContent',\n  '@mui/material/DialogContentText',\n  '@mui/material/Divider',\n  '@mui/material/Drawer',\n  '@mui/material/Fab',\n  '@mui/material/Fade',\n  '@mui/material/FilledInput',\n  '@mui/material/FormLabel',\n  '@mui/material/FormControl',\n  '@mui/material/FormControlLabel',\n  '@mui/material/FormHelperText',\n  '@mui/material/FormGroup',\n  '@mui/material/Grid',\n  '@mui/material/Grid2',\n  '@mui/material/Grow',\n  '@mui/material/Icon',\n  '@mui/material/IconButton',\n  '@mui/material/Input',\n  '@mui/material/InputBase',\n  '@mui/material/InputLabel',\n  '@mui/material/InputAdornment',\n  '@mui/material/Link',\n  '@mui/material/LinearProgress',\n  '@mui/material/List',\n  '@mui/material/ListItem',\n  '@mui/material/ListItemAvatar',\n  '@mui/material/ListItemSecondaryAction',\n  '@mui/material/ListItemIcon',\n  '@mui/material/ListSubheader',\n  '@mui/material/ListItemText',\n  '@mui/material/Menu',\n  '@mui/material/MenuItem',\n  '@mui/material/MenuList',\n  '@mui/material/Modal',\n  '@mui/material/NativeSelect',\n  '@mui/material/OutlinedInput',\n  '@mui/material/Pagination',\n  '@mui/material/PaginationItem',\n  '@mui/material/Paper',\n  '@mui/material/Popover',\n  '@mui/material/Popper',\n  '@mui/material/Portal',\n  '@mui/material/Radio',\n  '@mui/material/RadioGroup',\n  '@mui/material/Rating',\n  '@mui/material/ScopedCssBaseline',\n  '@mui/material/Select',\n  '@mui/material/Skeleton',\n  '@mui/material/Slider',\n  '@mui/material/Snackbar',\n  '@mui/material/SnackbarContent',\n  '@mui/material/SpeedDial',\n  '@mui/material/SpeedDialAction',\n  '@mui/material/SpeedDialIcon',\n  '@mui/material/Stack',\n  '@mui/material/Step',\n  '@mui/material/StepButton',\n  '@mui/material/StepConnector',\n  '@mui/material/StepLabel',\n  '@mui/material/StepIcon',\n  '@mui/material/Stepper',\n  '@mui/material/SvgIcon',\n  '@mui/material/Switch',\n  '@mui/material/Tab',\n  '@mui/material/Table',\n  '@mui/material/TableBody',\n  '@mui/material/TableCell',\n  '@mui/material/TableContainer',\n  '@mui/material/TableFooter',\n  '@mui/material/TableHead',\n  '@mui/material/TablePagination',\n  '@mui/material/TableRow',\n  '@mui/material/TableSortLabel',\n  '@mui/material/Tabs',\n  '@mui/material/TextField',\n  '@mui/material/TextareaAutosize',\n  '@mui/material/ToggleButton',\n  '@mui/material/ToggleButtonGroup',\n  '@mui/material/Toolbar',\n  '@mui/material/Tooltip',\n  '@mui/material/Typography',\n\n  '@material-ui/lab/ToggleButton',\n  '@material-ui/lab/ToggleButtonGroup',\n  '@material-ui/lab/Autocomplete',\n  '@material-ui/lab/Alert',\n  '@material-ui/lab',\n\n  '@jbrowse/core/Plugin',\n  '@jbrowse/core/pluggableElementTypes',\n  '@jbrowse/core/pluggableElementTypes/ViewType',\n  '@jbrowse/core/pluggableElementTypes/AdapterType',\n  '@jbrowse/core/pluggableElementTypes/DisplayType',\n  '@jbrowse/core/pluggableElementTypes/TrackType',\n  '@jbrowse/core/pluggableElementTypes/WidgetType',\n  '@jbrowse/core/pluggableElementTypes/models',\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType',\n  '@jbrowse/core/configuration',\n  '@jbrowse/core/util/types/mst',\n  '@jbrowse/core/ui',\n  '@jbrowse/core/ui/theme',\n  '@jbrowse/core/util',\n  '@jbrowse/core/util/color',\n  '@jbrowse/core/util/layouts',\n  '@jbrowse/core/util/tracks',\n  '@jbrowse/core/util/Base1DViewModel',\n  '@jbrowse/core/util/io',\n  '@jbrowse/core/util/mst-reflection',\n  '@jbrowse/core/util/rxjs',\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail',\n  '@jbrowse/core/data_adapters/BaseAdapter',\n]\n","import * as React from 'react'\n\nimport { alpha, createTheme, useTheme } from '@mui/material'\nimport * as MUIStyles from '@mui/material/styles'\nimport * as MUIUtils from '@mui/material/utils'\nimport {\n  useGridApiContext,\n  useGridApiRef,\n  useGridRootProps,\n} from '@mui/x-data-grid'\nimport * as mobx from 'mobx'\nimport * as mxreact from 'mobx-react'\nimport * as mst from 'mobx-state-tree'\nimport * as ReactJSXRuntime from 'react/jsx-runtime'\nimport * as ReactDom from 'react-dom'\nimport * as ReactDomClient from 'react-dom/client'\nimport { makeStyles } from 'tss-react/mui'\n\nimport Plugin from '../Plugin'\nimport * as Configuration from '../configuration'\nimport * as BaseAdapterExports from '../data_adapters/BaseAdapter'\nimport * as pluggableElementTypes from '../pluggableElementTypes'\nimport { BaseFeatureDetail } from './BaseFeatureDetails'\nimport { DataGridEntries } from './MuiDataGridReExports'\nimport { Entries } from './MuiReExports'\nimport { lazyMap } from './lazify'\nimport reExportsList from './list'\nimport AdapterType from '../pluggableElementTypes/AdapterType'\nimport DisplayType from '../pluggableElementTypes/DisplayType'\nimport TrackType from '../pluggableElementTypes/TrackType'\nimport ViewType from '../pluggableElementTypes/ViewType'\nimport WidgetType from '../pluggableElementTypes/WidgetType'\nimport * as pluggableElementTypeModels from '../pluggableElementTypes/models'\nimport * as BoxRendererType from '../pluggableElementTypes/renderers/BoxRendererType'\nimport CircularChordRendererType from '../pluggableElementTypes/renderers/CircularChordRendererType'\nimport * as FeatureRendererType from '../pluggableElementTypes/renderers/FeatureRendererType'\nimport * as RendererType from '../pluggableElementTypes/renderers/RendererType'\nimport * as ServerSideRendererType from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport * as coreUi from '../ui'\nimport * as coreTheme from '../ui/theme'\nimport * as coreUtil from '../util'\nimport Base1DView from '../util/Base1DViewModel'\nimport * as coreColor from '../util/color'\nimport * as coreIo from '../util/io'\nimport * as coreLayouts from '../util/layouts'\nimport * as coreMstReflection from '../util/mst-reflection'\nimport * as rxjs from '../util/rxjs'\nimport * as trackUtils from '../util/tracks'\nimport * as mstTypes from '../util/types/mst'\n\nconst libs = {\n  mobx,\n  'mobx-state-tree': mst,\n  react: React,\n  'react/jsx-runtime': ReactJSXRuntime,\n  'react-dom': ReactDom,\n  'react-dom/client': ReactDomClient,\n  'mobx-react': mxreact,\n  '@mui/x-data-grid': {\n    useGridApiContext,\n    useGridApiRef,\n    useGridRootProps,\n    ...lazyMap(DataGridEntries),\n  },\n\n  // special case so plugins can easily use @mui/icons-material; don't remove\n  '@mui/material/utils': MUIUtils,\n  '@material-ui/core/utils': MUIUtils,\n  'tss-react/mui': {\n    makeStyles,\n  },\n\n  '@material-ui/core': {\n    ...lazyMap(Entries),\n    useTheme,\n    alpha,\n\n    makeStyles: (args: any) => {\n      const useStyles = makeStyles()(args)\n      return () => useStyles().classes\n    },\n  },\n  '@mui/material': {\n    ...lazyMap(Entries),\n    alpha,\n    useTheme,\n    createTheme,\n  },\n  ...lazyMap(Entries, '@mui/material/'),\n  ...lazyMap(Entries, '@material-ui/core/'),\n\n  '@mui/material/styles': {\n    ...MUIStyles,\n\n    makeStyles: (args: any) => {\n      const useStyles = makeStyles()(args)\n      return () => useStyles().classes\n    },\n  },\n  '@material-ui/core/styles': {\n    ...MUIStyles,\n\n    makeStyles: (args: any) => {\n      const useStyles = makeStyles()(args)\n      return () => useStyles().classes\n    },\n  },\n\n  // these are core in @mui/material, but used to be in @material-ui/lab\n  '@material-ui/lab/ToggleButton': Entries.ToggleButton,\n  '@material-ui/lab/ToggleButtonGroup': Entries.ToggleButtonGroup,\n  '@material-ui/lab/Autocomplete': Entries.Autocomplete,\n  '@material-ui/lab/Alert': Entries.Alert,\n  '@material-ui/lab': {\n    Alert: Entries.Alert,\n    Autocomplete: Entries.Autocomplete,\n    ToggleButton: Entries.ToggleButton,\n    ToggleButtonGroup: Entries.ToggleButtonGroup,\n  },\n\n  '@jbrowse/core/Plugin': Plugin,\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType': RendererType,\n  '@jbrowse/core/configuration': Configuration,\n  '@jbrowse/core/util/types/mst': mstTypes,\n  '@jbrowse/core/ui': coreUi,\n  '@jbrowse/core/ui/theme': coreTheme,\n  '@jbrowse/core/util': coreUtil,\n  '@jbrowse/core/util/color': coreColor,\n  '@jbrowse/core/util/layouts': coreLayouts,\n  '@jbrowse/core/util/tracks': trackUtils,\n  '@jbrowse/core/util/Base1DViewModel': Base1DView,\n  '@jbrowse/core/util/io': coreIo,\n  '@jbrowse/core/util/mst-reflection': coreMstReflection,\n  '@jbrowse/core/util/rxjs': rxjs,\n  '@jbrowse/core/pluggableElementTypes': pluggableElementTypes,\n  '@jbrowse/core/pluggableElementTypes/ViewType': ViewType,\n  '@jbrowse/core/pluggableElementTypes/AdapterType': AdapterType,\n  '@jbrowse/core/pluggableElementTypes/DisplayType': DisplayType,\n  '@jbrowse/core/pluggableElementTypes/TrackType': TrackType,\n  '@jbrowse/core/pluggableElementTypes/WidgetType': WidgetType,\n  '@jbrowse/core/pluggableElementTypes/models': pluggableElementTypeModels,\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType':\n    ServerSideRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType':\n    CircularChordRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType':\n    BoxRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType':\n    FeatureRendererType,\n\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail': BaseFeatureDetail,\n  '@jbrowse/core/data_adapters/BaseAdapter': BaseAdapterExports,\n}\n\nconst libsList = Object.keys(libs)\n\n// make sure that all the items in the ReExports/list array (used by build\n// systems and such) are included here, and vice versa\nconst inLibsOnly = libsList.filter(mod => !reExportsList.includes(mod))\nif (inLibsOnly.length > 0) {\n  throw new Error(\n    `The following modules are in the modules libs, but not the re-exports list: ${inLibsOnly.join(\n      ', ',\n    )}`,\n  )\n}\nconst inReExportsOnly = reExportsList.filter(mod => !libsList.includes(mod))\nif (inReExportsOnly.length) {\n  throw new Error(\n    `The following modules are in the re-exports list, but not the modules libs: ${inReExportsOnly.join(\n      ', ',\n    )}`,\n  )\n}\n\nexport default libs\n","import type { BaseAdapter } from './BaseAdapter'\nimport type { BaseFeatureDataAdapter } from './BaseFeatureDataAdapter'\nimport type { BaseRefNameAliasAdapter } from './BaseRefNameAliasAdapter'\nimport type { BaseSequenceAdapter } from './BaseSequenceAdapter'\nimport type { BaseTextSearchAdapter } from './BaseTextSearchAdapter'\nimport type { RegionsAdapter } from './RegionsAdapter'\n\nexport type AnyDataAdapter =\n  | BaseAdapter\n  | BaseFeatureDataAdapter\n  | BaseRefNameAliasAdapter\n  | BaseTextSearchAdapter\n  | RegionsAdapter\n  | BaseSequenceAdapter\n\nexport function isSequenceAdapter(t: AnyDataAdapter): t is BaseSequenceAdapter {\n  return 'getRegions' in t && 'getFeatures' in t\n}\n\nexport function isRegionsAdapter(t: AnyDataAdapter): t is RegionsAdapter {\n  return 'getRegions' in t\n}\n\nexport function isFeatureAdapter(\n  t: AnyDataAdapter,\n): t is BaseFeatureDataAdapter {\n  return 'getFeatures' in t\n}\n\nexport function isRefNameAliasAdapter(t: object): t is BaseRefNameAliasAdapter {\n  return 'getRefNameAliases' in t\n}\n\nexport function isTextSearchAdapter(\n  t: AnyDataAdapter,\n): t is BaseTextSearchAdapter {\n  return 'searchIndex' in t\n}\n","import { getSnapshot, isStateTreeNode } from 'mobx-state-tree'\n\nimport { ConfigurationSchema, readConfObject } from '../../configuration'\nimport idMaker from '../../util/idMaker'\n\nimport type PluginManager from '../../PluginManager'\nimport type { AnyConfigurationModel } from '../../configuration'\nimport type { AugmentedRegion as Region } from '../../util/types'\nimport type { getSubAdapterType } from '../dataAdapterCache'\n\nconst EmptyConfig = ConfigurationSchema('empty', {})\n\nexport class BaseAdapter {\n  public id: string\n\n  static capabilities = [] as string[]\n\n  constructor(\n    public config: AnyConfigurationModel = EmptyConfig.create(),\n    public getSubAdapter?: getSubAdapterType,\n    public pluginManager?: PluginManager,\n  ) {\n    // note: we use switch on jest here for more simple feature IDs\n    // in test environment\n    if (typeof jest === 'undefined') {\n      const data = isStateTreeNode(config) ? getSnapshot(config) : config\n      this.id = `${idMaker(data)}`\n    } else {\n      this.id = 'test'\n    }\n  }\n\n  /**\n   * Same as `readConfObject(this.config, arg)`.\n   * Note: Does not offer the same TS type checking as `readConfObject`,\n   * consider using that instead.\n   */\n  getConf(arg: string | string[]) {\n    return readConfObject(this.config, arg)\n  }\n\n  /**\n   * Called to provide a hint that data tied to a certain region will not be\n   * needed for the foreseeable future and can be purged from caches, etc\n   * @param region - Region\n   */\n  freeResources(_region: Region) {}\n}\n","import { firstValueFrom, merge } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport { BaseAdapter } from './BaseAdapter'\nimport { max, min, sum } from '../../util'\nimport { ObservableCreate } from '../../util/rxjs'\nimport { blankStats, rectifyStats, scoresToStats } from '../../util/stats'\nimport { checkStopToken } from '../../util/stopToken'\n\nimport type { BaseOptions } from './BaseOptions'\nimport type { FeatureDensityStats } from './types'\nimport type { Feature } from '../../util/simpleFeature'\nimport type { AugmentedRegion as Region } from '../../util/types'\nimport type { Observable } from 'rxjs'\n\n/**\n * Base class for feature adapters to extend. Defines some methods that\n * subclasses must implement.\n */\nexport abstract class BaseFeatureDataAdapter extends BaseAdapter {\n  /**\n   * Get all reference sequence names used in the data source\n   * Example:\n   * public async getRefNames(opts?: BaseOptions): Promise\\<string[]\\> \\}\n   *   await this.setup()\n   *   const \\{ refNames \\} = this.metadata\n   *   return refNames\n   * \\}\n   *\n   *\n   * NOTE: If an adapter is unable to determine the reference sequence names,\n   * the array will be empty\n   * @param opts - Feature adapter options\n   */\n  public abstract getRefNames(opts?: BaseOptions): Promise<string[]>\n\n  /**\n   * Get features from the data source that overlap a region\n   * Example:\n   * public getFeatures(\n   *   region: Region,\n   *   opts: BaseOptions,\n   * ): Observable<Feature> \\{\n   *   return ObservableCreate(observer =\\> \\{\n   *     const records = getRecords(assembly, refName, start, end)\n   *     records.forEach(record =\\> \\{\n   *       observer.next(this.recordToFeature(record))\n   *     \\})\n   *     observer.complete()\n   *   \\})\n   * \\}\n   * @param region - Region\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the region\n   */\n  public abstract getFeatures(\n    region: Region,\n    opts?: BaseOptions,\n  ): Observable<Feature>\n\n  /**\n   * Return \"header info\" that is fetched from the data file, or other info\n   * that would not simply be in the config of the file. The return value can\n   * be `{tag:string, data: any}[]` e.g. list of tags with their values which\n   * is how VCF,BAM,CRAM return values for getInfo or it can be a nested JSON\n   * object\n   */\n  public async getHeader(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Return info that is primarily used for interpreting the data that is there,\n   * primarily in reference to being used for augmenting feature details panels\n   */\n  public async getMetadata(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   */\n  public getFeaturesInRegion(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const hasData = await this.hasDataForRefName(region.refName, opts)\n      checkStopToken(opts.stopToken)\n      if (!hasData) {\n        observer.complete()\n      } else {\n        this.getFeatures(region, opts).subscribe(observer)\n      }\n    })\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   *\n   * @param regions - Regions\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the regions\n   */\n  public getFeaturesInMultipleRegions(\n    regions: Region[],\n    opts: BaseOptions = {},\n  ) {\n    return merge(\n      ...regions.map(region => this.getFeaturesInRegion(region, opts)),\n    )\n  }\n\n  /**\n   * Check if the store has data for the given reference name.\n   * @param refName - Name of the reference sequence\n   * @returns Whether data source has data for the given reference name\n   */\n  public async hasDataForRefName(refName: string, opts: BaseOptions = {}) {\n    const refNames = await this.getRefNames(opts)\n    return refNames.includes(refName)\n  }\n\n  /**\n   * Calculates the minimum score, maximum score, and other statistics from\n   * features over a region, primarily used for quantitative tracks\n   */\n  public async getRegionQuantitativeStats(region: Region, opts?: BaseOptions) {\n    const feats = this.getFeatures(region, opts)\n    return scoresToStats(region, feats)\n  }\n  /**\n   * Calculates the minimum score, maximum score, and other statistics from\n   * features over multiple regions, primarily used for quantitative tracks\n   */\n  public async getMultiRegionQuantitativeStats(\n    regions: Region[] = [],\n    opts?: BaseOptions,\n  ) {\n    if (!regions.length) {\n      return blankStats()\n    }\n    const feats = await Promise.all(\n      regions.map(region => this.getRegionQuantitativeStats(region, opts)),\n    )\n\n    const scoreMax = max(feats.map(a => a.scoreMax))\n    const scoreMin = min(feats.map(a => a.scoreMin))\n    const scoreSum = sum(feats.map(a => a.scoreSum))\n    const scoreSumSquares = sum(feats.map(a => a.scoreSumSquares))\n    const featureCount = sum(feats.map(a => a.featureCount))\n    const basesCovered = sum(feats.map(a => a.basesCovered))\n\n    return rectifyStats({\n      scoreMin,\n      scoreMax,\n      featureCount,\n      basesCovered,\n      scoreSumSquares,\n      scoreSum,\n    })\n  }\n\n  /**\n   * Calculates the \"feature density\" of a region. The primary purpose of this\n   * API is to alert the user if they are going to be downloading too much\n   * information, and give them a hint to zoom in to see more. The default\n   * implementation samples from the regions, downloads feature data with\n   * getFeatures, and returns an object with the form \\{featureDensity:number\\}\n   *\n   * Derived classes can override this to return alternative calculations for\n   * featureDensity, or they can also return an object containing a byte size\n   * calculation with the format \\{bytes:number, fetchSizeLimit:number\\} where\n   * fetchSizeLimit is the adapter-defined limit for what it thinks is 'too\n   * much data' (e.g. CRAM and BAM may vary on what they think too much data\n   * is)\n   */\n  getRegionFeatureDensityStats(region: Region, opts?: BaseOptions) {\n    let lastTime = +Date.now()\n    const statsFromInterval = async (length: number, expansionTime: number) => {\n      const { start, end } = region\n      const sampleCenter = start * 0.75 + end * 0.25\n\n      const features = await firstValueFrom(\n        this.getFeatures(\n          {\n            ...region,\n            start: Math.max(0, Math.round(sampleCenter - length / 2)),\n            end: Math.min(Math.round(sampleCenter + length / 2), end),\n          },\n          opts,\n        ).pipe(toArray()),\n      )\n\n      return maybeRecordStats({\n        interval: length,\n        statsSampleFeatures: features.length,\n        expansionTime,\n        stats: {\n          featureDensity: features.length / length,\n        },\n      })\n    }\n\n    const maybeRecordStats = async ({\n      interval,\n      stats,\n      statsSampleFeatures,\n      expansionTime,\n    }: {\n      interval: number\n      stats: FeatureDensityStats\n      statsSampleFeatures: number\n      expansionTime: number\n    }): Promise<FeatureDensityStats> => {\n      const refLen = region.end - region.start\n      if (statsSampleFeatures >= 70 || interval * 2 > refLen) {\n        return stats\n      } else if (expansionTime <= 5000) {\n        const currTime = +Date.now()\n        expansionTime += currTime - lastTime\n        lastTime = currTime\n        return statsFromInterval(interval * 2, expansionTime)\n      } else {\n        console.warn(\n          \"Stats estimation reached timeout, or didn't get enough features\",\n        )\n        return { featureDensity: Number.POSITIVE_INFINITY }\n      }\n    }\n\n    return statsFromInterval(1000, 0)\n  }\n\n  /**\n   * Calculates the \"feature density\" of a set of regions. The primary purpose\n   * of this API is to alert the user if they are going to be downloading too\n   * much information, and give them a hint to zoom in to see more. The default\n   * implementation samples from the regions, downloads feature data with\n   * getFeatures, and returns an object with the form \\{featureDensity:number\\}\n   *\n   * Derived classes can override this to return alternative calculations for\n   * featureDensity, or they can also return an object containing a byte size\n   * calculation with the format \\{bytes:number, fetchSizeLimit:number\\} where\n   * fetchSizeLimit is the adapter-defined limit for what it thinks is 'too\n   * much data' (e.g. CRAM and BAM may vary on what they think too much data\n   * is)\n   */\n  public async getMultiRegionFeatureDensityStats(\n    regions: Region[],\n    opts?: BaseOptions,\n  ) {\n    if (!regions.length) {\n      throw new Error('No regions supplied')\n    }\n    return this.getRegionFeatureDensityStats(regions[0]!, opts)\n  }\n\n  async getSources(\n    regions: Region[],\n  ): Promise<{ name: string; color?: string; [key: string]: unknown }[]> {\n    const features = await firstValueFrom(\n      this.getFeaturesInMultipleRegions(regions).pipe(toArray()),\n    )\n    const sources = new Set<string>()\n    for (const f of features) {\n      sources.add(f.get('source'))\n    }\n    return [...sources].map(source => ({\n      name: source,\n    }))\n  }\n}\n","import { BaseFeatureDataAdapter } from './BaseFeatureDataAdapter'\n\nimport type { BaseOptions } from './types'\nimport type { NoAssemblyRegion } from '../../util'\nimport type { RegionsAdapter } from '../BaseAdapter'\n\nexport abstract class BaseSequenceAdapter\n  extends BaseFeatureDataAdapter\n  implements RegionsAdapter\n{\n  async getMultiRegionFeatureDensityStats() {\n    return { featureDensity: 0 }\n  }\n\n  /**\n   * Fetches a list of 'regions' with refName, start, and extends\n   */\n  abstract getRegions(opts: BaseOptions): Promise<NoAssemblyRegion[]>\n}\n","import PluggableElementBase from './PluggableElementBase'\n\nimport type { AnyConfigurationSchemaType } from '../configuration'\nimport type { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport interface AdapterMetadata {\n  category?: string\n  hiddenFromGUI?: boolean\n  description?: string\n}\n\nexport default class AdapterType extends PluggableElementBase {\n  getAdapterClass: () => Promise<AnyAdapter>\n\n  configSchema: AnyConfigurationSchemaType\n\n  adapterCapabilities: string[]\n\n  adapterMetadata?: AdapterMetadata\n\n  constructor(\n    stuff: {\n      name: string\n      configSchema: AnyConfigurationSchemaType\n      displayName?: string\n      adapterCapabilities?: string[]\n      adapterMetadata?: AdapterMetadata\n    } & (\n      | {\n          AdapterClass: AnyAdapter\n        }\n      | {\n          getAdapterClass: () => Promise<AnyAdapter>\n        }\n    ),\n  ) {\n    super(stuff)\n    this.getAdapterClass =\n      'AdapterClass' in stuff\n        ? async () => stuff.AdapterClass\n        : stuff.getAdapterClass\n    this.configSchema = stuff.configSchema\n    this.adapterCapabilities = stuff.adapterCapabilities || []\n    this.adapterMetadata = stuff.adapterMetadata\n  }\n}\n","function findCircleIntersectionX(\n  y: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(y - cy)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([cx, y])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([cx - solution, y], [cx + solution, y])\n}\n\nfunction findCircleIntersectionY(\n  x: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(x - cx)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([x, cy])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([x, cy - solution], [x, cy + solution])\n}\n\nfunction cartesianToTheta(x: number, y: number) {\n  let theta = (Math.atan(y / x) + 2 * Math.PI) % (2 * Math.PI)\n  if (x < 0) {\n    if (y <= 0) {\n      theta += Math.PI\n    } else {\n      theta -= Math.PI\n    }\n  }\n  return theta\n}\n\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  if (rho === 0) {\n    return [0, 0] as const\n  }\n  const theta = cartesianToTheta(x, y)\n  return [rho, theta] as const\n}\n\nconst twoPi = 2 * Math.PI\nexport function thetaRangesOverlap(\n  r1start: number,\n  r1length: number,\n  r2start: number,\n  r2length: number,\n) {\n  if (r1length <= 0 || r2length <= 0) {\n    return false\n  }\n  if (r1length + 0.0001 >= twoPi || r2length + 0.0001 >= twoPi) {\n    return true\n  }\n\n  // put both range starts between 2π and 4π\n  r1start = (((r1start % twoPi) + twoPi) % twoPi) + twoPi\n  r2start = (((r2start % twoPi) + twoPi) % twoPi) + twoPi\n\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move r2 2π to the left and check\n  r2start -= twoPi\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move it 2π to the right and check\n  r2start += twoPi + twoPi\n  return r1start < r2start + r2length && r1start + r1length > r2start\n}\n\n// return which arc range has any part of the circle visible in the viewport\nexport function viewportVisibleSection(\n  viewSides: [number, number, number, number],\n  circleCenter: [number, number],\n  circleRadius: number,\n) {\n  let [viewL, viewR, viewT, viewB] = viewSides\n  const [cx, cy] = circleCenter\n\n  // transform coordinate system to center of circle\n  viewL -= cx\n  viewR -= cx\n  viewT -= cy\n  viewB -= cy\n\n  const centerIsInsideViewport =\n    viewL < 0 && viewR > 0 && viewT < 0 && viewB > 0\n\n  if (centerIsInsideViewport) {\n    const vertices = [\n      [viewL, viewT],\n      [viewR, viewT],\n      [viewL, viewB],\n      [viewR, viewB],\n    ] as const\n    let maxRho = Number.NEGATIVE_INFINITY\n    for (const [x, y] of vertices) {\n      const rho = Math.sqrt(x * x + y * y)\n      if (rho > maxRho) {\n        maxRho = rho\n      }\n    }\n    return {\n      rho: [0, Math.min(circleRadius, maxRho)] as [number, number],\n      theta: [0, 2 * Math.PI] as [number, number],\n    }\n  }\n  // const viewportCompletelyContainsCircle =\n  //   circleCenter[0] - viewL >= circleRadius &&\n  //   viewR - circleCenter[0] >= circleRadius &&\n  //   circleCenter[1] - viewT >= circleRadius &&\n  //   viewB - circleCenter[1] >= circleRadius\n\n  // if (viewportCompletelyContainsCircle) {\n  //   return [0, 2 * Math.PI]\n  // }\n\n  // const distToCenterSquared = ([x, y]) => {\n  //   const [cx, cy] = circleCenter\n  //   const sq = n => n * n\n  //   return sq(x - cx) + sq(y - cy)\n  // }\n  // const circleRadiusSquared = circleRadius * circleRadius\n\n  // const tlInside = distToCenterSquared([viewL, viewT]) <= circleRadiusSquared\n  // const trInside = distToCenterSquared([viewR, viewT]) <= circleRadiusSquared\n  // const blInside = distToCenterSquared([viewL, viewB]) <= circleRadiusSquared\n  // const brInside = distToCenterSquared([viewR, viewB]) <= circleRadiusSquared\n\n  // const noIntersection = !tlInside && !trInside && !blInside && !brInside\n  // if (noIntersection) return undefined\n\n  // const circleCompletelyContainsViewport =\n  //   tlInside && trInside && blInside && brInside\n  // if (circleCompletelyContainsViewport) {\n  //   // viewport is in the circle, but the center is not in it, so take max\n  //   // and min of thetas to the center\n  //   const thetas = [\n  //     Math.atan(viewT / viewL),\n  //     Math.atan(viewT / viewR),\n  //     Math.atan(viewB / viewL),\n  //     Math.atan(viewB / viewR),\n  //   ]\n\n  //   return [Math.min(...thetas), Math.max(...thetas)]\n  // }\n\n  // if we get here, the viewport is partly in, partly out of the circle\n\n  // const viewLIntersects = Math.abs(viewL - circleCenter[0]) <= circleRadius\n  // const viewRIntersects = Math.abs(viewR - circleCenter[0]) <= circleRadius\n  // const viewTIntersects = Math.abs(viewT - circleCenter[1]) <= circleRadius\n  // const viewBIntersects = Math.abs(viewB - circleCenter[1]) <= circleRadius\n\n  // const numIntersectingSides =\n  //   Number(viewLIntersects) +\n  //   Number(viewRIntersects) +\n  //   Number(viewTIntersects) +\n  //   Number(viewBIntersects)\n\n  // if (numIntersectingSides === 4) return [0, 2 * Math.PI]\n  // if (numIntersectingSides === 3) {\n  //   // TODO calculate the thetas of the\n  // } else if (numIntersectingSides === 2) {\n  //   // TODO calculate the thetas of the 2 intersection points\n  // } else if (numIntersectingSides === 1) {\n  //   // TODO calculate the thetas of the 1-2 intersection points of the line, and the angle between\n  // }\n\n  // make a list of vertices-of-interest that lie inside both shapes to examine\n  // to determine the range covered by their intersection\n\n  // transform coordinates to have the circle as the origin and find the intersections\n  // of the circle and the view rectangle\n  const vertices: [number, number][] = [\n    [viewL, viewT],\n    [viewR, viewT],\n    [viewL, viewB],\n    [viewR, viewB],\n  ]\n  findCircleIntersectionY(viewL, 0, 0, circleRadius, vertices)\n  findCircleIntersectionY(viewR, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewT, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewB, 0, 0, circleRadius, vertices)\n\n  // for each edge, also look at the closest point to center if it is inside the circle\n  if (-viewL < circleRadius) {\n    vertices.push([viewL, 0])\n  }\n  if (viewR < circleRadius) {\n    vertices.push([viewR, 0])\n  }\n  if (-viewT < circleRadius) {\n    vertices.push([0, viewT])\n  }\n  if (viewB < circleRadius) {\n    vertices.push([0, viewB])\n  }\n\n  // const verticesOriginal = vertices.map(([x, y]) => [x + cx, y + cy])\n\n  // now convert them all to polar and take the max and min of rho and theta\n\n  // const viewportCenterTheta = cartesianToTheta(viewR + viewL, viewT + viewB)\n  const reflect = viewL >= 0 ? -1 : 1\n  // viewportCenterTheta < Math.PI / 2 || viewportCenterTheta > 1.5 * Math.PI\n  //   ? -1\n  //   : 1\n  let rhoMin = Number.POSITIVE_INFINITY\n  let rhoMax = Number.NEGATIVE_INFINITY\n  let thetaMin = Number.POSITIVE_INFINITY\n  let thetaMax = Number.NEGATIVE_INFINITY\n  for (const [vx, vy] of vertices) {\n    // ignore vertex if outside the viewport\n    if (vx >= viewL && vx <= viewR && vy >= viewT && vy <= viewB) {\n      const [rho, theta] = cartesianToPolar(vx * reflect, vy * reflect)\n      // ignore vertex if outside the circle\n      if (rho <= circleRadius + 0.001) {\n        // ignore theta if rho is 0\n        if (theta < thetaMin && rho > 0.0001) {\n          thetaMin = theta\n        }\n        if (theta > thetaMax && rho > 0.0001) {\n          thetaMax = theta\n        }\n        if (rho < rhoMin) {\n          rhoMin = rho\n        }\n        if (rho > rhoMax) {\n          rhoMax = rho\n        }\n      }\n    }\n  }\n\n  if (reflect === -1) {\n    thetaMin += Math.PI\n    thetaMax += Math.PI\n  }\n\n  if (thetaMin > 2 * Math.PI && thetaMax > 2 * Math.PI) {\n    thetaMin -= 2 * Math.PI\n    thetaMax -= 2 * Math.PI\n  }\n\n  return {\n    rho: [rhoMin, Math.min(circleRadius, rhoMax)] as [number, number],\n    theta: [thetaMin, thetaMax] as [number, number],\n  }\n}\n","import { assembleLocString, polarToCartesian } from '@jbrowse/core/util'\n\nimport { thetaRangesOverlap } from './viewportVisibleRegion'\n\nimport type { Region } from '@jbrowse/core/util'\n\nexport interface SliceElidedRegion {\n  elided: true\n  widthBp: number\n  regions: Region[]\n}\n\nexport interface SliceNonElidedRegion {\n  elided: false\n  widthBp: number\n  start: number\n  end: number\n  refName: string\n  assemblyName: string\n}\nexport type SliceRegion = SliceNonElidedRegion | SliceElidedRegion\n\nexport class Slice {\n  key: string\n\n  startRadians: number\n\n  endRadians: number\n\n  bpPerRadian: number\n\n  flipped: boolean\n\n  constructor(\n    view: { bpPerRadian: number },\n    public region: SliceRegion,\n    public offsetRadians: number,\n    public radianWidth: number,\n  ) {\n    const { bpPerRadian } = view\n    this.key =\n      'regions' in region\n        ? JSON.stringify(region.regions)\n        : assembleLocString(region)\n    this.bpPerRadian = bpPerRadian\n    this.flipped = false\n\n    this.startRadians = offsetRadians\n    this.endRadians = region.widthBp / this.bpPerRadian + offsetRadians\n    Object.freeze(this)\n  }\n\n  bpToXY(bp: number, radiusPx: number) {\n    let offsetBp: number | undefined\n    if (this.region.elided) {\n      offsetBp = this.region.widthBp / 2\n    } else if (this.flipped) {\n      offsetBp = this.region.end - bp\n    } else {\n      offsetBp = bp - this.region.start\n    }\n    const totalRadians = offsetBp / this.bpPerRadian + this.offsetRadians\n    return polarToCartesian(radiusPx, totalRadians)\n  }\n\n  toJSON() {\n    return Object.fromEntries(Object.entries(this))\n  }\n}\n\nfunction calculateStaticSlices(self: {\n  elidedRegions: readonly SliceRegion[]\n  bpPerRadian: number\n  spacingPx: number\n  pxPerRadian: number\n}) {\n  const slices = []\n  let currentRadianOffset = 0\n  const { bpPerRadian, spacingPx, pxPerRadian } = self\n  for (const region of self.elidedRegions) {\n    const radianWidth = region.widthBp / bpPerRadian + spacingPx / pxPerRadian\n    slices.push(new Slice(self, region, currentRadianOffset, radianWidth))\n    currentRadianOffset += radianWidth\n  }\n  return slices\n}\n\nfunction sliceIsVisible(\n  self: { offsetRadians: number; visibleSection: { theta: [number, number] } },\n  slice: Slice,\n) {\n  const {\n    theta: [visibleThetaMin, visibleThetaMax],\n  } = self.visibleSection\n\n  return thetaRangesOverlap(\n    slice.offsetRadians + self.offsetRadians,\n    slice.radianWidth,\n    visibleThetaMin,\n    visibleThetaMax - visibleThetaMin,\n  )\n}\n\nexport { calculateStaticSlices, sliceIsVisible }\n","import type React from 'react'\nimport { lazy } from 'react'\n\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  clamp,\n  getSession,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\nimport { saveAs } from 'file-saver'\nimport { transaction } from 'mobx'\nimport { cast, getRoot, resolveIdentifier, types } from 'mobx-state-tree'\n\nimport { calculateStaticSlices, sliceIsVisible } from './slices'\nimport { viewportVisibleSection } from './viewportVisibleRegion'\n\nimport type { SliceRegion } from './slices'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type { Region as IRegion } from '@jbrowse/core/util/types'\nimport type { Region } from '@jbrowse/core/util/types/mst'\nimport type { Instance, SnapshotOrInstance } from 'mobx-state-tree'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n  Wrapper?: React.FC<{ children: React.ReactNode }>\n  themeName?: string\n}\n\n/**\n * #stateModel CircularView\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  const minHeight = 40\n  const minWidth = 100\n  const defaultHeight = 400\n  return types\n    .compose(\n      'CircularView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('CircularView'),\n        /**\n         * #property\n         * similar to offsetPx in linear genome view\n         */\n        offsetRadians: -Math.PI / 2,\n        /**\n         * #property\n         */\n        bpPerPx: 200,\n        /**\n         * #property\n         */\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        /**\n         * #property\n         */\n        hideVerticalResizeHandle: false,\n        /**\n         * #property\n         */\n        hideTrackSelectorButton: false,\n        /**\n         * #property\n         */\n        lockedFitToWindow: true,\n        /**\n         * #property\n         */\n        disableImportForm: false,\n\n        /**\n         * #property\n         */\n        height: types.optional(types.number, defaultHeight),\n        /*\n         * #property\n         */\n        displayedRegions: types.optional(types.frozen<IRegion[]>(), []),\n        /**\n         * #property\n         */\n        scrollX: 0,\n        /**\n         * #property\n         */\n        scrollY: 0,\n\n        /**\n         * #property\n         */\n        minimumRadiusPx: 25,\n        /**\n         * #property\n         */\n        spacingPx: 10,\n        /**\n         * #property\n         */\n        paddingPx: 80,\n        /**\n         * #property\n         */\n        lockedPaddingPx: 100,\n        /**\n         * #property\n         */\n        minVisibleWidth: 6,\n        /**\n         * #property\n         */\n        minimumBlockWidth: 20,\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      error: undefined as unknown,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get width() {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'wait for view to be initialized first before accessing width',\n          )\n        }\n        return self.volatileWidth\n      },\n\n      /**\n       * #getter\n       */\n      get visibleSection() {\n        const { scrollX, scrollY, width, height } = self\n        return viewportVisibleSection(\n          [scrollX, scrollX + width, scrollY, scrollY + height],\n          this.centerXY,\n          this.radiusPx,\n        )\n      },\n      /**\n       * #getter\n       */\n      get circumferencePx() {\n        let elidedBp = 0\n\n        for (const r of this.elidedRegions) {\n          elidedBp += r.widthBp\n        }\n        return (\n          elidedBp / self.bpPerPx + self.spacingPx * this.elidedRegions.length\n        )\n      },\n      /**\n       * #getter\n       */\n      get radiusPx() {\n        return this.circumferencePx / (2 * Math.PI)\n      },\n      /**\n       * #getter\n       */\n      get bpPerRadian() {\n        return self.bpPerPx * this.radiusPx\n      },\n      /**\n       * #getter\n       */\n      get pxPerRadian() {\n        return this.radiusPx\n      },\n      /**\n       * #getter\n       */\n      get centerXY(): [number, number] {\n        return [this.radiusPx + self.paddingPx, this.radiusPx + self.paddingPx]\n      },\n      /**\n       * #getter\n       */\n      get totalBp() {\n        let total = 0\n        for (const region of self.displayedRegions) {\n          total += region.end - region.start\n        }\n        return total\n      },\n      /**\n       * #getter\n       */\n      get maximumRadiusPx() {\n        return self.lockedFitToWindow\n          ? Math.min(self.width, self.height) / 2 - self.lockedPaddingPx\n          : 1000000\n      },\n      /**\n       * #getter\n       */\n      get maxBpPerPx() {\n        const minCircumferencePx = 2 * Math.PI * self.minimumRadiusPx\n        return this.totalBp / minCircumferencePx\n      },\n      /**\n       * #getter\n       */\n      get minBpPerPx() {\n        // min depends on window dimensions, clamp between old min(0.01) and max\n        const maxCircumferencePx = 2 * Math.PI * this.maximumRadiusPx\n        return clamp(\n          this.totalBp / maxCircumferencePx,\n          0.0000000001,\n          this.maxBpPerPx,\n        )\n      },\n      /**\n       * #getter\n       */\n      get atMaxBpPerPx() {\n        return self.bpPerPx >= this.maxBpPerPx\n      },\n      /**\n       * #getter\n       */\n      get atMinBpPerPx() {\n        return self.bpPerPx <= this.minBpPerPx\n      },\n      /**\n       * #getter\n       */\n      get tooSmallToLock() {\n        return this.minBpPerPx <= 0.0000000001\n      },\n      /**\n       * #getter\n       */\n      get figureDimensions(): [number, number] {\n        return [\n          this.radiusPx * 2 + 2 * self.paddingPx,\n          this.radiusPx * 2 + 2 * self.paddingPx,\n        ]\n      },\n      /**\n       * #getter\n       */\n      get figureWidth() {\n        return this.figureDimensions[0]\n      },\n      /**\n       * #getter\n       */\n      get figureHeight() {\n        return this.figureDimensions[1]\n      },\n      /**\n       * #getter\n       * this is displayedRegions, post-processed to elide regions that are too\n       * small to see reasonably\n       */\n      get elidedRegions() {\n        const visible: SliceRegion[] = []\n        for (const region of self.displayedRegions) {\n          const widthBp = region.end - region.start\n          const widthPx = widthBp / self.bpPerPx\n          if (widthPx < self.minVisibleWidth) {\n            // too small to see, collapse into a single elision region\n            const lastVisible = visible.at(-1)\n            if (lastVisible?.elided) {\n              lastVisible.regions.push({ ...region })\n              lastVisible.widthBp += widthBp\n            } else {\n              visible.push({\n                elided: true,\n                widthBp,\n                regions: [{ ...region }],\n              })\n            }\n          } else {\n            // big enough to see, display it\n            visible.push({ ...region, widthBp, elided: false })\n          }\n        }\n\n        // remove any single-region elisions\n        for (let i = 0; i < visible.length; i += 1) {\n          const v = visible[i]!\n          if (v.elided && v.regions.length === 1) {\n            visible[i] = { ...v, ...v.regions[0]!, elided: false }\n          }\n        }\n        return visible\n      },\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        const assemblyNames: string[] = []\n        for (const displayedRegion of self.displayedRegions) {\n          if (!assemblyNames.includes(displayedRegion.assemblyName)) {\n            assemblyNames.push(displayedRegion.assemblyName)\n          }\n        }\n        return assemblyNames\n      },\n      /**\n       * #getter\n       */\n      get initialized() {\n        const { assemblyManager } = getSession(self)\n        return (\n          self.volatileWidth !== undefined &&\n          this.assemblyNames.every(a => assemblyManager.get(a)?.initialized)\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get staticSlices() {\n        return calculateStaticSlices(self)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get visibleStaticSlices() {\n        return self.staticSlices.filter(s => sliceIsVisible(self, s))\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = Math.max(newWidth, minWidth)\n        return self.volatileWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = Math.max(newHeight, minHeight)\n        return self.height\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        this.setModelViewWhenAdjust(!self.tooSmallToLock)\n        return newHeight - oldHeight\n      },\n      /**\n       * #action\n       */\n      resizeWidth(distance: number) {\n        const oldWidth = self.width\n        const newWidth = this.setWidth(self.width + distance)\n        this.setModelViewWhenAdjust(!self.tooSmallToLock)\n        return newWidth - oldWidth\n      },\n      /**\n       * #action\n       */\n      rotateClockwiseButton() {\n        this.rotateClockwise(Math.PI / 6)\n      },\n\n      /**\n       * #action\n       */\n      rotateCounterClockwiseButton() {\n        this.rotateCounterClockwise(Math.PI / 6)\n      },\n\n      /**\n       * #action\n       */\n      rotateClockwise(distance = 0.17) {\n        self.offsetRadians += distance\n      },\n\n      /**\n       * #action\n       */\n      rotateCounterClockwise(distance = 0.17) {\n        self.offsetRadians -= distance\n      },\n\n      /**\n       * #action\n       */\n      zoomInButton() {\n        this.setBpPerPx(self.bpPerPx / 1.4)\n      },\n\n      /**\n       * #action\n       */\n      zoomOutButton() {\n        this.setBpPerPx(self.bpPerPx * 1.4)\n      },\n\n      /**\n       * #action\n       */\n      setBpPerPx(newVal: number) {\n        self.bpPerPx = clamp(newVal, self.minBpPerPx, self.maxBpPerPx)\n      },\n\n      /**\n       * #action\n       */\n      setModelViewWhenAdjust(secondCondition: boolean) {\n        if (self.lockedFitToWindow && secondCondition) {\n          this.setBpPerPx(self.minBpPerPx)\n        }\n      },\n\n      /**\n       * #action\n       */\n      setDisplayedRegions(regions: SnapshotOrInstance<typeof Region>[]) {\n        const previouslyEmpty = self.displayedRegions.length === 0\n        self.displayedRegions = cast(regions)\n\n        if (previouslyEmpty) {\n          this.setBpPerPx(self.minBpPerPx)\n        } else {\n          this.setBpPerPx(self.bpPerPx)\n        }\n      },\n\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        const hiddenCount = this.hideTrack(trackId)\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n          return true\n        }\n        return false\n      },\n\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        self.error = error\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const trackType = pluginManager.getTrackType(conf.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${conf.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)!\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          supportedDisplays.has(d.type),\n        )\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      /**\n       * #action\n       */\n      addTrackConf(configuration: AnyConfigurationModel, initialSnapshot = {}) {\n        const { type } = configuration\n        const name = readConfObject(configuration, 'name')\n        const trackType = pluginManager.getTrackType(type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)!\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.has(d.type),\n        )\n        self.tracks.push(\n          trackType.stateModel.create({\n            ...initialSnapshot,\n            name,\n            type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const tracks = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => {\n          for (const track of tracks) {\n            self.tracks.remove(track)\n          }\n        })\n        return tracks.length\n      },\n\n      /**\n       * #action\n       */\n      toggleFitToWindowLock() {\n        // when going unlocked -> locked and circle is cut off, set to the\n        // locked minBpPerPx\n        self.lockedFitToWindow = !self.lockedFitToWindow\n        this.setModelViewWhenAdjust(self.atMinBpPerPx)\n        return self.lockedFitToWindow\n      },\n      /**\n       * #action\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import('./svgcomponents/SVGCircularView')\n        const html = await renderToSvg(self as CircularViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * return the view menu items\n       */\n      menuItems(): MenuItem[] {\n        return [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              self.setDisplayedRegions([])\n            },\n            icon: FolderOpenIcon,\n          },\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                { model: self, handleClose },\n              ])\n            },\n          },\n          {\n            label: 'Open track selector',\n            onClick: self.activateTrackSelector,\n            icon: TrackSelectorIcon,\n          },\n        ]\n      },\n    }))\n}\n\nexport type CircularViewStateModel = ReturnType<typeof stateModelFactory>\nexport type CircularViewModel = Instance<CircularViewStateModel>\n\nexport default stateModelFactory\n","import { observer } from 'mobx-react'\n\nconst DisplayError = observer(function ({\n  model,\n}: {\n  model: { renderProps: { radius: number }; error: unknown }\n}) {\n  const {\n    renderProps: { radius },\n    error,\n  } = model\n  return (\n    <g>\n      <defs>\n        <pattern\n          id=\"diagonalHatch\"\n          width=\"10\"\n          height=\"10\"\n          patternTransform=\"rotate(45 0 0)\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <line\n            x1=\"0\"\n            y1=\"0\"\n            x2=\"0\"\n            y2=\"10\"\n            style={{ stroke: 'rgba(255,0,0,0.5)', strokeWidth: 10 }}\n          />\n        </pattern>\n      </defs>\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#ffb4b4\" />\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n      <text\n        x=\"0\"\n        y=\"0\"\n        transform=\"rotate(90 0 0)\"\n        dominantBaseline=\"middle\"\n        textAnchor=\"middle\"\n      >\n        {String(error)}\n      </text>\n    </g>\n  )\n})\n\nexport default DisplayError\n","import { useEffect, useState } from 'react'\n\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()(theme => {\n  const offset = 2\n  const duration = 1.4\n\n  const { primary, secondary, tertiary, quaternary } = theme.palette\n  return {\n    path: {\n      strokeDasharray: 187,\n      strokeDashoffset: 50,\n      animation: `$dash ${duration}s ease-in-out infinite, $colors ${\n        duration * 4\n      }s ease-in-out infinite`,\n    },\n    '@keyframes colors': {\n      '0%': {\n        stroke: primary.light,\n      },\n      '25%': {\n        stroke: secondary.light,\n      },\n      '50%': {\n        stroke: tertiary.light,\n      },\n      '75%': {\n        stroke: quaternary.light,\n      },\n      '100%': {\n        stroke: primary.light,\n      },\n    },\n\n    '@keyframes dash': {\n      '0%': {\n        strokeDashoffset: offset,\n      },\n      '50%': {\n        strokeDashoffset: offset / 4,\n        transform: 'rotate(135deg)',\n      },\n      '100%': {\n        strokeDashoffset: offset,\n        transform: 'rotate(720deg)',\n      },\n    },\n  }\n})\n\nconst Loading = observer(function ({\n  model: {\n    renderProps: { radius },\n  },\n}: {\n  model: { renderProps: { radius: number } }\n}) {\n  const { classes } = useStyles()\n\n  // only show the loading message after 400ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      setShown(true)\n    }, 400)\n    return () => {\n      clearTimeout(timeout)\n    }\n  })\n\n  return !shown ? null : (\n    <g>\n      <defs>\n        <pattern\n          id=\"diagonalHatch\"\n          width=\"10\"\n          height=\"10\"\n          patternTransform=\"rotate(45 0 0)\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <line\n            x1=\"0\"\n            y1=\"0\"\n            x2=\"0\"\n            y2=\"10\"\n            style={{ stroke: 'rgba(255,255,255,0.5)', strokeWidth: 10 }}\n          />\n        </pattern>\n      </defs>\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#f1f1f1\" />\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n      <text\n        x=\"0\"\n        y=\"0\"\n        transform=\"rotate(90 0 0)\"\n        dominantBaseline=\"middle\"\n        textAnchor=\"middle\"\n      >\n        Loading&hellip;\n      </text>\n      <circle\n        className={classes.path}\n        fill=\"none\"\n        strokeWidth=\"4\"\n        strokeLinecap=\"round\"\n        cx=\"0\"\n        cy=\"0\"\n        r=\"60\"\n      />\n    </g>\n  )\n})\n\nexport default Loading\n","import { observer } from 'mobx-react'\n\nimport DisplayError from './DisplayError'\nimport Loading from './Loading'\n\nconst BaseChordDisplay = observer(function ({\n  display,\n}: {\n  display: {\n    filled: boolean\n    error: unknown\n    reactElement: React.ReactElement\n    renderProps: { radius: number }\n  }\n}) {\n  if (display.error) {\n    return <DisplayError model={display} />\n  } else if (!display.filled) {\n    return <Loading model={display} />\n  } else {\n    return display.reactElement\n  }\n})\n\nexport default BaseChordDisplay\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BaseChordDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst baseChordDisplayConfig = ConfigurationSchema(\n  'BaseChordDisplay',\n  {\n    /**\n     * #slot\n     */\n    onChordClick: {\n      type: 'boolean',\n      description:\n        'callback that should be run when a chord in the track is clicked',\n      defaultValue: false,\n      contextVariable: ['feature', 'track', 'pluginManager'],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'displayId',\n  },\n)\n\nexport { baseChordDisplayConfig }\n","import { getContainingView, getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\n\nimport type { CircularViewModel } from '../CircularView/model'\n\nexport function renderReactionData(self: any) {\n  const view = getContainingView(self) as CircularViewModel\n  const { rendererType } = self\n  const { rpcManager } = getSession(view)\n\n  return {\n    rendererType,\n    rpcManager,\n    renderProps: self.renderProps(),\n    renderArgs: {\n      assemblyName: view.displayedRegions[0]!.assemblyName,\n      adapterConfig: structuredClone(self.adapterConfig),\n      rendererType: rendererType.name,\n      regions: structuredClone(view.displayedRegions),\n      blockDefinitions: self.blockDefinitions,\n      sessionId: getRpcSessionId(self),\n      timeout: 1000000,\n    },\n  }\n}\n\nexport async function renderReactionEffect(props?: any, stopToken?: string) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const {\n    rendererType,\n    rpcManager,\n    cannotBeRenderedReason,\n    renderArgs,\n    renderProps,\n    exportSVG,\n  } = props\n\n  if (cannotBeRenderedReason) {\n    return { message: cannotBeRenderedReason }\n  }\n\n  // don't try to render 0 or NaN radius or no regions\n  if (!renderProps.radius || !renderArgs.regions?.length) {\n    return { message: 'Skipping render' }\n  }\n\n  const { html, ...data } = await rendererType.renderInClient(rpcManager, {\n    ...renderArgs,\n    ...renderProps,\n    exportSVG,\n    stopToken,\n  })\n\n  return {\n    html,\n    data,\n    reactElement: data.reactElement,\n    renderingComponent: rendererType.ReactComponent,\n  }\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  ReactRendering,\n  getContainingView,\n  getEnv,\n  getSession,\n  isFeature,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport { getParent, isAlive, types } from 'mobx-state-tree'\n\nimport { baseChordDisplayConfig } from './configSchema'\nimport { renderReactionData, renderReactionEffect } from './renderReaction'\n\nimport type { CircularViewModel, ExportSvgOptions } from '../CircularView/model'\nimport type { AnyReactComponentType, Feature } from '@jbrowse/core/util'\nimport type { ThemeOptions } from '@mui/material'\n\n/**\n * #stateModel BaseChordDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const BaseChordDisplayModel = types\n  .compose(\n    'BaseChordDisplay',\n    BaseDisplay,\n    types.model({\n      /**\n       * #property\n       */\n      bezierRadiusRatio: 0.1,\n      /**\n       * #property\n       */\n      assemblyName: types.maybe(types.string),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(baseChordDisplayConfig),\n    }),\n  )\n  .volatile(() => ({\n    // NOTE: all this volatile stuff has to be filled in at once\n    // so that it stays consistent\n    /**\n     * #volatile\n     */\n    filled: false,\n    /**\n     * #volatile\n     */\n    reactElement: undefined as React.ReactElement | undefined,\n    /**\n     * #volatile\n     */\n    data: undefined,\n    /**\n     * #volatile\n     */\n    html: undefined as string | undefined,\n    /**\n     * #volatile\n     */\n    message: '',\n    /**\n     * #volatile\n     */\n    renderingComponent: undefined as undefined | AnyReactComponentType,\n    /**\n     * #volatile\n     */\n    refNameMap: undefined as Record<string, string> | undefined,\n  }))\n  .actions(self => {\n    const { pluginManager } = getEnv(self)\n    const track = self\n    return {\n      /**\n       * #action\n       */\n      onChordClick(feature: Feature) {\n        getConf(self, 'onChordClick', { feature, track, pluginManager })\n      },\n    }\n  })\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get blockDefinitions() {\n      const view = getContainingView(self) as CircularViewModel\n      const origSlices = view.staticSlices\n      if (!self.refNameMap) {\n        return origSlices\n      }\n\n      const slices = structuredClone(origSlices)\n\n      for (const slice of slices) {\n        const regions = slice.region.elided\n          ? slice.region.regions\n          : [slice.region]\n        for (const region of regions) {\n          const renamed = self.refNameMap[region.refName]\n          if (renamed && region.refName !== renamed) {\n            region.refName = renamed\n          }\n        }\n      }\n      return slices\n    },\n\n    /**\n     * #method\n     */\n    renderProps() {\n      const view = getContainingView(self) as CircularViewModel\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n        radius: view.radiusPx,\n        blockDefinitions: this.blockDefinitions,\n        onChordClick: self.onChordClick,\n      }\n    },\n\n    /**\n     * #getter\n     * the pluggable element type object for this display's renderer\n     */\n    get rendererType() {\n      return getEnv(self).pluginManager.getRendererType(self.rendererTypeName)\n    },\n\n    /**\n     * #getter\n     * returns a string feature ID if the globally-selected object is probably\n     * a feature\n     */\n    get selectedFeatureId() {\n      if (!isAlive(self)) {\n        return undefined\n      }\n      const { selection } = getSession(self)\n      return isFeature(selection) ? selection.id() : undefined\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    renderStarted() {\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.data = undefined\n      self.html = undefined\n      self.error = undefined\n      self.renderingComponent = undefined\n    },\n    /**\n     * #action\n     */\n    renderSuccess({\n      message,\n      data,\n      reactElement,\n      html,\n      renderingComponent,\n    }: {\n      message?: string\n      data?: any\n      html?: string\n      reactElement?: React.ReactElement\n      renderingComponent?: AnyReactComponentType\n    }) {\n      if (message) {\n        self.filled = false\n        self.message = message\n        self.reactElement = undefined\n        self.data = undefined\n        self.html = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n      } else {\n        self.filled = true\n        self.message = ''\n        self.reactElement = reactElement\n        self.data = data\n        self.html = html\n        self.error = undefined\n        self.renderingComponent = renderingComponent\n      }\n    },\n    /**\n     * #action\n     */\n    renderError(error: unknown) {\n      console.error(error)\n      // the rendering failed for some reason\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.html = undefined\n      self.data = undefined\n      self.error = error\n      self.renderingComponent = undefined\n    },\n\n    /**\n     * #action\n     */\n    setRefNameMap(refNameMap: Record<string, string>) {\n      self.refNameMap = refNameMap\n    },\n  }))\n  .actions(self => ({\n    afterAttach() {\n      makeAbortableReaction(\n        self,\n        renderReactionData,\n        renderReactionEffect,\n        {\n          name: `${self.type} ${self.id} rendering`,\n          fireImmediately: true,\n        },\n        self.renderStarted,\n        self.renderSuccess,\n        self.renderError,\n      )\n\n      makeAbortableReaction(\n        self,\n        () => {\n          return {\n            assemblyNames: getTrackAssemblyNames(self.parentTrack),\n            adapter: getConf(getParent<any>(self, 2), 'adapter'),\n            assemblyManager: getSession(self).assemblyManager,\n          } as const\n        },\n        async (args, stopToken) => {\n          return args\n            ? args.assemblyManager.getRefNameMapForAdapter(\n                args.adapter,\n                args.assemblyNames[0],\n                {\n                  stopToken,\n                  sessionId: getRpcSessionId(self),\n                },\n              )\n            : undefined\n        },\n        {\n          name: `${self.type} ${self.id} getting refNames`,\n          fireImmediately: true,\n        },\n        () => {},\n        refNameMap => {\n          if (refNameMap) {\n            self.setRefNameMap(refNameMap)\n          }\n        },\n        error => {\n          console.error(error)\n          self.setError(error)\n        },\n      )\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     */\n    async renderSvg(\n      opts: ExportSvgOptions & {\n        theme?: ThemeOptions\n      },\n    ) {\n      const data = renderReactionData(self)\n      const rendering = await renderReactionEffect({\n        ...data,\n        exportSVG: opts,\n        theme: opts.theme || data.renderProps.theme,\n      })\n      return <ReactRendering rendering={rendering} />\n    },\n  }))\n","import Plugin from '@jbrowse/core/Plugin'\nimport { isAbstractMenuManager } from '@jbrowse/core/util'\nimport DataUsageIcon from '@mui/icons-material/DataUsage'\n\nimport CircularViewF from './CircularView'\nimport LaunchCircularViewF from './LaunchCircularView'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default class CircularViewPlugin extends Plugin {\n  name = 'CircularViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    CircularViewF(pluginManager)\n    LaunchCircularViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Circular view',\n        icon: DataUsageIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('CircularView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseChordDisplayComponent,\n  BaseChordDisplayModel,\n  baseChordDisplayConfig,\n} from './BaseChordDisplay'\n\nexport {\n  type CircularViewModel,\n  type CircularViewStateModel,\n} from './CircularView/model'\n","import { lazy } from 'react'\n\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function CircularViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(\n    () =>\n      new ViewType({\n        ReactComponent: lazy(() => import('./components/CircularView')),\n        stateModel: stateModelFactory(pluginManager),\n        name: 'CircularView',\n        displayName: 'Circular view',\n      }),\n  )\n}\n","import { when } from 'mobx'\n\nimport type { CircularViewModel } from '../CircularView/model'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\ntype CGV = CircularViewModel\n\nexport default function LaunchCircularViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-CircularView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      assembly?: string\n      loc: string\n      tracks?: string[]\n    }) => {\n      const { assemblyManager } = session\n      const view = session.addView('CircularView', {}) as CGV\n\n      await when(() => view.initialized)\n\n      if (!assembly) {\n        throw new Error(\n          'No assembly provided when launching circular genome view',\n        )\n      }\n\n      const asm = await assemblyManager.waitForAssembly(assembly)\n      if (!asm) {\n        throw new Error(\n          `Assembly \"${assembly}\" not found when launching circular genome view`,\n        )\n      }\n\n      view.setDisplayedRegions(asm.regions || [])\n\n      for (const track of tracks) {\n        view.showTrack(track)\n      }\n    },\n  )\n}\n","// get relative reference sequence positions for positions given relative to\n// the read sequence\nexport function getNextRefPos(cigarOps: string[], positions: number[]) {\n  let readPos = 0\n  let refPos = 0\n  let currPos = 0\n  const ret = []\n  for (let i = 0; i < cigarOps.length && currPos < positions.length; i += 2) {\n    const len = +cigarOps[i]!\n    const op = cigarOps[i + 1]!\n    if (op === 'S' || op === 'I') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          currPos++\n        }\n      }\n      readPos += len\n    } else if (op === 'D' || op === 'N') {\n      refPos += len\n    } else if (op === 'M' || op === 'X' || op === '=') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          ret.push({\n            ref: refPos + i,\n            idx: currPos,\n          })\n          currPos++\n        }\n      }\n      readPos += len\n      refPos += len\n    }\n  }\n  return ret\n}\n","import { useEffect, useState } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { clamp, getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\n\nimport type { LayoutRecord } from './types'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface Display {\n  height: number\n  scrollTop: number\n  SNPCoverageDisplay?: { height: number }\n  notReady?: () => boolean\n  searchFeatureByID?: (str: string) => LayoutRecord\n}\n\ninterface Track {\n  displays: Display[]\n  configuration: AnyConfigurationModel\n}\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3] as const\n\nfunction cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\n\nexport function heightFromSpecificLevel(\n  views: LGV[],\n  trackId: string,\n  level: number,\n  getYPosOverride?: (trackId: string, level: number) => number,\n) {\n  return getYPosOverride\n    ? getYPosOverride(trackId, level)\n    : views[level]!.trackRefs[trackId]?.getBoundingClientRect().top || 0\n}\n\nexport function getPxFromCoordinate(view: LGV, refName: string, coord: number) {\n  return (view.bpToPx({ refName, coord })?.offsetPx || 0) - view.offsetPx\n}\n\n// get's the yposition of a layout record in a track\nexport function yPos(\n  trackId: string,\n  level: number,\n  views: LGV[],\n  tracks: Track[],\n  c: LayoutRecord,\n  getYPosOverride?: (trackId: string, level: number) => number,\n) {\n  const display = tracks[level]!.displays[0]!\n  const min = 0\n  const max = display.height\n  let offset = 0\n  const { SNPCoverageDisplay } = display\n  if (SNPCoverageDisplay) {\n    offset = SNPCoverageDisplay.height\n  }\n  const yPos = getYPosOverride ? 0 : display.scrollTop\n  return (\n    clamp(c[TOP] - yPos + cheight(c) / 2 + offset, min, max) +\n    heightFromSpecificLevel(views, trackId, level, getYPosOverride) +\n    display.scrollTop\n  )\n}\n\n// we combo a useEffect and useState combo to force rerender on snap changing.\n// the setup of this being a useEffect+useState makes it re-render once the\n// useEffect is called, which is generally the \"next frame\". If we removed the\n// below use\nexport const useNextFrame = (variable: unknown) => {\n  const [, setNextFrameState] = useState<unknown>()\n  useEffect(() => {\n    setNextFrameState(variable)\n  }, [variable])\n}\n\n// https://stackoverflow.com/a/49186706/2129219 the array-intersection package\n// on npm has a large kb size, and we are just intersecting open track ids so\n// simple is better\nexport function intersect<T>(\n  cb: (l: T) => string,\n  a1: T[] = [],\n  a2: T[] = [],\n  ...rest: T[][]\n): T[] {\n  const ids = new Set(a2.map(elt => cb(elt)))\n  const a12 = a1.filter(value => ids.has(cb(value)))\n  return rest.length === 0 ? a12 : intersect(cb, a12, ...rest)\n}\n\nexport function calc(track: Track, f: Feature) {\n  return track.displays[0]!.searchFeatureByID?.(f.id())\n}\n\nexport async function getBlockFeatures(\n  model: { views: LinearGenomeViewModel[] },\n  track: Track,\n) {\n  const { views } = model\n  const { rpcManager } = getSession(model)\n  const sessionId = getRpcSessionId(track)\n\n  return Promise.all(\n    views.flatMap(\n      async view =>\n        (await rpcManager.call(sessionId, 'CoreGetFeatures', {\n          adapterConfig: getConf(track, ['adapter']),\n          sessionId,\n          regions: view.staticBlocks.contentBlocks,\n        })) as Feature[][],\n    ),\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { linearBasicDisplayModelFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel LinearVariantDisplay\n * similar to basic display, but provides custom widget on feature click\n * extends\n *\n * - [LinearBasicDisplay](../linearbasicdisplay)\n */\nexport default function stateModelFactory(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearVariantDisplay',\n      linearBasicDisplayModelFactory(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearVariantDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      async selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const { rpcManager } = session\n          const sessionId = getRpcSessionId(self)\n          const track = getContainingTrack(self)\n          const view = getContainingView(self)\n          const adapterConfig = getConf(track, 'adapter')\n          const descriptions = await rpcManager.call(\n            sessionId,\n            'CoreGetMetadata',\n            {\n              adapterConfig,\n            },\n          )\n          session.showWidget(\n            session.addWidget('VariantFeatureWidget', 'variantFeature', {\n              featureData: feature.toJSON(),\n              view,\n              track,\n              descriptions,\n            }),\n          )\n        }\n\n        session.setSelection(feature)\n      },\n    }))\n}\n\nexport type LinearVariantDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearVariantDisplayModel = Instance<LinearVariantDisplayStateModel>\n","import type { SampleInfo, Source } from './types'\n\nexport function getSources({\n  sources,\n  layout = sources,\n  renderingMode,\n  sampleInfo,\n}: {\n  sources: Source[]\n  layout?: Source[]\n  renderingMode: string\n  sampleInfo?: Record<string, SampleInfo>\n}) {\n  const rows = []\n  const sourceMap = Object.fromEntries(sources.map(s => [s.name, s]))\n  for (const row of layout) {\n    // make separate rows for each haplotype in phased mode\n    if (renderingMode === 'phased') {\n      const info = sampleInfo?.[row.name]\n      if (info?.isPhased) {\n        const ploidy = info.maxPloidy\n        for (let i = 0; i < ploidy; i++) {\n          const id = `${row.name} HP${i}`\n          rows.push({\n            ...sourceMap[row.name],\n            ...row,\n            label: id,\n            HP: i,\n            id: id,\n          })\n        }\n      }\n    }\n    // non-phased mode does not make separate rows\n    else {\n      rows.push({\n        ...sourceMap[row.name],\n        ...row,\n        label: row.name,\n        id: row.name,\n      })\n    }\n  }\n  return rows\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getSession } from '@jbrowse/core/util'\nimport { stopStopToken } from '@jbrowse/core/util/stopToken'\nimport { linearBareDisplayStateModelFactory } from '@jbrowse/plugin-linear-genome-view'\nimport CategoryIcon from '@mui/icons-material/Category'\nimport FilterListIcon from '@mui/icons-material/FilterList'\nimport HeightIcon from '@mui/icons-material/Height'\nimport SplitscreenIcon from '@mui/icons-material/Splitscreen'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport deepEqual from 'fast-deep-equal'\nimport { cast, types } from 'mobx-state-tree'\n\nimport { getSources } from './getSources'\n\nimport type { SampleInfo, Source } from './types'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst SetColorDialog = lazy(() => import('./components/SetColorDialog'))\nconst MAFFilterDialog = lazy(() => import('./components/MAFFilterDialog'))\nconst AddFiltersDialog = lazy(() => import('./components/AddFiltersDialog'))\nconst ClusterDialog = lazy(\n  () => import('./components/MultiVariantClusterDialog/ClusterDialog'),\n)\nconst SetRowHeightDialog = lazy(() => import('./components/SetRowHeightDialog'))\n\n/**\n * #stateModel MultiVariantBaseModel\n * extends\n * - [LinearBareDisplay](../linearbaredisplay)\n */\nexport default function MultiVariantBaseModelF(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearVariantMatrixDisplay',\n      linearBareDisplayStateModelFactory(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearVariantMatrixDisplay'),\n\n        /**\n         * #property\n         */\n        layout: types.optional(types.frozen<Source[]>(), []),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n\n        /**\n         * #property\n         */\n        minorAlleleFrequencyFilter: types.optional(types.number, 0),\n\n        /**\n         * #property\n         */\n        showSidebarLabelsSetting: true,\n\n        /**\n         * #property\n         */\n        renderingMode: types.optional(types.string, 'alleleCount'),\n\n        /**\n         * #property\n         * used only if autoHeight is false\n         */\n        rowHeightSetting: types.optional(types.number, 8),\n\n        /**\n         * #property\n         * used only if autoHeight is false\n         */\n        autoHeight: true,\n\n        /**\n         * #property\n         */\n        lengthCutoffFilter: Number.MAX_SAFE_INTEGER,\n\n        /**\n         * #property\n         */\n        jexlFilters: types.maybe(types.array(types.string)),\n\n        /**\n         * #property\n         */\n        referenceDrawingMode: 'skip',\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      sourcesLoadingStopToken: undefined as string | undefined,\n      /**\n       * #volatile\n       */\n      simplifiedFeaturesStopToken: undefined as string | undefined,\n      /**\n       * #volatile\n       */\n      featureUnderMouseVolatile: undefined as Feature | undefined,\n      /**\n       * #volatile\n       */\n      sourcesVolatile: undefined as Source[] | undefined,\n      /**\n       * #volatile\n       */\n      featuresVolatile: undefined as Feature[] | undefined,\n      /**\n       * #volatile\n       */\n      hasPhased: false,\n      /**\n       * #volatile\n       */\n      sampleInfo: undefined as undefined | Record<string, SampleInfo>,\n      /**\n       * #volatile\n       */\n      hoveredGenotype: undefined as\n        | { genotype: string; name: string }\n        | undefined,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setJexlFilters(f?: string[]) {\n        self.jexlFilters = cast(f)\n      },\n      /**\n       * #action\n       */\n      setRowHeight(arg: number) {\n        self.rowHeightSetting = arg\n      },\n      /**\n       * #action\n       */\n      setHoveredGenotype(arg?: { genotype: string; name: string }) {\n        self.hoveredGenotype = arg\n      },\n      /**\n       * #action\n       */\n      setFeatures(f: Feature[]) {\n        self.featuresVolatile = f\n      },\n      /**\n       * #action\n       */\n      setLayout(layout: Source[]) {\n        self.layout = layout\n      },\n      /**\n       * #action\n       */\n      clearLayout() {\n        self.layout = []\n      },\n      /**\n       * #action\n       */\n      setSourcesLoading(str: string) {\n        if (self.sourcesLoadingStopToken) {\n          stopStopToken(self.sourcesLoadingStopToken)\n        }\n        self.sourcesLoadingStopToken = str\n      },\n      /**\n       * #action\n       */\n      setSimplifiedFeaturesLoading(str: string) {\n        if (self.simplifiedFeaturesStopToken) {\n          stopStopToken(self.simplifiedFeaturesStopToken)\n        }\n        self.simplifiedFeaturesStopToken = str\n      },\n\n      /**\n       * #action\n       */\n      setSources(sources: Source[]) {\n        if (!deepEqual(sources, self.sourcesVolatile)) {\n          self.sourcesVolatile = sources\n        }\n      },\n      /**\n       * #action\n       */\n      setMafFilter(arg: number) {\n        self.minorAlleleFrequencyFilter = arg\n      },\n      /**\n       * #action\n       */\n      setShowSidebarLabels(arg: boolean) {\n        self.showSidebarLabelsSetting = arg\n      },\n      /**\n       * #action\n       */\n      setPhasedMode(arg: string) {\n        self.renderingMode = arg\n      },\n      /**\n       * #action\n       */\n      setAutoHeight(arg: boolean) {\n        self.autoHeight = arg\n      },\n      /**\n       * #action\n       */\n      setHasPhased(arg: boolean) {\n        self.hasPhased = arg\n      },\n      /**\n       * #action\n       */\n      setSampleInfo(arg: Record<string, SampleInfo>) {\n        if (!deepEqual(arg, self.sampleInfo)) {\n          self.sampleInfo = arg\n        }\n      },\n      /**\n       * #action\n       */\n      setReferenceDrawingMode(arg: string) {\n        self.referenceDrawingMode = arg\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get activeFilters() {\n        // config jexlFilters are deferred evaluated so they are prepended with\n        // jexl at runtime rather than being stored with jexl in the config\n        return (\n          self.jexlFilters ??\n          getConf(self, 'jexlFilters').map((r: string) => `jexl:${r}`)\n        )\n      },\n      /**\n       * #getter\n       */\n      get preSources() {\n        return self.layout.length ? self.layout : self.sourcesVolatile\n      },\n\n      get sourcesWithoutLayout() {\n        return self.sourcesVolatile\n          ? getSources({\n              sources: self.sourcesVolatile,\n              renderingMode: self.renderingMode,\n              sampleInfo: self.sampleInfo,\n            })\n          : undefined\n      },\n      /**\n       * #getter\n       */\n      get sources() {\n        const sourcesWithLayout = self.layout.length\n          ? self.layout\n          : self.sourcesVolatile\n        return sourcesWithLayout\n          ? getSources({\n              sources: sourcesWithLayout,\n              renderingMode: self.renderingMode,\n              sampleInfo: self.sampleInfo,\n            })\n          : undefined\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n\n      return {\n        /**\n         * #getter\n         */\n        get sourceMap() {\n          return self.sources\n            ? Object.fromEntries(\n                self.sources.map(source => [source.name, source]),\n              )\n            : undefined\n        },\n        /**\n         * #getter\n         */\n        get rowHeight() {\n          const { sources, autoHeight, rowHeightSetting, height } = self\n          return autoHeight ? height / (sources?.length || 1) : rowHeightSetting\n        },\n        /**\n         * #method\n         */\n        adapterProps() {\n          const superProps = superRenderProps()\n          return {\n            ...superProps,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            config: self.rendererConfig,\n          }\n        },\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show sidebar labels',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSidebarLabelsSetting,\n              onClick: () => {\n                self.setShowSidebarLabels(!self.showSidebarLabelsSetting)\n              },\n            },\n\n            {\n              label: 'Row height',\n              icon: HeightIcon,\n              subMenu: [\n                {\n                  label: 'Manually set row height',\n                  disabled: self.autoHeight,\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SetRowHeightDialog,\n                      {\n                        model: self,\n                        handleClose,\n                      },\n                    ])\n                  },\n                },\n                {\n                  label: 'Auto-adjust to display height',\n                  type: 'checkbox',\n                  checked: self.autoHeight,\n                  onClick: () => {\n                    self.setAutoHeight(!self.autoHeight)\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Rendering mode',\n              icon: SplitscreenIcon,\n              subMenu: [\n                {\n                  label: 'Allele count',\n                  type: 'radio',\n                  checked: self.renderingMode === 'alleleCount',\n                  onClick: () => {\n                    self.setPhasedMode('alleleCount')\n                  },\n                },\n                {\n                  label: `Phased${\n                    !self.hasPhased\n                      ? ' (disabled, no phased variants found)'\n                      : ''\n                  }`,\n                  disabled: !self.hasPhased,\n                  checked: self.renderingMode === 'phased',\n                  type: 'radio',\n                  onClick: () => {\n                    self.setPhasedMode('phased')\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Reference mode',\n              type: 'subMenu',\n              subMenu: [\n                {\n                  label:\n                    'Fill background grey, skip reference allele mouseovers (helps with large overlapping SVs)',\n                  type: 'radio',\n                  checked: self.referenceDrawingMode === 'skip',\n                  onClick: () => {\n                    self.setReferenceDrawingMode('skip')\n                  },\n                },\n                {\n                  label:\n                    \"Don't fill background grey, only draw actual reference alleles as grey\",\n                  type: 'radio',\n                  checked: self.referenceDrawingMode === 'draw',\n                  onClick: () => {\n                    self.setReferenceDrawingMode('draw')\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              subMenu: [\n                {\n                  label: 'Minor allele frequency',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      MAFFilterDialog,\n                      {\n                        model: self,\n                        handleClose,\n                      },\n                    ])\n                  },\n                },\n                {\n                  label: 'Edit filters',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      AddFiltersDialog,\n                      {\n                        model: self,\n                        handleClose,\n                      },\n                    ])\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Cluster by genotype',\n              icon: CategoryIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  ClusterDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n            {\n              label: 'Edit group colors/arrangement...',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetColorDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get canDisplayLabels() {\n        return self.rowHeight >= 8 && self.showSidebarLabelsSetting\n      },\n      /**\n       * #getter\n       */\n      get totalHeight() {\n        return self.rowHeight * (self.sources?.length || 1)\n      },\n      /**\n       * #getter\n       */\n      get featuresReady() {\n        return !!self.featuresVolatile\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      renderProps() {\n        const superProps = self.adapterProps()\n        return {\n          ...superProps,\n          notReady: superProps.notReady || !self.sources || !self.featuresReady,\n          height: self.height,\n          totalHeight: self.totalHeight,\n          renderingMode: self.renderingMode,\n          minorAlleleFrequencyFilter: self.minorAlleleFrequencyFilter,\n          lengthCutoffFilter: self.lengthCutoffFilter,\n          rowHeight: self.rowHeight,\n          sources: self.sources,\n          scrollTop: self.scrollTop,\n          referenceDrawingMode: self.referenceDrawingMode,\n          filters: new SerializableFilterChain({\n            filters: self.activeFilters,\n          }),\n        }\n      },\n    }))\n}\n\nexport type MultiVariantBaseStateModel = ReturnType<\n  typeof MultiVariantBaseModelF\n>\nexport type MultiVariantBaseModel = Instance<MultiVariantBaseStateModel>\n","import { getSession } from '@jbrowse/core/util'\nimport { isAlive, types } from 'mobx-state-tree'\n\nimport MultiVariantBaseModelF from '../shared/MultiVariantBaseModel'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { ExportSvgDisplayOptions } from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel MultiLinearVariantDisplay\n * extends\n * - [MultiVariantBaseModel](../linearbaredisplay)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'MultiLinearVariantDisplay',\n      MultiVariantBaseModelF(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('MultiLinearVariantDisplay'),\n        /**\n         * #property\n         * used only if autoHeight is false\n         */\n        rowHeightSetting: types.optional(types.number, 11),\n        /**\n         * #property\n         */\n        minorAlleleFrequencyFilter: types.optional(types.number, 0),\n      }),\n    )\n    .views(() => ({\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return 'MultiVariantRenderer'\n      },\n    }))\n    .actions(self => {\n      const { renderSvg: superRenderSvg } = self\n      return {\n        afterAttach() {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          ;(async () => {\n            try {\n              const { getMultiVariantSourcesAutorun } = await import(\n                '../getMultiVariantSourcesAutorun'\n              )\n              const { getMultiVariantFeaturesAutorun } = await import(\n                '../getMultiVariantFeaturesAutorun'\n              )\n\n              getMultiVariantSourcesAutorun(self)\n              getMultiVariantFeaturesAutorun(self)\n            } catch (e) {\n              if (isAlive(self)) {\n                console.error(e)\n                getSession(self).notifyError(`${e}`, e)\n              }\n            }\n          })()\n        },\n\n        /**\n         * #action\n         */\n        async renderSvg(opts: ExportSvgDisplayOptions) {\n          const { renderSvg } = await import('./renderSvg')\n          return renderSvg(self, opts, superRenderSvg)\n        },\n      }\n    })\n}\n\nexport type MultiLinearVariantDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type MultiLinearVariantDisplayModel =\n  Instance<MultiLinearVariantDisplayStateModel>\n\nexport default stateModelFactory\n","import { useRef, useState } from 'react'\n\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { observer } from 'mobx-react'\n\nimport LinesConnectingMatrixToGenomicPosition from './LinesConnectingMatrixToGenomicPosition'\nimport Crosshair from '../../shared/components/MultiVariantCrosshairs'\nimport LegendBar from '../../shared/components/MultiVariantLegendBar'\n\nimport type { MultiLinearVariantMatrixDisplayModel } from '../model'\n\nconst MultiLinearVariantMatrixDisplayComponent = observer(function (props: {\n  model: MultiLinearVariantMatrixDisplayModel\n}) {\n  const { model } = props\n  const { lineZoneHeight } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const [mouseY, setMouseY] = useState<number>()\n  const [mouseX, setMouseX] = useState<number>()\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={event => {\n        const rect = ref.current?.getBoundingClientRect()\n        const top = rect?.top || 0\n        const left = rect?.left || 0\n        setMouseY(event.clientY - top)\n        setMouseX(event.clientX - left)\n      }}\n      onMouseLeave={() => {\n        setMouseY(undefined)\n        setMouseX(undefined)\n      }}\n    >\n      <div style={{ position: 'relative' }}>\n        <LinesConnectingMatrixToGenomicPosition model={model} />\n        <div style={{ position: 'absolute', top: lineZoneHeight }}>\n          <LegendBar model={model} />\n          <BaseLinearDisplayComponent {...props} />\n        </div>\n      </div>\n\n      {mouseX && mouseY && mouseY > lineZoneHeight ? (\n        <Crosshair mouseX={mouseX} mouseY={mouseY} model={model} />\n      ) : null}\n    </div>\n  )\n})\nexport default MultiLinearVariantMatrixDisplayComponent\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config LinearVariantMatrixRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst LinearVariantMatrixRenderer = ConfigurationSchema(\n  'LinearVariantMatrixRenderer',\n  {},\n  { explicitlyTyped: true },\n)\nexport default LinearVariantMatrixRenderer\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\n// locals\nimport configSchema from '../MultiLinearVariantMatrixRenderer/configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearVariantMatrixDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearVariantMatrixDisplay',\n    {\n      /**\n       * #slot\n       * MultiLinearVariantMatrixRenderer\n       */\n      renderer: configSchema,\n\n      /**\n       * #slot\n       */\n      height: {\n        type: 'number',\n        defaultValue: 250,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { clamp, getSession } from '@jbrowse/core/util'\nimport { isAlive, types } from 'mobx-state-tree'\n\nimport MultiVariantBaseModelF from '../shared/MultiVariantBaseModel'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { ExportSvgDisplayOptions } from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel LinearVariantMatrixDisplay\n * extends\n * - [MultiVariantBaseModel](../multivariantbasemodel)\n */\nexport default function stateModelFactory(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearVariantMatrixDisplay',\n      MultiVariantBaseModelF(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearVariantMatrixDisplay'),\n\n        /**\n         * #property\n         */\n        rowHeightSetting: types.optional(types.number, 1),\n        /**\n         * #property\n         */\n        lineZoneHeight: 20,\n      }),\n    )\n    .views(self => ({\n      get nrow() {\n        return self.sources?.length || 1\n      },\n      /**\n       * #getter\n       */\n      get blockType() {\n        return 'dynamicBlocks'\n      },\n      /**\n       * #getter\n       */\n      get totalHeight() {\n        return self.autoHeight\n          ? self.height - self.lineZoneHeight\n          : this.nrow * self.rowHeightSetting\n      },\n\n      /**\n       * #getter\n       */\n      get rowHeight() {\n        return self.autoHeight\n          ? self.totalHeight / this.nrow\n          : self.rowHeightSetting\n      },\n\n      /**\n       * #getter\n       */\n      get featuresReady() {\n        return !!self.featuresVolatile\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #method\n       */\n      renderProps() {\n        const superProps = self.adapterProps()\n        return {\n          ...superProps,\n          notReady: superProps.notReady || !self.sources || !self.featuresReady,\n          renderingMode: self.renderingMode,\n          minorAlleleFrequencyFilter: self.minorAlleleFrequencyFilter,\n          lengthCutoffFilter: self.lengthCutoffFilter,\n          height: self.totalHeight,\n          sources: self.sources,\n        }\n      },\n      /**\n       * #getter\n       */\n      get canDisplayLabels() {\n        return self.rowHeight > 8 && self.showSidebarLabelsSetting\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setLineZoneHeight(n: number) {\n        self.lineZoneHeight = clamp(n, 10, 1000)\n        return self.lineZoneHeight\n      },\n    }))\n    .actions(self => {\n      const { renderSvg: superRenderSvg } = self\n      return {\n        /**\n         * #action\n         */\n        setLineZoneHeight(n: number) {\n          self.lineZoneHeight = clamp(n, 10, 1000)\n          return self.lineZoneHeight\n        },\n        afterAttach() {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          ;(async () => {\n            try {\n              const { getMultiVariantSourcesAutorun } = await import(\n                '../getMultiVariantSourcesAutorun'\n              )\n              const { getMultiVariantFeaturesAutorun } = await import(\n                '../getMultiVariantFeaturesAutorun'\n              )\n\n              getMultiVariantSourcesAutorun(self)\n              getMultiVariantFeaturesAutorun(self)\n            } catch (e) {\n              if (isAlive(self)) {\n                console.error(e)\n                getSession(self).notifyError(`${e}`, e)\n              }\n            }\n          })()\n        },\n\n        /**\n         * #action\n         */\n        async renderSvg(opts: ExportSvgDisplayOptions) {\n          const { renderSvg } = await import('./renderSvg')\n          return renderSvg(self, opts, superRenderSvg)\n        },\n      }\n    })\n}\n\nexport type MultiLinearVariantMatrixDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type MultiLinearVariantMatrixDisplayModel =\n  Instance<MultiLinearVariantMatrixDisplayStateModel>\n","import BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { SimpleFeature, renderToAbstractCanvas } from '@jbrowse/core/util'\n\nimport type { RenderArgsDeserialized } from './types'\n\nexport default class LinearVariantMatrixRenderer extends BoxRendererType {\n  supportsSVG = true\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const { height, sources, regions, bpPerPx } = renderProps\n    const region = regions[0]!\n    const { end, start } = region\n\n    const width = (end - start) / bpPerPx\n    const { makeImageData } = await import('./makeImageData')\n    const { mafs, ...rest } = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      ctx =>\n        makeImageData({\n          ctx,\n          canvasWidth: width,\n          canvasHeight: height,\n          renderArgs: {\n            ...renderProps,\n            features,\n            sources,\n          },\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...rest,\n      features,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...rest,\n      features: new Map(),\n      simplifiedFeatures: mafs.map(\n        ({ feature }) =>\n          new SimpleFeature({\n            id: feature.id(),\n            data: {\n              start: feature.get('start'),\n              end: feature.get('end'),\n              refName: feature.get('refName'),\n            },\n          }),\n      ),\n      height,\n      width,\n    }\n  }\n}\n\nexport type {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsDeserialized,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\n","import { useRef } from 'react'\n\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nimport type { MultiVariantBaseModel } from '../../shared/MultiVariantBaseModel'\n\nconst MultiLinearVariantMatrixRendering = observer(function (props: {\n  width: number\n  height: number\n  displayModel: MultiVariantBaseModel\n  arr: string[][]\n}) {\n  const { arr, width, height, displayModel } = props\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number, eventClientY: number) {\n    if (!ref.current) {\n      return\n    }\n    const r = ref.current.getBoundingClientRect()\n    const offsetX = eventClientX - r.left\n    const offsetY = eventClientY - r.top\n\n    const dimY = arr.length\n    const dimX = arr[0]?.length || 0\n    const name =\n      displayModel.sources![Math.floor((offsetY / height) * dimX)]?.name\n    const genotype =\n      arr[Math.floor((offsetX / width) * dimY)]?.[\n        Math.floor((offsetY / height) * dimX)\n      ]\n    return genotype && name\n      ? {\n          name,\n          genotype,\n        }\n      : undefined\n  }\n  return (\n    <div\n      ref={ref}\n      onMouseMove={e => {\n        displayModel.setHoveredGenotype(\n          getFeatureUnderMouse(e.clientX, e.clientY),\n        )\n      }}\n      onMouseLeave={() => {\n        displayModel.setHoveredGenotype(undefined)\n      }}\n      onMouseOut={() => {\n        displayModel.setHoveredGenotype(undefined)\n      }}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n})\n\nexport default MultiLinearVariantMatrixRendering\n","import FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util'\n\nimport type { MultiRenderArgsDeserialized } from './types'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class MultiVariantBaseRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  async render(renderProps: MultiRenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const { height, referenceDrawingMode, regions, bpPerPx } = renderProps\n    const region = regions[0]!\n    const width = (region.end - region.start) / bpPerPx\n\n    const { makeImageData } = await import('./makeImageData')\n\n    const ret = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      ctx => {\n        if (referenceDrawingMode === 'skip') {\n          ctx.fillStyle = '#ccc'\n          ctx.fillRect(0, 0, width, height)\n        }\n        return makeImageData(ctx, {\n          ...renderProps,\n          features,\n        })\n      },\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...ret,\n      features,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...ret,\n      features: new Map<string, Feature>(),\n      height,\n      width,\n      containsNoTransferables: true,\n    }\n  }\n}\n","import { useMemo, useRef } from 'react'\n\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { getBpDisplayStr } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport RBush from 'rbush'\n\nimport { minElt } from './util'\nimport { makeSimpleAltString } from '../../VcfFeature/util'\n\nimport type { Source } from '../../shared/types'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Region } from '@jbrowse/core/util/types'\n\ninterface RBushData {\n  minX: number\n  maxX: number\n  minY: number\n  maxY: number\n  genotype: string\n  featureId: string\n}\n\ntype SerializedRBush = any\n\ninterface MinimizedVariantRecord {\n  alt: string[]\n  ref: string\n  name: string\n  description: string\n  length: number\n}\n\nconst MultiVariantRendering = observer(function (props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  sources: Source[]\n  scrollTop: number\n  featureGenotypeMap: Record<string, MinimizedVariantRecord>\n  totalHeight: number\n  rbush: SerializedRBush\n  displayModel: any\n  onMouseLeave?: (event: React.MouseEvent) => void\n  onMouseMove?: (event: React.MouseEvent, arg?: Feature) => void\n  onFeatureClick?: (event: React.MouseEvent, arg?: Feature) => void\n}) {\n  const { featureGenotypeMap, totalHeight, scrollTop } = props\n  const { rbush, displayModel } = props\n  const ref = useRef<HTMLDivElement>(null)\n  const rbush2 = useMemo(() => new RBush<RBushData>().fromJSON(rbush), [rbush])\n\n  function getFeatureUnderMouse(eventClientX: number, eventClientY: number) {\n    let offsetX = 0\n    let offsetY = 0\n    if (ref.current) {\n      const r = ref.current.getBoundingClientRect()\n      offsetX = eventClientX - r.left\n      offsetY = eventClientY - r.top - (displayModel?.scrollTop || 0)\n    }\n\n    const x = rbush2.search({\n      minX: offsetX,\n      maxX: offsetX + 1,\n      minY: offsetY,\n      maxY: offsetY + 1,\n    })\n    if (x.length) {\n      const { minX, minY, maxX, maxY, genotype, featureId, ...rest } = minElt(\n        x,\n        elt => elt.maxX - elt.minX,\n      )!\n      const ret = featureGenotypeMap[featureId]\n      if (ret) {\n        const { ref, alt, name, description, length } = ret\n        const alleles = makeSimpleAltString(genotype, ref, alt)\n        return {\n          ...rest,\n          genotype,\n\n          // alleles is a expanded description, e.g. if genotype is 1/0,\n          // alleles is T/C\n          alleles,\n          featureName: name,\n\n          // avoid rendering multiple alt alleles as description, particularly\n          // with Cactus VCF where a large SV has many different ALT alleles.\n          // since descriptions are a join of ALT allele descriptions, just\n          // skip this in this case\n          description: alt.length >= 3 ? 'multiple ALT alleles' : description,\n          length: getBpDisplayStr(length),\n        }\n      }\n    }\n    return undefined\n  }\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={e =>\n        displayModel.setHoveredGenotype?.(\n          getFeatureUnderMouse(e.clientX, e.clientY),\n        )\n      }\n      onMouseLeave={() => {\n        displayModel.setHoveredGenotype?.(undefined)\n      }}\n      onMouseOut={() => {\n        displayModel.setHoveredGenotype?.(undefined)\n      }}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height: totalHeight,\n      }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{\n          position: 'absolute',\n          left: 0,\n          top: scrollTop,\n        }}\n      />\n    </div>\n  )\n})\n\nexport default MultiVariantRendering\n","export function minElt<T>(arr: Iterable<T>, cb: (arg: T) => number) {\n  let min = Infinity\n  let minElement: T | undefined\n  for (const entry of arr) {\n    const val = cb(entry)\n\n    if (val < min) {\n      min = val\n      minElement = entry\n    }\n  }\n  return minElement\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MultiVariantRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiVariantRenderer',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SplitVcfTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst SplitVcfTabixAdapter = ConfigurationSchema(\n  'SplitVcfTabixAdapter',\n  {\n    /**\n     * #slot\n     * object like `{chr1:{uri:'url to file'}}`\n     */\n    vcfGzLocationMap: {\n      type: 'frozen',\n      defaultValue: {},\n    },\n    /**\n     * #slot\n     * object like `{chr1:{uri:'url to index'}}`\n     */\n    indexLocationMap: {\n      type: 'frozen',\n      defaultValue: {},\n    },\n\n    /**\n     * #slot\n     */\n    indexType: {\n      type: 'string',\n      defaultValue: 'TBI',\n    },\n\n    /**\n     * #slot\n     */\n    samplesTsvLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/samples.tsv',\n        description:\n          'tsv with header like \"name\\tpopulation\\tetc\" where the first column is required, and corresponds to the sample names in the VCF files',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n  },\n)\n\nexport default SplitVcfTabixAdapter\n","import { useState } from 'react'\n\nimport { parseBreakend } from '@gmod/vcf'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getStrokeProps, polarToCartesian } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { AnyRegion, Block } from './types'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nfunction bpToRadians(block: Block, pos: number) {\n  const blockStart = block.region.elided ? 0 : block.region.start\n  const blockEnd = block.region.elided ? 0 : block.region.end\n  const bpOffset = block.flipped ? blockEnd - pos : pos - blockStart\n  return bpOffset / block.bpPerRadian + block.startRadians\n}\n\nconst Chord = observer(function Chord({\n  feature,\n  blocksForRefs,\n  radius,\n  config,\n  bezierRadius,\n  selected,\n  onClick,\n}: {\n  feature: Feature\n  blocksForRefs: Record<string, Block>\n  radius: number\n  config: AnyConfigurationModel\n  bezierRadius: number\n  selected: boolean\n  onClick: (feat: Feature, reg: AnyRegion, end: AnyRegion, evt: unknown) => void\n}) {\n  const [hovered, setHovered] = useState(false)\n  // find the blocks that our start and end points belong to\n  const startBlock = blocksForRefs[feature.get('refName')]\n  if (!startBlock) {\n    return null\n  }\n  let svType: string | undefined\n  if (feature.get('INFO')) {\n    ;[svType] = feature.get('INFO').SVTYPE || []\n  } else if (feature.get('mate')) {\n    svType = 'mate'\n  }\n  let endPosition: number\n  let endBlock: Block | undefined\n  const alt = feature.get('ALT')?.[0]\n  const bnd = alt && parseBreakend(alt)\n  const startPos = feature.get('start')\n  if (bnd) {\n    // VCF BND\n    const matePosition = bnd.MatePosition.split(':')\n    endPosition = +matePosition[1]\n    endBlock = blocksForRefs[matePosition[0]]\n  } else if (alt === '<TRA>') {\n    // VCF TRA\n    const chr2 = feature.get('INFO')?.CHR2?.[0]\n    const end = feature.get('INFO')?.END?.[0]\n    endPosition = Number.parseInt(end, 10)\n    endBlock = blocksForRefs[chr2]\n  } else if (svType === 'mate') {\n    // generic simplefeatures arcs\n    const mate = feature.get('mate')\n    const chr2 = mate.refName\n    endPosition = mate.start\n    endBlock = blocksForRefs[chr2]\n  } else {\n    endBlock = startBlock\n    endPosition = feature.get('end')\n  }\n\n  if (endBlock) {\n    const startRadians = bpToRadians(startBlock, startPos)\n    const endRadians = bpToRadians(endBlock, endPosition)\n    const startXY = polarToCartesian(radius, startRadians)\n    const endXY = polarToCartesian(radius, endRadians)\n    const controlXY = polarToCartesian(\n      bezierRadius,\n      (endRadians + startRadians) / 2,\n    )\n\n    const strokeColor = selected\n      ? readConfObject(config, 'strokeColorSelected', { feature })\n      : readConfObject(config, 'strokeColor', { feature })\n\n    const hoverStrokeColor = readConfObject(config, 'strokeColorHover', {\n      feature,\n    })\n    return (\n      <path\n        data-testid={`chord-${feature.id()}`}\n        cursor=\"crosshair\"\n        fill=\"none\"\n        d={['M', ...startXY, 'Q', ...controlXY, ...endXY].join(' ')}\n        {...getStrokeProps(hovered ? hoverStrokeColor : strokeColor)}\n        strokeWidth={hovered ? 3 : 1}\n        onClick={evt => {\n          onClick(feature, startBlock.region, endBlock.region, evt)\n        }}\n        onMouseOver={() => {\n          if (!selected) {\n            setHovered(true)\n          }\n        }}\n        onMouseOut={() => {\n          if (!selected) {\n            setHovered(false)\n          }\n        }}\n      />\n    )\n  }\n\n  return null\n})\n\nexport default Chord\n","import { useMemo } from 'react'\n\nimport { observer } from 'mobx-react'\n\nimport Chord from './Chord'\n\nimport type { AnyRegion, Block } from './types'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nconst StructuralVariantChordsReactComponent = observer(function ({\n  features,\n  config,\n  blockDefinitions,\n  radius,\n  bezierRadius,\n  displayModel,\n  onChordClick,\n}: {\n  features: Map<string, Feature>\n  radius: number\n  config: AnyConfigurationModel\n  displayModel?: {\n    id: string\n    selectedFeatureId: string\n  }\n  blockDefinitions: Block[]\n  bezierRadius: number\n  onChordClick: (\n    feature: Feature,\n    reg: AnyRegion,\n    endBlock: AnyRegion,\n    evt: unknown,\n  ) => void\n}) {\n  const { selectedFeatureId } = displayModel || {}\n  const blocksForRefsMemo = useMemo(() => {\n    const blocksForRefs = {} as Record<string, Block>\n    for (const block of blockDefinitions) {\n      const regions = block.region.elided\n        ? block.region.regions\n        : [block.region]\n      for (const region of regions) {\n        blocksForRefs[region.refName] = block\n      }\n    }\n    return blocksForRefs\n  }, [blockDefinitions])\n\n  return (\n    <g data-testid=\"structuralVariantChordRenderer\">\n      {[...features.values()].map(feature => {\n        const id = feature.id()\n        const selected = String(selectedFeatureId) === String(id)\n        return (\n          <Chord\n            key={id}\n            feature={feature}\n            config={config}\n            radius={radius}\n            bezierRadius={bezierRadius}\n            blocksForRefs={blocksForRefsMemo}\n            selected={selected}\n            onClick={onChordClick}\n          />\n        )\n      })}\n    </g>\n  )\n})\n\nexport default StructuralVariantChordsReactComponent\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config StructuralVariantChordRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'StructuralVariantChordRenderer',\n  {\n    /**\n     * #slot\n     */\n    strokeColor: {\n      type: 'color',\n      description: 'the line color of each arc',\n      defaultValue: 'rgba(255,133,0,0.32)',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    strokeColorSelected: {\n      type: 'color',\n      description: 'the line color of an arc that has been selected',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    strokeColorHover: {\n      type: 'color',\n      description:\n        'the line color of an arc that is being hovered over with the mouse',\n      defaultValue: '#555',\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const configSchema = ConfigurationSchema('VariantFeatureWidget', {})\n","import { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Instance } from 'mobx-state-tree'\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const baseModel = baseModelFactory(pluginManager)\n  return types.compose(\n    baseModel,\n    types.model('VariantFeatureWidget', {\n      /**\n       * #property\n       */\n\n      type: types.literal('VariantFeatureWidget'),\n      /**\n       * #property\n       */\n      descriptions: types.frozen(),\n    }),\n  )\n}\n\nexport type VariantFeatureWidgetStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type VariantFeatureWidgetModel = Instance<VariantFeatureWidgetStateModel>\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { forEachWithStopTokenCheck } from '@jbrowse/core/util'\nimport { firstValueFrom, toArray } from 'rxjs'\n\nimport { getFeaturesThatPassMinorAlleleFrequencyFilter } from '../shared/minorAlleleFrequencyUtils'\n\nimport type { GetGenotypeMatrixArgs } from './types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nexport async function getGenotypeMatrix({\n  pluginManager,\n  args,\n}: {\n  pluginManager: PluginManager\n  args: GetGenotypeMatrixArgs\n}) {\n  const {\n    sources,\n    minorAlleleFrequencyFilter,\n    regions,\n    adapterConfig,\n    sessionId,\n    lengthCutoffFilter,\n    stopToken,\n  } = args\n  const adapter = await getAdapter(pluginManager, sessionId, adapterConfig)\n  const dataAdapter = adapter.dataAdapter as BaseFeatureDataAdapter\n\n  const genotypeFactor = new Set<string>()\n  const mafs = getFeaturesThatPassMinorAlleleFrequencyFilter({\n    minorAlleleFrequencyFilter,\n    lengthCutoffFilter,\n    stopToken,\n    features: await firstValueFrom(\n      dataAdapter.getFeaturesInMultipleRegions(regions, args).pipe(toArray()),\n    ),\n  })\n\n  for (const { alleleCounts } of mafs) {\n    for (const alt of Object.keys(alleleCounts)) {\n      genotypeFactor.add(alt)\n    }\n  }\n\n  const rows = {} as Record<string, number[]>\n  const cacheSplit = {} as Record<string, string[]>\n  forEachWithStopTokenCheck(mafs, stopToken, ({ feature }) => {\n    const genotypes = feature.get('genotypes') as Record<string, string>\n    for (const { name } of sources) {\n      if (!rows[name]) {\n        rows[name] = []\n      }\n      const val = genotypes[name]!\n\n      let alleles: string[]\n      if (cacheSplit[val]) {\n        alleles = cacheSplit[val]\n      } else {\n        alleles = val.split(/[/|]/)\n        cacheSplit[val] = alleles\n      }\n\n      // Calculate '012' status of the allele for a VCF genotype matrix\n      // Similar to vcftools --012 https://vcftools.github.io/man_latest.html\n      // Note: could also consider https://www.rdocumentation.org/packages/fastcluster/versions/1.2.6/topics/hclust.vector for clustering true multi-dimensional allele count vectors\n      let genotypeStatus = 0\n      let nonRefCount = 0\n      let uncalledCount = 0\n      for (const l of alleles) {\n        if (l === '.') {\n          uncalledCount++\n        } else if (l !== '0') {\n          nonRefCount++\n        }\n      }\n\n      if (uncalledCount === alleles.length) {\n        genotypeStatus = -1 // All no-call\n      } else if (nonRefCount === 0) {\n        genotypeStatus = 0 // Homozygous reference\n      } else if (nonRefCount === alleles.length) {\n        genotypeStatus = 2 // Homozygous alternate\n      } else {\n        genotypeStatus = 1 // Heterozygous\n      }\n\n      rows[name].push(genotypeStatus)\n    }\n  })\n  return rows\n}\n","import RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\nimport { clusterData } from '@jbrowse/core/util/cluster'\n\nimport { getGenotypeMatrix } from './getGenotypeMatrix'\n\nimport type { ClusterGenotypeMatrixArgs } from './types'\n\nexport class MultiVariantClusterGenotypeMatrix extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'MultiVariantClusterGenotypeMatrix'\n\n  async execute(args: ClusterGenotypeMatrixArgs, rpcDriverClassName: string) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const matrix = await getGenotypeMatrix({\n      pluginManager: this.pluginManager,\n      args: deserializedArgs,\n    })\n    return clusterData({\n      data: Object.values(matrix),\n      stopToken: deserializedArgs.stopToken,\n      onProgress: progress => {\n        deserializedArgs.statusCallback(progress)\n      },\n    })\n  }\n}\n","import RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\n\nimport { getGenotypeMatrix } from './getGenotypeMatrix'\n\nimport type { GetGenotypeMatrixArgs } from './types'\n\nexport class MultiVariantGetGenotypeMatrix extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'MultiVariantGetGenotypeMatrix'\n\n  async execute(args: GetGenotypeMatrixArgs, rpcDriverClassName: string) {\n    return getGenotypeMatrix({\n      pluginManager: this.pluginManager,\n      args: await this.deserializeArguments(args, rpcDriverClassName),\n    })\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\nimport { forEachWithStopTokenCheck } from '@jbrowse/core/util'\nimport { firstValueFrom, toArray } from 'rxjs'\n\nimport { getFeaturesThatPassMinorAlleleFrequencyFilter } from '../shared/minorAlleleFrequencyUtils'\n\nimport type { GetSimplifiedFeaturesArgs } from './types'\nimport type { SampleInfo } from '../shared/types'\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nexport class MultiVariantGetSimplifiedFeatures extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'MultiVariantGetSimplifiedFeatures'\n\n  async execute(args: GetSimplifiedFeaturesArgs, rpcDriverClassName: string) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const {\n      lengthCutoffFilter,\n      minorAlleleFrequencyFilter,\n      regions,\n      adapterConfig,\n      stopToken,\n      sessionId,\n    } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    const features = getFeaturesThatPassMinorAlleleFrequencyFilter({\n      minorAlleleFrequencyFilter,\n      lengthCutoffFilter,\n      stopToken,\n      features: await firstValueFrom(\n        (dataAdapter as BaseFeatureDataAdapter)\n          .getFeaturesInMultipleRegions(regions, deserializedArgs)\n          .pipe(toArray()),\n      ),\n    })\n\n    const sampleInfo = {} as Record<string, SampleInfo>\n    let hasPhased = false\n\n    forEachWithStopTokenCheck(features, stopToken, ({ feature }) => {\n      const samp = feature.get('genotypes') as Record<string, string>\n      for (const [key, val] of Object.entries(samp)) {\n        const isPhased = val.includes('|')\n        hasPhased ||= isPhased\n        sampleInfo[key] = {\n          maxPloidy: Math.max(\n            sampleInfo[key]?.maxPloidy || 0,\n            val.split('|').length,\n          ),\n          isPhased: sampleInfo[key]?.isPhased || isPhased,\n        }\n      }\n    })\n    return {\n      hasPhased,\n      sampleInfo,\n      features: features.map(({ feature }) => ({\n        id: feature.id(),\n        data: {\n          start: feature.get('start'),\n          end: feature.get('end'),\n          refName: feature.get('refName'),\n          name: feature.get('name'),\n        },\n      })),\n    }\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodTypeWithFiltersAndRenameRegions from '@jbrowse/core/pluggableElementTypes/RpcMethodTypeWithFiltersAndRenameRegions'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Region } from '@jbrowse/core/util'\n\nexport class MultiVariantGetSources extends RpcMethodTypeWithFiltersAndRenameRegions {\n  name = 'MultiVariantGetSources'\n\n  async execute(\n    args: {\n      adapterConfig: AnyConfigurationModel\n      stopToken?: string\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-expect-error\n    return dataAdapter.getSources(regions, deserializedArgs)\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config VcfAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst VcfAdapter = ConfigurationSchema(\n  'VcfAdapter',\n  {\n    /**\n     * #slot\n     */\n    vcfLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.vcf',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    samplesTsvLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/samples.tsv',\n        description:\n          'tsv with header like name\\tpopulation\\tetc. where the first column is required, and is the sample names',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"VcfAdapter\",\n     *   \"uri\": \"yourfile.vcf\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            vcfLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default VcfAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config VcfTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst VcfTabixAdapter = ConfigurationSchema(\n  'VcfTabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    vcfGzLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.vcf.gz',\n        locationType: 'UriLocation',\n      },\n    },\n\n    index: ConfigurationSchema('VcfIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.vcf.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     */\n    samplesTsvLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/samples.tsv',\n        description:\n          'tsv with header like name\\tpopulation\\tetc. where the first column is required, and is the sample names',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes tbi index at\n     * yourfile.vcf.gz.tbi:\n     *\n     * ```json\n     * {\n     *   \"type\": \"VcfTabixAdapter\",\n     *   \"uri\": \"yourfile.vcf.gz\",\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            vcfGzLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            index: {\n              location: {\n                uri: `${snap.uri}.tbi`,\n                baseUri: snap.baseUri,\n              },\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default VcfTabixAdapter\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport ChordVariantDisplayF from './ChordVariantDisplay'\nimport LinearVariantDisplayF from './LinearVariantDisplay'\nimport MultiLinearVariantDisplayF from './MultiLinearVariantDisplay'\nimport LinearVariantMatrixDisplayF from './MultiLinearVariantMatrixDisplay'\nimport LinearVariantMatrixRendererF from './MultiLinearVariantMatrixRenderer'\nimport MultiVariantRendererF from './MultiLinearVariantRenderer'\nimport SplitVcfTabixAdapterF from './SplitVcfTabixAdapter'\nimport StructuralVariantChordRendererF from './StructuralVariantChordRenderer'\nimport VariantFeatureWidgetF from './VariantFeatureWidget'\nimport { MultiVariantClusterGenotypeMatrix } from './VariantRPC/MultiVariantClusterGenotypeMatrix'\nimport { MultiVariantGetGenotypeMatrix } from './VariantRPC/MultiVariantGetGenotypeMatrix'\nimport { MultiVariantGetSimplifiedFeatures } from './VariantRPC/MultiVariantGetSimplifiedFeatures'\nimport { MultiVariantGetSources } from './VariantRPC/MultiVariantGetSources'\nimport VariantTrackF from './VariantTrack'\nimport VcfAdapterF from './VcfAdapter'\nimport VcfTabixAdapterF from './VcfTabixAdapter'\nimport ExtensionPointsF from './extensionPoints'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class VariantsPlugin extends Plugin {\n  name = 'VariantsPlugin'\n\n  install(pluginManager: PluginManager) {\n    VcfAdapterF(pluginManager)\n    VcfTabixAdapterF(pluginManager)\n    SplitVcfTabixAdapterF(pluginManager)\n    VariantFeatureWidgetF(pluginManager)\n    VariantTrackF(pluginManager)\n    ExtensionPointsF(pluginManager)\n    LinearVariantDisplayF(pluginManager)\n    LinearVariantMatrixDisplayF(pluginManager)\n    MultiLinearVariantDisplayF(pluginManager)\n    MultiVariantRendererF(pluginManager)\n    LinearVariantMatrixRendererF(pluginManager)\n    StructuralVariantChordRendererF(pluginManager)\n    ChordVariantDisplayF(pluginManager)\n\n    pluginManager.addRpcMethod(() => new MultiVariantGetSources(pluginManager))\n    pluginManager.addRpcMethod(\n      () => new MultiVariantGetGenotypeMatrix(pluginManager),\n    )\n    pluginManager.addRpcMethod(\n      () => new MultiVariantClusterGenotypeMatrix(pluginManager),\n    )\n    pluginManager.addRpcMethod(\n      () => new MultiVariantGetSimplifiedFeatures(pluginManager),\n    )\n  }\n}\n\nexport { default as VcfFeature } from './VcfFeature'\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function VariantTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'VariantTrack',\n      displayName: 'Variant track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'VariantTrack', configSchema),\n    })\n  })\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function VcfAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'VcfAdapter',\n        displayName: 'VCF adapter',\n        configSchema,\n        getAdapterClass: () => import('./VcfAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport { default as configSchema } from './configSchema'\n\nexport default function VcfTabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'VcfTabixAdapter',\n        displayName: 'VCF tabix adapter',\n        configSchema,\n        getAdapterClass: () => import('./VcfTabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport { default as configSchema } from './configSchema'\n\nexport default function VcfTabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'SplitVcfTabixAdapter',\n        displayName: 'VCF tabix adapter (split across multiple files)',\n        configSchema,\n        getAdapterClass: () =>\n          import('./SplitVcfTabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { lazy } from 'react'\n\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\n\nimport { configSchema } from './configSchema'\nimport { stateModelFactory } from './stateModelFactory'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function VariantFeatureWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'VariantFeatureWidget',\n        heading: 'Feature details',\n        configSchema: configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(() => import('./VariantFeatureWidget')),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config VariantTrack\n * Mostly similar to feature track, but has `ChordDisplayType` registered to it,\n * and custom feature details in `LinearVariantDisplay`\n */\nexport default function VariantTrackF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'VariantTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n","import { testAdapter } from '@jbrowse/core/util'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n} from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function ExtensionPointsF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n        if (\n          testAdapter(fileName, /\\.vcf\\.b?gz$/i, adapterHint, 'VcfTabixAdapter')\n        ) {\n          return {\n            type: 'VcfTabixAdapter',\n            vcfGzLocation: file,\n            index: {\n              location: index || makeIndex(file, '.tbi'),\n              indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n            },\n          }\n        } else if (\n          testAdapter(fileName, /\\.vcf(\\.gz)?$/i, adapterHint, 'VcfAdapter')\n        ) {\n          return {\n            type: 'VcfAdapter',\n            vcfLocation: file,\n          }\n        } else {\n          return adapterGuesser(file, index, adapterHint)\n        }\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        return ['VcfTabixAdapter', 'VcfAdapter'].includes(adapterName)\n          ? 'VariantTrack'\n          : trackTypeGuesser(adapterName)\n      }\n    },\n  )\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport configSchemaF from './configSchema'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearVariantDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearVariantDisplay',\n      displayName: 'Variant display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'VariantTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config LinearVariantDisplay\n *\n * mostly empty, this display type is very much like a `FeatureTrack` with a\n * `LinearBasicDisplay` except it has a custom feature details widget\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearVariantDisplay',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type LinearVariantDisplayConfigModel = ReturnType<typeof configSchemaF>\nexport type LinearVariantDisplayConfig =\n  Instance<LinearVariantDisplayConfigModel>\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport MultiLinearVariantMatrixDisplayComponent from './components/VariantDisplayComponent'\nimport configSchemaF from './configSchema'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearVariantMatrixDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearVariantMatrixDisplay',\n      displayName: 'Multi-sample variant display (matrix)',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'VariantTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: MultiLinearVariantMatrixDisplayComponent,\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiLinearVariantDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'MultiLinearVariantDisplay',\n      displayName: 'Multi-sample variant display (regular)',\n      configSchema,\n      stateModel: modelFactory(configSchema),\n      trackType: 'VariantTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: lazy(\n        () => import('./components/VariantDisplayComponent'),\n      ),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n// locals\nimport sharedVariantConfigFactory from '../shared/SharedVariantConfigSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config MultiLinearVariantDisplay\n * extends\n * - [SharedVariantDisplay](../sharedvariantdisplay)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function VariantConfigFactory(pluginManager: PluginManager) {\n  const MultiVariantRendererConfigSchema = pluginManager.getRendererType(\n    'MultiVariantRenderer',\n  )!.configSchema\n\n  return ConfigurationSchema(\n    'MultiLinearVariantDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['multivariant']),\n        defaultValue: 'multivariant',\n      },\n\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        MultiVariantRenderer: MultiVariantRendererConfigSchema,\n      }),\n\n      /**\n       * #slot\n       */\n      height: {\n        type: 'number',\n        defaultValue: 200,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: sharedVariantConfigFactory(),\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config SharedVariantDisplay\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport default function sharedVariantConfigFactory() {\n  return ConfigurationSchema(\n    'SharedVariantDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n\n      /**\n       * #slot\n       */\n      minimalTicks: {\n        type: 'boolean',\n        defaultValue: false,\n        description: 'use the minimal amount of ticks',\n      },\n\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n\n      /**\n       * #slot\n       */\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import MultiVariantRenderer from './MultiVariantRenderer'\nimport ReactComponent from './components/MultiLinearVariantRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\n\nexport default function MultiVariantRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(() => {\n    return new MultiVariantRenderer({\n      name: 'MultiVariantRenderer',\n      ReactComponent,\n      configSchema,\n      pluginManager,\n    })\n  })\n}\n","import MultiLinearVariantMatrixRenderer from './MultiLinearVariantMatrixRenderer'\nimport ReactComponent from './components/MultiLinearVariantMatrixRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearVariantMatrixRendererF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addRendererType(() => {\n    return new MultiLinearVariantMatrixRenderer({\n      name: 'LinearVariantMatrixRenderer',\n      displayName: 'Linear variant matrix renderer',\n      ReactComponent,\n      configSchema,\n      pluginManager,\n    })\n  })\n}\n","import ChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\n\nimport ReactComponent from './ReactComponent'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function StructuralVariantChordRendererF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addRendererType(\n    () =>\n      new ChordRendererType({\n        name: 'StructuralVariantChordRenderer',\n        displayName: 'SV chord renderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { BaseChordDisplayComponent } from '@jbrowse/plugin-circular-view'\n\nimport configSchemaF from './models/configSchema'\nimport stateModelF from './models/stateModelFactory'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function ChordVariantDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    const stateModel = stateModelF(configSchema)\n    return new DisplayType({\n      name: 'ChordVariantDisplay',\n      displayName: 'Chord variant display',\n      configSchema,\n      stateModel,\n      trackType: 'VariantTrack',\n      viewType: 'CircularView',\n      ReactComponent: BaseChordDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseChordDisplayConfig } from '@jbrowse/plugin-circular-view'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config ChordVariantDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction stateModelFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ChordVariantDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'StructuralVariantChordRenderer' },\n      ),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseChordDisplayConfig,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default stateModelFactory\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { BaseChordDisplayModel } from '@jbrowse/plugin-circular-view'\nimport { types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { CircularViewModel } from '@jbrowse/plugin-circular-view'\n\n/**\n * #stateModel ChordVariantDisplay\n * extends\n * - [BaseChordDisplay](../basechorddisplay)\n */\nconst stateModelFactory = (configSchema: AnyConfigurationSchemaType) => {\n  return types\n    .compose(\n      'ChordVariantDisplay',\n      BaseChordDisplayModel,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('ChordVariantDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n\n      /**\n       * #method\n       */\n      renderProps(): Record<string, unknown> {\n        const view = getContainingView(self) as CircularViewModel\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n          radius: view.radiusPx,\n          blockDefinitions: self.blockDefinitions,\n          config: self.configuration.renderer,\n          onChordClick: (arg: Feature) => {\n            self.onChordClick(arg)\n          },\n        }\n      },\n    }))\n}\n\n// http://localhost:3000/test_data/hs37d5.HG002-SequelII-CCS.sv.vcf.gz.tbi\n\n// render request is for 1.5x the current viewing window\n\n// tracks all have a height\n//\nexport default stateModelFactory\n","import BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { dedupe } from '@jbrowse/core/util'\n\nimport type { SearchScope } from '@jbrowse/core/TextSearch/TextSearchManager'\nimport type { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport type { SearchType } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { TextSearchManager } from '@jbrowse/core/util'\n\nexport async function fetchResults({\n  queryString,\n  searchType,\n  searchScope,\n  rankSearchResults,\n  textSearchManager,\n  assembly,\n}: {\n  queryString: string\n  searchScope: SearchScope\n  rankSearchResults: (results: BaseResult[]) => BaseResult[]\n  searchType?: SearchType\n  textSearchManager?: TextSearchManager\n  assembly?: Assembly\n}) {\n  if (!textSearchManager) {\n    console.warn('No text search manager')\n  }\n\n  const textSearchResults =\n    (await textSearchManager?.search(\n      {\n        queryString,\n        searchType,\n      },\n      searchScope,\n      rankSearchResults,\n    )) || []\n\n  const refNameResults =\n    assembly?.allRefNames\n      ?.filter(ref => ref.toLowerCase().startsWith(queryString.toLowerCase()))\n      .slice(0, 10)\n      .map(\n        r =>\n          new BaseResult({\n            label: r,\n          }),\n      ) || []\n\n  return dedupe([...refNameResults, ...textSearchResults], elt => elt.getId())\n}\n\n// splits on the last instance of a character\nexport function splitLast(str: string, split: string): [string, string] {\n  const lastIndex = str.lastIndexOf(split)\n  if (lastIndex === -1) {\n    return [str, '']\n  } else {\n    const before = str.slice(0, lastIndex)\n    const after = str.slice(lastIndex + 1)\n    return [before, after]\n  }\n}\n\nexport function getRelativeX(\n  event: { clientX: number; target: EventTarget | null },\n  element: HTMLElement | null,\n) {\n  return event.clientX - (element?.getBoundingClientRect().left || 0)\n}\n\nexport function getCytobands(assembly: Assembly | undefined, refName: string) {\n  return (\n    assembly?.cytobands\n      ?.map(f => ({\n        refName:\n          assembly.getCanonicalRefName(f.get('refName')) || f.get('refName'),\n        start: f.get('start'),\n        end: f.get('end'),\n        type: f.get('gieStain') as string,\n        name: f.get('name'),\n      }))\n      .filter(f => f.refName === refName) || []\n  )\n}\n","import { LoadingEllipses } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()(theme => {\n  const bg = theme.palette.action.disabledBackground\n  return {\n    loading: {\n      paddingLeft: '0.6em',\n      backgroundColor: theme.palette.background.default,\n      backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 5px, ${bg} 5px, ${bg} 10px)`,\n      textAlign: 'center',\n    },\n  }\n})\n\nconst BlockLoadingMessage = observer(function ({\n  model,\n}: {\n  model: { status?: string }\n}) {\n  const { classes } = useStyles()\n  const { status: blockStatus } = model\n  const { message: displayStatus } = getParent<{ message?: string }>(model, 2)\n  const status = displayStatus || blockStatus\n  return (\n    <div className={classes.loading}>\n      <LoadingEllipses message={status} />\n    </div>\n  )\n})\n\nexport default BlockLoadingMessage\n","import { Suspense, isValidElement, lazy } from 'react'\n\nimport { observer } from 'mobx-react'\n\nimport BlockLoadingMessage from './BlockLoadingMessage'\nimport BlockMsg from './BlockMsg'\n\n// lazies\nconst BlockErrorMessage = lazy(() => import('./BlockErrorMessage'))\n\nconst ServerSideRenderedBlockContent = observer(function ({\n  model,\n}: {\n  model: {\n    error?: unknown\n    reload: () => void\n    message: React.ReactNode\n    filled?: boolean\n    status?: string\n    reactElement?: React.ReactElement\n  }\n}) {\n  if (model.error) {\n    return (\n      <Suspense fallback={null}>\n        <BlockErrorMessage model={model} />\n      </Suspense>\n    )\n  } else if (model.message) {\n    // the message can be a fully rendered react component, e.g. the region too\n    // large message\n    return isValidElement(model.message) ? (\n      model.message\n    ) : (\n      <BlockMsg message={`${model.message}`} severity=\"info\" />\n    )\n  } else if (!model.filled) {\n    return <BlockLoadingMessage model={model} />\n  } else {\n    return model.reactElement\n  }\n})\n\nexport default ServerSideRenderedBlockContent\n","import type React from 'react'\n\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  assembleLocString,\n  getContainingDisplay,\n  getContainingTrack,\n  getSession,\n  getViewParams,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { stopStopToken } from '@jbrowse/core/util/stopToken'\nimport {\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport { isRetryException } from '@jbrowse/core/util/types'\nimport { cast, getParent, isAlive, types } from 'mobx-state-tree'\n\nimport ServerSideRenderedBlockContent from '../components/ServerSideRenderedBlockContent'\n\nimport type { Feature } from '@jbrowse/core/util'\nimport type { AbstractDisplayModel, Region } from '@jbrowse/core/util/types'\nimport type { Instance } from 'mobx-state-tree'\n\nexport interface RenderedProps {\n  reactElement: React.ReactElement\n  features: Map<string, Feature>\n  layout: any\n  maxHeightReached: boolean\n  renderProps: any\n}\n// the MST state of a single server-side-rendered block in a display\nconst blockState = types\n  .model('BlockState', {\n    /**\n     * #property\n     */\n    key: types.string,\n    /**\n     * #property\n     */\n    region: types.frozen<Region>(),\n    /**\n     * #property\n     */\n    reloadFlag: 0,\n    /**\n     * #property\n     */\n    isLeftEndOfDisplayedRegion: false,\n    /**\n     * #property\n     */\n    isRightEndOfDisplayedRegion: false,\n  })\n  .volatile(() => ({\n    /**\n     * #volatile\n     */\n    stopToken: undefined as string | undefined,\n    /**\n     * #volatile\n     */\n    filled: false,\n    /**\n     * #volatile\n     */\n    reactElement: undefined as React.ReactElement | undefined,\n    /**\n     * #volatile\n     */\n    features: undefined as Map<string, Feature> | undefined,\n    /**\n     * #volatile\n     */\n    layout: undefined as any,\n    /**\n     * #volatile\n     */\n    status: '',\n    /**\n     * #volatile\n     */\n    error: undefined as unknown,\n    /**\n     * #volatile\n     */\n    message: undefined as string | undefined,\n    /**\n     * #volatile\n     */\n    maxHeightReached: false,\n    /**\n     * #volatile\n     */\n    ReactComponent: ServerSideRenderedBlockContent,\n    /**\n     * #volatile\n     */\n    renderProps: undefined as any,\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    doReload() {\n      self.reloadFlag = self.reloadFlag + 1\n    },\n    afterAttach() {\n      const display = getContainingDisplay(self)\n      setTimeout(() => {\n        if (isAlive(self)) {\n          makeAbortableReaction(\n            self as any,\n            renderBlockData,\n            renderBlockEffect,\n            {\n              name: `${display.id}/${assembleLocString(self.region)} rendering`,\n              delay: display.renderDelay,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        }\n      }, display.renderDelay)\n    },\n    /**\n     * #action\n     */\n    setStatus(message: string) {\n      self.status = message\n    },\n    /**\n     * #action\n     */\n    setLoading(newStopToken: string) {\n      if (self.stopToken !== undefined) {\n        stopStopToken(self.stopToken)\n      }\n      self.filled = false\n      self.message = undefined\n      self.reactElement = undefined\n      self.features = undefined\n      self.layout = undefined\n      self.error = undefined\n      self.maxHeightReached = false\n      self.renderProps = undefined\n      self.stopToken = newStopToken\n    },\n    /**\n     * #action\n     */\n    setMessage(messageText: string) {\n      if (self.stopToken !== undefined) {\n        stopStopToken(self.stopToken)\n      }\n      self.filled = false\n      self.message = messageText\n      self.reactElement = undefined\n      self.features = undefined\n      self.layout = undefined\n      self.error = undefined\n      self.maxHeightReached = false\n      self.renderProps = undefined\n      self.stopToken = undefined\n    },\n    /**\n     * #action\n     */\n    setRendered(props: RenderedProps | undefined) {\n      if (!props) {\n        return\n      }\n      const { reactElement, features, layout, maxHeightReached, renderProps } =\n        props\n      self.filled = true\n      self.message = undefined\n      self.reactElement = reactElement\n      self.features = features\n      self.layout = layout\n      self.error = undefined\n      self.maxHeightReached = maxHeightReached\n      self.renderProps = renderProps\n      self.stopToken = undefined\n    },\n    /**\n     * #action\n     */\n    setError(error: unknown) {\n      console.error(error)\n      if (self.stopToken !== undefined) {\n        stopStopToken(self.stopToken)\n      }\n      // the rendering failed for some reason\n      self.filled = false\n      self.message = undefined\n      self.reactElement = undefined\n      self.features = undefined\n      self.layout = undefined\n      self.maxHeightReached = false\n      self.error = error\n      self.renderProps = undefined\n      self.stopToken = undefined\n      if (isRetryException(error as Error)) {\n        this.reload()\n      }\n    },\n    /**\n     * #action\n     */\n    reload() {\n      self.stopToken = undefined\n      self.filled = false\n      self.reactElement = undefined\n      self.features = undefined\n      self.layout = undefined\n      self.error = undefined\n      self.message = undefined\n      self.maxHeightReached = false\n      self.ReactComponent = ServerSideRenderedBlockContent\n      self.renderProps = undefined\n      getParent<any>(self, 2).reload()\n    },\n    beforeDestroy() {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      ;(async () => {\n        try {\n          if (self.stopToken !== undefined) {\n            stopStopToken(self.stopToken)\n          }\n          const display = getContainingDisplay(self)\n          const { rpcManager } = getSession(self)\n          const { rendererType } = display\n          const { renderArgs } = renderBlockData(cast(self))\n          // renderArgs can be undefined if an error occurred in this block\n          if (renderArgs) {\n            await rendererType.freeResourcesInClient(\n              rpcManager,\n              // error if use structuredClone: can't clone Function, presumably a statusCallback\n              JSON.parse(JSON.stringify(renderArgs)),\n            )\n          }\n        } catch (e) {\n          console.error('Error while destroying block', e)\n        }\n      })()\n    },\n  }))\n\nexport default blockState\nexport type BlockStateModel = typeof blockState\nexport type BlockModel = Instance<BlockStateModel>\n\n// calls the render worker to render the block content not using a flow for\n// this, because the flow doesn't work with autorun\nexport function renderBlockData(\n  self: BlockModel,\n  optDisplay?: AbstractDisplayModel,\n) {\n  try {\n    const display = optDisplay || (getContainingDisplay(self) as any)\n    const { assemblyManager, rpcManager } = getSession(display)\n    const { adapterConfig, rendererType, error, parentTrack } = display\n    const assemblyNames = getTrackAssemblyNames(parentTrack)\n    const regionAsm = self.region.assemblyName\n    if (\n      !assemblyNames.includes(regionAsm) &&\n      !assemblyNames.some(name => assemblyManager.get(name)?.hasName(regionAsm))\n    ) {\n      throw new Error(\n        `region assembly (${regionAsm}) does not match track assemblies (${assemblyNames})`,\n      )\n    }\n\n    const renderProps = display.renderProps()\n    const { config } = renderProps\n\n    // This line is to trigger the mobx reaction when the config changes It\n    // won't trigger the reaction if it doesn't think we're accessing it\n    readConfObject(config)\n\n    const sessionId = getRpcSessionId(display)\n    const layoutId = getContainingTrack(display).id\n    const cannotBeRenderedReason = display.regionCannotBeRendered(self.region)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps,\n      cannotBeRenderedReason,\n      displayError: error,\n      renderArgs: {\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            self.setStatus(message)\n          }\n        },\n        assemblyName: self.region.assemblyName,\n        regions: [self.region],\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId,\n        layoutId,\n        blockKey: self.key,\n        reloadFlag: self.reloadFlag,\n        timeout: 1_000_000,\n      },\n    }\n  } catch (e) {\n    return { displayError: e }\n  }\n}\n\nasync function renderBlockEffect(\n  props: ReturnType<typeof renderBlockData> | undefined,\n  stopToken: string | undefined,\n  self: BlockModel,\n) {\n  if (!props) {\n    return\n  }\n  const {\n    rendererType,\n    renderProps,\n    rpcManager,\n    renderArgs,\n    cannotBeRenderedReason,\n    displayError,\n  } = props\n  if (!isAlive(self)) {\n    return undefined\n  } else if (displayError) {\n    self.setError(displayError)\n    return undefined\n  } else if (cannotBeRenderedReason) {\n    self.setMessage(cannotBeRenderedReason)\n    return undefined\n  } else if (renderProps.notReady) {\n    return undefined\n  } else {\n    const { reactElement, features, layout, maxHeightReached } =\n      await rendererType.renderInClient(rpcManager, {\n        ...renderArgs,\n        ...renderProps,\n        viewParams: getViewParams(self),\n        stopToken,\n      })\n    return {\n      reactElement,\n      features,\n      layout,\n      maxHeightReached,\n      renderProps,\n    }\n  }\n}\n","import jexl from 'jexl'\n\nimport type { Feature } from './simpleFeature'\n\ntype JexlWithAddFunction = typeof jexl & {\n  addFunction(name: string, func: (...args: unknown[]) => unknown): void\n}\ntype JexlNonBuildable = Omit<typeof jexl, 'Jexl'>\n\nexport default function JexlF(/* config?: any*/): JexlNonBuildable {\n  const j = new jexl.Jexl() as JexlWithAddFunction\n  // someday will make sure all of configs callbacks are added in, including\n  // ones passed in\n\n  // below are core functions\n  j.addFunction('get', (feature: Feature, data: string) => feature.get(data))\n  j.addFunction('parent', (feature: Feature) => feature.parent())\n\n  j.addFunction('id', (feature: Feature) => feature.id())\n\n  // let user cast a jexl type into a javascript type\n  j.addFunction('cast', (arg: unknown) => arg)\n\n  // logging\n  j.addFunction('log', (thing: unknown) => {\n    console.log(thing) // eslint-disable-line no-console\n    return thing\n  })\n\n  // math\n  // addfunction added in jexl 2.3 but types/jexl still on 2.2\n  j.addFunction('max', Math.max)\n  j.addFunction('min', Math.min)\n  j.addFunction('sqrt', Math.sqrt)\n  j.addFunction('ceil', Math.ceil)\n  j.addFunction('floor', Math.floor)\n  j.addFunction('round', Math.round)\n  j.addFunction('abs', Math.abs)\n  j.addFunction('log10', Math.log10)\n  j.addFunction('parseInt', Number.parseInt)\n  j.addFunction('parseFloat', Number.parseFloat)\n\n  // string\n  j.addFunction('split', (s: string, char: string) => s.split(char))\n  j.addFunction('charAt', (s: string, index: number) => s.charAt(index))\n  j.addFunction('charCodeAt', (s: string, index: number) => s.charCodeAt(index))\n  j.addFunction('codePointAt', (s: string, pos: number) => s.codePointAt(pos))\n  j.addFunction('startsWith', (s: string, search: string, len?: number) =>\n    s.startsWith(search, len),\n  )\n  j.addFunction('endsWith', (s: string, search: string, len?: number) =>\n    s.endsWith(search, len),\n  )\n  j.addFunction('padEnd', (s: string, len: number, pad?: string) =>\n    s.padEnd(len, pad),\n  )\n  j.addFunction('padStart', (s: string, len: number, fill?: string) =>\n    s.padStart(len, fill),\n  )\n  j.addFunction('repeat', (s: string, count: number) => s.repeat(count))\n  j.addFunction('replace', (s: string, match: string, sub: string) =>\n    s.replace(match, sub),\n  )\n  j.addFunction('replaceAll', (s: string, match: string, sub: string) =>\n    s.replaceAll(match, sub),\n  )\n  j.addFunction('slice', (s: string, start: number, end?: number) =>\n    s.slice(start, end),\n  )\n  j.addFunction('startsWith', (s: string, search: string, pos?: number) =>\n    s.startsWith(search, pos),\n  )\n  j.addFunction('substring', (s: string, start: number, end?: number) =>\n    // eslint-disable-next-line unicorn/prefer-string-slice\n    s.substring(start, end),\n  )\n  j.addFunction('toLowerCase', (s: string) => s.toLowerCase())\n  j.addFunction('toUpperCase', (s: string) => s.toUpperCase())\n  j.addFunction('jsonParse', (s: string) => JSON.parse(s))\n  j.addFunction('trim', (s: string) => s.trim())\n  j.addFunction('trimEnd', (s: string) => s.trimEnd())\n  j.addFunction('trimStart', (s: string) => s.trimStart())\n\n  j.addFunction('getTag', (feature: Feature, s: string) => {\n    const tags = feature.get('tags')\n    return tags ? tags[s] : feature.get(s)\n  })\n\n  j.addBinaryOp('&', 15, (a: number, b: number) => a & b)\n\n  return j\n}\n","// copied from\n// https://raw.githubusercontent.com/greenelab/hclust/refs/heads/master/src/hclust.js\n// license: MIT\n\nimport { checkStopToken } from '@jbrowse/core/util/stopToken'\n\nfunction toP(n: number) {\n  return Number.parseFloat((n * 100).toFixed(1))\n}\n\n// get euclidean distance between two equal-dimension vectors\nexport function euclideanDistance(a: number[], b: number[]) {\n  const size = Math.min(a.length, b.length)\n  let sum = 0\n  for (let index = 0; index < size; index++) {\n    sum += (a[index]! - b[index]!) * (a[index]! - b[index]!)\n  }\n  return Math.sqrt(sum)\n}\n\n// get average distance between sets of indexes, given distance matrix\nexport function averageDistance(\n  setA: number[],\n  setB: number[],\n  distances: number[][],\n) {\n  let distance = 0\n  const lenA = setA.length\n  const lenB = setB.length\n  for (let i = 0; i < lenA; i++) {\n    for (let j = 0; j < lenB; j++) {\n      distance += distances[setA[i]!]![setB[j]!]!\n    }\n  }\n\n  return distance / setA.length / setB.length\n}\n\n// the main clustering function\nexport function clusterData({\n  data,\n  distance = euclideanDistance,\n  linkage = averageDistance,\n  onProgress,\n  stopToken,\n}: {\n  data: number[][]\n  distance?: (a: number[], b: number[]) => number\n  linkage?: (a: number[], b: number[], distances: number[][]) => number\n  onProgress?: (a: string) => void\n  stopToken?: string\n}) {\n  // compute distance between each data point and every other data point\n  // N x N matrix where N = data.length\n  let start = performance.now()\n  const distances: number[][] = []\n\n  for (let i = 0; i < data.length; i++) {\n    if (performance.now() - start > 400) {\n      checkStopToken(stopToken)\n      start = performance.now()\n    }\n    if (onProgress) {\n      onProgress(`Making distance matrix: ${toP(i / (data.length - 1))}%`)\n    }\n\n    // create a row for this data point\n    const row: number[] = []\n\n    // calculate distance between this datum and every other datum\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let j = 0; j < data.length; j++) {\n      row.push(distance(data[i]!, data[j]!))\n    }\n\n    distances.push(row)\n  }\n\n  // initialize clusters to match data\n  const clusters = data.map((_datum, index) => ({\n    height: 0,\n    indexes: [Number(index)],\n  }))\n\n  // keep track of all tree slices\n  let clustersGivenK = []\n\n  start = performance.now()\n  for (let iteration = 0; iteration < data.length; iteration++) {\n    if (performance.now() - start > 400) {\n      checkStopToken(stopToken)\n      start = performance.now()\n    }\n    if (onProgress) {\n      onProgress(`Clustering: ${toP((iteration + 1) / data.length)}%`)\n    }\n\n    // add current tree slice\n    clustersGivenK.push(clusters.map(cluster => cluster.indexes))\n\n    // dont find clusters to merge when only one cluster left\n    if (iteration >= data.length - 1) {\n      break\n    }\n\n    // initialize smallest distance\n    let nearestDistance = Infinity\n    let nearestRow = 0\n    let nearestCol = 0\n\n    // upper triangular matrix of clusters\n    for (let row = 0; row < clusters.length; row++) {\n      for (let col = row + 1; col < clusters.length; col++) {\n        // calculate distance between clusters\n        const distance = linkage(\n          clusters[row]!.indexes,\n          clusters[col]!.indexes,\n          distances,\n        )\n        // update smallest distance\n        if (distance < nearestDistance) {\n          nearestDistance = distance\n          nearestRow = row\n          nearestCol = col\n        }\n      }\n    }\n\n    // merge nearestRow and nearestCol clusters together\n    const newCluster = {\n      indexes: [\n        ...clusters[nearestRow]!.indexes,\n        ...clusters[nearestCol]!.indexes,\n      ],\n      height: nearestDistance,\n      children: [clusters[nearestRow], clusters[nearestCol]],\n    }\n\n    // remove nearestRow and nearestCol clusters\n    // splice higher index first so it doesn't affect second splice\n    clusters.splice(Math.max(nearestRow, nearestCol), 1)\n    clusters.splice(Math.min(nearestRow, nearestCol), 1)\n\n    // add new merged cluster\n    clusters.push(newCluster)\n  }\n\n  // assemble full list of tree slices into array where index = k\n  clustersGivenK = [[], ...clustersGivenK.reverse()]\n\n  // return useful information\n  return {\n    clusters: clusters[0],\n    distances: distances,\n    order: clusters[0]!.indexes,\n    clustersGivenK: clustersGivenK,\n  }\n}\n","import { reaction } from 'mobx'\nimport { addDisposer, isAlive } from 'mobx-state-tree'\n\nimport { isAbortException } from './aborting'\nimport { createStopToken, stopStopToken } from './stopToken'\n\nimport type { IReactionOptions, IReactionPublic } from 'mobx'\n\n/**\n * makes a mobx reaction with the given functions, that calls actions on the\n * model for each stage of execution, and to abort the reaction function when\n * the model is destroyed.\n *\n * Will call startedFunction(stopToken), successFunction(result), and\n * errorFunction(error) when the async reaction function starts, completes, and\n * errors respectively.\n *\n * @param self -\n * @param dataFunction -\n * @param asyncReactionFunction -\n * @param reactionOptions -\n * @param startedFunction -\n * @param successFunction -\n * @param errorFunction -\n */\nexport function makeAbortableReaction<T, U, V>(\n  self: T,\n  dataFunction: (arg: T) => U,\n  asyncReactionFunction: (\n    arg: U | undefined,\n    stopToken: string,\n    model: T,\n    handle: IReactionPublic,\n  ) => Promise<V>,\n  // @ts-expect-error\n  reactionOptions: IReactionOptions,\n  startedFunction: (stopToken: string) => void,\n  successFunction: (arg: V) => void,\n  errorFunction: (err: unknown) => void,\n) {\n  let inProgress: string | undefined\n\n  function handleError(error: unknown) {\n    if (!isAbortException(error)) {\n      console.error(error)\n      if (isAlive(self)) {\n        errorFunction(error)\n      }\n    }\n  }\n\n  addDisposer(\n    self,\n    reaction(\n      () => {\n        try {\n          return dataFunction(self)\n        } catch (e) {\n          handleError(e)\n          return undefined\n        }\n      },\n      async (data, mobxReactionHandle) => {\n        if (inProgress) {\n          stopStopToken(inProgress)\n        }\n\n        if (!isAlive(self)) {\n          return\n        }\n        inProgress = createStopToken()\n\n        startedFunction(inProgress)\n        try {\n          const result = await asyncReactionFunction(\n            data,\n            inProgress,\n            self,\n            // @ts-expect-error\n            mobxReactionHandle,\n          )\n          if (isAlive(self)) {\n            successFunction(result)\n          }\n        } catch (e) {\n          handleError(e)\n        }\n      },\n      reactionOptions,\n    ),\n  )\n  addDisposer(self, () => {\n    if (inProgress) {\n      stopStopToken(inProgress)\n    }\n  })\n}\n","import PluggableElementBase from './PluggableElementBase'\n\nimport type { AnyConfigurationSchemaType } from '../configuration'\nimport type { AnyReactComponentType } from '../util'\nimport type { IAnyModelType } from 'mobx-state-tree'\n\nexport default class DisplayType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  ReactComponent: AnyReactComponentType\n\n  /**\n   * The track type the display is associated with\n   */\n  trackType: string\n\n  /*\n   * Indicates that this display type can be a \"sub-display\" of another type of\n   * display, e.g. in AlignmentsDisplay, has Pileup and SNPCoverage subDisplays\n   */\n  subDisplay?: {\n    type: string\n    [key: string]: unknown\n  }\n\n  /**\n   * The view type the display is associated with\n   */\n  viewType: string\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    trackType: string\n    viewType: string\n    displayName?: string\n    subDisplay?: { type: string; [key: string]: unknown }\n    configSchema: AnyConfigurationSchemaType\n    ReactComponent: AnyReactComponentType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.subDisplay = stuff.subDisplay\n    this.configSchema = stuff.configSchema\n    this.ReactComponent = stuff.ReactComponent\n    this.trackType = stuff.trackType\n    this.viewType = stuff.viewType\n  }\n}\n","import { firstValueFrom } from 'rxjs'\nimport { filter, toArray } from 'rxjs/operators'\n\nimport ServerSideRenderer from './ServerSideRendererType'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport { dedupe, getSerializedSvg } from '../../util'\n\nimport type {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n} from './ServerSideRendererType'\nimport type { AnyConfigurationModel } from '../../configuration'\nimport type { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\nimport type RpcManager from '../../rpc/RpcManager'\nimport type { Feature } from '../../util/simpleFeature'\nimport type { Region } from '../../util/types'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  blockKey: string\n}\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  blockKey: string\n}\n\nexport interface ResultsSerializedSvgExport extends ResultsSerialized {\n  canvasRecordedData: unknown\n  width: number\n  height: number\n  reactElement: unknown\n}\n\nfunction isSvgExport(e: ResultsSerialized): e is ResultsSerializedSvgExport {\n  return 'canvasRecordedData' in e\n}\n\nexport default class ComparativeServerSideRenderer extends ServerSideRenderer {\n  /**\n   * directly modifies the render arguments to prepare them to be serialized\n   * and sent to the worker.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n\n  async renameRegionsIfNeeded(args: RenderArgs) {\n    return args\n  }\n\n  serializeArgsInClient(args: RenderArgs) {\n    const deserializedArgs = {\n      ...args,\n      displayModel: undefined,\n    }\n\n    return super.serializeArgsInClient(deserializedArgs)\n  }\n\n  // deserialize some of the results that came back from the worker\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserialized = super.deserializeResultsInClient(result, args)\n    return {\n      ...deserialized,\n      blockKey: args.blockKey,\n    }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then\n   * calls `render` with the RPC manager.\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const results = (await rpcManager.call(\n      args.sessionId,\n      'ComparativeRender',\n      args,\n    )) as ResultsSerialized\n\n    if (isSvgExport(results)) {\n      results.html = await getSerializedSvg(results)\n      results.reactElement = undefined\n    }\n    return results\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    return renderArgs.filters\n      ? renderArgs.filters.passes(feature, renderArgs)\n      : true\n  }\n\n  async getFeatures(renderArgs: {\n    regions: Region[]\n    sessionId: string\n    adapterConfig: AnyConfigurationModel\n  }) {\n    const pm = this.pluginManager\n    const { regions, sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    const requestRegions = regions.map(r => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.floor(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    // note that getFeaturesInMultipleRegions does not do glyph expansion\n    const res = await firstValueFrom(\n      (dataAdapter as BaseFeatureDataAdapter)\n        .getFeaturesInMultipleRegions(requestRegions, renderArgs)\n        .pipe(\n          // @ts-expect-error\n          filter(f => this.featurePassesFilters(renderArgs, f)),\n          toArray(),\n        ),\n    )\n\n    // dedupe needed xref https://github.com/GMOD/jbrowse-components/pull/3404/\n    return dedupe(res, f => f.id())\n  }\n}\n\nexport { type RenderResults } from './ServerSideRendererType'\n","import { forwardRef } from 'react'\n\nimport { observer } from 'mobx-react'\n\nimport Tooltip from '../../Tooltip'\nimport { toP } from '../../util'\n\nimport type { TooltipContentsComponent } from '../../Tooltip'\nimport type { Feature } from '@jbrowse/core/util'\n\nconst en = (n: number) => n.toLocaleString('en-US')\n\ninterface Props {\n  feature: Feature\n}\n\nconst TooltipContents = forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ feature }, ref) {\n    const start = feature.get('start') + 1\n    const end = feature.get('end')\n    const refName = feature.get('refName')\n    const name = feature.get('name')\n    const loc = [\n      refName,\n      name,\n      start === end ? en(start) : `${en(start)}..${en(end)}`,\n    ]\n      .filter(f => !!f)\n      .join(':')\n\n    return feature.get('summary') !== undefined ? (\n      <div ref={ref}>\n        {loc}\n        <br />\n        Max: {toP(feature.get('maxScore'))}\n        <br />\n        Avg: {toP(feature.get('score'))}\n        <br />\n        Min: {toP(feature.get('minScore'))}\n      </div>\n    ) : (\n      <div ref={ref}>\n        {loc}\n        <br />\n        {`${toP(feature.get('score'))}`}\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst WiggleTooltip = observer(function (props: {\n  model: {\n    featureUnderMouse?: Feature\n  }\n  height: number\n  offsetMouseCoord: Coord\n  clientMouseCoord: Coord\n  clientRect?: DOMRect\n  TooltipContents?: TooltipContentsComponent\n}) {\n  return <Tooltip TooltipContents={TooltipContents} {...props} />\n})\nexport default WiggleTooltip\n\nexport { default as Tooltip } from '../../Tooltip'\n","import type { ErrorInfo } from 'react'\nimport { Component } from 'react'\n\ninterface Props {\n  children: React.ReactNode\n  FallbackComponent: React.FC<{ error: unknown }>\n}\n\ninterface State {\n  error: unknown\n}\n\nclass ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props)\n    this.state = { error: undefined }\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error('ErrorBoundary caught an error:', error, errorInfo)\n    this.setState({ error })\n  }\n\n  render() {\n    return this.state.error ? (\n      <this.props.FallbackComponent error={this.state.error} />\n    ) : (\n      this.props.children\n    )\n  }\n}\n\nexport { ErrorBoundary }\n","import PluggableElementBase from './PluggableElementBase'\n\nimport type { AnyConfigurationSchemaType } from '../configuration'\nimport type DisplayType from './DisplayType'\nimport type { IAnyModelType } from 'mobx-state-tree'\n\nexport default class TrackType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    displayName?: string\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import { observer } from 'mobx-react'\nimport { getType, isStateTreeNode } from 'mobx-state-tree'\n\nconst HeadingComponent = observer(function ({\n  model,\n}: {\n  model?: {\n    target: {\n      type: string\n    }\n  }\n}) {\n  if (model?.target) {\n    if (model.target.type) {\n      return `${model.target.type} settings`\n    }\n    if (isStateTreeNode(model.target)) {\n      const type = getType(model.target)\n      if (type.name) {\n        return `${type.name.replace('ConfigurationSchema', '')} settings`\n      }\n    }\n  }\n  return <>Settings</>\n})\n\nexport default HeadingComponent\n","import { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('ConfigurationEditorWidget', {\n      id: ElementId,\n      type: types.literal('ConfigurationEditorWidget'),\n      // If you add different types of targets, don't forget to account for that\n      // in the key of ./components/ConfigurationEditor.js\n      target: types.safeReference(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    .actions(self => ({\n      setTarget(newTarget: any) {\n        self.target = newTarget\n      },\n    }))\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nimport HeadingComponent from './components/HeadingComponent'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('ConfigurationEditorWidget', {})\n\nconst LazyConfigurationEditorComponent = lazy(\n  () => import('./components/ConfigurationEditor'),\n)\n\nexport default function registerConfigurationEditorWidget(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'ConfigurationEditorWidget',\n      HeadingComponent,\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: LazyConfigurationEditorComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config FromConfigAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'FromConfigAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FromConfigRegionsAdapter\n * used for specifying refNames+sizes of an assembly\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst regionsConfigSchema = ConfigurationSchema(\n  'FromConfigRegionsAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n    implicitIdentifier: 'adapterId',\n  },\n)\nexport default regionsConfigSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FromConfigSequenceAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst sequenceConfigSchema = ConfigurationSchema(\n  'FromConfigSequenceAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n    implicitIdentifier: 'adapterId',\n  },\n)\n\nexport default sequenceConfigSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config NcbiSequenceReportAliasAdapter\n * can read \"sequence_report.tsv\" type files from NCBI\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst NcbiSequenceReportAliasAdapterConfigSchema = ConfigurationSchema(\n  'NcbiSequenceReportAliasAdapter',\n  {\n    /**\n     * #slot\n     */\n    location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/sequence_report.tsv',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    useNameOverride: {\n      type: 'boolean',\n      defaultValue: true,\n      description:\n        'forces usage of the UCSC names over the NCBI style names from a FASTA',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"NcbiSequenceReportAliasAdapter\",\n     *   \"uri\": \"sequence_report.tsv\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      return snap.uri\n        ? {\n            ...snap,\n            location: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default NcbiSequenceReportAliasAdapterConfigSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config RefNameAliasAdapter\n * can read \"chromAliases\" type files from UCSC or any tab separated file of\n * refName aliases\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst RefNameAliasAdapter = ConfigurationSchema(\n  'RefNameAliasAdapter',\n  {\n    /**\n     * #slot\n     */\n    location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/aliases.txt',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     * by default, the \"ref names that match the fasta\" are assumed to be in the\n     * first column (0), change this variable if needed\n     */\n    refNameColumn: {\n      type: 'number',\n      defaultValue: 0,\n    },\n\n    /**\n     * #slot\n     * refNameColumnHeaderName\n     */\n    refNameColumnHeaderName: {\n      type: 'string',\n      description:\n        'alternative to refNameColumn, instead looks at header (starts with # and finds column name)',\n      defaultValue: '',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"RefNameAliasAdapter\",\n     *   \"uri\": \"yourfile.chromAlias.txt\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            location: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default RefNameAliasAdapter\n","import { lazy } from 'react'\n\nimport Plugin from '@jbrowse/core/Plugin'\n\nimport ConfigurationEditorWidgetF from './ConfigurationEditorWidget'\nimport FromConfigAdapterF from './FromConfigAdapter'\nimport FromConfigRegionsAdapterF from './FromConfigRegionsAdapter'\nimport FromConfigSequenceAdapterF from './FromConfigSequenceAdapter'\nimport NcbiSequenceReportAliasAdapterF from './NcbiSequenceReportAliasAdapter'\nimport RefNameAliasAdapterF from './RefNameAliasAdapter'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst LazyConfigurationEditorComponent = lazy(\n  () => import('./ConfigurationEditorWidget/components/ConfigurationEditor'),\n)\n\nexport default class ConfigurationPlugin extends Plugin {\n  name = 'ConfigurationPlugin'\n\n  install(pluginManager: PluginManager) {\n    FromConfigAdapterF(pluginManager)\n    FromConfigRegionsAdapterF(pluginManager)\n    FromConfigSequenceAdapterF(pluginManager)\n    RefNameAliasAdapterF(pluginManager)\n    ConfigurationEditorWidgetF(pluginManager)\n    NcbiSequenceReportAliasAdapterF(pluginManager)\n  }\n}\n\nexport { LazyConfigurationEditorComponent as ConfigurationEditor }\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function FromConfigAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'FromConfigAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./FromConfigAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function FromConfigRegionsAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'FromConfigRegionsAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./FromConfigRegionsAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function FromConfigSequenceAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'FromConfigSequenceAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./FromConfigSequenceAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function RefNameAliasAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'RefNameAliasAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./RefNameAliasAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function NcbiSequenceReportAliasAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'NcbiSequenceReportAliasAdapter',\n      configSchema,\n      getAdapterClass: () =>\n        import('./NcbiSequenceReportAliasAdapter').then(r => r.default),\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n    })\n  })\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  UNSUPPORTED,\n  getFileName,\n  guessAdapter,\n  guessTrackType,\n} from '@jbrowse/core/util/tracks'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport deepmerge from 'deepmerge'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { FileLocation } from '@jbrowse/core/util/types'\nimport type { Instance } from 'mobx-state-tree'\n\nfunction isAbsoluteUrl(url = '') {\n  try {\n    new URL(url)\n    return true\n  } catch (error) {\n    return url.startsWith('/')\n  }\n}\n\ninterface IndexingAttr {\n  attributes: string[]\n  exclude: string[]\n}\n\n/**\n * #stateModel AddTrackModel\n */\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('AddTrackModel', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('AddTrackWidget'),\n      /**\n       * #property\n       */\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({\n      trackSource: 'fromFile',\n      trackData: undefined as FileLocation | undefined,\n      indexTrackData: undefined as FileLocation | undefined,\n\n      // alts\n      altAssemblyName: '',\n      altTrackName: '',\n      altTrackType: '',\n\n      adapterHint: '',\n      textIndexTrack: true,\n      textIndexingConf: undefined as IndexingAttr | undefined,\n      mixinData: {},\n    }))\n    .actions(self => ({\n      setMixinData(arg: Record<string, unknown>) {\n        self.mixinData = arg\n      },\n      /**\n       * #action\n       */\n      setAdapterHint(obj: string) {\n        self.adapterHint = obj\n      },\n      /**\n       * #action\n       */\n      setTrackSource(str: string) {\n        self.trackSource = str\n      },\n      /**\n       * #action\n       */\n      setTextIndexingConf(conf: IndexingAttr) {\n        self.textIndexingConf = conf\n      },\n      /**\n       * #action\n       */\n      setTextIndexTrack(flag: boolean) {\n        self.textIndexTrack = flag\n      },\n      /**\n       * #action\n       */\n      setTrackData(obj: FileLocation) {\n        self.trackData = obj\n      },\n      /**\n       * #action\n       */\n      setIndexTrackData(obj: FileLocation) {\n        self.indexTrackData = obj\n      },\n      /**\n       * #action\n       */\n      setAssembly(str: string) {\n        self.altAssemblyName = str\n      },\n      /**\n       * #action\n       */\n      setTrackName(str: string) {\n        self.altTrackName = str\n      },\n      /**\n       * #action\n       */\n      setTrackType(str: string) {\n        self.altTrackType = str\n      },\n      /**\n       * #action\n       */\n      clearData() {\n        self.trackSource = ''\n        self.altTrackName = ''\n        self.altTrackType = ''\n        self.altAssemblyName = ''\n        self.adapterHint = ''\n        self.indexTrackData = undefined\n        self.trackData = undefined\n        self.textIndexingConf = undefined\n        self.textIndexTrack = true\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get trackAdapter() {\n        const { trackData, indexTrackData, adapterHint } = self\n\n        return trackData\n          ? guessAdapter(trackData, indexTrackData, adapterHint, self)\n          : undefined\n      },\n\n      /**\n       * #getter\n       */\n      get trackName() {\n        return (\n          self.altTrackName ||\n          (self.trackData ? getFileName(self.trackData) : '')\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get isFtp() {\n        const { trackData: track, indexTrackData: index } = self\n        return !!(\n          // @ts-expect-error\n          (index?.uri?.startsWith('ftp://') || track?.uri?.startsWith('ftp://'))\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get isRelativeTrackUrl() {\n        // @ts-expect-error\n        const uri = self.trackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      /**\n       * #getter\n       */\n      get isRelativeIndexUrl() {\n        // @ts-expect-error\n        const uri = self.indexTrackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      /**\n       * #getter\n       */\n      get isRelativeUrl() {\n        return this.isRelativeIndexUrl || this.isRelativeTrackUrl\n      },\n\n      /**\n       * #getter\n       */\n      get trackHttp() {\n        // @ts-expect-error\n        return self.trackData?.uri?.startsWith('http://')\n      },\n      /**\n       * #getter\n       */\n      get indexHttp() {\n        // @ts-expect-error\n        return self.indexTrackData?.uri?.startsWith('http://')\n      },\n\n      /**\n       * #getter\n       */\n      get wrongProtocol() {\n        return (\n          window.location.protocol === 'https:' &&\n          (this.trackHttp || this.indexHttp)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get unsupported() {\n        return this.trackAdapter?.type === UNSUPPORTED\n      },\n\n      /**\n       * #getter\n       */\n      get assembly() {\n        return self.altAssemblyName || self.view.assemblyNames?.[0]\n      },\n\n      /**\n       * #getter\n       */\n      get trackAdapterType() {\n        return this.trackAdapter?.type\n      },\n      /**\n       * #getter\n       */\n      get trackType() {\n        return (\n          self.altTrackType ||\n          (this.trackAdapterType\n            ? guessTrackType(this.trackAdapterType, self)\n            : '')\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      getTrackConfig(timestamp: number) {\n        const session = getSession(self)\n        const assemblyInstance = session.assemblyManager.get(self.assembly)\n\n        return assemblyInstance &&\n          self.trackAdapter &&\n          self.trackAdapter.type !== 'UNKNOWN'\n          ? deepmerge(\n              {\n                trackId: [\n                  `${self.trackName.toLowerCase().replaceAll(' ', '_')}-${timestamp}`,\n                  session.adminMode ? '' : '-sessionTrack',\n                ].join(''),\n                type: self.trackType,\n                name: self.trackName,\n                assemblyNames: [self.assembly],\n                adapter: {\n                  ...self.trackAdapter,\n                  sequenceAdapter: getConf(assemblyInstance, [\n                    'sequence',\n                    'adapter',\n                  ]),\n                },\n              },\n              self.mixinData,\n            )\n          : undefined\n      },\n      /**\n       * #getter\n       */\n      get warningMessage() {\n        if (self.isFtp) {\n          return 'Warning: JBrowse cannot access files using the ftp protocol'\n        } else if (self.isRelativeUrl) {\n          return `Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.`\n        } else if (self.wrongProtocol) {\n          return `Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol`\n        } else {\n          return ''\n        }\n      },\n    }))\n}\n\nexport type AddTrackStateModel = ReturnType<typeof f>\nexport type AddTrackModel = Instance<AddTrackStateModel>\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('AddTrackWidget', {})\n\nexport default function AddTrackWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'AddTrackWidget',\n      heading: 'Add a track',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/AddTrackWidget')),\n    })\n  })\n}\n","import type React from 'react'\n\nimport PluggableElementBase from './PluggableElementBase'\n\nimport type DisplayType from './DisplayType'\nimport type { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\n\ntype BasicView = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n\n  model: any\n  session?: IAnyStateTreeNode\n}>\n\ntype ViewComponentType = React.LazyExoticComponent<BasicView> | BasicView\n\ninterface ViewMetadata {\n  hiddenFromGUI?: boolean\n}\n\nexport default class ViewType extends PluggableElementBase {\n  ReactComponent: ViewComponentType\n\n  stateModel: IAnyModelType\n\n  displayTypes: DisplayType[] = []\n\n  viewMetadata: ViewMetadata = {}\n\n  // extendedName can be used for when you extend a given view type, and want\n  // to register all of that view types displays to yourself\n  //\n  // e.g. you create a linear-genome-view subtype, and want all the tracks that\n  // are compatible display types for the linear-genome-view to be compatible\n  // with your type also (without this, display types are only registered to a\n  // single view type)\n  extendedName?: string\n\n  constructor(stuff: {\n    name: string\n    displayName?: string\n    stateModel: IAnyModelType\n    extendedName?: string\n    viewMetadata?: ViewMetadata\n    ReactComponent: ViewComponentType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.viewMetadata = stuff.viewMetadata || {}\n    this.stateModel = stuff.stateModel\n    this.extendedName = stuff.extendedName\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\n\nexport default class ArcRenderer extends FeatureRendererType {}\n","import { Suspense, lazy, useRef, useState } from 'react'\n\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { bpSpanPx, getStrokeProps } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\n\nconst ArcTooltip = lazy(() => import('../ArcTooltip'))\n\nfunction Arc({\n  selectedFeatureId,\n  region,\n  bpPerPx,\n  config,\n  height: displayHeight,\n  feature,\n  onFeatureClick,\n}: {\n  selectedFeatureId?: string\n  region: Region\n  config: AnyConfigurationModel\n  bpPerPx: number\n  height: number\n  feature: Feature\n  onFeatureClick: (event: React.MouseEvent, featureId: string) => void\n}) {\n  const [isMouseOvered, setIsMouseOvered] = useState(false)\n  const [left, right] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n  const featureId = feature.id()\n  const selected =\n    selectedFeatureId && String(selectedFeatureId) === String(feature.id())\n  const stroke = selected ? 'red' : readConfObject(config, 'color', { feature })\n  const textStroke = selected ? 'red' : 'black'\n  const label = readConfObject(config, 'label', { feature })\n  const caption = readConfObject(config, 'caption', { feature })\n  const strokeWidth = readConfObject(config, 'thickness', { feature }) || 2\n  const height = Math.min(\n    readConfObject(config, 'height', { feature }) || 100,\n    displayHeight,\n  )\n  const ref = useRef<SVGPathElement>(null)\n\n  // formula: https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B%C3%A9zier_curves\n  const t = 0.5\n  const t1 = 1 - t\n  const textYCoord = 3 * (t1 * t1) * (t * height) + 3 * t1 * (t * t) * height\n\n  return (\n    <g>\n      <path\n        ref={ref}\n        {...getStrokeProps(stroke)}\n        d={`M ${left} 0 C ${left} ${height}, ${right} ${height}, ${right} 0`}\n        strokeWidth={strokeWidth}\n        fill=\"transparent\"\n        onClick={e => {\n          onFeatureClick(e, featureId)\n        }}\n        onMouseOver={() => {\n          setIsMouseOvered(true)\n        }}\n        onMouseLeave={() => {\n          setIsMouseOvered(false)\n        }}\n        pointerEvents=\"stroke\"\n      />\n\n      {isMouseOvered ? (\n        <Suspense fallback={null}>\n          <ArcTooltip contents={caption} />\n        </Suspense>\n      ) : null}\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke=\"white\"\n        strokeWidth=\"0.6em\"\n      >\n        {label}\n      </text>\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke={textStroke}\n      >\n        {label}\n      </text>\n    </g>\n  )\n}\n\nfunction polarToCartesian(\n  centerX: number,\n  centerY: number,\n  radius: number,\n  angleInDegrees: number,\n) {\n  const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180\n\n  return {\n    x: centerX + radius * Math.cos(angleInRadians),\n    y: centerY + radius * Math.sin(angleInRadians),\n  }\n}\n\nfunction describeArc(\n  x: number,\n  y: number,\n  radius: number,\n  startAngle: number,\n  endAngle: number,\n) {\n  const start = polarToCartesian(x, y, radius, endAngle)\n  const end = polarToCartesian(x, y, radius, startAngle)\n  const largeArcFlag = endAngle - startAngle <= 180 ? '0' : '1'\n\n  return [\n    'M',\n    start.x,\n    start.y,\n    'A',\n    radius,\n    radius,\n    0,\n    largeArcFlag,\n    0,\n    end.x,\n    end.y,\n  ].join(' ')\n}\n\nfunction SemiCircles({\n  selectedFeatureId,\n  region,\n  bpPerPx,\n  config,\n  onFeatureClick,\n  feature,\n}: {\n  selectedFeatureId?: string\n  region: Region\n  config: AnyConfigurationModel\n  onFeatureClick: (event: React.MouseEvent, featureId: string) => void\n  bpPerPx: number\n  feature: Feature\n}) {\n  const [isMouseOvered, setIsMouseOvered] = useState(false)\n  const [left, right] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n\n  const featureId = feature.id()\n  const selected =\n    selectedFeatureId && String(selectedFeatureId) === String(feature.id())\n  const stroke = selected ? 'red' : readConfObject(config, 'color', { feature })\n  const textStroke = selected ? 'red' : 'black'\n  const label = readConfObject(config, 'label', { feature })\n  const caption = readConfObject(config, 'caption', { feature })\n  const strokeWidth = readConfObject(config, 'thickness', { feature }) || 2\n  const ref = useRef<SVGPathElement>(null)\n  const textYCoord = (right - left) / 2\n\n  return (\n    <g>\n      <path\n        d={describeArc(\n          left + (right - left) / 2,\n          0,\n          (right - left) / 2,\n          90,\n          270,\n        )}\n        {...getStrokeProps(stroke)}\n        strokeWidth={strokeWidth}\n        fill=\"transparent\"\n        onClick={e => {\n          onFeatureClick(e, featureId)\n        }}\n        onMouseOver={() => {\n          setIsMouseOvered(true)\n        }}\n        onMouseLeave={() => {\n          setIsMouseOvered(false)\n        }}\n        ref={ref}\n        pointerEvents=\"stroke\"\n      />\n      {isMouseOvered ? <ArcTooltip contents={caption} /> : null}\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke=\"white\"\n        strokeWidth=\"0.6em\"\n      >\n        {label}\n      </text>\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke={textStroke}\n      >\n        {label}\n      </text>\n    </g>\n  )\n}\nconst ArcRendering = observer(function ({\n  features,\n  config,\n  regions,\n  bpPerPx,\n  height,\n  exportSVG,\n  displayModel,\n  onFeatureClick,\n}: {\n  features: Map<string, Feature>\n  config: AnyConfigurationModel\n  regions: Region[]\n  bpPerPx: number\n  height: number\n  displayModel?: { selectedFeatureId: string }\n  onFeatureClick: (event: React.MouseEvent, featureId: string) => void\n  exportSVG: boolean\n}) {\n  const region = regions[0]!\n  const width = (region.end - region.start) / bpPerPx\n  const semicircles = readConfObject(config, 'displayMode') === 'semicircles'\n  const { selectedFeatureId } = displayModel || {}\n\n  return (\n    <Wrapper exportSVG={exportSVG} width={width} height={height}>\n      {[...features.values()].map(f =>\n        semicircles ? (\n          <SemiCircles\n            key={f.id()}\n            config={config}\n            region={region}\n            bpPerPx={bpPerPx}\n            selectedFeatureId={selectedFeatureId}\n            onFeatureClick={onFeatureClick}\n            feature={f}\n          />\n        ) : (\n          <Arc\n            key={f.id()}\n            height={height}\n            config={config}\n            region={region}\n            bpPerPx={bpPerPx}\n            selectedFeatureId={selectedFeatureId}\n            onFeatureClick={onFeatureClick}\n            feature={f}\n          />\n        ),\n      )}\n    </Wrapper>\n  )\n})\n\nfunction Wrapper({\n  exportSVG,\n  width,\n  height,\n  children,\n}: {\n  exportSVG: boolean\n  width: number\n  height: number\n  children: React.ReactNode\n}) {\n  return exportSVG ? (\n    children\n  ) : (\n    <svg width={width} height={height}>\n      {children}\n    </svg>\n  )\n}\n\nexport default ArcRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config ArcRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ArcRenderer = ConfigurationSchema(\n  'ArcRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of the arcs',\n      defaultValue: 'darkblue',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    thickness: {\n      type: 'number',\n      description: 'the thickness of the arcs',\n      defaultValue: `jexl:logThickness(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    label: {\n      type: 'string',\n      description: 'the label to appear at the apex of the arcs',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'the height of the arcs',\n      defaultValue: `jexl:log10(get(feature,'end')-get(feature,'start'))*50`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    caption: {\n      type: 'string',\n      description:\n        'the caption to appear when hovering over any point on the arcs',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'enum',\n      defaultValue: 'arcs',\n      model: types.enumeration('DisplayMode', ['arcs', 'semicircles']),\n      description: 'render semi-circles instead of arcs',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default ArcRenderer\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getEnv } from '@jbrowse/core/util'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearArcDisplay\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearArcDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearArcDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        displayMode: types.maybe(types.string),\n      }),\n    )\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get blockType() {\n        return 'staticBlocks'\n      },\n      /**\n       * #getter\n       */\n      get renderDelay() {\n        return 500\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get displayModeSetting() {\n        return self.displayMode ?? getConf(self, ['renderer', 'displayMode'])\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n        const config = configBlob as Omit<typeof configBlob, symbol>\n        return self.rendererType.configSchema.create(\n          {\n            ...config,\n            displayMode: self.displayModeSetting,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.rendererConfig,\n            height: self.height,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setDisplayMode(flag: string) {\n        self.displayMode = flag\n      },\n    }))\n    .views(self => {\n      const superMenuItems = self.trackMenuItems\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superMenuItems(),\n            {\n              label: 'Display mode',\n              subMenu: [\n                {\n                  type: 'radio',\n                  label: 'Arcs',\n                  onClick: () => {\n                    self.setDisplayMode('arcs')\n                  },\n                  checked: self.displayMode === 'arcs',\n                },\n                {\n                  type: 'radio',\n                  label: 'Semi-circles',\n                  onClick: () => {\n                    self.setDisplayMode('semicircles')\n                  },\n                  checked: self.displayMode === 'semicircles',\n                },\n              ],\n            },\n          ]\n        },\n      }\n    })\n}\n","import type React from 'react'\n\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes'\nimport {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport {\n  FeatureDensityMixin,\n  TrackHeightMixin,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel LinearPairedArcDisplay\n * this is a non-block-based track type, and can connect arcs across multiple\n * displayedRegions\n *\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearPairedArcDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearPairedArcDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        displayMode: types.maybe(types.string),\n      }),\n    )\n    .volatile(() => ({\n      lastDrawnOffsetPx: 0,\n      features: undefined as Feature[] | undefined,\n      loading: false,\n      drawn: true,\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get displayModeSetting() {\n        return self.displayMode ?? getConf(self, ['renderer', 'displayMode'])\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'VariantFeatureWidget',\n            'variantFeature',\n            {\n              view: getContainingView(self),\n              track: getContainingTrack(self),\n              featureData: feature.toJSON(),\n            },\n          )\n\n          session.showWidget(featureWidget)\n        }\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n      /**\n       * #action\n       */\n      setLoading(flag: boolean) {\n        self.loading = flag\n      },\n      /**\n       * #action\n       */\n      setFeatures(f: Feature[]) {\n        self.features = f\n      },\n      /**\n       * #action\n       */\n      setDisplayMode(flag: string) {\n        self.displayMode = flag\n      },\n    }))\n\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('./afterAttach')\n            doAfterAttach(self)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n      /**\n       * #action\n       */\n      async renderSvg(opts: {\n        rasterizeLayers?: boolean\n      }): Promise<React.ReactNode> {\n        const { renderArcSvg } = await import('./renderSvg')\n        // @ts-expect-error\n        return renderArcSvg(self, opts)\n      },\n    }))\n}\n\nexport type LinearArcDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearArcDisplayModel = Instance<LinearArcDisplayStateModel>\n","import Plugin from '@jbrowse/core/Plugin'\nimport { set1 } from '@jbrowse/core/ui/colors'\n\nimport ArcRendererF from './ArcRenderer'\nimport LinearArcDisplayF from './LinearArcDisplay'\nimport LinearPairedArcDisplayF from './LinearPairedArcDisplay'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default class ArcPlugin extends Plugin {\n  name = 'ArcRenderer'\n  install(pluginManager: PluginManager) {\n    ArcRendererF(pluginManager)\n    LinearArcDisplayF(pluginManager)\n    LinearPairedArcDisplayF(pluginManager)\n\n    pluginManager.jexl.addFunction(\n      'logThickness',\n      (feature: Feature, attributeName: string) =>\n        Math.log(feature.get(attributeName) + 1),\n    )\n    pluginManager.jexl.addFunction(\n      'defaultPairedArcColor',\n      (_feature: Feature, alt?: string) => {\n        if (alt?.startsWith('<DEL')) {\n          return set1[0]\n        } else if (alt?.startsWith('<DUP')) {\n          return set1[1]\n        } else if (alt?.startsWith('<INV')) {\n          return set1[2]\n        } else if (alt?.startsWith('<TRA')) {\n          return set1[3]\n        } else if (alt?.startsWith('<CNV')) {\n          return set1[4]\n        } else {\n          return set1[6] // skip 5, yellow\n        }\n      },\n    )\n  }\n}\n","import ArcRenderer from './ArcRenderer'\nimport ReactComponent from './ArcRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function ArcRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new ArcRenderer({\n        name: 'ArcRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport { configSchemaFactory } from './configSchema'\nimport { stateModelFactory } from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearArcDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearArcDisplay',\n      displayName: 'Arc display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'FeatureTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearArcDisplay\n */\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearArcDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'ArcRenderer' },\n      ),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport { DisplayType } from '@jbrowse/core/pluggableElementTypes'\n\nimport { configSchemaFactory } from './configSchema'\nimport { stateModelFactory } from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearPairedArcDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory()\n    return new DisplayType({\n      name: 'LinearPairedArcDisplay',\n      displayName: 'Arc display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'VariantTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: lazy(() => import('./components/ReactComponent')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #config LinearPairedArcDisplay\n */\nexport function configSchemaFactory() {\n  return ConfigurationSchema(\n    'LinearPairedArcDisplay',\n    {\n      /**\n       * #slot\n       */\n      color: {\n        type: 'color',\n        description: 'the color of the arcs',\n        defaultValue: 'jexl:defaultPairedArcColor(feature,alt)',\n        contextVariable: ['feature', 'alt'],\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config OAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst OAuthConfigSchema = ConfigurationSchema(\n  'OAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Bearer',\n    },\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    clientId: {\n      description: 'id for the OAuth application',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    state: {\n      description: 'optional state for the authorization call',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    responseType: {\n      description:\n        \"the type of response from the authorization endpoint. can be 'token' or 'code'\",\n      type: 'string',\n      defaultValue: 'code',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type OAuthInternetAccountConfigModel = typeof OAuthConfigSchema\nexport type OAuthInternetAccountConfig =\n  Instance<OAuthInternetAccountConfigModel>\nexport default OAuthConfigSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config DropboxOAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DropboxOAuthConfigSchema = ConfigurationSchema(\n  'DropboxOAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://www.dropbox.com/oauth2/authorize',\n    },\n    /**\n     * #slot\n     */\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://api.dropbox.com/oauth2/token',\n    },\n    /**\n     * #slot\n     */\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [\n        'addtodropbox.com',\n        'db.tt',\n        'dropbox.com',\n        'dropboxapi.com',\n        'dropboxbusiness.com',\n        'dropbox.tech',\n        'getdropbox.com',\n      ],\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: OAuthConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport type DropboxOAuthInternetAccountConfigModel =\n  typeof DropboxOAuthConfigSchema\n\nexport type DropboxOAuthInternetAccountConfig =\n  Instance<DropboxOAuthInternetAccountConfigModel>\nexport default DropboxOAuthConfigSchema\n","export function fixup(buf: string) {\n  return buf.replaceAll('+', '-').replaceAll('/', '_').replaceAll('=', '')\n}\n\nexport async function generateChallenge(val: string) {\n  const sha256 = await import('crypto-js/sha256').then(f => f.default)\n  const Base64 = await import('crypto-js/enc-base64')\n  return fixup(Base64.stringify(sha256(val)))\n}\n\n// if response is JSON, checks if it needs to remove tokens in error, or just plain throw\nexport function processError(text: string, invalidErrorCb: () => void) {\n  try {\n    const obj = JSON.parse(text)\n    if (obj.error === 'invalid_grant') {\n      invalidErrorCb()\n    }\n    return obj?.error_description ?? text\n  } catch (e) {\n    /* response text is not json, just use original text as error */\n  }\n  return text\n}\n\nexport function processTokenResponse(\n  data: { refresh_token?: string; access_token: string },\n  storeRefreshTokenCb: (str: string) => void,\n) {\n  if (data.refresh_token) {\n    storeRefreshTokenCb(data.refresh_token)\n  }\n  return data.access_token\n}\n","export async function getResponseError({\n  response,\n  reason,\n  statusText,\n}: {\n  response: Response\n  reason?: string\n  statusText?: string\n}) {\n  return [\n    `HTTP ${response.status}`,\n    reason,\n    statusText ?? (await getError(response)),\n  ]\n    .filter(f => !!f)\n    .join(' - ')\n}\n\nexport async function getError(response: Response) {\n  try {\n    return await response.text()\n  } catch (e) {\n    return response.statusText\n  }\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { isElectron } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\n\nimport {\n  fixup,\n  generateChallenge,\n  processError,\n  processTokenResponse,\n} from './util'\nimport { getResponseError } from '../util'\n\nimport type { OAuthInternetAccountConfigModel } from './configSchema'\nimport type { UriLocation } from '@jbrowse/core/util'\nimport type { Instance } from 'mobx-state-tree'\n\n// ISC Copyright (c) 2020, Andrea Giammarchi, @WebReflection\n// https://github.com/WebReflection/uint8-to-base64\nfunction encode(uint8array: Uint8Array) {\n  const output = []\n\n  for (let i = 0, length = uint8array.length; i < length; i++) {\n    output.push(String.fromCharCode(uint8array[i]!))\n  }\n\n  return btoa(output.join(''))\n}\n\ninterface OAuthData {\n  client_id: string\n  redirect_uri: string\n  response_type: 'token' | 'code'\n  scope?: string\n  code_challenge?: string\n  code_challenge_method?: string\n  token_access_type?: string\n  state?: string\n}\n\n/**\n * #stateModel OAuthInternetAccount\n */\nconst stateModelFactory = (configSchema: OAuthInternetAccountConfigModel) => {\n  return InternetAccount.named('OAuthInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('OAuthInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => {\n      let codeVerifier: string | undefined = undefined\n      return {\n        /**\n         * #getter\n         */\n        get codeVerifierPKCE() {\n          if (!codeVerifier) {\n            const array = new Uint8Array(32)\n            globalThis.crypto.getRandomValues(array)\n            codeVerifier = fixup(encode(array))\n          }\n          return codeVerifier\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get authEndpoint(): string {\n        return getConf(self, 'authEndpoint')\n      },\n      /**\n       * #getter\n       */\n      get tokenEndpoint(): string {\n        return getConf(self, 'tokenEndpoint')\n      },\n      /**\n       * #getter\n       */\n      get needsPKCE(): boolean {\n        return getConf(self, 'needsPKCE')\n      },\n      /**\n       * #getter\n       */\n      get clientId(): string {\n        return getConf(self, 'clientId')\n      },\n      /**\n       * #getter\n       */\n      get scopes(): string {\n        return getConf(self, 'scopes')\n      },\n      /**\n       * #method\n       * OAuth state parameter:\n       * https://www.rfc-editor.org/rfc/rfc6749#section-4.1.1\n       *\n       * Can override or extend if dynamic state is needed.\n       */\n      state(): string | undefined {\n        return getConf(self, 'state')\n      },\n      /**\n       * #getter\n       */\n      get responseType(): 'token' | 'code' {\n        return getConf(self, 'responseType')\n      },\n      /**\n       * #getter\n       */\n      get refreshTokenKey() {\n        return `${self.internetAccountId}-refreshToken`\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      storeRefreshToken(refreshToken: string) {\n        localStorage.setItem(self.refreshTokenKey, refreshToken)\n      },\n      /**\n       * #action\n       */\n      removeRefreshToken() {\n        localStorage.removeItem(self.refreshTokenKey)\n      },\n      /**\n       * #method\n       */\n      retrieveRefreshToken() {\n        return localStorage.getItem(self.refreshTokenKey)\n      },\n      /**\n       * #action\n       */\n      async exchangeAuthorizationForAccessToken(\n        token: string,\n        redirectUri: string,\n      ) {\n        const params = new URLSearchParams(\n          Object.entries({\n            code: token,\n            grant_type: 'authorization_code',\n            client_id: self.clientId,\n            redirect_uri: redirectUri,\n            ...(self.needsPKCE ? { code_verifier: self.codeVerifierPKCE } : {}),\n          }),\n        )\n\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: params.toString(),\n        })\n\n        if (!response.ok) {\n          throw new Error(\n            await getResponseError({\n              response,\n              reason: 'Failed to obtain token',\n            }),\n          )\n        }\n\n        const data = await response.json()\n        return processTokenResponse(data, token => {\n          this.storeRefreshToken(token)\n        })\n      },\n      /**\n       * #action\n       */\n      async exchangeRefreshForAccessToken(refreshToken: string) {\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: new URLSearchParams(\n            Object.entries({\n              grant_type: 'refresh_token',\n              refresh_token: refreshToken,\n              client_id: self.clientId,\n            }),\n          ).toString(),\n        })\n\n        if (!response.ok) {\n          self.removeToken()\n          const text = await response.text()\n          throw new Error(\n            await getResponseError({\n              response,\n              statusText: processError(text, () => {\n                this.removeRefreshToken()\n              }),\n            }),\n          )\n        }\n        const data = await response.json()\n        return processTokenResponse(data, token => {\n          this.storeRefreshToken(token)\n        })\n      },\n    }))\n    .actions(self => {\n      let listener: (event: MessageEvent) => undefined\n      let exchangedTokenPromise: Promise<string> | undefined = undefined\n      return {\n        /**\n         * #action\n         * used to listen to child window for auth code/token\n         */\n        addMessageChannel(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          listener = event => {\n            // this should probably get better handling, but ignored for now\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.finishOAuthWindow(event, resolve, reject)\n          }\n          window.addEventListener('message', listener)\n        },\n        /**\n         * #action\n         */\n        deleteMessageChannel() {\n          window.removeEventListener('message', listener)\n        },\n        /**\n         * #action\n         */\n        async finishOAuthWindow(\n          event: MessageEvent,\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          if (\n            event.data.name !== `JBrowseAuthWindow-${self.internetAccountId}`\n          ) {\n            this.deleteMessageChannel()\n            return\n          }\n          const redirectUriWithInfo = event.data.redirectUri\n          const fixedQueryString = redirectUriWithInfo.replace('#', '?')\n          const redirectUrl = new URL(fixedQueryString)\n          const queryStringSearch = redirectUrl.search\n          const urlParams = new URLSearchParams(queryStringSearch)\n          if (urlParams.has('access_token')) {\n            const token = urlParams.get('access_token')\n            if (!token) {\n              reject(new Error('Error with token endpoint'))\n              return\n            }\n            self.storeToken(token)\n            resolve(token)\n            return\n          }\n          if (urlParams.has('code')) {\n            const code = urlParams.get('code')\n            if (!code) {\n              reject(new Error('Error with authorization endpoint'))\n              return\n            }\n            try {\n              const token = await self.exchangeAuthorizationForAccessToken(\n                code,\n                redirectUrl.origin + redirectUrl.pathname,\n              )\n              self.storeToken(token)\n              resolve(token)\n              return\n            } catch (e) {\n              if (e instanceof Error) {\n                reject(e)\n              } else {\n                reject(new Error(String(e)))\n              }\n              return\n            }\n          }\n          if (redirectUriWithInfo.includes('access_denied')) {\n            reject(new Error('OAuth flow was cancelled'))\n            return\n          }\n          if (redirectUriWithInfo.includes('error')) {\n            reject(new Error(`OAuth flow error: ${queryStringSearch}`))\n            return\n          }\n          this.deleteMessageChannel()\n        },\n        /**\n         * #action\n         * opens external OAuth flow, popup for web and new browser window for\n         * desktop\n         */\n        async useEndpointForAuthorization(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          const redirectUri = isElectron\n            ? 'http://localhost/auth'\n            : window.location.origin + window.location.pathname\n          const data: OAuthData = {\n            client_id: self.clientId,\n            redirect_uri: redirectUri,\n            response_type: self.responseType,\n            token_access_type: 'offline',\n          }\n\n          if (self.state()) {\n            data.state = self.state()\n          }\n\n          if (self.scopes) {\n            data.scope = self.scopes\n          }\n\n          if (self.needsPKCE) {\n            data.code_challenge = await generateChallenge(self.codeVerifierPKCE)\n            data.code_challenge_method = 'S256'\n          }\n\n          const params = new URLSearchParams(Object.entries(data))\n\n          const url = new URL(self.authEndpoint)\n          url.search = params.toString()\n\n          const eventName = `JBrowseAuthWindow-${self.internetAccountId}`\n          if (isElectron) {\n            const { ipcRenderer } = window.require('electron')\n            const redirectUri = await ipcRenderer.invoke('openAuthWindow', {\n              internetAccountId: self.internetAccountId,\n              data,\n              url: url.toString(),\n            })\n\n            const eventFromDesktop = new MessageEvent('message', {\n              data: { name: eventName, redirectUri: redirectUri },\n            })\n            // may want to improve handling\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.finishOAuthWindow(eventFromDesktop, resolve, reject)\n          } else {\n            window.open(url, eventName, 'width=500,height=600,left=0,top=0')\n          }\n        },\n        /**\n         * #action\n         */\n        async getTokenFromUser(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          const refreshToken = self.retrieveRefreshToken()\n          let doUserFlow = true\n\n          // if there is a refresh token, then try it out, and only if that\n          // refresh token succeeds, set doUserFlow to false\n          if (refreshToken) {\n            try {\n              const token =\n                await self.exchangeRefreshForAccessToken(refreshToken)\n              resolve(token)\n              doUserFlow = false\n            } catch (e) {\n              console.error(e)\n              self.removeRefreshToken()\n            }\n          }\n          if (doUserFlow) {\n            this.addMessageChannel(resolve, reject)\n            // may want to improve handling\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.useEndpointForAuthorization(resolve, reject)\n          }\n        },\n        /**\n         * #action\n         */\n        async validateToken(token: string, location: UriLocation) {\n          const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n          const response = await fetch(location.uri, newInit)\n          if (!response.ok) {\n            self.removeToken()\n            const refreshToken = self.retrieveRefreshToken()\n            if (refreshToken) {\n              try {\n                if (!exchangedTokenPromise) {\n                  exchangedTokenPromise =\n                    self.exchangeRefreshForAccessToken(refreshToken)\n                }\n                const newToken = await exchangedTokenPromise\n                exchangedTokenPromise = undefined\n                return newToken\n              } catch (err) {\n                console.error('Token could not be refreshed', err)\n                // let original error be thrown\n              }\n            }\n\n            throw new Error(\n              await getResponseError({\n                response,\n                reason: 'Error validating token',\n              }),\n            )\n          }\n          return token\n        },\n      }\n    })\n    .actions(self => {\n      const superGetFetcher = self.getFetcher\n      return {\n        /**\n         * #action\n         * Get a fetch method that will add any needed authentication headers\n         * to the request before sending it. If location is provided, it will\n         * be checked to see if it includes a token in it's pre-auth\n         * information.\n         *\n         * @param loc - UriLocation of the resource\n         * @returns A function that can be used to fetch\n         */\n        getFetcher(loc?: UriLocation) {\n          const fetcher = superGetFetcher(loc)\n          return async (input: RequestInfo, init?: RequestInit) => {\n            if (loc) {\n              await self.validateToken(await self.getToken(loc), loc)\n            }\n            return fetcher(input, init)\n          }\n        },\n      }\n    })\n}\n\nexport default stateModelFactory\nexport type OAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type OAuthModel = Instance<OAuthStateModel>\n","import { SvgIcon } from '@mui/material'\n\nimport type { SvgIconProps } from '@mui/material'\n\nexport default function DropboxIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z\" />\n    </SvgIcon>\n  )\n}\n","import { getResponseError } from '../util'\n\ninterface DropboxError {\n  error_summary: string\n  error: {\n    '.tag': string\n  }\n}\n\n/**\n * Error messages from\n * https://www.dropbox.com/developers/documentation/http/documentation#sharing-get_shared_link_file\n * */\nconst dropboxErrorMessages: Record<string, string> = {\n  shared_link_not_found: \"The shared link wasn't found.\",\n  shared_link_access_denied:\n    'The caller is not allowed to access this shared link.',\n  unsupported_link_type:\n    'This type of link is not supported; use files/export instead.',\n  shared_link_is_directory: 'Directories cannot be retrieved by this endpoint.',\n}\n\nexport async function getDescriptiveErrorMessage(\n  response: Response,\n  reason?: string,\n) {\n  let errorMessage = ''\n  try {\n    const err = JSON.parse(await response.text()) as DropboxError\n    const tag = err.error['.tag']\n    errorMessage = dropboxErrorMessages[tag] || tag\n  } catch (error) {\n    /* do nothing */\n  }\n  return getResponseError({ response, reason, statusText: errorMessage })\n}\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\nimport DropboxIcon from './DropboxIcon'\nimport { getDescriptiveErrorMessage } from './util'\nimport baseModel from '../OAuthModel/model'\n\nimport type { DropboxOAuthInternetAccountConfigModel } from './configSchema'\nimport type { UriLocation } from '@jbrowse/core/util/types'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel DropboxOAuthInternetAccount\n */\nconst stateModelFactory = (\n  configSchema: DropboxOAuthInternetAccountConfigModel,\n) => {\n  return baseModel(OAuthConfigSchema)\n    .named('DropboxOAuthInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('DropboxOAuthInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => ({\n      /**\n       * #getter\n       * The FileSelector icon for Dropbox\n       */\n      get toggleContents() {\n        return <DropboxIcon />\n      },\n      /**\n       * #getter\n       */\n      get selectorLabel() {\n        return 'Enter Dropbox share link'\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #method\n       */\n      getFetcher(location?: UriLocation) {\n        return async (input: RequestInfo, init?: RequestInit) => {\n          const authToken = await self.getToken(location)\n          const newInit = self.addAuthHeaderToInit(\n            { ...init, method: 'POST' },\n            authToken,\n          )\n          newInit.headers.append(\n            'Dropbox-API-Arg',\n            JSON.stringify({ url: input }),\n          )\n          const response = await fetch(\n            'https://content.dropboxapi.com/2/sharing/get_shared_link_file',\n            newInit,\n          )\n          if (!response.ok) {\n            throw new Error(await getDescriptiveErrorMessage(response))\n          }\n          return response\n        }\n      },\n      /**\n       * #action\n       */\n      async validateToken(\n        token: string,\n        location: UriLocation,\n      ): Promise<string> {\n        const response = await fetch(\n          'https://api.dropboxapi.com/2/sharing/get_shared_link_metadata',\n          {\n            method: 'POST',\n            headers: {\n              Authorization: `Bearer ${token}`,\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              url: location.uri,\n            }),\n          },\n        )\n        if (!response.ok) {\n          const refreshToken = self.retrieveRefreshToken()\n          if (refreshToken) {\n            self.removeRefreshToken()\n            const newToken =\n              await self.exchangeRefreshForAccessToken(refreshToken)\n            return this.validateToken(newToken, location)\n          }\n          throw new Error(\n            await getDescriptiveErrorMessage(\n              response,\n              'Token could not be validated',\n            ),\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type DropboxOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type DropboxOAuthModel = Instance<DropboxOAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config ExternalTokenInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ExternalTokenConfigSchema = ConfigurationSchema(\n  'ExternalTokenInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type ExternalTokenInternetAccountConfigModel =\n  typeof ExternalTokenConfigSchema\n\nexport type ExternalTokenInternetAccountConfig =\n  Instance<ExternalTokenInternetAccountConfigModel>\nexport default ExternalTokenConfigSchema\n","import { useState } from 'react'\n\nimport { Dialog } from '@jbrowse/core/ui'\nimport { Button, DialogActions, DialogContent, TextField } from '@mui/material'\n\nexport const ExternalTokenEntryForm = ({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (token?: string) => void\n}) => {\n  const [token, setToken] = useState('')\n\n  return (\n    <Dialog\n      open\n      maxWidth=\"xl\"\n      data-testid=\"externalToken-form\"\n      onClose={() => {\n        handleClose()\n      }}\n      title={`Enter token for ${internetAccountId}`}\n    >\n      <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n        <TextField\n          required\n          label=\"Enter Token\"\n          variant=\"outlined\"\n          onChange={event => {\n            setToken(event.target.value)\n          }}\n          margin=\"dense\"\n          slotProps={{\n            htmlInput: { 'data-testid': 'entry-externalToken' },\n          }}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          disabled={!token}\n          onClick={() => {\n            if (token) {\n              handleClose(token)\n            }\n          }}\n        >\n          Add\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={() => {\n            handleClose()\n          }}\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getRoot, types } from 'mobx-state-tree'\n\nimport { ExternalTokenEntryForm } from './ExternalTokenEntryForm'\n\nimport type { ExternalTokenInternetAccountConfigModel } from './configSchema'\nimport type { UriLocation } from '@jbrowse/core/util/types'\nimport type { Instance } from 'mobx-state-tree'\n\nconst stateModelFactory = (\n  configSchema: ExternalTokenInternetAccountConfigModel,\n) => {\n  return InternetAccount.named('ExternalTokenInternetAccount')\n    .props({\n      type: types.literal('ExternalTokenInternetAccount'),\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(self => ({\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        const { session } = getRoot<any>(self)\n        session.queueDialog((doneCallback: () => void) => [\n          ExternalTokenEntryForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('user cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          let errorMessage: string\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Token could not be validated — ${response.status} ${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type ExternalTokenStateModel = ReturnType<typeof stateModelFactory>\nexport type ExternalTokenModel = Instance<ExternalTokenStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config GoogleDriveOAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GoogleDriveOAuthConfigSchema = ConfigurationSchema(\n  'GoogleDriveOAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://accounts.google.com/o/oauth2/v2/auth',\n    },\n    /**\n     * #slot\n     */\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: 'https://www.googleapis.com/auth/drive.readonly',\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: ['drive.google.com\"'],\n    },\n    /**\n     * #slot\n     */\n    responseType: {\n      description: 'the type of response from the authorization endpoint',\n      type: 'string',\n      defaultValue: 'token',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: OAuthConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport type GoogleDriveOAuthInternetAccountConfigModel =\n  typeof GoogleDriveOAuthConfigSchema\n\nexport type GoogleDriveOAuthInternetAccountConfig =\n  Instance<GoogleDriveOAuthInternetAccountConfigModel>\nexport default GoogleDriveOAuthConfigSchema\n","import { RemoteFileWithRangeCache } from '@jbrowse/core/util/io'\n\nimport type { FilehandleOptions, Stats } from 'generic-filehandle2'\n\nexport interface RequestInitWithMetadata extends RequestInit {\n  metadataOnly?: boolean\n}\n\ninterface GoogleDriveFilehandleOptions extends FilehandleOptions {\n  fetch(input: RequestInfo, opts?: RequestInitWithMetadata): Promise<Response>\n}\n\nexport class GoogleDriveFile extends RemoteFileWithRangeCache {\n  private statsPromise: Promise<{ size: number }>\n  constructor(source: string, opts: GoogleDriveFilehandleOptions) {\n    super(source, opts)\n    this.statsPromise = this.fetch(source, {\n      metadataOnly: true,\n    }).then(response => response.json())\n  }\n\n  async fetch(\n    input: RequestInfo,\n    opts?: RequestInitWithMetadata,\n  ): Promise<Response> {\n    return super.fetch(input, opts)\n  }\n\n  async stat(): Promise<Stats> {\n    return this.statsPromise\n  }\n}\n","import { SvgIcon } from '@mui/material'\n\nimport type { SvgIconProps } from '@mui/material'\n\nexport default function GoogleDriveIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z\" />\n    </SvgIcon>\n  )\n}\n","import { getResponseError } from '../util'\n\ninterface GoogleDriveError {\n  error: {\n    errors: {\n      domain: string\n      reason: string\n      message: string\n      locationType?: string\n      location?: string\n    }[]\n    code: number\n    message: string\n  }\n}\n\nexport async function getDescriptiveErrorMessage(\n  response: Response,\n  reason?: string,\n) {\n  let errorMessage = ''\n  try {\n    const err = JSON.parse(await response.text()) as GoogleDriveError\n    errorMessage = err.error.message\n  } catch (error) {\n    /* do nothing */\n  }\n  return getResponseError({ response, reason, statusText: errorMessage })\n}\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\nimport { GoogleDriveFile } from './GoogleDriveFilehandle'\nimport GoogleDriveIcon from './GoogleDriveIcon'\nimport { getDescriptiveErrorMessage } from './util'\nimport baseModel from '../OAuthModel/model'\n\nimport type { GoogleDriveOAuthInternetAccountConfigModel } from './configSchema'\nimport type { UriLocation } from '@jbrowse/core/util/types'\nimport type { Instance } from 'mobx-state-tree'\n\nexport interface RequestInitWithMetadata extends RequestInit {\n  metadataOnly?: boolean\n}\n\nfunction getUri(str: string) {\n  const urlId = /[-\\w]{25,}/.exec(str)\n  return `https://www.googleapis.com/drive/v3/files/${urlId}`\n}\n\n/**\n * #stateModel GoogleDriveOAuthInternetAccount\n */\nexport default function stateModelFactory(\n  configSchema: GoogleDriveOAuthInternetAccountConfigModel,\n) {\n  return baseModel(OAuthConfigSchema)\n    .named('GoogleDriveOAuthInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('GoogleDriveOAuthInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => ({\n      /**\n       * #getter\n       * The FileSelector icon for Google drive\n       */\n      get toggleContents() {\n        return <GoogleDriveIcon />\n      },\n      /**\n       * #getter\n       */\n      get selectorLabel() {\n        return 'Enter Google Drive share link'\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #method\n       */\n      getFetcher(location?: UriLocation) {\n        return async (input: RequestInfo, init?: RequestInitWithMetadata) => {\n          const driveUrl = new URL(getUri(String(input)))\n          const searchParams = new URLSearchParams()\n          if (init?.metadataOnly) {\n            searchParams.append('fields', 'size')\n          } else {\n            searchParams.append('alt', 'media')\n          }\n          driveUrl.search = searchParams.toString()\n          const authToken = await self.getToken(location)\n          const response = await fetch(\n            driveUrl,\n            self.addAuthHeaderToInit(\n              { ...init, method: 'GET', credentials: 'same-origin' },\n              authToken,\n            ),\n          )\n          if (!response.ok) {\n            throw new Error(await getDescriptiveErrorMessage(response))\n          }\n          return response\n        }\n      },\n      /**\n       * #method\n       */\n      openLocation(location: UriLocation) {\n        return new GoogleDriveFile(location.uri, {\n          fetch: this.getFetcher(location),\n        })\n      },\n      /**\n       * #action\n       */\n      async validateToken(token: string, location: UriLocation) {\n        const response = await fetch(getUri(location.uri), {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n        })\n        if (!response.ok) {\n          throw new Error(\n            await getDescriptiveErrorMessage(\n              response,\n              'Token could not be validated',\n            ),\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport type GoogleDriveOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type GoogleDriveOAuthModel = Instance<GoogleDriveOAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config HTTPBasicInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HTTPBasicConfigSchema = ConfigurationSchema(\n  'HTTPBasicInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Basic',\n    },\n    /**\n     * #slot\n     */\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type HTTPBasicInternetAccountConfigModel = typeof HTTPBasicConfigSchema\n\nexport type HTTPBasicInternetAccountConfig =\n  Instance<HTTPBasicInternetAccountConfigModel>\nexport default HTTPBasicConfigSchema\n","import { useState } from 'react'\n\nimport { Dialog } from '@jbrowse/core/ui'\nimport { Button, DialogActions, DialogContent, TextField } from '@mui/material'\n\nexport function HTTPBasicLoginForm({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (arg?: string) => void\n}) {\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n\n  return (\n    <Dialog\n      open\n      maxWidth=\"xl\"\n      data-testid=\"login-httpbasic\"\n      title={`Log in for ${internetAccountId}`}\n      onClose={() => {\n        handleClose()\n      }}\n    >\n      <form\n        onSubmit={event => {\n          if (username && password) {\n            handleClose(btoa(`${username}:${password}`))\n          } else {\n            handleClose()\n          }\n          event.preventDefault()\n        }}\n      >\n        <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n          <TextField\n            required\n            label=\"Username\"\n            variant=\"outlined\"\n            onChange={event => {\n              setUsername(event.target.value)\n            }}\n            margin=\"dense\"\n            slotProps={{\n              htmlInput: { 'data-testid': 'login-httpbasic-username' },\n            }}\n          />\n          <TextField\n            required\n            label=\"Password\"\n            type=\"password\"\n            autoComplete=\"current-password\"\n            variant=\"outlined\"\n            onChange={event => {\n              setPassword(event.target.value)\n            }}\n            margin=\"dense\"\n            slotProps={{\n              htmlInput: { 'data-testid': 'login-httpbasic-password' },\n            }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button variant=\"contained\" color=\"primary\" type=\"submit\">\n            Submit\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            type=\"submit\"\n            onClick={() => {\n              handleClose()\n            }}\n          >\n            Cancel\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getRoot, types } from 'mobx-state-tree'\n\nimport { HTTPBasicLoginForm } from './HTTPBasicLoginForm'\nimport { getResponseError } from '../util'\n\nimport type { HTTPBasicInternetAccountConfigModel } from './configSchema'\nimport type { UriLocation } from '@jbrowse/core/util/types'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel HTTPBasicInternetAccount\n */\nconst stateModelFactory = (\n  configSchema: HTTPBasicInternetAccountConfigModel,\n) => {\n  return InternetAccount.named('HTTPBasicInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('HTTPBasicInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        const { session } = getRoot<any>(self)\n        session.queueDialog((doneCallback: () => void) => [\n          HTTPBasicLoginForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('User cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      /**\n       * #action\n       */\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          throw new Error(\n            await getResponseError({\n              response,\n              reason: 'Error validating token',\n            }),\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type HTTPBasicStateModel = ReturnType<typeof stateModelFactory>\nexport type HTTPBasicModel = Instance<HTTPBasicStateModel>\n","import Plugin from '@jbrowse/core/Plugin'\nimport InternetAccountType from '@jbrowse/core/pluggableElementTypes/InternetAccountType'\n\nimport {\n  configSchema as DropboxOAuthConfigSchema,\n  modelFactory as DropboxOAuthInternetAccountModelFactory,\n} from './DropboxOAuthModel'\nimport {\n  configSchema as ExternalTokenConfigSchema,\n  modelFactory as ExternalTokenInternetAccountModelFactory,\n} from './ExternalTokenModel'\nimport {\n  configSchema as GoogleDriveOAuthConfigSchema,\n  modelFactory as GoogleDriveOAuthInternetAccountModelFactory,\n} from './GoogleDriveOAuthModel'\nimport {\n  configSchema as HTTPBasicConfigSchema,\n  modelFactory as HTTPBasicInternetAccountModelFactory,\n} from './HTTPBasicModel'\nimport {\n  configSchema as OAuthConfigSchema,\n  modelFactory as OAuthInternetAccountModelFactory,\n} from './OAuthModel'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class AuthenticationPlugin extends Plugin {\n  name = 'AuthenticationPlugin'\n\n  exports = {\n    OAuthConfigSchema,\n    OAuthInternetAccountModelFactory,\n    ExternalTokenConfigSchema,\n    ExternalTokenInternetAccountModelFactory,\n    HTTPBasicConfigSchema,\n    HTTPBasicInternetAccountModelFactory,\n    DropboxOAuthConfigSchema,\n    DropboxOAuthInternetAccountModelFactory,\n    GoogleDriveOAuthConfigSchema,\n    GoogleDriveOAuthInternetAccountModelFactory,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'OAuthInternetAccount',\n        configSchema: OAuthConfigSchema,\n        stateModel: OAuthInternetAccountModelFactory(OAuthConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'ExternalTokenInternetAccount',\n        configSchema: ExternalTokenConfigSchema,\n        stateModel: ExternalTokenInternetAccountModelFactory(\n          ExternalTokenConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'HTTPBasicInternetAccount',\n        configSchema: HTTPBasicConfigSchema,\n        stateModel: HTTPBasicInternetAccountModelFactory(HTTPBasicConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'DropboxOAuthInternetAccount',\n        configSchema: DropboxOAuthConfigSchema,\n        stateModel: DropboxOAuthInternetAccountModelFactory(\n          DropboxOAuthConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'GoogleDriveOAuthInternetAccount',\n        configSchema: GoogleDriveOAuthConfigSchema,\n        stateModel: GoogleDriveOAuthInternetAccountModelFactory(\n          GoogleDriveOAuthConfigSchema,\n        ),\n      })\n    })\n  }\n}\n\nexport {\n  configSchema as OAuthConfigSchema,\n  modelFactory as OAuthInternetAccountModelFactory,\n} from './OAuthModel'\nexport {\n  configSchema as ExternalTokenConfigSchema,\n  modelFactory as ExternalTokenInternetAccountModelFactory,\n} from './ExternalTokenModel'\n\nexport {\n  configSchema as HTTPBasicConfigSchema,\n  modelFactory as HTTPBasicInternetAccountModelFactory,\n} from './HTTPBasicModel'\n\nexport {\n  configSchema as DropboxOAuthConfigSchema,\n  modelFactory as DropboxOAuthInternetAccountModelFactory,\n} from './DropboxOAuthModel'\n\nexport {\n  configSchema as GoogleDriveOAuthConfigSchema,\n  modelFactory as GoogleDriveOAuthInternetAccountModelFactory,\n} from './GoogleDriveOAuthModel'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BedAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedAdapter = ConfigurationSchema(\n  'BedAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedLocation: {\n      type: 'fileLocation',\n      description: 'path to bed file, also allows gzipped bed',\n      defaultValue: {\n        uri: '/path/to/my.bed.gz',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    colRef: {\n      type: 'number',\n      description: 'The column to use as a \"refName\" attribute',\n      defaultValue: 0,\n    },\n    /**\n     * #slot\n     */\n    colStart: {\n      type: 'number',\n      description: 'The column to use as a \"start\" attribute',\n      defaultValue: 1,\n    },\n    /**\n     * #slot\n     */\n    colEnd: {\n      type: 'number',\n      description: 'The column to use as a \"end\" attribute',\n      defaultValue: 2,\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"BedAdapter\",\n     *   \"uri\": \"yourfile.bed\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            bedLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default BedAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BedGraphAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedGraphAdapter = ConfigurationSchema(\n  'BedGraphAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedGraphLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bedgraph',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"BedGraphAdapter\",\n     *   \"uri\": \"yourfile.bed\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            bedGraphLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default BedGraphAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config BedGraphTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedGraphTabixAdapter = ConfigurationSchema(\n  'BedGraphTabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedGraphGzLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bedgraph',\n        locationType: 'UriLocation',\n      },\n    },\n    index: ConfigurationSchema('VcfIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.vcf.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes yourfile.bg.gz.tbi:\n     * ```json\n     * {\n     *   \"type\": \"BedGraphTabixAdapter\",\n     *   \"uri\": \"yourfile.bg.gz\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            bedGraphGzLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            index: {\n              location: {\n                uri: `${snap.uri}.tbi`,\n                baseUri: snap.baseUri,\n              },\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default BedGraphTabixAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config BedTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedTabixAdapter = ConfigurationSchema(\n  'BedTabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedGzLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bed.gz',\n        locationType: 'UriLocation',\n      },\n    },\n\n    index: ConfigurationSchema('TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.bed.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n\n    /**\n     * #slot\n     */\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes yourfile.bed.gz.tbi:\n     * ```json\n     * {\n     *   \"type\": \"BedTabixAdapter\",\n     *   \"uri\": \"yourfile.bed.gz\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            bedGzLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            index: {\n              location: {\n                uri: `${snap.uri}.tbi`,\n                baseUri: snap.baseUri,\n              },\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default BedTabixAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BedpeAdapter\n * intended for SVs in a single assembly\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedpeAdapter = ConfigurationSchema(\n  'BedpeAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedpeLocation: {\n      type: 'fileLocation',\n      description:\n        'can be plaintext or gzipped, not indexed so loaded into memory on startup',\n      defaultValue: {\n        uri: '/path/to/my.bedpe.gz',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"BedpeAdapter\",\n     *   \"uri\": \"yourfile.bedpe.gz\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            bedpeLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default BedpeAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BigBedAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BigBedAdapter = ConfigurationSchema(\n  'BigBedAdapter',\n  {\n    /**\n     * #slot\n     */\n    bigBedLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bb',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n\n    /**\n     * #slot\n     */\n    aggregateField: {\n      type: 'string',\n      description: 'An attribute to aggregate features with',\n      defaultValue: 'geneName2',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"BigBedAdapter\",\n     *   \"uri\": \"yourfile.bigBed\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            bigBedLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default BigBedAdapter\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport BedAdapterF from './BedAdapter'\nimport BedGraphAdapterF from './BedGraphAdapter'\nimport BedGraphTabixAdapterF from './BedGraphTabixAdapter'\nimport BedTabixAdapterF from './BedTabixAdapter'\nimport BedpeAdapterF from './BedpeAdapter'\nimport BigBedAdapterF from './BigBedAdapter'\nimport GuessAdapterF from './GuessAdapter'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class BedPlugin extends Plugin {\n  name = 'BedPlugin'\n\n  install(pluginManager: PluginManager) {\n    BigBedAdapterF(pluginManager)\n    BedAdapterF(pluginManager)\n    BedpeAdapterF(pluginManager)\n    BedTabixAdapterF(pluginManager)\n    BedGraphAdapterF(pluginManager)\n    BedGraphTabixAdapterF(pluginManager)\n    GuessAdapterF(pluginManager)\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BigBedAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BigBedAdapter',\n        displayName: 'BigBed adapter',\n        configSchema,\n        getAdapterClass: () => import('./BigBedAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BedAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedAdapter',\n        displayName: 'BED adapter',\n        configSchema,\n        getAdapterClass: () => import('./BedAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BedpeAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedpeAdapter',\n        displayName: 'BEDPE adapter',\n        configSchema,\n        getAdapterClass: () => import('./BedpeAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BedTabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedTabixAdapter',\n        displayName: 'BED tabix adapter',\n        configSchema,\n        getAdapterClass: () => import('./BedTabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BedGraphAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedGraphAdapter',\n        displayName: 'BedGraph adapter',\n        configSchema,\n        getAdapterClass: () => import('./BedGraphAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BedGraphTabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedGraphTabixAdapter',\n        displayName: 'BedGraphTabix adapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./BedGraphTabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { testAdapter } from '@jbrowse/core/util'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n} from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessAdapterF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n        if (\n          testAdapter(fileName, /\\.bedpe(\\.gz)?$/i, adapterHint, 'BedpeAdapter')\n        ) {\n          return {\n            type: 'BedpeAdapter',\n            bedpeLocation: file,\n          }\n        } else if (\n          testAdapter(fileName, /\\.bb$/i, adapterHint, 'BigBedAdapter') ||\n          testAdapter(fileName, /\\.bigBed?$/i, adapterHint, 'BigBedAdapter')\n        ) {\n          return {\n            type: 'BigBedAdapter',\n            bigBedLocation: file,\n          }\n        } else if (\n          testAdapter(fileName, /\\.bed$/i, adapterHint, 'BedAdapter')\n        ) {\n          return {\n            type: 'BedAdapter',\n            bedLocation: file,\n          }\n        } else if (\n          testAdapter(fileName, /\\.bg$/i, adapterHint, 'BedGraphAdapter')\n        ) {\n          return {\n            type: 'BedGraphAdapter',\n            bedGraphLocation: file,\n          }\n        } else if (\n          testAdapter(\n            fileName,\n            /\\.bg(\\.gz)?$/i,\n            adapterHint,\n            'BedGraphTabixAdapter',\n          )\n        ) {\n          return {\n            type: 'BedGraphTabixAdapter',\n            bedGraphGzLocation: file,\n            index: {\n              location: index || makeIndex(file, '.tbi'),\n              indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n            },\n          }\n        } else if (\n          testAdapter(fileName, /\\.bed\\.gz$/i, adapterHint, 'BedTabixAdapter')\n        ) {\n          return {\n            type: 'BedTabixAdapter',\n            bedGzLocation: file,\n            index: {\n              location: index || makeIndex(file, '.tbi'),\n              indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n            },\n          }\n        } else {\n          return adapterGuesser(file, index, adapterHint)\n        }\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => (adapterName: string) => {\n      return (\n        {\n          BedpeAdapter: 'VariantTrack',\n          BedGraphAdapter: 'QuantitativeTrack',\n          BedGraphTabixAdapter: 'QuantitativeTrack',\n        }[adapterName] || trackTypeGuesser(adapterName)\n      )\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('BreakpointAlignmentsWidget', {})\n\nconst stateModel = types\n  .model('BreakpointAlignmentsWidget', {\n    id: ElementId,\n    type: types.literal('BreakpointAlignmentsWidget'),\n    featureData: types.frozen(),\n  })\n  .actions(self => ({\n    setFeatureData(data: unknown) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = undefined\n    },\n  }))\n\nexport default function BreakpointAlignmentsFeatureDetailF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'BreakpointAlignmentsWidget',\n      heading: 'Breakpoint feature details',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./BreakpointAlignmentsFeatureDetail')),\n    })\n  })\n}\n","const startClip = new RegExp(/(\\d+)[SH]$/)\nconst endClip = new RegExp(/^(\\d+)([SH])/)\n\nexport function getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(startClip.exec(cigar) || [])[1]! || 0\n    : +(endClip.exec(cigar) || [])[1]! || 0\n}\n","import { lazy } from 'react'\n\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession, notEmpty } from '@jbrowse/core/util'\nimport LinkIcon from '@mui/icons-material/Link'\nimport PhotoCamera from '@mui/icons-material/PhotoCamera'\nimport { saveAs } from 'file-saver'\nimport { autorun } from 'mobx'\nimport { addDisposer, getPath, onAction, types } from 'mobx-state-tree'\n\nimport { getClip } from './getClip'\nimport { calc, getBlockFeatures, intersect } from './util'\n\nimport type { ExportSvgOptions } from './types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\n\n/**\n * #stateModel BreakpointSplitView\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  const defaultHeight = 400\n  return types\n    .compose(\n      'BreakpointSplitView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('BreakpointSplitView'),\n        /**\n         * #property\n         */\n        height: types.optional(types.number, defaultHeight),\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        showIntraviewLinks: true,\n        /**\n         * #property\n         */\n        linkViews: false,\n        /**\n         * #property\n         */\n        interactiveOverlay: true,\n        /**\n         * #property\n         */\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')!\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      width: 800,\n      /**\n       * #volatile\n       */\n      matchedTrackFeatures: {} as Record<string, Feature[][]>,\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import(\n          './svgcomponents/SVGBreakpointSplitView'\n        )\n        const html = await renderToSvg(self as BreakpointViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * Find all track ids that match across multiple views, or return just\n       * the single view's track if only a single row is used\n       */\n      get matchedTracks() {\n        return self.views.length === 1\n          ? self.views[0]!.tracks\n          : intersect(\n              elt => elt.configuration.trackId,\n              ...self.views.map(\n                view => view.tracks as { configuration: { trackId: string } }[],\n              ),\n            )\n      },\n\n      /**\n       * #method\n       * Get tracks with a given trackId across multiple views\n       */\n      getMatchedTracks(trackConfigId: string) {\n        return self.views\n          .map(view => view.getTrack(trackConfigId))\n          .filter(f => !!f)\n      },\n\n      /**\n       * #method\n       * Translocation features are handled differently since they do not have\n       * a mate e.g. they are one sided\n       */\n      hasTranslocations(trackConfigId: string) {\n        return [...this.getTrackFeatures(trackConfigId).values()].find(\n          f => f.get('type') === 'translocation',\n        )\n      },\n\n      /**\n       * #method\n       * Paired features similar to breakends, but simpler, like BEDPE\n       */\n      hasPairedFeatures(trackConfigId: string) {\n        return [...this.getTrackFeatures(trackConfigId).values()].find(\n          f => f.get('type') === 'paired_feature',\n        )\n      },\n\n      /**\n       * #method\n       * Get a composite map of featureId-\\>feature map for a track across\n       * multiple views\n       */\n      getTrackFeatures(trackConfigId: string) {\n        return new Map(\n          self.matchedTrackFeatures[trackConfigId]\n            ?.flat()\n            .map(f => [f.id(), f] as const),\n        )\n      },\n\n      /**\n       * #method\n       */\n      getMatchedFeaturesInLayout(trackConfigId: string, features: Feature[][]) {\n        // use reverse to search the second track first\n        const tracks = this.getMatchedTracks(trackConfigId)\n        return features.map(c =>\n          c\n            .map(feature => {\n              const level = tracks.findIndex(track => calc(track, feature))\n              return level !== -1\n                ? {\n                    feature,\n                    layout: calc(tracks[level], feature),\n                    level,\n                    clipPos: getClip(\n                      feature.get('CIGAR'),\n                      feature.get('strand'),\n                    ),\n                  }\n                : undefined\n            })\n            .filter(notEmpty),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(\n            self,\n            ({\n              name,\n              path,\n              args,\n            }: {\n              name: string\n              path?: string\n              args?: unknown[]\n            }) => {\n              if (self.linkViews) {\n                const actions = [\n                  'horizontalScroll',\n                  'zoomTo',\n                  'setScaleFactor',\n                  'showTrack',\n                  'toggleTrack',\n                  'hideTrack',\n                  'setTrackLabels',\n                  'toggleCenterLine',\n                ]\n                if (actions.includes(name) && path) {\n                  this.onSubviewAction(name, path, args)\n                }\n              }\n            },\n          ),\n        )\n      },\n\n      onSubviewAction(actionName: string, path: string, args?: unknown[]) {\n        for (const view of self.views) {\n          const ret = getPath(view)\n          if (!ret.endsWith(path)) {\n            // @ts-ignore\n            view[actionName](args?.[0])\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        for (const v of self.views) {\n          v.setWidth(newWidth)\n        }\n      },\n\n      /**\n       * #action\n       */\n      setInteractiveOverlay(arg: boolean) {\n        self.interactiveOverlay = arg\n      },\n\n      /**\n       * #action\n       */\n      setShowIntraviewLinks(arg: boolean) {\n        self.showIntraviewLinks = arg\n      },\n\n      /**\n       * #action\n       */\n      setLinkViews(arg: boolean) {\n        self.linkViews = arg\n      },\n\n      /**\n       * #action\n       */\n      setMatchedTrackFeatures(obj: Record<string, Feature[][]>) {\n        self.matchedTrackFeatures = obj\n      },\n      /**\n       * #action\n       */\n      reverseViewOrder() {\n        self.views.reverse()\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(async () => {\n            try {\n              // check all views 'initialized'\n              if (!self.views.every(view => view.initialized)) {\n                return\n              }\n              // check that tracks are 'ready' (not notReady)\n              if (\n                self.matchedTracks.some(track => track.displays[0].notReady?.())\n              ) {\n                return\n              }\n\n              self.setMatchedTrackFeatures(\n                Object.fromEntries(\n                  await Promise.all(\n                    self.matchedTracks.map(async track => [\n                      track.configuration.trackId,\n                      await getBlockFeatures(self, track),\n                    ]),\n                  ),\n                ),\n              )\n            } catch (e) {\n              console.error(e)\n              getSession(self).notifyError(`${e}`, e)\n            }\n          }),\n        )\n      },\n\n      /**\n       * #method\n       */\n      menuItems() {\n        return [\n          ...self.views\n            .map((view, idx) => [idx, view.menuItems()] as const)\n            .map(f => ({\n              label: `Row ${f[0] + 1} view menu`,\n              subMenu: f[1],\n            })),\n\n          ...(self.views.length > 1\n            ? [\n                {\n                  label: 'Reverse view order',\n                  onClick: () => {\n                    self.reverseViewOrder()\n                  },\n                },\n              ]\n            : []),\n          {\n            label: 'Show intra-view links',\n            type: 'checkbox',\n            checked: self.showIntraviewLinks,\n            onClick: () => {\n              self.setShowIntraviewLinks(!self.showIntraviewLinks)\n            },\n          },\n          {\n            label: 'Allow clicking alignment squiggles?',\n            type: 'checkbox',\n            checked: self.interactiveOverlay,\n            onClick: () => {\n              self.setInteractiveOverlay(!self.interactiveOverlay)\n            },\n          },\n          {\n            label: 'Link views',\n            type: 'checkbox',\n            icon: LinkIcon,\n            checked: self.linkViews,\n            onClick: () => {\n              self.setLinkViews(!self.linkViews)\n            },\n          },\n          {\n            label: 'Export SVG',\n            icon: PhotoCamera,\n            onClick: (): void => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                {\n                  model: self,\n                  handleClose,\n                },\n              ])\n            },\n          },\n        ]\n      },\n    }))\n}\n\nexport type BreakpointViewStateModel = ReturnType<typeof stateModelFactory>\nexport type BreakpointViewModel = Instance<BreakpointViewStateModel>\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport BreakpointAlignmentsWidgetF from './BreakpointAlignmentsFeatureDetail'\nimport BreakpointSplitViewF from './BreakpointSplitView'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class BreakpointSplitViewPlugin extends Plugin {\n  name = 'BreakpointSplitViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    BreakpointSplitViewF(pluginManager)\n    BreakpointAlignmentsWidgetF(pluginManager)\n  }\n\n  configure() {}\n}\n","import { lazy } from 'react'\n\nimport { ViewType } from '@jbrowse/core/pluggableElementTypes'\n\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BreakpointSplitViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'BreakpointSplitView',\n      displayName: 'Breakpoint split view',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/BreakpointSplitView')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BlastTabularAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BlastTabularAdapter = ConfigurationSchema(\n  'BlastTabularAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Query assembly is the first value in the array, target assembly is the second',\n    },\n\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    /**\n     * #slot\n     */\n    blastTableLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/blastTable.tsv',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    columns: {\n      type: 'string',\n      description:\n        'Optional space-separated column name list. If custom columns were used in outfmt, enter them here exactly as specified in the command. At least qseqid, sseqid, qstart, qend, sstart, and send are required',\n      defaultValue:\n        'qseqid sseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default BlastTabularAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config ChainAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ChainAdapter = ConfigurationSchema(\n  'ChainAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second',\n    },\n    /**\n     * #slot\n     * can be specified as alternative to assemblyNames\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    /**\n     * #slot\n     * can be specified as alternative to assemblyNames\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    /**\n     * #slot\n     */\n    chainLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.chain', locationType: 'UriLocation' },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"ChainAdapter\",\n     *   \"uri\": \"yourfile.chain.gz\",\n     *   \"queryAssembly\": \"hg19\",\n     *   \"targetAssembly\": \"hg38\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            chainLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default ChainAdapter\n","export const syntenyTypes = [\n  'PAFAdapter',\n  'ChainAdapter',\n  'DeltaAdapter',\n  'BlastTabularAdapter',\n  'MashMapAdapter',\n  'MCScanAnchorsAdapter',\n  'MCScanSimpleAnchorsAdapter',\n  'PairwiseIndexedPAFAdapter',\n]\n\nexport const pairwiseTypes = [\n  'PAFAdapter',\n  'ChainAdapter',\n  'DeltaAdapter',\n  'MashMapAdapter',\n  'BlastTabularAdapter',\n  'PairwiseIndexedPAFAdapter',\n]\n\nexport const mcscanTypes = [\n  'MCScanAnchorsAdapter',\n  'MCScanSimpleAnchorsAdapter',\n]\n","import { lazy } from 'react'\n\nimport { pairwiseTypes } from '../syntenyTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n// lazies\nconst ComparativeAddTrackComponent = lazy(\n  () => import('./ComparativeAddTrackComponent'),\n)\n\nexport default function ComparativeAddTrackComponentF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addToExtensionPoint(\n    'Core-addTrackComponent',\n    // @ts-expect-error\n    (comp, { model }: { trackAdapterType: string }) => {\n      return pairwiseTypes.includes(model.trackAdapterType)\n        ? ComparativeAddTrackComponent\n        : comp\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config DeltaAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DeltaAdapter = ConfigurationSchema(\n  'DeltaAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second',\n    },\n    /**\n     * #slot\n     * alternative to assembly names\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     * alternative to assembly names\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    deltaLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.delta',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"DeltaAdapter\",\n     *   \"uri\": \"yourfile.delta.gz\",\n     *   \"queryAssembly\": \"hg19\",\n     *   \"targetAssembly\": \"hg38\"\n     * }\n     * ```\n     */\n\n    preProcessSnapshot: snap => {\n      return snap.uri\n        ? {\n            ...snap,\n            deltaLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default DeltaAdapter\n","import { lazy } from 'react'\n\nimport { mcscanTypes } from '../syntenyTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n// lazies\nconst MCScanAddTrackComponent = lazy(() => import('./MCScanAddTrackComponent'))\n\nexport default function MCScanAddTrackComponentF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-addTrackComponent',\n    // @ts-expect-error\n    (comp, { model }: { trackAdapterType: string }) => {\n      return mcscanTypes.includes(model.trackAdapterType)\n        ? MCScanAddTrackComponent\n        : comp\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MCScanAnchorsAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MCScanAnchorsAdapter = ConfigurationSchema(\n  'MCScanAnchorsAdapter',\n  {\n    /**\n     * #slot\n     */\n    mcscanAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"MCScanAnchorsAdapter\",\n     *   \"uri\": \"file.anchors\",\n     *   \"bed1\": \"bed1.bed\",\n     *   \"bed2\": \"bed2.bed\",\n     *   \"assemblyNames\": [\"hg19\", \"hg38\"],\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      return snap.uri && snap.bed1 && snap.bed2\n        ? {\n            ...snap,\n            mcscanAnchorsLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            bed1Location: {\n              uri: snap.bed1,\n              baseUri: snap.baseUri,\n            },\n            bed2Location: {\n              uri: snap.bed2,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default MCScanAnchorsAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MCScanSimpleAnchorsAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MCScanSimpleAnchorsAdapter = ConfigurationSchema(\n  'MCScanSimpleAnchorsAdapter',\n  {\n    /**\n     * #slot\n     */\n    mcscanSimpleAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors.simple',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"MCScanSimpleAnchorsAdapter\",\n     *   \"uri\": \"file.anchors\",\n     *   \"bed1\": \"bed1.bed\",\n     *   \"bed2\": \"bed2.bed\",\n     *   \"assemblyNames\": [\"hg19\", \"hg38\"],\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      return snap.uri && snap.bed1 && snap.bed2\n        ? {\n            ...snap,\n            mcscanSimpleAnchorsLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            bed1Location: {\n              uri: snap.bed1,\n              baseUri: snap.baseUri,\n            },\n            bed2Location: {\n              uri: snap.bed2,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default MCScanSimpleAnchorsAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MashMapAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MashMapAdapter = ConfigurationSchema(\n  'MashMapAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second',\n    },\n\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    /**\n     * #slot\n     */\n    outLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mashmap.out',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"MashMapAdapter\",\n     *   \"uri\": \"file.out\",\n     *   \"queryAssembly\":\"hg19\",\n     *   \"targetAssembly\":\"hg38\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            outLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default MashMapAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config PAFAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PAFAdapter = ConfigurationSchema(\n  'PAFAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second',\n    },\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    pafLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.paf',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"PAFAdapter\",\n     *   \"uri\": \"file.paf.gz\",\n     *   \"queryAssembly\":\"hg19\",\n     *   \"targetAssembly\":\"hg38\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            pafLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default PAFAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config PairwiseIndexedPAFAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PairwiseIndexedPAFAdapter = ConfigurationSchema(\n  'PairwiseIndexedPAFAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second',\n    },\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    pifGzLocation: {\n      type: 'fileLocation',\n      description: 'location of pairwise tabix indexed PAF (pif)',\n      defaultValue: {\n        uri: '/path/to/data/file.pif.gz',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    index: ConfigurationSchema('TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.paf.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes file.pif.gz.tbi:\n     * ```json\n     * {\n     *   \"type\": \"PairwiseIndexedPAFAdapter\",\n     *   \"uri\": \"file.pif.gz\",\n     *   \"queryAssembly\": \"hg19\",\n     *   \"targetAssembly\": \"hg38\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            pifGzLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            index: {\n              location: {\n                uri: `${snap.uri}.tbi`,\n                baseUri: snap.baseUri,\n              },\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default PairwiseIndexedPAFAdapter\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport BlastTabularAdapter from './BlastTabularAdapter'\nimport ChainAdapterF from './ChainAdapter'\nimport ComparativeAddTrackComponentF from './ComparativeAddTrackComponent'\nimport DeltaAdapterF from './DeltaAdapter'\nimport GuessAdapterF from './GuessAdapter'\nimport MCScanAddTrackComponentF from './MCScanAddTrackComponent'\nimport MCScanAnchorsAdapterF from './MCScanAnchorsAdapter'\nimport MCScanSimpleAnchorsAdapterF from './MCScanSimpleAnchorsAdapter'\nimport MashMapAdapterF from './MashMapAdapter'\nimport PAFAdapterF from './PAFAdapter'\nimport PairwiseIndexedPAFAdapterF from './PairwiseIndexedPAFAdapter'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class ComparativeAdaptersPlugin extends Plugin {\n  name = 'ComparativeAdaptersPlugin'\n\n  install(pluginManager: PluginManager) {\n    PAFAdapterF(pluginManager)\n    PairwiseIndexedPAFAdapterF(pluginManager)\n    DeltaAdapterF(pluginManager)\n    ChainAdapterF(pluginManager)\n    MCScanAnchorsAdapterF(pluginManager)\n    MCScanSimpleAnchorsAdapterF(pluginManager)\n    MashMapAdapterF(pluginManager)\n    BlastTabularAdapter(pluginManager)\n    ComparativeAddTrackComponentF(pluginManager)\n    MCScanAddTrackComponentF(pluginManager)\n    GuessAdapterF(pluginManager)\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function PAFAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'PAFAdapter',\n        displayName: 'PAF adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n        getAdapterClass: () => import('./PAFAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function PairwiseIndexedPAFAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'PairwiseIndexedPAFAdapter',\n        displayName: 'Pairwise indexed PAF adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n        getAdapterClass: () =>\n          import('./PairwiseIndexedPAFAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function DeltaAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'DeltaAdapter',\n        displayName: 'MUMmer delta adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n        getAdapterClass: () => import('./DeltaAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function ChainAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'ChainAdapter',\n        displayName: 'Liftover chain adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n        getAdapterClass: () => import('./ChainAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MCScanAnchorsAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanAnchorsAdapter',\n        displayName: 'MCScan anchors adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n\n        getAdapterClass: () =>\n          import('./MCScanAnchorsAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MCScanSimpleAnchorsAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanSimpleAnchorsAdapter',\n        displayName: 'MCScan anchors.simple adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n        getAdapterClass: () =>\n          import('./MCScanSimpleAnchorsAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MashMapAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MashMapAdapter',\n        displayName: 'MashMap adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n        getAdapterClass: () => import('./MashMapAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BlastTabularAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BlastTabularAdapter',\n        displayName: 'Tabular BLAST output adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Synteny adapters',\n        },\n        getAdapterClass: () =>\n          import('./BlastTabularAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { testAdapter } from '@jbrowse/core/util'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n} from '@jbrowse/core/util/tracks'\n\nimport { syntenyTypes } from '../syntenyTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessAdapterF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n        if (testAdapter(fileName, /\\.paf(.gz)?/i, adapterHint, 'PAFAdapter')) {\n          return {\n            type: 'PAFAdapter',\n            pafLocation: file,\n          }\n        } else if (adapterHint === 'BlastTabularAdapter') {\n          return {\n            type: 'BlastTabularAdapter',\n            blastTableLocation: file,\n          }\n        } else if (\n          testAdapter(\n            fileName,\n            /\\.anchors.simple(.gz)?/i,\n            adapterHint,\n            'MCScanSimpleAnchorsAdapter',\n          )\n        ) {\n          return {\n            type: 'MCScanSimpleAnchorsAdapter',\n            mcscanSimpleAnchorsLocation: file,\n          }\n        } else if (\n          testAdapter(\n            fileName,\n            /\\.anchors(.gz)?/i,\n            adapterHint,\n            'MCScanAnchorsAdapter',\n          )\n        ) {\n          return {\n            type: 'MCScanAnchorsAdapter',\n            mcscanAnchorsLocation: file,\n          }\n        } else if (\n          testAdapter(fileName, /\\.delta(.gz)?/i, adapterHint, 'DeltaAdapter')\n        ) {\n          return {\n            type: 'DeltaAdapter',\n            deltaLocation: file,\n          }\n        } else if (\n          testAdapter(fileName, /\\.chain(.gz)?/i, adapterHint, 'ChainAdapter')\n        ) {\n          return {\n            type: 'ChainAdapter',\n            chainLocation: file,\n          }\n        } else if (\n          testAdapter(fileName, /\\.out(.gz)?/i, adapterHint, 'MashMapAdapter')\n        ) {\n          return {\n            type: 'MashMapAdapter',\n            outLocation: file,\n          }\n        } else if (\n          testAdapter(\n            fileName,\n            /\\.pif\\.gz/i,\n            adapterHint,\n            'PairwiseIndexedPAFAdapter',\n          )\n        ) {\n          return {\n            type: 'PairwiseIndexedPAFAdapter',\n            pifGzLocation: file,\n            index: {\n              location: index || makeIndex(file, '.tbi'),\n              indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n            },\n          }\n        } else {\n          return adapterGuesser(file, index, adapterHint)\n        }\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) =>\n        syntenyTypes.includes(adapterName)\n          ? 'SyntenyTrack'\n          : trackTypeGuesser(adapterName)\n    },\n  )\n}\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { checkStopToken } from '@jbrowse/core/util/stopToken'\n\nimport type {\n  RenderArgs as ComparativeRenderArgs,\n  RenderArgsSerialized as ComparativeRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport type ComparativeRenderer from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\n\ninterface RenderArgs extends ComparativeRenderArgs {\n  adapterConfig: Record<string, unknown>\n  rendererType: string\n}\n\ninterface RenderArgsSerialized extends ComparativeRenderArgsSerialized {\n  adapterConfig: Record<string, unknown>\n  rendererType: string\n}\n\nexport default class ComparativeRender extends RpcMethodType {\n  name = 'ComparativeRender'\n\n  async renameRegionsIfNeeded(args: RenderArgs, rend: ComparativeRenderer) {\n    return rend.renameRegionsIfNeeded(args)\n  }\n\n  getRenderer(rendererType: string) {\n    const pm = this.pluginManager\n    return pm.getRendererType(rendererType) as ComparativeRenderer\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rendererType } = args\n    const renderer = this.getRenderer(rendererType)\n    const n = (await super.serializeArguments(args, rpcDriver)) as RenderArgs\n    const result = await this.renameRegionsIfNeeded(n, renderer)\n\n    return rpcDriver === 'MainThreadRpcDriver'\n      ? result\n      : renderer.serializeArgsInClient(result)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { stopToken?: string },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { sessionId, rendererType, stopToken } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkStopToken(stopToken)\n\n    const renderer = this.getRenderer(rendererType)\n    return rpcDriver === 'MainThreadRpcDriver'\n      ? renderer.render(deserializedArgs)\n      : renderer.renderInWorker(deserializedArgs)\n  }\n\n  async deserializeReturn(\n    val: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriver: string,\n  ): Promise<unknown> {\n    const ret = (await super.deserializeReturn(\n      val,\n      args,\n      rpcDriver,\n    )) as ResultsSerialized\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return ret\n    }\n\n    const renderer = this.getRenderer(args.rendererType)\n    return renderer.deserializeResultsInClient(ret, args)\n  }\n}\n","import { getContainingView } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { DotplotViewModel } from '../../DotplotView/model'\nimport type { DotplotDisplayModel } from '../stateModelFactory'\n\nconst DotplotDisplay = observer(function DotplotDisplay(props: {\n  model: DotplotDisplayModel\n  children?: React.ReactNode\n}) {\n  const { model, children } = props\n  const { offsetX = 0, offsetY = 0 } = model.data || {}\n  const view = getContainingView(model) as DotplotViewModel\n\n  const top = view.vview.offsetPx - offsetY\n  const left = -(view.hview.offsetPx - offsetX)\n  return (\n    <div style={{ position: 'relative' }}>\n      <model.ReactComponent2\n        {...props}\n        style={{\n          position: 'absolute',\n          top,\n          left,\n        }}\n      />\n      {children}\n    </div>\n  )\n})\n\nexport default DotplotDisplay\n","import type { CSSProperties } from 'react'\nimport { useEffect, useState } from 'react'\n\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { Typography } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()(theme => {\n  const bg = theme.palette.action.disabledBackground\n  return {\n    loading: {\n      paddingLeft: '0.6em',\n      backgroundColor: theme.palette.background.default,\n      backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 5px, ${bg} 5px, ${bg} 10px)`,\n      textAlign: 'center',\n    },\n\n    blockMessage: {\n      backgroundColor: bg,\n      padding: '10px',\n    },\n    blockError: {\n      backgroundColor: bg,\n      padding: '10px',\n      color: 'red',\n    },\n  }\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const { classes } = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      setShown(true)\n    }, 300)\n    return () => {\n      clearTimeout(timeout)\n    }\n  }, [])\n\n  return shown ? (\n    <div className={classes.loading}>\n      <LoadingEllipses />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.blockMessage}>\n      <Typography>{messageText}</Typography>\n    </div>\n  )\n}\n\nfunction BlockError({ error }: { error: unknown }) {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.blockError}>\n      <Typography>{`${error}`}</Typography>\n    </div>\n  )\n}\n\nconst ServerSideRenderedDotplotContent = observer(function ({\n  model,\n  style,\n}: {\n  model: {\n    error?: unknown\n    message?: string\n    filled?: boolean\n    shouldDisplay?: boolean\n    reactElement?: React.ReactElement\n  }\n  style: CSSProperties\n}) {\n  if (model.error) {\n    return <BlockError error={model.error} data-testid=\"reload_button\" />\n  } else if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  } else if (!model.filled) {\n    return <LoadingMessage />\n  } else if (model.shouldDisplay) {\n    return <div style={style}>{model.reactElement}</div>\n  }\n  return null\n})\n\nexport default ServerSideRenderedDotplotContent\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getSnapshot } from 'mobx-state-tree'\n\nimport type { DotplotViewModel } from '../DotplotView/model'\nimport type { IAnyStateTreeNode } from 'mobx-state-tree'\n\nexport function renderBlockData(self: IAnyStateTreeNode) {\n  const { rpcManager } = getSession(self)\n  const { rendererType } = self\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as DotplotViewModel\n\n  // Alternative to readConfObject(config) is below used because renderProps is\n  // something under our control.  Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n  getSnapshot(parent)\n\n  if (parent.initialized) {\n    const { viewWidth, viewHeight, borderSize, borderX, borderY } = parent\n    return {\n      rendererType,\n      rpcManager,\n      renderProps: {\n        ...self.renderProps(),\n        view: structuredClone(getSnapshot(parent)),\n        width: viewWidth,\n        height: viewHeight,\n        borderSize,\n        borderX,\n        borderY,\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId: getRpcSessionId(self),\n        timeout: 1000000, // 10000,\n      },\n    }\n  }\n  return undefined\n}\n\nexport async function renderBlockEffect(\n  props?: ReturnType<typeof renderBlockData>,\n) {\n  if (!props) {\n    return\n  }\n\n  const { rendererType, rpcManager, renderProps } = props\n  const { reactElement, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderProps,\n  )\n  return {\n    reactElement,\n    data,\n    renderingComponent: rendererType.ReactComponent,\n  }\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  ReactRendering,\n  getContainingView,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\n\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\nimport { renderBlockData, renderBlockEffect } from './renderDotplotBlock'\n\nimport type { DotplotViewModel, ExportSvgOptions } from '../DotplotView/model'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { ThemeOptions } from '@mui/material'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel DotplotDisplay\n * #category display\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'DotplotDisplay',\n      BaseDisplay,\n      types\n        .model({\n          /**\n           * #property\n           */\n          type: types.literal('DotplotDisplay'),\n          /**\n           * #property\n           */\n          configuration: ConfigurationReference(configSchema),\n        })\n        .volatile(() => ({\n          /**\n           * #volatile\n           */\n          stopToken: undefined as string | undefined,\n          /**\n           * #volatile\n           */\n          warnings: [] as { message: string; effect: string }[],\n          /**\n           * #volatile\n           */\n          filled: false,\n          /**\n           * #volatile\n           */\n          data: undefined as any,\n          /**\n           * #volatile\n           */\n          reactElement: undefined as React.ReactElement | undefined,\n          /**\n           * #volatile\n           */\n          message: undefined as string | undefined,\n          /**\n           * #volatile\n           */\n          renderingComponent: undefined as any,\n          /**\n           * #volatile\n           */\n          ReactComponent2:\n            ServerSideRenderedBlockContent as unknown as React.FC<any>,\n        })),\n    )\n    .views(self => ({\n      get shouldDisplay() {\n        const { vview, hview } = getContainingView(self) as DotplotViewModel\n        return (\n          vview.bpPerPx === self.data.bpPerPxY &&\n          hview.bpPerPx === self.data.bpPerPxX\n        )\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: self.configuration.renderer,\n        }\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      async renderSvg(opts: ExportSvgOptions & { theme?: ThemeOptions }) {\n        const props = renderBlockData(self)\n        if (!props) {\n          return null\n        }\n\n        const { rendererType, rpcManager, renderProps } = props\n        const rendering = await rendererType.renderInClient(rpcManager, {\n          ...renderProps,\n          exportSVG: opts,\n          theme: opts.theme || renderProps.theme,\n        })\n        const { hview, vview } = getContainingView(self) as DotplotViewModel\n        const offX = -hview.offsetPx + rendering.offsetX\n        const offY = -vview.offsetPx + rendering.offsetY\n        return (\n          <g transform={`translate(${offX} ${-offY})`}>\n            <ReactRendering rendering={rendering} />\n          </g>\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        makeAbortableReaction(\n          self,\n          () => renderBlockData(self),\n          blockData => renderBlockEffect(blockData),\n          {\n            name: `${self.type} ${self.id} rendering`,\n            delay: 500,\n            fireImmediately: true,\n          },\n          this.setLoading,\n          this.setRendered,\n          this.setError,\n        )\n      },\n      /**\n       * #action\n       */\n      setLoading(stopToken?: string) {\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.data = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n        self.stopToken = stopToken\n      },\n      /**\n       * #action\n       */\n      setMessage(messageText: string) {\n        self.filled = false\n        self.message = messageText\n        self.reactElement = undefined\n        self.data = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n        self.stopToken = undefined\n      },\n      /**\n       * #action\n       */\n      setRendered(args?: {\n        data: any\n        reactElement: React.ReactElement\n        renderingComponent: React.Component\n      }) {\n        if (args === undefined) {\n          return\n        }\n        const { data, reactElement, renderingComponent } = args\n        self.warnings = data.warnings\n        self.filled = true\n        self.message = undefined\n        self.reactElement = reactElement\n        self.data = data\n        self.error = undefined\n        self.renderingComponent = renderingComponent\n        self.stopToken = undefined\n      },\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        console.error(error)\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.data = undefined\n        self.error = error\n        self.renderingComponent = undefined\n        self.stopToken = undefined\n      },\n    }))\n}\n\nexport type DotplotDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotDisplayModel = Instance<DotplotDisplayStateModel>\n","import { getConf } from '@jbrowse/core/configuration'\nimport { gatherOverlaps, getSession, sum } from '@jbrowse/core/util'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\n\nimport type { ReducedFeature } from '../util'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { LinearPileupDisplayModel } from '@jbrowse/plugin-alignments'\n\nconst { featurizeSA, getClip, getLength, getLengthSansClipping } =\n  MismatchParser\n\nexport function onClick(feature: Feature, self: LinearPileupDisplayModel) {\n  const session = getSession(self)\n  try {\n    const cigar = feature.get('CIGAR')\n    const clipPos = getClip(cigar, 1)\n    const flags = feature.get('flags')\n    const strand = feature.get('strand')\n    const readName = feature.get('name')\n    const readAssembly = `${readName}_assembly_${Date.now()}`\n    const { parentTrack } = self\n    const [trackAssembly] = getConf(parentTrack, 'assemblyNames')\n    const assemblyNames = [trackAssembly, readAssembly]\n    const trackId = `track-${Date.now()}`\n    const trackName = `${readName}_vs_${trackAssembly}`\n    const SA = feature.get('tags')?.SA as string\n    const SA2 = featurizeSA(SA, feature.id(), strand, readName, true)\n\n    // if secondary alignment or supplementary, calculate length from SA[0]'s\n    // CIGAR which is the primary alignments. otherwise it is the primary\n    // alignment just use seq.length if primary alignment\n    const totalLength = getLength(flags & 2048 ? SA2[0]!.CIGAR : cigar)\n\n    const features = (\n      [\n        {\n          ...feature.toJSON(),\n          strand: 1,\n          mate: {\n            refName: readName,\n            start: clipPos,\n            end: clipPos + getLengthSansClipping(cigar),\n          },\n        },\n        ...SA2,\n      ] as ReducedFeature[]\n    ).sort((a, b) => a.clipPos - b.clipPos)\n\n    session.addView('DotplotView', {\n      type: 'DotplotView',\n      hview: {\n        offsetPx: 0,\n        bpPerPx: sum(features.map(a => a.end - a.start)) / 800,\n        displayedRegions: gatherOverlaps(\n          features.map((f, index) => {\n            const { start, end, refName } = f\n            return {\n              start,\n              end,\n              refName,\n              index,\n              assemblyName: trackAssembly,\n            }\n          }),\n        ),\n      },\n      vview: {\n        offsetPx: 0,\n        bpPerPx: totalLength / 400,\n        minimumBlockWidth: 0,\n        interRegionPaddingWidth: 0,\n        displayedRegions: [\n          {\n            assemblyName: readAssembly,\n            start: 0,\n            end: totalLength,\n            refName: readName,\n          },\n        ],\n      },\n\n      viewTrackConfigs: [\n        {\n          type: 'SyntenyTrack',\n          assemblyNames,\n          adapter: {\n            type: 'FromConfigAdapter',\n            features,\n          },\n          trackId,\n          name: trackName,\n        },\n      ],\n      assemblyNames,\n      tracks: [\n        {\n          configuration: trackId,\n          type: 'SyntenyTrack',\n          displays: [\n            {\n              type: 'DotplotDisplay',\n              configuration: `${trackId}-DotplotDisplay`,\n            },\n          ],\n        },\n      ],\n\n      displayName: `${readName} vs ${trackAssembly}`,\n    })\n  } catch (e) {\n    console.error(e)\n    session.notifyError(`${e}`, e)\n  }\n}\n","import Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport { observable } from 'mobx'\nimport { getParent } from 'mobx-state-tree'\n\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel Dotplot1DView\n * ref https://mobx-state-tree.js.org/concepts/volatiles on volatile state used here\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Dotplot1DView = Base1DView.extend(self => {\n  const scaleFactor = observable.box(1)\n  return {\n    views: {\n      /**\n       * #getter\n       * this uses padding=false and elision=false\n       */\n      get dynamicBlocks() {\n        return calculateDynamicBlocks(self, false, false)\n      },\n      /**\n       * #getter\n       */\n\n      get scaleFactor() {\n        return scaleFactor.get()\n      },\n\n      /**\n       * #getter\n       */\n      get maxBpPerPx() {\n        return self.totalBp / (self.width - 50)\n      },\n\n      /**\n       * #getter\n       */\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      /**\n       * #getter\n       */\n      get maxOffset() {\n        return self.displayedRegionsTotalPx - self.width * 0.2\n      },\n\n      /**\n       * #getter\n       */\n      get minOffset() {\n        return -self.width * 0.8\n      },\n    },\n    actions: {\n      /**\n       * #action\n       */\n      setScaleFactor(n: number) {\n        scaleFactor.set(n)\n      },\n\n      /**\n       * #action\n       */\n      center() {\n        const centerBp = self.totalBp / 2\n        const centerPx = centerBp / self.bpPerPx\n        self.scrollTo(centerPx - self.width / 2)\n      },\n    },\n  }\n})\n\nconst DotplotHView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent<any>(self).viewWidth\n    },\n  },\n}))\n\nconst DotplotVView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent<any>(self).viewHeight\n    },\n  },\n}))\n\nexport { Dotplot1DView, DotplotHView, DotplotVView }\nexport type Dotplot1DViewModel = Instance<typeof Dotplot1DView>\n","import type React from 'react'\nimport { lazy } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  getSession,\n  getTickDisplayStr,\n  isSessionModelWithWidgets,\n  localStorageGetBoolean,\n  localStorageGetItem,\n  max,\n  measureText,\n  minmax,\n} from '@jbrowse/core/util'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\nimport { saveAs } from 'file-saver'\nimport { autorun, observable, transaction } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  getRoot,\n  getSnapshot,\n  resolveIdentifier,\n  types,\n} from 'mobx-state-tree'\n\nimport { Dotplot1DView, DotplotHView, DotplotVView } from './1dview'\nimport { getBlockLabelKeysToHide, makeTicks } from './components/util'\n\nimport type { ImportFormSyntenyTrack } from './types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BaseTrackStateModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport type { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport type { Instance, SnapshotIn } from 'mobx-state-tree'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\nconst ReturnToImportFormDialog = lazy(\n  () => import('@jbrowse/core/ui/ReturnToImportFormDialog'),\n)\ntype Coord = [number, number]\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n  Wrapper?: React.FC<{ children: React.ReactNode }>\n  themeName?: string\n}\n\nfunction stringLenPx(a: string) {\n  return measureText(a.slice(0, 30))\n}\n\nfunction pxWidthForBlocks(\n  blocks: BaseBlock[],\n  bpPerPx: number,\n  hide: Set<string>,\n) {\n  return max([\n    ...blocks.filter(b => !hide.has(b.key)).map(b => stringLenPx(b.refName)),\n    ...blocks\n      .filter(b => !hide.has(b.key))\n      .map(b => stringLenPx(getTickDisplayStr(b.end, bpPerPx))),\n  ])\n}\n\n/**\n * #stateModel DotplotView\n * #category view\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nexport default function stateModelFactory(pm: PluginManager) {\n  return types\n    .compose(\n      'DotplotView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('DotplotView'),\n        /**\n         * #property\n         */\n        height: 600,\n        /**\n         * #property\n         */\n        borderSize: 20,\n        /**\n         * #property\n         */\n        tickSize: 5,\n        /**\n         * #property\n         */\n        vtextRotation: 0,\n        /**\n         * #property\n         */\n        htextRotation: -90,\n        /**\n         * #property\n         */\n        fontSize: 15,\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        assemblyNames: types.array(types.string),\n        /**\n         * #property\n         */\n        drawCigar: true,\n        /**\n         * #property\n         */\n        hview: types.optional(DotplotHView, {}),\n        /**\n         * #property\n         */\n        vview: types.optional(DotplotVView, {}),\n\n        /**\n         * #property\n         */\n        tracks: types.array(\n          pm.pluggableMstType('track', 'stateModel') as BaseTrackStateModel,\n        ),\n\n        /**\n         * #property\n         * this represents tracks specific to this view specifically used\n         * for read vs ref dotplots where this track would not really apply\n         * elsewhere\n         */\n        viewTrackConfigs: types.array(pm.pluggableConfigSchemaType('track')),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      volatileWidth: undefined as number | undefined,\n      /**\n       * #volatile\n       */\n      volatileError: undefined as unknown,\n\n      /**\n       * #volatile\n       * these are 'personal preferences', stored in volatile and\n       * loaded/written to localStorage\n       */\n      cursorMode: localStorageGetItem('dotplot-cursorMode') || 'crosshair',\n      /**\n       * #volatile\n       */\n      showPanButtons: localStorageGetBoolean('dotplot-showPanbuttons', true),\n      /**\n       * #volatile\n       */\n      wheelMode: localStorageGetItem('dotplot-wheelMode') || 'zoom',\n      /**\n       * #volatile\n       */\n      borderX: 100,\n      /**\n       * #volatile\n       */\n      borderY: 100,\n      /**\n       * #volatile\n       */\n      importFormSyntenyTrackSelections:\n        observable.array<ImportFormSyntenyTrack>(),\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      importFormRemoveRow(idx: number) {\n        self.importFormSyntenyTrackSelections.splice(idx, 1)\n      },\n      /**\n       * #action\n       */\n      clearImportFormSyntenyTracks() {\n        self.importFormSyntenyTrackSelections.clear()\n      },\n      /**\n       * #action\n       */\n      setImportFormSyntenyTrack(arg: number, val: ImportFormSyntenyTrack) {\n        self.importFormSyntenyTrackSelections[arg] = val\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get width(): number {\n        if (!self.volatileWidth) {\n          throw new Error('width not initialized')\n        }\n        return self.volatileWidth\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n      /**\n       * #getter\n       */\n      get assembliesInitialized() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames.every(\n          n => assemblyManager.get(n)?.initialized ?? true,\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get initialized() {\n        return (\n          self.volatileWidth !== undefined &&\n          self.hview.displayedRegions.length > 0 &&\n          self.vview.displayedRegions.length > 0 &&\n          self.assembliesInitialized\n        )\n      },\n      /**\n       * #getter\n       */\n      get hticks() {\n        const { hview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = hview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n      /**\n       * #getter\n       */\n      get vticks() {\n        const { vview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = vview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n      /**\n       * #getter\n       */\n      get loading() {\n        return self.assemblyNames.length > 0 && !this.initialized\n      },\n      /**\n       * #getter\n       */\n      get viewWidth() {\n        return self.width - self.borderX\n      },\n      /**\n       * #getter\n       */\n      get viewHeight() {\n        return self.height - self.borderY\n      },\n      /**\n       * #getter\n       */\n      get views() {\n        return [self.hview, self.vview]\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        const session = getSession(self)\n        return {\n          ...getParentRenderProps(self),\n          drawCigar: self.drawCigar,\n          highResolutionScaling: getConf(session, 'highResolutionScaling'),\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setShowPanButtons(flag: boolean) {\n        self.showPanButtons = flag\n      },\n      /**\n       * #action\n       */\n      setWheelMode(str: string) {\n        self.wheelMode = str\n      },\n      /**\n       * #action\n       */\n      setCursorMode(str: string) {\n        self.cursorMode = str\n      },\n      /**\n       * #action\n       */\n      setDrawCigar(flag: boolean) {\n        self.drawCigar = flag\n      },\n      /**\n       * #action\n       * returns to the import form\n       */\n      clearView() {\n        self.hview.setDisplayedRegions([])\n        self.vview.setDisplayedRegions([])\n        self.assemblyNames = cast([])\n        self.tracks.clear()\n      },\n      /**\n       * #action\n       */\n      setBorderX(n: number) {\n        self.borderX = n\n      },\n      /**\n       * #action\n       */\n      setBorderY(n: number) {\n        self.borderY = n\n      },\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n        return self.volatileWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = newHeight\n        return self.height\n      },\n\n      /**\n       * #action\n       */\n      setError(e: unknown) {\n        self.volatileError = e\n      },\n\n      /**\n       * #action\n       */\n      zoomOut() {\n        self.hview.zoomOut()\n        self.vview.zoomOut()\n      },\n      /**\n       * #action\n       */\n      zoomIn() {\n        self.hview.zoomIn()\n        self.vview.zoomIn()\n      },\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pm.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const trackType = pm.getTrackType(conf.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${conf.type}`)\n        }\n        const viewType = pm.getViewType(self.type)!\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          viewType.displayTypes.find(type => type.name === d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pm.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const tracks = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => {\n          for (const track of tracks) {\n            self.tracks.remove(track)\n          }\n        })\n        return tracks.length\n      },\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        const hiddenCount = this.hideTrack(trackId)\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n          return true\n        }\n        return false\n      },\n      /**\n       * #action\n       */\n      setAssemblyNames(target: string, query: string) {\n        self.assemblyNames = cast([target, query])\n      },\n      /**\n       * #action\n       */\n      setViews(arr: SnapshotIn<Base1DViewModel>[]) {\n        self.hview = cast(arr[0])\n        self.vview = cast(arr[1])\n      },\n\n      /**\n       * #action\n       */\n      getCoords(mousedown: Coord, mouseup: Coord) {\n        const [xmin, xmax] = minmax(mouseup[0], mousedown[0])\n        const [ymin, ymax] = minmax(mouseup[1], mousedown[1])\n        return Math.abs(xmax - xmin) > 3 && Math.abs(ymax - ymin) > 3\n          ? [\n              self.hview.pxToBp(xmin),\n              self.hview.pxToBp(xmax),\n              self.vview.pxToBp(self.viewHeight - ymin),\n              self.vview.pxToBp(self.viewHeight - ymax),\n            ]\n          : undefined\n      },\n\n      /**\n       * #action\n       * zooms into clicked and dragged region\n       */\n      zoomInToMouseCoords(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          self.hview.moveTo(x1, x2)\n          self.vview.moveTo(y2, y1)\n        }\n      },\n      /**\n       * #action\n       */\n      showAllRegions() {\n        self.hview.zoomTo(self.hview.maxBpPerPx)\n        self.vview.zoomTo(self.vview.maxBpPerPx)\n        self.vview.center()\n        self.hview.center()\n      },\n      /**\n       * #action\n       * creates a linear synteny view from the clicked and dragged region\n       */\n      onDotplotView(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          const session = getSession(self)\n\n          const d1 = Dotplot1DView.create({\n            ...getSnapshot(self.hview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          const d2 = Dotplot1DView.create({\n            ...getSnapshot(self.vview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          d1.setVolatileWidth(self.hview.width)\n          d2.setVolatileWidth(self.vview.width)\n          d1.moveTo(x1, x2)\n          d2.moveTo(y2, y1)\n          d1.zoomTo(d1.bpPerPx / (self.width / self.hview.width), 0)\n          d2.zoomTo(d2.bpPerPx / (self.width / self.vview.width), 0)\n\n          // add the specific evidence tracks to the LGVs in the split view\n          // note: scales the bpPerPx by scaling proportional of the dotplot\n          // width to the eventual lgv width\n          const tracks = self.tracks\n            .map(track =>\n              track.configuration.displays.find(\n                (display: { type: string }) =>\n                  display.type === 'LinearSyntenyDisplay',\n              ),\n            )\n            .filter(f => !!f)\n            .map(displayConf => {\n              const trackConf = getParent<AnyConfigurationModel>(displayConf, 2)\n              return {\n                type: trackConf.type,\n                configuration: trackConf,\n                displays: [\n                  { type: displayConf.type, configuration: displayConf },\n                ],\n              }\n            })\n\n          const { id: _unused1, ...rest1 } = getSnapshot(d1)\n          const { id: _unused2, ...rest2 } = getSnapshot(d2)\n          const viewSnapshot = {\n            type: 'LinearSyntenyView',\n            views: [\n              {\n                type: 'LinearGenomeView',\n                tracks: [],\n                hideHeader: true,\n                ...rest1,\n              },\n              {\n                type: 'LinearGenomeView',\n                tracks: [],\n                hideHeader: true,\n                ...rest2,\n              },\n            ],\n            tracks,\n          }\n\n          session.addView('LinearSyntenyView', viewSnapshot)\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import('./svgcomponents/SVGDotplotView')\n        const html = await renderToSvg(self as DotplotViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n      // if any of our assemblies are temporary assemblies\n      beforeDestroy() {\n        const session = getSession(self)\n        for (const name of self.assemblyNames) {\n          session.removeTemporaryAssembly?.(name)\n        }\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const s = (s: unknown) => JSON.stringify(s)\n            const { showPanButtons, wheelMode, cursorMode } = self\n            if (typeof localStorage !== 'undefined') {\n              localStorage.setItem('dotplot-showPanbuttons', s(showPanButtons))\n              localStorage.setItem('dotplot-cursorMode', cursorMode)\n              localStorage.setItem('dotplot-wheelMode', wheelMode)\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const session = getSession(self)\n\n              // don't operate if width not set yet\n              if (\n                self.volatileWidth === undefined ||\n                !self.assembliesInitialized\n              ) {\n                return\n              }\n\n              // also don't operate if displayedRegions already set, this is a\n              // helper autorun to load regions from assembly\n              if (\n                self.hview.displayedRegions.length > 0 &&\n                self.vview.displayedRegions.length > 0\n              ) {\n                return\n              }\n\n              const views = [self.hview, self.vview]\n              transaction(() => {\n                for (const [index, name] of self.assemblyNames.entries()) {\n                  const assembly = session.assemblyManager.get(name)\n                  const view = views[index]!\n                  view.setDisplayedRegions(assembly?.regions || [])\n                }\n                self.showAllRegions()\n              })\n            },\n            { delay: 1000 },\n          ),\n        )\n        addDisposer(\n          self,\n          autorun(function borderSetter() {\n            // make sure we have a width on the view before trying to load\n            if (self.volatileWidth === undefined) {\n              return\n            }\n            const { vview, hview, viewHeight, viewWidth } = self\n            const padding = 40\n            const vblocks = vview.dynamicBlocks.contentBlocks\n            const hblocks = hview.dynamicBlocks.contentBlocks\n            const hoffset = hview.offsetPx\n            const voffset = vview.offsetPx\n\n            const vhide = getBlockLabelKeysToHide(vblocks, viewHeight, voffset)\n            const hhide = getBlockLabelKeysToHide(hblocks, viewWidth, hoffset)\n            const by = pxWidthForBlocks(hblocks, vview.bpPerPx, hhide)\n            const bx = pxWidthForBlocks(vblocks, hview.bpPerPx, vhide)\n\n            // these are set via autorun to avoid dependency cycle\n            self.setBorderY(Math.max(by + padding, 50))\n            self.setBorderX(Math.max(bx + padding, 50))\n          }),\n        )\n      },\n      /**\n       * #action\n       */\n      squareView() {\n        const { hview, vview } = self\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n      /**\n       * #action\n       */\n      squareViewProportional() {\n        const { hview, vview } = self\n        const ratio = hview.width / vview.width\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg / ratio)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems() {\n        const session = getSession(self)\n        return [\n          {\n            label: 'Return to import form',\n            icon: FolderOpenIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                {\n                  model: self,\n                  handleClose,\n                },\n              ])\n            },\n          },\n\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                {\n                  model: self,\n                  handleClose,\n                },\n              ])\n            },\n          },\n          ...(isSessionModelWithWidgets(session)\n            ? [\n                {\n                  label: 'Open track selector',\n                  onClick: self.activateTrackSelector,\n                  icon: TrackSelectorIcon,\n                },\n              ]\n            : []),\n        ]\n      },\n      /**\n       * #getter\n       */\n      get error(): unknown {\n        return self.volatileError || self.assemblyErrors\n      },\n    }))\n}\n\nexport type DotplotViewStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotViewModel = Instance<DotplotViewStateModel>\n\nexport { Dotplot1DView, type Dotplot1DViewModel } from './1dview'\n","import ComparativeRenderer from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport {\n  renameRegionsIfNeeded,\n  renderToAbstractCanvas,\n} from '@jbrowse/core/util'\n\nimport { Dotplot1DView } from '../DotplotView/model'\n\nimport type { Dotplot1DViewModel } from '../DotplotView/model'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type {\n  RenderArgs,\n  RenderArgsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport type { Region } from '@jbrowse/core/util'\n\nexport interface DotplotRenderArgsDeserialized extends RenderArgsDeserialized {\n  adapterConfig: AnyConfigurationModel\n  height: number\n  width: number\n  highResolutionScaling: number\n  view: {\n    hview: Dotplot1DViewModel\n    vview: Dotplot1DViewModel\n  }\n}\n\ninterface DotplotRenderArgs extends RenderArgs {\n  adapterConfig: AnyConfigurationModel\n  sessionId: string\n  view: {\n    hview: { displayedRegions: Region[] }\n    vview: { displayedRegions: Region[] }\n  }\n}\n\nexport default class DotplotRenderer extends ComparativeRenderer {\n  supportsSVG = true\n\n  async renameRegionsIfNeeded(args: DotplotRenderArgs) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n\n    const { view, sessionId, adapterConfig } = args\n\n    async function process(regions?: Region[]) {\n      if (!assemblyManager) {\n        throw new Error('No assembly manager provided')\n      }\n      const result = await renameRegionsIfNeeded(assemblyManager, {\n        sessionId,\n        adapterConfig,\n        regions,\n      })\n      return result.regions\n    }\n\n    view.hview.displayedRegions = await process(view.hview.displayedRegions)\n    view.vview.displayedRegions = await process(view.vview.displayedRegions)\n\n    return args\n  }\n\n  async render(renderProps: DotplotRenderArgsDeserialized) {\n    const {\n      width,\n      height,\n      view: { hview, vview },\n    } = renderProps\n    const dimensions = [width, height]\n    const views = [hview, vview].map((snap, idx) => {\n      const view = Dotplot1DView.create(snap)\n      view.setVolatileWidth(dimensions[idx]!)\n      return view\n    })\n    const target = views[0]!\n    const feats = await this.getFeatures({\n      ...renderProps,\n      regions: target.dynamicBlocks.contentBlocks,\n    })\n    target.setFeatures(feats)\n\n    const { drawDotplot } = await import('./drawDotplot')\n    const ret = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      drawDotplot(ctx, { ...renderProps, views }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...ret,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...ret,\n      height,\n      width,\n      offsetX: views[0]!.dynamicBlocks.blocks[0]?.offsetPx || 0,\n      offsetY: views[1]!.dynamicBlocks.blocks[0]?.offsetPx || 0,\n      bpPerPxX: views[0]!.bpPerPx,\n      bpPerPxY: views[1]!.bpPerPx,\n    }\n  }\n}\n","import { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nimport type { DotplotRenderArgsDeserialized } from '../DotplotRenderer'\n\nconst DotplotRendering = observer(function (\n  props: DotplotRenderArgsDeserialized,\n) {\n  return <PrerenderedCanvas {...props} />\n})\n\nexport default DotplotRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config DotplotRenderer\n * #category renderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'DotplotRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description:\n        'the color of each feature in a synteny, used with colorBy:default',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    posColor: {\n      type: 'color',\n      description: 'the color for forward alignments, used with colorBy:strand',\n      defaultValue: 'blue',\n    },\n    /**\n     * #slot\n     */\n    negColor: {\n      type: 'color',\n      description: 'the color for reverse alignments, used with colorBy:strand',\n      defaultValue: 'red',\n    },\n\n    /**\n     * #slot\n     */\n    lineWidth: {\n      type: 'number',\n      description: 'width of the lines to be drawn',\n      defaultValue: 2.5, // 2.5 is similar to D-GENIES\n    },\n\n    /**\n     * #slot\n     */\n    colorBy: {\n      type: 'stringEnum',\n      model: types.enumeration('colorBy', [\n        'identity',\n        'meanQueryIdentity',\n        'mappingQuality',\n        'strand',\n        'default',\n      ]),\n      description: `Color by options:<br/>\n<ul>\n  <li>\"identity\" - the identity of the particular hit, similar to D-GENIES, use the other config slots 'thresholds' and 'thresholdsPalette' to define colors for this setting</li>\n  <li>\"meanQueryIdentity\" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>\"mappingQuality\" - uses mapping quality from PAF, some adapters don't have this setting</li>\n  <li>\"strand\" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>\"default\" - uses the 'color' config slot</li>\n</ul>`,\n      defaultValue: 'default',\n    },\n\n    /**\n     * #slot\n     */\n    thresholdsPalette: {\n      type: 'stringArray',\n      defaultValue: ['#094b09', '#2ebd40', '#d5670b', '#ffd84b'],\n      description: 'threshold colors, used with colorBy:identity',\n    },\n\n    /**\n     * #slot\n     */\n    thresholds: {\n      type: 'stringArray',\n      defaultValue: ['0.75', '0.5', '0.25', '0'],\n      description: 'threshold breakpoints, used with colorBy:identity',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { transaction } from 'mobx'\n\nimport type { DotplotViewModel } from './DotplotView/model'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default function LaunchDotplotView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-DotplotView',\n    // @ts-expect-error\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: { loc: string; assembly: string; tracks?: string[] }[]\n      tracks?: string[]\n    }) => {\n      try {\n        const model = session.addView('DotplotView', {}) as DotplotViewModel\n        const assemblyNames = views.map(view => view.assembly)\n\n        transaction(() => {\n          model.setViews([\n            { bpPerPx: 0.1, offsetPx: 0 },\n            { bpPerPx: 0.1, offsetPx: 0 },\n          ])\n          model.setAssemblyNames(assemblyNames[0]!, assemblyNames[1]!)\n        })\n\n        // http://localhost:3000/?config=test_data%2Fvolvox%2Fconfig.json&session=spec-{\"views\":[{\"type\":\"DotplotView\",\"views\":[{\"assembly\":\"volvox\"},{\"assembly\":\"volvox\"}],\"tracks\":[\"volvox_fake_synteny\"]}]}\n\n        const idsNotFound = [] as string[]\n        for (const track of tracks) {\n          tryTrack(model, track, idsNotFound)\n        }\n\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notifyError(`${e}`, e)\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: { showTrack: (arg: string) => void },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (/Could not resolve identifier/.exec(`${e}`)) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport { isAbstractMenuManager } from '@jbrowse/core/util'\nimport TimelineIcon from '@mui/icons-material/Timeline'\n\nimport ComparativeRenderer from './ComparativeRenderer'\nimport DotplotDisplayF from './DotplotDisplay'\nimport DotplotReadVsRefMenuItem from './DotplotReadVsRef'\nimport DotplotRendererF from './DotplotRenderer'\nimport DotplotViewF from './DotplotView'\nimport LaunchDotplotViewF from './LaunchDotplotView'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default class DotplotPlugin extends Plugin {\n  name = 'DotplotPlugin'\n\n  install(pluginManager: PluginManager) {\n    DotplotViewF(pluginManager)\n    DotplotDisplayF(pluginManager)\n    DotplotRendererF(pluginManager)\n    LaunchDotplotViewF(pluginManager)\n    DotplotReadVsRefMenuItem(pluginManager)\n\n    // install our comparative rendering rpc callback\n    pluginManager.addRpcMethod(() => new ComparativeRenderer(pluginManager))\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Dotplot view',\n        icon: TimelineIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('DotplotView', {})\n        },\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { types } from 'mobx-state-tree'\n\nimport ReactComponent from './components/DotplotDisplay'\nimport { stateModelFactory } from './stateModelFactory'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function DotplotDisplayF(pm: PluginManager) {\n  pm.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pm)\n    return new DisplayType({\n      name: 'DotplotDisplay',\n      displayName: 'Dotplot display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'DotplotView',\n      ReactComponent,\n    })\n  })\n}\n\n/**\n * #config DotplotDisplay\n */\nexport function configSchemaFactory(pm: any) {\n  return ConfigurationSchema(\n    'DotplotDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(pm.pluggableConfigSchemaType('renderer'), {\n        type: 'DotplotRenderer',\n      }),\n    },\n    {\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'displayId',\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function DotplotViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'DotplotView',\n      displayName: 'Dotplot view',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/DotplotView')),\n    })\n  })\n}\n","import DotplotRenderer from './DotplotRenderer'\nimport ReactComponent from './components/DotplotRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function DotplotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new DotplotRenderer({\n        name: 'DotplotRenderer',\n        configSchema: configSchema,\n        ReactComponent,\n        pluginManager,\n      }),\n  )\n}\n","import AddIcon from '@mui/icons-material/Add'\n\nimport { onClick } from './DotplotReadVsRef'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  DisplayType,\n  PluggableElementType,\n} from '@jbrowse/core/pluggableElementTypes'\nimport type { LinearPileupDisplayModel } from '@jbrowse/plugin-alignments'\n\n// local\n\nexport default function DotplotReadVsRefMenuItem(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-extendPluggableElement',\n    (pluggableElement: PluggableElementType) => {\n      if (pluggableElement.name === 'LinearPileupDisplay') {\n        const { stateModel } = pluggableElement as DisplayType\n        const newStateModel = stateModel.extend(\n          (self: LinearPileupDisplayModel) => {\n            const superContextMenuItems = self.contextMenuItems\n            return {\n              views: {\n                contextMenuItems() {\n                  const feature = self.contextMenuFeature\n                  return [\n                    ...superContextMenuItems(),\n                    ...(feature\n                      ? [\n                          {\n                            label: 'Dotplot of read vs ref',\n                            icon: AddIcon,\n                            onClick: () => {\n                              onClick(feature, self)\n                            },\n                          },\n                        ]\n                      : []),\n                  ]\n                },\n              },\n            }\n          },\n        )\n\n        ;(pluggableElement as DisplayType).stateModel = newStateModel\n      }\n      return pluggableElement\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\nconst EditGCContentParamsDialog = lazy(\n  () => import('./components/EditGCContentParams'),\n)\n\n/**\n * #stateModel SharedGCContentModel\n * #category display\n * extends\n * - [LinearWiggleDisplay](../linearwiggledisplay)\n */\nexport default function SharedModelF(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'SharedGCContentModel',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        windowSize: types.maybe(types.number),\n        /**\n         * #property\n         */\n        windowDelta: types.maybe(types.number),\n      }),\n    )\n    .actions(self => ({\n      setGCContentParams({\n        windowSize,\n        windowDelta,\n      }: {\n        windowSize: number\n        windowDelta: number\n      }) {\n        self.windowSize = windowSize\n        self.windowDelta = windowDelta\n      },\n    }))\n    .views(self => ({\n      get windowSizeSetting() {\n        return self.windowSize ?? getConf(self, 'windowSize')\n      },\n      get windowDeltaSetting() {\n        return self.windowDelta ?? getConf(self, 'windowDelta')\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        adapterProps: superAdapterProps,\n      } = self\n      return {\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Change GC parameters',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  EditGCContentParamsDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n        /**\n         * #method\n         * retrieves the sequence adapter from parent track, and puts it as a\n         * subadapter on a GCContentAdapter\n         */\n        adapterProps() {\n          const sequenceAdapter = getConf(self.parentTrack, 'adapter')\n          return {\n            ...superAdapterProps(),\n            adapterConfig: {\n              type: 'GCContentAdapter',\n              sequenceAdapter,\n              windowSize: self.windowSizeSetting,\n              windowDelta: self.windowDeltaSetting,\n            },\n          }\n        },\n      }\n    })\n}\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport GCContentAdapterF from './GCContentAdapter'\nimport GCContentTrackF from './GCContentTrack'\nimport LinearGCContentDisplayF from './LinearGCContentDisplay'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class GCContentPlugin extends Plugin {\n  name = 'GCContentPlugin'\n\n  install(pluginManager: PluginManager) {\n    GCContentAdapterF(pluginManager)\n    GCContentTrackF(pluginManager)\n    LinearGCContentDisplayF(pluginManager)\n  }\n}\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function GCContentTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'GCContentTrack',\n      displayName: 'GCContent track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'GCContentTrack', configSchema),\n    })\n  })\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function GCContentAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'GCContentAdapter',\n        displayName: 'GC content adapter',\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        configSchema: configSchemaF(pluginManager),\n        getAdapterClass: () =>\n          import('./GCContentAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config GCContentAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GCContentAdapterF = (_pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'GCContentAdapter',\n    {\n      /**\n       * #slot\n       */\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n      /**\n       * #slot\n       */\n      windowSize: {\n        type: 'number',\n        defaultValue: 100,\n      },\n      /**\n       * #slot\n       */\n      windowDelta: {\n        type: 'number',\n        defaultValue: 100,\n      },\n    },\n    { explicitlyTyped: true },\n  )\n}\n\nexport default GCContentAdapterF\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config GCContentTrack\n * used for having a gc content track outside of the \"reference sequence display\"\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'GCContentTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\n\nimport configSchemaFactory1 from './config1'\nimport configSchemaFactory2 from './config2'\nimport stateModelF1 from './stateModel1'\nimport stateModelF2 from './stateModel2'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearGCContentDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory1(pluginManager)\n    const stateModel = stateModelF1(pluginManager, configSchema)\n    return new DisplayType({\n      name: 'LinearGCContentDisplay',\n      configSchema,\n      stateModel,\n      displayName: 'GC content display',\n      trackType: 'ReferenceSequenceTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory2(pluginManager)\n    const stateModel = stateModelF2(pluginManager, configSchema)\n    return new DisplayType({\n      name: 'LinearGCContentTrackDisplay',\n      configSchema,\n      stateModel,\n      displayName: 'GC content display',\n      trackType: 'GCContentTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearGCContentDisplay\n * #category display\n * extends LinearWiggleDisplay\n */\nexport default function LinearGCContentDisplay(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearGCContentDisplay',\n    {\n      windowSize: {\n        type: 'number',\n        defaultValue: 100,\n      },\n      windowDelta: {\n        type: 'number',\n        defaultValue: 100,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: pluginManager.getDisplayType('LinearWiggleDisplay')!\n        .configSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\n\nimport SharedModelF from './shared'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearGCContentDisplay\n * #category display\n * base model `SharedGCContentModel`\n */\nexport default function stateModelF(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types.compose(\n    'LinearGCContentDisplay',\n    SharedModelF(pluginManager, configSchema),\n    types.model({\n      type: types.literal('LinearGCContentDisplay'),\n    }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearGCContentTrackDisplay\n * #category display\n * extends LinearWiggleDisplay, used specifically for GCContentTrack\n */\nexport default function LinearGCContentTrackDisplayF(\n  pluginManager: PluginManager,\n) {\n  return ConfigurationSchema(\n    'LinearGCContentTrackDisplay',\n    {\n      windowSize: {\n        type: 'number',\n        defaultValue: 100,\n      },\n      windowDelta: {\n        type: 'number',\n        defaultValue: 100,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: pluginManager.getDisplayType('LinearWiggleDisplay')!\n        .configSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\n\nimport SharedModelF from './shared'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearGCContentTrackDisplay\n * #category display\n *\n * used on GCContentTrack, separately from the display type on the\n * ReferenceSequenceTrack\n *\n * extends\n * - [SharedGCContentModel](../sharedgccontentmodel)\n */\nexport default function stateModelF(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types.compose(\n    'LinearGCContentTrackDisplay',\n    SharedModelF(pluginManager, configSchema),\n    types.model({\n      type: types.literal('LinearGCContentTrackDisplay'),\n    }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config Gff3Adapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Gff3Adapter = ConfigurationSchema(\n  'Gff3Adapter',\n  {\n    /**\n     * #slot\n     */\n    gffLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.gff',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     *\n     * ```json\n     * {\n     *   \"type\": \"Gff3Adapter\",\n     *   \"uri\": \"yourfile.gff3\",\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            gffLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default Gff3Adapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config Gff3TabixAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Gff3TabixAdapter = ConfigurationSchema(\n  'Gff3TabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    gffGzLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.gff.gz',\n        locationType: 'UriLocation',\n      },\n    },\n\n    index: ConfigurationSchema('Gff3TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.indexType\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.gff.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     * the Gff3TabixAdapter has to \"redispatch\" if it fetches a region and\n     * features it finds inside that region extend outside the region we requested.\n     * you can disable this for certain feature types to avoid fetching e.g. the\n     * entire chromosome\n     */\n    dontRedispatch: {\n      type: 'stringArray',\n      defaultValue: ['chromosome', 'region', 'contig'],\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes tbi index at\n     * yourfile.gff3.gz.tbi:\n     *\n     * ```json\n     * {\n     *   \"type\": \"Gff3TabixAdapter\",\n     *   \"uri\": \"yourfile.gff3.gz\",\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            gffGzLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            index: {\n              location: {\n                uri: `${snap.uri}.tbi`,\n                baseUri: snap.baseUri,\n              },\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default Gff3TabixAdapter\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport Gff3AdapterF from './Gff3Adapter'\nimport Gff3TabixAdapterF from './Gff3TabixAdapter'\nimport GuessGff3F from './GuessGff3'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class GFF3Plugin extends Plugin {\n  name = 'GFF3Plugin'\n\n  install(pluginManager: PluginManager) {\n    Gff3TabixAdapterF(pluginManager)\n    Gff3AdapterF(pluginManager)\n    GuessGff3F(pluginManager)\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function Gff3TabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'Gff3TabixAdapter',\n        displayName: 'GFF3 tabix adapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./Gff3TabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function Gff3AdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'Gff3Adapter',\n        displayName: 'GFF3 adapter',\n        configSchema,\n        getAdapterClass: () => import('./Gff3Adapter').then(r => r.default),\n      }),\n  )\n}\n","import { testAdapter } from '@jbrowse/core/util'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n} from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AdapterGuesser } from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessGff3F(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n        if (\n          testAdapter(\n            fileName,\n            /\\.gff3?\\.b?gz$/i,\n            adapterHint,\n            'Gff3TabixAdapter',\n          )\n        ) {\n          return {\n            type: 'Gff3TabixAdapter',\n            bamLocation: file,\n            gffGzLocation: file,\n            index: {\n              location: index || makeIndex(file, '.tbi'),\n              indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n            },\n          }\n        } else if (\n          testAdapter(fileName, /\\.gff3?$/i, adapterHint, 'Gff3Adapter')\n        ) {\n          return {\n            type: 'Gff3Adapter',\n            gffLocation: file,\n          }\n        } else {\n          return adapterGuesser(file, index, adapterHint)\n        }\n      }\n    },\n  )\n}\n","import { Fragment, useEffect } from 'react'\n\nimport CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { getSession, notEmpty } from '@jbrowse/core/util'\nimport { colord } from '@jbrowse/core/util/colord'\nimport BookmarkIcon from '@mui/icons-material/Bookmark'\nimport { Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { GridBookmarkModel, IExtendedLGV } from '../../model'\nimport type { SessionWithWidgets } from '@jbrowse/core/util'\n\ntype LGV = IExtendedLGV\n\nconst useStyles = makeStyles()({\n  bookmarkButton: {\n    overflow: 'hidden',\n    position: 'absolute',\n    zIndex: 800,\n  },\n  highlight: {\n    overflow: 'hidden',\n    height: '100%',\n    position: 'absolute',\n  },\n})\n\nconst Highlight = observer(function Highlight({ model }: { model: LGV }) {\n  const { classes } = useStyles()\n  const session = getSession(model) as SessionWithWidgets\n  const { assemblyManager } = session\n  const { bookmarkHighlightsVisible, bookmarkLabelsVisible } = model\n\n  const bookmarkWidget = session.widgets.get('GridBookmark') as\n    | GridBookmarkModel\n    | undefined\n\n  useEffect(() => {\n    if (!bookmarkWidget) {\n      session.addWidget('GridBookmarkWidget', 'GridBookmark')\n    }\n  }, [session, bookmarkWidget])\n\n  const set = new Set(model.assemblyNames)\n\n  return bookmarkHighlightsVisible && bookmarkWidget?.bookmarks\n    ? bookmarkWidget.bookmarks\n        .filter(value => set.has(value.assemblyName))\n        .map(r => {\n          const asm = assemblyManager.get(r.assemblyName)\n          const refName = asm?.getCanonicalRefName(r.refName) ?? r.refName\n          const s = model.bpToPx({ refName, coord: r.start })\n          const e = model.bpToPx({ refName, coord: r.end })\n          return s && e\n            ? {\n                width: Math.max(Math.abs(e.offsetPx - s.offsetPx), 3),\n                left: Math.min(s.offsetPx, e.offsetPx) - model.offsetPx,\n                highlight: r.highlight,\n                label: r.label,\n                bookmark: r,\n              }\n            : undefined\n        })\n        .filter(notEmpty)\n        .map(({ left, width, highlight, label, bookmark }, idx) => (\n          /* biome-ignore lint/suspicious/noArrayIndexKey: */\n          <Fragment key={`${left}_${width}_${idx}`}>\n            <div\n              className={classes.highlight}\n              id=\"highlight\"\n              style={{\n                left,\n                width,\n                background: highlight,\n              }}\n            />\n            {bookmarkLabelsVisible && width > 20 ? (\n              <div className={classes.bookmarkButton} style={{ left }}>\n                <CascadingMenuButton\n                  menuItems={[\n                    {\n                      label: 'Open bookmark widget',\n                      onClick: () => {\n                        session.showWidget(bookmarkWidget)\n                      },\n                    },\n                    {\n                      label: 'Turn off highlights',\n                      onClick: () => {\n                        bookmarkWidget.setBookmarkHighlightsVisible(false)\n                      },\n                    },\n\n                    {\n                      label: 'Remove bookmark',\n                      onClick: () => {\n                        bookmarkWidget.removeBookmarkObject(bookmark)\n                      },\n                    },\n                  ]}\n                >\n                  <Tooltip title={label} arrow>\n                    <BookmarkIcon\n                      fontSize=\"small\"\n                      sx={{\n                        color:\n                          colord(highlight).alpha() !== 0\n                            ? colord(highlight).alpha(0.8).toRgbString()\n                            : colord(highlight).alpha(0).toRgbString(),\n                      }}\n                    />\n                  </Tooltip>\n                </CascadingMenuButton>\n              </div>\n            ) : null}\n          </Fragment>\n        ))\n    : null\n})\n\nexport default Highlight\n","import { useEffect } from 'react'\n\nimport { getSession, notEmpty } from '@jbrowse/core/util'\nimport { Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { GridBookmarkModel, IExtendedLGV } from '../../model'\nimport type { SessionWithWidgets } from '@jbrowse/core/util'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\ntype LGV = IExtendedLGV\n\nconst useStyles = makeStyles()({\n  highlight: {\n    height: '100%',\n    position: 'absolute',\n  },\n})\n\nconst OverviewHighlight = observer(function OverviewHighlight({\n  model,\n  overview,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n}) {\n  const { cytobandOffset } = model\n  const session = getSession(model) as SessionWithWidgets\n  const { classes } = useStyles()\n  const { assemblyManager } = session\n  const { bookmarkHighlightsVisible, bookmarkLabelsVisible } = model\n  const bookmarkWidget = session.widgets.get('GridBookmark') as\n    | GridBookmarkModel\n    | undefined\n\n  useEffect(() => {\n    if (!bookmarkWidget) {\n      session.addWidget('GridBookmarkWidget', 'GridBookmark')\n    }\n  }, [session, bookmarkWidget])\n\n  const assemblyNames = new Set(model.assemblyNames)\n  return bookmarkHighlightsVisible && bookmarkWidget?.bookmarks\n    ? bookmarkWidget.bookmarks\n        .filter(r => assemblyNames.has(r.assemblyName))\n        .map(r => {\n          const asm = assemblyManager.get(r.assemblyName)\n          const refName = asm?.getCanonicalRefName(r.refName) ?? r.refName\n          const rev = r.reversed\n          const s = overview.bpToPx({ refName, coord: rev ? r.end : r.start })\n          const e = overview.bpToPx({ refName, coord: rev ? r.start : r.end })\n          return s !== undefined && e !== undefined\n            ? {\n                width: Math.abs(e - s),\n                left: s + cytobandOffset,\n                highlight: r.highlight,\n                label: r.label,\n              }\n            : undefined\n        })\n        .filter(notEmpty)\n        .map((obj, idx) => {\n          const { left, width, highlight, label } = obj\n          return (\n            <Tooltip\n              key={`${JSON.stringify(obj)}-${idx}`}\n              title={bookmarkLabelsVisible ? label : ''}\n              arrow\n            >\n              <div\n                className={classes.highlight}\n                style={{\n                  left,\n                  width,\n                  background: highlight,\n                  borderLeft: `1px solid ${highlight}`,\n                  borderRight: `1px solid ${highlight}`,\n                }}\n              />\n            </Tooltip>\n          )\n        })\n    : null\n})\n\nexport default OverviewHighlight\n","import {\n  getSession,\n  localStorageGetItem,\n  localStorageSetItem,\n} from '@jbrowse/core/util'\nimport { ElementId, Region as RegionModel } from '@jbrowse/core/util/types/mst'\nimport { autorun } from 'mobx'\nimport { addDisposer, cast, types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Region } from '@jbrowse/core/util/types'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport type { IMSTArray, Instance, SnapshotIn } from 'mobx-state-tree'\n\nconst LabeledRegionModel = types\n  .compose(\n    RegionModel,\n    types.model('Label', {\n      label: types.optional(types.string, ''),\n      highlight: types.optional(types.string, 'rgba(247, 129, 192, 0.35)'),\n    }),\n  )\n  .actions(self => ({\n    setLabel(label: string) {\n      self.label = label\n    },\n    setHighlight(color: string) {\n      self.highlight = color\n    },\n  }))\n\nconst SharedBookmarksModel = types.model('SharedBookmarksModel', {\n  sharedBookmarks: types.maybe(types.array(LabeledRegionModel)),\n})\n\nexport interface IExtendedLGV extends LinearGenomeViewModel {\n  bookmarkHighlightsVisible: boolean\n  bookmarkLabelsVisible: boolean\n  setBookmarkHighlightsVisible: (arg: boolean) => void\n  setBookmarkLabelsVisible: (arg: boolean) => void\n}\n\nexport interface ILabeledRegionModel\n  extends SnapshotIn<typeof LabeledRegionModel> {\n  refName: string\n  start: number\n  end: number\n  reversed: boolean\n  highlight: string\n  assemblyName: string\n  label: string\n  setRefName: (newRefName: string) => void\n  setLabel: (label: string) => void\n  setHighlight: (color: string) => void\n}\n\nexport interface IExtendedLabeledRegionModel extends ILabeledRegionModel {\n  id: number\n  correspondingObj: ILabeledRegionModel\n}\n\nconst localStorageKeyF = () =>\n  typeof window !== 'undefined'\n    ? `bookmarks-${[window.location.host + window.location.pathname].join('-')}`\n    : 'empty'\n\n/**\n * #stateModel GridBookmarkWidgetModel\n */\nexport default function f(_pluginManager: PluginManager) {\n  return types\n    .model('GridBookmarkModel', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('GridBookmarkWidget'),\n      /**\n       * #property\n       * removed by postProcessSnapshot, only loaded from localStorage\n       */\n      bookmarks: types.optional(types.array(LabeledRegionModel), () =>\n        JSON.parse(localStorageGetItem(localStorageKeyF()) || '[]'),\n      ),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      selectedBookmarks: [] as IExtendedLabeledRegionModel[],\n      /**\n       * #volatile\n       */\n      selectedAssembliesPre: undefined as string[] | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get bookmarkAssemblies() {\n        return [...new Set(self.bookmarks.map(r => r.assemblyName))]\n      },\n      /**\n       * #getter\n       */\n      get validAssemblies() {\n        const { assemblyManager } = getSession(self)\n        return new Set(\n          this.bookmarkAssemblies.filter(a => assemblyManager.get(a)),\n        )\n      },\n      /**\n       * #getter\n       */\n      get areBookmarksHighlightedOnAllOpenViews() {\n        const { views } = getSession(self)\n        return views.every(v =>\n          'bookmarkHighlightsVisible' in v ? v.bookmarkHighlightsVisible : true,\n        )\n      },\n      /**\n       * #getter\n       */\n      get areBookmarksHighlightLabelsOnAllOpenViews() {\n        const { views } = getSession(self)\n        return views.every(v =>\n          'bookmarkLabelsVisible' in v ? v.bookmarkLabelsVisible : true,\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get bookmarksWithValidAssemblies() {\n        return self.bookmarks.filter(e =>\n          self.validAssemblies.has(e.assemblyName),\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get sharedBookmarksModel() {\n        // requires cloning bookmarks with JSON.stringify/parse to avoid duplicate\n        // reference to same object in the same state tree, will otherwise error\n        // when performing share\n        return SharedBookmarksModel.create({\n          sharedBookmarks: JSON.parse(JSON.stringify(self.selectedBookmarks)),\n        })\n      },\n      /**\n       * #getter\n       */\n      get allBookmarksModel() {\n        // requires cloning bookmarks with JSON.stringify/parse to avoid duplicate\n        // reference to same object in the same state tree, will otherwise error\n        // when performing share\n        return SharedBookmarksModel.create({\n          sharedBookmarks: JSON.parse(\n            JSON.stringify(self.bookmarksWithValidAssemblies),\n          ),\n        })\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSelectedAssemblies(assemblies?: string[]) {\n        self.selectedAssembliesPre = assemblies\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get selectedAssemblies() {\n        return (\n          self.selectedAssembliesPre?.filter(f =>\n            self.validAssemblies.has(f),\n          ) ?? [...self.validAssemblies]\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      importBookmarks(regions: Region[]) {\n        self.bookmarks = cast([...self.bookmarks, ...regions])\n      },\n      /**\n       * #action\n       */\n      addBookmark(region: Region) {\n        self.bookmarks.push(region)\n      },\n      /**\n       * #action\n       */\n      removeBookmark(index: number) {\n        self.bookmarks.splice(index, 1)\n      },\n      /**\n       * #action\n       */\n      updateBookmarkLabel(\n        bookmark: IExtendedLabeledRegionModel,\n        label: string,\n      ) {\n        bookmark.correspondingObj.setLabel(label)\n      },\n      /**\n       * #action\n       */\n      updateBookmarkHighlight(\n        bookmark: IExtendedLabeledRegionModel,\n        color: string,\n      ) {\n        bookmark.correspondingObj.setHighlight(color)\n      },\n      /**\n       * #action\n       */\n      updateBulkBookmarkHighlights(color: string) {\n        for (const bookmark of self.selectedBookmarks) {\n          this.updateBookmarkHighlight(bookmark, color)\n        }\n      },\n      /**\n       * #action\n       */\n      setSelectedBookmarks(bookmarks: IExtendedLabeledRegionModel[]) {\n        self.selectedBookmarks = bookmarks\n      },\n      /**\n       * #action\n       */\n      setBookmarkedRegions(regions: IMSTArray<typeof LabeledRegionModel>) {\n        self.bookmarks = cast(regions)\n      },\n      /**\n       * #action\n       */\n      setBookmarkHighlightsVisible(arg: boolean) {\n        const { views } = getSession(self)\n        // hacky, but mst walk() on session leads to 'too much recursion'\n        for (const view of views) {\n          // @ts-expect-error\n          view.setBookmarkHighlightsVisible?.(arg)\n          // @ts-expect-error\n          view.views?.map(view => {\n            view.setBookmarkHighlightsVisible?.(arg)\n          })\n        }\n      },\n      /**\n       * #action\n       */\n      setBookmarkLabelsVisible(arg: boolean) {\n        const { views } = getSession(self)\n        // hacky, but mst walk() on session leads to 'too much recursion'\n        for (const view of views) {\n          // @ts-expect-error\n          view.setBookmarkLabelsVisible?.(arg)\n          // @ts-expect-error\n          view.views?.map(view => {\n            view.setBookmarkHighlightsVisible?.(arg)\n          })\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      clearAllBookmarks() {\n        self.setBookmarkedRegions(\n          self.bookmarks.filter(\n            bookmark => !self.validAssemblies.has(bookmark.assemblyName),\n          ) as IMSTArray<typeof LabeledRegionModel>,\n        )\n      },\n      /**\n       * #action\n       */\n      clearSelectedBookmarks() {\n        for (const bookmark of self.selectedBookmarks) {\n          self.bookmarks.remove(bookmark.correspondingObj)\n        }\n        self.selectedBookmarks = []\n      },\n\n      removeBookmarkObject(arg: Instance<typeof LabeledRegionModel>) {\n        self.bookmarks.remove(arg)\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        const key = localStorageKeyF()\n        function handler(e: StorageEvent) {\n          if (e.key === key) {\n            const localStorage = JSON.parse(localStorageGetItem(key) || '[]')\n            self.setBookmarkedRegions(localStorage)\n          }\n        }\n        window.addEventListener('storage', handler)\n        addDisposer(self, () => {\n          window.removeEventListener('storage', handler)\n        })\n        addDisposer(\n          self,\n          autorun(() => {\n            localStorageSetItem(key, JSON.stringify(self.bookmarks))\n          }),\n        )\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      const { bookmarks: _, ...rest } = snap as Omit<typeof snap, symbol>\n      return rest\n    })\n}\n\nexport type GridBookmarkStateModel = ReturnType<typeof f>\nexport type GridBookmarkModel = Instance<GridBookmarkStateModel>\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nimport AddHighlightModelF from './components/Highlight'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('GridBookmarkWidget', {})\n\nexport default function GridBookmarkWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'GridBookmarkWidget',\n      heading: 'Bookmarked regions',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/GridBookmarkWidget')),\n    })\n  })\n  AddHighlightModelF(pluginManager)\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport {\n  getSession,\n  isAbstractMenuManager,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport BookmarkIcon from '@mui/icons-material/Bookmark'\nimport BookmarksIcon from '@mui/icons-material/Bookmarks'\nimport HighlightIcon from '@mui/icons-material/Highlight'\nimport LabelIcon from '@mui/icons-material/Label'\n\nimport GridBookmarkWidgetF from './GridBookmarkWidget'\n\nimport type { GridBookmarkModel } from './GridBookmarkWidget/model'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  PluggableElementType,\n  ViewType,\n} from '@jbrowse/core/pluggableElementTypes'\nimport type { SessionWithWidgets } from '@jbrowse/core/util'\nimport type { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport default class GridBookmarkPlugin extends Plugin {\n  name = 'GridBookmarkPlugin'\n\n  install(pluginManager: PluginManager) {\n    GridBookmarkWidgetF(pluginManager)\n\n    pluginManager.addToExtensionPoint(\n      'Core-extendPluggableElement',\n      (pluggableElement: PluggableElementType) => {\n        if (pluggableElement.name === 'LinearGenomeView') {\n          const { stateModel } = pluggableElement as ViewType\n          const lgv = stateModel as LinearGenomeViewStateModel\n          const newStateModel = lgv\n            .props({\n              /**\n               * #property\n               */\n              bookmarkHighlightsVisible: true,\n              /**\n               * #property\n               */\n              bookmarkLabelsVisible: true,\n            })\n            .actions(self => ({\n              /**\n               * #action\n               */\n              setBookmarkHighlightsVisible(arg: boolean) {\n                self.bookmarkHighlightsVisible = arg\n              },\n              /**\n               * #action\n               */\n              setBookmarkLabelsVisible(arg: boolean) {\n                self.bookmarkLabelsVisible = arg\n              },\n              /**\n               * #action\n               */\n              activateBookmarkWidget() {\n                const session = getSession(self)\n                if (isSessionModelWithWidgets(session)) {\n                  let bookmarkWidget = session.widgets.get('GridBookmark')\n                  if (!bookmarkWidget) {\n                    bookmarkWidget = session.addWidget(\n                      'GridBookmarkWidget',\n                      'GridBookmark',\n                    )\n                  }\n\n                  session.showWidget(bookmarkWidget)\n                  return session.widgets.get(\n                    'GridBookmark',\n                  ) as GridBookmarkModel\n                }\n\n                throw new Error('Could not open bookmark widget')\n              },\n            }))\n            .actions(self => ({\n              /**\n               * #action\n               */\n              navigateNewestBookmark() {\n                const session = getSession(self)\n                const bookmarkWidget = self.activateBookmarkWidget()\n                if (bookmarkWidget.bookmarks.length) {\n                  self.navTo(bookmarkWidget.bookmarks.at(-1)!)\n                } else {\n                  session.notify(\n                    'There are no recent bookmarks to navigate to.',\n                    'info',\n                  )\n                }\n              },\n\n              /**\n               * #action\n               */\n              bookmarkCurrentRegion() {\n                if (self.id === getSession(self).focusedViewId) {\n                  const selectedRegions = self.getSelectedRegions(\n                    undefined,\n                    undefined,\n                  )\n                  const bookmarkWidget = self.activateBookmarkWidget()\n                  if (!selectedRegions.length) {\n                    throw new Error('no region selected')\n                  } else {\n                    bookmarkWidget.addBookmark(selectedRegions[0]!)\n                  }\n                }\n              },\n            }))\n            .views(self => {\n              const superMenuItems = self.menuItems\n              const superRubberBandMenuItems = self.rubberBandMenuItems\n              return {\n                /**\n                 * #method\n                 */\n                menuItems() {\n                  return [\n                    ...superMenuItems(),\n                    { type: 'divider' },\n                    {\n                      label: 'Bookmarks',\n                      icon: BookmarksIcon,\n                      subMenu: [\n                        {\n                          label: 'Open bookmark widget',\n                          icon: BookmarksIcon,\n                          onClick: () => self.activateBookmarkWidget(),\n                        },\n                        {\n                          label: 'Bookmark current region',\n                          icon: BookmarkIcon,\n                          onClick: () => {\n                            self.bookmarkCurrentRegion()\n                          },\n                        },\n                        {\n                          label: 'Toggle bookmark highlights',\n                          icon: HighlightIcon,\n                          type: 'checkbox',\n                          checked: self.bookmarkHighlightsVisible,\n                          onClick: () => {\n                            self.setBookmarkHighlightsVisible(\n                              !self.bookmarkHighlightsVisible,\n                            )\n                          },\n                        },\n                        {\n                          label: 'Toggle bookmark labels',\n                          icon: LabelIcon,\n                          type: 'checkbox',\n                          checked: self.bookmarkLabelsVisible,\n                          onClick: () => {\n                            self.setBookmarkLabelsVisible(\n                              !self.bookmarkLabelsVisible,\n                            )\n                          },\n                        },\n                      ],\n                    },\n                  ]\n                },\n\n                /**\n                 * #method\n                 */\n                rubberBandMenuItems() {\n                  return [\n                    ...superRubberBandMenuItems(),\n                    {\n                      label: 'Bookmark region',\n                      icon: BookmarkIcon,\n                      onClick: () => {\n                        const { leftOffset, rightOffset } = self\n                        const selectedRegions = self.getSelectedRegions(\n                          leftOffset,\n                          rightOffset,\n                        )\n                        const bookmarkWidget = self.activateBookmarkWidget()\n                        if (!selectedRegions.length) {\n                          throw new Error('no regions selected')\n                        } else {\n                          bookmarkWidget.addBookmark(selectedRegions[0]!)\n                        }\n                      },\n                    },\n                  ]\n                },\n              }\n            })\n            .actions(self => ({\n              afterCreate() {\n                document.addEventListener('keydown', e => {\n                  const activationSequence =\n                    (e.ctrlKey || e.metaKey) && e.shiftKey\n                  // ctrl+shift+d or cmd+shift+d\n                  if (activationSequence && e.code === 'KeyD') {\n                    e.preventDefault()\n                    self.activateBookmarkWidget()\n                    self.bookmarkCurrentRegion()\n                    getSession(self).notify('Bookmark created.', 'success')\n                  }\n                  // ctrl+shift+m or cmd+shift+m\n                  if (activationSequence && e.code === 'KeyM') {\n                    e.preventDefault()\n                    self.navigateNewestBookmark()\n                  }\n                })\n              },\n            }))\n\n          ;(pluggableElement as ViewType).stateModel = newStateModel\n        }\n        return pluggableElement\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Tools', {\n        label: 'Bookmarks',\n        icon: BookmarksIcon,\n        onClick: (session: SessionWithWidgets) => {\n          let bookmarkWidget = session.widgets.get('GridBookmark')\n          if (!bookmarkWidget) {\n            bookmarkWidget = session.addWidget(\n              'GridBookmarkWidget',\n              'GridBookmark',\n            )\n          }\n          session.showWidget(bookmarkWidget)\n        },\n      })\n    }\n  }\n}\n","import Highlight from './Highlight'\nimport OverviewHighlight from './OverviewHighlight'\n\nimport type { IExtendedLGV } from '../../model'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\nexport default function AddHighlightModelF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LinearGenomeView-TracksContainerComponent',\n    // @ts-expect-error\n    (\n      rest: React.ReactNode[] | undefined,\n      { model }: { model: IExtendedLGV },\n    ) => {\n      return [\n        ...(rest || []),\n        <Highlight key=\"highlight_grid_bookmark\" model={model} />,\n      ]\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'LinearGenomeView-OverviewScalebarComponent',\n    // @ts-expect-error\n    (\n      rest: React.ReactNode[] | undefined,\n      { model, overview }: { model: IExtendedLGV; overview: Base1DViewModel },\n    ) => {\n      return [\n        ...(rest || []),\n        <OverviewHighlight\n          key=\"overview_highlight_grid_bookmark\"\n          model={model}\n          overview={overview}\n        />,\n      ]\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config GtfAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GtfAdapter = ConfigurationSchema(\n  'GtfAdapter',\n  {\n    /**\n     * #slot\n     */\n    gtfLocation: {\n      type: 'fileLocation',\n      description: 'path to gtf file, also allows for gzipped gtf',\n      defaultValue: {\n        uri: '/path/to/my.gtf',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    aggregateField: {\n      type: 'string',\n      description:\n        'field used to aggregate multiple transcripts into a single parent gene feature',\n      defaultValue: 'gene_name',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"GtfAdapter\",\n     *   \"uri\": \"yourfile.gtf\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            gtfLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default GtfAdapter\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport GtfAdapterF from './GtfAdapter'\nimport GuessAdapterF from './GuessAdapter'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class GtfPlugin extends Plugin {\n  name = 'GTFPlugin'\n\n  install(pluginManager: PluginManager) {\n    GtfAdapterF(pluginManager)\n    GuessAdapterF(pluginManager)\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function GtfAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'GtfAdapter',\n        displayName: 'GTF adapter',\n        configSchema,\n        getAdapterClass: () => import('./GtfAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { testAdapter } from '@jbrowse/core/util'\nimport { getFileName } from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AdapterGuesser } from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessAdapterF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n\n        return testAdapter(\n          fileName,\n          /\\.gtf(\\.gz)?$/i,\n          adapterHint,\n          'GtfAdapter',\n        )\n          ? {\n              type: 'GtfAdapter',\n              gtfLocation: file,\n            }\n          : adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HicAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicAdapter = ConfigurationSchema(\n  'HicAdapter',\n  {\n    /**\n     * #slot\n     */\n    hicLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.hic',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    resolutionMultiplier: {\n      type: 'number',\n      defaultValue: 1,\n      description: 'Initial resolution multiplier',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"HicAdapter\",\n     *   \"uri\": \"file.hic\",\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            hicLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default HicAdapter\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport ServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport type { Region } from '@jbrowse/core/util/types'\n\ninterface HicFeature {\n  bin1: number\n  bin2: number\n  counts: number\n}\n\ninterface HicDataAdapter extends BaseFeatureDataAdapter {\n  getResolution: (bp: number) => Promise<number>\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  regions: Region[]\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  regions: Region[]\n  dataAdapter: HicDataAdapter\n  bpPerPx: number\n  highResolutionScaling: number\n  resolution: number\n  adapterConfig: AnyConfigurationModel\n  displayHeight?: number\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: HicFeature[]\n  statusCallback?: (arg: string) => void\n}\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport type ResultsDeserialized = ServerSideResultsDeserialized\n\nexport default class HicRenderer extends ServerSideRendererType {\n  supportsSVG = true\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const { displayHeight, regions, bpPerPx } = renderProps\n    const region = regions[0]!\n    const width = (region.end - region.start) / bpPerPx\n    const hyp = width / 2\n    const height = displayHeight ?? hyp\n    const features = await this.getFeatures(renderProps)\n\n    const { makeImageData } = await import('./makeImageData')\n    const res = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      makeImageData(ctx, {\n        ...renderProps,\n        yScalar: height / Math.max(height, hyp),\n        features,\n        pluginManager: this.pluginManager,\n      }),\n    )\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      region: renderProps.regions[0],\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      height,\n      width,\n    }\n  }\n\n  async getFeatures(args: RenderArgsDeserialized) {\n    const { regions, sessionId, adapterConfig } = args\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const features = await firstValueFrom(\n      (dataAdapter as BaseFeatureDataAdapter)\n        .getFeatures(regions[0]!, args)\n        .pipe(toArray()),\n    )\n\n    // cast to any to avoid return-type conflict, because the types of features\n    // returned by our getFeatures are quite different from the base interface\n    return features as any\n  }\n}\n\nexport type {\n  RenderArgsSerialized,\n  RenderResults,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\n","import { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nimport type { Region } from '@jbrowse/core/util/types'\n\nconst HicRendering = observer(function HicRendering(props: {\n  blockKey: string\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n}) {\n  const { width, height } = props\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div style={{ position: 'relative', width: canvasWidth, height }}>\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n    </div>\n  )\n})\n\nexport default HicRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HicRenderer\n * #category renderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicRenderer = ConfigurationSchema(\n  'HicRenderer',\n  {\n    /**\n     * #slot\n     */\n    baseColor: {\n      type: 'color',\n      description: 'base color to be used in the hic alignment',\n      defaultValue: '#f00',\n    },\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a hic alignment',\n      defaultValue: 'jexl:interpolate(count,scale)',\n      contextVariable: ['count', 'maxScore', 'baseColor', 'scale'],\n    },\n\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a hic rendering',\n      defaultValue: 600,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HicRenderer\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getContainingTrack, getSession } from '@jbrowse/core/util'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { autorun } from 'mobx'\nimport { addDisposer, getEnv, types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearHicDisplay\n * #category display\n * extends `BaseLinearDisplay`\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function stateModelFactory(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearHicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearHicDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        resolution: types.optional(types.number, 1),\n        /**\n         * #property\n         */\n        useLogScale: false,\n        /**\n         * #property\n         */\n        colorScheme: types.maybe(types.string),\n        /**\n         * #property\n         */\n        activeNormalization: 'KR',\n        /**\n         * #property\n         */\n        mode: 'triangular',\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      availableNormalizations: undefined as string[] | undefined,\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #getter\n         */\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return 'HicRenderer'\n        },\n        /**\n         * #method\n         */\n        renderProps() {\n          const config = self.rendererType.configSchema.create(\n            {\n              ...getConf(self, 'renderer'),\n\n              // add specific jexl color callback when using pre-defined color schemes\n              ...(self.colorScheme\n                ? { color: 'jexl:interpolate(count,scale)' }\n                : {}),\n            },\n            getEnv(self),\n          )\n\n          return {\n            ...superRenderProps(),\n            config,\n            displayHeight: self.mode === 'adjust' ? self.height : undefined,\n            normalization: self.activeNormalization,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            resolution: self.resolution,\n            useLogScale: self.useLogScale,\n            colorScheme: self.colorScheme,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setResolution(n: number) {\n        self.resolution = n\n      },\n      /**\n       * #action\n       */\n      setUseLogScale(f: boolean) {\n        self.useLogScale = f\n      },\n      /**\n       * #action\n       */\n      setColorScheme(f?: string) {\n        self.colorScheme = f\n      },\n      /**\n       * #action\n       */\n      setActiveNormalization(f: string) {\n        self.activeNormalization = f\n      },\n      /**\n       * #action\n       */\n      setAvailableNormalizations(f: string[]) {\n        self.availableNormalizations = f\n      },\n      /**\n       * #action\n       */\n      setMode(arg: string) {\n        self.mode = arg\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Use log scale',\n              type: 'checkbox',\n              checked: self.useLogScale,\n              onClick: () => {\n                self.setUseLogScale(!self.useLogScale)\n              },\n            },\n            {\n              label: 'Rendering mode',\n              type: 'subMenu',\n              subMenu: [\n                {\n                  label: 'Triangular',\n                  type: 'radio',\n                  checked: self.mode === 'triangular',\n                  onClick: () => {\n                    self.setMode('triangular')\n                  },\n                },\n                {\n                  label: 'Adjust to height of display',\n                  type: 'radio',\n                  checked: self.mode === 'adjust',\n                  onClick: () => {\n                    self.setMode('adjust')\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Color scheme',\n              type: 'subMenu',\n              subMenu: [\n                {\n                  label: 'Fall',\n                  type: 'radio',\n                  checked: self.colorScheme === 'fall',\n                  onClick: () => {\n                    self.setColorScheme('fall')\n                  },\n                },\n                {\n                  label: 'Viridis',\n                  type: 'radio',\n                  checked: self.colorScheme === 'viridis',\n                  onClick: () => {\n                    self.setColorScheme('viridis')\n                  },\n                },\n                {\n                  label: 'Juicebox',\n                  type: 'radio',\n                  checked: self.colorScheme === 'juicebox',\n                  onClick: () => {\n                    self.setColorScheme('juicebox')\n                  },\n                },\n                {\n                  label: 'Default',\n                  type: 'radio',\n                  checked: self.colorScheme === undefined,\n                  onClick: () => {\n                    self.setColorScheme(undefined)\n                  },\n                },\n              ],\n            },\n\n            {\n              label: 'Resolution',\n              subMenu: [\n                {\n                  label: 'Finer resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution * 2)\n                  },\n                },\n                {\n                  label: 'Coarser resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution / 2)\n                  },\n                },\n              ],\n            },\n            ...(self.availableNormalizations\n              ? [\n                  {\n                    label: 'Normalization scheme',\n                    subMenu: self.availableNormalizations.map(norm => ({\n                      label: norm,\n                      type: 'radio',\n                      checked: norm === self.activeNormalization,\n                      onClick: () => {\n                        self.setActiveNormalization(norm)\n                      },\n                    })),\n                  },\n                ]\n              : []),\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(async () => {\n            try {\n              const { rpcManager } = getSession(self)\n              const track = getContainingTrack(self)\n              const adapterConfig = getConf(track, 'adapter')\n              const { norms } = (await rpcManager.call(\n                getConf(track, 'trackId'),\n                'CoreGetInfo',\n                {\n                  adapterConfig,\n                },\n              )) as { norms?: string[] }\n              if (norms) {\n                self.setAvailableNormalizations(norms)\n              }\n            } catch (e) {\n              console.error(e)\n              getSession(self).notifyError(`${e}`, e)\n            }\n          }),\n        )\n      },\n    }))\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport { colord } from '@jbrowse/core/util/colord'\n\nimport GuessAdapterF from './GuessAdapter'\nimport HicAdapterF from './HicAdapter'\nimport HicRendererF from './HicRenderer'\nimport HicTrackF from './HicTrack'\nimport LinearHicDisplayF from './LinearHicDisplay'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Colord } from '@jbrowse/core/util/colord'\n\nexport default class HicPlugin extends Plugin {\n  name = 'HicPlugin'\n\n  install(pluginManager: PluginManager) {\n    HicAdapterF(pluginManager)\n    HicRendererF(pluginManager)\n    HicTrackF(pluginManager)\n    LinearHicDisplayF(pluginManager)\n    GuessAdapterF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    const { jexl } = pluginManager\n    jexl.addFunction('alpha', (color: Colord, n: number) => color.alpha(n))\n    jexl.addFunction('hsl', (color: Colord) => colord(color.toHsl()))\n    jexl.addFunction('colorString', (color: Colord) => color.toHex())\n    jexl.addFunction(\n      'interpolate',\n      (count: number, scale: (n: number) => string) => scale(count),\n    )\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function HicAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'HicAdapter',\n        displayName: 'Hi-C adapter',\n        configSchema,\n        getAdapterClass: () => import('./HicAdapter').then(r => r.default),\n      }),\n  )\n}\n","import HicRenderer from './HicRenderer'\nimport ReactComponent from './components/HicRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function HicRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new HicRenderer({\n        name: 'HicRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function HicTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'HicTrack',\n      displayName: 'Hi-C track',\n      configSchema,\n      stateModel: createBaseTrackModel(pluginManager, 'HicTrack', configSchema),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config HicTrack\n * #category track\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'HicTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport configSchemaFactory from './configSchema'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearHicDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearHicDisplay',\n      displayName: 'Hi-C contact matrix display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'HicTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #config LinearHicDisplay\n * #category display\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicTrackConfigFactory = (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'LinearHicDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.getRendererType('HicRenderer')!.configSchema,\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type HicTrackConfigModel = ReturnType<typeof HicTrackConfigFactory>\nexport type HicTrackConfig = Instance<HicTrackConfigModel>\nexport default HicTrackConfigFactory\n","import { getFileName } from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessAdapterF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        return (/\\.hic$/i.test(fileName) && !adapterHint) ||\n          adapterHint === 'HicAdapter'\n          ? {\n              type: 'HicAdapter',\n              hicLocation: file,\n            }\n          : adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) =>\n        adapterName === 'HicAdapter'\n          ? 'HicTrack'\n          : trackTypeGuesser(adapterName)\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\n\n/**\n * #stateModel\n */\nexport const Job = types\n  .model('Job', {\n    /**\n     * #property\n     */\n    name: types.string,\n    /**\n     * #property\n     */\n    statusMessage: types.maybe(types.string),\n    /**\n     * #property\n     */\n    progressPct: types.number,\n  })\n  .volatile(() => ({\n    cancelCallback() {},\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setCancelCallback(cancelCallback: () => void) {\n      self.cancelCallback = cancelCallback\n    },\n\n    /**\n     * #action\n     */\n    setStatusMessage(message?: string) {\n      self.statusMessage = message\n    },\n\n    /**\n     * #action\n     */\n    setProgressPct(pct: number) {\n      self.progressPct = pct\n    },\n  }))\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nimport { stateModelFactory } from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nexport const configSchema = ConfigurationSchema('JobsListWidget', {})\n\nexport default function JobsListWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'JobsListWidget',\n      heading: 'Jobs list',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/JobsListWidget')),\n    })\n  })\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport { Indexing } from '@jbrowse/core/ui/Icons'\nimport {\n  isAbstractMenuManager,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\n\nimport JobsListWidgetF from './JobsListWidget'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { SessionWithWidgets } from '@jbrowse/core/util'\n\nexport default class JobsManagementPlugin extends Plugin {\n  name = 'JobsManagementPlugin'\n\n  install(pluginManager: PluginManager) {\n    JobsListWidgetF(pluginManager)\n  }\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Tools', {\n        label: 'Jobs list',\n        icon: Indexing, // TODO: pick a better icon\n        onClick: (session: SessionWithWidgets) => {\n          if (isSessionModelWithWidgets(session)) {\n            const { widgets } = session\n            let jobStatusWidget = widgets.get('JobsList')\n            if (!jobStatusWidget) {\n              jobStatusWidget = session.addWidget('JobsListWidget', 'JobsList')\n              session.showWidget(jobStatusWidget)\n            } else {\n              session.showWidget(jobStatusWidget)\n            }\n          }\n        },\n      })\n    }\n  }\n}\n","import { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport { Job } from './jobModel'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Instance, SnapshotIn } from 'mobx-state-tree'\n\nexport interface NewJob extends SnapshotIn<typeof Job> {\n  cancelCallback(): void\n  setStatusMessage(msg?: string): void\n}\n\n/**\n * #stateModel JobsListModel\n */\nexport function stateModelFactory(_pluginManager: PluginManager) {\n  return types\n    .model('JobsListModel', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('JobsListWidget'),\n      /**\n       * #property\n       */\n      jobs: types.array(Job),\n      /**\n       * #property\n       */\n      finished: types.array(Job),\n      /**\n       * #property\n       */\n      queued: types.array(Job),\n      /**\n       * #property\n       */\n      aborted: types.array(Job),\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addJob(job: NewJob) {\n        const { cancelCallback, name } = job\n        const existing = self.jobs.find(job => job.name === name)\n        if (existing) {\n          return existing\n        }\n        const length = self.jobs.push(job)\n        const addedJob = self.jobs[length - 1]!\n        addedJob.setCancelCallback(cancelCallback)\n        return addedJob\n      },\n      /**\n       * #action\n       */\n      removeJob(jobName: string) {\n        const indx = self.jobs.findIndex(job => job.name === jobName)\n        if (indx === -1) {\n          return undefined\n        }\n        const removed = self.jobs.splice(indx, 1)\n        return removed[0]\n      },\n      /**\n       * #action\n       */\n      addFinishedJob(job: NewJob) {\n        const existing = self.finished.find(\n          finishedJob => finishedJob.name === job.name,\n        )\n        if (existing) {\n          return existing\n        }\n        const length = self.finished.push(job)\n        return self.finished[length - 1]\n      },\n      /**\n       * #action\n       */\n      addQueuedJob(job: NewJob) {\n        const existing = self.queued.find(\n          queuedJob => queuedJob.name === job.name,\n        )\n        if (existing) {\n          return existing\n        }\n        const length = self.queued.push(job)\n        return self.queued[length - 1]\n      },\n      /**\n       * #action\n       */\n      addAbortedJob(job: NewJob) {\n        const existing = self.aborted.find(\n          abortedJob => abortedJob.name === job.name,\n        )\n        if (existing) {\n          return existing\n        }\n        const length = self.aborted.push(job)\n        return self.aborted[length - 1]\n      },\n      /**\n       * #action\n       */\n      removeQueuedJob(jobName: string) {\n        const indx = self.queued.findIndex(job => job.name === jobName)\n        if (indx === -1) {\n          return undefined\n        }\n        const removed = self.queued.splice(indx, 1)\n        return removed[0]\n      },\n      /**\n       * #action\n       */\n      updateJobStatusMessage(jobName: string, message?: string) {\n        const job = self.jobs.find(job => job.name === jobName)\n        if (!job) {\n          throw new Error(`No job found with name ${jobName}`)\n        }\n        job.setStatusMessage(message)\n      },\n      /**\n       * #action\n       */\n      updateJobProgressPct(jobName: string, pct: number) {\n        const job = self.jobs.find(job => job.name === jobName)\n        if (!job) {\n          throw new Error(`No job found with name ${jobName}`)\n        }\n        job.setProgressPct(pct)\n      },\n    }))\n}\n\nexport type JobsListStateModel = ReturnType<typeof stateModelFactory>\nexport type JobsListModel = Instance<JobsListStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config JBrowse1Connection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst JBrowse1Connection = ConfigurationSchema(\n  'JBrowse1Connection',\n  {\n    /**\n     * #slot\n     */\n    dataDirLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/jbrowse/data/',\n        locationType: 'UriLocation',\n      },\n      description:\n        'the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      description:\n        'name of the assembly the connection belongs to, should be a single entry',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseConnectionConfig,\n  },\n)\n\nexport default JBrowse1Connection\n","import {\n  ConfigurationReference,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'JBrowse1Connection',\n      BaseConnectionModelFactory(pluginManager),\n      types.model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('JBrowse1Connection'),\n      }),\n    )\n\n    .actions(self => ({\n      async connect() {\n        const session = getSession(self)\n        try {\n          const dataDirLocation = getConf(self, 'dataDirLocation')\n          const { fetchJb1 } = await import('./jb1ConfigLoad')\n          const { convertTrackConfig } = await import('./jb1ToJb2')\n          const config = await fetchJb1(dataDirLocation)\n          const assemblyName = getConf(self, 'assemblyNames')[0]\n          if (!assemblyName) {\n            throw new Error('assembly name required for JBrowse 1 connection')\n          }\n          const conf = session.assemblies.find(\n            a => readConfObject(a, 'name') === assemblyName,\n          )\n          if (!conf) {\n            throw new Error(`Assembly \"${assemblyName}\" not found`)\n          }\n          const sequenceAdapter = readConfObject(conf, ['sequence', 'adapter'])\n\n          // @ts-expect-error\n          const jb2Tracks = config.tracks?.map(jb1Track => ({\n            ...convertTrackConfig(\n              jb1Track,\n              config.dataRoot || '',\n              sequenceAdapter,\n            ),\n            assemblyNames: [assemblyName],\n          }))\n\n          self.setTrackConfs(jb2Tracks)\n        } catch (error) {\n          console.error(error)\n          session.notifyError(\n            `There was a problem connecting to the JBrowse 1 data directory \"${self.name}\". Please make sure you have entered a valid location. The error that was thrown is: \"${error}\"`,\n            error,\n          )\n          session.breakConnection?.(self.configuration)\n        }\n      },\n    }))\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config JBrowse1TextSearchAdapter\n * note: metadata about tracks and assemblies covered by text search adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'JBrowse1TextSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    namesIndexLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/volvox/names', locationType: 'UriLocation' },\n      description: 'the location of the JBrowse1 names index data directory',\n    },\n    /**\n     * #slot\n     */\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'textSearchAdapterId',\n  },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config NCListAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst NCListAdapter = ConfigurationSchema(\n  'NCListAdapter',\n  {\n    /**\n     * #slot\n     */\n    rootUrlTemplate: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/{refseq}/trackData.json',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of refNames used by the NCList used for aliasing',\n    },\n  },\n  {\n    explicitlyTyped: true,\n  },\n)\nexport default NCListAdapter\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport GuessNCListF from './GuessNCList'\nimport JBrowse1ConnectionF from './JBrowse1Connection'\nimport JBrowse1TextSearchAdapterF from './JBrowse1TextSearchAdapter'\nimport NCListAdapterF from './NCListAdapter'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class LegacyJBrowsePlugin extends Plugin {\n  name = 'LegacyJBrowsePlugin'\n\n  install(pluginManager: PluginManager) {\n    NCListAdapterF(pluginManager)\n    GuessNCListF(pluginManager)\n    JBrowse1TextSearchAdapterF(pluginManager)\n    JBrowse1ConnectionF(pluginManager)\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function NCListAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'NCListAdapter',\n        displayName: 'NCList adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Uncommon',\n        },\n        getAdapterClass: () => import('./NCListAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { getFileName } from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AdapterGuesser } from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessNCListF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const fileName = getFileName(file)\n        return (/trackData.jsonz?$/i.test(fileName) && !adapterHint) ||\n          adapterHint === 'NCListAdapter'\n          ? {\n              type: 'NCListAdapter',\n              rootUrlTemplate: file,\n            }\n          : adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n}\n","import TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function JBrowse1TextSearchAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addTextSearchAdapterType(\n    () =>\n      new TextSearchAdapterType({\n        name: 'JBrowse1TextSearchAdapter',\n        configSchema,\n        description: 'A JBrowse 1 text search adapter',\n        getAdapterClass: () =>\n          import('./JBrowse1TextSearchAdapter').then(t => t.default),\n      }),\n  )\n}\n","import ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\n\nimport configSchema from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function JBrowse1ConnectionF(pluginManager: PluginManager) {\n  pluginManager.addConnectionType(\n    () =>\n      new ConnectionType({\n        name: 'JBrowse1Connection',\n        configSchema,\n        stateModel: modelFactory(pluginManager),\n        displayName: 'JBrowse 1 Data',\n        description: 'A JBrowse 1 data directory',\n        url: '//jbrowse.org/',\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearPileupDisplayConfigSchemaFactory } from '@jbrowse/plugin-alignments'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Feature } from '@jbrowse/core/util'\n\n/**\n * #config LGVSyntenyDisplay\n * extends config\n * - [LinearPileupDisplay](../linearpileupdisplay)\n */\nfunction configSchemaF(pluginManager: PluginManager) {\n  pluginManager.jexl.addFunction('lgvSyntenyTooltip', (f: Feature) => {\n    const m = f.get('mate')\n    return [f.get('name') || f.get('id'), m?.name || m?.id]\n      .filter(f => !!f)\n      .join('<br/>')\n  })\n  return ConfigurationSchema(\n    'LGVSyntenyDisplay',\n    {\n      mouseover: {\n        type: 'string',\n        defaultValue: 'jexl:lgvSyntenyTooltip(feature)',\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearPileupDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import { lazy } from 'react'\n\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { SharedLinearPileupDisplayMixin } from '@jbrowse/plugin-alignments'\nimport { types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nconst LaunchSyntenyViewDialog = lazy(\n  () => import('./components/LaunchSyntenyViewDialog'),\n)\n\n/**\n * #stateModel LGVSyntenyDisplay\n * displays location of \"synteny\" feature in a plain LGV, allowing linking out\n * to external synteny views\n *\n * extends\n * - [SharedLinearPileupDisplayMixin](../sharedlinearpileupdisplaymixin)\n */\nfunction stateModelFactory(schema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LGVSyntenyDisplay',\n      SharedLinearPileupDisplayMixin(schema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LGVSyntenyDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(schema),\n      }),\n    )\n    .views(self => {\n      const superContextMenuItems = self.contextMenuItems\n      return {\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          const feature = self.contextMenuFeature\n          return [\n            ...superContextMenuItems(),\n            ...(feature\n              ? [\n                  {\n                    label: 'Launch synteny view for this position',\n                    onClick: () => {\n                      getSession(self).queueDialog(handleClose => [\n                        LaunchSyntenyViewDialog,\n                        {\n                          view: getContainingView(self) as LGV,\n                          trackId: getConf(getContainingTrack(self), 'trackId'),\n                          handleClose,\n                          session: getSession(self),\n                          feature,\n                        },\n                      ])\n                    },\n                  },\n                ]\n              : []),\n          ]\n        },\n      }\n    })\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        colorSchemeSubMenuItems: superColorSchemeSubMenuItems,\n      } = self\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Color scheme',\n              subMenu: [...superColorSchemeSubMenuItems()],\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const r2 = getContainingView(self)\n          let r3 = r2\n          try {\n            r3 = getContainingView(r3)\n          } catch (e) {}\n          const featureWidget = session.addWidget(\n            'SyntenyFeatureWidget',\n            'syntenyFeature',\n            {\n              featureData: feature.toJSON(),\n              view: r3,\n              track: getContainingTrack(self),\n            },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n      /**\n       * #autorun\n       */\n      afterCreate() {\n        // use color by stand to help indicate inversions better on first load,\n        // otherwise use selected orientation\n        if (!self.colorBySetting && self.colorBy.type === 'normal') {\n          self.setColorScheme({ type: 'strand' })\n        }\n      },\n    }))\n}\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config LinearComparativeDisplay\n */\nfunction configSchemaFactory(_pluginManager: any) {\n  return ConfigurationSchema(\n    'LinearComparativeDisplay',\n    {},\n    {\n      explicitlyTyped: true,\n\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'displayId',\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  dedupe,\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { stopStopToken } from '@jbrowse/core/util/stopToken'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getParent, getSnapshot, types } from 'mobx-state-tree'\n\nimport type { LinearComparativeViewModel } from '../LinearComparativeView/model'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel LinearComparativeDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearComparativeDisplay',\n      BaseDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearComparativeDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile((/* self */) => ({\n      /**\n       * #volatile\n       */\n      renderInProgress: undefined as string | undefined,\n      /**\n       * #volatile\n       */\n      features: undefined as Feature[] | undefined,\n      /**\n       * #volatile\n       */\n      message: undefined as string | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get level() {\n        return getParent<{ height: number; level: number }>(self, 4).level\n      },\n      /**\n       * #getter\n       */\n      get height() {\n        return getParent<{ height: number; level: number }>(self, 4).height\n      },\n      /**\n       * #getter\n       */\n      renderProps() {\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          highResolutionScaling: 2,\n        }\n      },\n    }))\n    .actions(self => {\n      let stopToken: undefined | string\n\n      return {\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setLoading(newStopToken: string) {\n          self.message = undefined\n          self.error = undefined\n          stopToken = newStopToken\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setMessage(messageText: string) {\n          self.message = messageText\n          self.error = undefined\n          stopToken = undefined\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setRendered(args?: { features: Feature[] }) {\n          if (!args) {\n            return\n          }\n          const { features } = args\n          const existingFeatures = self.features || []\n\n          const featIds = new Set(existingFeatures.map(f => f.id()))\n          const newFeatIds = new Set(features.map(f => f.id()))\n\n          let foundNewFeatureNotInExistingMap = false\n          let foundExistingFeatureNotInNewMap = false\n          for (const feat of features) {\n            if (!featIds.has(feat.id())) {\n              foundNewFeatureNotInExistingMap = true\n              break\n            }\n          }\n          for (const existingFeat of existingFeatures) {\n            if (!newFeatIds.has(existingFeat.id())) {\n              foundExistingFeatureNotInNewMap = true\n              break\n            }\n          }\n\n          self.message = undefined\n          self.error = undefined\n          stopToken = undefined\n\n          if (\n            foundNewFeatureNotInExistingMap ||\n            foundExistingFeatureNotInNewMap ||\n            !self.features\n          ) {\n            self.features = features\n          }\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setError(error: unknown) {\n          console.error(error)\n          if (stopToken !== undefined) {\n            stopStopToken(stopToken)\n          }\n          // the rendering failed for some reason\n          self.message = undefined\n          self.error = error\n          stopToken = undefined\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        makeAbortableReaction(\n          // @ts-expect-error\n          self,\n          renderBlockData,\n          renderBlockEffect,\n          {\n            name: `${self.type} ${self.id} rendering`,\n            delay: 1000,\n            fireImmediately: true,\n          },\n          self.setLoading,\n          self.setRendered,\n          self.setError,\n        )\n      },\n    }))\n}\nfunction renderBlockData(self: LinearComparativeDisplay) {\n  const { rpcManager } = getSession(self)\n  const display = self\n\n  // Alternative to readConfObject(config) is below used because\n  // renderProps is something under our control.  Compare to\n  // serverSideRenderedBlock\n  readConfObject(self.configuration)\n\n  const { level, adapterConfig } = self\n  const parent = getContainingView(self) as LinearComparativeViewModel\n  const sessionId = getRpcSessionId(self)\n  getSnapshot(parent)\n  return parent.initialized\n    ? {\n        rpcManager,\n        renderProps: {\n          ...display.renderProps(),\n          level,\n          view: parent,\n          adapterConfig,\n          sessionId,\n          timeout: 1000000,\n          self,\n        },\n      }\n    : undefined\n}\n\nasync function renderBlockEffect(props: ReturnType<typeof renderBlockData>) {\n  if (!props) {\n    return\n  }\n\n  const { rpcManager, renderProps } = props\n  const { adapterConfig, level } = renderProps\n  const view = renderProps.view.views[level]\n  const features = (await rpcManager.call('getFeats', 'CoreGetFeatures', {\n    regions: view.staticBlocks.contentBlocks,\n    sessionId: 'getFeats',\n    adapterConfig,\n  })) as Feature[]\n\n  return {\n    features: dedupe(features, f => f.id()),\n  }\n}\n\nexport default stateModelFactory\nexport type LinearComparativeDisplayModel = ReturnType<typeof stateModelFactory>\nexport type LinearComparativeDisplay = Instance<LinearComparativeDisplayModel>\n","import { lazy } from 'react'\n\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { avg, getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport { autorun } from 'mobx'\nimport { addDisposer, cast, getPath, onAction, types } from 'mobx-state-tree'\n\nimport type { LinearSyntenyViewHelperStateModel } from '../LinearSyntenyViewHelper/stateModelFactory'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance, SnapshotIn } from 'mobx-state-tree'\n\n// lazies\nconst ReturnToImportFormDialog = lazy(\n  () => import('@jbrowse/core/ui/ReturnToImportFormDialog'),\n)\n\n/**\n * #stateModel LinearComparativeView\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  const LinearSyntenyViewHelper = pluginManager.getViewType(\n    'LinearSyntenyViewHelper',\n  )?.stateModel as LinearSyntenyViewHelperStateModel\n  return types\n    .compose(\n      'LinearComparativeView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('LinearComparativeView'),\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        showIntraviewLinks: true,\n        /**\n         * #property\n         */\n        linkViews: false,\n        /**\n         * #property\n         */\n        interactiveOverlay: false,\n        /**\n         * #property\n         */\n        levels: types.array(LinearSyntenyViewHelper),\n        /**\n         * #property\n         * currently this is limited to an array of two\n         */\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')!\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n\n        /**\n         * #property\n         * this represents tracks specific to this view specifically used for\n         * read vs ref dotplots where this track would not really apply\n         * elsewhere\n         */\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      width: undefined as number | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get initialized() {\n        return (\n          // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n          self.width !== undefined &&\n          self.views.length > 0 &&\n          self.views.every(view => view.initialized)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get refNames() {\n        return self.views.map(v => [\n          ...new Set(v.staticBlocks.map(m => m.refName)),\n        ])\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        return [...new Set(self.views.flatMap(v => v.assemblyNames))]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // doesn't link showTrack/hideTrack, doesn't make sense in\n        // synteny views most time\n        const actions = new Set([\n          'horizontalScroll',\n          'zoomTo',\n          'setScaleFactor',\n        ])\n        addDisposer(\n          self,\n          onAction(self, param => {\n            if (self.linkViews) {\n              const { name, path, args } = param\n              if (actions.has(name) && path) {\n                this.onSubviewAction(name, path, args)\n              }\n            }\n          }),\n        )\n      },\n\n      // automatically removes session assemblies associated with this view\n      // e.g. read vs ref\n      beforeDestroy() {\n        const session = getSession(self)\n        for (const name of self.assemblyNames) {\n          session.removeTemporaryAssembly?.(name)\n        }\n      },\n\n      onSubviewAction(actionName: string, path: string, args?: unknown[]) {\n        for (const view of self.views) {\n          const ret = getPath(view)\n          if (!ret.endsWith(path)) {\n            // @ts-expect-error\n            view[actionName](args?.[0])\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.width = newWidth\n      },\n\n      /**\n       * #action\n       */\n      setViews(views: SnapshotIn<LinearGenomeViewModel>[]) {\n        self.views = cast(views)\n        const levels = []\n        for (let i = 0; i < views.length - 1; i++) {\n          levels.push({ level: i })\n        }\n        self.levels = cast(levels)\n      },\n\n      /**\n       * #action\n       */\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      /**\n       * #action\n       */\n      setLevelHeight(newHeight: number, level = 0) {\n        const l = self.levels[level]!\n        l.setHeight(newHeight)\n        return l.height\n      },\n      /**\n       * #action\n       */\n      setLinkViews(arg: boolean) {\n        self.linkViews = arg\n      },\n      /**\n       * #action\n       */\n      activateTrackSelector(level: number) {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              {\n                view: self.levels[level],\n              },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string, level = 0) {\n        self.levels[level]?.toggleTrack(trackId)\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, level = 0, initialSnapshot = {}) {\n        if (!self.levels[level]) {\n          self.levels[level] = cast({ level })\n        }\n        self.levels[level].showTrack(trackId, initialSnapshot)\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string, level = 0) {\n        self.levels[level]?.hideTrack(trackId)\n      },\n      /**\n       * #action\n       */\n      squareView() {\n        const average = avg(self.views.map(v => v.bpPerPx))\n        for (const view of self.views) {\n          const center = view.pxToBp(view.width / 2)\n          view.setNewView(average, view.offsetPx)\n          if (center.refName) {\n            view.centerAt(center.coord, center.refName, center.index)\n          }\n        }\n      },\n      /**\n       * #action\n       */\n      clearView() {\n        self.views = cast([])\n        self.levels = cast([])\n      },\n    }))\n    .views(() => ({\n      /**\n       * #method\n       * includes a subset of view menu options because the full list is a\n       * little overwhelming. overridden by subclasses\n       */\n      headerMenuItems(): MenuItem[] {\n        return []\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems(): MenuItem[] {\n        return [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                {\n                  model: self,\n                  handleClose,\n                },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n        ]\n      },\n      /**\n       * #method\n       */\n      rubberBandMenuItems() {\n        return [\n          {\n            label: 'Zoom to region(s)',\n            onClick: () => {\n              for (const view of self.views) {\n                const { leftOffset, rightOffset } = view\n                if (leftOffset && rightOffset) {\n                  view.moveTo(leftOffset, rightOffset)\n                }\n              }\n            },\n          },\n        ]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (self.width) {\n              for (const view of self.views) {\n                view.setWidth(self.width)\n              }\n            }\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // @ts-expect-error\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      const { tracks, levels = [{ tracks, level: 0 }], ...rest } = snap || {}\n      return {\n        ...rest,\n        levels,\n      }\n    })\n}\n\nexport type LinearComparativeViewStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearComparativeViewModel =\n  Instance<LinearComparativeViewStateModel>\n\nexport default stateModelFactory\n","import { lazy } from 'react'\n\nimport { getContainingTrack, getSession } from '@jbrowse/core/util'\nimport AddIcon from '@mui/icons-material/Add'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\nimport type DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nconst ReadVsRefDialog = lazy(() => import('./LinearReadVsRef'))\n\nfunction isDisplay(elt: { name: string }): elt is DisplayType {\n  return elt.name === 'LinearPileupDisplay'\n}\n\nexport default function LinearReadVsRefMenuItemF(pm: PluginManager) {\n  pm.addToExtensionPoint(\n    'Core-extendPluggableElement',\n    (pluggableElement: PluggableElementType) => {\n      if (!isDisplay(pluggableElement)) {\n        return pluggableElement\n      }\n      pluggableElement.stateModel = pluggableElement.stateModel.extend(self => {\n        const superContextMenuItems = self.contextMenuItems\n        return {\n          views: {\n            contextMenuItems() {\n              const feature = self.contextMenuFeature\n              const track = getContainingTrack(self)\n              return [\n                ...superContextMenuItems(),\n                ...(feature\n                  ? [\n                      {\n                        label: 'Linear read vs ref',\n                        icon: AddIcon,\n                        onClick: () => {\n                          getSession(self).queueDialog(handleClose => [\n                            ReadVsRefDialog,\n                            {\n                              track,\n                              feature,\n                              handleClose,\n                            },\n                          ])\n                        },\n                      },\n                    ]\n                  : []),\n              ]\n            },\n          },\n        }\n      })\n      return pluggableElement\n    },\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport baseModelFactory from '../LinearComparativeDisplay/stateModelFactory'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { Instance } from 'mobx-state-tree'\n\ninterface Pos {\n  offsetPx: number\n}\n\nexport interface FeatPos {\n  p11: Pos\n  p12: Pos\n  p21: Pos\n  p22: Pos\n  f: Feature\n  cigar: string[]\n}\n\n/**\n * #stateModel LinearSyntenyDisplay\n * extends\n * - [LinearComparativeDisplay](../linearcomparativedisplay)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearSyntenyDisplay',\n      baseModelFactory(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSyntenyDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       * canvas used for drawing visible screen\n       */\n      mainCanvas: null as HTMLCanvasElement | null,\n\n      /**\n       * #volatile\n       * canvas used for drawing click map with feature ids this renders a\n       * unique color per alignment, so that it can be re-traced after a\n       * feature click with getImageData at that pixel\n       */\n      clickMapCanvas: null as HTMLCanvasElement | null,\n\n      /**\n       * #volatile\n       * canvas used for drawing click map with cigar data this can show if you\n       * are mousing over a insertion/deletion. it is similar in purpose to the\n       * clickMapRef but was not feasible to pack this into the clickMapRef\n       */\n      cigarClickMapCanvas: null as HTMLCanvasElement | null,\n\n      /**\n       * #volatile\n       * canvas for drawing mouseover shading this is separate from the other\n       * code for speed: don't have to redraw entire canvas to do a feature's\n       * mouseover shading\n       */\n      mouseoverCanvas: null as HTMLCanvasElement | null,\n\n      /**\n       * #volatile\n       * assigned by reaction\n       */\n      featPositions: [] as FeatPos[],\n\n      /**\n       * #volatile\n       * currently mouse'd over feature\n       */\n      mouseoverId: undefined as string | undefined,\n\n      /**\n       * #volatile\n       * currently click'd over feature\n       */\n      clickId: undefined as string | undefined,\n\n      /**\n       * #volatile\n       * currently mouseover'd CIGAR subfeature\n       */\n      cigarMouseoverId: -1,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFeatPositions(arg: FeatPos[]) {\n        self.featPositions = arg\n      },\n      /**\n       * #action\n       */\n      setMainCanvasRef(ref: HTMLCanvasElement | null) {\n        self.mainCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setClickMapCanvasRef(ref: HTMLCanvasElement | null) {\n        self.clickMapCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setCigarClickMapCanvasRef(ref: HTMLCanvasElement | null) {\n        self.cigarClickMapCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setMouseoverCanvasRef(ref: HTMLCanvasElement | null) {\n        self.mouseoverCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setMouseoverId(arg?: string) {\n        self.mouseoverId = arg\n      },\n      /**\n       * #action\n       */\n      setCigarMouseoverId(arg: number) {\n        self.cigarMouseoverId = arg\n      },\n      /**\n       * #action\n       */\n      setClickId(arg?: string) {\n        self.clickId = arg\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get adapterConfig() {\n        return {\n          name: self.parentTrack.configuration.adapter.type,\n          assemblyNames: getConf(self, 'assemblyNames'),\n          ...getConf(self.parentTrack, 'adapter'),\n        }\n      },\n\n      /**\n       * #getter\n       */\n      get trackIds() {\n        return getConf(self, 'trackIds') as string[]\n      },\n\n      /**\n       * #getter\n       */\n      get numFeats() {\n        return self.featPositions.length\n      },\n\n      /**\n       * #getter\n       * used for synteny svg rendering\n       */\n      get ready() {\n        return this.numFeats > 0\n      },\n\n      /**\n       * #getter\n       */\n      get featMap() {\n        return Object.fromEntries(self.featPositions.map(f => [f.f.id(), f]))\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('./afterAttach')\n            doAfterAttach(self)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n    }))\n}\n\nexport type LinearSyntenyDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearSyntenyDisplayModel = Instance<LinearSyntenyDisplayStateModel>\n\nexport default stateModelFactory\n","import { SvgIcon } from '@mui/material'\n\nimport type { SvgIconProps } from '@mui/material'\n\nexport function Curves(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function StraightLines(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M22 12L17 22L7.1 6.04L4.24 12H2L7 2L16.9 17.96L19.76 12H22Z\"\n      />\n    </SvgIcon>\n  )\n}\n","import { lazy } from 'react'\n\nimport { getSession } from '@jbrowse/core/util'\nimport CropFreeIcon from '@mui/icons-material/CropFree'\nimport LinkIcon from '@mui/icons-material/Link'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport { saveAs } from 'file-saver'\nimport { observable, transaction } from 'mobx'\nimport { types } from 'mobx-state-tree'\n\nimport { Curves } from './components/Icons'\nimport baseModel from '../LinearComparativeView/model'\n\nimport type { ExportSvgOptions, ImportFormSyntenyTrack } from './types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\n\n/**\n * #stateModel LinearSyntenyView\n * extends\n * - [LinearComparativeView](../linearcomparativeview)\n */\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'LinearSyntenyView',\n      baseModel(pluginManager),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSyntenyView'),\n        /**\n         * #property/\n         */\n        drawCIGAR: true,\n        /**\n         * #property/\n         */\n        drawCIGARMatchesOnly: false,\n        /**\n         * #property\n         */\n        drawCurves: false,\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      importFormSyntenyTrackSelections:\n        observable.array<ImportFormSyntenyTrack>(),\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      importFormRemoveRow(idx: number) {\n        self.importFormSyntenyTrackSelections.splice(idx, 1)\n      },\n      /**\n       * #action\n       */\n      clearImportFormSyntenyTracks() {\n        self.importFormSyntenyTrackSelections.clear()\n      },\n      /**\n       * #action\n       */\n      setImportFormSyntenyTrack(arg: number, val: ImportFormSyntenyTrack) {\n        self.importFormSyntenyTrackSelections[arg] = val\n      },\n      /**\n       * #action\n       */\n      setDrawCurves(arg: boolean) {\n        self.drawCurves = arg\n      },\n      /**\n       * #action\n       */\n      setDrawCIGAR(arg: boolean) {\n        self.drawCIGAR = arg\n      },\n      /**\n       * #action\n       */\n      setDrawCIGARMatchesOnly(arg: boolean) {\n        self.drawCIGARMatchesOnly = arg\n      },\n      /**\n       * #action\n       */\n      showAllRegions() {\n        transaction(() => {\n          for (const view of self.views) {\n            view.showAllRegionsInAssembly()\n          }\n        })\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      async exportSvg(opts: ExportSvgOptions) {\n        const { renderToSvg } = await import(\n          './svgcomponents/SVGLinearSyntenyView'\n        )\n        const html = await renderToSvg(self as LinearSyntenyViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .views(self => {\n      const superHeaderMenuItems = self.headerMenuItems\n      const superMenuItems = self.menuItems\n      return {\n        /**\n         * #method\n         * includes a subset of view menu options because the full list is a\n         * little overwhelming\n         */\n        headerMenuItems() {\n          return [\n            ...superHeaderMenuItems(),\n            {\n              label: 'Square view',\n              onClick: self.squareView,\n              description:\n                'Makes both views use the same zoom level, adjusting to the average of each',\n              icon: CropFreeIcon,\n            },\n            {\n              label: 'Show all regions',\n              onClick: self.showAllRegions,\n              description: 'Show entire genome assemblies',\n              icon: VisibilityIcon,\n            },\n            {\n              label: 'Draw CIGAR',\n              checked: self.drawCIGAR,\n              type: 'checkbox',\n              description:\n                'If disabled, only draws the broad scale CIGAR match',\n              onClick: () => {\n                self.setDrawCIGAR(!self.drawCIGAR)\n              },\n            },\n            {\n              label: 'Draw only CIGAR matches',\n              checked: self.drawCIGARMatchesOnly,\n              type: 'checkbox',\n              description:\n                'If enabled, it hides the insertions and deletions in the CIGAR strings, helps with divergent',\n              onClick: () => {\n                self.setDrawCIGARMatchesOnly(!self.drawCIGARMatchesOnly)\n              },\n            },\n            {\n              label: 'Link views',\n              type: 'checkbox',\n              checked: self.linkViews,\n              icon: LinkIcon,\n              onClick: () => {\n                self.setLinkViews(!self.linkViews)\n              },\n            },\n            {\n              label: 'Use curved lines',\n              type: 'checkbox',\n              checked: self.drawCurves,\n              icon: Curves,\n              onClick: () => {\n                self.setDrawCurves(!self.drawCurves)\n              },\n            },\n            {\n              label: 'Export SVG',\n              icon: PhotoCameraIcon,\n              onClick: (): void => {\n                getSession(self).queueDialog(handleClose => [\n                  ExportSvgDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n          ]\n        },\n        /**\n         * #method\n         */\n        menuItems() {\n          return [\n            ...superMenuItems(),\n            {\n              label: 'Export SVG',\n              icon: PhotoCameraIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  ExportSvgDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n}\nexport type LinearSyntenyViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearSyntenyViewModel = Instance<LinearSyntenyViewStateModel>\n","import { ElementId } from '@jbrowse/core/util/types/mst'\nimport { transaction } from 'mobx'\nimport { getParent, getRoot, resolveIdentifier, types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport type { Instance } from 'mobx-state-tree'\n\nexport function linearSyntenyViewHelperModelFactory(\n  pluginManager: PluginManager,\n) {\n  return types\n    .model('LinearSyntenyViewHelper', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: 'LinearSyntenyViewHelper',\n      /**\n       * #property\n       */\n      tracks: types.array(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n      /**\n       * #property\n       */\n      height: 100,\n      /**\n       * #property\n       */\n      level: types.number,\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setHeight(n: number) {\n        self.height = n\n        return self.height\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(schema, getRoot(self), trackId)\n        if (!configuration) {\n          throw new Error(`track not found ${trackId}`)\n        }\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)!\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.has(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n\n        self.tracks.push(\n          trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [\n              {\n                type: displayConf.type,\n                configuration: displayConf,\n              },\n            ],\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const config = resolveIdentifier(schema, getRoot(self), trackId)\n        const shownTracks = self.tracks.filter(t => t.configuration === config)\n        transaction(() => {\n          for (const t of shownTracks) {\n            self.tracks.remove(t)\n          }\n        })\n        return shownTracks.length\n      },\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        const hiddenCount = this.hideTrack(trackId)\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n          return true\n        }\n        return false\n      },\n    }))\n    .views(self => ({\n      get assemblyNames() {\n        const p = getParent<{ views: LinearGenomeViewModel[] }>(self, 2)\n        return [\n          p.views[self.level]!.assemblyNames[0],\n          p.views[self.level + 1]!.assemblyNames[0],\n        ]\n      },\n    }))\n}\n\nexport type LinearSyntenyViewHelperStateModel = ReturnType<\n  typeof linearSyntenyViewHelperModelFactory\n>\nexport type LinearSyntenyViewHelperModel =\n  Instance<LinearSyntenyViewHelperStateModel>\n","import ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport { linearSyntenyViewHelperModelFactory } from './stateModelFactory'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nfunction UnusedComponent() {\n  return <div />\n}\n\nexport default function LinearSyntenyViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearSyntenyViewHelper',\n      displayName: 'Linear synteny view (helper)',\n      viewMetadata: {\n        hiddenFromGUI: true,\n      },\n      stateModel: linearSyntenyViewHelperModelFactory(pluginManager),\n      ReactComponent: UnusedComponent,\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport { stateModelFactory as BaseFeatureWidgetStateModelF } from '@jbrowse/core/BaseFeatureWidget'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('SyntenyFeatureWidget', {})\n\nfunction stateModelF(pluginManager: PluginManager) {\n  return types.compose(\n    BaseFeatureWidgetStateModelF(pluginManager),\n    types.model('SyntenyFeatureWidget', {\n      /**\n       * #property\n       */\n      type: types.literal('SyntenyFeatureWidget'),\n      /**\n       * #property\n       */\n      level: types.maybe(types.number),\n    }),\n  )\n}\n\nexport default function SyntenyFeatureWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'SyntenyFeatureWidget',\n        heading: 'Synteny feature details',\n        configSchema,\n        stateModel: stateModelF(pluginManager),\n        ReactComponent: lazy(() => import('./SyntenyFeatureDetail')),\n      }),\n  )\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport { isAbstractMenuManager } from '@jbrowse/core/util'\nimport CalendarIcon from '@mui/icons-material/CalendarViewDay'\n\nimport LGVSyntenyDisplayF from './LGVSyntenyDisplay'\nimport LaunchLinearSyntenyViewF from './LaunchLinearSyntenyView'\nimport LinearComparativeDisplayF from './LinearComparativeDisplay'\nimport LinearComparativeViewF from './LinearComparativeView'\nimport LinearReadVsRefMenuItemF from './LinearReadVsRef'\nimport LinearSyntenyDisplayF from './LinearSyntenyDisplay'\nimport LinearSyntenyViewF from './LinearSyntenyView'\nimport LinearSyntenyViewHelperF from './LinearSyntenyViewHelper'\nimport SyntenyFeatureWidgetF from './SyntenyFeatureDetail'\nimport SyntenyTrackF from './SyntenyTrack'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default class LinearComparativeViewPlugin extends Plugin {\n  name = 'LinearComparativeViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    LinearSyntenyViewHelperF(pluginManager)\n    LinearComparativeViewF(pluginManager)\n    LinearSyntenyViewF(pluginManager)\n    LinearComparativeDisplayF(pluginManager)\n    LinearSyntenyDisplayF(pluginManager)\n    SyntenyFeatureWidgetF(pluginManager)\n    LGVSyntenyDisplayF(pluginManager)\n    LaunchLinearSyntenyViewF(pluginManager)\n    SyntenyTrackF(pluginManager)\n    LinearReadVsRefMenuItemF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear synteny view',\n        icon: CalendarIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearSyntenyView', {})\n        },\n      })\n    }\n  }\n}\n","import { lazy } from 'react'\n\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearComparativeViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearComparativeView',\n      viewMetadata: {\n        hiddenFromGUI: true,\n      },\n      displayName: 'Linear comparative view',\n      stateModel: modelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearComparativeView')),\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearSyntenyViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearSyntenyView',\n      displayName: 'Linear synteny view',\n      stateModel: modelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearSyntenyView')),\n    })\n  })\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './configSchemaF'\nimport stateModelFactory from './stateModelFactory'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearComparativeDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearComparativeDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearComparativeView',\n      ReactComponent: () => {\n        return null\n      },\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaF from './configSchemaF'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearSyntenyDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearSyntenyDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearSyntenyViewHelper',\n      ReactComponent: lazy(() => import('./components/Component')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport baseConfigFactory from '../LinearComparativeDisplay/configSchemaF'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearSyntenyDisplay\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSyntenyDisplay',\n    {\n      /**\n       * #slot\n       * currently unused\n       */\n      trackIds: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n\n      /**\n       * #slot\n       * currently unused\n       */\n      middle: {\n        type: 'boolean',\n        defaultValue: true,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       * this refers to the LinearComparativeDisplay\n       */\n      baseConfiguration: baseConfigFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport configSchemaF from './configSchemaF'\nimport stateModelF from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LGVSyntenyDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    const stateModel = stateModelF(configSchema)\n    return new DisplayType({\n      name: 'LGVSyntenyDisplay',\n      configSchema,\n      stateModel,\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { notEmpty } from '@jbrowse/core/util'\nimport { when } from 'mobx'\n\nimport type { LinearSyntenyViewModel } from './LinearSyntenyView/model'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\ntype LSV = LinearSyntenyViewModel\n\ninterface ViewData {\n  loc: string\n  assembly: string\n  tracks?: string[]\n}\n\ntype MaybeString = string | undefined\n\nfunction makeMultiDimArray(str: string[] | string[][]) {\n  return Array.isArray(str[0]) ? (str as string[][]) : ([str] as string[][])\n}\n\nexport default function LaunchLinearSyntenyView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-LinearSyntenyView',\n    // @ts-expect-error\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: ViewData[]\n      tracks?: string[] | string[][]\n    }) => {\n      try {\n        const { assemblyManager } = session\n        const model = session.addView('LinearSyntenyView', {}) as LSV\n\n        await when(() => !!model.width)\n\n        model.setViews(\n          await Promise.all(\n            views.map(async view => {\n              const asm = await assemblyManager.waitForAssembly(view.assembly)\n              if (!asm) {\n                throw new Error(`Assembly ${view.assembly} failed to load`)\n              }\n              return {\n                type: 'LinearGenomeView' as const,\n                bpPerPx: 1,\n                offsetPx: 0,\n                hideHeader: true,\n                displayedRegions: asm.regions,\n              }\n            }),\n          ),\n        )\n\n        await Promise.all(model.views.map(view => when(() => view.initialized)))\n\n        let idsNotFound = [] as MaybeString[]\n        await Promise.all(\n          views.map(async (data, idx) => {\n            const view = model.views[idx]!\n            const { assembly, loc, tracks = [] } = data\n            const asm = await assemblyManager.waitForAssembly(assembly)\n            if (!asm) {\n              throw new Error(`Assembly ${data.assembly} failed to load`)\n            }\n            await view.navToSearchString({ input: loc, assembly: asm })\n            idsNotFound = [\n              ...idsNotFound,\n              ...tracks.map(trackId =>\n                tryTrackLGV({\n                  model: view,\n                  trackId,\n                }),\n              ),\n            ]\n          }),\n        )\n\n        idsNotFound = [\n          ...idsNotFound,\n          ...makeMultiDimArray(tracks).flatMap((trackSet, level) =>\n            trackSet.map(trackId =>\n              tryTrackSynteny({\n                model,\n                trackId,\n                level,\n              }),\n            ),\n          ),\n        ]\n\n        if (idsNotFound.filter(notEmpty).length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notifyError(`${e}`, e)\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrackLGV({\n  model,\n  trackId,\n}: {\n  model: {\n    showTrack: (arg: string) => void\n  }\n  trackId: string\n}) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (\n      /Could not resolve identifier/.exec(`${e}`) ||\n      /track not found/.exec(`${e}`)\n    ) {\n      return trackId\n    } else {\n      throw e\n    }\n  }\n  return undefined\n}\n\nfunction tryTrackSynteny({\n  model,\n  trackId,\n  level,\n}: {\n  model: {\n    showTrack: (arg: string, level?: number) => void\n  }\n  trackId: string\n  level: number\n}) {\n  try {\n    model.showTrack(trackId, level)\n  } catch (e) {\n    if (\n      /Could not resolve identifier/.exec(`${e}`) ||\n      /track not found/.exec(`${e}`)\n    ) {\n      return trackId\n    } else {\n      throw e\n    }\n  }\n  return undefined\n}\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function registerSyntenyTrack(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'SyntenyTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'SyntenyTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config SyntenyTrack\n * extends\n * - [BaseTrack](../basetrack)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'SyntenyTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearLollipopDisplay\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearLollipopDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearLollipopDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #getter\n         */\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        /**\n         * #getter\n         */\n        get renderDelay() {\n          return 500\n        },\n        /**\n         * #method\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\ninterface LayoutItem {\n  uniqueId: string\n  anchorLocation: number\n  width: number\n  height: number\n  data: { score: number }\n}\n\ntype LayoutEntry = LayoutItem & { x: number; y: number }\n\ntype LayoutMap = Map<string, LayoutEntry>\n\nexport class FloatingLayout {\n  width: number\n\n  totalHeight = 0\n\n  rectangles = new Map()\n  constructor({ width }: { width: number }) {\n    if (!width) {\n      throw new Error('width required to make a new FloatingLayout')\n    }\n    this.width = width\n  }\n  discardRange() {\n    /* do nothing */\n    this.items = []\n    this.layout = new Map()\n    this.totalHeight = 0\n  }\n\n  items: LayoutItem[] = []\n\n  layout: LayoutMap = new Map()\n\n  add(\n    uniqueId: string,\n    anchorLocation: number,\n    width: number,\n    height: number,\n    data: { score: number },\n  ) {\n    this.items.push({\n      uniqueId,\n      anchorLocation,\n      width,\n      height,\n      data,\n    })\n  }\n\n  /**\n   * @returns Map of `uniqueId => {x,y,anchorLocation,width,height,data}`\n   */\n  getLayout(configuration?: AnyConfigurationModel) {\n    if (!configuration) {\n      return this.layout\n      // throw new Error('configuration object required')\n    }\n    // this.layout = new Map()\n    // this.totalHeight = 0\n    // console.log(this.items)\n\n    const minY = readConfObject(configuration, 'minStickLength')\n\n    // sort them by score ascending, so higher scores will always end up\n    // stacked last (toward the bottom)\n    const sorted = this.items.sort((a, b) => a.data.score - b.data.score)\n\n    // bump them\n    let maxBottom = 0\n    const layoutEntries: [string, LayoutEntry][] = new Array(sorted.length)\n    for (const [i, element] of sorted.entries()) {\n      const currentItem = element\n      const { anchorLocation, width, height } = currentItem\n      const start = anchorLocation - width / 2\n      const end = start + width\n      let top = minY\n      let bottom = top + height\n\n      // figure out how far down to put it\n      for (let j = 0; j < i; j += 1) {\n        const [, previouslyLaidOutItem] = layoutEntries[j]!\n        const {\n          x: prevStart,\n          y: prevTop,\n          width: prevWidth,\n          height: prevHeight,\n        } = previouslyLaidOutItem\n        const prevEnd = prevStart + prevWidth\n        const prevBottom = prevTop + prevHeight\n        if (\n          doesIntersect2(prevStart, prevEnd, start, end) &&\n          doesIntersect2(prevTop, prevBottom, top, bottom)\n        ) {\n          // bump this one to the bottom of the previous one\n          top = prevBottom\n          bottom = top + height\n          j = -1 // we need to check all of them again after bumping\n        }\n      }\n\n      // record the entry and update the maxBottom\n      layoutEntries[i] = [\n        currentItem.uniqueId,\n        {\n          ...currentItem,\n          x: start,\n          y: top,\n        },\n      ]\n      if (bottom > maxBottom) {\n        maxBottom = bottom\n      }\n    }\n\n    // try to tile them left to right all at the same level\n    // if they don't fit, try to alternate them on 2 levels, then 3\n    this.totalHeight = maxBottom\n    this.layout = new Map(layoutEntries)\n    return this.layout\n  }\n\n  getTotalHeight() {\n    return this.totalHeight\n  }\n\n  serializeRegion() {\n    return this.toJSON()\n  }\n\n  toJSON() {\n    return {\n      pairs: [...this.getLayout()],\n      totalHeight: this.getTotalHeight(),\n    }\n  }\n\n  static fromJSON() {\n    throw new Error('not supported')\n  }\n}\n\nexport class PrecomputedFloatingLayout {\n  layout: LayoutMap\n\n  totalHeight: number\n\n  constructor({\n    pairs,\n    totalHeight,\n  }: {\n    pairs: [string, LayoutEntry][]\n    totalHeight: number\n  }) {\n    this.layout = new Map(pairs)\n    this.totalHeight = totalHeight\n  }\n\n  add(uniqueId: string) {\n    if (!this.layout.has(uniqueId)) {\n      throw new Error(`layout error, precomputed layout is missing ${uniqueId}`)\n    }\n  }\n\n  getLayout() {\n    return this.layout\n  }\n\n  getTotalHeight() {\n    return this.totalHeight\n  }\n  discardRange() {\n    /* do nothing */\n  }\n  static fromJSON(\n    json: ConstructorParameters<typeof PrecomputedFloatingLayout>[0],\n  ) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import { LayoutSession } from '@jbrowse/core/pluggableElementTypes/renderers/LayoutSession'\nimport { MultiLayout } from '@jbrowse/core/util/layouts'\n\nimport { FloatingLayout } from './Layout'\n\nexport class FloatingLayoutSession extends LayoutSession {\n  // @ts-expect-error\n  makeLayout() {\n    const { end, start } = this.props.regions[0]!\n    const widthPx = (end - start) / this.props.bpPerPx\n    // @ts-expect-error\n    return new MultiLayout(FloatingLayout, { width: widthPx })\n  }\n\n  layoutIsValid() {\n    return false\n  }\n}\n","import BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\n\nimport { FloatingLayoutSession } from './FloatingLayoutSession'\nimport { PrecomputedFloatingLayout } from './Layout'\n\nimport type { LayoutSessionProps } from '@jbrowse/core/pluggableElementTypes/renderers/LayoutSession'\n\nexport default class LollipopRenderer extends BoxRendererType {\n  // @ts-expect-error\n  createLayoutSession(props: LayoutSessionProps) {\n    return new FloatingLayoutSession(props)\n  }\n\n  // @ts-expect-error\n  deserializeLayoutInClient(json: any) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nexport default function ScoreText({\n  feature,\n  config,\n  layoutRecord: {\n    y,\n    data: { anchorX, radiusPx, score },\n  },\n}: {\n  feature: Feature\n  config: AnyConfigurationModel\n  layoutRecord: {\n    y: number\n    data: { anchorX: number; radiusPx: number; score: number }\n  }\n}) {\n  const innerColor = readConfObject(config, 'innerColor', { feature })\n\n  const scoreString = String(score)\n  const fontWidth = (radiusPx * 2) / scoreString.length\n  const fontHeight = fontWidth * 1.1\n  if (fontHeight < 12) {\n    return null\n  }\n  return (\n    <text\n      style={{\n        pointerEvents: 'none',\n        fontSize: fontHeight,\n        fill: contrastingTextColor(innerColor),\n      }}\n      x={anchorX}\n      y={y + radiusPx - fontHeight / 2.4}\n      textAnchor=\"middle\"\n      dominantBaseline=\"hanging\"\n    >\n      {scoreString}\n    </text>\n  )\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\n\nimport ScoreText from './ScoreText'\n\nconst Lollipop = observer(function Lollipop(props: Record<string, any>) {\n  const { feature, config, layoutRecord, selectedFeatureId } = props\n  const {\n    anchorLocation,\n    y,\n    data: { radiusPx },\n  } = layoutRecord\n\n  const styleOuter = {\n    fill: readConfObject(config, 'strokeColor', { feature }),\n  }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    styleOuter.fill = 'red'\n  }\n\n  const styleInner = {\n    fill: readConfObject(config, 'innerColor', { feature }),\n  }\n\n  const strokeWidth = readConfObject(config, 'strokeWidth', { feature })\n\n  return (\n    <g data-testid={feature.id()}>\n      <title>{readConfObject(config, 'caption', { feature })}</title>\n      <circle\n        cx={anchorLocation}\n        cy={y + radiusPx}\n        r={radiusPx}\n        style={styleOuter}\n        onMouseDown={(event: React.MouseEvent) => {\n          const { onFeatureMouseDown: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onMouseEnter={(event: React.MouseEvent) => {\n          const { onFeatureMouseEnter: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onMouseOut={(event: React.MouseEvent | React.FocusEvent) => {\n          const { onFeatureMouseOut: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onMouseOver={(event: React.MouseEvent | React.FocusEvent) => {\n          const { onFeatureMouseOver: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onMouseUp={(event: React.MouseEvent) => {\n          const { onFeatureMouseUp: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onMouseLeave={(event: React.MouseEvent) => {\n          const { onFeatureMouseLeave: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onMouseMove={(event: React.MouseEvent) => {\n          const { onFeatureMouseMove: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onClick={(event: React.MouseEvent) => {\n          const { onFeatureClick: handler, feature } = props\n          event.stopPropagation()\n          return handler?.(event, feature.id())\n        }}\n        onFocus={(event: React.MouseEvent | React.FocusEvent) => {\n          const { onFeatureMouseOver: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n        onBlur={(event: React.MouseEvent | React.FocusEvent) => {\n          const { onFeatureMouseOut: handler, feature } = props\n          return handler?.(event, feature.id())\n        }}\n      />\n      {radiusPx - strokeWidth <= 2 ? null : (\n        <circle\n          cx={anchorLocation}\n          cy={y + radiusPx}\n          r={radiusPx - strokeWidth}\n          style={styleInner}\n          onMouseDown={(event: React.MouseEvent) => {\n            const { onFeatureMouseDown: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onMouseEnter={(event: React.MouseEvent) => {\n            const { onFeatureMouseEnter: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onMouseOut={(event: React.MouseEvent | React.FocusEvent) => {\n            const { onFeatureMouseOut: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onMouseOver={(event: React.MouseEvent | React.FocusEvent) => {\n            const { onFeatureMouseOver: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onMouseUp={(event: React.MouseEvent) => {\n            const { onFeatureMouseUp: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onMouseLeave={(event: React.MouseEvent) => {\n            const { onFeatureMouseLeave: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onMouseMove={(event: React.MouseEvent) => {\n            const { onFeatureMouseMove: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onClick={(event: React.MouseEvent) => {\n            const { onFeatureClick: handler, feature } = props\n            event.stopPropagation()\n            return handler?.(event, feature.id())\n          }}\n          onFocus={(event: React.MouseEvent | React.FocusEvent) => {\n            const { onFeatureMouseOver: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n          onBlur={(event: React.MouseEvent | React.FocusEvent) => {\n            const { onFeatureMouseOut: handler, feature } = props\n            return handler?.(event, feature.id())\n          }}\n        />\n      )}\n      <ScoreText\n        feature={feature}\n        config={config}\n        layoutRecord={layoutRecord}\n      />\n    </g>\n  )\n})\n\nexport default Lollipop\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature } from '@jbrowse/core/util'\n\nconst Stick = observer(function Stick({\n  feature,\n  config,\n  layoutRecord: {\n    anchorLocation,\n    y,\n    data: { radiusPx },\n  },\n}: {\n  feature: Feature\n  config: AnyConfigurationModel\n  layoutRecord: {\n    anchorLocation: number\n    y: number\n    data: { radiusPx: number }\n  }\n}) {\n  return (\n    <line\n      x1={anchorLocation}\n      y1={0}\n      x2={anchorLocation}\n      y2={y + 2 * radiusPx}\n      stroke={readConfObject(config, 'stickColor', { feature })}\n      strokeWidth={readConfObject(config, 'stickWidth', { feature })}\n    />\n  )\n})\n\nexport default Stick\n","import type { FocusEvent, MouseEvent } from 'react'\nimport { Fragment, useEffect, useState } from 'react'\n\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { bpToPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport Lollipop from './Lollipop'\nimport Stick from './Stick'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\n\nfunction layoutFeat(args: {\n  feature: Feature\n  bpPerPx: number\n  region: Region\n  layout: { add: (...args: unknown[]) => void }\n  config: AnyConfigurationModel\n}) {\n  const { feature, bpPerPx, config, region, layout } = args\n\n  const centerBp = Math.abs(feature.get('end') + feature.get('start')) / 2\n  const centerPx = bpToPx(centerBp, region, bpPerPx)\n  const radiusPx = readConfObject(config, 'radius', { feature })\n\n  if (!radiusPx) {\n    console.error(\n      new Error(\n        `lollipop radius ${radiusPx} configured for feature ${feature.id()}`,\n      ),\n    )\n  }\n  layout.add(feature.id(), centerPx, radiusPx * 2, radiusPx * 2, {\n    featureId: feature.id(),\n    anchorX: centerPx,\n    radiusPx,\n    score: readConfObject(args.config, 'score', { feature }),\n  })\n}\n\nconst LollipopRendering = observer(function (props: Record<string, any>) {\n  const onMouseDown = (event: MouseEvent) => {\n    const { onMouseDown: handler } = props\n    return handler?.(event)\n  }\n\n  const onMouseUp = (event: MouseEvent) => {\n    const { onMouseUp: handler } = props\n    return handler?.(event)\n  }\n\n  const onMouseEnter = (event: MouseEvent | FocusEvent) => {\n    const { onMouseEnter: handler } = props\n    return handler?.(event)\n  }\n\n  const onMouseLeave = (event: MouseEvent | FocusEvent) => {\n    const { onMouseLeave: handler } = props\n    return handler?.(event)\n  }\n\n  const onMouseOver = (event: MouseEvent) => {\n    const { onMouseOver: handler } = props\n    return handler?.(event)\n  }\n\n  const onMouseOut = (event: MouseEvent) => {\n    const { onMouseOut: handler } = props\n    return handler?.(event)\n  }\n\n  const onClick = (event: MouseEvent) => {\n    const { onClick: handler } = props\n    return handler?.(event)\n  }\n  const [client, setClient] = useState(false)\n  useEffect(() => {\n    setClient(true)\n  }, [])\n\n  const {\n    regions,\n    bpPerPx,\n    layout,\n    config,\n    features = new Map(),\n    displayModel = {},\n  } = props\n  const { selectedFeatureId } = displayModel\n  const region = regions[0]!\n  for (const feature of features.values()) {\n    layoutFeat({\n      feature,\n      bpPerPx,\n      region,\n      config,\n      layout,\n    })\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const records = [...layout.getLayout(config).values()]\n  const height = layout.getTotalHeight()\n\n  return (\n    <svg\n      width={width}\n      height={height}\n      style={{ position: 'relative' }}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onFocus={onMouseEnter}\n      onBlur={onMouseLeave}\n      onClick={onClick}\n    >\n      {client ? (\n        <>\n          {records.map(layoutRecord => {\n            const feature = features.get(layoutRecord.data.featureId)\n            return (\n              <Fragment key={feature.id()}>\n                <Stick\n                  key={`stick-${feature.id()}`}\n                  {...props}\n                  config={config}\n                  layoutRecord={layoutRecord}\n                  feature={feature}\n                />\n                <Lollipop\n                  key={`body-${feature.id()}`}\n                  {...props}\n                  layoutRecord={layoutRecord}\n                  feature={feature}\n                  selectedFeatureId={selectedFeatureId}\n                />\n              </Fragment>\n            )\n          })}\n        </>\n      ) : null}\n    </svg>\n  )\n})\n\nexport default LollipopRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LollipopRenderer',\n  {\n    strokeColor: {\n      type: 'color',\n      description: 'the outer color of each lollipop',\n      defaultValue: 'green',\n      contextVariable: ['feature'],\n    },\n    innerColor: {\n      type: 'color',\n      description: 'the inner color of each lollipop',\n      defaultValue: '#7fc75f',\n      contextVariable: ['feature'],\n    },\n    strokeWidth: {\n      type: 'number',\n      description: 'width of the stroked border',\n      defaultValue: 4,\n      contextVariable: ['feature'],\n    },\n    radius: {\n      type: 'number',\n      description: 'radius in pixels of each lollipop body',\n      defaultValue: `jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))`,\n      contextVariable: ['feature'],\n    },\n    caption: {\n      type: 'string',\n      description:\n        'the tooltip caption displayed when the mouse hovers over a lollipop',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n    minStickLength: {\n      type: 'number',\n      description: 'minimum lollipop \"stick\" length, in pixels',\n      defaultValue: 5,\n    },\n    stickColor: {\n      type: 'color',\n      description: 'color of the lollipop stick',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    stickWidth: {\n      type: 'number',\n      description: 'width in pixels of the lollipop stick',\n      defaultValue: 2,\n      contextVariable: ['feature'],\n    },\n    score: {\n      type: 'number',\n      description:\n        'the \"score\" of each lollipop, displayed as a number in the center of the circle',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport LinearLollipopDisplayF from './LinearLollipopDisplay'\nimport LollipopRendererF from './LollipopRenderer'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class LollipopPlugin extends Plugin {\n  name = 'LollipopPlugin'\n\n  install(pluginManager: PluginManager) {\n    LollipopRendererF(pluginManager)\n    LinearLollipopDisplayF(pluginManager)\n  }\n}\n","import LollipopRenderer from './LollipopRenderer'\nimport ReactComponent from './components/LollipopRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LollipopRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new LollipopRenderer({\n        name: 'LollipopRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport { configSchemaFactory } from './configSchema'\nimport { stateModelFactory } from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearLollipopDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearLollipopDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'LollipopTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearLollipopDisplay\n */\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearLollipopDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('AboutWidget', {})\n\nconst stateModel = types.model('AboutWidget', {\n  id: ElementId,\n  type: types.literal('AboutWidget'),\n})\n\nexport default function AboutWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'AboutWidget',\n      heading: 'About',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./components/AboutWidget')),\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('HelpWidget', {})\n\nconst stateModel = types.model('HelpWidget', {\n  id: ElementId,\n  type: types.literal('HelpWidget'),\n})\n\nexport default function HelpWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'HelpWidget',\n      heading: 'Help',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./components/HelpWidget')),\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('ImportSessionWidget', {})\n\nconst stateModel = types.model('ImportSessionWidget', {\n  id: ElementId,\n  type: types.literal('ImportSessionWidget'),\n})\n\nexport default function ImportSessionWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'ImportSessionWidget',\n      heading: 'Import session',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./components/ImportSessionWidget')),\n    })\n  })\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport const configSchema = ConfigurationSchema('SessionManager', {})\n\nexport const stateModel = types.model('SessionManager', {\n  id: ElementId,\n  type: types.literal('SessionManager'),\n})\n\nexport default function SessionManagerF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'SessionManager',\n      heading: 'Recent sessions',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./components/SessionManager')),\n    })\n  })\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport { isAbstractMenuManager } from '@jbrowse/core/util'\nimport HelpIcon from '@mui/icons-material/Help'\nimport InfoIcon from '@mui/icons-material/Info'\n\nimport AboutWidgetF from './AboutWidget'\nimport HelpWidgetF from './HelpWidget'\nimport ImportSessionWidgetF from './ImportSessionWidget'\nimport SessionManagerF from './SessionManager'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { SessionWithWidgets } from '@jbrowse/core/util'\n\nexport default class MenusPlugin extends Plugin {\n  name = 'MenusPlugin'\n\n  install(pluginManager: PluginManager) {\n    AboutWidgetF(pluginManager)\n    HelpWidgetF(pluginManager)\n    ImportSessionWidgetF(pluginManager)\n    SessionManagerF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'About',\n        icon: InfoIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('AboutWidget', 'aboutWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'Help',\n        icon: HelpIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('HelpWidget', 'helpWidget')\n          session.showWidget(widget)\n        },\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SPARQLAdapter',\n  {\n    endpoint: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'https://somesite.com/sparql',\n        locationType: 'UriLocation',\n      },\n      description: 'URL of the SPARQL endpoint',\n    },\n    queryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query where {start} {end} and {refName} will get replaced for each call',\n    },\n    refNamesQueryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query that returns the possible refNames in a ?refName column',\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Possible refNames used by the SPARQL endpoint (ignored if \"refNamesQueryTemplate\" is provided)',\n    },\n    additionalQueryParams: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Additional parameters to add to the query, e.g. \"format=JSON\"',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import Plugin from '@jbrowse/core/Plugin'\nimport { getFileName } from '@jbrowse/core/util/tracks'\n\nimport SPARQLAdapterF from './SPARQLAdapter'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AdapterGuesser } from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default class RdfPlugin extends Plugin {\n  name = 'RdfPlugin'\n\n  install(pluginManager: PluginManager) {\n    SPARQLAdapterF(pluginManager)\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\/sparql$/i\n          const adapterName = 'SPARQLAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              endpoint: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SPARQLAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'SPARQLAdapter',\n        displayName: 'SPARQL adapter',\n        configSchema,\n        adapterMetadata: {\n          category: 'Uncommon',\n        },\n        getAdapterClass: () => import('./SPARQLAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config BgzipFastaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BgzipFastaAdapter = ConfigurationSchema(\n  'BgzipFastaAdapter',\n  {\n    /**\n     * #slot\n     */\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.fai',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    gziLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.gzi',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes yourfile.fa.fai and yourfile.fa.gzi:\n     * ```json\n     * {\n     *   \"type\": \"BgzipFastaAdapter\",\n     *   \"uri\": \"yourfile.fa\"\n     * }\n     * ```\n     */\n\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            fastaLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            faiLocation: {\n              uri: `${snap.uri}.fai`,\n              baseUri: snap.baseUri,\n            },\n            gziLocation: {\n              uri: `${snap.uri}.gzi`,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default BgzipFastaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config ChromSizesAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ChromSizesAdapter = ConfigurationSchema(\n  'ChromSizesAdapter',\n  {\n    /**\n     * #slot\n     */\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/species.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"ChromSizesAdapter\",\n     *   \"uri\": \"yourfile.chrom.sizes\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            chromSizesLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default ChromSizesAdapter\n","import type { ReactNode } from 'react'\nimport { Fragment } from 'react'\n\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport {\n  bpSpanPx,\n  complement,\n  defaultCodonTable,\n  defaultStarts,\n  defaultStops,\n  generateCodonTable,\n  revcom,\n} from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Frame, Region } from '@jbrowse/core/util'\nimport type { Theme } from '@mui/material'\n\nfunction Translation({\n  codonTable,\n  seq,\n  frame,\n  width,\n  bpPerPx,\n  colorByCDS,\n  region,\n  seqStart,\n  height,\n  y,\n  reverse = false,\n  theme,\n}: {\n  codonTable: Record<string, string>\n  width: number\n  seq: string\n  frame: Frame\n  colorByCDS: boolean\n  bpPerPx: number\n  region: Region\n  seqStart: number\n  reverse?: boolean\n  height: number\n  y: number\n  theme?: Theme\n}) {\n  const normalizedFrame = Math.abs(frame) - 1\n  const seqFrame = seqStart % 3\n  const frameShift = (normalizedFrame - seqFrame + 3) % 3\n\n  const frameShiftAdjustedSeqLength = seq.length - frameShift\n  const multipleOfThreeLength =\n    frameShiftAdjustedSeqLength - (frameShiftAdjustedSeqLength % 3)\n  const seqSliced = seq.slice(frameShift, frameShift + multipleOfThreeLength)\n\n  const translated: { letter: string; codon: string }[] = []\n  for (let i = 0; i < seqSliced.length; i += 3) {\n    const codon = seqSliced.slice(i, i + 3)\n    const normalizedCodon = reverse ? revcom(codon) : codon\n    const aminoAcid = codonTable[normalizedCodon] || ''\n    translated.push({\n      letter: aminoAcid,\n      codon: normalizedCodon.toUpperCase(),\n    })\n  }\n\n  const codonWidth = (1 / bpPerPx) * 3\n  const renderLetter = 1 / bpPerPx >= 12\n  const frameOffset = frameShift / bpPerPx\n  const startOffset = (region.start - seqStart) / bpPerPx\n  const offset = frameOffset - startOffset\n  const defaultFill = colorByCDS\n    ? theme?.palette.framesCDS.at(frame)?.main\n    : theme?.palette.frames.at(frame)?.main\n  return (\n    <>\n      <rect x={0} y={y} width={width} height={height} fill={defaultFill} />\n      {translated.map((element, index) => {\n        const x = region.reversed\n          ? width - (index + 1) * codonWidth - offset\n          : codonWidth * index + offset\n        const { letter, codon } = element\n        const codonFill = defaultStarts.includes(codon)\n          ? theme?.palette.startCodon\n          : defaultStops.includes(codon)\n            ? theme?.palette.stopCodon\n            : undefined\n        return !(renderLetter || codonFill) ? null : (\n          <Fragment key={`${index}-${letter}`}>\n            <rect\n              x={x}\n              y={y}\n              width={\n                renderLetter\n                  ? codonWidth\n                  : codonWidth + 0.7 /* small fudge factor when zoomed out*/\n              }\n              height={height}\n              stroke={renderLetter ? '#555' : 'none'}\n              fill={codonFill || 'none'}\n            />\n            {renderLetter ? (\n              <text\n                x={x + codonWidth / 2}\n                fontSize={height - 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n              >\n                {letter}\n              </text>\n            ) : null}\n          </Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction Sequence({\n  bpPerPx,\n  region,\n  feature,\n  sequenceType,\n  theme,\n  height,\n  seq,\n  y,\n}: {\n  seq: string\n  theme: Theme\n  bpPerPx: number\n  sequenceType: string\n  height: number\n  region: Region\n  feature: Feature\n  y: number\n}) {\n  const render = 1 / bpPerPx >= 12\n  const s = feature.get('start')\n  const e = feature.get('end')\n  const [leftPx, rightPx] = bpSpanPx(s, e, region, bpPerPx)\n  const reverse = region.reversed\n  const len = e - s\n  const w = Math.max((rightPx - leftPx) / len, 0.8)\n\n  return (\n    <>\n      {seq.split('').map((letter, index) => {\n        const color =\n          sequenceType === 'dna'\n            ? // @ts-expect-error\n              theme.palette.bases[letter.toUpperCase()]\n            : undefined\n        const x = reverse ? rightPx - (index + 1) * w : leftPx + index * w\n        return (\n          /* biome-ignore lint/suspicious/noArrayIndexKey: */\n          <Fragment key={`${letter}-${index}`}>\n            <rect\n              x={x}\n              y={y}\n              width={w}\n              height={height}\n              fill={color ? color.main : '#aaa'}\n              stroke={render ? '#555' : 'none'}\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n                fontSize={height - 2}\n                fill={\n                  color ? theme.palette.getContrastText(color.main) : 'black'\n                }\n              >\n                {letter}\n              </text>\n            ) : null}\n          </Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction SequenceSVG({\n  regions,\n  width,\n  theme: configTheme,\n  colorByCDS,\n  features = new Map(),\n  showReverse = true,\n  showForward = true,\n  showTranslation = true,\n  sequenceType = 'dna',\n  bpPerPx,\n  rowHeight,\n}: {\n  regions: Region[]\n  width: number\n  theme?: Theme\n  features: Map<string, Feature>\n  colorByCDS: boolean\n  showReverse?: boolean\n  showForward?: boolean\n  showTranslation?: boolean\n  sequenceType?: string\n  bpPerPx: number\n  rowHeight: number\n}) {\n  const region = regions[0]!\n  const theme = createJBrowseTheme(configTheme)\n  const codonTable = generateCodonTable(defaultCodonTable)\n  const [feature] = [...features.values()]\n  if (!feature) {\n    return null\n  }\n  const seq: string = feature.get('seq')\n  if (!seq) {\n    return null\n  }\n\n  // incrementer for the y-position of the current sequence being rendered\n  // (applies to both translation rows and dna rows)\n  let currY = -rowHeight\n\n  const showSequence = bpPerPx <= 1\n\n  const forwardFrames: Frame[] = showTranslation && showForward ? [3, 2, 1] : []\n  const reverseFrames: Frame[] =\n    showTranslation && showReverse ? [-1, -2, -3] : []\n\n  // if region.reversed, the forward translation is on bottom, reverse on top\n  const [topFrames, bottomFrames] = region.reversed\n    ? [reverseFrames.toReversed(), forwardFrames.toReversed()]\n    : [forwardFrames, reverseFrames]\n  return (\n    <>\n      {topFrames.map(index => (\n        <Translation\n          key={`translation-${index}`}\n          width={width}\n          colorByCDS={colorByCDS}\n          seq={seq}\n          y={(currY += rowHeight)}\n          codonTable={codonTable}\n          frame={index}\n          bpPerPx={bpPerPx}\n          region={region}\n          seqStart={feature.get('start')}\n          theme={theme}\n          height={rowHeight}\n          reverse={region.reversed}\n        />\n      ))}\n\n      {showForward && showSequence ? (\n        <Sequence\n          height={rowHeight}\n          sequenceType={sequenceType}\n          y={(currY += rowHeight)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? complement(seq) : seq}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {showReverse && showSequence ? (\n        <Sequence\n          height={rowHeight}\n          sequenceType={sequenceType}\n          y={(currY += rowHeight)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? seq : complement(seq)}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {bottomFrames.map(index => (\n        <Translation\n          key={`rev-translation-${index}`}\n          width={width}\n          colorByCDS={colorByCDS}\n          seq={seq}\n          y={(currY += rowHeight)}\n          codonTable={codonTable}\n          frame={index}\n          bpPerPx={bpPerPx}\n          region={region}\n          seqStart={feature.get('start')}\n          theme={theme}\n          height={rowHeight}\n          reverse={!region.reversed}\n        />\n      ))}\n    </>\n  )\n}\n\nfunction Wrapper({\n  exportSVG,\n  width,\n  totalHeight,\n  children,\n}: {\n  exportSVG?: { rasterizeLayers: boolean }\n  width: number\n  totalHeight: number\n  children: ReactNode\n}) {\n  return exportSVG ? (\n    children\n  ) : (\n    <svg\n      data-testid=\"sequence_track\"\n      width={width}\n      height={totalHeight}\n      style={{\n        // use block because svg by default is inline, which adds a margin\n        display: 'block',\n        width,\n        height: totalHeight,\n        userSelect: 'none',\n      }}\n    >\n      {children}\n    </svg>\n  )\n}\n\nconst DivSequenceRendering = observer(function ({\n  exportSVG,\n  features,\n  regions,\n  colorByCDS,\n  bpPerPx,\n  rowHeight,\n  sequenceHeight,\n  theme,\n  showForward,\n  showReverse,\n  showTranslation,\n}: {\n  exportSVG?: { rasterizeLayers: boolean }\n  features: Map<string, Feature>\n  regions: Region[]\n  colorByCDS: boolean\n  bpPerPx: number\n  rowHeight: number\n  sequenceHeight: number\n  config: AnyConfigurationModel\n  theme?: Theme\n  showForward?: boolean\n  showReverse?: boolean\n  showTranslation?: boolean\n}) {\n  const region = regions[0]!\n  const width = Math.ceil((region.end - region.start) / bpPerPx)\n\n  return (\n    <Wrapper exportSVG={exportSVG} totalHeight={sequenceHeight} width={width}>\n      <SequenceSVG\n        width={width}\n        showReverse={showReverse}\n        showForward={showForward}\n        theme={theme}\n        showTranslation={showTranslation}\n        colorByCDS={colorByCDS}\n        bpPerPx={bpPerPx}\n        rowHeight={rowHeight}\n        features={features}\n        regions={regions}\n      />\n    </Wrapper>\n  )\n})\n\nexport default DivSequenceRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config DivSequenceRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DivSequenceRenderer = ConfigurationSchema(\n  'DivSequenceRenderer',\n  {\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'height in pixels of each line of sequence',\n      defaultValue: 16,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default DivSequenceRenderer\n","import FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\n\nimport ReactComponent from './components/DivSequenceRendering'\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Region } from '@jbrowse/core/util/types'\n\n/* adjust in both directions */\nclass DivSequenceRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  getExpandedRegion(region: Region) {\n    return {\n      ...region,\n      start: Math.max(region.start - 3, 0),\n      end: region.end + 3,\n    }\n  }\n}\n\nexport default function DivSequenceRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new DivSequenceRenderer({\n        name: 'DivSequenceRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config IndexedFastaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst IndexedFastaAdapter = ConfigurationSchema(\n  'IndexedFastaAdapter',\n  {\n    /**\n     * #slot\n     */\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.fai', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes yourfile.fa.fai:\n     * ```json\n     * {\n     *   \"type\": \"IndexedFastaAdapter\",\n     *   \"uri\": \"yourfile.fa\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            fastaLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            faiLocation: {\n              uri: `${snap.uri}.fai`,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default IndexedFastaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport divSequenceRendererConfigSchema from '../DivSequenceRenderer/configSchema'\n\n/**\n * #config LinearReferenceSequenceDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const configSchema = ConfigurationSchema(\n  'LinearReferenceSequenceDisplay',\n  {\n    /**\n     * #slot\n     */\n    renderer: divSequenceRendererConfigSchema,\n  },\n  { explicitIdentifier: 'displayId', explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SequenceSearchAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'SequenceSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    search: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Search string or regex to search for',\n    },\n    /**\n     * #slot\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      defaultValue: null,\n    },\n    /**\n     * #slot\n     */\n    searchForward: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    searchReverse: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    caseInsensitive: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config TwoBitAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst TwoBitAdapter = ConfigurationSchema(\n  'TwoBitAdapter',\n  {\n    /**\n     * #slot\n     */\n    twoBitLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.2bit',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/default.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n      description:\n        'An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time',\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config (note that adding chromSizes improves speed, otherwise has to read a lot of the twobit file to calculate chromosome names and sizes):\n     *\n     * ```json\n     * {\n     *   \"type\": \"TwoBitAdapter\",\n     *   \"uri\": \"yourfile.2bit\"\n     *   \"chromSizes\":\"yourfile.chrom.sizes\"\n     * }\n     *\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            twoBitLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            ...(snap.chromSizes\n              ? {\n                  chromSizesLocation: {\n                    uri: snap.chromSizes,\n                    baseUri: snap.baseUri,\n                  },\n                }\n              : {}),\n          }\n        : snap\n    },\n  },\n)\n\nexport default TwoBitAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config UnindexedFastaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst UnindexedFastaAdapter = ConfigurationSchema(\n  'UnindexedFastaAdapter',\n  {\n    /**\n     * #slot\n     */\n    rewriteRefNames: {\n      type: 'string',\n      defaultValue: '',\n      contextVariable: ['refName'],\n    },\n    /**\n     * #slot\n     */\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"UnindexedFastaAdapter\",\n     *   \"uri\": \"yourfile.fa\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            fastaLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\nexport default UnindexedFastaAdapter\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport BgzipFastaAdapterF from './BgzipFastaAdapter'\nimport ChromSizesAdapterF from './ChromSizesAdapter'\nimport DivSequenceRendererF from './DivSequenceRenderer'\nimport IndexedFastaAdapterF from './IndexedFastaAdapter'\nimport LinearReferenceSequenceDisplayF from './LinearReferenceSequenceDisplay'\nimport ReferenceSequenceTrackF from './ReferenceSequenceTrack'\nimport SequenceSearchAdapterF from './SequenceSearchAdapter'\nimport TwoBitAdapterF from './TwoBitAdapter'\nimport UnindexedFastaAdapterF from './UnindexedFastaAdapter'\nimport createExtensionPoints from './createExtensionPoints'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class SequencePlugin extends Plugin {\n  name = 'SequencePlugin'\n\n  install(pluginManager: PluginManager) {\n    DivSequenceRendererF(pluginManager)\n    TwoBitAdapterF(pluginManager)\n    BgzipFastaAdapterF(pluginManager)\n    ChromSizesAdapterF(pluginManager)\n    IndexedFastaAdapterF(pluginManager)\n    UnindexedFastaAdapterF(pluginManager)\n    SequenceSearchAdapterF(pluginManager)\n    ReferenceSequenceTrackF(pluginManager)\n    LinearReferenceSequenceDisplayF(pluginManager)\n    createExtensionPoints(pluginManager)\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function TwoBitAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'TwoBitAdapter',\n        displayName: 'TwoBit adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () => import('./TwoBitAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BgzipFastaAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'BgzipFastaAdapter',\n      displayName: 'Bgzip-indexed FASTA adapter',\n      configSchema,\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n      getAdapterClass: () => import('./BgzipFastaAdapter').then(r => r.default),\n    })\n  })\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function ChromSizesAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'ChromSizesAdapter',\n        displayName: 'Chrom sizes adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./ChromSizesAdapter').then(r => r.default),\n      }),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function IndexedFastaAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'IndexedFastaAdapter',\n      displayName: 'Indexed FASTA adapter',\n      configSchema,\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n\n      getAdapterClass: () =>\n        import('./IndexedFastaAdapter').then(r => r.default),\n    })\n  })\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function UnindexedFastaAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'UnindexedFastaAdapter',\n      displayName: 'Unindexed FASTA adapter',\n      configSchema,\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n      getAdapterClass: () =>\n        import('./UnindexedFastaAdapter').then(r => r.default),\n    })\n  })\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SequenceSearchAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'SequenceSearchAdapter',\n      displayName: 'Sequence search adapter',\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n      configSchema,\n      getAdapterClass: () =>\n        import('./SequenceSearchAdapter').then(r => r.default),\n    })\n  })\n}\n","import TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport { createReferenceSeqTrackConfig } from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function ReferenceSequenceTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = createReferenceSeqTrackConfig(pluginManager)\n\n    return new TrackType({\n      name: 'ReferenceSequenceTrack',\n      displayName: 'Reference sequence track',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'ReferenceSequenceTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n// Note: this is primarily a copy of createBaseTrackConfig, except with a\n// subset of the config slots, to avoid including fields that don't make sense\n// for the ReferenceSequenceTrack\n\n/**\n * #config ReferenceSequenceTrack\n * used to display base level DNA sequence tracks\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport function createReferenceSeqTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ReferenceSequenceTrack',\n    {\n      /**\n       * #slot\n       * configuration for track adapter\n       */\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n\n      /**\n       * #slot\n       * configuration for the displays e.g. LinearReferenceSequenceDisplay\n       */\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n\n      /**\n       * #slot\n       */\n      name: {\n        type: 'string',\n        description:\n          'optional track name, otherwise uses the \"Reference sequence (assemblyName)\"',\n        defaultValue: '',\n      },\n\n      /**\n       * #slot\n       */\n      sequenceType: {\n        type: 'string',\n        description: 'either dna or pep',\n        defaultValue: 'dna',\n      },\n\n      /**\n       * #slot\n       */\n      description: {\n        description: 'a description of the track',\n        type: 'string',\n        defaultValue: '',\n      },\n\n      /**\n       * #slot\n       */\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n\n      formatAbout: ConfigurationSchema('FormatAbout', {\n        /**\n         * #slot formatAbout.config\n         */\n        config: {\n          type: 'frozen',\n          description: 'formats configuration in about dialog',\n          defaultValue: {},\n          contextVariable: ['config'],\n        },\n\n        /**\n         * #slot formatAbout.hideUris\n         */\n        hideUris: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n      }),\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          for (const d of displays) {\n            if (d) {\n              displayTypes.add(d.type)\n            }\n          }\n          const trackType = pluginManager.getTrackType(snap.type)\n          for (const displayType of trackType?.displayTypes || []) {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          }\n        }\n        return { ...snap, displays }\n      },\n      /**\n       * #identifier\n       * all tracks have a globally unique 'trackId'\n       */\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport { configSchema } from './configSchema'\nimport { modelFactory } from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearReferenceSequenceDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const stateModel = modelFactory(configSchema)\n    return new DisplayType({\n      name: 'LinearReferenceSequenceDisplay',\n      configSchema,\n      stateModel,\n      displayName: 'Reference sequence display',\n      trackType: 'ReferenceSequenceTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getContainingTrack, getContainingView } from '@jbrowse/core/util'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { autorun } from 'mobx'\nimport { addDisposer, types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearReferenceSequenceDisplay\n * base model `BaseLinearDisplay`\n */\nexport function modelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReferenceSequenceDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearReferenceSequenceDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        showForward: true,\n        /**\n         * #property\n         */\n        showReverse: true,\n        /**\n         * #property\n         */\n        showTranslation: true,\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #property\n       */\n      rowHeight: 15,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get sequenceType() {\n        return getConf(getContainingTrack(self), 'sequenceType')\n      },\n\n      /**\n       * #getter\n       * showReverse setting, it is NOT disabled for non-dna sequences\n       */\n      get showForwardActual() {\n        return self.showForward\n      },\n\n      /**\n       * #getter\n       * showReverse setting, is disabled for non-dna sequences\n       */\n      get showReverseActual() {\n        return this.sequenceType === 'dna' ? self.showReverse : false\n      },\n\n      /**\n       * #getter\n       * showTranslation setting is disabled for non-dna sequences\n       */\n      get showTranslationActual() {\n        return this.sequenceType === 'dna' ? self.showTranslation : false\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get sequenceHeight() {\n        const {\n          rowHeight,\n          showTranslationActual,\n          showReverseActual,\n          showForwardActual,\n        } = self\n        const r1 =\n          showReverseActual && showTranslationActual ? rowHeight * 3 : 0\n        const r2 =\n          showForwardActual && showTranslationActual ? rowHeight * 3 : 0\n        const t = r1 + r2\n        const r = showReverseActual ? rowHeight : 0\n        const s = showForwardActual ? rowHeight : 0\n        return t + r + s\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const {\n            rpcDriverName,\n            showForwardActual,\n            showReverseActual,\n            showTranslationActual,\n            rowHeight,\n            sequenceHeight,\n            sequenceType,\n          } = self\n          return {\n            ...superRenderProps(),\n            ...getParentRenderProps(self),\n            config: self.configuration.renderer,\n            rpcDriverName,\n            showForward: showForwardActual,\n            showReverse: showReverseActual,\n            showTranslation: showTranslationActual,\n            sequenceType,\n            rowHeight,\n            sequenceHeight,\n          }\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #method\n       */\n      regionCannotBeRendered(/* region */) {\n        const view = getContainingView(self) as LGV\n        return view.bpPerPx > 3 ? 'Zoom in to see sequence' : undefined\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      toggleShowForward() {\n        self.showForward = !self.showForward\n      },\n      /**\n       * #action\n       */\n      toggleShowReverse() {\n        self.showReverse = !self.showReverse\n      },\n      /**\n       * #action\n       */\n      toggleShowTranslation() {\n        self.showTranslation = !self.showTranslation\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const view = getContainingView(self) as LGV\n            if (view.bpPerPx > 3) {\n              self.setHeight(50)\n            } else {\n              self.setHeight(self.sequenceHeight)\n            }\n          }),\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      trackMenuItems() {\n        return [\n          ...(self.sequenceType === 'dna'\n            ? [\n                {\n                  label: 'Show forward',\n                  type: 'checkbox',\n                  checked: self.showForward,\n                  onClick: () => {\n                    self.toggleShowForward()\n                  },\n                },\n                {\n                  label: 'Show reverse',\n                  type: 'checkbox',\n                  checked: self.showReverse,\n                  onClick: () => {\n                    self.toggleShowReverse()\n                  },\n                },\n                {\n                  label: 'Show translation',\n                  type: 'checkbox',\n                  checked: self.showTranslation,\n                  onClick: () => {\n                    self.toggleShowTranslation()\n                  },\n                },\n              ]\n            : []),\n        ]\n      },\n    }))\n}\n","import { getFileName, makeIndex } from '@jbrowse/core/util/tracks'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport type { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function ExtensionPointsF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.2bit$/i\n        const adapterName = 'TwoBitAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          twoBitLocation: file,\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        }\n        if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'TwoBitAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.(fa|fasta|fas|fna|mfa)$/i\n        const adapterName = 'IndexedFastaAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          fastaLocation: file,\n          faiLocation: index || makeIndex(file, '.fai'),\n        }\n\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        }\n        if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'IndexedFastaAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.(fa|fasta|fas|fna|mfa)\\.b?gz$/i\n        const adapterName = 'BgzipFastaAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          faiLocation: makeIndex(file, '.fai'),\n          gziLocation: makeIndex(file, '.gzi'),\n        }\n\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        }\n        if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'BgzipFastaAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getEnv, getSession } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { getParent, types } from 'mobx-state-tree'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { FileLocation } from '@jbrowse/core/util'\nimport type { Instance } from 'mobx-state-tree'\n\nconst IMPORT_SIZE_LIMIT = 100_000_000\n\nconst fileTypes = ['VCF', 'BED', 'BEDPE', 'STAR-Fusion']\nconst fileTypeParsers = {\n  VCF: () => import('./importAdapters/VcfImport').then(r => r.parseVcfBuffer),\n  BED: () => import('./importAdapters/BedImport').then(r => r.parseBedBuffer),\n  BEDPE: () =>\n    import('./importAdapters/BedpeImport').then(r => r.parseBedPEBuffer),\n  'STAR-Fusion': () =>\n    import('./importAdapters/STARFusionImport').then(\n      r => r.parseSTARFusionBuffer,\n    ),\n}\n\nfunction getType(adapter: Record<string, unknown>) {\n  if (adapter.vcfLocation || adapter.vcfGzLocation) {\n    return 'VCF'\n  } else if (adapter.bedLocation || adapter.bedGzLocation) {\n    return 'BED'\n  } else if (adapter.bedpeLocation) {\n    return 'BEDPE'\n  } else {\n    return undefined\n  }\n}\n\n// hardcodes a couple different adapter types\nfunction getAdapterLoc(adapter: Record<string, FileLocation>) {\n  return (\n    adapter.vcfLocation ||\n    adapter.vcfGzLocation ||\n    adapter.bedLocation ||\n    adapter.bedGzLocation ||\n    adapter.bedpeLocation\n  )\n}\n\n// regexp used to guess the type of a file or URL from its file extension\nconst fileTypesRegexp = new RegExp(`\\\\.(${fileTypes.join('|')})(\\\\.gz)?$`, 'i')\n\n/**\n * #stateModel SpreadsheetImportWizard\n * #category view\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function stateModelFactory() {\n  return types\n    .model('SpreadsheetImportWizard', {\n      /**\n       * #property\n       */\n      fileType: types.optional(types.enumeration(fileTypes), 'VCF'),\n      /**\n       * #property\n       */\n      hasColumnNameLine: true,\n      /**\n       * #property\n       */\n      columnNameLineNumber: 1,\n      /**\n       * #property\n       */\n      selectedAssemblyName: types.maybe(types.string),\n\n      /**\n       * #property\n       * used specifically for UriLocation's\n       */\n      cachedFileLocation: types.frozen<FileLocation | undefined>(),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      fileTypes,\n      /**\n       * #volatile\n       */\n      fileSource: undefined as any,\n      /**\n       * #volatile\n       */\n      error: undefined as unknown,\n      /**\n       * #volatile\n       */\n      loading: false,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get isReadyToOpen() {\n        return (\n          self.fileSource &&\n          (self.fileSource.blobId ||\n            self.fileSource.localPath ||\n            self.fileSource.uri)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get fileName() {\n        return (\n          self.fileSource.uri ||\n          self.fileSource.localPath ||\n          (self.fileSource.blobId && self.fileSource.name)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get requiresUnzip() {\n        return this.fileName.endsWith('gz')\n      },\n\n      /**\n       * #method\n       */\n      isValidRefName(refName: string, assemblyName?: string) {\n        const { assemblyManager } = getSession(self)\n        return !assemblyName\n          ? false\n          : assemblyManager.isValidRefName(refName, assemblyName)\n      },\n\n      /**\n       * #method\n       */\n      tracksForAssembly(selectedAssembly: string) {\n        const session = getSession(self)\n        const { tracks = [], sessionTracks = [] } = session\n        const allTracks = [\n          ...tracks,\n          ...sessionTracks,\n        ] as AnyConfigurationModel[]\n        return allTracks\n          .map(track => {\n            const assemblyNames = readConfObject(track, 'assemblyNames')\n            const adapter = readConfObject(track, 'adapter')\n            const category = readConfObject(track, 'category').join(',')\n            const loc = getAdapterLoc(adapter)\n            return assemblyNames.includes(selectedAssembly) && loc\n              ? {\n                  track,\n                  label: [\n                    category ? `[${category}]` : '',\n                    getTrackName(track, session),\n                  ]\n                    .filter(f => !!f)\n                    .join(' '),\n                  assemblyNames,\n                  type: getType(adapter) || 'UNKNOWN',\n                  loc,\n                }\n              : undefined\n          })\n          .filter(f => !!f)\n          .sort((a, b) => a.label.localeCompare(b.label))\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSelectedAssemblyName(s: string) {\n        self.selectedAssemblyName = s\n      },\n      /**\n       * #action\n       */\n      setFileSource(newSource: unknown) {\n        self.fileSource = newSource\n        self.error = undefined\n\n        if (self.fileSource) {\n          // try to autodetect the file type, ignore errors\n          const name = self.fileName\n\n          if (name) {\n            const firstMatch = fileTypesRegexp.exec(name)?.[1]\n            if (firstMatch) {\n              self.fileType =\n                firstMatch === 'tsv' && name.includes('star-fusion')\n                  ? 'STAR-Fusion'\n                  : firstMatch.toUpperCase()\n            }\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setColumnNameLineNumber(newnumber: number) {\n        if (newnumber > 0) {\n          self.columnNameLineNumber = newnumber\n        }\n      },\n\n      /**\n       * #action\n       */\n      setFileType(typeName: string) {\n        self.fileType = typeName\n      },\n\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        self.error = error\n      },\n\n      /**\n       * #action\n       */\n      setLoading(arg: boolean) {\n        self.loading = arg\n      },\n\n      /**\n       * #action\n       */\n      cancelButton() {\n        self.error = undefined\n        getParent<any>(self).setDisplayMode()\n      },\n      /**\n       * #action\n       */\n      setCachedFileHandle(arg: FileLocation) {\n        self.cachedFileLocation = arg\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * fetch and parse the file, make a new Spreadsheet model for it, then set\n       * the parent to display it\n       */\n      async import(assemblyName: string) {\n        if (!self.fileSource) {\n          return\n        }\n\n        self.selectedAssemblyName = assemblyName\n        const type = self.fileType as keyof typeof fileTypeParsers\n        const typeParser = await fileTypeParsers[type]()\n\n        const { fetchAndMaybeUnzip } = await import('@jbrowse/core/util')\n        const { pluginManager } = getEnv(self)\n        const filehandle = openLocation(self.fileSource, pluginManager)\n        self.setLoading(true)\n        try {\n          const stat = await filehandle.stat()\n          if (stat.size > IMPORT_SIZE_LIMIT) {\n            self.setError(\n              `File is too big. Tabular files are limited to at most ${(\n                IMPORT_SIZE_LIMIT / 1000\n              ).toLocaleString()}kb.`,\n            )\n            return\n          }\n        } catch (e) {\n          // not required for stat to succeed to proceed, but it is helpful\n          console.warn(e)\n        } finally {\n          self.setLoading(false)\n        }\n\n        self.setLoading(true)\n        try {\n          if (self.fileSource.uri) {\n            self.setCachedFileHandle({\n              uri: self.fileSource.uri,\n              baseUri: self.fileSource.baseUri,\n              locationType: 'UriLocation',\n            })\n          }\n          const data = await fetchAndMaybeUnzip(filehandle)\n          getParent<any>(self).displaySpreadsheet({\n            ...typeParser(data),\n            assemblyName,\n          })\n        } catch (e) {\n          console.error(e)\n          self.setError(e)\n        } finally {\n          self.setLoading(false)\n        }\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // just a one-time thing on load\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            if (self.cachedFileLocation && self.selectedAssemblyName) {\n              self.setFileSource(self.cachedFileLocation)\n              await self.import(self.selectedAssemblyName)\n            }\n          } catch (e) {\n            console.error(e)\n            getSession(self).notifyError(`${e}`, e)\n          }\n        })()\n      },\n    }))\n}\nexport type ImportWizardStateModel = ReturnType<typeof stateModelFactory>\nexport type ImportWizardModel = Instance<ImportWizardStateModel>\n","import type { AbstractSessionModel } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function locationLinkClick({\n  assemblyName,\n  session,\n  locString,\n  spreadsheetViewId,\n}: {\n  assemblyName: string\n  session: AbstractSessionModel\n  locString: string\n  spreadsheetViewId: string\n}) {\n  const newViewId = `${spreadsheetViewId}_${assemblyName}`\n  let view = session.views.find(v => v.id === newViewId) as\n    | LinearGenomeViewModel\n    | undefined\n  if (!view) {\n    view = session.addView('LinearGenomeView', {\n      id: newViewId,\n    }) as LinearGenomeViewModel\n  }\n  return view.navToLocString(locString, assemblyName)\n}\n","import { lazy } from 'react'\n\nimport CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { SimpleFeature, assembleLocStringFast } from '@jbrowse/core/util'\nimport ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown'\nimport { getEnv } from 'mobx-state-tree'\n\nimport { locationLinkClick } from '../util'\n\nimport type {\n  AbstractSessionModel,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util'\n\n// lazies\nconst BreakendMultiLevelOptionDialog = lazy(\n  () => import('./BreakendMultiLevelOptionDialog'),\n)\nconst BreakendSingleLevelOptionDialog = lazy(\n  () => import('./BreakendSingleLevelOptionDialog'),\n)\n\nexport default function FeatureMenu({\n  assemblyName,\n  session,\n  spreadsheetViewId,\n  feature,\n}: {\n  spreadsheetViewId: string\n  assemblyName: string\n  session: AbstractSessionModel\n  feature: SimpleFeatureSerialized\n}) {\n  return (\n    <CascadingMenuButton\n      menuItems={[\n        {\n          label: 'Open in linear genome view',\n          onClick: async () => {\n            try {\n              await locationLinkClick({\n                spreadsheetViewId,\n                assemblyName,\n                session,\n                locString: assembleLocStringFast(feature),\n              })\n            } catch (e) {\n              console.error(e)\n              session.notifyError(`${e}`, e)\n            }\n          },\n        },\n        {\n          label: 'Open in single-level split view',\n          onClick: async () => {\n            const { pluginManager } = getEnv(session)\n            const viewType = pluginManager.getViewType('BreakpointSplitView')!\n            session.queueDialog(handleClose => [\n              BreakendSingleLevelOptionDialog,\n              {\n                handleClose,\n                session,\n                stableViewId: `${spreadsheetViewId}_${assemblyName}_breakpointsplitview_singlelevel`,\n                feature: new SimpleFeature(feature),\n                viewType,\n                assemblyName,\n              },\n            ])\n          },\n        },\n        {\n          label: 'Open in multi-level split view',\n          onClick: async () => {\n            const { pluginManager } = getEnv(session)\n            const viewType = pluginManager.getViewType('BreakpointSplitView')!\n            session.queueDialog(handleClose => [\n              BreakendMultiLevelOptionDialog,\n              {\n                handleClose,\n                session,\n                stableViewId: `${spreadsheetViewId}_${assemblyName}_breakpointsplitview_multilevel`,\n                feature: new SimpleFeature(feature),\n                viewType,\n                assemblyName,\n              },\n            ])\n          },\n        },\n      ]}\n    >\n      <ArrowDropDownIcon />\n    </CascadingMenuButton>\n  )\n}\n","import { assembleLocString, getSession } from '@jbrowse/core/util'\nimport { Link } from '@mui/material'\nimport { getParent } from 'mobx-state-tree'\n\nimport { locationLinkClick } from '../util'\nimport FeatureMenu from './FeatureMenu'\n\nimport type { SimpleFeatureSerialized } from '@jbrowse/core/util'\n\nexport default function LocationCell({\n  model,\n  feature,\n}: {\n  model: { assemblyName?: string }\n  feature: SimpleFeatureSerialized\n}) {\n  return (\n    <>\n      <FeatureMenu\n        session={getSession(model)}\n        spreadsheetViewId={getParent<any>(model).id}\n        assemblyName={model.assemblyName!}\n        feature={feature}\n      />\n      <Link\n        href=\"#\"\n        onClick={async event => {\n          try {\n            event.preventDefault()\n            await locationLinkClick({\n              spreadsheetViewId: getParent<any>(model).id,\n              session: getSession(model),\n              locString: assembleLocString(feature),\n              assemblyName: model.assemblyName!,\n            })\n          } catch (e) {\n            console.error(e)\n            getSession(model).notifyError(`${e}`, e)\n          }\n        }}\n      >\n        {assembleLocString(feature)}\n      </Link>\n    </>\n  )\n}\n","import { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession } from '@jbrowse/core/util'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport { cast, types } from 'mobx-state-tree'\n\nimport ImportWizard from './ImportWizard'\nimport Spreadsheet from './SpreadsheetModel'\n\nimport type { SpreadsheetModel } from './SpreadsheetModel'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type { Instance } from 'mobx-state-tree'\n\nconst minHeight = 40\nconst defaultHeight = 440\n\n/**\n * #stateModel SpreadsheetView\n * #category view\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function stateModelFactory() {\n  const ImportWizardModel = ImportWizard()\n  return types\n    .compose(\n      BaseViewModel,\n      types\n        .model('SpreadsheetView', {\n          /**\n           * #property\n           */\n          type: types.literal('SpreadsheetView'),\n          /**\n           * #property\n           */\n          offsetPx: 0,\n          /**\n           * #property\n           */\n          height: types.optional(types.number, defaultHeight),\n          /**\n           * #property\n           */\n          hideVerticalResizeHandle: false,\n          /**\n           * #property\n           */\n          hideFilterControls: false,\n\n          /**\n           * #property\n           */\n          importWizard: types.optional(ImportWizardModel, () =>\n            ImportWizardModel.create(),\n          ),\n          /**\n           * #property\n           */\n          spreadsheet: types.maybe(Spreadsheet()),\n        })\n        .volatile(() => ({\n          /**\n           * #volatile\n           */\n          width: 400,\n          /**\n           * #volatile\n           */\n          rowMenuItems: [] as MenuItem[],\n        }))\n        .views(self => ({\n          /**\n           * #getter\n           */\n          get assembly() {\n            const name = self.spreadsheet?.assemblyName\n            return name\n              ? getSession(self).assemblyManager.get(name)?.configuration\n              : undefined\n          },\n        }))\n        .actions(self => ({\n          /**\n           * #action\n           */\n          setRowMenuItems(newItems: MenuItem[]) {\n            self.rowMenuItems = newItems\n          },\n          /**\n           * #action\n           */\n          setWidth(newWidth: number) {\n            self.width = newWidth\n            return self.width\n          },\n          /**\n           * #action\n           */\n          setHeight(newHeight: number) {\n            self.height = Math.max(newHeight, minHeight)\n            return self.height\n          },\n          /**\n           * #action\n           */\n          resizeHeight(distance: number) {\n            const oldHeight = self.height\n            const newHeight = this.setHeight(self.height + distance)\n            return newHeight - oldHeight\n          },\n          /**\n           * #action\n           */\n          resizeWidth(distance: number) {\n            const oldWidth = self.width\n            const newWidth = this.setWidth(self.width + distance)\n            return newWidth - oldWidth\n          },\n\n          /**\n           * #action\n           * load a new spreadsheet and set our mode to display it\n           */\n          displaySpreadsheet(spreadsheet?: SpreadsheetModel) {\n            self.spreadsheet = cast(spreadsheet)\n          },\n        }))\n        .views(self => ({\n          /**\n           * #method\n           */\n          menuItems() {\n            return [\n              {\n                label: 'Return to import form',\n                icon: FolderOpenIcon,\n                onClick: () => {\n                  self.displaySpreadsheet(undefined)\n                },\n              },\n            ]\n          },\n        })),\n    )\n    .postProcessSnapshot(snap => {\n      const { importWizard, spreadsheet } = snap\n      if (importWizard.cachedFileLocation && spreadsheet) {\n        // don't serialize spreadsheet rows if we have the importForm\n        // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n        const { rowSet, ...rest } = spreadsheet as Omit<\n          typeof spreadsheet,\n          symbol\n        >\n\n        return {\n          ...(snap as Omit<typeof snap, symbol>),\n          spreadsheet: rest,\n        }\n      } else if (spreadsheet) {\n        // don't serialize spreadsheet rows if we have the importForm\n        const { rowSet, ...rest } = spreadsheet as Omit<\n          typeof spreadsheet,\n          symbol\n        >\n        // check stringified length of rows if it is a localfile or similar.\n        // try not to exceed localstorage limits\n        return rowSet && JSON.stringify(rowSet).length > 1_000_000\n          ? {\n              ...(snap as Omit<typeof snap, symbol>),\n              spreadsheet: rest,\n            }\n          : snap\n      }\n      return snap\n    })\n}\n\nexport type SpreadsheetViewStateModel = ReturnType<typeof stateModelFactory>\nexport type SpreadsheetViewModel = Instance<SpreadsheetViewStateModel>\n","import {\n  assembleLocStringFast,\n  getSession,\n  measureGridWidth,\n  toLocale,\n} from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\n\nimport LocationCell from './components/LocationCell'\n\nimport type { SimpleFeatureSerialized } from '@jbrowse/core/util'\nimport type { GridColDef } from '@mui/x-data-grid'\nimport type { Instance } from 'mobx-state-tree'\n\nexport interface Row {\n  // optional feature per-row\n  feature?: SimpleFeatureSerialized\n\n  // new style: object with key->name values\n  cellData?: Record<string, unknown>\n\n  // old style: array of cells\n  cells?: {\n    text: unknown\n  }[]\n}\n\nexport interface RowSet {\n  rows: Row[]\n}\n\n/**\n * #stateModel SpreadsheetViewSpreadsheet\n * #category view\n */\nexport default function stateModelFactory() {\n  return types\n    .model('Spreadsheet', {\n      /**\n       * #property\n       */\n      rowSet: types.frozen<RowSet | undefined>(),\n      /**\n       * #property\n       */\n      columns: types.frozen<{ name: string }[]>(),\n      /**\n       * #property\n       */\n      assemblyName: types.maybe(types.string),\n      /**\n       * #property\n       */\n      visibleColumns: types.frozen<Record<string, boolean>>(),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      visibleRowFlags: undefined as Record<number, boolean> | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rows() {\n        return self.rowSet?.rows.map((row, i) => ({\n          id: i,\n          feature: row.feature,\n          ...Object.fromEntries(\n            self.columns.map((c, idx) => [\n              c.name,\n              row.cellData?.[c.name] ?? row.cells?.[idx]?.text,\n            ]),\n          ),\n        }))\n      },\n\n      /**\n       * #getter\n       */\n      get initialized() {\n        const session = getSession(self)\n        const name = self.assemblyName\n        return (\n          self.rowSet &&\n          (name ? session.assemblyManager.get(name)?.initialized : false)\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get dataGridColumns() {\n        const { rows } = self\n        return rows\n          ? [\n              {\n                field: 'Location',\n                width:\n                  measureGridWidth(\n                    rows.map(row =>\n                      row.feature ? assembleLocStringFast(row.feature) : 0,\n                    ),\n                  ) + 40,\n                renderCell: ({ row }) => {\n                  const { feature } = row\n                  return feature ? (\n                    <LocationCell model={self} feature={feature} />\n                  ) : (\n                    'N/A'\n                  )\n                },\n              } satisfies GridColDef<(typeof rows)[0]>,\n              {\n                field: 'Length',\n                type: 'number',\n                width: measureGridWidth(\n                  rows.map(row => {\n                    const { feature } = row\n                    return feature ? feature.end - feature.start : 0\n                  }),\n                ),\n                valueGetter: (\n                  _val: unknown,\n                  row: { feature?: SimpleFeatureSerialized },\n                ) => {\n                  const { feature } = row\n                  return feature ? feature.end - feature.start : undefined\n                },\n                valueFormatter: arg => toLocale(arg),\n              } satisfies GridColDef<(typeof rows)[0]>,\n\n              ...self.columns.map(\n                f =>\n                  ({\n                    field: f.name,\n                    width: measureGridWidth(\n                      // @ts-expect-error\n                      [...rows.map(r => r[f.name]), f.name],\n                      { minWidth: 20 },\n                    ),\n                    type:\n                      // @ts-expect-error\n                      typeof rows[0][f.name] === 'number'\n                        ? 'number'\n                        : undefined,\n                  }) satisfies GridColDef<(typeof rows)[0]>,\n              ),\n            ]\n          : undefined\n      },\n    }))\n    .views(self => ({\n      get visibleRows() {\n        const { visibleRowFlags } = self\n        return visibleRowFlags\n          ? self.rows?.filter((_f, idx) => !!visibleRowFlags[idx])\n          : self.rows\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setVisibleRows(arg?: Record<number, boolean>) {\n        self.visibleRowFlags = arg\n      },\n      /**\n       * #action\n       */\n      setVisibleColumns(arg: Record<string, boolean>) {\n        self.visibleColumns = arg\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      return snap\n        ? {\n            ...snap,\n            // @ts-expect-error no longer support derived columns\n            columns: snap.columns.filter(f => !f.isDerived),\n            rowSet: snap.rowSet\n              ? {\n                  ...snap.rowSet,\n                  rows: snap.rowSet.rows.map(r => ({\n                    ...r,\n                    feature:\n                      r.feature ??\n                      // @ts-expect-error\n                      (r.extendedData?.vcfFeature as SimpleFeatureSerialized),\n                  })),\n                }\n              : undefined,\n          }\n        : snap\n    })\n}\n\nexport type SpreadsheetStateModel = ReturnType<typeof stateModelFactory>\nexport type SpreadsheetModel = Instance<SpreadsheetStateModel>\n","import Plugin from '@jbrowse/core/Plugin'\nimport { isAbstractMenuManager } from '@jbrowse/core/util'\nimport ViewComfyIcon from '@mui/icons-material/ViewComfy'\n\nimport LaunchSpreadsheetViewF from './LaunchSpreadsheetView'\nimport SpreadsheetViewF from './SpreadsheetView'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default class SpreadsheetViewPlugin extends Plugin {\n  name = 'SpreadsheetViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    SpreadsheetViewF(pluginManager)\n    LaunchSpreadsheetViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    const { rootModel } = pluginManager\n    if (isAbstractMenuManager(rootModel)) {\n      rootModel.appendToSubMenu(['Add'], {\n        label: 'Spreadsheet view',\n        icon: ViewComfyIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SpreadsheetView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  type SpreadsheetViewModel,\n  type SpreadsheetViewStateModel,\n} from './SpreadsheetView'\n","import { lazy } from 'react'\n\nimport { ViewType } from '@jbrowse/core/pluggableElementTypes'\n\nimport stateModelFactory from './SpreadsheetViewModel'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SpreadsheetViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'SpreadsheetView',\n      displayName: 'Spreadsheet view',\n      stateModel: stateModelFactory(),\n      ReactComponent: lazy(() => import('./components/SpreadsheetView')),\n    })\n  })\n}\n\nexport type {\n  SpreadsheetViewModel,\n  SpreadsheetViewStateModel,\n} from './SpreadsheetViewModel'\n","import type { SpreadsheetViewModel } from '../SpreadsheetView'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default function LaunchSpreadsheetViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-SpreadsheetView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      uri,\n      fileType,\n    }: {\n      session: AbstractSessionModel\n      assembly: string\n      uri: string\n      fileType?: string\n    }) => {\n      const view = session.addView('SpreadsheetView') as SpreadsheetViewModel\n      const exts = uri.split('.')\n      let ext = exts.pop()?.toUpperCase()\n      if (ext === 'GZ') {\n        ext = exts.pop()?.toUpperCase()\n      }\n\n      view.importWizard.setFileType(fileType || ext || '')\n      view.importWizard.setSelectedAssemblyName(assembly)\n      view.importWizard.setFileSource({\n        uri,\n        locationType: 'UriLocation',\n      })\n      await view.importWizard.import(assembly)\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\nimport { navToMultiLevelBreak } from '@jbrowse/sv-core'\nimport { type IAnyStateTreeNode, getParent } from 'mobx-state-tree'\n\nimport stateModelFactory from './model'\n\nimport type { SvInspectorViewModel } from './model'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { CircularViewModel } from '@jbrowse/plugin-circular-view'\n\nfunction defaultOnChordClick(feature: Feature, chordTrack: IAnyStateTreeNode) {\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  ;(async () => {\n    const session = getSession(chordTrack)\n    try {\n      session.setSelection(feature)\n      const view = getContainingView(chordTrack) as CircularViewModel\n      const parentView = getParent<any>(view) as SvInspectorViewModel\n      const stableViewId = `${parentView.id}_spawned`\n      await navToMultiLevelBreak({\n        assemblyName: view.assemblyNames[0]!,\n        session,\n        stableViewId,\n        feature,\n      })\n    } catch (e) {\n      console.error(e)\n      session.notifyError(`${e}`, e)\n    }\n  })()\n}\n\nexport default function SvInspectorViewF(pluginManager: PluginManager) {\n  pluginManager.jexl.addFunction('defaultOnChordClick', defaultOnChordClick)\n\n  pluginManager.addViewType(() => {\n    const stateModel = stateModelFactory(pluginManager)\n    return new ViewType({\n      name: 'SvInspectorView',\n      displayName: 'SV inspector',\n      stateModel,\n      ReactComponent: lazy(() => import('./components/SvInspectorView')),\n    })\n  })\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport { isAbstractMenuManager } from '@jbrowse/core/util/types'\nimport TableChartIcon from '@mui/icons-material/TableChart'\n\nimport LaunchSvInspectorViewF from './LaunchSvInspectorView'\nimport SvInspectorViewF from './SvInspectorView'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util/types'\n\nexport default class SvInspectorViewPlugin extends Plugin {\n  name = 'SvInspectorViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    SvInspectorViewF(pluginManager)\n    LaunchSvInspectorViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'SV inspector',\n        icon: TableChartIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SvInspectorView', {})\n        },\n      })\n    }\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession } from '@jbrowse/core/util'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport { autorun, reaction } from 'mobx'\nimport { addDisposer, types } from 'mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { Region } from '@jbrowse/core/util'\nimport type { CircularViewStateModel } from '@jbrowse/plugin-circular-view'\nimport type { SpreadsheetViewStateModel } from '@jbrowse/plugin-spreadsheet-view'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel SvInspectorView\n * #category view\n * does not extend, but is a combination of a\n * - [SpreadsheetView](../spreadsheetview)\n * - [CircularView](../circularview)\n *\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nfunction SvInspectorViewF(pluginManager: PluginManager) {\n  const SpreadsheetViewType = pluginManager.getViewType('SpreadsheetView')!\n  const CircularViewType = pluginManager.getViewType('CircularView')!\n\n  const SpreadsheetModel =\n    SpreadsheetViewType.stateModel as SpreadsheetViewStateModel\n  const CircularModel = CircularViewType.stateModel as CircularViewStateModel\n\n  const minHeight = 400\n  const defaultHeight = 550\n  const headerHeight = 52\n  const circularViewOptionsBarHeight = 52\n  return types\n    .compose(\n      'SvInspectorView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('SvInspectorView'),\n\n        /**\n         * #property\n         */\n        height: types.optional(types.number, defaultHeight),\n        /**\n         * #property\n         */\n        onlyDisplayRelevantRegionsInCircularView: false,\n        /**\n         * #property\n         */\n        spreadsheetView: types.optional(SpreadsheetModel, () =>\n          SpreadsheetModel.create({\n            type: 'SpreadsheetView',\n            hideVerticalResizeHandle: true,\n          }),\n        ),\n        /**\n         * #property\n         */\n        circularView: types.optional(CircularModel, () =>\n          CircularModel.create({\n            type: 'CircularView',\n            hideVerticalResizeHandle: true,\n            hideTrackSelectorButton: true,\n            disableImportForm: true,\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      width: 800,\n      /**\n       * #volatile\n       */\n      SpreadsheetViewReactComponent: SpreadsheetViewType.ReactComponent,\n      /**\n       * #volatile\n       */\n      CircularViewReactComponent: CircularViewType.ReactComponent,\n      /**\n       * #volatile\n       */\n      circularViewOptionsBarHeight,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblyName() {\n        const { assembly } = self.spreadsheetView\n        return assembly\n          ? (readConfObject(assembly, 'name') as string)\n          : undefined\n      },\n      /**\n       * #getter\n       */\n      get showCircularView() {\n        return !!self.spreadsheetView.spreadsheet?.rowSet\n      },\n\n      /**\n       * #getter\n       */\n      get features() {\n        return (\n          structuredClone(self.spreadsheetView.spreadsheet?.visibleRows)\n            ?.map(row => row.feature)\n            .filter(f => !!f) || []\n        )\n      },\n      /**\n       * #getter\n       */\n      get featuresAdapterConfigSnapshot() {\n        return {\n          type: 'FromConfigAdapter',\n          features: this.features,\n        }\n      },\n      /**\n       * #getter\n       */\n      get featureRefNames() {\n        return [\n          ...new Set(\n            [\n              ...this.features.map(r => r.refName),\n              // @ts-expect-error\n              ...this.features.flatMap(r => r.INFO?.CHR2),\n              // @ts-expect-error\n              ...this.features.flatMap(r => r.mate?.refName),\n            ].filter(f => !!f),\n          ),\n        ]\n      },\n      get currentAssembly() {\n        const { assemblyManager } = getSession(self)\n        return this.assemblyName\n          ? assemblyManager.get(this.assemblyName)\n          : undefined\n      },\n\n      /**\n       * #getter\n       */\n      get canonicalFeatureRefNameSet() {\n        const asm = this.currentAssembly\n        return new Set(\n          asm?.initialized\n            ? this.featureRefNames.map(r => asm.getCanonicalRefName(r) || r)\n            : [],\n        )\n      },\n      /**\n       * #getter\n       */\n      get featuresCircularTrackConfiguration() {\n        return {\n          type: 'VariantTrack',\n          trackId: `sv-inspector-variant-track-${self.id}`,\n          name: 'features from tabular data',\n          adapter: this.featuresAdapterConfigSnapshot,\n          assemblyNames: [this.assemblyName],\n          displays: [\n            {\n              type: 'ChordVariantDisplay',\n              displayId: `sv-inspector-variant-track-chord-display-${self.id}`,\n              onChordClick:\n                'jexl:defaultOnChordClick(feature, track, pluginManager)',\n              renderer: {\n                type: 'StructuralVariantChordRenderer',\n              },\n            },\n          ],\n        }\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.width = newWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = Math.max(newHeight, minHeight)\n        return self.height\n      },\n\n      /**\n       * #action\n       */\n      setDisplayedRegions(regions: Region[]) {\n        self.circularView.setDisplayedRegions(regions)\n      },\n      /**\n       * #action\n       */\n      setOnlyDisplayRelevantRegionsInCircularView(val: boolean) {\n        self.onlyDisplayRelevantRegionsInCircularView = Boolean(val)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems() {\n        return [\n          {\n            label: 'Return to import form',\n            icon: FolderOpenIcon,\n            onClick: () => {\n              self.spreadsheetView.displaySpreadsheet(undefined)\n            },\n          },\n        ]\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = self.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n      afterAttach() {\n        // synchronize subview widths\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const borderWidth = 1\n              if (self.showCircularView) {\n                const spreadsheetWidth = Math.round(self.width * 0.66)\n                const circularViewWidth = self.width - spreadsheetWidth\n                self.spreadsheetView.setWidth(spreadsheetWidth - borderWidth)\n                self.circularView.setWidth(circularViewWidth)\n              } else {\n                self.spreadsheetView.setWidth(self.width)\n              }\n            },\n            { name: 'SvInspectorView width binding' },\n          ),\n        )\n        // synchronize subview heights\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              self.spreadsheetView.setHeight(self.height - headerHeight)\n              self.circularView.setHeight(\n                self.height - headerHeight - circularViewOptionsBarHeight,\n              )\n            },\n            {\n              name: 'SvInspectorView height binding',\n            },\n          ),\n        )\n\n        // bind circularview displayedRegions to spreadsheet assembly, mediated\n        // by the onlyRelevantRegions toggle\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              const {\n                onlyDisplayRelevantRegionsInCircularView,\n                circularView,\n                canonicalFeatureRefNameSet,\n                currentAssembly,\n              } = self\n              if (!circularView.initialized || !currentAssembly?.regions) {\n                return\n              } else if (onlyDisplayRelevantRegionsInCircularView) {\n                if (circularView.tracks.length === 1) {\n                  try {\n                    circularView.setDisplayedRegions(\n                      structuredClone(\n                        currentAssembly.regions.filter(r =>\n                          canonicalFeatureRefNameSet.has(r.refName),\n                        ),\n                      ),\n                    )\n                  } catch (e) {\n                    console.error(e)\n                    getSession(self).notifyError(`${e}`, e)\n                  }\n                }\n              } else {\n                circularView.setDisplayedRegions(currentAssembly.regions)\n              }\n            },\n            { name: 'SvInspectorView displayed regions bind' },\n          ),\n        )\n\n        // bind circularview tracks to our track snapshot view\n        addDisposer(\n          self,\n          reaction(\n            () => ({\n              generatedTrackConf: self.featuresCircularTrackConfiguration,\n              assemblyName: self.assemblyName,\n            }),\n            data => {\n              // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n              if (!data) {\n                return\n              }\n              const { assemblyName, generatedTrackConf } = data\n              const { circularView } = self\n              // hide any visible tracks\n              for (const t of circularView.tracks) {\n                circularView.hideTrack(t.configuration.trackId)\n              }\n\n              // put our track in as the only track\n              if (assemblyName) {\n                // @ts-expect-error\n                circularView.addTrackConf(generatedTrackConf, {\n                  assemblyName,\n                })\n              }\n            },\n            {\n              name: 'SvInspectorView track configuration binding',\n              fireImmediately: true,\n            },\n          ),\n        )\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      const { circularView, ...rest } = snap as Omit<typeof snap, symbol>\n      return rest\n    })\n}\n\nexport type SvInspectorViewStateModel = ReturnType<typeof SvInspectorViewF>\nexport type SvInspectorViewModel = Instance<SvInspectorViewStateModel>\n\nexport default SvInspectorViewF\n","import type { SvInspectorViewModel } from '../SvInspectorView/model'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default function LaunchSvInspectorViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-SvInspectorView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      uri,\n      fileType,\n    }: {\n      session: AbstractSessionModel\n      assembly: string\n      uri: string\n      fileType?: string\n    }) => {\n      const view = session.addView('SvInspectorView') as SvInspectorViewModel\n      const exts = uri.split('.')\n      let ext = exts.pop()?.toUpperCase()\n      if (ext === 'GZ') {\n        ext = exts.pop()?.toUpperCase()\n      }\n\n      view.spreadsheetView.importWizard.setFileType(fileType || ext || '')\n      view.spreadsheetView.importWizard.setSelectedAssemblyName(assembly)\n      view.spreadsheetView.importWizard.setFileSource({\n        uri,\n        locationType: 'UriLocation',\n      })\n      await view.spreadsheetView.importWizard.import(assembly)\n    },\n  )\n}\n","import { useEffect, useState } from 'react'\n\nimport { getViewParams, measureText, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { isAlive, isStateTreeNode } from 'mobx-state-tree'\n\nimport type { DisplayModel } from './util'\nimport type { Feature, Region } from '@jbrowse/core/util'\n\ninterface ViewParams {\n  start: number\n  end: number\n  offsetPx: number\n  offsetPx1: number\n}\n\nconst FeatureLabel = observer(function ({\n  text,\n  x,\n  y,\n  region,\n  reversed,\n  bpPerPx,\n  exportSVG,\n  feature,\n  viewParams,\n  color = 'black',\n  fontHeight = 11,\n  featureWidth = 0,\n  allowedWidthExpansion = 0,\n  displayModel = {},\n}: {\n  text: string\n  x: number\n  y: number\n  color?: string\n  fontHeight?: number\n  featureWidth?: number\n  bpPerPx: number\n  allowedWidthExpansion?: number\n  feature: Feature\n  reversed?: boolean\n  displayModel?: DisplayModel\n  exportSVG?: unknown\n  region: Region\n  viewParams: ViewParams\n}) {\n  const totalWidth = featureWidth + allowedWidthExpansion\n  const measuredTextWidth = measureText(text, fontHeight)\n  const params =\n    isStateTreeNode(displayModel) && isAlive(displayModel) && !exportSVG\n      ? getViewParams(displayModel)\n      : viewParams\n\n  const viewLeft = reversed ? params.end : params.start\n\n  const [featureLabelsVisible, setFeatureLabelsVisible] = useState(exportSVG)\n  const theme = useTheme()\n\n  // we use an effect to set the label visible because there can be a\n  // mismatch between the server and the client after hydration due to the\n  // floating labels. if we are exporting an SVG we allow it as is though and\n  // do not use the effect\n  useEffect(() => {\n    setFeatureLabelsVisible(true)\n  }, [])\n\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return null\n  }\n\n  const rstart = region.start\n  const rend = region.end\n  const fstart = feature.get('start')\n  const fend = feature.get('end')\n\n  const featureWidthBp = measuredTextWidth * bpPerPx\n\n  // this tricky bit of code helps smooth over block boundaries\n  // not supported for reverse mode currently\n  // reason: reverse mode allocates space for the label in the \"normal\n  // forward orientation\" making it hard to slide. The reverse mode should\n  // allocate the label space in the reverse orientation to slide it\n  if (\n    viewLeft < rend &&\n    viewLeft > rstart &&\n    fstart < viewLeft &&\n    viewLeft + featureWidthBp < fend\n  ) {\n    x = params.offsetPx\n  } else if (\n    fstart < viewLeft &&\n    viewLeft + featureWidthBp < fend &&\n    viewLeft + featureWidthBp > rstart &&\n    viewLeft + featureWidthBp < rend\n  ) {\n    x = params.offsetPx1\n  }\n\n  return featureLabelsVisible ? (\n    <text\n      x={x}\n      y={y + fontHeight}\n      fill={color === '#f0f' ? stripAlpha(theme.palette.text.primary) : color}\n      fontSize={fontHeight}\n    >\n      {measuredTextWidth > totalWidth\n        ? `${text.slice(0, totalWidth / (fontHeight * 0.6))}...`\n        : text}\n    </text>\n  ) : null\n})\n\nexport default FeatureLabel\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\n\nimport FeatureLabel from './FeatureLabel'\n\nimport type { DisplayModel } from './util'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type { SceneGraph } from '@jbrowse/core/util/layouts'\n\nconst FeatureGlyph = observer(function (props: {\n  feature: Feature\n  rootLayout: SceneGraph\n  config: AnyConfigurationModel\n  name: string\n  description: string\n  shouldShowName: boolean\n  shouldShowDescription: boolean\n  colorByCDS: boolean\n  fontHeight: number\n  allowedWidthExpansion: number\n  exportSVG?: unknown\n  displayModel?: DisplayModel\n  selected?: boolean\n  reversed?: boolean\n  topLevel?: boolean\n  region: Region\n  viewParams: {\n    end: number\n    start: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  bpPerPx: number\n}) {\n  const {\n    feature,\n    rootLayout,\n    config,\n    name,\n    description,\n    shouldShowName,\n    shouldShowDescription,\n  } = props\n\n  const featureLayout = rootLayout.getSubRecord(String(feature.id()))\n  if (!featureLayout) {\n    return null\n  }\n  const { GlyphComponent } = featureLayout.data || {}\n\n  return (\n    <g>\n      <GlyphComponent featureLayout={featureLayout} {...props} />\n      {shouldShowName ? (\n        <FeatureLabel\n          text={name}\n          x={rootLayout.getSubRecord('nameLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('nameLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'nameColor'], { feature })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n      {shouldShowDescription ? (\n        <FeatureLabel\n          text={description}\n          x={rootLayout.getSubRecord('descriptionLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('descriptionLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'descriptionColor'], {\n            feature,\n          })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n    </g>\n  )\n})\n\nexport default FeatureGlyph\n","import { useEffect, useState } from 'react'\n\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport type { Feature, Region } from '@jbrowse/core/util'\n\ntype LayoutRecord = [number, number, number, number]\n\ninterface OverlayRectProps extends React.SVGProps<SVGRectElement> {\n  rect?: LayoutRecord\n  region: Region\n  bpPerPx: number\n}\n\nfunction OverlayRect({\n  rect,\n  region,\n  bpPerPx,\n  ...rectProps\n}: OverlayRectProps) {\n  if (!rect) {\n    return null\n  }\n  const [leftBp, topPx, rightBp, bottomPx] = rect\n  const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n  const rectTop = Math.round(topPx)\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const rectHeight = Math.round(bottomPx - topPx)\n  const width = rightPx - leftPx\n\n  if (leftPx + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(leftPx, 0)\n  const diff = leftWithinBlock - leftPx\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      x={leftWithinBlock - 2}\n      y={rectTop - 2}\n      width={widthWithinBlock + 4}\n      height={rectHeight + 4}\n      {...rectProps}\n    />\n  )\n}\n\ntype ME = React.MouseEvent<SVGRectElement>\ntype MEFE = ME | React.FocusEvent<SVGRectElement>\n\nconst SvgOverlay = observer(function ({\n  displayModel = {},\n  blockKey,\n  region,\n  bpPerPx,\n  movedDuringLastMouseDown,\n  ...handlers\n}: {\n  region: Region\n  displayModel?: {\n    getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n    selectedFeatureId?: string\n    featureIdUnderMouse?: string\n    contextMenuFeature?: Feature\n  }\n  bpPerPx: number\n  blockKey: string\n  movedDuringLastMouseDown?: boolean\n  onFeatureMouseDown?(event: ME, featureId: string): void\n  onFeatureMouseEnter?(event: ME, featureId: string): void\n  onFeatureMouseOut?(event: MEFE, featureId: string): void\n  onFeatureMouseOver?(event: MEFE, featureId: string): void\n  onFeatureMouseUp?(event: ME, featureId: string): void\n  onFeatureMouseLeave?(event: ME, featureId: string): void\n  onFeatureMouseMove?(event: ME, featureId: string): void\n  // synthesized from mouseup and mousedown\n  onFeatureClick?(event: ME, featureId: string): void\n  onFeatureContextMenu?(event: ME, featureId: string): void\n}) {\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const mouseoverFeatureId = featureIdUnderMouse || contextMenuFeature?.id()\n  const [renderOverlay, setRenderOverlay] = useState(false)\n  useEffect(() => {\n    setRenderOverlay(true)\n  }, [])\n\n  function onFeatureMouseDown(event: ME) {\n    const { onFeatureMouseDown: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseEnter(event: ME) {\n    const { onFeatureMouseEnter: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOut(event: ME | React.FocusEvent<SVGRectElement>) {\n    const { onFeatureMouseOut: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOver(event: ME | React.FocusEvent<SVGRectElement>) {\n    const { onFeatureMouseOver: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseUp(event: ME) {\n    const { onFeatureMouseUp: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseLeave(event: ME) {\n    const { onFeatureMouseLeave: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseMove(event: ME) {\n    const { onFeatureMouseMove: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureClick(event: ME) {\n    if (movedDuringLastMouseDown) {\n      return undefined\n    }\n    const { onFeatureClick: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    event.stopPropagation()\n    handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureContextMenu(event: ME) {\n    const { onFeatureContextMenu: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    handler(event, mouseoverFeatureId)\n  }\n\n  return renderOverlay ? (\n    <>\n      {mouseoverFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, mouseoverFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          fill=\"#000\"\n          fillOpacity=\"0.2\"\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onContextMenu={onFeatureContextMenu}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n          data-testid={mouseoverFeatureId}\n        />\n      ) : null}\n      {selectedFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, selectedFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          stroke=\"#00b8ff\"\n          fill=\"none\"\n        />\n      ) : null}\n    </>\n  ) : null\n})\n\nexport default SvgOverlay\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type { SceneGraph } from '@jbrowse/core/util/layouts'\n\nconst Arrow = observer(function Arrow({\n  feature,\n  featureLayout,\n  config,\n  region,\n}: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n}) {\n  const strand = feature.get('strand')\n  const size = 5\n  const reverseFlip = region.reversed ? -1 : 1\n  const offset = 7 * strand * reverseFlip\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n\n  const c = readConfObject(config, 'color2', { feature })\n  const theme = useTheme()\n  const color2 = c === '#f0f' ? stripAlpha(theme.palette.text.secondary) : c\n  const p =\n    strand * reverseFlip === -1\n      ? left\n      : strand * reverseFlip === 1\n        ? left + width\n        : null\n  const y = top + height / 2\n\n  return p ? (\n    <>\n      <line x1={p} x2={p + offset} y1={y} y2={y} stroke={color2} />\n      <polygon\n        points={[\n          [p + offset / 2, y - size / 2],\n          [p + offset / 2, y + size / 2],\n          [p + offset, y],\n        ].toString()}\n        stroke={color2}\n        fill={color2}\n      />\n    </>\n  ) : null\n})\n\nexport default Arrow\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getFrame } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport Arrow from './Arrow'\nimport { isUTR } from './util'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type { SceneGraph } from '@jbrowse/core/util/layouts'\n\nconst utrHeightFraction = 0.65\n\nconst Box = observer(function Box(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  bpPerPx: number\n  selected?: boolean\n  topLevel?: boolean\n  colorByCDS: boolean\n}) {\n  const theme = useTheme()\n  const {\n    colorByCDS,\n    feature,\n    region,\n    config,\n    featureLayout,\n    bpPerPx,\n    topLevel,\n  } = props\n  const { start, end } = region\n  const screenWidth = Math.ceil((end - start) / bpPerPx)\n  const featureStart = feature.get('start')\n  const featureEnd = feature.get('end')\n  const featureType: string | undefined = feature.get('type')\n  const featureStrand: -1 | 1 | undefined = feature.get('strand')\n  const featurePhase: 0 | 1 | 2 | undefined = feature.get('phase')\n  const width = (featureEnd - featureStart) / bpPerPx\n  const { left = 0 } = featureLayout.absolute\n  let { top = 0, height = 0 } = featureLayout.absolute\n\n  if (left + width < 0) {\n    return null\n  }\n\n  if (isUTR(feature)) {\n    top += ((1 - utrHeightFraction) / 2) * height\n    height *= utrHeightFraction\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(2, Math.min(width - diff, screenWidth))\n\n  let fill: string = isUTR(feature)\n    ? readConfObject(config, 'color3', { feature })\n    : readConfObject(config, 'color1', { feature })\n  if (\n    colorByCDS &&\n    featureType === 'CDS' &&\n    featureStrand !== undefined &&\n    featurePhase !== undefined\n  ) {\n    const frame = getFrame(\n      featureStart,\n      featureEnd,\n      featureStrand,\n      featurePhase,\n    )\n    const frameColor = theme.palette.framesCDS.at(frame)?.main\n    if (frameColor) {\n      fill = frameColor\n    }\n  }\n\n  // if feature has parent and type is intron, then don't render the intron\n  // subfeature (if it doesn't have a parent, then maybe the introns are\n  // separately displayed features that should be displayed)\n  return feature.parent() && featureType === 'intron' ? null : (\n    <>\n      {topLevel ? <Arrow {...props} /> : null}\n      <rect\n        data-testid={`box-${feature.id()}`}\n        x={leftWithinBlock}\n        y={top}\n        width={widthWithinBlock}\n        height={height}\n        fill={fill}\n        stroke={readConfObject(config, 'outline', { feature }) as string}\n      />\n    </>\n  )\n})\n\nexport default Box\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport Arrow from './Arrow'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type { SceneGraph } from '@jbrowse/core/util/layouts'\n\nconst Segments = observer(function Segments(props: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n  selected?: boolean\n  reversed?: boolean\n  subfeatures?: Feature[]\n  children?: React.ReactNode\n}) {\n  const {\n    feature,\n    featureLayout,\n    selected,\n    config,\n    // some subfeatures may be computed e.g. makeUTRs,\n    // so these are passed as a prop, or feature.get('subfeatures') by default\n    subfeatures = feature.get('subfeatures'),\n  } = props\n\n  const theme = useTheme()\n  const c = readConfObject(config, 'color2', { feature })\n  const color2 = c === '#f0f' ? stripAlpha(theme.palette.text.secondary) : c\n\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n\n  const y = top + height / 2\n  return (\n    <>\n      <line\n        data-testid={feature.id()}\n        x1={left}\n        y1={y}\n        y2={y}\n        x2={left + width}\n        stroke={color2}\n      />\n      {subfeatures?.map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        // This subfeature got filtered out\n        if (!subfeatureLayout) {\n          return null\n        }\n        const { GlyphComponent } = subfeatureLayout.data || {}\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            topLevel={false}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n      <Arrow {...props} />\n    </>\n  )\n})\n\nexport default Segments\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { SimpleFeature } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\nimport Segments from './Segments'\nimport { isUTR, layOutFeature, layOutSubfeatures } from './util'\n\nimport type { ExtraGlyphValidator } from './util'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type { SceneGraph } from '@jbrowse/core/util/layouts'\n\n// returns a callback that will filter features features according to the\n// subParts conf var\nfunction makeSubpartsFilter(\n  confKey: string | string[],\n  config: AnyConfigurationModel,\n) {\n  const filter = readConfObject(config, confKey) as string[] | string\n  const ret = typeof filter === 'string' ? filter.split(/\\s*,\\s*/) : filter\n\n  return (feature: Feature) =>\n    ret\n      .map(typeName => typeName.toLowerCase())\n      .includes(feature.get('type').toLowerCase())\n}\n\nfunction filterSubpart(feature: Feature, config: AnyConfigurationModel) {\n  return makeSubpartsFilter('subParts', config)(feature)\n}\n\nfunction makeUTRs(parent: Feature, subs: Feature[]) {\n  // based on Lincoln's UTR-making code in\n  // Bio::Graphics::Glyph::processed_transcript\n  const subparts = [...subs]\n\n  let codeStart = Number.POSITIVE_INFINITY\n  let codeEnd = Number.NEGATIVE_INFINITY\n\n  let haveLeftUTR: boolean | undefined\n  let haveRightUTR: boolean | undefined\n\n  // gather exons, find coding start and end, and look for UTRs\n  const exons = []\n  for (const subpart of subparts) {\n    const type = subpart.get('type')\n    if (/^cds/i.test(type)) {\n      if (codeStart > subpart.get('start')) {\n        codeStart = subpart.get('start')\n      }\n      if (codeEnd < subpart.get('end')) {\n        codeEnd = subpart.get('end')\n      }\n    } else if (/exon/i.test(type)) {\n      exons.push(subpart)\n    } else if (isUTR(subpart)) {\n      haveLeftUTR = subpart.get('start') === parent.get('start')\n      haveRightUTR = subpart.get('end') === parent.get('end')\n    }\n  }\n\n  // bail if we don't have exons and CDS\n  if (\n    !(\n      exons.length &&\n      codeStart < Number.POSITIVE_INFINITY &&\n      codeEnd > Number.NEGATIVE_INFINITY\n    )\n  ) {\n    return subparts\n  }\n\n  // make sure the exons are sorted by coord\n  exons.sort((a, b) => a.get('start') - b.get('start'))\n\n  const strand = parent.get('strand')\n\n  // make the left-hand UTRs\n  let start: number | undefined\n  let end: number | undefined\n  if (!haveLeftUTR) {\n    for (const [i, exon] of exons.entries()) {\n      start = exon.get('start')\n      if (start >= codeStart) {\n        break\n      }\n      end = Math.min(codeStart, exon.get('end'))\n      const type = strand >= 0 ? 'five_prime_UTR' : 'three_prime_UTR'\n      subparts.unshift(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  // make the right-hand UTRs\n  if (!haveRightUTR) {\n    for (let i = exons.length - 1; i >= 0; i--) {\n      end = exons[i]!.get('end')\n      if (end <= codeEnd) {\n        break\n      }\n\n      start = Math.max(codeEnd, exons[i]!.get('start'))\n      const type = strand >= 0 ? 'three_prime_UTR' : 'five_prime_UTR'\n      subparts.push(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  return subparts\n}\n\nfunction getSubparts(f: Feature, config: AnyConfigurationModel) {\n  let c = f.get('subfeatures')\n  if (!c || c.length === 0) {\n    return []\n  }\n  const hasUTRs = c.some(child => isUTR(child))\n  const isTranscript = ['mRNA', 'transcript'].includes(f.get('type'))\n  const impliedUTRs = !hasUTRs && isTranscript\n\n  // if we think we should use impliedUTRs, or it is specifically in the\n  // config, then makeUTRs\n  if (impliedUTRs || readConfObject(config, 'impliedUTRs')) {\n    c = makeUTRs(f, c)\n  }\n\n  return c.filter(element => filterSubpart(element, config))\n}\n\nconst ProcessedTranscript = observer(function ProcessedTranscript(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  selected?: boolean\n  reversed?: boolean\n  [key: string]: unknown\n}) {\n  const { feature, config } = props\n  const subfeatures = getSubparts(feature, config)\n\n  // we manually compute some subfeatures, so pass these separately\n  return <Segments {...props} subfeatures={subfeatures} />\n})\n\n// @ts-expect-error\nProcessedTranscript.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const subfeatures = getSubparts(feature, config)\n  layOutSubfeatures({\n    layout: subLayout,\n    subfeatures,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  return subLayout\n}\n\nexport default ProcessedTranscript\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\n\nimport { chooseGlyphComponent, layOut, layOutFeature } from './util'\n\nimport type { ExtraGlyphValidator } from './util'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { SceneGraph } from '@jbrowse/core/util/layouts'\nimport type { Feature } from '@jbrowse/core/util/simpleFeature'\n\nconst Subfeatures = observer(function Subfeatures(props: {\n  feature: Feature\n  featureLayout: SceneGraph\n  selected?: boolean\n}) {\n  const { feature, featureLayout, selected } = props\n\n  return feature.get('subfeatures')?.map(subfeature => {\n    const subfeatureId = String(subfeature.id())\n    const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n    if (!subfeatureLayout) {\n      return null\n    }\n    const { GlyphComponent } = subfeatureLayout.data || {}\n    return (\n      <GlyphComponent\n        key={`glyph-${subfeatureId}`}\n        {...props}\n        feature={subfeature}\n        featureLayout={subfeatureLayout}\n        selected={selected}\n      />\n    )\n  })\n})\n\n// @ts-expect-error\nSubfeatures.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const displayMode = readConfObject(config, 'displayMode')\n  if (displayMode !== 'reducedRepresentation') {\n    let topOffset = 0\n    const subfeatures = feature.get('subfeatures')\n    if (subfeatures) {\n      for (const subfeature of subfeatures) {\n        const SubfeatureGlyphComponent = chooseGlyphComponent({\n          feature: subfeature,\n          extraGlyphs,\n          config,\n        })\n        const subfeatureHeight = readConfObject(config, 'height', {\n          feature: subfeature,\n        }) as number\n\n        const subSubLayout = (SubfeatureGlyphComponent.layOut || layOut)({\n          layout: subLayout,\n          feature: subfeature,\n          bpPerPx,\n          reversed,\n          config,\n          extraGlyphs,\n        })\n        subSubLayout.move(0, topOffset)\n        topOffset +=\n          displayMode === 'collapse'\n            ? 0\n            : (displayMode === 'compact'\n                ? subfeatureHeight / 3\n                : subfeatureHeight) + 2\n      }\n    }\n  }\n  return subLayout\n}\n\nexport default Subfeatures\n","import type React from 'react'\n\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nimport Box from './Box'\nimport ProcessedTranscript from './ProcessedTranscript'\nimport Segments from './Segments'\nimport Subfeatures from './Subfeatures'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\n\nexport interface Glyph\n  extends React.FC<{\n    colorByCDS: boolean\n    feature: Feature\n    featureLayout: SceneGraph\n    selected?: boolean\n    config: AnyConfigurationModel\n    region: Region\n    bpPerPx: number\n    topLevel?: boolean\n    [key: string]: unknown\n  }> {\n  layOut?: (arg: FeatureLayOutArgs) => SceneGraph\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nexport interface DisplayModel {\n  getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n  getFeatureOverlapping?: (\n    blockKey: string,\n    bp: number,\n    y: number,\n  ) => string | undefined\n  selectedFeatureId?: string\n  featureIdUnderMouse?: string\n  contextMenuFeature?: Feature\n}\n\nexport interface ExtraGlyphValidator {\n  glyph: Glyph\n  validator: (feature: Feature) => boolean\n}\n\nexport function chooseGlyphComponent({\n  feature,\n  extraGlyphs,\n  config,\n}: {\n  feature: Feature\n  config: AnyConfigurationModel\n  extraGlyphs?: ExtraGlyphValidator[]\n}): Glyph {\n  const type = feature.get('type')\n  const subfeatures = feature.get('subfeatures')\n  const transcriptTypes = readConfObject(config, 'transcriptTypes')\n  const containerTypes = readConfObject(config, 'containerTypes')\n\n  if (subfeatures?.length && type !== 'CDS') {\n    const hasSubSub = subfeatures.some(f => f.get('subfeatures')?.length)\n    const hasCDS = subfeatures.some(f => f.get('type') === 'CDS')\n    if (transcriptTypes.includes(type) && hasCDS) {\n      return ProcessedTranscript\n    } else if (\n      (!feature.parent() && hasSubSub) ||\n      containerTypes.includes(type)\n    ) {\n      return Subfeatures\n    } else {\n      return Segments\n    }\n  } else {\n    return extraGlyphs?.find(f => f.validator(feature))?.glyph || Box\n  }\n}\n\ninterface BaseLayOutArgs {\n  layout: SceneGraph\n  bpPerPx: number\n  reversed?: boolean\n  config: AnyConfigurationModel\n}\n\ninterface FeatureLayOutArgs extends BaseLayOutArgs {\n  feature: Feature\n  extraGlyphs?: ExtraGlyphValidator[]\n}\n\ninterface SubfeatureLayOutArgs extends BaseLayOutArgs {\n  subfeatures: Feature[]\n  extraGlyphs?: ExtraGlyphValidator[]\n}\n\nexport function layOut({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: FeatureLayOutArgs): SceneGraph {\n  const displayMode = readConfObject(config, 'displayMode')\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  if (displayMode !== 'reducedRepresentation') {\n    layOutSubfeatures({\n      layout: subLayout,\n      subfeatures: feature.get('subfeatures') || [],\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  }\n  return subLayout\n}\n\nexport function layOutFeature(args: FeatureLayOutArgs) {\n  const { layout, feature, bpPerPx, reversed, config, extraGlyphs } = args\n  const displayMode = readConfObject(config, 'displayMode') as string\n  const GlyphComponent =\n    displayMode === 'reducedRepresentation'\n      ? Box\n      : chooseGlyphComponent({\n          feature,\n          extraGlyphs,\n          config,\n        })\n  const parentFeature = feature.parent()\n  let x = 0\n  if (parentFeature) {\n    x =\n      (reversed\n        ? parentFeature.get('end') - feature.get('end')\n        : feature.get('start') - parentFeature.get('start')) / bpPerPx\n  }\n  const height = readConfObject(config, 'height', { feature }) as number\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const layoutParent = layout.parent\n  const top = layoutParent ? layoutParent.top : 0\n  return layout.addChild(\n    String(feature.id()),\n    x,\n    displayMode === 'collapse' ? 0 : top,\n    Math.max(width, 1), // has to be at least one to register in the layout\n    displayMode === 'compact' ? height / 2 : height,\n    { GlyphComponent },\n  )\n}\n\nexport function layOutSubfeatures(args: SubfeatureLayOutArgs) {\n  const { layout, subfeatures, bpPerPx, reversed, config, extraGlyphs } = args\n  for (const feature of subfeatures) {\n    ;(chooseGlyphComponent({ feature, extraGlyphs, config }).layOut || layOut)({\n      layout,\n      feature,\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  }\n}\n\nexport function isUTR(feature: Feature) {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/i.test(\n    feature.get('type') || '',\n  )\n}\n","import { useCallback, useEffect, useRef, useState } from 'react'\n\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { bpToPx, measureText } from '@jbrowse/core/util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { observer } from 'mobx-react'\n\nimport FeatureGlyph from './FeatureGlyph'\nimport SvgOverlay from './SvgOverlay'\nimport { chooseGlyphComponent, layOut } from './util'\n\nimport type { DisplayModel, ExtraGlyphValidator } from './util'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, Region } from '@jbrowse/core/util'\nimport type { BaseLayout } from '@jbrowse/core/util/layouts'\n\n// used to make features have a little padding for their labels\nconst xPadding = 3\nconst yPadding = 5\n\n// used so that user can click-away-from-feature below the laid out features\n// (issue #1248)\nconst svgHeightPadding = 100\n\nfunction RenderedFeatureGlyph(props: {\n  feature: Feature\n  bpPerPx: number\n  region: Region\n  config: AnyConfigurationModel\n  colorByCDS: boolean\n  layout: BaseLayout<unknown>\n  extraGlyphs?: ExtraGlyphValidator[]\n  displayMode: string\n  exportSVG?: unknown\n  displayModel?: DisplayModel\n  detectRerender?: () => void\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  [key: string]: unknown\n}) {\n  const {\n    feature,\n    detectRerender,\n    bpPerPx,\n    region,\n    config,\n    displayMode,\n    layout,\n    extraGlyphs,\n  } = props\n\n  // used for unit testing, difficult to mock out so it is in actual source code\n  detectRerender?.()\n\n  const { reversed } = region\n  const start = feature.get(reversed ? 'end' : 'start')\n  const startPx = bpToPx(start, region, bpPerPx)\n  const labelAllowed = displayMode !== 'collapsed'\n\n  const rootLayout = new SceneGraph('root', 0, 0, 0, 0)\n  const GlyphComponent = chooseGlyphComponent({ config, feature, extraGlyphs })\n  const featureLayout = (GlyphComponent.layOut || layOut)({\n    layout: rootLayout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  let shouldShowName = false\n  let shouldShowDescription = false\n  let name = ''\n  let description = ''\n  let fontHeight = 0\n  let expansion = 0\n  if (labelAllowed) {\n    const showLabels = readConfObject(config, 'showLabels')\n    const showDescriptions = readConfObject(config, 'showDescriptions')\n    fontHeight = readConfObject(config, ['labels', 'fontSize'], { feature })\n    expansion = readConfObject(config, 'maxFeatureGlyphExpansion') || 0\n    name = String(readConfObject(config, ['labels', 'name'], { feature }) || '')\n    shouldShowName = /\\S/.test(name) && showLabels\n\n    const getWidth = (text: string) => {\n      const glyphWidth = rootLayout.width + expansion\n      const textWidth = measureText(text, fontHeight)\n      return Math.round(Math.min(textWidth, glyphWidth))\n    }\n\n    description = String(\n      readConfObject(config, ['labels', 'description'], { feature }) || '',\n    )\n    shouldShowDescription = /\\S/.test(description) && showDescriptions\n\n    if (shouldShowName) {\n      rootLayout.addChild(\n        'nameLabel',\n        0,\n        featureLayout.bottom,\n        getWidth(name),\n        fontHeight,\n      )\n    }\n\n    if (shouldShowDescription) {\n      const aboveLayout = shouldShowName\n        ? rootLayout.getSubRecord('nameLabel')\n        : featureLayout\n      if (!aboveLayout) {\n        throw new Error('failed to layout nameLabel')\n      }\n\n      rootLayout.addChild(\n        'descriptionLabel',\n        0,\n        aboveLayout.bottom,\n        getWidth(description),\n        fontHeight,\n      )\n    }\n  }\n\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start'),\n    feature.get('start') + rootLayout.width * bpPerPx + xPadding * bpPerPx,\n    rootLayout.height + yPadding,\n  )\n  if (topPx === null) {\n    return null\n  }\n  rootLayout.move(startPx, topPx)\n\n  return (\n    <FeatureGlyph\n      rootLayout={rootLayout}\n      name={name}\n      shouldShowName={shouldShowName}\n      description={description}\n      shouldShowDescription={shouldShowDescription}\n      fontHeight={fontHeight}\n      allowedWidthExpansion={expansion}\n      reversed={region.reversed}\n      topLevel={true}\n      {...props}\n    />\n  )\n}\n\nconst RenderedFeatures = observer(function RenderedFeatures(props: {\n  features?: Map<string, Feature>\n  isFeatureDisplayed?: (f: Feature) => boolean\n  bpPerPx: number\n  config: AnyConfigurationModel\n  displayMode: string\n  colorByCDS: boolean\n  displayModel?: DisplayModel\n  region: Region\n  exportSVG?: unknown\n  extraGlyphs?: ExtraGlyphValidator[]\n  layout: BaseLayout<unknown>\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  [key: string]: unknown\n}) {\n  const { features = new Map(), isFeatureDisplayed } = props\n  return (\n    <>\n      {[...features.values()]\n        .filter(feature =>\n          isFeatureDisplayed ? isFeatureDisplayed(feature) : true,\n        )\n        .map(feature => (\n          <RenderedFeatureGlyph\n            key={feature.id()}\n            feature={feature}\n            {...props}\n          />\n        ))}\n    </>\n  )\n})\n\nconst SvgFeatureRendering = observer(function SvgFeatureRendering(props: {\n  layout: BaseLayout<unknown>\n  blockKey: string\n  regions: Region[]\n  bpPerPx: number\n  detectRerender?: () => void\n  config: AnyConfigurationModel\n  colorByCDS: boolean\n  features: Map<string, Feature>\n  displayModel?: DisplayModel\n  exportSVG?: boolean\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  featureDisplayHandler?: (f: Feature) => boolean\n  extraGlyphs?: ExtraGlyphValidator[]\n  onMouseOut?: React.MouseEventHandler\n  onMouseDown?: React.MouseEventHandler\n  onMouseLeave?: React.MouseEventHandler\n  onMouseEnter?: React.MouseEventHandler\n  onMouseOver?: React.MouseEventHandler\n  onMouseMove?: (event: React.MouseEvent, featureId?: string) => void\n  onMouseUp?: React.MouseEventHandler\n  onClick?: React.MouseEventHandler\n}) {\n  const {\n    layout,\n    blockKey,\n    regions = [],\n    bpPerPx,\n    config,\n    displayModel = {},\n    exportSVG,\n    featureDisplayHandler,\n    onMouseOut,\n    onMouseDown,\n    onMouseLeave,\n    onMouseEnter,\n    onMouseOver,\n    onMouseMove,\n    onMouseUp,\n    onClick,\n  } = props\n\n  const region = regions[0]!\n  const width = (region.end - region.start) / bpPerPx\n  const displayMode = readConfObject(config, 'displayMode') as string\n  const maxConfHeight = readConfObject(config, 'maxHeight') as number\n\n  const ref = useRef<SVGSVGElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [height, setHeight] = useState(maxConfHeight)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n  const [initialMousePos, setInitialMousePos] = useState<{\n    x: number\n    y: number\n  }>()\n\n  const mouseDown = useCallback(\n    (event: React.MouseEvent) => {\n      setMouseIsDown(true)\n      setMovedDuringLastMouseDown(false)\n      setInitialMousePos({\n        x: event.clientX,\n        y: event.clientY,\n      })\n      return onMouseDown?.(event)\n    },\n    [onMouseDown],\n  )\n\n  const mouseUp = useCallback(\n    (event: React.MouseEvent) => {\n      setMouseIsDown(false)\n      setInitialMousePos(undefined)\n      return onMouseUp?.(event)\n    },\n    [onMouseUp],\n  )\n\n  const mouseMove = useCallback(\n    (event: React.MouseEvent) => {\n      if (!ref.current) {\n        return\n      }\n      if (mouseIsDown && initialMousePos) {\n        const dx = event.clientX - initialMousePos.x\n        const dy = event.clientY - initialMousePos.y\n        if (Math.abs(dx) > 8 || Math.abs(dy) > 8) {\n          setMovedDuringLastMouseDown(true)\n        }\n      }\n      const { left, top } = ref.current.getBoundingClientRect()\n      const offsetX = event.clientX - left\n      const offsetY = event.clientY - top\n      const px = region.reversed ? width - offsetX : offsetX\n      const clientBp = region.start + bpPerPx * px\n\n      const featureIdCurrentlyUnderMouse = displayModel.getFeatureOverlapping?.(\n        blockKey,\n        clientBp,\n        offsetY,\n      )\n\n      if (onMouseMove) {\n        onMouseMove(event, featureIdCurrentlyUnderMouse)\n      }\n    },\n    [\n      initialMousePos,\n      blockKey,\n      bpPerPx,\n      mouseIsDown,\n      onMouseMove,\n      region.reversed,\n      region.start,\n      displayModel,\n      width,\n    ],\n  )\n\n  const click = useCallback(\n    (event: React.MouseEvent) => {\n      // don't select a feature if we are clicking and dragging\n      if (movedDuringLastMouseDown) {\n        return\n      }\n      onClick?.(event)\n    },\n    [movedDuringLastMouseDown, onClick],\n  )\n\n  useEffect(() => {\n    setHeight(layout.getTotalHeight())\n  }, [layout])\n\n  return exportSVG ? (\n    <RenderedFeatures\n      displayMode={displayMode}\n      isFeatureDisplayed={featureDisplayHandler}\n      region={region}\n      {...props}\n    />\n  ) : (\n    <svg\n      ref={ref}\n      data-testid=\"svgfeatures\"\n      width={width}\n      height={height + svgHeightPadding}\n      style={{\n        // use block because svg by default is inline, which adds a margin\n        display: 'block',\n      }}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onMouseMove={mouseMove}\n      onClick={click}\n    >\n      <RenderedFeatures\n        displayMode={displayMode}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n        isFeatureDisplayed={featureDisplayHandler}\n        {...props}\n      />\n\n      <SvgOverlay\n        {...props}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n      />\n    </svg>\n  )\n})\n\nexport default SvgFeatureRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config SvgFeatureRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst SvgFeatureRenderer = ConfigurationSchema(\n  'SvgFeatureRenderer',\n  {\n    /**\n     * #slot\n     */\n    color1: {\n      type: 'color',\n      description: 'the main color of each feature',\n      defaultValue: 'goldenrod',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    color2: {\n      type: 'color',\n      description:\n        'the secondary color of each feature, used for connecting lines, etc',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    color3: {\n      type: 'color',\n      description:\n        'the tertiary color of each feature, often used for contrasting fills, like on UTRs',\n      defaultValue: '#357089',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    outline: {\n      type: 'color',\n      description: 'the outline for features',\n      defaultValue: '',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'height in pixels of the main body of each feature',\n      defaultValue: 10,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    showLabels: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n\n    /**\n     * #slot\n     */\n    showDescriptions: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n\n    labels: ConfigurationSchema('SvgFeatureLabels', {\n      /**\n       * #slot labels.name\n       */\n      name: {\n        type: 'string',\n        description:\n          'the primary name of the feature to show, if space is available',\n        defaultValue: `jexl:get(feature,'name') || get(feature,'id')`,\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.nameColor\n       */\n      nameColor: {\n        type: 'color',\n        description: 'the color of the name label, if shown',\n        defaultValue: '#f0f',\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.description\n       */\n      description: {\n        type: 'string',\n        description: 'the text description to show, if space is available',\n        defaultValue: `jexl:get(feature,'note') || get(feature,'description')`,\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.descriptionColor\n       */\n      descriptionColor: {\n        type: 'color',\n        description: 'the color of the description, if shown',\n        defaultValue: 'blue',\n        contextVariable: ['feature'],\n      },\n\n      /**\n       * #slot labels.fontSize\n       */\n      fontSize: {\n        type: 'number',\n        description:\n          'height in pixels of the text to use for names and descriptions',\n        defaultValue: 12,\n        contextVariable: ['feature'],\n      },\n    }),\n\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'reducedRepresentation',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n\n    /**\n     * #slot\n     */\n    maxFeatureGlyphExpansion: {\n      type: 'number',\n      description:\n        \"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use\",\n      defaultValue: 500,\n    },\n\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a svg rendering',\n      defaultValue: 1200,\n    },\n\n    /**\n     * #slot\n     */\n    subParts: {\n      type: 'string',\n      description: 'subparts for a glyph',\n      defaultValue: 'CDS,UTR,five_prime_UTR,three_prime_UTR',\n    },\n\n    /**\n     * #slot\n     */\n    impliedUTRs: {\n      type: 'boolean',\n      description: 'imply UTR from the exon and CDS differences',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    transcriptTypes: {\n      type: 'stringArray',\n      defaultValue: ['mRNA', 'transcript', 'primary_transcript'],\n    },\n    /**\n     * #slot\n     */\n    containerTypes: {\n      type: 'stringArray',\n      defaultValue: ['proteoform_orf'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default SvgFeatureRenderer\n","import Plugin from '@jbrowse/core/Plugin'\nimport BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\n\nimport {\n  ReactComponent as SvgFeatureRendererReactComponent,\n  configSchema as svgFeatureRendererConfigSchema,\n} from './SvgFeatureRenderer'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nclass SvgFeatureRenderer extends BoxRendererType {\n  supportsSVG = true\n}\n\nexport default class SVGPlugin extends Plugin {\n  name = 'SVGPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new SvgFeatureRenderer({\n          name: 'SvgFeatureRenderer',\n          ReactComponent: SvgFeatureRendererReactComponent,\n          configSchema: svgFeatureRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n  }\n}\n\nexport {\n  ReactComponent as SvgFeatureRendererReactComponent,\n  configSchema as svgFeatureRendererConfigSchema,\n} from './SvgFeatureRenderer'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config TrixTextSearchAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst TrixTextSearchAdapter = ConfigurationSchema(\n  'TrixTextSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    ixFilePath: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'out.ix',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    ixxFilePath: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'out.ixx',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    metaFilePath: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'meta.json',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'textSearchAdapterId',\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config, assumes file.ixx also exists:\n     * ```json\n     * {\n     *   \"type\": \"TrixTextSearchAdapter\",\n     *   \"uri\": \"file.ix\",\n     *   \"assemblyNames\": [\"hg19\"],\n     *   \"textSearchAdapterId\": \"hg19SearchIndex\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      return snap.uri\n        ? {\n            ...snap,\n            ixFilePath: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n            ixxFilePath: {\n              uri: `${snap.uri}x`,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default TrixTextSearchAdapter\n","import Plugin from '@jbrowse/core/Plugin'\nimport TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\n\nimport configSchema from './TrixTextSearchAdapter/configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default class TrixPlugin extends Plugin {\n  name = 'TrixPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTextSearchAdapterType(() => {\n      return new TextSearchAdapterType({\n        name: 'TrixTextSearchAdapter',\n        displayName: 'Trix text search adapter',\n        configSchema,\n        description: 'Trix text search adapter',\n        getAdapterClass: () =>\n          import('./TrixTextSearchAdapter/TrixTextSearchAdapter').then(\n            d => d.default,\n          ),\n      })\n    })\n  }\n}\n","import Alignments from '@jbrowse/plugin-alignments'\nimport Arc from '@jbrowse/plugin-arc'\nimport Authentication from '@jbrowse/plugin-authentication'\nimport Bed from '@jbrowse/plugin-bed'\nimport BreakpointSplitView from '@jbrowse/plugin-breakpoint-split-view'\nimport CircularView from '@jbrowse/plugin-circular-view'\nimport ComparativeAdapters from '@jbrowse/plugin-comparative-adapters'\nimport Config from '@jbrowse/plugin-config'\nimport DataManagement from '@jbrowse/plugin-data-management'\nimport DotplotView from '@jbrowse/plugin-dotplot-view'\nimport GCContent from '@jbrowse/plugin-gccontent'\nimport Gff3 from '@jbrowse/plugin-gff3'\nimport GridBookmarkPlugin from '@jbrowse/plugin-grid-bookmark'\nimport GtfPlugin from '@jbrowse/plugin-gtf'\nimport HicPlugin from '@jbrowse/plugin-hic'\nimport JobsManagementPlugin from '@jbrowse/plugin-jobs-management'\nimport LegacyJBrowse from '@jbrowse/plugin-legacy-jbrowse'\nimport LinearComparativeView from '@jbrowse/plugin-linear-comparative-view'\nimport LinearGenomeView from '@jbrowse/plugin-linear-genome-view'\nimport Lollipop from '@jbrowse/plugin-lollipop'\nimport Menus from '@jbrowse/plugin-menus'\nimport RDF from '@jbrowse/plugin-rdf'\nimport Sequence from '@jbrowse/plugin-sequence'\nimport SpreadsheetViewPlugin from '@jbrowse/plugin-spreadsheet-view'\nimport SvInspectorPlugin from '@jbrowse/plugin-sv-inspector'\nimport SVG from '@jbrowse/plugin-svg'\nimport TrixPlugin from '@jbrowse/plugin-trix'\nimport Variants from '@jbrowse/plugin-variants'\nimport Wiggle from '@jbrowse/plugin-wiggle'\n\nconst corePlugins = [\n  SVG,\n  LinearGenomeView,\n  Alignments,\n  Authentication,\n  Bed,\n  CircularView,\n  Config,\n  DataManagement,\n  DotplotView,\n  GtfPlugin,\n  Gff3,\n  JobsManagementPlugin,\n  LegacyJBrowse,\n  LinearComparativeView,\n  Lollipop,\n  Menus,\n  RDF,\n  Sequence,\n  Variants,\n  Wiggle,\n  GCContent,\n  SpreadsheetViewPlugin,\n  SvInspectorPlugin,\n  BreakpointSplitView,\n  HicPlugin,\n  TrixPlugin,\n  GridBookmarkPlugin,\n  ComparativeAdapters,\n  Arc,\n]\n\nexport default corePlugins\n","import { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { ContentBlock } from '@jbrowse/core/util/blockTypes'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  verticalGuidesZoomContainer: {\n    position: 'absolute',\n    top: 0,\n    height: '100%',\n    width: '100%',\n    pointerEvents: 'none',\n  },\n  verticalGuidesContainer: {\n    position: 'absolute',\n    height: '100%',\n    pointerEvents: 'none',\n    display: 'flex',\n  },\n  tick: {\n    position: 'absolute',\n    height: '100%',\n    width: 1,\n  },\n  majorTick: {\n    background: theme.palette.action.disabled,\n  },\n  minorTick: {\n    background: theme.palette.divider,\n  },\n}))\n\nfunction RenderedBlockLines({\n  block,\n  bpPerPx,\n}: {\n  block: ContentBlock\n  bpPerPx: number\n}) {\n  const { classes, cx } = useStyles()\n  const ticks = makeTicks(block.start, block.end, bpPerPx)\n  return (\n    <ContentBlockComponent block={block}>\n      {ticks.map(({ type, base }) => {\n        const x =\n          (block.reversed ? block.end - base : base - block.start) / bpPerPx\n        return (\n          <div\n            key={base}\n            className={cx(\n              classes.tick,\n              type === 'major' || type === 'labeledMajor'\n                ? classes.majorTick\n                : classes.minorTick,\n            )}\n            style={{ left: x }}\n          />\n        )\n      })}\n    </ContentBlockComponent>\n  )\n}\nconst RenderedVerticalGuides = observer(({ model }: { model: LGV }) => {\n  const { staticBlocks, bpPerPx } = model\n  return (\n    <>\n      {staticBlocks.map((block, index) => {\n        const k = `${block.key}-${index}`\n        if (block.type === 'ContentBlock') {\n          return <RenderedBlockLines key={k} block={block} bpPerPx={bpPerPx} />\n        } else if (block.type === 'ElidedBlock') {\n          return <ElidedBlockComponent key={k} width={block.widthPx} />\n        } else if (block.type === 'InterRegionPaddingBlock') {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={k}\n              width={block.widthPx}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\nconst Gridlines = observer(function ({\n  model,\n  offset = 0,\n}: {\n  model: LGV\n  offset?: number\n}) {\n  const { classes } = useStyles()\n  // find the block that needs pinning to the left side for context\n  const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n  return (\n    <div\n      className={classes.verticalGuidesZoomContainer}\n      style={{\n        transform:\n          model.scaleFactor !== 1 ? `scaleX(${model.scaleFactor})` : undefined,\n      }}\n    >\n      <div\n        className={classes.verticalGuidesContainer}\n        style={{\n          left: offsetLeft - offset,\n          width: model.staticBlocks.totalWidthPx,\n        }}\n      >\n        <RenderedVerticalGuides model={model} />\n      </div>\n    </div>\n  )\n})\n\nexport default Gridlines\n","import DragIcon from '@mui/icons-material/DragIndicator'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst useStyles = makeStyles()({\n  dragHandle: {\n    cursor: 'grab',\n  },\n  dragHandleIcon: {\n    display: 'inline-block',\n    verticalAlign: 'middle',\n    pointerEvents: 'none',\n  },\n})\n\nfunction TrackLabelDragHandle({\n  trackId,\n  view,\n  track,\n}: {\n  trackId: string\n  track: BaseTrackModel\n  view: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  return (\n    <span\n      draggable\n      className={classes.dragHandle}\n      onDragStart={event => {\n        const target = event.currentTarget\n        if (target.parentNode) {\n          const parent = target.parentNode as HTMLElement\n          event.dataTransfer.setDragImage(parent, 20, 20)\n          view.setDraggingTrackId(track.id)\n        }\n      }}\n      onDragEnd={() => {\n        view.setDraggingTrackId(undefined)\n      }}\n      data-testid={`dragHandle-${view.id}-${trackId}`}\n    >\n      <DragIcon className={classes.dragHandleIcon} fontSize=\"small\" />\n    </span>\n  )\n}\n\nexport default TrackLabelDragHandle\n","import CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\nimport AddIcon from '@mui/icons-material/Add'\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown'\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp'\nimport KeyboardDoubleArrowDownIcon from '@mui/icons-material/KeyboardDoubleArrowDown'\nimport KeyboardDoubleArrowUpIcon from '@mui/icons-material/KeyboardDoubleArrowUp'\nimport MinimizeIcon from '@mui/icons-material/Minimize'\nimport MoreVertIcon from '@mui/icons-material/MoreVert'\nimport PushPinIcon from '@mui/icons-material/PushPin'\nimport { observer } from 'mobx-react'\n\nimport type { LinearGenomeViewModel } from '../model'\nimport type { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst TrackLabelMenu = observer(function ({\n  track,\n}: {\n  track: BaseTrackModel\n}) {\n  const view = getContainingView(track) as LinearGenomeViewModel\n  const session = getSession(track)\n  const trackConf = track.configuration\n  const minimized = track.minimized\n  const pinned = track.pinned\n  const { isTopLevelView } = view\n\n  const items = [\n    ...(isTopLevelView\n      ? []\n      : [\n          {\n            label: pinned ? 'Unpin track' : 'Pin track',\n            icon: PushPinIcon,\n            onClick: () => {\n              track.setPinned(!pinned)\n            },\n          },\n        ]),\n    {\n      label: 'Track order',\n      type: 'subMenu',\n      priority: 2000,\n      subMenu: [\n        {\n          label: minimized ? 'Restore track' : 'Minimize track',\n          icon: minimized ? AddIcon : MinimizeIcon,\n          onClick: () => {\n            track.setMinimized(!minimized)\n          },\n        },\n        ...(view.tracks.length > 2\n          ? [\n              {\n                label: 'Move track to top',\n                icon: KeyboardDoubleArrowUpIcon,\n                onClick: () => {\n                  view.moveTrackToTop(track.id)\n                },\n              },\n            ]\n          : []),\n\n        {\n          label: 'Move track up',\n          icon: KeyboardArrowUpIcon,\n          onClick: () => {\n            view.moveTrackUp(track.id)\n          },\n        },\n        {\n          label: 'Move track down',\n          icon: KeyboardArrowDownIcon,\n          onClick: () => {\n            view.moveTrackDown(track.id)\n          },\n        },\n        ...(view.tracks.length > 2\n          ? [\n              {\n                label: 'Move track to bottom',\n                icon: KeyboardDoubleArrowDownIcon,\n                onClick: () => {\n                  view.moveTrackToBottom(track.id)\n                },\n              },\n            ]\n          : []),\n      ],\n    },\n    ...(session.getTrackActionMenuItems?.(trackConf) || []),\n    ...track.trackMenuItems(),\n  ].sort((a, b) => (b?.priority || 0) - (a?.priority || 0))\n  return (\n    <CascadingMenuButton menuItems={items} data-testid=\"track_menu_icon\">\n      <MoreVertIcon fontSize=\"small\" />\n    </CascadingMenuButton>\n  )\n})\n\nexport default TrackLabelMenu\n","import { forwardRef } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { SanitizedHTML } from '@jbrowse/core/ui'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport CloseIcon from '@mui/icons-material/Close'\nimport { IconButton, Paper, Typography, alpha } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport TrackLabelDragHandle from './TrackLabelDragHandle'\nimport TrackLabelMenu from './TrackLabelMenu'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    // above breakpoint split view\n    zIndex: 200,\n    background: alpha(theme.palette.background.paper, 0.8),\n    '&:hover': {\n      background: theme.palette.background.paper,\n    },\n  },\n  trackName: {\n    fontSize: '0.8rem',\n  },\n  iconButton: {\n    padding: theme.spacing(1),\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\ninterface Props {\n  track: BaseTrackModel\n  className?: string\n}\n\nconst TrackLabel = observer(\n  forwardRef<HTMLDivElement, Props>(function TrackLabel2(\n    { track, className },\n    ref,\n  ) {\n    const { classes, cx } = useStyles()\n    const view = getContainingView(track) as LGV\n    const session = getSession(track)\n    const trackConf = track.configuration\n    const { minimized } = track\n    const trackId = getConf(track, 'trackId')\n    const trackName = getTrackName(trackConf, session)\n\n    return (\n      <Paper\n        ref={ref}\n        className={cx(className, classes.root)}\n        onClick={event => {\n          // avoid clicks on track label from turning into double-click zoom\n          event.stopPropagation()\n        }}\n      >\n        <TrackLabelDragHandle track={track} trackId={trackId} view={view} />\n        <IconButton\n          onClick={() => view.hideTrack(trackId)}\n          className={classes.iconButton}\n          title=\"close this track\"\n        >\n          <CloseIcon fontSize=\"small\" />\n        </IconButton>\n\n        <Typography\n          variant=\"body1\"\n          component=\"span\"\n          className={classes.trackName}\n          onMouseDown={event => {\n            // avoid becoming a click-and-drag action on the lgv\n            event.stopPropagation()\n          }}\n        >\n          <SanitizedHTML\n            html={[trackName, minimized ? '(minimized)' : '']\n              .filter(f => !!f)\n              .join(' ')}\n          />\n        </Typography>\n        <TrackLabelMenu track={track} />\n      </Paper>\n    )\n  }),\n)\n\nexport default TrackLabel\n","import { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport TrackLabel from './TrackLabel'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst useStyles = makeStyles()({\n  trackLabel: {\n    zIndex: 2,\n  },\n\n  trackLabelOffset: {\n    position: 'relative',\n    display: 'inline-block',\n  },\n  trackLabelOverlap: {\n    position: 'absolute',\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackLabelContainer = observer(function ({\n  track,\n  view,\n}: {\n  track: BaseTrackModel\n  view: LGV\n}) {\n  const { classes, cx } = useStyles()\n  const display = track.displays[0]\n  const { trackLabel, trackLabelOverlap, trackLabelOffset } = classes\n  const labelStyle =\n    view.trackLabelsSetting !== 'overlapping' || display.prefersOffset\n      ? trackLabelOffset\n      : trackLabelOverlap\n\n  return view.trackLabelsSetting !== 'hidden' ? (\n    <TrackLabel track={track} className={cx(trackLabel, labelStyle)} />\n  ) : null\n})\n\nexport default TrackLabelContainer\n","import { Suspense, useEffect, useRef } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst useStyles = makeStyles()({\n  // aligns with block boundaries. check for example the breakpoint split view\n  // demo to see if features align if wanting to change things\n  renderingComponentContainer: {\n    position: 'absolute',\n    // -1 offset because of the 1px border of the Paper\n    left: -1,\n    height: '100%',\n    width: '100%',\n  },\n\n  trackRenderingContainer: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    position: 'relative',\n    background: 'none',\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackRenderingContainer = observer(function ({\n  model,\n  track,\n  onDragEnter,\n}: {\n  model: LGV\n  track: BaseTrackModel\n  onDragEnter: () => void\n}) {\n  const { classes } = useStyles()\n  const display = track.displays[0]\n  const { height, RenderingComponent, DisplayBlurb } = display\n  const { trackRefs, id, scaleFactor } = model\n  const trackId = getConf(track, 'trackId')\n  const ref = useRef<HTMLDivElement>(null)\n  const minimized = track.minimized\n\n  useEffect(() => {\n    if (ref.current) {\n      trackRefs[trackId] = ref.current\n    }\n    return () => {\n      delete trackRefs[trackId]\n    }\n  }, [trackRefs, trackId])\n\n  return (\n    <div\n      className={classes.trackRenderingContainer}\n      style={{\n        height: minimized ? 20 : height,\n      }}\n      onScroll={evt => display.setScrollTop(evt.currentTarget.scrollTop)}\n      onDragEnter={onDragEnter}\n      data-testid={`trackRenderingContainer-${id}-${trackId}`}\n    >\n      {!minimized ? (\n        <>\n          <div\n            ref={ref}\n            className={classes.renderingComponentContainer}\n            style={{\n              transform:\n                scaleFactor !== 1 ? `scaleX(${scaleFactor})` : undefined,\n            }}\n          >\n            <Suspense fallback={<LoadingEllipses />}>\n              <RenderingComponent\n                model={display}\n                onHorizontalScroll={model.horizontalScroll}\n              />\n            </Suspense>\n          </div>\n\n          {DisplayBlurb ? (\n            <div\n              style={{\n                position: 'absolute',\n                left: 0,\n                top: display.height - 20,\n              }}\n            >\n              <DisplayBlurb model={display} />\n            </div>\n          ) : null}\n        </>\n      ) : null}\n    </div>\n  )\n})\n\nexport default TrackRenderingContainer\n","import { useRef } from 'react'\n\nimport { ErrorMessage, ResizeHandle } from '@jbrowse/core/ui'\nimport { ErrorBoundary } from '@jbrowse/core/ui/ErrorBoundary'\nimport { Paper } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport { makeStyles } from 'tss-react/mui'\n\nimport Gridlines from './Gridlines'\nimport TrackLabelContainer from './TrackLabelContainer'\nimport TrackRenderingContainer from './TrackRenderingContainer'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst useStyles = makeStyles()({\n  root: {\n    marginTop: 2,\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  unpinnedTrack: {\n    background: 'none',\n  },\n  resizeHandle: {\n    height: 3,\n    boxSizing: 'border-box',\n    position: 'relative',\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackContainer = observer(function ({\n  model,\n  track,\n}: {\n  model: LGV\n  track: BaseTrackModel\n}) {\n  const { classes, cx } = useStyles()\n  const display = track.displays[0]\n  const { draggingTrackId, showTrackOutlines } = model\n  const ref = useRef<HTMLDivElement>(null)\n\n  return (\n    <Paper\n      ref={ref}\n      className={cx(classes.root, track.pinned ? null : classes.unpinnedTrack)}\n      variant={showTrackOutlines ? 'outlined' : undefined}\n      elevation={showTrackOutlines ? undefined : 0}\n      onClick={event => {\n        if (event.detail === 2 && !track.displays[0].featureIdUnderMouse) {\n          const left = ref.current?.getBoundingClientRect().left || 0\n          model.zoomTo(model.bpPerPx / 2, event.clientX - left, true)\n        }\n      }}\n    >\n      {/* offset 1px since for left track border */}\n      {track.pinned ? <Gridlines model={model} offset={1} /> : null}\n      <TrackLabelContainer track={track} view={model} />\n      <ErrorBoundary FallbackComponent={e => <ErrorMessage error={e.error} />}>\n        <TrackRenderingContainer\n          model={model}\n          track={track}\n          onDragEnter={() => {\n            if (\n              isAlive(display) &&\n              draggingTrackId !== undefined &&\n              draggingTrackId !== display.id\n            ) {\n              model.moveTrack(draggingTrackId, track.id)\n            }\n          }}\n        />\n      </ErrorBoundary>\n      <ResizeHandle\n        onDrag={display.resizeHeight}\n        className={classes.resizeHandle}\n      />\n    </Paper>\n  )\n})\n\nexport default TrackContainer\n","import { stringify } from '@jbrowse/core/util'\nimport { Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  guide: {\n    pointerEvents: 'none',\n    height: '100%',\n    width: 1,\n    position: 'absolute',\n    background: 'red',\n    zIndex: 1001,\n  },\n  tooltipTarget: {\n    position: 'sticky',\n    width: 1,\n  },\n})\n\nconst VerticalGuide = observer(function VerticalGuide({\n  model,\n  coordX,\n}: {\n  model: LGV\n  coordX: number\n}) {\n  const { classes } = useStyles()\n  const { stickyViewHeaders, rubberbandTop } = model\n\n  return (\n    <>\n      <Tooltip\n        open\n        placement=\"top\"\n        title={stringify(model.pxToBp(coordX))}\n        arrow\n      >\n        <div\n          className={classes.tooltipTarget}\n          style={{\n            left: coordX + 6,\n            top: rubberbandTop,\n            position: stickyViewHeaders ? 'sticky' : undefined,\n          }}\n        />\n      </Tooltip>\n      <div className={classes.guide} style={{ left: coordX }} />\n    </>\n  )\n})\n\nexport default VerticalGuide\n","import type React from 'react'\nimport { useEffect, useState } from 'react'\n\nimport { getRelativeX } from './util'\n\nimport type { LinearGenomeViewModel } from '..'\n\ninterface AnchorPosition {\n  offsetX: number\n  clientX: number\n  clientY: number\n}\n\nexport function useRangeSelect(\n  ref: React.RefObject<HTMLDivElement | null>,\n  model: LinearGenomeViewModel,\n  shiftOnly?: boolean,\n) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n\n  // clientX and clientY used for anchorPosition for menu\n  // offsetX used for calculations about width of selection\n  const [anchorPosition, setAnchorPosition] = useState<AnchorPosition>()\n  const [guideX, setGuideX] = useState<number>()\n  const mouseDragging = startX !== undefined && anchorPosition === undefined\n\n  useEffect(() => {\n    function computeOffsets(offsetX: number) {\n      if (startX === undefined) {\n        return\n      }\n      const leftPx = Math.min(startX, offsetX)\n      const rightPx = Math.max(startX, offsetX)\n      return {\n        leftOffset: model.pxToBp(leftPx),\n        rightOffset: model.pxToBp(rightPx),\n      }\n    }\n\n    function globalMouseMove(event: MouseEvent) {\n      if (ref.current && mouseDragging) {\n        const relativeX = getRelativeX(event, ref.current)\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp(event: MouseEvent) {\n      if (startX !== undefined && ref.current) {\n        const { clientX, clientY } = event\n        const offsetX = getRelativeX(event, ref.current)\n        // as stated above, store both clientX/Y and offsetX for different\n        // purposes\n        setAnchorPosition({\n          offsetX,\n          clientX,\n          clientY,\n        })\n        const args = computeOffsets(offsetX)\n        if (args) {\n          model.setOffsets(args.leftOffset, args.rightOffset)\n        }\n        setGuideX(undefined)\n      }\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove)\n      window.addEventListener('mouseup', globalMouseUp)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove)\n        window.removeEventListener('mouseup', globalMouseUp)\n      }\n    }\n    return () => {}\n  }, [startX, mouseDragging, model, ref])\n\n  useEffect(() => {\n    if (\n      !mouseDragging &&\n      currentX !== undefined &&\n      startX !== undefined &&\n      Math.abs(currentX - startX) <= 3\n    ) {\n      handleClose()\n    }\n  }, [mouseDragging, currentX, startX])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    if (shiftOnly && !event.shiftKey) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n    const relativeX = getRelativeX(event, ref.current)\n    setStartX(relativeX)\n    setCurrentX(relativeX)\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    if (shiftOnly) {\n      if (event.shiftKey) {\n        setGuideX(getRelativeX(event, ref.current))\n      } else {\n        setGuideX(undefined)\n      }\n    } else {\n      setGuideX(getRelativeX(event, ref.current))\n    }\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n    model.setOffsets(undefined, undefined)\n  }\n\n  function handleClose() {\n    setAnchorPosition(undefined)\n    setStartX(undefined)\n    setCurrentX(undefined)\n  }\n\n  function handleMenuItemClick(_: unknown, callback: () => void) {\n    callback()\n    handleClose()\n  }\n\n  const open = Boolean(anchorPosition)\n  if (startX === undefined) {\n    return {\n      open,\n      guideX,\n      mouseDown,\n      mouseMove,\n      mouseOut,\n      handleMenuItemClick,\n    }\n  }\n  const right = anchorPosition ? anchorPosition.offsetX : currentX || 0\n  const left = Math.min(right, startX)\n  const width = Math.abs(right - startX)\n  const leftBpOffset = model.pxToBp(left)\n  const rightBpOffset = model.pxToBp(left + width)\n  const numOfBpSelected = Math.ceil(width * model.bpPerPx)\n\n  return {\n    open,\n    rubberbandOn: true,\n    mouseDown,\n    mouseMove,\n    mouseOut,\n    handleClose,\n    handleMenuItemClick,\n    leftBpOffset,\n    rightBpOffset,\n    anchorPosition,\n    numOfBpSelected,\n    width,\n    left,\n  }\n}\n","import { useRef } from 'react'\n\nimport { Menu } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport RubberbandSpan from './RubberbandSpan'\nimport VerticalGuide from './VerticalGuide'\nimport { useRangeSelect } from './useRangeSelect'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  rubberbandControl: {\n    cursor: 'crosshair',\n    width: '100%',\n    minHeight: 8,\n    zIndex: 825,\n  },\n})\n\nconst Rubberband = observer(function ({\n  model,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  ControlComponent?: React.ReactElement\n}) {\n  const ref = useRef<HTMLDivElement>(null)\n  const { classes } = useStyles()\n  const { stickyViewHeaders, rubberbandTop } = model\n\n  const {\n    guideX,\n    rubberbandOn,\n    leftBpOffset,\n    rightBpOffset,\n    numOfBpSelected,\n    width,\n    left,\n    anchorPosition,\n    open,\n    handleMenuItemClick,\n    handleClose,\n    mouseMove,\n    mouseDown,\n    mouseOut,\n  } = useRangeSelect(ref, model)\n\n  return (\n    <>\n      {guideX !== undefined ? (\n        <VerticalGuide model={model} coordX={guideX} />\n      ) : rubberbandOn ? (\n        <RubberbandSpan\n          leftBpOffset={leftBpOffset}\n          rightBpOffset={rightBpOffset}\n          numOfBpSelected={numOfBpSelected}\n          width={width}\n          left={left}\n          top={rubberbandTop}\n          sticky={stickyViewHeaders}\n        />\n      ) : null}\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={model.rubberBandMenuItems()}\n        />\n      ) : null}\n      <div\n        data-testid=\"rubberband_controls\"\n        className={classes.rubberbandControl}\n        style={{\n          top: rubberbandTop,\n          position: stickyViewHeaders ? 'sticky' : undefined,\n        }}\n        ref={ref}\n        onMouseDown={mouseDown}\n        onMouseMove={mouseMove}\n        onMouseOut={mouseOut}\n      >\n        {ControlComponent}\n      </div>\n    </>\n  )\n})\n\nexport default Rubberband\n","import { getTickDisplayStr } from '@jbrowse/core/util'\nimport { Typography } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nimport { ContentBlock as ContentBlockComponent } from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\n\nimport type { ContentBlock } from '@jbrowse/core/util/blockTypes'\n\nconst useStyles = makeStyles()(theme => ({\n  majorTickLabel: {\n    fontSize: 11,\n    zIndex: 1,\n    background: theme.palette.background.paper,\n    lineHeight: 'normal',\n    pointerEvents: 'none',\n  },\n  tick: {\n    position: 'absolute',\n    width: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n}))\n\nconst ScalebarCoordinateTicks = function ({\n  block,\n  bpPerPx,\n}: {\n  block: ContentBlock\n  bpPerPx: number\n}) {\n  const { classes } = useStyles()\n  const { reversed, start, end } = block\n  const ticks = makeTicks(start, end, bpPerPx, true, false)\n\n  return (\n    <ContentBlockComponent block={block}>\n      {ticks.map(({ type, base }) => {\n        if (type === 'major') {\n          const x = (reversed ? end - base : base - start) / bpPerPx\n          const baseNumber = base + 1\n          return (\n            <div key={base} className={classes.tick} style={{ left: x }}>\n              {baseNumber ? (\n                <Typography className={classes.majorTickLabel}>\n                  {getTickDisplayStr(baseNumber, bpPerPx)}\n                </Typography>\n              ) : null}\n            </div>\n          )\n        }\n        return null\n      })}\n    </ContentBlockComponent>\n  )\n}\n\nexport default ScalebarCoordinateTicks\n","import { observer } from 'mobx-react'\n\nimport ScalebarCoordinateTicks from './ScalebarCoordinateTicks'\nimport {\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst ScalebarCoordinateLabels = observer(function ({ model }: { model: LGV }) {\n  const { staticBlocks, bpPerPx } = model\n  return (\n    <>\n      {staticBlocks.map((b, idx) => {\n        const { key, widthPx } = b\n        const k = `${key}-${idx}`\n        if (b.type === 'ContentBlock') {\n          return <ScalebarCoordinateTicks key={k} block={b} bpPerPx={bpPerPx} />\n        } else if (b.type === 'ElidedBlock') {\n          return <ElidedBlockComponent key={k} width={widthPx} />\n        } else if (b.type === 'InterRegionPaddingBlock') {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={k}\n              width={widthPx}\n              style={{ background: 'none' }}\n              boundary={b.variant === 'boundary'}\n            />\n          )\n        } else {\n          return null\n        }\n      })}\n    </>\n  )\n})\n\nexport default ScalebarCoordinateLabels\n","import { Typography } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  refLabel: {\n    fontSize: 11,\n    position: 'absolute',\n    left: 2,\n    top: -1,\n    fontWeight: 'bold',\n    lineHeight: 'normal',\n    zIndex: 1,\n    background: theme.palette.background.paper,\n  },\n  b0: {\n    left: 0,\n    zIndex: 100,\n  },\n}))\n\nconst ScalebarRefNameLabels = observer(function ({ model }: { model: LGV }) {\n  const { classes, cx } = useStyles()\n  const { staticBlocks, offsetPx, scaleBarDisplayPrefix } = model\n\n  // find the block that needs pinning to the left side for context\n  let lastLeftBlock = 0\n\n  // eslint-disable-next-line unicorn/no-array-for-each\n  staticBlocks.forEach((block, i) => {\n    if (block.offsetPx - offsetPx < 0) {\n      lastLeftBlock = i\n    }\n  })\n  const val = scaleBarDisplayPrefix()\n  const b0 = staticBlocks.blocks[0]\n  return (\n    <>\n      {b0?.type !== 'ContentBlock' && val ? (\n        <Typography className={cx(classes.b0, classes.refLabel)}>\n          {val}\n        </Typography>\n      ) : null}\n      {staticBlocks.map((block, index) => {\n        const {\n          offsetPx: blockOffsetPx,\n          isLeftEndOfDisplayedRegion,\n          key,\n          type,\n          refName,\n        } = block\n        const last = index === lastLeftBlock\n        return type === 'ContentBlock' &&\n          (isLeftEndOfDisplayedRegion || last) ? (\n          <Typography\n            key={`refLabel-${key}-${index}`}\n            style={{\n              left: last\n                ? Math.max(0, -offsetPx)\n                : blockOffsetPx - offsetPx - 1,\n              paddingLeft: last ? 0 : 1,\n            }}\n            className={classes.refLabel}\n            data-testid={`refLabel-${refName}`}\n          >\n            {last && val ? `${val}:` : ''}\n            {refName}\n          </Typography>\n        ) : null\n      })}\n    </>\n  )\n})\n\nexport default ScalebarRefNameLabels\n","import type React from 'react'\nimport { forwardRef } from 'react'\n\nimport { Paper } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport Gridlines from './Gridlines'\nimport ScalebarCoordinateLabels from './ScalebarCoordinateLabels'\nimport ScalebarRefNameLabels from './ScalebarRefNameLabels'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  container: {\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  zoomContainer: {\n    position: 'relative',\n  },\n  scalebar: {\n    position: 'absolute',\n    display: 'flex',\n    pointerEvents: 'none',\n  },\n})\n\ninterface ScalebarProps {\n  model: LGV\n  style?: React.CSSProperties\n  className?: string\n}\n\nconst Scalebar = observer(\n  forwardRef<HTMLDivElement, ScalebarProps>(function Scalebar2(\n    { model, style, className, ...other },\n    ref,\n  ) {\n    const { classes, cx } = useStyles()\n    const { staticBlocks, offsetPx, scaleFactor } = model\n    const offsetLeft = staticBlocks.offsetPx - offsetPx\n    return (\n      <Paper\n        data-resizer=\"true\" // used to avoid click-and-drag scrolls on trackscontainer\n        className={cx(classes.container, className)}\n        variant=\"outlined\"\n        ref={ref}\n        style={style}\n        {...other}\n      >\n        {/* offset 1px since for left track border */}\n        <Gridlines model={model} offset={1} />\n        <div\n          className={classes.zoomContainer}\n          style={{\n            transform: scaleFactor !== 1 ? `scaleX(${scaleFactor})` : undefined,\n          }}\n        >\n          <div\n            className={classes.scalebar}\n            style={{\n              left: offsetLeft - 1,\n              width: staticBlocks.totalWidthPx,\n              ...style,\n            }}\n          >\n            <ScalebarCoordinateLabels model={model} />\n          </div>\n        </div>\n        <ScalebarRefNameLabels model={model} />\n      </Paper>\n    )\n  }),\n)\n\nexport default Scalebar\n","import { Suspense, lazy, useRef } from 'react'\n\nimport { Menu } from '@jbrowse/core/ui'\nimport { getEnv } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport Gridlines from './Gridlines'\nimport Rubberband from './Rubberband'\nimport Scalebar from './Scalebar'\nimport VerticalGuide from './VerticalGuide'\nimport { SCALE_BAR_HEIGHT } from '../consts'\nimport { useRangeSelect } from './useRangeSelect'\nimport { useSideScroll } from './useSideScroll'\nimport { useWheelScroll } from './useWheelScroll'\n\nimport type { LinearGenomeViewModel } from '..'\n\nconst CenterLine = lazy(() => import('./CenterLine'))\nconst Highlight = lazy(() => import('./Highlight'))\nconst RubberbandSpan = lazy(() => import('./RubberbandSpan'))\n\nconst useStyles = makeStyles()({\n  tracksContainer: {\n    position: 'relative',\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TracksContainer = observer(function TracksContainer({\n  children,\n  model,\n}: {\n  children: React.ReactNode\n  model: LGV\n}) {\n  const { classes } = useStyles()\n  const { pluginManager } = getEnv(model)\n  const { mouseDown: mouseDown1, mouseUp } = useSideScroll(model)\n  const { stickyViewHeaders, rubberbandTop, showGridlines, showCenterLine } =\n    model\n  const ref = useRef<HTMLDivElement>(null)\n  const {\n    guideX,\n    rubberbandOn,\n    leftBpOffset,\n    rightBpOffset,\n    numOfBpSelected,\n    width,\n    left,\n    anchorPosition,\n    open,\n    handleMenuItemClick,\n    handleClose,\n    mouseMove,\n    mouseDown: mouseDown2,\n  } = useRangeSelect(ref, model, true)\n  useWheelScroll(ref, model)\n\n  const additional = pluginManager.evaluateExtensionPoint(\n    'LinearGenomeView-TracksContainerComponent',\n    undefined,\n    { model },\n  ) as React.ReactNode\n\n  return (\n    <div\n      ref={ref}\n      data-testid=\"tracksContainer\"\n      className={classes.tracksContainer}\n      onMouseDown={event => {\n        mouseDown1(event)\n        mouseDown2(event)\n      }}\n      onMouseMove={mouseMove}\n      onMouseUp={mouseUp}\n    >\n      {showGridlines ? <Gridlines model={model} /> : null}\n      <Suspense fallback={null}>\n        {showCenterLine ? <CenterLine model={model} /> : null}\n      </Suspense>\n      {guideX !== undefined ? (\n        <VerticalGuide model={model} coordX={guideX} />\n      ) : rubberbandOn ? (\n        <Suspense fallback={null}>\n          <RubberbandSpan\n            leftBpOffset={leftBpOffset}\n            rightBpOffset={rightBpOffset}\n            numOfBpSelected={numOfBpSelected}\n            width={width}\n            left={left}\n            top={rubberbandTop}\n            sticky={stickyViewHeaders}\n          />\n        </Suspense>\n      ) : null}\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={model.rubberBandMenuItems()}\n        />\n      ) : null}\n\n      <Rubberband\n        model={model}\n        ControlComponent={\n          <Scalebar\n            model={model}\n            style={{\n              height: SCALE_BAR_HEIGHT,\n              boxSizing: 'border-box',\n            }}\n          />\n        }\n      />\n      <HighlightGroup model={model} />\n      {additional}\n      {children}\n    </div>\n  )\n})\n\nconst HighlightGroup = observer(function HighlightGroup({\n  model,\n}: {\n  model: LGV\n}) {\n  return model.highlight.length ? (\n    <Suspense fallback={null}>\n      {model.highlight.map((highlight, idx) => (\n        <Highlight\n          key={`${JSON.stringify(highlight)}-${idx}`}\n          model={model}\n          highlight={highlight}\n        />\n      ))}\n    </Suspense>\n  ) : null\n})\n\nexport default TracksContainer\n","import type React from 'react'\nimport { useEffect, useRef, useState } from 'react'\n\nimport type { LinearGenomeViewModel } from '..'\n\nexport function useSideScroll(model: LinearGenomeViewModel) {\n  const [mouseDragging, setMouseDragging] = useState(false)\n  // refs are to store these variables to avoid repeated rerenders associated\n  // with useState/setState\n  const scheduled = useRef(false)\n\n  const prevX = useRef<number>(0)\n\n  useEffect(() => {\n    let cleanup = () => {}\n\n    function globalMouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const currX = event.clientX\n      const distance = currX - prevX.current\n      if (distance) {\n        // use rAF to make it so multiple event handlers aren't fired per-frame\n        // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n        if (!scheduled.current) {\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(-distance)\n            scheduled.current = false\n            prevX.current = event.clientX\n          })\n        }\n      }\n    }\n\n    function globalMouseUp() {\n      prevX.current = 0\n      if (mouseDragging) {\n        setMouseDragging(false)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      cleanup = () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n      }\n    }\n    return cleanup\n  }, [model, mouseDragging])\n\n  function mouseDown(event: React.MouseEvent) {\n    if (event.shiftKey) {\n      return\n    }\n    // check if clicking a draggable element or a resize handle\n    const target = event.target as HTMLElement\n    if (target.draggable || target.dataset.resizer) {\n      return\n    }\n\n    // otherwise do click and drag scroll\n    if (event.button === 0) {\n      prevX.current = event.clientX\n      setMouseDragging(true)\n    }\n  }\n\n  // this local mouseup is used in addition to the global because sometimes\n  // the global add/remove are not called in time, resulting in issue #533\n  function mouseUp(event: React.MouseEvent) {\n    event.preventDefault()\n    setMouseDragging(false)\n  }\n  return { mouseDown, mouseUp }\n}\n","import type React from 'react'\nimport { useEffect, useRef } from 'react'\n\nimport { sum } from '@jbrowse/core/util'\n\ntype Timer = ReturnType<typeof setTimeout>\n\nexport function useWheelScroll(\n  ref: React.RefObject<HTMLDivElement | null>,\n  model: {\n    bpPerPx: number\n    zoomTo: (arg: number, arg2?: number) => void\n    setScaleFactor: (arg: number) => void\n    horizontalScroll: (arg: number) => void\n  },\n) {\n  const delta = useRef(0)\n  const timeout = useRef<Timer>(null)\n  const scheduled = useRef(false)\n\n  useEffect(() => {\n    let samples = [] as number[]\n    const curr = ref.current\n\n    // if ctrl is held down, zoom in with y-scroll, else scroll horizontally\n    // with x-scroll\n    function onWheel(event: WheelEvent) {\n      if (event.ctrlKey) {\n        event.preventDefault()\n        // there is no way to truly detect this, but it attempts to dynamically\n        // toggle between normalization scheme depending on strength of deltaY,\n        // particular due to the fact that this code path is triggered for both\n        // normal ctrl+wheel scroll and pinch to zoom. for these two cases\n        // - true wheel scroll has larger deltaY\n        // - pinch-to-zoom has much smaller deltaY\n        // though there is variation depending on platform\n        samples.push(event.deltaY)\n        const averageDeltaY = Math.abs(sum(samples)) / samples.length\n        const normalizer =\n          averageDeltaY < 6\n            ? 25\n            : averageDeltaY > 30\n              ? averageDeltaY > 150\n                ? 500\n                : 150\n              : 75\n        delta.current += event.deltaY / normalizer\n        model.setScaleFactor(\n          delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n        )\n        if (timeout.current) {\n          clearTimeout(timeout.current)\n        }\n        timeout.current = setTimeout(() => {\n          model.setScaleFactor(1)\n          model.zoomTo(\n            delta.current > 0\n              ? model.bpPerPx * (1 + delta.current)\n              : model.bpPerPx / (1 - delta.current),\n            event.clientX - (curr?.getBoundingClientRect().left || 0),\n          )\n          delta.current = 0\n          samples = []\n        }, 300)\n      } else {\n        // this is needed to stop the event from triggering \"back button\n        // action\" on MacOSX etc.  but is a heuristic to avoid preventing the\n        // inner-track scroll behavior\n        if (Math.abs(event.deltaX) > Math.abs(2 * event.deltaY)) {\n          event.preventDefault()\n        }\n        delta.current += event.deltaX\n        if (!scheduled.current) {\n          // use rAF to make it so multiple event handlers aren't fired per-frame\n          // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(delta.current)\n            delta.current = 0\n            scheduled.current = false\n          })\n        }\n      }\n    }\n    if (curr) {\n      curr.addEventListener('wheel', onWheel)\n      return () => {\n        curr.removeEventListener('wheel', onWheel)\n      }\n    }\n    return () => {}\n  }, [model, ref])\n}\n","import { Suspense, lazy, useEffect, useRef } from 'react'\n\nimport { VIEW_HEADER_HEIGHT } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\nimport Paper from '@mui/material/Paper'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport TrackContainer from './TrackContainer'\nimport TracksContainer from './TracksContainer'\n\nimport type { LinearGenomeViewModel } from '..'\n\n// lazies\nconst NoTracksActiveButton = lazy(() => import('./NoTracksActiveButton'))\n\nconst useStyles = makeStyles()(theme => ({\n  header: {\n    background: theme.palette.background.paper,\n    top: VIEW_HEADER_HEIGHT,\n    zIndex: 850,\n  },\n  pinnedTracks: {\n    position: 'sticky',\n    zIndex: 3,\n  },\n  rel: {\n    position: 'relative',\n  },\n}))\n\nconst LinearGenomeViewContainer = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const {\n    pinnedTracks,\n    stickyViewHeaders,\n    pinnedTracksTop,\n    tracks,\n    unpinnedTracks,\n  } = model\n  const { classes } = useStyles()\n  const session = getSession(model)\n  const ref = useRef<HTMLDivElement>(null)\n  const MiniControlsComponent = model.MiniControlsComponent()\n  const HeaderComponent = model.HeaderComponent()\n  useEffect(() => {\n    // sets the focused view id based on a click within the LGV;\n    // necessary for subviews to be focused properly\n    function handleSelectView(e: Event) {\n      if (e.target instanceof Element && ref.current?.contains(e.target)) {\n        session.setFocusedViewId?.(model.id)\n      }\n    }\n\n    document.addEventListener('mousedown', handleSelectView)\n    document.addEventListener('keydown', handleSelectView)\n    return () => {\n      document.removeEventListener('mousedown', handleSelectView)\n      document.removeEventListener('keydown', handleSelectView)\n    }\n  }, [session, model])\n\n  return (\n    <div\n      className={classes.rel}\n      ref={ref}\n      onMouseLeave={() => {\n        session.setHovered(undefined)\n      }}\n      onMouseMove={event => {\n        const c = ref.current\n        if (!c) {\n          return\n        }\n        const { tracks } = model\n        const leftPx = event.clientX - c.getBoundingClientRect().left\n        const hoverPosition = model.pxToBp(leftPx)\n        const hoverFeature = tracks.find(t => t.displays[0].featureUnderMouse)\n        session.setHovered({ hoverPosition, hoverFeature })\n      }}\n    >\n      <div\n        className={classes.header}\n        style={{ position: stickyViewHeaders ? 'sticky' : undefined }}\n      >\n        <HeaderComponent model={model} />\n        <MiniControlsComponent model={model} />\n      </div>\n      <TracksContainer model={model}>\n        {!tracks.length ? (\n          <Suspense fallback={null}>\n            <NoTracksActiveButton model={model} />\n          </Suspense>\n        ) : (\n          <>\n            {pinnedTracks.length ? (\n              <Paper\n                elevation={6}\n                className={classes.pinnedTracks}\n                style={{ top: pinnedTracksTop }}\n              >\n                {pinnedTracks.map(track => (\n                  <TrackContainer key={track.id} model={model} track={track} />\n                ))}\n              </Paper>\n            ) : null}\n            {unpinnedTracks.map(track => (\n              <TrackContainer key={track.id} model={model} track={track} />\n            ))}\n          </>\n        )}\n      </TracksContainer>\n    </div>\n  )\n})\n\nexport default LinearGenomeViewContainer\n","import { lazy } from 'react'\n\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nimport LinearGenomeViewContainer from './LinearGenomeViewContainer'\n\nimport type { LinearGenomeViewModel } from '..'\n\n// lazies\nconst ImportForm = lazy(() => import('./ImportForm'))\n\nconst LinearGenomeView = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { error, initialized, hasDisplayedRegions } = model\n\n  if (!initialized && !error) {\n    return <LoadingEllipses variant=\"h6\" />\n  } else if (!hasDisplayedRegions || error) {\n    return <ImportForm model={model} />\n  } else {\n    return <LinearGenomeViewContainer model={model} />\n  }\n})\n\nexport default LinearGenomeView\n","import { Observable } from 'rxjs'\n\nimport { checkStopToken } from './stopToken'\n\nimport type { Observer } from 'rxjs'\n\n/**\n * Wrapper for rxjs Observable.create with improved error handling and\n * aborting support\n * @param func - observer function, could be async\n * TODO:ABORTING?\n */\nexport function ObservableCreate<T>(\n  func: (arg: Observer<T>) => void | Promise<void>,\n  stopToken?: string,\n): Observable<T> {\n  checkStopToken(stopToken)\n  return new Observable((observer: Observer<T>) => {\n    try {\n      const ret = func(observer)\n      if (ret?.catch) {\n        ret.catch((error: unknown) => {\n          observer.error(error)\n        })\n      }\n    } catch (error) {\n      observer.error(error)\n    }\n  })\n}\n","import type { ComponentType, LazyExoticComponent } from 'react'\nimport type React from 'react'\n\nimport PluggableElementBase from './PluggableElementBase'\n\nimport type { AnyConfigurationSchemaType } from '../configuration'\nimport type { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\n\ntype WidgetComponentType = LazyExoticComponent<React.FC<any>> | React.FC<any>\n\ntype HeadingComponentType = ComponentType<{ model: IAnyStateTreeNode }>\n\nexport default class WidgetType extends PluggableElementBase {\n  heading?: string\n\n  configSchema: AnyConfigurationSchemaType\n\n  HeadingComponent?: HeadingComponentType\n\n  ReactComponent: WidgetComponentType\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    heading?: string\n    HeadingComponent?: HeadingComponentType\n    configSchema: AnyConfigurationSchemaType\n    stateModel: IAnyModelType\n    ReactComponent: WidgetComponentType\n  }) {\n    super(stuff)\n    this.heading = stuff.heading\n    this.HeadingComponent = stuff.HeadingComponent\n    this.configSchema = stuff.configSchema\n    this.stateModel = stuff.stateModel\n    this.ReactComponent = stuff.ReactComponent\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nconst configSchema = ConfigurationSchema('HierarchicalTrackSelectorWidget', {})\nexport default configSchema\n","export function findNonSparseKeys(\n  keys: readonly string[],\n  rows: Record<string, unknown>[],\n  cb: (row: Record<string, unknown>, f: string) => unknown,\n) {\n  return keys.filter(f => rows.map(r => cb(r, f)).filter(f => !!f).length > 5)\n}\n\nexport function getRootKeys(obj: Record<string, unknown>) {\n  return Object.entries(obj)\n    .map(([key, val]) => (typeof val === 'string' ? key : ''))\n    .filter(f => !!f)\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport function hasAnyOverlap<T>(a1: T[] = [], a2: T[] = []) {\n  // shortcut case is that arrays are single entries, and are equal\n  // long case is that we use a set\n  if (a1[0] === a2[0]) {\n    return true\n  } else {\n    const s1 = new Set(a1)\n    return a2.some(a => s1.has(a))\n  }\n}\n\nexport function hasAllOverlap<T>(a1: T[] = [], a2: T[] = []) {\n  const s1 = new Set(a1)\n  return a2.every(a => s1.has(a))\n}\n\nexport function matches(\n  query: string,\n  conf: AnyConfigurationModel,\n  session: AbstractSessionModel,\n) {\n  const categories = (readConfObject(conf, 'category') || []) as string[]\n  const queryLower = query.toLowerCase()\n  return (\n    getTrackName(conf, session).toLowerCase().includes(queryLower) ||\n    !!categories.filter(c => c.toLowerCase().includes(queryLower)).length\n  )\n}\n\ninterface Node {\n  children: Node[]\n  id: string\n}\n\nexport function findSubCategories(obj: Node[], paths: string[], depth = 0) {\n  let hasSubs = false\n  for (const elt of obj) {\n    if (elt.children.length) {\n      const hasSubCategories = findSubCategories(elt.children, paths, depth + 1)\n      // avoid pushing the root \"Tracks\" node by checking depth>0\n      if (hasSubCategories && depth > 0) {\n        paths.push(elt.id)\n      }\n    } else {\n      hasSubs = true\n    }\n  }\n  return hasSubs\n}\n\nexport function findTopLevelCategories(obj: Node[], paths: string[]) {\n  for (const elt of obj) {\n    if (elt.children.length) {\n      paths.push(elt.id)\n    }\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  getSession,\n  localStorageGetBoolean,\n  localStorageGetNumber,\n} from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { autorun, observable } from 'mobx'\nimport { addDisposer, getParent, types } from 'mobx-state-tree'\n\nimport { getRowStr } from './components/faceted/util'\nimport { findNonSparseKeys, getRootKeys } from './facetedUtil'\nimport { matches } from './util'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Instance } from 'mobx-state-tree'\n\nconst nonMetadataKeys = ['category', 'adapter', 'description'] as const\n\n/**\n * #stateModel FacetedModel\n */\nexport function facetedStateTreeF() {\n  return types\n    .model('FacetedModel', {\n      /**\n       * #property\n       */\n      filterText: types.optional(types.string, ''),\n      /**\n       * #property\n       */\n      showSparse: types.optional(types.boolean, () =>\n        localStorageGetBoolean('facet-showSparse', false),\n      ),\n      /**\n       * #property\n       */\n      showFilters: types.optional(types.boolean, () =>\n        localStorageGetBoolean('facet-showFilters', true),\n      ),\n\n      /**\n       * #property\n       */\n      showOptions: types.optional(types.boolean, () =>\n        localStorageGetBoolean('facet-showTableOptions', false),\n      ),\n\n      /**\n       * #property\n       */\n      panelWidth: types.optional(types.number, () =>\n        localStorageGetNumber('facet-panelWidth', 400),\n      ),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      visible: {} as Record<string, boolean>,\n      /**\n       * #volatile\n       */\n      useShoppingCart: false,\n      /**\n       * #volatile\n       */\n      filters: observable.map<string, string[]>(),\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFilter(key: string, value: string[]) {\n        self.filters.set(key, value)\n      },\n      /**\n       * #action\n       */\n      setPanelWidth(width: number) {\n        self.panelWidth = width\n        return self.panelWidth\n      },\n      /**\n       * #action\n       */\n      setUseShoppingCart(f: boolean) {\n        self.useShoppingCart = f\n      },\n      /**\n       * #action\n       */\n      setFilterText(str: string) {\n        self.filterText = str\n      },\n      /**\n       * #action\n       */\n      setShowSparse(f: boolean) {\n        self.showSparse = f\n      },\n      /**\n       * #action\n       */\n      setShowOptions(f: boolean) {\n        self.showOptions = f\n      },\n      /**\n       * #action\n       */\n      setShowFilters(f: boolean) {\n        self.showFilters = f\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get allTrackConfigurations() {\n        return getParent<{ allTrackConfigurations: AnyConfigurationModel[] }>(\n          self,\n        ).allTrackConfigurations\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rows() {\n        const session = getSession(self)\n        const { allTrackConfigurations, filterText } = self\n        return allTrackConfigurations\n          .filter(conf => matches(filterText, conf, session))\n          .map(\n            track =>\n              ({\n                id: track.trackId as string,\n                conf: track,\n                name: getTrackName(track, session),\n                category: readConfObject(track, 'category')?.join(\n                  ', ',\n                ) as string,\n                adapter: readConfObject(track, 'adapter')?.type as string,\n                description: readConfObject(track, 'description') as string,\n                metadata: readConfObject(track, 'metadata') as Record<\n                  string,\n                  unknown\n                >,\n              }) as const,\n          )\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get filteredNonMetadataKeys() {\n        return self.showSparse\n          ? nonMetadataKeys\n          : findNonSparseKeys(nonMetadataKeys, self.rows, (r, f) => r[f])\n      },\n      /**\n       * #getter\n       */\n      get metadataKeys() {\n        return [...new Set(self.rows.flatMap(row => getRootKeys(row.metadata)))]\n      },\n      /**\n       * #getter\n       */\n      get filteredMetadataKeys() {\n        return self.showSparse\n          ? this.metadataKeys\n          : findNonSparseKeys(\n              this.metadataKeys,\n              self.rows,\n              // @ts-expect-error\n              (r, f) => r.metadata[f],\n            )\n      },\n      /**\n       * #getter\n       */\n      get fields() {\n        return [\n          'name',\n          ...this.filteredNonMetadataKeys,\n          ...this.filteredMetadataKeys.map(m => `metadata.${m}`),\n        ]\n      },\n      /**\n       * #getter\n       */\n      get filteredRows() {\n        const arrFilters = [...self.filters.entries()]\n          .filter(f => f[1].length > 0)\n          .map(([key, val]) => [key, new Set(val)] as const)\n        return self.rows.filter(row =>\n          arrFilters.every(([key, val]) => val.has(getRowStr(key, row))),\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setVisible(args: Record<string, boolean>) {\n        self.visible = args\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            this.setVisible(Object.fromEntries(self.fields.map(c => [c, true])))\n          }),\n        )\n      },\n    }))\n}\nexport type FacetedStateModel = ReturnType<typeof facetedStateTreeF>\nexport type FacetedModel = Instance<FacetedStateModel>\nexport type FacetedRow = FacetedModel['filteredRows'][0]\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getEnv, getSession, notEmpty } from '@jbrowse/core/util'\n\nimport { hasAllOverlap, hasAnyOverlap } from './util'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\nexport function filterTracks(\n  tracks: AnyConfigurationModel[],\n  self: {\n    view?: {\n      type: string\n      trackSelectorAnyOverlap?: boolean\n    }\n    assemblyNames: string[]\n  },\n) {\n  const { assemblyManager } = getSession(self)\n  const { pluginManager } = getEnv(self)\n  const { view } = self\n\n  if (!view) {\n    return []\n  }\n  const trackListAssemblies = self.assemblyNames\n    .map(a => assemblyManager.get(a))\n    .filter(notEmpty)\n  return tracks\n    .filter(c => {\n      const trackAssemblyNames = readConfObject(c, 'assemblyNames') as\n        | string[]\n        | undefined\n      const trackAssemblies = trackAssemblyNames\n        ?.map(name => assemblyManager.get(name))\n        .filter(notEmpty)\n      return view.trackSelectorAnyOverlap\n        ? hasAnyOverlap(trackAssemblies, trackListAssemblies)\n        : hasAllOverlap(trackAssemblies, trackListAssemblies)\n    })\n    .filter(c => {\n      const { displayTypes } = pluginManager.getViewType(view.type)!\n      const compatDisplays = displayTypes.map(d => d.name)\n      const trackDisplays = c.displays.map((d: { type: string }) => d.type)\n      return hasAnyOverlap(compatDisplays, trackDisplays)\n    })\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\n\nimport { matches } from './util'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { MenuItem } from '@jbrowse/core/ui'\n\nfunction sortConfs(\n  confs: AnyConfigurationModel[],\n  sortNames: boolean,\n  sortCategories: boolean,\n) {\n  // uses readConfObject instead of getTrackName so that the undefined\n  // reference sequence track is sorted to the top\n  const ret = confs.map(c => [\n    c,\n    readConfObject(c, 'name'),\n    readConfObject(c, 'category')?.[0] || '',\n    readConfObject(c, 'category')?.[1] || '',\n    readConfObject(c, 'category')?.[2] || '',\n  ])\n  if (sortNames) {\n    ret.sort((a, b) => a[1].localeCompare(b[1]))\n  }\n  if (sortCategories) {\n    // sort up to three sub-category levels, harder to code it to go deeper\n    // than this and likely rarely used\n    ret.sort((a, b) => {\n      if (a[2] !== b[2]) {\n        return a[2].localeCompare(b[2])\n      } else if (a[3] !== b[3]) {\n        return a[3].localeCompare(b[3])\n      } else if (a[4] !== b[4]) {\n        return a[4].localeCompare(b[4])\n      }\n      return 0\n    })\n  }\n  return ret.map(a => a[0])\n}\n\nexport interface TreeTrackNode {\n  name: string\n  id: string\n  trackId: string\n  conf: AnyConfigurationModel\n  checked: boolean\n  children: TreeNode[] // empty\n  type: 'track'\n}\n\nexport interface TreeCategoryNode {\n  name: string\n  id: string\n  isOpenByDefault: boolean\n  children: TreeNode[]\n  type: 'category'\n}\n\nexport type TreeNode = TreeTrackNode | TreeCategoryNode\n\nexport function generateHierarchy({\n  model,\n  trackConfs,\n  extra,\n  noCategories,\n  menuItems,\n}: {\n  model: {\n    filterText: string\n    activeSortTrackNames: boolean\n    activeSortCategories: boolean\n    collapsed: Map<string | number, boolean>\n    view?: {\n      tracks: { configuration: AnyConfigurationModel }[]\n    }\n  }\n  noCategories?: boolean\n  menuItems?: MenuItem[]\n  trackConfs: AnyConfigurationModel[]\n  extra?: string\n}): TreeNode[] {\n  const hierarchy = { children: [] as TreeNode[] } as TreeNode\n  const {\n    collapsed,\n    filterText,\n    activeSortTrackNames,\n    activeSortCategories,\n    view,\n  } = model\n  if (!view) {\n    return []\n  }\n  const session = getSession(model)\n  const viewTracks = view.tracks\n  const confs = trackConfs.filter(conf => matches(filterText, conf, session))\n\n  // uses getConf\n  for (const conf of sortConfs(\n    confs,\n    activeSortTrackNames,\n    activeSortCategories,\n  )) {\n    // copy the categories since this array can be mutated downstream\n    const categories = [...(readConfObject(conf, 'category') || [])]\n\n    // hack where if trackId ends with sessionTrack, then push it to a\n    // category that starts with a space to force sort to the top\n    if (conf.trackId.endsWith('sessionTrack')) {\n      categories.unshift(' Session tracks')\n    }\n\n    let currLevel = hierarchy\n\n    if (!noCategories) {\n      // find existing category to put track into or create it\n      for (let i = 0; i < categories.length; i++) {\n        const category = categories[i]\n        const ret = currLevel.children.find(c => c.name === category)\n        const id = [extra, categories.slice(0, i + 1).join(',')]\n          .filter(f => !!f)\n          .join('-')\n        if (!ret) {\n          const n = {\n            children: [],\n            name: category,\n            id,\n            isOpenByDefault: !collapsed.get(id),\n            menuItems,\n            type: 'category' as const,\n          }\n          currLevel.children.push(n)\n          currLevel = n\n        } else {\n          currLevel = ret\n        }\n      }\n    }\n\n    // uses splice to try to put all leaf nodes above \"category nodes\" if you\n    // change the splice to a simple push and open\n    // test_data/test_order/config.json you will see the weirdness\n    const r = currLevel.children.findIndex(elt => elt.children.length)\n    const idx = r === -1 ? currLevel.children.length : r\n    currLevel.children.splice(idx, 0, {\n      id: [extra, conf.trackId].filter(f => !!f).join(','),\n      trackId: conf.trackId,\n      name: getTrackName(conf, session),\n      conf,\n      checked: viewTracks.some(f => f.configuration === conf),\n      children: [],\n      type: 'track' as const,\n    })\n  }\n\n  return hierarchy.children\n}\n","import { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport {\n  dedupe,\n  getSession,\n  localStorageGetItem,\n  localStorageSetItem,\n  notEmpty,\n} from '@jbrowse/core/util'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { autorun, observable } from 'mobx'\nimport { addDisposer, types } from 'mobx-state-tree'\n\nimport { facetedStateTreeF } from './facetedModel'\nimport { filterTracks } from './filterTracks'\nimport { generateHierarchy } from './generateHierarchy'\nimport { findSubCategories, findTopLevelCategories } from './util'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { GridRowId } from '@mui/x-data-grid'\nimport type { Instance } from 'mobx-state-tree'\n\ntype MaybeAnyConfigurationModel = AnyConfigurationModel | undefined\n\ntype MaybeBoolean = boolean | undefined\n\ntype MaybeCollapsedKeys = [string, boolean][] | undefined\n\n// for settings that are config dependent\nfunction keyConfigPostFix() {\n  return typeof window !== 'undefined'\n    ? [\n        window.location.pathname,\n        new URLSearchParams(window.location.search).get('config'),\n      ]\n        .filter(f => !!f)\n        .join('-')\n    : 'empty'\n}\n\nfunction recentlyUsedK(assemblyNames: string[]) {\n  return ['recentlyUsedTracks', keyConfigPostFix(), assemblyNames.join(',')]\n    .filter(f => !!f)\n    .join('-')\n}\n\n// this has a extra } at the end because that's how it was initially\n// released\nfunction favoritesK() {\n  return `favoriteTracks-${keyConfigPostFix()}}`\n}\n\nfunction collapsedK(assemblyNames: string[], viewType: string) {\n  return [\n    'collapsedCategories',\n    keyConfigPostFix(),\n    assemblyNames.join(','),\n    viewType,\n  ].join('-')\n}\n\nfunction sortTrackNamesK() {\n  return 'sortTrackNames'\n}\n\nfunction sortCategoriesK() {\n  return 'sortCategories'\n}\n\nfunction localStorageGetJSON<T>(key: string, defaultValue: T) {\n  const val = localStorageGetItem(key)\n  return val !== undefined && val !== null && val\n    ? (JSON.parse(val) as T)\n    : defaultValue\n}\n\nfunction localStorageSetJSON(key: string, val: unknown) {\n  if (val !== undefined && val !== null) {\n    localStorageSetItem(key, JSON.stringify(val))\n  }\n}\n\nconst MAX_RECENTLY_USED = 10\n\n/**\n * #stateModel HierarchicalTrackSelectorWidget\n */\nexport default function stateTreeFactory(pluginManager: PluginManager) {\n  return types\n    .model('HierarchicalTrackSelectorWidget', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('HierarchicalTrackSelectorWidget'),\n\n      /**\n       * #property\n       */\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      /**\n       * #property\n       */\n      faceted: types.optional(facetedStateTreeF(), {}),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      favorites: localStorageGetJSON<string[]>(favoritesK(), []),\n      /**\n       * #volatile\n       */\n      recentlyUsed: [] as GridRowId[],\n      /**\n       * #volatile\n       */\n      selection: [] as AnyConfigurationModel[],\n      /**\n       * #volatile\n       */\n      sortTrackNames: localStorageGetJSON<MaybeBoolean>(\n        sortTrackNamesK(),\n        undefined,\n      ),\n      /**\n       * #volatile\n       */\n      sortCategories: localStorageGetJSON<MaybeBoolean>(\n        sortCategoriesK(),\n        undefined,\n      ),\n      /**\n       * #volatile\n       */\n      collapsed: observable.map<string, boolean>(),\n      /**\n       * #volatile\n       */\n      filterText: '',\n      /**\n       * #volatile\n       */\n      recentlyUsedCounter: 0,\n      /**\n       * #volatile\n       */\n      favoritesCounter: 0,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get shownTrackIds() {\n        return new Set<string>(\n          self.view?.tracks?.map(\n            (t: { configuration: { trackId: string } }) =>\n              t.configuration.trackId,\n          ),\n        )\n      },\n      /**\n       * #getter\n       */\n      get selectionSet() {\n        return new Set(self.selection)\n      },\n      /**\n       * #getter\n       */\n      get favoritesSet() {\n        return new Set(self.favorites)\n      },\n      /**\n       * #getter\n       */\n      get recentlyUsedSet() {\n        return new Set(self.recentlyUsed)\n      },\n      /**\n       * #getter\n       */\n      get assemblyNames(): string[] {\n        return self.view?.assemblyNames || []\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSortTrackNames(val: boolean) {\n        self.sortTrackNames = val\n      },\n      /**\n       * #action\n       */\n      setSortCategories(val: boolean) {\n        self.sortCategories = val\n      },\n      /**\n       * #action\n       */\n      setSelection(elt: AnyConfigurationModel[]) {\n        self.selection = elt\n      },\n      /**\n       * #action\n       */\n      addToSelection(elt: AnyConfigurationModel[]) {\n        self.selection = dedupe([...self.selection, ...elt], e => e.trackId)\n      },\n      /**\n       * #action\n       */\n      removeFromSelection(elt: AnyConfigurationModel[]) {\n        const s = new Set(elt)\n        self.selection = self.selection.filter(f => !s.has(f))\n      },\n      /**\n       * #action\n       */\n      clearSelection() {\n        self.selection = []\n      },\n\n      /**\n       * #action\n       */\n      addToFavorites(trackId: string) {\n        self.favoritesCounter += 1\n        self.favorites = [...self.favorites, trackId]\n      },\n      /**\n       * #action\n       */\n      removeFromFavorites(trackId: string) {\n        self.favorites = self.favorites.filter(f => f !== trackId)\n      },\n      /**\n       * #action\n       */\n      clearFavorites() {\n        self.favorites = []\n      },\n\n      /**\n       * #action\n       */\n      setRecentlyUsedCounter(val: number) {\n        self.recentlyUsedCounter = val\n      },\n      /**\n       * #action\n       */\n      setRecentlyUsed(str: string[]) {\n        self.recentlyUsed = str\n      },\n      /**\n       * #action\n       */\n      setFavorites(str: string[]) {\n        self.favorites = str\n      },\n      /**\n       * #action\n       */\n      setFavoritesCounter(val: number) {\n        self.favoritesCounter = val\n      },\n      /**\n       * #action\n       */\n      addToRecentlyUsed(id: GridRowId) {\n        if (!self.recentlyUsed.includes(id)) {\n          self.recentlyUsedCounter = Math.min(\n            self.recentlyUsedCounter + 1,\n            MAX_RECENTLY_USED,\n          )\n          self.recentlyUsed =\n            self.recentlyUsed.length >= MAX_RECENTLY_USED\n              ? [...self.recentlyUsed.slice(1), id]\n              : [...self.recentlyUsed, id]\n        }\n      },\n      /**\n       * #action\n       */\n      clearRecentlyUsed() {\n        self.recentlyUsed = []\n      },\n      /**\n       * #action\n       */\n      setView(view: unknown) {\n        self.view = view\n      },\n      /**\n       * #action\n       */\n      toggleCategory(pathName: string) {\n        self.collapsed.set(pathName, !self.collapsed.get(pathName))\n      },\n      /**\n       * #action\n       */\n      setCategoryCollapsed(pathName: string, status: boolean) {\n        self.collapsed.set(pathName, status)\n      },\n      /**\n       * #action\n       */\n      expandAllCategories() {\n        self.collapsed.clear()\n      },\n      /**\n       * #action\n       */\n      setCollapsedCategories(str: [string, boolean][]) {\n        self.collapsed.replace(str)\n      },\n      /**\n       * #action\n       */\n      clearFilterText() {\n        self.filterText = ''\n      },\n      /**\n       * #action\n       */\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      isSelected(track: AnyConfigurationModel) {\n        return self.selectionSet.has(track)\n      },\n      /**\n       * #method\n       */\n      isFavorite(trackId: string) {\n        return self.favoritesSet.has(trackId)\n      },\n      /**\n       * #method\n       */\n      isRecentlyUsed(trackId: string) {\n        return self.recentlyUsedSet.has(trackId)\n      },\n      /**\n       * #method\n       */\n      getRefSeqTrackConf(assemblyName: string): MaybeAnyConfigurationModel {\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        const trackConf = assembly?.configuration.sequence\n        const viewType = pluginManager.getViewType(self.view.type)!\n        if (trackConf) {\n          for (const display of trackConf.displays) {\n            if (viewType.displayTypes.some(d => d.name === display.type)) {\n              return trackConf\n            }\n          }\n        }\n        return undefined\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get activeSortTrackNames() {\n        return (\n          self.sortTrackNames ??\n          getConf(getSession(self), ['hierarchical', 'sort', 'trackNames'])\n        )\n      },\n      /**\n       * #getter\n       */\n      get activeSortCategories() {\n        return (\n          self.sortCategories ??\n          getConf(getSession(self), ['hierarchical', 'sort', 'categories'])\n        )\n      },\n\n      /**\n       * #getter\n       * filter out tracks that don't match the current assembly/display types\n       */\n      get configAndSessionTrackConfigurations() {\n        return [\n          ...self.assemblyNames.map(a => self.getRefSeqTrackConf(a)),\n          ...filterTracks(getSession(self).tracks, self),\n        ].filter(notEmpty)\n      },\n      /**\n       * #getter\n       */\n      get allTrackConfigurations() {\n        const { connectionInstances = [] } = getSession(self)\n        return [\n          ...this.configAndSessionTrackConfigurations,\n          ...connectionInstances.flatMap(c => c.tracks),\n        ]\n      },\n\n      /**\n       * #getter\n       */\n      get allTrackConfigurationTrackIdSet() {\n        return new Map(this.allTrackConfigurations.map(t => [t.trackId, t]))\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * filters out tracks that are not in the favorites group\n       */\n      get favoriteTracks() {\n        return self.favorites\n          .filter(t => self.allTrackConfigurationTrackIdSet.has(t))\n          .map(t => self.allTrackConfigurationTrackIdSet.get(t)!)\n      },\n\n      /**\n       * #getter\n       * filters out tracks that are not in the recently used group\n       */\n      get recentlyUsedTracks() {\n        return self.recentlyUsed\n          .filter(t => self.allTrackConfigurationTrackIdSet.has(t))\n          .map(t => self.allTrackConfigurationTrackIdSet.get(t)!)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get allTracks() {\n        const { connectionInstances = [] } = getSession(self)\n        return [\n          {\n            group: 'Tracks',\n            tracks: self.configAndSessionTrackConfigurations,\n            noCategories: false,\n            menuItems: [],\n          },\n          ...connectionInstances.flatMap(c => ({\n            group: getConf(c, 'name'),\n            tracks: c.tracks,\n            noCategories: false,\n            menuItems: [],\n          })),\n        ]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get hierarchy() {\n        return {\n          name: 'Root',\n          id: 'Root',\n          isOpenByDefault: true,\n          type: 'category' as const,\n          children: self.allTracks.map(s => ({\n            name: s.group,\n            id: s.group,\n            type: 'category' as const,\n            isOpenByDefault: !self.collapsed.get(s.group),\n            menuItems: s.menuItems,\n            children: generateHierarchy({\n              model: self,\n              trackConfs: s.tracks,\n              extra: s.group,\n              noCategories: s.noCategories,\n            }),\n          })),\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      collapseSubCategories() {\n        const paths = [] as string[]\n        findSubCategories(self.hierarchy.children, paths)\n        for (const path of paths) {\n          self.setCategoryCollapsed(path, true)\n        }\n      },\n      /**\n       * #action\n       */\n      collapseTopLevelCategories() {\n        const paths = [] as string[]\n        for (const trackGroups of self.hierarchy.children) {\n          if (trackGroups.children.length) {\n            findTopLevelCategories(trackGroups.children, paths)\n          }\n        }\n        for (const path of paths) {\n          self.setCategoryCollapsed(path, true)\n        }\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get hasAnySubcategories() {\n        return self.allTracks.some(group =>\n          group.tracks.some(t => readConfObject(t, 'category')?.length > 1),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // this should be the first autorun to properly initialize\n        addDisposer(\n          self,\n          autorun(() => {\n            const { assemblyNames, view } = self\n            self.setRecentlyUsed(\n              localStorageGetJSON<string[]>(recentlyUsedK(assemblyNames), []),\n            )\n            if (view) {\n              const lc = localStorageGetJSON<MaybeCollapsedKeys>(\n                collapsedK(assemblyNames, view.type),\n                undefined,\n              )\n              const r = ['hierarchical', 'defaultCollapsed']\n              const session = getSession(self)\n              if (!lc) {\n                self.expandAllCategories()\n                if (getConf(session, [...r, 'topLevelCategories'])) {\n                  self.collapseTopLevelCategories()\n                }\n                if (getConf(session, [...r, 'subCategories'])) {\n                  self.collapseSubCategories()\n                }\n                for (const elt of getConf(session, [...r, 'categoryNames'])) {\n                  self.setCategoryCollapsed(`Tracks-${elt}`, true)\n                }\n              } else {\n                self.setCollapsedCategories(lc)\n              }\n            }\n          }),\n        )\n        // this should be the second autorun\n        addDisposer(\n          self,\n          autorun(() => {\n            const {\n              sortTrackNames,\n              sortCategories,\n              favorites,\n              recentlyUsed,\n              assemblyNames,\n              collapsed,\n              view,\n            } = self\n            localStorageSetJSON(recentlyUsedK(assemblyNames), recentlyUsed)\n            localStorageSetJSON(favoritesK(), favorites)\n            localStorageSetJSON(sortTrackNamesK(), sortTrackNames)\n            localStorageSetJSON(sortCategoriesK(), sortCategories)\n            if (view) {\n              localStorageSetJSON(\n                collapsedK(assemblyNames, view.type),\n                collapsed,\n              )\n            }\n          }),\n        )\n      },\n    }))\n}\n\nexport type HierarchicalTrackSelectorStateModel = ReturnType<\n  typeof stateTreeFactory\n>\nexport type HierarchicalTrackSelectorModel =\n  Instance<HierarchicalTrackSelectorStateModel>\n","import { lazy } from 'react'\n\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchema from './configSchema'\nimport stateModelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function HierarchicalTrackSelectorWidgetF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'HierarchicalTrackSelectorWidget',\n      heading: 'Available tracks',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(\n        () => import('./components/HierarchicalTrackSelector'),\n      ),\n    })\n  })\n}\n\nexport {\n  type HierarchicalTrackSelectorModel,\n  default as stateModelFactory,\n} from './model'\nexport { default as configSchema } from './configSchema'\n","import { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport default types.model('AddConnectionModel', {\n  id: ElementId,\n  type: types.literal('AddConnectionWidget'),\n})\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nimport stateModel from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst configSchema = ConfigurationSchema('AddConnectionWidget', {})\n\nexport default function AddConnectionWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'AddConnectionWidget',\n      heading: 'Add a connection',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./components/AddConnectionWidget')),\n    })\n  })\n}\n","import { parseBreakend } from '@gmod/vcf'\nimport { getBpDisplayStr } from '@jbrowse/core/util'\n\nimport type VCF from '@gmod/vcf'\n\nconst altTypeToSO: Record<string, string> = {\n  DEL: 'deletion',\n  INS: 'insertion',\n  DUP: 'duplication',\n  INV: 'inversion',\n  INVDUP: 'inverted_duplication',\n  CNV: 'copy_number_variation',\n  TRA: 'translocation',\n  'DUP:TANDEM': 'tandem_duplication',\n  NON_REF: 'sequence_variant',\n  '*': 'sequence_variant',\n}\n\nexport function getSOTermAndDescription(\n  ref: string,\n  alt: string[] | undefined,\n  parser: VCF,\n): string[] {\n  // it's just a remark if there are no alternate alleles\n  if (!alt || alt.length === 0) {\n    return ['remark', 'no alternative alleles']\n  }\n\n  const soTerms = new Set<string>()\n  let descriptions = new Set<string>()\n  for (const a of alt) {\n    let [soTerm, description] = getSOAndDescFromAltDefs(a, parser)\n    if (!soTerm) {\n      ;[soTerm, description] = getSOAndDescByExamination(ref, a)\n    }\n    if (soTerm && description) {\n      soTerms.add(soTerm)\n      descriptions.add(description)\n    }\n  }\n\n  // Combine descriptions like [\"SNV G -> A\", \"SNV G -> T\"] to [\"SNV G -> A,T\"]\n  if (descriptions.size > 1) {\n    const descs = [...descriptions]\n    const prefixes = new Set(\n      descs\n        .map(desc => {\n          const prefix = desc.split('->')\n          return prefix[1] ? prefix[0] : desc\n        })\n        .filter((f): f is string => !!f),\n    )\n\n    descriptions = new Set(\n      [...prefixes]\n        .map(r => r.trim())\n        .map(prefix => {\n          const suffixes = descs\n            .map(desc => desc.split('->').map(r => r.trim()))\n            .map(pref => (pref[1] && pref[0] === prefix ? pref[1] : ''))\n            .filter(f => !!f)\n\n          return suffixes.length ? `${prefix} -> ${suffixes.join(',')}` : prefix\n        }),\n    )\n  }\n  return soTerms.size\n    ? [[...soTerms].join(','), [...descriptions].join(',')]\n    : []\n}\n\nexport function getSOAndDescFromAltDefs(alt: string, parser: VCF): string[] {\n  if (typeof alt === 'string' && !alt.startsWith('<')) {\n    return []\n  }\n\n  // look for a definition with an SO type for this\n  let soTerm = altTypeToSO[alt]\n\n  // if no SO term but ALT is in metadata, assume sequence_variant\n  if (!soTerm && parser.getMetadata('ALT', alt)) {\n    soTerm = 'sequence_variant'\n  }\n  if (soTerm) {\n    return [soTerm, alt]\n  }\n\n  // try to look for a definition for a parent term if we can\n  const modAlt = alt.split(':')\n  return modAlt.length > 1\n    ? getSOAndDescFromAltDefs(`<${modAlt.slice(0, -1).join(':')}>`, parser)\n    : []\n}\n\nexport function getSOAndDescByExamination(ref: string, alt: string) {\n  const bnd = parseBreakend(alt)\n  if (bnd) {\n    return ['breakend', alt]\n  } else if (ref.length === 1 && alt.length === 1) {\n    // note: SNV is used instead of SNP because SO definition of SNP says\n    // abundance must be at least 1% in population\n    return ['SNV', makeDescriptionString('SNV', ref, alt)]\n  } else if (alt === '<INS>') {\n    return ['insertion', alt]\n  } else if (alt === '<DEL>') {\n    return ['deletion', alt]\n  } else if (alt === '<DUP>') {\n    return ['duplication', alt]\n  } else if (alt === '<CNV>') {\n    return ['cnv', alt]\n  } else if (alt === '<INV>') {\n    return ['inversion', alt]\n  } else if (alt === '<TRA>') {\n    return ['translocation', alt]\n  } else if (alt.includes('<')) {\n    return ['sv', alt]\n  } else if (ref.length === alt.length) {\n    const lenRef = ref.length\n    const lenAlt = alt.length\n    if (lenRef > 5 || lenAlt > 5) {\n      const lena = getBpDisplayStr(lenRef)\n      const lenb = getBpDisplayStr(lenAlt)\n      return ref.split('').reverse().join('') === alt\n        ? ['inverson', makeDescriptionString('inv', lena, lenb)]\n        : ['substitution', makeDescriptionString('substitution', lena, lenb)]\n    } else {\n      return ref.split('').reverse().join('') === alt\n        ? ['inversion', makeDescriptionString('inv', ref, alt)]\n        : ['substitution', makeDescriptionString('substitution', ref, alt)]\n    }\n  } else if (ref.length <= alt.length) {\n    const len = alt.length - ref.length\n    const lenAlt = alt.length\n    const lenRef = ref.length\n    const lena = getBpDisplayStr(len)\n    return [\n      'insertion',\n      lenRef > 5 || lenAlt > 5\n        ? `${lena} INS`\n        : makeDescriptionString('insertion', len > 5 ? lena : ref, alt),\n    ]\n  } else if (ref.length > alt.length) {\n    const lenRef = ref.length\n    const lenAlt = alt.length\n    const lena = getBpDisplayStr(lenRef - lenAlt)\n    return [\n      'deletion',\n      lenRef > 5 || lenAlt > 5\n        ? `${lena} DEL`\n        : makeDescriptionString('deletion', ref, alt),\n    ]\n  } else {\n    return ['indel', makeDescriptionString('indel', ref, alt)]\n  }\n}\n\nexport function getMinimalDesc(ref: string, alt: string) {\n  const bnd = parseBreakend(alt)\n  if (bnd) {\n    return alt\n  } else if (ref.length === 1 && alt.length === 1) {\n    // note: SNV is used instead of SNP because SO definition of SNP says\n    // abundance must be at least 1% in population\n    return alt\n  } else if (alt === '<INS>') {\n    return alt\n  } else if (alt === '<DEL>') {\n    return alt\n  } else if (alt === '<DUP>') {\n    return alt\n  } else if (alt === '<CNV>') {\n    return alt\n  } else if (alt === '<INV>') {\n    return alt\n  } else if (alt === '<TRA>') {\n    return alt\n  } else if (alt.includes('<')) {\n    return alt\n  } else if (ref.length === alt.length) {\n    const lenRef = ref.length\n    const lenAlt = alt.length\n    if (lenRef > 5 || lenAlt > 5) {\n      const lena = getBpDisplayStr(lenRef)\n      const lenb = getBpDisplayStr(lenAlt)\n      return ref.split('').reverse().join('') === alt\n        ? makeDescriptionString('inv', lena, lenb)\n        : makeDescriptionString('substitution', lena, lenb)\n    } else {\n      return ref.split('').reverse().join('') === alt\n        ? makeDescriptionString('inv', ref, alt)\n        : makeDescriptionString('substitution', ref, alt)\n    }\n  } else if (ref.length <= alt.length) {\n    const len = alt.length - ref.length\n    const lenAlt = alt.length\n    const lenRef = ref.length\n    const lena = getBpDisplayStr(len)\n    return lenRef > 5 || lenAlt > 5\n      ? `${lena} INS`\n      : makeDescriptionString('insertion', len > 5 ? lena : ref, alt)\n  } else if (ref.length > alt.length) {\n    const lenRef = ref.length\n    const lenAlt = alt.length\n    const lena = getBpDisplayStr(lenRef - lenAlt)\n    return lenRef > 5 || lenAlt > 5\n      ? `${lena} DEL`\n      : makeDescriptionString('deletion', ref, alt)\n  } else {\n    return makeDescriptionString('indel', ref, alt)\n  }\n}\n\nfunction makeDescriptionString(soTerm: string, ref: string, alt: string) {\n  return `${soTerm} ${[ref, alt].join(' -> ')}`\n}\n\nexport function makeSimpleAltString(\n  genotype: string,\n  ref: string,\n  alt: string[],\n) {\n  return genotype\n    .split(/[/|]/)\n    .map(r =>\n      r === '.'\n        ? '.'\n        : +r === 0\n          ? `ref(${ref.length < 10 ? ref : getBpDisplayStr(ref.length)})`\n          : getMinimalDesc(ref, alt[+r - 1] || ''),\n    )\n    .join(genotype.includes('|') ? '|' : '/')\n}\n","import { ConfigurationSchema } from '../../configuration'\n\n/**\n * #config CytobandAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'CytobandAdapter',\n  {\n    /**\n     * #slot\n     */\n    cytobandLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/cytoband.txt.gz',\n      },\n    },\n  },\n  {\n    explicitlyTyped: true,\n\n    /**\n     * #preProcessSnapshot\n     *\n     *\n     * preprocessor to allow minimal config:\n     * ```json\n     * {\n     *   \"type\": \"CytobandAdapter\",\n     *   \"uri\": \"yourfile.bed\"\n     * }\n     * ```\n     */\n    preProcessSnapshot: snap => {\n      // populate from just snap.uri\n      return snap.uri\n        ? {\n            ...snap,\n            cytobandLocation: {\n              uri: snap.uri,\n              baseUri: snap.baseUri,\n            },\n          }\n        : snap\n    },\n  },\n)\n\nexport default configSchema\n","import { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\n\nexport default class CoreGetRefNames extends RpcMethodType {\n  name = 'CoreGetRefNames'\n\n  async execute(\n    args: {\n      sessionId: string\n      stopToken?: string\n      adapterConfig: Record<string, unknown>\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (isFeatureAdapter(dataAdapter)) {\n      return dataAdapter.getRefNames(deserializedArgs)\n    }\n    return []\n  }\n}\n","import RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { renameRegionsIfNeeded } from '../../util'\n\nimport type { RenderArgs, RenderArgsSerialized } from './util'\nimport type { BoxRendererType } from '../../pluggableElementTypes'\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport default class CoreGetFeatureDetails extends RpcMethodType {\n  name = 'CoreGetFeatureDetails'\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    )) as RenderArgs\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n    const { rendererType } = args\n    const RendererType = this.pluginManager.getRendererType(rendererType)!\n    // @ts-expect-error\n    return RendererType.serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { stopToken?: string },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { rendererType, featureId } = deserializedArgs\n    const RendererType = this.pluginManager.getRendererType(\n      rendererType,\n    )! as BoxRendererType\n\n    return {\n      // @ts-expect-error\n      feature: RendererType.getLayoutSession(args)\n        // @ts-expect-error\n        ?.cachedLayout.layout.getDataByID(featureId)\n        // @ts-expect-error\n        ?.toJSON(),\n    }\n  }\n}\n","import { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\n\nexport default class CoreGetMetadata extends RpcMethodType {\n  name = 'CoreGetMetadata'\n\n  async execute(\n    args: {\n      sessionId: string\n      stopToken?: string\n      adapterConfig: Record<string, unknown>\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getMetadata(deserializedArgs)\n      : null\n  }\n}\n","import { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\n\nexport default class CoreGetFileInfo extends RpcMethodType {\n  name = 'CoreGetInfo'\n\n  async execute(\n    args: {\n      sessionId: string\n      stopToken?: string\n      adapterConfig: Record<string, unknown>\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getHeader(deserializedArgs)\n      : null\n  }\n}\n","import { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { renameRegionsIfNeeded } from '../../util'\nimport SimpleFeature from '../../util/simpleFeature'\n\nimport type { RenderArgs } from './util'\nimport type { Region } from '../../util'\nimport type { SimpleFeatureSerialized } from '../../util/simpleFeature'\n\nexport default class CoreGetFeatures extends RpcMethodType {\n  name = 'CoreGetFeatures'\n\n  async deserializeReturn(\n    feats: SimpleFeatureSerialized[],\n    args: unknown,\n    rpcDriver: string,\n  ) {\n    const superDeserialized = (await super.deserializeReturn(\n      feats,\n      args,\n      rpcDriver,\n    )) as SimpleFeatureSerialized[]\n    return superDeserialized.map(feat => new SimpleFeature(feat))\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n    return super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    ) as Promise<RenderArgs>\n  }\n\n  async execute(\n    args: {\n      sessionId: string\n      regions: Region[]\n      adapterConfig: Record<string, unknown>\n      stopToken?: string\n      opts?: any\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { stopToken, sessionId, adapterConfig, regions, opts } =\n      deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    const ret = dataAdapter.getFeaturesInMultipleRegions(regions, {\n      ...opts,\n      stopToken,\n    })\n    const r = await firstValueFrom(ret.pipe(toArray()))\n    return r.map(f => f.toJSON())\n  }\n}\n","import type { ServerSideRendererType } from '../../pluggableElementTypes'\nimport type {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n} from '../../pluggableElementTypes/renderers/ServerSideRendererType'\nimport type { Region } from '../../util'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  adapterConfig: Record<string, unknown>\n  rendererType: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  assemblyName: string\n  regions: Region[]\n  adapterConfig: Record<string, unknown>\n  rendererType: string\n}\n\nexport function validateRendererType<T>(\n  rendererType: string,\n  RendererType: T,\n): ServerSideRendererType {\n  // @ts-expect-error\n  if (!RendererType.ReactComponent) {\n    throw new Error(\n      `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n    )\n  }\n  return RendererType as unknown as ServerSideRendererType\n}\n\nexport {\n  type RenderResults,\n  type ResultsSerialized,\n} from '../../pluggableElementTypes/renderers/ServerSideRendererType'\n","import { validateRendererType } from './util'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { renameRegionsIfNeeded } from '../../util'\n\nimport type {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from './util'\n\nexport default class CoreRender extends RpcMethodType {\n  name = 'CoreRender'\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    )) as RenderArgs\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n\n    return validateRendererType(\n      args.rendererType,\n      this.pluginManager.getRendererType(args.rendererType),\n    ).serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { stopToken?: string },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { sessionId, rendererType } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return rpcDriver === 'MainThreadRpcDriver'\n      ? await RendererType.render(deserializedArgs)\n      : await RendererType.renderInWorker(deserializedArgs)\n  }\n\n  async deserializeReturn(\n    serializedReturn: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriver: string,\n  ): Promise<unknown> {\n    const des = await super.deserializeReturn(serializedReturn, args, rpcDriver)\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return des\n    }\n    return validateRendererType(\n      args.rendererType,\n      this.pluginManager.getRendererType(args.rendererType),\n    ).deserializeResultsInClient(des as ResultsSerialized, args)\n  }\n}\n","import { freeAdapterResources } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\n\n/**\n * free up any resources (e.g. cached adapter objects)\n * that are only associated with the given track ID.\n *\n * returns number of objects deleted\n */\nexport default class CoreFreeResources extends RpcMethodType {\n  name = 'CoreFreeResources'\n\n  async execute(args: Record<string, unknown>) {\n    freeAdapterResources(args)\n    for (const renderer of this.pluginManager.getRendererTypes()) {\n      renderer.freeResources(args)\n    }\n  }\n\n  async serializeArguments(args: Record<string, unknown>, _rpcDriver: string) {\n    return args\n  }\n}\n","import { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { renameRegionsIfNeeded } from '../../util'\n\nimport type { RenderArgs } from './util'\nimport type { Region } from '../../util'\n\nexport default class CoreGetFeatureDensityStats extends RpcMethodType {\n  name = 'CoreGetFeatureDensityStats'\n\n  async serializeArguments(\n    args: RenderArgs & {\n      stopToken?: string\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriver: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriver)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: Record<string, unknown>\n      regions: Region[]\n      stopToken?: string\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    return dataAdapter.getMultiRegionFeatureDensityStats(\n      regions,\n      deserializedArgs,\n    )\n  }\n}\n","import { lazy } from 'react'\n\nimport { configSchema, stateModelFactory } from './BaseFeatureWidget'\nimport Plugin from './Plugin'\nimport CytobandAdapterF from './data_adapters/CytobandAdapter'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport * as coreRpcMethods from './rpc/coreRpcMethods'\n\nimport type PluginManager from './PluginManager'\n\n// the core plugin, which registers types that ALL JBrowse applications are\n// expected to need.\nexport default class CorePlugin extends Plugin {\n  name = 'CorePlugin'\n\n  install(pluginManager: PluginManager) {\n    // register all our core rpc methods\n    for (const RpcMethod of Object.values(coreRpcMethods)) {\n      pluginManager.addRpcMethod(() => new RpcMethod(pluginManager))\n    }\n\n    CytobandAdapterF(pluginManager)\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'BaseFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./BaseFeatureWidget/BaseFeatureDetail'),\n        ),\n      })\n    })\n  }\n}\n","import configSchema from './configSchema'\nimport { AdapterType } from '../../pluggableElementTypes'\n\nimport type PluginManager from '../../PluginManager'\n\nexport default function CytobandAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'CytobandAdapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () => import('./CytobandAdapter').then(f => f.default),\n      }),\n  )\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-function-type */\nimport { isModelType, isType, types } from 'mobx-state-tree'\n\nimport CorePlugin from './CorePlugin'\nimport ReExports from './ReExports'\nimport {\n  ConfigurationSchema,\n  isBareConfigurationSchemaType,\n} from './configuration'\nimport AdapterType from './pluggableElementTypes/AdapterType'\nimport AddTrackWorkflowType from './pluggableElementTypes/AddTrackWorkflowType'\nimport ConnectionType from './pluggableElementTypes/ConnectionType'\nimport DisplayType from './pluggableElementTypes/DisplayType'\nimport InternetAccountType from './pluggableElementTypes/InternetAccountType'\nimport RpcMethodType from './pluggableElementTypes/RpcMethodType'\nimport TextSearchAdapterType from './pluggableElementTypes/TextSearchAdapterType'\nimport TrackType from './pluggableElementTypes/TrackType'\nimport ViewType from './pluggableElementTypes/ViewType'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport RendererType from './pluggableElementTypes/renderers/RendererType'\nimport createJexlInstance from './util/jexl'\n\nimport type Plugin from './Plugin'\nimport type { PluginDefinition } from './PluginLoader'\nimport type {\n  PluggableElementMember,\n  PluggableElementType,\n} from './pluggableElementTypes'\nimport type PluggableElementBase from './pluggableElementTypes/PluggableElementBase'\nimport type { AbstractRootModel } from './util'\nimport type { IAnyModelType, IAnyType } from 'mobx-state-tree'\n\n// helper class that keeps groups of callbacks that are then run in a specified\n// order by group\nclass PhasedScheduler<PhaseName extends string> {\n  phaseCallbacks = new Map<PhaseName, Function[]>()\n\n  phaseOrder: PhaseName[] = []\n\n  constructor(...phaseOrder: PhaseName[]) {\n    this.phaseOrder = phaseOrder\n  }\n\n  add(phase: PhaseName, callback: Function) {\n    if (!this.phaseOrder.includes(phase)) {\n      throw new Error(`unknown phase ${phase}`)\n    }\n    let phaseCallbacks = this.phaseCallbacks.get(phase)\n    if (!phaseCallbacks) {\n      phaseCallbacks = []\n      this.phaseCallbacks.set(phase, phaseCallbacks)\n    }\n    phaseCallbacks.push(callback)\n  }\n\n  run() {\n    for (const phaseName of this.phaseOrder) {\n      for (const callback of this.phaseCallbacks.get(phaseName) || []) {\n        callback()\n      }\n    }\n  }\n}\n\ntype PluggableElementTypeGroup =\n  | 'renderer'\n  | 'adapter'\n  | 'display'\n  | 'track'\n  | 'connection'\n  | 'view'\n  | 'widget'\n  | 'rpc method'\n  | 'internet account'\n  | 'text search adapter'\n  | 'add track workflow'\n\n/** internal class that holds the info for a certain element type */\nclass TypeRecord<ElementClass extends PluggableElementBase> {\n  registeredTypes: Record<string, ElementClass> = {}\n\n  constructor(\n    public typeName: string,\n    public baseClass:\n      | (new (...args: unknown[]) => ElementClass)\n      // covers abstract class case\n      | (Function & {\n          prototype: ElementClass\n        }),\n  ) {}\n\n  add(name: string, t: ElementClass) {\n    this.registeredTypes[name] = t\n  }\n\n  has(name: string) {\n    return name in this.registeredTypes\n  }\n\n  get(name: string) {\n    if (!this.has(name)) {\n      throw new Error(\n        `${this.typeName} '${name}' not found, perhaps its plugin is not loaded or its plugin has not added it.`,\n      )\n    }\n    return this.registeredTypes[name]\n  }\n\n  all() {\n    return Object.values(this.registeredTypes)\n  }\n}\n\ntype AnyFunction = (...args: any) => any\n\n/**\n * free-form string-to-unknown mapping of metadata related to the instance of\n * this plugin. `isCore` is typically set to `Boolean(true)` if the plugin was\n * loaded as part of the \"core\" set of plugins for this application. Can also\n * use this metadata to stash other things about why the plugin is loaded, such\n * as where it came from, what plugin depends on it, etc.\n */\nexport type PluginMetadata = Record<string, unknown>\n\nexport interface PluginLoadRecord {\n  metadata?: PluginMetadata\n  plugin: Plugin\n}\nexport interface RuntimePluginLoadRecord extends PluginLoadRecord {\n  definition: PluginDefinition\n}\n\nexport default class PluginManager {\n  plugins: Plugin[] = []\n\n  jexl = createJexlInstance()\n\n  pluginMetadata: Record<string, PluginMetadata> = {}\n\n  runtimePluginDefinitions: PluginDefinition[] = []\n\n  elementCreationSchedule = new PhasedScheduler<PluggableElementTypeGroup>(\n    'renderer',\n    'adapter',\n    'text search adapter',\n    'display',\n    'track',\n    'connection',\n    'view',\n    'widget',\n    'rpc method',\n    'internet account',\n    'add track workflow',\n  ) as PhasedScheduler<PluggableElementTypeGroup> | undefined\n\n  rendererTypes = new TypeRecord('RendererType', RendererType)\n\n  adapterTypes = new TypeRecord('AdapterType', AdapterType)\n\n  textSearchAdapterTypes = new TypeRecord(\n    'TextSearchAdapterType',\n    TextSearchAdapterType,\n  )\n\n  trackTypes = new TypeRecord('TrackType', TrackType)\n\n  displayTypes = new TypeRecord('DisplayType', DisplayType)\n\n  connectionTypes = new TypeRecord('ConnectionType', ConnectionType)\n\n  viewTypes = new TypeRecord('ViewType', ViewType)\n\n  widgetTypes = new TypeRecord('WidgetType', WidgetType)\n\n  rpcMethods = new TypeRecord('RpcMethodType', RpcMethodType)\n\n  addTrackWidgets = new TypeRecord('AddTrackWorkflow', AddTrackWorkflowType)\n\n  internetAccountTypes = new TypeRecord(\n    'InternetAccountType',\n    InternetAccountType,\n  )\n\n  configured = false\n\n  rootModel?: AbstractRootModel\n\n  extensionPoints = new Map<string, Function[]>()\n\n  constructor(initialPlugins: (Plugin | PluginLoadRecord)[] = []) {\n    // add the core plugin\n    this.addPlugin({\n      plugin: new CorePlugin(),\n      metadata: {\n        isCore: true,\n      },\n    })\n\n    // add all the initial plugins\n    for (const plugin of initialPlugins) {\n      this.addPlugin(plugin)\n    }\n  }\n\n  pluginConfigurationSchemas() {\n    const configurationSchemas: Record<string, unknown> = {}\n    for (const plugin of this.plugins) {\n      if (plugin.configurationSchema) {\n        configurationSchemas[plugin.name] = plugin.configurationSchema\n      }\n    }\n    return configurationSchemas\n  }\n\n  addPlugin(load: Plugin | PluginLoadRecord | RuntimePluginLoadRecord) {\n    if (this.configured) {\n      throw new Error('JBrowse already configured, cannot add plugins')\n    }\n\n    // check for availability of 'install' and 'configure' as a proxy for being\n    // an 'instanceof Plugin'\n    const [plugin, metadata = {}] =\n      'install' in load && 'configure' in load\n        ? [load, {}]\n        : [load.plugin, load.metadata]\n\n    if (this.plugins.includes(plugin)) {\n      throw new Error('plugin already installed')\n    }\n\n    this.pluginMetadata[plugin.name] = metadata\n    if ('definition' in load) {\n      this.runtimePluginDefinitions.push(load.definition)\n    }\n    plugin.install(this)\n    this.plugins.push(plugin)\n    return this\n  }\n\n  getPlugin(name: string) {\n    return this.plugins.find(p => p.name === name)\n  }\n\n  hasPlugin(name: string) {\n    return this.getPlugin(name) !== undefined\n  }\n\n  createPluggableElements() {\n    // run the creation callbacks for each element type in order.\n    // see elementCreationSchedule above for the creation order\n    if (this.elementCreationSchedule) {\n      this.elementCreationSchedule.run()\n      this.elementCreationSchedule = undefined\n    }\n    return this\n  }\n\n  setRootModel(rootModel: AbstractRootModel) {\n    this.rootModel = rootModel\n    return this\n  }\n\n  configure() {\n    if (this.configured) {\n      throw new Error('already configured')\n    }\n\n    for (const plugin of this.plugins) {\n      plugin.configure(this)\n    }\n\n    this.configured = true\n\n    return this\n  }\n\n  getElementTypeRecord(\n    groupName: PluggableElementTypeGroup,\n  ): TypeRecord<PluggableElementBase> {\n    switch (groupName) {\n      case 'adapter':\n        return this.adapterTypes\n      case 'text search adapter':\n        return this.textSearchAdapterTypes\n      case 'connection':\n        return this.connectionTypes\n      case 'widget':\n        return this.widgetTypes\n      case 'renderer':\n        return this.rendererTypes\n      case 'display':\n        return this.displayTypes\n      case 'track':\n        return this.trackTypes\n      case 'view':\n        return this.viewTypes\n      case 'rpc method':\n        return this.rpcMethods\n      case 'internet account':\n        return this.internetAccountTypes\n      case 'add track workflow':\n        return this.addTrackWidgets\n      default:\n        throw new Error(`invalid element type '${groupName}'`)\n    }\n  }\n\n  addElementType(\n    groupName: PluggableElementTypeGroup,\n    creationCallback: (pluginManager: PluginManager) => PluggableElementType,\n  ) {\n    if (typeof creationCallback !== 'function') {\n      throw new Error(\n        'must provide a callback function that returns the new type object',\n      )\n    }\n    const typeRecord = this.getElementTypeRecord(groupName)\n\n    this.elementCreationSchedule?.add(groupName, () => {\n      const newElement = creationCallback(this)\n      if (!newElement.name) {\n        throw new Error(`cannot add a ${groupName} with no name`)\n      }\n\n      if (typeRecord.has(newElement.name)) {\n        console.warn(\n          `${groupName} ${newElement.name} already registered, cannot register it again`,\n        )\n      } else {\n        typeRecord.add(\n          newElement.name,\n          this.evaluateExtensionPoint(\n            'Core-extendPluggableElement',\n            newElement,\n          ) as PluggableElementType,\n        )\n      }\n    })\n\n    return this\n  }\n\n  getElementType(groupName: PluggableElementTypeGroup, typeName: string) {\n    return this.getElementTypeRecord(groupName).get(typeName)\n  }\n\n  getElementTypesInGroup(groupName: PluggableElementTypeGroup) {\n    return this.getElementTypeRecord(groupName).all()\n  }\n\n  getViewElements() {\n    return this.getElementTypesInGroup('view') as ViewType[]\n  }\n\n  getTrackElements() {\n    return this.getElementTypesInGroup('track') as TrackType[]\n  }\n\n  getConnectionElements() {\n    return this.getElementTypesInGroup('connection') as ConnectionType[]\n  }\n\n  getAddTrackWorkflowElements() {\n    return this.getElementTypesInGroup(\n      'add track workflow',\n    ) as AddTrackWorkflowType[]\n  }\n\n  getRpcElements() {\n    return this.getElementTypesInGroup('rpc method') as RpcMethodType[]\n  }\n\n  getDisplayElements() {\n    return this.getElementTypesInGroup('display') as DisplayType[]\n  }\n\n  getAdapterElements() {\n    return this.getElementTypesInGroup('adapter') as AdapterType[]\n  }\n\n  /** get a MST type for the union of all specified pluggable MST types */\n  pluggableMstType(\n    groupName: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember,\n    fallback: IAnyType = types.maybe(types.null),\n  ) {\n    const pluggableTypes = this.getElementTypeRecord(groupName)\n      .all()\n      // @ts-expect-error\n      .map(t => t[fieldName])\n      .filter(t => isType(t) && isModelType(t)) as IAnyType[]\n\n    // try to smooth over the case when no types are registered, mostly\n    // encountered in tests\n    if (pluggableTypes.length === 0 && typeof jest === 'undefined') {\n      console.warn(\n        `No pluggable types found matching ('${groupName}','${fieldName}')`,\n      )\n      return fallback\n    }\n    return types.union(...pluggableTypes)\n  }\n\n  /** get a MST type for the union of all specified pluggable config schemas */\n  pluggableConfigSchemaType(\n    typeGroup: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember = 'configSchema',\n  ) {\n    const pluggableTypes = this.getElementTypeRecord(typeGroup)\n      .all()\n      // @ts-expect-error\n      .map(t => t[fieldName])\n      .filter(t => isBareConfigurationSchemaType(t)) as IAnyType[]\n\n    if (pluggableTypes.length === 0) {\n      pluggableTypes.push(ConfigurationSchema('Null', {}))\n    }\n    return types.union(...pluggableTypes) as IAnyModelType\n  }\n\n  jbrequireCache = new Map()\n\n  lib = ReExports\n\n  load = <FTYPE extends AnyFunction>(lib: FTYPE): ReturnType<FTYPE> => {\n    if (!this.jbrequireCache.has(lib)) {\n      this.jbrequireCache.set(lib, lib(this))\n    }\n    return this.jbrequireCache.get(lib)\n  }\n\n  /**\n   * Get the re-exported version of the given package name.\n   * Throws an error if the package is not re-exported by the plugin manager.\n   *\n   * @returns the library's default export\n   */\n  jbrequire = (\n    lib: keyof typeof ReExports | AnyFunction | { default: AnyFunction },\n  ): any => {\n    if (typeof lib === 'string') {\n      const pack = this.lib[lib]\n\n      if (!pack) {\n        throw new TypeError(\n          `No jbrequire re-export defined for package '${lib}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`,\n        )\n      }\n      return pack\n    } else if (typeof lib === 'function') {\n      return this.load(lib)\n    }\n\n    // @ts-expect-error\n    else if (lib.default) {\n      console.warn('initiated jbrequire on a {default:Function}')\n      // @ts-expect-error\n      return this.jbrequire(lib.default)\n    }\n\n    throw new TypeError(\n      'lib passed to jbrequire must be either a string or a function',\n    )\n  }\n\n  getRendererType(typeName: string) {\n    return this.rendererTypes.get(typeName)\n  }\n\n  getRendererTypes(): RendererType[] {\n    return this.rendererTypes.all()\n  }\n\n  getAdapterType(typeName: string) {\n    return this.adapterTypes.get(typeName)\n  }\n\n  getTextSearchAdapterType(typeName: string) {\n    return this.textSearchAdapterTypes.get(typeName)\n  }\n\n  getTrackType(typeName: string) {\n    return this.trackTypes.get(typeName)\n  }\n\n  getDisplayType(typeName: string) {\n    return this.displayTypes.get(typeName)\n  }\n\n  getViewType(typeName: string) {\n    return this.viewTypes.get(typeName)\n  }\n\n  getAddTrackWorkflow(typeName: string) {\n    return this.addTrackWidgets.get(typeName)\n  }\n\n  getWidgetType(typeName: string) {\n    return this.widgetTypes.get(typeName)\n  }\n\n  getConnectionType(typeName: string) {\n    return this.connectionTypes.get(typeName)\n  }\n\n  getRpcMethodType(methodName: string) {\n    return this.rpcMethods.get(methodName)\n  }\n\n  getInternetAccountType(name: string) {\n    return this.internetAccountTypes.get(name)\n  }\n\n  addRendererType(cb: (pm: PluginManager) => RendererType) {\n    return this.addElementType('renderer', cb)\n  }\n\n  addAdapterType(cb: (pm: PluginManager) => AdapterType) {\n    return this.addElementType('adapter', cb)\n  }\n\n  addTextSearchAdapterType(cb: (pm: PluginManager) => TextSearchAdapterType) {\n    return this.addElementType('text search adapter', cb)\n  }\n\n  addTrackType(cb: (pm: PluginManager) => TrackType) {\n    // Goes through the already-created displays and registers the ones that\n    // specify this track type\n    const callback = () => {\n      const track = cb(this)\n      const displays = this.getElementTypesInGroup('display') as DisplayType[]\n      for (const display of displays) {\n        // track may have already added the displayType in its cb\n        if (\n          display.trackType === track.name &&\n          !track.displayTypes.includes(display)\n        ) {\n          track.addDisplayType(display)\n        }\n      }\n      return track\n    }\n    return this.addElementType('track', callback)\n  }\n\n  addDisplayType(cb: (pluginManager: PluginManager) => DisplayType) {\n    return this.addElementType('display', cb)\n  }\n\n  addViewType(cb: (pluginManager: PluginManager) => ViewType) {\n    const callback = () => {\n      const newView = cb(this)\n      const displays = this.getElementTypesInGroup('display') as DisplayType[]\n      for (const display of displays) {\n        // view may have already added the displayType in its callback\n        // see ViewType for description of extendedName\n        if (\n          (display.viewType === newView.name ||\n            display.viewType === newView.extendedName) &&\n          !newView.displayTypes.includes(display)\n        ) {\n          newView.addDisplayType(display)\n        }\n      }\n      return newView\n    }\n    return this.addElementType('view', callback)\n  }\n\n  addWidgetType(cb: (pm: PluginManager) => WidgetType) {\n    return this.addElementType('widget', cb)\n  }\n\n  addConnectionType(cb: (pm: PluginManager) => ConnectionType) {\n    return this.addElementType('connection', cb)\n  }\n\n  addRpcMethod(cb: (pm: PluginManager) => RpcMethodType) {\n    return this.addElementType('rpc method', cb)\n  }\n\n  addInternetAccountType(cb: (pm: PluginManager) => InternetAccountType) {\n    return this.addElementType('internet account', cb)\n  }\n\n  addAddTrackWorkflowType(cb: (pm: PluginManager) => AddTrackWorkflowType) {\n    return this.addElementType('add track workflow', cb)\n  }\n\n  addToExtensionPoint<T>(\n    extensionPointName: string,\n    callback: (extendee: T, props: Record<string, unknown>) => T,\n  ) {\n    let callbacks = this.extensionPoints.get(extensionPointName)\n    if (!callbacks) {\n      callbacks = []\n      this.extensionPoints.set(extensionPointName, callbacks)\n    }\n    callbacks.push(callback)\n  }\n\n  evaluateExtensionPoint(\n    extensionPointName: string,\n    extendee: unknown,\n    props?: Record<string, unknown>,\n  ) {\n    const callbacks = this.extensionPoints.get(extensionPointName)\n    let accumulator = extendee\n    if (callbacks) {\n      for (const callback of callbacks) {\n        try {\n          accumulator = callback(accumulator, props)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    return accumulator\n  }\n\n  async evaluateAsyncExtensionPoint(\n    extensionPointName: string,\n    extendee: unknown,\n    props?: Record<string, unknown>,\n  ) {\n    const callbacks = this.extensionPoints.get(extensionPointName)\n    let accumulator = extendee\n    if (callbacks) {\n      for (const callback of callbacks) {\n        try {\n          accumulator = await callback(accumulator, props)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    return accumulator\n  }\n}\n","import { forwardRef, isValidElement, useState } from 'react'\n\nimport { ResizeHandle, SanitizedHTML } from '@jbrowse/core/ui'\nimport BaseTooltip from '@jbrowse/core/ui/BaseTooltip'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { MultiLinearVariantMatrixDisplayModel } from '../model'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst useStyles = makeStyles()({\n  resizeHandle: {\n    height: 4,\n    background: '#ccc',\n    boxSizing: 'border-box',\n    borderTop: '1px solid #fafafa',\n  },\n})\n\nconst Wrapper = observer(function ({\n  children,\n  model,\n  exportSVG,\n}: {\n  model: MultiLinearVariantMatrixDisplayModel\n  children: React.ReactNode\n  exportSVG?: boolean\n}) {\n  const { height } = model\n  const { width, offsetPx } = getContainingView(model) as LinearGenomeViewModel\n  const left = Math.max(0, -offsetPx)\n  return exportSVG ? (\n    <g transform={`translate(${left})`}>{children}</g>\n  ) : (\n    <svg\n      style={{\n        position: 'absolute',\n        top: 0,\n        left,\n        height,\n        width,\n      }}\n    >\n      {children}\n    </svg>\n  )\n})\n\ninterface MouseOverLine {\n  f: Feature\n  idx: number\n  c: number\n}\n\nconst LinesConnectingMatrixToGenomicPosition = observer(function ({\n  model,\n  exportSVG,\n}: {\n  model: MultiLinearVariantMatrixDisplayModel\n  exportSVG?: boolean\n}) {\n  const { classes } = useStyles()\n  const { assemblyManager } = getSession(model)\n  const view = getContainingView(model) as LinearGenomeViewModel\n  const [mouseOverLine, setMouseOverLine] = useState<MouseOverLine>()\n  const { lineZoneHeight, featuresVolatile } = model\n  const { assemblyNames, dynamicBlocks } = view\n  const assembly = assemblyManager.get(assemblyNames[0]!)\n  const b0 = dynamicBlocks.contentBlocks[0]?.widthPx || 0\n  const w = b0 / (featuresVolatile?.length || 1)\n  return assembly && featuresVolatile ? (\n    <>\n      <Wrapper exportSVG={exportSVG} model={model}>\n        <AllLines model={model} setMouseOverLine={setMouseOverLine} />\n        {mouseOverLine ? (\n          <>\n            <line\n              stroke=\"#f00c\"\n              strokeWidth={2}\n              style={{\n                pointerEvents: 'none',\n              }}\n              x1={mouseOverLine.idx * w + w / 2}\n              x2={mouseOverLine.c}\n              y1={lineZoneHeight}\n              y2={0}\n              onMouseLeave={() => {\n                setMouseOverLine(undefined)\n              }}\n            />\n            <LineTooltip contents={mouseOverLine.f.get('name')} />\n          </>\n        ) : null}\n      </Wrapper>\n      {!exportSVG ? (\n        <ResizeHandle\n          style={{\n            position: 'absolute',\n            top: lineZoneHeight - 4,\n          }}\n          onDrag={n => model.setLineZoneHeight(lineZoneHeight + n)}\n          className={classes.resizeHandle}\n        />\n      ) : null}\n    </>\n  ) : null\n})\ninterface Props {\n  message: React.ReactNode | string\n}\nconst TooltipContents = forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ message }, ref) {\n    return (\n      <div ref={ref}>\n        {isValidElement(message) ? (\n          message\n        ) : message ? (\n          <SanitizedHTML html={String(message)} />\n        ) : null}\n      </div>\n    )\n  },\n)\nconst LineTooltip = observer(function ({ contents }: { contents?: string }) {\n  return contents ? (\n    <BaseTooltip>\n      <TooltipContents message={contents} />\n    </BaseTooltip>\n  ) : null\n})\n\nconst AllLines = observer(function ({\n  model,\n  setMouseOverLine,\n}: {\n  model: MultiLinearVariantMatrixDisplayModel\n  setMouseOverLine: (arg: any) => void\n}) {\n  const { assemblyManager } = getSession(model)\n  const view = getContainingView(model) as LinearGenomeViewModel\n  const { lineZoneHeight, featuresVolatile } = model\n  const { offsetPx, assemblyNames, dynamicBlocks } = view\n  const assembly = assemblyManager.get(assemblyNames[0]!)\n  const b0 = dynamicBlocks.contentBlocks[0]?.widthPx || 0\n  const w = b0 / (featuresVolatile?.length || 1)\n  const l = Math.max(offsetPx, 0)\n  return assembly && featuresVolatile ? (\n    <>\n      {featuresVolatile.map((f, i) => {\n        const ref = f.get('refName')\n        const c =\n          (view.bpToPx({\n            refName: assembly.getCanonicalRefName(ref) || ref,\n            coord: f.get('start'),\n          })?.offsetPx || 0) - l\n        return (\n          <line\n            stroke=\"#0004\"\n            strokeWidth={1}\n            key={f.id()}\n            x1={i * w + w / 2}\n            x2={c}\n            y1={lineZoneHeight}\n            y2={0}\n            onMouseEnter={() => {\n              setMouseOverLine({ f, idx: i, c })\n            }}\n            onMouseLeave={() => {\n              setMouseOverLine(undefined)\n            }}\n          />\n        )\n      })}\n    </>\n  ) : null\n})\n\nexport default LinesConnectingMatrixToGenomicPosition\n","import {\n  scaleLinear,\n  scaleLog,\n  scaleQuantize,\n} from '@mui/x-charts-vendor/d3-scale'\n\nexport const YSCALEBAR_LABEL_OFFSET = 5\n\nexport interface ScaleOpts {\n  domain: number[]\n  range: number[]\n  scaleType: string\n  pivotValue?: number\n  inverted?: boolean\n}\n\nexport interface Source {\n  baseUri?: string\n  name: string\n  color?: string\n  group?: string\n}\n\n/**\n * produces a d3-scale from arguments. applies a \"nice domain\" adjustment\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - range [min,max]\n *   - bounds [min,max]\n *   - scaleType (linear or log)\n *   - pivotValue (number)\n *   - inverted (boolean)\n */\nexport function getScale({\n  domain = [],\n  range = [],\n  scaleType,\n  pivotValue,\n  inverted,\n}: ScaleOpts) {\n  let scale:\n    | ReturnType<typeof scaleLinear<number>>\n    | ReturnType<typeof scaleLog<number>>\n    | ReturnType<typeof scaleQuantize<number>>\n  const [min, max] = domain\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain')\n  }\n  if (scaleType === 'linear') {\n    scale = scaleLinear()\n  } else if (scaleType === 'log') {\n    scale = scaleLog().base(2)\n  } else if (scaleType === 'quantize') {\n    scale = scaleQuantize()\n  } else {\n    throw new Error('undefined scaleType')\n  }\n  scale.domain(pivotValue !== undefined ? [min, pivotValue, max] : [min, max])\n  scale.nice()\n\n  const [rangeMin, rangeMax] = range\n  if (rangeMin === undefined || rangeMax === undefined) {\n    throw new Error('invalid range')\n  }\n  scale.range(inverted ? range.slice().reverse() : range)\n  return scale\n}\n/**\n * gets the origin for drawing the graph. for linear this is 0, for log this is\n * arbitrarily set to log(1)==0\n *\n * @param scaleType -\n */\nexport function getOrigin(scaleType: string /* , pivot, stats */) {\n  // if (pivot) {\n  //   if (pivot === 'mean') {\n  //     return stats.scoreMean || 0\n  //   }\n  //   if (pivot === 'zero') {\n  //     return 0\n  //   }\n  //   return parseFloat()\n  // }\n  // if (scaleType === 'z_score') {\n  //   return stats.scoreMean || 0\n  // }\n  if (scaleType === 'log') {\n    return 1\n  }\n  return 0\n}\n\n/**\n * produces a \"nice\" domain that actually rounds down to 0 for the min or 0 to\n * the max depending on if all values are positive or negative\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - bounds [min,max]\n *   - mean\n *   - stddev\n *   - scaleType (linear or log)\n */\nexport function getNiceDomain({\n  scaleType,\n  domain,\n  bounds,\n}: {\n  scaleType: string\n  domain: readonly [number, number]\n  bounds: readonly [number | undefined, number | undefined]\n}) {\n  const [minScore, maxScore] = bounds\n  let [min, max] = domain\n\n  if (scaleType === 'linear') {\n    if (max < 0) {\n      max = 0\n    }\n    if (min > 0) {\n      min = 0\n    }\n  }\n  if (scaleType === 'log') {\n    // for min>0 and max>1, set log min to 1, which works for most coverage\n    // type tracks. if max is not >1, might be like raw p-values so then it'll\n    // display negative values\n    if (min >= 0 && max > 1) {\n      min = 1\n    }\n  }\n\n  if (minScore !== undefined && minScore !== Number.MIN_VALUE) {\n    min = minScore\n  }\n  if (maxScore !== undefined && maxScore !== Number.MAX_VALUE) {\n    max = maxScore\n  }\n  const getScaleType = (type: string) => {\n    if (type === 'linear') {\n      return scaleLinear()\n    }\n    if (type === 'log') {\n      const scale = scaleLog()\n      scale.base(2)\n      return scale\n    }\n    if (type === 'quantize') {\n      return scaleQuantize()\n    }\n    throw new Error(`undefined scaleType ${type}`)\n  }\n  const scale = getScaleType(scaleType)\n\n  scale.domain([min, max])\n  scale.nice()\n  return scale.domain() as [number, number]\n}\n\nexport function toP(s = 0) {\n  return +(+s).toPrecision(6)\n}\n\nexport function round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\n\n// avoid drawing negative width features for SVG exports\nexport function fillRectCtx(\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  ctx: CanvasRenderingContext2D,\n  color?: string,\n) {\n  if (width < 0) {\n    x += width\n    width = -width\n  }\n  if (height < 0) {\n    y += height\n    height = -height\n  }\n\n  if (color) {\n    ctx.fillStyle = color\n  }\n  ctx.fillRect(x, y, width, height)\n}\n","import RBush from 'rbush'\n\nimport type {\n  BaseLayout,\n  RectTuple,\n  Rectangle,\n  SerializedLayout,\n} from './BaseLayout'\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\nexport default class PrecomputedLayout<T> implements BaseLayout<T> {\n  private rectangles: Map<string, RectTuple>\n\n  private totalHeight: number\n\n  public maxHeightReached: boolean\n\n  private rbush: RBush<Layout>\n\n  constructor({ rectangles, totalHeight, maxHeightReached }: SerializedLayout) {\n    this.rectangles = new Map(Object.entries(rectangles))\n    // rectangles is of the form \"featureId\": [leftPx, topPx, rightPx, bottomPx]\n    this.totalHeight = totalHeight\n    this.maxHeightReached = maxHeightReached\n    this.rbush = new RBush()\n    for (const [key, layout] of Object.entries(rectangles)) {\n      this.rbush.insert({\n        minX: layout[0],\n        minY: layout[1],\n        maxX: layout[2],\n        maxY: layout[3],\n        name: key,\n      })\n    }\n  }\n\n  addRect(id: string) {\n    const rect = this.rectangles.get(id)\n    if (!rect) {\n      throw new Error(`id ${id} not found in precomputed feature layout`)\n    }\n    // left, top, right, bottom\n    return rect[1]\n  }\n\n  /**\n   * returns a Map of `feature id -> rectangle`\n   */\n  getRectangles(): Map<string, RectTuple> {\n    return this.rectangles\n  }\n\n  getTotalHeight(): number {\n    return this.totalHeight\n  }\n\n  collides(_rect: Rectangle<T>, _top: number): boolean {\n    throw new Error('Method not implemented.')\n  }\n\n  getByCoord(x: number, y: number) {\n    const rect = { minX: x, minY: y, maxX: x + 1, maxY: y + 1 }\n    return this.rbush.collides(rect)\n      ? this.rbush.search(rect)[0]!.name\n      : undefined\n  }\n\n  getByID(id: string) {\n    return this.rectangles.get(id)\n  }\n\n  addRectToBitmap(_rect: Rectangle<T>, _data: Record<string, T>): void {\n    throw new Error('Method not implemented.')\n  }\n\n  discardRange(_left: number, _right: number): void {\n    throw new Error('Method not implemented.')\n  }\n\n  serializeRegion(_region: { start: number; end: number }): SerializedLayout {\n    throw new Error('Method not implemented.')\n  }\n\n  toJSON(): SerializedLayout {\n    return {\n      rectangles: Object.fromEntries(this.rectangles),\n      totalHeight: this.totalHeight,\n      maxHeightReached: false,\n      containsNoTransferables: true,\n    }\n  }\n}\n","export const HEADER_BAR_HEIGHT = 48\nexport const HEADER_OVERVIEW_HEIGHT = 20\nexport const SCALE_BAR_HEIGHT = 17\nexport const RESIZE_HANDLE_HEIGHT = 3\nexport const INTER_REGION_PADDING_WIDTH = 2\nexport const SPACING = 7\nexport const WIDGET_HEIGHT = 32\n","import { sum } from '.'\n\ntype Func<T> = (value: BaseBlock, index: number, array: BaseBlock[]) => T\n\nexport class BlockSet {\n  constructor(public blocks: BaseBlock[] = []) {}\n\n  push(block: BaseBlock) {\n    if (block.type === 'ElidedBlock' && this.blocks.length > 0) {\n      const lastBlock = this.blocks.at(-1)\n      if (lastBlock?.type === 'ElidedBlock') {\n        ;(lastBlock as ElidedBlock).push(block as ElidedBlock)\n        return\n      }\n    }\n\n    this.blocks.push(block)\n  }\n\n  getBlocks() {\n    return this.blocks\n  }\n\n  getRegions() {\n    return this.blocks.map(block => block.toRegion())\n  }\n\n  map<T, U = this>(func: Func<T>, thisarg?: U) {\n    // eslint-disable-next-line unicorn/no-array-method-this-argument\n    return this.blocks.map(func, thisarg)\n  }\n\n  forEach<T, U = this>(func: Func<T>, thisarg?: U) {\n    // eslint-disable-next-line unicorn/no-array-method-this-argument,unicorn/no-array-for-each\n    this.blocks.forEach(func, thisarg)\n  }\n\n  get length() {\n    return this.blocks.length\n  }\n\n  get totalWidthPx() {\n    return this.blocks.length > 0\n      ? sum(this.blocks.map(blocks => blocks.widthPx))\n      : 0\n  }\n\n  get totalWidthPxWithoutBorders() {\n    return this.blocks.length > 0\n      ? sum(\n          this.blocks\n            .filter(block => block.variant !== 'boundary')\n            .map(blocks => blocks.widthPx),\n        )\n      : 0\n  }\n\n  get offsetPx() {\n    return this.blocks.length > 0 ? this.blocks[0]!.offsetPx : 0\n  }\n\n  get contentBlocks() {\n    return this.blocks.filter(block => block.type === 'ContentBlock')\n  }\n\n  get totalBp() {\n    return sum(this.contentBlocks.map(block => block.end - block.start))\n  }\n}\n\nexport class BaseBlock {\n  type = 'BaseBlock'\n\n  public regionNumber?: number\n\n  public reversed?: boolean\n\n  public refName: string\n\n  public start: number\n\n  public end: number\n\n  public assemblyName: string\n\n  public key: string\n\n  public offsetPx: number\n\n  public widthPx = 0\n\n  public variant?: string\n\n  public isLeftEndOfDisplayedRegion?: boolean\n\n  /**\n   * a block that should be shown as filled with data\n   */\n\n  constructor(data: Record<string, any>) {\n    Object.assign(this, data)\n    this.assemblyName = data.assemblyName\n    this.refName = data.refName\n    this.start = data.start\n    this.end = data.end\n    this.key = data.key\n    this.offsetPx = data.offsetPx\n  }\n\n  toRegion() {\n    return {\n      refName: this.refName,\n      start: this.start,\n      end: this.end,\n      assemblyName: this.assemblyName,\n      reversed: this.reversed,\n    }\n  }\n}\n\nexport class ContentBlock extends BaseBlock {\n  type = 'ContentBlock'\n}\n\n/**\n * marker block representing one or more blocks that are\n * too small to be shown at the current zoom level\n */\nexport class ElidedBlock extends BaseBlock {\n  type = 'ElidedBlock'\n\n  public widthPx: number\n\n  public elidedBlockCount = 0\n\n  constructor(data: Record<string, any>) {\n    super(data)\n    this.widthPx = data.widthPx\n  }\n\n  push(otherBlock: ElidedBlock) {\n    this.elidedBlockCount += 1\n    this.refName = ''\n    this.start = 0\n    this.end = 0\n    this.widthPx += otherBlock.widthPx\n  }\n}\n\n/**\n * marker block that sits between two different displayed regions\n * and provides a thick border between them\n */\nexport class InterRegionPaddingBlock extends BaseBlock {\n  type = 'InterRegionPaddingBlock'\n}\n","// from https://www.w3.org/TR/css-color-4/#named-colors\n\nconst colors: Record<string, string> = {\n  aliceblue: '#F0F8FF',\n  antiquewhite: '#FAEBD7',\n  aqua: '#00FFFF',\n  aquamarine: '#7FFFD4',\n  azure: '#F0FFFF',\n  beige: '#F5F5DC',\n  bisque: '#FFE4C4',\n  black: '#000000',\n  blanchedalmond: '#FFEBCD',\n  blue: '#0000FF',\n  blueviolet: '#8A2BE2',\n  brown: '#A52A2A',\n  burlywood: '#DEB887',\n  cadetblue: '#5F9EA0',\n  chartreuse: '#7FFF00',\n  chocolate: '#D2691E',\n  coral: '#FF7F50',\n  cornflowerblue: '#6495ED',\n  cornsilk: '#FFF8DC',\n  crimson: '#DC143C',\n  cyan: '#00FFFF',\n  darkblue: '#00008B',\n  darkcyan: '#008B8B',\n  darkgoldenrod: '#B8860B',\n  darkgray: '#A9A9A9',\n  darkgreen: '#006400',\n  darkgrey: '#A9A9A9',\n  darkkhaki: '#BDB76B',\n  darkmagenta: '#8B008B',\n  darkolivegreen: '#556B2F',\n  darkorange: '#FF8C00',\n  darkorchid: '#9932CC',\n  darkred: '#8B0000',\n  darksalmon: '#E9967A',\n  darkseagreen: '#8FBC8F',\n  darkslateblue: '#483D8B',\n  darkslategray: '#2F4F4F',\n  darkslategrey: '#2F4F4F',\n  darkturquoise: '#00CED1',\n  darkviolet: '#9400D3',\n  deeppink: '#FF1493',\n  deepskyblue: '#00BFFF',\n  dimgray: '#696969',\n  dimgrey: '#696969',\n  dodgerblue: '#1E90FF',\n  firebrick: '#B22222',\n  floralwhite: '#FFFAF0',\n  forestgreen: '#228B22',\n  fuchsia: '#FF00FF',\n  gainsboro: '#DCDCDC',\n  ghostwhite: '#F8F8FF',\n  gold: '#FFD700',\n  goldenrod: '#DAA520',\n  gray: '#808080',\n  green: '#008000',\n  greenyellow: '#ADFF2F',\n  grey: '#808080',\n  honeydew: '#F0FFF0',\n  hotpink: '#FF69B4',\n  indianred: '#CD5C5C',\n  indigo: '#4B0082',\n  ivory: '#FFFFF0',\n  khaki: '#F0E68C',\n  lavender: '#E6E6FA',\n  lavenderblush: '#FFF0F5',\n  lawngreen: '#7CFC00',\n  lemonchiffon: '#FFFACD',\n  lightblue: '#ADD8E6',\n  lightcoral: '#F08080',\n  lightcyan: '#E0FFFF',\n  lightgoldenrodyellow: '#FAFAD2',\n  lightgray: '#D3D3D3',\n  lightgreen: '#90EE90',\n  lightgrey: '#D3D3D3',\n  lightpink: '#FFB6C1',\n  lightsalmon: '#FFA07A',\n  lightseagreen: '#20B2AA',\n  lightskyblue: '#87CEFA',\n  lightslategray: '#778899',\n  lightslategrey: '#778899',\n  lightsteelblue: '#B0C4DE',\n  lightyellow: '#FFFFE0',\n  lime: '#00FF00',\n  limegreen: '#32CD32',\n  linen: '#FAF0E6',\n  magenta: '#FF00FF',\n  maroon: '#800000',\n  mediumaquamarine: '#66CDAA',\n  mediumblue: '#0000CD',\n  mediumorchid: '#BA55D3',\n  mediumpurple: '#9370DB',\n  mediumseagreen: '#3CB371',\n  mediumslateblue: '#7B68EE',\n  mediumspringgreen: '#00FA9A',\n  mediumturquoise: '#48D1CC',\n  mediumvioletred: '#C71585',\n  midnightblue: '#191970',\n  mintcream: '#F5FFFA',\n  mistyrose: '#FFE4E1',\n  moccasin: '#FFE4B5',\n  navajowhite: '#FFDEAD',\n  navy: '#000080',\n  oldlace: '#FDF5E6',\n  olive: '#808000',\n  olivedrab: '#6B8E23',\n  orange: '#FFA500',\n  orangered: '#FF4500',\n  orchid: '#DA70D6',\n  palegoldenrod: '#EEE8AA',\n  palegreen: '#98FB98',\n  paleturquoise: '#AFEEEE',\n  palevioletred: '#DB7093',\n  papayawhip: '#FFEFD5',\n  peachpuff: '#FFDAB9',\n  peru: '#CD853F',\n  pink: '#FFC0CB',\n  plum: '#DDA0DD',\n  powderblue: '#B0E0E6',\n  purple: '#800080',\n  rebeccapurple: '#663399',\n  red: '#FF0000',\n  rosybrown: '#BC8F8F',\n  royalblue: '#4169E1',\n  saddlebrown: '#8B4513',\n  salmon: '#FA8072',\n  sandybrown: '#F4A460',\n  seagreen: '#2E8B57',\n  seashell: '#FFF5EE',\n  sienna: '#A0522D',\n  silver: '#C0C0C0',\n  skyblue: '#87CEEB',\n  slateblue: '#6A5ACD',\n  slategray: '#708090',\n  slategrey: '#708090',\n  snow: '#FFFAFA',\n  springgreen: '#00FF7F',\n  steelblue: '#4682B4',\n  tan: '#D2B48C',\n  teal: '#008080',\n  thistle: '#D8BFD8',\n  tomato: '#FF6347',\n  turquoise: '#40E0D0',\n  violet: '#EE82EE',\n  wheat: '#F5DEB3',\n  white: '#FFFFFF',\n  whitesmoke: '#F5F5F5',\n  yellow: '#FFFF00',\n  yellowgreen: '#9ACD32',\n}\n\nexport function namedColorToHex(name: string): string | undefined {\n  return colors[name]\n}\n\nexport function isNamedColor(name: string): boolean {\n  return !!colors[name]\n}\n","import {\n  darken,\n  emphasize as muiEmphasize,\n  getContrastRatio,\n  getLuminance as muiGetLuminance,\n  lighten,\n} from '@mui/material/styles'\n\nimport { namedColorToHex } from './cssColorsLevel4'\n\n/**\n * Algorithmically pick a contrasting text color that will\n * be visible on top of the given background color. Either\n * black or white.\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns 'black' or 'white'\n */\nexport function contrastingTextColor(color: string): string {\n  const luminance = getLuminance(color)\n  return luminance > 0.5 ? 'black' : 'white'\n}\n\n/**\n * The relative brightness of any point in a color space,\n * normalized to 0 for darkest black and 1 for lightest white.\n * Uses MUI's `getLuminance`, but adds support for named colors\n *\n * Formula: https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns The relative brightness of the color in the range 0 - 1\n */\nfunction getLuminance(color: string): number {\n  const convertedColor = namedColorToHex(color)\n  return muiGetLuminance(convertedColor || color)\n}\n\n/**\n * Darken or lighten a color, depending on its luminance.\n * Light colors are darkened, dark colors are lightened.\n * Uses MUI's `emphasize`, but adds support for named colors\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n * hsl(), hsla(), or named color\n * @param coefficient - multiplier in the range 0 - 1, defaults to 0.15\n * @returns A CSS color string. Hex input values are returned as rgb\n */\nexport function emphasize(color: string, coefficient = 0.15): string {\n  const convertedColor = namedColorToHex(color)\n  return muiEmphasize(convertedColor || color, coefficient)\n}\n\nexport function makeContrasting(\n  foreground: string,\n  background = 'white',\n  minContrastRatio = 3,\n) {\n  let convertedForeground = namedColorToHex(foreground) || foreground\n  const convertedBackground = namedColorToHex(background) || background\n  const backgroundLuminance = getLuminance(convertedBackground)\n  let contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  const originalColor = convertedForeground\n  let coefficient = 0.05\n  while (contrastRatio < minContrastRatio) {\n    convertedForeground =\n      backgroundLuminance > 0.5\n        ? darken(originalColor, coefficient)\n        : lighten(originalColor, coefficient)\n    coefficient += 0.05\n    contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  }\n  return convertedForeground\n}\n\nexport { isNamedColor, namedColorToHex } from './cssColorsLevel4'\n","import { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BlockSet } from '@jbrowse/core/util/blockTypes'\nimport type { IAnyStateTreeNode } from 'mobx-state-tree'\n\nexport async function getUniqueTags({\n  self,\n  tag,\n  blocks,\n  opts,\n}: {\n  self: IAnyStateTreeNode & { adapterConfig: AnyConfigurationModel }\n  tag: string\n  blocks: BlockSet\n  opts?: {\n    headers?: Record<string, string>\n    stopToken?: string\n    filters: string[]\n  }\n}) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n","import idMaker from '../util/idMaker'\n\nexport function adapterConfigCacheKey(conf: Record<string, unknown> = {}) {\n  return `${idMaker(conf)}`\n}\n","import uFuzzy from '@leeoniya/ufuzzy'\n\nimport { readConfObject } from '../configuration'\nimport QuickLRU from '../util/QuickLRU'\n\nimport type BaseResult from './BaseResults'\nimport type PluginManager from '../PluginManager'\nimport type { AnyConfigurationModel } from '../configuration'\nimport type {\n  BaseTextSearchAdapter,\n  BaseTextSearchArgs,\n} from '../data_adapters/BaseAdapter'\n\nexport interface SearchScope {\n  includeAggregateIndexes: boolean\n  assemblyName: string\n  tracks?: string[]\n}\n\nexport default class TextSearchManager {\n  adapterCache = new QuickLRU<string, BaseTextSearchAdapter>({\n    maxSize: 15,\n  })\n\n  constructor(public pluginManager: PluginManager) {}\n\n  loadTextSearchAdapters(searchScope: SearchScope) {\n    return Promise.all(\n      this.relevantAdapters(searchScope).map(async conf => {\n        const adapterId = readConfObject(conf, 'textSearchAdapterId')\n        const r = this.adapterCache.get(adapterId)\n        if (r) {\n          return r\n        } else {\n          const adapterType = this.pluginManager.getTextSearchAdapterType(\n            conf.type,\n          )!\n          const AdapterClass = await adapterType.getAdapterClass()\n          const adapterInstance = new AdapterClass(\n            conf,\n            undefined,\n            this.pluginManager,\n          ) as BaseTextSearchAdapter\n          this.adapterCache.set(adapterId, adapterInstance)\n          return adapterInstance\n        }\n      }),\n    )\n  }\n\n  relevantAdapters(searchScope: SearchScope) {\n    const rootModel = this.pluginManager.rootModel\n    const { aggregateTextSearchAdapters } = rootModel?.jbrowse as {\n      aggregateTextSearchAdapters: AnyConfigurationModel[]\n    }\n    const { tracks } = rootModel?.session as {\n      tracks: AnyConfigurationModel[]\n    }\n\n    const { assemblyName } = searchScope\n\n    return [\n      ...this.getAdaptersWithAssembly(\n        assemblyName,\n        aggregateTextSearchAdapters,\n      ),\n      ...this.getTrackAdaptersWithAssembly(assemblyName, tracks),\n    ]\n  }\n\n  getAdaptersWithAssembly(\n    assemblyName: string,\n    confs: AnyConfigurationModel[],\n  ) {\n    return confs.filter(c =>\n      readConfObject(c, 'assemblyNames')?.includes(assemblyName),\n    )\n  }\n\n  getTrackAdaptersWithAssembly(\n    assemblyName: string,\n    confs: AnyConfigurationModel[],\n  ) {\n    return confs\n      .filter(conf =>\n        readConfObject(conf, [\n          'textSearching',\n          'textSearchAdapter',\n          'assemblyNames',\n        ])?.includes(assemblyName),\n      )\n      .map(\n        conf => conf.textSearching.textSearchAdapter as AnyConfigurationModel,\n      )\n  }\n\n  /**\n   * legacy API for searching:\n   * Returns list of relevant results given a search query and options\n   */\n  async search(\n    args: BaseTextSearchArgs,\n    searchScope: SearchScope,\n    rankFn: (results: BaseResult[]) => BaseResult[],\n  ) {\n    return this.search2({ args, searchScope, rankFn })\n  }\n\n  /**\n   * modern API for searching:\n   * Returns list of relevant results given a search query and options\n   */\n  async search2({\n    args,\n    searchScope,\n    rankFn,\n  }: {\n    args: BaseTextSearchArgs\n    searchScope: SearchScope\n    rankFn: (results: BaseResult[]) => BaseResult[]\n  }) {\n    const adapters = await this.loadTextSearchAdapters(searchScope)\n    const results = await Promise.all(adapters.map(a => a.searchIndex(args)))\n\n    return this.sortResults2({\n      args,\n      results: results.flat(),\n      rankFn,\n    })\n  }\n\n  /**\n   * Returns array of revelevant and sorted results. Note: renamed to\n   * sortResults2 to accommodate new format\n   *\n   * @param results - array of results from all text search adapters\n   * @param rankFn - function that updates results scores\n   * based on more relevance\n   */\n  sortResults2({\n    results,\n    rankFn,\n    args,\n  }: {\n    results: BaseResult[]\n    args: BaseTextSearchArgs\n    rankFn: (results: BaseResult[]) => BaseResult[]\n  }) {\n    const uf = new uFuzzy({})\n\n    // does fuzzy matching on the 'display string'\n    const haystack = results.map(r => r.getDisplayString())\n\n    // this code sample relatively unmodified from\n    // https://github.com/leeoniya/uFuzzy?tab=readme-ov-file#example\n    const needle = args.queryString\n\n    // false positive, this is not Array.prototype.filter\n    // eslint-disable-next-line unicorn/no-array-method-this-argument\n    const idxs = uf.filter(haystack, needle)\n    const res = []\n\n    // idxs can be null when the needle is non-searchable (has no alpha-numeric chars)\n    if (idxs != null && idxs.length > 0) {\n      const info = uf.info(idxs, haystack, needle)\n\n      // order is a double-indirection array (a re-order of the passed-in idxs)\n      // this allows corresponding info to be grabbed directly by idx, if needed\n      const order = uf.sort(info, haystack, needle)\n\n      // render post-filtered & ordered matches\n      for (const element of order) {\n        // using info.idx here instead of idxs because uf.info() may have\n        // further reduced the initial idxs based on prefix/suffix rules\n        res.push(results[info.idx[element]!]!)\n      }\n    }\n    return rankFn(res)\n  }\n}\n","import { getFillProps } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\n// core\nimport { getCytobands } from './util'\nimport { HEADER_OVERVIEW_HEIGHT } from '../consts'\n\nimport type { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport type { ContentBlock } from '@jbrowse/core/util/blockTypes'\n\n// rounded rect from https://stackoverflow.com/a/45889603/2129219\nfunction rightRoundedRect(\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number,\n) {\n  return `M${x},${y}h${width - radius}a${radius},${radius} 0 0 1 ${radius},${radius}v${height - 2 * radius}a${radius},${radius} 0 0 1 ${-radius},${radius}h${radius - width}z`\n}\n\nfunction leftRoundedRect(\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number,\n) {\n  return `M${x + radius},${y}h${width - radius}v${height}h${radius - width}a${radius},${radius} 0 0 1 ${-radius},${-radius}v${2 * radius - height}a${radius},${radius} 0 0 1 ${radius},${-radius}z`\n}\n\nfunction leftTriangle(x: number, _y: number, width: number, height: number) {\n  return [\n    [x, 0],\n    [x + width, height / 2],\n    [x, height],\n  ].toString()\n}\n\nfunction rightTriangle(x: number, _y: number, width: number, height: number) {\n  return [\n    [x, height / 2],\n    [x + width, 0],\n    [x + width, height],\n  ].toString()\n}\n\nconst colorMap: Record<string, string> = {\n  gneg: 'rgb(227,227,227)',\n  gpos25: 'rgb(142,142,142)',\n  gpos50: 'rgb(85,85,85)',\n  gpos100: 'rgb(0,0,0)',\n  gpos75: 'rgb(57,57,57)',\n  gvar: 'rgb(0,0,0)',\n  stalk: 'rgb(127,127,127)',\n  acen: '#800',\n}\n\nconst Cytobands = observer(function ({\n  overview,\n  block,\n  assembly,\n}: {\n  overview: Base1DViewModel\n  assembly?: Assembly\n  block: ContentBlock\n}) {\n  const { offsetPx, reversed } = block\n  const cytobands = getCytobands(assembly, block.refName)\n  const lcap = reversed ? cytobands.length - 1 : 0\n  const rcap = reversed ? 0 : cytobands.length - 1\n\n  const h = HEADER_OVERVIEW_HEIGHT\n  let centromereSeen = false\n  let curr = ''\n  let idx = 0\n  return (\n    <g transform={`translate(-${offsetPx})`}>\n      {cytobands.map((args, index) => {\n        const k = JSON.stringify(args)\n        const { refName, name, type, start, end } = args\n        const s = overview.bpToPx({ refName, coord: start }) || 0\n        const e = overview.bpToPx({ refName, coord: end }) || 0\n        const l = Math.min(s, e)\n        const w = Math.abs(e - s)\n        if (type === 'n/a') {\n          const match = name?.match(/^(\\d+)([A-Za-z])/)\n          const ret = match[1] + match[2]\n          if (ret && ret !== curr) {\n            curr = ret\n            idx++\n          }\n        }\n        const c =\n          type === 'n/a'\n            ? idx % 2\n              ? 'black'\n              : '#a77'\n            : colorMap[type] || 'black'\n\n        if (type === 'acen' && !centromereSeen) {\n          centromereSeen = true // the next acen entry is drawn with different right triangle\n          return (\n            <polygon\n              key={k}\n              points={\n                reversed\n                  ? rightTriangle(s - w, 0, w, h)\n                  : leftTriangle(s, 0, w, h)\n              }\n              {...getFillProps(c)}\n            />\n          )\n        }\n        if (type === 'acen' && centromereSeen) {\n          return (\n            <polygon\n              key={k}\n              points={\n                reversed\n                  ? leftTriangle(s - w, 0, w, h)\n                  : rightTriangle(s, 0, w, h)\n              }\n              {...getFillProps(c)}\n            />\n          )\n        }\n        if (lcap === index) {\n          return (\n            <path\n              key={k}\n              d={leftRoundedRect(l, 0, w, h, 8)}\n              {...getFillProps(c)}\n            />\n          )\n        }\n        if (rcap === index) {\n          return (\n            <path\n              key={k}\n              d={rightRoundedRect(l, 0, w, h, 8)}\n              {...getFillProps(c)}\n            />\n          )\n        }\n        return (\n          <rect key={k} x={l} y={0} width={w} height={h} {...getFillProps(c)} />\n        )\n      })}\n    </g>\n  )\n})\n\nexport default Cytobands\n","import type {\n  BaseLayout,\n  RectTuple,\n  Rectangle,\n  SerializedLayout,\n} from './BaseLayout'\n\n/**\n * Rectangle-layout manager that lays out rectangles using bitmaps at\n * resolution that, for efficiency, may be somewhat lower than that of\n * the coordinate system for the rectangles being laid out.  `pitchX`\n * and `pitchY` are the ratios of input scale resolution to internal\n * bitmap resolution.\n */\n\n// minimum excess size of the array at which we garbage collect\nconst minSizeToBotherWith = 10000\nconst maxFeaturePitchWidth = 20000\n\nfunction segmentsIntersect(\n  x1: number,\n  x2: number,\n  y1: number,\n  y2: number,\n): boolean {\n  return x2 >= y1 && y2 >= x1\n}\n\ntype Bit<T> = Record<string, T> | string | undefined\n\ninterface RowState<T> {\n  min: number\n  max: number\n  offset: number\n  bits: Bit<T>[]\n}\n// a single row in the layout\nclass LayoutRow<T> {\n  private padding = 1\n\n  private allFilled?: Record<string, T> | string\n\n  private widthLimit = 1_000_000\n\n  private rowState?: RowState<T>\n\n  // this.rowState.bits is the array of items in the layout row, indexed by (x - this.offset)\n  // this.rowState.min is the leftmost edge of all the rectangles we have in the layout\n  // this.rowState.max is the rightmost edge of all the rectangles we have in the layout\n  // this.rowState.offset is the offset of the bits array relative to the genomic coordinates\n  //      (modified by pitchX, but we don't know that in this class)\n\n  setAllFilled(data: Record<string, T> | string): void {\n    this.allFilled = data\n  }\n\n  getItemAt(x: number): Record<string, T> | string | undefined {\n    if (this.allFilled) {\n      return this.allFilled\n    }\n    if (\n      this.rowState?.min === undefined ||\n      x < this.rowState.min ||\n      x >= this.rowState.max\n    ) {\n      return undefined\n    }\n    return this.rowState.bits[x - this.rowState.offset]\n  }\n\n  isRangeClear(left: number, right: number) {\n    if (this.allFilled) {\n      return false\n    }\n\n    if (\n      this.rowState === undefined ||\n      right <= this.rowState.min ||\n      left >= this.rowState.max\n    ) {\n      return true\n    }\n    const { min, max, offset, bits } = this.rowState\n\n    const maxX = Math.min(max, right) - offset\n    let flag = true\n    for (let x = Math.max(min, left) - offset; x < maxX && flag; x++) {\n      flag = bits[x] === undefined\n    }\n\n    return flag\n  }\n\n  // NOTE: this.rowState.min, this.rowState.max, and this.rowState.offset are\n  // interbase coordinates\n  initialize(left: number, right: number): RowState<T> {\n    const rectWidth = right - left\n    return {\n      offset: left - rectWidth,\n      min: left,\n      max: right,\n      bits: Array.from({ length: 3 * rectWidth }),\n    }\n  }\n\n  addRect(rect: Rectangle<T>, data: Record<string, T> | string): void {\n    const left = rect.l\n    const right = rect.r + this.padding // only padding on the right\n    if (!this.rowState) {\n      this.rowState = this.initialize(left, right)\n    }\n\n    // or check if we need to expand to the left and/or to the right\n    let oLeft = left - this.rowState.offset\n    let oRight = right - this.rowState.offset\n    const currLength = this.rowState.bits.length\n\n    // expand rightward if necessary\n    if (oRight >= this.rowState.bits.length) {\n      const additionalLength = oRight + 1\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n        this.rowState = this.initialize(left, right)\n      } else if (additionalLength > 0) {\n        this.rowState.bits = [\n          ...this.rowState.bits,\n          ...Array.from<Bit<T>>({ length: additionalLength }),\n        ]\n      }\n    }\n\n    // expand leftward if necessary\n    if (left < this.rowState.offset) {\n      // use math.min to avoid negative lengths\n      const additionalLength = Math.min(\n        currLength - oLeft,\n        this.rowState.offset,\n      )\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n\n        this.rowState = this.initialize(left, right)\n      } else {\n        this.rowState.bits = [\n          ...Array.from<Bit<T>>({ length: additionalLength }),\n          ...this.rowState.bits,\n        ]\n        this.rowState.offset -= additionalLength\n      }\n    }\n    oRight = right - this.rowState.offset\n    oLeft = left - this.rowState.offset\n    const w = oRight - oLeft\n\n    if (w > maxFeaturePitchWidth) {\n      console.warn(\n        `Layout X pitch set too low, feature spans ${w} bits in a single row.`,\n        rect,\n        data,\n      )\n    }\n\n    for (let x = oLeft; x < oRight; x += 1) {\n      this.rowState.bits[x] = data\n    }\n\n    if (left < this.rowState.min) {\n      this.rowState.min = left\n    }\n    if (right > this.rowState.max) {\n      this.rowState.max = right\n    }\n  }\n\n  /**\n   *  Given a range of interbase coordinates, deletes all data dealing with that range\n   */\n  discardRange(left: number, right: number): void {\n    if (this.allFilled) {\n      return\n    } // allFilled is irrevocable currently\n\n    // if we have no data, do nothing\n    if (!this.rowState) {\n      return\n    }\n\n    // if doesn't overlap at all, do nothing\n    if (right <= this.rowState.min || left >= this.rowState.max) {\n      return\n    }\n\n    // if completely encloses range, discard everything\n    if (left <= this.rowState.min && right >= this.rowState.max) {\n      this.rowState = undefined\n      return\n    }\n\n    // if overlaps left edge, adjust the min\n    if (right > this.rowState.min && left <= this.rowState.min) {\n      this.rowState.min = right\n    }\n\n    // if overlaps right edge, adjust the max\n    if (left < this.rowState.max && right >= this.rowState.max) {\n      this.rowState.max = left\n    }\n\n    // now trim the left, right, or both sides of the array\n    if (\n      this.rowState.offset < this.rowState.min - minSizeToBotherWith &&\n      this.rowState.bits.length >\n        this.rowState.max + minSizeToBotherWith - this.rowState.offset\n    ) {\n      // trim both sides\n      const leftTrimAmount = this.rowState.min - this.rowState.offset\n      const rightTrimAmount =\n        this.rowState.bits.length -\n        1 -\n        (this.rowState.max - this.rowState.offset)\n      // if (rightTrimAmount <= 0) debugger\n      // if (leftTrimAmount <= 0) debugger\n      // this.log(`trim both sides, ${leftTrimAmount} from left, ${rightTrimAmount} from right`)\n      this.rowState.bits = this.rowState.bits.slice(\n        leftTrimAmount,\n        this.rowState.bits.length - rightTrimAmount,\n      )\n      this.rowState.offset += leftTrimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (this.rowState.offset < this.rowState.min - minSizeToBotherWith) {\n      // trim left side\n      const desiredOffset =\n        this.rowState.min - Math.floor(minSizeToBotherWith / 2)\n      const trimAmount = desiredOffset - this.rowState.offset\n      // this.log(`trim left side by ${trimAmount}`)\n      this.rowState.bits.splice(0, trimAmount)\n      this.rowState.offset += trimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (\n      this.rowState.bits.length >\n      this.rowState.max - this.rowState.offset + minSizeToBotherWith\n    ) {\n      // trim right side\n      const desiredLength =\n        this.rowState.max -\n        this.rowState.offset +\n        1 +\n        Math.floor(minSizeToBotherWith / 2)\n      // this.log(`trim right side by ${this.rowState.bits.length-desiredLength}`)\n      // if (desiredLength > this.rowState.bits.length) debugger\n      this.rowState.bits.length = desiredLength\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    }\n\n    // if (this.rowState.offset > this.rowState.min) debugger\n    // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n\n    // if range now enclosed in the new bounds, loop through and clear the bits\n    const oLeft = Math.max(this.rowState.min, left) - this.rowState.offset\n    // if (oLeft < 0) debugger\n    // if (oLeft >= this.rowState.bits.length) debugger\n    // if (oRight < 0) debugger\n    // if (oRight >= this.rowState.bits.length) debugger\n\n    const oRight = Math.min(right, this.rowState.max) - this.rowState.offset\n    for (let x = oLeft; x >= 0 && x < oRight; x += 1) {\n      this.rowState.bits[x] = undefined\n    }\n  }\n}\n\nexport default class GranularRectLayout<T> implements BaseLayout<T> {\n  private pitchX: number\n\n  private pitchY: number\n\n  private hardRowLimit: number\n\n  private bitmap: LayoutRow<T>[]\n\n  private rectangles: Map<string, Rectangle<T>>\n\n  public maxHeightReached: boolean\n\n  private maxHeight: number\n\n  private displayMode: string\n\n  private pTotalHeight: number\n\n  /**\n   * pitchX - layout grid pitch in the X direction\n   * pitchY - layout grid pitch in the Y direction\n   * maxHeight - maximum layout height, default Infinity (no max)\n   */\n  constructor({\n    pitchX = 10,\n    pitchY = 10,\n    maxHeight = 10000,\n    hardRowLimit = 10000,\n    displayMode = 'normal',\n  }: {\n    pitchX?: number\n    pitchY?: number\n    maxHeight?: number\n    displayMode?: string\n    hardRowLimit?: number\n  } = {}) {\n    this.pitchX = pitchX\n    this.pitchY = pitchY\n    this.hardRowLimit = hardRowLimit\n    this.maxHeightReached = false\n    this.displayMode = displayMode\n\n    // reduce the pitchY to try and pack the features tighter\n    if (this.displayMode === 'compact') {\n      this.pitchY = Math.round(this.pitchY / 4) || 1\n      this.pitchX = Math.round(this.pitchX / 4) || 1\n    }\n\n    this.bitmap = []\n    this.rectangles = new Map()\n    this.maxHeight = Math.ceil(maxHeight / this.pitchY)\n    this.pTotalHeight = 0 // total height, in units of bitmap squares (px/pitchY)\n  }\n\n  /**\n   * @returns top position for the rect, or Null if laying\n   *  out the rect would exceed maxHeight\n   */\n  addRect(\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data?: T,\n  ): number | null {\n    // if we have already laid it out, return its layout\n    const storedRec = this.rectangles.get(id)\n    if (storedRec) {\n      if (storedRec.top === null) {\n        return null\n      }\n\n      // add it to the bitmap again, since that bitmap range may have been\n      // discarded\n      this.addRectToBitmap(storedRec)\n      return storedRec.top * this.pitchY\n    }\n\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const pHeight = Math.ceil(height / this.pitchY)\n\n    const rectangle: Rectangle<T> = {\n      id,\n      l: pLeft,\n      r: pRight,\n      top: null,\n      h: pHeight,\n      originalHeight: height,\n      data,\n    }\n\n    const maxTop = this.maxHeight - pHeight\n    let top = 0\n    if (this.displayMode !== 'collapse') {\n      for (; top <= maxTop; top += 1) {\n        if (!this.collides(rectangle, top)) {\n          break\n        }\n      }\n\n      if (top > maxTop) {\n        rectangle.top = null\n        this.rectangles.set(id, rectangle)\n        this.maxHeightReached = true\n        return null\n      }\n    }\n    rectangle.top = top\n    this.addRectToBitmap(rectangle)\n    this.rectangles.set(id, rectangle)\n    this.pTotalHeight = Math.max(this.pTotalHeight || 0, top + pHeight)\n    return top * this.pitchY\n  }\n\n  collides(rect: Rectangle<T>, top: number) {\n    const { bitmap } = this\n\n    const maxY = top + rect.h\n    for (let y = top; y < maxY; y += 1) {\n      const row = bitmap[y]\n      if (row !== undefined && !row.isRangeClear(rect.l, rect.r)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * make a subarray if it does not exist\n   */\n  private autovivifyRow(bitmap: LayoutRow<T>[], y: number) {\n    let row = bitmap[y]\n    if (!row) {\n      if (y > this.hardRowLimit) {\n        throw new Error(\n          `layout hard limit (${\n            this.hardRowLimit * this.pitchY\n          }px) exceeded, aborting layout`,\n        )\n      }\n      row = new LayoutRow()\n      bitmap[y] = row\n    }\n    return row\n  }\n\n  addRectToBitmap(rect: Rectangle<T>) {\n    if (rect.top === null) {\n      return\n    }\n\n    const data = rect.id\n    const yEnd = rect.top + rect.h\n    if (rect.r - rect.l > maxFeaturePitchWidth) {\n      // the rect is very big in relation to the view size, just pretend, for\n      // the purposes of layout, that it extends infinitely.  this will cause\n      // weird layout if a user scrolls manually for a very, very long time\n      // along the genome at the same zoom level.  but most users will not do\n      // that.  hopefully.\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).setAllFilled(data)\n      }\n    } else {\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).addRect(rect, data)\n      }\n    }\n  }\n\n  /**\n   *  Given a range of X coordinates, deletes all data dealing with\n   *  the features.\n   */\n  discardRange(left: number, right: number) {\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const { bitmap } = this\n    for (const row of bitmap) {\n      row.discardRange(pLeft, pRight)\n    }\n  }\n\n  hasSeen(id: string) {\n    return this.rectangles.has(id)\n  }\n\n  getByCoord(x: number, y: number) {\n    const pY = Math.floor(y / this.pitchY)\n    const row = this.bitmap[pY]\n    if (!row) {\n      return undefined\n    }\n    const pX = Math.floor(x / this.pitchX)\n    return row.getItemAt(pX)\n  }\n\n  getByID(id: string) {\n    const r = this.rectangles.get(id)\n    if (r) {\n      const t = r.top! * this.pitchY\n      return [\n        r.l * this.pitchX,\n        t,\n        r.r * this.pitchX,\n        t + r.originalHeight,\n      ] as RectTuple\n    }\n\n    return undefined\n  }\n\n  getDataByID(id: string) {\n    return this.rectangles.get(id)?.data\n  }\n\n  cleanup() {}\n\n  getTotalHeight() {\n    return this.pTotalHeight * this.pitchY\n  }\n\n  get totalHeight() {\n    return this.getTotalHeight()\n  }\n\n  getRectangles(): Map<string, RectTuple> {\n    return new Map(\n      [...this.rectangles.entries()].map(([id, rect]) => {\n        const { l, r, originalHeight, top } = rect\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        return [id, [l * this.pitchX, t, r * this.pitchX, b]] // left, top, right, bottom\n      }),\n    )\n  }\n\n  serializeRegion(region: { start: number; end: number }): SerializedLayout {\n    const regionRectangles: Record<string, RectTuple> = {}\n    let maxHeightReached = false\n    for (const [id, rect] of this.rectangles.entries()) {\n      const { l, r, originalHeight, top } = rect\n      if (rect.top === null) {\n        maxHeightReached = true\n      } else {\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        const y1 = l * this.pitchX\n        const y2 = r * this.pitchX\n        const x1 = region.start\n        const x2 = region.end\n        // add +/- pitchX to avoid resolution causing errors\n        if (segmentsIntersect(x1, x2, y1 - this.pitchX, y2 + this.pitchX)) {\n          regionRectangles[id] = [y1, t, y2, b]\n        }\n      }\n    }\n    return {\n      rectangles: regionRectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached,\n    }\n  }\n\n  toJSON(): SerializedLayout {\n    const rectangles = Object.fromEntries(this.getRectangles())\n    return {\n      rectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached: this.maxHeightReached,\n    }\n  }\n}\n","import { forEachWithStopTokenCheck, sum } from '@jbrowse/core/util'\n\nimport type { Feature } from '@jbrowse/core/util'\n\nexport function findSecondLargestNumber(arr: Iterable<number>) {\n  let firstMax = 0\n  let secondMax = 0\n\n  for (const num of arr) {\n    if (num > firstMax) {\n      secondMax = firstMax\n      firstMax = num\n    } else if (num > secondMax && num !== firstMax) {\n      secondMax = num\n    }\n  }\n\n  return secondMax\n}\n\nexport function calculateAlleleCounts(feat: Feature) {\n  const genotypes = feat.get('genotypes') as Record<string, string>\n  const alleleCounts = { 0: 0, 1: 0, '.': 0 } as Record<string, number>\n  const cacheSplit = {} as Record<string, string[]>\n  const vals = Object.values(genotypes)\n  const len = vals.length\n  for (let i = 0; i < len; i++) {\n    const genotype = vals[i]!\n    const alleles =\n      cacheSplit[genotype] || (cacheSplit[genotype] = genotype.split(/[/|]/))\n\n    for (let i = 0, len = alleles.length; i < len; i++) {\n      const a = alleles[i]!\n      alleleCounts[a] = (alleleCounts[a] ?? 0) + 1\n    }\n  }\n\n  return alleleCounts\n}\n\nexport function calculateMinorAlleleFrequency(\n  alleleCounts: Record<string, number>,\n) {\n  return (\n    findSecondLargestNumber(Object.values(alleleCounts)) /\n    (sum(Object.values(alleleCounts)) || 1)\n  )\n}\n\nfunction getMostFrequentAlt(alleleCounts: Record<string, number>) {\n  let mostFrequentAlt\n  let max = 0\n  for (const [alt, altCount] of Object.entries(alleleCounts)) {\n    if (alt !== '.' && alt !== '0') {\n      if (altCount > max) {\n        mostFrequentAlt = alt\n        max = altCount\n      }\n    }\n  }\n  return mostFrequentAlt\n}\n\nexport function getFeaturesThatPassMinorAlleleFrequencyFilter({\n  features,\n  minorAlleleFrequencyFilter,\n  lengthCutoffFilter,\n  stopToken,\n}: {\n  features: Iterable<Feature>\n  minorAlleleFrequencyFilter: number\n  lengthCutoffFilter: number\n  stopToken?: string\n}) {\n  const results = [] as {\n    feature: Feature\n    mostFrequentAlt: string\n    alleleCounts: Record<string, number>\n  }[]\n  forEachWithStopTokenCheck(features, stopToken, feature => {\n    if (feature.get('end') - feature.get('start') <= lengthCutoffFilter) {\n      const alleleCounts = calculateAlleleCounts(feature)\n      if (\n        calculateMinorAlleleFrequency(alleleCounts) >=\n        minorAlleleFrequencyFilter\n      ) {\n        results.push({\n          feature,\n          mostFrequentAlt: getMostFrequentAlt(alleleCounts)!,\n          alleleCounts,\n        })\n      }\n    }\n  })\n\n  return results\n}\n","import { autorun } from 'mobx'\nimport { addDisposer, isAlive } from 'mobx-state-tree'\nimport { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport type { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { AugmentedRegion, Feature } from '@jbrowse/core/util'\nimport type { IAutorunOptions } from 'mobx'\nimport type { IAnyStateTreeNode } from 'mobx-state-tree'\n\n// use fallback alt tag, used in situations where upper case/lower case tags\n// exist e.g. Mm/MM for base modifications\nexport function getTagAlt(feature: Feature, tag: string, alt: string) {\n  const tags = feature.get('tags')\n  return tags[tag] ?? tags[alt]\n}\n\n// orientation definitions from igv.js, see also\n// https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\nexport const orientationTypes = {\n  fr: {\n    F1R2: 'LR',\n    F2R1: 'LR',\n\n    F1F2: 'LL',\n    F2F1: 'LL',\n\n    R1R2: 'RR',\n    R2R1: 'RR',\n\n    R1F2: 'RL',\n    R2F1: 'RL',\n  } as Record<string, string>,\n\n  rf: {\n    R1F2: 'LR',\n    R2F1: 'LR',\n\n    R1R2: 'LL',\n    R2R1: 'LL',\n\n    F1F2: 'RR',\n    F2F1: 'RR',\n\n    F1R2: 'RL',\n    F2R1: 'RL',\n  } as Record<string, string>,\n\n  ff: {\n    F2F1: 'LR',\n    R1R2: 'LR',\n\n    F2R1: 'LL',\n    R1F2: 'LL',\n\n    R2F1: 'RR',\n    F1R2: 'RR',\n\n    R2R1: 'RL',\n    F1F2: 'RL',\n  } as Record<string, string>,\n}\n\nexport const pairMap = {\n  LR: 'color_pair_lr',\n  LL: 'color_pair_ll',\n  RR: 'color_pair_rr',\n  RL: 'color_pair_rl',\n} as const\n\nexport function getColorWGBS(strand: number, base: string) {\n  if (strand === 1) {\n    if (base === 'C') {\n      return '#f00'\n    }\n    if (base === 'T') {\n      return '#00f'\n    }\n  } else if (strand === -1) {\n    if (base === 'G') {\n      return '#f00'\n    }\n    if (base === 'A') {\n      return '#00f'\n    }\n  }\n  return '#888'\n}\n\nexport async function fetchSequence(\n  region: AugmentedRegion,\n  adapter: BaseFeatureDataAdapter,\n) {\n  const { start, end, originalRefName, refName } = region\n\n  const feats = await firstValueFrom(\n    adapter\n      .getFeatures({\n        ...region,\n        refName: originalRefName || refName,\n        end,\n        start,\n      })\n      .pipe(toArray()),\n  )\n  return feats[0]?.get('seq')\n}\n\ninterface ModificationData {\n  color: string\n  name: string\n}\n\n// adapted from IGV\n// https://github.com/igvteam/igv/blob/af07c3b1be8806cfd77343ee04982aeff17d2beb/src/main/resources/org/broad/igv/prefs/preferences.tab#L230-L242\nexport const modificationData = {\n  m: { color: 'rgb(255,0,0)', name: '5mC' },\n  h: { color: 'rgb(255,0,255)', name: '5hmC' },\n  o: { color: 'rgb(111, 78, 129)', name: '8oxoG' },\n  f: { color: 'rgb(246, 200, 95)', name: '5fC' },\n  c: { color: 'rgb(157, 216, 102)', name: '5cac' },\n  g: { color: 'rgb(255, 160, 86)', name: '5hmu' },\n  e: { color: 'rgb(141, 221, 208)', name: '5fU' },\n  b: { color: 'rgb(0,100,47)', name: '5caU' },\n  a: { color: 'rgb(51,0,111)', name: '6mA' },\n  17082: { color: 'rgb(51,153,255)', name: 'pseU' },\n  17596: { color: 'rgb(102,153,0)', name: 'inosine' },\n  21839: { color: 'rgb(153,0,153)', name: '4mC' },\n} as Record<string, ModificationData>\n\ntype DisplayModel = IAnyStateTreeNode & { setError: (arg: unknown) => void }\n\nexport function createAutorun(\n  self: DisplayModel,\n  cb: () => Promise<void>,\n  opts?: IAutorunOptions,\n) {\n  addDisposer(\n    self,\n    autorun(async () => {\n      try {\n        await cb()\n      } catch (e) {\n        if (isAlive(self)) {\n          self.setError(e)\n        }\n      }\n    }, opts),\n  )\n}\n\nexport function randomColor(str: string) {\n  let sum = 0\n\n  for (let i = 0; i < str.length; i++) {\n    sum += str.charCodeAt(i)\n  }\n  return `hsl(${sum * 10}, 20%, 50%)`\n}\n\nexport function getColorForModification(str: string) {\n  return modificationData[str]?.color || randomColor(str)\n}\n","import { extend } from 'colord'\nimport mix from 'colord/plugins/mix'\nimport names from 'colord/plugins/names'\nextend([mix, names])\n\nexport { Colord, colord } from 'colord'\n","import MultiLayout from './MultiLayout'\nimport PrecomputedLayout from './PrecomputedLayout'\n\nclass ThrowingLayout {\n  constructor() {\n    throw new Error('invalid layout name')\n  }\n}\n\nexport default class PrecomputedMultiLayout extends MultiLayout {\n  constructor(json) {\n    // use ThrowingLayout because there is not supposed to be any creation\n    // of new layouts in a precomputed layout\n    super(ThrowingLayout)\n    for (const [layoutName, sublayoutJson] of Object.entries(json)) {\n      this.subLayouts.set(layoutName, new PrecomputedLayout(sublayoutJson))\n    }\n  }\n}\n","interface AbsoluteCache {\n  dirty: boolean\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n  width?: number\n  height?: number\n}\n\nexport default class SceneGraph {\n  private children: Map<string, SceneGraph>\n\n  private absoluteCache: AbsoluteCache\n\n  public parent?: SceneGraph\n\n  /**\n   * note: all coordinates are inter-base or inter-pixel coordinates\n   */\n  constructor(\n    public name: string,\n    public left: number,\n    public top: number,\n    public width: number,\n    public height: number,\n\n    public data?: Record<string, any>,\n  ) {\n    this.children = new Map()\n    this.absoluteCache = { dirty: true }\n  }\n\n  addChild(\n    nameOrSceneGraph: string | SceneGraph,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n\n    data?: Record<string, any>,\n  ) {\n    const child =\n      nameOrSceneGraph instanceof SceneGraph\n        ? nameOrSceneGraph\n        : new SceneGraph(nameOrSceneGraph, left, top, width, height, data)\n\n    if (!(child instanceof SceneGraph)) {\n      throw new TypeError(\n        'argument to addChild must be an array or a SceneGraph',\n      )\n    }\n\n    if (this.children.has(child.name)) {\n      throw new Error(`child named \"${child.name}\" already exists`)\n    }\n\n    // update the bounds to match the child\n    child.parent = this\n    const {\n      left: childLeft,\n      right: childRight,\n      top: childTop,\n      bottom: childBottom,\n    } = child.absolute\n    if (\n      childLeft !== undefined &&\n      childRight !== undefined &&\n      childTop !== undefined &&\n      childBottom !== undefined\n    ) {\n      this.expand(childLeft, childRight, childTop, childBottom)\n      this.children.set(child.name, child)\n    }\n    return child\n  }\n\n  getSubRecord(name: string) {\n    return this.children.get(name)\n  }\n\n  /**\n   * if the record does not already cover the given absolute extents, extend it\n   * to cover them\n   *\n   * @param left -\n   * @param right -\n   * @param top -\n   * @param bottom -\n   */\n  expand(newLeft: number, newRight: number, newTop: number, newBottom: number) {\n    const { left, right, top, bottom } = this.absolute\n\n    if (left !== undefined && newLeft < left) {\n      const diff = left - newLeft\n      this.width += diff\n      this.left -= diff\n    }\n    if (right !== undefined && newRight > right) {\n      this.width += newRight - right\n    }\n    if (top !== undefined && newTop < top) {\n      const diff = top - newTop\n      this.height += diff\n      this.top -= diff\n    }\n    if (bottom !== undefined && newBottom > bottom) {\n      this.height += newBottom - bottom\n    }\n    if (this.parent) {\n      this.parent.expand(newLeft, newRight, newTop, newBottom)\n    }\n    this.absoluteCache.dirty = true\n  }\n\n  get bottom() {\n    return this.top + this.height\n  }\n\n  get right() {\n    return this.left + this.width\n  }\n\n  walkParents(callback: (arg: SceneGraph) => void) {\n    if (this.parent) {\n      callback(this.parent)\n      this.parent.walkParents(callback)\n    }\n  }\n\n  walkChildren(callback: (c: SceneGraph) => void) {\n    for (const sub of this.children.values()) {\n      callback(sub)\n      sub.walkChildren(callback)\n    }\n  }\n\n  get absolute() {\n    if (this.absoluteCache.dirty) {\n      let xOffset = 0\n      let yOffset = 0\n      this.walkParents((node: SceneGraph) => {\n        xOffset += node.left\n        yOffset += node.top\n      })\n      this.absoluteCache = {\n        dirty: false,\n        left: this.left + xOffset,\n        right: this.right + xOffset,\n        top: this.top + yOffset,\n        bottom: this.bottom + yOffset,\n        width: this.width,\n        height: this.height,\n      }\n    }\n    return this.absoluteCache\n  }\n\n  move(x: number, y: number) {\n    this.left += x\n    this.top += y\n\n    this.absoluteCache.dirty = true\n    this.walkChildren(c => {\n      c.absoluteCache.dirty = true\n    })\n    const { left, right, top, bottom } = this.absolute\n    if (\n      left !== undefined &&\n      right !== undefined &&\n      top !== undefined &&\n      bottom !== undefined\n    ) {\n      this.expand(left, right, top, bottom)\n    }\n  }\n}\n","import { Suspense } from 'react'\n\nimport BaseTooltip from '@jbrowse/core/ui/BaseTooltip'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport { YSCALEBAR_LABEL_OFFSET } from './util'\n\nimport type { Feature } from '@jbrowse/core/util'\n\nconst useStyles = makeStyles()({\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: YSCALEBAR_LABEL_OFFSET,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n})\n\ntype Coord = [number, number]\n\n// forwardRef component for the tooltip, the ref is used for measuring\n// the size of the tooltip\nexport type TooltipContentsComponent = React.ForwardRefExoticComponent<\n  { feature: Feature; model: any } & React.RefAttributes<HTMLDivElement>\n>\n\nconst Tooltip = observer(function Tooltip({\n  model,\n  height,\n  clientMouseCoord,\n  offsetMouseCoord,\n  clientRect,\n  TooltipContents,\n  useClientY,\n}: {\n  model: { featureUnderMouse?: Feature }\n  useClientY?: boolean\n  height: number\n  clientMouseCoord: Coord\n  offsetMouseCoord: Coord\n  clientRect?: DOMRect\n  TooltipContents: TooltipContentsComponent\n}) {\n  const { featureUnderMouse } = model\n  const { classes } = useStyles()\n\n  const x = clientMouseCoord[0] + 5\n  const y = useClientY ? clientMouseCoord[1] : clientRect?.top || 0\n  return featureUnderMouse ? (\n    <>\n      <Suspense fallback={null}>\n        <BaseTooltip clientPoint={{ x, y }}>\n          <TooltipContents model={model} feature={featureUnderMouse} />\n        </BaseTooltip>\n      </Suspense>\n\n      <div\n        className={classes.hoverVertical}\n        style={{\n          left: offsetMouseCoord[0],\n          height: height - YSCALEBAR_LABEL_OFFSET * 2,\n        }}\n      />\n    </>\n  ) : null\n})\n\nexport default Tooltip\n","import { getSnapshot, isStateTreeNode } from 'mobx-state-tree'\n\nimport { assembleLocStringFast } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\n\nimport type { Region } from './types'\nimport type { Region as RegionModel } from './types/mst'\nimport type { Instance } from 'mobx-state-tree'\n\nexport interface Base1DViewModel {\n  offsetPx: number\n  width: number\n  displayedRegions: (Region | Instance<typeof RegionModel>)[]\n  bpPerPx: number\n  minimumBlockWidth: number\n  interRegionPaddingWidth: number\n}\n\nexport default function calculateStaticBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n  extra = 0,\n  width = 800,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n    width: modelWidth,\n  } = model\n\n  const windowLeftBp = offsetPx * bpPerPx\n  const windowRightBp = (offsetPx + modelWidth) * bpPerPx\n  const blockSizePx = width\n  const blockSizeBp = Math.ceil(blockSizePx * bpPerPx)\n  // for each displayed region\n  let regionBpOffset = 0\n  const blocks = new BlockSet()\n  for (\n    let regionNumber = 0;\n    regionNumber < displayedRegions.length;\n    regionNumber++\n  ) {\n    const region = displayedRegions[regionNumber]!\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n\n    const regionBlockCount = Math.ceil((regionEnd - regionStart) / blockSizeBp)\n    const parentRegion = isStateTreeNode(region) ? getSnapshot(region) : region\n\n    let windowRightBlockNum =\n      Math.floor((windowRightBp - regionBpOffset) / blockSizeBp) + extra\n    if (windowRightBlockNum >= regionBlockCount) {\n      windowRightBlockNum = regionBlockCount - 1\n    }\n\n    let windowLeftBlockNum =\n      Math.floor((windowLeftBp - regionBpOffset) / blockSizeBp) - extra\n    if (windowLeftBlockNum < 0) {\n      windowLeftBlockNum = 0\n    }\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    for (\n      let blockNum = windowLeftBlockNum;\n      blockNum <= windowRightBlockNum;\n      blockNum += 1\n    ) {\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      if (reversed) {\n        start = Math.max(regionStart, regionEnd - (blockNum + 1) * blockSizeBp)\n        end = regionEnd - blockNum * blockSizeBp\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n      } else {\n        start = regionStart + blockNum * blockSizeBp\n        end = Math.min(regionEnd, regionStart + (blockNum + 1) * blockSizeBp)\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: (regionBpOffset + blockNum * blockSizeBp) / bpPerPx,\n        parentRegion,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocStringFast(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && regionNumber === 0 && blockNum === 0) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: width,\n            offsetPx: blockData.offsetPx - width,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n        }\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    regionBpOffset += regionEnd - regionStart\n  }\n  return blocks\n}\n","import type { Dotplot1DViewModel } from '../model'\nimport type { BaseBlock } from '@jbrowse/core/util/blockTypes'\n\nexport function locstr(\n  px: number,\n  view: Dotplot1DViewModel,\n  includeAsm = true,\n) {\n  const { assemblyName, refName, start, offset, oob } = view.pxToBp(px)\n  const coord = Math.floor(start + offset)\n  return oob\n    ? 'out of bounds'\n    : `${\n        includeAsm ? `{${assemblyName}}` : ''\n      }${refName}:${coord.toLocaleString('en-US')}`\n}\n\nexport function getBlockLabelKeysToHide(\n  blocks: BaseBlock[],\n  length: number,\n  viewOffsetPx: number,\n) {\n  const blockLabelKeysToHide = new Set<string>()\n  const sortedBlocks = [...blocks].sort((a, b) => {\n    const alen = a.end - a.start\n    const blen = b.end - b.start\n    return blen - alen\n  })\n  const positions = Array.from({ length: Math.round(length) })\n  for (const { key, offsetPx } of sortedBlocks) {\n    const y = Math.round(length - offsetPx + viewOffsetPx)\n    const labelBounds = [Math.max(y - 12, 0), y]\n    if (y === 0 || positions.slice(...labelBounds).some(Boolean)) {\n      blockLabelKeysToHide.add(key)\n    } else {\n      positions.fill(true, ...labelBounds)\n    }\n  }\n  return blockLabelKeysToHide\n}\n/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = +Number(minMajorPitchBp)\n    .toExponential()\n    .split(/e/i)[1]!\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  regions: BaseBlock[],\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const ticks = []\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  for (const { start, end, refName } of regions) {\n    let index = 0\n\n    const minBase = start\n    const maxBase = end\n\n    for (\n      let base = Math.floor(minBase / iterPitch) * iterPitch;\n      base < Math.ceil(maxBase / iterPitch) * iterPitch + 1;\n      base += iterPitch\n    ) {\n      if (emitMinor && base % gridPitch.majorPitch) {\n        ticks.push({ type: 'minor', base: base - 1, index, refName })\n        index += 1\n      } else if (emitMajor && Math.abs(base - start) > gridPitch.minorPitch) {\n        ticks.push({ type: 'major', base: base - 1, index, refName })\n        index += 1\n      }\n    }\n  }\n  return ticks\n}\n","import { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { Axis, LEFT, RIGHT } from 'react-d3-axis-mod'\n\nimport type { axisPropsFromTickScale } from 'react-d3-axis-mod'\n\ntype Ticks = ReturnType<typeof axisPropsFromTickScale>\n\nconst YScaleBar = observer(function ({\n  model,\n  orientation,\n}: {\n  model: { ticks?: Ticks }\n  orientation?: string\n}) {\n  const { ticks } = model\n  const theme = useTheme()\n  return ticks ? (\n    <Axis\n      {...ticks}\n      shadow={2}\n      format={(n: number) => n}\n      style={{ orient: orientation === 'left' ? LEFT : RIGHT }}\n      bg={theme.palette.background.default}\n      fg={theme.palette.text.primary}\n    />\n  ) : null\n})\n\nexport default YScaleBar\n","import { colord } from '@jbrowse/core/util/colord'\n\nimport type { ChainData } from './fetchChains'\n\nexport function hasPairedReads(features: ChainData) {\n  for (const f of features.chains.values()) {\n    if (f[0]!.flags & 1) {\n      return true\n    }\n  }\n  return false\n}\n\nexport function alphaColor(baseColor: string, p: number) {\n  return p !== 1\n    ? colord(baseColor)\n        .alpha(Math.min(1, p * p + 0.1))\n        .toHslString()\n    : baseColor\n}\n\nexport const defaultFilterFlags = {\n  flagInclude: 0,\n  flagExclude: 1540,\n}\nexport const negFlags = {\n  flagInclude: 16,\n  flagExclude: 1540,\n}\nexport const posFlags = {\n  flagInclude: 0,\n  flagExclude: 1556,\n}\n\nexport function cacheGetter<T>(ctor: { prototype: T }, prop: keyof T): void {\n  const desc = Object.getOwnPropertyDescriptor(ctor.prototype, prop)!\n  const getter = desc.get!\n  Object.defineProperty(ctor.prototype, prop, {\n    get() {\n      const ret = getter.call(this)\n      Object.defineProperty(this, prop, { value: ret })\n      return ret\n    },\n  })\n}\n\nexport function filterReadFlag(\n  flags: number,\n  flagInclude: number,\n  flagExclude: number,\n) {\n  if ((flags & flagInclude) !== flagInclude) {\n    return true\n  } else if (flags & flagExclude) {\n    return true\n  } else {\n    return false\n  }\n}\n\nexport function filterTagValue(readVal: unknown, filterVal?: string) {\n  return filterVal === '*'\n    ? readVal === undefined\n    : `${readVal}` !== `${filterVal}`\n}\n","import PluggableElementBase from './PluggableElementBase'\n\nimport type { AnyConfigurationSchemaType } from '../configuration'\nimport type { AnyReactComponentType } from '../util'\nimport type { IAnyModelType } from 'mobx-state-tree'\n\nexport default class ConnectionType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  description: string\n\n  url: string\n\n  configEditorComponent?: AnyReactComponentType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n    displayName: string\n    description: string\n    configEditorComponent?: AnyReactComponentType\n    url: string\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.description = stuff.description\n    this.url = stuff.url\n    this.configEditorComponent = stuff.configEditorComponent\n  }\n}\n","import PluggableElementBase from './PluggableElementBase'\n\nimport type { AnyConfigurationSchemaType } from '../configuration/types'\nimport type { IAnyModelType } from 'mobx-state-tree'\n\nexport default class InternetAccountType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n  }\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-function-type */\nimport type React from 'react'\n\nimport { isStateTreeNode } from 'mobx-state-tree'\n\nimport type {\n  BlobLocation as MUBlobLocation,\n  LocalPathLocation as MULocalPathLocation,\n  NoAssemblyRegion as MUNoAssemblyRegion,\n  Region as MUIRegion,\n  UriLocation as MUUriLocation,\n} from './mst'\nimport type TextSearchManager from '../../TextSearch/TextSearchManager'\nimport type assemblyManager from '../../assemblyManager'\nimport type { AnyConfigurationModel } from '../../configuration'\nimport type { BaseInternetAccountModel } from '../../pluggableElementTypes/models'\nimport type RpcManager from '../../rpc/RpcManager'\nimport type { MenuItem } from '../../ui'\nimport type { Feature } from '../simpleFeature'\nimport type { ThemeOptions } from '@mui/material'\nimport type {\n  IAnyStateTreeNode,\n  IStateTreeNode,\n  IType,\n  Instance,\n  SnapshotIn,\n} from 'mobx-state-tree'\n\nexport * from './util'\n\n/** abstract type for a model that contains multiple views */\nexport interface AbstractViewContainer\n  extends IStateTreeNode<IType<any, any, any>> {\n  views: AbstractViewModel[]\n  removeView(view: AbstractViewModel): void\n  addView(\n    typeName: string,\n    initialState?: Record<string, unknown>,\n  ): AbstractViewModel\n}\nexport function isViewContainer(\n  thing: unknown,\n): thing is AbstractViewContainer {\n  return (\n    isStateTreeNode(thing) &&\n    'removeView' in thing &&\n    'addView' in thing &&\n    'views' in thing\n  )\n}\n\nexport type NotificationLevel = 'error' | 'info' | 'warning' | 'success'\nexport interface SnackAction {\n  name: React.ReactElement | string\n  onClick: () => void\n}\n\nexport type AssemblyManager = Instance<ReturnType<typeof assemblyManager>>\n\nexport interface BasePlugin {\n  version?: string\n  name: string\n  url?: string\n}\n\nexport interface JBrowsePlugin {\n  name: string\n  authors: string[]\n  description: string\n  location: string\n  url?: string\n  umdUrl?: string\n  esmUrl?: string\n  cjsUrl?: string\n  license: string\n  image?: string\n}\n\nexport type DialogComponentType =\n  | React.LazyExoticComponent<React.FC<any>>\n  | React.FC<any>\n\n/** minimum interface that all session state models must implement */\nexport interface AbstractSessionModel extends AbstractViewContainer {\n  jbrowse: IAnyStateTreeNode\n  drawerPosition?: string\n  configuration: AnyConfigurationModel\n  rpcManager: RpcManager\n  assemblyNames: string[]\n  assemblies: AnyConfigurationModel[]\n  selection?: unknown\n  focusedViewId?: string\n  themeName?: string\n  hovered: unknown\n  setHovered: (arg: unknown) => void\n  setFocusedViewId?: (id: string) => void\n  allThemes?: () => Record<string, ThemeOptions>\n  setSelection: (feature: Feature) => void\n  setSession?: (arg: { name: string; [key: string]: unknown }) => void\n  clearSelection: () => void\n  duplicateCurrentSession?: () => void\n  notify: (\n    message: string,\n    level?: NotificationLevel,\n    action?: SnackAction,\n  ) => void\n  notifyError: (message: string, error?: unknown, extra?: unknown) => void\n  assemblyManager: AssemblyManager\n  version: string\n  getTrackActionMenuItems?: Function\n  addAssembly?: Function\n  removeAssembly?: Function\n  textSearchManager?: TextSearchManager\n  connections: AnyConfigurationModel[]\n  deleteConnection?: Function\n  temporaryAssemblies?: unknown[]\n  addTemporaryAssembly?: (arg: Record<string, unknown>) => void\n  removeTemporaryAssembly?: (arg: string) => void\n  sessionConnections?: AnyConfigurationModel[]\n  sessionTracks?: AnyConfigurationModel[]\n  connectionInstances?: {\n    name: string\n    tracks: AnyConfigurationModel[]\n    configuration: AnyConfigurationModel\n  }[]\n  makeConnection?: Function\n  breakConnection?: Function\n\n  prepareToBreakConnection?: (arg: AnyConfigurationModel) => any\n  adminMode?: boolean\n  showWidget?: Function\n  addWidget?: Function\n\n  DialogComponent?: DialogComponentType\n\n  DialogProps: any\n  queueDialog<T extends DialogComponentType>(\n    callback: (doneCallback: () => void) => [T, React.ComponentProps<T>],\n  ): void\n  name: string\n  id?: string\n  tracks: AnyConfigurationModel[]\n}\nexport function isSessionModel(thing: unknown): thing is AbstractSessionModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'rpcManager' in thing &&\n    'configuration' in thing\n  )\n}\n\n/** abstract interface for a session allows editing configurations */\nexport interface SessionWithConfigEditing extends AbstractSessionModel {\n  editConfiguration(configuration: AnyConfigurationModel): void\n}\nexport function isSessionModelWithConfigEditing(\n  t: unknown,\n): t is SessionWithConfigEditing {\n  return isSessionModel(t) && 'editConfiguration' in t\n}\n\n/** abstract interface for a session allows adding tracks */\nexport interface SessionWithAddTracks extends AbstractSessionModel {\n  addTrackConf(\n    configuration: AnyConfigurationModel | SnapshotIn<AnyConfigurationModel>,\n  ): void\n}\nexport function isSessionWithAddTracks(t: unknown): t is SessionWithAddTracks {\n  return (\n    // @ts-expect-error\n    isSessionModel(t) && 'addTrackConf' in t && !t.disableAddTracks\n  )\n}\n\n/** abstract interface for a session allows adding tracks */\nexport interface SessionWithShareURL extends AbstractSessionModel {\n  shareURL: string\n}\nexport function isSessionWithShareURL(\n  thing: unknown,\n): thing is SessionWithShareURL {\n  return isSessionModel(thing) && 'shareURL' in thing && !!thing.shareURL\n}\n\nexport interface Widget {\n  type: string\n  id: string\n}\n\n/** abstract interface for a session that manages widgets */\nexport interface SessionWithWidgets extends AbstractSessionModel {\n  minimized: boolean\n  visibleWidget?: Widget\n  widgets: Map<string | number, Widget>\n  activeWidgets: Map<string | number, Widget>\n  hideAllWidgets: () => void\n  addWidget(\n    typeName: string,\n    id: string,\n    initialState?: Record<string, unknown>,\n    configuration?: { type: string },\n  ): Widget\n  showWidget(widget: unknown): void\n  hideWidget(widget: unknown): void\n}\n\n/* only some sessions with widgets use a drawer widget */\nexport interface SessionWithDrawerWidgets extends SessionWithWidgets {\n  drawerWidth: number\n  resizeDrawer(arg: number): number\n  minimizeWidgetDrawer(): void\n  showWidgetDrawer: () => void\n  drawerPosition: string\n  setDrawerPosition(arg: string): void\n}\n\nexport function isSessionModelWithWidgets(\n  thing: unknown,\n): thing is SessionWithWidgets {\n  return isSessionModel(thing) && 'widgets' in thing\n}\ninterface SessionWithConnections {\n  makeConnection: (arg: AnyConfigurationModel) => void\n}\nexport function isSessionModelWithConnections(\n  thing: unknown,\n): thing is SessionWithConnections {\n  return isSessionModel(thing) && 'makeConnection' in thing\n}\n\ninterface SessionWithConnectionEditing {\n  addConnectionConf: (arg: AnyConfigurationModel) => void\n}\n\nexport function isSessionModelWithConnectionEditing(\n  thing: unknown,\n): thing is SessionWithConnectionEditing {\n  return isSessionModel(thing) && 'addConnectionConf' in thing\n}\n\nexport interface SessionWithSessionPlugins extends AbstractSessionModel {\n  sessionPlugins: JBrowsePlugin[]\n  addSessionPlugin: Function\n  removeSessionPlugin: Function\n}\nexport function isSessionWithSessionPlugins(\n  thing: unknown,\n): thing is SessionWithSessionPlugins {\n  return isSessionModel(thing) && 'sessionPlugins' in thing\n}\n\n/** abstract interface for a session that manages a global selection */\nexport interface SelectionContainer extends AbstractSessionModel {\n  selection?: unknown\n  setSelection(thing: unknown): void\n}\nexport function isSelectionContainer(\n  thing: unknown,\n): thing is SelectionContainer {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'selection' in thing &&\n    'setSelection' in thing\n  )\n}\n\n/** abstract interface for a session allows applying focus to views and widgets */\nexport interface SessionWithFocusedViewAndDrawerWidgets\n  extends SessionWithDrawerWidgets {\n  focusedViewId: string | undefined\n  setFocusedViewId(id: string): void\n}\n\n/** minimum interface that all view state models must implement */\nexport interface AbstractViewModel {\n  id: string\n  type: string\n  width: number\n  minimized: boolean\n  setWidth(width: number): void\n  setMinimized(flag: boolean): void\n  displayName: string | undefined\n  setDisplayName: (arg: string) => void\n  menuItems: () => MenuItem[]\n}\nexport function isViewModel(thing: unknown): thing is AbstractViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'width' in thing &&\n    'setWidth' in thing\n  )\n}\n\nexport interface AbstractTrackModel {\n  id: string\n  displays: AbstractDisplayModel[]\n  configuration: AnyConfigurationModel\n}\n\nexport function isTrackModel(thing: unknown): thing is AbstractTrackModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-expect-error\n    thing.configuration.trackId\n  )\n}\n\nexport interface AbstractDisplayModel {\n  id: string\n  parentTrack: AbstractTrackModel\n  renderDelay: number\n  rendererType: any\n  cannotBeRenderedReason?: string\n}\nexport function isDisplayModel(thing: unknown): thing is AbstractDisplayModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-expect-error\n    thing.configuration.displayId\n  )\n}\n\nexport interface TrackViewModel extends AbstractViewModel {\n  showTrack(trackId: string): void\n  hideTrack(trackId: string): void\n}\nexport function isTrackViewModel(thing: unknown): thing is TrackViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'showTrack' in thing &&\n    'hideTrack' in thing\n  )\n}\n\n/** minimum interface for the root MST model of a JBrowse app */\nexport interface AbstractRootModel {\n  jbrowse: IAnyStateTreeNode\n  session?: AbstractSessionModel\n  setDefaultSession?(): void\n  adminMode?: boolean\n  error?: unknown\n}\n\n/** root model with more included for the heavier JBrowse web and desktop app */\nexport interface AppRootModel extends AbstractRootModel {\n  internetAccounts: BaseInternetAccountModel[]\n  findAppropriateInternetAccount(\n    location: UriLocation,\n  ): BaseInternetAccountModel | undefined\n}\n\nexport function isAppRootModel(thing: unknown): thing is AppRootModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'findAppropriateInternetAccount' in thing\n  )\n}\n\nexport interface RootModelWithInternetAccounts extends AbstractRootModel {\n  internetAccounts: BaseInternetAccountModel[]\n  findAppropriateInternetAccount(\n    location: UriLocation,\n  ): BaseInternetAccountModel | undefined\n}\n\nexport function isRootModelWithInternetAccounts(\n  thing: unknown,\n): thing is RootModelWithInternetAccounts {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'internetAccounts' in thing &&\n    'findAppropriateInternetAccount' in thing\n  )\n}\n\n/** a root model that manages global menus */\nexport interface AbstractMenuManager {\n  appendMenu(menuName: string): void\n  insertMenu(menuName: string, position: number): number\n  insertInMenu(menuName: string, menuItem: MenuItem, position: number): number\n  appendToMenu(menuName: string, menuItem: MenuItem): number\n  appendToSubMenu(menuPath: string[], menuItem: MenuItem): number\n  insertInSubMenu(\n    menuPath: string[],\n    menuItem: MenuItem,\n    position: number,\n  ): number\n}\nexport function isAbstractMenuManager(\n  thing: unknown,\n): thing is AbstractMenuManager {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'appendMenu' in thing &&\n    'appendToSubMenu' in thing\n  )\n}\n\n// Empty interfaces required by mobx-state-tree\n// See https://mobx-state-tree.js.org/tips/typescript#using-a-mst-type-at-design-time\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface NoAssemblyRegion\n  extends SnapshotIn<typeof MUNoAssemblyRegion> {}\n\n/**\n * a description of a specific genomic region. assemblyName, refName, start,\n * end, and reversed\n */\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface Region extends SnapshotIn<typeof MUIRegion> {}\n\nexport interface AugmentedRegion extends Region {\n  originalRefName?: string\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface LocalPathLocation\n  extends SnapshotIn<typeof MULocalPathLocation> {}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface UriLocation extends SnapshotIn<typeof MUUriLocation> {}\n\nexport function isUriLocation(location: unknown): location is UriLocation {\n  return (\n    typeof location === 'object' &&\n    location !== null &&\n    'uri' in location &&\n    !!location.uri\n  )\n}\nexport function isLocalPathLocation(\n  location: unknown,\n): location is LocalPathLocation {\n  return (\n    typeof location === 'object' &&\n    location !== null &&\n    'localPath' in location &&\n    !!location.localPath\n  )\n}\n\nexport function isBlobLocation(location: unknown): location is BlobLocation {\n  return (\n    typeof location === 'object' &&\n    location !== null &&\n    'blobId' in location &&\n    !!location.blobId\n  )\n}\nexport class AuthNeededError extends Error {\n  constructor(\n    public message: string,\n    public url: string,\n  ) {\n    super(message)\n    this.name = 'AuthNeededError'\n\n    Object.setPrototypeOf(this, AuthNeededError.prototype)\n  }\n}\n\nexport class RetryError extends Error {\n  constructor(\n    public message: string,\n    public internetAccountId: string,\n  ) {\n    super(message)\n    this.name = 'RetryError'\n  }\n}\n\nexport function isAuthNeededException(\n  exception: unknown,\n): exception is AuthNeededError {\n  return (\n    exception instanceof Error &&\n    // DOMException\n    (exception.name === 'AuthNeededError' ||\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      (exception as AuthNeededError).url !== undefined)\n  )\n}\n\nexport function isRetryException(exception: Error): boolean {\n  return (\n    // DOMException\n    exception.name === 'RetryError' ||\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    (exception as RetryError).internetAccountId !== undefined\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface BlobLocation extends SnapshotIn<typeof MUBlobLocation> {}\n\nexport type FileLocation = LocalPathLocation | UriLocation | BlobLocation\n\n// These types are slightly different than the MST models representing a\n// location because a blob cannot be stored in a MST, so this is the\n// pre-processed file location\nexport interface PreUriLocation {\n  uri: string\n}\nexport interface PreLocalPathLocation {\n  localPath: string\n}\nexport interface PreBlobLocation {\n  blob: File\n}\nexport type PreFileLocation =\n  | PreUriLocation\n  | PreLocalPathLocation\n  | PreBlobLocation\n\nexport { default as TextSearchManager } from '../../TextSearch/TextSearchManager'\n","import { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport ServerSideRendererType from './ServerSideRendererType'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport { iterMap } from '../../util'\nimport SimpleFeature from '../../util/simpleFeature'\nimport { checkStopToken } from '../../util/stopToken'\n\nimport type {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderResults as ServerSideRenderResults,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n} from './ServerSideRendererType'\nimport type { AnyConfigurationModel } from '../../configuration'\nimport type { Feature, SimpleFeatureSerialized } from '../../util/simpleFeature'\nimport type { AugmentedRegion as Region } from '../../util/types'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel?: {\n    id: string\n    selectedFeatureId?: string\n  }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel?: {\n    id: string\n    selectedFeatureId?: string\n  }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n  adapterConfig: AnyConfigurationModel\n}\n\nexport interface RenderResults extends ServerSideRenderResults {\n  features: Map<string, Feature>\n}\n\nexport interface ResultsSerialized extends ServerSideResultsSerialized {\n  features: SimpleFeatureSerialized[]\n}\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  features: Map<string, Feature>\n  blockKey: string\n}\n\nexport default class FeatureRendererType extends ServerSideRendererType {\n  /**\n   * replaces the `displayModel` param (which on the client is a MST model)\n   * with a stub that only contains the `selectedFeature`, since this is the\n   * only part of the track model that most renderers read. also serializes the\n   * config and regions to JSON from MST objects.\n   *\n   * @param args - the arguments passed to render\n   */\n  serializeArgsInClient(args: RenderArgs) {\n    return super.serializeArgsInClient({\n      ...args,\n      displayModel: undefined,\n      regions: structuredClone(args.regions),\n    })\n  }\n\n  /**\n   * Adds feature deserialization to base server-side result deserialization\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserializedFeatures = new Map<string, SimpleFeature>(\n      result.features.map(f => SimpleFeature.fromJSON(f)).map(f => [f.id(), f]),\n    )\n\n    const deserialized = super.deserializeResultsInClient(\n      {\n        ...result,\n        features: deserializedFeatures,\n      } as ServerSideResultsSerialized,\n      args,\n    )\n    return {\n      ...deserialized,\n      blockKey: args.blockKey,\n      features: deserializedFeatures,\n    }\n  }\n\n  /**\n   * Adds feature serialization to base server-side result serialization\n   *\n   * @param result - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    result: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(result, args)\n    const { features } = result\n    return {\n      ...serialized,\n      features: iterMap(features.values(), f => f.toJSON(), features.size),\n    }\n  }\n\n  /**\n   * will expand if soft clipping or feature glyphs are shown\n   *\n   * @param region - rendering region\n   * @param _renderArgs - render args, unused, may be used in deriving classes\n   */\n  getExpandedRegion(region: Region, _renderArgs: RenderArgsDeserialized) {\n    return region\n  }\n\n  /**\n   * use the dataAdapter to fetch the features to be rendered\n   *\n   * @param renderArgs -\n   * @returns Map of features as `{ id => feature, ... }`\n   */\n  async getFeatures(\n    renderArgs: RenderArgsDeserialized,\n  ): Promise<Map<string, Feature>> {\n    const pm = this.pluginManager\n    const { stopToken, regions, sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    checkStopToken(stopToken)\n\n    // make sure the requested region's start and end are integers, if there is\n    // a region specification.\n    const requestRegions = regions.map(r => ({\n      ...r,\n      start: Math.floor(r.start),\n      end: Math.ceil(r.end),\n    }))\n\n    const region = requestRegions[0]!\n\n    const featureObservable =\n      requestRegions.length === 1\n        ? dataAdapter.getFeatures(\n            this.getExpandedRegion(region, renderArgs),\n            renderArgs,\n          )\n        : dataAdapter.getFeaturesInMultipleRegions(requestRegions, renderArgs)\n\n    const feats = await firstValueFrom(featureObservable.pipe(toArray()))\n    checkStopToken(stopToken)\n    return new Map<string, Feature>(\n      feats\n        .filter(feat => this.featurePassesFilters(renderArgs, feat))\n        .map(feat => [feat.id(), feat] as const),\n    )\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    return renderArgs.filters\n      ? renderArgs.filters.passes(feature, renderArgs)\n      : true\n  }\n\n  /**\n   * gets features and renders\n   *\n   * @param props - render args\n   */\n  async render(\n    props: RenderArgsDeserialized & { features?: Map<string, Feature> },\n  ): Promise<RenderResults> {\n    const features = props.features || (await this.getFeatures(props))\n    const result = await super.render({\n      ...props,\n      features,\n    })\n    return {\n      ...result,\n      features,\n    }\n  }\n}\n","import { revcom } from '@jbrowse/core/util'\n\nimport { getNextRefPos } from '../MismatchParser'\nimport { getTagAlt } from '../util'\n\nimport type { Feature } from '@jbrowse/core/util'\n\nconst modificationRegex = new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/)\n// ML stores probabilities as array of numerics and MP is scaled phred scores\n// https://github.com/samtools/hts-specs/pull/418/files#diff-e765c6479316309f56b636f88189cdde8c40b854c7bdcce9ee7fe87a4e76febcR596\n//\n// if we have ML or Ml, it is an 8bit probability, divide by 255\n//\n// if we have MP or Mp it is phred scaled ASCII, which can go up to 90 but has\n// very high likelihood basecalls at that point, we really only care about low\n// qual calls <20 approx\nexport function getModProbabilities(feature: Feature) {\n  const m = (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n  return m\n    ? (typeof m === 'string' ? m.split(',').map(e => +e) : m).map(e => e / 255)\n    : (getTagAlt(feature, 'MP', 'Mp') as string | undefined)\n        ?.split('')\n        .map(s => s.charCodeAt(0) - 33)\n        .map(elt => Math.min(1, elt / 50))\n}\n\nexport function getModPositions(mm: string, fseq: string, fstrand: number) {\n  const seq = fstrand === -1 ? revcom(fseq) : fseq\n  const mods = mm.split(';').filter(mod => !!mod)\n  const result = []\n  for (const mod of mods) {\n    const [basemod, ...skips] = mod.split(',')\n\n    // regexes based on parse_mm.pl from hts-specs\n    // https://github.com/samtools/hts-specs/blob/master/test/SAMtags/parse_mm.pl\n    const matches = modificationRegex.exec(basemod!)\n    if (!matches) {\n      throw new Error('bad format for MM tag')\n    }\n    const [, base, strand, typestr] = matches\n\n    // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so split,\n    // and they can also be chemical codes (ChEBI) e.g. C+16061\n    const types = typestr!.split(/(\\d+|.)/).filter(f => !!f)\n\n    if (strand === '-') {\n      console.warn('unsupported negative strand modifications')\n      result.push({\n        type: 'unsupported',\n        positions: [] as number[],\n        base: base!,\n        strand: strand,\n      })\n    }\n\n    // this logic based on parse_mm.pl from hts-specs\n    for (const type of types) {\n      let i = 0\n      const positions = []\n      for (const d of skips) {\n        let delta = +d\n        do {\n          if (base === 'N' || base === seq[i]) {\n            delta--\n          }\n          i++\n        } while (delta >= 0 && i < seq.length)\n        if (fstrand === -1) {\n          const pos = seq.length - i\n          if (pos >= 0) {\n            // avoid negative-number-positions in array, seen in #4629 cause\n            // unknown, could warrant some further investigation\n            positions.unshift(pos)\n          }\n        } else {\n          positions.push(i - 1)\n        }\n      }\n\n      result.push({\n        type,\n        base: base!,\n        strand: strand!,\n        positions,\n      })\n    }\n  }\n  return result\n}\n\nexport function getModTypes(mm: string) {\n  return mm\n    .split(';')\n    .filter(mod => !!mod)\n    .flatMap(mod => {\n      const basemod = mod.split(',')[0]!\n\n      const matches = modificationRegex.exec(basemod)\n      if (!matches) {\n        throw new Error('bad format for MM tag')\n      }\n      const [, base, strand, typestr] = matches\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      return typestr!\n        .split(/(\\d+|.)/)\n        .filter(f => !!f)\n        .map(type => ({\n          type,\n          base: base!,\n          strand: strand!,\n        }))\n    })\n}\n\nexport function getMethBins(feature: Feature, cigarOps: string[]) {\n  const fstart = feature.get('start')\n  const fend = feature.get('end')\n  const fstrand = feature.get('strand') as -1 | 0 | 1\n  const flen = fend - fstart\n  const mm = (getTagAlt(feature, 'MM', 'Mm') as string | undefined) || ''\n  const methBins = []\n  const hydroxyMethBins = []\n  const methProbs = []\n  const hydroxyMethProbs = []\n  const seq = feature.get('seq') as string | undefined\n  if (seq) {\n    const probabilities = getModProbabilities(feature)\n    const modifications = getModPositions(mm, seq, fstrand)\n    let probIndex = 0\n    for (const { type, positions } of modifications) {\n      for (const { ref, idx } of getNextRefPos(cigarOps, positions)) {\n        const idx2 =\n          probIndex + (fstrand === -1 ? positions.length - 1 - idx : idx)\n        const prob = probabilities?.[idx2] || 0\n        if (type === 'm') {\n          if (ref >= 0 && ref < flen) {\n            methBins[ref] = 1\n            methProbs[ref] = prob\n          }\n        } else if (type === 'h') {\n          if (ref >= 0 && ref < flen) {\n            hydroxyMethBins[ref] = 1\n            hydroxyMethProbs[ref] = prob\n          }\n        }\n      }\n      probIndex += positions.length\n    }\n  }\n  return { methBins, hydroxyMethBins, methProbs, hydroxyMethProbs }\n}\n","import { stringToJexlExpression } from '../../../util/jexlStrings'\n\ntype FilterExpression = (...args: Record<string, any>[] | any[]) => boolean\n\ninterface Filter {\n  string: string\n  expr: FilterExpression\n}\n\nexport type SerializedFilterChain = string[]\n\nexport default class SerializableFilterChain {\n  filterChain: Filter[]\n\n  constructor({ filters = [] }: { filters: SerializedFilterChain }) {\n    this.filterChain = filters\n      .map(f => f.trim())\n      .filter(f => !!f)\n      .map(inputFilter => {\n        if (typeof inputFilter === 'string') {\n          const expr = stringToJexlExpression(inputFilter) as FilterExpression\n          return { expr, string: inputFilter }\n        }\n        throw new Error(`invalid inputFilter string \"${inputFilter}\"`)\n      })\n  }\n\n  passes(...args: any[]) {\n    for (const entry of this.filterChain) {\n      if (\n        // @ts-expect-error\n        !entry.expr.evalSync({ feature: args[0] })\n      ) {\n        return false\n      }\n    }\n    return true\n  }\n\n  toJSON() {\n    return { filters: this.filterChain.map(f => f.string) }\n  }\n\n  static fromJSON(json: { filters: SerializedFilterChain }) {\n    return new SerializableFilterChain(json)\n  }\n}\n","import { getSnapshot, isStateTreeNode } from 'mobx-state-tree'\n\nimport { assembleLocStringFast } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { intersection2 } from './range'\n\nimport type { Base1DViewModel } from './calculateStaticBlocks'\n\n/**\n * returns a BlockSet of which the `blocks` attribute is an array of 'dynamic\n * blocks', which are blocks representing only the regions that are visible in\n * the view right now. these are mostly used by tracks for which static blocks\n * are not feasible.\n *\n * each block is a plain JS object like:\n *   `{ refName, start, end, offsetPx, reversed? }`\n *\n * start and end are in bp, and start is always less than end, but if reversed\n * is true, startBp will be on the right side of the visible region.\n *\n * offsetPx is the number of pixels from the left edge of the view to the left\n * edge of the region\n *\n * NOTE: start, end, and offsetPx may all be fractional!\n *\n * @returns BlockSet of `{ refName, startBp, end, offset, reversed? }`\n */\nexport default function calculateDynamicBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    width,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  if (!width) {\n    throw new Error('view has no width, cannot calculate displayed blocks')\n  }\n  const blocks = new BlockSet()\n  let displayedRegionLeftPx = 0\n  const windowLeftPx = offsetPx\n  const windowRightPx = windowLeftPx + width\n  for (\n    let regionNumber = 0;\n    regionNumber < displayedRegions.length;\n    regionNumber++\n  ) {\n    const region = displayedRegions[regionNumber]\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region!\n    const displayedRegionRightPx =\n      displayedRegionLeftPx + (regionEnd - regionStart) / bpPerPx\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n    const parentRegion = isStateTreeNode(region) ? getSnapshot(region) : region\n\n    const [leftPx, rightPx] = intersection2(\n      windowLeftPx,\n      windowRightPx,\n      displayedRegionLeftPx,\n      displayedRegionRightPx,\n    )\n    if (leftPx !== undefined && rightPx !== undefined) {\n      // this displayed region overlaps the view, so make a record for it\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      let blockOffsetPx: number\n      if (reversed) {\n        start = Math.max(\n          regionStart,\n          regionEnd - (rightPx - displayedRegionLeftPx) * bpPerPx,\n        )\n        end = regionEnd - (leftPx - displayedRegionLeftPx) * bpPerPx\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n        blockOffsetPx = displayedRegionLeftPx + (regionEnd - end) / bpPerPx\n      } else {\n        start = (leftPx - displayedRegionLeftPx) * bpPerPx + regionStart\n        end = Math.min(\n          regionEnd,\n          (rightPx - displayedRegionLeftPx) * bpPerPx + regionStart,\n        )\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n        blockOffsetPx = displayedRegionLeftPx + (start - regionStart) / bpPerPx\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: blockOffsetPx,\n        parentRegion,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocStringFast(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && blocks.length === 0 && isLeftEndOfDisplayedRegion) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: -offsetPx,\n            offsetPx: blockData.offsetPx + offsetPx,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n          displayedRegionLeftPx += interRegionPaddingWidth\n        }\n\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          blockOffsetPx = blockData.offsetPx + blockData.widthPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width - blockOffsetPx + offsetPx,\n              offsetPx: blockOffsetPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    displayedRegionLeftPx += (regionEnd - regionStart) / bpPerPx\n  }\n  return blocks\n}\n","import { observer } from 'mobx-react'\n\nimport type { AnyReactComponentType, Feature } from '../../util'\nimport type { ThemeOptions } from '@mui/material'\n\nconst RpcRenderedSvgGroup = observer(function RpcRenderedSvgGroup(props: {\n  html: string\n  features: Map<string, Feature>\n  theme: ThemeOptions\n  RenderingComponent: AnyReactComponentType\n}) {\n  const { html, RenderingComponent, ...rest } = props\n\n  return <RenderingComponent {...rest} />\n})\n\nexport default RpcRenderedSvgGroup\n","import FeatureRenderer from './FeatureRendererType'\nimport RpcRenderedSvgGroup from './RpcRenderedSvgGroup'\nimport { SimpleFeature } from '../../util'\n\nimport type { SimpleFeatureSerialized } from '../../util'\nimport type { ThemeOptions } from '@mui/material'\n\nexport default class CircularChordRendererType extends FeatureRenderer {\n  supportsSVG = true\n\n  deserializeResultsInClient(\n    res: { features: SimpleFeatureSerialized[]; html: string },\n    args: {\n      displayModel?: any\n      theme: ThemeOptions\n      exportSVG?: { rasterizeLayers?: boolean }\n    },\n  ) {\n    const deserializedFeatures = new Map(\n      res.features.map(f => SimpleFeature.fromJSON(f)).map(f => [f.id(), f]),\n    )\n    // if we are rendering svg, we skip hydration only return the res if the\n    // renderer explicitly has this.supportsSVG support to avoid garbage\n    // being rendered in SVG document\n    return args.exportSVG\n      ? {\n          ...res,\n          features: deserializedFeatures,\n          blockKey: 'circularChord',\n          html: this.supportsSVG\n            ? res.html\n            : '<text y=\"12\" fill=\"black\">SVG export not supported for this track</text>',\n        }\n      : {\n          ...res,\n          features: deserializedFeatures,\n          blockKey: 'circularChord',\n          reactElement: (\n            <RpcRenderedSvgGroup\n              {...args}\n              {...res}\n              features={deserializedFeatures}\n              RenderingComponent={this.ReactComponent}\n            />\n          ),\n        }\n  }\n}\n","import type { Region, ViewSnap } from './index'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n}\n\nfunction lengthBetween(self: ViewSnap, start: BpOffset, end: BpOffset) {\n  let bpSoFar = 0\n  const { displayedRegions } = self\n  if (start.index === end.index) {\n    bpSoFar += end.offset - start.offset\n  } else {\n    const s = displayedRegions[start.index]!\n    bpSoFar += s.end - s.start - start.offset\n    if (end.index - start.index >= 2) {\n      for (let i = start.index + 1; i < end.index; i++) {\n        const region = displayedRegions[i]!\n        const len = region.end - region.start\n        bpSoFar += len\n      }\n    }\n    bpSoFar += end.offset\n  }\n  return bpSoFar\n}\n\nexport function moveTo(\n  self: ViewSnap & {\n    zoomTo: (arg: number) => number\n    scrollTo: (arg: number) => void\n  },\n  start?: BpOffset,\n  end?: BpOffset,\n) {\n  if (!start || !end) {\n    return\n  }\n  const {\n    width,\n    interRegionPaddingWidth,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n  } = self\n\n  const len = lengthBetween(self, start, end)\n  let numBlocksWideEnough = 0\n  for (let i = start.index; i < end.index; i++) {\n    const r = displayedRegions[i]!\n    if ((r.end - r.start) / bpPerPx > minimumBlockWidth) {\n      numBlocksWideEnough++\n    }\n  }\n\n  const targetBpPerPx =\n    len / (width - interRegionPaddingWidth * numBlocksWideEnough)\n  const newBpPerPx = self.zoomTo(targetBpPerPx)\n\n  // If our target bpPerPx was smaller than the allowed minBpPerPx, adjust\n  // the scroll so the requested range is in the middle of the screen\n  let extraBp = 0\n  if (targetBpPerPx < newBpPerPx) {\n    extraBp = ((newBpPerPx - targetBpPerPx) * self.width) / 2\n  }\n\n  let bpToStart = -extraBp\n\n  for (let i = 0; i < self.displayedRegions.length; i++) {\n    const region = self.displayedRegions[i]!\n    if (start.index === i) {\n      bpToStart += start.offset\n      break\n    } else {\n      bpToStart += region.end - region.start\n    }\n  }\n\n  self.scrollTo(Math.round(bpToStart / self.bpPerPx))\n}\n\nfunction coord(r: Region, bp: number) {\n  return Math.floor(r.reversed ? r.end - bp : r.start + bp) + 1\n}\n\n// manual return type since getSnapshot hard to infer here\nexport function pxToBp(\n  self: ViewSnap,\n  px: number,\n): {\n  coord: number\n  index: number\n  refName: string\n  oob: boolean\n  assemblyName: string\n  offset: number\n  start: number\n  end: number\n  reversed?: boolean\n} {\n  let bpSoFar = 0\n  const {\n    bpPerPx,\n    offsetPx,\n    displayedRegions,\n    interRegionPaddingWidth,\n    staticBlocks,\n  } = self\n  const blocks = staticBlocks.contentBlocks\n  const bp = (offsetPx + px) * bpPerPx\n  if (bp < 0) {\n    const r = displayedRegions[0]!\n    const snap = r\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(snap as Omit<typeof snap, symbol>),\n      oob: true,\n      coord: coord(r, bp),\n      offset: bp,\n      index: 0,\n    }\n  }\n\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  let currBlock = 0\n  // eslint-disable-next-line unicorn/no-for-loop\n  for (let i = 0; i < displayedRegions.length; i++) {\n    const r = displayedRegions[i]!\n    const len = r.end - r.start\n    const offset = bp - bpSoFar\n    if (len + bpSoFar > bp && bpSoFar <= bp) {\n      const snap = r\n      return {\n        // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n        ...(snap as Omit<typeof snap, symbol>),\n        oob: false,\n        offset,\n        coord: coord(r, offset),\n        index: i,\n      }\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n\n  if (bp >= bpSoFar && displayedRegions.length > 0) {\n    const r = displayedRegions.at(-1)!\n    const len = r.end - r.start\n    const offset = bp - bpSoFar + len\n\n    const snap = r\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(snap as Omit<typeof snap, symbol>),\n      oob: true,\n      offset,\n      coord: coord(r, offset),\n      index: displayedRegions.length - 1,\n    }\n  }\n  return {\n    coord: 0,\n    index: 0,\n    refName: '',\n    oob: true,\n    assemblyName: '',\n    offset: 0,\n    start: 0,\n    end: 0,\n    reversed: false,\n  }\n}\n\nexport function bpToPx({\n  refName,\n  coord,\n  regionNumber,\n  self,\n}: {\n  refName: string\n  coord: number\n  regionNumber?: number\n  self: ViewSnap\n}) {\n  let bpSoFar = 0\n\n  const { interRegionPaddingWidth, bpPerPx, displayedRegions, staticBlocks } =\n    self\n  const blocks = staticBlocks.contentBlocks\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  let currBlock = 0\n\n  let i = 0\n  for (; i < displayedRegions.length; i++) {\n    const r = displayedRegions[i]!\n    const len = r.end - r.start\n    if (\n      refName === r.refName &&\n      coord >= r.start &&\n      coord <= r.end &&\n      (regionNumber ? regionNumber === i : true)\n    ) {\n      bpSoFar += r.reversed ? r.end - coord : coord - r.start\n      break\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n  const found = displayedRegions[i]\n  if (found) {\n    return {\n      index: i,\n      offsetPx: Math.round(bpSoFar / bpPerPx),\n    }\n  }\n\n  return undefined\n}\n\nexport function bpToPxMap({\n  refName,\n  coord,\n  regionNumber,\n  self,\n}: {\n  refName: string\n  coord: number\n  regionNumber?: number\n  self: ViewSnap\n}) {\n  let bpSoFar = 0\n\n  const { interRegionPaddingWidth, bpPerPx, displayedRegions, staticBlocks } =\n    self\n  const blocks = staticBlocks.contentBlocks\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  const map = {}\n  let currBlock = 0\n\n  let i = 0\n  for (; i < displayedRegions.length; i++) {\n    const r = displayedRegions[i]!\n    const len = r.end - r.start\n    if (\n      refName === r.refName &&\n      coord >= r.start &&\n      coord <= r.end &&\n      (regionNumber === undefined ? true : regionNumber === i)\n    ) {\n      bpSoFar += r.reversed ? r.end - coord : coord - r.start\n      break\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n  const found = displayedRegions[i]\n  if (found) {\n    return {\n      index: i,\n      offsetPx: Math.round(bpSoFar / bpPerPx),\n    }\n  }\n\n  return map\n}\n","import { getSOTermAndDescription } from './util'\n\nimport type VCFParser from '@gmod/vcf'\nimport type { Variant } from '@gmod/vcf'\nimport type { Feature } from '@jbrowse/core/util'\n\ntype FeatureData = ReturnType<typeof dataFromVariant>\n\nfunction dataFromVariant(variant: Variant, parser: VCFParser) {\n  const { REF = '', ALT, POS, CHROM, ID } = variant\n  const start = POS - 1\n  const [type, description] = getSOTermAndDescription(REF, ALT, parser)\n\n  return {\n    refName: CHROM,\n    start,\n    end: getEnd(variant),\n    description,\n    type,\n    name: ID?.join(','),\n  }\n}\nfunction getEnd(variant: Variant) {\n  const { POS, REF = '', ALT } = variant\n  const isTRA = ALT?.includes('<TRA>')\n  const start = POS - 1\n  const isSymbolic = ALT?.some(f => f.includes('<'))\n  if (isSymbolic) {\n    const info = variant.INFO\n    if (info.END && !isTRA) {\n      return +(info.END as string[])[0]!\n    }\n  }\n  return start + REF.length\n}\n\nexport default class VCFFeature implements Feature {\n  private variant: Variant\n\n  private parser: VCFParser\n\n  private data: FeatureData\n\n  private _id: string\n\n  constructor(args: { variant: Variant; parser: VCFParser; id: string }) {\n    this.variant = args.variant\n    this.parser = args.parser\n    this.data = dataFromVariant(this.variant, this.parser)\n    this._id = args.id\n  }\n\n  get(field: string): any {\n    return field === 'samples'\n      ? this.variant.SAMPLES()\n      : field === 'genotypes'\n        ? this.variant.GENOTYPES()\n        : (this.data[field as keyof typeof this.data] ??\n          this.variant[field as keyof typeof this.variant])\n  }\n  parent() {\n    return undefined\n  }\n\n  children() {\n    return undefined\n  }\n\n  id() {\n    return this._id\n  }\n\n  toJSON(): any {\n    const { SAMPLES, GENOTYPES, ...rest } = this.variant\n    return {\n      uniqueId: this._id,\n      ...rest,\n      ...this.data,\n      samples: this.variant.SAMPLES(),\n    }\n  }\n}\n","import type React from 'react'\n\nimport PluggableElementBase from '../PluggableElementBase'\n\nimport type PluginManager from '../../PluginManager'\nimport type { AnyConfigurationSchemaType } from '../../configuration'\nimport type { AnyReactComponentType } from '../../util'\n\nexport type RenderProps = Record<string, unknown>\n\nexport interface RenderResults {\n  reactElement?: React.ReactElement\n  html?: string\n}\n\nexport default class RendererType extends PluggableElementBase {\n  ReactComponent: AnyReactComponentType\n\n  supportsSVG = true\n\n  configSchema: AnyConfigurationSchemaType\n\n  pluginManager: PluginManager\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AnyReactComponentType\n    displayName?: string\n    configSchema: AnyConfigurationSchemaType\n    pluginManager: PluginManager\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.configSchema = stuff.configSchema\n    this.pluginManager = stuff.pluginManager\n  }\n\n  async render(props: RenderProps): Promise<RenderResults> {\n    return {\n      reactElement: <this.ReactComponent {...props} />,\n    }\n  }\n\n  freeResources(_args: any) {}\n}\n","import type { Mismatch } from '../shared/types'\n\nexport function cigarToMismatches(\n  ops: string[],\n  seq?: string,\n  ref?: string,\n  qual?: Uint8Array,\n) {\n  let roffset = 0 // reference offset\n  let soffset = 0 // seq offset\n  const mismatches: Mismatch[] = []\n  const hasRefAndSeq = ref && seq\n  for (let i = 0; i < ops.length; i += 2) {\n    const len = +ops[i]!\n    const op = ops[i + 1]!\n\n    if (op === 'M' || op === '=' || op === 'E') {\n      if (hasRefAndSeq) {\n        for (let j = 0; j < len; j++) {\n          if (\n            // @ts-ignore in the full yarn build of the repo, this says that\n            // object is possibly undefined for some reason, ignored\n            seq[soffset + j].toUpperCase() !== ref[roffset + j].toUpperCase()\n          ) {\n            mismatches.push({\n              start: roffset + j,\n              type: 'mismatch',\n              base: seq[soffset + j]!,\n              altbase: ref[roffset + j]!,\n              length: 1,\n            })\n          }\n        }\n      }\n      soffset += len\n    }\n    if (op === 'I') {\n      mismatches.push({\n        start: roffset,\n        type: 'insertion',\n        base: `${len}`,\n        length: 0,\n      })\n      soffset += len\n    } else if (op === 'D') {\n      mismatches.push({\n        start: roffset,\n        type: 'deletion',\n        base: '*',\n        length: len,\n      })\n    } else if (op === 'N') {\n      mismatches.push({\n        start: roffset,\n        type: 'skip',\n        base: 'N',\n        length: len,\n      })\n    } else if (op === 'X') {\n      const r = seq?.slice(soffset, soffset + len) || []\n      const q = qual?.subarray(soffset, soffset + len) || []\n\n      for (let j = 0; j < len; j++) {\n        mismatches.push({\n          start: roffset + j,\n          type: 'mismatch',\n          base: r[j] || 'X',\n          qual: q[j],\n          length: 1,\n        })\n      }\n      soffset += len\n    } else if (op === 'H') {\n      mismatches.push({\n        start: roffset,\n        type: 'hardclip',\n        base: `H${len}`,\n        cliplen: len,\n        length: 1,\n      })\n    } else if (op === 'S') {\n      mismatches.push({\n        start: roffset,\n        type: 'softclip',\n        base: `S${len}`,\n        cliplen: len,\n        length: 1,\n      })\n      soffset += len\n    }\n\n    if (op !== 'I' && op !== 'S' && op !== 'H') {\n      roffset += len\n    }\n  }\n  return mismatches\n}\n","import type { Mismatch } from '../shared/types'\n\nconst mdRegex = new RegExp(/(\\d+|\\^[a-z]+|[a-z])/gi)\n\nexport function mdToMismatches(\n  mdstring: string,\n  ops: string[],\n  cigarMismatches: Mismatch[],\n  seq: string,\n  qual?: Uint8Array,\n) {\n  let curr: Mismatch = { start: 0, base: '', length: 0, type: 'mismatch' }\n  let lastCigar = 0\n  let lastTemplateOffset = 0\n  let lastRefOffset = 0\n  let lastSkipPos = 0\n  const mismatchRecords: Mismatch[] = []\n  const skips = cigarMismatches.filter(cigar => cigar.type === 'skip')\n\n  // convert a position on the reference sequence to a position on the template\n  // sequence, taking into account hard and soft clipping of reads\n  function nextRecord(): void {\n    mismatchRecords.push(curr)\n\n    // get a new mismatch record ready\n    curr = {\n      start: curr.start + curr.length,\n      length: 0,\n      base: '',\n      type: 'mismatch',\n    }\n  }\n\n  function getTemplateCoordLocal(refCoord: number): number {\n    let templateOffset = lastTemplateOffset\n    let refOffset = lastRefOffset\n    for (\n      let i = lastCigar;\n      i < ops.length && refOffset <= refCoord;\n      i += 2, lastCigar = i\n    ) {\n      const len = +ops[i]!\n      const op = ops[i + 1]!\n\n      if (op === 'S' || op === 'I') {\n        templateOffset += len\n      } else if (op === 'D' || op === 'P' || op === 'N') {\n        refOffset += len\n      } else if (op !== 'H') {\n        templateOffset += len\n        refOffset += len\n      }\n    }\n    lastTemplateOffset = templateOffset\n    lastRefOffset = refOffset\n\n    return templateOffset - (refOffset - refCoord)\n  }\n\n  // now actually parse the MD string\n  const md = mdstring.match(mdRegex) || []\n  for (const token of md) {\n    const num = +token\n    if (!Number.isNaN(num)) {\n      curr.start += num\n    } else if (token.startsWith('^')) {\n      curr.start += token.length - 1\n    } else {\n      // mismatch\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (let j = 0; j < token.length; j += 1) {\n        curr.length = 1\n\n        while (lastSkipPos < skips.length) {\n          const mismatch = skips[lastSkipPos]!\n          if (curr.start >= mismatch.start) {\n            curr.start += mismatch.length\n            lastSkipPos++\n          } else {\n            break\n          }\n        }\n        const s = getTemplateCoordLocal(curr.start)\n        curr.base = seq[s] || 'X'\n        curr.qual = qual?.[s]\n        curr.altbase = token\n        nextRecord()\n      }\n    }\n  }\n  return mismatchRecords\n}\n","import { cigarToMismatches } from './cigarToMismatches'\nimport { mdToMismatches } from './mdToMismatches'\n\nimport type { Mismatch } from '../shared/types'\nimport type { Feature } from '@jbrowse/core/util'\n\nconst cigarRegex = new RegExp(/([MIDNSHPX=])/)\nconst startClip = new RegExp(/(\\d+)[SH]$/)\nconst endClip = new RegExp(/^(\\d+)([SH])/)\n\nexport function parseCigar(cigar = '') {\n  return cigar.split(cigarRegex).slice(0, -1)\n}\n\nexport function getMismatches(\n  cigar?: string,\n  md?: string,\n  seq?: string,\n  ref?: string,\n  qual?: Uint8Array,\n) {\n  let mismatches: Mismatch[] = []\n  const ops = parseCigar(cigar)\n  // parse the CIGAR tag if it has one\n  if (cigar) {\n    mismatches = mismatches.concat(cigarToMismatches(ops, seq, ref, qual))\n  }\n\n  // now let's look for CRAM or MD mismatches\n  if (md && seq) {\n    mismatches = mismatches.concat(\n      mdToMismatches(md, ops, mismatches, seq, qual),\n    )\n  }\n\n  return mismatches\n}\n\nexport function getOrientedCigar(flip: boolean, cigar: string[]) {\n  if (flip) {\n    const ret = []\n    for (let i = 0; i < cigar.length; i += 2) {\n      const len = cigar[i]!\n      let op = cigar[i + 1]!\n      if (op === 'D') {\n        op = 'I'\n      } else if (op === 'I') {\n        op = 'D'\n      }\n      ret.push(len, op)\n    }\n    return ret\n  }\n  return cigar\n}\n\nexport function getOrientedMismatches(flip: boolean, cigar: string) {\n  const p = parseCigar(cigar)\n  return cigarToMismatches(flip ? getOrientedCigar(flip, p) : p)\n}\n\nexport function getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]!\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nexport function getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]!\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]!\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(startClip.exec(cigar) || [])[1]! || 0\n    : +(endClip.exec(cigar) || [])[1]! || 0\n}\n\nexport function getTag(feature: Feature, tag: string) {\n  return feature.get('tags')[tag]\n}\n\n// produces a list of \"feature-like\" object from parsing supplementary\n// alignments in the SA tag\n//\n// @param normalize - used specifically in the linear-read-vs-ref context, it\n// flips features around relative to the original feature. other contexts of\n// usage can keep this false\nexport function featurizeSA(\n  SA: string | undefined,\n  id: string,\n  strand: number,\n  readName: string,\n  normalize?: boolean,\n) {\n  return (\n    SA?.split(';')\n      .filter(aln => !!aln)\n      .map((aln, index) => {\n        const ret = aln.split(',')\n        const saRef = ret[0]!\n        const saStart = ret[1]!\n        const saStrand = ret[2]!\n        const saCigar = ret[3]!\n        const saLengthOnRef = getLengthOnRef(saCigar)\n        const saLength = getLength(saCigar)\n        const saLengthSansClipping = getLengthSansClipping(saCigar)\n        const saStrandNormalized = saStrand === '-' ? -1 : 1\n        const saClipPos = getClip(\n          saCigar,\n          (normalize ? strand : 1) * saStrandNormalized,\n        )\n        const saRealStart = +saStart - 1\n        return {\n          refName: saRef,\n          start: saRealStart,\n          end: saRealStart + saLengthOnRef,\n          seqLength: saLength,\n          clipPos: saClipPos,\n          CIGAR: saCigar,\n          strand: (normalize ? strand : 1) * saStrandNormalized,\n          uniqueId: `${id}_SA${index}`,\n          mate: {\n            start: saClipPos,\n            end: saClipPos + saLengthSansClipping,\n            refName: readName,\n          },\n        }\n      }) || []\n  )\n}\n\nexport { getNextRefPos } from './getNextRefPos'\n","import { TextField } from '@mui/material'\n\nimport type {\n  AutocompleteRenderInputParams,\n  TextFieldProps as TFP,\n} from '@mui/material'\n\nexport default function AutocompleteTextField({\n  TextFieldProps,\n  inputBoxVal,\n  params,\n  setInputValue,\n  setCurrentSearch,\n}: {\n  TextFieldProps: TFP\n  inputBoxVal: string\n  params: AutocompleteRenderInputParams\n  setInputValue: (arg: string) => void\n  setCurrentSearch: (arg: string) => void\n}) {\n  const { helperText, slotProps = {} } = TextFieldProps\n  return (\n    <TextField\n      onBlur={() => {\n        // this is used to restore a refName or the non-user-typed input to the\n        // box on blurring\n        setInputValue(inputBoxVal)\n      }}\n      {...params}\n      {...TextFieldProps}\n      size=\"small\"\n      helperText={helperText}\n      slotProps={{\n        input: {\n          ...params.InputProps,\n          // eslint-disable-next-line @typescript-eslint/no-misused-spread\n          ...slotProps.input,\n        },\n      }}\n      placeholder=\"Search for location\"\n      onChange={e => {\n        setCurrentSearch(e.target.value)\n      }}\n    />\n  )\n}\n","import { useEffect, useState } from 'react'\n\nimport BaseResult, {\n  RefSequenceResult,\n} from '@jbrowse/core/TextSearch/BaseResults'\nimport { getSession, measureText, useDebounce } from '@jbrowse/core/util'\nimport { Autocomplete } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport AutocompleteTextField from './AutocompleteTextField'\nimport { getDeduplicatedResult, getFiltered } from './util'\n\nimport type { Option } from './util'\nimport type { LinearGenomeViewModel } from '../../model'\nimport type { TextFieldProps as TFP } from '@mui/material'\n\nconst RefNameAutocomplete = observer(function ({\n  model,\n  onSelect,\n  assemblyName,\n  style,\n  fetchResults,\n  onChange,\n  value,\n  minWidth = 200,\n  maxWidth = 550,\n  TextFieldProps = {},\n}: {\n  model: LinearGenomeViewModel\n  onSelect?: (region: BaseResult) => void\n  onChange?: (val: string) => void\n  assemblyName?: string\n  value?: string\n  fetchResults: (query: string) => Promise<BaseResult[]>\n  style?: React.CSSProperties\n  minWidth?: number\n  maxWidth?: number\n  TextFieldProps?: TFP\n}) {\n  const session = getSession(model)\n  const { assemblyManager } = session\n  const [open, setOpen] = useState(false)\n  const [loaded, setLoaded] = useState(true)\n  const [currentSearch, setCurrentSearch] = useState('')\n  const [inputValue, setInputValue] = useState('')\n  const [searchOptions, setSearchOptions] = useState<Option[]>()\n  const debouncedSearch = useDebounce(currentSearch, 300)\n  const assembly = assemblyName ? assemblyManager.get(assemblyName) : undefined\n  const { coarseVisibleLocStrings, hasDisplayedRegions } = model\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        if (debouncedSearch === '' || !assemblyName) {\n          return\n        }\n\n        setLoaded(false)\n        setSearchOptions(\n          getDeduplicatedResult(await fetchResults(debouncedSearch)),\n        )\n      } catch (e) {\n        console.error(e)\n        session.notifyError(`${e}`, e)\n      } finally {\n        setLoaded(true)\n      }\n    })()\n  }, [assemblyName, fetchResults, debouncedSearch, session])\n\n  const inputBoxVal = coarseVisibleLocStrings || value || ''\n\n  const regions = assembly?.regions\n  const regionOptions =\n    regions?.map(region => ({\n      result: new RefSequenceResult({\n        refName: region.refName,\n        label: region.refName,\n        displayString: region.refName,\n        matchedAttribute: 'refName',\n      }),\n    })) || []\n\n  // notes on implementation:\n  // The selectOnFocus setting helps highlight the field when clicked\n  return (\n    <Autocomplete\n      data-testid=\"autocomplete\"\n      disableListWrap\n      disableClearable\n      disabled={!assemblyName}\n      freeSolo\n      includeInputInList\n      selectOnFocus\n      style={{\n        ...style,\n        width: Math.min(\n          Math.max(measureText(inputBoxVal, 14) + 100, minWidth),\n          maxWidth,\n        ),\n      }}\n      value={inputBoxVal}\n      loading={!loaded}\n      inputValue={inputValue}\n      onInputChange={(_event, newInputValue) => {\n        setInputValue(newInputValue)\n        onChange?.(newInputValue)\n      }}\n      loadingText=\"loading results\"\n      open={open}\n      onOpen={() => {\n        setOpen(true)\n      }}\n      onClose={() => {\n        setOpen(false)\n        setLoaded(true)\n        if (hasDisplayedRegions) {\n          setCurrentSearch('')\n          setSearchOptions(undefined)\n        }\n      }}\n      onChange={(_event, selectedOption) => {\n        if (!selectedOption || !assemblyName) {\n          return\n        }\n\n        if (typeof selectedOption === 'string') {\n          // handles string inputs on keyPress enter\n          onSelect?.(\n            new BaseResult({\n              label: selectedOption,\n            }),\n          )\n        } else {\n          onSelect?.(selectedOption.result)\n        }\n        setInputValue(inputBoxVal)\n      }}\n      options={searchOptions?.length ? searchOptions : regionOptions}\n      getOptionDisabled={option => option.group === 'limitOption'}\n      filterOptions={(opts, { inputValue }) => getFiltered(opts, inputValue)}\n      renderInput={params => (\n        <AutocompleteTextField\n          params={params}\n          inputBoxVal={inputBoxVal}\n          TextFieldProps={TextFieldProps}\n          setCurrentSearch={setCurrentSearch}\n          setInputValue={setInputValue}\n        />\n      )}\n      getOptionLabel={opt =>\n        typeof opt === 'string' ? opt : opt.result.getDisplayString()\n      }\n    />\n  )\n})\n\nexport default RefNameAutocomplete\n","import BaseResult from '@jbrowse/core/TextSearch/BaseResults'\n\nexport interface Option {\n  group?: string\n  result: BaseResult\n}\n\nfunction filterOptions(options: Option[], searchQuery: string) {\n  return options.filter(\n    ({ result }) =>\n      result.getLabel().toLowerCase().includes(searchQuery) ||\n      result.matchedObject,\n  )\n}\n\n// the logic of this method is to only apply a filter to RefSequenceResults\n// because they do not have a matchedObject. the trix search results already\nexport function getFiltered(opts: Option[], inputValue: string) {\n  const filtered = filterOptions(opts, inputValue.toLocaleLowerCase())\n  return [\n    ...filtered.slice(0, 100),\n    ...(filtered.length > 100\n      ? [\n          {\n            group: 'limitOption',\n            result: new BaseResult({\n              label: 'keep typing for more results',\n            }),\n          },\n        ]\n      : []),\n  ]\n}\n\nexport function aggregateResults(results: BaseResult[]) {\n  const m: Record<string, BaseResult[]> = {}\n\n  for (const result of results) {\n    const displayString = result.getDisplayString()\n    if (!m[displayString]) {\n      m[displayString] = []\n    }\n    m[displayString].push(result)\n  }\n  return m\n}\n\nexport function getDeduplicatedResult(results: BaseResult[]) {\n  return Object.entries(aggregateResults(results)).map(\n    ([displayString, results]) =>\n      results.length === 1\n        ? {\n            result: results[0]!,\n          }\n        : {\n            // deduplicate a \"multi-result\"\n            result: new BaseResult({\n              displayString,\n              results,\n              label: displayString,\n            }),\n          },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BaseLinearDisplay\n * #category display\n *\n * `BaseLinearDisplay` is a \"base\" config that is extended by other configs including\n * - `LinearBasicDisplay` (used for feature tracks, etc)\n * - `LinearBareDisplay` (more stripped down than even the basic display, not\n *   commonly used)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst baseLinearDisplayConfigSchema = ConfigurationSchema(\n  'BaseLinearDisplay',\n  {\n    /**\n     * #slot\n     */\n    maxFeatureScreenDensity: {\n      type: 'number',\n      description:\n        'maximum features per pixel that is displayed in the view, used if byte size estimates not available',\n      defaultValue: 0.3,\n    },\n    /**\n     * #slot\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      defaultValue: 1_000_000,\n      description:\n        \"maximum data to attempt to download for a given track, used if adapter doesn't specify one\",\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      defaultValue: 100,\n      description: 'default height for the track',\n    },\n    /**\n     * #slot\n     */\n    mouseover: {\n      type: 'string',\n      description: 'text to display when the cursor hovers over a feature',\n      defaultValue: `jexl:get(feature,'name')`,\n\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     * config jexlFilters are deferred evaluated so they are prepended with\n     * jexl at runtime rather than being stored with jexl in the config\n     */\n    jexlFilters: {\n      type: 'stringArray',\n      description:\n        'default set of jexl filters to apply to a track. note: these do not use the jexl prefix because they have a deferred evaluation system',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'displayId',\n  },\n)\n\nexport default baseLinearDisplayConfigSchema\n","// takes an array or Map or Set (anything iterable with values()) of Maps and\n// lets you query them as one Map\nexport default class CompositeMap<T, U> {\n  constructor(private submaps: Map<T, U>[]) {}\n\n  has(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return true\n      }\n    }\n    return false\n  }\n\n  get(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return submap.get(id)\n      }\n    }\n    return undefined\n  }\n\n  *values() {\n    for (const key of this.keys()) {\n      yield this.get(key) as U\n    }\n  }\n\n  *keys() {\n    const keys = new Set<T>()\n    for (const submap of this.submaps.values()) {\n      for (const key of submap.keys()) {\n        keys.add(key)\n      }\n    }\n    for (const key of keys) {\n      yield key\n    }\n  }\n\n  find<V>(f: (arg0: U) => V) {\n    for (const submap of this.submaps.values()) {\n      for (const value of submap.values()) {\n        const found = f(value)\n        if (found) {\n          return value\n        }\n      }\n    }\n    return undefined\n  }\n\n  *[Symbol.iterator]() {\n    for (const key of this.keys()) {\n      yield [key, this.get(key)]\n    }\n  }\n\n  *entries() {\n    for (const k of this.keys()) {\n      yield [k, this.get(k)]\n    }\n  }\n}\n","import { Button } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\n\nimport BlockMsg from '../components/BlockMsg'\n\nimport type { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nconst TooLargeMessage = observer(function ({\n  model,\n}: {\n  model: {\n    regionTooLargeReason: string\n    featureDensityStats?: FeatureDensityStats\n    setFeatureDensityStatsLimit: (s?: FeatureDensityStats) => void\n    reload: () => void\n  }\n}) {\n  const { regionTooLargeReason } = model\n  return (\n    <BlockMsg\n      severity=\"warning\"\n      action={\n        <Button\n          onClick={() => {\n            if (isAlive(model)) {\n              model.setFeatureDensityStatsLimit(model.featureDensityStats)\n              model.reload()\n            }\n          }}\n        >\n          Force load\n        </Button>\n      }\n      message={[\n        regionTooLargeReason,\n        'Zoom in to see features or force load (may be slow)',\n      ]\n        .filter(f => !!f)\n        .join('. ')}\n    />\n  )\n})\n\nexport default TooLargeMessage\n","import { getConf } from '@jbrowse/core/configuration'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\nimport { addDisposer, isAlive, types } from 'mobx-state-tree'\n\nimport autorunFeatureDensityStats from './autorunFeatureDensityStats'\nimport { getDisplayStr, getFeatureDensityStatsPre } from './util'\nimport TooLargeMessage from '../components/TooLargeMessage'\n\nimport type { LinearGenomeViewModel } from '../../LinearGenomeView'\nimport type { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { Region } from '@jbrowse/core/util/types'\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel FeatureDensityMixin\n * #category display\n */\nexport default function FeatureDensityMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      userBpPerPxLimit: types.maybe(types.number),\n      /**\n       * #property\n       */\n\n      userByteSizeLimit: types.maybe(types.number),\n    })\n    .volatile(() => ({\n      featureDensityStatsP: undefined as\n        | undefined\n        | Promise<FeatureDensityStats>,\n      featureDensityStats: undefined as undefined | FeatureDensityStats,\n      currStatsBpPerPx: 0,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get currentBytesRequested() {\n        return self.featureDensityStats?.bytes || 0\n      },\n\n      /**\n       * #getter\n       */\n      get currentFeatureScreenDensity() {\n        const view = getContainingView(self) as LGV\n        return (self.featureDensityStats?.featureDensity || 0) * view.bpPerPx\n      },\n\n      /**\n       * #getter\n       */\n      get maxFeatureScreenDensity() {\n        // @ts-expect-error\n        return getConf(self, 'maxFeatureScreenDensity')\n      },\n      /**\n       * #getter\n       */\n      get featureDensityStatsReady() {\n        const view = getContainingView(self) as LGV\n        return (\n          self.currStatsBpPerPx === view.bpPerPx &&\n          (!!self.featureDensityStats || !!self.userBpPerPxLimit)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get maxAllowableBytes() {\n        return (\n          self.userByteSizeLimit ||\n          self.featureDensityStats?.fetchSizeLimit ||\n          // @ts-expect-error\n          (getConf(self, 'fetchSizeLimit') as number)\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => autorunFeatureDensityStats(self as any)),\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCurrStatsBpPerPx(n: number) {\n        self.currStatsBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      setFeatureDensityStatsLimit(stats?: FeatureDensityStats) {\n        const view = getContainingView(self) as LGV\n        if (stats?.bytes) {\n          self.userByteSizeLimit = stats.bytes\n        } else {\n          self.userBpPerPxLimit = view.bpPerPx\n        }\n      },\n      /**\n       * #action\n       */\n      getFeatureDensityStats() {\n        if (!self.featureDensityStatsP) {\n          self.featureDensityStatsP = getFeatureDensityStatsPre(\n            self as any,\n          ).catch((e: unknown) => {\n            if (isAlive(self)) {\n              this.setFeatureDensityStatsP(undefined)\n            }\n            throw e\n          })\n        }\n        return self.featureDensityStatsP\n      },\n\n      /**\n       * #action\n       */\n      setFeatureDensityStatsP(arg: any) {\n        self.featureDensityStatsP = arg\n      },\n\n      /**\n       * #action\n       */\n      setFeatureDensityStats(featureDensityStats?: FeatureDensityStats) {\n        self.featureDensityStats = featureDensityStats\n      },\n      /**\n       * #action\n       */\n      clearFeatureDensityStats() {\n        self.featureDensityStatsP = undefined\n        self.featureDensityStats = undefined\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * region is too large if:\n       * - stats are ready\n       * - region is greater than 20kb (don't warn when zoomed in less than that)\n       * - and bytes is greater than max allowed bytes or density greater than max\n       *   density\n       */\n      get regionTooLarge() {\n        const view = getContainingView(self) as LGV\n        if (\n          !self.featureDensityStatsReady ||\n          view.dynamicBlocks.totalBp < 20_000\n        ) {\n          return false\n        }\n        return (\n          self.currentBytesRequested > self.maxAllowableBytes ||\n          (self.userBpPerPxLimit\n            ? view.bpPerPx > self.userBpPerPxLimit\n            : self.currentFeatureScreenDensity > self.maxFeatureScreenDensity)\n        )\n      },\n\n      /**\n       * #getter\n       * only shows a message of bytes requested is defined, the feature density\n       * based stats don't produce any helpful message besides to zoom in\n       */\n      get regionTooLargeReason() {\n        const req = self.currentBytesRequested\n        const max = self.maxAllowableBytes\n\n        return req && req > max\n          ? `Requested too much data (${getDisplayStr(req)})`\n          : ''\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get statsReadyAndRegionNotTooLarge() {\n        return self.featureDensityStatsReady && !self.regionTooLarge\n      },\n      /**\n       * #method\n       */\n      regionCannotBeRenderedText(_region: Region) {\n        return self.regionTooLarge ? 'Force load to see features' : ''\n      },\n\n      /**\n       * #method\n       * @param region -\n       * @returns falsy if the region is fine to try rendering. Otherwise,\n       *  return a react node + string of text.\n       *  string of text describes why it cannot be rendered\n       *  react node allows user to force load at current setting\n       */\n      regionCannotBeRendered(_region: Region) {\n        return self.regionTooLarge ? (\n          <TooLargeMessage model={self as any} />\n        ) : null\n      },\n    }))\n}\n","import { getContainingView, isAbortException } from '@jbrowse/core/util'\nimport { isAlive } from 'mobx-state-tree'\n\nimport type { BaseLinearDisplayModel } from './BaseLinearDisplayModel'\nimport type { LinearGenomeViewModel } from '../../LinearGenomeView'\n\n// stats estimation autorun calls getFeatureDensityStats against the data\n// adapter which by default uses featureDensity, but can also respond with a\n// byte size estimate and fetch size limit (data adapter can define what is too\n// much data)\nexport default async function autorunFeatureDensityStats(\n  self: BaseLinearDisplayModel,\n) {\n  try {\n    const view = getContainingView(self) as LinearGenomeViewModel\n\n    // extra check for contentBlocks.length\n    // https://github.com/GMOD/jbrowse-components/issues/2694\n    if (\n      !view.initialized ||\n      !view.staticBlocks.contentBlocks.length ||\n      view.bpPerPx === self.currStatsBpPerPx ||\n      self.error\n    ) {\n      return\n    }\n\n    // don't re-estimate featureDensity even if zoom level changes,\n    // jbrowse 1-style assume it's sort of representative\n    if (self.featureDensityStats?.featureDensity !== undefined) {\n      self.setCurrStatsBpPerPx(view.bpPerPx)\n      return\n    }\n\n    self.clearFeatureDensityStats()\n    self.setCurrStatsBpPerPx(view.bpPerPx)\n    const stats = await self.getFeatureDensityStats()\n    if (isAlive(self)) {\n      self.setFeatureDensityStats(stats)\n    }\n  } catch (e) {\n    console.error(e)\n    if (isAlive(self) && !isAbortException(e)) {\n      self.setError(e)\n    }\n  }\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nconst minDisplayHeight = 20\n\n/**\n * #stateModel TrackHeightMixin\n * #category display\n */\nexport default function TrackHeightMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      heightPreConfig: types.maybe(\n        types.refinement(\n          'displayHeight',\n          types.number,\n          n => n >= minDisplayHeight,\n        ),\n      ),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      scrollTop: 0,\n    }))\n    .views(self => ({\n      get height() {\n        // @ts-expect-error\n        return self.heightPreConfig ?? (getConf(self, 'height') as number)\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n      /**\n       * #action\n       */\n      setHeight(displayHeight: number) {\n        self.heightPreConfig = Math.max(displayHeight, minDisplayHeight)\n        return self.height\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n}\n","import type React from 'react'\nimport { lazy } from 'react'\n\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  isFeature,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport CenterFocusStrongIcon from '@mui/icons-material/CenterFocusStrong'\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\nimport { autorun } from 'mobx'\nimport { addDisposer, isAlive, types } from 'mobx-state-tree'\n\nimport FeatureDensityMixin from './FeatureDensityMixin'\nimport TrackHeightMixin from './TrackHeightMixin'\nimport configSchema from './configSchema'\nimport BlockState from './serverSideRenderedBlock'\n\nimport type { LinearGenomeViewModel } from '../../LinearGenomeView'\nimport type { ExportSvgOptions } from '../../LinearGenomeView/types'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type { AnyReactComponentType, Feature } from '@jbrowse/core/util'\nimport type { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport type { ThemeOptions } from '@mui/material'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst Tooltip = lazy(() => import('../components/Tooltip'))\n\ntype LGV = LinearGenomeViewModel\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nexport interface ExportSvgDisplayOptions extends ExportSvgOptions {\n  overrideHeight: number\n  theme: ThemeOptions\n}\n\n/**\n * #stateModel BaseLinearDisplay\n * #category display\n *\n * BaseLinearDisplay is used as the basis for many linear genome view tracks.\n * It is block based, and can use 'static blocks' or 'dynamic blocks'\n *\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nfunction stateModelFactory() {\n  return types\n    .compose(\n      'BaseLinearDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         * updated via autorun\n         */\n        blockState: types.map(BlockState),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      featureIdUnderMouse: undefined as undefined | string,\n      /**\n       * #volatile\n       */\n      contextMenuFeature: undefined as undefined | Feature,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * if a display-level message should be displayed instead of the blocks,\n       * make this return a react component\n       */\n      get DisplayMessageComponent(): undefined | React.FC<any> {\n        return undefined\n      },\n      /**\n       * #getter\n       */\n      get blockType(): 'staticBlocks' | 'dynamicBlocks' {\n        return 'staticBlocks'\n      },\n      /**\n       * #getter\n       */\n      get blockDefinitions() {\n        const view = getContainingView(self) as LGV\n        if (!view.initialized) {\n          throw new Error('view not initialized yet')\n        }\n        return view[this.blockType]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * how many milliseconds to wait for the display to\n       * \"settle\" before re-rendering a block\n       */\n      get renderDelay() {\n        return 50\n      },\n\n      /**\n       * #getter\n       */\n      get TooltipComponent(): AnyReactComponentType {\n        return Tooltip as AnyReactComponentType\n      },\n\n      /**\n       * #getter\n       * returns a string feature ID if the globally-selected object\n       * is probably a feature\n       */\n      get selectedFeatureId() {\n        if (isAlive(self)) {\n          const { selection } = getSession(self)\n          // does it quack like a feature?\n          if (isFeature(selection)) {\n            return selection.id()\n          }\n        }\n        return undefined\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       */\n      get features() {\n        const featureMaps = []\n        for (const block of self.blockState.values()) {\n          if (block.features) {\n            featureMaps.push(block.features)\n          }\n        }\n        return new CompositeMap(featureMaps)\n      },\n\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        const feat = self.featureIdUnderMouse\n        return feat ? this.features.get(feat) : undefined\n      },\n\n      /**\n       * #getter\n       */\n      getFeatureOverlapping(\n        blockKey: string,\n        x: number,\n        y: number,\n      ): string | undefined {\n        return self.blockState.get(blockKey)?.layout?.getByCoord(x, y)\n      },\n\n      /**\n       * #getter\n       */\n      getFeatureByID(blockKey: string, id: string): LayoutRecord | undefined {\n        return self.blockState.get(blockKey)?.layout?.getByID(id)\n      },\n\n      /**\n       * #getter\n       */\n      searchFeatureByID(id: string): LayoutRecord | undefined {\n        let ret: LayoutRecord | undefined\n        for (const block of self.blockState.values()) {\n          const val = block.layout?.getByID(id)\n          if (val) {\n            ret = val\n          }\n        }\n        return ret\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addBlock(key: string, block: BaseBlock) {\n        self.blockState.set(\n          key,\n          BlockState.create({\n            key,\n            region: block.toRegion(),\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      deleteBlock(key: string) {\n        self.blockState.delete(key)\n      },\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const { rpcManager } = session\n          const sessionId = getRpcSessionId(self)\n          const track = getContainingTrack(self)\n          const view = getContainingView(self)\n          const adapterConfig = getConf(track, 'adapter')\n\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          ;(async () => {\n            try {\n              const descriptions = await rpcManager.call(\n                sessionId,\n                'CoreGetMetadata',\n                {\n                  adapterConfig,\n                },\n              )\n              session.showWidget(\n                session.addWidget('BaseFeatureWidget', 'baseFeature', {\n                  featureData: feature.toJSON(),\n                  view,\n                  track,\n                  descriptions,\n                }),\n              )\n            } catch (e) {\n              console.error(e)\n              getSession(e).notifyError(`${e}`, e)\n            }\n          })()\n        }\n\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n\n      /**\n       * #action\n       */\n      navToFeature(feature: Feature) {\n        const view = getContainingView(self) as LGV\n        view.navTo({\n          refName: feature.get('refName'),\n          start: feature.get('start'),\n          end: feature.get('end'),\n        })\n      },\n      /**\n       * #action\n       */\n      clearFeatureSelection() {\n        getSession(self).clearSelection()\n      },\n      /**\n       * #action\n       */\n      setFeatureIdUnderMouse(feature?: string) {\n        self.featureIdUnderMouse = feature\n      },\n\n      /**\n       * #action\n       */\n      setContextMenuFeature(feature?: Feature) {\n        self.contextMenuFeature = feature\n      },\n    }))\n\n    .actions(self => {\n      const { reload: superReload } = self\n\n      return {\n        /**\n         * #action\n         */\n        async reload() {\n          self.setError()\n          self.setCurrStatsBpPerPx(0)\n          self.clearFeatureDensityStats()\n          for (const val of self.blockState.values()) {\n            val.doReload()\n          }\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      /**\n       * #method\n       */\n      trackMenuItems(): MenuItem[] {\n        return []\n      },\n\n      /**\n       * #method\n       */\n      contextMenuItems(): MenuItem[] {\n        return [\n          ...(self.contextMenuFeature\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    if (self.contextMenuFeature) {\n                      self.selectFeature(self.contextMenuFeature)\n                    }\n                  },\n                },\n                {\n                  label: 'Zoom to feature',\n                  icon: CenterFocusStrongIcon,\n                  onClick: () => {\n                    if (self.contextMenuFeature) {\n                      self.navToFeature(self.contextMenuFeature)\n                    }\n                  },\n                },\n              ]\n            : []),\n        ]\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          notReady: !self.featureDensityStatsReady,\n          rpcDriverName: self.rpcDriverName,\n\n          displayModel: self,\n          onFeatureClick(_: unknown, featureId?: string) {\n            const f = featureId || self.featureIdUnderMouse\n            if (!f) {\n              self.clearFeatureSelection()\n            } else {\n              const feature = self.features.get(f)\n              if (feature) {\n                self.selectFeature(feature)\n              }\n            }\n          },\n          onClick() {\n            self.clearFeatureSelection()\n          },\n          // similar to click but opens a menu with further options\n          onFeatureContextMenu(_: unknown, featureId?: string) {\n            const f = featureId || self.featureIdUnderMouse\n            if (!f) {\n              self.clearFeatureSelection()\n            } else {\n              // feature id under mouse passed to context menu\n              self.setContextMenuFeature(self.features.get(f))\n            }\n          },\n\n          onMouseMove(_: unknown, featureId?: string) {\n            self.setFeatureIdUnderMouse(featureId)\n          },\n\n          onMouseLeave(_: unknown) {\n            self.setFeatureIdUnderMouse(undefined)\n          },\n\n          onContextMenu() {\n            self.setContextMenuFeature(undefined)\n            self.clearFeatureSelection()\n          },\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #method\n       */\n      async renderSvg(opts: ExportSvgDisplayOptions) {\n        const { renderBaseLinearDisplaySvg } = await import('./renderSvg')\n        return renderBaseLinearDisplaySvg(self as BaseLinearDisplayModel, opts)\n      },\n      afterAttach() {\n        // watch the parent's blocks to update our block state when they\n        // change, then we recreate the blocks on our own model (creating and\n        // deleting to match the parent blocks)\n        addDisposer(\n          self,\n          autorun(() => {\n            const blocksPresent: Record<string, boolean> = {}\n            const view = getContainingView(self) as LGV\n            if (!view.initialized) {\n              return\n            }\n            for (const block of self.blockDefinitions.contentBlocks) {\n              blocksPresent[block.key] = true\n              if (!self.blockState.has(block.key)) {\n                self.addBlock(block.key, block)\n              }\n            }\n            for (const key of self.blockState.keys()) {\n              if (!blocksPresent[key]) {\n                self.deleteBlock(key)\n              }\n            }\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      // rewrite \"height\" from older snapshots to \"heightPreConfig\", this allows\n      // us to maintain a height \"getter\" going forward\n      // @ts-expect-error\n      const { height, ...rest } = snap\n      return { heightPreConfig: height, ...rest }\n    })\n    .postProcessSnapshot(snap => {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const r = snap as Omit<typeof snap, symbol>\n      const { blockState, ...rest } = r\n      return rest\n    })\n}\n\nexport const BaseLinearDisplay = stateModelFactory()\n\nexport type BaseLinearDisplayStateModel = typeof BaseLinearDisplay\nexport type BaseLinearDisplayModel = Instance<BaseLinearDisplayStateModel>\n","import { getContainingView } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from './Block'\n\nimport type { LinearGenomeViewModel } from '../../LinearGenomeView'\nimport type { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  linearBlocks: {\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    position: 'absolute',\n    minHeight: '100%',\n    display: 'flex',\n  },\n  heightOverflowed: {\n    position: 'absolute',\n    color: 'rgb(77,77,77)',\n    borderBottom: '2px solid rgb(77,77,77)',\n    textShadow: 'white 0px 0px 1px',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    fontWeight: 'bold',\n    textAlign: 'center',\n    zIndex: 999,\n    boxSizing: 'border-box',\n  },\n})\n\nconst RenderedBlocks = observer(function ({\n  model,\n}: {\n  model: BaseLinearDisplayModel\n}) {\n  const { classes } = useStyles()\n  const { blockDefinitions, blockState } = model\n  return (\n    <>\n      {blockDefinitions.map(block => {\n        const key = `${model.id}-${block.key}`\n        if (block.type === 'ContentBlock') {\n          const state = blockState.get(block.key)\n          return (\n            <ContentBlockComponent block={block} key={key}>\n              {state?.ReactComponent ? (\n                <state.ReactComponent model={state} />\n              ) : null}\n              {state?.maxHeightReached ? (\n                <div\n                  className={classes.heightOverflowed}\n                  style={{\n                    top: state.layout.getTotalHeight() - 16,\n                    pointerEvents: 'none',\n                    height: 16,\n                  }}\n                >\n                  Max height reached\n                </div>\n              ) : null}\n            </ContentBlockComponent>\n          )\n        }\n        if (block.type === 'ElidedBlock') {\n          return <ElidedBlockComponent key={key} width={block.widthPx} />\n        }\n        if (block.type === 'InterRegionPaddingBlock') {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={key}\n              width={block.widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        throw new Error(`invalid block type ${JSON.stringify(block)}`)\n      })}\n    </>\n  )\n})\n\nexport { RenderedBlocks }\n\nconst LinearBlocks = observer(function ({\n  model,\n}: {\n  model: BaseLinearDisplayModel\n}) {\n  const { classes } = useStyles()\n  const { blockDefinitions } = model\n  const viewModel = getContainingView(model) as LGV\n  return (\n    <div\n      className={classes.linearBlocks}\n      style={{\n        left: blockDefinitions.offsetPx - viewModel.offsetPx,\n      }}\n    >\n      <RenderedBlocks model={model} />\n    </div>\n  )\n})\n\nexport default LinearBlocks\n","import { Suspense, useRef, useState } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport LinearBlocks from './LinearBlocks'\n\nimport type { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nconst useStyles = makeStyles()({\n  display: {\n    position: 'relative',\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    width: '100%',\n    minHeight: '100%',\n  },\n})\n\ntype Coord = [number, number]\n\nconst BaseLinearDisplay = observer(function (props: {\n  model: BaseLinearDisplayModel\n  children?: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const ref = useRef<HTMLDivElement>(null)\n  const [clientRect, setClientRect] = useState<DOMRect>()\n  const [offsetMouseCoord, setOffsetMouseCoord] = useState<Coord>([0, 0])\n  const [clientMouseCoord, setClientMouseCoord] = useState<Coord>([0, 0])\n  const [contextCoord, setContextCoord] = useState<Coord>()\n  const { model, children } = props\n  const { TooltipComponent, DisplayMessageComponent, height } = model\n  const items = model.contextMenuItems()\n  return (\n    <div\n      ref={ref}\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      className={classes.display}\n      onContextMenu={event => {\n        event.preventDefault()\n        if (contextCoord) {\n          // There's already a context menu open, so close it\n          setContextCoord(undefined)\n        } else if (ref.current) {\n          setContextCoord([event.clientX, event.clientY])\n        }\n      }}\n      onMouseMove={event => {\n        if (!ref.current) {\n          return\n        }\n        const rect = ref.current.getBoundingClientRect()\n        const { left, top } = rect\n        setOffsetMouseCoord([event.clientX - left, event.clientY - top])\n        setClientMouseCoord([event.clientX, event.clientY])\n        setClientRect(rect)\n      }}\n    >\n      {DisplayMessageComponent ? (\n        <DisplayMessageComponent model={model} />\n      ) : (\n        <LinearBlocks {...props} />\n      )}\n      {children}\n\n      <Suspense fallback={null}>\n        <TooltipComponent\n          model={model}\n          height={height}\n          offsetMouseCoord={offsetMouseCoord}\n          clientMouseCoord={clientMouseCoord}\n          clientRect={clientRect}\n          mouseCoord={offsetMouseCoord}\n        />\n      </Suspense>\n\n      <Menu\n        open={Boolean(contextCoord) && items.length > 0}\n        onMenuItemClick={(_, callback) => {\n          callback()\n          setContextCoord(undefined)\n        }}\n        onClose={() => {\n          setContextCoord(undefined)\n          model.setContextMenuFeature(undefined)\n        }}\n        slotProps={{\n          transition: {\n            onExit: () => {\n              setContextCoord(undefined)\n              model.setContextMenuFeature(undefined)\n            },\n          },\n        }}\n        anchorReference=\"anchorPosition\"\n        anchorPosition={\n          contextCoord\n            ? { top: contextCoord[1], left: contextCoord[0] }\n            : undefined\n        }\n        style={{\n          zIndex: theme.zIndex.tooltip,\n        }}\n        menuItems={items}\n      />\n    </div>\n  )\n})\n\nexport default BaseLinearDisplay\n\nexport { default as Tooltip } from './Tooltip'\nexport { default as BlockMsg } from './BlockMsg'\n","import { parseLocString, when } from '@jbrowse/core/util'\n\nimport { handleSelectedRegion } from '../searchUtils'\n\nimport type { LinearGenomeViewModel } from '../LinearGenomeView'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\ntype LGV = LinearGenomeViewModel\n\nexport default function LaunchLinearGenomeViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-LinearGenomeView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      loc,\n      tracks = [],\n      tracklist,\n      nav,\n      highlight,\n    }: {\n      session: AbstractSessionModel\n      assembly?: string\n      loc: string\n      tracks?: string[]\n      tracklist?: boolean\n      nav?: boolean\n      highlight?: string[]\n    }) => {\n      try {\n        const { assemblyManager } = session\n        const view = session.addView('LinearGenomeView', {}) as LGV\n        await when(() => !!view.volatileWidth)\n\n        if (!assembly) {\n          throw new Error(\n            'No assembly provided when launching linear genome view',\n          )\n        }\n\n        const asm = await assemblyManager.waitForAssembly(assembly)\n        if (!asm) {\n          throw new Error(\n            `Assembly \"${assembly}\" not found when launching linear genome view`,\n          )\n        }\n\n        if (tracklist) {\n          view.activateTrackSelector()\n        }\n        if (nav !== undefined) {\n          view.setHideHeader(!nav)\n        }\n        if (highlight !== undefined) {\n          for (const h of highlight) {\n            const p = parseLocString(h, refName =>\n              assemblyManager.isValidRefName(refName, assembly),\n            )\n            const { start, end } = p\n            if (start !== undefined && end !== undefined) {\n              view.addToHighlights({\n                ...p,\n                start,\n                end,\n                assemblyName: assembly,\n              })\n            }\n          }\n        }\n\n        await handleSelectedRegion({\n          input: loc,\n          model: view,\n          assembly: asm,\n        })\n\n        const idsNotFound = [] as string[]\n        for (const track of tracks) {\n          tryTrack(view, track, idsNotFound)\n        }\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notifyError(`${e}`, e)\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: {\n    showTrack: (arg: string) => void\n  },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (/Could not resolve identifier/.exec(`${e}`)) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearBareDisplay\n * #category display\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBareDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport { configSchemaFactory }\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getEnv } from '@jbrowse/core/util'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\n\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearBareDisplay\n * #category display\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBareDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearBareDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n        const config = configBlob as Omit<typeof configBlob, symbol>\n\n        return self.rendererType.configSchema.create(config, getEnv(self))\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            ...getParentRenderProps(self),\n            rpcDriverName: self.rpcDriverName,\n            config: self.rendererConfig,\n          }\n        },\n      }\n    })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearBasicDisplay\n * #category display\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBasicDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import { lazy } from 'react'\n\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getSession } from '@jbrowse/core/util'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport { cast, getEnv, types } from 'mobx-state-tree'\n\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type { Instance } from 'mobx-state-tree'\n\nconst SetMaxHeightDialog = lazy(() => import('./components/SetMaxHeightDialog'))\nconst AddFiltersDialog = lazy(() => import('./components/AddFiltersDialog'))\n\n/**\n * #stateModel LinearBasicDisplay\n * #category display\n * used by `FeatureTrack`, has simple settings like \"show/hide feature labels\",\n * etc.\n *\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBasicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearBasicDisplay'),\n        /**\n         * #property\n         */\n        trackShowLabels: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackShowDescriptions: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackDisplayMode: types.maybe(types.string),\n        /**\n         * #property\n         */\n        trackMaxHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        jexlFilters: types.maybe(types.array(types.string)),\n      }),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get activeFilters() {\n        // config jexlFilters are deferred evaluated so they are prepended with\n        // jexl at runtime rather than being stored with jexl in the config\n        return (\n          self.jexlFilters ??\n          getConf(self, 'jexlFilters').map((r: string) => `jexl:${r}`)\n        )\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n\n      /**\n       * #getter\n       */\n      get showLabels() {\n        return self.trackShowLabels ?? getConf(self, ['renderer', 'showLabels'])\n      },\n\n      /**\n       * #getter\n       */\n      get showDescriptions() {\n        return (\n          self.trackShowDescriptions ??\n          getConf(self, ['renderer', 'showDescriptions'])\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get maxHeight() {\n        return self.trackMaxHeight ?? getConf(self, ['renderer', 'maxHeight'])\n      },\n\n      /**\n       * #getter\n       */\n      get displayMode() {\n        return (\n          self.trackDisplayMode ?? getConf(self, ['renderer', 'displayMode'])\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n        const config = configBlob as Omit<typeof configBlob, symbol>\n\n        return self.rendererType.configSchema.create(\n          {\n            ...config,\n            showLabels: self.showLabels,\n            showDescriptions: self.showDescriptions,\n            displayMode: self.displayMode,\n            maxHeight: self.maxHeight,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setJexlFilters(f?: string[]) {\n        self.jexlFilters = cast(f)\n      },\n      /**\n       * #action\n       */\n      toggleShowLabels() {\n        self.trackShowLabels = !self.showLabels\n      },\n      /**\n       * #action\n       */\n      toggleShowDescriptions() {\n        self.trackShowDescriptions = !self.showDescriptions\n      },\n      /**\n       * #action\n       */\n      setDisplayMode(val: string) {\n        self.trackDisplayMode = val\n      },\n      /**\n       * #action\n       */\n      setMaxHeight(val?: number) {\n        self.trackMaxHeight = val\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const superProps = superRenderProps()\n          return {\n            ...(superProps as Omit<typeof superProps, symbol>),\n            config: self.rendererConfig,\n            filters: new SerializableFilterChain({\n              filters: self.activeFilters,\n            }),\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems(): MenuItem[] {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show labels',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showLabels,\n              onClick: () => {\n                self.toggleShowLabels()\n              },\n            },\n            {\n              label: 'Show descriptions',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showDescriptions,\n              onClick: () => {\n                self.toggleShowDescriptions()\n              },\n            },\n            {\n              label: 'Display mode',\n              icon: VisibilityIcon,\n              subMenu: [\n                'compact',\n                'reducedRepresentation',\n                'normal',\n                'collapse',\n              ].map(val => ({\n                label: val,\n                onClick: () => {\n                  self.setDisplayMode(val)\n                },\n              })),\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetMaxHeightDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n            {\n              label: 'Edit filters',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  AddFiltersDialog,\n                  {\n                    model: self,\n                    handleClose,\n                  },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n}\n\nexport type FeatureTrackStateModel = ReturnType<typeof stateModelFactory>\nexport type FeatureTrackModel = Instance<FeatureTrackStateModel>\n\nexport default stateModelFactory\n","import ArrowBackIcon from '@mui/icons-material/ArrowBack'\nimport ArrowForwardIcon from '@mui/icons-material/ArrowForward'\nimport { Button, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nimport { SPACING } from '../consts'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\nconst useStyles = makeStyles()(theme => ({\n  panButton: {\n    background: alpha(theme.palette.background.paper, 0.8),\n    color: theme.palette.text.primary,\n    margin: SPACING,\n  },\n}))\n\nexport default function HeaderPanControls({ model }: { model: LGV }) {\n  const { classes } = useStyles()\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => {\n          model.slide(-0.9)\n        }}\n      >\n        <ArrowBackIcon />\n      </Button>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => {\n          model.slide(0.9)\n        }}\n      >\n        <ArrowForwardIcon />\n      </Button>\n    </>\n  )\n}\n","import { getBpDisplayStr } from '@jbrowse/core/util'\nimport { Typography } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()({\n  bp: {\n    display: 'flex',\n    alignItems: 'center',\n    marginLeft: 5,\n    cursor: 'pointer',\n  },\n})\n\nconst HeaderRegionWidth = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const { coarseTotalBp } = model\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.bp}>\n      {getBpDisplayStr(coarseTotalBp)}\n    </Typography>\n  )\n})\n\nexport default HeaderRegionWidth\n","import { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport { IconButton } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()(theme => ({\n  toggleButton: {\n    height: 44,\n    border: 'none',\n    marginLeft: theme.spacing(4),\n  },\n}))\n\nconst HeaderTrackSelectorButton = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  return (\n    <IconButton\n      onClick={model.activateTrackSelector}\n      className={classes.toggleButton}\n      title=\"Open track selector\"\n      value=\"track_select\"\n    >\n      <TrackSelectorIcon />\n    </IconButton>\n  )\n})\n\nexport default HeaderTrackSelectorButton\n","import { lazy, useEffect, useState } from 'react'\n\nimport CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { getBpDisplayStr, getSession } from '@jbrowse/core/util'\nimport MoreVert from '@mui/icons-material/MoreVert'\nimport ZoomIn from '@mui/icons-material/ZoomIn'\nimport ZoomOut from '@mui/icons-material/ZoomOut'\nimport { IconButton, Slider, Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { SliderValueLabelProps } from '@mui/material'\n\n// lazies\nconst RegionWidthEditorDialog = lazy(() => import('./RegionWidthEditorDialog'))\n\nconst useStyles = makeStyles()(theme => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  slider: {\n    width: 100,\n    color: theme.palette.text.secondary,\n  },\n}))\nfunction ValueLabelComponent(props: SliderValueLabelProps) {\n  const { children, open, value } = props\n  return (\n    <Tooltip\n      open={open}\n      enterTouchDelay={0}\n      placement=\"top\"\n      title={value}\n      arrow\n    >\n      {children}\n    </Tooltip>\n  )\n}\nconst HeaderZoomControls = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const { width, maxBpPerPx, minBpPerPx, bpPerPx } = model\n  const [value, setValue] = useState(-Math.log2(bpPerPx) * 100)\n  useEffect(() => {\n    setValue(-Math.log2(bpPerPx) * 100)\n  }, [bpPerPx])\n  const zoomInDisabled = bpPerPx <= minBpPerPx + 0.0001\n  const zoomOutDisabled = bpPerPx >= maxBpPerPx - 0.0001\n  return (\n    <div className={classes.container}>\n      <Tooltip title=\"Zoom out 2x\">\n        <span>\n          <IconButton\n            data-testid=\"zoom_out\"\n            disabled={zoomOutDisabled}\n            onClick={() => {\n              model.zoom(bpPerPx * 2)\n            }}\n          >\n            <ZoomOut />\n          </IconButton>\n        </span>\n      </Tooltip>\n\n      <Slider\n        size=\"small\"\n        className={classes.slider}\n        value={value}\n        min={-Math.log2(maxBpPerPx) * 100}\n        max={-Math.log2(minBpPerPx) * 100}\n        onChangeCommitted={() => model.zoomTo(2 ** (-value / 100))}\n        valueLabelDisplay=\"auto\"\n        valueLabelFormat={newValue =>\n          `Window size: ${getBpDisplayStr(2 ** (-newValue / 100) * width)}`\n        }\n        slots={{\n          valueLabel: ValueLabelComponent,\n        }}\n        onChange={(_, val) => {\n          setValue(val)\n        }}\n      />\n      <Tooltip title=\"Zoom in 2x\">\n        <span>\n          <IconButton\n            data-testid=\"zoom_in\"\n            disabled={zoomInDisabled}\n            onClick={() => {\n              model.zoom(model.bpPerPx / 2)\n            }}\n          >\n            <ZoomIn />\n          </IconButton>\n        </span>\n      </Tooltip>\n\n      <CascadingMenuButton\n        menuItems={[\n          ...[100, 50, 10].map(r => ({\n            label: `Zoom in ${r}x`,\n            onClick: () => {\n              model.zoom(model.bpPerPx / r)\n            },\n          })),\n          ...[10, 50, 100].map(r => ({\n            label: `Zoom out ${r}x`,\n            onClick: () => {\n              model.zoom(model.bpPerPx * r)\n            },\n          })),\n          {\n            label: 'Custom zoom',\n            onClick: () => {\n              getSession(model).queueDialog(handleClose => [\n                RegionWidthEditorDialog,\n                {\n                  model,\n                  handleClose,\n                },\n              ])\n            },\n          },\n        ]}\n      >\n        <MoreVert />\n      </CascadingMenuButton>\n    </div>\n  )\n})\n\nexport default HeaderZoomControls\n","import { getSession, notEmpty } from '@jbrowse/core/util'\nimport { colord } from '@jbrowse/core/util/colord'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '../model'\nimport type { SessionWithWidgets } from '@jbrowse/core/util'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  highlight: {\n    height: '100%',\n    position: 'absolute',\n    background: colord(theme.palette.highlight.main).alpha(0.35).toRgbString(),\n    borderLeft: `1px solid ${theme.palette.highlight.main}`,\n    borderRight: `1px solid ${theme.palette.highlight.main}`,\n  },\n}))\n\nconst OverviewHighlight = observer(function OverviewHighlight({\n  model,\n  overview,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n}) {\n  const { classes } = useStyles()\n  const { highlight, cytobandOffset } = model\n\n  const session = getSession(model) as SessionWithWidgets\n  const { assemblyManager } = session\n  return highlight\n    .map(r => {\n      const asm = assemblyManager.get(r.assemblyName)\n      const refName = asm?.getCanonicalRefName(r.refName) ?? r.refName\n      const s = overview.bpToPx({\n        ...r,\n        refName,\n        coord: r.start,\n      })\n      const e = overview.bpToPx({\n        ...r,\n        refName,\n        coord: r.end,\n      })\n      return s !== undefined && e !== undefined\n        ? {\n            width: Math.abs(e - s),\n            left: s + cytobandOffset,\n          }\n        : undefined\n    })\n    .filter(notEmpty)\n    .map(({ left, width }, idx) => (\n      <div\n        /* biome-ignore lint/suspicious/noArrayIndexKey: */\n        key={`${left}_${width}_${idx}`}\n        className={classes.highlight}\n        style={{\n          width: width,\n          left: left,\n        }}\n      />\n    ))\n})\n\nexport default OverviewHighlight\n","import { getSession, stringify } from '@jbrowse/core/util'\nimport { Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  guide: {\n    pointerEvents: 'none',\n    height: '100%',\n    width: 1,\n    position: 'absolute',\n  },\n})\n\nconst OverviewRubberbandHoverTooltip = observer(function ({\n  model,\n  open,\n  guideX,\n  overview,\n}: {\n  model: LGV\n  open: boolean\n  guideX: number\n  overview: Base1DViewModel\n}) {\n  const { classes } = useStyles()\n  const { cytobandOffset } = model\n  const { assemblyManager } = getSession(model)\n\n  const px = overview.pxToBp(guideX - cytobandOffset)\n  const assembly = assemblyManager.get(px.assemblyName)\n  const cytoband = assembly?.cytobands?.find(\n    f =>\n      px.coord > f.get('start') &&\n      px.coord < f.get('end') &&\n      px.refName === assembly.getCanonicalRefName(f.get('refName')),\n  )\n\n  return (\n    <Tooltip\n      open={open}\n      placement=\"top\"\n      title={[stringify(px), cytoband?.get('name'), cytoband?.get('type')].join(\n        ' ',\n      )}\n      arrow\n    >\n      <div className={classes.guide} style={{ left: guideX }} />\n    </Tooltip>\n  )\n})\n\nexport default OverviewRubberbandHoverTooltip\n","import { useEffect, useRef, useState } from 'react'\n\nimport { getSession } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport OverviewRubberbandHoverTooltip from './OverviewRubberbandHoverTooltip'\nimport RubberbandSpan from './RubberbandSpan'\nimport { getRelativeX } from './util'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  rubberbandControl: {\n    cursor: 'crosshair',\n    width: '100%',\n    minHeight: 8,\n  },\n  rel: {\n    position: 'relative',\n  },\n})\n\nconst OverviewRubberband = observer(function OverviewRubberband({\n  model,\n  overview,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  ControlComponent?: React.ReactElement\n}) {\n  const { cytobandOffset } = model\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [guideX, setGuideX] = useState<number>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const { classes } = useStyles()\n  const mouseDragging = startX !== undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      const ref = controlsRef.current\n      if (ref && mouseDragging) {\n        setCurrentX(getRelativeX(event, ref))\n      }\n    }\n\n    function globalMouseUp() {\n      // click and drag\n      if (startX !== undefined && currentX !== undefined) {\n        if (Math.abs(currentX - startX) > 3) {\n          const left = Math.min(startX, currentX)\n          const right = Math.max(startX, currentX)\n          model.moveTo(\n            overview.pxToBp(left - cytobandOffset),\n            overview.pxToBp(right - cytobandOffset),\n          )\n        }\n      }\n\n      // just a click\n      if (startX !== undefined && currentX === undefined) {\n        const click = overview.pxToBp(startX - cytobandOffset)\n        if (!click.refName) {\n          getSession(model).notify('unknown position clicked')\n          console.error('unknown position clicked', click)\n        } else {\n          model.centerAt(Math.round(click.coord), click.refName, click.index)\n        }\n      }\n      setStartX(undefined)\n      setCurrentX(undefined)\n\n      if (startX !== undefined) {\n        setGuideX(undefined)\n      }\n    }\n\n    function globalKeyDown(event: KeyboardEvent) {\n      if (event.key === 'Escape') {\n        setStartX(undefined)\n        setCurrentX(undefined)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      window.addEventListener('keydown', globalKeyDown, true)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n        window.removeEventListener('keydown', globalKeyDown, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, currentX, startX, model, overview, cytobandOffset])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    setStartX(getRelativeX(event, controlsRef.current))\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    setGuideX(getRelativeX(event, controlsRef.current))\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  if (startX === undefined) {\n    return (\n      <div className={classes.rel}>\n        {guideX !== undefined ? (\n          <OverviewRubberbandHoverTooltip\n            model={model}\n            open={!mouseDragging}\n            overview={overview}\n            guideX={guideX}\n          />\n        ) : null}\n        <div\n          className={classes.rubberbandControl}\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </div>\n    )\n  }\n\n  let left = startX || 0\n  let width = 0\n  if (currentX !== undefined) {\n    left = Math.min(currentX, startX)\n    width = currentX - startX\n  }\n  // calculate the start and end bp of drag\n  let leftBpOffset: ReturnType<typeof overview.pxToBp> | undefined\n  let rightBpOffset: ReturnType<typeof overview.pxToBp> | undefined\n  if (startX) {\n    leftBpOffset = overview.pxToBp(startX - cytobandOffset)\n    rightBpOffset = overview.pxToBp(startX + width - cytobandOffset)\n    if (currentX !== undefined && currentX < startX) {\n      ;[leftBpOffset, rightBpOffset] = [rightBpOffset, leftBpOffset]\n    }\n  }\n\n  return (\n    <div className={classes.rel}>\n      {leftBpOffset && rightBpOffset ? (\n        <RubberbandSpan\n          leftBpOffset={leftBpOffset}\n          rightBpOffset={rightBpOffset}\n          width={Math.abs(width)}\n          left={left}\n        />\n      ) : null}\n      <div\n        data-testid=\"rubberband_controls\"\n        className={classes.rubberbandControl}\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n    </div>\n  )\n})\n\nexport default OverviewRubberband\n","import { getSession, getTickDisplayStr } from '@jbrowse/core/util'\nimport { Typography } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\n// core\nimport { HEADER_OVERVIEW_HEIGHT } from '../consts'\nimport { chooseGridPitch } from '../util'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport type { ContentBlock } from '@jbrowse/core/util/blockTypes'\n\nconst useStyles = makeStyles()({\n  scalebarLabel: {\n    height: HEADER_OVERVIEW_HEIGHT,\n    position: 'absolute',\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n})\n\nconst OverviewScalebarTickLabels = observer(function ({\n  block,\n  scale,\n  overview,\n  model,\n}: {\n  model: LinearGenomeViewModel\n  scale: number\n  block: ContentBlock\n  overview: Base1DViewModel\n}) {\n  const { classes } = useStyles()\n  const { start, end, reversed, refName, assemblyName } = block\n  const { majorPitch } = chooseGridPitch(scale, 120, 15)\n  const { assemblyManager } = getSession(model)\n  const assembly = assemblyManager.get(assemblyName)\n  const refNameColor = assembly?.getRefNameColor(refName)\n\n  const tickLabels = []\n  for (let i = 0; i < Math.floor((end - start) / majorPitch); i++) {\n    const offsetLabel = (i + 1) * majorPitch\n    tickLabels.push(reversed ? end - offsetLabel : start + offsetLabel)\n  }\n  return tickLabels.map((tickLabel, labelIdx) => (\n    <Typography\n      key={`${JSON.stringify(block)}-${tickLabel}-${labelIdx}`}\n      className={classes.scalebarLabel}\n      variant=\"body2\"\n      style={{\n        left: ((labelIdx + 1) * majorPitch) / scale,\n        pointerEvents: 'none',\n        color: refNameColor,\n      }}\n    >\n      {getTickDisplayStr(tickLabel, overview.bpPerPx)}\n    </Typography>\n  ))\n})\n\nexport default OverviewScalebarTickLabels\n","import { useMemo } from 'react'\n\n// core\nimport { getEnv, getSession } from '@jbrowse/core/util'\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport { Typography, alpha, useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport Cytobands from './Cytobands'\nimport OverviewHighlight from './OverviewHighlight'\nimport OverviewRubberband from './OverviewRubberband'\nimport OverviewScalebarPolygon from './OverviewScalebarPolygon'\nimport OverviewScalebarTickLabels from './OverviewScalebarTickLabels'\nimport { getCytobands } from './util'\nimport { HEADER_BAR_HEIGHT, HEADER_OVERVIEW_HEIGHT } from '../consts'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport type { ContentBlock } from '@jbrowse/core/util/blockTypes'\n\nconst wholeSeqSpacer = 2\n\nconst useStyles = makeStyles()(theme => ({\n  scalebar: {\n    height: HEADER_OVERVIEW_HEIGHT,\n  },\n  scalebarBorder: {\n    border: '1px solid',\n  },\n  scalebarContig: {\n    backgroundColor: theme.palette.background.default,\n    position: 'absolute',\n    top: 0,\n    height: HEADER_OVERVIEW_HEIGHT,\n    overflow: 'hidden',\n  },\n  scalebarContigForward: {\n    backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='${theme.palette.divider}'/%3E%3C/svg%3E\")`,\n    backgroundRepeat: 'repeat',\n  },\n  scalebarContigReverse: {\n    backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='${theme.palette.divider}'/%3E%3C/svg%3E\")`,\n    backgroundRepeat: 'repeat',\n  },\n\n  scalebarRefName: {\n    position: 'absolute',\n    fontWeight: 'bold',\n    pointerEvents: 'none',\n    zIndex: 100,\n  },\n  scalebarVisibleRegion: {\n    position: 'absolute',\n    height: HEADER_OVERVIEW_HEIGHT,\n    pointerEvents: 'none',\n    zIndex: 100,\n    border: '1px solid',\n  },\n  overview: {\n    height: HEADER_BAR_HEIGHT,\n    position: 'relative',\n  },\n  overviewSvg: {\n    pointerEvents: 'none',\n    width: '100%',\n    position: 'absolute',\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nconst OverviewBox = observer(function ({\n  scale,\n  model,\n  block,\n  overview,\n}: {\n  scale: number\n  model: LGV\n  block: ContentBlock\n  overview: Base1DViewModel\n}) {\n  const { classes, cx } = useStyles()\n  const theme = useTheme()\n  const { cytobandOffset, showCytobands } = model\n  const { reversed, refName, assemblyName } = block\n  const { assemblyManager } = getSession(model)\n  const assembly = assemblyManager.get(assemblyName)\n  const refNameColor = assembly?.getRefNameColor(refName)\n\n  const canDisplayCytobands =\n    showCytobands && getCytobands(assembly, block.refName).length\n\n  return (\n    <div>\n      {/* name of sequence */}\n      <Typography\n        style={{\n          left: block.offsetPx + 3,\n          color: canDisplayCytobands\n            ? theme.palette.text.primary\n            : refNameColor,\n        }}\n        className={classes.scalebarRefName}\n      >\n        {refName}\n      </Typography>\n      <div\n        className={cx(\n          classes.scalebarContig,\n          canDisplayCytobands\n            ? undefined\n            : reversed\n              ? classes.scalebarContigReverse\n              : classes.scalebarContigForward,\n          !canDisplayCytobands ? classes.scalebarBorder : undefined,\n        )}\n        style={{\n          left: block.offsetPx + cytobandOffset,\n          width: block.widthPx,\n          borderColor: refNameColor,\n        }}\n      >\n        {canDisplayCytobands ? (\n          <svg style={{ width: '100%' }}>\n            <Cytobands overview={overview} assembly={assembly} block={block} />\n          </svg>\n        ) : (\n          <OverviewScalebarTickLabels\n            model={model}\n            overview={overview}\n            scale={scale}\n            block={block}\n          />\n        )}\n      </div>\n    </div>\n  )\n})\n\nconst Scalebar = observer(function ({\n  model,\n  scale,\n  overview,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  scale: number\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const { dynamicBlocks, showCytobands, cytobandOffset } = model\n  const { pluginManager } = getEnv(model)\n  const visibleRegions = dynamicBlocks.contentBlocks\n  const overviewVisibleRegions = overview.dynamicBlocks\n  const scalebarColor = theme.palette.tertiary.light\n  // catches possible null from at's below\n  if (!visibleRegions.length) {\n    return null\n  }\n\n  const first = visibleRegions.at(0)!\n  const last = visibleRegions.at(-1)!\n\n  const firstOverviewPx =\n    overview.bpToPx({\n      // eslint-disable-next-line @typescript-eslint/no-misused-spread\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0\n\n  const lastOverviewPx =\n    overview.bpToPx({\n      // eslint-disable-next-line @typescript-eslint/no-misused-spread\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0\n\n  const color = showCytobands ? '#f00' : scalebarColor\n  const transparency = showCytobands ? 0.1 : 0.3\n\n  const additional = pluginManager.evaluateExtensionPoint(\n    'LinearGenomeView-OverviewScalebarComponent',\n    undefined,\n    { model, overview },\n  ) as React.ReactNode\n\n  return (\n    <div className={classes.scalebar}>\n      <div\n        className={classes.scalebarVisibleRegion}\n        style={{\n          width: lastOverviewPx - firstOverviewPx,\n          left: firstOverviewPx + cytobandOffset,\n          background: alpha(color, transparency),\n          borderColor: color,\n        }}\n      />\n      {/* this is the entire scale bar */}\n      {overviewVisibleRegions.map((block, idx) => {\n        return !(block.type === 'ContentBlock') ? (\n          <div\n            key={`${JSON.stringify(block)}-${idx}`}\n            className={classes.scalebarContig}\n            style={{\n              width: block.widthPx,\n              left: block.offsetPx,\n              backgroundColor: '#999',\n              backgroundImage:\n                'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n            }}\n          />\n        ) : (\n          <OverviewBox\n            scale={scale}\n            block={block}\n            model={model}\n            overview={overview}\n            key={`${JSON.stringify(block)}-${idx}`}\n          />\n        )\n      })}\n      <OverviewHighlight model={model} overview={overview} />\n      {additional}\n    </div>\n  )\n})\n\nconst OverviewScalebar = observer(function ({\n  model,\n  children,\n}: {\n  model: LGV\n  children: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  const {\n    minimumBlockWidth,\n    totalBp,\n    width,\n    cytobandOffset,\n    displayedRegions,\n  } = model\n\n  const modWidth = width - cytobandOffset\n  const str = JSON.stringify(displayedRegions)\n  const overview = useMemo(() => {\n    const overview = Base1DView.create({\n      displayedRegions: JSON.parse(str),\n      interRegionPaddingWidth: 0,\n      minimumBlockWidth,\n    })\n\n    overview.setVolatileWidth(modWidth)\n    overview.showAllRegions()\n    return overview\n  }, [str, minimumBlockWidth, modWidth])\n\n  const scale =\n    totalBp / (modWidth - (displayedRegions.length - 1) * wholeSeqSpacer)\n\n  return (\n    <div>\n      <OverviewRubberband\n        model={model}\n        overview={overview}\n        ControlComponent={\n          <Scalebar model={model} overview={overview} scale={scale} />\n        }\n      />\n      <div className={classes.overview}>\n        <svg height={HEADER_BAR_HEIGHT} className={classes.overviewSvg}>\n          <OverviewScalebarPolygon model={model} overview={overview} />\n        </svg>\n        {children}\n      </div>\n    </div>\n  )\n})\n\nexport default OverviewScalebar\n","import { Suspense, lazy, useState } from 'react'\n\nimport HelpIcon from '@mui/icons-material/Help'\nimport SearchIcon from '@mui/icons-material/Search'\nimport { IconButton, InputAdornment } from '@mui/material'\n\n// lazy\nconst HelpDialog = lazy(() => import('./HelpDialog'))\n\nfunction HelpAdornment() {\n  const [isHelpDialogDisplayed, setHelpDialogDisplayed] = useState(false)\n  return (\n    <>\n      <IconButton\n        onClick={() => {\n          setHelpDialogDisplayed(true)\n        }}\n        size=\"small\"\n      >\n        <HelpIcon fontSize=\"small\" />\n      </IconButton>\n      {isHelpDialogDisplayed ? (\n        <Suspense fallback={null}>\n          <HelpDialog\n            handleClose={() => {\n              setHelpDialogDisplayed(false)\n            }}\n          />\n        </Suspense>\n      ) : null}\n    </>\n  )\n}\n\nexport default function EndAdornment({ showHelp }: { showHelp?: boolean }) {\n  return (\n    <>\n      <InputAdornment position=\"end\" style={{ marginRight: 7 }}>\n        <SearchIcon fontSize=\"small\" />\n        {showHelp ? <HelpAdornment /> : null}\n      </InputAdornment>\n    </>\n  )\n}\n","import { getSession } from '@jbrowse/core/util'\nimport { alpha, useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport EndAdornment from './RefNameAutocomplete/EndAdornment'\nimport { fetchResults } from './util'\nimport { handleSelectedRegion, navToOption } from '../../searchUtils'\nimport { SPACING, WIDGET_HEIGHT } from '../consts'\n\nimport type { LinearGenomeViewModel } from '../model'\nimport type BaseResult from '@jbrowse/core/TextSearch/BaseResults'\n\nconst useStyles = makeStyles()({\n  headerRefName: {\n    minWidth: 100,\n  },\n})\n\nasync function onSelect({\n  option,\n  model,\n  assemblyName,\n}: {\n  option: BaseResult\n  model: LinearGenomeViewModel\n  assemblyName: string\n}) {\n  const { assemblyManager } = getSession(model)\n  const assembly = assemblyManager.get(assemblyName)\n  if (option.hasLocation()) {\n    await navToOption({\n      option,\n      model,\n      assemblyName,\n    })\n  } else if (option.results?.length) {\n    model.setSearchResults(option.results, option.getLabel())\n  } else if (assembly) {\n    await handleSelectedRegion({\n      input: option.getLabel(),\n      assembly,\n      model,\n    })\n  }\n}\n\nconst SearchBox = observer(function ({\n  model,\n  showHelp = true,\n}: {\n  showHelp?: boolean\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const session = getSession(model)\n\n  const { textSearchManager, assemblyManager } = session\n  const { assemblyNames, rankSearchResults } = model\n  const assemblyName = assemblyNames[0]!\n  const assembly = assemblyManager.get(assemblyName)\n  const searchScope = model.searchScope(assemblyName)\n\n  return (\n    <RefNameAutocomplete\n      onSelect={async option => {\n        try {\n          await onSelect({\n            model,\n            assemblyName,\n            option,\n          })\n        } catch (e) {\n          console.error(e)\n          getSession(model).notify(`${e}`, 'warning')\n        }\n      }}\n      assemblyName={assemblyName}\n      fetchResults={queryString =>\n        fetchResults({\n          queryString,\n          searchScope,\n          rankSearchResults,\n          textSearchManager,\n          assembly,\n        })\n      }\n      model={model}\n      minWidth={175}\n      TextFieldProps={{\n        variant: 'outlined',\n        className: classes.headerRefName,\n        style: {\n          margin: SPACING,\n        },\n        slotProps: {\n          input: {\n            style: {\n              padding: 0,\n              height: WIDGET_HEIGHT,\n              background: alpha(theme.palette.background.paper, 0.8),\n            },\n            endAdornment: <EndAdornment showHelp={showHelp} />,\n          },\n        },\n      }}\n    />\n  )\n})\n\nexport default SearchBox\n","import { FormGroup } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport HeaderPanControls from './HeaderPanControls'\nimport HeaderRegionWidth from './HeaderRegionWidth'\nimport HeaderTrackSelectorButton from './HeaderTrackSelectorButton'\nimport HeaderZoomControls from './HeaderZoomControls'\nimport OverviewScalebar from './OverviewScalebar'\nimport SearchBox from './SearchBox'\nimport { HEADER_BAR_HEIGHT } from '../consts'\n\nimport type { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()({\n  headerBar: {\n    display: 'flex',\n    height: HEADER_BAR_HEIGHT,\n  },\n  headerForm: {\n    flexWrap: 'nowrap',\n    marginRight: 7,\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n})\n\nconst Controls = function ({ model }: { model: LinearGenomeViewModel }) {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.headerBar}>\n      <HeaderTrackSelectorButton model={model} />\n      <div className={classes.spacer} />\n      <FormGroup row className={classes.headerForm}>\n        <HeaderPanControls model={model} />\n        <SearchBox model={model} />\n      </FormGroup>\n      <HeaderRegionWidth model={model} />\n      <HeaderZoomControls model={model} />\n      <div className={classes.spacer} />\n    </div>\n  )\n}\n\nconst LinearGenomeViewHeader = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { hideHeader, hideHeaderOverview } = model\n  return !hideHeader ? (\n    hideHeaderOverview ? (\n      <Controls model={model} />\n    ) : (\n      <OverviewScalebar model={model}>\n        <Controls model={model} />\n      </OverviewScalebar>\n    )\n  ) : null\n})\n\nexport default LinearGenomeViewHeader\n","import CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { getSession } from '@jbrowse/core/util'\nimport ArrowDown from '@mui/icons-material/KeyboardArrowDown'\nimport ZoomIn from '@mui/icons-material/ZoomIn'\nimport ZoomOut from '@mui/icons-material/ZoomOut'\nimport { IconButton, Paper, alpha } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\nimport type { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()(theme => ({\n  background: {\n    position: 'absolute',\n    right: 0,\n    background: theme.palette.background.paper,\n\n    // needed when sticky header is off in lgv, e.g. in breakpoint split view\n    zIndex: 2,\n  },\n  focusedBackground: {\n    background: alpha(theme.palette.secondary.light, 0.2),\n  },\n}))\n\nconst MiniControls = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const { id, bpPerPx, maxBpPerPx, minBpPerPx, scaleFactor, hideHeader } = model\n  const { focusedViewId } = getSession(model)\n  return hideHeader ? (\n    <Paper className={classes.background}>\n      <Paper\n        className={focusedViewId === id ? classes.focusedBackground : undefined}\n      >\n        <CascadingMenuButton menuItems={model.menuItems()}>\n          <ArrowDown fontSize=\"small\" />\n        </CascadingMenuButton>\n        <IconButton\n          data-testid=\"zoom_out\"\n          onClick={() => {\n            model.zoom(bpPerPx * 2)\n          }}\n          disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n        >\n          <ZoomOut fontSize=\"small\" />\n        </IconButton>\n        <IconButton\n          data-testid=\"zoom_in\"\n          onClick={() => {\n            model.zoom(bpPerPx / 2)\n          }}\n          disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n        >\n          <ZoomIn fontSize=\"small\" />\n        </IconButton>\n      </Paper>\n    </Paper>\n  ) : null\n})\n\nexport default MiniControls\n","import type React from 'react'\nimport { lazy } from 'react'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { VIEW_HEADER_HEIGHT } from '@jbrowse/core/ui'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  assembleLocString,\n  clamp,\n  findLast,\n  getSession,\n  isSessionModelWithWidgets,\n  isSessionWithAddTracks,\n  localStorageGetBoolean,\n  localStorageGetItem,\n  localStorageSetItem,\n  measureText,\n  springAnimate,\n  sum,\n} from '@jbrowse/core/util'\nimport { bpToPx, moveTo, pxToBp } from '@jbrowse/core/util/Base1DUtils'\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport calculateStaticBlocks from '@jbrowse/core/util/calculateStaticBlocks'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { isSessionWithMultipleViews } from '@jbrowse/product-core'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport LabelIcon from '@mui/icons-material/Label'\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\nimport SearchIcon from '@mui/icons-material/Search'\nimport SyncAltIcon from '@mui/icons-material/SyncAlt'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport ZoomInIcon from '@mui/icons-material/ZoomIn'\nimport { saveAs } from 'file-saver'\nimport { autorun, transaction, when } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  getRoot,\n  getSnapshot,\n  resolveIdentifier,\n  types,\n} from 'mobx-state-tree'\n\nimport Header from './components/Header'\nimport {\n  calculateVisibleLocStrings,\n  generateLocations,\n  parseLocStrings,\n} from './util'\nimport { handleSelectedRegion } from '../searchUtils'\nimport MiniControls from './components/MiniControls'\nimport {\n  HEADER_BAR_HEIGHT,\n  HEADER_OVERVIEW_HEIGHT,\n  INTER_REGION_PADDING_WIDTH,\n  RESIZE_HANDLE_HEIGHT,\n  SCALE_BAR_HEIGHT,\n} from './consts'\n\nimport type {\n  BpOffset,\n  ExportSvgOptions,\n  HighlightType,\n  InitState,\n  NavLocation,\n} from './types'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport type { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type { ParsedLocString } from '@jbrowse/core/util'\nimport type { BaseBlock, BlockSet } from '@jbrowse/core/util/blockTypes'\nimport type { Region, Region as IRegion } from '@jbrowse/core/util/types'\nimport type { Instance } from 'mobx-state-tree'\n\n// lazies\nconst ReturnToImportFormDialog = lazy(\n  () => import('@jbrowse/core/ui/ReturnToImportFormDialog'),\n)\nconst SequenceSearchDialog = lazy(\n  () => import('./components/SequenceSearchDialog'),\n)\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\nconst GetSequenceDialog = lazy(() => import('./components/GetSequenceDialog'))\nconst SearchResultsDialog = lazy(\n  () => import('./components/SearchResultsDialog'),\n)\n\n/**\n * #stateModel LinearGenomeView\n * #category view\n *\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'LinearGenomeView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n\n        /**\n         * #property\n         * this is a string instead of the const literal 'LinearGenomeView' to\n         * reduce some typescripting strictness, but you should pass the string\n         * 'LinearGenomeView' to the model explicitly\n         */\n        type: types.literal('LinearGenomeView') as unknown as string,\n\n        /**\n         * #property\n         * corresponds roughly to the horizontal scroll of the LGV\n         */\n        offsetPx: 0,\n\n        /**\n         * #property\n         * corresponds roughly to the zoom level, base-pairs per pixel\n         */\n        bpPerPx: 1,\n\n        /**\n         * #property\n         * currently displayed regions, can be a single chromosome, arbitrary\n         * subsections, or the entire  set of chromosomes in the genome, but it not\n         * advised to use the entire set of chromosomes if your assembly is very\n         * fragmented\n         */\n        displayedRegions: types.optional(types.frozen<IRegion[]>(), []),\n\n        /**\n         * #property\n         * array of currently displayed tracks state models instances\n         */\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        /**\n         * #property\n         */\n        hideHeader: false,\n\n        /**\n         * #property\n         */\n        hideHeaderOverview: false,\n\n        /**\n         * #property\n         */\n        hideNoTracksActive: false,\n\n        /**\n         * #property\n         */\n        trackSelectorType: types.optional(\n          types.enumeration(['hierarchical']),\n          'hierarchical',\n        ),\n        /**\n         * #property\n         * show the \"center line\"\n         */\n        showCenterLine: types.optional(types.boolean, () =>\n          localStorageGetBoolean('lgv-showCenterLine', false),\n        ),\n\n        /**\n         * #property\n         * show the \"cytobands\" in the overview scale bar\n         */\n        showCytobandsSetting: types.optional(types.boolean, () =>\n          localStorageGetBoolean('lgv-showCytobands', true),\n        ),\n\n        /**\n         * #property\n         * how to display the track labels, can be \"overlapping\", \"offset\", or\n         * \"hidden\", or empty string \"\" (which results in conf being used). see\n         * LinearGenomeViewPlugin\n         * https://jbrowse.org/jb2/docs/config/lineargenomeviewplugin/ docs for\n         * how conf is used\n         */\n        trackLabels: types.optional(\n          types.string,\n          () => localStorageGetItem('lgv-trackLabels') || '',\n        ),\n\n        /**\n         * #property\n         * show the \"gridlines\" in the track area\n         */\n        showGridlines: true,\n\n        /**\n         * #property\n         * highlights on the LGV from the URL parameters\n         */\n        highlight: types.optional(\n          types.array(types.frozen<HighlightType>()),\n          [],\n        ),\n\n        /**\n         * #property\n         * color by CDS\n         */\n        colorByCDS: types.optional(types.boolean, () =>\n          localStorageGetBoolean('lgv-colorByCDS', false),\n        ),\n\n        /**\n         * #property\n         * color by CDS\n         */\n        showTrackOutlines: types.optional(types.boolean, () =>\n          localStorageGetBoolean('lgv-showTrackOutlines', true),\n        ),\n        /**\n         * #property\n         * this is a non-serialized property that can be used for loading the\n         * linear genome view via session snapshots\n         * example:\n         * ```json\n         * {\n         *   loc: \"chr1:1,000,000-2,000,000\"\n         *   assembly: \"hg19\"\n         *   tracks: [\"genes\", \"variants\"]\n         * }\n         * ```\n         */\n        init: types.frozen<InitState | undefined>(),\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      volatileWidth: undefined as number | undefined,\n      /**\n       * #volatile\n       */\n      minimumBlockWidth: 3,\n      /**\n       * #volatile\n       */\n      draggingTrackId: undefined as undefined | string,\n      /**\n       * #volatile\n       */\n      volatileError: undefined as unknown,\n\n      /**\n       * #volatile\n       * array of callbacks to run after the next set of the displayedRegions,\n       * which is basically like an onLoad\n       */\n      afterDisplayedRegionsSetCallbacks: [] as (() => void)[],\n      /**\n       * #volatile\n       */\n      scaleFactor: 1,\n      /**\n       * #volatile\n       */\n      trackRefs: {} as Record<string, HTMLDivElement>,\n      /**\n       * #volatile\n       */\n      coarseDynamicBlocks: [] as BaseBlock[],\n      /**\n       * #volatile\n       */\n      coarseTotalBp: 0,\n      /**\n       * #volatile\n       */\n      leftOffset: undefined as undefined | BpOffset,\n      /**\n       * #volatile\n       */\n      rightOffset: undefined as undefined | BpOffset,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get pinnedTracks() {\n        return self.tracks.filter(t => t.pinned)\n      },\n      /**\n       * #getter\n       */\n      get unpinnedTracks() {\n        return self.tracks.filter(t => !t.pinned)\n      },\n      /**\n       * #getter\n       * this is the effective value of the track labels setting, incorporating\n       * both the config and view state. use this instead of view.trackLabels\n       */\n      get trackLabelsSetting() {\n        const sessionSetting = getConf(getSession(self), [\n          'LinearGenomeViewPlugin',\n          'trackLabels',\n        ])\n        return self.trackLabels || sessionSetting\n      },\n      /**\n       * #getter\n       */\n      get width(): number {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'width undefined, make sure to check for model.initialized',\n          )\n        }\n        return self.volatileWidth\n      },\n      /**\n       * #getter\n       */\n      get interRegionPaddingWidth() {\n        return INTER_REGION_PADDING_WIDTH\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        return [\n          ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n        ]\n      },\n      /**\n       * #getter\n       * checking if lgv is a 'top-level' view is used for toggling pin track\n       * capability, sticky positioning\n       */\n      get isTopLevelView() {\n        const session = getSession(self)\n        return session.views.find(r => r.id === self.id)\n      },\n      /**\n       * #getter\n       * only uses sticky view headers when it is a 'top-level' view and\n       * session allows it\n       */\n      get stickyViewHeaders() {\n        const session = getSession(self)\n        return isSessionWithMultipleViews(session)\n          ? this.isTopLevelView && session.stickyViewHeaders\n          : false\n      },\n\n      /**\n       * #getter\n       */\n      get rubberbandTop() {\n        let pinnedTracksTop = 0\n        if (this.stickyViewHeaders) {\n          pinnedTracksTop = VIEW_HEADER_HEIGHT\n          if (!self.hideHeader) {\n            pinnedTracksTop += HEADER_BAR_HEIGHT\n            if (!self.hideHeaderOverview) {\n              pinnedTracksTop += HEADER_OVERVIEW_HEIGHT\n            }\n          }\n        }\n        return pinnedTracksTop\n      },\n\n      get pinnedTracksTop() {\n        return this.rubberbandTop + SCALE_BAR_HEIGHT\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      scaleBarDisplayPrefix() {\n        return getParent<any>(self, 2).type === 'LinearSyntenyView'\n          ? self.assemblyNames[0]\n          : ''\n      },\n      /**\n       * #method\n       */\n\n      MiniControlsComponent(): React.FC<any> {\n        return MiniControls\n      },\n\n      /**\n       * #method\n       */\n\n      HeaderComponent(): React.FC<any> {\n        return Header\n      },\n\n      /**\n       * #getter\n       */\n      get assembliesNotFound() {\n        const { assemblyManager } = getSession(self)\n        const r0 = self.assemblyNames\n          .map(a => (!assemblyManager.get(a) ? a : undefined))\n          .filter(f => !!f)\n          .join(',')\n        return r0 ? `Assemblies ${r0} not found` : undefined\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n\n      /**\n       * #getter\n       */\n      get assembliesInitialized() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames.every(\n          a => assemblyManager.get(a)?.initialized,\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get initialized() {\n        return self.volatileWidth !== undefined && this.assembliesInitialized\n      },\n\n      /**\n       * #getter\n       */\n      get hasDisplayedRegions() {\n        return self.displayedRegions.length > 0\n      },\n\n      /**\n       * #getter\n       */\n      get scaleBarHeight() {\n        return SCALE_BAR_HEIGHT + RESIZE_HANDLE_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get headerHeight() {\n        if (self.hideHeader) {\n          return 0\n        } else if (self.hideHeaderOverview) {\n          return HEADER_BAR_HEIGHT\n        } else {\n          return HEADER_BAR_HEIGHT + HEADER_OVERVIEW_HEIGHT\n        }\n      },\n\n      /**\n       * #getter\n       */\n      get trackHeights() {\n        return sum(self.tracks.map(t => t.displays[0].height))\n      },\n\n      /**\n       * #getter\n       */\n      get trackHeightsWithResizeHandles() {\n        return this.trackHeights + self.tracks.length * RESIZE_HANDLE_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get height() {\n        return (\n          this.trackHeightsWithResizeHandles +\n          this.headerHeight +\n          this.scaleBarHeight\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get totalBp() {\n        return sum(self.displayedRegions.map(r => r.end - r.start))\n      },\n\n      /**\n       * #getter\n       */\n      get maxBpPerPx() {\n        return this.totalBp / (self.width * 0.9)\n      },\n\n      /**\n       * #getter\n       */\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      /**\n       * #getter\n       */\n      get error(): unknown {\n        return (\n          self.volatileError || this.assemblyErrors || this.assembliesNotFound\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get maxOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const leftPadding = 10\n        return this.displayedRegionsTotalPx - leftPadding\n      },\n\n      /**\n       * #getter\n       */\n      get minOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const rightPadding = 30\n        return -self.width + rightPadding\n      },\n\n      /**\n       * #getter\n       */\n      get displayedRegionsTotalPx() {\n        return this.totalBp / self.bpPerPx\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          bpPerPx: self.bpPerPx,\n          colorByCDS: self.colorByCDS,\n        }\n      },\n\n      /**\n       * #method\n       */\n      searchScope(assemblyName: string) {\n        return {\n          assemblyName,\n          includeAggregateIndexes: true,\n          tracks: self.tracks,\n        }\n      },\n\n      /**\n       * #method\n       */\n      getTrack(id: string) {\n        return self.tracks.find(t => t.configuration.trackId === id)\n      },\n\n      /**\n       * #method\n       * does nothing currently\n       */\n      rankSearchResults(results: BaseResult[]) {\n        return results\n      },\n\n      /**\n       * #method\n       * modifies view menu action onClick to apply to all tracks of same type\n       */\n      rewriteOnClicks(trackType: string, viewMenuActions: MenuItem[]) {\n        for (const action of viewMenuActions) {\n          // go to lowest level menu\n          if ('subMenu' in action) {\n            this.rewriteOnClicks(trackType, action.subMenu)\n          }\n          if ('onClick' in action) {\n            const holdOnClick = action.onClick\n            action.onClick = (...args: unknown[]) => {\n              for (const track of self.tracks) {\n                if (track.type === trackType) {\n                  holdOnClick.apply(track, [track, ...args])\n                }\n              }\n            }\n          }\n        }\n      },\n      /**\n       * #getter\n       */\n      get trackTypeActions() {\n        const allActions = new Map<string, MenuItem[]>()\n        for (const track of self.tracks) {\n          const trackInMap = allActions.get(track.type)\n          if (!trackInMap) {\n            const viewMenuActions = structuredClone(track.viewMenuActions)\n            this.rewriteOnClicks(track.type, viewMenuActions)\n            allActions.set(track.type, viewMenuActions)\n          }\n        }\n\n        return allActions\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setShowTrackOutlines(arg: boolean) {\n        self.showTrackOutlines = arg\n      },\n      /**\n       * #action\n       */\n      setColorByCDS(flag: boolean) {\n        self.colorByCDS = flag\n      },\n      /**\n       * #action\n       */\n      setShowCytobands(flag: boolean) {\n        self.showCytobandsSetting = flag\n      },\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n      },\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        self.volatileError = error\n      },\n      /**\n       * #action\n       */\n      setHideHeader(b: boolean) {\n        self.hideHeader = b\n      },\n      /**\n       * #action\n       */\n      setHideHeaderOverview(b: boolean) {\n        self.hideHeaderOverview = b\n      },\n      /**\n       * #action\n       */\n      setHideNoTracksActive(b: boolean) {\n        self.hideNoTracksActive = b\n      },\n      /**\n       * #action\n       */\n      setShowGridlines(b: boolean) {\n        self.showGridlines = b\n      },\n      /**\n       * #action\n       */\n      addToHighlights(highlight: HighlightType) {\n        self.highlight.push(highlight)\n      },\n      /**\n       * #action\n       */\n      setHighlight(highlight?: HighlightType[]) {\n        self.highlight = cast(highlight)\n      },\n      /**\n       * #action\n       */\n      removeHighlight(highlight: HighlightType) {\n        self.highlight.remove(highlight)\n      },\n      /**\n       * #action\n       */\n      scrollTo(offsetPx: number) {\n        const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n        self.offsetPx = newOffsetPx\n        return newOffsetPx\n      },\n\n      /**\n       * #action\n       */\n      zoomTo(bpPerPx: number, offset = self.width / 2, centerAtOffset = false) {\n        const newBpPerPx = clamp(bpPerPx, self.minBpPerPx, self.maxBpPerPx)\n        if (newBpPerPx === self.bpPerPx) {\n          return newBpPerPx\n        }\n        const oldBpPerPx = self.bpPerPx\n\n        if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n          console.warn('zoomTo bpPerPx rounding error')\n          return oldBpPerPx\n        }\n        self.bpPerPx = newBpPerPx\n\n        // tweak the offset so that the center of the view remains at the same\n        // coordinate\n        this.scrollTo(\n          Math.round(\n            ((self.offsetPx + offset) * oldBpPerPx) / newBpPerPx -\n              (centerAtOffset ? self.width / 2 : offset),\n          ),\n        )\n        return newBpPerPx\n      },\n\n      /**\n       * #action\n       * sets offsets of rubberband, used in the get sequence dialog can call\n       * view.getSelectedRegions(view.leftOffset,view.rightOffset) to compute\n       * the selected regions from the offsets\n       */\n      setOffsets(left?: BpOffset, right?: BpOffset) {\n        self.leftOffset = left\n        self.rightOffset = right\n      },\n\n      /**\n       * #action\n       */\n      setSearchResults(\n        searchResults: BaseResult[],\n        searchQuery: string,\n        assemblyName?: string,\n      ) {\n        getSession(self).queueDialog(handleClose => [\n          SearchResultsDialog,\n          {\n            model: self as LinearGenomeViewModel,\n            searchResults,\n            searchQuery,\n            handleClose,\n            assemblyName,\n          },\n        ])\n      },\n\n      /**\n       * #action\n       */\n      setNewView(bpPerPx: number, offsetPx: number) {\n        this.zoomTo(bpPerPx)\n        this.scrollTo(offsetPx)\n      },\n\n      /**\n       * #action\n       */\n      horizontallyFlip() {\n        self.displayedRegions = cast(\n          [...self.displayedRegions]\n            .reverse()\n            .map(region => ({ ...region, reversed: !region.reversed })),\n        )\n        this.scrollTo(self.totalBp / self.bpPerPx - self.offsetPx - self.width)\n      },\n\n      /**\n       * #action\n       */\n      showTrack(\n        trackId: string,\n        initialSnapshot = {},\n        displayInitialSnapshot = {},\n      ) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        if (!conf) {\n          throw new Error(`Could not resolve identifier \"${trackId}\"`)\n        }\n        const trackType = pluginManager.getTrackType(conf?.type)\n        if (!trackType) {\n          throw new Error(`Unknown track type ${conf.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)!\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          supportedDisplays.has(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `Could not find a compatible display for view type ${self.type}`,\n          )\n        }\n\n        const t = self.tracks.filter(t => t.configuration === conf)\n        if (t.length === 0) {\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: conf.type,\n            configuration: conf,\n            displays: [\n              {\n                type: displayConf.type,\n                configuration: displayConf,\n                ...displayInitialSnapshot,\n              },\n            ],\n          })\n          self.tracks.push(track)\n          return track\n        }\n        return t[0]\n      },\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const tracks = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => {\n          for (const track of tracks) {\n            self.tracks.remove(track)\n          }\n        })\n        return tracks.length\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      moveTrackDown(id: string) {\n        const idx = self.tracks.findIndex(v => v.id === id)\n        if (idx === -1) {\n          return\n        }\n\n        if (idx !== -1 && idx < self.tracks.length - 1) {\n          self.tracks.splice(idx, 2, self.tracks[idx + 1], self.tracks[idx])\n        }\n      },\n      /**\n       * #action\n       */\n      moveTrackUp(id: string) {\n        const idx = self.tracks.findIndex(track => track.id === id)\n        if (idx > 0) {\n          self.tracks.splice(idx - 1, 2, self.tracks[idx], self.tracks[idx - 1])\n        }\n      },\n      /**\n       * #action\n       */\n      moveTrackToTop(id: string) {\n        const idx = self.tracks.findIndex(track => track.id === id)\n        self.tracks = cast([\n          self.tracks[idx],\n          ...self.tracks.filter(track => track.id !== id),\n        ])\n      },\n      /**\n       * #action\n       */\n      moveTrackToBottom(id: string) {\n        const idx = self.tracks.findIndex(track => track.id === id)\n        self.tracks = cast([\n          ...self.tracks.filter(track => track.id !== id),\n          self.tracks[idx],\n        ])\n      },\n      /**\n       * #action\n       */\n      moveTrack(movingId: string, targetId: string) {\n        const oldIndex = self.tracks.findIndex(track => track.id === movingId)\n        if (oldIndex === -1) {\n          throw new Error(`Track ID ${movingId} not found`)\n        }\n        const newIndex = self.tracks.findIndex(track => track.id === targetId)\n        if (newIndex === -1) {\n          throw new Error(`Track ID ${targetId} not found`)\n        }\n\n        const tracks = self.tracks.filter((_, idx) => idx !== oldIndex)\n        tracks.splice(newIndex, 0, self.tracks[oldIndex])\n        self.tracks = cast(tracks)\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = self.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          self.showTrack(trackId)\n          return true\n        }\n        return false\n      },\n\n      /**\n       * #action\n       */\n      setTrackLabels(setting: 'overlapping' | 'offset' | 'hidden') {\n        localStorage.setItem('lgv-trackLabels', setting)\n        self.trackLabels = setting\n      },\n\n      /**\n       * #action\n       */\n      setShowCenterLine(b: boolean) {\n        self.showCenterLine = b\n      },\n\n      /**\n       * #action\n       */\n      setDisplayedRegions(regions: Region[]) {\n        self.displayedRegions = cast(regions)\n        self.zoomTo(self.bpPerPx)\n      },\n\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #method\n       * Helper method for the fetchSequence.\n       * Retrieves the corresponding regions that were selected by the\n       * rubberband\n       *\n       * @param leftOffset - `object as {start, end, index, offset}`, offset = start\n       * of user drag\n       * @param rightOffset - `object as {start, end, index, offset}`,\n       * offset = end of user drag\n       * @returns array of Region[]\n       */\n      getSelectedRegions(leftOffset?: BpOffset, rightOffset?: BpOffset) {\n        const snap = getSnapshot(self)\n        const simView = Base1DView.create({\n          ...snap,\n          interRegionPaddingWidth: self.interRegionPaddingWidth,\n        })\n\n        simView.setVolatileWidth(self.width)\n        simView.moveTo(leftOffset, rightOffset)\n\n        return simView.dynamicBlocks.contentBlocks.map(region => ({\n          // eslint-disable-next-line @typescript-eslint/no-misused-spread\n          ...region,\n          start: Math.floor(region.start),\n          end: Math.ceil(region.end),\n        }))\n      },\n\n      /**\n       * #action\n       * schedule something to be run after the next time displayedRegions is\n       * set\n       */\n      afterDisplayedRegionsSet(cb: () => void) {\n        self.afterDisplayedRegionsSetCallbacks.push(cb)\n      },\n\n      /**\n       * #action\n       */\n      horizontalScroll(distance: number) {\n        const oldOffsetPx = self.offsetPx\n        // newOffsetPx is the actual offset after the scroll is clamped\n        const newOffsetPx = self.scrollTo(self.offsetPx + distance)\n        return newOffsetPx - oldOffsetPx\n      },\n\n      /**\n       * #action\n       */\n      center() {\n        const centerBp = self.totalBp / 2\n        const centerPx = centerBp / self.bpPerPx\n        self.scrollTo(Math.round(centerPx - self.width / 2))\n      },\n\n      /**\n       * #action\n       */\n      showAllRegions() {\n        self.zoomTo(self.maxBpPerPx)\n        this.center()\n      },\n\n      /**\n       * #action\n       */\n      showAllRegionsInAssembly(assemblyName?: string) {\n        const session = getSession(self)\n        const { assemblyManager } = session\n        if (!assemblyName) {\n          const names = new Set(self.displayedRegions.map(r => r.assemblyName))\n          if (names.size > 1) {\n            session.notify(\n              `Can't perform operation with multiple assemblies currently`,\n            )\n            return\n          }\n          ;[assemblyName] = [...names]\n        }\n        const assembly = assemblyManager.get(assemblyName!)\n        if (assembly) {\n          const { regions } = assembly\n          if (regions) {\n            this.setDisplayedRegions(regions)\n            self.zoomTo(self.maxBpPerPx)\n            this.center()\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setDraggingTrackId(idx?: string) {\n        self.draggingTrackId = idx\n      },\n\n      /**\n       * #action\n       */\n      setScaleFactor(factor: number) {\n        self.scaleFactor = factor\n      },\n\n      /**\n       * #action\n       * this \"clears the view\" and makes the view return to the import form\n       */\n      clearView() {\n        this.setDisplayedRegions([])\n        self.tracks.clear()\n        // it is necessary to run these after setting displayed regions empty\n        // or else model.offsetPx gets set to Infinity and breaks\n        // mobx-state-tree snapshot\n        self.scrollTo(0)\n        self.zoomTo(10)\n      },\n\n      /**\n       * #action\n       */\n      setInit(arg?: InitState) {\n        self.init = arg\n      },\n\n      /**\n       * #method\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import(\n          './svgcomponents/SVGLinearGenomeView'\n        )\n        const html = await renderToSvg(self as LinearGenomeViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      /**\n       * #action\n       * perform animated slide\n       */\n      function slide(viewWidths: number) {\n        const [animate, cancelAnimation] = springAnimate(\n          self.offsetPx,\n          self.offsetPx + self.width * viewWidths,\n          self.scrollTo,\n          undefined,\n          undefined,\n          200,\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation!\n        animate!()\n      }\n\n      return { slide }\n    })\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      /**\n       * #action\n       * perform animated zoom\n       */\n      function zoom(targetBpPerPx: number) {\n        self.zoomTo(self.bpPerPx)\n        if (\n          // already zoomed all the way in\n          (targetBpPerPx < self.bpPerPx && self.bpPerPx === self.minBpPerPx) ||\n          // already zoomed all the way out\n          (targetBpPerPx > self.bpPerPx && self.bpPerPx === self.maxBpPerPx)\n        ) {\n          return\n        }\n        const factor = self.bpPerPx / targetBpPerPx\n        const [animate, cancelAnimation] = springAnimate(\n          1,\n          factor,\n          self.setScaleFactor,\n          () => {\n            self.zoomTo(targetBpPerPx)\n            self.setScaleFactor(1)\n          },\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation!\n        animate!()\n      }\n\n      return { zoom }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get canShowCytobands() {\n        return self.displayedRegions.length === 1 && this.anyCytobandsExist\n      },\n      /**\n       * #getter\n       */\n      get showCytobands() {\n        return this.canShowCytobands && self.showCytobandsSetting\n      },\n      /**\n       * #getter\n       */\n      get anyCytobandsExist() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames.some(\n          a => assemblyManager.get(a)?.cytobands?.length,\n        )\n      },\n      /**\n       * #getter\n       * the cytoband is displayed to the right of the chromosome name, and\n       * that offset is calculated manually with this method\n       */\n      get cytobandOffset() {\n        return this.showCytobands\n          ? measureText(self.displayedRegions[0]?.refName || '', 12) + 15\n          : 0\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * return the view menu items\n       */\n      menuItems(): MenuItem[] {\n        const { canShowCytobands, showCytobands } = self\n        const session = getSession(self)\n        const menuItems: MenuItem[] = [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          ...(isSessionWithAddTracks(session)\n            ? [\n                {\n                  label: 'Sequence search',\n                  icon: SearchIcon,\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SequenceSearchDialog,\n                      { model: self, handleClose },\n                    ])\n                  },\n                },\n              ]\n            : []),\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                { model: self, handleClose },\n              ])\n            },\n          },\n          {\n            label: 'Open track selector',\n            onClick: self.activateTrackSelector,\n            icon: TrackSelectorIcon,\n          },\n          {\n            label: 'Horizontally flip',\n            icon: SyncAltIcon,\n            onClick: self.horizontallyFlip,\n          },\n          {\n            label: 'Color by CDS',\n            type: 'checkbox',\n            checked: self.colorByCDS,\n            icon: PaletteIcon,\n            onClick: () => {\n              self.setColorByCDS(!self.colorByCDS)\n            },\n          },\n          {\n            label: 'Show...',\n            icon: VisibilityIcon,\n            subMenu: [\n              {\n                label: 'Show all regions in assembly',\n                onClick: self.showAllRegionsInAssembly,\n              },\n              {\n                label: 'Show center line',\n                type: 'checkbox',\n                checked: self.showCenterLine,\n                onClick: () => {\n                  self.setShowCenterLine(!self.showCenterLine)\n                },\n              },\n              {\n                label: 'Show header',\n                type: 'checkbox',\n                checked: !self.hideHeader,\n                onClick: () => {\n                  self.setHideHeader(!self.hideHeader)\n                },\n              },\n\n              {\n                label: 'Show track outlines',\n                type: 'checkbox',\n                checked: self.showTrackOutlines,\n                onClick: () => {\n                  self.setShowTrackOutlines(!self.showTrackOutlines)\n                },\n              },\n              {\n                label: 'Show header overview',\n                type: 'checkbox',\n                checked: !self.hideHeaderOverview,\n                onClick: () => {\n                  self.setHideHeaderOverview(!self.hideHeaderOverview)\n                },\n                disabled: self.hideHeader,\n              },\n              {\n                label: 'Show no tracks active button',\n                type: 'checkbox',\n                checked: !self.hideNoTracksActive,\n                onClick: () => {\n                  self.setHideNoTracksActive(!self.hideNoTracksActive)\n                },\n              },\n              {\n                label: 'Show guidelines',\n                type: 'checkbox',\n                checked: self.showGridlines,\n                onClick: () => {\n                  self.setShowGridlines(!self.showGridlines)\n                },\n              },\n              ...(canShowCytobands\n                ? [\n                    {\n                      label: 'Show ideogram',\n                      type: 'checkbox' as const,\n                      checked: self.showCytobands,\n                      onClick: () => {\n                        self.setShowCytobands(!showCytobands)\n                      },\n                    },\n                  ]\n                : []),\n            ],\n          },\n          {\n            label: 'Track labels',\n            icon: LabelIcon,\n            subMenu: [\n              {\n                label: 'Overlapping',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabelsSetting === 'overlapping',\n                onClick: () => {\n                  self.setTrackLabels('overlapping')\n                },\n              },\n              {\n                label: 'Offset',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabelsSetting === 'offset',\n                onClick: () => {\n                  self.setTrackLabels('offset')\n                },\n              },\n              {\n                label: 'Hidden',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabelsSetting === 'hidden',\n                onClick: () => {\n                  self.setTrackLabels('hidden')\n                },\n              },\n            ],\n          },\n        ]\n\n        // add track's view level menu options\n        for (const [key, value] of self.trackTypeActions.entries()) {\n          if (value.length) {\n            menuItems.push(\n              { type: 'divider' },\n              { type: 'subHeader', label: key },\n            )\n            for (const action of value) {\n              menuItems.push(action)\n            }\n          }\n        }\n\n        return menuItems\n      },\n    }))\n    .views(self => {\n      let currentlyCalculatedStaticBlocks: BlockSet | undefined\n      let stringifiedCurrentlyCalculatedStaticBlocks = ''\n      return {\n        /**\n         * #getter\n         * static blocks are an important concept jbrowse uses to avoid\n         * re-rendering when you scroll to the side. when you horizontally\n         * scroll to the right, old blocks to the left may be removed, and new\n         * blocks may be instantiated on the right. tracks may use the static\n         * blocks to render their data for the region represented by the block\n         */\n        get staticBlocks() {\n          const ret = calculateStaticBlocks(self)\n          const sret = JSON.stringify(ret)\n          if (stringifiedCurrentlyCalculatedStaticBlocks !== sret) {\n            currentlyCalculatedStaticBlocks = ret\n            stringifiedCurrentlyCalculatedStaticBlocks = sret\n          }\n          return currentlyCalculatedStaticBlocks!\n        },\n        /**\n         * #getter\n         * dynamic blocks represent the exact coordinates of the currently\n         * visible genome regions on the screen. they are similar to static\n         * blocks, but static blocks can go offscreen while dynamic blocks\n         * represent exactly what is on screen\n         */\n        get dynamicBlocks() {\n          return calculateDynamicBlocks(self)\n        },\n        /**\n         * #getter\n         * rounded dynamic blocks are dynamic blocks without fractions of bp\n         */\n        get roundedDynamicBlocks() {\n          return this.dynamicBlocks.contentBlocks.map(\n            block =>\n              ({\n                // eslint-disable-next-line @typescript-eslint/no-misused-spread\n                ...block,\n                start: Math.floor(block.start),\n                end: Math.ceil(block.end),\n              }) as BaseBlock,\n          )\n        },\n\n        /**\n         * #getter\n         * a single \"combo-locstring\" representing all the regions visible on\n         * the screen\n         */\n        get visibleLocStrings() {\n          return calculateVisibleLocStrings(this.dynamicBlocks.contentBlocks)\n        },\n\n        /**\n         * #getter\n         * same as visibleLocStrings, but only updated every 300ms\n         */\n        get coarseVisibleLocStrings() {\n          return calculateVisibleLocStrings(self.coarseDynamicBlocks)\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCoarseDynamicBlocks(blocks: BlockSet) {\n        self.coarseDynamicBlocks = blocks.contentBlocks\n        self.coarseTotalBp = blocks.totalBp\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * offset is the base-pair-offset in the displayed region, index is the\n       * index of the displayed region in the linear genome view\n       *\n       * @param start - object as `{start, end, offset, index}`\n       * @param end - object as `{start, end, offset, index}`\n       */\n      moveTo(start?: BpOffset, end?: BpOffset) {\n        moveTo(self, start, end)\n      },\n\n      /**\n       * #action\n       * Navigate to the given locstring, will change displayed regions if\n       * needed, and wait for assemblies to be initialized\n       *\n       * @param input - e.g. \"chr1:1-100\", \"chr1:1-100 chr2:1-100\", \"chr 1 100\"\n       * @param optAssemblyName - (optional) the assembly name to use when\n       * navigating to the locstring\n       */\n      async navToLocString(\n        input: string,\n        optAssemblyName?: string,\n        grow?: number,\n      ) {\n        const { assemblyNames } = self\n        const { assemblyManager } = getSession(self)\n        const assemblyName = optAssemblyName || assemblyNames[0]!\n        if (assemblyName) {\n          await assemblyManager.waitForAssembly(assemblyName)\n        }\n\n        return this.navToLocations(\n          parseLocStrings(input, assemblyName, (ref, asm) =>\n            assemblyManager.isValidRefName(ref, asm),\n          ),\n          assemblyName,\n          grow,\n        )\n      },\n\n      /**\n       * #action\n       * Performs a text index search, and navigates to it immediately if a\n       * single result is returned. Will pop up a search dialog if multiple\n       * results are returned\n       */\n      async navToSearchString({\n        input,\n        assembly,\n      }: {\n        input: string\n        assembly: Assembly\n      }) {\n        await handleSelectedRegion({\n          input,\n          assembly,\n          model: self as LinearGenomeViewModel,\n        })\n      },\n\n      /**\n       * #action\n       * Similar to `navToLocString`, but accepts a parsed location object\n       * instead of a locstring. Will try to perform `setDisplayedRegions` if\n       * changing regions\n       */\n      async navToLocation(\n        parsedLocString: ParsedLocString,\n        assemblyName?: string,\n        grow?: number,\n      ) {\n        return this.navToLocations([parsedLocString], assemblyName, grow)\n      },\n\n      /**\n       * #action\n       * Similar to `navToLocString`, but accepts a list of parsed location\n       * objects instead of a locstring. Will try to perform\n       * `setDisplayedRegions` if changing regions\n       */\n      async navToLocations(\n        regions: ParsedLocString[],\n        assemblyName?: string,\n        grow?: number,\n      ) {\n        const { assemblyManager } = getSession(self)\n        await when(() => self.volatileWidth !== undefined)\n        const locations = await generateLocations({\n          regions,\n          assemblyManager,\n          assemblyName,\n          grow,\n        })\n\n        if (locations.length === 1) {\n          const loc = locations[0]!\n          const { reversed, parentRegion, start, end } = loc\n          self.setDisplayedRegions([{ reversed, ...parentRegion }])\n\n          this.navTo({\n            ...loc,\n            start: clamp(start ?? 0, 0, parentRegion.end),\n            end: clamp(end ?? parentRegion.end, 0, parentRegion.end),\n          })\n        } else {\n          self.setDisplayedRegions(\n            // @ts-expect-error\n            locations.map(r => (r.start === undefined ? r.parentRegion : r)),\n          )\n          self.showAllRegions()\n        }\n      },\n\n      /**\n       * #action\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Will not try to change displayed regions, use\n       * `navToLocations` instead. Only navigates to a location if it is\n       * entirely within a displayedRegion. Navigates to the first matching\n       * location encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param query - a proposed location to navigate to\n       */\n      navTo(query: NavLocation) {\n        this.navToMultiple([query])\n      },\n\n      /**\n       * #action\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Will not try to change displayed regions, use\n       * navToLocations instead. Only navigates to a location if it is entirely\n       * within a displayedRegion. Navigates to the first matching location\n       * encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param locations - proposed location to navigate to\n       */\n      navToMultiple(locations: NavLocation[]) {\n        if (\n          locations.some(\n            l =>\n              l.start !== undefined && l.end !== undefined && l.start > l.end,\n          )\n        ) {\n          throw new Error('found start greater than end')\n        }\n        const f1 = locations.at(0)\n        const f2 = locations.at(-1)\n        if (!f1 || !f2) {\n          return\n        }\n        const a = self.assemblyNames[0]!\n        const { assemblyManager } = getSession(self)\n        const assembly1 = assemblyManager.get(f1.assemblyName || a)\n        const assembly2 = assemblyManager.get(f2.assemblyName || a)\n        const ref1 = assembly1?.getCanonicalRefName(f1.refName) || f1.refName\n        const ref2 = assembly2?.getCanonicalRefName(f2.refName) || f2.refName\n        const r1 = self.displayedRegions.find(r => r.refName === ref1)\n        const r2 = findLast(self.displayedRegions, r => r.refName === ref2)\n        if (!r1) {\n          throw new Error(`could not find a region with refName \"${ref1}\"`)\n        }\n        if (!r2) {\n          throw new Error(`could not find a region with refName \"${ref2}\"`)\n        }\n\n        const s1 = f1.start === undefined ? r1.start : f1.start\n        const e1 = f1.end === undefined ? r1.end : f1.end\n        const s2 = f2.start === undefined ? r2.start : f2.start\n        const e2 = f2.end === undefined ? r2.end : f2.end\n\n        const index = self.displayedRegions.findIndex(\n          r =>\n            ref1 === r.refName &&\n            s1 >= r.start &&\n            s1 <= r.end &&\n            e1 <= r.end &&\n            e1 >= r.start,\n        )\n\n        const index2 = self.displayedRegions.findIndex(\n          r =>\n            ref2 === r.refName &&\n            s2 >= r.start &&\n            s2 <= r.end &&\n            e2 <= r.end &&\n            e2 >= r.start,\n        )\n\n        if (index === -1 || index2 === -1) {\n          throw new Error(\n            `could not find a region that contained \"${locations.map(l =>\n              assembleLocString(l),\n            )}\"`,\n          )\n        }\n\n        const sd = self.displayedRegions[index]!\n        const ed = self.displayedRegions[index2]!\n\n        this.moveTo(\n          {\n            index,\n            offset: sd.reversed ? sd.end - e1 : s1 - sd.start,\n          },\n          {\n            index: index2,\n            offset: ed.reversed ? ed.end - s2 : e2 - ed.start,\n          },\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      rubberBandMenuItems(): MenuItem[] {\n        return [\n          {\n            label: 'Zoom to region',\n            icon: ZoomInIcon,\n            onClick: () => {\n              self.moveTo(self.leftOffset, self.rightOffset)\n            },\n          },\n          {\n            label: 'Get sequence',\n            icon: MenuOpenIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                GetSequenceDialog,\n\n                { model: self as any, handleClose },\n              ])\n            },\n          },\n        ]\n      },\n\n      /**\n       * #method\n       */\n      bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      }: {\n        refName: string\n        coord: number\n        regionNumber?: number\n      }) {\n        return bpToPx({ refName, coord, regionNumber, self })\n      },\n\n      /**\n       * #method\n       * scrolls the view to center on the given bp. if that is not in any of\n       * the displayed regions, does nothing\n       *\n       * @param coord - basepair at which you want to center the view\n       * @param refName - refName of the displayedRegion you are centering at\n       * @param regionNumber - index of the displayedRegion\n       */\n      centerAt(coord: number, refName: string, regionNumber?: number) {\n        const centerPx = this.bpToPx({\n          refName,\n          coord,\n          regionNumber,\n        })\n        if (centerPx !== undefined) {\n          self.scrollTo(Math.round(centerPx.offsetPx - self.width / 2))\n        }\n      },\n\n      /**\n       * #method\n       */\n      pxToBp(px: number) {\n        return pxToBp(self, px)\n      },\n\n      /**\n       * #getter\n       */\n      get centerLineInfo() {\n        return self.displayedRegions.length > 0\n          ? this.pxToBp(self.width / 2)\n          : undefined\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        function handler(e: KeyboardEvent) {\n          const session = getSession(self)\n          if (session.focusedViewId === self.id && (e.ctrlKey || e.metaKey)) {\n            if (e.code === 'ArrowLeft') {\n              e.preventDefault()\n              self.slide(-0.9)\n            } else if (e.code === 'ArrowRight') {\n              e.preventDefault()\n              self.slide(0.9)\n            } else if (e.code === 'ArrowUp' && self.scaleFactor === 1) {\n              e.preventDefault()\n              self.zoom(self.bpPerPx / 2)\n            } else if (e.code === 'ArrowDown' && self.scaleFactor === 1) {\n              e.preventDefault()\n              self.zoom(self.bpPerPx * 2)\n            }\n          }\n        }\n        document.addEventListener('keydown', handler)\n        addDisposer(self, () => {\n          document.removeEventListener('keydown', handler)\n        })\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const { init } = self\n            if (init) {\n              self\n                .navToLocString(init.loc, init.assembly)\n                .catch((e: unknown) => {\n                  getSession(self).notifyError(`${e}`, e)\n                })\n\n              init.tracks?.map(t => self.showTrack(t))\n\n              // clear init state\n              self.setInit(undefined)\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.initialized) {\n                self.setCoarseDynamicBlocks(self.dynamicBlocks)\n              }\n            },\n            { delay: 150 },\n          ),\n        )\n\n        addDisposer(\n          self,\n          autorun(() => {\n            const s = (s: unknown) => JSON.stringify(s)\n            const { showCytobandsSetting, showCenterLine, colorByCDS } = self\n            localStorageSetItem('lgv-showCytobands', s(showCytobandsSetting))\n            localStorageSetItem('lgv-showCenterLine', s(showCenterLine))\n            localStorageSetItem('lgv-colorByCDS', s(colorByCDS))\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { highlight, ...rest } = snap\n      return {\n        highlight:\n          Array.isArray(highlight) || highlight === undefined\n            ? highlight\n            : [highlight],\n        ...rest,\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      } else {\n        const { init, ...rest } = snap as Omit<typeof snap, symbol>\n        return rest\n      }\n    })\n}\n\nexport type LinearGenomeViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearGenomeViewModel = Instance<LinearGenomeViewStateModel>\n\nexport {\n  default as LinearGenomeView,\n  default as ReactComponent,\n} from './components/LinearGenomeView'\n\nexport { default as RefNameAutocomplete } from './components/RefNameAutocomplete'\nexport { default as SearchBox } from './components/SearchBox'\n\nexport { renderToSvg } from './svgcomponents/SVGLinearGenomeView'\n","import Plugin from '@jbrowse/core/Plugin'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { isAbstractMenuManager } from '@jbrowse/core/util'\nimport LineStyleIcon from '@mui/icons-material/LineStyle'\nimport { types } from 'mobx-state-tree'\n\nimport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  baseLinearDisplayConfigSchema,\n} from './BaseLinearDisplay'\nimport BasicTrackF from './BasicTrack'\nimport FeatureTrackF from './FeatureTrack'\nimport LaunchLinearGenomeViewF from './LaunchLinearGenomeView'\nimport LinearBareDisplayF from './LinearBareDisplay'\nimport LinearBasicDisplayF from './LinearBasicDisplay'\nimport LinearGenomeViewF, {\n  LinearGenomeView,\n  SearchBox,\n} from './LinearGenomeView'\nimport ZoomControls from './LinearGenomeView/components/HeaderZoomControls'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nexport default class LinearGenomeViewPlugin extends Plugin {\n  name = 'LinearGenomeViewPlugin'\n\n  exports = {\n    BaseLinearDisplayComponent,\n    BaseLinearDisplay,\n    baseLinearDisplayConfigSchema,\n    SearchBox,\n    ZoomControls,\n    LinearGenomeView,\n  }\n\n  /**\n   * #config LinearGenomeViewConfigSchema\n   */\n  configurationSchema = ConfigurationSchema('LinearGenomeViewConfigSchema', {\n    /**\n     * #slot configuration.LinearGenomeViewPlugin.trackLabels\n     */\n    trackLabels: {\n      type: 'string',\n      defaultValue: 'overlapping',\n      model: types.enumeration('trackLabelOptions', [\n        'offset',\n        'overlapping',\n        'hidden',\n      ]),\n    },\n  })\n\n  install(pluginManager: PluginManager) {\n    FeatureTrackF(pluginManager)\n    BasicTrackF(pluginManager)\n    LinearBasicDisplayF(pluginManager)\n    LinearGenomeViewF(pluginManager)\n    LinearBareDisplayF(pluginManager)\n    LaunchLinearGenomeViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear genome view',\n        icon: LineStyleIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearGenomeView', {})\n        },\n      })\n    }\n  }\n}\n\nexport type {\n  BaseLinearDisplayModel,\n  BlockModel,\n  ExportSvgDisplayOptions,\n} from './BaseLinearDisplay'\n\nexport {\n  configSchemaFactory as linearBareDisplayConfigSchemaFactory,\n  stateModelFactory as linearBareDisplayStateModelFactory,\n} from './LinearBareDisplay'\nexport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  BlockMsg,\n  FeatureDensityMixin,\n  TooLargeMessage,\n  TrackHeightMixin,\n  baseLinearDisplayConfigSchema,\n} from './BaseLinearDisplay'\nexport {\n  type LinearGenomeViewModel,\n  type LinearGenomeViewStateModel,\n  RefNameAutocomplete,\n  SearchBox,\n} from './LinearGenomeView'\nexport {\n  SVGRuler,\n  SVGTracks,\n  renderToSvg,\n} from './LinearGenomeView/svgcomponents/SVGLinearGenomeView'\nexport { totalHeight } from './LinearGenomeView/svgcomponents/util'\nexport {\n  configSchema as linearBasicDisplayConfigSchemaFactory,\n  modelFactory as linearBasicDisplayModelFactory,\n} from './LinearBasicDisplay'\n","import {\n  TrackType,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function FeatureTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'FeatureTrack',\n      displayName: 'Feature track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'FeatureTrack', configSchema),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config FeatureTrack\n * #category track\n * used for basic gene and feature tracks, generally used with LinearBasicDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'FeatureTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'trackId',\n    },\n  )\n\nexport default configSchema\n","import {\n  TrackType,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes'\n\nimport configSchemaF from './configSchema'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function BasicTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n\n    return new TrackType({\n      name: 'BasicTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'BasicTrack', configSchema),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config BasicTrack\n * #category track\n * synonym for FeatureTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'BasicTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n      explicitIdentifier: 'trackId',\n    },\n  )\nexport default configSchema\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\n\nimport { BaseLinearDisplayComponent } from '../BaseLinearDisplay'\nimport configSchema from './configSchema'\nimport modelFactory from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearBasicDisplay(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const config = configSchema(pluginManager)\n    return new DisplayType({\n      name: 'LinearBasicDisplay',\n      displayName: 'Basic feature display',\n      configSchema: config,\n      stateModel: modelFactory(config),\n      trackType: 'FeatureTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n\nexport { default as modelFactory } from './model'\nexport { default as configSchema } from './configSchema'\n","import { lazy } from 'react'\n\nimport { ViewType } from '@jbrowse/core/pluggableElementTypes'\n\nimport { stateModelFactory } from './model'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearGenomeViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearGenomeView',\n      displayName: 'Linear genome view',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearGenomeView')),\n    })\n  })\n}\n\nexport * from './model'\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\n\nimport { configSchemaFactory } from './configSchema'\nimport { stateModelFactory } from './model'\nimport { BaseLinearDisplayComponent } from '../BaseLinearDisplay/'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function LinearBareDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearBareDisplay',\n      configSchema,\n      displayName: 'Bare feature display',\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'BasicTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n\nexport { configSchemaFactory } from './configSchema'\nexport { stateModelFactory } from './model'\n","import { cast, types } from 'mobx-state-tree'\n\nimport { bpToPx, moveTo, pxToBp } from './Base1DUtils'\nimport calculateDynamicBlocks from './calculateDynamicBlocks'\nimport calculateStaticBlocks from './calculateStaticBlocks'\nimport { clamp, sum } from './index'\nimport { ElementId } from './types/mst'\n\nimport type { BpOffset } from './Base1DUtils'\nimport type { Feature } from './simpleFeature'\nimport type { Region as IRegion } from './types'\nimport type { Instance } from 'mobx-state-tree'\n\n/**\n * #stateModel Base1DView\n * used in non-lgv view representations of a 1d view e.g. the two axes of the\n * dotplot use this\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Base1DView = types\n  .model('Base1DView', {\n    /**\n     * #property\n     */\n    id: ElementId,\n    /**\n     * #property\n     */\n    displayedRegions: types.optional(types.frozen<IRegion[]>(), []),\n    /**\n     * #property\n     */\n    bpPerPx: 0,\n    /**\n     * #property\n     */\n    offsetPx: 0,\n    /**\n     * #property\n     */\n    interRegionPaddingWidth: types.optional(types.number, 0),\n    /**\n     * #property\n     */\n    minimumBlockWidth: types.optional(types.number, 0),\n  })\n  .volatile(() => ({\n    features: undefined as undefined | Feature[],\n    volatileWidth: 0,\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setDisplayedRegions(regions: IRegion[]) {\n      self.displayedRegions = cast(regions)\n    },\n    /**\n     * #action\n     */\n    setBpPerPx(val: number) {\n      self.bpPerPx = val\n    },\n    /**\n     * #action\n     */\n    setVolatileWidth(width: number) {\n      self.volatileWidth = width\n    },\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get width() {\n      return self.volatileWidth\n    },\n    /**\n     * #getter\n     */\n    get assemblyNames() {\n      return [...new Set(self.displayedRegions.map(r => r.assemblyName))]\n    },\n    /**\n     * #getter\n     */\n    get displayedRegionsTotalPx() {\n      return this.totalBp / self.bpPerPx\n    },\n\n    /**\n     * #getter\n     */\n    get maxOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const leftPadding = 10\n      return this.displayedRegionsTotalPx - leftPadding\n    },\n\n    /**\n     * #getter\n     */\n    get minOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const rightPadding = 30\n      return -this.width + rightPadding\n    },\n\n    /**\n     * #getter\n     */\n    get totalBp() {\n      return sum(self.displayedRegions.map(a => a.end - a.start))\n    },\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get dynamicBlocks() {\n      return calculateDynamicBlocks(self)\n    },\n\n    /**\n     * #getter\n     */\n    get staticBlocks() {\n      return calculateStaticBlocks(self)\n    },\n\n    /**\n     * #getter\n     */\n    get currBp() {\n      return sum(this.dynamicBlocks.map(a => a.end - a.start))\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     */\n    pxToBp(px: number) {\n      return pxToBp(self, px)\n    },\n\n    /**\n     * #method\n     */\n    bpToPx({\n      refName,\n      coord,\n      regionNumber,\n    }: {\n      refName: string\n      coord: number\n      regionNumber?: number\n    }) {\n      return bpToPx({ refName, coord, regionNumber, self })?.offsetPx\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setFeatures(features: Feature[]) {\n      self.features = features\n    },\n\n    /**\n     * #action\n     * this makes a zoomed out view that shows all displayedRegions that makes\n     * the overview bar square with the scale bar\n     */\n    showAllRegions() {\n      self.bpPerPx = self.totalBp / self.width\n      self.offsetPx = 0\n    },\n\n    /**\n     * #action\n     */\n    zoomOut() {\n      this.zoomTo(self.bpPerPx * 2)\n    },\n\n    /**\n     * #action\n     */\n    zoomIn() {\n      this.zoomTo(self.bpPerPx / 2)\n    },\n\n    /**\n     * #action\n     */\n    zoomTo(bpPerPx: number, offset = self.width / 2) {\n      const newBpPerPx = clamp(\n        bpPerPx,\n        'minBpPerPx' in self ? (self.minBpPerPx as number) : 0,\n        'maxBpPerPx' in self\n          ? (self.maxBpPerPx as number)\n          : Number.POSITIVE_INFINITY,\n      )\n\n      const oldBpPerPx = self.bpPerPx\n      if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n        return oldBpPerPx\n      }\n\n      self.bpPerPx = newBpPerPx\n\n      // tweak the offset so that the center of the view remains at the same\n      // coordinate\n      self.offsetPx = clamp(\n        Math.round(\n          ((self.offsetPx + offset) * oldBpPerPx) / newBpPerPx - offset,\n        ),\n        self.minOffset,\n        self.maxOffset,\n      )\n      return self.bpPerPx\n    },\n\n    /**\n     * #action\n     */\n    scrollTo(offsetPx: number) {\n      const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n      self.offsetPx = newOffsetPx\n      return newOffsetPx\n    },\n    /**\n     * #action\n     */\n    centerAt(coord: number, refName: string | undefined, regionNumber: number) {\n      if (!refName) {\n        return\n      }\n      const centerPx = self.bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      })\n      if (centerPx) {\n        this.scrollTo(Math.round(centerPx - self.width / 2))\n      }\n    },\n\n    /**\n     * #action\n     * note: the scroll is clamped to keep the view on the main screen\n     */\n    scroll(distance: number) {\n      const oldOffsetPx = self.offsetPx\n      const newOffsetPx = clamp(\n        self.offsetPx + distance,\n        self.minOffset,\n        self.maxOffset,\n      )\n      self.offsetPx = newOffsetPx\n      return newOffsetPx - oldOffsetPx\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * offset is the base-pair-offset in the displayed region, index is the\n     * index of the displayed region in the linear genome view\n     *\n     * @param start - object as `{start, end, offset, index}`\n     * @param end - object as `{start, end, offset, index}`\n     */\n    moveTo(start?: BpOffset, end?: BpOffset) {\n      moveTo(self, start, end)\n    },\n  }))\n\nexport type Base1DViewStateModel = typeof Base1DView\nexport type Base1DViewModel = Instance<Base1DViewStateModel>\n\nexport default Base1DView\n","import FeatureRendererType from './FeatureRendererType'\nimport { LayoutSession } from './LayoutSession'\nimport { readConfObject } from '../../configuration'\nimport { getLayoutId } from '../../util'\nimport PrecomputedLayout from '../../util/layouts/PrecomputedLayout'\n\nimport type {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderArgsSerialized as FeatureRenderArgsSerialized,\n  RenderResults as FeatureRenderResults,\n  ResultsDeserialized as FeatureResultsDeserialized,\n  ResultsSerialized as FeatureResultsSerialized,\n} from './FeatureRendererType'\nimport type { LayoutSessionProps } from './LayoutSession'\nimport type RpcManager from '../../rpc/RpcManager'\nimport type { Feature, Region } from '../../util'\nimport type {\n  BaseLayout,\n  SerializedLayout,\n} from '../../util/layouts/BaseLayout'\nimport type GranularRectLayout from '../../util/layouts/GranularRectLayout'\nimport type MultiLayout from '../../util/layouts/MultiLayout'\n\nexport type MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\n\nexport interface RenderArgs extends FeatureRenderArgs {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderArgsSerialized extends FeatureRenderArgsSerialized {\n  bpPerPx: number\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderResults extends FeatureRenderResults {\n  layout: BaseLayout<Feature>\n}\n\nexport interface ResultsSerialized extends FeatureResultsSerialized {\n  maxHeightReached: boolean\n  layout: SerializedLayout\n}\n\nexport interface ResultsDeserialized extends FeatureResultsDeserialized {\n  maxHeightReached: boolean\n  layout: PrecomputedLayout<string>\n}\n\nexport default class BoxRendererType extends FeatureRendererType {\n  layoutSessions: Record<string, LayoutSession> = {}\n\n  createLayoutSession(props: LayoutSessionProps) {\n    return new LayoutSession(props)\n  }\n\n  getLayoutSession(props: { sessionId: string; layoutId: string }) {\n    return this.layoutSessions[getLayoutId(props)]\n  }\n\n  getWorkerSession(\n    props: LayoutSessionProps & { sessionId: string; layoutId: string },\n  ) {\n    const key = getLayoutId(props)\n    if (!this.layoutSessions[key]) {\n      this.layoutSessions[key] = this.createLayoutSession(props)\n    }\n    return this.layoutSessions[key].update(props)\n  }\n\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    const { bpPerPx, config } = renderArgs\n    const maxFeatureGlyphExpansion =\n      readConfObject(config, 'maxFeatureGlyphExpansion') || 0\n    const bpExpansion = Math.round(maxFeatureGlyphExpansion * bpPerPx)\n    return {\n      ...(region as Omit<typeof region, symbol>),\n      start: Math.floor(Math.max(region.start - bpExpansion, 0)),\n      end: Math.ceil(region.end + bpExpansion),\n    }\n  }\n\n  // renaming function to make clear it runs in worker\n  freeResources(args: Record<string, any>) {\n    this.freeResourcesInWorker(args)\n  }\n\n  freeResourcesInWorker(args: Record<string, any>) {\n    const { regions } = args\n\n    // @ts-expect-error\n    const key = getLayoutId(args)\n    const session = this.layoutSessions[key]\n\n    if (session) {\n      const region = regions[0]!\n      session.layout.discardRange(region.refName, region.start, region.end)\n    }\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const { regions } = args\n    const key = getLayoutId(args)\n    const session = this.layoutSessions[key]\n\n    if (session) {\n      const region = regions[0]!\n      session.layout.discardRange(region.refName, region.start, region.end)\n    }\n    return super.freeResourcesInClient(rpcManager, args)\n  }\n\n  deserializeLayoutInClient(json: SerializedLayout) {\n    return new PrecomputedLayout(json)\n  }\n\n  deserializeResultsInClient(result: ResultsSerialized, args: RenderArgs) {\n    const layout = this.deserializeLayoutInClient(result.layout)\n    return super.deserializeResultsInClient(\n      {\n        ...result,\n        layout,\n      } as FeatureResultsSerialized,\n      args,\n    ) as ResultsDeserialized\n  }\n\n  createLayoutInWorker(args: RenderArgsDeserialized) {\n    const { regions } = args\n    const { layout } = this.getWorkerSession(args)\n    return layout.getSublayout(regions[0]!.refName)\n  }\n\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const { features, ...rest } = super.serializeResultsInWorker(\n      results,\n      args,\n    ) as ResultsSerialized\n\n    const region = args.regions[0]!\n    const layout = results.layout.serializeRegion(\n      this.getExpandedRegion(region, args),\n    )\n    return {\n      ...rest,\n      layout,\n      maxHeightReached: layout.maxHeightReached,\n      features:\n        // floating layout has no rectangles\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        layout.rectangles !== undefined\n          ? features.filter(f => !!layout.rectangles[f.uniqueId])\n          : features,\n    }\n  }\n\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const layout =\n      (props.layout as undefined | BaseLayout<unknown>) ||\n      this.createLayoutInWorker(props)\n    const result = await super.render({\n      ...props,\n      layout,\n    })\n    return {\n      ...result,\n      layout,\n    }\n  }\n}\n","/* eslint-disable react-refresh/only-export-components */\n\nimport { isValidElement } from 'react'\n\nimport { CanvasSequence } from 'canvas-sequencer'\n\nimport { blobToDataURL } from './blobToDataURL'\nimport { createCanvas, createImageBitmap } from './offscreenCanvasPonyfill'\n\ninterface ExportSVGOptions {\n  rasterizeLayers?: boolean\n  scale?: number\n}\n\ninterface RenderToAbstractCanvasOptions {\n  exportSVG?: ExportSVGOptions\n  highResolutionScaling?: number\n}\n\ntype R<T extends Record<string, unknown> | undefined> = Omit<T, never> &\n  (\n    | { canvasRecordedData: Record<string, unknown> }\n    | { imageData: any }\n    | { reactElement: React.ReactElement }\n  )\n\nexport async function renderToAbstractCanvas<\n  T extends Record<string, unknown> | undefined,\n>(\n  width: number,\n  height: number,\n  opts: RenderToAbstractCanvasOptions,\n  cb: (ctx: CanvasRenderingContext2D) => Promise<T> | T,\n): Promise<R<T>> {\n  const { exportSVG, highResolutionScaling = 1 } = opts\n\n  if (exportSVG) {\n    if (!exportSVG.rasterizeLayers) {\n      const fakeCtx = new CanvasSequence()\n      const callbackResult = await cb(fakeCtx)\n      return {\n        ...callbackResult,\n        canvasRecordedData: fakeCtx.toJSON() as Record<string, unknown>,\n      }\n    } else {\n      const s = exportSVG.scale || highResolutionScaling\n      const canvas = createCanvas(Math.ceil(width * s), height * s)\n      const ctx = canvas.getContext('2d')\n      if (!ctx) {\n        throw new Error('2d canvas rendering not supported on this platform')\n      }\n      ctx.scale(s, s)\n      const callbackResult = await cb(ctx)\n\n      // two methods needed for converting canvas to PNG, one for webworker\n      // offscreen canvas, one for main thread\n      return {\n        ...callbackResult,\n        reactElement: (\n          <image\n            width={width}\n            height={height}\n            xlinkHref={\n              'convertToBlob' in canvas\n                ? await blobToDataURL(\n                    await canvas.convertToBlob({\n                      type: 'image/png',\n                    }),\n                  )\n                : canvas.toDataURL('image/png')\n            }\n          />\n        ),\n      }\n    }\n  } else {\n    const s = highResolutionScaling\n    const canvas = createCanvas(Math.ceil(width * s), height * s)\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      throw new Error('2d canvas rendering not supported on this platform')\n    }\n    ctx.scale(s, s)\n    const callbackResult = await cb(ctx)\n    return {\n      ...callbackResult,\n      imageData: await createImageBitmap(canvas),\n    }\n  }\n}\n\nexport async function getSerializedSvg(results: {\n  width: number\n  height: number\n  canvasRecordedData: unknown\n}) {\n  const { width, height, canvasRecordedData } = results\n\n  // @ts-ignore needs to be ignore not expect error, produces error in build step\n  const C2S = await import('canvas2svg')\n  const ctx = new C2S.default(width, height)\n  const seq = new CanvasSequence(canvasRecordedData)\n  seq.execute(ctx)\n\n  // innerHTML strips the outer <svg> element from returned data, we add\n  // our own <svg> element in the view's SVG export\n  return ctx.getSvg().innerHTML as string\n}\n\nexport function ReactRendering({\n  rendering,\n}: {\n  rendering: {\n    reactElement?: React.ReactNode\n    html?: string\n  }\n}) {\n  return isValidElement(rendering.reactElement) ? (\n    rendering.reactElement\n  ) : (\n    <g dangerouslySetInnerHTML={{ __html: rendering.html || '' }} />\n  )\n}\n","import { stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nexport default function SVGBackground({\n  width,\n  height,\n  shift,\n}: {\n  width: number\n  height: number\n  shift: number\n}) {\n  const theme = useTheme()\n  return (\n    <rect\n      width={width + shift * 2}\n      height={height}\n      fill={stripAlpha(theme.palette.background.default)}\n    />\n  )\n}\n","import type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\n// SVG component, region separator\nexport default function SVGRegionSeparators({\n  model,\n  height,\n}: {\n  height: number\n  model: LGV\n}) {\n  const { dynamicBlocks, offsetPx, interRegionPaddingWidth } = model\n  return (\n    <>\n      {dynamicBlocks.contentBlocks.slice(1).map(block => (\n        <rect\n          key={block.key}\n          x={block.offsetPx - offsetPx - interRegionPaddingWidth}\n          width={interRegionPaddingWidth}\n          y={0}\n          height={height}\n          fill=\"grey\"\n        />\n      ))}\n    </>\n  )\n}\n","import { getTickDisplayStr, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nimport { makeTicks } from '../util'\nimport SVGRegionSeparators from './SVGRegionSeparators'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nfunction Ruler({\n  start,\n  end,\n  bpPerPx,\n  reversed = false,\n  major = true,\n  minor = true,\n  hideText = false,\n}: {\n  start: number\n  end: number\n  bpPerPx: number\n  reversed?: boolean\n  major?: boolean\n  minor?: boolean\n  hideText?: boolean\n}) {\n  const ticks = makeTicks(start, end, bpPerPx, major, minor)\n  const theme = useTheme()\n  const c = stripAlpha(theme.palette.text.secondary)\n  return (\n    <>\n      {ticks.map(tick => {\n        const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n        return (\n          <line\n            key={`tick-${tick.base}`}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={tick.type === 'major' ? 6 : 4}\n            strokeWidth={1}\n            stroke={c}\n          />\n        )\n      })}\n      {!hideText\n        ? ticks\n            .filter(tick => tick.type === 'major')\n            .map(tick => {\n              const x =\n                (reversed ? end - tick.base : tick.base - start) / bpPerPx\n              return (\n                <text\n                  key={`label-${tick.base}`}\n                  x={x - 3}\n                  y={7 + 11}\n                  fontSize={11}\n                  fill={c}\n                >\n                  {getTickDisplayStr(tick.base + 1, bpPerPx)}\n                </text>\n              )\n            })\n        : null}\n    </>\n  )\n}\n\nexport default function SVGRuler({\n  model,\n  fontSize,\n}: {\n  model: LGV\n  fontSize: number\n}) {\n  const {\n    dynamicBlocks: { contentBlocks },\n    offsetPx: viewOffsetPx,\n    bpPerPx,\n  } = model\n  const renderRuler = contentBlocks.length < 5\n  const theme = useTheme()\n  const c = stripAlpha(theme.palette.text.primary)\n  return (\n    <>\n      <SVGRegionSeparators model={model} height={30} />\n      {contentBlocks.map(block => {\n        const { start, end, key, reversed, offsetPx, refName, widthPx } = block\n        const offset = offsetPx - viewOffsetPx\n        const clipid = `clip-${key}`\n        return (\n          <g key={key}>\n            <defs>\n              <clipPath id={clipid}>\n                <rect x={0} y={0} width={widthPx} height={100} />\n              </clipPath>\n            </defs>\n            <g transform={`translate(${offset} 0)`}>\n              <g clipPath={`url(#${clipid})`}>\n                <text x={4} y={fontSize} fontSize={fontSize} fill={c}>\n                  {refName}\n                </text>\n                <g transform=\"translate(0 20)\">\n                  <Ruler\n                    hideText={!renderRuler}\n                    start={start}\n                    end={end}\n                    bpPerPx={bpPerPx}\n                    reversed={reversed}\n                  />\n                </g>\n              </g>\n            </g>\n          </g>\n        )\n      })}\n    </>\n  )\n}\n","import { getBpDisplayStr, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nimport type { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nexport default function SVGScalebar({\n  model,\n  fontSize,\n}: {\n  model: LGV\n  fontSize: number\n}) {\n  const {\n    offsetPx,\n    dynamicBlocks: { totalWidthPxWithoutBorders: totalWidthPx, totalBp },\n  } = model\n  const theme = useTheme()\n  const displayBp = getBpDisplayStr(totalBp)\n  const x0 = Math.max(-offsetPx, 0)\n  const x1 = x0 + totalWidthPx\n  const c = stripAlpha(theme.palette.text.secondary)\n  const x = x0 + (x1 - x0) / 2\n  const y = fontSize\n  return (\n    <>\n      <line x1={x0} x2={x1} y1={10} y2={10} stroke={c} />\n      <line x1={x0} x2={x0} y1={5} y2={15} stroke={c} />\n      <line x1={x1} x2={x1} y1={5} y2={15} stroke={c} />\n      <text\n        x={x}\n        y={y}\n        textAnchor=\"middle\"\n        dominantBaseline=\"hanging\"\n        fontSize={fontSize}\n        fill={c}\n      >\n        {displayBp}\n      </text>\n    </>\n  )\n}\n","import { getSession, stripAlpha } from '@jbrowse/core/util'\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport { useTheme } from '@mui/material'\n\nimport SVGRuler from './SVGRuler'\nimport SVGScalebar from './SVGScalebar'\nimport Cytobands from '../components/Cytobands'\nimport OverviewScalebarPolygon from '../components/OverviewScalebarPolygon'\nimport { HEADER_OVERVIEW_HEIGHT } from '../consts'\n\nimport type { LinearGenomeViewModel } from '..'\n\nexport default function SVGHeader({\n  model,\n  fontSize,\n  cytobandHeight,\n  rulerHeight,\n}: {\n  model: LinearGenomeViewModel\n  rulerHeight: number\n  fontSize: number\n  cytobandHeight: number\n}) {\n  const { width, assemblyNames, showCytobands, displayedRegions } = model\n  const { assemblyManager } = getSession(model)\n  const assemblyName = assemblyNames.length > 1 ? '' : assemblyNames[0]!\n  const assembly = assemblyManager.get(assemblyName)\n  const theme = useTheme()\n  const c = stripAlpha(theme.palette.text.primary)\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n  const visibleRegions = model.dynamicBlocks.contentBlocks\n  if (!visibleRegions.length) {\n    return null\n  }\n\n  overview.setVolatileWidth(width)\n  overview.showAllRegions()\n  const block = overview.dynamicBlocks.contentBlocks[0]!\n  const first = visibleRegions.at(0)!\n  const last = visibleRegions.at(-1)!\n  const firstOverviewPx =\n    overview.bpToPx({\n      // eslint-disable-next-line @typescript-eslint/no-misused-spread\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0\n\n  const lastOverviewPx =\n    overview.bpToPx({\n      // eslint-disable-next-line @typescript-eslint/no-misused-spread\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0\n  const y = +showCytobands * cytobandHeight\n  return (\n    <g id=\"header\">\n      <text x={0} y={0} dominantBaseline=\"hanging\" fontSize={fontSize} fill={c}>\n        {assemblyName}\n      </text>\n\n      {showCytobands ? (\n        <g transform={`translate(0 ${rulerHeight})`}>\n          <Cytobands overview={overview} assembly={assembly} block={block} />\n          <rect\n            stroke=\"red\"\n            fill=\"rgb(255,0,0)\"\n            fillOpacity={0.1}\n            width={Math.max(lastOverviewPx - firstOverviewPx, 0.5)}\n            height={HEADER_OVERVIEW_HEIGHT - 1}\n            x={firstOverviewPx}\n            y={0.5}\n          />\n          <g transform={`translate(0,${HEADER_OVERVIEW_HEIGHT})`}>\n            <OverviewScalebarPolygon\n              overview={overview}\n              model={model}\n              useOffset={false}\n            />\n          </g>\n        </g>\n      ) : null}\n\n      <g transform={`translate(0 ${fontSize + y})`}>\n        <SVGScalebar model={model} fontSize={fontSize} />\n      </g>\n      <g transform={`translate(0 ${rulerHeight + y})`}>\n        <SVGRuler model={model} fontSize={fontSize} />\n      </g>\n    </g>\n  )\n}\n","import { coarseStripHTML, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nexport default function SVGTrackLabel({\n  trackLabels,\n  trackName,\n  fontSize,\n  trackLabelOffset,\n  x,\n}: {\n  trackName: string\n  trackLabels: string\n  fontSize: number\n  trackLabelOffset: number\n  x: number\n}) {\n  const theme = useTheme()\n  const fill = stripAlpha(theme.palette.text.primary)\n  const xoff = trackLabels === 'overlay' ? 5 : 0\n  const yoff = trackLabels === 'offset' ? 5 : 0\n  const name = coarseStripHTML(trackName)\n  return trackLabels !== 'none' ? (\n    <g>\n      {trackLabels === 'left' ? (\n        <text\n          x={trackLabelOffset - 40}\n          y={20}\n          fill={fill}\n          fontSize={fontSize}\n          dominantBaseline=\"hanging\"\n          textAnchor=\"end\"\n        >\n          {name}\n        </text>\n      ) : (\n        <text\n          x={x + xoff}\n          y={yoff}\n          fill={fill}\n          fontSize={fontSize}\n          dominantBaseline=\"hanging\"\n        >\n          {name}\n        </text>\n      )}\n    </g>\n  ) : null\n}\n","import { getSession } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\n\nimport SVGRegionSeparators from './SVGRegionSeparators'\nimport SVGTrackLabel from './SVGTrackLabel'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\ntype LGV = LinearGenomeViewModel\n\ninterface DisplayResult {\n  track: {\n    configuration: AnyConfigurationModel\n    displays: { height: number }[]\n  }\n  result: string\n}\n\n// SVG component, tracks\nexport default function SVGTracks({\n  displayResults,\n  model,\n  textHeight,\n  fontSize,\n  trackLabels = 'offset',\n  trackLabelOffset = 0,\n}: {\n  displayResults: DisplayResult[]\n  model: LGV\n  textHeight: number\n  fontSize: number\n  trackLabels?: string\n  trackLabelOffset?: number\n}) {\n  const session = getSession(model)\n  const textOffset = trackLabels === 'offset' ? textHeight : 0\n  return (\n    <>\n      {\n        displayResults.reduce(\n          ({ prevOffset, reactElements }, { track, result }) => {\n            const conf = track.configuration\n            const trackName = getTrackName(conf, session)\n            const display = track.displays[0]!\n            const x = Math.max(-model.offsetPx, 0)\n            const currOffset = prevOffset + display.height + textOffset\n            return {\n              prevOffset: currOffset,\n              reactElements: [\n                ...reactElements,\n                <g key={conf.trackId} transform={`translate(0 ${prevOffset})`}>\n                  <g transform={`translate(${trackLabelOffset} ${textOffset})`}>\n                    <SVGRegionSeparators\n                      model={model}\n                      height={display.height}\n                    />\n                    {result}\n                  </g>\n                  <SVGTrackLabel\n                    trackName={trackName}\n                    fontSize={fontSize}\n                    trackLabels={trackLabels}\n                    trackLabelOffset={trackLabelOffset}\n                    x={x}\n                  />\n                </g>,\n              ],\n            }\n          },\n          {\n            prevOffset: 0,\n            reactElements: [] as React.ReactElement[],\n          },\n        ).reactElements\n      }\n    </>\n  )\n}\n","/* eslint-disable react-refresh/only-export-components */\n\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport {\n  getSession,\n  max,\n  measureText,\n  renderToStaticMarkup,\n} from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { ThemeProvider } from '@mui/material'\nimport { when } from 'mobx'\n\nimport SVGBackground from './SVGBackground'\nimport SVGHeader from './SVGHeader'\nimport SVGTracks from './SVGTracks'\nimport { totalHeight } from './util'\n\nimport type { LinearGenomeViewModel } from '..'\nimport type { ExportSvgOptions } from '../types'\n\ntype LGV = LinearGenomeViewModel\n\n// render LGV to SVG\nexport async function renderToSvg(model: LGV, opts: ExportSvgOptions) {\n  await when(() => model.initialized)\n  const {\n    textHeight = 18,\n    headerHeight = 40,\n    rulerHeight = 50,\n    fontSize = 13,\n    cytobandHeight = 100,\n    trackLabels = 'offset',\n    themeName = 'default',\n    Wrapper = ({ children }) => children,\n  } = opts\n  const session = getSession(model)\n  const { allThemes } = session\n\n  const theme = allThemes?.()[themeName]\n  const { width, pinnedTracks, unpinnedTracks, tracks, showCytobands } = model\n  const shift = 50\n  const c = +showCytobands * cytobandHeight\n  const offset = headerHeight + rulerHeight + c + 10\n  const height = totalHeight(tracks, textHeight, trackLabels) + offset + 100\n  const displayResults = await Promise.all(\n    [...pinnedTracks, ...unpinnedTracks].map(async track => {\n      const display = track.displays[0]\n      await when(() => !display.renderProps().notReady)\n      return { track, result: await display.renderSvg({ ...opts, theme }) }\n    }),\n  )\n  const trackLabelMaxLen =\n    max(\n      tracks.map(t =>\n        measureText(getTrackName(t.configuration, session), fontSize),\n      ),\n      0,\n    ) + 40\n  const trackLabelOffset = trackLabels === 'left' ? trackLabelMaxLen : 0\n  const w = width + trackLabelOffset\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <ThemeProvider theme={createJBrowseTheme(theme)}>\n      <Wrapper>\n        <svg\n          width={w}\n          height={height}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n          viewBox={[0, 0, w + shift * 2, height].toString()}\n        >\n          <SVGBackground width={w} height={height} shift={shift} />\n          <g transform={`translate(${shift} 0)`}>\n            <g transform={`translate(${trackLabelOffset})`}>\n              <SVGHeader\n                model={model}\n                fontSize={fontSize}\n                rulerHeight={rulerHeight}\n                cytobandHeight={cytobandHeight}\n              />\n            </g>\n            <g transform={`translate(0 ${offset})`}>\n              <SVGTracks\n                textHeight={textHeight}\n                fontSize={fontSize}\n                model={model}\n                displayResults={displayResults}\n                trackLabels={trackLabels}\n                trackLabelOffset={trackLabelOffset}\n              />\n            </g>\n          </g>\n        </svg>\n      </Wrapper>\n    </ThemeProvider>,\n  )\n}\n\nexport { default as SVGRuler } from './SVGRuler'\nexport { default as SVGTracks } from './SVGTracks'\n","import { getConf } from '@jbrowse/core/configuration'\nimport {\n  getContainingTrack,\n  getContainingView,\n  measureText,\n} from '@jbrowse/core/util'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { observer } from 'mobx-react'\n\nimport YScaleBar from '../../shared/YScaleBar'\n\nimport type { WiggleDisplayModel } from '../model'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nconst LinearWiggleDisplay = observer(function (props: {\n  model: WiggleDisplayModel\n}) {\n  const { model } = props\n  const { stats, height, graphType } = model\n\n  const { trackLabels } = getContainingView(model) as LGV\n  const track = getContainingTrack(model)\n\n  return (\n    <div>\n      <BaseLinearDisplayComponent {...props} />\n      {stats && graphType ? (\n        <svg\n          style={{\n            position: 'absolute',\n            top: 0,\n            left:\n              trackLabels === 'overlapping'\n                ? measureText(getConf(track, 'name'), 12.8) + 100\n                : 50,\n            pointerEvents: 'none',\n            height,\n            width: 50,\n          }}\n        >\n          <YScaleBar model={model} />\n        </svg>\n      ) : null}\n    </div>\n  )\n})\n\nexport default LinearWiggleDisplay\n","import { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { type IAnyStateTreeNode, isAlive } from 'mobx-state-tree'\n\nimport type { ModificationType } from './types'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nexport interface ModificationOpts {\n  headers?: Record<string, string>\n  stopToken?: string\n  filters: string[]\n}\n\nexport async function getUniqueModifications({\n  model,\n  adapterConfig,\n  blocks,\n  opts,\n}: {\n  model: IAnyStateTreeNode\n  adapterConfig: AnyConfigurationModel\n  blocks: BlockSet\n  opts?: ModificationOpts\n}) {\n  const { rpcManager } = getSession(model)\n  const sessionId = getRpcSessionId(model)\n  const values = await rpcManager.call(\n    sessionId,\n    'PileupGetVisibleModifications',\n    {\n      adapterConfig,\n      sessionId,\n      regions: blocks.contentBlocks,\n      statusCallback: (arg: string) => {\n        if (isAlive(model)) {\n          model.setMessage(arg)\n        }\n      },\n      ...opts,\n    },\n  )\n  return values as ModificationType[]\n}\n","import { HttpRangeFetcher } from '@gmod/http-range-fetcher'\nimport { RemoteFile } from 'generic-filehandle2'\n\ntype BinaryRangeFetch = (\n  url: string,\n  start: number,\n  end: number,\n  options?: { headers?: HeadersInit; stopToken?: string },\n) => Promise<BinaryRangeResponse>\n\nexport interface BinaryRangeResponse {\n  headers: Record<string, string>\n  requestDate: Date\n  responseDate: Date\n  buffer: Uint8Array\n}\n\nconst fetchers: Record<string, BinaryRangeFetch> = {}\n\nfunction binaryRangeFetch(\n  url: string,\n  start: number,\n  end: number,\n  options: { headers?: HeadersInit; stopToken?: string } = {},\n): Promise<BinaryRangeResponse> {\n  const fetcher = fetchers[url]\n  if (!fetcher) {\n    throw new Error(`fetch not registered for ${url}`)\n  }\n  return fetcher(url, start, end, options)\n}\n\nconst globalRangeCache = new HttpRangeFetcher({\n  // @ts-expect-error\n  fetch: binaryRangeFetch,\n  size: 500 * 1024 ** 2, // 500MiB\n  chunkSize: 128 * 1024, // 128KiB\n  maxFetchSize: 100 * 1024 ** 2, // 100MiB\n  minimumTTL: 24 * 60 * 60 * 1000, // 1 day\n})\n\nexport function clearCache() {\n  globalRangeCache.reset()\n}\n\nexport class RemoteFileWithRangeCache extends RemoteFile {\n  public async fetch(\n    url: string | RequestInfo,\n    init?: RequestInit,\n  ): Promise<Response> {\n    const str = String(url)\n    if (!fetchers[str]) {\n      fetchers[str] = this.fetchBinaryRange.bind(this)\n    }\n    // if it is a range request, route it through the range cache\n    const range = new Headers(init?.headers).get('range')\n    if (range) {\n      const rangeParse = /bytes=(\\d+)-(\\d+)/.exec(range)\n      if (rangeParse) {\n        const [, start, end] = rangeParse\n        const s = Number.parseInt(start!, 10)\n        const e = Number.parseInt(end!, 10)\n        const len = e - s\n        const { buffer, headers } = (await globalRangeCache.getRange(\n          `${url}`,\n          s,\n          len + 1,\n        )) as BinaryRangeResponse\n        return new Response(buffer, {\n          status: 206,\n          headers,\n        })\n      }\n    }\n    return super.fetch(url, init)\n  }\n\n  public async fetchBinaryRange(\n    url: string,\n    start: number,\n    end: number,\n    options: { headers?: HeadersInit; stopToken?: string } = {},\n  ): Promise<BinaryRangeResponse> {\n    const requestDate = new Date()\n    const res = await super.fetch(url, {\n      ...options,\n      headers: {\n        // eslint-disable-next-line @typescript-eslint/no-misused-spread\n        ...options.headers,\n        range: `bytes=${start}-${end}`,\n      },\n    })\n    const responseDate = new Date()\n    if (!res.ok) {\n      const errorMessage = `HTTP ${res.status} fetching ${url} bytes ${start}-${end}`\n      const hint = ' (should be 206 for range requests)'\n      throw new Error(`${errorMessage}${res.status === 200 ? hint : ''}`)\n    }\n\n    // translate the Headers object into a regular key -> value object.\n    // will miss duplicate headers of course\n\n    const headers: Record<string, any> = {}\n    for (const [k, v] of res.headers.entries()) {\n      headers[k] = v\n    }\n\n    // return the response headers, and the data buffer\n    const arrayBuffer = await res.arrayBuffer()\n    return {\n      headers,\n      requestDate,\n      responseDate,\n      buffer: new Uint8Array(arrayBuffer),\n    }\n  }\n}\n","import isNode from 'detect-node'\nimport { BlobFile, LocalFile } from 'generic-filehandle2'\n\nimport { RemoteFileWithRangeCache } from './RemoteFileWithRangeCache'\nimport { isElectron } from '../'\nimport { getBlob } from '../tracks'\nimport {\n  AuthNeededError,\n  isRootModelWithInternetAccounts,\n  isUriLocation,\n} from '../types'\n\nimport type PluginManager from '../../PluginManager'\nimport type { BaseInternetAccountModel } from '../../pluggableElementTypes/models'\nimport type {\n  BlobLocation,\n  FileLocation,\n  LocalPathLocation,\n  UriLocation,\n} from '../types'\nimport type { Fetcher, GenericFilehandle } from 'generic-filehandle2'\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\n/** if a UriLocation has a baseUri, resolves its uri with respect to that base */\nexport function resolveUriLocation(location: UriLocation) {\n  return location.baseUri\n    ? { ...location, uri: new URL(location.uri, location.baseUri).href }\n    : location\n}\n\nexport function openLocation(\n  location: FileLocation,\n  pluginManager?: PluginManager,\n): GenericFilehandle {\n  if (isLocalPathLocation(location)) {\n    if (!location.localPath) {\n      throw new Error('No local path provided')\n    }\n\n    if (isNode || isElectron) {\n      return new LocalFile(location.localPath)\n    } else {\n      throw new Error(\"can't use local files in the browser\")\n    }\n  }\n  if (isBlobLocation(location)) {\n    // special case where blob is not directly stored on the model, use a getter\n    const blob = getBlob(location.blobId)\n    if (!blob) {\n      throw new Error(\n        `file (\"${location.name}\") was opened locally from a previous session. To restore it, go to track settings and reopen the file`,\n      )\n    }\n    return new BlobFile(blob)\n  }\n  if (isUriLocation(location)) {\n    // Check for empty string\n    if (!location.uri) {\n      throw new Error('No URI provided')\n    }\n\n    // Resolve any relative URLs to absolute URLs\n    const absoluteLocation = resolveUriLocation(location)\n\n    // If there is a plugin manager, we can try internet accounts\n    if (pluginManager) {\n      const internetAccount = getInternetAccount(location, pluginManager)\n      // If an internetAccount was found, use it to open the location\n      if (internetAccount) {\n        return internetAccount.openLocation(absoluteLocation)\n      }\n    }\n    // Otherwise fall back on usual open\n    return new RemoteFileWithRangeCache(absoluteLocation.uri, {\n      fetch: checkAuthNeededFetch,\n    })\n  }\n  throw new Error('invalid fileLocation')\n}\n\nexport function getFetcher(\n  location: FileLocation,\n  pluginManager?: PluginManager,\n): Fetcher {\n  if (!isUriLocation(location)) {\n    throw new Error(`Not a valid UriLocation: ${JSON.stringify(location)}`)\n  }\n  if (pluginManager) {\n    const internetAccount = getInternetAccount(location, pluginManager)\n    if (internetAccount) {\n      return internetAccount.getFetcher(location)\n    }\n  }\n  return checkAuthNeededFetch\n}\n\nfunction getInternetAccount(\n  location: UriLocation,\n  pluginManager: PluginManager,\n): BaseInternetAccountModel | undefined {\n  const { rootModel } = pluginManager\n  // If there is an appRootModel, use it to find the internetAccount\n  if (rootModel && isRootModelWithInternetAccounts(rootModel)) {\n    return rootModel.findAppropriateInternetAccount(location)\n  }\n  // If there is no appRootModel, but there is pre-auth, create a temporary\n  // internetAccount. This is typical in a worker.\n  if (location.internetAccountPreAuthorization) {\n    if (!location.internetAccountPreAuthorization.authInfo.token) {\n      throw new Error(\n        'Failed to obtain token from internet account. Try reloading the page',\n      )\n    }\n    return pluginManager\n      .getInternetAccountType(\n        location.internetAccountPreAuthorization.internetAccountType,\n      )!\n      .stateModel.create({\n        type: location.internetAccountPreAuthorization.internetAccountType,\n        configuration:\n          location.internetAccountPreAuthorization.authInfo.configuration,\n      })\n  }\n  return undefined\n}\n\n// This fetch throws a special error if the response is \"401\" and includes a\n// \"WWW-Authenticate: Basic\" header. This is so downstream code can retry if\n// needed with HTTP Basic authentication included\nasync function checkAuthNeededFetch(url: RequestInfo, opts?: RequestInit) {\n  const response = await fetch(url, opts)\n  if (\n    response.status === 401 &&\n    response.headers.get('WWW-Authenticate')?.includes('Basic')\n  ) {\n    throw new AuthNeededError(\n      'Accessing HTTPBasic resource without authentication',\n      url.toString(),\n    )\n  }\n  return response\n}\n\nexport { RemoteFileWithRangeCache } from './RemoteFileWithRangeCache'\n"],"names":["ServerSideRenderer","RendererType","serializeArgsInClient","args","config","isStateTreeNode","getSnapshot","filters","toJSON","deserializeResultsInClient","res","exportSVG","html","this","supportsSVG","reactElement","_jsx","ServerSideRenderedContent","RenderingComponent","ReactComponent","deserializeArgsInWorker","deserialized","configSchema","create","pluginManager","SerializableFilterChain","undefined","serializeResultsInWorker","results","renderToString","ThemeProvider","theme","createJBrowseTheme","children","renderInClient","rpcManager","call","sessionId","getSerializedSvg","renderInWorker","stopToken","statusCallback","deserializedArgs","updateStatus","render","checkStopToken","freeResourcesInClient","serializedArgs","stitch","subfeats","sequence","map","sub","slice","start","end","join","getItemId","feat","dedupe","list","filter","item","pos","ary","revlist","seqlen","sort","a","b","calculateUTRs","cds","exons","length","firstCds","at","lastCds","firstCdsIdx","findIndex","exon","lastCdsIdx","lastCdsExon","firstCdsExon","elt","type","calculateUTRs2","parentFeat","ellipses","slug","replaceUndefinedWithNull","obj","JSON","parse","stringify","_","v","formatSubfeatures","depth","currentDepth","returnObj","subfeatures","stateModelFactory","types","model","id","ElementId","literal","filterText","view","safeReference","pluggableMstType","actions","self","clearFilterText","setFilterText","newText","ConfigurationSchema","PluginStoreWidgetF","addWidgetType","WidgetType","name","heading","stateModel","lazy","defaultValue","description","assemblyNames","explicitlyTyped","explicitIdentifier","identifier","tracks","array","pluggableConfigSchemaType","configuration","ConfigurationReference","connect","_arg","afterAttach","addTrackConf","trackConf","push","addTrackConfs","trackConfs","setTrackConfs","cast","clear","BaseDisplay","string","rpcDriverName","maybe","volatile","rendererTypeName","error","message","views","getEnv","getDisplayType","DisplayBlurb","adapterConfig","getConf","parentTrack","track","getParent","isRoot","Error","renderProps","getParentRenderProps","notReady","getContainingView","minimized","displayModel","rendererType","getRendererType","DisplayMessageComponent","trackMenuItems","viewMenuActions","regionCannotBeRendered","setMessage","arg","setError","setRpcDriverName","reload","BaseInternetAccountConfig","authHeader","tokenType","domains","inWebWorker","sessionStorage","InternetAccount","internetAccountId","toggleContents","SelectorComponent","selectorLabel","handlesLocation","location","some","domain","uri","includes","tokenKey","getTokenFromUser","_resolve","_reject","storeToken","token","setItem","removeToken","removeItem","retrieveToken","getItem","async","validateToken","_loc","tokenPromise","getToken","internetAccountPreAuthorization","authInfo","Promise","resolve","reject","addAuthHeaderToInit","init","headers","Headers","getPreAuthorizationInformation","authToken","validatedToken","internetAccountType","getFetcher","loc","input","newInit","fetch","openLocation","RemoteFileWithRangeCache","createBaseTrackModel","pm","trackType","baseTrackConfig","pinned","displays","rpcSessionId","adapter","adapterConfigCacheKey","trackId","textSearchAdapter","adapterType","getAdapterType","flatMap","d","canConfigure","session","getSession","sessionTracks","adminMode","isSessionModelWithConfigEditing","find","t","setPinned","flag","setMinimized","showDisplay","displayId","initialSnapshot","schema","conf","resolveIdentifier","getRoot","displayType","display","hideDisplay","transaction","remove","replaceDisplay","oldId","newId","idx","splice","menuItems","shownId","compatDisp","viewType","getViewType","compatTypes","Set","displayTypes","has","getCompatibleDisplays","label","priority","subMenu","displayName","checked","onClick","createBaseTrackConfig","category","metadata","textSearching","indexingAttributes","indexingFeatureTypesToExclude","formatDetails","feature","contextVariable","maxDepth","formatAbout","hideUris","preProcessSnapshot","s2","snap","evaluateExtensionPoint","structuredClone","configDisplayTypes","getTrackType","e","cause","addDisplayConf","MultiLayout","subLayouts","Map","constructor","SubLayoutClass","subLayoutConstructorArgs","getDataByID","layout","values","r","getSublayout","layoutName","subLayout","get","set","addRect","left","right","height","data","discardRange","sublayout","entries","TooltipContents","forwardRef","ref","isValidElement","SanitizedHTML","String","observer","clientMouseCoord","featureUnderMouse","x","y","contents","BaseTooltip","clientPoint","isObject","value","isObjectCustom","RegExp","Date","globalThis","Blob","object","mapper","isSeen","WeakSet","add","mapArray","element","Array","isArray","Object","RpcMethodType","PluggableElementBase","super","serializeArguments","rpcDriverClassName","blobMap","getBlobMap","augmentLocationObjects","serializeNewAuthArguments","rootModel","isAppRootModel","account","findAppropriateInternetAccount","deserializeArguments","_rpcDriverClassName","setBlobMap","serializeReturn","originalReturn","_args","deserializeReturn","serializedReturn","isAuthNeededException","retryAccount","createEphemeralInternetAccount","URL","url","origin","RetryError","thing","uris","mapObject","val","isUriLocation","adapterCache","getAdapter","adapterConfigSnapshot","cacheKey","dataAdapterType","getSubAdapter","bind","dataAdapter","getAdapterClass","sessionIds","cacheEntry","freeAdapterResources","specKeys","keys","delete","size","regions","region","refName","freeResources","hasher","clone","lookup","entry","hashed","navToOption","option","assemblyName","getLocation","getTrackId","navToLocString","showTrack","handleSelectedRegion","assembly","allRefs","allRefNamesWithLowerCase","split","every","str","rest","lastIndex","lastIndexOf","splitLast","Number","isNaN","parseInt","checkRef","searchScope","textSearchManager","queryString","searchType","rankSearchResults","console","warn","textSearchResults","search","refNameResults","allRefNames","toLowerCase","startsWith","BaseResult","getId","fetchResults","setSearchResults","isFeature","isSimpleFeatureSerialized","SimpleFeature","parentHandle","parent","uniqueId","aliases","f","i","strand","tags","p","parentId","c","child","fromJSON","json","getRowStr","facet","row","replace","BaseViewModel","width","setDisplayName","setWidth","newWidth","props","displayedRegions","Region","TextSearchAdapterType","stuff","AdapterClass","locString","renderingComponent","displayString","matchedAttribute","matchedObject","relevance","score","getLabel","getDisplayString","getRenderingComponent","getScore","updateScore","newScore","hasLocation","getComboResults","RefSequenceResult","localStorageSetNumber","key","localStorageSetItem","featureData","frozen","formattedFields","unformattedFeatureData","number","sequenceFeatureDetails","optional","showCoordinatesSetting","localStorageGetItem","intronBp","localStorageGetNumber","upDownBp","upperCaseCDS","localStorageGetBoolean","charactersPerRow","mode","setFeature","setUpDownBp","setIntronBp","setUpperCaseCDS","setShowCoordinates","setMode","showCoordinates","showGenomicCoordsOption","hasCDS","hasExon","hasExonOrCDS","addDisposer","autorun","descriptions","setFeatureData","clearFeatureData","setFormattedData","setExtra","afterCreate","combine","arg2","__jbrowsefmt","finalizedFeatureData","postProcessSnapshot","RectBg","color","useTheme","pointerEvents","getFillProps","alpha","palette","background","paper","labelWidth","canDisplayLabels","rowHeight","sources","svgFontSize","clamp","hasColors","s","legendWidth","colorBoxWidth","_jsxs","_Fragment","source","Fragment","fontSize","text","primary","Wrapper","scrollTop","clipid","clipPath","transform","style","position","top","zIndex","totalHeight","ColorLegend","max","measureText","bigWigLocation","locationType","resolutionMultiplier","baseUri","ConfirmDialog","WiggleBaseRenderer","FeatureRendererType","features","getFeatures","inverted","bpPerPx","reducedFeatures","renderToAbstractCanvas","ctx","draw","containsNoTransferables","DensityRenderer","drawDensity","posColor","negColor","clipColor","bicolorPivot","enumeration","bicolorPivotValue","baseConfiguration","baseWiggleRendererConfigSchema","onMouseLeave","onMouseMove","onFeatureClick","useRef","getFeatureUnderMouse","eventClientX","offset","current","getBoundingClientRect","offsetX","px","reversed","clientBp","clientX","overflow","PrerenderedCanvas","displayCrossHatches","LinePlotRenderer","readConfObject","drawLine","YSCALEBAR_LABEL_OFFSET","colorCallback","sharedWiggleConfigFactory","autoscale","minimalTicks","minScore","MIN_VALUE","maxScore","MAX_VALUE","numStdDev","scaleType","baseLinearDisplayConfigSchema","SetMinMaxDialog","SharedWiggleMixin","compose","BaseLinearDisplay","selectedRendering","resolution","fill","boolean","minSize","summaryScoreMode","rendererTypeNameState","scale","constraints","min","stats","statsFetchInProgress","updateQuantitativeStats","currStatsBpPerPx","scoreMin","scoreMax","EPSILON","Math","abs","setColor","setPosColor","setNegColor","setStatsLoading","stopStopToken","selectFeature","isSelectionContainer","setSelection","setResolution","setFill","toggleLogScale","setScaleType","setSummaryScoreMode","setAutoscale","setMaxScore","setRendererType","setMinScore","toggleCrossHatches","setCrossHatches","cross","adapterTypeName","rendererTypeNameSimple","adapterCapabilities","rendererConfig","configBlob","filled","autoscaleType","oldDomain","ret","getNiceDomain","bounds","summaryScoreModeSetting","scaleOpts","canHaveFill","displayCrossHatchesSetting","hasResolution","hasGlobalStats","scoreTrackMenuItems","queueDialog","handleClose","superReload","Tooltip","SetColorDialog","rendererTypes","invertedSetting","setInverted","TooltipComponent","quantitativeStatsRelevantToCurrentZoom","graphType","superRenderProps","adapterProps","superProps","ticks","axisPropsFromTickScale","getScale","range","fillSetting","quantitativeStatsReady","initialized","statsReadyAndRegionNotTooLarge","superTrackMenuItems","hasRenderings","icon","EqualizerIcon","PaletteIcon","VisibilityIcon","renderSvg","superRenderSvg","getQuantitativeStatsAutorun","opts","isMultiRow","eventClientY","rect","offsetY","floor","mouseoverBp","featuresUnderMouse","fromEntries","event","clientY","MultiDensityPlotRenderer","groups","groupBy","feats","save","forEachWithStopTokenCheck","translate","concat","restore","MultiLineRenderer","randomColor","replaceAll","random","toString","WiggleClusterDialog","_pluginManager","showSidebar","sourcesLoadingStopToken","featureUnderMouseVolatile","sourcesVolatile","setShowSidebar","setSourcesLoading","setLayout","clearLayout","setSources","deepEqual","setFeatureUnderMouse","needsFullHeightScalebar","needsCustomLegend","renderColorBoxes","prefersOffset","sourcesWithoutLayout","iter","colors","rowHeightTooSmallForScalebar","useMinimalTicks","legendFontSize","canDisplayLegendLabels","getMultiWiggleSourcesAutorun","all","isAlive","notifyError","MultiRowLineRenderer","strokeStyle","beginPath","moveTo","lineTo","stroke","MultiXYPlotRenderer","drawXY","subadapters","bigWigs","MultiWiggleGetSources","RpcMethodTypeWithFiltersAndRenameRegions","execute","getSources","WiggleGetMultiRegionQuantitativeStats","getMultiRegionQuantitativeStats","WiggleGetGlobalQuantitativeStats","getGlobalStats","getScoreMatrix","r0","r0len","w","firstValueFrom","pipe","toArray","rows","arr","fstart","fend","MultiWiggleGetScoreMatrix","MultiWiggleClusterScoreMatrix","matrix","clusterData","onProgress","XYPlotRenderer","pivotValue","isCallback","_score","_feature","WigglePlugin","Plugin","install","addAdapterType","AdapterType","adapterMetadata","hiddenFromGUI","then","default","addTrackType","configSchemaF","TrackType","QuantitativeTrackF","MultiQuantitativeTrackF","addDisplayType","XYPlotRendererConfigSchema","DensityRendererConfigSchema","LinePlotRendererConfigSchema","defaultRendering","renderers","configSchemaFactory","modelFactory","DisplayType","LinearWiggleDisplayF","MultiXYPlotRendererConfigSchema","MultiDensityRendererConfigSchema","MultiRowXYPlotRendererConfigSchema","MultiLineRendererConfigSchema","MultiRowLineRendererConfigSchema","MultiDensityRenderer","MultiRowXYPlotRenderer","MultiLinearWiggleDisplayF","addRendererType","LinePlotRendererF","XYPlotRendererF","DensityRendererF","MultiXYPlotRendererF","MultiRowXYPlotRendererF","MultiDensityRendererF","MultiLineRendererF","MultiRowLineRendererF","addAddTrackWorkflowType","AddTrackWorkflowType","MultiWiggleAddTrackWorkflowF","addToExtensionPoint","items","isSessionWithAddTracks","selection","onClose","arg1","trackIds","now","makeTrack","CreateMultiWiggleExtensionF","cb","file","index","adapterHint","fileName","getFileName","testAdapter","trackTypeGuesser","adapterName","GuessAdapterF","addRpcMethod","exports","LinearWiggleDisplayReactComponent","XYPlotRendererReactComponent","linearWiggleDisplayModelFactory","xyPlotRendererConfigSchema","utils","configure","assemblyManager","renamedArgs","renameRegionsIfNeeded","setLocation","TextField","variant","fullWidth","onChange","target","trim","slotProps","htmlInput","createCanvas","createImageBitmap","ImageBitmapType","drawImageOntoCanvasContext","imageData","context","serializedCommands","CanvasSequence","drawImage","weHave","OffscreenCanvas","isNode","window","ImageBitmap","nodeCreateCanvas","dataUri","canvas","toDataURL","img","nodeImage","onload","onerror","src","getContext","AbortError","checkAbortSignal","signal","AbortSignal","TypeError","aborted","makeAbortError","abortBreakPoint","setTimeout","DOMException","code","observeAbortSignal","fromEvent","Observable","isAbortException","exception","test","MultiVariantTooltip","backgroundColor","escapeHTML","useStyles","makeStyles","rel","cursor","mouseX","mouseY","classes","hoveredGenotype","sourceMap","className","x1","x2","y1","y2","bg","padding","margin","maxHeight","border","divider","RedErrorMessageBox","getDisplayStr","totalBytes","parseFloat","toPrecision","notJest","jest","getFeatureDensityStatsPre","staticBlocks","contentBlocks","getRpcSessionId","getSubType","isOptionalType","_subtype","isArrayType","isMapType","_subType","subType","getUnionSubTypes","unionType","isUnionType","_types","getPropertyType","propertyName","properties","getDefaultValue","_defaultValue","getEnumerationValues","resolveLateType","maybeLate","isLateType","idMaker","len","stack","pop","hashCode","textHeight","trackLabels","sum","baseModelFactory","AlignmentFeatureDetailsF","register","linearAlignmentsDisplay","bamLocation","indexType","fetchSizeLimit","sequenceAdapter","BamAdapterF","cramLocation","craiLocation","CramAdapterF","GuessAlignmentsTypesF","adapterGuesser","indexName","makeIndex","makeIndexType","htsgetBase","htsgetTrackId","HtsgetBamAdapterF","resizeHandle","AlignmentsDisplay","PileupDisplay","SNPCoverageDisplay","ResizeHandle","onDrag","delta","setHeight","getLowerPanelDisplays","getDisplayElements","subDisplay","lowerPanel","preCheck","union","snpCovHeight","heightPreConfig","userFeatureScreenDensity","lowerPanelType","LinearAlignmentsDisplayMixin","setScrollTop","setSNPCoverageHeight","n","featureIdUnderMouse","pileupConf","getFeatureByID","blockKey","searchFeatureByID","sortedBy","coverageConf","setSNPCoverageDisplay","setFeatureDensityStatsLimit","setPileupDisplay","setFilterBy","setLowerPanelType","resizeHeight","distance","oldHeight","setConfig","colorBy","setColorScheme","propagateColorBy","filterBy","propagateFilterBy","pileupHeight","when","overrideHeight","extra","LinearAlignmentsDisplayF","pileupDisplay","snpCoverageDisplay","PileupRenderer","maxFeatureScreenDensity","defaultFilterFlags","linearBasicDisplayConfigSchemaFactory","LinearPileupDisplayBlurb","Typography","tag","FilterByTagDialog","ColorByTagDialog","SetFeatureHeightDialog","SetMaxHeightDialog","SharedLinearPileupDisplayMixin","featureHeight","noSpacing","fadeLikelihood","trackMaxHeight","colorBySetting","filterBySetting","jexlFilters","hideSmallIndelsSetting","colorTagMap","observable","tagsReady","autorunReady","hideSmallIndels","setTagsReady","setMaxHeight","setFeatureHeight","setNoSpacing","colorScheme","updateColorTagMap","uniqueTag","colorPalette","totalKeys","isSessionModelWithWidgets","featureWidget","addWidget","getContainingTrack","showWidget","copyFeatureToClipboard","copy","notify","setJexlFilters","setHideSmallIndels","featureHeightSetting","renderReady","viewName","contextMenuItems","contextMenuFeature","MenuOpenIcon","clearFeatureSelection","ContentCopyIcon","renderPropsPre","featureId","layoutId","onFeatureContextMenu","setContextMenuFeature","colorSchemeSubMenuItems","FilterListIcon","createAutorun","vals","getUniqueTags","blocks","delay","SortByTagDialog","GroupByDialog","showSoftClipping","mismatchAlpha","sortReady","currSortBpPerPx","visibleModifications","modificationsReady","setCurrSortBpPerPx","updateVisibleModifications","uniqueModifications","getColorForModification","setModificationsReady","setSortReady","clearSelected","toggleSoftClipping","toggleMismatchAlpha","setSortedBy","centerLineInfo","centerBp","round","visibleModificationTypes","superRenderReady","mismatchAlphaSetting","superRenderPropsPre","superColorSchemeSubMenuItems","showSoftClip","result","SwapVertIcon","disabled","ColorLensIcon","modificationData","modifications","isolatedModification","twoColor","WorkspacesIcon","doAfterAttach","BaseLinearDisplayComponent","TrackHeightMixin","FeatureDensityMixin","lineWidth","jitter","drawInter","drawLongRange","loading","chainData","lastDrawnOffsetPx","lastDrawnBpPerPx","setLastDrawnOffsetPx","setLastDrawnBpPerPx","setLoading","setRef","setChainData","setDrawInter","setDrawLongRange","setLineWidth","setJitter","drawn","lineWidthSetting","jitterVal","drawFeats","stateModelF","drawSingletons","setDrawSingletons","showInterbaseCounts","showInterbaseIndicators","showArcs","modification","superAdapterProps","showArcsSetting","showInterbaseCountsSetting","showInterbaseIndicatorsSetting","setShowInterbaseIndicators","setShowInterbaseCounts","setShowArcs","getUniqueModifications","subadapter","multiTicks","SNPCoverageRenderer","PileupBaseRPC","rpcDriver","PileupGetReducedFeatures","featuresArray","getFeaturesInMultipleRegions","reduced","flags","tlen","pair_orientation","next_ref","next_pos","clipPos","getClip","SA","filtered","reduce","sum2","total","avg","sd","sqrt","upper","lower","getInsertSizeStats","chains","hasPaired","PileupGetVisibleModifications","mod","getModTypes","getTagAlt","PileupGetGlobalValueForTag","PileupRPCMethodsF","PileupLayoutSession","LayoutSession","update","cachedLayoutIsValid","cachedLayout","makeLayout","BoxRendererType","fetchSequence","getExpandedRegion","renderArgs","maxClippingSize","bpExpansion","ceil","createLayoutInWorker","layoutRecords","featureMap","sortFeature","featureArray","from","featuresInCenterLine","featuresOutsideCenter","innerArray","doesIntersect2","isCram","getTag","localeCompare","baseSortArray","mismatches","m","baseMap","aMismatch","bMismatch","acode","base","toUpperCase","bcode","charCodeAt","heightPx","displayMode","iterMap","expansionBefore","expansionAfter","cliplen","leftPx","rightPx","bpSpanPx","topPx","layoutFeature","notEmpty","getTotalHeight","layoutFeats","regionSequence","makeImageData","canvasWidth","maxHeightReached","createLayoutSession","selectedFeatureId","firstRender","setFirstRender","useState","useEffect","mouseIsDown","setMouseIsDown","movedDuringLastMouseDown","setMovedDuringLastMouseDown","selectedRect","highlightedFeature","highlightedRect","makeRect","leftBp","rightBp","bottomPx","selected","highlight","callMouseHandler","handlerName","featureHandler","canvasHandler","tagFilter","onMouseDown","onMouseEnter","onMouseOut","onMouseOver","onMouseUp","getFeatureOverlapping","mouseMove","onContextMenu","onFocus","onBlur","boxSizing","orientationType","minSubfeatureWidth","largeInsertionIndicatorScale","SNPCoverageAdapterF","makeImage","indicatorThreshold","WiggleRendering","AlignmentsPlugin","LinearPileupDisplayF","LinearSNPCoverageDisplayF","AlignmentsTrackF","PileupRendererF","SNPCoverageRendererF","LinearReadArcsDisplayF","LinearReadCloudDisplayF","AlignmentsFeatureWidgetF","chooseGridPitch","minMajorPitchPx","minMinorPitchPx","minMajorPitchBp","majorPitch","toExponential","majorPitchPx","minorPitch","makeTicks","emitMajor","emitMinor","gridPitch","minBase","maxBase","iterPitch","generateLocations","grow","asmName","asm","waitForAssembly","canonicalRefName","getCanonicalRefName","parentRegion","parseLocStrings","isValidRefName","inputs","parseLocString","exec","isInteger","calculateVisibleLocStrings","isSingleAssemblyName","block","assembleLocString","GranularRectLayout","pitchX","pitchY","blobToDataURL","blob","FileReader","readAsDataURL","hubTxtLocation","baseConnectionConfig","UCSCTrackHubConnection","BaseConnectionModelFactory","doConnect","UCSCTrackHubConnectionF","addConnectionType","ConnectionType","overview","useOffset","multiplier","interRegionPaddingWidth","offsetPx","dynamicBlocks","cytobandOffset","totalWidthPxWithoutBorders","polygonColor","tertiary","light","first","last","topLeft","bpToPx","coord","topRight","startPx","endPx","points","HEADER_BAR_HEIGHT","getStrokeProps","intersection2","left1","right1","left2","right2","isContainedWithin","nanoid","crypto","getRandomValues","Uint8Array","byte","AddTrackWorkflow","Checkbox2","FormControlLabel","control","Checkbox","getBreakendCoveringRegions","alt","bnd","parseBreakend","startPos","INFO","mateRefName","CHR2","matePos","END","MatePosition","matePosition","mate","stripIds","makeTitle","navToMultiLevelBreak","stableViewId","mirror","viewTracks","addView","hideHeader","reverse","r1","r2","navToLocations","zoomTo","centerAt","copyTracks","setCopyTracks","setMirror","Dialog","open","title","DialogContent","DialogActions","Button","autoFocus","focusOnBreakends","setFocusOnBreakends","windowSize","setWindowSize","useLocalStorage","coverage","topRegion","bottomRegion","gatherOverlaps","singleLevelFocusedSnapshotFromBreakendFeature","singleLevelEncompassingSnapshotFromBreakendFeature","endPos","setDisplayedRegions","lgv","l0","navToSingleLevelBreak","FactoryResetDialog","onFactoryReset","handleDialogClose","action","DialogContentText","ResetComponent","resetButtonText","dialogOpen","setDialogOpen","FatalErrorDialog","componentStack","maxWidth","DialogTitle","ErrorMessage","confObject","slotPath","slotName","newPath","subConf","getType","slot","expr","evalSync","isConfigurationModel","getTypeNamesFromExplicitlyTypedUnion","maybeUnionType","isType","typeNames","typeName","isBareConfigurationSchemaType","isModelType","isConfigurationSchemaType","isConfigurationSlotType","maybeDisplayName","textOverflow","BlockMsg","severity","Alert","stopPropagation","createStopToken","createObjectURL","revokeObjectURL","WorkerGlobalScope","xhr","XMLHttpRequest","send","popover","mouseEvents","paddingLeft","spacing","paddingRight","RubberbandTooltip","anchorEl","side","Popover","anchorOrigin","vertical","horizontal","transformOrigin","keepMounted","disableRestoreFocus","rubberband","textAlign","rubberbandControl","minHeight","rubberbandText","contrastText","RubberbandSpan","leftBpOffset","rightBpOffset","numOfBpSelected","sticky","setAnchorEl","el","getBpDisplayStr","calcStdFromSums","sumSquares","population","variance","rectifyStats","scoreMean","scoreSum","featureCount","basesCovered","scoreStdDev","scoreSumSquares","featureDensity","scoresToStats","seed","found","acc","summary","blankStats","useMeasure","dims","setDims","RS","ResizeObserver","contentRect","observe","disconnect","category10","dark2","set1","set2","tableau10","ggplot2Colors6","ggplot2Colors5","ggplot2Colors4","ggplot2Colors3","typeModels","stringArray","stringArrayMap","numberMap","refinement","integer","fileLocation","FileLocation","fallbackDefaults","literalJSON","valueJSON","objectJSON","typeModelExtensions","removeAtIndex","setAtIndex","addToKey","ar","removeAtKeyIndex","setAtKeyIndex","JexlStringType","ConfigSlot","configSlotModelName","charAt","stringToJexlExpression","jexl","newVal","reset","convertToCallback","convertToValue","funcResult","extend","defineProperty","isEmptyArray","modelName","inputSchemaDefinition","inputOptions","schemaDefinition","options","jbrowseSchemaDefinition","jbrowseSchemaOptions","preprocessConfigurationSchemaArguments","schemaType","modelDefinition","implicitIdentifier","volatileConstants","isJBrowseConfigurationSchema","jbrowseSchema","definition","slotDefinition","completeModel","setSubschema","newSchema","identifierDefault","modelDefault","defaultSnap","newSnap","matchesDefault","makeConfigurationSchemaModel","reference","contentBlock","whiteSpace","elidedBlock","backgroundImage","interRegionPaddingBlock","boundaryPaddingBlock","disabledBackground","ContentBlock","widthPx","ElidedBlock","InterRegionPaddingBlock","boundary","compilationCache","compiled","compile","createJexlInstance","isBlobLocation","filename","marginLeft","localPath","needToReload","getBlob","blobId","Box","flexDirection","alignItems","FormControl","component","hidden","files","isElectron","webUtils","require","getPathForFile","storeBlobLocation","lazyMap","prefix","Component","Suspense","fallback","lazyifyComponent","BaseFeatureDetail","Attributes","FeatureDetails","BaseCard","BaseAttributes","BaseCoreDetails","DataGridEntries","DataGrid","module","GridActionsCellItem","GridAddIcon","GridArrowDownwardIcon","GridArrowUpwardIcon","GridCellCheckboxForwardRef","GridCellCheckboxRenderer","GridCheckCircleIcon","GridCheckIcon","GridCloseIcon","GridColumnHeaderSeparator","GridColumnHeaderSortIcon","GridColumnIcon","GridColumnMenu","GridColumnMenuContainer","GridDragIcon","GridExpandMoreIcon","GridFilterAltIcon","GridFilterForm","GridFilterListIcon","GridFilterPanel","GridFooter","GridFooterContainer","GridHeader","GridHeaderCheckbox","GridKeyboardArrowRight","GridLoadIcon","GridLoadingOverlay","GridMenuIcon","GridMoreVertIcon","GridNoRowsOverlay","GridOverlay","GridPagination","GridPanel","GridPanelWrapper","GridRemoveIcon","GridRoot","GridRowCount","GridSearchIcon","GridSelectedRowCount","GridSeparatorIcon","GridTableRowsIcon","GridToolbarExportContainer","GridTripleDotsVerticalIcon","GridViewHeadlineIcon","GridViewStreamIcon","Entries","Accordion","AccordionActions","AccordionDetails","AccordionSummary","AlertTitle","Autocomplete","Avatar","AvatarGroup","Backdrop","Badge","Breadcrumbs","ButtonGroup","Card","CardActions","CardActionArea","CardContent","CardHeader","CardMedia","CircularProgress","Collapse","ClickAwayListener","Chip","Container","Divider","Drawer","Fab","Fade","FilledInput","FormLabel","FormHelperText","FormGroup","Grid","Grid2","Grow","Icon","IconButton","Input","InputBase","InputLabel","InputAdornment","Link","LinearProgress","List","ListItem","ListItemAvatar","ListItemSecondaryAction","ListItemIcon","ListSubheader","ListItemText","Menu","MenuItem","MenuList","Modal","NativeSelect","OutlinedInput","Pagination","PaginationItem","Paper","Popper","Portal","Radio","RadioGroup","Rating","ScopedCssBaseline","Select","Skeleton","Slider","Snackbar","SnackbarContent","SpeedDial","SpeedDialAction","SpeedDialIcon","Stack","Step","StepButton","StepConnector","StepLabel","StepIcon","Stepper","SvgIcon","Switch","Tab","Table","TableBody","TableCell","TableContainer","TableFooter","TableHead","TablePagination","TableRow","TableSortLabel","Tabs","TextareaAutosize","ToggleButton","ToggleButtonGroup","Toolbar","libs","mobx","mst","react","React","ReactJSXRuntime","ReactDom","ReactDomClient","mxreact","useGridApiContext","useGridApiRef","useGridRootProps","MUIUtils","createTheme","MUIStyles","Configuration","mstTypes","coreUi","coreTheme","coreUtil","coreColor","coreLayouts","trackUtils","Base1DView","coreIo","coreMstReflection","rxjs","pluggableElementTypes","ViewType","pluggableElementTypeModels","ServerSideRendererType","CircularChordRendererType","BaseAdapterExports","libsList","inLibsOnly","reExportsList","inReExportsOnly","isSequenceAdapter","isRegionsAdapter","isFeatureAdapter","isRefNameAliasAdapter","isTextSearchAdapter","EmptyConfig","BaseAdapter","static","_region","BaseFeatureDataAdapter","getHeader","_opts","getMetadata","getFeaturesInRegion","ObservableCreate","hasData","hasDataForRefName","subscribe","complete","merge","getRefNames","getRegionQuantitativeStats","getRegionFeatureDensityStats","lastTime","statsFromInterval","expansionTime","sampleCenter","maybeRecordStats","interval","statsSampleFeatures","refLen","currTime","POSITIVE_INFINITY","getMultiRegionFeatureDensityStats","BaseSequenceAdapter","findCircleIntersectionX","cx","cy","resultArray","solution","findCircleIntersectionY","cartesianToPolar","rho","theta","atan","PI","cartesianToTheta","twoPi","Slice","offsetRadians","radianWidth","bpPerRadian","flipped","startRadians","endRadians","widthBp","freeze","bpToXY","bp","radiusPx","offsetBp","elided","totalRadians","polarToCartesian","ExportSvgDialog","hideVerticalResizeHandle","hideTrackSelectorButton","lockedFitToWindow","disableImportForm","scrollX","scrollY","minimumRadiusPx","spacingPx","paddingPx","lockedPaddingPx","minVisibleWidth","minimumBlockWidth","trackSelectorType","volatileWidth","visibleSection","viewSides","circleCenter","circleRadius","viewL","viewR","viewT","viewB","vertices","maxRho","NEGATIVE_INFINITY","reflect","rhoMin","rhoMax","thetaMin","thetaMax","vx","vy","viewportVisibleSection","centerXY","circumferencePx","elidedBp","elidedRegions","pxPerRadian","totalBp","maximumRadiusPx","maxBpPerPx","minCircumferencePx","minBpPerPx","maxCircumferencePx","atMaxBpPerPx","atMinBpPerPx","tooSmallToLock","figureDimensions","figureWidth","figureHeight","visible","lastVisible","displayedRegion","staticSlices","slices","currentRadianOffset","calculateStaticSlices","visibleStaticSlices","visibleThetaMin","visibleThetaMax","r1start","r2start","r2length","r1length","sliceIsVisible","newHeight","setModelViewWhenAdjust","resizeWidth","oldWidth","rotateClockwiseButton","rotateClockwise","rotateCounterClockwiseButton","rotateCounterClockwise","zoomInButton","setBpPerPx","zoomOutButton","secondCondition","previouslyEmpty","activateTrackSelector","selector","toggleTrack","hideTrack","supportedDisplays","displayConf","toggleFitToWindowLock","exportSvg","renderToSvg","saveAs","FolderOpenIcon","PhotoCameraIcon","TrackSelectorIcon","DisplayError","radius","patternTransform","patternUnits","strokeWidth","dominantBaseline","textAnchor","secondary","quaternary","path","strokeDasharray","strokeDashoffset","animation","shown","setShown","timeout","clearTimeout","strokeLinecap","Loading","baseChordDisplayConfig","onChordClick","renderReactionData","blockDefinitions","renderReactionEffect","cannotBeRenderedReason","BaseChordDisplayModel","bezierRadiusRatio","refNameMap","origSlices","renamed","bezierRadius","renderStarted","renderSuccess","renderError","setRefNameMap","makeAbortableReaction","fireImmediately","getTrackAssemblyNames","getRefNameMapForAdapter","rendering","ReactRendering","CircularViewPlugin","addViewType","CircularViewF","LaunchCircularViewF","isAbstractMenuManager","appendToSubMenu","DataUsageIcon","getNextRefPos","cigarOps","positions","readPos","refPos","currPos","op","TOP","BOTTOM","heightFromSpecificLevel","level","getYPosOverride","trackRefs","getPxFromCoordinate","yPos","chunk","useNextFrame","variable","setNextFrameState","intersect","a1","a2","ids","a12","calc","getBlockFeatures","linearBasicDisplayModelFactory","renderingMode","sampleInfo","info","isPhased","ploidy","maxPloidy","HP","MAFFilterDialog","AddFiltersDialog","ClusterDialog","SetRowHeightDialog","MultiVariantBaseModelF","linearBareDisplayStateModelFactory","minorAlleleFrequencyFilter","showSidebarLabelsSetting","rowHeightSetting","autoHeight","lengthCutoffFilter","MAX_SAFE_INTEGER","referenceDrawingMode","simplifiedFeaturesStopToken","featuresVolatile","hasPhased","setRowHeight","setHoveredGenotype","setFeatures","setSimplifiedFeaturesLoading","setMafFilter","setShowSidebarLabels","setPhasedMode","setAutoHeight","setHasPhased","setSampleInfo","setReferenceDrawingMode","activeFilters","preSources","sourcesWithLayout","HeightIcon","SplitscreenIcon","CategoryIcon","featuresReady","getMultiVariantSourcesAutorun","getMultiVariantFeaturesAutorun","MultiLinearVariantMatrixDisplayComponent","lineZoneHeight","setMouseY","setMouseX","LinesConnectingMatrixToGenomicPosition","LegendBar","Crosshair","renderer","nrow","blockType","setLineZoneHeight","LinearVariantMatrixRenderer","mafs","canvasHeight","simplifiedFeatures","dimY","dimX","genotype","MultiVariantBaseRenderer","fillStyle","fillRect","featureGenotypeMap","rbush","rbush2","useMemo","RBush","minX","maxX","minY","maxY","minElement","Infinity","minElt","alleles","makeSimpleAltString","featureName","vcfGzLocationMap","indexLocationMap","samplesTsvLocation","bpToRadians","blockStart","blockEnd","blocksForRefs","hovered","setHovered","startBlock","svType","endPosition","endBlock","SVTYPE","chr2","startXY","endXY","controlXY","strokeColor","hoverStrokeColor","evt","blocksForRefsMemo","Chord","strokeColorSelected","strokeColorHover","baseModel","getGenotypeMatrix","genotypeFactor","getFeaturesThatPassMinorAlleleFrequencyFilter","alleleCounts","cacheSplit","genotypes","genotypeStatus","nonRefCount","uncalledCount","l","MultiVariantClusterGenotypeMatrix","progress","MultiVariantGetGenotypeMatrix","MultiVariantGetSimplifiedFeatures","samp","MultiVariantGetSources","vcfLocation","vcfGzLocation","VariantsPlugin","VcfAdapterF","VcfTabixAdapterF","SplitVcfTabixAdapterF","VariantFeatureWidgetF","ExtensionPointsF","LinearVariantDisplayF","LinearVariantMatrixDisplayF","MultiVariantRendererConfigSchema","MultiVariantRenderer","MultiLinearVariantDisplayF","MultiVariantRendererF","MultiLinearVariantMatrixRenderer","LinearVariantMatrixRendererF","ChordRendererType","StructuralVariantChordRendererF","BaseChordDisplayComponent","ChordVariantDisplayF","getRelativeX","getCytobands","cytobands","status","blockStatus","displayStatus","LoadingEllipses","BlockErrorMessage","BlockLoadingMessage","reloadFlag","isLeftEndOfDisplayedRegion","isRightEndOfDisplayedRegion","ServerSideRenderedBlockContent","doReload","getContainingDisplay","renderBlockData","renderBlockEffect","renderDelay","setRendered","setStatus","newStopToken","messageText","isRetryException","beforeDestroy","optDisplay","regionAsm","hasName","displayError","viewParams","getViewParams","JexlF","j","addFunction","log","log10","char","codePointAt","endsWith","pad","padEnd","padStart","count","repeat","match","substring","trimEnd","trimStart","addBinaryOp","toP","toFixed","euclideanDistance","averageDistance","setA","setB","distances","lenA","lenB","linkage","performance","clusters","_datum","indexes","clustersGivenK","iteration","cluster","nearestDistance","nearestRow","nearestCol","col","newCluster","order","dataFunction","asyncReactionFunction","reactionOptions","startedFunction","successFunction","errorFunction","inProgress","handleError","reaction","mobxReactionHandle","ComparativeServerSideRenderer","featurePassesFilters","passes","requestRegions","requestRegion","en","toLocaleString","ErrorBoundary","state","componentDidCatch","errorInfo","setState","FallbackComponent","setTarget","newTarget","LazyConfigurationEditorComponent","useNameOverride","refNameColumn","refNameColumnHeaderName","ConfigurationPlugin","FromConfigAdapterF","FromConfigRegionsAdapterF","FromConfigSequenceAdapterF","RefNameAliasAdapterF","HeadingComponent","ConfigurationEditorWidgetF","NcbiSequenceReportAliasAdapterF","isAbsoluteUrl","trackSource","trackData","indexTrackData","altAssemblyName","altTrackName","altTrackType","textIndexTrack","textIndexingConf","mixinData","setMixinData","setAdapterHint","setTrackSource","setTextIndexingConf","setTextIndexTrack","setTrackData","setIndexTrackData","setAssembly","setTrackName","setTrackType","clearData","trackAdapter","guessAdapter","trackName","isFtp","isRelativeTrackUrl","isRelativeIndexUrl","isRelativeUrl","trackHttp","indexHttp","wrongProtocol","protocol","unsupported","UNSUPPORTED","trackAdapterType","guessTrackType","getTrackConfig","timestamp","assemblyInstance","deepmerge","warningMessage","AddTrackWidgetF","viewMetadata","extendedName","ArcRenderer","ArcTooltip","Arc","displayHeight","isMouseOvered","setIsMouseOvered","textStroke","caption","textYCoord","centerX","centerY","angleInDegrees","angleInRadians","cos","sin","describeArc","startAngle","endAngle","largeArcFlag","SemiCircles","semicircles","thickness","displayModeSetting","setDisplayMode","superMenuItems","renderArcSvg","ArcPlugin","ArcRendererF","LinearArcDisplayF","LinearPairedArcDisplayF","attributeName","authEndpoint","tokenEndpoint","needsPKCE","clientId","scopes","responseType","OAuthConfigSchema","fixup","buf","processError","invalidErrorCb","error_description","processTokenResponse","storeRefreshTokenCb","refresh_token","access_token","getResponseError","response","reason","statusText","getError","named","codeVerifier","codeVerifierPKCE","uint8array","output","fromCharCode","btoa","encode","refreshTokenKey","storeRefreshToken","refreshToken","localStorage","removeRefreshToken","retrieveRefreshToken","exchangeAuthorizationForAccessToken","redirectUri","params","URLSearchParams","grant_type","client_id","redirect_uri","code_verifier","method","body","ok","exchangeRefreshForAccessToken","listener","exchangedTokenPromise","addMessageChannel","finishOAuthWindow","addEventListener","deleteMessageChannel","removeEventListener","redirectUriWithInfo","fixedQueryString","redirectUrl","queryStringSearch","urlParams","pathname","useEndpointForAuthorization","response_type","token_access_type","scope","code_challenge","sha256","generateChallenge","code_challenge_method","eventName","ipcRenderer","invoke","eventFromDesktop","MessageEvent","doUserFlow","newToken","err","superGetFetcher","fetcher","DropboxIcon","dropboxErrorMessages","shared_link_not_found","shared_link_access_denied","unsupported_link_type","shared_link_is_directory","getDescriptiveErrorMessage","errorMessage","append","Authorization","validateWithHEAD","ExternalTokenEntryForm","setToken","required","doneCallback","GoogleDriveFile","statsPromise","metadataOnly","stat","GoogleDriveIcon","getUri","driveUrl","searchParams","credentials","HTTPBasicLoginForm","username","setUsername","password","setPassword","onSubmit","preventDefault","autoComplete","AuthenticationPlugin","OAuthInternetAccountModelFactory","ExternalTokenConfigSchema","ExternalTokenInternetAccountModelFactory","HTTPBasicConfigSchema","HTTPBasicInternetAccountModelFactory","DropboxOAuthConfigSchema","DropboxOAuthInternetAccountModelFactory","GoogleDriveOAuthConfigSchema","GoogleDriveOAuthInternetAccountModelFactory","addInternetAccountType","InternetAccountType","bedLocation","columnNames","scoreColumn","autoSql","colRef","colStart","colEnd","bedGraphLocation","bedGraphGzLocation","bedGzLocation","bedpeLocation","bigBedLocation","aggregateField","BedPlugin","BigBedAdapterF","BedAdapterF","BedpeAdapterF","BedTabixAdapterF","BedGraphAdapterF","BedGraphTabixAdapterF","BedpeAdapter","BedGraphAdapter","BedGraphTabixAdapter","startClip","endClip","showIntraviewLinks","linkViews","interactiveOverlay","matchedTrackFeatures","matchedTracks","getMatchedTracks","trackConfigId","getTrack","hasTranslocations","getTrackFeatures","hasPairedFeatures","flat","getMatchedFeaturesInLayout","cigar","onAction","onSubviewAction","actionName","getPath","setInteractiveOverlay","setShowIntraviewLinks","setLinkViews","setMatchedTrackFeatures","reverseViewOrder","LinkIcon","PhotoCamera","BreakpointSplitViewPlugin","BreakpointSplitViewF","BreakpointAlignmentsWidgetF","targetAssembly","queryAssembly","blastTableLocation","columns","chainLocation","syntenyTypes","pairwiseTypes","mcscanTypes","ComparativeAddTrackComponent","deltaLocation","MCScanAddTrackComponent","mcscanAnchorsLocation","bed1Location","bed2Location","bed1","bed2","mcscanSimpleAnchorsLocation","outLocation","pafLocation","pifGzLocation","ComparativeAdaptersPlugin","PAFAdapterF","PairwiseIndexedPAFAdapterF","DeltaAdapterF","ChainAdapterF","MCScanAnchorsAdapterF","MCScanSimpleAnchorsAdapterF","MashMapAdapterF","BlastTabularAdapter","comp","ComparativeAddTrackComponentF","MCScanAddTrackComponentF","ComparativeRender","rend","getRenderer","DotplotDisplay","vview","hview","ReactComponent2","blockMessage","blockError","LoadingMessage","BlockMessage","BlockError","ServerSideRenderedDotplotContent","shouldDisplay","viewWidth","viewHeight","borderSize","borderX","borderY","warnings","bpPerPxY","bpPerPxX","offX","offY","blockData","featurizeSA","getLength","getLengthSansClipping","MismatchParser","Dotplot1DView","scaleFactor","box","calculateDynamicBlocks","maxOffset","displayedRegionsTotalPx","minOffset","setScaleFactor","center","centerPx","scrollTo","DotplotHView","DotplotVView","ReturnToImportFormDialog","stringLenPx","pxWidthForBlocks","hide","getTickDisplayStr","DotplotRenderer","ComparativeRenderer","process","dimensions","setVolatileWidth","drawDotplot","thresholdsPalette","thresholds","tryTrack","idsNotFound","DotplotPlugin","tickSize","vtextRotation","htextRotation","drawCigar","viewTrackConfigs","volatileError","cursorMode","showPanButtons","wheelMode","importFormSyntenyTrackSelections","importFormRemoveRow","clearImportFormSyntenyTracks","setImportFormSyntenyTrack","assemblyErrors","assembliesInitialized","hticks","vticks","highResolutionScaling","setShowPanButtons","setWheelMode","setCursorMode","setDrawCigar","clearView","setBorderX","setBorderY","zoomOut","zoomIn","setAssemblyNames","query","setViews","getCoords","mousedown","mouseup","xmin","xmax","minmax","ymin","ymax","pxToBp","zoomInToMouseCoords","showAllRegions","onDotplotView","d1","d2","_unused1","rest1","_unused2","rest2","viewSnapshot","removeTemporaryAssembly","vblocks","hblocks","hoffset","voffset","vhide","getBlockLabelKeysToHide","hhide","by","bx","squareView","hpx","vpx","squareViewProportional","ratio","DotplotViewF","DotplotRendererF","LaunchDotplotViewF","pluggableElement","newStateModel","superContextMenuItems","AddIcon","readName","readAssembly","trackAssembly","SA2","totalLength","CIGAR","DotplotReadVsRefMenuItem","TimelineIcon","EditGCContentParamsDialog","SharedModelF","windowDelta","setGCContentParams","windowSizeSetting","windowDeltaSetting","GCContentPlugin","GCContentAdapterF","configSchemaFactory1","stateModelF1","configSchemaFactory2","stateModelF2","LinearGCContentDisplayF","gffLocation","gffGzLocation","dontRedispatch","GFF3Plugin","Gff3TabixAdapterF","Gff3AdapterF","GuessGff3F","bookmarkButton","Highlight","bookmarkHighlightsVisible","bookmarkLabelsVisible","bookmarkWidget","widgets","bookmarks","bookmark","CascadingMenuButton","setBookmarkHighlightsVisible","removeBookmarkObject","arrow","BookmarkIcon","sx","colord","toRgbString","OverviewHighlight","rev","borderLeft","borderRight","LabeledRegionModel","RegionModel","setLabel","setHighlight","SharedBookmarksModel","sharedBookmarks","localStorageKeyF","host","GridBookmarkPlugin","selectedBookmarks","selectedAssembliesPre","bookmarkAssemblies","validAssemblies","areBookmarksHighlightedOnAllOpenViews","areBookmarksHighlightLabelsOnAllOpenViews","bookmarksWithValidAssemblies","sharedBookmarksModel","allBookmarksModel","setSelectedAssemblies","assemblies","selectedAssemblies","importBookmarks","addBookmark","removeBookmark","updateBookmarkLabel","correspondingObj","updateBookmarkHighlight","updateBulkBookmarkHighlights","setSelectedBookmarks","setBookmarkedRegions","setBookmarkLabelsVisible","clearAllBookmarks","clearSelectedBookmarks","handler","AddHighlightModelF","GridBookmarkWidgetF","activateBookmarkWidget","navigateNewestBookmark","navTo","bookmarkCurrentRegion","focusedViewId","selectedRegions","getSelectedRegions","superRubberBandMenuItems","rubberBandMenuItems","BookmarksIcon","HighlightIcon","LabelIcon","leftOffset","rightOffset","document","activationSequence","ctrlKey","metaKey","shiftKey","appendToMenu","gtfLocation","GtfPlugin","GtfAdapterF","hicLocation","HicRenderer","hyp","yScalar","baseColor","useLogScale","activeNormalization","availableNormalizations","normalization","setUseLogScale","setActiveNormalization","setAvailableNormalizations","norm","norms","HicPlugin","HicAdapterF","HicRendererF","HicTrackF","LinearHicDisplayF","toHsl","toHex","Job","statusMessage","progressPct","cancelCallback","setCancelCallback","setStatusMessage","setProgressPct","pct","JobsManagementPlugin","jobs","finished","queued","addJob","job","existing","addedJob","removeJob","jobName","indx","addFinishedJob","finishedJob","addQueuedJob","queuedJob","addAbortedJob","abortedJob","removeQueuedJob","updateJobStatusMessage","updateJobProgressPct","JobsListWidgetF","Indexing","jobStatusWidget","dataDirLocation","fetchJb1","convertTrackConfig","jb2Tracks","jb1Track","dataRoot","breakConnection","namesIndexLocation","rootUrlTemplate","refNames","LegacyJBrowsePlugin","NCListAdapterF","GuessNCListF","addTextSearchAdapterType","JBrowse1TextSearchAdapterF","JBrowse1ConnectionF","LaunchSyntenyViewDialog","renderInProgress","existingFeatures","featIds","newFeatIds","foundNewFeatureNotInExistingMap","foundExistingFeatureNotInNewMap","existingFeat","LinearSyntenyViewHelper","levels","param","removeView","setLevelHeight","average","setNewView","headerMenuItems","ReadVsRefDialog","mainCanvas","clickMapCanvas","cigarClickMapCanvas","mouseoverCanvas","featPositions","mouseoverId","clickId","cigarMouseoverId","setFeatPositions","setMainCanvasRef","setClickMapCanvasRef","setCigarClickMapCanvasRef","setMouseoverCanvasRef","setMouseoverId","setCigarMouseoverId","setClickId","numFeats","ready","featMap","Curves","drawCIGAR","drawCIGARMatchesOnly","drawCurves","setDrawCurves","setDrawCIGAR","setDrawCIGARMatchesOnly","showAllRegionsInAssembly","superHeaderMenuItems","CropFreeIcon","linearSyntenyViewHelperModelFactory","shownTracks","UnusedComponent","BaseFeatureWidgetStateModelF","LinearComparativeViewPlugin","LinearSyntenyViewHelperF","LinearComparativeViewF","LinearSyntenyViewF","LinearComparativeDisplayF","middle","baseConfigFactory","LinearSyntenyDisplayF","SyntenyFeatureWidgetF","mouseover","linearPileupDisplayConfigSchemaFactory","r3","LGVSyntenyDisplayF","navToSearchString","tryTrackLGV","trackSet","tryTrackSynteny","LaunchLinearSyntenyViewF","SyntenyTrackF","CalendarIcon","FloatingLayout","rectangles","anchorLocation","getLayout","sorted","maxBottom","layoutEntries","currentItem","bottom","previouslyLaidOutItem","prevStart","prevTop","prevWidth","prevHeight","prevEnd","prevBottom","serializeRegion","pairs","PrecomputedFloatingLayout","FloatingLayoutSession","layoutIsValid","LollipopRenderer","deserializeLayoutInClient","ScoreText","layoutRecord","anchorX","innerColor","scoreString","fontHeight","contrastingTextColor","styleOuter","styleInner","onFeatureMouseDown","onFeatureMouseEnter","onFeatureMouseOut","onFeatureMouseOver","onFeatureMouseUp","onFeatureMouseLeave","onFeatureMouseMove","layoutFeat","client","setClient","records","Stick","Lollipop","minStickLength","stickColor","stickWidth","LollipopPlugin","LollipopRendererF","LinearLollipopDisplayF","MenusPlugin","AboutWidgetF","HelpWidgetF","ImportSessionWidgetF","SessionManagerF","InfoIcon","widget","HelpIcon","endpoint","queryTemplate","refNamesQueryTemplate","additionalQueryParams","RdfPlugin","SPARQLAdapterF","fastaLocation","faiLocation","metadataLocation","gziLocation","chromSizesLocation","Translation","codonTable","seq","frame","colorByCDS","seqStart","frameShift","frameShiftAdjustedSeqLength","multipleOfThreeLength","seqSliced","translated","codon","normalizedCodon","revcom","aminoAcid","letter","codonWidth","renderLetter","defaultFill","framesCDS","main","frames","codonFill","defaultStarts","startCodon","defaultStops","stopCodon","Sequence","sequenceType","bases","getContrastText","SequenceSVG","configTheme","showReverse","showForward","showTranslation","generateCodonTable","defaultCodonTable","currY","showSequence","forwardFrames","reverseFrames","topFrames","bottomFrames","toReversed","complement","userSelect","sequenceHeight","DivSequenceRenderer","divSequenceRendererConfigSchema","searchForward","searchReverse","caseInsensitive","twoBitLocation","chromSizes","rewriteRefNames","SequencePlugin","DivSequenceRendererF","TwoBitAdapterF","BgzipFastaAdapterF","ChromSizesAdapterF","IndexedFastaAdapterF","UnindexedFastaAdapterF","SequenceSearchAdapterF","createReferenceSeqTrackConfig","ReferenceSequenceTrackF","showForwardActual","showReverseActual","showTranslationActual","toggleShowForward","toggleShowReverse","toggleShowTranslation","LinearReferenceSequenceDisplayF","createExtensionPoints","fileTypes","fileTypeParsers","VCF","parseVcfBuffer","BED","parseBedBuffer","BEDPE","parseBedPEBuffer","STAR-Fusion","parseSTARFusionBuffer","fileTypesRegexp","locationLinkClick","spreadsheetViewId","newViewId","BreakendMultiLevelOptionDialog","BreakendSingleLevelOptionDialog","FeatureMenu","assembleLocStringFast","ArrowDropDownIcon","LocationCell","href","ImportWizardModel","fileType","hasColumnNameLine","columnNameLineNumber","selectedAssemblyName","cachedFileLocation","fileSource","isReadyToOpen","requiresUnzip","tracksForAssembly","selectedAssembly","getAdapterLoc","getTrackName","setSelectedAssemblyName","setFileSource","newSource","firstMatch","setColumnNameLineNumber","newnumber","setFileType","cancelButton","setCachedFileHandle","import","typeParser","fetchAndMaybeUnzip","filehandle","displaySpreadsheet","hideFilterControls","importWizard","spreadsheet","rowSet","visibleColumns","visibleRowFlags","cellData","cells","dataGridColumns","field","measureGridWidth","renderCell","valueGetter","_val","valueFormatter","toLocale","minWidth","visibleRows","_f","setVisibleRows","setVisibleColumns","isDerived","extendedData","vcfFeature","rowMenuItems","setRowMenuItems","newItems","SpreadsheetViewPlugin","SpreadsheetViewF","exts","ext","LaunchSpreadsheetViewF","ViewComfyIcon","defaultOnChordClick","chordTrack","SvInspectorViewPlugin","SpreadsheetViewType","CircularViewType","SpreadsheetModel","CircularModel","onlyDisplayRelevantRegionsInCircularView","spreadsheetView","circularView","SpreadsheetViewReactComponent","CircularViewReactComponent","circularViewOptionsBarHeight","showCircularView","featuresAdapterConfigSnapshot","featureRefNames","currentAssembly","canonicalFeatureRefNameSet","featuresCircularTrackConfiguration","setOnlyDisplayRelevantRegionsInCircularView","Boolean","spreadsheetWidth","circularViewWidth","generatedTrackConf","SvInspectorViewF","LaunchSvInspectorViewF","TableChartIcon","FeatureLabel","featureWidth","allowedWidthExpansion","totalWidth","measuredTextWidth","viewLeft","featureLabelsVisible","setFeatureLabelsVisible","rstart","featureWidthBp","offsetPx1","stripAlpha","rootLayout","shouldShowName","shouldShowDescription","featureLayout","getSubRecord","GlyphComponent","absolute","OverlayRect","rectProps","rectTop","screenWidth","rectHeight","leftWithinBlock","diff","widthWithinBlock","handlers","mouseoverFeatureId","renderOverlay","setRenderOverlay","fillOpacity","reverseFlip","color2","topLevel","featureStart","featureEnd","featureType","featureStrand","featurePhase","isUTR","getFrame","frameColor","Arrow","subfeature","subfeatureId","subfeatureLayout","getSubparts","hasUTRs","isTranscript","subs","subparts","haveLeftUTR","haveRightUTR","codeStart","codeEnd","subpart","unshift","makeUTRs","confKey","makeSubpartsFilter","filterSubpart","ProcessedTranscript","Segments","layOut","extraGlyphs","layOutFeature","layOutSubfeatures","Subfeatures","topOffset","SubfeatureGlyphComponent","chooseGlyphComponent","subfeatureHeight","move","transcriptTypes","containerTypes","hasSubSub","validator","glyph","parentFeature","layoutParent","addChild","RenderedFeatureGlyph","detectRerender","labelAllowed","SceneGraph","expansion","showLabels","showDescriptions","getWidth","glyphWidth","textWidth","aboveLayout","FeatureGlyph","RenderedFeatures","isFeatureDisplayed","featureDisplayHandler","maxConfHeight","initialMousePos","setInitialMousePos","mouseDown","useCallback","mouseUp","dx","dy","featureIdCurrentlyUnderMouse","click","SvgOverlay","color1","color3","outline","labels","nameColor","descriptionColor","maxFeatureGlyphExpansion","subParts","impliedUTRs","SvgFeatureRenderer","SVGPlugin","SvgFeatureRendererReactComponent","svgFeatureRendererConfigSchema","ixFilePath","ixxFilePath","metaFilePath","TrixPlugin","SVG","LinearGenomeView","Alignments","Authentication","Bed","CircularView","Config","DataManagement","DotplotView","Gff3","LegacyJBrowse","LinearComparativeView","Menus","RDF","Variants","Wiggle","GCContent","SvInspectorPlugin","BreakpointSplitView","ComparativeAdapters","verticalGuidesZoomContainer","verticalGuidesContainer","tick","majorTick","minorTick","RenderedBlockLines","ContentBlockComponent","RenderedVerticalGuides","k","ElidedBlockComponent","InterRegionPaddingBlockComponent","offsetLeft","totalWidthPx","dragHandle","dragHandleIcon","verticalAlign","draggable","onDragStart","currentTarget","parentNode","dataTransfer","setDragImage","setDraggingTrackId","onDragEnd","DragIcon","isTopLevelView","PushPinIcon","MinimizeIcon","KeyboardDoubleArrowUpIcon","moveTrackToTop","KeyboardArrowUpIcon","moveTrackUp","KeyboardArrowDownIcon","moveTrackDown","KeyboardDoubleArrowDownIcon","moveTrackToBottom","getTrackActionMenuItems","MoreVertIcon","root","iconButton","TrackLabelDragHandle","CloseIcon","TrackLabelMenu","trackLabel","trackLabelOffset","trackLabelOverlap","labelStyle","trackLabelsSetting","TrackLabel","renderingComponentContainer","trackRenderingContainer","overflowY","overflowX","onDragEnter","onScroll","onHorizontalScroll","horizontalScroll","marginTop","unpinnedTrack","draggingTrackId","showTrackOutlines","elevation","detail","Gridlines","TrackLabelContainer","TrackRenderingContainer","moveTrack","guide","tooltipTarget","coordX","stickyViewHeaders","rubberbandTop","placement","useRangeSelect","shiftOnly","startX","setStartX","currentX","setCurrentX","anchorPosition","setAnchorPosition","guideX","setGuideX","mouseDragging","relativeX","mouseOut","setOffsets","handleMenuItemClick","callback","globalMouseMove","globalMouseUp","computeOffsets","rubberbandOn","ControlComponent","VerticalGuide","anchorReference","onMenuItemClick","majorTickLabel","lineHeight","justifyContent","baseNumber","ScalebarCoordinateTicks","refLabel","fontWeight","b0","scaleBarDisplayPrefix","lastLeftBlock","forEach","blockOffsetPx","container","zoomContainer","scalebar","other","ScalebarCoordinateLabels","ScalebarRefNameLabels","CenterLine","tracksContainer","TracksContainer","mouseDown1","setMouseDragging","scheduled","prevX","cleanup","requestAnimationFrame","dataset","resizer","button","useSideScroll","showGridlines","showCenterLine","mouseDown2","samples","curr","onWheel","deltaY","averageDeltaY","normalizer","deltaX","useWheelScroll","additional","Rubberband","Scalebar","SCALE_BAR_HEIGHT","HighlightGroup","NoTracksActiveButton","header","VIEW_HEADER_HEIGHT","pinnedTracks","LinearGenomeViewContainer","pinnedTracksTop","unpinnedTracks","MiniControlsComponent","HeaderComponent","handleSelectView","Element","contains","setFocusedViewId","hoverPosition","hoverFeature","TrackContainer","ImportForm","hasDisplayedRegions","func","catch","findNonSparseKeys","hasAnyOverlap","s1","matches","categories","queryLower","findSubCategories","paths","hasSubs","findTopLevelCategories","nonMetadataKeys","filterTracks","trackListAssemblies","trackAssemblyNames","trackAssemblies","trackSelectorAnyOverlap","hasAllOverlap","generateHierarchy","noCategories","hierarchy","collapsed","activeSortTrackNames","activeSortCategories","confs","sortNames","sortCategories","sortConfs","currLevel","isOpenByDefault","keyConfigPostFix","recentlyUsedK","favoritesK","collapsedK","localStorageGetJSON","localStorageSetJSON","MAX_RECENTLY_USED","stateTreeFactory","faceted","showSparse","showFilters","showOptions","panelWidth","useShoppingCart","setFilter","setPanelWidth","setUseShoppingCart","setShowSparse","setShowOptions","setShowFilters","allTrackConfigurations","filteredNonMetadataKeys","metadataKeys","getRootKeys","filteredMetadataKeys","fields","filteredRows","arrFilters","setVisible","favorites","recentlyUsed","sortTrackNames","recentlyUsedCounter","favoritesCounter","shownTrackIds","selectionSet","favoritesSet","recentlyUsedSet","setSortTrackNames","setSortCategories","addToSelection","removeFromSelection","clearSelection","addToFavorites","removeFromFavorites","clearFavorites","setRecentlyUsedCounter","setRecentlyUsed","setFavorites","setFavoritesCounter","addToRecentlyUsed","clearRecentlyUsed","setView","toggleCategory","pathName","setCategoryCollapsed","expandAllCategories","setCollapsedCategories","isSelected","isFavorite","isRecentlyUsed","getRefSeqTrackConf","configAndSessionTrackConfigurations","connectionInstances","allTrackConfigurationTrackIdSet","favoriteTracks","recentlyUsedTracks","allTracks","group","collapseSubCategories","collapseTopLevelCategories","trackGroups","hasAnySubcategories","lc","HierarchicalTrackSelectorWidgetF","AddConnectionWidgetF","altTypeToSO","DEL","INS","DUP","INV","INVDUP","CNV","TRA","NON_REF","getSOTermAndDescription","parser","soTerms","soTerm","getSOAndDescFromAltDefs","getSOAndDescByExamination","descs","prefixes","desc","suffixes","pref","modAlt","makeDescriptionString","lenRef","lenAlt","lena","lenb","getMinimalDesc","cytobandLocation","CoreGetRefNames","CoreGetFeatureDetails","superArgs","getLayoutSession","CoreGetMetadata","CoreGetFileInfo","CoreGetFeatures","validateRendererType","CoreRender","des","CoreFreeResources","getRendererTypes","_rpcDriver","CoreGetFeatureDensityStats","CorePlugin","RpcMethod","coreRpcMethods","CytobandAdapterF","PhasedScheduler","phaseCallbacks","phaseOrder","phase","run","phaseName","TypeRecord","registeredTypes","baseClass","PluginManager","plugins","pluginMetadata","runtimePluginDefinitions","elementCreationSchedule","adapterTypes","textSearchAdapterTypes","trackTypes","connectionTypes","viewTypes","widgetTypes","rpcMethods","addTrackWidgets","internetAccountTypes","configured","extensionPoints","initialPlugins","addPlugin","plugin","isCore","pluginConfigurationSchemas","configurationSchemas","configurationSchema","load","getPlugin","hasPlugin","createPluggableElements","setRootModel","getElementTypeRecord","groupName","addElementType","creationCallback","typeRecord","newElement","getElementType","getElementTypesInGroup","getViewElements","getTrackElements","getConnectionElements","getAddTrackWorkflowElements","getRpcElements","getAdapterElements","fieldName","null","pluggableTypes","typeGroup","jbrequireCache","lib","ReExports","jbrequire","pack","getTextSearchAdapterType","getAddTrackWorkflow","getWidgetType","getConnectionType","getRpcMethodType","methodName","getInternetAccountType","newView","extensionPointName","callbacks","extendee","accumulator","evaluateAsyncExtensionPoint","borderTop","mouseOverLine","setMouseOverLine","AllLines","LineTooltip","scaleLinear","scaleLog","scaleQuantize","nice","rangeMin","rangeMax","getOrigin","getScaleType","fillRectCtx","PrecomputedLayout","insert","getRectangles","collides","_rect","_top","getByCoord","getByID","addRectToBitmap","_data","_left","_right","HEADER_OVERVIEW_HEIGHT","RESIZE_HANDLE_HEIGHT","INTER_REGION_PADDING_WIDTH","SPACING","WIDGET_HEIGHT","BlockSet","lastBlock","getBlocks","getRegions","toRegion","thisarg","BaseBlock","assign","elidedBlockCount","otherBlock","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","namedColorToHex","isNamedColor","getLuminance","convertedColor","muiGetLuminance","emphasize","coefficient","muiEmphasize","makeContrasting","foreground","minContrastRatio","convertedForeground","convertedBackground","backgroundLuminance","contrastRatio","getContrastRatio","originalColor","darken","lighten","TextSearchManager","QuickLRU","maxSize","loadTextSearchAdapters","relevantAdapters","adapterId","adapterInstance","aggregateTextSearchAdapters","jbrowse","getAdaptersWithAssembly","getTrackAdaptersWithAssembly","rankFn","search2","adapters","searchIndex","sortResults2","uf","uFuzzy","haystack","needle","idxs","rightRoundedRect","leftTriangle","_y","rightTriangle","colorMap","gneg","gpos25","gpos50","gpos100","gpos75","gvar","stalk","acen","lcap","rcap","h","centromereSeen","minSizeToBotherWith","segmentsIntersect","LayoutRow","widthLimit","setAllFilled","allFilled","getItemAt","rowState","bits","isRangeClear","initialize","rectWidth","oLeft","oRight","currLength","additionalLength","leftTrimAmount","rightTrimAmount","trimAmount","desiredLength","hardRowLimit","bitmap","pTotalHeight","storedRec","pLeft","pRight","pHeight","rectangle","originalHeight","maxTop","autovivifyRow","yEnd","hasSeen","pY","pX","regionRectangles","getMostFrequentAlt","mostFrequentAlt","altCount","calculateAlleleCounts","firstMax","secondMax","num","findSecondLargestNumber","calculateMinorAlleleFrequency","orientationTypes","fr","F1R2","F2R1","F1F2","F2F1","R1R2","R2R1","R1F2","R2F1","rf","ff","pairMap","LR","LL","RR","RL","originalRefName","o","g","mix","names","ThrowingLayout","PrecomputedMultiLayout","sublayoutJson","absoluteCache","dirty","nameOrSceneGraph","childLeft","childRight","childTop","childBottom","expand","newLeft","newRight","newTop","newBottom","walkParents","walkChildren","xOffset","yOffset","node","hoverVertical","offsetMouseCoord","clientRect","useClientY","calculateStaticBlocks","elision","modelWidth","windowLeftBp","windowRightBp","blockSizePx","blockSizeBp","regionBpOffset","regionNumber","regionStart","regionEnd","regionBlockCount","windowRightBlockNum","windowLeftBlockNum","regionWidthPx","blockNum","locstr","includeAsm","oob","viewOffsetPx","blockLabelKeysToHide","sortedBlocks","alen","labelBounds","orientation","Axis","shadow","format","orient","LEFT","RIGHT","fg","hasPairedReads","alphaColor","toHslString","flagInclude","flagExclude","negFlags","posFlags","cacheGetter","ctor","prop","getter","getOwnPropertyDescriptor","prototype","filterReadFlag","filterTagValue","readVal","filterVal","configEditorComponent","isViewContainer","isSessionModel","disableAddTracks","isSessionWithShareURL","shareURL","isSessionModelWithConnections","isSessionModelWithConnectionEditing","isSessionWithSessionPlugins","isViewModel","isTrackModel","isDisplayModel","isTrackViewModel","isRootModelWithInternetAccounts","isLocalPathLocation","AuthNeededError","setPrototypeOf","deserializedFeatures","serialized","_renderArgs","featureObservable","modificationRegex","getModProbabilities","getModPositions","mm","fseq","fstrand","mods","basemod","skips","typestr","getMethBins","flen","methBins","hydroxyMethBins","methProbs","hydroxyMethProbs","probabilities","probIndex","idx2","prob","filterChain","inputFilter","displayedRegionLeftPx","windowLeftPx","windowRightPx","displayedRegionRightPx","FeatureRenderer","RpcRenderedSvgGroup","bpSoFar","lengthBetween","numBlocksWideEnough","targetBpPerPx","newBpPerPx","extraBp","bpToStart","interRegionPaddingBp","currBlock","getEnd","POS","REF","ALT","isTRA","isSymbolic","VCFFeature","CHROM","ID","dataFromVariant","_id","SAMPLES","GENOTYPES","cigarToMismatches","ops","qual","roffset","soffset","hasRefAndSeq","altbase","q","subarray","mdRegex","cigarRegex","parseCigar","getMismatches","md","mdstring","cigarMismatches","lastCigar","lastTemplateOffset","lastRefOffset","lastSkipPos","mismatchRecords","getTemplateCoordLocal","refCoord","templateOffset","refOffset","mismatch","mdToMismatches","getOrientedCigar","flip","getOrientedMismatches","getLengthOnRef","lengthOnRef","normalize","aln","saRef","saStart","saStrand","saCigar","saLengthOnRef","saLength","saLengthSansClipping","saStrandNormalized","saClipPos","saRealStart","seqLength","AutocompleteTextField","TextFieldProps","inputBoxVal","setInputValue","setCurrentSearch","helperText","InputProps","placeholder","onSelect","setOpen","loaded","setLoaded","currentSearch","inputValue","searchOptions","setSearchOptions","debouncedSearch","useDebounce","coarseVisibleLocStrings","aggregateResults","regionOptions","disableListWrap","disableClearable","freeSolo","includeInputInList","selectOnFocus","onInputChange","_event","newInputValue","loadingText","onOpen","selectedOption","getOptionDisabled","filterOptions","searchQuery","toLocaleLowerCase","getFiltered","renderInput","getOptionLabel","opt","CompositeMap","submaps","submap","Symbol","iterator","TooLargeMessage","regionTooLargeReason","featureDensityStats","userBpPerPxLimit","userByteSizeLimit","featureDensityStatsP","currentBytesRequested","bytes","currentFeatureScreenDensity","featureDensityStatsReady","maxAllowableBytes","setCurrStatsBpPerPx","clearFeatureDensityStats","getFeatureDensityStats","setFeatureDensityStats","autorunFeatureDensityStats","setFeatureDensityStatsP","regionTooLarge","req","regionCannotBeRenderedText","minDisplayHeight","blockState","BlockState","featureMaps","addBlock","deleteBlock","navToFeature","setFeatureIdUnderMouse","CenterFocusStrongIcon","renderBaseLinearDisplaySvg","blocksPresent","linearBlocks","heightOverflowed","borderBottom","textShadow","RenderedBlocks","LinearBlocks","viewModel","setClientRect","setOffsetMouseCoord","setClientMouseCoord","contextCoord","setContextCoord","mouseCoord","transition","onExit","tooltip","trackShowLabels","trackShowDescriptions","trackDisplayMode","toggleShowLabels","toggleShowDescriptions","panButton","HeaderPanControls","slide","ArrowBackIcon","ArrowForwardIcon","HeaderRegionWidth","coarseTotalBp","toggleButton","HeaderTrackSelectorButton","RegionWidthEditorDialog","slider","ValueLabelComponent","enterTouchDelay","HeaderZoomControls","setValue","log2","zoomInDisabled","zoomOutDisabled","zoom","ZoomOut","onChangeCommitted","valueLabelDisplay","valueLabelFormat","newValue","slots","valueLabel","ZoomIn","MoreVert","OverviewRubberbandHoverTooltip","cytoband","OverviewRubberband","controlsRef","globalKeyDown","scalebarLabel","OverviewScalebarTickLabels","refNameColor","getRefNameColor","tickLabels","offsetLabel","tickLabel","labelIdx","scalebarBorder","scalebarContig","scalebarContigForward","backgroundRepeat","scalebarContigReverse","scalebarRefName","scalebarVisibleRegion","overviewSvg","OverviewBox","showCytobands","canDisplayCytobands","borderColor","Cytobands","visibleRegions","overviewVisibleRegions","scalebarColor","firstOverviewPx","lastOverviewPx","transparency","OverviewScalebar","modWidth","OverviewScalebarPolygon","HelpDialog","HelpAdornment","isHelpDialogDisplayed","setHelpDialogDisplayed","EndAdornment","showHelp","marginRight","SearchIcon","headerRefName","SearchBox","RefNameAutocomplete","endAdornment","headerBar","headerForm","flexWrap","spacer","flexGrow","Controls","LinearGenomeViewHeader","hideHeaderOverview","focusedBackground","MiniControls","ArrowDown","SequenceSearchDialog","GetSequenceDialog","SearchResultsDialog","hideNoTracksActive","showCytobandsSetting","afterDisplayedRegionsSetCallbacks","coarseDynamicBlocks","sessionSetting","isSessionWithMultipleViews","Header","assembliesNotFound","scaleBarHeight","headerHeight","trackHeights","trackHeightsWithResizeHandles","includeAggregateIndexes","rewriteOnClicks","holdOnClick","apply","trackTypeActions","allActions","setShowTrackOutlines","setColorByCDS","setShowCytobands","setHideHeader","setHideHeaderOverview","setHideNoTracksActive","setShowGridlines","addToHighlights","removeHighlight","newOffsetPx","centerAtOffset","oldBpPerPx","searchResults","horizontallyFlip","displayInitialSnapshot","movingId","targetId","oldIndex","newIndex","setTrackLabels","setting","setShowCenterLine","simView","afterDisplayedRegionsSet","oldOffsetPx","factor","setInit","cancelLastAnimation","viewWidths","animate","cancelAnimation","springAnimate","canShowCytobands","anyCytobandsExist","SyncAltIcon","currentlyCalculatedStaticBlocks","stringifiedCurrentlyCalculatedStaticBlocks","sret","roundedDynamicBlocks","visibleLocStrings","setCoarseDynamicBlocks","optAssemblyName","navToLocation","parsedLocString","locations","navToMultiple","f1","f2","assembly1","assembly2","ref1","ref2","findLast","e1","e2","index2","ed","ZoomInIcon","LinearGenomeViewPlugin","ZoomControls","BasicTrackF","LinearBasicDisplayF","LinearGenomeViewF","LinearBareDisplayF","tracklist","nav","LaunchLinearGenomeViewF","LineStyleIcon","currBp","scroll","layoutSessions","getLayoutId","getWorkerSession","freeResourcesInWorker","rasterizeLayers","xlinkHref","convertToBlob","fakeCtx","canvasRecordedData","getSvg","innerHTML","dangerouslySetInnerHTML","__html","SVGBackground","shift","SVGRegionSeparators","Ruler","major","minor","hideText","SVGRuler","renderRuler","SVGScalebar","displayBp","x0","SVGHeader","cytobandHeight","rulerHeight","SVGTrackLabel","xoff","yoff","coarseStripHTML","SVGTracks","displayResults","textOffset","prevOffset","reactElements","themeName","allThemes","trackLabelMaxLen","renderToStaticMarkup","xmlns","xmlnsXlink","viewBox","YScaleBar","fetchers","globalRangeCache","HttpRangeFetcher","chunkSize","maxFetchSize","minimumTTL","RemoteFile","fetchBinaryRange","rangeParse","buffer","getRange","Response","requestDate","responseDate","hint","arrayBuffer","resolveUriLocation","LocalFile","BlobFile","absoluteLocation","internetAccount","getInternetAccount","checkAuthNeededFetch"],"sourceRoot":""}