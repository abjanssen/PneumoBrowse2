"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2574,6537],{17710(e,t,s){s.r(t),s.d(t,{default:()=>K});var n=s(28910),l=s(63209),i=s(69566),o=s(55614),a=s(35864),r=s(37472),c=s(46625),d=s(30128),h=s(89570),m=s(11218),u=s(49328),f=s(52189),p=s(30097),x=s(59705),g=s(1241),w=s(54825),v=s(84037),b=s(44460);const j=(0,c.n)()(e=>({facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}}));function k(e){const t=(0,o.c)(5),{onClick:s}=e;let n,l,i;return t[0]!==s?(n=()=>{s()},t[0]=s,t[1]=n):n=t[1],t[2]===Symbol.for("react.memo_cache_sentinel")?(l=(0,b.jsx)(u.A,{}),t[2]=l):l=t[2],t[3]!==n?(i=(0,b.jsx)(p.A,{title:"Clear selection on this facet filter",children:(0,b.jsx)(x.A,{onClick:n,size:"small",children:l})}),t[3]=n,t[4]=i):i=t[4],i}function C(e){const t=(0,o.c)(7),{visible:s,onClick:n}=e;let l,i,a;return t[0]!==n?(l=()=>{n()},t[0]=n,t[1]=l):l=t[1],t[2]!==s?(i=s?(0,b.jsx)(f.A,{}):(0,b.jsx)(m.A,{}),t[2]=s,t[3]=i):i=t[3],t[4]!==l||t[5]!==i?(a=(0,b.jsx)(p.A,{title:"Minimize/expand this facet filter",children:(0,b.jsx)(x.A,{onClick:l,size:"small",children:i})}),t[4]=l,t[5]=i,t[6]=a):a=t[6],a}const y=(0,i.observer)(function({column:e,vals:t,model:s}){const{classes:n}=j(),[l,i]=(0,d.useState)(!0),{faceted:o}=s,{filters:a}=o,{field:r}=e;return(0,b.jsxs)(g.A,{className:n.facet,fullWidth:!0,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(w.A,{component:"span",children:r}),(0,b.jsx)(k,{onClick:()=>{o.setFilter(r,[])}}),(0,b.jsx)(C,{visible:l,onClick:()=>{i(!l)}})]}),l?(0,b.jsx)(v.A,{multiple:!0,native:!0,className:n.select,value:a.get(e.field)||[],onChange:t=>{o.setFilter(e.field,[...t.target.options].filter(e=>e.selected).map(e=>e.value))},children:t.sort((e,t)=>e[0].localeCompare(t[0])).map(([e,t])=>(0,b.jsxs)("option",{value:e,children:[(0,h.Z)(e)," (",t,")"]},e))}):null]})});var S=s(89919);const A=(0,i.observer)(function({rows:e,columns:t,model:s}){const{faceted:n}=s,{filters:l}=n,i=t.slice(1),o=new Map(t.slice(1).map(e=>[e.field,new Map])),a=n.filters.keys(),r=i.map(e=>e.field),c=new Set;for(const e of a)l.get(e)?.length&&c.add(e);for(const e of r)c.add(e);let d=e;for(const e of c){const t=o.get(e);if(t)for(const s of d){const n=(0,S.a)(e,s),l=t.get(n);n&&(void 0===l?t.set(n,1):t.set(n,l+1))}const s=l.get(e)?.length?new Set(l.get(e)):void 0;d=d.filter(t=>void 0===s||s.has((0,S.a)(e,t)))}return(0,b.jsx)("div",{children:i.map(e=>(0,b.jsx)(y,{vals:[...o.get(e.field)],column:e,model:s},e.field))})});var T=s(23886),M=s(27529),N=s(44934);const W=(0,i.observer)(function({model:e,columns:t,shownTrackIds:s,selection:n}){const{view:l,faceted:i}=e,{rows:o,useShoppingCart:a,showOptions:r,filteredRows:c,filteredNonMetadataKeys:h,filteredMetadataKeys:m,visible:u}=i,[,f]=(0,d.useTransition)(),[p,x]=(0,d.useState)(()=>function(e,t,s,n){return{name:(0,T.measureGridWidth)(e.map(e=>e.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(t.filter(e=>n[e]).map(t=>[t,(0,T.measureGridWidth)(e.map(e=>e[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(s.filter(e=>n[`metadata.${e}`]).map(t=>[`metadata.${t}`,(0,T.measureGridWidth)(e.map(e=>e.metadata[t]),{maxWidth:400,stripHTML:!0})]))}}(o,h,m,u)),g=(0,d.useMemo)(()=>({type:"include",ids:new Set(a?n.map(e=>e.trackId):[...s])}),[a,n,s]),w=(0,d.useMemo)(()=>t.map(e=>({...e,width:p[e.field]})),[t,p]);return(0,b.jsx)(M.z,{rowHeight:25,columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,rows:c,columnVisibilityModel:u,showToolbar:r,onColumnWidthChange:e=>{x(t=>({...t,[e.colDef.field]:e.width}))},onColumnVisibilityModelChange:t=>{e.faceted.setVisible(t)},onRowSelectionModelChange:t=>{f(()=>{if(a)e.setSelection([...t.ids].map(t=>e.allTrackConfigurationTrackIdSet.get(t)).filter(T.notEmpty));else{const n=s,i=t.ids;(0,N.transaction)(()=>{[...n].filter(e=>!i.has(e)).map(e=>l.hideTrack(e)),[...i].filter(e=>!n.has(e)).map(t=>{l.showTrack(t),e.addToRecentlyUsed(t)})})}})},rowSelectionModel:g,columns:w})});var F=s(53458),H=s(66143),R=s(49186),_=s(6569),G=s(51138);function I(e){const t=(0,o.c)(49),{model:s}=e,{faceted:n}=s,{filterText:l,showOptions:i,showFilters:a,showSparse:r,useShoppingCart:c}=n,[h,m]=(0,d.useState)(null);let u,f,p,g,w;t[0]!==n?(u=e=>{n.setFilterText(e)},t[0]=n,t[1]=u):u=t[1],t[2]!==l||t[3]!==u?(f=(0,b.jsx)(_.A,{label:"Search...",value:l,onChange:u}),t[2]=l,t[3]=u,t[4]=f):f=t[4],t[5]===Symbol.for("react.memo_cache_sentinel")?(p=(0,b.jsx)(x.A,{onClick:e=>{m(e.currentTarget)},children:(0,b.jsx)(H.A,{})}),t[5]=p):p=t[5],t[6]!==s?(g=(0,b.jsx)(G.A,{model:s}),t[6]=s,t[7]=g):g=t[7],t[8]!==f||t[9]!==g?(w=(0,b.jsxs)(R.A,{container:!0,spacing:4,alignItems:"center",children:[f,p,g]}),t[8]=f,t[9]=g,t[10]=w):w=t[10];const v=!!h;let j,k,C,y,S,A,T,M,N,W,I,L,O;return t[11]===Symbol.for("react.memo_cache_sentinel")?(j=()=>{m(null)},k=(e,t)=>{t(),m(null)},t[11]=j,t[12]=k):(j=t[11],k=t[12]),t[13]!==n||t[14]!==c?(C=()=>{n.setUseShoppingCart(!c)},t[13]=n,t[14]=c,t[15]=C):C=t[15],t[16]!==C||t[17]!==c?(y={label:"Add tracks to selection instead of turning them on/off",onClick:C,type:"checkbox",checked:c},t[16]=C,t[17]=c,t[18]=y):y=t[18],t[19]!==n||t[20]!==r?(S=()=>{n.setShowSparse(!r)},t[19]=n,t[20]=r,t[21]=S):S=t[21],t[22]!==r||t[23]!==S?(A={label:"Show sparse metadata columns",onClick:S,checked:r,type:"checkbox"},t[22]=r,t[23]=S,t[24]=A):A=t[24],t[25]!==n||t[26]!==a?(T=()=>{n.setShowFilters(!a)},t[25]=n,t[26]=a,t[27]=T):T=t[27],t[28]!==a||t[29]!==T?(M={label:"Show facet filters",onClick:T,checked:a,type:"checkbox"},t[28]=a,t[29]=T,t[30]=M):M=t[30],t[31]!==n||t[32]!==i?(N=()=>{n.setShowOptions(!i)},t[31]=n,t[32]=i,t[33]=N):N=t[33],t[34]!==i||t[35]!==N?(W={label:"Show extra table options",onClick:N,checked:i,type:"checkbox"},t[34]=i,t[35]=N,t[36]=W):W=t[36],t[37]!==y||t[38]!==A||t[39]!==M||t[40]!==W?(I=[y,A,M,W],t[37]=y,t[38]=A,t[39]=M,t[40]=W,t[41]=I):I=t[41],t[42]!==h||t[43]!==I||t[44]!==v?(L=(0,b.jsx)(F.A,{anchorEl:h,open:v,onClose:j,onMenuItemClick:k,menuItems:I}),t[42]=h,t[43]=I,t[44]=v,t[45]=L):L=t[45],t[46]!==L||t[47]!==w?(O=(0,b.jsxs)(b.Fragment,{children:[w,L]}),t[46]=L,t[47]=w,t[48]=O):O=t[48],O}var L=s(55679);const O=(0,c.n)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}});function z(e){const t=(0,o.c)(12),{text:s,query:n,className:l}=e;if(!n||!s){let e;return t[0]!==l||t[1]!==s?(e=(0,b.jsx)("span",{className:l,children:s}),t[0]=l,t[1]=s,t[2]=e):e=t[2],e}let i,a;if(t[3]!==n||t[4]!==s){const e=s.toLowerCase(),l=n.toLowerCase();i=[];let o=0,a=e.indexOf(l,0);for(;-1!==a;)a>o&&i.push(s.slice(o,a)),i.push((0,b.jsx)("mark",{style:{background:"#FFEB3B"},children:s.slice(a,a+n.length)},a)),o=a+n.length,a=e.indexOf(l,o);if(o<s.length){let e;t[6]!==o||t[7]!==s?(e=s.slice(o),t[6]=o,t[7]=s,t[8]=e):e=t[8],i.push(e)}t[3]=n,t[4]=s,t[5]=i}else i=t[5];return t[9]!==l||t[10]!==i?(a=(0,b.jsx)("span",{className:l,children:i}),t[9]=l,t[10]=i,t[11]=a):a=t[11],a}const E=.75,$=(0,i.observer)(function({model:e}){const{classes:t}=O(),{selection:s,shownTrackIds:n,faceted:l}=e,{rows:i,panelWidth:o,showFilters:c,filterText:d,filteredNonMetadataKeys:h,filteredMetadataKeys:m}=l,u=[{field:"name",hideable:!1,renderCell:s=>{const{value:n,row:l}=s,{id:i,conf:o}=l;return(0,b.jsxs)("div",{className:t.cell,children:[(0,b.jsx)(r.A,{html:n}),(0,b.jsx)(L.A,{id:i,conf:o,model:e})]})}},...h.map(e=>({field:e,renderCell:e=>{const s=e.value;return s?(0,b.jsx)(z,{className:t.cell,text:s,query:d}):""}})),...m.map(e=>({field:`metadata.${e}`,headerName:["name",...h].includes(e)?`${e} (from metadata)`:e,valueGetter:(t,s)=>`${s.metadata[e]??""}`,renderCell:e=>{const s=e.value;return s?(0,b.jsx)(z,{className:t.cell,text:s,query:d}):""}}))];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(I,{model:e}),(0,b.jsxs)("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*E,width:window.innerWidth*E},children:[(0,b.jsx)("div",{style:{height:window.innerHeight*E,width:window.innerWidth*E-(c?o:0)},children:(0,b.jsx)(W,{model:e,columns:u,shownTrackIds:n,selection:s})}),c?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a.A,{vertical:!0,onDrag:e=>l.setPanelWidth(o-e),className:t.resizeHandle}),(0,b.jsx)("div",{style:{width:o,overflow:"auto"},children:(0,b.jsx)(A,{model:e,rows:i,columns:u})})]}):null]})]})}),K=(0,i.observer)(function(e){const{handleClose:t}=e;return(0,b.jsx)(n.A,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector",children:(0,b.jsx)(l.A,{children:(0,b.jsx)($,{...e})})})})},46537(e,t,s){s.d(t,{A:()=>m});var n=s(30128),l=s(21227),i=s(74533),o=s(80638),a=s(39104),r=s(45639),c=s(10137),d=s(44460);const h=(0,o.Ay)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,!s.disableGutters&&t.gutters,t[s.variant]]}})((0,a.A)(({theme:e})=>({position:"relative",display:"flex",alignItems:"center",variants:[{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}}},{props:{variant:"dense"},style:{minHeight:48}},{props:{variant:"regular"},style:e.mixins.toolbar}]}))),m=n.forwardRef(function(e,t){const s=(0,r.b)({props:e,name:"MuiToolbar"}),{className:n,component:o="div",disableGutters:a=!1,variant:m="regular",...u}=s,f={...s,component:o,disableGutters:a,variant:m},p=(e=>{const{classes:t,disableGutters:s,variant:n}=e,l={root:["root",!s&&"gutters",n]};return(0,i.A)(l,c.U,t)})(f);return(0,d.jsx)(h,{as:o,className:(0,l.A)(p.root,n),ref:t,ownerState:f,...u})})},10137(e,t,s){s.d(t,{A:()=>o,U:()=>i});var n=s(26743),l=s(2395);function i(e){return(0,l.Ay)("MuiToolbar",e)}const o=(0,n.A)("MuiToolbar",["root","gutters","regular","dense"])}}]);
//# sourceMappingURL=2574.ed4f6463.chunk.js.map