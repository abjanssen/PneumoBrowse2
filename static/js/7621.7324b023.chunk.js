"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7621],{90095(t,e,a){a.d(e,{pN:()=>s,a9:()=>c,qt:()=>l,OO:()=>r});class n{constructor(t=[],e){this.data={};const{checkIndent:a=!0,skipValidation:n=!1}=e??{},i="string"==typeof t?t.trimEnd().split(/\r?\n/):t;let o,r;for(const t of i){if(""===t)throw new Error("Invalid stanza, contained blank lines");if(t.trim().startsWith("#"))continue;if(t.trimEnd().endsWith("\\")){const e=t.trimEnd().slice(0,-1);r?r+=e.trimStart():r=e;continue}let e=t;if(r&&(e=r+e.trimStart(),r=void 0),o??a){const t=/^([ \t]+)/.exec(e);if(void 0===o)t?[,o]=t:o="";else if(""===o&&null!==t||o&&t&&o!==t[1])throw new Error("Inconsistent indentation of stanza")}else o="";const n=e.trim(),i=n.indexOf(" ");if(-1===i){if(!this.nameKey)throw new Error("First line in a stanza must have both a key and a value");if(this.data[n])continue;this.data[n]="";continue}const s=n.slice(0,i),c=n.slice(i+1);if(this.data[s]&&c!==this.data[s])throw new Error(`Got duplicate key with a different value in stanza: "${s}" key has both ${this.data[s]} and ${c}`);this.nameKey||(this.nameKey=s,this.name=n.slice(i+1)),this.data[s]=c}n||this.validate()}validate(){}}class i{constructor(t=[],e){this.data={};const{checkIndent:a=!0,skipValidation:i=!1}=e??{},o="string"==typeof t?t.trimEnd().split(/(?:[\t ]*\r?\n){2,}/):t;for(const t of o){if(""===t)throw new Error("Invalid stanza, was empty");if(t.startsWith("include"))continue;if(t.trim().startsWith("#")&&t.trimEnd().split(/\r?\n/).map(t=>t.trim()).every(t=>t.startsWith("#")))continue;const e=new n(t,{checkIndent:a});if(this.nameKey){if(e.nameKey!==this.nameKey)throw new Error(`The first line in each stanza must have the same key. Saw both ${this.nameKey} and ${e.nameKey}`)}else this.nameKey=e.nameKey;if(!e.name)throw new Error(`No stanza name: ${e.name}`);if(this.data[e.name])throw new Error(`Got duplicate stanza name: ${e.name}`);this.data[e.name]=e}i||this.validate()}validate(){}}function o(t,e,a=""){const n=[];for(const a of e)t.data[a]||n.push(a);if(n.length>0)throw new Error(`${a} is missing required entr${1===n.length?"y":"ies"}: ${n.join(", ")}`)}class r extends i{constructor(t,e){super(t,{...e,checkIndent:!1})}validate(){if("track"!==this.nameKey)throw new Error(`trackDb has "${this.nameKey}" instead of "track" as the first line in each track`);for(const[t,e]of Object.entries(this.data)){const a=Object.keys(e.data);o(e,["track","shortLabel"],`Track ${t}`);const n=new Set(["superTrack","compositeTrack","container","view"]);if(!a.some(t=>n.has(t))){if(!a.includes("bigDataUrl"))throw new Error(`Track ${t} is missing required key "bigDataUrl"`);if(!a.includes("type")&&!Object.keys(this.settings(t)).includes("type"))throw new Error(`Neither track ${t} nor any of its parent tracks have the required key "type"`)}let i=t;do{i=this.data[i]?.parent,i&&([i]=i.split(" "))}while(i);const r=this.data[t];r&&(this.data[t]=r)}}settings(t){if(!this.data[t])throw new Error(`Track ${t} does not exist`);const e=[t];let a=t;do{a=this.data[a]?.parent,a&&e.push(a)}while(a);const n={};e.reverse();for(const t of e){const e=this.data[t];if(e)for(const[t,a]of Object.entries(e))n[t]=a}return n}}class s extends i{validate(t=["genome","trackDb"]){if("genome"!==this.nameKey)throw new Error('Genomes file must begin with a line like "genome <genome_name>"');for(const[e,a]of Object.entries(this.data))o(a,t,`genome ${e}`)}}class c extends n{validate(){o(this,["hub","shortLabel","longLabel","genomesFile","email"],"Hub file")}}class l{constructor(t){const[e,a,...i]=t.trimEnd().split(/(?:[\t ]*\r?\n){2,}/);this.hubData=new n(e),this.validateHub(),this.genome=new n(a),this.validateGenomeSection(),this.tracks=new r(i.join("\n\n"),{skipValidation:!1})}validateHub(){if("hub"!==this.hubData.nameKey)throw new Error('Hub file must begin with a line like "hub <hub_name>"');o(this.hubData,["hub","shortLabel","longLabel","email"])}validateGenomeSection(){if("genome"!==this.genome.nameKey)throw new Error('Genomes file must begin with a line like "genome <genome_name>"')}}},97621(t,e,a){a.d(e,{doConnect:()=>w});var n=a(90095),i=a(11259),o=a(77251),r=a(33624),s=a(27868),c=a(10525),l=a(70203);async function h(t){const e=await(0,r.openLocation)(t).readFile("utf8");return new n.OO(e)}function d(t,e){return{uri:new URL(t,new URL(e.uri,e.baseUri)).href,locationType:"UriLocation"}}function m(t,e,a){return d(t||e,a)}function u(t,e){return t?{uri:t,locationType:"LocalPath"}:{uri:e,locationType:"UriLocation"}}function b(t,e){return new URL(t,e).href}function f({trackDb:t,trackDbLoc:e,assemblyName:a,baseUrl:n}){const i=new Set(["superTrack","compositeTrack","container","view"]);return Object.entries(t.data).map(([a,o])=>{const{data:r}=o;if(!Object.keys(r).some(t=>i.has(t))){const i=[];let r=a;do{r=t.data[r]?.data.parent||"",r&&(r=r.split(" ")[0],i.push(t.data[r]))}while(r);return i.reverse(),{metadata:{...o.data,...o.data.html?{html:`<a href="${b(o.data.html,n)}">${o.data.html}</a>`}:{}},category:[o.data.group,...i.map(t=>t?.data.group).filter(t=>!!t)].filter(t=>!!t),...p({track:o,trackDbLoc:e,trackDb:t})}}}).filter(o.notEmpty).map(t=>({...t,trackId:`ucsc-trackhub-${(0,o.objectHash)(t)}`,assemblyNames:[a]}))}function p({track:t,trackDbLoc:e,trackDb:a}){const{data:n}=t,i=n.parent||"",o=n.bigDataUrl||"",r=n.bigDataIndex||"",s=n.type||a.data[i]?.data.type||"",h=(n.shortLabel||"")+(o.includes("xeno")?" (xeno)":""),b=(0,c.C1)(e);let f=s.split(" ")[0]||"";"bam"===f&&o.toLowerCase().endsWith("cram")&&(f="cram");const p=b?d(o,e):u(o);return"bam"===f?{type:"AlignmentsTrack",name:h,description:n.longLabel,adapter:{type:"BamAdapter",bamLocation:p,index:{location:b?m(r,`${o}.bai`,e):u(r,`${o}.bai`)}}}:"cram"===f?{type:"AlignmentsTrack",name:h,description:n.longLabel,adapter:{type:"CramAdapter",cramLocation:p,craiLocation:b?m(r,`${o}.crai`,e):u(r,`${o}.crai`)}}:"bigWig"===f?{type:"QuantitativeTrack",name:h,description:n.longLabel,adapter:{type:"BigWigAdapter",bigWigLocation:p}}:f.startsWith("big")?{type:"FeatureTrack",name:h,description:n.longLabel,adapter:{type:"BigBedAdapter",bigBedLocation:p}}:"vcfTabix"===f?{type:"VariantTrack",name:h,description:n.longLabel,adapter:{type:"VcfTabixAdapter",vcfGzLocation:p,index:{location:b?m(r,`${o}.tbi`,e):u(r,`${o}.tbi`)}}}:"hic"===f?{type:"HicTrack",name:h,description:n.longLabel,adapter:{type:"HicAdapter",hicLocation:p}}:(0,l.generateUnknownTrackConf)(h,f)}async function w(t){const{pluginManager:e}=(0,o.getEnv)(t),a=(0,o.getSession)(t),c=[];try{const o=(0,i.FI)(t,"hubTxtLocation"),l=await(0,r.openLocation)(o).readFile("utf8"),d=b(o.uri,o.baseUri),{assemblyManager:m}=a;if(l.includes("useOneFile on")){const i=new n.qt(l),{genome:r,tracks:c}=i,h=r.name,u=r.data.description;m.get(h)||a.addSessionAssembly({name:h,displayName:u,sequence:{type:"ReferenceSequenceTrack",metadata:{...r.data,...r.data.htmlPath?{htmlPath:`<a href="${b(r.data.htmlPath,d)}">${r.data.htmlPath}</a>`}:{}},trackId:`${h}-${(0,s.w)()}`,adapter:{type:"TwoBitAdapter",twoBitLocation:{uri:b(r.data.twoBitPath,d)},chromSizesLocation:{uri:b(r.data.chromSizes,d)}}},...r.data.chromAliasBb?{refNameAliases:{adapter:{type:"BigBedAdapter",uri:b(r.data.chromAliasBb,d)}}}:{}});const p=f({trackDb:c,trackDbLoc:o,assemblyName:h,baseUrl:d});t.addTrackConfs(p),e.evaluateExtensionPoint("LaunchView-LinearGenomeView",{session:a,assembly:h,tracklist:!0,loc:r.data.defaultPos})}else{const e=new n.a9(l).data.genomesFile;if(!e)throw new Error("genomesFile not found on hub");const s=b(o.uri,o.baseUri),d=s?{uri:b(e,s),locationType:"UriLocation"}:{localPath:e,locationType:"LocalPathLocation"},u=await async function(t){const e=await(0,r.openLocation)(t).readFile("utf8");return new n.pN(e)}(d),p={};for(const[a,n]of Object.entries(u.data)){const o=(0,i.FI)(t,"assemblyNames");if(o.length>0&&!o.includes(a))continue;if(!m.get(a)){c.push(a);continue}const r=n.data.trackDb;if(!r)throw new Error("genomesFile not found on hub");const l=new URL(e,s),d=s?{uri:new URL(r,l).href,locationType:"UriLocation"}:{localPath:r,locationType:"LocalPathLocation"},u=f({trackDb:await h(d),trackDbLoc:d,assemblyName:a,baseUrl:s});t.addTrackConfs(u),p[a]=u.length}const w=Object.entries(p),y=w.length?`Loaded data from these assemblies: ${w.map(([t,e])=>`${t} (${e} tracks)`).join(", ")}`:"",k=c.length?`Skipped data from these assemblies: ${c.join(", ")}`:"";a.notify([y,k].filter(t=>!!t).join(". "),"success")}}catch(e){console.error(e),a.notifyError(`${(0,i.FI)(t,"name")}: "${e}"`,e),a.breakConnection?.(t.configuration)}}}}]);
//# sourceMappingURL=7621.7324b023.chunk.js.map