"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2297],{72297(e,n,t){t.r(n),t.d(n,{default:()=>L});var o=t(55614),s=t(30128),r=t(62456),i=t(23886),a=t(61425),l=t(69566),c=t(62088),d=t(51049),g=t(46625),u=t(44460);const h=(0,g.n)()({loading:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.15)",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(0, 0, 0, 0.05) 8px, rgba(0, 0, 0, 0.05) 16px)",pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},loadingMessage:{zIndex:2,pointerEvents:"none"}}),x=(0,l.observer)(function({model:e,children:n}){const{error:t,regionTooLarge:o}=e;return t?(0,u.jsx)(c.A,{error:t}):o?e.regionCannotBeRendered():(0,u.jsx)(b,{model:e,children:n})}),b=(0,l.observer)(function({model:e,children:n}){const{drawn:t,loading:o}=e;return(0,u.jsxs)("div",{"data-testid":`drawn-${t}`,children:[n,o?(0,u.jsx)(f,{model:e}):null]})}),f=(0,l.observer)(function({model:e}){const{classes:n}=h(),{statusMessage:t}=e;return(0,u.jsx)("div",{className:n.loading,children:(0,u.jsx)("div",{className:n.loadingMessage,children:(0,u.jsx)(d.A,{message:t})})})}),m=x;var v=t(84405),j=t(91121);const p=(0,g.n)()({legend:{position:"absolute",right:10,top:10,background:"rgba(255,255,255,0.9)",border:"1px solid #ccc",borderRadius:4,padding:8,fontSize:11,pointerEvents:"none",zIndex:100},gradientBar:{width:100,height:12,marginBottom:4,borderRadius:2},labels:{display:"flex",justifyContent:"space-between",fontSize:10}}),y={juicebox:"linear-gradient(to right, rgba(0,0,0,0), red)",fall:"linear-gradient(to right, rgb(255,255,255), rgb(255,255,204), rgb(255,237,160), rgb(254,217,118), rgb(254,178,76), rgb(253,141,60), rgb(252,78,42), rgb(227,26,28), rgb(189,0,38), rgb(128,0,38), rgb(0,0,0))",viridis:"linear-gradient(to right, #440154, #482878, #3e4a89, #31688e, #26828e, #1f9e89, #35b779, #6ece58, #b5de2b, #fde725)"},w=(0,l.observer)(function({maxScore:e,colorScheme:n="juicebox",useLogScale:t}){const{classes:o}=p(),s=y[n]||y.juicebox,{min:r,max:a}=function(e,n){if(n){const n=(0,v.A)().base(2).domain([1,e]).nice(),[t,o]=n.domain();return{min:t,max:o}}const t=(0,j.A)().domain([0,e]).nice(),[o,s]=t.domain();return{min:o,max:s}}(e,t);return(0,u.jsxs)("div",{className:o.legend,children:[(0,u.jsx)("div",{className:o.gradientBar,style:{background:s}}),(0,u.jsxs)("div",{className:o.labels,children:[(0,u.jsx)("span",{children:void 0!==r?(0,i.toLocale)(r):""}),(0,u.jsxs)("span",{children:[void 0!==a?(0,i.toLocale)(a):"",t?" (log)":""]})]})]})}),S=Math.sqrt(2);function k(e){const n=(0,o.c)(10),{item:t,x:s,y:a}=e,l=s+15;let c,d,g,h;return n[0]!==l||n[1]!==a?(c={x:l,y:a},n[0]=l,n[1]=a,n[2]=c):c=n[2],n[3]!==t.counts?(d=(0,i.reducePrecision)(t.counts),n[3]=t.counts,n[4]=d):d=n[4],n[5]!==d?(g=(0,u.jsxs)("div",{children:["Score: ",d]}),n[5]=d,n[6]=g):g=n[6],n[7]!==c||n[8]!==g?(h=(0,u.jsx)(r.A,{clientPoint:c,children:g}),n[7]=c,n[8]=g,n[9]=h):h=n[9],h}function C(e){const n=(0,o.c)(9),{x:t,y:s,yScalar:r,left:i,width:a,height:l}=e,c=s/r;let d;n[0]!==l||n[1]!==i||n[2]!==a?(d={position:"absolute",left:i,top:0,width:a,height:l,pointerEvents:"none"},n[0]=l,n[1]=i,n[2]=a,n[3]=d):d=n[3];const g=`M ${t-c} 0 L ${t} ${s} L ${t+c} 0`;let h,x;return n[4]!==g?(h=(0,u.jsx)("g",{stroke:"#000",strokeWidth:"1",fill:"none",children:(0,u.jsx)("path",{d:g})}),n[4]=g,n[5]=h):h=n[5],n[6]!==d||n[7]!==h?(x=(0,u.jsx)("svg",{style:d,children:h}),n[6]=d,n[7]=h,n[8]=x):x=n[8],x}const M=(0,l.observer)(function({model:e}){const n=(0,i.getContainingView)(e),t=Math.round(n.dynamicBlocks.totalWidthPx),{height:o,fullyDrawn:r,flatbush:l,flatbushItems:c,yScalar:d,showLegend:g,maxScore:h,colorScheme:x,useLogScale:b,lastDrawnOffsetPx:f}=e,m=(0,s.useRef)(null),[v,j]=(0,s.useState)(),[p,y]=(0,s.useState)(),[M,L]=(0,s.useState)(),P=n.offsetPx>=0?(f??0)-n.offsetPx:Math.max(0,-n.offsetPx),A=(0,s.useMemo)(()=>l?a.A.from(l):null,[l]),B=(0,s.useCallback)(n=>{e.setRef(n)},[e,t,o]),I=(0,s.useCallback)(e=>{if(!m.current||!A||!c.length)return j(void 0),void y(void 0);const n=m.current.getBoundingClientRect(),t=P,o=e.clientX-n.left-t,s=e.clientY-n.top;y({x:e.clientX,y:e.clientY}),L({x:o,y:s});const{x:r,y:i}=function(e,n,t){const o=n/t;return{x:(e-o)/S,y:(e+o)/S}}(o,s,d),a=A.search(r-1,i-1,r+1,i+1);if(a.length>0){const e=c[a[0]];j(e)}else j(void 0)},[A,c,d,P]),R=(0,s.useCallback)(()=>{j(void 0),y(void 0),L(void 0)},[]);return(0,u.jsxs)("div",{ref:m,style:{cursor:v&&p?"crosshair":void 0,position:"relative",width:t,height:o,overflow:"hidden"},onMouseMove:I,onMouseLeave:R,children:[(0,u.jsx)("canvas",{"data-testid":"hic_canvas"+(r?"_done":""),ref:B,style:{width:t,height:o,position:"absolute",left:P},width:2*t,height:2*o}),v&&M?(0,u.jsx)(C,{x:M.x,y:M.y,yScalar:d,left:P,width:t,height:o}):null,v&&p?(0,u.jsx)(k,{item:v,x:p.x,y:p.y}):null,g&&h>0?(0,u.jsx)(w,{maxScore:h,colorScheme:x,useLogScale:b}):null]})}),L=(0,l.observer)(function({model:e}){return(0,u.jsx)(m,{model:e,children:(0,u.jsx)(M,{model:e})})})}}]);
//# sourceMappingURL=2297.77386250.chunk.js.map