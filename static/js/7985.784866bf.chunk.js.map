{"version":3,"file":"static/js/7985.784866bf.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../packages/core/src/ui/ErrorMessageStackTraceContents.tsx","webpack://@jbrowse/web/../../packages/core/src/ui/ErrorMessageStackTraceDialog.tsx"],"sourcesContent":["import { Typography, alpha } from '@mui/material'\n\nimport ExternalLink from './ExternalLink.tsx'\nimport { makeStyles } from '../util/tss-react/index.ts'\n\n// produce a source-map resolved stack trace\n// reference code https://stackoverflow.com/a/77158517/2129219\nconst EMAIL = 'jbrowse2@berkeley.edu'\n\nconst useStyles = makeStyles()(theme => ({\n  pre: {\n    background: alpha(theme.palette.error.main, 0.2),\n    border: `1px solid ${theme.palette.divider}`,\n    overflow: 'auto',\n    margin: 20,\n    maxHeight: 300,\n  },\n}))\n\nexport default function ErrorMessageStackTraceContents({\n  text,\n  extra,\n}: {\n  text: string\n  extra?: unknown\n}) {\n  const { classes } = useStyles()\n  const extraStr = extra\n    ? `supporting data: ${JSON.stringify(extra, null, 2)}`\n    : ''\n  const displayText = [text, extraStr].filter(Boolean).join('\\n')\n  const issueBody = encodeURIComponent(\n    `I got this error from JBrowse, here is the stack trace:\\n\\n\\`\\`\\`\\n${text}\\n\\`\\`\\`\\n${extraStr}\\n`,\n  )\n  const githubLink = `https://github.com/GMOD/jbrowse-components/issues/new?labels=bug&title=JBrowse+issue&body=${issueBody}`\n  const emailLink = `mailto:${EMAIL}?subject=JBrowse%202%20error&body=${issueBody}`\n\n  return (\n    <>\n      <Typography>\n        Post a new issue at{' '}\n        <ExternalLink href={githubLink}>GitHub</ExternalLink> or send an email\n        to <ExternalLink href={emailLink}>{EMAIL}</ExternalLink>\n      </Typography>\n      <pre className={classes.pre}>{displayText}</pre>\n    </>\n  )\n}\n","import { useEffect, useState } from 'react'\n\nimport CloseIcon from '@mui/icons-material/Close'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n} from '@mui/material'\nimport { SourceMapConsumer } from 'source-map-js'\n\nimport ErrorMessageStackTraceContents from './ErrorMessageStackTraceContents.tsx'\nimport LoadingEllipses from './LoadingEllipses.tsx'\n\nasync function myfetchtext(uri: string) {\n  const res = await fetch(uri)\n  if (!res.ok) {\n    throw new Error(`HTTP ${res.status} fetching ${uri}: ${await res.text()}`)\n  }\n  return res.text()\n}\n\nasync function myfetchjson(uri: string) {\n  return JSON.parse(await myfetchtext(uri))\n}\n\n// produce a source-map resolved stack trace\n// reference code https://stackoverflow.com/a/77158517/2129219\nconst sourceMaps: Record<string, SourceMapConsumer> = {}\nconst sourceMappingUrlRe = /\\/\\/# sourceMappingURL=(.*)/\nconst stackLineRe = /(.*)((?:https?|file):\\/\\/.*):(\\d+):(\\d+)/\n\nasync function getSourceMapFromUri(uri: string) {\n  if (sourceMaps[uri]) {\n    return sourceMaps[uri]\n  }\n  const uriQuery = new URL(uri).search\n  const currentScriptContent = await myfetchtext(uri)\n  const mapUri = sourceMappingUrlRe.exec(currentScriptContent)?.[1] ?? ''\n  const data = await myfetchjson(new URL(mapUri, uri).href + uriQuery)\n  const map = new SourceMapConsumer(data)\n  sourceMaps[uri] = map\n  return map\n}\n\nasync function mapStackTrace(stack: string) {\n  const mappedStack = []\n  for (const line of stack.split('\\n')) {\n    const match = stackLineRe.exec(line)\n    if (!match) {\n      mappedStack.push(line)\n      continue\n    }\n\n    const uri = match[2]!\n    const consumer = await getSourceMapFromUri(uri)\n    const pos = consumer.originalPositionFor({\n      line: +match[3]!,\n      column: +match[4]!,\n    })\n\n    if (!pos.source || !pos.line || !pos.column) {\n      mappedStack.push(line)\n      continue\n    }\n\n    mappedStack.push(\n      `${pos.source}:${pos.line}:${pos.column + 1} (${match[1]!.trim()})`,\n    )\n  }\n  return mappedStack.join('\\n')\n}\n\nconst MAX_ERR_LEN = 10_000\n\n// Chrome has the error message in the stacktrace, firefox doesn't.\n// Remove it since it can be very long due to mobx-state-tree stuff\nfunction stripMessage(trace: string, error: unknown) {\n  return trace.startsWith('Error:') ? trace.slice(`${error}`.length) : trace\n}\n\nfunction getStackTrace(error: unknown) {\n  return typeof error === 'object' && error !== null && 'stack' in error\n    ? `${error.stack}`\n    : ''\n}\n\nexport default function ErrorMessageStackTraceDialog({\n  error,\n  onClose,\n  extra,\n}: {\n  onClose: () => void\n  error: unknown\n  extra?: unknown\n}) {\n  const [mappedStackTrace, setMappedStackTrace] = useState<string>()\n  const [secondaryError, setSecondaryError] = useState<unknown>()\n  const [clicked, setClicked] = useState(false)\n  const errorText = error ? `${error}` : ''\n  const stackTrace = stripMessage(getStackTrace(error), errorText)\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        setMappedStackTrace(await mapStackTrace(stackTrace))\n      } catch (e) {\n        console.error(e)\n        setMappedStackTrace(stackTrace)\n        setSecondaryError(e)\n      }\n    })()\n  }, [stackTrace])\n\n  // @ts-expect-error\n  const version = window.JBrowseSession?.version\n  const errorBoxText = [\n    secondaryError\n      ? 'Error loading source map, showing raw stack trace below:'\n      : '',\n    errorText.length > MAX_ERR_LEN\n      ? `${errorText.slice(0, MAX_ERR_LEN)}...`\n      : errorText,\n    mappedStackTrace || 'No stack trace available',\n    version ? `JBrowse ${version}` : '',\n  ]\n    .filter(Boolean)\n    .join('\\n')\n\n  return (\n    <Dialog open onClose={onClose} maxWidth=\"xl\">\n      <DialogTitle>\n        Stack trace\n        <IconButton\n          onClick={onClose}\n          sx={{\n            position: 'absolute',\n            right: 8,\n            top: 8,\n          }}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {mappedStackTrace === undefined ? (\n          <LoadingEllipses variant=\"h6\" />\n        ) : (\n          <ErrorMessageStackTraceContents text={errorBoxText} extra={extra} />\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={async () => {\n            const { default: copy } = await import('copy-to-clipboard')\n            copy(errorBoxText)\n            setClicked(true)\n            setTimeout(() => {\n              setClicked(false)\n            }, 1000)\n          }}\n        >\n          {clicked ? 'Copied!' : 'Copy stack trace to clipboard'}\n        </Button>\n        <Button variant=\"contained\" color=\"primary\" onClick={onClose}>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n"],"names":["EMAIL","useStyles","makeStyles","theme","pre","background","alpha","palette","error","main","border","divider","overflow","margin","maxHeight","ErrorMessageStackTraceContents","t0","$","_c","text","extra","classes","t1","JSON","stringify","extraStr","t2","filter","Boolean","displayText","join","issueBody","encodeURIComponent","githubLink","emailLink","t3","t4","t5","t6","t7","_jsx","ExternalLink","children","_jsxs","Typography","className","_Fragment","async","myfetchtext","uri","res","fetch","ok","Error","status","sourceMaps","sourceMappingUrlRe","stackLineRe","getSourceMapFromUri","uriQuery","URL","search","currentScriptContent","mapUri","exec","data","parse","myfetchjson","href","map","SourceMapConsumer","ErrorMessageStackTraceDialog","onClose","mappedStackTrace","setMappedStackTrace","useState","secondaryError","setSecondaryError","clicked","setClicked","errorText","stackTrace","trace","startsWith","slice","length","stripMessage","stack","getStackTrace","useEffect","mappedStack","line","split","match","push","pos","originalPositionFor","column","source","trim","mapStackTrace","e","console","version","window","JBrowseSession","errorBoxText","Dialog","open","maxWidth","DialogTitle","IconButton","onClick","sx","position","right","top","CloseIcon","DialogContent","undefined","LoadingEllipses","variant","DialogActions","Button","color","default","copy","setTimeout"],"sourceRoot":""}