{"version":3,"file":"static/js/3301.33f7fe16.chunk.js","mappings":"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","sources":["../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/components/util.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/components/LaunchSyntenyViewDialog.tsx"],"sourcesContent":["import { getSession, Feature } from '@jbrowse/core/util'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// locals\nimport { LinearSyntenyViewModel } from '../../LinearSyntenyView/model'\n\ntype LSV = LinearSyntenyViewModel\n\nconst { parseCigar } = MismatchParser\n\nfunction f(n: number) {\n  return Math.floor(n)\n}\nfunction findPosInCigar(cigar: string[], startX: number) {\n  let featX = 0\n  let mateX = 0\n  for (let i = 0; i < cigar.length; i++) {\n    const len = +cigar[i]!\n    const op = cigar[i + 1]!\n    const min = Math.min(len, startX - featX)\n\n    if (featX >= startX) {\n      break\n    }\n    if (op === 'I') {\n      mateX += len\n    } else if (op === 'D') {\n      featX += min\n    } else if (op === 'M' || op === '=' || op === 'X') {\n      mateX += min\n      featX += min\n    }\n  }\n  return [featX, mateX] as const\n}\n\nexport async function navToSynteny({\n  feature,\n  windowSize: ws,\n  model,\n  trackId,\n  view,\n  horizontallyFlip,\n}: {\n  windowSize: number\n  trackId: string\n  horizontallyFlip: boolean\n  feature: Feature\n  view?: LinearGenomeViewModel\n  model: IAnyStateTreeNode\n}) {\n  const session = getSession(model)\n  const reg = view?.dynamicBlocks.contentBlocks[0]\n  const cigar = feature.get('CIGAR')\n  const strand = feature.get('strand')\n\n  const featRef = feature.get('refName')\n  const featAsm = feature.get('assemblyName')\n  const featStart = feature.get('start')\n  const featEnd = feature.get('end')\n  const mate = feature.get('mate')\n  const mateStart = mate.start\n  const mateEnd = mate.end\n  const mateAsm = mate.assemblyName\n  const mateRef = mate.refName\n\n  let rMateStart: number\n  let rMateEnd: number\n  let rFeatStart: number\n  let rFeatEnd: number\n\n  if (reg && cigar) {\n    const regStart = reg.start\n    const regEnd = reg.end\n    const p = parseCigar(cigar)\n    const [fStartX, mStartX] = findPosInCigar(p, regStart - featStart)\n    const [fEndX, mEndX] = findPosInCigar(p, regEnd - featStart)\n\n    // avoid multiply by 0 with strand undefined\n    const flipper = strand === -1 ? -1 : 1\n    rFeatStart = featStart + fStartX\n    rFeatEnd = featStart + fEndX\n    rMateStart = (strand === -1 ? mateEnd : mateStart) + mStartX * flipper\n    rMateEnd = (strand === -1 ? mateEnd : mateStart) + mEndX * flipper\n  } else {\n    rFeatStart = featStart\n    rFeatEnd = featEnd\n    rMateStart = mateStart\n    rMateEnd = mateEnd\n  }\n\n  const view2 = session.addView('LinearSyntenyView', {\n    type: 'LinearSyntenyView',\n    views: [\n      {\n        type: 'LinearGenomeView',\n        hideHeader: true,\n      },\n      {\n        type: 'LinearGenomeView',\n        hideHeader: true,\n      },\n    ],\n    tracks: [\n      {\n        configuration: trackId,\n        type: 'SyntenyTrack',\n        displays: [\n          {\n            type: 'LinearSyntenyDisplay',\n            configuration: `${trackId}-LinearSyntenyDisplay`,\n          },\n        ],\n      },\n    ],\n  }) as LSV\n  const l1 = `${featRef}:${f(rFeatStart - ws)}-${f(rFeatEnd + ws)}`\n  const m1 = Math.min(rMateStart, rMateEnd)\n  const m2 = Math.max(rMateStart, rMateEnd)\n  const l2 = `${mateRef}:${f(m1 - ws)}-${f(m2 + ws)}${\n    horizontallyFlip ? '[rev]' : ''\n  }`\n  await Promise.all([\n    view2.views[0]!.navToLocString(l1, featAsm),\n    view2.views[1]!.navToLocString(l2, mateAsm),\n  ])\n}\n","import React, { useState } from 'react'\nimport { Dialog } from '@jbrowse/core/ui'\nimport { Feature, getSession } from '@jbrowse/core/util'\nimport {\n  Button,\n  Checkbox,\n  DialogActions,\n  DialogContent,\n  FormControlLabel,\n  TextField,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n// locals\nimport { navToSynteny } from './util'\n\nconst useStyles = makeStyles()({\n  padding: {\n    margin: 10,\n    border: '1px solid #ccc',\n  },\n})\n\nexport default function LaunchSyntenyViewDialog({\n  model,\n  feature,\n  trackId,\n  handleClose,\n}: {\n  model: unknown\n  feature: Feature\n  trackId: string\n  handleClose: () => void\n}) {\n  const { classes } = useStyles()\n  const inverted = feature.get('strand') === -1\n  const [horizontallyFlip, setHorizontallyFlip] = useState(inverted)\n  const [windowSize, setWindowSize] = useState('1000')\n  return (\n    <Dialog open title=\"Launch synteny view\" onClose={handleClose}>\n      <DialogContent>\n        {inverted ? (\n          <FormControlLabel\n            className={classes.padding}\n            control={\n              <Checkbox\n                checked={horizontallyFlip}\n                onChange={event => {\n                  setHorizontallyFlip(event.target.checked)\n                }}\n              />\n            }\n            label=\"Note: The feature is inverted in orientation on the target\n            sequence. This will result in the lower panel having genomic\n            coordinates decreasing left to right. Horizontally flip?\"\n          />\n        ) : null}\n        <TextField\n          label=\"Add window size in bp\"\n          value={windowSize}\n          onChange={event => {\n            setWindowSize(event.target.value)\n          }}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          onClick={() => {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            ;(async () => {\n              try {\n                await navToSynteny({\n                  feature,\n                  windowSize: +windowSize,\n                  horizontallyFlip,\n                  trackId,\n                  model,\n                })\n              } catch (e) {\n                console.error(e)\n                getSession(model).notifyError(`${e}`, e)\n              }\n            })()\n            handleClose()\n          }}\n        >\n          Submit\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={() => {\n            handleClose()\n          }}\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n"],"names":["parseCigar","MismatchParser","f","n","Math","floor","findPosInCigar","cigar","startX","featX","mateX","i","length","len","op","min","useStyles","makeStyles","padding","margin","border","LaunchSyntenyViewDialog","model","feature","trackId","handleClose","classes","inverted","get","horizontallyFlip","setHorizontallyFlip","useState","windowSize","setWindowSize","React","Dialog","open","title","onClose","DialogContent","FormControlLabel","className","control","Checkbox","checked","onChange","event","target","label","TextField","value","DialogActions","Button","variant","onClick","async","ws","view","session","getSession","reg","dynamicBlocks","contentBlocks","strand","featRef","featAsm","featStart","featEnd","mate","mateStart","start","mateEnd","end","mateAsm","assemblyName","mateRef","refName","rMateStart","rMateEnd","rFeatStart","rFeatEnd","regStart","regEnd","p","fStartX","mStartX","fEndX","mEndX","flipper","view2","addView","type","views","hideHeader","tracks","configuration","displays","l1","m1","m2","max","l2","Promise","all","navToLocString","navToSynteny","e","console","error","notifyError","color"],"sourceRoot":""}