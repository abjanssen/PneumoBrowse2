"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3348],{33348(e,t,r){r.r(t),r.d(t,{default:()=>f});var s=r(30936),o=r(77251),n=r(64074),a=r(38715),l=r(32118);function i(e){const t=(0,s.c)(8),{bpPerPx:r,region:n,feature:i,sequenceType:d,height:h,seq:c,y:f}=e,g=(0,a.A)(),p=1/r>=12;let u,x,b;t[0]!==r||t[1]!==i||t[2]!==n?(x=i.get("start"),u=i.get("end"),b=(0,o.bpSpanPx)(x,u,n,r),t[0]=r,t[1]=i,t[2]=n,t[3]=u,t[4]=x,t[5]=b):(u=t[3],x=t[4],b=t[5]);const[w,m]=b,v=n.reversed,y=u-x,$=Math.max((m-w)/y,.8);let S,P="";for(let e=0,t=c.length;e<t;e++){const t=c[e],r="dna"===d?g.palette.bases[t.toUpperCase()]:void 0,s=v?m-(e+1)*$:w+e*$;P+=`<rect x="${s}" y="${f}" width="${$}" height="${h}" fill="${r?r.main:"#aaa"}" stroke="${p?"#555":"none"}"/>`,p&&(P+=`<text x="${s+$/2}" y="${f+h/2}" dominant-baseline="middle" text-anchor="middle" font-size="${h-2}" fill="${r?g.palette.getContrastText(r.main):"black"}">${t}</text>`)}return t[6]!==P?(S=(0,l.jsx)("g",{dangerouslySetInnerHTML:{__html:P}}),t[6]=P,t[7]=S):S=t[7],S}function d(e){const t=(0,s.c)(22),{codonTable:r,seq:n,frame:i,width:d,bpPerPx:h,colorByCDS:c,region:f,seqStart:g,height:p,y:u,reverse:x}=e,b=void 0!==x&&x,w=(0,a.A)(),m=(Math.abs(i)-1-g%3+3)%3,v=n.length-m,y=v-v%3;let $,S;if(t[0]!==h||t[1]!==r||t[2]!==c||t[3]!==i||t[4]!==m||t[5]!==p||t[6]!==y||t[7]!==f||t[8]!==b||t[9]!==n||t[10]!==g||t[11]!==w||t[12]!==d||t[13]!==u){const e=n.slice(m,m+y),s=[];for(let t=0;t<e.length;t+=3,t){const n=e.slice(t,t+3),a=b?(0,o.revcom)(n):n,l=r[a]||"";s.push({letter:l,codon:a.toUpperCase()})}const a=1/h*3,l=1/h>=12,x=m/h-(f.start-g)/h;let v;t[15]!==c||t[16]!==i||t[17]!==w.palette.frames||t[18]!==w.palette.framesCDS?(v=c?w.palette.framesCDS.at(i)?.main:w.palette.frames.at(i)?.main,t[15]=c,t[16]=i,t[17]=w.palette.frames,t[18]=w.palette.framesCDS,t[19]=v):v=t[19],$=`<rect x="0" y="${u}" width="${d}" height="${p}" fill="${v}"/>`;for(let e=0,t=s.length;e<t;e++){const t=s[e],r=f.reversed?d-(e+1)*a-x:a*e+x,{letter:n,codon:i}=t,h=o.defaultStarts.includes(i)?w.palette.startCodon:o.defaultStops.includes(i)?w.palette.stopCodon:void 0;(l||h)&&($+=`<rect x="${r}" y="${u}" width="${l?a:a+.7}" height="${p}" stroke="${l?"#555":"none"}" fill="${h||"none"}"/>`,l&&($+=`<text x="${r+a/2}" font-size="${p-2}" y="${u+p/2}" dominant-baseline="middle" text-anchor="middle">${n}</text>`))}t[0]=h,t[1]=r,t[2]=c,t[3]=i,t[4]=m,t[5]=p,t[6]=y,t[7]=f,t[8]=b,t[9]=n,t[10]=g,t[11]=w,t[12]=d,t[13]=u,t[14]=$}else $=t[14];return t[20]!==$?(S=(0,l.jsx)("g",{dangerouslySetInnerHTML:{__html:$}}),t[20]=$,t[21]=S):S=t[21],S}function h(e){const t=(0,s.c)(35),{regions:r,width:n,colorByCDS:a,features:h,showReverse:c,showForward:f,showTranslation:g,sequenceType:p,bpPerPx:u,rowHeight:x}=e,b=void 0===c||c,w=void 0===f||f,m=void 0===g||g,v=void 0===p?"dna":p,y=r[0];let $;t[0]===Symbol.for("react.memo_cache_sentinel")?($=(0,o.generateCodonTable)(o.defaultCodonTable),t[0]=$):$=t[0];const S=$;let P,q;if(t[1]!==u||t[2]!==a||t[3]!==h||t[4]!==y||t[5]!==x||t[6]!==v||t[7]!==w||t[8]!==b||t[9]!==m||t[10]!==n){q=Symbol.for("react.early_return_sentinel");e:{const[e]=[...h.values()];if(!e){q=null;break e}const r=e.get("seq");if(!r){q=null;break e}const s=u<=1,c=m&&w?[3,2,1]:[],f=m&&b?[-1,-2,-3]:[],[g,p]=y.reversed?[f.toReversed(),c.toReversed()]:[c,f],$=[];let C=0;for(const t of g)$.push((0,l.jsx)(d,{width:n,colorByCDS:a,seq:r,y:C,codonTable:S,frame:t,bpPerPx:u,region:y,seqStart:e.get("start"),height:x,reverse:y.reversed},`translation-${t}`)),C+=x;if(w&&s){let s,n;t[13]!==y.reversed||t[14]!==r?(s=y.reversed?(0,o.complement)(r):r,t[13]=y.reversed,t[14]=r,t[15]=s):s=t[15],t[16]!==u||t[17]!==C||t[18]!==e||t[19]!==y||t[20]!==x||t[21]!==v||t[22]!==s?(n=(0,l.jsx)(i,{height:x,sequenceType:v,y:C,feature:e,region:y,seq:s,bpPerPx:u},"forward_seq"),t[16]=u,t[17]=C,t[18]=e,t[19]=y,t[20]=x,t[21]=v,t[22]=s,t[23]=n):n=t[23],$.push(n),C+=x}if(b&&s){let s,n;t[24]!==y.reversed||t[25]!==r?(s=y.reversed?r:(0,o.complement)(r),t[24]=y.reversed,t[25]=r,t[26]=s):s=t[26],t[27]!==u||t[28]!==C||t[29]!==e||t[30]!==y||t[31]!==x||t[32]!==v||t[33]!==s?(n=(0,l.jsx)(i,{height:x,sequenceType:v,y:C,feature:e,region:y,seq:s,bpPerPx:u},"reverse_seq"),t[27]=u,t[28]=C,t[29]=e,t[30]=y,t[31]=x,t[32]=v,t[33]=s,t[34]=n):n=t[34],$.push(n),C+=x}for(const t of p)$.push((0,l.jsx)(d,{width:n,colorByCDS:a,seq:r,y:C,codonTable:S,frame:t,bpPerPx:u,region:y,seqStart:e.get("start"),height:x,reverse:!y.reversed},`rev-translation-${t}`)),C+=x;P=(0,l.jsx)(l.Fragment,{children:$})}t[1]=u,t[2]=a,t[3]=h,t[4]=y,t[5]=x,t[6]=v,t[7]=w,t[8]=b,t[9]=m,t[10]=n,t[11]=P,t[12]=q}else P=t[11],q=t[12];return q!==Symbol.for("react.early_return_sentinel")?q:P}function c(e){const t=(0,s.c)(5),{exportSVG:r,width:o,totalHeight:n,children:a}=e;let i;return t[0]!==a||t[1]!==r||t[2]!==n||t[3]!==o?(i=r?a:(0,l.jsx)("svg",{"data-testid":"sequence_track",width:o,height:n,style:{display:"block",width:o,height:n,userSelect:"none"},children:a}),t[0]=a,t[1]=r,t[2]=n,t[3]=o,t[4]=i):i=t[4],i}const f=(0,n.observer)(function({exportSVG:e,features:t,regions:r,colorByCDS:s,bpPerPx:o,rowHeight:n,sequenceHeight:a,showForward:i,showReverse:d,showTranslation:f}){const g=r[0],p=Math.ceil((g.end-g.start)/o);return(0,l.jsx)(c,{exportSVG:e,totalHeight:a,width:p,children:(0,l.jsx)(h,{width:p,showReverse:d,showForward:i,showTranslation:f,colorByCDS:s,bpPerPx:o,rowHeight:n,features:t,regions:r})})})}}]);
//# sourceMappingURL=3348.b54502d1.chunk.js.map