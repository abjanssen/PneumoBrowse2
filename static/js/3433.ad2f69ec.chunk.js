"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3433],{53433(e,t,o){o.r(t),o.d(t,{default:()=>R});var n=o(55614),s=o(30128),r=o(28910),a=o(34823),i=o(78921),l=o(69590),c=o(69566),d=o(62088),u=o(23886),p=o(15146),h=o(29458),m=o(19608),v=o(10533),x=o(63209),g=o(35703),A=o(54825),f=o(23149),j=o(44641),b=o(44460);const y=(0,c.observer)(function({model:e,children:t,handleClose:o}){const[n,r]=(0,s.useState)(""),[a,i]=(0,s.useState)(),[l,c]=(0,s.useState)(!1),[y,C]=(0,s.useState)(),[S,w]=(0,s.useState)(!1),[k,R]=(0,u.useLocalStorage)("cluster-samplesPerPixel","1");return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(x.A,{children:[t,(0,b.jsxs)("div",{style:{marginTop:50},children:[(0,b.jsx)(g.A,{variant:"contained",onClick:()=>{w(!S)},children:S?"Hide advanced options":"Show advanced options"}),S?(0,b.jsxs)("div",{style:{marginTop:20},children:[(0,b.jsx)(A.A,{children:"This procedure samples the data at each 'pixel' across the visible by default"}),(0,b.jsx)(f.A,{label:"Samples per pixel (>1 for denser sampling, between 0-1 for sparser sampling)",variant:"outlined",size:"small",value:k,onChange:e=>{R(e.target.value)}})]}):null]}),(0,b.jsxs)("div",{children:[l?(0,b.jsxs)("div",{style:{padding:50},children:[(0,b.jsx)("span",{children:n||"Loading..."}),(0,b.jsx)(g.A,{onClick:()=>{(0,h.CF)(y)},children:"Stop"})]}):null,a?(0,b.jsx)(d.A,{error:a}):null]})]}),(0,b.jsxs)(j.A,{children:[(0,b.jsx)(g.A,{variant:"contained",disabled:l,onClick:async()=>{try{i(void 0),r("Initializing"),c(!0);const t=(0,u.getContainingView)(e);if(!t.initialized)return;const{rpcManager:n}=(0,u.getSession)(e),{sourcesWithoutLayout:s,adapterConfig:a}=e;if(s){const o=(0,m.getRpcSessionId)(e),i=(0,h.y5)();C(i);const l=await n.call(o,"MultiWiggleClusterScoreMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:s,sessionId:o,adapterConfig:a,stopToken:i,bpPerPx:t.bpPerPx/+k,statusCallback:e=>{r(e)}}),c=e.layout?.length?e.layout:s,d=Object.fromEntries(c.map(e=>[e.name,e]));e.setLayout(l.order.map(e=>{const t=s[e];if(!t)throw new Error(`out of bounds at ${e}`);return{...t,...d[t.name]}}),!1),e.setClusterTree(l.tree)}o()}catch(t){!(0,p.Kp)(t)&&(0,v.isAlive)(e)&&(console.error(t),i(t))}finally{c(!1),r(""),C("")}},children:"Run clustering"}),(0,b.jsx)(g.A,{variant:"contained",color:"secondary",onClick:()=>{o(),y&&(0,h.CF)(y)},children:"Cancel"})]})]})});var C=o(51049);const S=(0,o(46625).n)()({textAreaFont:{fontFamily:"Courier New"}}),w=(0,c.observer)(function({model:e,handleClose:t,children:n}){const{classes:r}=S(),[c,h]=(0,s.useState)(""),[y,w]=(0,s.useState)(),[k,R]=(0,s.useState)(),[M,P]=(0,s.useState)(!1),[z,B]=(0,u.useLocalStorage)("cluster-showAdvanced",!1),[$,T]=(0,s.useState)("single"),[O,I]=(0,s.useState)("1");(0,s.useEffect)(()=>{(async()=>{try{R(void 0),w(void 0),P(!0);const t=(0,u.getContainingView)(e),{dynamicBlocks:o,bpPerPx:n}=t,{rpcManager:s}=(0,u.getSession)(e),{sourcesWithoutLayout:r,adapterConfig:a}=e,i=(0,m.getRpcSessionId)(e),l=await s.call(i,"MultiWiggleGetScoreMatrix",{regions:o.contentBlocks,sources:r,sessionId:i,adapterConfig:a,bpPerPx:n/+O});w(l)}catch(t){!(0,p.Kp)(t)&&(0,v.isAlive)(e)&&(console.error(t),R(t))}finally{P(!1)}})()},[e,O]);const F=y?String.raw`inputMatrix<-matrix(c(${Object.values(y).map(e=>e.join(",")).join(",\n")}
),nrow=${Object.values(y).length},byrow=TRUE)
rownames(inputMatrix)<-c(${Object.keys(y).map(e=>`'${e}'`).join(",")})
resultClusters<-hclust(dist(inputMatrix), method='${$}')
cat(resultClusters$order,sep='\n')`:void 0,E=y?Object.entries(y).map(([e,t])=>[e,...t].join("\t")).join("\n"):void 0;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(x.A,{children:[n,(0,b.jsxs)("div",{style:{marginTop:50},children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"16px"},children:[(0,b.jsx)(g.A,{variant:"contained",onClick:async()=>{const{saveAs:e}=await o.e(1611).then(o.bind(o,91611));e(new Blob([F||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,b.jsx)(g.A,{variant:"contained",onClick:async()=>{const{default:e}=await o.e(2899).then(o.t.bind(o,72899,23));e(F||"")},children:"Copy Rscript to clipboard"})," ","or"," ",(0,b.jsx)(g.A,{variant:"contained",onClick:async()=>{const{saveAs:e}=await o.e(1611).then(o.bind(o,91611));e(new Blob([E||""],{type:"text/plain;charset=utf-8"}),"scores.tsv")},children:"Download TSV"})]}),(0,b.jsx)("div",{children:(0,b.jsx)(g.A,{variant:"contained",onClick:()=>{B(!z)},children:z?"Hide advanced options":"Show advanced options"})}),z?(0,b.jsxs)("div",{children:[(0,b.jsx)(A.A,{variant:"h6",children:"Advanced options"}),(0,b.jsx)(a.A,{children:Object.entries({single:"Single",complete:"Complete"}).map(([e,t])=>(0,b.jsx)(i.A,{control:(0,b.jsx)(l.A,{checked:$===e,onChange:()=>{T(e)}}),label:t},e))}),(0,b.jsxs)("div",{style:{marginTop:20},children:[(0,b.jsx)(A.A,{children:"This procedure samples the data at each 'pixel' across the visible by default"}),(0,b.jsx)(f.A,{label:"Samples per pixel (>1 for denser sampling, between 0-1 for sparser sampling)",variant:"outlined",size:"small",value:O,onChange:e=>{I(e.target.value)}})]})]}):null,F?(0,b.jsx)("div",{}):M?(0,b.jsx)(C.A,{variant:"h6",message:"Generating score matrix"}):k?(0,b.jsx)(d.A,{error:k}):null]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(A.A,{variant:"subtitle2",gutterBottom:!0,style:{marginTop:"16px"},children:"Clustering Results:"}),(0,b.jsx)(f.A,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:c,onChange:e=>{h(e.target.value)},slotProps:{input:{classes:{input:r.textAreaFont}}}})]})]})]}),(0,b.jsxs)(j.A,{children:[(0,b.jsx)(g.A,{variant:"contained",onClick:()=>{const{sourcesWithoutLayout:o}=e;if(o)try{const t=e.layout?.length?e.layout:o,n=Object.fromEntries(t.map(e=>[e.name,e]));e.setLayout(c.split("\n").map(e=>e.trim()).filter(e=>!!e).map(e=>+e).map(e=>{const t=o[e-1];if(!t)throw new Error(`out of bounds at ${e}`);return{...t,...n[t.name]}}))}catch(t){console.error(t),(0,u.getSession)(e).notifyError(`${t}`,t)}t()},children:"Apply clustering"}),(0,b.jsx)(g.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})});function k(e){const t=(0,n.c)(4),{activeMode:o,setActiveMode:s}=e;let r,c;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r=Object.entries({auto:(0,b.jsx)("div",{children:"Run in-app clustering (slower, particularly for large numbers of samples, uses JS implementation of hclust)"}),manual:(0,b.jsx)("div",{children:"Download R script to run clustering (faster, uses R implementation of hclust)"})}),t[0]=r):r=t[0],t[1]!==o||t[2]!==s?(c=(0,b.jsx)("div",{children:(0,b.jsx)(a.A,{children:r.map(e=>{const[t,n]=e;return(0,b.jsx)(i.A,{control:(0,b.jsx)(l.A,{checked:o===t,onChange:()=>{s(t)}}),label:n},t)})})}),t[1]=o,t[2]=s,t[3]=c):c=t[3],c}const R=(0,c.observer)(function({model:e,handleClose:t}){const[o,n]=(0,s.useState)("auto");return(0,b.jsx)(r.A,{open:!0,title:"Cluster by score",maxWidth:"xl",onClose:(e,o)=>{"backdropClick"!==o&&t()},children:"auto"===o?(0,b.jsx)(y,{model:e,handleClose:t,children:(0,b.jsx)(k,{activeMode:o,setActiveMode:n})}):(0,b.jsx)(w,{model:e,handleClose:t,children:(0,b.jsx)(k,{activeMode:o,setActiveMode:n})})})})},69590(e,t,o){o.d(t,{A:()=>P});var n=o(30128),s=o(21227),r=o(74533),a=o(94126),i=o(91383),l=o(44460);const c=(0,i.A)((0,l.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),d=(0,i.A)((0,l.jsx)("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked");var u=o(73888),p=o(80638),h=o(39104);const m=(0,p.Ay)("span",{name:"MuiRadioButtonIcon",shouldForwardProp:u.A})({position:"relative",display:"flex"}),v=(0,p.Ay)(c,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),x=(0,p.Ay)(d,{name:"MuiRadioButtonIcon"})((0,h.A)(({theme:e})=>({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}}]}))),g=function(e){const{checked:t=!1,classes:o={},fontSize:n}=e,s={...e,checked:t};return(0,l.jsxs)(m,{className:o.root,ownerState:s,children:[(0,l.jsx)(v,{fontSize:n,className:o.background,ownerState:s}),(0,l.jsx)(x,{fontSize:n,className:o.dot,ownerState:s})]})};var A=o(37540),f=o(64600),j=o(83918),b=o(96300),y=o(63417),C=o(71646),S=o(30787),w=o(45639);const k=(0,p.Ay)(a.A,{shouldForwardProp:e=>(0,u.A)(e)||"classes"===e,name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,"medium"!==o.size&&t[`size${(0,A.A)(o.size)}`],t[`color${(0,A.A)(o.color)}`]]}})((0,h.A)(({theme:e})=>({color:(e.vars||e).palette.text.secondary,[`&.${y.A.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter((0,C.A)()).map(([t])=>({props:{color:t,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter((0,C.A)()).map(([t])=>({props:{color:t,disabled:!1},style:{[`&.${y.A.checked}`]:{color:(e.vars||e).palette[t].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),R=(0,l.jsx)(g,{checked:!0}),M=(0,l.jsx)(g,{}),P=n.forwardRef(function(e,t){const o=(0,w.b)({props:e,name:"MuiRadio"}),{checked:a,checkedIcon:i=R,color:c="primary",icon:d=M,name:u,onChange:p,size:h="medium",className:m,disabled:v,disableRipple:x=!1,slots:g={},slotProps:C={},inputProps:P,...z}=o,B=(0,j.A)();let $=v;B&&void 0===$&&($=B.disabled),$??=!1;const T={...o,disabled:$,disableRipple:x,color:c,size:h},O=(e=>{const{classes:t,color:o,size:n}=e,s={root:["root",`color${(0,A.A)(o)}`,"medium"!==n&&`size${(0,A.A)(n)}`]};return{...t,...(0,r.A)(s,y.q,t)}})(T),I=(0,b.A)();let F=a;const E=(0,f.A)(p,I&&I.onChange);let L=u;var N,W;I&&(void 0===F&&(N=I.value,F="object"==typeof(W=o.value)&&null!==W?N===W:String(N)===String(W)),void 0===L&&(L=I.name));const _=C.input??P,[q,G]=(0,S.A)("root",{ref:t,elementType:k,className:(0,s.A)(O.root,m),shouldForwardComponentProp:!0,externalForwardedProps:{slots:g,slotProps:C,...z},getSlotProps:e=>({...e,onChange:(t,...o)=>{e.onChange?.(t,...o),E(t,...o)}}),ownerState:T,additionalProps:{type:"radio",icon:n.cloneElement(d,{fontSize:d.props.fontSize??h}),checkedIcon:n.cloneElement(i,{fontSize:i.props.fontSize??h}),disabled:$,name:L,checked:F,slots:g,slotProps:{input:"function"==typeof _?_(T):_}}});return(0,l.jsx)(q,{...G,classes:O})})},63417(e,t,o){o.d(t,{A:()=>a,q:()=>r});var n=o(26743),s=o(2395);function r(e){return(0,s.Ay)("MuiRadio",e)}const a=(0,n.A)("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"])},34823(e,t,o){o.d(t,{A:()=>h});var n=o(30128),s=o(21227),r=o(74533),a=o(88793),i=o(18131),l=o(44330),c=o(80533),d=o(97152),u=o(82462),p=o(44460);const h=n.forwardRef(function(e,t){const{actions:o,children:h,className:m,defaultValue:v,name:x,onChange:g,value:A,...f}=e,j=n.useRef(null),b=(e=>{const{classes:t,row:o,error:n}=e,s={root:["root",o&&"row",n&&"error"]};return(0,r.A)(s,i.B,t)})(e),[y,C]=(0,c.A)({controlled:A,default:v,name:"RadioGroup"});n.useImperativeHandle(o,()=>({focus:()=>{let e=j.current.querySelector("input:not(:disabled):checked");e||(e=j.current.querySelector("input:not(:disabled)")),e&&e.focus()}}),[]);const S=(0,l.A)(t,j),w=(0,u.A)(x),k=n.useMemo(()=>({name:w,onChange(e){C(e.target.value),g&&g(e,e.target.value)},value:y}),[w,g,C,y]);return(0,p.jsx)(d.A.Provider,{value:k,children:(0,p.jsx)(a.A,{role:"radiogroup",ref:S,className:(0,s.A)(b.root,m),...f,children:h})})})},97152(e,t,o){o.d(t,{A:()=>n});const n=o(30128).createContext(void 0)},18131(e,t,o){o.d(t,{A:()=>a,B:()=>r});var n=o(26743),s=o(2395);function r(e){return(0,s.Ay)("MuiRadioGroup",e)}const a=(0,n.A)("MuiRadioGroup",["root","row","error"])},96300(e,t,o){o.d(t,{A:()=>r});var n=o(30128),s=o(97152);function r(){return n.useContext(s.A)}}}]);
//# sourceMappingURL=3433.ad2f69ec.chunk.js.map