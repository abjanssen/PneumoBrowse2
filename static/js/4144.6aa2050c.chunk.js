"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4144],{13677(e,t,o){o.d(t,{E:()=>l});var n=o(14157),s=o(19598),a=o(80921);function l(e,t,o,l,r,i,f,c,h=!0,p=1){const u=+e[f],g=u?void 0!==c?`hsl(${+c%255}, 50%, 50%)`||a.lh:n.set1[u-1]||a.lh:h?a.Us:void 0;return g&&(t.fillStyle=1!==p?(0,s.M)(g).alpha(p).toHex():g,t.fillRect(o-a.f2,l-a.f2,r+a.f2,i+a.f2)),g}},61494(e,t,o){o.d(t,{Bs:()=>a,KP:()=>l});var n=o(19598),s=o(80921);function a(e,t,o,a,l){const r=`${e}:${t}`;let i=o[r];if(void 0===i){let f=0,c=0,h=0,p=0;const u=a[e]??(a[e]=e.split(/[/|]/)),g=u.length;for(let e=0;e<g;e++){const o=u[e];o===t?f++:"0"===o?p++:"."===o?c++:h++}i=function(e,t,o,a,l,r=!0){if(e===l)return r?s.Us:"";if(!(t||o||a))return"";let i;if(t){const e=80-t/l*50;i=(0,n.M)(`hsl(${s.Lp},${s.V4}%,${e}%)`)}if(o){const e=`hsla(0,100%,20%,${o/l})`;i=i?i.mix(e):(0,n.M)(e)}if(a){const e=a/l,t=s.FX.replace(")",`,${e})`).replace("hsl","hsla");i=i?i.mix(t):(0,n.M)(t)}return i?.toHex()||"black"}(p,f,h,c,g,l),o[r]=i}return i}function l(e,t,o,a,l,r,i="",f,c=1){t.fillStyle=1!==c?(0,n.M)(e).alpha(c).toHex():e,"inversion"===i?1===f?(t.beginPath(),t.moveTo(o-s.f2,a-s.f2),t.lineTo(o-s.f2,a+r+s.f2),t.lineTo(o+l+s.f2,a+r/2),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(o+l+s.f2,a-s.f2),t.lineTo(o+l+s.f2,a+r+s.f2),t.lineTo(o-s.f2,a+r/2),t.closePath(),t.fill()):t.fillRect(o-s.f2,a-s.f2,l+s.f2,r+s.f2)}},84144(e,t,o){o.d(t,{makeImageData:()=>c});var n=o(77251),s=o(57141),a=o(52901),l=o(80921),r=o(61494),i=o(13677),f=o(95067);async function c(e,t){const{scrollTop:o,minorAlleleFrequencyFilter:c,sources:h,rowHeight:p,height:u,features:g,regions:d,bpPerPx:w,renderingMode:m,stopToken:b,lengthCutoffFilter:M,referenceDrawingMode:x,statusCallback:P=()=>{}}=t,T=d[0],y=(0,a.jL)(b),C=[],k=[],R={},v={},F=new Map,H="draw"===x,$=p,A=Math.max(p,1),L=Math.floor(o/$),S=Math.min(h.length,Math.ceil((o+u)/$)),j=await(0,n.updateStatus)("Calculating stats",P,()=>(0,f.Cg)({lastCheck:y,features:g.values(),minorAlleleFrequencyFilter:c,lengthCutoffFilter:M,genotypesCache:F,splitCache:v})),_={ctx:e,sources:h,region:T,bpPerPx:w,startRow:L,endRow:S,h:$,drawH:A,scrollTop:o,splitCache:v,drawRef:H,genotypesCache:F,stopToken:b},q={items:k,coords:C};await(0,n.updateStatus)("Drawing variants",P,()=>{"phased"===m?function(e,t,o){const{ctx:s,sources:r,region:f,bpPerPx:c,startRow:h,endRow:p,h:u,drawH:g,scrollTop:d,splitCache:w,drawRef:m,genotypesCache:b,stopToken:M}=e,{items:x,coords:P}=t,T=(0,a.jL)(M);for(const{feature:e}of o){const[t,o]=(0,n.featureSpanPx)(e,f,c),M=e.id(),y=e.get("end")-e.get("start"),C=Math.max(Math.round(o-t),2),k=Math.floor(t);let R=b.get(M);R||(R=e.get("genotypes"),b.set(M,R));for(let e=h;e<p;e++){const t=e*u-d,o=r[e],{name:n,HP:a,baseName:f}=o,c=R[f??n];if(c)if(c.includes("|")){const e=w[c]??(w[c]=c.split("|"));(0,i.E)(e,s,k,t,C,g,a,void 0,m)&&(x.push({name:n,genotype:c,featureId:M,bpLen:y}),P.push(k,t,k+C,t+g))}else s.fillStyle="black",s.fillRect(k-l.f2,t-l.f2,C+l.f2,g+l.f2)}(0,a.As)(T)}}(_,q,j):function(e,t,o,s){const{ctx:l,sources:i,region:f,bpPerPx:c,startRow:h,endRow:p,h:u,drawH:g,scrollTop:d,splitCache:w,drawRef:m,genotypesCache:b,stopToken:M}=e,{items:x,coords:P}=t,T=(0,a.jL)(M);for(const{mostFrequentAlt:e,feature:t}of o){const[o,M]=(0,n.featureSpanPx)(t,f,c),y=t.id(),C=t.get("end")-t.get("start"),k=Math.max(Math.round(M-o),2),R=Math.floor(o);let v=b.get(y);v||(v=t.get("genotypes"),b.set(y,v));const F=t.get("type"),H=t.get("strand"),$=C>5?.75:1;for(let t=h;t<p;t++){const o=t*u-d,{name:n}=i[t],a=v[n];if(a){const t=(0,r.Bs)(a,e,s,w,m);t&&((0,r.KP)(t,l,R,o,k,g,F,H,$),x.push({name:n,genotype:a,featureId:y,bpLen:C}),P.push(R,o,R+k,o+g))}}(0,a.As)(T)}}(_,q,j,R)});const D=new s.A(Math.max(k.length,1));if(k.length)for(let e=0,t=C.length;e<t;e+=4)D.add(C[e],C[e+1],C[e+2],C[e+3]);else D.add(0,0);D.finish();const E={};for(const{feature:e}of j)E[e.id()]={alt:e.get("ALT"),ref:e.get("REF"),name:e.get("name"),description:e.get("description"),length:e.get("end")-e.get("start")};return{flatbush:D.data,items:k,featureGenotypeMap:E}}}}]);
//# sourceMappingURL=4144.6aa2050c.chunk.js.map