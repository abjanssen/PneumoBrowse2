"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9978],{21016:(e,t,n)=>{n.d(t,{K:()=>s,W:()=>o});var a=n(87485),l=n(46879);function o(e,t,n,l,o,s=!0){if(e===o)return s?"#ccc":"";{let e;if(t&&(e=(0,a.M)(`hsl(200,50%,${80-t/o*50}%)`)),n){const t=`hsla(0,100%,20%,${n/o})`;e=e?e.mix(t):(0,a.M)(t)}if(l){const t=`hsl(50,50%,50%,${l/o})`;e=e?e.mix(t):(0,a.M)(t)}return e?.toHex()||"black"}}function s(e,t,n,o,s,f,i="",r,c=1){t.fillStyle=1!==c?(0,a.M)(e).alpha(c).toHex():e,"inversion"===i?1===r?(t.beginPath(),t.moveTo(n-l.f2,o-l.f2),t.lineTo(n-l.f2,o+f+l.f2),t.lineTo(n+s+l.f2,o+f/2),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(n+s+l.f2,o-l.f2),t.lineTo(n+s+l.f2,o+f+l.f2),t.lineTo(n-l.f2,o+f/2),t.closePath(),t.fill()):t.fillRect(n-l.f2,o-l.f2,s+l.f2,f+l.f2)}},46879:(e,t,n)=>{n.d(t,{f2:()=>a});const a=.3},66540:(e,t,n)=>{n.d(t,{E:()=>s});var a=n(40898),l=n(87485),o=n(46879);function s(e,t,n,s,f,i,r,c,u=!0,h=1){const g=void 0!==c?function(e,t,n,a=!0){return+e[t]?`hsl(${+n%255}, 50%, 50%)`||"black":a?"#ccc":void 0}(e,r,c,u):function(e,t,n=!0){const l=+e[t];return l?a.set1[l-1]||"black":n?"#ccc":void 0}(e,r,u);return g&&(t.fillStyle=1!==h?(0,l.M)(g).alpha(h).toHex():g,t.fillRect(n-o.f2,s-o.f2,f+o.f2,i+o.f2)),g}},99978:(e,t,n)=>{n.d(t,{makeImageData:()=>c});var a=n(99546),l=n(65944),o=n(37347),s=n(46879),f=n(21016),i=n(66540),r=n(85497);async function c(e,t){const{scrollTop:n,minorAlleleFrequencyFilter:c,sources:u,rowHeight:h,features:g,regions:d,bpPerPx:p,renderingMode:m,stopToken:b,lengthCutoffFilter:M,referenceDrawingMode:k}=t,w=d[0],{statusCallback:v=()=>{}}=t;(0,o.SW)(b);const T=await(0,a.updateStatus)("Calculating stats",v,()=>(0,r.Cg)({stopToken:b,features:g.values(),minorAlleleFrequencyFilter:c,lengthCutoffFilter:M}));(0,o.SW)(b);const x=[],y=[],S={};await(0,a.updateStatus)("Drawing variants",v,()=>{(0,a.forEachWithStopTokenCheck)(T,b,({mostFrequentAlt:t,feature:l})=>{const[o,r]=(0,a.featureSpanPx)(l,w,p),c=l.id(),g=l.get("end")-l.get("start"),d=Math.max(Math.round(r-o),2),b=l.get("genotypes");let M=-n;const v=u.length;if("phased"===m)for(let t=0;t<v;t++){const{name:n,HP:a}=u[t],l=b[n],f=Math.floor(o),r=Math.max(h,1);if(l)if(l.includes("|")){const t=l.split("|");(0,i.E)(t,e,f,M,d,r,a,void 0,"draw"===k)&&(y.push({name:n,genotype:l,featureId:c,bpLen:g}),x.push(f,M,f+d,M+r))}else e.fillStyle="black",e.fillRect(f-s.f2,M-s.f2,d+s.f2,r+s.f2);M+=h}else for(let n=0;n<v;n++){const{name:a}=u[n],s=b[a],i=Math.floor(o),r=Math.max(h,1);if(s){const n=`${s}:${t}`;let o=S[n];if(void 0===o){let e=0,a=0,l=0,i=0;const r=s.split(/[/|]/),c=r.length;for(let n=0;n<c;n++){const o=r[n];o===t?e++:"0"===o?i++:"."===o?a++:l++}o=(0,f.W)(i,e,l,a,c,"draw"===k),S[n]=o}o&&((0,f.K)(o,e,i,M,d,r,l.get("type"),l.get("strand"),g>5?.75:1),y.push({name:a,genotype:s,featureId:c,bpLen:g}),x.push(i,M,i+d,M+r))}M+=h}})});const C=new l.A(Math.max(y.length,1));if(y.length)for(let e=0;e<x.length;e+=4)C.add(x[e],x[e+1],x[e+2],x[e+3]);else C.add(0,0);return C.finish(),{flatbush:C.data,items:y,featureGenotypeMap:Object.fromEntries(T.map(({feature:e})=>[e.id(),{alt:e.get("ALT"),ref:e.get("REF"),name:e.get("name"),description:e.get("description"),length:e.get("end")-e.get("start")}]))}}}}]);
//# sourceMappingURL=9978.6755d8bc.chunk.js.map