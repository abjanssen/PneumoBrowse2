{"version":3,"file":"static/js/5668.42bdb400.chunk.js","mappings":"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","sources":["../../../plugins/breakpoint-split-view/src/BreakpointSplitView/svgcomponents/SVGBackground.tsx","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/svgcomponents/SVGBreakpointSplitView.tsx","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/svgcomponents/util.ts"],"sourcesContent":["import { stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nexport default function SVGBackground({\n  width,\n  height,\n  shift,\n}: {\n  width: number\n  height: number\n  shift: number\n}) {\n  const theme = useTheme()\n  return (\n    <rect\n      width={width + shift * 2}\n      height={height}\n      fill={stripAlpha(theme.palette.background.default)}\n    />\n  )\n}\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { getSession, renderToStaticMarkup, sum } from '@jbrowse/core/util'\nimport {\n  SVGRuler,\n  SVGTracks,\n  totalHeight,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { ThemeProvider } from '@mui/material'\nimport { when } from 'mobx'\n\nimport SVGBackground from './SVGBackground'\nimport { getTrackNameMaxLen, getTrackOffsets } from './util'\nimport Overlay from '../components/Overlay'\n\nimport type { BreakpointViewModel } from '../model'\nimport type { ExportSvgOptions } from '../types'\n\ntype BSV = BreakpointViewModel\n\n// render LGV to SVG\nexport async function renderToSvg(model: BSV, opts: ExportSvgOptions) {\n  const {\n    textHeight = 18,\n    headerHeight = 30,\n    rulerHeight = 30,\n    fontSize = 13,\n    trackLabels = 'offset',\n    Wrapper = ({ children }) => children,\n    themeName = 'default',\n  } = opts\n\n  const session = getSession(model)\n  const theme = session.allThemes?.()[themeName]\n  const { width, views } = model\n  const shift = 50\n  const offset = headerHeight + rulerHeight\n  const heights = views.map(\n    v => totalHeight(v.tracks, textHeight, trackLabels) + offset,\n  )\n  const totalHeightSvg = sum(heights) + 100\n  const displayResults = await Promise.all(\n    views.map(\n      async view =>\n        ({\n          view,\n          data: await Promise.all(\n            view.tracks.map(async track => {\n              const d = track.displays[0]\n              await when(() => (d.ready !== undefined ? d.ready : true))\n              return { track, result: await d.renderSvg({ ...opts, theme }) }\n            }),\n          ),\n        }) as const,\n    ),\n  )\n\n  const trackLabelMaxLen = getTrackNameMaxLen(views, fontSize, session) + 40\n  const trackLabelOffset = trackLabels === 'left' ? trackLabelMaxLen : 0\n  const textOffset = trackLabels === 'offset' ? textHeight : 0\n  const trackOffsets = views.map((view, idx) =>\n    getTrackOffsets(\n      view,\n      textOffset,\n      fontSize + (idx > 0 ? heights[idx - 1]! : 0) + offset,\n    ),\n  )\n  const w = width + trackLabelOffset\n  const t = createJBrowseTheme(theme)\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <ThemeProvider theme={t}>\n      <Wrapper>\n        <svg\n          width={width}\n          height={totalHeightSvg}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n          viewBox={[0, 0, w + shift * 2, totalHeightSvg].toString()}\n        >\n          <SVGBackground width={w} height={totalHeightSvg} shift={shift} />\n          {views[0] ? (\n            <g transform={`translate(${shift} ${fontSize})`}>\n              <g transform={`translate(${trackLabelOffset})`}>\n                <text x={0} fontSize={fontSize} fill={t.palette.text.primary}>\n                  {views[0].assemblyNames.join(', ')}\n                </text>\n\n                <SVGRuler model={displayResults[0]!.view} fontSize={fontSize} />\n              </g>\n              <g transform={`translate(0 ${offset})`}>\n                <SVGTracks\n                  textHeight={textHeight}\n                  trackLabels={trackLabels}\n                  fontSize={fontSize}\n                  model={displayResults[0]!.view}\n                  displayResults={displayResults[0]!.data}\n                  trackLabelOffset={trackLabelOffset}\n                />\n              </g>\n            </g>\n          ) : null}\n\n          {views[1] ? (\n            <g transform={`translate(${shift} ${fontSize + heights[0]!})`}>\n              <g transform={`translate(${trackLabelOffset})`}>\n                <text x={0} fontSize={fontSize} fill={t.palette.text.primary}>\n                  {views[1].assemblyNames.join(', ')}\n                </text>\n                <SVGRuler model={displayResults[1]!.view} fontSize={fontSize} />\n              </g>\n              <g transform={`translate(0 ${offset})`}>\n                <SVGTracks\n                  textHeight={textHeight}\n                  trackLabels={trackLabels}\n                  fontSize={fontSize}\n                  model={displayResults[1]!.view}\n                  displayResults={displayResults[1]!.data}\n                  trackLabelOffset={trackLabelOffset}\n                />\n              </g>\n            </g>\n          ) : null}\n\n          <defs>\n            <clipPath id=\"clip-bsv\">\n              <rect x={0} y={0} width={width} height={totalHeightSvg} />\n            </clipPath>\n          </defs>\n          <g\n            transform={`translate(${trackLabelOffset + shift})`}\n            clipPath=\"url(#clip-bsv)\"\n          >\n            {model.matchedTracks.map(track => (\n              <Overlay\n                parentRef={{ current: null }}\n                key={track.configuration.trackId}\n                model={model}\n                trackId={track.configuration.trackId}\n                getTrackYPosOverride={(id, level) => trackOffsets[level]![id]!}\n              />\n            ))}\n          </g>\n        </svg>\n      </Wrapper>\n    </ThemeProvider>,\n  )\n}\n","import { max, measureText } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\n\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function getTrackNameMaxLen(\n  views: LinearGenomeViewModel[],\n  fontSize: number,\n  session: AbstractSessionModel,\n) {\n  return max(\n    views.flatMap(view =>\n      view.tracks.map(t =>\n        measureText(getTrackName(t.configuration, session), fontSize),\n      ),\n    ),\n    0,\n  )\n}\nexport function getTrackOffsets(\n  view: LinearGenomeViewModel,\n  textOffset: number,\n  extra = 0,\n) {\n  const offsets = {} as Record<string, number>\n  let curr = textOffset\n  for (const track of view.tracks) {\n    offsets[track.configuration.trackId] = curr + extra\n    curr += track.displays[0].height + textOffset\n  }\n  return offsets\n}\n"],"names":["SVGBackground","t0","$","_c","width","height","shift","theme","useTheme","t1","t2","t3","palette","background","default","stripAlpha","_jsx","fill","async","renderToSvg","model","opts","textHeight","headerHeight","rulerHeight","fontSize","trackLabels","Wrapper","children","themeName","session","getSession","allThemes","views","offset","heights","map","v","totalHeight","tracks","totalHeightSvg","sum","displayResults","Promise","all","view","data","d","track","displays","when","undefined","ready","result","renderSvg","trackLabelMaxLen","max","flatMap","t","measureText","getTrackName","configuration","getTrackNameMaxLen","trackLabelOffset","textOffset","trackOffsets","idx","extra","offsets","curr","trackId","getTrackOffsets","w","createJBrowseTheme","renderToStaticMarkup","ThemeProvider","_jsxs","xmlns","xmlnsXlink","viewBox","toString","transform","x","text","primary","assemblyNames","join","SVGRuler","SVGTracks","id","y","clipPath","matchedTracks","Overlay","parentRef","current","getTrackYPosOverride","level"],"sourceRoot":""}