"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4385],{84385(e,t,a){a.r(t),a.d(t,{default:()=>ie});var s=a(42918),n=a(77251),r=a(25415),o=a(44642),i=a(16073),c=a(57271),l=a(64074),d=a(65045),p=a(41031),u=a(92511),h=a(19925),m=a(35311),f=a(49520),g=a(70885),x=a(34592),k=a(70203),j=a(43787),b=a(28519),A=a(76143),y=a(30936),v=a(32118);const w=(0,d.n)()(e=>({spacing:{marginBottom:e.spacing(3)}}));function T(e){const t=(0,y.c)(5),{trackAdapter:a,trackType:s}=e,{classes:n}=w(),{type:r,subadapter:o}=a;let i;return t[0]!==n.spacing||t[1]!==o?.type||t[2]!==s||t[3]!==r?(i="SNPCoverageAdapter"===r?(0,v.jsxs)(p.A,{className:n.spacing,children:["Selected ",(0,v.jsx)("code",{children:s}),". Using adapter ",(0,v.jsx)("code",{children:r})," with subadapter ",(0,v.jsx)("code",{children:o?.type}),". Please enter a track name and, if necessary, update the track type."]}):(0,v.jsxs)(p.A,{className:n.spacing,children:["Using adapter ",(0,v.jsx)("code",{children:r})," and guessing track type"," ",(0,v.jsx)("code",{children:s}),". Please enter a track name and, if necessary, update the track type."]}),t[0]=n.spacing,t[1]=o?.type,t[2]=s,t[3]=r,t[4]=i):i=t[4],i}var N=a(84830),S=a(99495);function C(e){const t={};for(const a of e){const e=a.adapterMetadata?.category||"Default";t[e]||(t[e]=[]),t[e].push(a)}return t}const I=(0,l.observer)(function({model:e}){const{trackAdapter:t,adapterHintNotConfigurable:a}=e,{adapterHint:s}=e,{pluginManager:r}=(0,n.getEnv)(e),o=s||("UNKNOWN"!==t?.type?t?.type:"");return(0,v.jsx)(j.A,{value:o,label:"Adapter type",variant:"outlined",select:!0,fullWidth:!0,error:a,helperText:a?`The "${s}" adapter cannot be configured for the provided file. This adapter may require a specific file extension or additional setup.`:void 0,onChange:t=>{e.setAdapterHint(t.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},children:Object.entries(C(r.getAdapterElements().filter(e=>!e.adapterMetadata?.hiddenFromGUI))).map(([e,t])=>[(0,v.jsx)(S.A,{children:e},e),t.map(e=>(0,v.jsx)(i.A,{value:e.name,children:e.displayName},e.name))])})}),D=(0,d.n)()(e=>({spacing:{marginBottom:e.spacing(3)}}));function E(e){const t=(0,y.c)(9),{model:a}=e,{classes:s}=D();let n,r,o,i,c;return t[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,v.jsx)(N.A,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"}),t[0]=n):n=t[0],t[1]===Symbol.for("react.memo_cache_sentinel")?(r=(0,v.jsx)(N.A,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"}),t[1]=r):r=t[1],t[2]!==s.spacing?(o=(0,v.jsxs)(p.A,{className:s.spacing,children:["JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",n," ","of JBrowse to see if they support this data type or"," ",r," ","and add a feature request for this data type."]}),t[2]=s.spacing,t[3]=o):o=t[3],t[4]!==a?(i=(0,v.jsx)(I,{model:a}),t[4]=a,t[5]=i):i=t[5],t[6]!==o||t[7]!==i?(c=(0,v.jsxs)(v.Fragment,{children:[o,i]}),t[6]=o,t[7]=i,t[8]=c):c=t[8],c}var P=a(49563),O=a(11125),M=a(45371),B=a(68689),V=a(44681),W=a(37159),_=a(8193),J=a(40271),U=a(31289),F=a(87);const G=(0,d.n)()(e=>({paper:{display:"flex",flexDirection:"column",padding:e.spacing(1)},card:{marginTop:e.spacing(1)}})),H=(0,l.observer)(function({model:e}){const{classes:t}=G(),[a,n]=(0,s.useState)(""),[r,o]=(0,s.useState)(""),[i,c]=(0,s.useState)(["Name","ID"]),[l,d]=(0,s.useState)(["CDS","exon"]),p=[{label:"Indexing attributes",values:i,setValues:c,inputValue:a,setInputValue:n},{label:"Feature types to exclude",values:l,setValues:d,inputValue:r,setInputValue:o}];return(0,s.useEffect)(()=>{e.setTextIndexingConf({attributes:i,exclude:l})},[e,i,l]),(0,v.jsxs)(M.A,{className:t.paper,children:[(0,v.jsx)(B.A,{children:"Indexing configuration"}),p.map(e=>(0,v.jsx)(V.A,{raised:!0,className:t.card,children:(0,v.jsxs)(W.A,{children:[(0,v.jsx)(B.A,{children:e.label}),(0,v.jsxs)(_.A,{disablePadding:!0,children:[e.values.map((t,a)=>(0,v.jsx)(J.Ay,{disableGutters:!0,children:(0,v.jsx)(j.A,{value:t,slotProps:{input:{endAdornment:(0,v.jsx)(U.A,{position:"end",children:(0,v.jsx)(F.A,{onClick:()=>{e.setValues(e.values.filter((e,t)=>t!==a))},children:(0,v.jsx)(O.A,{})})})}}})},`${t}-${a}`)),(0,v.jsx)(J.Ay,{disableGutters:!0,children:(0,v.jsx)(j.A,{value:e.inputValue,placeholder:"add new",onChange:t=>{e.setInputValue(t.target.value)},slotProps:{input:{endAdornment:(0,v.jsx)(U.A,{position:"end",children:(0,v.jsx)(F.A,{onClick:()=>{e.setValues([...e.values,e.inputValue]),e.setInputValue("")},disabled:""===e.inputValue,"data-testid":"stringArrayAdd-Feat",children:(0,v.jsx)(P.A,{})})})}}})})]})]})},e.label))]})}),R=(0,l.observer)(function({model:e}){const{pluginManager:t}=(0,n.getEnv)(e),{trackType:a}=e,s=t.getTrackElements();return(0,v.jsx)(j.A,{value:a,variant:"outlined",label:"Track type",select:!0,fullWidth:!0,onChange:t=>{e.setTrackType(t.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},children:s.map(({name:e,displayName:t})=>(0,v.jsx)(i.A,{value:e,children:t},e))})}),q=(0,d.n)()(e=>({spacing:{marginBottom:e.spacing(3)}}));function $(){const e=(0,y.c)(4),{classes:t}=q();let a,s,n;return e[0]===Symbol.for("react.memo_cache_sentinel")?(a=(0,v.jsx)(N.A,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"}),e[0]=a):a=e[0],e[1]===Symbol.for("react.memo_cache_sentinel")?(s=(0,v.jsx)(N.A,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"}),e[1]=s):s=e[1],e[2]!==t.spacing?(n=(0,v.jsxs)(p.A,{className:t.spacing,children:["This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",a," ","of JBrowse or"," ",s," ","and add a feature request for this data type."]}),e[2]=t.spacing,e[3]=n):n=e[3],n}const L=(0,d.n)()(e=>({spacing:{marginBottom:e.spacing(3)},selectorsContainer:{display:"flex",flexDirection:"column",gap:10}})),K=(0,l.observer)(function({model:e}){const{classes:t}=L(),a=(0,n.getSession)(e),{trackName:o,unsupported:i,trackAdapter:c,trackType:l,warningMessage:d,adapterHint:u,textIndexTrack:h,adapterHintNotConfigurable:m}=e;if((0,s.useEffect)(()=>{""===u&&c&&c.type!==k.UNKNOWN&&e.setAdapterHint(c.type)},[u,c,e]),i)return(0,v.jsx)($,{});if(c?.type===k.UNKNOWN)return(0,v.jsx)(E,{model:e});if(m)return(0,v.jsxs)(p.A,{color:"error",children:['The "',u,'" adapter cannot be configured for the provided file. This adapter may require a specific file extension or format. Please check the file or select a different adapter.']});if(c?.type){const i=(0,n.isSupportedIndexingAdapter)(c.type),{pluginManager:u}=(0,n.getEnv)(e),m=u.evaluateExtensionPoint("Core-addTrackComponent",({model:e})=>(0,v.jsx)(x.A,{session:a,helperText:"Select assembly to add track to",selected:e.assembly,onChange:t=>{e.setAssembly(t)},TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),{model:e});return(0,v.jsxs)("div",{children:[(0,v.jsx)(T,{trackAdapter:c,trackType:l}),d?(0,v.jsx)(p.A,{color:"warning",children:d}):null,(0,v.jsx)(j.A,{className:t.spacing,label:"Track name",helperText:"A name for this track",fullWidth:!0,value:o,onChange:t=>{e.setTrackName(t.target.value)},slotProps:{htmlInput:{"data-testid":"trackNameInput"}}}),(0,v.jsxs)("div",{className:t.selectorsContainer,children:[(0,v.jsx)(I,{model:e}),(0,v.jsx)(R,{model:e}),(0,v.jsx)(s.Suspense,{fallback:null,children:(0,v.jsx)(m,{model:e})})]}),n.isElectron&&i&&(0,v.jsx)(r.A,{children:(0,v.jsx)(b.A,{label:"Index track for text searching?",control:(0,v.jsx)(A.A,{checked:h,onChange:t=>{e.setTextIndexTrack(t.target.checked)}})})}),n.isElectron&&h&&i?(0,v.jsx)(H,{model:e}):null]})}return(0,v.jsx)(p.A,{children:"Could not recognize this data type."})});var Q=a(66012),z=a(99226);const Y=(0,d.n)()(e=>({paper:{padding:e.spacing(2)},spacer:{height:e.spacing(8)}})),X=(0,l.observer)(function({model:e}){const{classes:t}=Y(),a=(0,z.getRoot)(e);return(0,v.jsxs)(M.A,{className:t.paper,children:[(0,v.jsx)(Q.A,{name:"Main file",description:"",location:e.trackData,setLocation:e.setTrackData,rootModel:a}),(0,v.jsx)("div",{className:t.spacer}),(0,v.jsx)(Q.A,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:e.indexTrackData,setLocation:e.setIndexTrackData,rootModel:a})]})});var Z=a(10525);const ee=(0,d.n)()(e=>({root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginRight:e.spacing(1)},actionsContainer:{marginTop:e.spacing(10),marginBottom:e.spacing(2)}})),te=["Enter track data","Confirm track type"],ae=(0,l.observer)(function({model:e}){const[t,a]=(0,s.useState)(0),{classes:r}=ee(),{assembly:o,trackAdapter:i,trackData:c,trackName:l,trackType:d}=e;function x(t){switch(t){case 0:return(0,v.jsx)(X,{model:e});case 1:return(0,v.jsx)(K,{model:e});default:return(0,v.jsx)(p.A,{children:"Unknown step"})}}function k(){switch(t){case 0:return!c;case 1:return!(l&&d&&i?.type&&o);default:return!0}}return(0,v.jsx)("div",{className:r.root,children:(0,v.jsx)(u.A,{className:r.stepper,activeStep:t,orientation:"vertical",children:te.map((s,o)=>(0,v.jsxs)(h.A,{children:[(0,v.jsx)(m.A,{children:s}),(0,v.jsxs)(f.A,{children:[x(o),(0,v.jsxs)("div",{className:r.actionsContainer,children:[(0,v.jsx)(g.A,{disabled:0===t,className:r.button,onClick:()=>{a(t-1)},"data-testid":"addTrackBackButton",children:"Back"}),(0,v.jsx)(g.A,{disabled:k(),variant:"contained",color:"primary",onClick:()=>{if(t!==te.length-1)a(t+1);else try{!function({model:e}){const{textIndexTrack:t,trackAdapter:a,view:s}=e,r=(0,n.getSession)(e),o=e.getTrackConfig(Date.now());if(!(0,Z.QW)(r))throw new Error("Can't add tracks to this session");if(!o||!a)throw new Error("Failed to add track.\nThe configuration of this file is not currently supported.");{const{trackId:i}=o;r.addTrackConf(o),s?.showTrack?.(i),n.isElectron&&t&&(0,n.isSupportedIndexingAdapter)(a.type)&&function({trackId:e,model:t}){const{textIndexingConf:a,trackName:s,assembly:n}=t,{jobsManager:r}=(0,z.getRoot)(t),o=a||{attributes:["Name","ID"],exclude:["CDS","exon"]},i=`${s}-index`;r.queueJob({indexingParams:{...o,assemblies:[n],tracks:[e],indexType:"perTrack",name:i,timestamp:(new Date).toISOString()},name:i,cancelCallback:()=>r.abortJob()})}({model:e,trackId:String(i)}),e.clearData(),(0,Z.lO)(r)&&r.hideWidget(e)}}({model:e})}catch(t){(0,n.getSession)(e).notifyError(`${t}`,t)}},className:r.button,"data-testid":"addTrackNextButton",children:t===te.length-1?"Add":"Next"})]})]})]},s))})})});var se=a(27351),ne=a(38567);const re=(0,d.n)()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),oe=(0,l.observer)(function({model:e}){const{classes:t}=re(),[a,r]=(0,s.useState)(""),[o,i]=(0,s.useState)();return(0,v.jsxs)("div",{children:[o?(0,v.jsx)(se.A,{error:o}):null,(0,v.jsx)(j.A,{multiline:!0,rows:10,value:a,placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:t.textbox,onChange:e=>{r(e.target.value)}}),(0,v.jsx)(g.A,{variant:"contained",className:t.submit,onClick:()=>{try{i(void 0);const t=(0,n.getSession)(e),s=JSON.parse(a),r=Array.isArray(s)?s:[s];(0,Z.QW)(t)&&(0,Z.lO)(t)&&((0,ne.transaction)(()=>{for(const e of r)t.addTrackConf(e);for(const t of r)e.view?.showTrack?.(t.trackId);e.clearData()}),t.hideWidget(e))}catch(e){console.error(e),i(e)}},children:"Submit"})]})}),ie=(0,l.observer)(function({model:e}){const[t,a]=(0,s.useState)("Default add track workflow"),l={"Default add track workflow":ae,"Add track JSON":oe,...Object.fromEntries((0,n.getEnv)(e).pluginManager.getAddTrackWorkflowElements().map(e=>[e.name,e.ReactComponent]))},d=l[t]?t:"Default add track workflow",p=l[d];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(r.A,{children:[(0,v.jsx)(o.A,{value:d,onChange:e=>{a(e.target.value)},children:Object.keys(l).map(e=>(0,v.jsx)(i.A,{value:e,children:e},e))}),(0,v.jsx)(c.A,{children:"Type of add track workflow"})]}),(0,v.jsx)(s.Suspense,{fallback:null,children:(0,v.jsx)(p,{model:e})})]})})}}]);
//# sourceMappingURL=4385.86c8f23e.chunk.js.map