"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5403],{95403(e,t,o){o.d(t,{renderSNPCoverageToCanvas:()=>x});var n=o(17378),s=o(56993),r=o(40907),a=o(29458),i=o(23886),c=o(31508),l=o(23638),f=o(91520),p=o(61425);function h(e,t){const o=new p.A(Math.max(t.length,1));if(e.length)for(let t=0;t<e.length;t+=4)o.add(e[t],e[t+1],e[t+2],e[t+3]);else o.add(0,0);return o.finish(),{flatbush:o.data,items:t}}const u=4.5,d={C:"G",G:"C",A:"T",T:"A"};function g(e,t,o,n,s){return{type:e,base:e,count:t,total:o,avgLength:s?.avgLength,minLength:s?.minLength,maxLength:s?.maxLength,topSequence:s?.topSequence,start:n}}function b(e,t,o,n,s,r,a){const{ctx:i,colorMap:c,toHeight2:l,extraHorizontallyFlippedOffset:f,coords:p,items:h,bpPerPx:d,indicatorThreshold:b,showInterbaseCounts:m,showInterbaseIndicators:y}=e;let T=0,x=0,v="",I=0;const k=o-.6+f;for(const e in t.noncov){const{entryDepth:o}=t.noncov[e];T+=o,o>x&&(x=o,v=e)}const S=n>0&&T>.1*n,N=m&&(!r||S);if(N)for(const e in t.noncov){const{entryDepth:o}=t.noncov[e],n=l(o);i.fillStyle=c[e],i.fillRect(k,u+I,1.2,n),I+=n}if(T>0){const e=t.noncov[v];if(N&&(d<50||S)){const t=Math.max(1.2,2);p.push(k,u,k+t,u+I),h.push(g(v,T,n,a,e))}if(y&&(!r||S)){const t=Math.max(n,s);if(T>t*b&&t>7){i.fillStyle=c[v],i.beginPath();const n=o+f;i.moveTo(n-3.5,0),i.lineTo(n+3.5,0),i.lineTo(n,u),i.fill();const s=1;p.push(n-3.5-s,0,n+3.5+s,u+s),h.push(g(v,T,t,a,e))}}}}function m(e,t,o,n,s,r,a,i,c){let l=c;for(const c in t){const{entryDepth:f}=t[c];e.fillStyle=o[c]||"black",e.fillRect(n,s-(f+l)/i*a,r,f/i*a),l+=f}return l}function y({base:e,isSimplex:t,refbase:o,snps:n,ref:s,score0:r}){if("N"===e)return{modifiable:r,detectable:r};const a=d[e],i=(n[e]?.entryDepth||0)+(o===e?s.entryDepth:0)+((n[a]?.entryDepth||0)+(o===a?s.entryDepth:0));return{modifiable:i,detectable:t?(n[e]?.[1]||0)+(n[a]?.[-1]||0)+(o===e?s[1]:0)+(o===a?s[-1]:0):i}}var T=o(89579);async function x(e){const{features:t,regions:o,bpPerPx:p,adapterConfig:u}=e,d=o[0],g=(d.end-d.start)/p,x=e.height,v=u.adapterId??"unknown",I=[],k=[];for(const e of t.values())"skip"===e.get("type")?I.push({uniqueId:e.id(),type:"skip",refName:d.refName,start:e.get("start"),end:e.get("end"),strand:e.get("strand"),score:e.get("score"),effectiveStrand:e.get("effectiveStrand")}):k.push(e);const{reducedFeatures:S,coords:N,items:P,...C}=await(0,r.u)(g,x,e,t=>function(e,t,o){const{regions:r,bpPerPx:c,colorBy:l,displayCrossHatches:p,visibleModifications:h={},simplexModifications:u=[],scaleOpts:d,height:g,theme:x,config:v,ticks:I,stopTokenCheck:k}=t,S=(0,s.createJBrowseTheme)(x),N=r[0],P=(N.end-N.start)/c,C=f.YSCALEBAR_LABEL_OFFSET,w=g-2*C,M={...d,range:[0,w]},A=(0,f.getScale)(M),F=(0,f.getScale)({...M,range:[0,w/2],scaleType:"linear"}),_=(0,f.getOrigin)(d.scaleType),D=(0,n.QZ)(v,"indicatorThreshold"),E=(0,n.QZ)(v,"showInterbaseCounts"),H=(0,n.QZ)(v,"showInterbaseIndicators"),L=e=>w-(A(e)||0)+C,Y=e=>L(_)-L(e),{bases:G,softclip:R,hardclip:O,insertion:Q}=S.palette,q={A:G.A.main,C:G.C.main,G:G.G.main,T:G.T.main,insertion:Q,softclip:R,hardclip:O,total:(0,n.QZ)(v,"color"),mod_NONE:"blue",cpg_meth:"red",cpg_unmeth:"blue"},B=[];let V=Number.NEGATIVE_INFINITY;const Z=[],$=[];e.fillStyle=q.total;for(let t=0,n=o.length;t<n;t++){(0,a.As)(k);const n=o[t],[s,r]=(0,i.featureSpanPx)(n,N,c),l=r-s+.6,f=n.get("score");e.fillRect(s,L(f),l,Y(f)),s>V+1&&(B.push({start:n.get("start"),end:n.get("end"),score:f,snpinfo:n.get("snpinfo"),refName:N.refName}),V=s)}const j=N.reversed?1/c:0,z={ctx:e,coverageFeatures:o,region:N,bpPerPx:c,colorMap:q,toY:L,toHeight:Y,toHeight2:e=>F(e)||0,stopTokenCheck:k,extraHorizontallyFlippedOffset:j,coords:Z,items:$,indicatorThreshold:D,showInterbaseCounts:E,showInterbaseIndicators:H};if("modifications"===l.type){const e=l.modifications?.isolatedModification;!function(e,t,o,n){const{ctx:s,coverageFeatures:r,region:c,bpPerPx:l,toY:f,toHeight:p,stopTokenCheck:h}=e;let u=Number.NEGATIVE_INFINITY,d=0;for(let g=0,m=r.length;g<m;g++){(0,a.As)(h);const m=r[g],[x,v]=(0,i.featureSpanPx)(m,c,l),I=m.get("snpinfo"),k=Math.max(v-x,1),S=m.get("score"),N=Math.round(x),P=N===u;let C=0;const w=I?.refbase?.toUpperCase(),{nonmods:M,mods:A,snps:F,ref:_}=I||{},D=p(S),E=f(S)+D;for(const e in M){const r=t[e.slice(7)];if(!r||o&&r.type!==o)continue;const{modifiable:a,detectable:i}=y({base:r.base,isSimplex:n.has(r.type),refbase:w,snps:F||{},ref:_||{entryDepth:0,1:0,"-1":0,0:0},score0:S}),{entryDepth:c,avgProbability:l=0}=M[e],f=a/S*(c/i)*D;P?0:(s.fillStyle=(0,T.yr)("blue",l),s.fillRect(N,E-(C+f),k,f),u=N),C+=f}for(const e in A){const r=t[e.slice(4)];if(!r||o&&r.type!==o)continue;const{modifiable:a,detectable:i}=y({base:r.base,isSimplex:n.has(r.type),refbase:w,snps:F||{},ref:_||{entryDepth:0,1:0,"-1":0,0:0},score0:S}),{entryDepth:c,avgProbability:l=0}=A[e],f=a/S*(c/i)*D;P?0:(s.fillStyle=(0,T.yr)(r.color||"black",l),s.fillRect(N,E-(C+f),k,f),u=N),C+=f}b(e,I,x,S,d,P,m.get("start")),d=S}}(z,h,e,new Set(u))}else"methylation"===l.type?function(e){const{ctx:t,coverageFeatures:o,region:n,bpPerPx:s,colorMap:r,toY:c,toHeight:l,stopTokenCheck:f}=e;let p=Number.NEGATIVE_INFINITY,h=0;for(let u=0,d=o.length;u<d;u++){(0,a.As)(f);const d=o[u],[g,y]=(0,i.featureSpanPx)(d,n,s),T=d.get("snpinfo"),x=Math.max(y-g,1),v=d.get("score"),I=Math.round(g),k=I===p,{depth:S,nonmods:N,mods:P}=T,C=l(v),w=c(v)+C,M=m(t,P,r,I,w,x,C,S,0);m(t,N,r,I,w,x,C,S,M),p=I,b(e,T,g,v,h,k,d.get("start")),h=v}}(z):function(e){const{ctx:t,coverageFeatures:o,region:n,bpPerPx:s,colorMap:r,toY:c,toHeight:l,stopTokenCheck:f,coords:p,items:h}=e;let u=Number.NEGATIVE_INFINITY,d=-1,g=0;for(let m=0,y=o.length;m<y;m++){(0,a.As)(f);const y=o[m],[T,x]=(0,i.featureSpanPx)(y,n,s),v=y.get("snpinfo"),I=Math.max(x-T,1),k=y.get("score"),S=Math.round(T),N=S===u,{depth:P,snps:C,refbase:w}=v,M=w?.toUpperCase(),A=l(k),F=c(k)+A;let _=0;for(const e in C){const o=C[e],{entryDepth:n}=o,s=F-(n+_)/P*A,a=n/P*A,i=n/k>=.04;N&&!i||N&&n===d?0:(t.fillStyle=r[e]||"black",t.fillRect(S,s,I,a),u=S,d=n),i&&(p.push(S,s,S+I,s+a),h.push({type:"snp",base:e,count:n,total:k,refbase:M,avgQual:o.avgProbability,fwdCount:o[1]||0,revCount:o[-1]||0,bin:v,start:y.get("start"),end:y.get("end")})),_+=n}b(e,v,T,k,g,N,y.get("start")),g=k}}(z);return p&&function(e,t,o,n){e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)";for(const s of t.values)e.beginPath(),e.moveTo(0,Math.round(n(s))),e.lineTo(o,Math.round(n(s))),e.stroke()}(e,I,P,L),{reducedFeatures:B,coords:Z,items:$}}(t,e,k)),w={...C,features:S.map((e,t)=>({...e,uniqueId:`${v}-${e.start}-${t}`})),skipFeatures:I,clickMap:h(N,P),height:x,width:g};return(0,c.lk)(w,(0,l.X)(C))}}}]);
//# sourceMappingURL=5403.55088910.chunk.js.map