"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4092],{84092(t,e,n){n.d(e,{default:()=>l});var i=n(45188),a=n(20208),r=n(90946),s=n(23886),o=n(11931),c=n(25529),u=n(77989);class l extends r.L{async configurePre(t){const e=this.getConf("indexType"),n=this.getConf("vcfGzLocationMap")[t],r=this.getConf("indexLocationMap")[t]||{uri:`${n.uri}.${e.toLowerCase()}`},s=(0,o.openLocation)(n,this.pluginManager),c="CSI"===e,u=new i.wD({filehandle:s,csiFilehandle:c?(0,o.openLocation)(r,this.pluginManager):void 0,tbiFilehandle:c?void 0:(0,o.openLocation)(r,this.pluginManager),chunkCacheSize:52428800});return{vcf:u,parser:new a.Ay({header:await u.getHeader()})}}async configure(t,e){const{statusCallback:n=()=>{}}=e||{};return(0,s.updateStatus)("Downloading index",n,()=>this.configurePre(t))}async getRefNames(){return Object.keys(this.getConf("vcfGzLocationMap"))}getFeatures(t,e={}){return(0,c.ObservableCreate)(async n=>{const{refName:i,start:a,end:r}=t,{statusCallback:o=()=>{}}=e,{vcf:c,parser:l}=await this.configure(t.refName,e);await(0,s.updateStatus)("Downloading variants",o,()=>c.getLines(i,a,r,{lineCallback:(t,e)=>{n.next(new u.A({variant:l.parseLine(t),parser:l,id:`${this.id}-vcf-${e}`}))},...e})),n.complete()},e.stopToken)}async getSources(){const t=this.getConf("samplesTsvLocation"),e=Object.keys(this.getConf("vcfGzLocationMap"))[0];if(""===t.uri||"/path/to/samples.tsv"===t.uri){const{parser:t}=await this.configure(e);return t.samples.map(t=>({name:t}))}{const n=(await(0,s.fetchAndMaybeUnzipText)((0,o.openLocation)(t,this.pluginManager))).split(/\n|\r\n|\r/),i=n[0].split("\t"),{parser:a}=await this.configure(e),r=new Set(a.samples);return n.slice(1).map(t=>{const e=t.split("\t");return{name:e[0],...Object.fromEntries(e.slice(1).map((t,e)=>[i[e+1],t]))}}).filter(t=>r.has(t.name))}}}},77989(t,e,n){n.d(e,{A:()=>s});var i=n(23886),a=n(17253);function r(t){const{POS:e,REF:n="",ALT:a=[]}=t,r=e-1;let s=!1,o=!1;for(const t of a)if(t.includes("<")&&(o=!0,"<TRA>"===t)){s=!0;break}if(o){const e=t.INFO;if(e.END&&!s)return+e.END[0];const n=[];if(e.SVLEN&&!s){const t=e.SVLEN;for(let e=0;e<t.length;e++){const i=t[e];a[e]?.startsWith("<INS")?n.push(1):n.push(Math.abs(+i))}return r+(0,i.max)(n)}}return r+n.length}class s{constructor(t){this.variant=t.variant,this.parser=t.parser,this.data=function(t,e){const{REF:n="",ALT:i,POS:s,CHROM:o,ID:c}=t,u=s-1,[l,p]=(0,a.M_)(n,i,e);return{refName:o,start:u,end:r(t),description:p,type:l,name:c?.join(",")}}(this.variant,this.parser),this._id=t.id}get(t){return"samples"===t?this.variant.SAMPLES():"genotypes"===t?this.variant.GENOTYPES():this.data[t]??this.variant[t]}parent(){}children(){}id(){return this._id}processGenotypes(t){this.variant.processGenotypes(t)}toJSON(){return{uniqueId:this._id,...this.variant.toJSON(),...this.data,samples:this.variant.SAMPLES()}}}},17253(t,e,n){n.d(e,{Fm:()=>h,M_:()=>u,bC:()=>p});var i=n(20208),a=n(23886);const r=/[/|]/;function s(t){return t.includes("[")||t.includes("]")||t.startsWith(".")||t.endsWith(".")}function o(t){return t.startsWith("<")||s(t)}const c={"<DEL>":"deletion","<INS>":"insertion","<DUP>":"duplication","<INV>":"inversion","<INVDUP>":"inverted_duplication","<CNV>":"copy_number_variation","<TRA>":"translocation","<DUP:TANDEM>":"tandem_duplication","<NON_REF>":"sequence_variant","<*>":"sequence_variant"};function u(t,e,n){if(!e||0===e.length)return["remark","no alternative alleles"];const r=e.map(e=>function(t,e,n){if(t.startsWith("<"))return l(t,n)??"variant";if(s(t)&&(0,i.An)(t))return"breakend";const a=e.length,r=t.length;return 1===a&&1===r?"SNV":a===r?function(t,e){return t.split("").reverse().join("")===e}(e,t)?"inversion":"substitution":a<r?"insertion":"deletion"}(e,t,n)),c=[...new Set(r)],u=function(t,e){if(e.every(o))return e.join(",");const n=t.length;return`${t.length>10?(0,a.getBpDisplayStr)(n):t} -> ${e.map(t=>t.length>10?(0,a.getBpDisplayStr)(t.length):t).join(",")}`}(t,e);return[c.join(","),u]}function l(t,e){if(c[t])return c[t];if(e.getMetadata("ALT",t))return"sequence_variant";const n=t.slice(1,-1).split(":");return n.length>1?l(`<${n.slice(0,-1).join(":")}>`,e):void 0}function p(t,e){if(o(e)||1===t.length&&1===e.length)return e;const n=t.length,i=e.length;return n>5||i>5?`${(0,a.getBpDisplayStr)(n)} -> ${(0,a.getBpDisplayStr)(i)}`:`${t} -> ${e}`}function h(t,e,n){return t.split(r).map(t=>"."===t?".":0===+t?`ref(${e.length<10?e:(0,a.getBpDisplayStr)(e.length)})`:p(e,n[+t-1]||"")).join(t.includes("|")?"|":"/")}}}]);
//# sourceMappingURL=4092.a867d89a.chunk.js.map