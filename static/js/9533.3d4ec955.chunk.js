"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9533],{13228(e,t,n){n.d(t,{J0:()=>c,s5:()=>i});var o=n(77251);const r={insertion:"Insertion",softclip:"Soft clip",hardclip:"Hard clip",snp:"SNP",modification:"Modification"};function i(e){return r[e]??e}function s(e){return(e[-1]?`${e[-1]}(-)`:"")+(e[1]?`${e[1]}(+)`:"")||"-"}function a(e,t=1){return`${(e/(t||1)*100).toFixed(1)}%`}function u(e){const{readsCounted:t,ref:n,refbase:r,snps:i,mods:u}=e,c=[{base:"Total",count:t,percent:"-",strands:"-"},{base:r?`REF (${r.toUpperCase()})`:"REF",count:n.entryDepth,percent:a(n.entryDepth,t),strands:s(n)}];for(const[e,n]of Object.entries(i))c.push({base:e.toUpperCase(),count:n.entryDepth,percent:a(n.entryDepth,t),strands:s(n),prob:void 0!==n.avgProbability?`qual:${(0,o.reducePrecision)(n.avgProbability)}`:void 0});for(const[e,n]of Object.entries(u))c.push({base:e,count:n.entryDepth,percent:a(n.entryDepth,t),strands:s(n),prob:void 0!==n.avgProbability?`${(100*n.avgProbability).toFixed(1)}%`:void 0});return c}function c(e,t){if("snp"===e.type)return{uniqueId:`snp-${e.base}-${e.start}`,type:"snp",refName:t,start:e.start,end:e.end,details:e.bin?u(e.bin):void 0};if("modification"===e.type){const n=e.total>0?(e.count/e.total*100).toFixed(1):"0",o=e.isUnmodified?`Unmodified ${e.base}`:`${e.modType} (${e.base})`;return{uniqueId:`mod-${e.modType}-${e.base}`,type:"modification",refName:t,start:e.start,end:e.start+1,label:o,count:`${e.count}/${e.total} (${n}%)`,strands:`${e.fwdCount}(+) ${e.revCount}(-)`,probability:void 0!==e.avgProb?`${(100*e.avgProb).toFixed(1)}%`:void 0}}const n=e.total>0?(e.count/e.total*100).toFixed(1):"0";return{uniqueId:`${e.type}-${e.base}`,type:e.type,refName:t,start:e.start,end:e.start+1,count:`${e.count}/${e.total} (${n}%)`,size:e.minLength===e.maxLength?`${e.minLength}bp`:`${e.minLength}-${e.maxLength}bp (avg ${e.avgLength?.toFixed(1)}bp)`,sequence:e.topSequence}}},69533(e,t,n){n.r(t),n.d(t,{default:()=>l});var o=n(42918),r=n(93111),i=n(77251),s=n(10525),a=n(57141),u=n(64074),c=n(13228),d=n(32118);function f(e){for(const t of e.values()){const e=t.get("refName");if(e)return e}}const l=(0,u.observer)(function(e){const{regions:t,features:n,bpPerPx:u,width:l,height:p,clickMap:b,displayModel:g}=e,v=t[0],h=(0,o.useRef)(null),[m,$]=(0,o.useState)(!1),y=(0,o.useMemo)(()=>b?.flatbush?a.A.from(b.flatbush):void 0,[b?.flatbush]),x=b?.items;function F(e){let t=0;h.current&&(t=h.current.getBoundingClientRect().left);const o=e-t,r=v.reversed?l-o:o,i=v.start+u*r;let s;for(const e of n.values())if(i<=e.get("end")+u&&i>=e.get("start")){s=e;break}return s}function M(e,t){if(!y||!x||!h.current)return;const n=h.current.getBoundingClientRect(),o=e-n.left,r=t-n.top,i=y.search(o,r,o+1.5,r+1.5);return 0!==i.length?1===i.length?x[i[0]]:i.map(e=>x[e]).sort((e,t)=>t.count/t.total-e.count/e.total)[0]:void 0}return(0,d.jsx)("div",{ref:h,"data-testid":"snpcoverage-rendering-test",onMouseMove:e=>{const t=M(e.clientX,e.clientY),o=function(e,t){if(e)return JSON.stringify({item:e,refName:t})}(t,f(n)??v.refName);$(!!t),o?(g?.setFeatureIdUnderMouse(void 0),g?.setMouseoverExtraInformation(o)):(g?.setFeatureIdUnderMouse(F(e.clientX)?.id()),g?.setMouseoverExtraInformation(void 0))},onClick:e=>{const t=M(e.clientX,e.clientY);if(t&&g){const e=(0,i.getSession)(g),o=(0,i.getContainingView)(g),r=(0,c.J0)(t,f(n)??v.refName);if((0,s.lO)(e)){const t=e.addWidget("BaseFeatureWidget","baseFeature",{featureData:r,view:o,track:(0,i.getContainingTrack)(g)});e.showWidget(t)}}else{const t=F(e.clientX)?.id();t&&g?.selectFeatureById(t).catch(e=>{console.error(e),(0,i.getSession)(g).notifyError(`${e}`,e)})}},onMouseLeave:()=>{$(!1),g?.setFeatureIdUnderMouse(void 0),g?.setMouseoverExtraInformation(void 0)},style:{overflow:"visible",position:"relative",height:p,cursor:m?"pointer":void 0},children:(0,d.jsx)(r.A,{...e})})})}}]);
//# sourceMappingURL=9533.3d4ec955.chunk.js.map