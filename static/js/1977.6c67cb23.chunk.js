"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1977],{21977(e,t,a){a.d(t,{default:()=>u});var s=a(90946),r=a(23886),n=a(27725),i=a(11931),o=a(25529),c=a(43102);const l=new Set(["DUP","TRA","INV","CNV","DEL"]);function h(e,t,a,s){const r=e.split("\t"),n=r[a?3:0],i=+r[a?4:1],o=+r[a?5:2],h=r[a?0:3],u=+r[a?1:4],f=+r[a?2:5],p=r[6],m=r[7]?+r[7]:void 0,b=d(r[8]),w=d(r[9]),g=r.slice(10),T=s?Object.fromEntries(s.slice(10).map((e,t)=>[e,g[t]])):{},v=l.has(g[0])?`<${g[0]}>`:void 0;return new c.A({...T,start:i,end:o,type:"paired_feature",refName:n,strand:b,name:p,score:m,uniqueId:t,mate:{refName:h,start:u,end:f,strand:w},...v?{ALT:[v]}:{}})}function d(e){return"+"===e?1:"-"===e?-1:"."===e?0:void 0}class u extends s.L{intervalTrees={};static capabilities=["getFeatures","getRefNames"];async loadDataP(e){const t=(await(0,r.fetchAndMaybeUnzipText)((0,i.openLocation)(this.getConf("bedpeLocation"),this.pluginManager),e)).split(/\n|\r\n|\r/).filter(e=>!!e),a=[];let s=0;for(;s<t.length&&t[s].startsWith("#");s++)a.push(t[s]);const n=a.join("\n"),o={},c={};for(;s<t.length;s++){const e=t[s],a=e.split("\t"),r=a[0],n=a[3];o[r]||(o[r]=[]),c[n]||(c[n]=[]),o[r].push(e),c[n].push(e)}return{header:n,feats1:o,feats2:c,columnNames:this.getConf("columnNames")}}async loadData(e={}){return this.bedpeFeatures||(this.bedpeFeatures=this.loadDataP(e).catch(e=>{throw this.bedpeFeatures=void 0,e})),this.bedpeFeatures}async getRefNames(e={}){const{feats1:t,feats2:a}=await this.loadData(e);return[...new Set([...Object.keys(t),...Object.keys(a)])]}async getHeader(e={}){const{header:t}=await this.loadData(e);return t}async getNames(){const{header:e,columnNames:t}=await this.loadData();if(t.length)return t;const a=e.split(/\n|\r\n|\r/).filter(e=>!!e).at(-1);return a?.includes("\t")?a.slice(1).split("\t").map(e=>e.trim()):void 0}async loadFeatureTreeP(e){const{feats1:t,feats2:a}=await this.loadData(),s=await this.getNames(),r=new n.M,i=t[e]?.map((t,a)=>h(t,`${this.id}-${e}-${a}-r1`,!1,s))??[],o=a[e]?.map((t,a)=>h(t,`${this.id}-${e}-${a}-r2`,!0,s))??[];for(const e of[...i,...o])r.insert([e.get("start"),e.get("end")],e);return r}async loadFeatureTree(e){return this.intervalTrees[e]||(this.intervalTrees[e]=this.loadFeatureTreeP(e).catch(t=>{throw this.intervalTrees[e]=void 0,t})),this.intervalTrees[e]}getFeatures(e,t={}){return(0,o.ObservableCreate)(async t=>{const{start:a,end:s,refName:r}=e,n=await this.loadFeatureTree(r);for(const e of n?.search([a,s])||[])t.next(e);t.complete()},t.stopToken)}}}}]);
//# sourceMappingURL=1977.6c67cb23.chunk.js.map