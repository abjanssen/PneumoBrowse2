"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6800],{86800(t,e,a){a.d(e,{default:()=>l});var s=a(90946),n=a(23886),i=a(25529),o=a(37362),r=a(11931);class c{constructor(t){this.filehandle=t}async read(t,e){const a=await this.filehandle.read(e,t);return a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}}function h(t,e){return new c((0,r.openLocation)(t,e))}class l extends s.L{constructor(t,e,a){super(t,e,a),this.hic=new o.A({file:h(this.getConf("hicLocation"),this.pluginManager)})}async setup(t){const{statusCallback:e=()=>{}}=t||{};return(0,n.updateStatus)("Downloading .hic header",e,()=>this.hic.getMetaData())}async getHeader(t){const{chromosomes:e,...a}=await this.setup(t),s=await this.hic.getNormalizationOptions();await this.hic.hicFile.init();const{masterIndex:n}=this.hic.hicFile;return{...a,norms:s,hasInterChromosomalData:Object.keys(n).some(t=>{const[e,a]=t.split("_");return e!==a})}}async getRefNames(t){return(await this.setup(t)).chromosomes.map(t=>t.name)}async getResolution(t,e){const{resolutions:a}=await this.setup(e),s=this.getConf("resolutionMultiplier");let n=a.at(-1);for(let e=a.length-1;e>=0;e-=1){const i=a[e];i<=2*t*s&&(n=i)}return n}getFeatures(t,e={}){return(0,i.ObservableCreate)(async a=>{const{refName:s,start:i,end:o}=t,{resolution:r,normalization:c="KR",bpPerPx:h=1,statusCallback:l=()=>{}}=e,u=await this.getResolution(h/(r||1e3),e);await(0,n.updateStatus)("Downloading .hic data",l,async()=>{const t=await this.hic.getContactRecords(c,{start:i,chr:s,end:o},{start:i,chr:s,end:o},"BP",u);for(const e of t)a.next(e)}),a.complete()},e.stopToken)}async getMultiRegionContactRecords(t,e={}){const{resolution:a,normalization:s="KR",bpPerPx:i=1,statusCallback:o=()=>{}}=e,r=await this.getResolution(i/(a||1e3),e),c=[];return await(0,n.updateStatus)("Downloading .hic data",o,async()=>{for(let e=0;e<t.length;e++)for(let a=e;a<t.length;a++){const n=t[e],i=t[a],o=await this.hic.getContactRecords(s,{chr:n.refName,start:n.start,end:n.end},{chr:i.refName,start:i.start,end:i.end},"BP",r);for(const{bin1:t,bin2:s,counts:n}of o)c.push({bin1:t,bin2:s,counts:n,region1Idx:e,region2Idx:a})}}),c}async getMultiRegionFeatureDensityStats(t){return{featureDensity:0}}}}}]);
//# sourceMappingURL=6800.5ed47f7e.chunk.js.map