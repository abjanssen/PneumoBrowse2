"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6651],{6651(e,t,i){i.d(t,{setupMultiVariantAutoruns:()=>f});var o=i(11259),n=i(99226),s=i(38567),r=i(50282),a=i(77251),l=i(53155),c=i(8201),u=i(52901),d=i(70203);function f(e){!function(e){(0,n.addDisposer)(e,(0,s.autorun)(async()=>{try{if(!(0,n.isAlive)(e)||e.isMinimized)return;if(!(0,a.getContainingView)(e).initialized)return;const{rpcManager:t}=(0,a.getSession)(e),{adapterConfig:i}=e,o=(0,u.y5)();e.setSourcesLoading(o);const s=(0,d.getRpcSessionId)(e),r=await t.call(s,"MultiVariantGetSources",{sessionId:s,adapterConfig:i,stopToken:o,statusCallback:t=>{(0,n.isAlive)(e)&&e.setStatusMessage(t)}});(0,n.isAlive)(e)&&e.setSources(r)}catch(t){!(0,c.Kp)(t)&&(0,n.isAlive)(e)&&(console.error(t),(0,a.getSession)(e).notifyError(`${t}`,t))}},{delay:1e3,name:"GetMultiVariantSources"}))}(e),function(e){(0,n.addDisposer)(e,(0,s.autorun)(async()=>{try{if(!(0,n.isAlive)(e)||e.isMinimized)return;const t=(0,a.getContainingView)(e);if(!t.initialized||!e.featureDensityStatsReadyAndRegionNotTooLarge)return;const i=(0,u.y5)();e.setSimplifiedFeaturesLoading(i);const{rpcManager:o}=(0,a.getSession)(e),{lengthCutoffFilter:s,sources:r,minorAlleleFrequencyFilter:c,adapterConfig:f}=e;if(r){const a=(0,d.getRpcSessionId)(e),{sampleInfo:u,hasPhased:g,features:p}=await o.call(a,"MultiVariantGetSimplifiedFeatures",{regions:t.dynamicBlocks.contentBlocks,sources:r,minorAlleleFrequencyFilter:c,lengthCutoffFilter:s,sessionId:a,adapterConfig:f,stopToken:i,statusCallback:t=>{(0,n.isAlive)(e)&&e.setStatusMessage(t)}});(0,n.isAlive)(e)&&(e.setHasPhased(g),e.setSampleInfo(u),e.setFeatures(p.map(e=>new l.A(e))))}}catch(t){console.error(t),!(0,c.Kp)(t)&&(0,n.isAlive)(e)&&(0,a.getSession)(e).notifyError(`${t}`,t)}},{delay:1e3,name:"MultiVariantFeatures"}))}(e),function(e){(0,n.addDisposer)(e,(0,s.autorun)(function(){if(!(0,n.isAlive)(e)||e.isMinimized)return;const{treeCanvas:t,hierarchy:i,treeAreaWidth:o,height:s,scrollTop:r,totalHeight:a}=e;if(!t||!i)return;const l=t.getContext("2d");if(l){l.resetTransform(),l.scale(2,2),l.clearRect(0,0,o,s),l.translate(0,-r),l.strokeStyle="#0008",l.lineWidth=1,l.beginPath();for(const e of i.links()){const{source:t,target:i}=e,o=t.x,n=i.x,s=i.y,r=t.y;l.moveTo(r,o),l.lineTo(r,n),l.moveTo(r,n),l.lineTo(s,n)}l.stroke()}},{name:"TreeDraw"})),(0,n.addDisposer)(e,(0,s.autorun)(function(){if(!(0,n.isAlive)(e)||e.isMinimized)return;const{mouseoverCanvas:t,hierarchy:i,rowHeight:o,hoveredTreeNode:s,height:r,scrollTop:l,sources:c,totalHeight:u}=e;if(!t)return;const d=t.getContext("2d");if(!d)return;const f=(0,a.getContainingView)(e).width;if(d.clearRect(0,0,f,r),i&&s&&c){d.save(),d.translate(0,-l),d.fillStyle="rgba(255,165,0,0.2)";const e=new Set(s.descendantNames);for(let t=0,i=c.length;t<i;t++){const i=c[t];if(e.has(i.name)){const e=(t+.5)*o;d.fillRect(0,e-o/2,f,o)}}const{node:t}=s;d.fillStyle="rgba(255,165,0,0.8)",d.beginPath(),d.arc(t.y,t.x,4,0,2*Math.PI),d.fill(),d.strokeStyle="rgba(255,140,0,1)",d.lineWidth=1,d.stroke(),d.restore()}},{name:"TreeHover"}))}(e),function(e){(0,n.addDisposer)(e,(0,s.autorun)(()=>{if(!(0,n.isAlive)(e))return;if(e.colorByApplied)return;const t=e.sourcesVolatile;if(!t||0===t.length)return;if(e.layout.length>0)return void e.setColorByApplied(!0);const i=(0,o.FI)(e,"colorBy");if(!i)return void e.setColorByApplied(!0);if(!t.some(e=>i in e))return console.warn(`colorBy attribute "${i}" not found in sample metadata. Available attributes: ${Object.keys(t[0]||{}).join(", ")}`),void e.setColorByApplied(!0);const s=(0,r.l)(t,i);e.setLayout(s,!1),e.setColorByApplied(!0)},{name:"ColorByAutorun"}))}(e)}},50282(e,t,i){i.d(t,{l:()=>s});var o=i(14157),n=i(86559);function s(e,t){if(!t||0===e.length)return e;if(!e.some(e=>t in e))return e;const i=new Map;for(const o of e){const e=String(o[t]??"");i.set(e,(i.get(e)||0)+1)}const s=Object.fromEntries([...i.entries()].sort((e,t)=>e[1]-t[1]).map(([e],t)=>[e,o.set1[t]||(0,n.randomColor)(e)]));return e.map(e=>({...e,color:s[String(e[t]??"")]}))}}}]);
//# sourceMappingURL=6651.d02b337d.chunk.js.map