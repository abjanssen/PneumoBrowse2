"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3859],{16802(t,e,n){n.d(e,{A:()=>s});var a=n(77251),i=n(96960);function r(t){const{POS:e,REF:n="",ALT:i=[]}=t,r=e-1;let s=!1,o=!1;for(const t of i)if(t.includes("<")&&(o=!0,"<TRA>"===t)){s=!0;break}if(o){const e=t.INFO;if(e.END&&!s)return+e.END[0];const n=[];if(e.SVLEN&&!s){const t=e.SVLEN;for(let e=0;e<t.length;e++){const a=t[e];i[e]?.startsWith("<INS")?n.push(1):n.push(Math.abs(+a))}return r+(0,a.max)(n)}}return r+n.length}class s{constructor(t){this.variant=t.variant,this.parser=t.parser,this.data=function(t,e){const{REF:n="",ALT:a,POS:s,CHROM:o,ID:c}=t,l=s-1,[u,h]=(0,i.M_)(n,a,e);return{refName:o,start:l,end:r(t),description:h,type:u,name:c?.join(",")}}(this.variant,this.parser),this._id=t.id}get(t){return"samples"===t?this.variant.SAMPLES():"genotypes"===t?this.variant.GENOTYPES():this.data[t]??this.variant[t]}parent(){}children(){}id(){return this._id}toJSON(){const{SAMPLES:t,GENOTYPES:e,...n}=this.variant;return{uniqueId:this._id,...n,...this.data,samples:this.variant.SAMPLES()}}}},63859(t,e,n){n.d(e,{default:()=>u});var a=n(9272),i=n(93750),r=n(48455),s=n(77251),o=n(33624),c=n(86618),l=n(16802);class u extends r.L{static capabilities=["getFeatures","getRefNames","exportData"];async configurePre(t){const e=this.getConf("vcfGzLocation"),n=this.getConf(["index","location"]),r=this.getConf(["index","indexType"]),s=(0,o.openLocation)(e,this.pluginManager),c="CSI"===r,l=new a.wD({filehandle:s,csiFilehandle:c?(0,o.openLocation)(n,this.pluginManager):void 0,tbiFilehandle:c?void 0:(0,o.openLocation)(n,this.pluginManager),chunkCacheSize:52428800});return{vcf:l,parser:new i.A({header:await l.getHeader()})}}async configurePre2(){return this.configured||(this.configured=this.configurePre().catch(t=>{throw this.configured=void 0,t})),this.configured}async configure(t){const{statusCallback:e=()=>{}}=t||{};return(0,s.updateStatus)("Downloading index",e,()=>this.configurePre2())}async getRefNames(t={}){const{vcf:e}=await this.configure(t);return e.getReferenceSequenceNames(t)}async getHeader(t){const{vcf:e}=await this.configure(t);return e.getHeader()}async getMetadata(t){const{parser:e}=await this.configure(t);return e.getMetadata()}async getExportData(t,e,n){if("vcf"!==e)return;const{statusCallback:a=()=>{}}=n||{},{vcf:i}=await this.configure(n),r=(await i.getHeader()).split("\n").filter(Boolean);for(const e of t){const{refName:t,start:o,end:c}=e,l=[];await(0,s.updateStatus)("Exporting variants",a,()=>i.getLines(t,o,c,{lineCallback:t=>{l.push(t)},...n}));for(const t of l)r.push(t)}return r.join("\n")}getFeatures(t,e={}){return(0,c.ObservableCreate)(async n=>{const{refName:a,start:i,end:r}=t,{statusCallback:o=()=>{}}=e,{vcf:c,parser:u}=await this.configure(e);await(0,s.updateStatus)("Downloading variants",o,()=>c.getLines(a,i,r,{lineCallback:(t,e)=>{n.next(new l.A({variant:u.parseLine(t),parser:u,id:`${this.id}-vcf-${e}`}))},...e})),n.complete()},e.stopToken)}async getSources(){const t=this.getConf("samplesTsvLocation");if(""===t.uri||"/path/to/samples.tsv"===t.uri){const{parser:t}=await this.configure();return t.samples.map(t=>({name:t}))}{const e=(await(0,s.fetchAndMaybeUnzipText)((0,o.openLocation)(t,this.pluginManager))).split(/\n|\r\n|\r/),n=e[0].split("\t"),{parser:a}=await this.configure(),i=e.slice(1).filter(Boolean).map(t=>{const[e,...a]=t.split("\t");return{...Object.fromEntries(n.slice(1).map((t,e)=>[t,a[e]||""])),name:e}}),r=new Set(a.samples),c=new Set(i.map(t=>t.name)),l=[...c].filter(t=>!r.has(t)),u=[...r].filter(t=>!c.has(t));return l.length&&console.warn(`There are ${l.length} samples in metadata file (${i.length} lines) not in VCF (${a.samples.length} samples):`,(0,s.shorten2)(l.join(","))),u.length&&console.warn(`There are ${u.length} samples in VCF file (${a.samples.length} samples) not in metadata file (${i.length} lines):`,(0,s.shorten2)(u.join(","))),i.filter(t=>r.has(t.name))}}}},96960(t,e,n){n.d(e,{Fm:()=>p,M_:()=>l,bC:()=>h});var a=n(93750),i=n(77251);const r=/[/|]/;function s(t){return t.includes("[")||t.includes("]")||t.startsWith(".")||t.endsWith(".")}function o(t){return t.startsWith("<")||s(t)}const c={"<DEL>":"deletion","<INS>":"insertion","<DUP>":"duplication","<INV>":"inversion","<INVDUP>":"inverted_duplication","<CNV>":"copy_number_variation","<TRA>":"translocation","<DUP:TANDEM>":"tandem_duplication","<NON_REF>":"sequence_variant","<*>":"sequence_variant"};function l(t,e,n){if(!e||0===e.length)return["remark","no alternative alleles"];const r=e.map(e=>function(t,e,n){if(t.startsWith("<"))return u(t,n)??"variant";if(s(t)&&(0,a.h)(t))return"breakend";const i=e.length,r=t.length;return 1===i&&1===r?"SNV":i===r?function(t,e){return t.split("").reverse().join("")===e}(e,t)?"inversion":"substitution":i<r?"insertion":"deletion"}(e,t,n)),c=[...new Set(r)],l=function(t,e){if(e.every(o))return e.join(",");const n=t.length;return`${t.length>10?(0,i.getBpDisplayStr)(n):t} -> ${e.map(t=>t.length>10?(0,i.getBpDisplayStr)(t.length):t).join(",")}`}(t,e);return[c.join(","),l]}function u(t,e){if(c[t])return c[t];if(e.getMetadata("ALT",t))return"sequence_variant";const n=t.slice(1,-1).split(":");return n.length>1?u(`<${n.slice(0,-1).join(":")}>`,e):void 0}function h(t,e){if(o(e)||1===t.length&&1===e.length)return e;const n=t.length,a=e.length;return n>5||a>5?`${(0,i.getBpDisplayStr)(n)} -> ${(0,i.getBpDisplayStr)(a)}`:`${t} -> ${e}`}function p(t,e,n){return t.split(r).map(t=>"."===t?".":0===+t?`ref(${e.length<10?e:(0,i.getBpDisplayStr)(e.length)})`:h(e,n[+t-1]||"")).join(t.includes("|")?"|":"/")}}}]);
//# sourceMappingURL=3859.9955ccbd.chunk.js.map