"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9865],{19865(t,e,s){s.d(e,{default:()=>i});var a=s(90946),n=s(23886),r=s(43102),o=s(25529),c=s(29458);class i extends a.L{gcMode="content";static capabilities=["hasLocalStats"];async configure(){const t=await(this.getSubAdapter?.(this.getConf("sequenceAdapter")));if(!t)throw new Error("Error getting subadapter");return t.dataAdapter}async getRefNames(t){return(await this.configure()).getRefNames(t)}async calculateGCContent(t,e){const{statusCallback:s=()=>{},stopToken:a}=e||{},r=await this.configure(),o=this.getConf("windowSize"),i=this.getConf("windowDelta"),l=1===o?1:Math.ceil(o/2),h=1===o,u=Math.max(0,Math.floor((t.start-l)/o)*o),g=Math.ceil((t.end+l)/o)*o;if(g<0||u>g)return{starts:[],ends:[],scores:[]};const f=await r.getSequence({...t,start:u,end:g},e)??"";return(0,n.updateStatus)("Calculating GC",s,()=>{const t=[],e=[],s=[];let n=0,r=0,o=0,g=performance.now();const d=l;for(let t=d-l;t<d+l;t++){const e=f[t];"c"===e||"C"===e?n++:"g"!==e&&"G"!==e||r++,"N"!==e&&o++}for(let d=l;d<f.length-l;d+=i){if(performance.now()-g>400&&((0,c.SW)(a),g=performance.now()),h){const t=f[d];n="c"===t||"C"===t?1:0,r="g"===t||"G"===t?1:0,o="N"!==t?1:0}else if(d>l){const t=d-i+l,e=d-l,s=d+l;for(let s=d-i-l;s<Math.min(t,e);s++)if(s>=0&&s<f.length){const t=f[s];"c"===t||"C"===t?n--:"g"!==t&&"G"!==t||r--,"N"!==t&&o--}for(let a=Math.max(t,e);a<s;a++)if(a>=0&&a<f.length){const t=f[a];"c"===t||"C"===t?n++:"g"!==t&&"G"!==t||r++,"N"!==t&&o++}}const w=u,p="content"===this.gcMode?(r+n)/(o||1):"skew"===this.gcMode?(r-n)/(r+n||1):0;t.push(w+d),e.push(w+d+i),s.push(p)}return{starts:t,ends:e,scores:s}})}getFeatures(t,e){return(0,o.ObservableCreate)(async s=>{const a=await this.calculateGCContent(t,e);for(let e=0;e<a.starts.length;e++)s.next(new r.A({uniqueId:`${this.id}_${a.starts[e]}`,refName:t.refName,start:a.starts[e],end:a.ends[e],score:a.scores[e]}));s.complete()})}}}}]);
//# sourceMappingURL=9865.63ee09e1.chunk.js.map