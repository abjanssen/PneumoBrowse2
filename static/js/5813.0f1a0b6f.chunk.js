"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5813],{2678(e,s,t){t.d(s,{J:()=>r,Z:()=>n});var o=t(8345);function a(e){try{return JSON.parse(e).message}catch(s){return e}}async function r(e,s,r){const n=await(0,o.eW)(JSON.stringify(e)),i=window.btoa([...window.crypto.getRandomValues(new Uint8Array(10))].map(e=>String.fromCharCode(e)).join("")).replaceAll(/[+/]/g,"").slice(0,5);const l=await(async(e,s)=>(await Promise.all([t.e(6716),t.e(6216),t.e(7167)]).then(t.t.bind(t,86216,23))).encrypt(e,s).toString())(n,i),c=new FormData;c.append("session",l),c.append("dateShared",`${Date.now()}`),c.append("referer",r);const d=await fetch(`${s}share`,{method:"POST",mode:"cors",body:c});if(!d.ok){const e=await d.text();throw new Error(a(e))}return{json:await d.json(),encryptedSession:l,password:i}}async function n(e,s,o){const r=s.split("share-")[1],n=`${e}?sessionId=${encodeURIComponent(r)}`,i=await fetch(n);if(!i.ok)throw new Error(a(await i.text()));return(async(e,s)=>{const o=await Promise.all([t.e(6716),t.e(6216),t.e(7167)]).then(t.t.bind(t,86216,23)),a=await Promise.all([t.e(6716),t.e(4721)]).then(t.t.bind(t,81335,23));return o.decrypt(e,s).toString(a)})((await i.json()).session,o)}},45813(e,s,t){t.r(s),t.d(s,{default:()=>j});var o=t(42918),a=t(85787),r=t(27351),n=t(77251),i=t(10525),l=t(65045),c=t(99226),d=t(2193),h=t(24215),w=t(52681),p=t(59199),m=t(1591),f=t(15675),k=t(11543),u=t(65525),b=t(64074),y=t(2678),x=t(32118);const g=(0,l.n)()(()=>({flexItem:{margin:5},content:{display:"flex",flexFlow:"column",gap:"5px"}})),j=(0,b.observer)(function({onClose:e,model:s}){const{classes:l}=g(),[b,j]=(0,o.useState)(""),[S,A]=(0,o.useState)(),[C,U]=(0,o.useState)(!0),R=(0,n.getSession)(s),{selectedBookmarks:v}=s,I=0===v.length,L=0===v.length?s.allBookmarksModel:s.sharedBookmarksModel;return(0,o.useEffect)(()=>{(async()=>{try{if(!(0,i.xv)(R))throw new Error("No shareURL configured");U(!0);const e=(0,c.getSnapshot)(L),s=new URL(window.location.href),t=await(0,y.J)(e,R.shareURL,s.href),o=new URLSearchParams(s.search);o.set("bookmarks",`share-${t.json.sessionId}`),o.set("password",t.password),s.search=o.toString(),j(s.href),U(!1)}catch(e){A(e)}finally{U(!1)}})()},[L,R]),(0,x.jsxs)(a.A,{open:!0,onClose:e,title:"Share bookmarks",children:[(0,x.jsxs)(h.A,{className:l.content,children:[(0,x.jsx)(w.A,{severity:"info",children:I?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{children:"All bookmarks will be shared."}),(0,x.jsx)("br",{}),(0,x.jsx)("span",{children:"Use the checkboxes to select individual bookmarks to share."})]}):"Only selected bookmarks will be shared."}),(0,x.jsx)(p.A,{children:"Copy the URL below to share your bookmarks."}),S?(0,x.jsx)(r.A,{error:S}):C?(0,x.jsx)(m.A,{children:"Generating short URL..."}):(0,x.jsx)(f.A,{label:"URL",value:b,slotProps:{input:{readOnly:!0}},variant:"filled",fullWidth:!0,onClick:e=>{e.target.select()}}),(0,x.jsx)(p.A,{children:'The URL should be pasted into the "Import from share link" field in the "Import" form found in the "Bookmarked regions" drawer.'})]}),(0,x.jsx)(k.A,{children:(0,x.jsx)(u.A,{className:l.flexItem,"data-testid":"dialogShare",variant:"contained",color:"primary",disabled:C,startIcon:(0,x.jsx)(d.A,{}),onClick:async()=>{const{default:s}=await t.e(8284).then(t.t.bind(t,88284,23));s(b),R.notify("Copied to clipboard","success"),e()},children:"Copy share link"})})]})})}}]);
//# sourceMappingURL=5813.0f1a0b6f.chunk.js.map