{"version":3,"file":"static/js/2276.c6143a20.chunk.js","mappings":"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","sources":["../../../plugins/alignments/src/shared/getUniqueTags.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/GroupByDialog.tsx"],"sourcesContent":["import { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nexport async function getUniqueTags({\n  self,\n  tag,\n  blocks,\n  opts,\n}: {\n  self: {\n    adapterConfig: AnyConfigurationModel\n    effectiveRpcDriverName?: string\n  }\n  tag: string\n  blocks: BlockSet\n  opts?: {\n    headers?: Record<string, string>\n    stopToken?: string\n    filters: string[]\n  }\n}) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig, effectiveRpcDriverName } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag,\n      sessionId,\n      rpcDriverName: effectiveRpcDriverName,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n","import { useEffect, useState } from 'react'\n\nimport { Dialog, ErrorMessage, LoadingEllipses } from '@jbrowse/core/ui'\nimport {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  useDebounce,\n} from '@jbrowse/core/util'\nimport { getSnapshot } from '@jbrowse/mobx-state-tree'\nimport {\n  Button,\n  DialogActions,\n  DialogContent,\n  MenuItem,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { getUniqueTags } from '../../shared/getUniqueTags.ts'\nimport { defaultFilterFlags, negFlags, posFlags } from '../../shared/util.ts'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { IAnyStateTreeNode } from '@jbrowse/mobx-state-tree'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst GroupByTagDialog = observer(function GroupByTagDialog(props: {\n  model: {\n    adapterConfig: AnyConfigurationModel\n    configuration: AnyConfigurationModel\n  } & IAnyStateTreeNode\n  handleClose: () => void\n}) {\n  const { model, handleClose } = props\n  const [tag, setGroupByTag] = useState('')\n  const [tagSet, setGroupByTagSet] = useState<string[]>()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<unknown>()\n\n  const validTag = /^[A-Za-z][A-Za-z0-9]$/.exec(tag)\n  const isInvalid = tag.length === 2 && !validTag\n  const debouncedTag = useDebounce(tag, 1000)\n  const [type, setType] = useState('')\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        if (!isInvalid) {\n          setError(undefined)\n          setLoading(true)\n          const vals = await getUniqueTags({\n            self: model,\n            tag: debouncedTag,\n            blocks: (getContainingView(model) as LinearGenomeViewModel)\n              .staticBlocks,\n          })\n          setGroupByTagSet(vals)\n        }\n      } catch (e) {\n        console.error(e)\n        setError(e)\n      } finally {\n        setLoading(false)\n      }\n    })()\n  }, [model, isInvalid, debouncedTag])\n  return (\n    <Dialog open onClose={handleClose} title=\"Group by\">\n      <DialogContent>\n        <Typography>\n          NOTE: this will create new session tracks with the \"filter by\" set to\n          the values chosen here rather than affecting the current track state\n        </Typography>\n        <TextField\n          fullWidth\n          value={type}\n          onChange={event => {\n            setType(event.target.value)\n          }}\n          label=\"Group by...\"\n          select\n        >\n          <MenuItem value=\"strand\">Strand</MenuItem>\n          <MenuItem value=\"tag\">Tag</MenuItem>\n        </TextField>\n        {type === 'tag' ? (\n          <>\n            <Typography color=\"textSecondary\">\n              Examples: HP for haplotype, RG for read group, etc.\n            </Typography>\n\n            <TextField\n              value={tag}\n              onChange={event => {\n                setGroupByTag(event.target.value)\n              }}\n              placeholder=\"Enter tag name\"\n              error={isInvalid}\n              helperText={isInvalid ? 'Not a valid tag' : ''}\n              autoComplete=\"off\"\n              data-testid=\"group-tag-name\"\n              slotProps={{\n                htmlInput: {\n                  maxLength: 2,\n                  'data-testid': 'group-tag-name-input',\n                },\n              }}\n            />\n            {error ? (\n              <ErrorMessage error={error} />\n            ) : loading ? (\n              <LoadingEllipses message=\"Loading unique tags\" />\n            ) : tagSet ? (\n              <div>\n                <div>Found unique {tag} values:</div>\n                <div>{tagSet.join(', ')}</div>\n              </div>\n            ) : null}\n          </>\n        ) : null}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          disabled={!tagSet}\n          autoFocus\n          onClick={() => {\n            const track = getContainingTrack(model)\n            const trackConf = structuredClone(getSnapshot(track.configuration))\n            const session = getSession(model)\n            const view = getContainingView(model) as LinearGenomeViewModel\n            if (type === 'tag') {\n              if (tagSet) {\n                const ret = [...tagSet, undefined] as (string | undefined)[]\n                for (const tagValue of ret) {\n                  const t1 = `${trackConf.trackId}-${tag}:${tagValue}-${Date.now()}-sessionTrack`\n                  // @ts-expect-error\n                  session.addTrackConf({\n                    ...trackConf,\n                    trackId: t1,\n                    name: `${trackConf.name} (${tag}:${tagValue})`,\n                    displays: [\n                      {\n                        displayId: `${t1}-LinearAlignmentsDisplay`,\n                        type: 'LinearAlignmentsDisplay',\n                        pileupDisplay: {\n                          displayId: `${t1}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n                          type: 'LinearPileupDisplay',\n                          filterBy: {\n                            ...defaultFilterFlags,\n                            tagFilter: {\n                              tag,\n                              value: tagValue,\n                            },\n                          },\n                        },\n                      },\n                    ],\n                  })\n                  view.showTrack(t1)\n                }\n              }\n            } else if (type === 'strand') {\n              const t1 = `${trackConf.trackId}-${tag}:(-)-${Date.now()}-sessionTrack`\n              const t2 = `${trackConf.trackId}-${tag}:(+)-${Date.now()}-sessionTrack`\n\n              // @ts-expect-error\n              session.addTrackConf({\n                ...trackConf,\n                trackId: t1,\n                name: `${trackConf.name} (-)`,\n                displays: [\n                  {\n                    displayId: `${t1}-LinearAlignmentsDisplay`,\n                    type: 'LinearAlignmentsDisplay',\n                    pileupDisplay: {\n                      displayId: `${t1}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n                      type: 'LinearPileupDisplay',\n                      filterBy: negFlags,\n                    },\n                  },\n                  {\n                    displayId: `${t1}-LinearSNPCoverageDisplay`,\n                    type: 'LinearSNPCoverageDisplay',\n                    filterBy: negFlags,\n                  },\n                ],\n              })\n              // @ts-expect-error\n              session.addTrackConf({\n                ...trackConf,\n                trackId: t2,\n                name: `${trackConf.name} (+)`,\n                displays: [\n                  {\n                    displayId: `${t2}-LinearAlignmentsDisplay`,\n                    type: 'LinearAlignmentsDisplay',\n                    pileupDisplay: {\n                      displayId: `${t2}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n                      type: 'LinearPileupDisplay',\n                      filterBy: posFlags,\n                    },\n                  },\n                  {\n                    displayId: `${t2}-LinearSNPCoverageDisplay`,\n                    type: 'LinearSNPCoverageDisplay',\n                    filterBy: posFlags,\n                  },\n                ],\n              })\n              view.showTrack(t1)\n              view.showTrack(t2)\n            }\n            handleClose()\n          }}\n        >\n          Submit\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={() => {\n            handleClose()\n          }}\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default GroupByTagDialog\n"],"names":["async","getUniqueTags","self","tag","blocks","opts","rpcManager","getSession","adapterConfig","effectiveRpcDriverName","sessionId","getRpcSessionId","call","rpcDriverName","regions","contentBlocks","observer","props","model","handleClose","setGroupByTag","useState","tagSet","setGroupByTagSet","loading","setLoading","error","setError","validTag","exec","isInvalid","length","debouncedTag","useDebounce","type","setType","useEffect","undefined","vals","getContainingView","staticBlocks","e","console","_jsxs","Dialog","open","onClose","title","children","DialogContent","_jsx","Typography","TextField","fullWidth","value","onChange","event","target","label","select","MenuItem","_Fragment","color","placeholder","helperText","autoComplete","slotProps","htmlInput","maxLength","ErrorMessage","LoadingEllipses","message","join","DialogActions","Button","variant","disabled","autoFocus","onClick","track","getContainingTrack","trackConf","structuredClone","getSnapshot","configuration","session","view","ret","tagValue","t1","trackId","Date","now","addTrackConf","name","displays","displayId","pileupDisplay","filterBy","defaultFilterFlags","tagFilter","showTrack","t2","negFlags","posFlags"],"ignoreList":[],"sourceRoot":""}