{"version":3,"file":"static/js/815.33d9ee02.chunk.js","mappings":"4MAWe,MAAMA,UACXC,EAAAA,QAQRC,WAAAA,CAAYC,GACV,OAAOC,EAAAA,EAAAA,kBAA0BC,UAC/B,MAGMC,SAHcC,EAAAA,EAAAA,GAClBC,MAAMN,YAAYC,GAAQM,MAAKC,EAAAA,EAAAA,QAEd,GACnBC,EAASC,KACP,IAAIC,EAAAA,EAAc,IACbP,EAAKQ,SACRC,SAAU,GAAGT,EAAKU,QAAQb,EAAOc,SAASd,EAAOe,MACjDA,IAAKf,EAAOe,IACZD,MAAOd,EAAOc,MACdE,IAAKb,EACFc,IAAI,OACJC,MACCC,KAAKC,IAAIpB,EAAOc,MAAQX,EAAKc,IAAI,SAAU,GAC3CE,KAAKC,IAAIpB,EAAOe,IAAMZ,EAAKc,IAAI,SAAU,OAKjDT,EAASa,YAEb,CAKA,gBAAMC,GACJ,MAAMC,EAAU,GAGhB,IAAK,MAAOC,EAASC,KAAaC,KAAKD,SAAU,CAC/C,IAAIE,EAGJ,IAAK,MAAMC,KAAWH,EAElBE,GACAA,EAAcZ,KAAOa,EAAQX,IAAI,UACjCU,EAAcb,OAASc,EAAQX,IAAI,OAEnCU,EAAcZ,IAAMa,EAAQX,IAAI,QAE5BU,GACFJ,EAAQM,KAAKF,GAEfA,EAAgB,CACdH,UACAV,MAAOc,EAAQX,IAAI,SACnBF,IAAKa,EAAQX,IAAI,SAInBU,GACFJ,EAAQM,KAAKF,EAEjB,CAEA,OAAOJ,CACT,E,8FClEK,SAASO,EAAaC,GAC3B,MAAMN,EAAW,IAAIO,IACrB,IAAK,MAAMC,KAASF,EAAO,CACzB,MAAMG,EAAI,IAAIxB,EAAAA,EAAcuB,GACtBT,EAAUU,EAAEjB,IAAI,WACtB,IAAIkB,EAASV,EAASR,IAAIO,GACrBW,IACHA,EAAS,GACTV,EAASW,IAAIZ,EAASW,IAGxBA,EAAON,KAAKK,EACd,CAGA,IAAK,MAAMG,KAAeZ,EAASa,SACjCD,EAAYE,KAAK,CAACC,EAAGC,IAAMD,EAAEvB,IAAI,SAAWwB,EAAExB,IAAI,UAGpD,OAAOQ,CACT,CAEe,MAAM3B,UAA0B4C,EAAAA,EAG7CC,WAAAA,CACEC,EACAC,EACAC,GAEAzC,MAAMuC,EAAMC,EAAeC,GAC3B,MAAMC,GAAQC,EAAAA,EAAAA,IAAeJ,EAAM,YACnClB,KAAKD,SAAWK,EAAaiB,EAC/B,CAEA,iBAAME,GACJ,MAAO,IAAIvB,KAAKD,SAASyB,OAC3B,CAEA,uBAAMC,GACJ,MAAO,IAAIzB,KAAKD,SAASa,UAAUc,IAAIC,IAAgB,CACrD7B,QAAS6B,EAAa,GAAIpC,IAAI,WAC9BqC,QAASD,EAAa,GAAIpC,IAAI,aAElC,CAEAlB,WAAAA,CAAYC,GACV,MAAM,QAAEwB,EAAO,MAAEV,EAAK,IAAEC,GAAQf,EAEhC,OAAOC,EAAAA,EAAAA,kBAA0BC,UAC/B,MAAMuB,EAAWC,KAAKD,SAASR,IAAIO,IAAY,GAC/C,IAAK,MAAMU,KAAKT,EACVS,EAAEjB,IAAI,OAASH,GAASoB,EAAEjB,IAAI,SAAWF,GAC3CP,EAASC,KAAKyB,GAGlB1B,EAASa,YAEb,E","sources":["../../../plugins/config/src/FromConfigSequenceAdapter/FromConfigSequenceAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigAdapter.ts"],"sourcesContent":["import { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport { firstValueFrom } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\nimport FromConfigAdapter from '../FromConfigAdapter/FromConfigAdapter.ts'\n\nimport type { RegionsAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport type { Feature } from '@jbrowse/core/util/simpleFeature'\nimport type { NoAssemblyRegion } from '@jbrowse/core/util/types'\n\nexport default class FromConfigSequenceAdapter\n  extends FromConfigAdapter\n  implements RegionsAdapter\n{\n  /**\n   * Fetch features for a certain region\n   * @param region - Region\n   * @returns Observable of Feature objects in the region\n   */\n  getFeatures(region: NoAssemblyRegion) {\n    return ObservableCreate<Feature>(async observer => {\n      const feats = await firstValueFrom(\n        super.getFeatures(region).pipe(toArray()),\n      )\n      const feat = feats[0]!\n      observer.next(\n        new SimpleFeature({\n          ...feat.toJSON(),\n          uniqueId: `${feat.id()}:${region.start}-${region.end}`,\n          end: region.end,\n          start: region.start,\n          seq: feat\n            .get('seq')\n            .slice(\n              Math.max(region.start - feat.get('start'), 0),\n              Math.max(region.end - feat.get('start'), 0),\n            ),\n        }),\n      )\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion:\n        | { start: number; end: number; refName: string }\n        | undefined\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) {\n            regions.push(currentRegion)\n          }\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) {\n        regions.push(currentRegion)\n      }\n    }\n\n    return regions\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the foreseeable future and can be purged\n   * from caches, etc\n   */\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature from '@jbrowse/core/util/simpleFeature'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport type {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport type { NoAssemblyRegion } from '@jbrowse/core/util/types'\n\nexport function makeFeatures(fdata: SimpleFeatureSerialized[]) {\n  const features = new Map<string, Feature[]>()\n  for (const entry of fdata) {\n    const f = new SimpleFeature(entry)\n    const refName = f.get('refName') as string\n    let bucket = features.get(refName)\n    if (!bucket) {\n      bucket = []\n      features.set(refName, bucket)\n    }\n\n    bucket.push(f)\n  }\n\n  // sort the features on each reference sequence by start coordinate\n  for (const refFeatures of features.values()) {\n    refFeatures.sort((a, b) => a.get('start') - b.get('start'))\n  }\n\n  return features\n}\n\nexport default class FromConfigAdapter extends BaseFeatureDataAdapter {\n  protected features: Map<string, Feature[]>\n\n  constructor(\n    conf: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(conf, getSubAdapter, pluginManager)\n    const feats = readConfObject(conf, 'features') as SimpleFeatureSerialized[]\n    this.features = makeFeatures(feats)\n  }\n\n  async getRefNames() {\n    return [...this.features.keys()]\n  }\n\n  async getRefNameAliases() {\n    return [...this.features.values()].map(featureArray => ({\n      refName: featureArray[0]!.get('refName'),\n      aliases: featureArray[0]!.get('aliases'),\n    }))\n  }\n\n  getFeatures(region: NoAssemblyRegion) {\n    const { refName, start, end } = region\n\n    return ObservableCreate<Feature>(async observer => {\n      const features = this.features.get(refName) || []\n      for (const f of features) {\n        if (f.get('end') > start && f.get('start') < end) {\n          observer.next(f)\n        }\n      }\n      observer.complete()\n    })\n  }\n}\n"],"names":["FromConfigSequenceAdapter","FromConfigAdapter","getFeatures","region","ObservableCreate","async","feat","firstValueFrom","super","pipe","toArray","observer","next","SimpleFeature","toJSON","uniqueId","id","start","end","seq","get","slice","Math","max","complete","getRegions","regions","refName","features","this","currentRegion","feature","push","makeFeatures","fdata","Map","entry","f","bucket","set","refFeatures","values","sort","a","b","BaseFeatureDataAdapter","constructor","conf","getSubAdapter","pluginManager","feats","readConfObject","getRefNames","keys","getRefNameAliases","map","featureArray","aliases"],"ignoreList":[],"sourceRoot":""}