{"version":3,"file":"static/js/2577.27c8af9d.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../plugins/alignments/src/LinearPileupDisplay/components/GroupByDialog.tsx","webpack://@jbrowse/web/../../plugins/alignments/src/shared/getUniqueTags.ts"],"sourcesContent":["import { useEffect, useState } from 'react'\n\nimport { Dialog, ErrorMessage, LoadingEllipses } from '@jbrowse/core/ui'\nimport {\n  type SessionWithAddTracks,\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  useDebounce,\n} from '@jbrowse/core/util'\nimport { getSnapshot, isStateTreeNode } from '@jbrowse/mobx-state-tree'\nimport {\n  Button,\n  DialogActions,\n  DialogContent,\n  MenuItem,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { getUniqueTags } from '../../shared/getUniqueTags.ts'\nimport { defaultFilterFlags, negFlags, posFlags } from '../../shared/util.ts'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { IAnyStateTreeNode } from '@jbrowse/mobx-state-tree'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst TAG_REGEX = /^[A-Za-z][A-Za-z0-9]$/\n\nfunction TagResults({ tag, tagSet }: { tag: string; tagSet: string[] }) {\n  if (tagSet.length === 0) {\n    return (\n      <Typography color=\"warning.main\">\n        No values found for tag {tag} in the current region\n      </Typography>\n    )\n  }\n  return (\n    <div>\n      <div>Found unique {tag} values:</div>\n      <div>{tagSet.join(', ')}</div>\n    </div>\n  )\n}\n\nfunction createTrackId(baseId: string, suffix: string) {\n  return `${baseId}-${suffix}-${Date.now()}-sessionTrack`\n}\n\nfunction createTagBasedTracks({\n  trackConf,\n  tag,\n  tagSet,\n  session,\n  view,\n}: {\n  trackConf: any\n  tag: string\n  tagSet: string[]\n  session: SessionWithAddTracks\n  view: LinearGenomeViewModel\n}) {\n  const values = [...tagSet, undefined] as (string | undefined)[]\n  for (const tagValue of values) {\n    const trackId = createTrackId(trackConf.trackId, `${tag}:${tagValue}`)\n    session.addTrackConf({\n      ...trackConf,\n      trackId,\n      name: `${trackConf.name} (${tag}:${tagValue})`,\n      displays: [\n        {\n          displayId: `${trackId}-LinearAlignmentsDisplay`,\n          type: 'LinearAlignmentsDisplay',\n          pileupDisplay: {\n            displayId: `${trackId}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n            type: 'LinearPileupDisplay',\n            filterBy: {\n              ...defaultFilterFlags,\n              tagFilter: {\n                tag,\n                value: tagValue,\n              },\n            },\n          },\n        },\n      ],\n    })\n    view.showTrack(trackId)\n  }\n}\n\nfunction createStrandBasedTracks({\n  trackConf,\n  session,\n  view,\n}: {\n  trackConf: any\n  session: SessionWithAddTracks\n  view: LinearGenomeViewModel\n}) {\n  const negTrackId = createTrackId(trackConf.trackId, 'strand:(-)')\n  const posTrackId = createTrackId(trackConf.trackId, 'strand:(+)')\n\n  session.addTrackConf({\n    ...trackConf,\n    trackId: negTrackId,\n    name: `${trackConf.name} (-)`,\n    displays: [\n      {\n        displayId: `${negTrackId}-LinearAlignmentsDisplay`,\n        type: 'LinearAlignmentsDisplay',\n        pileupDisplay: {\n          displayId: `${negTrackId}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n          type: 'LinearPileupDisplay',\n          filterBy: negFlags,\n        },\n      },\n      {\n        displayId: `${negTrackId}-LinearSNPCoverageDisplay`,\n        type: 'LinearSNPCoverageDisplay',\n        filterBy: negFlags,\n      },\n    ],\n  })\n  session.addTrackConf({\n    ...trackConf,\n    trackId: posTrackId,\n    name: `${trackConf.name} (+)`,\n    displays: [\n      {\n        displayId: `${posTrackId}-LinearAlignmentsDisplay`,\n        type: 'LinearAlignmentsDisplay',\n        pileupDisplay: {\n          displayId: `${posTrackId}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n          type: 'LinearPileupDisplay',\n          filterBy: posFlags,\n        },\n      },\n      {\n        displayId: `${posTrackId}-LinearSNPCoverageDisplay`,\n        type: 'LinearSNPCoverageDisplay',\n        filterBy: posFlags,\n      },\n    ],\n  })\n  view.showTrack(negTrackId)\n  view.showTrack(posTrackId)\n}\n\nconst GroupByTagDialog = observer(function GroupByTagDialog(props: {\n  model: {\n    adapterConfig: AnyConfigurationModel\n    configuration: AnyConfigurationModel\n  } & IAnyStateTreeNode\n  handleClose: () => void\n}) {\n  const { model, handleClose } = props\n  const [tag, setGroupByTag] = useState('')\n  const [tagSet, setGroupByTagSet] = useState<string[]>()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<unknown>()\n\n  const validTag = TAG_REGEX.exec(tag)\n  const isInvalid = tag.length === 2 && !validTag\n  const debouncedTag = useDebounce(tag, 1000)\n  const [type, setType] = useState('')\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      const isValidTag = TAG_REGEX.test(debouncedTag)\n      if (type === 'tag' && isValidTag) {\n        try {\n          setError(undefined)\n          setLoading(true)\n          const vals = await getUniqueTags({\n            self: model,\n            tag: debouncedTag,\n            blocks: (getContainingView(model) as LinearGenomeViewModel)\n              .staticBlocks,\n          })\n          setGroupByTagSet(vals)\n        } catch (e) {\n          console.error(e)\n          setError(e)\n        } finally {\n          setLoading(false)\n        }\n      }\n    })()\n  }, [model, type, debouncedTag])\n\n  useEffect(() => {\n    if (type !== 'tag') {\n      setGroupByTagSet(undefined)\n      setError(undefined)\n      setLoading(false)\n    }\n  }, [type])\n\n  return (\n    <Dialog open onClose={handleClose} title=\"Group by\">\n      <DialogContent>\n        <Typography>\n          NOTE: this will create new session tracks with the \"filter by\" set to\n          the values chosen here rather than affecting the current track state\n        </Typography>\n        <TextField\n          fullWidth\n          value={type}\n          onChange={event => {\n            setType(event.target.value)\n          }}\n          label=\"Group by...\"\n          select\n        >\n          <MenuItem value=\"strand\">Strand</MenuItem>\n          <MenuItem value=\"tag\">Tag</MenuItem>\n        </TextField>\n        {type === 'tag' ? (\n          <>\n            <Typography color=\"textSecondary\">\n              Examples: HP for haplotype, RG for read group, etc.\n            </Typography>\n\n            <TextField\n              value={tag}\n              onChange={event => {\n                setGroupByTag(event.target.value)\n              }}\n              placeholder=\"Enter tag name\"\n              error={isInvalid}\n              helperText={isInvalid ? 'Not a valid tag' : ''}\n              autoComplete=\"off\"\n              data-testid=\"group-tag-name\"\n              slotProps={{\n                htmlInput: {\n                  maxLength: 2,\n                  'data-testid': 'group-tag-name-input',\n                },\n              }}\n            />\n            {error ? (\n              <ErrorMessage error={error} />\n            ) : loading ? (\n              <LoadingEllipses message=\"Loading unique tags\" />\n            ) : tagSet ? (\n              <TagResults tag={tag} tagSet={tagSet} />\n            ) : null}\n          </>\n        ) : null}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          disabled={\n            !type ||\n            loading ||\n            (type === 'tag' && (!tagSet || tagSet.length === 0))\n          }\n          autoFocus\n          onClick={() => {\n            const track = getContainingTrack(model)\n            const trackConf = isStateTreeNode(track.configuration)\n              ? structuredClone(getSnapshot(track.configuration))\n              : track.configuration\n            const session = getSession(model) as SessionWithAddTracks\n            const view = getContainingView(model) as LinearGenomeViewModel\n\n            if (type === 'tag' && tagSet) {\n              createTagBasedTracks({\n                trackConf,\n                tag,\n                tagSet,\n                session,\n                view,\n              })\n            } else if (type === 'strand') {\n              createStrandBasedTracks({\n                trackConf,\n                session,\n                view,\n              })\n            }\n\n            handleClose()\n          }}\n        >\n          Submit\n        </Button>\n        <Button variant=\"contained\" color=\"secondary\" onClick={handleClose}>\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default GroupByTagDialog\n","import { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nexport async function getUniqueTags({\n  self,\n  tag,\n  blocks,\n  opts,\n}: {\n  self: {\n    adapterConfig: AnyConfigurationModel\n    effectiveRpcDriverName?: string\n  }\n  tag: string\n  blocks: BlockSet\n  opts?: {\n    headers?: Record<string, string>\n    stopToken?: string\n    filters: string[]\n  }\n}) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig, effectiveRpcDriverName } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag,\n      sessionId,\n      rpcDriverName: effectiveRpcDriverName,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n"],"names":["TAG_REGEX","TagResults","t0","$","_c","tag","tagSet","length","t1","_jsxs","Typography","color","children","t2","t3","t4","join","_jsx","createTrackId","baseId","suffix","Date","now","observer","props","model","handleClose","setGroupByTag","useState","setGroupByTagSet","loading","setLoading","error","setError","validTag","exec","isInvalid","debouncedTag","useDebounce","type","setType","useEffect","isValidTag","test","undefined","vals","getUniqueTags","self","blocks","getContainingView","staticBlocks","e","console","Dialog","open","onClose","title","DialogContent","TextField","fullWidth","value","onChange","event","target","label","select","MenuItem","_Fragment","placeholder","helperText","autoComplete","slotProps","htmlInput","maxLength","ErrorMessage","LoadingEllipses","message","DialogActions","Button","variant","disabled","autoFocus","onClick","track","getContainingTrack","trackConf","isStateTreeNode","configuration","structuredClone","getSnapshot","session","getSession","view","values","tagValue","trackId","addTrackConf","name","displays","displayId","pileupDisplay","filterBy","defaultFilterFlags","tagFilter","showTrack","createTagBasedTracks","negTrackId","posTrackId","negFlags","posFlags","createStrandBasedTracks","async","opts","rpcManager","adapterConfig","effectiveRpcDriverName","sessionId","getRpcSessionId","call","rpcDriverName","regions","contentBlocks"],"sourceRoot":""}