"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[555],{28933(t,e,s){s.d(e,{h:()=>o});var n=s(13469);function o(t,e){let s=0,o=0,i=0;const l=[];for(let r=0,c=t.length,a=e.length;r<c&&i<a;r++){const c=t[r],f=c>>4,h=15&c;if(h===n.hN||h===n.hE){for(let t=0;t<f&&i<a;t++)e[i]===s+t&&i++;s+=f}else if(h===n.aT||h===n.a2)o+=f;else if(h===n.hK||h===n.oE||h===n.C4){for(let t=0;t<f&&i<a;t++)e[i]===s+t&&(l.push({ref:o+t,idx:i}),i++);s+=f,o+=f}}return l}},11605(t,e,s){s.d(e,{Z:()=>i});var n=s(23886),o=s(2165);function i(t,e,s){const i=-1===s?(0,n.revcom)(e):e,l=i.length,r=t.split(";"),c=[];for(const t of r){if(""===t)continue;const e=t.split(","),n=e[0],r=o.k.exec(n);if(!r)throw new Error(`bad format for MM tag: "${t}"`);const[,a,f,h]=r,p=h.split(/(\d+|.)/);for(const t of p){if(""===t)continue;const n=e.length;let o=0;const r=-1===s?new Array(n-1):[];let h=-1===s?n-2:0;for(let t=1;t<n;t++){let n=+e[t];do{"N"!==a&&a!==i[o]||n--,o++}while(n>=0&&o<l);if(-1===s){const t=l-o;t>=0&&(r[h--]=t)}else r[h++]=o-1}const p=-1===s?r.slice(h+1):r;c.push({type:t,base:a,strand:f,positions:p})}}return c}},26570(t,e,s){s.d(e,{Y:()=>o});var n=s(52301);function o(t){const e=(0,n.c$)(t,"ML","Ml")||[];if(e){const t=[];if("string"==typeof e){const s=e.split(",");for(let e=0,n=s.length;e<n;e++)t.push(+s[e]/255)}else for(let s=0,n=e.length;s<n;s++)t.push(e[s]/255);return t}{const e=(0,n.c$)(t,"MP","Mp");if(e){const t=[];for(let s=0,n=e.length;s<n;s++){const n=e.charCodeAt(s)-33;t.push(Math.min(1,n/50))}return t}return}}},13469(t,e,s){s.d(e,{A_:()=>u,C4:()=>f,El:()=>g,Tr:()=>p,a2:()=>r,aT:()=>l,hE:()=>i,hK:()=>o,hN:()=>c,oE:()=>h,og:()=>a,q7:()=>d,sO:()=>m,tQ:()=>y});var n=s(153);const o=0,i=1,l=2,r=3,c=4,a=5,f=7,h=8,p=129,d=389,u="=ACMGRSVTWYHKDBN",g=new Uint8Array([61,97,99,109,103,114,115,118,116,119,121,104,107,100,98,110]),m=Array.from({length:128},(t,e)=>String.fromCharCode(e));function y(t){return"string"==typeof t?(0,n.YJ)(t):t||[]}},63572(t,e,s){s.d(e,{Y:()=>h});var n=s(53121),o=s(63692),i=s(23886);const l=new Map,r=new Map;function c(t,e){const s=10===e?l:r;if(t>=0&&t<100){let n=s.get(t);return void 0===n&&(n=(0,i.measureText)(String(t),e),s.set(t,n)),n}return(0,i.measureText)(String(t),e)}const a=new Map;function f(t,e){const s=`${t},${e}`,o=a.get(s);if(o)return o;const i=e>=0?(0,n.M)(t).alpha(Math.min(1,e/50)).toHslString():t;return a.set(s,i),i}function h({ctx:t,feat:e,bpPerPx:s,regions:n,minSubfeatureWidth:i,largeInsertionIndicatorScale:l,mismatchAlpha:r,charWidth:a,charHeight:h,colorMap:p,colorContrastMap:d,hideSmallIndels:u,hideMismatches:g,hideLargeIndels:m,canvasWidth:y,drawSNPsMuted:b,checkRef:M,drawIndels:S=!0}){const x=[],w=[],{heightPx:T,topPx:v,feature:R}=e,$=v+T,P=R.get("start"),k=M?n.find(t=>{const e=R.get("refName"),s=R.get("end");return t.refName===e&&t.start<=P&&s<=t.end})??n[0]:n[0],C=1/s,E=Math.min(C,2),N=T>=h-2,A=!0===r,I=k.start,Y=k.end,q=k.reversed,_=q?C+1:-1,j=[];let D=0,H=0,W=0,B=0,K=Number.NEGATIVE_INFINITY;const Z=(e,s,n,l,r,h,M)=>{const R=P+s,k=R+n;if(1<<e&o.xi)return void(R>=I&&R<Y&&j.push({type:e,start:s,base:l,cliplen:M}));if(k<=I||R>=Y)return;const E=q?(Y-k)*C:(R-I)*C,_=q?(Y-R)*C:(k-I)*C;if(_<0||E>y)return;const Z=Math.max(i,_-E);if(e===o.oq){if(!g){if(_-E>=.2&&(x.push({type:"mismatch",base:l,start:R}),w.push(E,v,_,$)),!b){const e=p[l]||"#888",s=A&&r?f(e,r):e,n=Math.round(E),o=Z;n===K?H++:n+o>0&&n<y&&(t.fillStyle=s,t.fillRect(n,v,o,T),D++,K=n)}if(Z>=a&&N){const e=b?"black":d[l]||"black",s=A&&r?f(e,r):e,n=E+(Z-a)/2+1;n>0&&n<y&&s&&(t.fillStyle=s,t.fillText(l,n,$))}}}else if(e===o.YX&&S){if(!(n<10&&u||n>=10&&m)){const e=Math.abs(E-_);e>=.3&&E+e>0&&E<y?(t.fillStyle=p.deletion,t.fillRect(E,v,e,T),W++,x.push({type:"deletion",length:n,start:R}),w.push(E,v,_,$)):e<.3&&B++;const s=String(n),o=c(n,10);if(Z>=o&&N){const e=(E+_)/2-o/2;e>0&&e<y&&(t.fillStyle=d.deletion,t.fillText(s,e,$))}}}else if(e===o.D){const e=Math.max(Z,1.5);E+e>0&&E<y&&(t.fillStyle=p.skip,t.fillRect(E,v+T/2-1,e,1))}};if("forEachMismatch"in R)R.forEachMismatch(Z);else{const t=R.get("mismatches");if(t)for(let e=0,s=t.length;e<s;e++){const s=t[e];let n,i;"mismatch"===s.type?n=s.base:"insertion"===s.type?(n=s.insertedBases??"",i=s.insertlen):"softclip"===s.type||"hardclip"===s.type?(n="",i=s.cliplen):n="",Z(o.iz[s.type],s.start,s.length,n,"mismatch"===s.type?s.qual:void 0,"mismatch"===s.type&&s.altbase?.charCodeAt(0),i)}}for(const e of j){const{type:n,start:r,base:f,cliplen:g}=e,b=P+r,M=q?(Y-b-1)*C:(b-I)*C,R=M+_;if(!(R<-20||R>y+20))if(n===o.jm&&S){const e=g,n=Math.max(0,Math.min(1.2,C));if(e<10){if(!u){const o=p.insertion;if(R+n>0&&R<y&&(t.fillStyle=o,t.fillRect(R,v,n,T)),C>=a&&N){const s=Math.round(R-n),o=3*n;s+o>0&&s<y&&(t.fillRect(s,v,o,1),t.fillRect(s,$-1,o,1));const i=R+3;i>0&&i<y&&t.fillText(`(${e})`,i,$)}s<3&&(x.push({type:"insertion",length:e,...f?{sequence:f}:{},start:b}),w.push(M-2,v,M+n+2,$))}}else if(!m){x.push({type:"insertion",length:e,...f?{sequence:f}:{},start:b});const n=`${e}`;if(s>l){w.push(M-1,v,M+1,$);const e=M-1,s=2;e+s>0&&e<y&&(t.fillStyle=p.insertion,t.fillRect(e,v,s,T))}else if(T>h){const s=c(e),o=5;w.push(M-s/2-o,v,M+s/2+o,$);const i=M-s/2-o,l=s+2*o;i+l>0&&i<y&&(t.fillStyle=p.insertion,t.fillRect(i,v,l,T));const r=M-s/2;r>0&&r<y&&(t.fillStyle=d.insertion,t.fillText(n,r,$))}else{const e=2;w.push(M-e,v,M+e,$);const s=M-e,n=2*e;s+n>0&&s<y&&(t.fillStyle=p.insertion,t.fillRect(s,v,n,T))}}}else if((n===o.eC||n===o.bU)&&!m){const e=n===o.eC?"softclip":"hardclip",s=p[e],l=Math.max(i,E);if(R+l>0&&R<y&&(t.fillStyle=s,t.fillRect(R,v,l,T)),x.push({type:e,length:g,start:b}),w.push(R-l,v,R+2*l,$),C>=a&&N){const e=R-l,n=3*l;e+n>0&&e<y&&(t.fillStyle=s,t.fillRect(e,v,n,1),t.fillRect(e,$-1,n,1));const o=R+3;o>0&&o<y&&(t.fillStyle=s,t.fillText(`(${f})`,o,$))}}}return{coords:w,items:x,stats:{mismatchDrawn:D,mismatchSkipped:H,deletionDrawn:W,deletionSkipped:B}}}},80658(t,e,s){s.d(e,{k:()=>p});var n=s(53121),o=s(28933),i=s(11605),l=s(26570),r=s(98682),c=s(11231),a=s(89579),f=s(52301);const h=(0,n.M)("blue");function p({ctx:t,feat:e,region:s,bpPerPx:n,renderArgs:p,cigarOps:d}){const u=[],g=[],{feature:m,topPx:y,heightPx:b}=e,{colorBy:M,visibleModifications:S={}}=p,x=m.get("seq");if(!x)return{coords:g,items:u};const w=m.get("start"),T=(0,a.hn)(m,w),v=M?.modifications?.isolatedModification,R=M?.modifications?.twoColor,$=(M?.modifications?.threshold??10)/100,P=y+b,k=m.get("strand"),C=(0,f.c$)(m,"MM","Mm")||"",E=(0,i.Z)(C,x,k),N=(0,l.Y)(m),A=new Map;let I=0;for(const{type:t,base:e,strand:s,positions:n}of E){for(const{ref:i,idx:l}of(0,o.h)(d,n)){const o=N?.[I+(-1===k?n.length-1-l:l)]||0;A.has(i)||A.set(i,[]),A.get(i).push({type:t,base:e,strand:s,prob:o})}I+=n.length}const Y=s.start,q=s.end,_=s.reversed,j=1/n;return(0,r.r)(m,d)?.forEach(({allProbs:e,prob:s,type:n},o)=>{const i=w+o;if(i<Y||i>=q)return;const l=S[n];if(!l||v&&l.type!==v)return;if(s<$)return;const r=_?(q-i-1)*j:(i-Y)*j,f=_?(q-i)*j:(i+1-Y)*j,p=f-r+.5,d=l.color||"black";let m=0,M=0;for(let t=0,s=e.length;t<s;t++){const s=e[t];m+=s,s>M&&(M=s)}const x=1-m;t.fillStyle=R&&x>M?h.alpha(x).toHslString():(0,a.yr)(d,s),t.fillRect(r,y,p,b);const k=A.get(o);if(f-r>=.2&&k){const t=T.get(i);u.push({type:"modification",info:k.map(t=>`${t.base}${t.strand}${t.type} ${(0,c.y)(t.type)} (${(100*t.prob).toFixed(1)}%)`).join("\n"),modType:n,probability:s,start:i,mismatch:t}),g.push(r,y,f,P)}o++}),{coords:g,items:u}}},98682(t,e,s){s.d(e,{r:()=>r});var n=s(28933),o=s(11605),i=s(26570),l=s(52301);function r(t,e){const s=t.get("strand"),r=t.get("seq"),c=(0,l.c$)(t,"MM","Mm")||"";if(r){const l=(0,o.Z)(c,r,s),a=(0,i.Y)(t),f=[];let h=0;for(const{type:t,positions:o}of l){for(const{ref:i,idx:l}of(0,n.h)(e,o)){const e=a?.[h+(-1===s?o.length-1-l:l)]||0;if(f[i]){const s=f[i];f[i]={allProbs:[...s.allProbs,e],prob:Math.max(s.prob,e),type:s.prob>e?s.type:t}}else f[i]={type:t,prob:e,allProbs:[e]}}h+=o.length}return f}}}}]);
//# sourceMappingURL=555.42849243.chunk.js.map