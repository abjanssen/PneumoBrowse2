"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8939],{1832(t,e,n){n.d(e,{P:()=>r});var a=n(23886);function r(t,e,n=()=>{}){const r=new TextDecoder("utf8");let s=0,i=0;for(;s<t.length;){const o=t.indexOf(10,s),c=-1===o?t.length:o,u=t.subarray(s,c),l=r.decode(u).trim();if(l&&!1===e(l,i))break;i++%1e4==0&&n(`Loading ${(0,a.getProgressDisplayStr)(s,t.length)}`),s=c+1}}},88939(t,e,n){n.d(e,{default:()=>p});var a=n(20208),r=n(90946),s=n(23886),i=n(27725),o=n(11931),c=n(25529),u=n(1832),l=n(77989);class p extends r.L{calculatedIntervalTreeMap={};static capabilities=["getFeatures","getRefNames","exportData"];async getHeader(){const{header:t}=await this.setup();return t}async getMetadata(){const{parser:t}=await this.setup();return t.getMetadata()}async setupP(t){const{statusCallback:e=()=>{}}=t||{},n=(0,o.openLocation)(this.getConf("vcfLocation"),this.pluginManager),r=await(0,s.fetchAndMaybeUnzip)(n,t),{header:c,featureMap:p}=function(t,e=()=>{}){const n=[],a={};return(0,u.P)(t,t=>{if(t.startsWith("#"))n.push(t);else{const e=t.indexOf("\t"),n=t.slice(0,e);a[n]||(a[n]=[]),a[n].push(t)}return!0},e),{header:n.join("\n"),featureMap:a}}(r,e),h=new a.Ay({header:c}),f=Object.fromEntries(Object.entries(p).map(([t,e])=>[t,n=>{if(!this.calculatedIntervalTreeMap[t]){n?.("Parsing VCF data");let a=0;const r=new i.M;for(const n of e){const e=new l.A({variant:h.parseLine(n),parser:h,id:`${this.id}-${t}-${a++}`});r.insert([e.get("start"),e.get("end")],e)}this.calculatedIntervalTreeMap[t]=r}return this.calculatedIntervalTreeMap[t]}]));return{header:c,parser:h,intervalTreeMap:f,featureMap:p}}async setup(){return this.vcfFeatures||(this.vcfFeatures=this.setupP().catch(t=>{throw this.vcfFeatures=void 0,t})),this.vcfFeatures}async getRefNames(t={}){const{intervalTreeMap:e}=await this.setup();return Object.keys(e)}getFeatures(t,e={}){return(0,c.ObservableCreate)(async n=>{const{start:a,end:r,refName:s}=t,{intervalTreeMap:i}=await this.setup();for(const t of i[s]?.(e.statusCallback).search([a,r])||[])n.next(t);n.complete()},e.stopToken)}async getExportData(t,e,n){if("vcf"!==e)return;const{header:a,featureMap:r}=await this.setup(),s=[a];for(const e of t){const{refName:t,start:n,end:a}=e,i=r[t]||[];for(const t of i){const e=t.split("\t"),r=parseInt(e[1],10);r-1>=n&&r-1<a&&s.push(t)}}return s.join("\n")}async getSources(){const t=this.getConf("samplesTsvLocation");if(""===t.uri||"/path/to/samples.tsv"===t.uri){const{parser:t}=await this.setup();return t.samples.map(t=>({name:t}))}{const e=(await(0,o.openLocation)(t).readFile("utf8")).split(/\n|\r\n|\r/),n=e[0].split("\t"),{parser:a}=await this.setup(),r=new Set(a.samples);return e.slice(1).filter(Boolean).map(t=>{const e=t.split("\t");return{name:e[0],...Object.fromEntries(e.slice(1).map((t,e)=>[n[e+1],t]))}}).filter(t=>r.has(t.name))}}}},77989(t,e,n){n.d(e,{A:()=>i});var a=n(23886),r=n(17253);function s(t){const{POS:e,REF:n="",ALT:r=[]}=t,s=e-1;let i=!1,o=!1;for(const t of r)if(t.includes("<")&&(o=!0,"<TRA>"===t)){i=!0;break}if(o){const e=t.INFO;if(e.END&&!i)return+e.END[0];const n=[];if(e.SVLEN&&!i){const t=e.SVLEN;for(let e=0;e<t.length;e++){const a=t[e];r[e]?.startsWith("<INS")?n.push(1):n.push(Math.abs(+a))}return s+(0,a.max)(n)}}return s+n.length}class i{constructor(t){this.variant=t.variant,this.parser=t.parser,this.data=function(t,e){const{REF:n="",ALT:a,POS:i,CHROM:o,ID:c}=t,u=i-1,[l,p]=(0,r.M_)(n,a,e);return{refName:o,start:u,end:s(t),description:p,type:l,name:c?.join(",")}}(this.variant,this.parser),this._id=t.id}get(t){return"samples"===t?this.variant.SAMPLES():"genotypes"===t?this.variant.GENOTYPES():this.data[t]??this.variant[t]}parent(){}children(){}id(){return this._id}processGenotypes(t){this.variant.processGenotypes(t)}toJSON(){return{uniqueId:this._id,...this.variant.toJSON(),...this.data,samples:this.variant.SAMPLES()}}}},17253(t,e,n){n.d(e,{Fm:()=>h,M_:()=>u,bC:()=>p});var a=n(20208),r=n(23886);const s=/[/|]/;function i(t){return t.includes("[")||t.includes("]")||t.startsWith(".")||t.endsWith(".")}function o(t){return t.startsWith("<")||i(t)}const c={"<DEL>":"deletion","<INS>":"insertion","<DUP>":"duplication","<INV>":"inversion","<INVDUP>":"inverted_duplication","<CNV>":"copy_number_variation","<TRA>":"translocation","<DUP:TANDEM>":"tandem_duplication","<NON_REF>":"sequence_variant","<*>":"sequence_variant"};function u(t,e,n){if(!e||0===e.length)return["remark","no alternative alleles"];const s=e.map(e=>function(t,e,n){if(t.startsWith("<"))return l(t,n)??"variant";if(i(t)&&(0,a.An)(t))return"breakend";const r=e.length,s=t.length;return 1===r&&1===s?"SNV":r===s?function(t,e){return t.split("").reverse().join("")===e}(e,t)?"inversion":"substitution":r<s?"insertion":"deletion"}(e,t,n)),c=[...new Set(s)],u=function(t,e){if(e.every(o))return e.join(",");const n=t.length;return`${t.length>10?(0,r.getBpDisplayStr)(n):t} -> ${e.map(t=>t.length>10?(0,r.getBpDisplayStr)(t.length):t).join(",")}`}(t,e);return[c.join(","),u]}function l(t,e){if(c[t])return c[t];if(e.getMetadata("ALT",t))return"sequence_variant";const n=t.slice(1,-1).split(":");return n.length>1?l(`<${n.slice(0,-1).join(":")}>`,e):void 0}function p(t,e){if(o(e)||1===t.length&&1===e.length)return e;const n=t.length,a=e.length;return n>5||a>5?`${(0,r.getBpDisplayStr)(n)} -> ${(0,r.getBpDisplayStr)(a)}`:`${t} -> ${e}`}function h(t,e,n){return t.split(s).map(t=>"."===t?".":0===+t?`ref(${e.length<10?e:(0,r.getBpDisplayStr)(e.length)})`:p(e,n[+t-1]||"")).join(t.includes("|")?"|":"/")}}}]);
//# sourceMappingURL=8939.4420df9a.chunk.js.map