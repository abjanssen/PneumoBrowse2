"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6667],{869(e,t,o){o.d(t,{A:()=>h});var n=o(42918),s=o(77710),r=o(61648),a=o(96887),i=o(93597),l=o(51484),c=o(21583),d=o(76830),u=o(30764),p=o(32118);const h=n.forwardRef(function(e,t){const{actions:o,children:h,className:m,defaultValue:v,name:f,onChange:A,value:g,...x}=e,y=n.useRef(null),j=(e=>{const{classes:t,row:o,error:n}=e,s={root:["root",o&&"row",n&&"error"]};return(0,r.A)(s,i.B,t)})(e),[C,b]=(0,c.A)({controlled:g,default:v,name:"RadioGroup"});n.useImperativeHandle(o,()=>({focus:()=>{let e=y.current.querySelector("input:not(:disabled):checked");e||(e=y.current.querySelector("input:not(:disabled)")),e&&e.focus()}}),[]);const w=(0,l.A)(t,y),S=(0,u.A)(f),k=n.useMemo(()=>({name:S,onChange(e){b(e.target.value),A&&A(e,e.target.value)},value:C}),[S,A,b,C]);return(0,p.jsx)(d.A.Provider,{value:k,children:(0,p.jsx)(a.A,{role:"radiogroup",ref:w,className:(0,s.A)(j.root,m),...x,children:h})})})},54690(e,t,o){o.d(t,{A:()=>F});var n=o(42918),s=o(77710),r=o(61648),a=o(69364),i=o(2425),l=o(32118);const c=(0,i.A)((0,l.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),d=(0,i.A)((0,l.jsx)("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked");var u=o(63154),p=o(18496),h=o(55030);const m=(0,p.Ay)("span",{name:"MuiRadioButtonIcon",shouldForwardProp:u.A})({position:"relative",display:"flex"}),v=(0,p.Ay)(c,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),f=(0,p.Ay)(d,{name:"MuiRadioButtonIcon"})((0,h.A)(({theme:e})=>({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}}]}))),A=function(e){const{checked:t=!1,classes:o={},fontSize:n}=e,s={...e,checked:t};return(0,l.jsxs)(m,{className:o.root,ownerState:s,children:[(0,l.jsx)(v,{fontSize:n,className:o.background,ownerState:s}),(0,l.jsx)(f,{fontSize:n,className:o.dot,ownerState:s})]})};var g=o(42458),x=o(31286),y=o(19116),j=o(59922),C=o(67728),b=o(77180),w=o(84961),S=o(27997);const k=(0,p.Ay)(a.A,{shouldForwardProp:e=>(0,u.A)(e)||"classes"===e,name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,"medium"!==o.size&&t[`size${(0,g.A)(o.size)}`],t[`color${(0,g.A)(o.color)}`]]}})((0,h.A)(({theme:e})=>({color:(e.vars||e).palette.text.secondary,[`&.${C.A.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter((0,b.A)()).map(([t])=>({props:{color:t,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter((0,b.A)()).map(([t])=>({props:{color:t,disabled:!1},style:{[`&.${C.A.checked}`]:{color:(e.vars||e).palette[t].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),R=(0,l.jsx)(A,{checked:!0}),M=(0,l.jsx)(A,{}),F=n.forwardRef(function(e,t){const o=(0,S.b)({props:e,name:"MuiRadio"}),{checked:a,checkedIcon:i=R,color:c="primary",icon:d=M,name:u,onChange:p,size:h="medium",className:m,disabled:v,disableRipple:f=!1,slots:A={},slotProps:b={},inputProps:F,...z}=o,B=(0,y.A)();let I=v;B&&void 0===I&&(I=B.disabled),I??=!1;const P={...o,disabled:I,disableRipple:f,color:c,size:h},$=(e=>{const{classes:t,color:o,size:n}=e,s={root:["root",`color${(0,g.A)(o)}`,"medium"!==n&&`size${(0,g.A)(n)}`]};return{...t,...(0,r.A)(s,C.q,t)}})(P),O=(0,j.A)();let T=a;const q=(0,x.A)(p,O&&O.onChange);let N=u;var _,G;O&&(void 0===T&&(_=O.value,T="object"==typeof(G=o.value)&&null!==G?_===G:String(_)===String(G)),void 0===N&&(N=O.name));const L=b.input??F,[V,E]=(0,w.A)("root",{ref:t,elementType:k,className:(0,s.A)($.root,m),shouldForwardComponentProp:!0,externalForwardedProps:{slots:A,slotProps:b,...z},getSlotProps:e=>({...e,onChange:(t,...o)=>{e.onChange?.(t,...o),q(t,...o)}}),ownerState:P,additionalProps:{type:"radio",icon:n.cloneElement(d,{fontSize:d.props.fontSize??h}),checkedIcon:n.cloneElement(i,{fontSize:i.props.fontSize??h}),disabled:I,name:N,checked:T,slots:A,slotProps:{input:"function"==typeof L?L(P):L}}});return(0,l.jsx)(V,{...E,classes:$})})},59922(e,t,o){o.d(t,{A:()=>r});var n=o(42918),s=o(76830);function r(){return n.useContext(s.A)}},67728(e,t,o){o.d(t,{A:()=>a,q:()=>r});var n=o(97818),s=o(11042);function r(e){return(0,s.Ay)("MuiRadio",e)}const a=(0,n.A)("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"])},76830(e,t,o){o.d(t,{A:()=>n});const n=o(42918).createContext(void 0)},86667(e,t,o){o.r(t),o.d(t,{default:()=>z});var n=o(30936),s=o(42918),r=o(85787),a=o(41031),i=o(869),l=o(28519),c=o(54690),d=o(64074),u=o(27351),p=o(77251),h=o(8201),m=o(52901),v=o(70203),f=o(99226),A=o(99367),g=o(70885),x=o(8039),y=o(23628),j=o(32118);const C=(0,d.observer)(function({model:e,children:t,handleClose:o}){const[n,r]=(0,s.useState)(""),[a,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(),[d,C]=(0,s.useState)(),{rpcManager:b}=(0,p.getSession)(e),{sourcesVolatile:w,minorAlleleFrequencyFilter:S,lengthCutoffFilter:k,adapterConfig:R,renderingMode:M,sampleInfo:F}=e,z="phased"===M;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(A.A,{children:[t,z?(0,j.jsx)("div",{style:{marginTop:8,fontStyle:"italic"},children:"Note: Clustering by individual haplotypes (phased mode)"}):null,(0,j.jsxs)("div",{children:[a?(0,j.jsxs)("div",{style:{padding:50},children:[(0,j.jsx)("span",{children:n||"Loading..."}),(0,j.jsx)(g.A,{onClick:()=>{(0,m.CF)(d)},children:"Stop"})]}):null,l?(0,j.jsx)(u.A,{error:l}):null]})]}),(0,j.jsxs)(x.A,{children:[(0,j.jsx)(g.A,{variant:"contained",disabled:a||!w,onClick:async()=>{try{c(void 0),r("Initializing"),i(!0);const t=(0,p.getContainingView)(e);if(!t.initialized)return;if(w){const o=(0,v.getRpcSessionId)(e),n=(0,m.y5)();C(n);const s=await b.call(o,"MultiVariantClusterGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:w,minorAlleleFrequencyFilter:S,lengthCutoffFilter:k,sessionId:o,adapterConfig:R,stopToken:n,renderingMode:M,sampleInfo:F,statusCallback:e=>{r(e)}});if(z&&F){const t=(0,y.d)({sources:w,sampleInfo:F});e.setLayout(s.order.map(e=>t[e]),!1)}else e.setLayout(s.order.map(e=>w[e]),!1);e.setClusterTree(s.tree)}o()}catch(t){!(0,h.Kp)(t)&&(0,f.isAlive)(e)&&(console.error(t),c(t))}finally{i(!1),r(""),C(void 0)}},children:"Run clustering"}),(0,j.jsx)(g.A,{variant:"contained",color:"secondary",onClick:()=>{o(),d&&(0,m.CF)(d)},children:"Cancel"})]})]})});var b=o(87574),w=o(65045),S=o(45371),k=o(43787);const R=(0,w.n)()({textAreaFont:{fontFamily:"Courier New"}}),M=(0,d.observer)(function({model:e,handleClose:t,children:n}){const{classes:r}=R(),[d,m]=(0,s.useState)(""),[y,C]=(0,s.useState)(),[w,M]=(0,s.useState)(),[F,z]=(0,s.useState)(!1),[B,I]=(0,p.useLocalStorage)("cluster-showAdvanced",!1),[P,$]=(0,s.useState)("single");(0,s.useEffect)(()=>{(async()=>{try{M(void 0),C(void 0),z(!0);const t=(0,p.getContainingView)(e);if(!t.initialized)return;const{rpcManager:o}=(0,p.getSession)(e),{sourcesWithoutLayout:n,minorAlleleFrequencyFilter:s,lengthCutoffFilter:r,adapterConfig:a}=e,i=(0,v.getRpcSessionId)(e),l=await o.call(i,"MultiVariantGetGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:n,minorAlleleFrequencyFilter:s,lengthCutoffFilter:r,sessionId:i,adapterConfig:a});C(l)}catch(t){!(0,h.Kp)(t)&&(0,f.isAlive)(e)&&(console.error(t),M(t))}finally{z(!1)}})()},[e]);const O=y?String.raw`inputMatrix<-matrix(c(${Object.values(y).map(e=>e.join(",")).join(",\n")}
),nrow=${Object.values(y).length},byrow=TRUE)
rownames(inputMatrix)<-c(${Object.keys(y).map(e=>`'${e}'`).join(",")})
resultClusters<-hclust(dist(inputMatrix), method='${P}')
cat(resultClusters$order,sep='\n')`:void 0,T=y?Object.entries(y).map(([e,t])=>[e,...t].join("\t")).join("\n"):void 0;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(A.A,{children:[n,(0,j.jsxs)(S.A,{style:{padding:16},children:[(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"16px"},children:[(0,j.jsx)(g.A,{variant:"contained",onClick:async()=>{const{saveAs:e}=await o.e(9044).then(o.bind(o,99044));e(new Blob([O||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,j.jsx)(g.A,{variant:"contained",onClick:async()=>{const{default:e}=await o.e(8284).then(o.t.bind(o,88284,23));e(O||"")},children:"Copy Rscript to clipboard"})," ","or"," ",(0,j.jsx)(g.A,{variant:"contained",onClick:async()=>{const{saveAs:e}=await o.e(9044).then(o.bind(o,99044));e(new Blob([T||""],{type:"text/plain;charset=utf-8"}),"genotypes.tsv")},children:"Download TSV"}),(0,j.jsx)("div",{children:(0,j.jsx)(g.A,{variant:"contained",onClick:()=>{I(!B)},children:B?"Hide advanced options":"Show advanced options"})})]}),B?(0,j.jsxs)("div",{children:[(0,j.jsx)(a.A,{variant:"h6",children:"Advanced options"}),(0,j.jsx)(i.A,{children:Object.entries({single:"Single",complete:"Complete"}).map(([e,t])=>(0,j.jsx)(l.A,{control:(0,j.jsx)(c.A,{checked:P===e,onChange:()=>{$(e)}}),label:t},e))})]}):null,O?(0,j.jsx)("div",{}):F?(0,j.jsx)(b.A,{variant:"h6",message:"Generating genotype matrix"}):w?(0,j.jsx)(u.A,{error:w}):null]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(a.A,{variant:"subtitle2",gutterBottom:!0,style:{marginTop:"16px"},children:"Clustering Results:"}),(0,j.jsx)(k.A,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:d,onChange:e=>{m(e.target.value)},slotProps:{input:{classes:{input:r.textAreaFont}}}})]})]})]}),(0,j.jsxs)(x.A,{children:[(0,j.jsx)(g.A,{variant:"contained",onClick:()=>{const{sourcesWithoutLayout:o}=e;if(o)try{e.setLayout(d.split("\n").map(e=>e.trim()).filter(e=>!!e).map(e=>+e).map(e=>{const t=o[e-1];if(!t)throw new Error(`out of bounds at ${e}`);return t}))}catch(t){console.error(t),(0,p.getSession)(e).notifyError(`${t}`,t)}t()},children:"Apply clustering"}),(0,j.jsx)(g.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})});function F(e){const t=(0,n.c)(5),{activeMode:o,setActiveMode:s}=e;let r,d,u;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,j.jsx)(a.A,{style:{marginBottom:30},children:"This procedure will cluster the visible genotype data using hierarchical clustering"}),t[0]=r):r=t[0],t[1]===Symbol.for("react.memo_cache_sentinel")?(d=Object.entries({auto:(0,j.jsx)("div",{children:"Run in-app clustering (slower, particularly for large numbers of samples, uses JS implementation of hclust)"}),manual:(0,j.jsx)("div",{children:"Download R script to run clustering (faster, uses R implementation of hclust)"})}),t[1]=d):d=t[1],t[2]!==o||t[3]!==s?(u=(0,j.jsxs)("div",{children:[r,(0,j.jsx)(i.A,{children:d.map(e=>{const[t,n]=e;return(0,j.jsx)(l.A,{control:(0,j.jsx)(c.A,{checked:o===t,onChange:()=>{s(t)}}),label:n},t)})})]}),t[2]=o,t[3]=s,t[4]=u):u=t[4],u}const z=(0,d.observer)(function({model:e,handleClose:t}){const[o,n]=(0,s.useState)("auto");return(0,j.jsx)(r.A,{open:!0,title:"Cluster by genotype",onClose:(e,o)=>{"backdropClick"!==o&&t()},children:"auto"===o?(0,j.jsx)(C,{model:e,handleClose:t,children:(0,j.jsx)(F,{activeMode:o,setActiveMode:n})}):(0,j.jsx)(M,{model:e,handleClose:t,children:(0,j.jsx)(F,{activeMode:o,setActiveMode:n})})})})},93597(e,t,o){o.d(t,{A:()=>a,B:()=>r});var n=o(97818),s=o(11042);function r(e){return(0,s.Ay)("MuiRadioGroup",e)}const a=(0,n.A)("MuiRadioGroup",["root","row","error"])}}]);
//# sourceMappingURL=6667.ce7bdf18.chunk.js.map