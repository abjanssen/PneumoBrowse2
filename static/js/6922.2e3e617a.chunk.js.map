{"version":3,"file":"static/js/6922.2e3e617a.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../plugins/dotplot-view/src/DotplotView/components/Axes.tsx","webpack://@jbrowse/web/../../plugins/dotplot-view/src/DotplotView/components/DotplotGrid.tsx","webpack://@jbrowse/web/../../plugins/dotplot-view/src/DotplotView/svgcomponents/SVGBackground.tsx","webpack://@jbrowse/web/../../plugins/dotplot-view/src/DotplotView/svgcomponents/SVGDotplotView.tsx"],"sourcesContent":["import {\n  getFillProps,\n  getStrokeProps,\n  getTickDisplayStr,\n} from '@jbrowse/core/util'\nimport { bpToPx } from '@jbrowse/core/util/Base1DUtils'\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { getSnapshot } from '@jbrowse/mobx-state-tree'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { getBlockLabelKeysToHide } from './util.ts'\n\nimport type { DotplotViewModel } from '../model.ts'\n\nconst useStyles = makeStyles()(() => ({\n  vtext: {\n    gridColumn: '1/2',\n    gridRow: '1/2',\n    pointerEvents: 'none',\n    userSelect: 'none',\n  },\n  htext: {\n    gridColumn: '2/2',\n    gridRow: '2/2',\n    pointerEvents: 'none',\n    userSelect: 'none',\n  },\n}))\nexport const HorizontalAxis = observer(function HorizontalAxis({\n  model,\n}: {\n  model: DotplotViewModel\n}) {\n  const { viewWidth, borderY } = model\n  const { classes } = useStyles()\n  return (\n    <svg width={viewWidth} height={borderY} className={classes.htext}>\n      <HorizontalAxisRaw model={model} />\n    </svg>\n  )\n})\n\nexport const HorizontalAxisRaw = observer(function HorizontalAxisRaw({\n  model,\n}: {\n  model: DotplotViewModel\n}) {\n  const { viewWidth, borderX, borderY, hview, htextRotation, hticks } = model\n  const { offsetPx, width, dynamicBlocks, bpPerPx } = hview\n  const dblocks = dynamicBlocks.contentBlocks\n  const hide = getBlockLabelKeysToHide(dblocks, viewWidth, offsetPx)\n  const theme = useTheme()\n  const hviewSnap = {\n    ...getSnapshot(hview),\n    width,\n    staticBlocks: hview.staticBlocks,\n  }\n\n  const ticks = hticks\n    .map(\n      tick =>\n        [\n          tick,\n          bpToPx({\n            refName: tick.refName,\n            coord: tick.base,\n            self: hviewSnap,\n          })?.offsetPx,\n        ] as const,\n    )\n    .filter(f => f[1] !== undefined)\n    .map(f => [f[0], f[1]! - offsetPx] as const)\n\n  return (\n    <>\n      {dblocks\n        .filter(region => !hide.has(region.key))\n        .map(region => {\n          const xoff = Math.floor(region.offsetPx - hview.offsetPx)\n          return (\n            <text\n              transform={`rotate(${htextRotation},${xoff},0)`}\n              key={region.key}\n              x={xoff}\n              y={1}\n              fontSize={11}\n              dominantBaseline=\"hanging\"\n              textAnchor=\"end\"\n              {...getFillProps(theme.palette.text.primary)}\n            >\n              {region.refName}\n            </text>\n          )\n        })}\n      {ticks.map(([tick, x], idx) =>\n        x > 0 && x < width ? (\n          <line\n            key={`line-${tick.refName}-${tick.base}-${idx}`}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={tick.type === 'major' ? 6 : 4}\n            strokeWidth={1}\n            {...getStrokeProps(theme.palette.text.primary)}\n          />\n        ) : null,\n      )}\n      {ticks\n        .filter(t => t[0].type === 'major')\n        .map(([tick, x], idx) =>\n          x > 10 && x < width ? (\n            <text\n              x={x - 7}\n              y={0}\n              transform={`rotate(${htextRotation},${x},0)`}\n              key={`text-${tick.refName}-${tick.base}-${idx}`}\n              fontSize={11}\n              dominantBaseline=\"middle\"\n              textAnchor=\"end\"\n              {...getFillProps(theme.palette.text.primary)}\n            >\n              {getTickDisplayStr(tick.base + 1, bpPerPx)}\n            </text>\n          ) : null,\n        )}\n      <text\n        y={borderY - 12}\n        x={(viewWidth - borderX) / 2}\n        textAnchor=\"middle\"\n        fontSize={11}\n        dominantBaseline=\"hanging\"\n        {...getFillProps(theme.palette.text.primary)}\n      >\n        {hview.assemblyNames.join(',')}\n      </text>\n    </>\n  )\n})\nexport const VerticalAxis = observer(function VerticalAxis({\n  model,\n}: {\n  model: DotplotViewModel\n}) {\n  const { borderX, viewHeight } = model\n  const { classes } = useStyles()\n  return (\n    <svg className={classes.vtext} width={borderX} height={viewHeight}>\n      <VerticalAxisRaw model={model} />\n    </svg>\n  )\n})\n\nexport const VerticalAxisRaw = observer(function VerticalAxisRaw({\n  model,\n}: {\n  model: DotplotViewModel\n}) {\n  const { viewHeight, borderX, borderY, vview, vtextRotation, vticks } = model\n  const { offsetPx, width, dynamicBlocks, bpPerPx } = vview\n  const dblocks = dynamicBlocks.contentBlocks\n  const hide = getBlockLabelKeysToHide(dblocks, viewHeight, offsetPx)\n  const theme = useTheme()\n  const vviewSnap = {\n    ...getSnapshot(vview),\n    width,\n    staticBlocks: vview.staticBlocks,\n  }\n  const ticks = vticks\n    .map(\n      tick =>\n        [\n          tick,\n          bpToPx({\n            refName: tick.refName,\n            coord: tick.base,\n            self: vviewSnap,\n          })?.offsetPx,\n        ] as const,\n    )\n    .filter(f => f[1] !== undefined)\n    .map(f => [f[0], f[1]! - offsetPx] as const)\n\n  return (\n    <>\n      {dblocks\n        .filter(region => !hide.has(region.key))\n        .map(region => {\n          const yoff = Math.floor(viewHeight - region.offsetPx + offsetPx)\n          return (\n            <text\n              transform={`rotate(${vtextRotation},${borderX},${region.offsetPx})`}\n              key={region.key}\n              x={borderX}\n              y={yoff}\n              fontSize={11}\n              textAnchor=\"end\"\n              {...getFillProps(theme.palette.text.primary)}\n            >\n              {region.refName}\n            </text>\n          )\n        })}\n      {ticks.map(([tick, y], idx) =>\n        y > 0 && y < viewHeight ? (\n          <line\n            key={`line-${tick.refName}-${tick.base}-${idx}`}\n            y1={viewHeight - y}\n            y2={viewHeight - y}\n            x1={borderX}\n            x2={borderX - (tick.type === 'major' ? 6 : 4)}\n            strokeWidth={1}\n            {...getStrokeProps(theme.palette.text.primary)}\n          />\n        ) : null,\n      )}\n      {ticks\n        .filter(t => t[0].type === 'major')\n        .map(([tick, y], idx) =>\n          y > 10 && y < viewHeight ? (\n            <text\n              y={viewHeight - y - 3}\n              x={borderX - 7}\n              key={`text-${tick.refName}-${tick.base}-${idx}`}\n              textAnchor=\"end\"\n              dominantBaseline=\"hanging\"\n              fontSize={11}\n              {...getFillProps(theme.palette.text.primary)}\n            >\n              {getTickDisplayStr(tick.base + 1, bpPerPx)}\n            </text>\n          ) : null,\n        )}\n      <text\n        y={(viewHeight - borderY) / 2}\n        x={12}\n        transform={`rotate(-90,12,${(viewHeight - borderY) / 2})`}\n        textAnchor=\"middle\"\n        fontSize={11}\n        {...getFillProps(theme.palette.text.primary)}\n      >\n        {vview.assemblyNames.join(',')}\n      </text>\n    </>\n  )\n})\n","import { getFillProps, getStrokeProps } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { DotplotViewModel } from '../model.ts'\n\nconst DotplotGrid = observer(function DotplotGrid({\n  model,\n  children,\n}: {\n  model: DotplotViewModel\n  children?: React.ReactNode\n}) {\n  const { viewWidth, viewHeight, hview, vview } = model\n  const hblocks = hview.dynamicBlocks.contentBlocks\n  const vblocks = vview.dynamicBlocks.contentBlocks\n  const theme = useTheme()\n  if (!hblocks.length || !vblocks.length) {\n    return null\n  }\n  const htop = hview.displayedRegionsTotalPx - hview.offsetPx\n  const vtop = vview.displayedRegionsTotalPx - vview.offsetPx\n  const hbottom = hblocks[0]!.offsetPx - hview.offsetPx\n  const vbottom = vblocks[0]!.offsetPx - vview.offsetPx\n  const stroke = theme.palette.divider\n\n  // Uses math.max/min avoid making very large SVG rect offscreen element,\n  // which can sometimes fail to draw\n  const rx = Math.max(hbottom, 0)\n  const ry = Math.max(viewHeight - vtop, 0)\n  const w = Math.min(htop - hbottom, viewWidth)\n  const h = Math.min(viewHeight - vbottom - ry, viewHeight)\n\n  // Filter blocks to avoid rendering duplicate lines at the same pixel position\n  const hlines = hblocks.filter((region, idx) => {\n    const x = Math.floor(region.offsetPx - hview.offsetPx)\n    const prevX =\n      idx > 0 ? Math.floor(hblocks[idx - 1]!.offsetPx - hview.offsetPx) : null\n    return x !== prevX\n  })\n  const vlines = vblocks.filter((region, idx) => {\n    const y = Math.floor(viewHeight - (region.offsetPx - vview.offsetPx))\n    const prevY =\n      idx > 0\n        ? Math.floor(viewHeight - (vblocks[idx - 1]!.offsetPx - vview.offsetPx))\n        : null\n    return y !== prevY\n  })\n\n  return (\n    <>\n      <rect\n        x={rx}\n        y={ry}\n        width={w}\n        height={h}\n        {...getFillProps(theme.palette.background.default)}\n      />\n      <g>\n        {hlines.map(region => {\n          const x = region.offsetPx - hview.offsetPx\n          return (\n            <line\n              key={region.key}\n              x1={x}\n              y1={0}\n              x2={x}\n              y2={viewHeight}\n              {...getStrokeProps(stroke)}\n            />\n          )\n        })}\n        {vlines.map(region => {\n          const y = viewHeight - (region.offsetPx - vview.offsetPx)\n          return (\n            <line\n              key={region.key}\n              x1={0}\n              y1={y}\n              x2={viewWidth}\n              y2={y}\n              {...getStrokeProps(stroke)}\n            />\n          )\n        })}\n        <line\n          x1={htop}\n          y1={0}\n          x2={htop}\n          y2={viewHeight}\n          {...getStrokeProps(stroke)}\n        />\n        <line\n          x1={0}\n          y1={viewHeight - vtop}\n          x2={viewWidth}\n          y2={viewHeight - vtop}\n          {...getStrokeProps(stroke)}\n        />\n      </g>\n      {children}\n    </>\n  )\n})\n\nexport default DotplotGrid\n","import { stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nexport default function SVGBackground({\n  width,\n  height,\n}: {\n  width: number\n  height: number\n}) {\n  const theme = useTheme()\n  return (\n    <rect\n      x={0}\n      y={0}\n      width={width}\n      height={height}\n      fill={stripAlpha(theme.palette.background.default)}\n    />\n  )\n}\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { getSession, renderToStaticMarkup } from '@jbrowse/core/util'\nimport { ThemeProvider } from '@mui/material'\nimport { when } from 'mobx'\n\nimport SVGBackground from './SVGBackground.tsx'\nimport { HorizontalAxisRaw, VerticalAxisRaw } from '../components/Axes.tsx'\nimport DotplotGrid from '../components/DotplotGrid.tsx'\n\nimport type { DotplotViewModel, ExportSvgOptions } from '../model.ts'\n\n// render LGV to SVG\nexport async function renderToSvg(\n  model: DotplotViewModel,\n  opts: ExportSvgOptions,\n) {\n  await when(() => model.initialized)\n  const { themeName = 'default', Wrapper = ({ children }) => children } = opts\n\n  const session = getSession(model)\n  const theme = session.allThemes?.()[themeName]\n  const { width, borderX, viewWidth, viewHeight, tracks, height } = model\n  const shift = 50\n  const displayResults = await Promise.all(\n    tracks.map(async track => {\n      const display = track.displays[0]\n      await when(() => (display.ready !== undefined ? display.ready : true))\n      return { track, result: await display.renderSvg({ ...opts, theme }) }\n    }),\n  )\n  const w = width + shift * 2\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <ThemeProvider theme={createJBrowseTheme(theme)}>\n      <Wrapper>\n        <svg\n          width={width}\n          height={height}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n          viewBox={[0, 0, w, height].toString()}\n        >\n          <SVGBackground width={w} height={height} />\n          <VerticalAxisRaw model={model} />\n          <g transform={`translate(${borderX} 0)`}>\n            <DotplotGrid model={model} />\n            <defs>\n              <clipPath id=\"clip-ruler\">\n                <rect x={0} y={0} width={viewWidth} height={viewHeight} />\n              </clipPath>\n            </defs>\n            <g clipPath=\"url(#clip-ruler)\">\n              {displayResults.map(({ result }, i) => (\n                /* biome-ignore lint/suspicious/noArrayIndexKey: */\n                <g key={i}>{result}</g>\n              ))}\n            </g>\n          </g>\n          <g transform={`translate(${borderX} ${viewHeight})`}>\n            <HorizontalAxisRaw model={model} />\n          </g>\n        </svg>\n      </Wrapper>\n    </ThemeProvider>,\n  )\n}\n"],"names":["useStyles","makeStyles","vtext","gridColumn","gridRow","pointerEvents","userSelect","htext","HorizontalAxis","observer","model","viewWidth","borderY","classes","_jsx","width","height","className","children","HorizontalAxisRaw","borderX","hview","htextRotation","hticks","offsetPx","dynamicBlocks","bpPerPx","dblocks","contentBlocks","hide","getBlockLabelKeysToHide","theme","useTheme","hviewSnap","getSnapshot","staticBlocks","ticks","map","tick","bpToPx","refName","coord","base","self","filter","f","undefined","_jsxs","_Fragment","region","has","key","xoff","Math","floor","transform","x","y","fontSize","dominantBaseline","textAnchor","getFillProps","palette","text","primary","idx","x1","x2","y1","y2","type","strokeWidth","getStrokeProps","t","getTickDisplayStr","assemblyNames","join","VerticalAxis","viewHeight","VerticalAxisRaw","vview","vtextRotation","vticks","vviewSnap","yoff","hblocks","vblocks","length","htop","displayedRegionsTotalPx","vtop","hbottom","vbottom","stroke","divider","rx","max","ry","w","min","h","hlines","vlines","background","default","SVGBackground","t0","$","_c","t1","t2","stripAlpha","fill","async","renderToSvg","opts","when","initialized","themeName","Wrapper","session","getSession","allThemes","tracks","displayResults","Promise","all","display","track","displays","ready","result","renderSvg","shift","renderToStaticMarkup","ThemeProvider","createJBrowseTheme","xmlns","xmlnsXlink","viewBox","toString","DotplotGrid","id","clipPath","i"],"sourceRoot":""}