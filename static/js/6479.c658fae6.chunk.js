"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6479],{26479(e,r,n){n.d(r,{default:()=>d});var a=n(9272),t=n(54523),s=n(77251),i=n(33624);class d extends t.D{async configurePre(e){const r=this.getConf("ldLocation"),n=this.getConf(["index","location"]),t=this.getConf(["index","indexType"]),s=(0,i.openLocation)(r,this.pluginManager),d="CSI"===t,o=new a.wD({filehandle:s,csiFilehandle:d?(0,i.openLocation)(n,this.pluginManager):void 0,tbiFilehandle:d?void 0:(0,i.openLocation)(n,this.pluginManager),chunkCacheSize:52428800}),c=await o.getHeader();return{ld:o,header:this.parseHeader(c)}}parseHeader(e){const r=e.trim().split(/\s+/),n=e=>{for(const n of e){const e=r.indexOf(n);if(-1!==e)return e}return-1},a=n(["CHR_A","CHR1"]),t=n(["BP_A","BP1","POS_A","POS1"]),s=n(["SNP_A","SNP1","ID_A","ID1"]),i=n(["CHR_B","CHR2"]),d=n(["BP_B","BP2","POS_B","POS2"]),o=n(["SNP_B","SNP2","ID_B","ID2"]),c=n(["R2","R^2","RSQ"]),h=n(["DP","DPRIME","D'"]),u=n(["MAF_A","MAF1"]),p=n(["MAF_B","MAF2"]);if(-1===a||-1===t||-1===i||-1===d)throw new Error(`Invalid PLINK LD header. Expected columns CHR_A, BP_A, CHR_B, BP_B. Got: ${r.join(", ")}`);if(-1===c&&-1===h)throw new Error(`Invalid PLINK LD header. Expected at least R2 or DP column. Got: ${r.join(", ")}`);return{columns:r,hasR2:-1!==c,hasDprime:-1!==h,hasMafA:-1!==u,hasMafB:-1!==p,chrAIdx:a,bpAIdx:t,snpAIdx:s,chrBIdx:i,bpBIdx:d,snpBIdx:o,r2Idx:c,dprimeIdx:h,mafAIdx:u,mafBIdx:p}}async configurePre2(){return this.configured||(this.configured=this.configurePre().catch(e=>{throw this.configured=void 0,e})),this.configured}async configure(e){const{statusCallback:r=()=>{}}=e||{};return(0,s.updateStatus)("Downloading index",r,()=>this.configurePre2())}async getRefNames(e={}){const{ld:r}=await this.configure(e);return r.getReferenceSequenceNames(e)}async getHeader(e){const{header:r}=await this.configure(e);return r}async getLDRecords(e,r={}){const{refName:n,start:a,end:t}=e,{ld:s,header:i}=await this.configure(r),d=[];return await s.getLines(n,a,t,{lineCallback:e=>{const r=this.parseLine(e,i);r&&d.push(r)},...r}),d}async getLDRecordsInRegion(e,r={}){const{refName:n,start:a,end:t}=e;return(await this.getLDRecords(e,r)).filter(e=>e.chrB===n&&e.bpB>=a&&e.bpB<=t&&e.chrA===n&&e.bpA>=a&&e.bpA<=t)}parseLine(e,r){const n=e.trim().split(/\s+/),a=n[r.chrAIdx],t=Number.parseInt(n[r.bpAIdx]??"",10),s=r.snpAIdx>=0?n[r.snpAIdx]:`${a}:${t}`,i=n[r.chrBIdx],d=Number.parseInt(n[r.bpBIdx]??"",10),o=r.snpBIdx>=0?n[r.snpBIdx]:`${i}:${d}`;return!a||!i||Number.isNaN(t)||Number.isNaN(d)?null:{chrA:a,bpA:t,snpA:s??`${a}:${t}`,chrB:i,bpB:d,snpB:o??`${i}:${d}`,r2:(r.r2Idx>=0?Number.parseFloat(n[r.r2Idx]??""):void 0)??0,dprime:r.dprimeIdx>=0?Number.parseFloat(n[r.dprimeIdx]??""):void 0,mafA:r.mafAIdx>=0?Number.parseFloat(n[r.mafAIdx]??""):void 0,mafB:r.mafBIdx>=0?Number.parseFloat(n[r.mafBIdx]??""):void 0}}freeResources(){}}}}]);
//# sourceMappingURL=6479.c658fae6.chunk.js.map