"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3962],{3962(e,t,n){n.d(t,{sw:()=>N,Cj:()=>T,wi:()=>L,ZR:()=>O,$B:()=>A,ie:()=>k});var o=n(57141),i=n(11259),s=n(17868),a=n(35702),r=n(74721),c=n(20253);function l(e,t,n,o,i,s){s&&(i.strokeStyle=s),i.beginPath(),i.moveTo(e,t),i.lineTo(n,o),i.stroke()}var h=n(5248),f=n(47354);function d(e){return"dark"===(0,s.createJBrowseTheme)(e).palette.mode?"#aaa8":"#6665"}function g({ctx:e,xPos:t,yPos:n,width:o,height:i,strand:s,fillStyle:a,strokeStyle:r,renderChevrons:c,showOutline:l=!0}){if(c)!function(e,t,n,o,i,s,a,r,c){e.fillStyle=a,e.beginPath(),-1===s?(e.moveTo(t-r,n+i/2),e.lineTo(t,n+i),e.lineTo(t+o,n+i),e.lineTo(t+o,n),e.lineTo(t,n)):(e.moveTo(t,n),e.lineTo(t,n+i),e.lineTo(t+o,n+i),e.lineTo(t+o+r,n+i/2),e.lineTo(t+o,n)),e.closePath(),e.fill(),c&&(e.strokeStyle=c,e.stroke())}(e,t,n,o,i,s,a,f.Fz,l?r:void 0);else{let s=t,c=n,h=o;h<0&&(s+=h,h=-h),i<0&&(c+=i),e.fillStyle=a,e.fillRect(s,c,h,i),l&&function(e,t,n,o,i,s){n<0&&(e+=n,n=-n),o<0&&(t+=o,o=-o),s&&(i.strokeStyle=s),i.strokeRect(e,t,n,o)}(s,c,h,i,e,r)}}function m(e){return-1===e?"color_rev_strand":"color_fwd_strand"}function u(e){for(const t of e)if(t.get("flags")&h.Xx)return!0;return!1}function p(e){const t=[];for(const n of e)n.get("flags")&h.fs||t.push(n);return t}function x(e,t,n,o,a){const r=(0,i.QZ)(t,"mismatchAlpha"),c=(0,i.QZ)(t,"minSubfeatureWidth")??1,l=(0,i.QZ)(t,"largeInsertionIndicatorScale"),h=a?.hideSmallIndels??(0,i.QZ)(t,"hideSmallIndels"),d=a?.hideMismatches??(0,i.QZ)(t,"hideMismatches"),g=a?.hideLargeIndels??(0,i.QZ)(t,"hideLargeIndels")??!1,m=(0,s.createJBrowseTheme)(n),u=(0,f.LI)(m),p=(0,f._7)(m);(0,f.Hh)(e);const{charWidth:x,charHeight:P}=(0,f.Sr)();return{mismatchAlpha:r,minSubfeatureWidth:c,largeInsertionIndicatorScale:l,hideSmallIndels:h,hideMismatches:d,hideLargeIndels:g,colorMap:u,colorContrastMap:p,charWidth:x,charHeight:P,drawSNPsMuted:(0,f.B$)(o.type),drawIndels:(0,f.P9)()}}function P(e,t,n,o){return e===o.refName&&t<o.end&&n>o.start}function S(e,t,n,o,i){const s=Math.max(e,n),a=Math.min(t,o);return{xPos:(s-n)/i,width:Math.max((a-s)/i,3)}}function y(e,t){let n=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const i of e){const e=i;e.get("refName")===t&&(n=Math.min(n,e.get("start")),o=Math.max(o,e.get("end")))}return n!==Number.MAX_VALUE?{minStart:n,maxEnd:o}:void 0}function b(e,t,n,o){for(let o=0;o<e.coords.length;o+=4)n.push(e.coords[o]+t,e.coords[o+1],e.coords[o+2]+t,e.coords[o+3]);for(const t of e.items)o.push(t)}function M({ctx:e,feat:t,layoutFeat:n,region:o,regionStartPx:i,bpPerPx:s,canvasWidth:l,colorBy:h,visibleModifications:f,mismatchConfig:d,allCoords:g,allItems:m}){b((0,r.Y)({ctx:e,feat:n,checkRef:!0,bpPerPx:s,regions:[o],canvasWidth:l,...d}),i,g,m),function({ctx:e,feat:t,layoutFeat:n,region:o,regionStartPx:i,bpPerPx:s,colorBy:r,visibleModifications:l,allCoords:h,allItems:f}){if("modifications"!==r.type||!l)return;const d=(0,a.tQ)(t.get("NUMERIC_CIGAR")||t.get("CIGAR"));b((0,c.k)({ctx:e,feat:n,region:o,bpPerPx:s,renderArgs:{colorBy:r,visibleModifications:l},cigarOps:d}),i,h,f)}({ctx:e,feat:t,layoutFeat:n,region:o,regionStartPx:i,bpPerPx:s,colorBy:h,visibleModifications:f,allCoords:g,allItems:m})}var I=n(52901),_=n(15391);function v(e){const t=e.get("flags");if(2048&t){const t=e.get("tags")?.SA,n=t?.split(";")[0]?.split(",")[2];return"-"===n?-1:1}return 16&t?-1:1}function w({ctx:e,chainData:t,chainYOffsets:n,renderChevrons:o,featureHeight:i,computedChains:s,flipStrandLongReadChains:a,config:r,theme:c,region:h,regionStartPx:f,bpPerPx:u,colorBy:p,visibleModifications:b,stopTokenCheck:w,hideSmallIndels:C,hideMismatches:A,hideLargeIndels:L,showOutline:k}){const N=x(e,r,c,p,{hideSmallIndels:C,hideMismatches:A,hideLargeIndels:L}),O=h.widthPx,T=h.start,B=[],E=[];for(const r of s){(0,I.As)(w);const{id:s,chain:x,isPairedEnd:C,nonSupplementary:A}=r;if(C)continue;const L=n.get(s);if(void 0===L)continue;const R=1===x.length,F=v(A[0]||x[0]);if(!R){const t=y(x,h.refName);if(t&&t.minStart<h.end&&t.maxEnd>h.start){const n=L+i/2;l((t.minStart-T)/u,n,(t.maxEnd-T)/u,n,e,d(c))}}const X=[];for(let n=0,s=x.length;n<s;n++){const s=x[n],r=s.get("refName"),c=s.get("start"),l=s.get("end");if(!P(r,c,l,h))continue;const f=s.get("strand"),d=R||!a?f:f*F,[p,y]=R?(0,_.Pq)({tlen:s.get("template_length"),pair_orientation:s.get("pair_orientation"),flags:s.get("flags")},t.stats):[_.pf[m(d)],_.w7[m(d)]],{xPos:b,width:M}=S(c,l,T,h.end,u);X.push(s),g({ctx:e,xPos:b,yPos:L,width:M,height:i,strand:d,fillStyle:p,strokeStyle:y,renderChevrons:o,showOutline:k})}for(const t of X)M({ctx:e,feat:t,layoutFeat:{feature:t,heightPx:i,topPx:L},region:h,regionStartPx:f,bpPerPx:u,canvasWidth:O,colorBy:p,visibleModifications:b,mismatchConfig:N,allCoords:B,allItems:E})}return{coords:B,items:E}}function C({ctx:e,type:t,chainData:n,chainYOffsets:o,renderChevrons:i,featureHeight:s,computedChains:a,config:r,theme:c,region:h,regionStartPx:f,bpPerPx:m,colorBy:u,visibleModifications:p,stopTokenCheck:b,hideSmallIndels:v,hideMismatches:w,hideLargeIndels:C,showOutline:A}){const L=x(e,r,c,u,{hideSmallIndels:v,hideMismatches:w,hideLargeIndels:C}),k=h.widthPx,N=h.start,O=[],T=[];for(const r of a){(0,I.As)(b);const{id:a,chain:x,isPairedEnd:v,nonSupplementary:w}=r;if(!v)continue;const C=o.get(a);if(void 0===C)continue;const B=2===w.length,E=w[0]||x[0],[R,F]=(0,_.PJ)({type:t,v0:E,stats:n.stats})||["lightgrey","#888"],X=C+s/2,H=x.length>w.length;if(B){const t=y(x,h.refName);t&&t.minStart<h.end&&t.maxEnd>h.start&&l((t.minStart-N)/m,X,(t.maxEnd-N)/m,X,e,H?_.pf.color_supplementary:d(c))}const U=[];for(let t=0,n=x.length;t<n;t++){const n=x[t],o=n.get("refName"),a=n.get("start"),r=n.get("end");if(!P(o,a,r,h))continue;const{xPos:c,width:l}=S(a,r,N,h.end,m);U.push(n);const[f,d]=H?[_.pf.color_supplementary,_.w7.color_supplementary]:[R,F];g({ctx:e,xPos:c,yPos:C,width:l,height:s,strand:n.get("strand"),fillStyle:f,strokeStyle:d,renderChevrons:i,showOutline:A})}for(const t of U)M({ctx:e,feat:t,layoutFeat:{feature:t,heightPx:s,topPx:C},region:h,regionStartPx:f,bpPerPx:m,canvasWidth:k,colorBy:u,visibleModifications:p,mismatchConfig:L,allCoords:O,allItems:T});(0,I.As)(b)}return{coords:O,items:T}}function A(e,t,n,o,i){const s=[];for(const a of e){if(!t&&1===a.length)continue;const e=u(a);if(!n&&e){const e=p(a);if(2===e.length){const t=e[0];if((0,_.en)({type:o,f:{refName:t.get("refName"),next_ref:t.get("next_ref"),pair_orientation:t.get("pair_orientation"),tlen:t.get("template_length"),flags:t.get("flags")},stats:i.stats})===_.J8.PROPER_PAIR)continue}}s.push(a)}return s}function L(e,t){const n=[],{bpPerPx:o}=t;for(const i of e){let e=Number.MAX_VALUE,s=Number.MIN_VALUE,a="",r=0,c=!1;const l=[],f=i.length;for(let n=0;n<f;n++){const f=i[n],d=f.get("start"),g=f.get("end"),m=f.get("flags");m&h.Xx&&(c=!0),m&h.fs||l.push(f);const u=t.bpToPx({refName:f.get("refName"),coord:d})?.offsetPx;if(void 0!==u){const t=u+(g-d)/o;e=Math.min(e,u),s=Math.max(s,t)}a||(a=f.id());const p=f.get("template_length");0===r&&p&&(r=Math.abs(p))}if(e===Number.MAX_VALUE||s===Number.MIN_VALUE)continue;let d=0;r>0&&r<=(s-e)*o*100&&(d=r),n.push({distance:d,minX:e,maxX:s,chain:i,id:a,isPairedEnd:c,nonSupplementary:l})}return n}function k(e){e.sort((e,t)=>{const n=1===e.chain.length?1:0,o=1===t.chain.length?1:0;return o!==n?o-n:e.distance-t.distance})}function N(e,t){const n=new o.A(Math.max(e.length,1)),i=e.length;if(i)for(let t=0;t<i;t++){const{x1:o,y1:i,x2:s,y2:a}=e[t];n.add(o,i,s,a)}else n.add(0,0);n.finish(),t.setFeatureLayout(n),t.setFeaturesForFlatbush(e)}function O({ctx:e,params:t,view:n,calculateYOffsets:i}){const{chainData:s,featureHeight:a,colorBy:r,drawSingletons:c,drawProperPairs:l,flipStrandLongReadChains:h,stopTokenCheck:d}=t,g=r.type||"insertSizeAndOrientation",{chains:m}=s,u=L(A(m,c,l,g,s),n);k(u);const{chainYOffsets:p,layoutHeight:x,cloudMaxDistance:P}=i(u),S=[],y=(0,f.SP)(n.bpPerPx,a),b=n.offsetPx,M=[],I=[];for(const n of t.regions){e.save();const o=n.offsetPx-b;e.beginPath(),e.rect(o,0,n.widthPx,1e5),e.clip(),e.translate(o,0);const i=C({ctx:e,type:g,chainData:s,chainYOffsets:p,renderChevrons:y,featureHeight:a,computedChains:u,config:t.config,theme:t.theme,region:n,regionStartPx:o,bpPerPx:t.bpPerPx,colorBy:t.colorBy,visibleModifications:t.visibleModifications,stopTokenCheck:d,hideSmallIndels:t.hideSmallIndels,hideMismatches:t.hideMismatches,hideLargeIndels:t.hideLargeIndels,showOutline:t.showOutline}),r=w({ctx:e,chainData:s,chainYOffsets:p,renderChevrons:y,featureHeight:a,computedChains:u,flipStrandLongReadChains:h,config:t.config,theme:t.theme,region:n,regionStartPx:o,bpPerPx:t.bpPerPx,colorBy:t.colorBy,visibleModifications:t.visibleModifications,stopTokenCheck:d,hideSmallIndels:t.hideSmallIndels,hideMismatches:t.hideMismatches,hideLargeIndels:t.hideLargeIndels,showOutline:t.showOutline});for(const e of i.coords)M.push(e);for(const e of r.coords)M.push(e);for(const e of i.items)I.push(e);for(const e of r.items)I.push(e);e.restore()}!function(e,t,n,o,i){for(const s of e){const{id:e,chain:a,minX:r,maxX:c,nonSupplementary:l}=s,h=t.get(e);if(void 0===h)continue;const f=r-o.offsetPx,d=c-o.offsetPx;if(a.length>0){const t=l[0]||a[0],o=l.length<a.length;i.push({x1:f,y1:h,x2:d,y2:h+n,data:{name:t.get("name"),refName:t.get("refName"),start:t.get("start"),end:t.get("end"),strand:t.get("strand"),flags:t.get("flags"),id:t.id(),tlen:t.get("template_length")||0,pair_orientation:t.get("pair_orientation")||"",clipLengthAtStartOfRead:t.get("clipLengthAtStartOfRead")||0,next_ref:t.get("next_ref")},chainId:e,chainMinX:f,chainMaxX:d,hasSupplementary:o,chain:a.map(e=>({name:e.get("name"),refName:e.get("refName"),start:e.get("start"),end:e.get("end"),strand:e.get("strand"),flags:e.get("flags"),id:e.id(),tlen:e.get("template_length")||0,pair_orientation:e.get("pair_orientation")||"",clipLengthAtStartOfRead:e.get("clipLengthAtStartOfRead")||0,next_ref:e.get("next_ref")}))})}}}(u,p,a,n,S);const _=new o.A(Math.max(I.length,1));if(M.length)for(let e=0;e<M.length;e+=4)_.add(M[e],M[e+1],M[e+2],M[e+3]);else _.add(0,0,0,0);return _.finish(),{featuresForFlatbush:S,layoutHeight:x,cloudMaxDistance:P,mismatchFlatbush:_.data,mismatchItems:I}}function T(e,t,n){const i=o.A.from(e);n.setMismatchLayout(i),n.setMismatchItems(t)}}}]);
//# sourceMappingURL=3962.2d339e53.chunk.js.map