"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3917],{3917(e,t,r){r.d(t,{A:()=>x});var n=r(69566),o=r(30128),a=r(23886),s=r(10533),i=r(87377),l=r(7201);const c={F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},u={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"},d={color_fwd_strand_not_proper:(0,l.X4)("#CA6767",.8),color_rev_strand_not_proper:(0,l.X4)("#7272AA",.8),color_fwd_strand:(0,l.X4)("#DC2A2A",.8),color_rev_strand:(0,l.X4)("#4141BA",.8),color_fwd_missing_mate:(0,l.X4)("#921111",.8),color_rev_missing_mate:(0,l.X4)("#111192",.8),color_fwd_diff_chr:(0,l.X4)("#000000",.8),color_rev_diff_chr:(0,l.X4)("#696969",.8),color_pair_lr:(0,l.X4)("#8C8C8C",.8),color_pair_rr:(0,l.X4)("#00005A",.8),color_pair_rl:(0,l.X4)("#005A5A",.8),color_pair_ll:(0,l.X4)("#005A00",.8),color_nostrand:(0,l.X4)("#8C8C8C",.8),color_interchrom:(0,l.X4)("#5A005A",.8),color_longinsert:(0,l.X4)("#B30000",.8),color_shortinsert:(0,l.X4)("#FF3A5C",.8),color_unknown:(0,l.X4)("#555",.8)},f=d.color_unknown;function g(e,t){return-1===e&&1===t?d.color_pair_rr:1===e&&-1===t?d.color_pair_ll:d.color_unknown}function p(e,t){return-1===e&&1===t||1===e&&-1===t}function h(e){return"LR"!==c[e.pair_orientation||""]}function v(e){return function(e){const t=c[e.pair_orientation||""];return"LR"===t?void 0:d[u[t]]}(e)||f}const[m,,_]=[0,1,2,3];function k(e){return e.current?.getBoundingClientRect().top??0}function w(e,t,r,n,o,a){return{onClick:()=>{const e=r.addWidget?.(n,o,{featureData:a});r.showWidget?.(e)},onMouseOver:()=>{t(e)},onMouseOut:()=>{t(void 0)}}}function T(e,t){return t?`${e}-loaded`:e}function R(e,t,r){const n=e.getCanonicalRefName(t),o=e.getCanonicalRefName(r);if(!n||!o)throw new Error(`unable to find ref for ${n||o}`);return{f1ref:n,f2ref:o}}function S(e){return"+"===e?1:"-"===e?-1:0}function N(e,t,r,n){return t===n?`Q ${(e+r)/2} ${t-30} ${r} ${n}`:`L ${r} ${n}`}function y(e,t,r,n){return`M ${e} ${t} ${N(e,t,r,n)}`}function M(e,t,r,n,o,a){return`M ${o} ${t} L ${e} ${t} ${N(e,t,r,n)} L ${a} ${n}`}var A=r(20208);function L(e,t){const r=e.get("ALT");if(r)return new Map(r.map(e=>(0,A.An)(e)).filter(a.notEmpty).map(e=>[e.MatePosition,e])).get(`${t.get("refName")}:${t.get("start")+1}`)}var b=r(66878),F=r(44460);const O=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:l,views:c,showIntraviewLinks:u}=e,d=(0,i.A)(),f=(0,a.getSession)(e),w=(0,s.getSnapshot)(e),{assemblyManager:R}=f,S=c[0],N=S?R.get(S.assemblyNames[0]):void 0;(0,b.E6)(w);const y=e.getTrackFeatures(t),M=(0,o.useMemo)(()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(y),[y]),A=(0,o.useMemo)(()=>{const r=M?function(e){const t=new Map,r=new Set,n=new Set;for(const o of e.values()){const e=o.get("flags"),s=o.id(),i=(0,a.assembleLocStringFast)({refName:o.get("refName"),start:o.get("start"),end:o.get("end")}),l=4&e,c=2&e;if(!(r.has(s)||n.has(i)||c||l)){const e=o.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(o)}r.add(o.id()),n.add(i)}return[...t.values()].filter(e=>e.length>1)}(y):function(e){const t=new Map,r=new Set;for(const n of e.values()){const e=n.id(),o=4&n.get("flags"),a=!!n.get("tags")?.SA;if(!r.has(e)&&!o&&a){const e=n.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}r.add(n.id())}return[...t.values()].filter(e=>e.length>1)}(y),n=e.getMatchedFeaturesInLayout(t,r);if(!M)for(const e of n)e.sort((e,t)=>e.clipLengthAtStartOfRead-t.clipLengthAtStartOfRead);return n},[y,t,M,e]),[L,O]=(0,o.useState)(),$=k(r),C=c.map(e=>e.getTrack(t));return N?(0,F.jsx)("g",{fill:"none","data-testid":T(t,A.length>0),children:A.map(e=>{const r=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:i,level:k}=e[o],{layout:w,feature:T,level:R}=e[o+1];if(!u&&k===R)return null;const S=N.getCanonicalRefName(i.get("refName")),A=N.getCanonicalRefName(T.get("refName"));if(!S||!A)throw new Error(`unable to find ref for ${S||A}`);const E={pair_orientation:i.get("pair_orientation")},x=i.get("strand"),W=T.get("strand");let X="",j=!1;S===A&&(M?(X=v(E),j=h(E)):(X=g(x,W),j=p(x,W)));const I=s[-1===x?m:_],J=-1===W,B=M?w[J?m:_]:w[J?_:m],P=(0,b.Tp)(c[k],S,I),D=(0,b.Tp)(c[R],A,B),V=c[k].pxToBp(P).reversed?-1:1,Y=c[R].pxToBp(D).reversed?-1:1,H=(0,b.Ec)(t,k,c,C,s,n)-$,Q=(0,b.Ec)(t,R,c,C,w,n)-$,q=k===R&&j,z=q?C[k].displays[0].height:0,G=M?-1:1,K=(0,b.eW)(c,t,k,n),U=["M",P,H,"C",P+200*i.get("strand")*V,q?Math.min(K-$+z,H+z):H,D-200*T.get("strand")*Y*G,q?Math.min(K-$+z,Q+z):Q,D,Q].join(" "),Z=`${i.id()}-${T.id()}`;r.push((0,F.jsx)("path",{d:U,"data-testid":"r1",pointerEvents:l?"auto":void 0,strokeWidth:L===Z?5:1,...(0,a.getStrokeProps)(X||d.palette.text.disabled),onClick:()=>{const e=f.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(y.get(i.id())||{toJSON:()=>({})}).toJSON(),feature2:(y.get(T.id())||{toJSON:()=>({})}).toJSON()}});f.showWidget?.(e)},onMouseOver:()=>{O(Z)},onMouseOut:()=>{O(void 0)}},Z))}return r})}):null}),$=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:i,views:l}=e,c=(0,a.getSession)(e),{assemblyManager:u}=c,d=(0,s.getSnapshot)(e),f=l[0],g=f?u.get(f.assemblyNames[0]):void 0;(0,b.E6)(d);const p=e.getTrackFeatures(t),h=(0,o.useMemo)(()=>{const r=function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"breakend"===n.get("type")){const e=n.get("ALT");if(e)for(const r of e){const e=`${n.get("refName")}:${n.get("start")+1}`,o=(0,A.An)(r);if(o){const r=t.get(e);r?r.push(n):t.set(o.MatePosition||"none",[n])}}}r.add(n.id())}return[...t.values()].filter(e=>e.length>1)}(p);return e.getMatchedFeaturesInLayout(t,r)},[p,t,e]),[v,_]=(0,o.useState)(),S=k(r),N=l.map(e=>e.getTrack(t));return g?(0,F.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":T(t,h.length>0),children:h.map(e=>{const r=[];for(let o=0;o<e.length-1;o+=1){const{layout:a,feature:s,level:u}=e[o],{layout:d,feature:f,level:h}=e[o+1],k=s.id(),T=L(s,f),{f1ref:y,f2ref:A}=R(g,s.get("refName"),f.get("refName")),O=(0,b.Tp)(l[u],y,a[m]),$=(0,b.Tp)(l[h],A,d[m]),C=l[u].pxToBp(O).reversed,E=l[h].pxToBp($).reversed,x=(0,b.Ec)(t,u,l,N,a,n)-S,W=(0,b.Ec)(t,h,l,N,d,n)-S;if(T){const e=M(O,x,$,W,O-20*("left"===T.Join?-1:1)*(C?-1:1),$-20*("left"===T.MateDirection?1:-1)*(E?-1:1)),t=w(k,_,c,"VariantFeatureWidget","variantFeature",p.get(k)?.toJSON());r.push((0,F.jsx)("path",{d:e,"data-testid":"r2",pointerEvents:i?"auto":void 0,strokeWidth:k===v?10:5,...t},JSON.stringify(e)))}else console.warn("the relevant ALT allele was not found, cannot render")}return r})}):null}),C=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:i,views:l}=e,c=(0,a.getSession)(e),{assemblyManager:u}=c,d=(0,s.getSnapshot)(e),f=l[0],g=f?u.get(f.assemblyNames[0]):void 0;(0,b.E6)(d);const p=e.getTrackFeatures(t),h=(0,o.useMemo)(()=>{const r=function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"paired_feature"===n.get("type")){const e=n.id().replace("-r1",""),r=n.id().replace("-r2","");n.id().endsWith("-r1")?(t.get(e)||t.set(e,[]),t.get(e).push(n)):n.id().endsWith("-r2")&&(t.get(r)||t.set(r,[]),t.get(r).push(n))}r.add(n.id())}return[...t.values()].filter(e=>e.length>1)}(p);return e.getMatchedFeaturesInLayout(t,r)},[p,t,e]),[v,_]=(0,o.useState)(),S=k(r),N=l.map(e=>e.getTrack(t));return g?(0,F.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":T(t,h.length>0),children:h.map(e=>{const r=[];for(let o=0;o<e.length-1;o+=1){const{layout:a,feature:s,level:u}=e[o],{layout:d,feature:f,level:h}=e[o+1],k=s.id(),{f1ref:T,f2ref:M}=R(g,s.get("refName"),f.get("refName")),A=(0,b.Tp)(l[u],T,a[m]),L=(0,b.Tp)(l[h],M,d[m]),O=y(A,(0,b.Ec)(t,u,l,N,a,n)-S,L,(0,b.Ec)(t,h,l,N,d,n)-S),$=w(k,_,c,"VariantFeatureWidget","variantFeature",p.get(k)?.toJSON());r.push((0,F.jsx)("path",{d:O,"data-testid":"r2",pointerEvents:i?"auto":void 0,strokeWidth:k===v?10:5,...$},JSON.stringify(O)))}return r})}):null}),E=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:i,views:l}=e,c=(0,a.getSession)(e),{assemblyManager:u}=c,d=(0,s.getSnapshot)(e),f=l[0],g=f?u.get(f.assemblyNames[0]):void 0;(0,b.E6)(d);const p=e.getTrackFeatures(t),h=(0,o.useMemo)(()=>{const r=function(e){const t=[],r=new Set;for(const n of e.values())r.has(n.id())||"<TRA>"!==n.get("ALT")[0]||t.push([n]),r.add(n.id());return t}(p);return e.getMatchedFeaturesInLayout(t,r)},[p,t,e]),[v,_]=(0,o.useState)(),R=k(r),N=l.map(e=>e.getTrack(t));return g?l.length<2?null:(0,F.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":T(t,h.length>0),children:h.map(e=>{const r=[];for(const{layout:o,feature:a,level:s}of e){const e=0===s?1:0,u=a.id(),d=a.get("INFO"),f=d.CHR2[0],g=d.END[0],h=d.STRANDS?.[0]?.split(""),[k,T]=h??[".","."],y=(0,b.Tp)(l[e],f,g);if(y){const d=[y,0,y+1,0],f=(0,b.Tp)(l[s],a.get("refName"),o[m]),g=y,h=l[s].pxToBp(f).reversed,A=l[e].pxToBp(g).reversed,L=M(f,(0,b.Ec)(t,s,l,N,o,n)-R,g,(0,b.Ec)(t,e,l,N,d,n)-R,f-20*S(k)*(h?-1:1),g-20*S(T)*(A?-1:1)),O=w(u,_,c,"VariantFeatureWidget","variantFeature",p.get(u)?.toJSON());r.push((0,F.jsx)("path",{d:L,pointerEvents:i?"auto":void 0,strokeWidth:u===v?10:5,...O},JSON.stringify(L)))}}return r})}):null}),x=(0,n.observer)(function(e){const{model:t,trackId:r}=e,n=t.getMatchedTracks(r),o=n[0]?.type;return"AlignmentsTrack"===o?(0,F.jsx)(O,{...e}):"VariantTrack"===o?t.hasTranslocations(r)?(0,F.jsx)(E,{...e}):t.hasPairedFeatures(r)?(0,F.jsx)(C,{...e}):(0,F.jsx)($,{...e}):null})}}]);
//# sourceMappingURL=3917.823a3939.chunk.js.map