{"version":3,"file":"static/js/2276.9cecaeb8.chunk.js","mappings":"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","sources":["../../../plugins/alignments/src/shared/getUniqueTags.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/GroupByDialog.tsx"],"sourcesContent":["import { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nexport async function getUniqueTags({\n  self,\n  tag,\n  blocks,\n  opts,\n}: {\n  self: {\n    adapterConfig: AnyConfigurationModel\n    effectiveRpcDriverName?: string\n  }\n  tag: string\n  blocks: BlockSet\n  opts?: {\n    headers?: Record<string, string>\n    stopToken?: string\n    filters: string[]\n  }\n}) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig, effectiveRpcDriverName } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag,\n      sessionId,\n      rpcDriverName: effectiveRpcDriverName,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n","import { useEffect, useState } from 'react'\n\nimport { Dialog, ErrorMessage, LoadingEllipses } from '@jbrowse/core/ui'\nimport {\n  type SessionWithAddTracks,\n  getContainingTrack,\n  getContainingView,\n  getSession,\n  useDebounce,\n} from '@jbrowse/core/util'\nimport { getSnapshot, isStateTreeNode } from '@jbrowse/mobx-state-tree'\nimport {\n  Button,\n  DialogActions,\n  DialogContent,\n  MenuItem,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { getUniqueTags } from '../../shared/getUniqueTags.ts'\nimport { defaultFilterFlags, negFlags, posFlags } from '../../shared/util.ts'\n\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { IAnyStateTreeNode } from '@jbrowse/mobx-state-tree'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nconst TAG_REGEX = /^[A-Za-z][A-Za-z0-9]$/\n\nfunction TagResults({ tag, tagSet }: { tag: string; tagSet: string[] }) {\n  if (tagSet.length === 0) {\n    return (\n      <Typography color=\"warning.main\">\n        No values found for tag {tag} in the current region\n      </Typography>\n    )\n  }\n  return (\n    <div>\n      <div>Found unique {tag} values:</div>\n      <div>{tagSet.join(', ')}</div>\n    </div>\n  )\n}\n\nfunction createTrackId(baseId: string, suffix: string) {\n  return `${baseId}-${suffix}-${Date.now()}-sessionTrack`\n}\n\nfunction createTagBasedTracks({\n  trackConf,\n  tag,\n  tagSet,\n  session,\n  view,\n}: {\n  trackConf: any\n  tag: string\n  tagSet: string[]\n  session: SessionWithAddTracks\n  view: LinearGenomeViewModel\n}) {\n  const values = [...tagSet, undefined] as (string | undefined)[]\n  for (const tagValue of values) {\n    const trackId = createTrackId(trackConf.trackId, `${tag}:${tagValue}`)\n    session.addTrackConf({\n      ...trackConf,\n      trackId,\n      name: `${trackConf.name} (${tag}:${tagValue})`,\n      displays: [\n        {\n          displayId: `${trackId}-LinearAlignmentsDisplay`,\n          type: 'LinearAlignmentsDisplay',\n          pileupDisplay: {\n            displayId: `${trackId}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n            type: 'LinearPileupDisplay',\n            filterBy: {\n              ...defaultFilterFlags,\n              tagFilter: {\n                tag,\n                value: tagValue,\n              },\n            },\n          },\n        },\n      ],\n    })\n    view.showTrack(trackId)\n  }\n}\n\nfunction createStrandBasedTracks({\n  trackConf,\n  session,\n  view,\n}: {\n  trackConf: any\n  session: SessionWithAddTracks\n  view: LinearGenomeViewModel\n}) {\n  const negTrackId = createTrackId(trackConf.trackId, 'strand:(-)')\n  const posTrackId = createTrackId(trackConf.trackId, 'strand:(+)')\n\n  session.addTrackConf({\n    ...trackConf,\n    trackId: negTrackId,\n    name: `${trackConf.name} (-)`,\n    displays: [\n      {\n        displayId: `${negTrackId}-LinearAlignmentsDisplay`,\n        type: 'LinearAlignmentsDisplay',\n        pileupDisplay: {\n          displayId: `${negTrackId}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n          type: 'LinearPileupDisplay',\n          filterBy: negFlags,\n        },\n      },\n      {\n        displayId: `${negTrackId}-LinearSNPCoverageDisplay`,\n        type: 'LinearSNPCoverageDisplay',\n        filterBy: negFlags,\n      },\n    ],\n  })\n  session.addTrackConf({\n    ...trackConf,\n    trackId: posTrackId,\n    name: `${trackConf.name} (+)`,\n    displays: [\n      {\n        displayId: `${posTrackId}-LinearAlignmentsDisplay`,\n        type: 'LinearAlignmentsDisplay',\n        pileupDisplay: {\n          displayId: `${posTrackId}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n          type: 'LinearPileupDisplay',\n          filterBy: posFlags,\n        },\n      },\n      {\n        displayId: `${posTrackId}-LinearSNPCoverageDisplay`,\n        type: 'LinearSNPCoverageDisplay',\n        filterBy: posFlags,\n      },\n    ],\n  })\n  view.showTrack(negTrackId)\n  view.showTrack(posTrackId)\n}\n\nconst GroupByTagDialog = observer(function GroupByTagDialog(props: {\n  model: {\n    adapterConfig: AnyConfigurationModel\n    configuration: AnyConfigurationModel\n  } & IAnyStateTreeNode\n  handleClose: () => void\n}) {\n  const { model, handleClose } = props\n  const [tag, setGroupByTag] = useState('')\n  const [tagSet, setGroupByTagSet] = useState<string[]>()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<unknown>()\n\n  const validTag = TAG_REGEX.exec(tag)\n  const isInvalid = tag.length === 2 && !validTag\n  const debouncedTag = useDebounce(tag, 1000)\n  const [type, setType] = useState('')\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      const isValidTag = TAG_REGEX.test(debouncedTag)\n      if (type === 'tag' && isValidTag) {\n        try {\n          setError(undefined)\n          setLoading(true)\n          const vals = await getUniqueTags({\n            self: model,\n            tag: debouncedTag,\n            blocks: (getContainingView(model) as LinearGenomeViewModel)\n              .staticBlocks,\n          })\n          setGroupByTagSet(vals)\n        } catch (e) {\n          console.error(e)\n          setError(e)\n        } finally {\n          setLoading(false)\n        }\n      }\n    })()\n  }, [model, type, debouncedTag])\n\n  useEffect(() => {\n    if (type !== 'tag') {\n      setGroupByTagSet(undefined)\n      setError(undefined)\n      setLoading(false)\n    }\n  }, [type])\n\n  return (\n    <Dialog open onClose={handleClose} title=\"Group by\">\n      <DialogContent>\n        <Typography>\n          NOTE: this will create new session tracks with the \"filter by\" set to\n          the values chosen here rather than affecting the current track state\n        </Typography>\n        <TextField\n          fullWidth\n          value={type}\n          onChange={event => {\n            setType(event.target.value)\n          }}\n          label=\"Group by...\"\n          select\n        >\n          <MenuItem value=\"strand\">Strand</MenuItem>\n          <MenuItem value=\"tag\">Tag</MenuItem>\n        </TextField>\n        {type === 'tag' ? (\n          <>\n            <Typography color=\"textSecondary\">\n              Examples: HP for haplotype, RG for read group, etc.\n            </Typography>\n\n            <TextField\n              value={tag}\n              onChange={event => {\n                setGroupByTag(event.target.value)\n              }}\n              placeholder=\"Enter tag name\"\n              error={isInvalid}\n              helperText={isInvalid ? 'Not a valid tag' : ''}\n              autoComplete=\"off\"\n              data-testid=\"group-tag-name\"\n              slotProps={{\n                htmlInput: {\n                  maxLength: 2,\n                  'data-testid': 'group-tag-name-input',\n                },\n              }}\n            />\n            {error ? (\n              <ErrorMessage error={error} />\n            ) : loading ? (\n              <LoadingEllipses message=\"Loading unique tags\" />\n            ) : tagSet ? (\n              <TagResults tag={tag} tagSet={tagSet} />\n            ) : null}\n          </>\n        ) : null}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          disabled={\n            !type ||\n            loading ||\n            (type === 'tag' && (!tagSet || tagSet.length === 0))\n          }\n          autoFocus\n          onClick={() => {\n            const track = getContainingTrack(model)\n            const trackConf = isStateTreeNode(track.configuration)\n              ? structuredClone(getSnapshot(track.configuration))\n              : track.configuration\n            const session = getSession(model) as SessionWithAddTracks\n            const view = getContainingView(model) as LinearGenomeViewModel\n\n            if (type === 'tag' && tagSet) {\n              createTagBasedTracks({\n                trackConf,\n                tag,\n                tagSet,\n                session,\n                view,\n              })\n            } else if (type === 'strand') {\n              createStrandBasedTracks({\n                trackConf,\n                session,\n                view,\n              })\n            }\n\n            handleClose()\n          }}\n        >\n          Submit\n        </Button>\n        <Button variant=\"contained\" color=\"secondary\" onClick={handleClose}>\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default GroupByTagDialog\n"],"names":["async","getUniqueTags","self","tag","blocks","opts","rpcManager","getSession","adapterConfig","effectiveRpcDriverName","sessionId","getRpcSessionId","call","rpcDriverName","regions","contentBlocks","TAG_REGEX","TagResults","t0","$","_c","tagSet","length","t1","_jsxs","Typography","color","children","t2","t3","t4","join","_jsx","createTrackId","baseId","suffix","Date","now","observer","props","model","handleClose","setGroupByTag","useState","setGroupByTagSet","loading","setLoading","error","setError","validTag","exec","isInvalid","debouncedTag","useDebounce","type","setType","useEffect","isValidTag","test","undefined","vals","getContainingView","staticBlocks","e","console","Dialog","open","onClose","title","DialogContent","TextField","fullWidth","value","onChange","event","target","label","select","MenuItem","_Fragment","placeholder","helperText","autoComplete","slotProps","htmlInput","maxLength","ErrorMessage","LoadingEllipses","message","DialogActions","Button","variant","disabled","autoFocus","onClick","track","getContainingTrack","trackConf","isStateTreeNode","configuration","structuredClone","getSnapshot","session","view","values","tagValue","trackId","addTrackConf","name","displays","displayId","pileupDisplay","filterBy","defaultFilterFlags","tagFilter","showTrack","createTagBasedTracks","negTrackId","posTrackId","negFlags","posFlags","createStrandBasedTracks"],"ignoreList":[],"sourceRoot":""}