"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3365,7706],{7706:(e,t,r)=>{r.d(t,{sG:()=>d,unzip:()=>i,i2:()=>o});var n=r(35451),a=r(45834),s=r(57864);async function i(e){try{let t,r=0,a=0;const i=[];let o,l=0;do{const n=e.subarray(r);if(o=new s.Inflate,({strm:t}=o),o.push(n,s.Z_SYNC_FLUSH),o.err)throw new Error(o.msg);r+=t.next_in,i[a]=o.result,l+=i[a].length,a+=1}while(t.avail_in);const h=new Uint8Array(l);for(let e=0,t=0;e<i.length;e++)h.set(i[e],t),t+=i[e].length;return n.Buffer.from(h)}catch(e){if(`${e}`.match(/incorrect header check/))throw new Error("problem decompressing block: incorrect gzip header check");throw e}}async function o(e,t){try{let r;const{minv:a,maxv:i}=t;let o=a.blockPosition,l=a.dataPosition;const h=[],c=[],d=[];let f=0,u=0;do{const t=e.subarray(o-a.blockPosition),n=new s.Inflate;if(({strm:r}=n),n.push(t,s.Z_SYNC_FLUSH),n.err)throw new Error(n.msg);const g=n.result;h.push(g);let b=g.length;c.push(o),d.push(l),1===h.length&&a.dataPosition&&(h[0]=h[0].subarray(a.dataPosition),b=h[0].length);const w=o;if(o+=r.next_in,l+=b,w>=i.blockPosition){h[u]=h[u].subarray(0,i.blockPosition===a.blockPosition?i.dataPosition-a.dataPosition+1:i.dataPosition+1),c.push(o),d.push(l),f+=h[u].length;break}f+=h[u].length,u++}while(r.avail_in);const g=new Uint8Array(f);for(let e=0,t=0;e<h.length;e++)g.set(h[e],t),t+=h[e].length;return{buffer:n.Buffer.from(g),cpositions:c,dpositions:d}}catch(e){if(`${e}`.match(/incorrect header check/))throw new Error("problem decompressing block: incorrect gzip header check");throw e}}var l=r(59086),h=r.n(l);class c{constructor({filehandle:e,path:t}){if(e)this.filehandle=e;else{if(!t)throw new TypeError("either filehandle or path must be defined");this.filehandle=new a.EY(t)}}_readLongWithOverflow(e,t=0,r=!0){const n=h().fromBytesLE(e.slice(t,t+8),r);if(n.greaterThan(Number.MAX_SAFE_INTEGER)||n.lessThan(Number.MIN_SAFE_INTEGER))throw new TypeError("integer overflow");return n.toNumber()}_getIndex(){return this.index||(this.index=this._readIndex()),this.index}async _readIndex(){let e=n.Buffer.allocUnsafe(8);await this.filehandle.read(e,0,8,0);const t=this._readLongWithOverflow(e,0,!0);if(!t)return[[0,0]];const r=new Array(t+1);r[0]=[0,0];const a=16*t;if(a>Number.MAX_SAFE_INTEGER)throw new TypeError("integer overflow");e=n.Buffer.allocUnsafe(a),await this.filehandle.read(e,0,a,8);for(let n=0;n<t;n+=1){const t=this._readLongWithOverflow(e,16*n),a=this._readLongWithOverflow(e,16*n+8);r[n+1]=[t,a]}return r}async getLastBlock(){const e=await this._getIndex();if(e.length)return e[e.length-1]}async getRelevantBlocksForRead(e,t){const r=t+e;if(0===e)return[];const n=await this._getIndex(),a=[],s=(e,r)=>{const n=e[1],a=r?r[1]:1/0;return n<=t&&a>t?0:n<t?-1:1};let i=0,o=n.length-1,l=Math.floor(n.length/2),h=s(n[l],n[l+1]);for(;0!==h;)h>0?o=l-1:h<0&&(i=l+1),l=Math.ceil((o-i)/2)+i,h=s(n[l],n[l+1]);a.push(n[l]);let c=l+1;for(;c<n.length&&(a.push(n[c]),!(n[c][1]>=r));c+=1);return a[a.length-1][1]<r&&a.push([]),a}}class d{constructor({filehandle:e,path:t,gziFilehandle:r,gziPath:n}){if(e)this.filehandle=e;else{if(!t)throw new TypeError("either filehandle or path must be defined");this.filehandle=new a.EY(t)}if(!r&&!n&&!t)throw new TypeError("either gziFilehandle or gziPath must be defined");this.gzi=new c({filehandle:r,path:r||n||!t?`${t}.gzi`:n})}async stat(){const e=await this.filehandle.stat();return Object.assign(e,{size:await this.getUncompressedFileSize(),blocks:void 0,blksize:void 0})}async getUncompressedFileSize(){const[,e]=await this.gzi.getLastBlock(),{size:t}=await this.filehandle.stat(),r=n.Buffer.allocUnsafe(4),{bytesRead:a}=await this.filehandle.read(r,0,4,t-28-4);if(4!==a)throw new Error("read error");return e+r.readUInt32LE(0)}async _readAndUncompressBlock(e,[t],[r]){let n=r;n||(n=(await this.filehandle.stat()).size);const a=n-t;return await this.filehandle.read(e,0,a,t),await i(e.slice(0,a))}async read(e,t,r,a){const s=await this.gzi.getRelevantBlocksForRead(r,a),i=n.Buffer.allocUnsafe(65536);let o=t,l=0;for(let t=0;t<s.length-1;t+=1){const n=await this._readAndUncompressBlock(i,s[t],s[t+1]),[,h]=s[t],c=h>=a?0:a-h,d=Math.min(a+r,h+n.length)-h;c>=0&&c<n.length&&(n.copy(e,o,c,d),o+=d-c,l+=d-c)}return{bytesRead:l,buffer:e}}}},71616:(e,t,r)=>{r.d(t,{tP:()=>l,BL:()=>o});var n=r(45834),a=r(7706),s=r(22609).hp;function i(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}class o{constructor({fasta:e,fai:t,path:r,faiPath:a}){if(e)this.fasta=e;else{if(!r)throw new Error("Need to pass filehandle for fasta or path to localfile");this.fasta=new n.EY(r)}if(t)this.fai=t;else if(a)this.fai=new n.EY(a);else{if(!r)throw new Error("Need to pass filehandle for  or path to localfile");this.fai=new n.EY(`${r}.fai`)}}async _getIndexes(e){return this.indexes||(this.indexes=async function(e,t){const r=await e.readFile(t);if(!r||!r.length)throw new Error("No data read from FASTA index (FAI) file");let n,a=0;const s=r.toString("utf8").split(/\r?\n/).filter((e=>/\S/.test(e))).map((e=>e.split("\t"))).filter((e=>""!==e[0])).map((e=>(n&&n.name===e[0]||(n={name:e[0],id:a},a+=1),{id:n.id,name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]})));return{name:Object.fromEntries(s.map((e=>[e.name,e]))),id:Object.fromEntries(s.map((e=>[e.id,e])))}}(this.fai,e)),this.indexes}async getSequenceNames(e){return Object.keys((await this._getIndexes(e)).name)}async getSequenceSizes(e){const t={},r=await this._getIndexes(e),n=Object.values(r.id);for(let e=0;e<n.length;e+=1)t[n[e].name]=n[e].length;return t}async getSequenceSize(e,t){var r;return null===(r=(await this._getIndexes(t)).name[e])||void 0===r?void 0:r.length}async hasReferenceSequence(e,t){return!!(await this._getIndexes(t)).name[e]}async getResiduesById(e,t,r,n){const a=(await this._getIndexes(n)).id[e];if(a)return this._fetchFromIndexEntry(a,t,r,n)}async getResiduesByName(e,t,r,n){const a=(await this._getIndexes(n)).name[e];if(a)return this._fetchFromIndexEntry(a,t,r,n)}async getSequence(e,t,r,n){return this.getResiduesByName(e,t,r,n)}async _fetchFromIndexEntry(e,t=0,r,n){let a=r;if(t<0)throw new TypeError("regionStart cannot be less than 0");if((void 0===a||a>e.length)&&(a=e.length),t>=a)return"";const o=i(e,t),l=i(e,a)-o,h=s.allocUnsafe(l);return await this.fasta.read(h,0,l,o,n),h.toString("utf8").replace(/\s+/g,"")}}class l extends o{constructor({fasta:e,path:t,fai:r,faiPath:n,gzi:s,gziPath:i}){super({fasta:e,path:t,fai:r,faiPath:n}),e&&s?this.fasta=new a.sG({filehandle:e,gziFilehandle:s}):t&&i&&(this.fasta=new a.sG({path:t,gziPath:i}))}}},12401:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(53472),s=n(r(58607)),i=n(r(56086));class o{constructor({fill:e,cache:t}){if("function"!=typeof e)throw new TypeError("must pass a fill function");if("object"!=typeof t)throw new TypeError("must pass a cache object");if("function"!=typeof t.get||"function"!=typeof t.set||"function"!=typeof t.delete)throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=t,this.fillCallback=e}static isAbortException(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||"AbortError: aborted"===e.message||"Error: aborted"===e.message}evict(e,t){this.cache.get(e)===t&&this.cache.delete(e)}fill(e,t,r,n){const a=new s.default,o=new i.default;o.addCallback(n);const l={aborter:a,promise:this.fillCallback(t,a.signal,(e=>{o.callback(e)})),settled:!1,statusReporter:o,get aborted(){return this.aborter.signal.aborted}};l.aborter.addSignal(r),l.aborter.signal.addEventListener("abort",(()=>{l.settled||this.evict(e,l)})),l.promise.then((()=>{l.settled=!0}),(()=>{l.settled=!0,this.evict(e,l)})).catch((e=>{throw console.error(e),e})),this.cache.set(e,l)}static checkSinglePromise(e,t){function r(){if(t&&t.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return e.then((e=>(r(),e)),(e=>{throw r(),e}))}has(e){return this.cache.has(e)}get(e,t,r,n){if(!r&&t instanceof a.AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");const s=this.cache.get(e);return s?s.aborted&&!s.settled?(this.evict(e,s),this.get(e,t,r,n)):s.settled?s.promise:(s.aborter.addSignal(r),s.statusReporter.addCallback(n),o.checkSinglePromise(s.promise,r)):(this.fill(e,t,r,n),o.checkSinglePromise(this.cache.get(e).promise,r))}delete(e){const t=this.cache.get(e);t&&(t.settled||t.aborter.abort(),this.cache.delete(e))}clear(){const e=this.cache.keys();let t=0;for(let r=e.next();!r.done;r=e.next())this.delete(r.value),t+=1;return t}}t.default=o},58607:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(53472);class a{}t.default=class{constructor(){this.signals=new Set,this.abortController=new n.AbortController}addSignal(e=new a){if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(e),e.aborted?this.handleAborted(e):"function"==typeof e.addEventListener&&e.addEventListener("abort",(()=>{this.handleAborted(e)}))}handleAborted(e){this.signals.delete(e),0===this.signals.size&&this.abortController.abort()}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}}},56086:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.callbacks=new Set}addCallback(e=(()=>{})){this.callbacks.add(e),e(this.currentMessage)}callback(e){this.currentMessage=e,this.callbacks.forEach((t=>{t(e)}))}}},53472:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbortSignal=t.AbortController=void 0;const n=r(16006);var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")};let s=void 0===a().AbortController?n.AbortController:a().AbortController;t.AbortController=s;let i=void 0===a().AbortController?n.AbortSignal:a().AbortSignal;t.AbortSignal=i},5742:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(12401));t.default=a.default}}]);
//# sourceMappingURL=3365.4b50f5b8.chunk.js.map