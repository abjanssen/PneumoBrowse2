"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5331],{9469:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(23758),s=n(99546),l=n(31712),c=n(85877),i=n(68446),a=n(69500);const r=(0,i.observer)(function({model:e}){const t=(0,s.getSession)(e),{selection:n}=e,{pluginManager:i}=(0,s.getEnv)(e),{adminMode:r,sessionTracks:d}=t,h=new Set(d?.map(e=>e.trackId)),g=i.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:t});return n.length?(0,a.jsx)(o.A,{menuItems:[{label:"Clear selection",onClick:()=>{e.clearSelection()}},...n.every(e=>{return t=e.trackId,r||h.has(t);var t})?[{label:"Delete tracks",onClick:()=>{for(const e of n)t.deleteTrackConf?.(e)}}]:[],...g.map(t=>({...t,..."onClick"in t?{onClick:()=>{t.onClick(e)}}:{}}))],children:(0,a.jsx)(c.A,{badgeContent:n.length,color:"primary",children:(0,a.jsx)(l.A,{})})}):null})},25331:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue});var o=n(67758),s=n(7552),l=n(68446),c=n(28685),i=n(99546),a=n(18423),r=n(13570),d=n(11810),h=n(10240),g=n(75785),u=n(69500);const m=(0,g.n9)()(e=>({fab:{position:"absolute",bottom:e.spacing(6),right:e.spacing(6)}})),k=(0,l.observer)(function({model:e}){const{classes:t}=m(),n=(0,i.getSession)(e),[o,l]=(0,s.useState)(null);function c(){l(null)}const g=(0,i.isSessionModelWithConnections)(n),k=(0,i.isSessionWithAddTracks)(n);return k||g?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.A,{color:"secondary",className:t.fab,onClick:e=>{l(e.currentTarget)},children:(0,u.jsx)(a.A,{})}),(0,u.jsxs)(d.A,{anchorEl:o,open:Boolean(o),onClose:()=>{l(null)},children:[g?(0,u.jsx)(h.A,{onClick:()=>{c(),(0,i.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("AddConnectionWidget","addConnectionWidget"))},children:"Add connection"}):null,k?(0,u.jsx)(h.A,{onClick:()=>{c(),(0,i.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))},children:"Add track"}):null]})]}):null});var b=n(8193),C=n(93062),x=n(33896),f=n(89870),p=n(68584),v=n(23758),j=n(41785);const y=(0,s.lazy)(()=>Promise.all([n.e(2407),n.e(4132),n.e(2826),n.e(809)]).then(n.bind(n,11158))),A=(0,s.lazy)(()=>n.e(7181).then(n.bind(n,97181))),S=(0,s.lazy)(()=>n.e(5896).then(n.bind(n,35896))),T=(0,s.lazy)(()=>n.e(741).then(n.bind(n,60741))),w=(0,s.lazy)(()=>n.e(4138).then(n.bind(n,44138))),W=(0,l.observer)(function({model:e}){const t=(0,i.getSession)(e),[n,o]=(0,s.useState)(),[l,c]=(0,s.useState)(),[a,r]=(0,s.useState)(!1),[d,h]=(0,s.useState)(!1),[g,m]=(0,s.useState)(!1);function k(e,n){const s=(0,p.readConfObject)(e,"name"),l=t.prepareToBreakConnection?.(e);if(l){const[t,n]=l;Object.keys(n).length>0?o({connectionConf:e,safelyBreakConnection:t,dereferenceTypeCount:n,name:s}):t()}n&&c({name:s,connectionConf:e})}return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(v.A,{menuItems:[{label:"Open faceted track selector",onClick:()=>{m(!0)}},...(0,i.isSessionWithAddTracks)(t)?[{label:"Add track...",onClick:()=>{(0,i.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))}}]:[],{label:"Connections...",subMenu:[...(0,i.isSessionModelWithConnections)(t)?[{label:"Turn on/off connections...",onClick:()=>{r(!0)}}]:[],...(0,i.isSessionModelWithConnectionEditing)(t)?[{label:"Add connection...",onClick:()=>{(0,i.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>{h(!0)}}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:e.activeSortTrackNames,onClick:()=>{e.setSortTrackNames(!e.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:e.activeSortCategories,onClick:()=>{e.setSortCategories(!e.activeSortCategories)}}]},{label:"Collapse...",type:"subMenu",subMenu:[...e.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>{e.collapseSubCategories()}}]:[],{label:"Collapse top-level categories",onClick:()=>{e.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:()=>{e.expandAllCategories()}}]}],children:(0,u.jsx)(j.A,{})}),(0,u.jsxs)(s.Suspense,{fallback:null,children:[n?(0,u.jsx)(A,{modalInfo:n,onClose:()=>{o(void 0)}}):null,l?(0,u.jsx)(S,{handleClose:()=>{c(void 0)},deleteDialogDetails:l,session:t}):null,d?(0,u.jsx)(T,{handleClose:()=>{h(!1)},breakConnection:k,session:t}):null,a?(0,u.jsx)(w,{handleClose:()=>{r(!1)},session:t,breakConnection:k}):null,g?(0,u.jsx)(y,{handleClose:()=>{m(!1)},model:e}):null]})]})});var I=n(9469),M=n(59351),N=n(37962),F=n(85877),L=n(13476),O=n(91468),B=n(26027);const R=(0,l.observer)(function({model:e,tracks:t,extraMenuItems:n,children:o,onClick:l}){const{view:c}=e,[a,r]=(0,s.useState)(!1),d=(0,i.getSession)(e);return c?(0,u.jsx)(v.A,{closeAfterItemClick:!1,onClick:l,menuItems:[...t.map(t=>({type:"checkbox",label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(L.A,{html:(0,O.getTrackName)(t,d)})," ",(0,u.jsx)(B.A,{id:t.trackId,trackId:t.trackId,model:e,conf:t,setOpen:r,stopPropagation:!0})]}),checked:c.tracks.some(e=>e.configuration===t),onClick:()=>{a||e.view.toggleTrack(t.trackId)&&e.addToRecentlyUsed(t.trackId)}})),...n],children:o}):null}),_=(0,g.n9)()({smallBadge:{height:14},margin:{marginRight:10}}),P=(0,l.observer)(function({model:e}){const{classes:t}=_(),{view:n,favoriteTracks:o}=e;return n?(0,u.jsx)(R,{onClick:()=>{e.setFavoritesCounter(0)},tracks:o,model:e,extraMenuItems:o.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>{e.clearFavorites()}}]:[{label:"No favorite tracks yet",onClick:()=>{}}],children:(0,u.jsx)(N.A,{title:"Favorite tracks",children:(0,u.jsx)(F.A,{classes:{badge:t.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:t.margin,badgeContent:e.favoritesCounter,children:(0,u.jsx)(M.A,{})})})}):null});var D=n(41080);const E=(0,g.n9)()({smallBadge:{height:14}}),H=(0,l.observer)(function({model:e}){const{classes:t}=E(),{view:n,recentlyUsedCounter:o,recentlyUsedTracks:s}=e;return n?(0,u.jsx)(R,{onClick:()=>{e.setRecentlyUsedCounter(0)},model:e,tracks:s,extraMenuItems:s.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>{e.clearRecentlyUsed()}}]:[{label:"No recently used",onClick:()=>{}}],children:(0,u.jsx)(N.A,{title:"Recently used tracks",children:(0,u.jsx)(F.A,{classes:{badge:t.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:o,children:(0,u.jsx)(D.A,{})})})}):null}),U=(0,g.n9)()(e=>({searchBox:{margin:e.spacing(2)}})),z=(0,l.observer)(function({model:e}){const{filterText:t}=e,{classes:n}=U();return(0,u.jsx)(C.A,{className:n.searchBox,label:"Filter tracks",value:t,onChange:t=>{e.setFilterText(t.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:(0,u.jsx)(x.A,{position:"end",children:(0,u.jsx)(f.A,{onClick:()=>{e.clearFilterText()},children:(0,u.jsx)(b.A,{})})})}}})}),$=(0,l.observer)(function({model:e,setHeaderHeight:t}){return(0,u.jsx)("div",{ref:e=>{t(e?.getBoundingClientRect().height||0)},"data-testid":"hierarchical_track_selector",children:(0,u.jsxs)("div",{style:{display:"flex"},children:[(0,u.jsx)(W,{model:e}),(0,u.jsx)(I.A,{model:e}),(0,u.jsx)(z,{model:e}),(0,u.jsx)(H,{model:e}),(0,u.jsx)(P,{model:e})]})})});var K=n(32296),q=n(8463),G=n(61968),J=n(68527),Q=n(79801),V=n(61282);function X(e){return"category"===e?.type?e.children.flatMap(e=>"category"===e.type?X(e):e.conf):[]}function Y(e,t=new Map){e.id&&e.children.length&&t.set(e.id,e);for(const n of e.children)Y(n,t);return t}const Z=(0,g.n9)()(e=>({contrastColor:{color:e.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}));function ee(e){const t=(0,o.c)(30),{isOpen:n,setOpen:l,data:c}=e,{classes:i}=Z(),[a,r]=(0,s.useState)(null),{menuItems:d,name:h,model:g,id:m,tree:k}=c;let b;t[0]!==d?(b=void 0===d?[]:d,t[0]=d,t[1]=b):b=t[1];const C=b;let x;t[2]!==c||t[3]!==m||t[4]!==n||t[5]!==a||t[6]!==l?(x=()=>{a||(c.toggleCollapse(m),l(!n))},t[2]=c,t[3]=m,t[4]=n,t[5]=a,t[6]=l,t[7]=x):x=t[7];const p=`htsCategory-${h}`;let v,j,y,A,S,T,w;return t[8]!==n?(v=n?(0,u.jsx)(G.A,{}):(0,u.jsx)(J.A,{}),t[8]=n,t[9]=v):v=t[9],t[10]===Symbol.for("react.memo_cache_sentinel")?(j=e=>{r(e.currentTarget),e.stopPropagation()},t[10]=j):j=t[10],t[11]===Symbol.for("react.memo_cache_sentinel")?(y=(0,u.jsx)(Q.A,{}),t[11]=y):y=t[11],t[12]!==i.contrastColor?(A=(0,u.jsx)(f.A,{onClick:j,className:i.contrastColor,children:y}),t[12]=i.contrastColor,t[13]=A):A=t[13],t[14]!==h||t[15]!==p||t[16]!==v||t[17]!==A?(S=(0,u.jsxs)(V.A,{"data-testid":p,children:[v,h,A]}),t[14]=h,t[15]=p,t[16]=v,t[17]=A,t[18]=S):S=t[18],t[19]!==m||t[20]!==a||t[21]!==C||t[22]!==g||t[23]!==k?(T=a?(0,u.jsx)(q.A,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:()=>{const e=Y(k).get(m);g.addToSelection(X(e))}},{label:"Remove from selection",onClick:()=>{const e=Y(k).get(m);g.removeFromSelection(X(e))}},{label:"Show all tracks",onClick:()=>{for(const e of Y(k).get(m)?.children||[])"track"===e.type&&g.view.showTrack(e.trackId)}},{label:"Hide all tracks",onClick:()=>{for(const e of Y(k).get(m)?.children||[])"track"===e.type&&g.view.hideTrack(e.trackId)}},...C],onMenuItemClick:(e,t)=>{t(),r(null)},open:Boolean(a),onClose:()=>{r(null)}}):null,t[19]=m,t[20]=a,t[21]=C,t[22]=g,t[23]=k,t[24]=T):T=t[24],t[25]!==i.accordionText||t[26]!==T||t[27]!==x||t[28]!==S?(w=(0,u.jsxs)("div",{className:i.accordionText,onClick:x,children:[S,T]}),t[25]=i.accordionText,t[26]=T,t[27]=x,t[28]=S,t[29]=w):w=t[29],w}var te=n(22762),ne=n(7946);const oe=(0,g.n9)()(e=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:e.palette.action.selected}},selected:{background:"#cccc"}}));function se(e){const t=(0,o.c)(40),{data:n}=e,{classes:s}=oe(),{checked:l,conf:c,model:i,drawerPosition:a,id:r,trackId:d,name:h,selected:g,onChange:m}=n,k=(0,p.readConfObject)(c,"description")+(g?" (in selection)":""),b="left"===a?"right":"left",C=s.checkboxLabel;let x;t[0]!==c||t[1]!==i||t[2]!==g?(x=e=>{(e.ctrlKey||e.metaKey)&&(g?i.removeFromSelection([c]):i.addToSelection([c]),e.preventDefault())},t[0]=c,t[1]=i,t[2]=g,t[3]=x):x=t[3];const f=s.compactCheckbox;let v,j;t[4]!==m||t[5]!==d?(v=()=>{m(d)},t[4]=m,t[5]=d,t[6]=v):v=t[6],t[7]!==h?(j=function(e=""){return e.endsWith("(Unsupported)")||e.endsWith("(Unknown)")}(h),t[7]=h,t[8]=j):j=t[8];const y=`htsTrackEntry-${r}`;let A,S;t[9]!==y?(A={input:{"data-testid":y}},t[9]=y,t[10]=A):A=t[10],t[11]!==l||t[12]!==s.compactCheckbox||t[13]!==v||t[14]!==j||t[15]!==A?(S=(0,u.jsx)(te.A,{className:f,checked:l,onChange:v,disabled:j,slotProps:A}),t[11]=l,t[12]=s.compactCheckbox,t[13]=v,t[14]=j,t[15]=A,t[16]=S):S=t[16];const T=`htsTrackLabel-${r}`,w=g?s.selected:void 0;let W,I,M,F,O,R;return t[17]!==h?(W=(0,u.jsx)(L.A,{html:h}),t[17]=h,t[18]=W):W=t[18],t[19]!==T||t[20]!==w||t[21]!==W?(I=(0,u.jsx)("div",{"data-testid":T,className:w,children:W}),t[19]=T,t[20]=w,t[21]=W,t[22]=I):I=t[22],t[23]!==s.checkboxLabel||t[24]!==S||t[25]!==I||t[26]!==x?(M=(0,u.jsx)(ne.A,{className:C,onClick:x,control:S,label:I}),t[23]=s.checkboxLabel,t[24]=S,t[25]=I,t[26]=x,t[27]=M):M=t[27],t[28]!==k||t[29]!==M||t[30]!==b?(F=(0,u.jsx)(N.A,{title:k,placement:b,children:M}),t[28]=k,t[29]=M,t[30]=b,t[31]=F):F=t[31],t[32]!==c||t[33]!==r||t[34]!==i||t[35]!==d?(O=(0,u.jsx)(B.A,{model:i,trackId:d,id:r,conf:c}),t[32]=c,t[33]=r,t[34]=i,t[35]=d,t[36]=O):O=t[36],t[37]!==F||t[38]!==O?(R=(0,u.jsxs)(u.Fragment,{children:[F,O]}),t[37]=F,t[38]=O,t[39]=R):R=t[39],R}const le=(0,g.n9)()(e=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:e.palette.tertiary.main,color:e.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}));function ce(e){const t=(0,o.c)(26),{data:n,isOpen:s,style:l,setOpen:c}=e,{isLeaf:i,nestingLevel:a}=n,{classes:r}=le(),d=10*a+(i?10:0),h=i?void 0:r.accordionBase;let g;if(t[0]!==r||t[1]!==a||t[2]!==l?.height){let e;t[4]!==r||t[5]!==l?.height?(e=(e,t)=>(0,u.jsx)("div",{style:{left:10*t+4,height:l?.height},className:r.nestingLevelMarker},`mark-${t}`),t[4]=r,t[5]=l?.height,t[6]=e):e=t[6],g=new Array(a).fill(0).map(e),t[0]=r,t[1]=a,t[2]=l?.height,t[3]=g}else g=t[3];const m=i?void 0:r.accordionCard;let k;t[7]!==d?(k={marginLeft:d,whiteSpace:"nowrap",width:"100%"},t[7]=d,t[8]=k):k=t[8];const b=i?void 0:r.accordionColor;let C,x,f,p;return t[9]!==n||t[10]!==i||t[11]!==s||t[12]!==c?(C=i?(0,u.jsx)(se,{data:n}):(0,u.jsx)(ee,{isOpen:s,data:n,setOpen:c}),t[9]=n,t[10]=i,t[11]=s,t[12]=c,t[13]=C):C=t[13],t[14]!==b||t[15]!==C?(x=(0,u.jsx)("div",{className:b,children:C}),t[14]=b,t[15]=C,t[16]=x):x=t[16],t[17]!==m||t[18]!==k||t[19]!==x?(f=(0,u.jsx)("div",{className:m,style:k,children:x}),t[17]=m,t[18]=k,t[19]=x,t[20]=f):f=t[20],t[21]!==l||t[22]!==h||t[23]!==g||t[24]!==f?(p=(0,u.jsxs)("div",{style:l,className:h,children:[g,f]}),t[21]=l,t[22]=h,t[23]=g,t[24]=f,t[25]=p):p=t[25],p}function ie(e,t,n,o){const s="track"===e.type;return{data:{defaultHeight:s?22:40,isLeaf:s,isOpenByDefault:!0,nestingLevel:t,selected:!!s&&o[e.trackId],...e,...n},nestingLevel:t,node:e}}const ae=(0,l.observer)(function({height:e,tree:t,model:n}){const{filterText:o,selection:l,view:c}=n,a=(0,s.useRef)(null),r=(0,i.getSession)(n),{drawerPosition:d}=r,h=(0,s.useMemo)(()=>Object.fromEntries(l.map(e=>[e.trackId,e])),[l]),g=(0,s.useMemo)(()=>({onChange:e=>{c.toggleTrack(e)&&n.addToRecentlyUsed(e)},toggleCollapse:e=>{n.toggleCategory(e)},tree:t,model:n,drawerPosition:d}),[c,n,d,t]),m=(0,s.useCallback)(function*(){for(const e of t.children)yield ie(e,0,g,h);for(;;){const e=yield;for(const t of e.node.children)yield ie(t,e.nestingLevel+1,g,h)}},[t,g,h]);return(0,s.useEffect)(()=>{a.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})},[t,o]),(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(K.SS,{ref:a,treeWalker:m,height:e,children:ce})})}),re=e=>{const t=(0,o.c)(4),{tree:n,model:s,offset:l}=e;let i;return t[0]!==s||t[1]!==l||t[2]!==n?(i="undefined"==typeof jest?(0,u.jsx)(c.Ay,{disableWidth:!0,children:e=>(0,u.jsx)(ae,{height:(e.height||l)-l,model:s,tree:n})}):(0,u.jsx)(ae,{height:9e3,model:s,tree:n}),t[0]=s,t[1]=l,t[2]=n,t[3]=i):i=t[3],i},de=e=>{const t=(0,o.c)(3),{overrideDimensions:n,children:s}=e;let l;return t[0]!==s||t[1]!==n?(l=n?(0,u.jsx)("div",{style:{...n},children:s}):s,t[0]=s,t[1]=n,t[2]=l):l=t[2],l},he=(0,l.observer)(function({model:e,toolbarHeight:t,overrideDimensions:n}){return(0,u.jsxs)(de,{overrideDimensions:n,children:[(0,u.jsx)(ge,{model:e,toolbarHeight:t}),(0,u.jsx)(k,{model:e})]})}),ge=(0,l.observer)(function({model:e,toolbarHeight:t=0}){const[n,o]=(0,s.useState)(0);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)($,{model:e,setHeaderHeight:o}),(0,u.jsx)(re,{tree:e.hierarchy,model:e,offset:t+n})]})}),ue=he},26027:(e,t,n)=>{n.d(t,{A:()=>g});var o=n(67758),s=n(23758),l=n(99546),c=n(79801),i=n(7462),a=n(36438),r=n(75785),d=n(69500);const h=(0,r.n9)()({cascadingStyle:{padding:0}}),g=function(e){const t=(0,o.c)(18),{id:n,trackId:r,stopPropagation:g,model:u,setOpen:m,conf:k}=e,{classes:b}=h(),C=`htsTrackEntryMenu-${n}`;let x,f,p;if(t[0]!==k||t[1]!==u||t[2]!==r){let e,n,o;t[4]!==u||t[5]!==r?(e=u.isFavorite(r)?{label:"Remove from favorites",onClick:()=>{u.removeFromFavorites(r)},icon:a.A}:{label:"Add to favorites",onClick:()=>{u.addToFavorites(r)},icon:i.A},t[4]=u,t[5]=r,t[6]=e):e=t[6],t[7]!==k||t[8]!==u?(n={label:"Add to selection",onClick:()=>{u.addToSelection([k])}},o=u.isSelected(k)?[{label:"Remove from selection",onClick:()=>{u.removeFromSelection([k])}}]:[],t[7]=k,t[8]=u,t[9]=n,t[10]=o):(n=t[9],o=t[10]),x=[...(0,l.getSession)(u).getTrackActionMenuItems?.(k)||[],e,n,...o],t[0]=k,t[1]=u,t[2]=r,t[3]=x}else x=t[3];return t[11]===Symbol.for("react.memo_cache_sentinel")?(f=(0,d.jsx)(c.A,{}),t[11]=f):f=t[11],t[12]!==b.cascadingStyle||t[13]!==m||t[14]!==g||t[15]!==C||t[16]!==x?(p=(0,d.jsx)(s.A,{className:b.cascadingStyle,stopPropagation:g,setOpen:m,"data-testid":C,menuItems:x,children:f}),t[12]=b.cascadingStyle,t[13]=m,t[14]=g,t[15]=C,t[16]=x,t[17]=p):p=t[17],p}}}]);
//# sourceMappingURL=5331.7e8cdf5c.chunk.js.map