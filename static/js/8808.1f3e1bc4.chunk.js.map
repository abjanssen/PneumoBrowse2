{"version":3,"file":"static/js/8808.1f3e1bc4.chunk.js","mappings":"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","sources":["webpack://@jbrowse/web/../../packages/core/src/BaseFeatureWidget/SequenceFeatureDetails/SequenceFeatureDetails.tsx","webpack://@jbrowse/web/../../packages/core/src/BaseFeatureWidget/SequenceFeatureDetails/dialogs/SequenceFeatureMenu.tsx","webpack://@jbrowse/web/../../packages/core/src/BaseFeatureWidget/SequenceFeatureDetails/dialogs/SequenceTypeSelector.tsx","webpack://@jbrowse/web/../../packages/core/src/util/fetchSeq.ts","webpack://@jbrowse/web/../../packages/core/src/util/useFeatureSequence.ts","webpack://@jbrowse/web/../../node_modules/.pnpm/@mui+icons-material@7.3.8_@mui+material@7.3.8_@emotion+react@11.14.0_@types+react@19.2._eea1b8ae36d0998f6630ee1e4377c145/node_modules/@mui/icons-material/esm/Settings.js"],"sourcesContent":["import { Suspense, lazy, useEffect, useMemo, useRef, useState } from 'react'\n\nimport { Button, Typography } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport SequenceFeatureMenu from './dialogs/SequenceFeatureMenu.tsx'\nimport SequenceTypeSelector from './dialogs/SequenceTypeSelector.tsx'\nimport {\n  createSequenceFeatureDetailsModel,\n  destroySequenceFeatureDetailsModel,\n} from './model.ts'\nimport { ErrorMessage, LoadingEllipses } from '../../ui/index.ts'\nimport { SimpleFeature, getSession } from '../../util/index.ts'\nimport { useFeatureSequence } from '../../util/useFeatureSequence.ts'\n\nimport type { SimpleFeatureSerialized } from '../../util/index.ts'\nimport type { BaseFeatureWidgetModel } from '../stateModelFactory.ts'\n\n// lazies\nconst SequencePanel = lazy(() => import('./SequencePanel.tsx'))\nconst SequenceDialog = lazy(() => import('./dialogs/SequenceDialog.tsx'))\n\n// set the key on this component to feature.id to clear state after new feature\n// is selected\nconst SequenceFeatureDetails = observer(function SequenceFeatureDetails({\n  model,\n  feature,\n}: {\n  model: BaseFeatureWidgetModel\n  feature: SimpleFeatureSerialized\n}) {\n  const [sequenceFeatureDetails] = useState(() =>\n    createSequenceFeatureDetailsModel(),\n  )\n  useEffect(() => {\n    return () => {\n      destroySequenceFeatureDetailsModel(sequenceFeatureDetails)\n    }\n  }, [sequenceFeatureDetails])\n\n  const { upDownBp } = sequenceFeatureDetails\n  const seqPanelRef = useRef<HTMLDivElement>(null)\n\n  const [openInDialog, setOpenInDialog] = useState(false)\n  const [forceLoad, setForceLoad] = useState(false)\n  const session = getSession(model)\n  const assemblyName = model.view?.assemblyNames?.[0]\n  const simpleFeature = useMemo(() => new SimpleFeature(feature), [feature])\n  const { sequence, error } = useFeatureSequence({\n    assemblyName,\n    session,\n    feature: simpleFeature,\n    upDownBp,\n    forceLoad,\n  })\n  useEffect(() => {\n    sequenceFeatureDetails.setFeature(feature)\n  }, [sequenceFeatureDetails, feature])\n\n  return (\n    <>\n      <div>\n        <SequenceTypeSelector model={sequenceFeatureDetails} />\n        <SequenceFeatureMenu\n          ref={seqPanelRef}\n          model={sequenceFeatureDetails}\n          extraItems={[\n            {\n              label: 'Open in dialog',\n              onClick: () => {\n                setOpenInDialog(true)\n              },\n            },\n          ]}\n        />\n      </div>\n      {openInDialog ? (\n        <div>\n          Open in dialog...\n          <Suspense fallback={<LoadingEllipses />}>\n            <SequenceDialog\n              model={model}\n              sequenceFeatureDetails={sequenceFeatureDetails}\n              feature={feature}\n              handleClose={() => {\n                setOpenInDialog(false)\n              }}\n            />\n          </Suspense>\n        </div>\n      ) : (\n        <div>\n          {feature.type === 'gene' ? (\n            <Typography>\n              Note: inspect subfeature sequences for protein/CDS computations\n            </Typography>\n          ) : null}\n          {error ? (\n            <ErrorMessage error={error} />\n          ) : !sequence ? (\n            <LoadingEllipses />\n          ) : 'error' in sequence ? (\n            <>\n              <Typography color=\"error\">{sequence.error}</Typography>\n              <Button\n                variant=\"contained\"\n                color=\"inherit\"\n                onClick={() => {\n                  setForceLoad(true)\n                }}\n              >\n                Force load\n              </Button>\n            </>\n          ) : (\n            <Suspense fallback={<LoadingEllipses />}>\n              <SequencePanel\n                ref={seqPanelRef}\n                feature={feature}\n                sequence={sequence}\n                model={sequenceFeatureDetails}\n              />\n            </Suspense>\n          )}\n        </div>\n      )}\n    </>\n  )\n})\n\nexport default SequenceFeatureDetails\n","import { forwardRef, lazy, useState } from 'react'\n\nimport MoreVert from '@mui/icons-material/MoreVert'\nimport Settings from '@mui/icons-material/Settings'\nimport { observer } from 'mobx-react'\n\nimport CascadingMenuButton from '../../../ui/CascadingMenuButton.tsx'\n\nimport type { MenuItem } from '../../../ui/index.ts'\nimport type { SequenceFeatureDetailsModel } from '../model.ts'\n\n// lazies\nconst SequenceFeatureSettingsDialog = lazy(() => import('./SettingsDialog.tsx'))\n\ninterface Props {\n  model: SequenceFeatureDetailsModel\n  extraItems?: MenuItem[]\n}\nconst SequenceFeatureMenu = observer(\n  forwardRef<HTMLDivElement, Props>(function SequenceFeatureMenu2(\n    { model, extraItems = [] },\n    ref,\n  ) {\n    if (typeof ref === 'function') {\n      throw new Error('needs a non function ref')\n    }\n    const [showSettings, setShowSettings] = useState(false)\n    const { showCoordinatesSetting, showGenomicCoordsOption } = model\n\n    return (\n      <>\n        <CascadingMenuButton\n          menuItems={[\n            {\n              label: 'Copy plaintext',\n              onClick: async () => {\n                const { default: copy } = await import('copy-to-clipboard')\n                const r = ref?.current\n                if (r) {\n                  copy(r.textContent || '', { format: 'text/plain' })\n                }\n              },\n            },\n            {\n              label: 'Copy HTML',\n              onClick: async () => {\n                const { default: copy } = await import('copy-to-clipboard')\n                const r = ref?.current\n                if (r) {\n                  copy(r.outerHTML, { format: 'text/html' })\n                }\n              },\n            },\n            {\n              label: 'Download plaintext',\n              onClick: async () => {\n                // eslint-disable-next-line @typescript-eslint/no-deprecated\n                const { saveAs } = await import('file-saver-es')\n                const r = ref?.current\n                if (r) {\n                  saveAs(\n                    new Blob([r.textContent || ''], {\n                      type: 'text/plain;charset=utf-8',\n                    }),\n                    'sequence.txt',\n                  )\n                }\n              },\n            },\n            {\n              label: 'Download HTML',\n              onClick: async () => {\n                // eslint-disable-next-line @typescript-eslint/no-deprecated\n                const { saveAs } = await import('file-saver-es')\n                const r = ref?.current\n                if (r) {\n                  saveAs(\n                    new Blob([r.outerHTML || ''], {\n                      type: 'text/html;charset=utf-8',\n                    }),\n                    'sequence.html',\n                  )\n                }\n              },\n            },\n\n            ...extraItems,\n\n            {\n              label: 'Show coordinates?',\n              type: 'subMenu',\n              subMenu: [\n                {\n                  label: 'No coordinates',\n                  type: 'radio',\n                  checked: showCoordinatesSetting === 'none',\n                  onClick: () => {\n                    model.setShowCoordinates('none')\n                  },\n                },\n                {\n                  label: 'Coordinates relative to feature start',\n                  type: 'radio',\n                  checked: showCoordinatesSetting === 'relative',\n                  onClick: () => {\n                    model.setShowCoordinates('relative')\n                  },\n                },\n                ...(showGenomicCoordsOption\n                  ? [\n                      {\n                        label:\n                          'Coordinates relative to genome (only available for continuous genome based sequence types)',\n                        type: 'radio' as const,\n                        checked: showCoordinatesSetting === 'genomic',\n                        onClick: () => {\n                          model.setShowCoordinates('genomic')\n                        },\n                      },\n                    ]\n                  : []),\n              ],\n            },\n            {\n              label: 'Settings',\n              icon: Settings,\n              onClick: () => {\n                setShowSettings(true)\n              },\n            },\n          ]}\n        >\n          <MoreVert />\n        </CascadingMenuButton>\n\n        {showSettings ? (\n          <SequenceFeatureSettingsDialog\n            model={model}\n            handleClose={() => {\n              setShowSettings(false)\n            }}\n          />\n        ) : null}\n      </>\n    )\n  }),\n)\n\nexport default SequenceFeatureMenu\n","import { FormControl, MenuItem, Select } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport { makeStyles } from '../../../util/tss-react/index.ts'\n\nimport type { SequenceFeatureDetailsModel } from '../model.ts'\n\nconst useStyles = makeStyles()({\n  formControl: {\n    margin: 0,\n    marginLeft: 4,\n  },\n})\n\nconst SequenceTypeSelector = observer(function SequenceTypeSelector({\n  model,\n}: {\n  model: SequenceFeatureDetailsModel\n}) {\n  const { classes } = useStyles()\n  const { intronBp, upDownBp, mode, hasCDS, hasExonOrCDS } = model\n\n  return (\n    <FormControl className={classes.formControl}>\n      <Select\n        size=\"small\"\n        value={mode}\n        onChange={event => {\n          model.setMode(event.target.value)\n        }}\n      >\n        {Object.entries({\n          ...(hasCDS\n            ? {\n                cds: 'CDS',\n              }\n            : {}),\n          ...(hasCDS\n            ? {\n                protein: 'Protein',\n              }\n            : {}),\n          ...(hasExonOrCDS\n            ? {\n                cdna: 'cDNA',\n              }\n            : {}),\n          ...(hasExonOrCDS\n            ? {\n                gene: 'Genomic w/ full introns',\n              }\n            : {}),\n          ...(hasExonOrCDS\n            ? {\n                gene_updownstream: `Genomic w/ full introns +/- ${upDownBp}bp up+down stream`,\n              }\n            : {}),\n          ...(hasExonOrCDS\n            ? {\n                gene_collapsed_intron: `Genomic w/ ${intronBp}bp intron`,\n              }\n            : {}),\n          ...(hasExonOrCDS\n            ? {\n                gene_updownstream_collapsed_intron: `Genomic w/ ${intronBp}bp intron +/- ${upDownBp}bp up+down stream `,\n              }\n            : {}),\n          ...(!hasExonOrCDS\n            ? {\n                genomic: 'Genomic',\n              }\n            : {}),\n          ...(!hasExonOrCDS\n            ? {\n                genomic_sequence_updownstream: `Genomic +/- ${upDownBp}bp up+down stream`,\n              }\n            : {}),\n        }).map(([key, val]) => (\n          <MenuItem key={key} value={key}>\n            {val}\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  )\n})\n\nexport default SequenceTypeSelector\n","import { getConf } from '../configuration/index.ts'\n\nimport type { AbstractSessionModel } from './types/index.ts'\n\nexport async function fetchSeq({\n  start,\n  end,\n  refName,\n  assemblyName,\n  session,\n}: {\n  start: number\n  end: number\n  refName: string\n  assemblyName: string\n  session: AbstractSessionModel\n}) {\n  const { rpcManager, assemblyManager } = session\n  const assembly = await assemblyManager.waitForAssembly(assemblyName)\n  if (!assembly) {\n    throw new Error('assembly not found')\n  }\n\n  const sessionId = 'getSequence'\n  const adapterConfig = getConf(assembly, ['sequence', 'adapter'])\n\n  // Get the canonical refName, then translate to the sequence adapter refName\n  // (in FASTA). These may differ when refNameAliases override.\n  const canonicalRefName = assembly.getCanonicalRefName2(refName)\n  const seqAdapterRefName = assembly.getSeqAdapterRefName(canonicalRefName)\n\n  const seq = (await rpcManager.call(sessionId, 'CoreGetSequence', {\n    adapterConfig,\n    sessionId,\n    region: {\n      start,\n      end,\n      refName: seqAdapterRefName,\n      assemblyName,\n    },\n  })) as string | undefined\n\n  return seq ?? ''\n}\n","import { useEffect, useMemo, useState } from 'react'\n\nimport { fetchSeq } from './fetchSeq.ts'\n\nimport type { AbstractSessionModel, Feature } from './index.ts'\n\nconst BPLIMIT = 20_000_000\n\nexport function useFeatureSequence({\n  session,\n  feature,\n  upDownBp,\n  forceLoad,\n  assemblyName,\n  shouldFetch = true,\n}: {\n  assemblyName: string\n  session?: AbstractSessionModel\n  feature: Feature\n  upDownBp: number\n  forceLoad: boolean\n  shouldFetch?: boolean\n}) {\n  const [sequence, setSequence] = useState<\n    | {\n        seq: string\n        upstream: string\n        downstream: string\n      }\n    | { error: string }\n  >()\n  const [error, setError] = useState<unknown>()\n  const [loading, setLoading] = useState(false)\n\n  const key = useMemo(() => {\n    if (!session || !shouldFetch) {\n      return null\n    }\n\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const refName = feature.get('refName')\n\n    return {\n      start,\n      end,\n      refName,\n      assemblyName,\n      upDownBp,\n      forceLoad,\n      sessionId: session.id || 'default',\n    }\n  }, [session, feature, assemblyName, upDownBp, forceLoad, shouldFetch])\n\n  useEffect(() => {\n    if (!key) {\n      setSequence(undefined)\n      setError(undefined)\n      return\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        setLoading(true)\n        setError(undefined)\n\n        const { start, end, refName, assemblyName, upDownBp, forceLoad } = key\n\n        if (!forceLoad && end - start > BPLIMIT) {\n          setSequence({\n            error: `Genomic sequence larger than ${BPLIMIT}bp, use \"force load\" button to display`,\n          })\n          return\n        }\n\n        const b = start - upDownBp\n        const e = end + upDownBp\n\n        const [seq, upstream, downstream] = await Promise.all([\n          fetchSeq({\n            start,\n            end,\n            refName,\n            assemblyName,\n            session: session!,\n          }),\n          fetchSeq({\n            start: Math.max(0, b),\n            end: start,\n            refName,\n            assemblyName,\n            session: session!,\n          }),\n          fetchSeq({\n            start: end,\n            end: e,\n            refName,\n            assemblyName,\n            session: session!,\n          }),\n        ] as const)\n\n        setSequence({\n          seq,\n          upstream,\n          downstream,\n        })\n      } catch (err) {\n        setError(err)\n      } finally {\n        setLoading(false)\n      }\n    })()\n  }, [key, session])\n\n  return {\n    sequence,\n    loading,\n    error,\n  }\n}\n","\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6\"\n}), 'Settings');"],"names":["SequencePanel","lazy","SequenceDialog","observer","model","feature","sequenceFeatureDetails","useState","createSequenceFeatureDetailsModel","useEffect","destroySequenceFeatureDetailsModel","upDownBp","seqPanelRef","useRef","openInDialog","setOpenInDialog","forceLoad","setForceLoad","session","getSession","assemblyName","view","assemblyNames","simpleFeature","useMemo","SimpleFeature","sequence","error","useFeatureSequence","setFeature","_jsxs","_Fragment","children","_jsx","SequenceTypeSelector","SequenceFeatureMenu","ref","extraItems","label","onClick","Suspense","fallback","LoadingEllipses","handleClose","type","Typography","ErrorMessage","color","Button","variant","SequenceFeatureSettingsDialog","forwardRef","Error","showSettings","setShowSettings","showCoordinatesSetting","showGenomicCoordsOption","CascadingMenuButton","menuItems","async","default","copy","r","current","textContent","format","outerHTML","saveAs","Blob","subMenu","checked","setShowCoordinates","icon","Settings","MoreVert","useStyles","makeStyles","formControl","margin","marginLeft","classes","intronBp","mode","hasCDS","hasExonOrCDS","FormControl","className","Select","size","value","onChange","event","setMode","target","Object","entries","cds","protein","cdna","gene","gene_updownstream","gene_collapsed_intron","gene_updownstream_collapsed_intron","genomic","genomic_sequence_updownstream","map","key","val","MenuItem","fetchSeq","start","end","refName","rpcManager","assemblyManager","assembly","waitForAssembly","sessionId","adapterConfig","getConf","canonicalRefName","getCanonicalRefName2","seqAdapterRefName","getSeqAdapterRefName","call","region","shouldFetch","setSequence","setError","loading","setLoading","get","id","undefined","b","e","seq","upstream","downstream","Promise","all","Math","max","err","createSvgIcon","d"],"sourceRoot":""}