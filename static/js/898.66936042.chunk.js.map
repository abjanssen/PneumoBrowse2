{"version":3,"file":"static/js/898.66936042.chunk.js","mappings":"2KAqBA,SAASA,EACPC,EACAC,EACAC,EACAC,GAEA,MAAMC,EAAYH,EAAKG,YAAa,EAC9BC,EAAYJ,EAAKK,gBAAkB,KAEnCC,EAAS,IAAIC,EAAAA,EAA+B,CAChDC,OAAQ,EACRC,OAAQ,EACRL,cAIIM,EAAgBP,EAAY,EAAI,EAGtC,IAAK,MAAM,GAAEQ,EAAE,KAAEC,EAAI,KAAEC,EAAI,MAAEC,KAAWf,EACtCO,EAAOS,QAAQJ,EAAIC,EAAMC,EAAMX,EAAgBQ,EAAe,CAC5DM,KAAMF,EAAM,GACZG,KAAM,cACNC,OAAQ,cACRC,SAAUN,EAAOD,IAKrB,MAAMQ,EAAgB,IAAIC,IAC1B,IAAK,MAAOV,EAAIW,KAAShB,EAAOiB,gBAAiB,CAC/C,MAAMC,EAAMF,EAAK,GACjBF,EAAcK,IAAId,EAAIa,EACxB,CAEA,MAAO,CAAEJ,gBAAeM,aAAcpB,EAAOqB,iBAC/C,CAEO,SAASC,EACd5B,EACA6B,IAEAC,EAAAA,EAAAA,IAAgB9B,EAAM6B,EAAK/B,EAC7B,C","sources":["../../../plugins/alignments/src/LinearReadCloudDisplay/drawFeatsStack.ts"],"sourcesContent":["import GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\n\nimport { drawFeatsCommon } from './drawFeatsCommon'\n\nimport type { ComputedChain } from './drawFeatsCommon'\nimport type { LinearReadCloudDisplayModel } from './model'\nimport type { ReducedFeature } from '../shared/fetchChains'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface LayoutData {\n  feat: ReducedFeature\n  fill: string\n  stroke: string\n  distance: number\n}\n\n/**\n * Calculate Y-offsets using GranularRectLayout for stacking\n */\nfunction calculateStackYOffsets(\n  computedChains: ComputedChain[],\n  self: LinearReadCloudDisplayModel,\n  _view: LGV,\n  featureHeight: number,\n) {\n  const noSpacing = self.noSpacing ?? false\n  const maxHeight = self.trackMaxHeight ?? 1200\n\n  const layout = new GranularRectLayout<LayoutData>({\n    pitchX: 1,\n    pitchY: 1,\n    maxHeight,\n  })\n\n  // Add small padding between rows (unless noSpacing is enabled)\n  const layoutPadding = noSpacing ? 0 : 1\n\n  // First pass: add all dummy chain rectangles to the layout\n  for (const { id, minX, maxX, chain } of computedChains) {\n    layout.addRect(id, minX, maxX, featureHeight + layoutPadding, {\n      feat: chain[0]!, // Use first feature as a placeholder for layout data\n      fill: 'transparent',\n      stroke: 'transparent',\n      distance: maxX - minX,\n    })\n  }\n\n  // Second pass: retrieve laid-out rectangles and populate chainYOffsets\n  const chainYOffsets = new Map<string, number>()\n  for (const [id, rect] of layout.getRectangles()) {\n    const top = rect[1]\n    chainYOffsets.set(id, top) // Store the Y-offset (top) for the chain\n  }\n\n  return { chainYOffsets, layoutHeight: layout.getTotalHeight() }\n}\n\nexport function drawFeats(\n  self: LinearReadCloudDisplayModel,\n  ctx: CanvasRenderingContext2D,\n) {\n  drawFeatsCommon(self, ctx, calculateStackYOffsets)\n}\n"],"names":["calculateStackYOffsets","computedChains","self","_view","featureHeight","noSpacing","maxHeight","trackMaxHeight","layout","GranularRectLayout","pitchX","pitchY","layoutPadding","id","minX","maxX","chain","addRect","feat","fill","stroke","distance","chainYOffsets","Map","rect","getRectangles","top","set","layoutHeight","getTotalHeight","drawFeats","ctx","drawFeatsCommon"],"sourceRoot":""}