"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6746,6999],{66999:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var n=r(7552),o=r(68446),s=r(99546),a=r(373);const l="rgb(220,220,180)",c="rgba(250,200,200)";function d({str:e,charactersPerRow:t,showCoordinates:r,currRemainder:n=0,splitSize:o=10}){const s=Math.ceil(e.length/t),a=new Array(s);let l=n%10,c=0,d=0;for(;c<s+1;++c){const s=0===c?t-n:t,m=e.slice(d,d+s);if(!m)break;if(r){let e="";for(let t=0,r=l;t<m.length;t++,r++)r%o==0&&(e+=" ",r=0),e+=m[t];e&&(a[c]=e)}else a[c]=m;l=0,d+=s}return{segments:a,remainder:((a.at(-1)?.replaceAll(" ","").length||0)+(c<2?n:0))%t}}const m=(0,o.observer)((function({chunks:e,start:t,color:r,strand:o=1,coordStart:s=t,model:a}){const{charactersPerRow:l,showCoordinates:c}=a;return e.map(((a,d)=>{const m=0===d&&t%l==0||d>0?`${(""+(s-t%l+d*o*l)).padStart(4)}   `:"",u=d===e.length-1&&(e.at(-1)?.replaceAll(" ","").length||0)+(0===d?t%l:0)!==l?null:c?" \n":"";return n.createElement(n.Fragment,{key:`${a}-${d}`},c?m:null,n.createElement("span",{style:{background:r}},a),u)}))})),u=(0,o.observer)((function({utr:e,cds:t,exons:r,sequence:o,upstream:s,downstream:a,feature:u,includeIntrons:i,collapseIntron:h,model:g}){const{upperCaseCDS:f,intronBp:w,charactersPerRow:p,showCoordinates:E,showCoordinatesSetting:C}=g,b=t.length>0,k=(t.length?[...t,...e].sort(((e,t)=>e.start-t.start)):r).filter((e=>e.start!==e.end)),q=e=>f?e.toLowerCase():e,S=e=>f?e.toUpperCase():e,v=-1===u.strand?-1:1,R="genomic"===C&&i&&!h,y=R?v:1;let P=R?v>0?u.start+1-(s?.length||0):u.end+(s?.length||0):0,$=0,_=0,x=null;if(s){const{segments:e,remainder:t}=d({str:q(s),charactersPerRow:p,showCoordinates:E});x=n.createElement(m,{model:g,color:c,strand:y,start:$,coordStart:P,chunks:e}),_=t,$+=s.length*y,P+=s.length*y}const A=[];for(let e=0;e<k.length;e++){const t=k[e],r=o.slice(t.end,k[e+1]?.start),s=o.slice(t.start,t.end),{segments:a,remainder:c}=d({str:b?"CDS"===t.type?S(s):q(s):S(s),charactersPerRow:p,currRemainder:_,showCoordinates:E});if(A.push(n.createElement(m,{key:`${JSON.stringify(t)}-mid`,model:g,color:"CDS"===t.type?l:"rgb(200,240,240)",strand:y,start:$,coordStart:P,chunks:a})),_=c,$+=s.length*y,P+=s.length*y,r&&i&&e<k.length-1){const e=q(h&&r.length>2*w?`${r.slice(0,w)}...${r.slice(-w)}`:r),{segments:o,remainder:s}=d({str:e,charactersPerRow:p,currRemainder:_,showCoordinates:E});o.length&&(A.push(n.createElement(m,{key:`${JSON.stringify(t)}-intron`,model:g,strand:y,coordStart:P,start:$,chunks:o})),_=s,$+=e.length*y,P+=e.length*y)}}let D=null;if(a){const{segments:e}=d({str:q(a),charactersPerRow:p,currRemainder:_,showCoordinates:E});D=n.createElement(m,{start:$,model:g,strand:y,chunks:e,coordStart:P,color:c})}return n.createElement(n.Fragment,null,x,A,D)})),i=(0,o.observer)((function({cds:e,sequence:t,model:r}){const{charactersPerRow:o,showCoordinates:s}=r,{segments:c}=d({str:(0,a.o9)(e,t),charactersPerRow:o,showCoordinates:s});return n.createElement(m,{model:r,color:l,chunks:c,start:0})})),h=(0,o.observer)((function({sequence:e,upstream:t,feature:r,downstream:o,model:s}){const{charactersPerRow:a,showCoordinatesSetting:l,showCoordinates:u}=s;let i=0,h=null,g=0;const f=-1===r.strand?-1:1,w="genomic"===l,p=w?f:1;let E=w?f>0?r.start+1-(t?.length||0):r.end+(t?.length||0):0;if(t){const{segments:e,remainder:r}=d({str:t,charactersPerRow:a,showCoordinates:u});h=n.createElement(m,{model:s,color:c,start:i,coordStart:E,chunks:e}),g=r,i+=t.length*p,E+=t.length*p}const{segments:C,remainder:b}=d({str:e,charactersPerRow:a,showCoordinates:u,currRemainder:g}),k=n.createElement(m,{model:s,color:"rgb(200,280,200)",start:i,coordStart:E,chunks:C});g=b,i+=e.length*p,E+=e.length*p;let q=null;if(o){const{segments:e}=d({str:o,charactersPerRow:a,currRemainder:g,showCoordinates:u});q=n.createElement(m,{start:i,model:s,chunks:e,coordStart:E,color:c})}return n.createElement(n.Fragment,null,h,k,q)})),g=(0,o.observer)((function({cds:e,sequence:t,codonTable:r,model:o}){const{charactersPerRow:s,showCoordinates:l}=o,c=(0,a.o9)(e,t);let u="";for(let e=0;e<c.length;e+=3)u+=r[c.slice(e,e+3)]||"&";const{segments:i}=d({str:u,charactersPerRow:s,showCoordinates:l});return n.createElement(m,{model:o,color:"rgb(220,160,220)",chunks:i,start:0})}));function f({children:e}){return n.createElement("pre",{style:{fontFamily:"monospace",color:"black",fontSize:11}},e)}function w({children:e}){return n.createElement("div",{style:{fontFamily:"monospace",color:"black",fontSize:11,maxWidth:600,whiteSpace:"wrap",wordBreak:"break-all"}},e)}function p({mode:e,model:t,feature:r}){return n.createElement("div",{style:{background:"white"}},`>${[[r.name||r.id,e].filter((e=>!!e)).join("-"),`${r.refName}:${(0,s.toLocale)(r.start+1)}-${(0,s.toLocale)(r.end)}${o=r.strand,-1===o?"(-)":1===o?"(+)":""}`,e.endsWith("updownstream")?`+/- ${(0,s.toLocale)(t.upDownBp)} up/downstream bp`:""].filter((e=>!!e)).join(" ")}\n`);var o}function E({mode:e,feature:t,sequence:r,model:o}){let{seq:l,upstream:c="",downstream:d=""}=r;const{subfeatures:m=[]}=t,f=m.sort(((e,t)=>e.start-t.start)).map((e=>({...e,start:e.start-t.start,end:e.end-t.start})));let w=(0,a.Qq)(f.filter((e=>"CDS"===e.type))),p=(0,a.Qq)(f.filter((e=>e.type?.match(/utr/i)))),E=(0,a.Qq)(f.filter((e=>"exon"===e.type)));!p.length&&w.length&&E.length&&(p=(0,a.h8)(w,E)),p.length||!w.length||E.length||(p=(0,a.V4)(w,{start:0,end:t.end-t.start,type:"gene"})),-1===t.strand&&([l,c,d]=[(0,s.revcom)(l),(0,s.revcom)(d),(0,s.revcom)(c)],w=(0,a.YC)(w,l.length),E=(0,a.YC)(E,l.length),p=(0,a.YC)(p,l.length));const C=(0,s.generateCodonTable)(s.defaultCodonTable);return n.createElement(n.Fragment,null,"genomic"===e?n.createElement(h,{feature:t,model:o,sequence:l}):"genomic_sequence_updownstream"===e?n.createElement(h,{model:o,feature:t,sequence:l,upstream:c,downstream:d}):"cds"===e?n.createElement(i,{model:o,cds:w,sequence:l}):"cdna"===e?n.createElement(u,{model:o,exons:E,feature:t,cds:w,utr:p,sequence:l}):"protein"===e?n.createElement(g,{model:o,cds:w,codonTable:C,sequence:l}):"gene"===e?n.createElement(u,{model:o,exons:E,feature:t,cds:w,utr:p,sequence:l,includeIntrons:!0}):"gene_collapsed_intron"===e?n.createElement(u,{model:o,exons:E,feature:t,cds:w,sequence:l,utr:p,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===e?n.createElement(u,{model:o,exons:E,feature:t,cds:w,sequence:l,utr:p,upstream:c,downstream:d,includeIntrons:!0}):"gene_updownstream_collapsed_intron"===e?n.createElement(u,{model:o,exons:E,feature:t,cds:w,sequence:l,utr:p,upstream:c,downstream:d,includeIntrons:!0,collapseIntron:!0}):n.createElement("div",null,"Unknown type"))}const C=(0,o.observer)(n.forwardRef((function(e,t){const{sequence:r,model:o,feature:s}=e,{showCoordinates:a,mode:l}=o,c=a?f:w;return n.createElement("div",{"data-testid":"sequence_panel",ref:t,style:{maxHeight:300,overflow:"auto"}},n.createElement(c,null,n.createElement(p,{model:o,mode:l,feature:s}),n.createElement(E,{model:o,mode:l,feature:s,sequence:r})))})))},76746:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var n=r(7552),o=r(49823),s=r(29499),a=r(36715),l=r(5401),c=r(58507),d=r(68446),m=r(75785),u=r(66999),i=r(78781),h=r(54579),g=r(14465);const f=(0,m.n9)()({dialogContent:{width:"80em"},formControl:{margin:0,marginLeft:4}}),w=(0,d.observer)((function({handleClose:e,model:t,feature:r}){const{sequenceFeatureDetails:d}=t,{upDownBp:m}=d,{classes:w}=f(),p=(0,n.useRef)(null),[E,C]=(0,n.useState)(!1),{sequence:b,error:k}=(0,i.p)(t,r,m,E);return n.createElement(o.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{e()},title:"Sequence view"},n.createElement(s.A,{className:w.dialogContent},n.createElement("div",null,n.createElement(g.A,{model:d}),n.createElement(h.A,{ref:p,model:d})),n.createElement("div",null,"gene"===r.type?n.createElement(a.A,null,"Note: inspect subfeature sequences for protein/CDS computations"):null,k?n.createElement(o.ErrorMessage,{error:k}):b?"error"in b?n.createElement(n.Fragment,null,n.createElement(a.A,{color:"error"},b.error),n.createElement(l.A,{variant:"contained",color:"inherit",onClick:()=>{C(!0)}},"Force load")):n.createElement(n.Suspense,{fallback:n.createElement(o.LoadingEllipses,null)},n.createElement(u.default,{ref:p,feature:r,sequence:b,model:d})):n.createElement(o.LoadingEllipses,null))),n.createElement(c.A,null,n.createElement(l.A,{onClick:()=>{e()},variant:"contained"},"Close")))}))}}]);
//# sourceMappingURL=6746.eaaf86dc.chunk.js.map