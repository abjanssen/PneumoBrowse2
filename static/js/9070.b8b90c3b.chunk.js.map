{"version":3,"file":"static/js/9070.b8b90c3b.chunk.js","mappings":"0LAUO,SAASA,EACdC,EACAC,GAeA,SAASC,EAAKC,GACZ,MAAMC,EAASJ,EAAKK,IACpB,IAAKD,EACH,OAGF,MAAME,EAAMF,EAAOG,WAAW,MAC9B,IAAKD,EACH,OAGF,IAAKN,EAAKQ,UACR,OAGF,MAAMC,EAAS,iBAAkBT,EAAOA,EAAKU,cAAgB,EAAIV,EAAKS,OACtEH,EAAIK,iBAEJL,EAAIM,UAAU,EAAG,EAAGR,EAAOS,MAAOT,EAAOK,QACzCH,EAAIQ,MAAM,EAAG,GACbb,EAAGD,EAAMM,EAAKF,EAAOS,MAAOJ,GAC5BT,EAAKe,qBAAqBZ,EAAKa,UAC/BhB,EAAKiB,oBAAoBd,EAAKe,QAChC,EA/BAC,EAAAA,EAAAA,IACEnB,EACAoB,gBCgBGA,eACLpB,GAEA,MAAMqB,GAAYC,EAAAA,EAAAA,iBAAgBtB,IAC5B,WAAEuB,IAAeC,EAAAA,EAAAA,YAAWxB,GAC5BG,GAAOsB,EAAAA,EAAAA,mBAAkBzB,GAE/B,IAAKG,EAAKuB,aAAe1B,EAAK2B,QAAU3B,EAAK4B,+BAC3C,OAGF5B,EAAK6B,YAAW,GAChB,MAAMC,QAAaP,EAAWQ,KAAKV,EAAW,2BAA4B,CACxEA,YACAW,QAAS7B,EAAK8B,aAAaC,cAC3BC,SAAUnC,EAAKmC,SACfC,cAAepC,EAAKoC,gBAGtBpC,EAAKqC,aAAaP,GAClB9B,EAAK6B,YAAW,EAClB,CDpCYS,CAAYtC,IAEpB,CAAEuC,MAAO,OA6BXpB,EAAAA,EAAAA,IAAcnB,EAAMoB,UAClB,MAAMjB,GAAOsB,EAAAA,EAAAA,mBAAkBzB,GAC3BG,EAAKe,UAAYlB,EAAKwC,kBACxBtC,EAAKC,MAKTgB,EAAAA,EAAAA,IACEnB,EACAoB,UAEElB,GADauB,EAAAA,EAAAA,mBAAkBzB,KAGjC,CAAEuC,MAAO,KAEb,C","sources":["../../../plugins/alignments/src/shared/afterAttach.tsx","../../../plugins/alignments/src/shared/fetchChains.ts"],"sourcesContent":["import { getContainingView } from '@jbrowse/core/util'\n\nimport { createAutorun } from '../util'\nimport { fetchChains } from './fetchChains'\n\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport type { IAnyStateTreeNode } from 'mobx-state-tree'\n\ntype LGV = LinearGenomeViewModel\n\nexport function doAfterAttach<T extends IAnyStateTreeNode>(\n  self: T,\n  cb: (\n    self: T,\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number,\n  ) => void,\n) {\n  createAutorun(\n    self,\n    async () => {\n      await fetchChains(self)\n    },\n    { delay: 1000 },\n  )\n\n  function draw(view: LGV) {\n    const canvas = self.ref\n    if (!canvas) {\n      return\n    }\n\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      return\n    }\n\n    if (!self.chainData) {\n      return\n    }\n\n    const height = 'layoutHeight' in self ? self.layoutHeight || 1 : self.height\n    ctx.resetTransform()\n    // Clear entire canvas to avoid artifacts when content height changes on scroll\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.scale(2, 2)\n    cb(self, ctx, canvas.width, height)\n    self.setLastDrawnOffsetPx(view.offsetPx)\n    self.setLastDrawnBpPerPx(view.bpPerPx)\n  }\n\n  // first autorun instantly draws if bpPerPx changes\n  createAutorun(self, async () => {\n    const view = getContainingView(self) as LGV\n    if (view.bpPerPx !== self.lastDrawnBpPerPx) {\n      draw(view)\n    }\n  })\n\n  // second autorun draws after delay 1000 e.g. if offsetPx changes\n  createAutorun(\n    self,\n    async () => {\n      const view = getContainingView(self) as LGV\n      draw(view)\n    },\n    { delay: 1000 },\n  )\n}\n","import { getContainingView, getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\n\nimport type { LinearReadArcsDisplayModel } from '../LinearReadArcsDisplay/model'\nimport type { LinearReadCloudDisplayModel } from '../LinearReadCloudDisplay/model'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nexport interface ReducedFeature {\n  name: string\n  strand: number\n  refName: string\n  start: number\n  end: number\n  id: string\n  flags: number\n  tlen: number\n  pair_orientation: string\n  next_ref?: string\n  next_pos?: number\n  clipPos: number\n  SA?: string\n}\n\nexport interface ChainStats {\n  max: number\n  min: number\n  upper: number\n  lower: number\n}\n\nexport interface ChainData {\n  chains: ReducedFeature[][]\n  stats?: ChainStats\n}\n\nexport async function fetchChains(\n  self: LinearReadArcsDisplayModel | LinearReadCloudDisplayModel,\n) {\n  const sessionId = getRpcSessionId(self)\n  const { rpcManager } = getSession(self)\n  const view = getContainingView(self) as LGV\n\n  if (!view.initialized || self.error || !self.statsReadyAndRegionNotTooLarge) {\n    return\n  }\n\n  self.setLoading(true)\n  const ret = (await rpcManager.call(sessionId, 'PileupGetReducedFeatures', {\n    sessionId,\n    regions: view.staticBlocks.contentBlocks,\n    filterBy: self.filterBy,\n    adapterConfig: self.adapterConfig,\n  })) as ChainData\n\n  self.setChainData(ret)\n  self.setLoading(false)\n}\n"],"names":["doAfterAttach","self","cb","draw","view","canvas","ref","ctx","getContext","chainData","height","layoutHeight","resetTransform","clearRect","width","scale","setLastDrawnOffsetPx","offsetPx","setLastDrawnBpPerPx","bpPerPx","createAutorun","async","sessionId","getRpcSessionId","rpcManager","getSession","getContainingView","initialized","error","statsReadyAndRegionNotTooLarge","setLoading","ret","call","regions","staticBlocks","contentBlocks","filterBy","adapterConfig","setChainData","fetchChains","delay","lastDrawnBpPerPx"],"sourceRoot":""}