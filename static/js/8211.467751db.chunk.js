"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8211],{70900(e,t,n){n.d(t,{A:()=>g});var o=n(30128),r=n(23886),s=n(69566),l=n(55614),i=n(87377),a=n(85510),c=n(44460);const h=function(e){const t=(0,l.c)(4),{source:n,idx:o,rowHeight:r}=e,{color:s}=n;let i;return t[0]!==s||t[1]!==o||t[2]!==r?(i=s?(0,c.jsx)(a.A,{y:o*r,x:0,width:15.5,height:r+.5,color:s}):null,t[0]=s,t[1]=o,t[2]=r,t[3]=i):i=t[3],i},d=function(e){const t=(0,l.c)(6),{source:n,idx:o,rowHeight:r,textFillProps:s}=e,{color:i,name:a}=n,h=Math.min(r,12),d=(o+.5)*r,u=i?17:0;let x;return t[0]!==a||t[1]!==h||t[2]!==d||t[3]!==u||t[4]!==s?(x=(0,c.jsx)("text",{y:d,x:u,fontSize:h,dominantBaseline:"central",...s,children:a}),t[0]=a,t[1]=h,t[2]=d,t[3]=u,t[4]=s,t[5]=x):x=t[5],x},u=(0,s.observer)(function({model:e,labelWidth:t}){const{canDisplayLegendLabels:n,rowHeight:s,sources:l}=e,u=(0,i.A)(),x=t+((0,o.useMemo)(()=>l?.some(e=>e.color)??!1,[l])?20:0),g=(0,o.useMemo)(()=>(0,r.getFillProps)(u.palette.text.primary),[u.palette.text.primary]);return l?(0,c.jsxs)(c.Fragment,{children:[n?(0,c.jsx)(a.A,{y:0,x:0,width:x,height:(l.length+.25)*s}):null,l.map((e,t)=>(0,c.jsx)(h,{source:e,idx:t,rowHeight:s},`${e.name}-${t}`)),n?l.map((e,t)=>(0,c.jsx)(d,{source:e,idx:t,rowHeight:s,textFillProps:g},`${e.name}-text-${t}`)):null]}):null}),x=(0,s.observer)(function({children:e,model:t,exportSVG:n}){const{id:o,scrollTop:s,height:l,hierarchy:i,treeAreaWidth:a,showTree:h}=t,d=`legend-${"undefined"==typeof jest?o:"test"}`,u=i&&h?a:0;return n?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("defs",{children:(0,c.jsx)("clipPath",{id:d,children:(0,c.jsx)("rect",{x:0,y:0,width:1e3,height:l})})}),(0,c.jsx)("g",{clipPath:`url(#${d})`,children:(0,c.jsx)("g",{transform:`translate(0,${-s})`,children:e})})]}):(0,c.jsx)("svg",{style:{position:"absolute",top:0,left:u,zIndex:100,pointerEvents:"none",height:t.totalHeight,width:(0,r.getContainingView)(t).width},children:e})}),g=(0,s.observer)(function(e){const{model:t}=e,{canDisplayLegendLabels:n,rowHeight:s,sources:l}=t,i=Math.min(s,12),a=(0,o.useMemo)(()=>{if(!l)return 0;let e=0;for(const t of l){const o=n?(0,r.measureText)(t.name,i)+10:20;o>e&&(e=o)}return e},[l,i,n]);return l?(0,c.jsx)(x,{...e,children:(0,c.jsx)(u,{model:t,labelWidth:a})}):null})},85510(e,t,n){n.d(t,{A:()=>c});var o=n(55614),r=n(23886),s=n(7201),l=n(87377),i=n(67114),a=n(44460);const c=e=>{const t=(0,o.c)(11),{x:n,y:c,width:h,height:d,color:u}=e,x=(0,l.A)();let g,p,m;return t[0]!==u||t[1]!==x?(g=u||(0,s.X4)(x.palette.background.paper,i.U),t[0]=u,t[1]=x,t[2]=g):g=t[2],t[3]!==g?(p=(0,r.getFillProps)(g),t[3]=g,t[4]=p):p=t[4],t[5]!==d||t[6]!==p||t[7]!==h||t[8]!==n||t[9]!==c?(m=(0,a.jsx)("rect",{pointerEvents:"auto",x:n,y:c,width:h,height:d,...p}),t[5]=d,t[6]=p,t[7]=h,t[8]=n,t[9]=c,t[10]=m):m=t[10],m}},68211(e,t,n){n.r(t),n.d(t,{default:()=>v});var o=n(83826),r=n(69566),s=n(70900),l=n(30128),i=n(35864),a=n(23886),c=n(61425),h=n(46625),d=n(7201),u=n(68673),x=n(79291),g=n(44934),p=n(67114),m=n(44460);const f=(0,h.n)()(e=>({resizeHandle:{position:"absolute",top:0,height:"100%",width:4,zIndex:101,background:"transparent","&:hover":{background:e.palette.divider}},treeBackground:{position:"absolute",top:0,left:0,background:(0,d.X4)(e.palette.background.paper,p.U)}}));function w(e){return e.children?.length?e.children.flatMap(e=>w(e)):[e.data.name]}const j=(0,r.observer)(function({model:e}){const{classes:t}=f(),{width:n}=(0,a.getContainingView)(e),[o,r]=(0,l.useState)(null),[s,h]=(0,l.useState)([]),[d,p]=(0,l.useState)(null),{hierarchy:j,treeAreaWidth:b,height:v,scrollTop:y,showTree:S,sources:C}=e,H=(0,l.useCallback)(t=>{e.setTreeCanvasRef(t)},[e,b,v]),A=(0,l.useCallback)(t=>{e.setMouseoverCanvasRef(t)},[e,n,v]);(0,l.useEffect)(()=>(0,g.autorun)(function(){const{treeAreaWidth:t,hierarchy:n,totalHeight:o}=e;if(!n)return r(null),void h([]);const s=n.descendants().filter(e=>e.children?.length),l=new c.A(s.length);for(const e of s){const t=e.y,n=e.x;l.add(t-8,n-8,t+8,n+8)}l.finish(),r(l),h(s)},{name:"TreeSpatialIndex"}),[e]);const F=(0,l.useCallback)(t=>{if(!j||!o)return;const n=t.currentTarget.getBoundingClientRect(),r=t.clientX-n.left,l=t.clientY-n.top+y,i=o.search(r,l,r,l),a=i.length>0?s[i[0]]:void 0;if(a){const t=w(a);e.setHoveredTreeNode({node:a,descendantNames:t})}else e.setHoveredTreeNode(void 0)},[j,o,s,y,e]),T=(0,l.useCallback)(()=>{e.setHoveredTreeNode(void 0)},[e]),k=(0,l.useCallback)(e=>{if(!j||!o)return;const t=e.currentTarget.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top+y,l=o.search(n,r,n,r),i=l.length>0?s[l[0]]:void 0;if(i){const t=w(i);p({x:e.clientX,y:e.clientY,names:t})}},[j,o,s,y]),V=(0,l.useCallback)(()=>{p(null)},[]);return j&&S&&C?.length?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{style:{position:"sticky",top:0,left:0,height:0,zIndex:100},children:[(0,m.jsx)("div",{className:t.treeBackground,style:{width:b,height:v}}),(0,m.jsx)("canvas",{ref:H,width:2*b,height:2*v,style:{width:b,height:v,position:"absolute",top:0,left:0,pointerEvents:"none"}}),(0,m.jsx)("canvas",{ref:A,width:n,height:v,style:{width:n,height:v,position:"absolute",top:0,left:0,zIndex:1,pointerEvents:"none"}}),(0,m.jsx)("div",{onMouseMove:F,onMouseLeave:T,onClick:k,style:{position:"absolute",top:0,left:0,width:b,height:v,zIndex:2,cursor:"pointer"}})]}),(0,m.jsx)(i.A,{onDrag:t=>{e.setTreeAreaWidth(Math.max(50,b+t))},className:t.resizeHandle,style:{left:b},vertical:!0}),(0,m.jsxs)(u.A,{open:!!d,onClose:V,anchorReference:"anchorPosition",anchorPosition:d?{top:d.y,left:d.x}:void 0,children:[e.subtreeFilter?.length?(0,m.jsx)(x.A,{onClick:()=>{e.setSubtreeFilter(void 0),V()},children:"Clear subtree filter"}):null,(0,m.jsxs)(x.A,{onClick:()=>{d&&e.setSubtreeFilter(d.names),V()},children:["Show only subtree (",d?.names.length," samples)"]})]})]}):null});var b=n(9478);const v=(0,r.observer)(function(e){const{model:t}=e,{isMultiRow:n}=t;return(0,m.jsxs)("div",{children:[n?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(j,{model:t}),(0,m.jsx)(s.A,{model:t})]}):null,(0,m.jsx)(o.Ay,{...e}),(0,m.jsx)(b.A,{model:t})]})})},9478(e,t,n){n.d(t,{A:()=>j});var o=n(69566),r=n(23886),s=n(30128),l=n(87377),i=n(55614),a=n(85510),c=n(44460);const h=function(e){const t=(0,i.c)(18),{source:n,idx:o,rowHeight:r,labelWidth:s,model:l,exportSVG:h}=e,d=Math.min(20,r),{needsCustomLegend:u,graphType:x,needsFullHeightScalebar:g,rowHeightTooSmallForScalebar:p,renderColorBoxes:m}=l,f=m?15:0,w=s+f+5,j=(h?10:0)||(x&&!p?50:0);let b,v,y;return t[0]!==d||t[1]!==j||t[2]!==o||t[3]!==w||t[4]!==g||t[5]!==r?(b=g?null:(0,c.jsx)(a.A,{y:o*r+1,x:j,width:w,height:d}),t[0]=d,t[1]=j,t[2]=o,t[3]=w,t[4]=g,t[5]=r,t[6]=b):b=t[6],t[7]!==d||t[8]!==f||t[9]!==j||t[10]!==o||t[11]!==u||t[12]!==r||t[13]!==n.color?(v=n.color?(0,c.jsx)(a.A,{y:o*r+1,x:j,width:f,height:u?r:d,color:n.color}):null,t[7]=d,t[8]=f,t[9]=j,t[10]=o,t[11]=u,t[12]=r,t[13]=n.color,t[14]=v):v=t[14],t[15]!==b||t[16]!==v?(y=(0,c.jsxs)(c.Fragment,{children:[b,v]}),t[15]=b,t[16]=v,t[17]=y):y=t[17],y},d=function(e){const t=(0,i.c)(9),{source:n,idx:o,rowHeight:r,model:s,exportSVG:l,textFillProps:a}=e,{graphType:h,rowHeightTooSmallForScalebar:d,renderColorBoxes:u}=s,x=Math.min(r,12),g=r>=6,p=u?15:0,m=(l?10:0)||(h&&!d?50:0);let f;return t[0]!==g||t[1]!==p||t[2]!==m||t[3]!==o||t[4]!==r||t[5]!==n||t[6]!==x||t[7]!==a?(f=g?(0,c.jsx)("text",{y:o*r+x,x:m+p+2,fontSize:x,...a,children:n.name}):null,t[0]=g,t[1]=p,t[2]=m,t[3]=o,t[4]=r,t[5]=n,t[6]=x,t[7]=a,t[8]=f):f=t[8],f},u=(0,o.observer)(function({model:e,rowHeight:t,exportSVG:n}){const{graphType:o,needsFullHeightScalebar:i,rowHeightTooSmallForScalebar:u,renderColorBoxes:x,sources:g,labelWidth:p}=e,m=p+(x?20:0)+5,f=(n?10:0)||(o&&!u?50:0),w=(0,l.A)(),j=(0,s.useMemo)(()=>(0,r.getFillProps)(w.palette.text.primary),[w.palette.text.primary]);return g?(0,c.jsxs)(c.Fragment,{children:[i?(0,c.jsx)(a.A,{y:0,x:f,width:m,height:(g.length+.25)*t}):null,g.map((o,r)=>(0,c.jsx)(h,{source:o,idx:r,model:e,rowHeight:t,exportSVG:n,labelWidth:m},`${o.name}-${r}`)),g.map((o,r)=>(0,c.jsx)(d,{source:o,idx:r,model:e,rowHeight:t,exportSVG:n,textFillProps:j},`${o.name}-text-${r}`))]}):null});var x=n(20223),g=n(20702);const p=(0,o.observer)(function({model:e,orientation:t,exportSVG:n}){const{labelWidth:o}=e,{width:s}=(0,r.getContainingView)(e);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("g",{transform:`translate(${n?0:(0,x.A3)(e)},0)`,children:(0,c.jsx)(g.A,{model:e,orientation:t})}),(0,c.jsx)("g",{transform:`translate(${s-o-100},0)`,children:(0,c.jsx)(u,{exportSVG:n,model:e,rowHeight:12})})]})}),m=(0,o.observer)(function({model:e}){const{ticks:t,scaleType:n}=e,{width:o}=(0,r.getContainingView)(e),s=`[${t?.values[0]}-${t?.values[1]}]${"log"===n?" (log scale)":""}`,l=(0,r.measureText)(s,14),i=o-l-25;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(a.A,{y:0,x:i,width:l+6,height:16}),(0,c.jsx)("text",{y:13,x:i,children:s})]})}),f=(0,o.observer)(function({model:e,orientation:t,exportSVG:n}){const{sources:o,rowHeight:r,rowHeightTooSmallForScalebar:s,needsCustomLegend:l,ticks:i,hierarchy:a,showTree:h}=e,d=a&&h;return o?.length?(0,c.jsxs)(c.Fragment,{children:[d?null:(0,c.jsx)(u,{exportSVG:n,model:e,rowHeight:e.rowHeight}),s||l?(0,c.jsx)(m,{model:e}):o.map((n,o)=>(0,c.jsx)("g",{transform:`translate(0 ${r*o})`,children:(0,c.jsx)(g.A,{model:e,orientation:t})},`${JSON.stringify(i)}-${o}`))]}):null}),w=(0,o.observer)(function({children:e,model:t,exportSVG:n}){const{height:o}=t;return n?e:(0,c.jsx)("svg",{style:{position:"absolute",top:0,left:0,pointerEvents:"none",height:o,width:(0,r.getContainingView)(t).width},children:e})}),j=(0,o.observer)(function(e){const{model:t,orientation:n,exportSVG:o}=e,{showSidebar:r,stats:s,needsFullHeightScalebar:l,sources:i}=t;return s&&i?(0,c.jsx)(w,{...e,children:r?l?(0,c.jsx)(p,{model:t,orientation:n,exportSVG:o}):(0,c.jsx)(f,{model:t,orientation:n,exportSVG:o}):null}):null})},67114(e,t,n){n.d(t,{U:()=>o});const o=.8},20223(e,t,n){n.d(t,{A3:()=>i,BO:()=>s,oJ:()=>l});var o=n(17378),r=n(23886);function s(e,t,n=1){const o=t.map(t=>e.findIndex(e=>e.name===t)).sort((e,t)=>e-t);let r=0;for(const t of o){const o=Math.max(r,t-n);o>=r&&e.splice(o,0,e.splice(t,1)[0]),r+=1}return e}function l(e,t,n=1){const o=t.map(t=>e.findIndex(e=>e.name===t)).sort((e,t)=>t-e);let r=e.length-1;for(const t of o){const o=Math.min(r,t+n);o<=r&&e.splice(o,0,e.splice(t,1)[0]),r-=1}return e}function i(e){const{prefersOffset:t}=e,{trackLabels:n}=(0,r.getContainingView)(e),s=(0,r.getContainingTrack)(e),l=(0,o.FI)(s,"name");return"overlapping"!==n||t?10:(0,r.measureText)(l,12.8)+100}}}]);
//# sourceMappingURL=8211.467751db.chunk.js.map