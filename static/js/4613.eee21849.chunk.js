"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4613],{14613(e,t,i){i.d(t,{doAfterAttach:()=>h});var n=i(23886),o=i(89147),a=i(10533),s=i(153),r=i(44934),l=i(57763),f=i(49303),c=i(87185),d=i(2433);function h(e){(0,a.addDisposer)(e,(0,r.autorun)(function(){if(e.isMinimized)return;const t=(0,n.getContainingView)(e);if(!t.initialized||!t.views.every(e=>e.displayedRegions.length>0&&e.initialized))return;const i=e.mainCanvas?.getContext("2d"),o=e.cigarClickMapCanvas?.getContext("2d");if(!i||!o)return;const{alpha:a}=e,s=e.height,r=t.width;i.clearRect(0,0,r,s),(0,l.W)(e,i),function(e,t){const i=(0,n.getContainingView)(e),o=i.drawCurves,a=i.drawCIGAR,s=i.drawCIGARMatchesOnly,{level:r,height:l,featPositions:h}=e,g=i.width,u=i.views.map(e=>e.bpPerPx);t.imageSmoothingEnabled=!1,t.clearRect(0,0,g,l);const m=i.views.map(e=>e.offsetPx),v=1/u[r],b=1/u[r+1];for(const{p11:e,p12:n,p21:u,p22:p,f:M,cigar:w}of h){const h=e.offsetPx-m[r],C=n.offsetPx-m[r],y=u.offsetPx-m[r+1],x=p.offsetPx-m[r+1],P=Math.abs(C-h),k=Math.abs(x-y),T=Math.min(y,x),S=Math.max(y,x),R=0,W=l,I=(W-R)/2;if(!(P<=d.m$&&k<=d.m$)&&(0,f.R6)(T,S,-d.u5,i.width+d.u5)){const e=M.get("strand"),i=-1===e?C:h,n=i<(-1===e?h:C)?1:-1,r=(y<x?1:-1)*e;let l=i,f=-1===e?x:y;if(w.length&&a){let e=!1,i=0,a=0;const h=Math.floor(d.xx/w.length);for(let u=0;u<w.length;u+=2){const m=+w[u],p=w[u+1];e||(i=l,a=f);const M=m*v,C=m*b;if("M"===p||"="===p||"X"===p?(l+=M*n,f+=C*r):"D"===p||"N"===p?l+=M*n:"I"===p&&(f+=C*r),!(Math.max(i,a,l,f)<0||Math.min(i,a,l,f)>g)){const n=u<w.length-2;if(Math.abs(l-i)<=1&&Math.abs(f-a)<=1&&n)e=!0;else if(e=!1,!s||("M"===p||"="===p||"X"===p)&&Math.abs(l-i)>1&&Math.abs(f-a)>1){const e=u*h+1;t.fillStyle=(0,d._b)(e),(0,c.$2)(t,i,l,R,f,a,W,I,o),t.fill()}}}}}}}(e,o)},{name:"SyntenyDraw"})),(0,a.addDisposer)(e,(0,r.autorun)(function(){if(e.isMinimized)return;const t=(0,n.getContainingView)(e);if(!t.initialized||!t.views.every(e=>e.displayedRegions.length>0&&e.initialized))return;const{clickId:i,mouseoverId:o}=e;!function(e){const{level:t,clickId:i,mouseoverId:o}=e,a=(0,n.getContainingView)(e),s=a.drawCurves,r=e.height,l=a.width,f=e.mouseoverCanvas?.getContext("2d"),h=a.views.map(e=>e.offsetPx);if(!f)return;f.resetTransform(),f.clearRect(0,0,l,r),f.strokeStyle="rgba(0, 0, 0, 0.9)",f.fillStyle="rgba(0, 0, 0, 0.1)";const g=e.featMap[o||""];g&&(0,c.mr)({cb:e=>{e.fill()},feature:g,level:t,ctx:f,oobLimit:d.u5,viewWidth:a.width,drawCurves:s,offsets:h,height:r});const u=e.featMap[i||""];u&&(0,c.mr)({cb:e=>{e.stroke()},feature:u,ctx:f,level:t,oobLimit:d.u5,viewWidth:a.width,drawCurves:s,offsets:h,height:r})}(e)},{name:"SyntenyMouseover"})),(0,a.addDisposer)(e,(0,r.reaction)(()=>{if(e.isMinimized)return{initialized:!1};const t=(0,n.getContainingView)(e);return{bpPerPx:t.views.map(e=>e.bpPerPx),displayedRegions:JSON.stringify(t.views.map(e=>e.displayedRegions)),features:e.features,initialized:t.initialized&&t.views.every(e=>e.displayedRegions.length>0&&e.initialized)}},({initialized:t})=>{if(!t)return;const{level:i}=e,{assemblyManager:r}=(0,n.getSession)(e),l=(0,n.getContainingView)(e).views.map(e=>({...(0,a.getSnapshot)(e),width:e.width,staticBlocks:e.staticBlocks,interRegionPaddingWidth:e.interRegionPaddingWidth,minimumBlockWidth:e.minimumBlockWidth})),f=[],c=e.features||[];for(const e of c){const t=e.get("mate");let n=e.get("start"),a=e.get("end");const c=t.start,d=t.end;-1===e.get("strand")&&([a,n]=[n,a]);const h=r.get(e.get("assemblyName")),g=r.get(t.assemblyName),u=e.get("refName"),m=t.refName,v=h?.getCanonicalRefName(u)||u,b=g?.getCanonicalRefName(m)||m,p=l[i],M=l[i+1],w=(0,o.eB)({self:p,refName:v,coord:n}),C=(0,o.eB)({self:p,refName:v,coord:a}),y=(0,o.eB)({self:M,refName:b,coord:c}),x=(0,o.eB)({self:M,refName:b,coord:d});if(void 0===w||void 0===C||void 0===y||void 0===x)continue;const P=e.get("CIGAR");f.push({p11:w,p12:C,p21:y,p22:x,f:e,cigar:s.eL(P)})}e.setFeatPositions(f)},{fireImmediately:!0}))}},87185(e,t,i){i.d(t,{$2:()=>l,Eg:()=>g,WT:()=>d,bo:()=>f,f0:()=>h,mr:()=>r});var n=i(23886),o=i(16640),a=i(49303),s=i(2433);function r({feature:e,ctx:t,offsets:i,level:n,cb:o,height:s,drawCurves:r,oobLimit:f,viewWidth:c,hideTiny:d}){const{p11:h,p12:g,p21:u,p22:m}=e,v=h.offsetPx-i[n],b=g.offsetPx-i[n],p=u.offsetPx-i[n+1],M=m.offsetPx-i[n+1],w=Math.abs(b-v),C=Math.abs(M-p),y=s,x=(y-0)/2,P=Math.min(p,M),k=Math.max(p,M);(0,a.R6)(P,k,-f,c+f)&&(w<=1&&C<=1?d||(t.beginPath(),t.moveTo(v,0),r?t.bezierCurveTo(v,x,p,x,p,y):t.lineTo(p,y),t.stroke()):(l(t,v,b,0,M,p,y,x,r),o(t)))}function l(e,t,i,n,o,a,s,r,l){l?function(e,t,i,n,o,a,s,r){const l=Math.abs(t-i),f=Math.abs(t-i);if(l<5&&f<5&&i<t&&Math.abs(t-o)>100){const e=t;t=i,i=e}e.beginPath(),e.moveTo(t,n),e.lineTo(i,n),e.bezierCurveTo(i,r,o,r,o,s),e.lineTo(a,s),e.bezierCurveTo(a,r,t,r,t,n),e.closePath()}(e,t,i,n,o,a,s,r):function(e,t,i,n,o,a,s){e.beginPath(),e.moveTo(t,n),e.lineTo(i,n),e.lineTo(o,s),e.lineTo(a,s),e.closePath()}(e,t,i,n,o,a,s)}function f(e,t,i,n,o,a,s,r,l,f,c){const d=(Math.abs(i-t)+Math.abs(a-o))/2;if(d<30)return;const h=Math.max(2,Math.floor(d/20)+1),g=e.strokeStyle,u=e.lineWidth;if(e.strokeStyle="rgba(0, 0, 0, 0.25)",e.lineWidth=.5,e.beginPath(),c)for(let l=0;l<h;l++){const f=l/h,c=t+(i-t)*f,d=a+(o-a)*f;e.moveTo(c,n),e.bezierCurveTo(c,r,d,r,d,s)}else for(let r=0;r<h;r++){const l=r/h,f=t+(i-t)*l,c=a+(o-a)*l;e.moveTo(f,n),e.lineTo(c,s)}e.stroke(),e.strokeStyle=g,e.lineWidth=u}function c(e,t){const{clickMapCanvas:i,numFeats:n,featPositions:o}=t;if(!i)return;const a=i.getContext("2d");if(!a)return;const r=i.getBoundingClientRect(),l=e.clientX-r.left,f=e.clientY-r.top,[c,d,h]=a.getImageData(l,f,1,1).data,g=Math.floor(s.xx/n);return o[(0,s.OX)(c,d,h,g)]}function d(e,t){const i=c(e,t);if(i){const{f:e}=i;t.setClickId(e.id());const a=(0,n.getSession)(t);if((0,o.lO)(a)){const i=(0,n.getContainingView)(t),o=(0,n.getContainingTrack)(t);a.showWidget(a.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:i,track:o,featureData:e.toJSON(),level:t.level}))}}return i}function h(e,t,i){e.preventDefault();const n=c(e,t);n&&(t.setClickId(n.f.id()),i({clientX:e.clientX,clientY:e.clientY,feature:n}))}function g({feature:e,cigarOp:t,cigarOpLen:i}){const o=e.toJSON(),a=o.mate,s=o.end-o.start,r=a.end-a.start,l=o.identity,f=o.name,c=a.name;return[`Loc1: ${(0,n.assembleLocString)(o)}`,`Loc2: ${(0,n.assembleLocString)(a)}`,`Inverted: ${-1===o.strand}`,`Query len: ${(0,n.toLocale)(s)}`,`Target len: ${(0,n.toLocale)(r)}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${(0,n.toLocale)(+i)}${t}`:"",f?`Name 1: ${f}`:"",c?`Name 2: ${c}`:""].filter(e=>!!e).join("<br/>")}},57763(e,t,i){i.d(t,{W:()=>l});var n=i(23886),o=i(49303),a=i(87185),s=i(2433);const r=e=>{e.fill()};function l(e,t){const i=(0,n.getContainingView)(e),l=i.drawCurves,f=i.drawCIGAR,c=i.drawCIGARMatchesOnly,d=i.drawLocationMarkers,{level:h,height:g,featPositions:u,minAlignmentLength:m,colorBy:v}=e,b=i.width,p=i.views.map(e=>e.bpPerPx),M=e.colorMapWithAlpha,w=e.posColorWithAlpha,C=e.negColorWithAlpha,y=e.queryColorWithAlphaMap,x=e.queryTotalLengths,P=i.views.map(e=>e.offsetPx),k=P[h],T=P[h+1],S=Math.floor(s.xx/u.length),R=g,W=(R-0)/2,I="strand"===v,N="query"===v,$=p[h],z=p[h+1],L=1/$,A=1/z,B=e.clickMapCanvas?.getContext("2d");B&&(B.imageSmoothingEnabled=!1,B.clearRect(0,0,b,g)),t.fillStyle=M.M,t.strokeStyle=M.M;for(const[e,n]of u.entries()){const u=n,{p11:v,p12:p,p21:D,p22:O,f:V,cigar:X}=u,G=V.get("strand"),_=V.get("refName");if(x){const e=V.get("name")||V.get("id")||V.id();if((x.get(e)||0)<m)continue}const F=v.offsetPx-k,j=p.offsetPx-k,q=D.offsetPx-T,E=O.offsetPx-T,J=Math.abs(j-F),Y=Math.abs(E-q),Q=Math.min(q,E),H=Math.max(q,E);if(J<=s.m$&&Y<=s.m$&&q<b+s.u5&&q>-s.u5)t.strokeStyle=I?-1===G?C:w:N?y(_):M.M,t.beginPath(),t.moveTo(F,0),l?t.bezierCurveTo(F,W,q,W,q,R):t.lineTo(q,R),t.stroke();else if((0,o.R6)(Q,H,-s.u5,i.width+s.u5)){const e=-1===G?j:F,i=e<(-1===G?F:j)?1:-1,n=(q<E?1:-1)*G;let o=e,s=-1===G?E:q;if(X.length&&f){let e=!1,r=0,f=0;for(let h=0;h<X.length;h+=2){const g=+X[h],u=X[h+1];e||(r=o,f=s);const m=g*L,v=g*A;if("M"===u||"="===u||"X"===u?(o+=m*i,s+=v*n):"D"===u||"N"===u?o+=m*i:"I"===u&&(s+=v*n),!(Math.max(r,f,o,s)<0||Math.min(r,f,o,s)>b)){const i=h<X.length-2;if(Math.abs(o-r)<=1&&Math.abs(s-f)<=1&&i)e=!0;else{const i=e&&m>1||v>1?u:"M",n="I"===i||"D"===i||"N"===i;t.fillStyle=I&&!n?-1===G?C:w:N&&!n?y(_):M[i],e=!1,c?"M"===i&&((0,a.$2)(t,r,o,0,s,f,R,W,l),t.fill(),d&&(0,a.bo)(t,r,o,0,s,f,R,W,$,z,l)):((0,a.$2)(t,r,o,0,s,f,R,W,l),t.fill(),d&&(0,a.bo)(t,r,o,0,s,f,R,W,$,z,l))}}}}else I?t.fillStyle=-1===G?C:w:N&&(t.fillStyle=y(_)),(0,a.$2)(t,F,j,0,E,q,R,W,l),t.fill(),(I||N)&&(t.fillStyle=M.M)}if(B){const t=e*S+1;B.fillStyle=(0,s._b)(t),(0,a.mr)({cb:r,feature:u,ctx:B,drawCurves:l,level:h,offsets:P,oobLimit:s.u5,viewWidth:i.width,hideTiny:!0,height:g})}}}}}]);
//# sourceMappingURL=4613.eee21849.chunk.js.map