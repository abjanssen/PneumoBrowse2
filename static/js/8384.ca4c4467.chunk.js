"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8384],{88384:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var a=n(68446),r=n(67758),s=n(75785),o=n(69500);const i=(0,s.n9)()({blockError:{background:"#f1f1f1",padding:10,color:"red"}});function c(e){const t=(0,r.c)(3),{error:n}=e,{classes:a}=i(),s=`${n}`;let c;return t[0]!==a.blockError||t[1]!==s?(c=(0,o.jsx)("div",{className:a.blockError,children:s}),t[0]=a.blockError,t[1]=s,t[2]=c):c=t[2],c}const l=(0,s.n9)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10}}});function u(e){const t=(0,r.c)(3),{messageText:n}=e,{classes:a}=l();let s;return t[0]!==a.blockMessage||t[1]!==n?(s=(0,o.jsx)("div",{className:a.blockMessage,children:n}),t[0]=a.blockMessage,t[1]=n,t[2]=s):s=t[2],s}var d=n(7552),g=n(99546),f=n(42489),v=n(30385),m=n(67112);function p(e){const t=(0,r.c)(17),{model:n,onClose:a,anchorEl:s}=e;let i;t[0]!==n?(i=(0,g.getContainingView)(n),t[0]=n,t[1]=i):i=t[1];const c=i,{clientX:l,clientY:u,feature:d}=s;let f,v;t[2]!==a?(f=(e,t)=>{t(e),a()},t[2]=a,t[3]=f):f=t[3],t[4]!==l||t[5]!==u?(v={nodeType:1,getBoundingClientRect:()=>({top:u,left:l,bottom:u,right:l,width:0,height:0,x:l,y:u,toJSON(){}})},t[4]=l,t[5]=u,t[6]=v):v=t[6];const p=Boolean(s);let b,h;return t[7]!==d||t[8]!==n||t[9]!==c?(b=[{label:"Center on feature",onClick:()=>{const{f:e}=d,t=e.get("start"),a=e.get("end"),r=e.get("refName"),s=e.get("mate"),o=c.views[n.level],i=c.views[n.level+1],l=o.assemblyNames[0],u=i.assemblyNames[0];o.navToLocString(`${r}:${t}-${a}`).catch(e=>{const t=`${l}:${e}`;console.error(l,t),(0,g.getSession)(n).notifyError(t,e)}),i.navToLocString(`${s.refName}:${s.start}-${s.end}`).catch(e=>{const t=`${u}:${e}`;console.error(u,t),(0,g.getSession)(n).notifyError(t,e)})}}],t[7]=d,t[8]=n,t[9]=c,t[10]=b):b=t[10],t[11]!==a||t[12]!==f||t[13]!==v||t[14]!==p||t[15]!==b?(h=(0,o.jsx)(m.Menu,{onMenuItemClick:f,anchorEl:v,onClose:a,open:p,menuItems:b}),t[11]=a,t[12]=f,t[13]=v,t[14]=p,t[15]=b,t[16]=h):h=t[16],h}var b=n(79610);const h=(0,d.lazy)(()=>n.e(7831).then(n.bind(n,47831))),x=(0,s.n9)()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},mouseoverCanvas:{position:"absolute",pointEvents:"none"},mainCanvas:{position:"absolute"}}),C=(0,a.observer)(function({model:e}){const{classes:t}=x(),{mouseoverId:n,height:a}=e,r=(0,d.useRef)(0),s=(0,g.getContainingView)(e),i=s.width,c=(0,d.useRef)(0),l=(0,d.useRef)(!1),u=(0,d.useRef)(null),[m,C]=(0,d.useState)(),[k,w]=(0,d.useState)(""),[M,j]=(0,d.useState)(),[E,S]=(0,d.useState)(),[$,N]=(0,d.useState)(),[R,X]=(0,d.useState)(),y=(0,d.useRef)(null),T=(0,d.useCallback)(t=>{e.setMouseoverCanvasRef(t)},[e,a,i]),I=(0,d.useCallback)(t=>{e.setMainCanvasRef(t),y.current=t},[e,a,i]);(0,d.useEffect)(()=>{function e(e){if(e.preventDefault(),e.ctrlKey){c.current+=e.deltaY/500;for(const e of s.views)e.setScaleFactor(c.current<0?1-c.current:1/(1+c.current));u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{for(const t of s.views)t.setScaleFactor(1),t.zoomTo(c.current>0?t.bpPerPx*(1+c.current):t.bpPerPx/(1-c.current),e.clientX-(y.current?.getBoundingClientRect().left||0));c.current=0},300)}else Math.abs(e.deltaY)<Math.abs(e.deltaX)&&(r.current+=e.deltaX/2),l.current||(l.current=!0,window.requestAnimationFrame(()=>{(0,f.transaction)(()=>{for(const e of s.views)e.horizontalScroll(r.current);r.current=0,l.current=!1})}))}return y.current?.addEventListener("wheel",e),()=>{y.current?.removeEventListener("wheel",e)}},[e,a,i]);const L=(0,d.useCallback)(t=>{e.setClickMapCanvasRef(t)},[e,a,i]),P=(0,d.useCallback)(t=>{e.setCigarClickMapCanvasRef(t)},[e,a,i]);return(0,o.jsxs)("div",{className:t.rel,children:[(0,o.jsx)("canvas",{ref:T,width:i,height:a,className:t.mouseoverCanvas}),(0,o.jsx)("canvas",{ref:I,onMouseMove:t=>{if(void 0!==E)r.current+=E-t.clientX,S(t.clientX),l.current||(l.current=!0,window.requestAnimationFrame(()=>{(0,f.transaction)(()=>{for(const e of s.views)e.horizontalScroll(r.current);r.current=0,l.current=!1})}));else{const n=e.clickMapCanvas,a=e.cigarClickMapCanvas;if(!n||!a)return;const r=n.getBoundingClientRect(),s=n.getContext("2d"),o=a.getContext("2d");if(!s||!o)return;const{clientX:i,clientY:c}=t,l=i-r.left,u=c-r.top;j(i),X(c);const[d,g,f]=s.getImageData(l,u,1,1).data,[m,p,h]=o.getImageData(l,u,1,1).data,x=Math.floor(v.xx/e.numFeats),C=(0,v.OX)(d,g,f,x);if(e.setMouseoverId(e.featPositions[C]?.f.id()),-1===C)w("");else if(e.featPositions[C]){const{f:t,cigar:n}=e.featPositions[C],a=Math.floor(v.xx/n.length),r=(0,v.OX)(m,p,h,a);w(r%2!=0||0===m&&0===p&&0===h?"":(0,b.Eg)({feature:t,cigarOp:n[r+1],cigarOpLen:n[r]}))}}},onMouseLeave:()=>{e.setMouseoverId(void 0),N(void 0),S(void 0)},onMouseDown:e=>{S(e.clientX),N(e.clientX)},onMouseUp:t=>{S(void 0),void 0!==$&&Math.abs(t.clientX-$)<5&&(0,b.WT)(t,e)},onContextMenu:t=>{(0,b.f0)(t,e,C)},"data-testid":"synteny_canvas",className:t.mainCanvas,width:i,height:a}),(0,o.jsx)("canvas",{ref:L,className:t.pix,width:i,height:a}),(0,o.jsx)("canvas",{ref:P,className:t.pix,width:i,height:a}),n&&k&&M&&R?(0,o.jsx)(h,{title:k}):null,m?(0,o.jsx)(p,{model:e,anchorEl:m,onClose:()=>{C(void 0)}}):null]})}),k=(0,s.n9)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}});function w(e){const t=(0,r.c)(5),{message:n}=e,{classes:a}=k();let s,i;return t[0]!==n?(s=(0,o.jsx)(m.LoadingEllipses,{message:n}),t[0]=n,t[1]=s):s=t[1],t[2]!==a.loading||t[3]!==s?(i=(0,o.jsx)("div",{className:a.loading,children:s}),t[2]=a.loading,t[3]=s,t[4]=i):i=t[4],i}const M=(0,a.observer)(function({model:e}){return e.error?(0,o.jsx)(c,{error:e.error}):e.message?(0,o.jsx)(u,{messageText:e.message}):e.features?(0,o.jsx)(C,{model:e}):(0,o.jsx)(w,{message:e.loadingStatus})})}}]);
//# sourceMappingURL=8384.ca4c4467.chunk.js.map