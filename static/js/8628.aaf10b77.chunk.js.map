{"version":3,"file":"static/js/8628.aaf10b77.chunk.js","mappings":"sHAgBO,SAASA,EAAYC,GAC1B,OAAkB,IAAXA,EACH,yBACY,IAAZA,EACE,wBACA,uBACR,CAEO,SAASC,EAAoBD,GAClC,OAAkB,IAAXA,EACH,uBACY,IAAZA,EACE,sBACA,qBACR,CAEO,SAASE,EAAeF,GAC7B,OAAkB,IAAXA,EAAe,KAAkB,IAAZA,EAAgB,IAAM,SACpD,CAEO,SAASG,EACdC,EACAC,EACAC,EACAC,EACAC,GAEA,MAAMC,EAAQL,EAAQM,IAAI,SACpBC,EAAMP,EAAQM,IAAI,OAClBE,EAAUJ,EAASK,qBAAqBT,EAAQM,IAAI,YAEpDI,EAAUT,EAAKU,OAAO,CAAEH,UAASI,MAAOP,IACxCQ,EAAQZ,EAAKU,OAAO,CAAEH,UAASI,MAAOL,IAE5C,QAAgBO,IAAZJ,QAAmCI,IAAVD,EAC3B,OAGF,MAAME,EAAOL,EAAQP,SAAWA,EAC1Ba,EAAQH,EAAMV,SAAWA,EACzBP,EAASI,EAAQM,IAAI,oBAAsB,EAC3CW,EAAQjB,EAAQM,IAAI,UAAY,EAEtC,MAAO,CACLY,GAAIlB,EAAQkB,KACZC,KAAM,KAAKJ,KAA0B,GAAlBb,OAA2Ba,KAA0B,GAAlBb,MAA0Bc,KAA2B,GAAlBd,MAA0Bc,KAA2B,GAAlBd,IAC5HkB,OAAQzB,EAAYC,GACpByB,YAAaC,KAAKC,IAAIN,EAAQ,GAC9BZ,QACAE,MACAC,UACAS,QACArB,SAEJ,C,0HCOO4B,eAAeC,EACpBC,EACAC,EACAC,GAEA,MAAM3B,GAAO4B,EAAAA,EAAAA,mBAAkBH,GACzBI,QAAsBF,EAAeD,GACrCI,EAhER,SACEL,EACAzB,GAEA,MAAM,GAAEiB,EAAE,aAAEc,EAAY,OAAEC,EAAM,gBAAEC,GAAoBR,EAEtD,IAAKQ,GAA2C,IAAxBF,EAAaG,OACnC,OAAO,KAGT,MAAM,gBAAEC,IAAoBC,EAAAA,EAAAA,YAAWX,GACjCtB,EAAWgC,EAAgB9B,IAAIL,EAAKqC,cAAc,IACxD,IAAKlC,EACH,OAAO,KAGT,MAAMF,EAAkB+B,EAASM,GAC3BC,EAAkBvC,EAAKE,SACvBsC,EAAQxC,EAAKyC,cAAcC,aAG3BC,EAAOZ,EACVa,IAAIC,IACH/C,EAAAA,EAAAA,IAAiB+C,EAAG7C,EAAMC,EAAiBsC,EAAiBpC,IAE7D2C,OAAQC,QAAgDlC,IAARkC,GAEnD,GAAoB,IAAhBJ,EAAKT,OACP,OAAO,KAGT,MAAMc,EAAS,qBAAqB/B,IAEpC,OACEgC,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,QAAAD,UACEC,EAAAA,EAAAA,KAAA,YAAUnC,GAAI+B,EAAOG,UACnBC,EAAAA,EAAAA,KAAA,QAAMC,EAAG,EAAGC,EAAG,EAAGd,MAAOA,EAAOR,OAAQA,SAG5CoB,EAAAA,EAAAA,KAAA,KAAGG,SAAU,QAAQP,KAAUG,UAC7BC,EAAAA,EAAAA,KAAA,KAAGI,UAAW,kBAA0CL,SACrDR,EAAKC,IAAIG,IACRK,EAAAA,EAAAA,KAAA,QAEEK,EAAGV,EAAI7B,KACPC,OAAQ4B,EAAI5B,OACZC,YAAa2B,EAAI3B,YACjBsC,KAAK,QAJAX,EAAI9B,WAWvB,CASwB0C,CAAqBlC,EAAMzB,GAEjD,OACEiD,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAC,SAAA,CACGtB,EACAC,IAGP,C","sources":["../../../plugins/alignments/src/LinearSNPCoverageDisplay/components/arcUtils.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/components/renderSvg.tsx"],"sourcesContent":["import type { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport type { Feature } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport interface ArcData {\n  id: string\n  path: string\n  stroke: string\n  strokeWidth: number\n  start: number\n  end: number\n  refName: string\n  score: number\n  strand: number\n}\n\nexport function getArcColor(strand: number) {\n  return strand === 1\n    ? 'rgba(255,170,170,0.7)'\n    : strand === -1\n      ? 'rgba(160,160,255,0.7)'\n      : 'rgba(200,200,200,0.7)'\n}\n\nexport function getArcSelectedColor(strand: number) {\n  return strand === 1\n    ? 'rgba(255,100,100,1)'\n    : strand === -1\n      ? 'rgba(100,100,255,1)'\n      : 'rgba(120,120,120,1)'\n}\n\nexport function getStrandLabel(strand: number) {\n  return strand === 1 ? '+' : strand === -1 ? '-' : 'unknown'\n}\n\nexport function featureToArcData(\n  feature: Feature,\n  view: LinearGenomeViewModel,\n  effectiveHeight: number,\n  offsetPx: number,\n  assembly: Assembly,\n): ArcData | undefined {\n  const start = feature.get('start')\n  const end = feature.get('end')\n  const refName = assembly.getCanonicalRefName2(feature.get('refName'))\n\n  const startPx = view.bpToPx({ refName, coord: start })\n  const endPx = view.bpToPx({ refName, coord: end })\n\n  if (startPx === undefined || endPx === undefined) {\n    return undefined\n  }\n\n  const left = startPx.offsetPx - offsetPx\n  const right = endPx.offsetPx - offsetPx\n  const strand = feature.get('effectiveStrand') ?? 0\n  const score = feature.get('score') ?? 1\n\n  return {\n    id: feature.id(),\n    path: `M ${left} ${effectiveHeight * 0.9} C ${left} ${effectiveHeight * 0.1}, ${right} ${effectiveHeight * 0.1}, ${right} ${effectiveHeight * 0.9}`,\n    stroke: getArcColor(strand),\n    strokeWidth: Math.log(score + 1),\n    start,\n    end,\n    refName,\n    score,\n    strand,\n  }\n}\n","import { getContainingView, getSession } from '@jbrowse/core/util'\n\nimport { featureToArcData } from './arcUtils.ts'\n\nimport type { Feature } from '@jbrowse/core/util'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// Interface to avoid circular import with model.ts\ninterface SNPCoverageDisplayModel {\n  id: string\n  skipFeatures: Feature[]\n  height: number\n  showArcsSetting: boolean\n}\n\nconst YSCALEBAR_LABEL_OFFSET = 5\n\nfunction renderSashimiArcsSvg(\n  self: SNPCoverageDisplayModel,\n  view: LinearGenomeViewModel,\n) {\n  const { id, skipFeatures, height, showArcsSetting } = self\n\n  if (!showArcsSetting || skipFeatures.length === 0) {\n    return null\n  }\n\n  const { assemblyManager } = getSession(self)\n  const assembly = assemblyManager.get(view.assemblyNames[0]!)\n  if (!assembly) {\n    return null\n  }\n\n  const effectiveHeight = height - YSCALEBAR_LABEL_OFFSET * 2\n  const currentOffsetPx = view.offsetPx\n  const width = view.dynamicBlocks.totalWidthPx\n\n  // Generate arc data\n  const arcs = skipFeatures\n    .map(f =>\n      featureToArcData(f, view, effectiveHeight, currentOffsetPx, assembly),\n    )\n    .filter((arc): arc is NonNullable<typeof arc> => arc !== undefined)\n\n  if (arcs.length === 0) {\n    return null\n  }\n\n  const clipId = `sashimi-arcs-clip-${id}`\n\n  return (\n    <>\n      <defs>\n        <clipPath id={clipId}>\n          <rect x={0} y={0} width={width} height={height} />\n        </clipPath>\n      </defs>\n      <g clipPath={`url(#${clipId})`}>\n        <g transform={`translate(0, ${YSCALEBAR_LABEL_OFFSET})`}>\n          {arcs.map(arc => (\n            <path\n              key={arc.id}\n              d={arc.path}\n              stroke={arc.stroke}\n              strokeWidth={arc.strokeWidth}\n              fill=\"none\"\n            />\n          ))}\n        </g>\n      </g>\n    </>\n  )\n}\n\nexport async function renderSNPCoverageSvg(\n  self: SNPCoverageDisplayModel,\n  opts: ExportSvgDisplayOptions,\n  superRenderSvg: (opts: ExportSvgDisplayOptions) => Promise<React.ReactNode>,\n) {\n  const view = getContainingView(self) as LinearGenomeViewModel\n  const baseRendering = await superRenderSvg(opts)\n  const arcsRendering = renderSashimiArcsSvg(self, view)\n\n  return (\n    <>\n      {baseRendering}\n      {arcsRendering}\n    </>\n  )\n}\n"],"names":["getArcColor","strand","getArcSelectedColor","getStrandLabel","featureToArcData","feature","view","effectiveHeight","offsetPx","assembly","start","get","end","refName","getCanonicalRefName2","startPx","bpToPx","coord","endPx","undefined","left","right","score","id","path","stroke","strokeWidth","Math","log","async","renderSNPCoverageSvg","self","opts","superRenderSvg","getContainingView","baseRendering","arcsRendering","skipFeatures","height","showArcsSetting","length","assemblyManager","getSession","assemblyNames","YSCALEBAR_LABEL_OFFSET","currentOffsetPx","width","dynamicBlocks","totalWidthPx","arcs","map","f","filter","arc","clipId","_jsxs","_Fragment","children","_jsx","x","y","clipPath","transform","d","fill","renderSashimiArcsSvg"],"ignoreList":[],"sourceRoot":""}