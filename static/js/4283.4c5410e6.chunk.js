"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4283],{14283(n,e,o){o.r(e),o.d(e,{default:()=>w});var t=o(42918),c=o(77251),s=o(10525),i=o(65045),r=o(40446),a=o(48111),l=o(28069),d=o(639),u=o(60096),p=o(65525),f=o(64074),m=o(87574),g=o(79235),h=o(32118);const C=(0,f.observer)(function({connectionType:n,model:e,session:o}){const c=n.configEditorComponent||g.S;return(0,h.jsx)(t.Suspense,{fallback:(0,h.jsx)(m.A,{}),children:(0,h.jsx)(c,{model:{target:e},session:o})})});var b=o(84830),j=o(15675),v=o(9625);const y=(0,f.observer)(function({connectionTypeChoices:n,connectionType:e,setConnectionType:o}){const c=n[0];return(0,t.useEffect)(()=>{e||o(c)},[e,c,o]),(0,h.jsx)("form",{autoComplete:"off",children:e?(0,h.jsx)(j.A,{value:e.name,label:"connectionType",helperText:e.description?(0,h.jsxs)(h.Fragment,{children:[e.description,e.url?(0,h.jsx)(b.A,{href:e.url}):null]}):null,select:!0,fullWidth:!0,onChange:e=>{o(n.find(n=>n.name===e.target.value))},variant:"outlined",children:n.map(n=>(0,h.jsx)(v.A,{value:n.name,children:n.displayName||n.name},n.name))}):null})}),x=(0,i.n)()(n=>({root:{marginTop:n.spacing(1)},stepper:{backgroundColor:n.palette.background.default},button:{marginTop:n.spacing(1),marginRight:n.spacing(1)},actionsContainer:{marginBottom:n.spacing(2)}})),k=["Select a Connection Type","Configure Connection"],w=(0,f.observer)(function({model:n}){const[e,o]=(0,t.useState)(),[i,f]=(0,t.useState)(),[m,g]=(0,t.useState)(0),{classes:b}=x(),j=(0,c.getSession)(n),{pluginManager:v}=(0,c.getEnv)(j),w=(0,t.useMemo)(()=>e?.configSchema.create({connectionId:i},(0,c.getEnv)(n)),[i,e,n]);return(0,h.jsx)("div",{className:b.root,children:(0,h.jsx)(a.A,{className:b.stepper,activeStep:m,orientation:"vertical",children:k.map(t=>(0,h.jsxs)(l.A,{children:[(0,h.jsx)(d.A,{children:t}),(0,h.jsxs)(u.A,{children:[0===m?(0,h.jsx)(y,{connectionTypeChoices:v.getConnectionElements(),connectionType:e,setConnectionType:n=>{o(n),n&&f(`${n.name}-${Date.now()}`)}}):e&&w?(0,h.jsx)(C,{connectionType:e,model:w,session:j}):null,(0,h.jsxs)("div",{className:b.actionsContainer,children:[(0,h.jsx)(p.A,{disabled:0===m,onClick:()=>{g(m-1)},className:b.button,children:"Back"}),(0,h.jsx)(p.A,{disabled:!(0===m&&e||1===m&&w),variant:"contained",color:"primary",onClick:()=>{if(m===k.length-1){if(w&&(0,r.M)(j)){const n=j.addConnectionConf(w);j.makeConnection(n)}else j.notify("No config model to add");(0,s.lO)(j)&&j.hideWidget(n)}else g(m+1)},className:b.button,"data-testid":"addConnectionNext",children:m===k.length-1?"Connect":"Next"})]})]})]},t))})})})},40446(n,e,o){if(o.d(e,{F:()=>i,M:()=>r}),8792==o.j)var t=o(11259);if(8792==o.j)var c=o(99226);var s=o(15416);function i(n){return c.types.model({connectionInstances:c.types.array(n.pluggableMstType("connection","stateModel"))}).views(n=>({get connections(){const{jbrowse:e}=n;return e.connections}})).actions(e=>({makeConnection(o,c={}){const s=o.type;if(!s)throw new Error("track configuration has no `type` listed");const i=(0,t.QZ)(o,"name");if(!n.getConnectionType(s))throw new Error(`unknown connection type ${s}`);const r=e.connectionInstances.push({...c,name:i,type:s,configuration:o});return e.connectionInstances[r-1]},prepareToBreakConnection(n){const o=e,c=[],s={},i=(0,t.QZ)(n,"name"),r=e.connectionInstances.find(n=>n.name===i);if(r){for(const n of r.tracks){const e=o.getReferring(n);o.removeReferring(e,n,c,s)}return[()=>{for(const n of c)n();this.breakConnection(n)},s]}},breakConnection(n){const o=(0,t.QZ)(n,"name"),c=e.connectionInstances.find(n=>n.name===o);if(!c)throw new Error(`no connection found with name ${o}`);e.connectionInstances.remove(c)},deleteConnection(n){const{jbrowse:o}=e;return o.deleteConnectionConf(n)},addConnectionConf(n){const{jbrowse:o}=e;return o.addConnectionConf(n)},clearConnections(){e.connectionInstances.clear()}})).postProcessSnapshot(n=>{if(!n)return n;const{connectionInstances:e,...o}=n;return{...o,...e?.length?{connectionInstances:e}:{}}})}function r(n){return(0,s.qk)(n)&&"connectionInstances"in n}}}]);
//# sourceMappingURL=4283.4c5410e6.chunk.js.map