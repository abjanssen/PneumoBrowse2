"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5727],{95727:(e,t,r)=>{r.d(t,{A:()=>L});var n=r(7552),o=r(68446),a=r(36422),s=r(48231),i=r(99546),l=r(9502);function c(e,t){const r=e.get("ALT");if(r)return new Map(r.map((e=>(0,l.h)(e))).filter(i.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var u=r(49473),d=r(963);const g={F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},f={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"},p={color_fwd_strand_not_proper:(0,d.X4)("#CA6767",.8),color_rev_strand_not_proper:(0,d.X4)("#7272AA",.8),color_fwd_strand:(0,d.X4)("#DC2A2A",.8),color_rev_strand:(0,d.X4)("#4141BA",.8),color_fwd_missing_mate:(0,d.X4)("#921111",.8),color_rev_missing_mate:(0,d.X4)("#111192",.8),color_fwd_diff_chr:(0,d.X4)("#000000",.8),color_rev_diff_chr:(0,d.X4)("#696969",.8),color_pair_lr:(0,d.X4)("#8C8C8C",.8),color_pair_rr:(0,d.X4)("#00005A",.8),color_pair_rl:(0,d.X4)("#005A5A",.8),color_pair_ll:(0,d.X4)("#005A00",.8),color_nostrand:(0,d.X4)("#8C8C8C",.8),color_interchrom:(0,d.X4)("#5A005A",.8),color_longinsert:(0,d.X4)("#B30000",.8),color_shortinsert:(0,d.X4)("#FF3A5C",.8),color_unknown:(0,d.X4)("#555",.8)},h=p.color_unknown;function m(e,t){return-1===e&&1===t?p.color_pair_rr:1===e&&-1===t?p.color_pair_ll:p.color_unknown}function v(e,t){return-1===e&&1===t||1===e&&-1===t}function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_.apply(null,arguments)}const[k,,w]=[0,1,2,3],R=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:l,showIntraviewLinks:c}=e,d=(0,s.A)(),R=(0,i.getSession)(e),T=(0,a.getSnapshot)(e),{assemblyManager:y}=R,M=l[0],N=M?y.get(M.assemblyNames[0]):void 0;(0,u.E6)(T);const S=e.getTrackFeatures(t),b=(0,n.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(S)),[S]),E=(0,n.useMemo)((()=>{const r=e.getMatchedFeaturesInLayout(t,b?function(e){const t=new Map,r=new Set;for(const n of e.values()){const e=n.get("flags"),o=n.id(),a=4&e,s=2&e;if(!r.has(o)&&!s&&!a){const e=n.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(S):function(e){const t=new Map,r=new Set;for(const n of e.values()){const e=n.id(),o=4&n.get("flags"),a=!!n.get("tags")?.SA;if(!r.has(e)&&!o&&a){const e=n.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(S));if(!b)for(const e of r)e.sort(((e,t)=>e.clipPos-t.clipPos));return r}),[S,t,b,e]),[L,C]=(0,n.useState)();let O=0;if(r.current){const e=r.current.getBoundingClientRect();O=e.top}return N?n.createElement("g",{fill:"none","data-testid":E.length?`${t}-loaded`:t},E.map((e=>{const r=[];for(let a=0;a<e.length-1;a++){const{layout:s,feature:T,level:y}=e[a],{layout:M,feature:E,level:F}=e[a+1];if(!s||!M)return console.warn("received null layout for a overlay feature"),null;if(!c&&y===F)return null;const A=N.getCanonicalRefName(T.get("refName")),W=N.getCanonicalRefName(E.get("refName"));if(!A||!W)throw new Error(`unable to find ref for ${A||W}`);const X={pair_orientation:T.get("pair_orientation")},B=T.get("strand"),$=E.get("strand");let J="",I=!1;A===W&&(b?(J=function(e){const t=g[e.pair_orientation||""];return"LR"===t?void 0:p[f[t]]}(X)||h,I="LR"!==g[X.pair_orientation||""]):(J=m(B,$),I=v(B,$)));const P=s[-1===B?k:w],j=-1===$,D=b?M[j?k:w]:M[j?w:k],x=(0,u.Tp)(l[y],A,P),V=(0,u.Tp)(l[F],W,D),Y=l[y].pxToBp(x).reversed?-1:1,H=l[F].pxToBp(V).reversed?-1:1,q=l.map((e=>e.getTrack(t))),z=(0,u.Ec)(t,y,l,q,s,o)-O,G=(0,u.Ec)(t,F,l,q,M,o)-O,K=y===F&&I,Q=K?q[y].displays[0].height:0,U=b?-1:1,Z=(0,u.eW)(l,t,y,o),ee=["M",x,z,"C",x+200*T.get("strand")*Y,K?Math.min(Z-O+Q,z+Q):z,V-200*E.get("strand")*H*U,K?Math.min(Z-O+Q,G+Q):G,V,G].join(" "),te=`${T.id()}-${E.id()}`;r.push(n.createElement("path",_({d:ee,key:te,"data-testid":"r1",strokeWidth:L===te?5:1},(0,i.getStrokeProps)(J||d.palette.text.disabled),{onClick:()=>{const e=R.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(S.get(T.id())||{toJSON:()=>{}}).toJSON(),feature2:(S.get(E.id())||{toJSON:()=>{}}).toJSON()}});R.showWidget?.(e)},onMouseOver:()=>{C(te)},onMouseOut:()=>{C(void 0)}})))}return r}))):null})),[T]=[0,1,2,3],y=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:s}=e,d=(0,i.getSession)(e),{assemblyManager:g}=d,f=e.getTrackFeatures(t),p=(0,n.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"breakend"===n.get("type")){const e=n.get("ALT");e?.forEach((e=>{const r=`${n.get("refName")}:${n.get("start")+1}`,o=(0,l.h)(e);if(o){const e=t.get(r);e?e.push(n):t.set(o.MatePosition||"none",[n])}}))}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(f))),[f,t,e]),[h,m]=(0,n.useState)(),v=(0,a.getSnapshot)(e);(0,u.E6)(v);const _=g.get(s[0].assemblyNames[0]);if(!_)return null;let k=0;if(r.current){const e=r.current.getBoundingClientRect();k=e.top}return n.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":p.length?`${t}-loaded`:t},p.map((e=>{const r=[];for(let a=0;a<e.length-1;a+=1){const{layout:i,feature:l,level:g}=e[a],{layout:p,feature:v,level:w}=e[a+1],R=l.id(),y=c(l,v);if(!i||!p)return null;const M=l.get("refName"),N=v.get("refName"),S=_.getCanonicalRefName(M),b=_.getCanonicalRefName(N);if(!S||!b)throw new Error(`unable to find ref for ${S||b}`);const E=(0,u.Tp)(s[g],S,i[T]),L=(0,u.Tp)(s[w],b,p[T]),C=s[g].pxToBp(E).reversed,O=s[w].pxToBp(L).reversed,F=s.map((e=>e.getTrack(t))),A=(0,u.Ec)(t,g,s,F,i,o)-k,W=(0,u.Ec)(t,w,s,F,p,o)-k;if(y){const e=["M",E-20*("left"===y.Join?-1:1)*(C?-1:1),A,"L",E,A,"L",L,W,"L",L-20*("left"===y.MateDirection?1:-1)*(O?-1:1),W].join(" ");r.push(n.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:R===h?10:5,onClick:()=>{const e=d.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:f.get(R)?.toJSON()});d.showWidget?.(e)},onMouseOver:()=>{m(R)},onMouseOut:()=>{m(void 0)}}))}else console.warn("the relevant ALT allele was not found, cannot render")}return r})))})),[M]=[0,1,2,3];function N(e){return"+"===e?1:"-"===e?-1:0}const S=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:s}=e,l=(0,i.getSession)(e),{assemblyManager:c}=l,d=e.getTrackFeatures(t),g=(0,n.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],r=new Set;for(const n of e.values())r.has(n.id())||"<TRA>"!==n.get("ALT")[0]||t.push([n]),r.add(n.id());return t}(d))),[d,t,e]),[f,p]=(0,n.useState)(),h=(0,a.getSnapshot)(e);if((0,u.E6)(h),!c.get(s[0].assemblyNames[0]))return null;let m=0;if(r.current){const e=r.current.getBoundingClientRect();m=e.top}return s.length<2?null:n.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":g.length?`${t}-loaded`:t},g.map((e=>{const r=[];for(const{layout:a,feature:i,level:c}of e){const e=0===c?1:0,g=i.id();if(!a)return null;const h=i.get("INFO"),v=h.CHR2[0],_=h.END[0],k=h.STRANDS?.[0]?.split(""),[w,R]=k??[".","."],T=(0,u.Tp)(s[e],v,_);if(T){const h=[T,0,T+1,0],v=(0,u.Tp)(s[c],i.get("refName"),a[M]),_=T,k=s[c].pxToBp(v).reversed,y=s[e].pxToBp(_).reversed,S=s.map((e=>e.getTrack(t))),b=(0,u.Ec)(t,c,s,S,a,o)-m,E=(0,u.Ec)(t,e,s,S,h,o)-m,L=["M",v-20*N(w)*(k?-1:1),b,"L",v,b,"L",_,E,"L",_-20*N(R)*(y?-1:1),E].join(" ");r.push(n.createElement("path",{d:L,key:JSON.stringify(L),strokeWidth:g===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(d.get(g)||{toJSON:()=>{}}).toJSON()});l.showWidget?.(e)},onMouseOver:()=>{p(g)},onMouseOut:()=>{p(void 0)}}))}}return r})))})),[b]=[0,1,2,3],E=(0,o.observer)((function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:o}){const{views:s}=e,l=(0,i.getSession)(e),{assemblyManager:c}=l,d=e.getTrackFeatures(t),g=(0,n.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"paired_feature"===n.get("type")){const e=n.id().replace("-r1",""),r=n.id().replace("-r2","");n.id().endsWith("-r1")?(t.get(e)||t.set(e,[]),t.get(e).push(n)):n.id().endsWith("-r2")&&(t.get(r)||t.set(r,[]),t.get(r).push(n))}r.add(n.id())}return[...t.values()].filter((e=>e.length>1))}(d))),[d,t,e]),[f,p]=(0,n.useState)(),h=(0,a.getSnapshot)(e);(0,u.E6)(h);const m=c.get(s[0].assemblyNames[0]);if(!m)return null;let v=0;if(r.current){const e=r.current.getBoundingClientRect();v=e.top}return n.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":g.length?`${t}-loaded`:t},g.map((e=>{const r=[];for(let a=0;a<e.length-1;a+=1){const{layout:i,feature:c,level:g}=e[a],{layout:h,feature:_,level:k}=e[a+1],w=c.id();if(!i||!h)return null;const R=c.get("refName"),T=_.get("refName"),y=m.getCanonicalRefName(R),M=m.getCanonicalRefName(T);if(!y||!M)throw new Error(`unable to find ref for ${y||M}`);const N=(0,u.Tp)(s[g],y,i[b]),S=(0,u.Tp)(s[k],M,h[b]),E=s.map((e=>e.getTrack(t))),L=["M",N,(0,u.Ec)(t,g,s,E,i,o)-v,"L",S,(0,u.Ec)(t,k,s,E,h,o)-v].join(" ");r.push(n.createElement("path",{d:L,"data-testid":"r2",key:JSON.stringify(L),strokeWidth:w===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:d.get(w)?.toJSON()});l.showWidget?.(e)},onMouseOver:()=>{p(w)},onMouseOut:()=>{p(void 0)}}))}return r})))})),L=(0,o.observer)((function(e){const{model:t,trackId:r}=e,o=t.getMatchedTracks(r);return"AlignmentsTrack"===o[0]?.type?n.createElement(R,e):"VariantTrack"===o[0]?.type?t.hasTranslocations(r)?n.createElement(S,e):t.hasPairedFeatures(r)?n.createElement(E,e):n.createElement(y,e):null}))}}]);
//# sourceMappingURL=5727.891639aa.chunk.js.map