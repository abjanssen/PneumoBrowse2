"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6214],{28493:(e,t,r)=>{function n(e){const t=e?.trim().split(" ");return[0,1,2,3,5,6].every(e=>void 0!==t?.[e]&&!Number.isNaN(+t[e]))}function a(e){if(n(e)){const[t,r,n,a,s,i,o,c,u,d,l,p,m,h,f]=e.trim().split(" ");return{bitsw_score:t,percent_div:r,percent_del:n,percent_ins:a,query_chr:s,query_begin:i,query_end:o,query_remaining:c,orientation:u,matching_repeat_name:d,matching_repeat_class:l,matching_repeat_begin:p,matching_repeat_end:m,matching_repeat_remaining:h,repeat_id:f}}return{description:e}}function s({line:e,colRef:t,colStart:r,colEnd:n,scoreColumn:a,parser:s,uniqueId:o,names:c}){const u=e.split("\t");return i({splitLine:u,refName:u[t],start:Number.parseInt(u[r],10),end:Number.parseInt(u[n],10)+(r===n?1:0),parser:s,uniqueId:o,scoreColumn:a,names:c})}function i({splitLine:e,refName:t,start:r,end:s,parser:i,uniqueId:c,scoreColumn:u,names:d}){const l=d?function(e,t){let r=!1;const n=[];for(let a=0;a<t.length;a++)"blockCount"===e[a]&&(r=!0),n.push([e[a],t[a]]);const a=Object.fromEntries(n);if(r){const{blockStarts:e,blockCount:t,chromStarts:r,thickEnd:n,thickStart:s,blockSizes:i,...c}=a;return{...c,blockStarts:o(e),chromStarts:o(r),blockSizes:o(i),thickStart:s?+s:void 0,thickEnd:n?+n:void 0,blockCount:t?+t:void 0}}return a}(d,e):i.parseLine(e,{uniqueId:c}),{strand:p,score:m,chrom:h,chromStart:f,chromEnd:b,...k}=l,S=u?+l[u]:m?+m:void 0,N="string"==typeof p?"-"===p?-1:1:p,_=k.blockCount?function({start:e,uniqueId:t,refName:r,chromStarts:n,blockCount:a,blockSizes:s,blockStarts:i}){const o=[],c=n||i||[];for(let n=0;n<a;n++){const a=(c[n]||0)+e,i=s?.[n];if(i&&i>0){const e=a+i;o.push({uniqueId:`${t}-${n}`,start:a,end:e,refName:r,type:"block"})}}return o}({start:r,uniqueId:c,refName:t,chromStarts:k.chromStarts,blockCount:k.blockCount,blockSizes:k.blockSizes,blockStarts:k.blockStarts}):void 0;if(function({splitLine:e,start:t,end:r}){return+(e[6]||0)===t&&+(e[7]||0)===r&&[9,10,11,12,13,14,15,16,17].every(t=>e[t]&&!Number.isNaN(+e[t]))}({splitLine:e,start:r,end:s}))return function({splitLine:e,uniqueId:t,refName:r,start:n,end:a}){const[,,,s,,i,,,o,c,u,d,l,p,m,h,f,b]=e;return{uniqueId:t,refName:r,start:n,end:a,code:s,score:+u||0,strand:i,color:o,source:s,n_valid_cov:c,fraction_modified:u,n_mod:d,n_canonical:l,n_other_mod:p,n_delete:m,n_fail:h,n_diff:f,n_nocall:b}}({splitLine:e,uniqueId:c,refName:t,start:r,end:s});if(n(k.description)){const{chromStarts:e,blockSizes:n,blockStarts:i,type:o,blockCount:u,thickStart:d,thickEnd:l,description:p,...m}=k;return function({uniqueId:e,refName:t,start:r,end:n,description:s,...i}){const{subfeatures:o,...c}=i;return{...c,...a(s),uniqueId:e,refName:t,start:r,end:n}}({...m,uniqueId:c,description:p,type:o,score:S,start:r,end:s,strand:N,refName:t,subfeatures:_})}if(_&&function({thickStart:e,blockCount:t,strand:r}){return e&&t&&0!==r}({strand:N,blockCount:k.blockCount,thickStart:k.thickStart})){const{chromStarts:e,blockSizes:n,type:a,blockCount:i,thickStart:o,thickEnd:u,description:d}=k;return function(e){const{strand:t=0,chrom:r,chromStart:n,chromEnd:a,chromStarts:s,blockStarts:i,blockSizes:o,uniqueId:c,...u}=e,{subfeatures:d,thickStart:l,thickEnd:p,blockCount:m,refName:h,...f}=u,b=[],k=d.filter(e=>"block"===e.type).sort((e,t)=>e.start-t.start),{cdsEndStat:S,cdsStartStat:N}=f;if("none"===N&&"none"===S)return{...f,uniqueId:c,strand:t,type:"transcript",refName:h,subfeatures:k.map(e=>({...e,type:"exon"}))};for(const e of k){const r=e.start,n=e.end;l>=n?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:n,refName:h}):l>r&&l<n&&p>=n?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:l,refName:h},{type:"CDS",phase:0,start:l,end:n,refName:h}):l<=r&&p>=n?b.push({type:"CDS",phase:0,start:r,end:n,refName:h}):l>r&&l<n&&p<n?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:l,refName:h},{type:"CDS",phase:0,start:l,end:p,refName:h},{type:(t>0?"three":"five")+"_prime_UTR",start:p,end:n,refName:h}):l<=r&&p>r&&p<n?b.push({type:"CDS",phase:0,start:r,end:p,refName:h},{type:(t>0?"three":"five")+"_prime_UTR",start:p,end:n,refName:h}):p<=r&&b.push({type:(t>0?"three":"five")+"_prime_UTR",start:r,end:n,refName:h})}return{...f,uniqueId:c,strand:t,type:"mRNA",refName:h,subfeatures:b}}({...k,description:d,chromStarts:e,thickStart:o,thickEnd:u,blockSizes:n,blockCount:i,type:a,score:S,start:r,end:s,strand:N,refName:t,uniqueId:c,subfeatures:_})}return{...k,uniqueId:c,score:S,start:r,end:s,strand:N,refName:t,subfeatures:_}}function o(e){return void 0!==e?"string"==typeof e?e.split(",").map(e=>+e):e:void 0}r.d(t,{dE:()=>s,np:()=>i})},86214:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var n=r(41256),a=r(75466),s=r(46377),i=r(99546),o=r(99834),c=r(66885),u=r(37347),d=r(28493);class l extends s.BaseFeatureDataAdapter{static capabilities=["getFeatures","getRefNames"];constructor(e,t,r){super(e,t,r);const s=this.getConf("bedGzLocation"),i=this.getConf(["index","indexType"]),c=this.getConf(["index","location"]),u=this.getConf("autoSql"),d=this.pluginManager;this.bed=new a.wD({filehandle:(0,o.openLocation)(s,d),csiFilehandle:"CSI"===i?(0,o.openLocation)(c,d):void 0,tbiFilehandle:"CSI"!==i?(0,o.openLocation)(c,d):void 0,chunkCacheSize:52428800}),this.columnNames=this.getConf("columnNames"),this.scoreColumn=this.getConf("scoreColumn"),this.parser=new n.A({autoSql:u})}async getRefNames(e={}){return this.bed.getReferenceSequenceNames(e)}async getHeader(e){return this.bed.getHeader(e)}async getMetadataPre2(e){return this.setupP||(this.setupP=this.getMetadataPre().catch(e=>{throw this.setupP=void 0,e})),this.setupP}async getMetadataPre(){return{meta:await this.bed.getMetadata()}}async getMetadata(e){const{statusCallback:t=()=>{}}=e||{};return(0,i.updateStatus)("Downloading index",t,()=>this.getMetadataPre2(e))}async getNames(){if(this.columnNames.length)return this.columnNames;const e=(await this.getHeader()).split(/\n|\r\n|\r/).filter(e=>!!e).at(-1);return e?.includes("\t")?e.slice(1).split("\t").map(e=>e.trim()):void 0}getFeatures(e,t){const{stopToken:r,statusCallback:n=()=>{}}=t||{};return(0,c.ObservableCreate)(async t=>{const{meta:a}=await this.getMetadata(),{columnNumbers:s}=a,o=s.ref-1,c=s.start-1,l=s.end-1,p=await this.getNames();let m=performance.now();(0,u.SW)(r),await(0,i.updateStatus)("Downloading features",n,()=>this.bed.getLines(e.refName,e.start,e.end,{lineCallback:(e,n)=>{performance.now()-m>200&&((0,u.SW)(r),m=performance.now()),t.next(new i.SimpleFeature((0,d.dE)({line:e,colRef:o,colStart:c,colEnd:l,scoreColumn:this.scoreColumn,parser:this.parser,uniqueId:`${this.id}-${n}`,names:p})))},stopToken:r})),t.complete()},r)}}}}]);
//# sourceMappingURL=6214.10a1ae35.chunk.js.map