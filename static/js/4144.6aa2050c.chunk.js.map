{"version":3,"file":"static/js/4144.6aa2050c.chunk.js","mappings":"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","sources":["../../../plugins/variants/src/shared/drawPhased.ts","../../../plugins/variants/src/shared/drawAlleleCount.ts","../../../plugins/variants/src/MultiLinearVariantRenderer/makeImageData.ts"],"sourcesContent":["import { set1 } from '@jbrowse/core/ui/colors'\nimport { colord } from '@jbrowse/core/util/colord'\n\nimport { REFERENCE_COLOR, UNPHASED_COLOR, f2 } from './constants.ts'\n\nfunction colorify(n: number) {\n  return `hsl(${n % 255}, 50%, 50%)`\n}\n\nexport function drawPhased(\n  alleles: string[],\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  w: number,\n  h: number,\n  HP: number,\n  PS?: string,\n  drawReference = true,\n  alpha = 1,\n) {\n  const allele = +alleles[HP]!\n  const c = allele\n    ? PS !== undefined\n      ? colorify(+PS) || UNPHASED_COLOR\n      : set1[allele - 1] || UNPHASED_COLOR\n    : drawReference\n      ? REFERENCE_COLOR\n      : undefined\n  if (c) {\n    ctx.fillStyle = alpha !== 1 ? colord(c).alpha(alpha).toHex() : c\n    ctx.fillRect(x - f2, y - f2, w + f2, h + f2)\n  }\n  return c\n}\n","import { colord } from '@jbrowse/core/util/colord'\n\nimport {\n  ALT_COLOR_HUE,\n  ALT_COLOR_SATURATION,\n  NO_CALL_COLOR,\n  REFERENCE_COLOR,\n  f2,\n} from './constants.ts'\n\nexport function getAlleleColor(\n  genotype: string,\n  mostFrequentAlt: string,\n  colorCache: Record<string, string | undefined>,\n  splitCache: Record<string, string[]>,\n  drawRef: boolean,\n) {\n  const cacheKey = `${genotype}:${mostFrequentAlt}`\n  let c = colorCache[cacheKey]\n  if (c === undefined) {\n    let alt = 0\n    let uncalled = 0\n    let alt2 = 0\n    let ref = 0\n    const alleles =\n      splitCache[genotype] ?? (splitCache[genotype] = genotype.split(/[/|]/))\n    const total = alleles.length\n\n    for (let i = 0; i < total; i++) {\n      const allele = alleles[i]!\n      if (allele === mostFrequentAlt) {\n        alt++\n      } else if (allele === '0') {\n        ref++\n      } else if (allele === '.') {\n        uncalled++\n      } else {\n        alt2++\n      }\n    }\n    c = getColorAlleleCount(ref, alt, alt2, uncalled, total, drawRef)\n    colorCache[cacheKey] = c\n  }\n  return c\n}\n\nexport function getColorAlleleCount(\n  ref: number,\n  alt: number,\n  alt2: number,\n  uncalled: number,\n  total: number,\n  drawReference = true,\n) {\n  if (ref === total) {\n    return drawReference ? REFERENCE_COLOR : ''\n  }\n\n  if (!(alt || alt2 || uncalled)) {\n    return ''\n  }\n\n  let a1\n  if (alt) {\n    const lightness = 80 - (alt / total) * 50\n    a1 = colord(`hsl(${ALT_COLOR_HUE},${ALT_COLOR_SATURATION}%,${lightness}%)`)\n  }\n  if (alt2) {\n    const alpha = alt2 / total\n    const l = `hsla(0,100%,20%,${alpha})`\n    a1 = a1 ? a1.mix(l) : colord(l)\n  }\n  if (uncalled) {\n    const alpha = uncalled / total\n    const l = NO_CALL_COLOR.replace(')', `,${alpha})`).replace('hsl', 'hsla')\n    a1 = a1 ? a1.mix(l) : colord(l)\n  }\n  return a1?.toHex() || 'black'\n}\n\nexport function drawColorAlleleCount(\n  c: string,\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  w: number,\n  h: number,\n  featureType = '',\n  featureStrand?: number,\n  alpha = 1,\n) {\n  ctx.fillStyle = alpha !== 1 ? colord(c).alpha(alpha).toHex() : c\n  if (featureType === 'inversion') {\n    if (featureStrand === 1) {\n      ctx.beginPath()\n      ctx.moveTo(x - f2, y - f2)\n      ctx.lineTo(x - f2, y + h + f2)\n      ctx.lineTo(x + w + f2, y + h / 2)\n      ctx.closePath()\n      ctx.fill()\n    } else {\n      ctx.beginPath()\n      ctx.moveTo(x + w + f2, y - f2)\n      ctx.lineTo(x + w + f2, y + h + f2)\n      ctx.lineTo(x - f2, y + h / 2)\n      ctx.closePath()\n      ctx.fill()\n    }\n  } else {\n    ctx.fillRect(x - f2, y - f2, w + f2, h + f2)\n  }\n}\n","import { featureSpanPx, updateStatus } from '@jbrowse/core/util'\nimport Flatbush from '@jbrowse/core/util/flatbush'\nimport {\n  checkStopToken2,\n  createStopTokenChecker,\n} from '@jbrowse/core/util/stopToken'\n\nimport { f2 } from '../shared/constants.ts'\nimport {\n  drawColorAlleleCount,\n  getAlleleColor,\n} from '../shared/drawAlleleCount.ts'\nimport { drawPhased } from '../shared/drawPhased.ts'\nimport { getFeaturesThatPassMinorAlleleFrequencyFilter } from '../shared/minorAlleleFrequencyUtils.ts'\n\nimport type { MultiRenderArgsDeserialized } from './types.ts'\nimport type { Source } from '../shared/types.ts'\nimport type { Feature, Region } from '@jbrowse/core/util'\n\ninterface Maf {\n  feature: Feature\n  mostFrequentAlt: string\n}\n\ninterface DrawContext {\n  ctx: CanvasRenderingContext2D\n  sources: Source[]\n  region: Region\n  bpPerPx: number\n  startRow: number\n  endRow: number\n  h: number\n  drawH: number\n  scrollTop: number\n  splitCache: Record<string, string[]>\n  drawRef: boolean\n  genotypesCache: Map<string, Record<string, string>>\n  stopToken?: string\n}\n\ninterface ItemData {\n  items: { name: string; genotype: string; featureId: string; bpLen: number }[]\n  coords: number[]\n}\n\nfunction drawPhasedMode(drawCtx: DrawContext, itemData: ItemData, mafs: Maf[]) {\n  const {\n    ctx,\n    sources,\n    region,\n    bpPerPx,\n    startRow,\n    endRow,\n    h,\n    drawH,\n    scrollTop,\n    splitCache,\n    drawRef,\n    genotypesCache,\n    stopToken,\n  } = drawCtx\n  const { items, coords } = itemData\n  const lastCheck = createStopTokenChecker(stopToken)\n  for (const { feature } of mafs) {\n    const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n    const featureId = feature.id()\n    const bpLen = feature.get('end') - feature.get('start')\n    const w = Math.max(Math.round(rightPx - leftPx), 2)\n    const x = Math.floor(leftPx)\n    let samp = genotypesCache.get(featureId)\n    if (!samp) {\n      samp = feature.get('genotypes') as Record<string, string>\n      genotypesCache.set(featureId, samp)\n    }\n\n    for (let j = startRow; j < endRow; j++) {\n      const y = j * h - scrollTop\n      const source = sources[j]!\n      const { name, HP, baseName } = source\n      const sampleName = baseName ?? name\n      const genotype = samp[sampleName]\n      if (genotype) {\n        const isPhased = genotype.includes('|')\n        if (isPhased) {\n          const alleles =\n            splitCache[genotype] ?? (splitCache[genotype] = genotype.split('|'))\n          if (\n            drawPhased(alleles, ctx, x, y, w, drawH, HP!, undefined, drawRef)\n          ) {\n            items.push({ name, genotype, featureId, bpLen })\n            coords.push(x, y, x + w, y + drawH)\n          }\n        } else {\n          ctx.fillStyle = 'black'\n          ctx.fillRect(x - f2, y - f2, w + f2, drawH + f2)\n        }\n      }\n    }\n    checkStopToken2(lastCheck)\n  }\n}\n\nfunction drawAlleleCountMode(\n  drawCtx: DrawContext,\n  itemData: ItemData,\n  mafs: Maf[],\n  colorCache: Record<string, string | undefined>,\n) {\n  const {\n    ctx,\n    sources,\n    region,\n    bpPerPx,\n    startRow,\n    endRow,\n    h,\n    drawH,\n    scrollTop,\n    splitCache,\n    drawRef,\n    genotypesCache,\n    stopToken,\n  } = drawCtx\n  const { items, coords } = itemData\n  const lastCheck = createStopTokenChecker(stopToken)\n  for (const { mostFrequentAlt, feature } of mafs) {\n    const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n    const featureId = feature.id()\n    const bpLen = feature.get('end') - feature.get('start')\n    const w = Math.max(Math.round(rightPx - leftPx), 2)\n    const x = Math.floor(leftPx)\n    let samp = genotypesCache.get(featureId)\n    if (!samp) {\n      samp = feature.get('genotypes') as Record<string, string>\n      genotypesCache.set(featureId, samp)\n    }\n    const featureType = feature.get('type')\n    const featureStrand = feature.get('strand')\n    const alpha = bpLen > 5 ? 0.75 : 1\n\n    for (let j = startRow; j < endRow; j++) {\n      const y = j * h - scrollTop\n      const { name } = sources[j]!\n      const genotype = samp[name]\n      if (genotype) {\n        const c = getAlleleColor(\n          genotype,\n          mostFrequentAlt,\n          colorCache,\n          splitCache,\n          drawRef,\n        )\n        if (c) {\n          drawColorAlleleCount(\n            c,\n            ctx,\n            x,\n            y,\n            w,\n            drawH,\n            featureType,\n            featureStrand,\n            alpha,\n          )\n          items.push({ name, genotype, featureId, bpLen })\n          coords.push(x, y, x + w, y + drawH)\n        }\n      }\n    }\n    checkStopToken2(lastCheck)\n  }\n}\n\nexport async function makeImageData(\n  ctx: CanvasRenderingContext2D,\n  props: MultiRenderArgsDeserialized,\n) {\n  const {\n    scrollTop,\n    minorAlleleFrequencyFilter,\n    sources,\n    rowHeight,\n    height: canvasHeight,\n    features,\n    regions,\n    bpPerPx,\n    renderingMode,\n    stopToken,\n    lengthCutoffFilter,\n    referenceDrawingMode,\n    statusCallback = () => {},\n  } = props\n  const region = regions[0]!\n  const lastCheck = createStopTokenChecker(stopToken)\n\n  const coords = [] as number[]\n  const items = [] as {\n    name: string\n    genotype: string\n    featureId: string\n    bpLen: number\n  }[]\n  const colorCache = {} as Record<string, string | undefined>\n  const splitCache = {} as Record<string, string[]>\n  const genotypesCache = new Map<string, Record<string, string>>()\n  const drawRef = referenceDrawingMode === 'draw'\n  const h = rowHeight\n  const drawH = Math.max(rowHeight, 1)\n  const startRow = Math.floor(scrollTop / h)\n  const endRow = Math.min(\n    sources.length,\n    Math.ceil((scrollTop + canvasHeight) / h),\n  )\n\n  const mafs = await updateStatus('Calculating stats', statusCallback, () =>\n    getFeaturesThatPassMinorAlleleFrequencyFilter({\n      lastCheck,\n      features: features.values(),\n      minorAlleleFrequencyFilter,\n      lengthCutoffFilter,\n      genotypesCache,\n      splitCache,\n    }),\n  )\n\n  const drawCtx: DrawContext = {\n    ctx,\n    sources,\n    region,\n    bpPerPx,\n    startRow,\n    endRow,\n    h,\n    drawH,\n    scrollTop,\n    splitCache,\n    drawRef,\n    genotypesCache,\n    stopToken,\n  }\n  const itemData: ItemData = { items, coords }\n\n  await updateStatus('Drawing variants', statusCallback, () => {\n    if (renderingMode === 'phased') {\n      drawPhasedMode(drawCtx, itemData, mafs)\n    } else {\n      drawAlleleCountMode(drawCtx, itemData, mafs, colorCache)\n    }\n  })\n\n  const flatbush = new Flatbush(Math.max(items.length, 1))\n  if (items.length) {\n    for (let i = 0, l = coords.length; i < l; i += 4) {\n      flatbush.add(coords[i]!, coords[i + 1]!, coords[i + 2], coords[i + 3])\n    }\n  } else {\n    flatbush.add(0, 0)\n  }\n  flatbush.finish()\n\n  const featureGenotypeMap = {} as Record<\n    string,\n    {\n      alt: unknown\n      ref: unknown\n      name: unknown\n      description: unknown\n      length: number\n    }\n  >\n  for (const { feature } of mafs) {\n    const id = feature.id()\n    featureGenotypeMap[id] = {\n      alt: feature.get('ALT'),\n      ref: feature.get('REF'),\n      name: feature.get('name'),\n      description: feature.get('description'),\n      length: feature.get('end') - feature.get('start'),\n    }\n  }\n\n  return {\n    flatbush: flatbush.data,\n    items,\n    featureGenotypeMap,\n  }\n}\n"],"names":["drawPhased","alleles","ctx","x","y","w","h","HP","PS","drawReference","alpha","allele","c","undefined","UNPHASED_COLOR","set1","REFERENCE_COLOR","fillStyle","colord","toHex","fillRect","f2","getAlleleColor","genotype","mostFrequentAlt","colorCache","splitCache","drawRef","cacheKey","alt","uncalled","alt2","ref","split","total","length","i","a1","lightness","ALT_COLOR_HUE","ALT_COLOR_SATURATION","l","mix","NO_CALL_COLOR","replace","getColorAlleleCount","drawColorAlleleCount","featureType","featureStrand","beginPath","moveTo","lineTo","closePath","fill","async","makeImageData","props","scrollTop","minorAlleleFrequencyFilter","sources","rowHeight","height","canvasHeight","features","regions","bpPerPx","renderingMode","stopToken","lengthCutoffFilter","referenceDrawingMode","statusCallback","region","lastCheck","createStopTokenChecker","coords","items","genotypesCache","Map","drawH","Math","max","startRow","floor","endRow","min","ceil","mafs","updateStatus","getFeaturesThatPassMinorAlleleFrequencyFilter","values","drawCtx","itemData","feature","leftPx","rightPx","featureSpanPx","featureId","id","bpLen","get","round","samp","set","j","source","name","baseName","includes","push","checkStopToken2","drawPhasedMode","drawAlleleCountMode","flatbush","Flatbush","add","finish","featureGenotypeMap","description","data"],"ignoreList":[],"sourceRoot":""}