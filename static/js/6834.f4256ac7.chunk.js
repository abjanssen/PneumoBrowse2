"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6834],{6834:(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var n=r(93902),a=r(60972),s=r(46377),i=r(99834),o=r(66885),c=r(99546),u=r(44728),d=r(82088),f=r(28493);class m extends s.BaseFeatureDataAdapter{async configurePre(e){const t=this.pluginManager,r=new n.C({filehandle:(0,i.openLocation)(this.getConf("bigBedLocation"),t)}),s=await r.getHeader(e);return{bigbed:r,header:s,parser:new a.A({autoSql:s.autoSql})}}async configure(e){return this.cachedP||(this.cachedP=this.configurePre(e).catch((e=>{throw this.cachedP=void 0,e}))),this.cachedP}async getRefNames(e){const{header:t}=await this.configure(e);return Object.keys(t.refsByName)}async getData(){const e=await this.getRefNames(),t=[];for(const r of e){const e=await(0,u._)(this.getFeatures({assemblyName:"unknown",refName:r,start:0,end:Number.MAX_SAFE_INTEGER}).pipe((0,d.$)()));t.push(e)}return t.flat()}async getHeader(e){const{parser:t,header:r}=await this.configure(e),{version:n,fileType:a}=r,{fields:s,...i}=t.autoSql;return{version:n,fileType:a,autoSql:{...i},fields:Object.fromEntries(s.map((({name:e,comment:t})=>[e,t])))}}async getFeaturesHelper({query:e,opts:t,observer:r,allowRedispatch:n,originalQuery:a=e}){const{signal:s}=t,i=this.getConf("scoreColumn"),o=this.getConf("aggregateField"),{parser:u,bigbed:d}=await this.configure(t),m=await d.getFeatures(e.refName,e.start,e.end,{signal:s,basesPerSpan:e.end-e.start});if(n&&m.length){let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(const e of m)e.start<n&&(n=e.start),e.end>a&&(a=e.end);if(a>e.end||n<e.start)return void await this.getFeaturesHelper({query:{...e,start:n,end:a},opts:t,observer:r,allowRedispatch:!1,originalQuery:e})}const p={};if(m.some((e=>void 0===e.uniqueId)))throw new Error("found uniqueId undefined");for(const t of m){const n=`${e.refName}\t${t.start}\t${t.end}\t${t.rest}`,s=u.parseLine(n,{uniqueId:t.uniqueId}),d=s[o];p[d]||(p[d]=[]);const{uniqueId:m,type:l,chrom:h,chromStart:b,chromEnd:_,description:N,chromStarts:g,blockStarts:S,blockSizes:k,score:y,blockCount:I,thickStart:q,thickEnd:v,strand:w,...C}=s,E=(0,f.np)({...C,scoreColumn:i,line:n,parser:u,uniqueId:m,start:t.start,end:t.end,refName:e.refName});d?p[d].push(E):(0,c.doesIntersect2)(E.start,E.end,a.start,a.end)&&r.next(new c.SimpleFeature({id:`${this.id}-${m}`,data:E}))}Object.entries(p).map((([t,n])=>{const s=(0,c.min)(n.map((e=>e.start))),i=(0,c.max)(n.map((e=>e.end)));if((0,c.doesIntersect2)(s,i,a.start,a.end)){const{uniqueId:a,strand:o}=n[0];r.next(new c.SimpleFeature({id:`${this.id}-${a}-parent`,data:{type:"gene",subfeatures:n,strand:o,name:t,start:s,end:i,refName:e.refName}}))}})),r.complete()}getFeatures(e,t={}){return(0,o.ObservableCreate)((async r=>{try{await this.getFeaturesHelper({query:e,opts:t,observer:r,allowRedispatch:!0})}catch(e){r.error(e)}}),t.signal)}freeResources(){}}},28493:(e,t,r)=>{function n(e){const t=e?.trim().split(" ");return[0,1,2,3,5,6].every((e=>void 0!==t?.[e]&&!Number.isNaN(+t[e])))}function a(e){if(n(e)){const[t,r,n,a,s,i,o,c,u,d,f,m,p,l,h]=e.trim().split(" ");return{bitsw_score:t,percent_div:r,percent_del:n,percent_ins:a,query_chr:s,query_begin:i,query_end:o,query_remaining:c,orientation:u,matching_repeat_name:d,matching_repeat_class:f,matching_repeat_begin:m,matching_repeat_end:p,matching_repeat_remaining:l,repeat_id:h}}return{description:e}}function s({line:e,colRef:t,colStart:r,colEnd:n,scoreColumn:a,parser:s,uniqueId:o,names:c}){const u=e.split("\t");return i({line:e,refName:u[t],start:+u[r],end:+u[n]+(r===n?1:0),parser:s,uniqueId:o,scoreColumn:a,names:c})}function i({line:e,refName:t,start:r,end:s,parser:i,uniqueId:c,scoreColumn:u,names:d}){const f=e.split("\t"),m=d?function(e,t){const r=Object.fromEntries(t.split("\t").map(((t,r)=>[e[r],t]))),{blockStarts:n,blockCount:a,chromStarts:s,thickEnd:i,thickStart:c,blockSizes:u,...d}=r;return{...d,blockStarts:o(n),chromStarts:o(s),blockSizes:o(u),thickStart:c?+c:void 0,thickEnd:i?+i:void 0,blockCount:a?+a:void 0}}(d,e):i.parseLine(e,{uniqueId:c}),{strand:p,score:l,chrom:h,chromStart:b,chromEnd:_,...N}=m,{chromStarts:g,blockSizes:S,blockStarts:k,type:y,blockCount:I,thickStart:q,thickEnd:v,description:w,...C}=N,E=u?+m[u]:l?+l:void 0,R="string"==typeof p?"-1"===(T=p)?-1:"+"===T?1:0:p;var T;const F=function({start:e,uniqueId:t,refName:r,chromStarts:n,blockCount:a,blockSizes:s,blockStarts:i}){if(a){const o=[],c=n||i||[];for(let n=0;n<a;n++){const a=(c[n]||0)+e,i=s?.[n];if(i&&i>0){const e=a+i;o.push({uniqueId:`${t}-${n}`,start:a,end:e,refName:r,type:"block"})}}return o}return[]}({start:r,uniqueId:c,refName:t,chromStarts:g,blockCount:I,blockSizes:S,blockStarts:k});return function({splitLine:e,start:t,end:r}){return+(e[6]||0)===t&&+(e[7]||0)===r}({splitLine:f,start:r,end:s})?function({line:e,uniqueId:t,refName:r,start:n,end:a}){const[,,,s,,i,,,o,c,u,d,f,m,p,l,h,b]=e.split("\t");return{uniqueId:t,refName:r,start:n,end:a,code:s,score:u,strand:i,color:o,source:s,n_valid_cov:c,fraction_modified:u,n_mod:d,n_canonical:f,n_other_mod:m,n_delete:p,n_fail:l,n_diff:h,n_nocall:b}}({line:e,uniqueId:c,refName:t,start:r,end:s}):n(w)?function({uniqueId:e,refName:t,start:r,end:n,description:s,...i}){return{...i,...a(s),uniqueId:e,refName:t,start:r,end:n}}({...C,uniqueId:c,description:w,type:y,score:E,start:r,end:s,strand:R,refName:t,subfeatures:F}):function({thickStart:e,blockCount:t,strand:r}){return e&&t&&0!==r}({strand:R,blockCount:I,thickStart:q})?function(e){const{strand:t=0,chrom:r,chromStart:n,chromEnd:a,chromStarts:s,blockStarts:i,blockSizes:o,uniqueId:c,...u}=e,{subfeatures:d,thickStart:f,thickEnd:m,blockCount:p,refName:l,...h}=u,b=[],_=d.filter((e=>"block"===e.type)).sort(((e,t)=>e.start-t.start));for(const e of _){const r=e.start,n=e.end;f>=n?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:n,refName:l}):f>r&&f<n&&m>=n?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:f,refName:l},{type:"CDS",start:f,end:n,refName:l}):f<=r&&m>=n?b.push({type:"CDS",start:r,end:n,refName:l}):f>r&&f<n&&m<n?b.push({type:(t>0?"five":"three")+"_prime_UTR",start:r,end:f,refName:l},{type:"CDS",start:f,end:m,refName:l},{type:(t>0?"three":"five")+"_prime_UTR",start:m,end:n,refName:l}):f<=r&&m>r&&m<n?b.push({type:"CDS",start:r,end:m,refName:l},{type:(t>0?"three":"five")+"_prime_UTR",start:m,end:n,refName:l}):m<=r&&b.push({type:(t>0?"three":"five")+"_prime_UTR",start:r,end:n,refName:l})}return{...h,uniqueId:c,strand:t,type:"mRNA",refName:l,subfeatures:b}}({...N,description:w,chromStarts:g,thickStart:q,thickEnd:v,blockSizes:S,blockCount:I,type:y,score:E,start:r,end:s,strand:R,refName:t,uniqueId:c,subfeatures:F}):{...N,uniqueId:c,description:w,type:y,score:E,start:r,end:s,strand:R,refName:t,subfeatures:F}}function o(e){return void 0!==e?"string"==typeof e?e.split(",").map((e=>+e)):e:void 0}r.d(t,{dE:()=>s,np:()=>i})}}]);
//# sourceMappingURL=6834.f4256ac7.chunk.js.map