"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1770],{30385:(t,e,o)=>{o.d(e,{Gn:()=>m,OX:()=>u,Td:()=>M,Ww:()=>b,xx:()=>r});var n=o(40898),a=o(99546),i=o(87485),s=o(79610);const r=16581375;function f(t){return`rgb(${Math.floor(t/65025)%255},${Math.floor(t/255)%255},${t%255})`}const l={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c={default:{cigarColors:l},strand:{posColor:"red",negColor:"blue",cigarColors:{I:"#ff03",N:"#a020f0",D:"#a020f0",X:"brown",M:"#f003","=":"#f003"}},query:{cigarColors:l}};function g(t,e){return 1===e?t:(0,i.M)(t).alpha(e).toHex()}const h=3,d=1600;function u(t,e,o,n){return Math.floor((255*t*255+255*e+o-1)/n)}function M(t,e){const o=(0,a.getContainingView)(t),n=o.drawCurves,i=o.drawCIGAR,l=o.drawCIGARMatchesOnly,{level:c,height:g,featPositions:u}=t,M=o.width,b=o.views.map(t=>t.bpPerPx);e.imageSmoothingEnabled=!1,e.clearRect(0,0,M,g);const m=o.views.map(t=>t.offsetPx),C=1/b[c],v=1/b[c+1];for(const{p11:t,p12:b,p21:x,p22:p,f:w,cigar:y}of u){const u=t.offsetPx-m[c],P=b.offsetPx-m[c],S=x.offsetPx-m[c+1],T=p.offsetPx-m[c+1],k=Math.abs(P-u),I=Math.abs(T-S),$=Math.min(S,T),L=Math.max(S,T),W=0,N=g,X=(N-W)/2;if(!(k<=h&&I<=h)&&(0,a.doesIntersect2)($,L,-d,o.width+d)){const t=w.get("strand"),o=-1===t?P:u,a=o<(-1===t?u:P)?1:-1,c=(S<T?1:-1)*t;let g=o,h=-1===t?T:S;if(y.length&&i){let t=!1,o=0,i=0;const d=Math.floor(r/y.length);for(let r=0;r<y.length;r+=2){const u=+y[r],b=y[r+1];t||(o=g,i=h);const m=u*C,x=u*v;if("M"===b||"="===b||"X"===b?(g+=m*a,h+=x*c):"D"===b||"N"===b?g+=m*a:"I"===b&&(h+=x*c),!(Math.max(o,i,g,h)<0||Math.min(o,i,g,h)>M)){const a=r<y.length-2;if(Math.abs(g-o)<=1&&Math.abs(h-i)<=1&&a)t=!0;else if(t=!1,!l||("M"===b||"="===b||"X"===b)&&Math.abs(g-o)>1&&Math.abs(h-i)>1){const t=r*d+1;e.fillStyle=f(t),(0,s.$2)(e,o,g,W,h,i,N,X,n),e.fill()}}}}}}}function b(t,e){const o=(0,a.getContainingView)(t),i=o.drawCurves,l=o.drawCIGAR,u=o.drawCIGARMatchesOnly,M=o.drawLocationMarkers,{level:b,height:m,featPositions:C,alpha:v,minAlignmentLength:x,colorBy:p}=t,w=o.width,y=o.views.map(t=>t.bpPerPx),P=new Map;if(x>0)for(const{f:t}of C){const e=t.get("name")||t.get("id")||t.id(),o=Math.abs(t.get("end")-t.get("start")),n=P.get(e)||0;P.set(e,n+o)}const S=(c[p]||c.default).cigarColors,T="strand"===p?c.strand.posColor:"red",k="strand"===p?c.strand.negColor:"blue",I={I:g(S.I,v),N:g(S.N,v),D:g(S.D,v),X:g(S.X,v),M:g(S.M,v),"=":g(S["="],v)},$=g(T,v),L=g(k,v),W=new Map,N=t=>{if(!W.has(t)){const e=function(t){const e=function(t){let e=0;for(let o=0;o<t.length;o++)e=(e<<5)-e+t.charCodeAt(o),e&=e;return Math.abs(e)}(t);return n.category10[e%n.category10.length]}(t);W.set(t,g(e,v))}return W.get(t)};e.beginPath();const X=o.views.map(t=>t.offsetPx),D=X[b],R=X[b+1],O=Math.floor(r/C.length),A=m,G=(A-0)/2,z="strand"===p,F="query"===p;e.fillStyle=I.M,e.strokeStyle=I.M;const V=new Map;for(const{p11:t,p12:e,p21:o,p22:n,f:a}of C){if(x>0){const t=a.get("name")||a.get("id")||a.id();if((P.get(t)||0)<x)continue}const i=t.offsetPx-D,s=e.offsetPx-D,r=o.offsetPx-R,f=n.offsetPx-R,l=Math.abs(s-i),c=Math.abs(f-r);if(l<=h&&c<=h&&r<w+d&&r>-d){let t="default";z?t=-1===a.get("strand")?"neg":"pos":F&&(t=a.get("refName")),V.has(t)||V.set(t,[]),V.get(t).push({x11:i,x21:r,y1:0,y2:A,mid:G})}}for(const[t,o]of V){if(e.strokeStyle="pos"===t?$:"neg"===t?L:"default"!==t?N(t):I.M,e.beginPath(),i)for(const{x11:t,x21:n,y1:a,y2:i,mid:s}of o)e.moveTo(t,a),e.bezierCurveTo(t,s,n,s,n,i);else for(const{x11:t,x21:n,y1:a,y2:i}of o)e.moveTo(t,a),e.lineTo(n,i);e.stroke()}const _=y[b],j=y[b+1],q=1/_,B=1/j,E="strand"===p,Y="query"===p;e.fillStyle=I.M,e.strokeStyle=I.M;for(const{p11:t,p12:n,p21:r,p22:f,f:c,cigar:g}of C){const b=c.get("strand"),m=c.get("refName");if(x>0){const t=c.get("name")||c.get("id")||c.id();if((P.get(t)||0)<x)continue}const C=t.offsetPx-D,v=n.offsetPx-D,p=r.offsetPx-R,y=f.offsetPx-R,S=Math.abs(v-C),T=Math.abs(y-p),k=Math.min(p,y),W=Math.max(p,y);if(!(S<=h&&T<=h)&&(0,a.doesIntersect2)(k,W,-d,o.width+d)){const t=-1===b?v:C,o=t<(-1===b?C:v)?1:-1,n=(p<y?1:-1)*b;let a=t,r=-1===b?y:p;if(g.length&&l){let t=!1,f=0,l=0;for(let c=0;c<g.length;c+=2){const h=+g[c],d=g[c+1];t||(f=a,l=r);const C=h*q,v=h*B;if("M"===d||"="===d||"X"===d?(a+=C*o,r+=v*n):"D"===d||"N"===d?a+=C*o:"I"===d&&(r+=v*n),!(Math.max(f,l,a,r)<0||Math.min(f,l,a,r)>w)){const o=c<g.length-2;if(Math.abs(a-f)<=1&&Math.abs(r-l)<=1&&o)t=!0;else{const o=t&&C>1||v>1?d:"M",n="I"===o||"D"===o||"N"===o;e.fillStyle=E&&!n?-1===b?L:$:Y&&!n?N(m):I[o],t=!1,u?"M"===o&&((0,s.$2)(e,f,a,0,r,l,A,G,i),e.fill(),M&&(0,s.bo)(e,f,a,0,r,l,A,G,_,j,i)):((0,s.$2)(e,f,a,0,r,l,A,G,i),e.fill(),M&&(0,s.bo)(e,f,a,0,r,l,A,G,_,j,i))}}}}else E?e.fillStyle=-1===b?L:$:Y&&(e.fillStyle=N(m)),(0,s.$2)(e,C,v,0,y,p,A,G,i),e.fill(),(E||Y)&&(e.fillStyle=I.M)}}const J=t.clickMapCanvas?.getContext("2d");if(J){J.imageSmoothingEnabled=!1,J.clearRect(0,0,w,m);for(let t=0;t<C.length;t++){const e=C[t];if(x>0){const t=e.f.get("name")||e.f.get("id")||e.f.id();if((P.get(t)||0)<x)continue}const n=t*O+1;J.fillStyle=f(n),(0,s.mr)({cb:t=>{t.fill()},feature:e,ctx:J,drawCurves:i,level:b,offsets:X,oobLimit:d,viewWidth:o.width,hideTiny:!0,height:m})}}}function m(t){const{level:e,clickId:o,mouseoverId:n}=t,i=(0,a.getContainingView)(t),r=i.drawCurves,f=t.height,l=i.width,c=t.mouseoverCanvas?.getContext("2d"),g=i.views.map(t=>t.offsetPx);if(!c)return;c.resetTransform(),c.scale(1,1),c.clearRect(0,0,l,f),c.strokeStyle="rgba(0, 0, 0, 0.9)",c.fillStyle="rgba(0, 0, 0, 0.1)";const h=t.featMap[n||""];h&&(0,s.mr)({cb:t=>{t.fill()},feature:h,level:e,ctx:c,oobLimit:d,viewWidth:i.width,drawCurves:r,offsets:g,height:f});const u=t.featMap[o||""];u&&(0,s.mr)({cb:t=>{t.stroke()},feature:u,ctx:c,level:e,oobLimit:d,viewWidth:i.width,drawCurves:r,offsets:g,height:f})}},79610:(t,e,o)=>{o.d(e,{$2:()=>s,Eg:()=>c,WT:()=>f,bo:()=>r,f0:()=>l,mr:()=>i});var n=o(99546),a=o(30385);function i({feature:t,ctx:e,offsets:o,level:a,cb:i,height:r,drawCurves:f,oobLimit:l,viewWidth:c,hideTiny:g}){const{p11:h,p12:d,p21:u,p22:M}=t,b=h.offsetPx-o[a],m=d.offsetPx-o[a],C=u.offsetPx-o[a+1],v=M.offsetPx-o[a+1],x=Math.abs(m-b),p=Math.abs(v-C),w=r,y=(w-0)/2,P=Math.min(C,v),S=Math.max(C,v);(0,n.doesIntersect2)(P,S,-l,c+l)&&(x<=1&&p<=1?g||(e.beginPath(),e.moveTo(b,0),f?e.bezierCurveTo(b,y,C,y,C,w):e.lineTo(C,w),e.stroke()):(s(e,b,m,0,v,C,w,y,f),i(e)))}function s(t,e,o,n,a,i,s,r,f){f?function(t,e,o,n,a,i,s,r){const f=Math.abs(e-o),l=Math.abs(e-o);if(f<5&&l<5&&o<e&&Math.abs(e-a)>100){const t=e;e=o,o=t}t.beginPath(),t.moveTo(e,n),t.lineTo(o,n),t.bezierCurveTo(o,r,a,r,a,s),t.lineTo(i,s),t.bezierCurveTo(i,r,e,r,e,n),t.closePath()}(t,e,o,n,a,i,s,r):function(t,e,o,n,a,i,s){t.beginPath(),t.moveTo(e,n),t.lineTo(o,n),t.lineTo(a,s),t.lineTo(i,s),t.closePath()}(t,e,o,n,a,i,s)}function r(t,e,o,n,a,i,s,r,f,l,c){const g=(Math.abs(o-e)+Math.abs(i-a))/2;if(g<30)return;const h=Math.max(2,Math.floor(g/20)+1),d=t.strokeStyle,u=t.lineWidth;if(t.strokeStyle="rgba(0, 0, 0, 0.25)",t.lineWidth=.5,t.beginPath(),c)for(let f=0;f<h;f++){const l=f/h,c=e+(o-e)*l,g=i+(a-i)*l;t.moveTo(c,n),t.bezierCurveTo(c,r,g,r,g,s)}else for(let r=0;r<h;r++){const f=r/h,l=e+(o-e)*f,c=i+(a-i)*f;t.moveTo(l,n),t.lineTo(c,s)}t.stroke(),t.strokeStyle=d,t.lineWidth=u}function f(t,e){const o=(0,n.getContainingView)(e),i=(0,n.getContainingTrack)(e),{featPositions:s,numFeats:r,clickMapCanvas:f,cigarClickMapCanvas:l,level:c}=e;if(!f||!l)return;const g=f.getBoundingClientRect(),h=f.getContext("2d"),d=l.getContext("2d");if(!h||!d)return;const u=t.clientX-g.left,M=t.clientY-g.top,[b,m,C]=h.getImageData(u,M,1,1).data,v=Math.floor(a.xx/r),x=s[(0,a.OX)(b,m,C,v)];if(x){const{f:t}=x;e.setClickId(t.id());const a=(0,n.getSession)(e);(0,n.isSessionModelWithWidgets)(a)&&a.showWidget(a.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:o,track:i,featureData:t.toJSON(),level:c}))}return x}function l(t,e,o){t.preventDefault();const n=e.clickMapCanvas,i=e.cigarClickMapCanvas;if(!n||!i)return;const s=n.getBoundingClientRect(),r=n.getContext("2d"),f=i.getContext("2d");if(!r||!f)return;const{clientX:l,clientY:c}=t,g=l-s.left,h=c-s.top,[d,u,M]=r.getImageData(g,h,1,1).data,b=Math.floor(a.xx/e.numFeats),m=(0,a.OX)(d,u,M,b),C=e.featPositions[m];C&&(e.setClickId(C.f.id()),o({clientX:l,clientY:c,feature:C}))}function c({feature:t,cigarOp:e,cigarOpLen:o}){const a=t.toJSON(),i=a.mate,s=a.end-a.start,r=i.end-i.start,f=a.identity,l=a.name,c=i.name;return[`Loc1: ${(0,n.assembleLocString)(a)}`,`Loc2: ${(0,n.assembleLocString)(i)}`,`Inverted: ${-1===a.strand}`,`Query len: ${s.toLocaleString("en-US")}`,`Target len: ${r.toLocaleString("en-US")}`,f?`Identity: ${f.toPrecision(2)}`:"",e?`CIGAR operator: ${(0,n.toLocale)(+o)}${e}`:"",l?`Name 1: ${l}`:"",c?`Name 2: ${c}`:""].filter(t=>!!t).join("<br/>")}}}]);
//# sourceMappingURL=1770.f82b79a5.chunk.js.map