"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7523],{37523(e,t,n){n.r(t),n.d(t,{default:()=>T});var o=n(64074),a=n(30936),s=n(65045),r=n(32118);const i=(0,s.n)()({blockError:{background:"#f1f1f1",padding:10,color:"red"}});function c(e){const t=(0,a.c)(3),{error:n}=e,{classes:o}=i(),s=`${n}`;let c;return t[0]!==o.blockError||t[1]!==s?(c=(0,r.jsx)("div",{className:o.blockError,children:s}),t[0]=o.blockError,t[1]=s,t[2]=c):c=t[2],c}const l=(0,s.n)()({blockMessage:{background:"#f1f1f1",padding:10}});function u(e){const t=(0,a.c)(3),{messageText:n}=e,{classes:o}=l();let s;return t[0]!==o.blockMessage||t[1]!==n?(s=(0,r.jsx)("div",{className:o.blockMessage,children:n}),t[0]=o.blockMessage,t[1]=n,t[2]=s):s=t[2],s}var f=n(42918),d=n(77251),g=n(38567),v=n(29742),h=n(14391);function m(e){const t=(0,a.c)(17),{model:n,onClose:o,anchorEl:s}=e;let i;t[0]!==n?(i=(0,d.getContainingView)(n),t[0]=n,t[1]=i):i=t[1];const c=i,{clientX:l,clientY:u,feature:f}=s;let g,v;t[2]!==o?(g=(e,t)=>{t(),o()},t[2]=o,t[3]=g):g=t[3],t[4]!==l||t[5]!==u?(v={top:u,left:l},t[4]=l,t[5]=u,t[6]=v):v=t[6];const m=Boolean(s);let b,p;return t[7]!==f||t[8]!==n||t[9]!==c?(b=[{label:"Center on feature",onClick:()=>{const{f:e}=f,t=e.get("start"),o=e.get("end"),a=e.get("refName"),s=e.get("mate"),r=c.views[n.level],i=c.views[n.level+1],l=(t+o)/2,u=(s.start+s.end)/2;r.centerAt(l,a),i.centerAt(u,s.refName)}}],t[7]=f,t[8]=n,t[9]=c,t[10]=b):b=t[10],t[11]!==o||t[12]!==g||t[13]!==v||t[14]!==m||t[15]!==b?(p=(0,r.jsx)(h.A,{onMenuItemClick:g,anchorReference:"anchorPosition",anchorPosition:v,onClose:o,open:m,menuItems:b}),t[11]=o,t[12]=g,t[13]=v,t[14]=m,t[15]=b,t[16]=p):p=t[16],p}var b=n(41772);const p=(0,f.lazy)(()=>n.e(4689).then(n.bind(n,94689))),C=(0,s.n)()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},mouseoverCanvas:{position:"absolute",pointerEvents:"none"},mainCanvas:{position:"absolute"}}),x=(0,o.observer)(function({model:e}){const{classes:t}=C(),{mouseoverId:n,height:o}=e,a=(0,f.useRef)(0),s=(0,d.getContainingView)(e),i=s.width,c=(0,f.useRef)(0),l=(0,f.useRef)(!1),u=(0,f.useRef)(null),[h,x]=(0,f.useState)(),[k,M]=(0,f.useState)(""),[w,T]=(0,f.useState)(),[P,S]=(0,f.useState)(),[j,y]=(0,f.useState)(),[R,X]=(0,f.useState)(),I=(0,f.useRef)(null),L=(0,f.useCallback)(t=>{e.setMouseoverCanvasRef(t)},[e,o,i]),N=(0,f.useCallback)(t=>{e.setMainCanvasRef(t),I.current=t},[e,o,i]);(0,f.useEffect)(()=>{function e(e){if(e.preventDefault(),e.ctrlKey){c.current+=e.deltaY/500;for(const e of s.views)e.setScaleFactor(c.current<0?1-c.current:1/(1+c.current));u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{for(const t of s.views)t.setScaleFactor(1),t.zoomTo(c.current>0?t.bpPerPx*(1+c.current):t.bpPerPx/(1-c.current),e.clientX-(I.current?.getBoundingClientRect().left||0));c.current=0},300)}else Math.abs(e.deltaY)<Math.abs(e.deltaX)&&(a.current+=e.deltaX/2),l.current||(l.current=!0,window.requestAnimationFrame(()=>{(0,g.transaction)(()=>{for(const e of s.views)e.horizontalScroll(a.current);a.current=0,l.current=!1})}))}return I.current?.addEventListener("wheel",e),()=>{I.current?.removeEventListener("wheel",e)}},[e,o,i]);const $=(0,f.useCallback)(t=>{e.setClickMapCanvasRef(t)},[e,o,i]),E=(0,f.useCallback)(t=>{e.setCigarClickMapCanvasRef(t)},[e,o,i]);return(0,r.jsxs)("div",{className:t.rel,children:[(0,r.jsx)("canvas",{ref:N,onMouseMove:t=>{if(void 0!==P)a.current+=P-t.clientX,S(t.clientX),l.current||(l.current=!0,window.requestAnimationFrame(()=>{(0,g.transaction)(()=>{for(const e of s.views)e.horizontalScroll(a.current);a.current=0,l.current=!1})}));else{const n=e.clickMapCanvas,o=e.cigarClickMapCanvas;if(!n||!o)return;const a=n.getBoundingClientRect(),s=n.getContext("2d"),r=o.getContext("2d");if(!s||!r)return;const{clientX:i,clientY:c}=t,l=i-a.left,u=c-a.top;T(i),X(c);const[f,d,g]=s.getImageData(l,u,1,1).data,[h,m,p]=r.getImageData(l,u,1,1).data;if(0===e.numFeats)return void M("");const C=Math.floor(v.xx/e.numFeats),x=(0,v.OX)(f,d,g,C);if(e.setMouseoverId(e.featPositions[x]?.f.id()),-1!==x&&e.featPositions[x]){const{f:t,cigar:n}=e.featPositions[x],o=Math.floor(v.xx/n.length),a=(0,v.OX)(h,m,p,o),s=a%2==0&&(0!==h||0!==m||0!==p);M((0,b.Eg)({feature:t,cigarOp:s?n[a+1]:void 0,cigarOpLen:s?n[a]:void 0}))}else M("")}},onMouseLeave:()=>{e.setMouseoverId(void 0),y(void 0),S(void 0)},onMouseDown:e=>{S(e.clientX),y(e.clientX)},onMouseUp:t=>{S(void 0),void 0!==j&&Math.abs(t.clientX-j)<5&&(0,b.WT)(t,e)},onContextMenu:t=>{(0,b.f0)(t,e,x)},"data-testid":"synteny_canvas",className:t.mainCanvas,width:i,height:o}),(0,r.jsx)("canvas",{ref:L,width:i,height:o,className:t.mouseoverCanvas}),(0,r.jsx)("canvas",{ref:$,className:t.pix,width:i,height:o}),(0,r.jsx)("canvas",{ref:E,className:t.pix,width:i,height:o}),n&&k&&w&&R?(0,r.jsx)(p,{title:k}):null,h?(0,r.jsx)(m,{model:e,anchorEl:h,onClose:()=>{x(void 0)}}):null]})});var k=n(87574);const M=(0,s.n)()(e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}});function w(e){const t=(0,a.c)(5),{message:n}=e,{classes:o}=M();let s,i;return t[0]!==n?(s=(0,r.jsx)(k.A,{message:n}),t[0]=n,t[1]=s):s=t[1],t[2]!==o.loading||t[3]!==s?(i=(0,r.jsx)("div",{className:o.loading,children:s}),t[2]=o.loading,t[3]=s,t[4]=i):i=t[4],i}const T=(0,o.observer)(function({model:e}){return e.error?(0,r.jsx)(c,{error:e.error}):e.message?(0,r.jsx)(u,{messageText:e.message}):e.features?(0,r.jsx)(x,{model:e}):(0,r.jsx)(w,{message:e.loadingStatus})})},41772(e,t,n){n.d(t,{$2:()=>c,Eg:()=>g,WT:()=>f,bo:()=>l,f0:()=>d,mr:()=>i});var o=n(77251),a=n(10525),s=n(25978),r=n(29742);function i({feature:e,ctx:t,offsets:n,level:o,cb:a,height:r,drawCurves:i,oobLimit:l,viewWidth:u,hideTiny:f}){const{p11:d,p12:g,p21:v,p22:h}=e,m=d.offsetPx-n[o],b=g.offsetPx-n[o],p=v.offsetPx-n[o+1],C=h.offsetPx-n[o+1],x=Math.abs(b-m),k=Math.abs(C-p),M=r,w=(M-0)/2,T=Math.min(p,C),P=Math.max(p,C);(0,s.R6)(T,P,-l,u+l)&&(x<=1&&k<=1?f||(t.beginPath(),t.moveTo(m,0),i?t.bezierCurveTo(m,w,p,w,p,M):t.lineTo(p,M),t.stroke()):(c(t,m,b,0,C,p,M,w,i),a(t)))}function c(e,t,n,o,a,s,r,i,c){c?function(e,t,n,o,a,s,r,i){const c=Math.abs(t-n),l=Math.abs(t-n);if(c<5&&l<5&&n<t&&Math.abs(t-a)>100){const e=t;t=n,n=e}e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.bezierCurveTo(n,i,a,i,a,r),e.lineTo(s,r),e.bezierCurveTo(s,i,t,i,t,o),e.closePath()}(e,t,n,o,a,s,r,i):function(e,t,n,o,a,s,r){e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.lineTo(a,r),e.lineTo(s,r),e.closePath()}(e,t,n,o,a,s,r)}function l(e,t,n,o,a,s,r,i,c,l,u){const f=(Math.abs(n-t)+Math.abs(s-a))/2;if(f<30)return;const d=Math.max(2,Math.floor(f/20)+1),g=e.strokeStyle,v=e.lineWidth;if(e.strokeStyle="rgba(0, 0, 0, 0.25)",e.lineWidth=.5,e.beginPath(),u)for(let c=0;c<d;c++){const l=c/d,u=t+(n-t)*l,f=s+(a-s)*l;e.moveTo(u,o),e.bezierCurveTo(u,i,f,i,f,r)}else for(let i=0;i<d;i++){const c=i/d,l=t+(n-t)*c,u=s+(a-s)*c;e.moveTo(l,o),e.lineTo(u,r)}e.stroke(),e.strokeStyle=g,e.lineWidth=v}function u(e,t){const{clickMapCanvas:n,numFeats:o,featPositions:a}=t;if(!n)return;const s=n.getContext("2d");if(!s)return;const i=n.getBoundingClientRect(),c=e.clientX-i.left,l=e.clientY-i.top,[u,f,d]=s.getImageData(c,l,1,1).data,g=Math.floor(r.xx/o);return a[(0,r.OX)(u,f,d,g)]}function f(e,t){const n=u(e,t);if(n){const{f:e}=n;t.setClickId(e.id());const s=(0,o.getSession)(t);if((0,a.lO)(s)){const n=(0,o.getContainingView)(t),a=(0,o.getContainingTrack)(t);s.showWidget(s.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:n,track:a,featureData:e.toJSON(),level:t.level}))}}return n}function d(e,t,n){e.preventDefault();const o=u(e,t);o&&(t.setClickId(o.f.id()),n({clientX:e.clientX,clientY:e.clientY,feature:o}))}function g({feature:e,cigarOp:t,cigarOpLen:n}){const a=e.toJSON(),s=a.mate,r=a.end-a.start,i=s.end-s.start,c=a.identity,l=a.name,u=s.name;return[`Loc1: ${(0,o.assembleLocString)(a)}`,`Loc2: ${(0,o.assembleLocString)(s)}`,`Inverted: ${-1===a.strand}`,`Query len: ${(0,o.toLocale)(r)}`,`Target len: ${(0,o.toLocale)(i)}`,c?`Identity: ${c.toPrecision(2)}`:"",t?`CIGAR operator: ${(0,o.toLocale)(+n)}${t}`:"",l?`Name 1: ${l}`:"",u?`Name 2: ${u}`:""].filter(e=>!!e).join("<br/>")}}}]);
//# sourceMappingURL=7523.cbcd8989.chunk.js.map