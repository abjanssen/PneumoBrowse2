"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5669,6746],{45669:(e,r,t)=>{t.r(r),t.d(r,{default:()=>b});var n=t(67758),s=t(7552),o=t(68446),a=t(99546),c=t(373);const l="rgb(220,220,180)",d="rgba(250,200,200)";function i({str:e,charactersPerRow:r,showCoordinates:t,currRemainder:n=0,splitSize:s=10}){const o=Math.ceil(e.length/r),a=new Array(o);let c=n%10,l=0,d=0;for(;l<o+1;++l){const o=0===l?r-n:r,i=e.slice(d,d+o);if(!i)break;if(t){let e="";for(let r=0,t=c;r<i.length;r++,t++)t%s===0&&(e+=" ",t=0),e+=i[r];e&&(a[l]=e)}else a[l]=i;c=0,d+=o}return{segments:a,remainder:((a.at(-1)?.replaceAll(" ","").length||0)+(l<2?n:0))%r}}var u=t(69500);const h=(0,o.observer)(function({chunks:e,start:r,color:t,strand:n=1,coordStart:o=r,model:a}){const{charactersPerRow:c,showCoordinates:l}=a;return e.map((a,d)=>{const i=0===d&&r%c===0||d>0?`${(""+(o-r%c+d*n*c)).padStart(4)}   `:"",h=d===e.length-1&&(e.at(-1)?.replaceAll(" ","").length||0)+(0===d?r%c:0)!==c?null:l?" \n":"";return(0,u.jsxs)(s.Fragment,{children:[l?i:null,(0,u.jsx)("span",{style:{background:t},children:a}),h]},`${a}-${d}`)})}),m=(0,o.observer)(function({utr:e,cds:r,exons:t,sequence:n,upstream:s,downstream:o,feature:a,includeIntrons:c,collapseIntron:m,model:g}){const{upperCaseCDS:f,intronBp:w,charactersPerRow:p,showCoordinates:x,showCoordinatesSetting:j}=g,C=r.length>0,b=(r.length?[...r,...e].sort((e,r)=>e.start-r.start):t).filter(e=>e.start!==e.end),S=e=>f?e.toLowerCase():e,q=e=>f?e.toUpperCase():e,v=-1===a.strand?-1:1,k="genomic"===j&&c&&!m,R=k?v:1;let y=k?v>0?a.start+1-(s?.length||0):a.end+(s?.length||0):0,_=0,P=0,$=null;if(s){const{segments:e,remainder:r}=i({str:S(s),charactersPerRow:p,showCoordinates:x});$=(0,u.jsx)(h,{model:g,color:d,strand:R,start:_,coordStart:y,chunks:e}),P=r,_+=s.length*R,y+=s.length*R}const A=[];for(let e=0;e<b.length;e++){const r=b[e],t=n.slice(r.end,b[e+1]?.start),s=n.slice(r.start,r.end),{segments:o,remainder:a}=i({str:C?"CDS"===r.type?q(s):S(s):q(s),charactersPerRow:p,currRemainder:P,showCoordinates:x});if(A.push((0,u.jsx)(h,{model:g,color:"CDS"===r.type?l:"rgb(200,240,240)",strand:R,start:_,coordStart:y,chunks:o},`${JSON.stringify(r)}-mid`)),P=a,_+=s.length*R,y+=s.length*R,t&&c&&e<b.length-1){const e=S(m&&t.length>2*w?`${t.slice(0,w)}...${t.slice(-w)}`:t),{segments:n,remainder:s}=i({str:e,charactersPerRow:p,currRemainder:P,showCoordinates:x});n.length&&(A.push((0,u.jsx)(h,{model:g,strand:R,coordStart:y,start:_,chunks:n},`${JSON.stringify(r)}-intron`)),P=s,_+=e.length*R,y+=e.length*R)}}let D=null;if(o){const{segments:e}=i({str:S(o),charactersPerRow:p,currRemainder:P,showCoordinates:x});D=(0,u.jsx)(h,{start:_,model:g,strand:R,chunks:e,coordStart:y,color:d})}return(0,u.jsxs)(u.Fragment,{children:[$,A,D]})}),g=(0,o.observer)(function({cds:e,sequence:r,model:t}){const{charactersPerRow:n,showCoordinates:s}=t,{segments:o}=i({str:(0,c.o9)(e,r),charactersPerRow:n,showCoordinates:s});return(0,u.jsx)(h,{model:t,color:l,chunks:o,start:0})}),f=(0,o.observer)(function({sequence:e,upstream:r,feature:t,downstream:n,model:s}){const{charactersPerRow:o,showCoordinatesSetting:a,showCoordinates:c}=s;let l=0,m=null,g=0;const f=-1===t.strand?-1:1,w="genomic"===a,p=w?f:1;let x=w?f>0?t.start+1-(r?.length||0):t.end+(r?.length||0):0;if(r){const{segments:e,remainder:t}=i({str:r,charactersPerRow:o,showCoordinates:c});m=(0,u.jsx)(h,{model:s,color:d,start:l,coordStart:x,chunks:e}),g=t,l+=r.length*p,x+=r.length*p}const{segments:j,remainder:C}=i({str:e,charactersPerRow:o,showCoordinates:c,currRemainder:g}),b=(0,u.jsx)(h,{model:s,color:"rgb(200,280,200)",start:l,coordStart:x,chunks:j});g=C,l+=e.length*p,x+=e.length*p;let S=null;if(n){const{segments:e}=i({str:n,charactersPerRow:o,currRemainder:g,showCoordinates:c});S=(0,u.jsx)(h,{start:l,model:s,chunks:e,coordStart:x,color:d})}return(0,u.jsxs)(u.Fragment,{children:[m,b,S]})}),w=(0,o.observer)(function({cds:e,sequence:r,codonTable:t,model:n}){const{charactersPerRow:s,showCoordinates:o}=n,a=(0,c.o9)(e,r);let l="";for(let e=0;e<a.length;e+=3)l+=t[a.slice(e,e+3)]||"&";const{segments:d}=i({str:l,charactersPerRow:s,showCoordinates:o});return(0,u.jsx)(h,{model:n,color:"rgb(220,160,220)",chunks:d,start:0})}),p=(0,o.observer)(function({mode:e,feature:r,sequence:t,model:n}){let{seq:s,upstream:o="",downstream:l=""}=t;const d=r.subfeatures?.sort((e,r)=>e.start-r.start).map(e=>({...e,start:e.start-r.start,end:e.end-r.start}))||[];let i=(0,c.Qq)(d.filter(e=>"CDS"===e.type)),h=(0,c.Qq)(d.filter(e=>e.type?.match(/utr/i))),p=(0,c.Qq)(d.filter(e=>"exon"===e.type));return!h.length&&i.length&&p.length&&(h=(0,c.h8)(i,p)),h.length||!i.length||p.length||(h=(0,c.V4)(i,{start:0,end:r.end-r.start,type:"gene"})),-1===r.strand&&([s,o,l]=[(0,a.revcom)(s),(0,a.revcom)(l),(0,a.revcom)(o)],i=(0,c.YC)(i,s.length),p=(0,c.YC)(p,s.length),h=(0,c.YC)(h,s.length)),(0,u.jsx)(u.Fragment,{children:"genomic"===e?(0,u.jsx)(f,{feature:r,model:n,sequence:s}):"genomic_sequence_updownstream"===e?(0,u.jsx)(f,{model:n,feature:r,sequence:s,upstream:o,downstream:l}):"cds"===e?(0,u.jsx)(g,{model:n,cds:i,sequence:s}):"cdna"===e?(0,u.jsx)(m,{model:n,exons:p,feature:r,cds:i,utr:h,sequence:s}):"protein"===e?(0,u.jsx)(w,{model:n,cds:i,codonTable:(0,a.generateCodonTable)(a.defaultCodonTable),sequence:s}):"gene"===e?(0,u.jsx)(m,{model:n,exons:p,feature:r,cds:i,utr:h,sequence:s,includeIntrons:!0}):"gene_collapsed_intron"===e?(0,u.jsx)(m,{model:n,exons:p,feature:r,cds:i,sequence:s,utr:h,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===e?(0,u.jsx)(m,{model:n,exons:p,feature:r,cds:i,sequence:s,utr:h,upstream:o,downstream:l,includeIntrons:!0}):"gene_updownstream_collapsed_intron"===e?(0,u.jsx)(m,{model:n,exons:p,feature:r,cds:i,sequence:s,utr:h,upstream:o,downstream:l,includeIntrons:!0,collapseIntron:!0}):(0,u.jsx)("div",{children:"Unknown type"})})}),x=(0,o.observer)(function({mode:e,model:r,feature:t}){return(0,u.jsx)("div",{style:{background:"white"},children:`>${[[t.name||t.id,e].filter(e=>!!e).join("-"),`${t.refName}:${(0,a.toLocale)(t.start+1)}-${(0,a.toLocale)(t.end)}${n=t.strand,-1===n?"(-)":1===n?"(+)":""}`,e.endsWith("updownstream")?`+/- ${(0,a.toLocale)(r.upDownBp)} up/downstream bp`:""].filter(e=>!!e).join(" ")}\n`});var n});function j(e){const r=(0,n.c)(3),{children:t}=e;let s,o;return r[0]===Symbol.for("react.memo_cache_sentinel")?(s={fontFamily:"monospace",color:"black",fontSize:11},r[0]=s):s=r[0],r[1]!==t?(o=(0,u.jsx)("pre",{style:s,children:t}),r[1]=t,r[2]=o):o=r[2],o}function C(e){const r=(0,n.c)(3),{children:t}=e;let s,o;return r[0]===Symbol.for("react.memo_cache_sentinel")?(s={fontFamily:"monospace",color:"black",fontSize:11,maxWidth:600,whiteSpace:"wrap",wordBreak:"break-all"},r[0]=s):s=r[0],r[1]!==t?(o=(0,u.jsx)("div",{style:s,children:t}),r[1]=t,r[2]=o):o=r[2],o}const b=(0,o.observer)((0,s.forwardRef)(function(e,r){const t=(0,n.c)(17),{sequence:s,model:o,feature:a}=e,{showCoordinates:c,mode:l}=o,d=c?j:C;let i,h,m,g,f;return t[0]===Symbol.for("react.memo_cache_sentinel")?(i={maxHeight:300,overflow:"auto"},t[0]=i):i=t[0],t[1]!==a||t[2]!==l||t[3]!==o?(h=(0,u.jsx)(x,{model:o,mode:l,feature:a}),t[1]=a,t[2]=l,t[3]=o,t[4]=h):h=t[4],t[5]!==a||t[6]!==l||t[7]!==o||t[8]!==s?(m=(0,u.jsx)(p,{model:o,mode:l,feature:a,sequence:s}),t[5]=a,t[6]=l,t[7]=o,t[8]=s,t[9]=m):m=t[9],t[10]!==d||t[11]!==h||t[12]!==m?(g=(0,u.jsxs)(d,{children:[h,m]}),t[10]=d,t[11]=h,t[12]=m,t[13]=g):g=t[13],t[14]!==r||t[15]!==g?(f=(0,u.jsx)("div",{"data-testid":"sequence_panel",ref:r,style:i,children:g}),t[14]=r,t[15]=g,t[16]=f):f=t[16],f}))},76746:(e,r,t)=>{t.r(r),t.d(r,{default:()=>p});var n=t(7552),s=t(67112),o=t(76218),a=t(61282),c=t(69092),l=t(30698),d=t(68446),i=t(75785),u=t(45669),h=t(78781),m=t(54579),g=t(14465),f=t(69500);const w=(0,i.n9)()({dialogContent:{width:"80em"},formControl:{margin:0,marginLeft:4}}),p=(0,d.observer)(function({handleClose:e,model:r,feature:t}){const{sequenceFeatureDetails:d}=r,{upDownBp:i}=d,{classes:p}=w(),x=(0,n.useRef)(null),[j,C]=(0,n.useState)(!1),{sequence:b,error:S}=(0,h.p)(r,t,i,j);return(0,f.jsxs)(s.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{e()},title:"Sequence view",children:[(0,f.jsxs)(o.A,{className:p.dialogContent,children:[(0,f.jsxs)("div",{children:[(0,f.jsx)(g.A,{model:d}),(0,f.jsx)(m.A,{ref:x,model:d})]}),(0,f.jsxs)("div",{children:["gene"===t.type?(0,f.jsx)(a.A,{children:"Note: inspect subfeature sequences for protein/CDS computations"}):null,S?(0,f.jsx)(s.ErrorMessage,{error:S}):b?"error"in b?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(a.A,{color:"error",children:b.error}),(0,f.jsx)(c.A,{variant:"contained",color:"inherit",onClick:()=>{C(!0)},children:"Force load"})]}):(0,f.jsx)(n.Suspense,{fallback:(0,f.jsx)(s.LoadingEllipses,{}),children:(0,f.jsx)(u.default,{ref:x,feature:t,sequence:b,model:d})}):(0,f.jsx)(s.LoadingEllipses,{})]})]}),(0,f.jsx)(l.A,{children:(0,f.jsx)(c.A,{onClick:()=>{e()},variant:"contained",children:"Close"})})]})})}}]);
//# sourceMappingURL=6746.c1f1b34b.chunk.js.map