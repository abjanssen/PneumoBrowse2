(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9945],{198:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(91063),a=r(36422),i=r(48180),o=r(95742),s=r(25889),l=r(67112),c=r(93100),d=r(99546),u=r(37347),p=r(69500);class g extends o.default{serializeArgsInClient(e){return{...e,config:(0,a.isStateTreeNode)(e.config)?(0,a.getSnapshot)(e.config):e.config,filters:e.filters?.toJSON().filters}}deserializeResultsInClient(e,t){return t.exportSVG?{...e,html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,reactElement:(0,p.jsx)(s.A,{...t,...e,RenderingComponent:this.ReactComponent})}}deserializeArgsInWorker(e){const t={...e};return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=e.filters?new c.A({filters:e.filters}):void 0,t}serializeResultsInWorker(e,t){const r=(0,i.F0)((0,p.jsx)(n.A,{theme:(0,l.createJBrowseTheme)(t.theme),children:e.reactElement}));return e.reactElement=void 0,{...e,html:r}}async renderInClient(e,t){const r=await e.call(t.sessionId,"CoreRender",t);return"canvasRecordedData"in r&&(r.html=await(0,d.getSerializedSvg)(r),r.reactElement=void 0),r}async renderInWorker(e){const{stopToken:t,statusCallback:r=()=>{}}=e,n=this.deserializeArgsInWorker(e),a=await(0,d.updateStatus)("Rendering plot",r,(()=>this.render(n)));return(0,u.SW)(t),(0,d.updateStatus)("Serializing results",r,(()=>this.serializeResultsInWorker(a,n)))}async freeResourcesInClient(e,t){const r=this.serializeArgsInClient(t),{sessionId:n}=t;await e.call(n,"CoreFreeResources",r)}}},373:(e,t,r)=>{"use strict";function n(e,t){return e.map((e=>t.slice(e.start,e.end))).join("")}function a(e){return`${e.start}-${e.end}`}function i(e){return e.filter(((e,t,r)=>!t||a(e)!==a(r[t-1])))}function o(e,t){return e.map((e=>({...e,start:t-e.end,end:t-e.start}))).sort(((e,t)=>e.start-t.start))}function s(e,t){if(!e.length)return[];const r=e.at(0),n=e.at(-1),a=t.findIndex((e=>e.end>=r.start&&e.start<=r.start)),i=t.findIndex((e=>e.end>=n.end&&e.start<=n.end)),o=t[i],s=t[a];return[...[...t.slice(0,a),{start:s.start,end:r.start}].map((e=>({...e,type:"five_prime_UTR"}))),...[{start:n.end,end:o.end},...t.slice(i+1)].map((e=>({...e,type:"three_prime_UTR"})))]}function l(e,t){if(!e.length)return[];const r=e.at(0),n=e.at(-1);return[...[{start:t.start,end:r.start}].map((e=>({...e,type:"five_prime_UTR"}))),...[{start:n.end,end:t.end}].map((e=>({...e,type:"three_prime_UTR"})))]}function c(e){return e.length>20?`${e.slice(0,20)}...`:e}function d(e){return JSON.parse(JSON.stringify(e,((e,t)=>void 0===t?null:t)))}function u(e,t,r,n=0,a={}){t<=n||e.subfeatures?.map((e=>{u(e,t,r,n+1,a),r(e)}))}r.d(t,{Il:()=>d,Qq:()=>i,SX:()=>c,V4:()=>l,YC:()=>o,fq:()=>u,h8:()=>s,o9:()=>n})},679:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(7552),a=r(68584),i=r(58921),o=r(8832),s=r(36422);function l(e){return s.types.model("PluginStoreModel",{id:o.ElementId,type:s.types.literal("PluginStoreWidget"),filterText:"",view:s.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((e=>({clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}})))}const c=(0,a.ConfigurationSchema)("PluginStoreWidget",{});function d(e){e.addWidgetType((()=>new i.WidgetType({name:"PluginStoreWidget",heading:"Plugin store",configSchema:c,stateModel:l(e),ReactComponent:(0,n.lazy)((()=>Promise.all([r.e(6386),r.e(1557)]).then(r.bind(r,21557))))})))}},1622:(e,t,r)=>{"use strict";r.r(t),r.d(t,{BaseConnectionModelFactory:()=>o,BaseDisplay:()=>u,BaseInternetAccountConfig:()=>p,BaseViewModel:()=>s.A,InternetAccount:()=>f,baseConnectionConfig:()=>a,createBaseTrackConfig:()=>v,createBaseTrackModel:()=>w});var n=r(68584);const a=(0,n.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"});var i=r(36422);const o=function(e){return i.types.model("Connection",{name:i.types.identifier,tracks:i.types.array(e.pluggableConfigSchemaType("track")),configuration:(0,n.ConfigurationReference)(a)}).actions((()=>({connect(e){}}))).actions((e=>({afterAttach(){0===e.tracks.length&&e.connect(e.configuration)},addTrackConf(t){const r=e.tracks.push(t);return e.tracks[r-1]},addTrackConfs(t){e.tracks.push(...t)},setTrackConfs(t){e.tracks=(0,i.cast)(t)},clear(){}})))};var s=r(7772),l=r(99546),c=r(91468),d=r(8832);const u=i.types.model("BaseDisplay",{id:d.ElementId,type:i.types.string,rpcDriverName:i.types.maybe(i.types.string)}).volatile((()=>({rendererTypeName:"",error:void 0,message:void 0}))).views((e=>({get RenderingComponent(){const{pluginManager:t}=(0,l.getEnv)(e);return t.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,n.getConf)(this.parentTrack,"adapter")},get parentTrack(){let t=(0,i.getParent)(e);for(;!t.configuration||!(0,n.getConf)(t,"trackId");){if((0,i.isRoot)(t))throw new Error(`No parent track found for ${e.type} ${e.id}`);t=(0,i.getParent)(t)}return t},renderProps:()=>({...(0,c.getParentRenderProps)(e),notReady:(0,l.getContainingView)(e).minimized,rpcDriverName:e.rpcDriverName,displayModel:e}),get rendererType(){const{pluginManager:t}=(0,l.getEnv)(e);return t.getRendererType(e.rendererTypeName)},get DisplayMessageComponent(){},trackMenuItems:()=>[],get viewMenuActions(){return[]},regionCannotBeRendered:()=>null}))).actions((e=>({setMessage(t){e.message=t},setError(t){e.error=t},setRpcDriverName(t){e.rpcDriverName=t},reload(){}}))),p=(0,n.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0});var g=r(99834);const h="undefined"==typeof sessionStorage,f=i.types.model("InternetAccount",{id:d.ElementId,type:i.types.string,configuration:(0,n.ConfigurationReference)(p)}).views((e=>({get name(){return(0,n.getConf)(e,"name")},get description(){return(0,n.getConf)(e,"description")},get internetAccountId(){return(0,n.getConf)(e,"internetAccountId")},get authHeader(){return(0,n.getConf)(e,"authHeader")},get tokenType(){return(0,n.getConf)(e,"tokenType")},get domains(){return(0,n.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}}))).views((e=>({handlesLocation:t=>e.domains.some((e=>t.uri.includes(e))),get tokenKey(){return`${e.internetAccountId}-token`}}))).actions((e=>({getTokenFromUser(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken(t){sessionStorage.setItem(e.tokenKey,t)},removeToken(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:()=>sessionStorage.getItem(e.tokenKey),validateToken:async(e,t)=>e}))).actions((e=>{let t;return{async getToken(r){if(t)return t;let n=r?.internetAccountPreAuthorization?.authInfo?.token;if(n)return t=Promise.resolve(n),t;if(h)throw new Error("Did not get internet account pre-authorization info in worker");return n=e.retrieveToken(),n?(t=Promise.resolve(n),t):(t=new Promise(((t,r)=>{e.getTokenFromUser((r=>{e.storeToken(r),t(r)}),(t=>{e.removeToken(),r(t)}))})),t)}}})).actions((e=>({addAuthHeaderToInit:(t,r)=>({...t,headers:new Headers({...t?.headers,...r?{[e.authHeader]:e.tokenType?`${e.tokenType} ${r}`:r}:{}})}),async getPreAuthorizationInformation(t){const r=await e.getToken(t);let a;try{a=await e.validateToken(r,t)}catch(t){throw e.removeToken(),t}return{internetAccountType:e.type,authInfo:{token:a,configuration:(0,n.getConf)(e)}}}}))).actions((e=>({getFetcher:t=>async(r,n)=>{const a=await e.getToken(t),i=e.addAuthHeaderToInit(n,a);return fetch(r,i)}}))).actions((e=>({openLocation:t=>new g.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})})));var m=r(42489),y=r(80703),b=r(92516);function w(e,t,r){return i.types.model(t,{id:d.ElementId,type:i.types.literal(t),configuration:(0,n.ConfigurationReference)(r),minimized:!1,pinned:!1,displays:i.types.array(e.pluggableMstType("display","stateModel"))}).views((t=>({get rpcSessionId(){const e=(0,n.getConf)(t,"adapter");return e?(0,y.L)(e):t.configuration.trackId},get name(){return(0,n.getConf)(t,"name")},get textSearchAdapter(){return(0,n.getConf)(t,"textSearchAdapter")},get adapterConfig(){return(0,n.getConf)(t,"adapter")},get adapterType(){const r=(0,n.getConf)(t,"adapter");if(!r)throw new Error(`no adapter configuration provided for ${t.type}`);const a=e.getAdapterType(r.type);if(!a)throw new Error(`unknown adapter type ${r.type}`);return a},get viewMenuActions(){return t.displays.flatMap((e=>e.viewMenuActions))},get canConfigure(){const e=(0,l.getSession)(t),{sessionTracks:r,adminMode:n}=e;return(0,b.u3)(e)&&(n||r?.find((e=>e.trackId===t.configuration.trackId)))}}))).actions((t=>({setPinned(e){t.pinned=e},setMinimized(e){t.minimized=e},showDisplay(r,n={}){const a=e.pluggableConfigSchemaType("display"),o=(0,i.resolveIdentifier)(a,(0,i.getRoot)(t),r),s=e.getDisplayType(o.type);if(!s)throw new Error(`unknown display type ${o.type}`);const l=s.stateModel.create({...n,type:o.type,configuration:o});t.displays.push(l)},hideDisplay(r){const n=e.pluggableConfigSchemaType("display"),a=(0,i.resolveIdentifier)(n,(0,i.getRoot)(t),r),o=t.displays.filter((e=>e.configuration===a));return(0,m.transaction)((()=>{for(const e of o)t.displays.remove(e)})),o.length},replaceDisplay(r,n,a={}){const o=t.displays.findIndex((e=>e.configuration.displayId===r));if(-1===o)throw new Error(`could not find display id ${r} to replace`);const s=e.pluggableConfigSchemaType("display"),l=(0,i.resolveIdentifier)(s,(0,i.getRoot)(t),n);if(!e.getDisplayType(l.type))throw new Error(`unknown display type ${l.type}`);t.displays.splice(o,1,{...a,type:l.type,configuration:l})}}))).views((t=>({trackMenuItems(){const r=t.displays.flatMap((e=>e.trackMenuItems())),n=t.displays[0].configuration.displayId,a=function(e){const{pluginManager:t}=(0,l.getEnv)(e),r=(0,l.getContainingView)(e),n=t.getViewType(r.type),a=new Set(n.displayTypes.map((e=>e.name)));return e.configuration.displays.filter((e=>a.has(e.type)))}(t);return[...r,...a.length>1?[{type:"subMenu",label:"Display types",priority:-1e3,subMenu:a.map((r=>({type:"radio",label:e.getDisplayType(r.type).displayName,checked:r.displayId===n,onClick:()=>{t.replaceDisplay(n,r.displayId)}})))}]:[]]}})))}function v(e){return(0,n.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,n.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:i.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,n.ConfigurationSchema)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2"},maxDepth:{type:"number",defaultValue:99999,description:"Maximum depth to render subfeatures"}}),formatAbout:(0,n.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const r=e.evaluateExtensionPoint("Core-preProcessTrackConfig",structuredClone(t)),{displays:n=[]}=r;if("placeholderId"!==r.trackId)try{const t=new Set(n.map((e=>e.type)));for(const a of e.getTrackType(r.type).displayTypes)t.has(a.name)||n.push({displayId:`${r.trackId}-${a.name}`,type:a.name})}catch(e){throw new Error(`Unknown track type "${r.type}" in ${JSON.stringify(r)}`,{cause:e})}return{...r,displays:n.map((e=>({...e,displayId:e.displayId??`${r.trackId}-${e.type}`})))}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:r}=t;if(!r)throw new Error(`unknown display type ${r}`);const n=e.displays.find((e=>e?.displayId===t.displayId));if(n)return n;const a=e.displays.push(t);return e.displays[a-1]}})})}},1864:(e,t,r)=>{"use strict";r.d(t,{z:()=>n.when});var n=r(42489)},2265:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});class n{subLayouts=new Map;constructor(e,t={}){this.SubLayoutClass=e,this.subLayoutConstructorArgs=t}getDataByID(e){for(const t of this.subLayouts.values()){const r=t.getDataByID(e);if(r)return r}}getSublayout(e){let t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}addRect(e,t,r,n,a,i={}){return this.getSublayout(e).addRect(t,r,n,a,i)}discardRange(e,t,r){return this.subLayouts.get(e)?.discardRange(t,r)}toJSON(){const e={};for(const[t,r]of this.subLayouts.entries())e[t]=r.toJSON();return e}}},2286:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(7552),a=r(68584),i=r(67112),o=r(9236),s=r(68446),l=r(69500);const c=(0,n.forwardRef)((function({message:e},t){return(0,l.jsx)("div",{ref:t,children:(0,n.isValidElement)(e)?e:e?(0,l.jsx)(i.SanitizedHTML,{html:String(e)}):null})})),d=(0,s.observer)((function({model:e,clientMouseCoord:t}){const{featureUnderMouse:r}=e,n=t[0]+15,i=t[1],s=r?(0,a.getConf)(e,"mouseover",{feature:r}):void 0;return r&&s?(0,l.jsx)(o.A,{clientPoint:{x:n,y:i},children:(0,l.jsx)(c,{message:s})}):null}))},2406:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(35470);const a=e=>"object"==typeof e&&null!==e,i=e=>a(e)&&!(e instanceof RegExp)&&!(e instanceof Error)&&!(e instanceof Date)&&!(globalThis.Blob&&e instanceof globalThis.Blob);function o(e,t,r=new WeakSet){if(r.has(e))return;r.add(e);const n=e=>{for(const n of e)t(n),a(n)&&o(n,t,r)};Array.isArray(e)&&n(e);for(const a of Object.values(e))t(a),i(a)&&(Array.isArray(a)?n(a):o(a,t,r))}var s=r(91468),l=r(92516);class c extends n.A{constructor(e){super(),this.pluginManager=e}async serializeArguments(e,t){const r=(0,s.getBlobMap)();return await this.augmentLocationObjects(e,t),{...e,blobMap:r}}async serializeNewAuthArguments(e,t){const r=this.pluginManager.rootModel;if(!(0,l.bV)(r)||e.internetAccountPreAuthorization)return e;const n=r.findAppropriateInternetAccount(e);return n&&"MainThreadRpcDriver"!==t&&(e.internetAccountPreAuthorization=await n.getPreAuthorizationInformation(e)),e}async deserializeArguments(e,t){return e.blobMap&&(0,s.setBlobMap)(e.blobMap),e}async serializeReturn(e,t,r){return e}async deserializeReturn(e,t,r){let n;try{n=await e}catch(e){if((0,l.ZL)(e)){const t=this.pluginManager.rootModel?.createEphemeralInternetAccount(`HTTPBasicInternetAccount-${new URL(e.url).origin}`,{},e.url);throw new l.J_("Retrying with created internet account",t.internetAccountId)}throw e}return n}async augmentLocationObjects(e,t){const r=[];o(e,(e=>{(0,l.C1)(e)&&r.push(e)}));for(const e of r)await this.serializeNewAuthArguments(e,t);return e}}},3496:(e,t,r)=>{"use strict";r.d(t,{cK:()=>i,pZ:()=>o});var n=r(80703);let a={};async function i(e,t,r){const o=(0,n.L)(r);if(!a[o]){const n=r?.type;if(!n)throw new Error(`could not determine adapter type from adapter config snapshot ${JSON.stringify(r)}`);const s=e.getAdapterType(n);if(!s)throw new Error(`unknown data adapter type ${n}`);const l=s.configSchema.create(r,{pluginManager:e}),c=i.bind(null,e,t),d=new(await s.getAdapterClass())(l,c,e);a[o]={dataAdapter:d,sessionIds:new Set([t])}}const s=a[o];return s.sessionIds.add(t),s}function o(e){const t=Object.keys(e);if(1===t.length&&"sessionId"===t[0]){const{sessionId:t}=e;for(const[e,r]of Object.entries(a))r.sessionIds.delete(t),0===r.sessionIds.size&&delete a[e]}else for(const t of Object.values(a)){const r=e.regions||(e.region?[e.region]:[]);for(const e of r)void 0!==e.refName&&t.dataAdapter.freeResources(e)}}},3519:(e,t,r)=>{"use strict";function n(e,t=JSON.stringify){const r=[],n=new Set;for(const a of e){const e=t(a);n.has(e)||(r.push(a),n.add(e))}return r}r.d(t,{Q:()=>n})},6184:(e,t,r)=>{"use strict";r.d(t,{Kd:()=>i,cm:()=>o});var n=r(8656),a=r(99546);async function i({option:e,model:t,assemblyName:r}){const n=e.getLocation(),a=e.getTrackId();n&&(await t.navToLocString(n,r,.2),a&&t.showTrack(a))}async function o({input:e,model:t,assembly:r}){const o=r.allRefNamesWithLowerCase||[],s=r.name;if(e.split(" ").every((e=>function(e,t){const[r,n]=function(e){const t=e.lastIndexOf(":");if(-1===t)return[e,""];return[e.slice(0,t),e.slice(t+1)]}(e);return t.includes(e)||t.includes(r)&&!Number.isNaN(Number.parseInt(n,10))}(e,o))))await t.navToLocString(e,r.name);else{const o=t.searchScope(s),{textSearchManager:l}=(0,a.getSession)(t),c=await async function({queryString:e,searchType:t,searchScope:r,rankSearchResults:i,textSearchManager:o,assembly:s}){o||console.warn("No text search manager");const l=await(o?.search({queryString:e,searchType:t},r,i)),c=s?.allRefNames?.filter((t=>t.toLowerCase().startsWith(e.toLowerCase()))).slice(0,10).map((e=>new n.A({label:e})));return(0,a.dedupe)([...c||[],...l||[]],(e=>e.getId()))}({queryString:e,searchType:"exact",searchScope:o,rankSearchResults:t.rankSearchResults,textSearchManager:l,assembly:r});c.length>1?t.setSearchResults(c,e.toLowerCase(),s):1===c.length?await i({option:c[0],model:t,assemblyName:s}):await t.navToLocString(e,s)}}},6434:(e,t,r)=>{"use strict";function n(e){return"object"==typeof e&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id}function a(e){return"uniqueId"in e&&"object"!=typeof e.data}r.d(t,{A:()=>i,l:()=>n});class i{constructor(e){a(e)?this.data=e:(this.data=e.data,this.parentHandle=e.parent);const t=a(e)?e.uniqueId:e.id;if(null==t)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(t),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error(`invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`);this.data.subfeatures&&(this.subfeatures=this.data.subfeatures?.map(((e,r)=>"function"!=typeof e.get?new i({id:e.uniqueId||`${t}-${r}`,data:{strand:this.data.strand,...e},parent:this}):e)))}get(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}set(e,t){this.data[e]=t}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={...this.data,uniqueId:this.id()},t=this.parent();t&&(e.parentId=t.id());const r=this.children();return r&&(e.subfeatures=r.map((e=>e.toJSON()))),e}static fromJSON(e){return new i({...e})}}},6842:(e,t,r)=>{"use strict";function n(e,t){return`${(e.startsWith("metadata.")?t.metadata?.[e.replace("metadata.","")]:t[e])||""}`}r.d(t,{a:()=>n})},7772:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(36422),a=r(8832);const i=n.types.model("BaseView",{id:a.ElementId,displayName:n.types.maybe(n.types.string),minimized:!1}).volatile((()=>({width:800}))).views((()=>({menuItems:()=>[]}))).actions((e=>({setDisplayName(t){e.displayName=t},setWidth(t){e.width=t},setMinimized(t){e.minimized=t}}))),o=i;i.props({displayedRegions:n.types.array(a.Region)})},8024:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{constructor(e){super(e),this.description=e.description,this.configSchema=e.configSchema,this.getAdapterClass="getAdapterClass"in e?e.getAdapterClass:async()=>e.AdapterClass}}},8656:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,S:()=>a});class n{constructor(e){this.label=e.label,this.locString=e.locString,this.renderingComponent=e.renderingComponent,this.displayString=e.displayString,this.matchedAttribute=e.matchedAttribute,this.matchedObject=e.matchedObject,this.textSearchAdapter=e.textSearchAdapter,this.relevance=e.relevance,this.trackId=e.trackId,this.score=e.score||1,this.results=e.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(e){return this.score=e,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}class a extends n{constructor(e){super(e),this.refName=e.refName??""}getLocation(){return this.refName}}},9342:(e,t,r)=>{"use strict";r.d(t,{Q:()=>a,n:()=>p});var n=r(68584);const a=(0,n.ConfigurationSchema)("BaseFeatureWidget",{});var i=r(42489),o=r(36422),s=r(99546);function l(e,t){(0,s.localStorageSetItem)(e,JSON.stringify(t))}const c="sequenceFeatureDetails";var d=r(373),u=r(8832);function p(e){return o.types.model("BaseFeatureWidget",{id:u.ElementId,type:o.types.literal("BaseFeatureWidget"),featureData:o.types.frozen(),formattedFields:o.types.frozen(),unformattedFeatureData:o.types.frozen(),view:o.types.safeReference(e.pluggableMstType("view","stateModel")),track:o.types.safeReference(e.pluggableMstType("track","stateModel")),trackId:o.types.maybe(o.types.string),trackType:o.types.maybe(o.types.string),maxDepth:o.types.maybe(o.types.number),sequenceFeatureDetails:o.types.optional(o.types.model("SequenceFeatureDetails").volatile((()=>({showCoordinatesSetting:(0,s.localStorageGetItem)(`${c}-showCoordinatesSetting`)||"none",intronBp:(0,s.localStorageGetNumber)(`${c}-intronBp`,10),upDownBp:(0,s.localStorageGetNumber)(`${c}-upDownBp`,100),upperCaseCDS:(0,s.localStorageGetBoolean)(`${c}-upperCaseCDS`,!0),charactersPerRow:100,feature:void 0,mode:""}))).actions((e=>({setFeature(t){e.feature=t},setUpDownBp(t){e.upDownBp=t},setIntronBp(t){e.intronBp=t},setUpperCaseCDS(t){e.upperCaseCDS=t},setShowCoordinates(t){e.showCoordinatesSetting=t},setMode(t){e.mode=t}}))).views((e=>({get showCoordinates(){return"none"!==e.showCoordinatesSetting},get showGenomicCoordsOption(){return"gene"===e.mode||"gene_updownstream"===e.mode||"genomic"===e.mode||"genomic_sequence_updownstream"===e.mode},get hasCDS(){return e.feature?.subfeatures?.some((e=>"CDS"===e.type))},get hasExon(){return e.feature?.subfeatures?.some((e=>"exon"===e.type))},get hasExonOrCDS(){return this.hasExon||this.hasCDS}}))).actions((e=>({afterAttach(){(0,o.addDisposer)(e,(0,i.autorun)((()=>{var t,r;l(`${c}-upDownBp`,e.upDownBp),l(`${c}-intronBp`,e.intronBp),t=`${c}-upperCaseCDS`,r=e.upperCaseCDS,(0,s.localStorageSetItem)(t,JSON.stringify(r)),(0,s.localStorageSetItem)(`${c}-showCoordinatesSetting`,e.showCoordinatesSetting)}))),(0,o.addDisposer)(e,(0,i.autorun)((()=>{e.setMode(e.hasCDS?"cds":e.hasExon?"cdna":"genomic")})))}}))),{}),descriptions:o.types.frozen()}).volatile((()=>({error:void 0}))).actions((e=>({setFeatureData(t){e.unformattedFeatureData=t},clearFeatureData(){e.featureData=void 0},setFormattedData(t){e.featureData=t},setExtra(t,r,n){e.trackId=r,e.trackType=t,e.maxDepth=n},setError(t){e.error=t}}))).actions((e=>({afterCreate(){(0,o.addDisposer)(e,(0,i.autorun)((()=>{try{const{unformattedFeatureData:t,track:r}=e,a=(0,s.getSession)(e);if(r&&e.setExtra(r.type,r.configuration.trackId,(0,n.getConf)(r,["formatDetails","maxDepth"])),t){const i=structuredClone(t),o=(e,t)=>({...(0,n.getConf)(a,["formatDetails",e],{feature:t}),...(0,n.getConf)(r,["formatDetails",e],{feature:t})});r&&(i.__jbrowsefmt=o("feature",i),(0,d.fq)(i,(0,n.getConf)(r,["formatDetails","depth"]),(e=>{e.__jbrowsefmt=o("subfeatures",e)}))),e.setFormattedData(i)}}catch(t){console.error(t),e.setError(t)}})))}}))).preProcessSnapshot((e=>{const{featureData:t,finalizedFeatureData:r,...n}=e;return{unformattedFeatureData:t,featureData:r,...n}})).postProcessSnapshot((e=>{const{unformattedFeatureData:t,featureData:r,...n}=e,a=JSON.stringify(r,((e,t)=>void 0===t?null:t));return{finalizedFeatureData:!a||a.length>2e6?void 0:JSON.parse(a),...n}}))}},9669:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var n=r(99546),a=r(68446),i=r(7552),o=r(51414),s=r(62266),l=r(69500);const c=({x:e,y:t,width:r,height:a,color:i})=>{const c=(0,o.A)();return(0,l.jsx)("rect",{pointerEvents:"auto",x:e,y:t,width:r,height:a,...(0,n.getFillProps)(i||(0,s.X4)(c.palette.background.paper,.3))})},d=(0,a.observer)((function({model:e,labelWidth:t}){const{canDisplayLabels:r,rowHeight:a,sources:s}=e,d=(0,n.clamp)(a,8,12),u=s?.some((e=>e.color)),p=t+(u?20:0),g=(0,o.A)();return s?(0,l.jsxs)(l.Fragment,{children:[r?(0,l.jsx)(c,{y:0,x:0,width:p,height:(s.length+.25)*a}):null,s.map(((e,t)=>{const{color:o,name:s,label:u}=e;return(0,l.jsxs)(i.Fragment,{children:[o?(0,l.jsx)(c,{y:t*a,x:0,width:15.5,height:a+.5,color:o}):null,r?(0,l.jsx)("text",{y:t*a+d,x:o?17:0,fontSize:d,...(0,n.getFillProps)(g.palette.text.primary),children:u||s}):null]},`${u}-${t}`)}))]}):null})),u=(0,a.observer)((function({children:e,model:t,exportSVG:r}){const{id:a,scrollTop:i,height:o}=t,s=`legend-${a}`;return r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("defs",{children:(0,l.jsx)("clipPath",{id:s,children:(0,l.jsx)("rect",{x:0,y:0,width:1e3,height:o})})}),(0,l.jsx)("g",{clipPath:`url(#${s})`,children:(0,l.jsx)("g",{transform:`translate(0,${-i})`,children:e})})]}):(0,l.jsx)("svg",{style:{position:"absolute",top:0,left:0,zIndex:100,pointerEvents:"none",height:t.totalHeight,width:(0,n.getContainingView)(t).width},children:e})})),p=(0,a.observer)((function(e){const{model:t}=e,{canDisplayLabels:r,rowHeight:a,sources:i}=t,o=(0,n.clamp)(a,8,12);return i?(0,l.jsx)(u,{...e,children:(0,l.jsx)(d,{model:t,labelWidth:(0,n.max)(i.map((e=>(0,n.measureText)(e.label,o)+10)).map((e=>r?e:20)),0)})}):null}))},11210:(e,t,r)=>{"use strict";r.d(t,{r:()=>z.default,m_:()=>E.default,er:()=>u,Ep:()=>w,Oy:()=>C.YSCALEBAR_LABEL_OFFSET,Ay:()=>xe,$z:()=>C.getOrigin,X_:()=>C.getScale,_i:()=>j});var n=r(12678),a=r(47369),i=r(68584);const o=(0,i.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bigWigLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=r(7552),l=r(99546);const c=(0,s.lazy)((()=>r.e(9305).then(r.bind(r,69305))));var d=r(92880);class u extends d.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{inverted:r,height:n,regions:a,bpPerPx:i,statusCallback:o=()=>{}}=e,s=a[0],c=(s.end-s.start)/i,{reducedFeatures:d,...u}=await(0,l.updateStatus)("Rendering plot",o,(()=>(0,l.renderToAbstractCanvas)(c,n,e,(n=>this.draw(n,{...e,features:t,inverted:r}))))),p=await super.render({...e,...u,features:t,height:n,width:c});return{...p,...u,features:d?new Map(d.map((e=>[e.id(),e]))):p.features,height:n,width:c,containsNoTransferables:!0}}}class p extends u{async draw(e,t){const{drawDensity:n}=await r.e(5847).then(r.bind(r,65847));return n(e,t)}}var g=r(36422);const h=(0,i.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue",contextVariable:["feature"]},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red",contextVariable:["feature"]},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:g.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0}),f=(0,i.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:h,explicitlyTyped:!0});var m=r(67112),y=r(68446),b=r(69500);const w=(0,y.observer)((function(e){const{regions:t,features:r,bpPerPx:n,width:a,height:i,onMouseLeave:o,onMouseMove:l,onFeatureClick:c}=e,d=t[0],u=(0,s.useRef)(null);function p(e){let t=0;u.current&&(t=u.current.getBoundingClientRect().left);const i=e-t,o=d.reversed?a-i:i,s=d.start+n*o;let l;for(const e of r.values())if(s<=e.get("end")+n&&s>=e.get("start")){l=e;break}return l}return(0,b.jsx)("div",{ref:u,"data-testid":"wiggle-rendering-test",onMouseMove:e=>l?.(e,p(e.clientX)?.id()),onClick:e=>c?.(e,p(e.clientX)?.id()),onMouseLeave:e=>o?.(e),style:{overflow:"visible",position:"relative",height:i},children:(0,b.jsx)(m.PrerenderedCanvas,{...e})})}));var v=r(91468);const S=(0,i.ConfigurationSchema)("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:h,explicitlyTyped:!0});var C=r(75429);class x extends u{async draw(e,t){const{config:n}=t,a=(0,i.readConfObject)(n,"color"),{drawLine:o}=await r.e(9113).then(r.bind(r,49113));return o(e,{...t,offset:C.YSCALEBAR_LABEL_OFFSET,colorCallback:"#f0f"===a?()=>"grey":e=>(0,i.readConfObject)(n,"color",{feature:e})})}}var k=r(56328),T=r(97486);function A(){return(0,i.ConfigurationSchema)("SharedWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:g.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:g.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:T.Ki,explicitlyTyped:!0})}var M=r(37832),P=r(48747),R=r(20482),L=r(77126),I=r(37347);const F=(0,s.lazy)((()=>r.e(8615).then(r.bind(r,8615))));function N(e){return g.types.compose(T.Lr,g.types.model({selectedRendering:g.types.optional(g.types.string,""),resolution:g.types.optional(g.types.number,1),fill:g.types.maybe(g.types.boolean),minSize:g.types.maybe(g.types.number),color:g.types.maybe(g.types.string),posColor:g.types.maybe(g.types.string),negColor:g.types.maybe(g.types.string),summaryScoreMode:g.types.maybe(g.types.string),rendererTypeNameState:g.types.maybe(g.types.string),scale:g.types.maybe(g.types.string),autoscale:g.types.maybe(g.types.string),displayCrossHatches:g.types.maybe(g.types.boolean),constraints:g.types.optional(g.types.model({max:g.types.maybe(g.types.number),min:g.types.maybe(g.types.number)}),{}),configuration:(0,i.ConfigurationReference)(e)})).volatile((()=>({message:void 0,stats:void 0,statsFetchInProgress:void 0}))).actions((e=>({updateQuantitativeStats(t){const{currStatsBpPerPx:r,scoreMin:n,scoreMax:a}=t,i=1e-6;(!e.stats||Math.abs(e.stats.scoreMax-a)>i||Math.abs(e.stats.scoreMin-n)>i)&&(e.stats={currStatsBpPerPx:r,scoreMin:n,scoreMax:a})},setColor(t){e.color=t},setPosColor(t){e.posColor=t},setNegColor(t){e.negColor=t},setStatsLoading(t){e.statsFetchInProgress&&(0,I.CF)(e.statsFetchInProgress),e.statsFetchInProgress=t},selectFeature(t){const r=(0,l.getSession)(e);(0,l.isSelectionContainer)(r)&&r.setSelection(t)},setResolution(t){e.resolution=t},setFill(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale(){e.scale="log"===e.scale?"linear":"log"},setScaleType(t){e.scale=t},setSummaryScoreMode(t){e.summaryScoreMode=t},setAutoscale(t){e.autoscale=t},setMaxScore(t){e.constraints.max=t},setRendererType(t){e.rendererTypeNameState=t},setMinScore(t){e.constraints.min=t},toggleCrossHatches(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches(t){e.displayCrossHatches=t}}))).views((e=>({get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){return e.rendererTypeNameState??(0,i.getConf)(e,"defaultRendering")},get filters(){},get scaleType(){return e.scale??(0,i.getConf)(e,"scaleType")},get maxScore(){return e.constraints.max??(0,i.getConf)(e,"maxScore")},get minScore(){return e.constraints.min??(0,i.getConf)(e,"minScore")}}))).views((e=>({get adapterCapabilities(){const t=e.adapterTypeName,{pluginManager:r}=(0,l.getEnv)(e);return r.getAdapterType(t).adapterCapabilities},get rendererConfig(){const{color:t,displayCrossHatches:r,fill:n,minSize:a,negColor:o,posColor:s,summaryScoreMode:c,scaleType:d,rendererTypeName:u}=e,p=(0,i.getConf)(e,["renderers",u])||{};return e.rendererType.configSchema.create({...p,...d?{scaleType:d}:{},...void 0!==n?{filled:n}:{},...void 0!==r?{displayCrossHatches:r}:{},...void 0!==c?{summaryScoreMode:c}:{},...void 0!==t?{color:t}:{},...void 0!==o?{negColor:o}:{},...void 0!==s?{posColor:s}:{},...void 0!==a?{minSize:a}:{}},(0,l.getEnv)(e))},get autoscaleType(){return e.autoscale??(0,i.getConf)(e,"autoscale")}}))).views((e=>{let t=[0,0];return{get domain(){const{stats:r,scaleType:n,minScore:a,maxScore:i}=e;if(!r)return;const o=(0,C.getNiceDomain)({domain:[r.scoreMin,r.scoreMax],bounds:[a,i],scaleType:n});return"log"===n&&o[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(o)&&(t=o),t)}}})).views((e=>({get filled(){return e.fill??(0,i.readConfObject)(e.rendererConfig,"filled")},get summaryScoreModeSetting(){return e.summaryScoreMode??(0,i.readConfObject)(e.rendererConfig,"summaryScoreMode")},get scaleOpts(){return{domain:e.domain,stats:e.stats,autoscaleType:e.autoscaleType,scaleType:e.scaleType,inverted:(0,i.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get displayCrossHatchesSetting(){return e.displayCrossHatches??(0,i.readConfObject)(e.rendererConfig,"displayCrossHatches")},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")}}))).views((e=>({scoreTrackMenuItems:()=>[...e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((t=>({label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:()=>{e.setSummaryScoreMode(t)}})))}]:[],{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:()=>{e.toggleLogScale()}},{label:"Autoscale type",subMenu:[["local","Local"],...e.hasGlobalStats?[["global","Global"],["globalsd","Global ± 3σ"]]:[],["localsd","Local ± 3σ"]].map((([t,r])=>({label:r,type:"radio",checked:e.autoscaleType===t,onClick:()=>{e.setAutoscale(t)}})))},{label:"Set min/max score",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[F,{model:e,handleClose:t}]))}}]}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),t()}}}))}const D=(0,s.lazy)((()=>Promise.resolve().then(r.bind(r,57266)))),B=(0,s.lazy)((()=>Promise.all([r.e(6395),r.e(725)]).then(r.bind(r,23106)))),V=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),j=function(e,t){return g.types.compose("LinearWiggleDisplay",N(t),g.types.model({type:g.types.literal("LinearWiggleDisplay"),invertedSetting:g.types.maybe(g.types.boolean)})).actions((e=>({setInverted(t){e.invertedSetting=t}}))).views((e=>({get TooltipComponent(){return D},get rendererTypeName(){const t=e.rendererTypeNameSimple,r=V.get(t);if(!r)throw new Error(`unknown renderer ${t}`);return r},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,l.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx},get graphType(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get inverted(){return e.invertedSetting??(0,i.getConf)(e,"inverted")}}))).views((e=>{const{renderProps:t}=e;return{adapterProps(){const r=t(),{filters:n,resolution:a,scaleOpts:i}=e;return{...r,rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig,displayCrossHatches:e.displayCrossHatchesSetting,scaleOpts:i,resolution:a,filters:n}},get ticks(){const{inverted:t,scaleType:r,domain:n,height:a}=e,o=(0,i.getConf)(e,"minimalTicks");if(n){const e=(0,L.axisPropsFromTickScale)((0,C.getScale)({scaleType:r,domain:n,range:[a-C.YSCALEBAR_LABEL_OFFSET,C.YSCALEBAR_LABEL_OFFSET],inverted:t}),4);return a<100||o?{...e,values:n}:e}}}})).views((e=>({renderProps(){const{inverted:t,ticks:r,height:n}=e,a=e.adapterProps();return{...e.adapterProps(),notReady:a.notReady||!e.stats,height:n,ticks:r,inverted:t}},get fillSetting(){return e.filled?0:1===e.minSize?1:2},get quantitativeStatsReady(){return(0,l.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error}}))).views((e=>{const{trackMenuItems:t}=e,r=(0,i.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",icon:M.A,subMenu:e.scoreTrackMenuItems()},...e.graphType?[{label:"Inverted",type:"checkbox",checked:e.inverted,onClick:()=>{e.setInverted(!e.inverted)}}]:[],...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,r)=>({label:t,type:"radio",checked:e.fillSetting===r,onClick:()=>{e.setFill(r)}})))}]:[],...r?[{label:"Renderer type",subMenu:["xyplot","density","line"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}})))}]:[],{label:"Color",icon:P.A,onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[B,{model:e,handleClose:t}]))}},...e.graphType?[{type:"checkbox",icon:R.A,label:"Show cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[]]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{const{getQuantitativeStatsAutorun:t}=await r.e(7722).then(r.bind(r,47722));t(e)})()},async renderSvg(n){const{renderSvg:a}=await r.e(1466).then(r.bind(r,51466));return a(e,n,t)}}}))};var E=r(57266),z=r(98911);const O=(0,i.ConfigurationSchema)("MultiDensityRenderer",{},{baseConfiguration:h,explicitlyTyped:!0}),H=(0,y.observer)((function(e){const{regions:t,features:r,bpPerPx:n,width:a,height:i,sources:o,onMouseLeave:c=()=>{},onMouseMove:d=()=>{},onFeatureClick:u=()=>{},displayModel:p}=e,g=t[0],h=(0,s.useRef)(null),{isMultiRow:f}=p||{};function y(e,t){if(!h.current)return;const s=h.current.getBoundingClientRect(),c=e-s.left,d=t-s.top,u=o[Math.floor(d/i*o.length)];if(!u)return;const p=g.reversed?a-c:c,m=g.start+n*p;let y;if(f){for(const e of r.values())if(e.get("source")===u.name&&m<=e.get("end")+n&&m>=e.get("start")){y=e;break}}else{const e=[];for(const t of r.values())m<=t.get("end")+n&&m>=t.get("start")&&e.push(t);if(e.length){const t=Math.floor(m);y=new l.SimpleFeature({uniqueId:"mouseoverfeat",sources:Object.fromEntries(e.map((e=>e.toJSON())).map((e=>{const{refName:t,start:r,end:n,source:a,...i}=e;return[a,i]}))),...g,start:t,end:t+1})}}return y}return(0,b.jsx)("div",{ref:h,onMouseMove:e=>{const{clientX:t,clientY:r}=e,n=y(t,r);d(e,n)},onClick:e=>{const{clientX:t,clientY:r}=e,n=y(t,r);u(e,n)},onMouseLeave:e=>{c(e)},style:{overflow:"visible",position:"relative",height:i},children:(0,b.jsx)(m.PrerenderedCanvas,{...e})})}));class G extends u{async draw(e,t){const{stopToken:n,sources:a,features:i}=t,o=(0,l.groupBy)(i.values(),(e=>e.get("source"))),s=t.height/a.length;let c=[];const{drawDensity:d}=await r.e(5847).then(r.bind(r,65847));return e.save(),(0,l.forEachWithStopTokenCheck)(a,n,(r=>{const n=o[r.name]||[],{reducedFeatures:a}=d(e,{...t,features:n,height:s});e.translate(0,s),c=c.concat(a)})),e.restore(),{reducedFeatures:c}}}class W extends u{async draw(e,t){const{stopToken:n,sources:a,features:i}=t,o=(0,l.groupBy)(i.values(),(e=>e.get("source"))),{drawLine:s}=await r.e(9113).then(r.bind(r,49113));let c=[];return(0,l.forEachWithStopTokenCheck)(a,n,(r=>{const{reducedFeatures:n}=s(e,{...t,features:o[r.name]||[],colorCallback:()=>r.color||"blue"});c=c.concat(n)})),{reducedFeatures:c}}}const $=(0,i.ConfigurationSchema)("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:h,explicitlyTyped:!0});var U=r(40898),q=r(41365),_=r.n(q);const J=()=>"#000000".replaceAll("0",(()=>(~~(16*Math.random())).toString(16))),X=(0,s.lazy)((()=>r.e(6021).then(r.bind(r,96021)))),Y=(0,s.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(3100),r.e(6395),r.e(8658)]).then(r.bind(r,68658)))),K=(0,s.lazy)((()=>r.e(7040).then(r.bind(r,67040)))),Q=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]),Z=function(e,t){return g.types.compose("MultiLinearWiggleDisplay",N(t),g.types.model({type:g.types.literal("MultiLinearWiggleDisplay"),layout:g.types.optional(g.types.frozen(),[]),showSidebar:!0})).volatile((()=>({sourcesLoadingStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0}))).actions((e=>({setShowSidebar(t){e.showSidebar=t},setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,I.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSources(t){_()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t}}))).views((e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return X},get rendererTypeName(){const t=e.rendererTypeNameSimple,r=Q.get(t);if(!r)throw new Error(`unknown renderer ${t}`);return r}}))).views((e=>({get graphType(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName},get needsFullHeightScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName},get isMultiRow(){return"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName||"MultiDensityRenderer"===e.rendererTypeName},get needsCustomLegend(){return"MultiDensityRenderer"===e.rendererTypeName},get canHaveFill(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName},get renderColorBoxes(){return!("MultiRowLineRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName)},get prefersOffset(){return this.isMultiRow},get sourcesWithoutLayout(){const t=Object.fromEntries(e.sourcesVolatile?.map((e=>[e.name,e]))||[]),r=e.sourcesVolatile;return r?.map((e=>({...t[e.name],...e}))).map(((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":U.set1[t]||J())})))},get sources(){const t=Object.fromEntries(e.sourcesVolatile?.map((e=>[e.name,e]))||[]),r=e.layout.length?e.layout:e.sourcesVolatile;return r?.map((e=>({...t[e.name],...e}))).map(((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":U.set1[t]||J())})))},get quantitativeStatsReady(){return(0,l.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error}}))).views((e=>({get rowHeight(){const{sources:t,height:r,isMultiRow:n}=e;return n?r/(t?.length||1):r},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return(0,i.getConf)(e,"minimalTicks")||this.rowHeightTooSmallForScalebar}}))).views((e=>{const{renderProps:t}=e;return{adapterProps:()=>({...t(),displayModel:e,config:e.rendererConfig,filters:e.filters,resolution:e.resolution,rpcDriverName:e.rpcDriverName,sources:e.sources}),get ticks(){const{scaleType:t,domain:r,isMultiRow:n,rowHeight:a,useMinimalTicks:o}=e;if(!r)return;const s=n?0:C.YSCALEBAR_LABEL_OFFSET,l=(0,L.axisPropsFromTickScale)((0,C.getScale)({scaleType:t,domain:r,range:[a-s,s],inverted:(0,i.getConf)(e,"inverted")}),4);return o?{...l,values:r}:l},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]},get quantitativeStatsRelevantToCurrentZoom(){const t=(0,l.getContainingView)(e);return e.stats?.currStatsBpPerPx===t.bpPerPx}}})).views((e=>({get legendFontSize(){return Math.min(e.rowHeight,12)},get canDisplayLegendLabels(){return e.rowHeight>11},get labelWidth(){return(0,l.max)(e.sources?.map((e=>(0,l.measureText)(e.name,this.legendFontSize))).map((e=>this.canDisplayLegendLabels?e:20))||[])},renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.stats,displayModel:e,rpcDriverName:e.rpcDriverName,displayCrossHatches:e.displayCrossHatches,height:e.height,ticks:e.ticks,stats:e.stats,scaleOpts:e.scaleOpts,onMouseMove:(t,r)=>{e.setFeatureUnderMouse(r)},onMouseLeave:()=>{e.setFeatureUnderMouse(void 0)}}},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:1===e.minSize?1:2}}))).views((e=>{const{trackMenuItems:t}=e,r=(0,i.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,r)=>({label:t,type:"radio",checked:e.fillSetting===r,onClick:()=>{e.setFill(r)}})))}]:[],...r?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>{e.setRendererType(t)}})))}]:[],...e.graphType?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>{e.toggleCrossHatches()}}]:[],{label:"Cluster by score",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[K,{model:e,handleClose:t}]))}},{label:"Show sidebar",type:"checkbox",checked:e.showSidebar,onClick:()=>{e.setShowSidebar(!e.showSidebar)}},{label:"Edit colors/arrangement...",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[Y,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const[{getMultiWiggleSourcesAutorun:t},{getQuantitativeStatsAutorun:n}]=await Promise.all([r.e(1439).then(r.bind(r,31439)),r.e(7722).then(r.bind(r,47722))]);n(e),t(e)}catch(t){(0,g.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(n){const{renderSvg:a}=await r.e(1531).then(r.bind(r,51531));return a(e,n,t)}}}))};var ee=r(58273),te=r(1622);class re extends u{async draw(e,t){const{stopToken:n,bpPerPx:a,sources:i,regions:o,features:s}=t,c=o[0],d=(0,l.groupBy)(s.values(),(e=>e.get("source"))),u=t.height/i.length,p=(c.end-c.start)/a,{drawLine:g}=await r.e(9113).then(r.bind(r,49113));let h=[];return e.save(),(0,l.forEachWithStopTokenCheck)(i,n,(r=>{const{reducedFeatures:n}=g(e,{...t,features:d[r.name]||[],height:u,colorCallback:()=>r.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,u),e.lineTo(p,u),e.stroke(),e.translate(0,u),h=h.concat(n)})),e.restore(),{reducedFeatures:h}}}const ne=(0,i.ConfigurationSchema)("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:h,explicitlyTyped:!0});class ae extends u{async draw(e,t){const{stopToken:n,bpPerPx:a,sources:i,regions:o,features:s}=t,c=o[0],d=(0,l.groupBy)(s.values(),(e=>e.get("source"))),u=t.height/i.length,p=(c.end-c.start)/a,{drawXY:g}=await r.e(5524).then(r.bind(r,15524));let h=[];return e.save(),(0,l.forEachWithStopTokenCheck)(i,n,(r=>{const{reducedFeatures:n}=g(e,{...t,features:d[r.name]||[],height:u,colorCallback:()=>r.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,u),e.lineTo(p,u),e.stroke(),e.translate(0,u),h=h.concat(n)})),e.restore(),{reducedFeatures:h}}}const ie=(0,i.ConfigurationSchema)("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:h,explicitlyTyped:!0}),oe=(0,i.ConfigurationSchema)("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[],description:"array of subadapter JSON objects"},bigWigs:{type:"frozen",description:"array of bigwig filenames, alternative to the subadapters slot",defaultValue:[]}},{explicitlyTyped:!0});var se=r(58921);class le extends u{async draw(e,t){const{stopToken:n,sources:a,features:i}=t,o=(0,l.groupBy)(i.values(),(e=>e.get("source"))),{drawXY:s}=await r.e(5524).then(r.bind(r,15524));let c=[];return(0,l.forEachWithStopTokenCheck)(a,n,(r=>{const n=o[r.name]||[],{reducedFeatures:a}=s(e,{...t,features:n,offset:C.YSCALEBAR_LABEL_OFFSET,colorCallback:()=>r.color||"blue"});c=c.concat(a)})),{reducedFeatures:c}}}const ce=(0,i.ConfigurationSchema)("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:h,explicitlyTyped:!0});var de=r(3496),ue=r(14129);class pe extends ue.A{name="MultiWiggleGetSources";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{regions:a,adapterConfig:i,sessionId:o}=n,{dataAdapter:s}=await(0,de.cK)(r,o,i);return s.getSources(a,n)}}class ge extends ue.A{name="WiggleGetMultiRegionQuantitativeStats";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{regions:a,adapterConfig:i,sessionId:o}=n,{dataAdapter:s}=await(0,de.cK)(r,o,i);return s.getMultiRegionQuantitativeStats(a,n)}}class he extends ue.A{name="WiggleGetGlobalQuantitativeStats";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:i}=n,{dataAdapter:o}=await(0,de.cK)(r,i,a);return o.getGlobalStats(n)}}var fe=r(44728),me=r(82088);async function ye({pluginManager:e,args:t}){const{sources:r,regions:n,adapterConfig:a,sessionId:i,bpPerPx:o}=t,s=(await(0,de.cK)(e,i,a)).dataAdapter,c=n[0],d=c.end-c.start,u=Math.floor(d/o),p=await(0,fe._)(s.getFeatures(c,t).pipe((0,me.$)())),g=(0,l.groupBy)(p,(e=>e.get("source"))),h={};for(const e of r){const{name:t}=e,r=g[t]||[],n=new Array(u).fill(0);for(const e of r){const t=e.get("start"),r=e.get("end"),a=e.get("score");for(let e=t;e<r;e+=o){const t=Math.floor((e-c.start)/o);t>=0&&t<u&&(n[t]||=a)}}h[t]=n}return h}class be extends ue.A{name="MultiWiggleGetScoreMatrix";async execute(e,t){return ye({args:await this.deserializeArguments(e,t),pluginManager:this.pluginManager})}}var we=r(53996);class ve extends ue.A{name="MultiWiggleClusterScoreMatrix";async execute(e,t){const r=await this.deserializeArguments(e,t),n=await ye({pluginManager:this.pluginManager,args:r});return(0,we.DV)({data:Object.values(n),stopToken:r.stopToken,onProgress:e=>{r.statusCallback?.(e)}})}}class Se extends u{async draw(e,t){const{inverted:n,stopToken:a,features:o,config:s}=t,{drawXY:l}=await r.e(5524).then(r.bind(r,15524)),c=(0,i.readConfObject)(s,"bicolorPivotValue"),d=(0,i.readConfObject)(s,"negColor"),u=(0,i.readConfObject)(s,"posColor");return l(e,{...t,colorCallback:s.color.isCallback?(e,t)=>(0,i.readConfObject)(s,"color",{feature:e}):(e,t)=>t<c?d:u,offset:C.YSCALEBAR_LABEL_OFFSET,features:[...o.values()],inverted:n,stopToken:a})}}const Ce=(0,i.ConfigurationSchema)("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:g.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:.7}},{baseConfiguration:h,explicitlyTyped:!0});class xe extends n.A{name="WigglePlugin";install(e){e.addAdapterType((()=>new a.A({name:"MultiWiggleAdapter",displayName:"Multi-wiggle adapter",configSchema:oe,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(1822).then(r.bind(r,31822)).then((e=>e.default))}))),e.addAdapterType((()=>new a.A({name:"BigWigAdapter",displayName:"BigWig adapter",configSchema:o,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>Promise.all([r.e(7260),r.e(4234)]).then(r.bind(r,14234)).then((e=>e.default))}))),function(e){e.addTrackType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:(0,te.createBaseTrackConfig)(e)})}(e);return new ee.A({name:"QuantitativeTrack",displayName:"Quantitative track",configSchema:t,stateModel:(0,te.createBaseTrackModel)(e,"QuantitativeTrack",t)})}))}(e),function(e){e.addTrackType((()=>{const t=(e=>(0,i.ConfigurationSchema)("MultiQuantitativeTrack",{},{baseConfiguration:(0,te.createBaseTrackConfig)(e)}))(e);return new ee.A({name:"MultiQuantitativeTrack",displayName:"Multi-quantitative track",configSchema:t,stateModel:(0,te.createBaseTrackModel)(e,"MultiQuantitativeTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("XYPlotRenderer").configSchema,r=e.getRendererType("DensityRenderer").configSchema,n=e.getRendererType("LinePlotRenderer").configSchema;return(0,i.ConfigurationSchema)("LinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:g.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:r,XYPlotRenderer:t,LinePlotRenderer:n})},{baseConfiguration:A(),explicitlyTyped:!0})}(e),n=j(e,t);return new k.A({name:"LinearWiggleDisplay",displayName:"Wiggle display",configSchema:t,stateModel:n,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,s.lazy)((()=>Promise.resolve().then(r.bind(r,98911))))})}))}(e),function(e){e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("MultiXYPlotRenderer").configSchema,r=e.getRendererType("MultiDensityRenderer").configSchema,n=e.getRendererType("MultiRowXYPlotRenderer").configSchema,a=e.getRendererType("MultiLineRenderer").configSchema,o=e.getRendererType("MultiRowLineRenderer").configSchema;return(0,i.ConfigurationSchema)("MultiLinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:g.types.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:(0,i.ConfigurationSchema)("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:r,MultiRowXYPlotRenderer:n,MultiLineRenderer:a,MultiRowLineRenderer:o}),height:{type:"number",defaultValue:200}},{baseConfiguration:A(),explicitlyTyped:!0})}(e);return new k.A({name:"MultiLinearWiggleDisplay",displayName:"Multi-wiggle display",configSchema:t,stateModel:Z(0,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,s.lazy)((()=>r.e(8526).then(r.bind(r,8526))))})}))}(e),function(e){e.addRendererType((()=>new x({name:"LinePlotRenderer",ReactComponent:w,configSchema:S,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new Se({name:"XYPlotRenderer",ReactComponent:w,configSchema:Ce,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new p({name:"DensityRenderer",ReactComponent:w,configSchema:f,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new le({name:"MultiXYPlotRenderer",ReactComponent:H,configSchema:ce,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new ae({name:"MultiRowXYPlotRenderer",ReactComponent:H,configSchema:ie,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new G({name:"MultiDensityRenderer",ReactComponent:H,configSchema:O,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new W({name:"MultiLineRenderer",ReactComponent:H,configSchema:$,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new re({name:"MultiRowLineRenderer",ReactComponent:H,configSchema:ne,pluginManager:e})))}(e),function(e){e.addAddTrackWorkflowType((()=>new se.AddTrackWorkflowType({name:"Multi-wiggle track",ReactComponent:(0,s.lazy)((()=>r.e(2018).then(r.bind(r,52018)))),stateModel:g.types.model({})})))}(e),function(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",((e,t)=>{const{session:r}=t;return[...e,...(0,l.isSessionWithAddTracks)(r)?[{label:"Create multi-wiggle track",onClick:e=>{const t=e.selection;(0,l.getSession)(e).queueDialog((r=>[c,{tracks:t,onClose:(t,n)=>{t&&n&&function({model:e,arg:t}){const r=e.selection,n=r.map((e=>(0,i.readConfObject)(e,"name"))),a=r.map((e=>(0,i.readConfObject)(e,"adapter"))).map(((e,t)=>({...e,source:n[t]}))),o=`multitrack-${+Date.now()}-sessionTrack`,s=(0,l.getSession)(e);(0,l.isSessionWithAddTracks)(s)&&(s.addTrackConf({type:"MultiQuantitativeTrack",trackId:o,name:t.name,assemblyNames:[...new Set(r.flatMap((e=>(0,i.readConfObject)(e,"assemblyNames"))))],adapter:{type:"MultiWiggleAdapter",subadapters:a}}),e.view.showTrack(o))}({model:e,arg:n}),r()}}]))}}]:[]]}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,v.getFileName)(t);return(0,l.testAdapter)(a,/\.(bw|bigwig)$/i,n,"BigWigAdapter")?{type:"BigWigAdapter",bigWigLocation:t}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BigWigAdapter"===t?"QuantitativeTrack":e(t)))}(e),e.addRpcMethod((()=>new he(e))),e.addRpcMethod((()=>new ge(e))),e.addRpcMethod((()=>new pe(e))),e.addRpcMethod((()=>new be(e))),e.addRpcMethod((()=>new ve(e)))}exports={LinearWiggleDisplayReactComponent:z.default,XYPlotRendererReactComponent:w,XYPlotRenderer:Se,WiggleBaseRenderer:u,linearWiggleDisplayModelFactory:j,xyPlotRendererConfigSchema:Ce,utils:C}}},12678:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});class n{install(e){}configure(e){}}},14129:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(2406),a=r(99546),i=r(93100);class o extends n.A{async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new i.A({filters:e.filters}):void 0}}async serializeArguments(e,t){const r=this.pluginManager,n=r.rootModel?.session?.assemblyManager;if(!n)throw new Error("no assembly manager");const i=await(0,a.renameRegionsIfNeeded)(n,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(i,t)}}},14862:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(93062),a=r(68446),i=r(92516),o=r(69500);const s=(0,a.observer)((function({location:e,label:t,style:r,setLocation:a}){return(0,o.jsx)(n.A,{variant:"outlined",fullWidth:!0,defaultValue:e&&(0,i.C1)(e)?e.uri:"",label:t||"Enter URL",style:r,onChange:e=>{a({uri:e.target.value.trim(),locationType:"UriLocation"})},slotProps:{htmlInput:{"data-testid":"urlInput"}}})}))},18010:(e,t,r)=>{"use strict";r.d(t,{Nw:()=>i,T9:()=>o,bV:()=>s,pv:()=>l});var n=r(13862),a=r(70777);let i,o,s;function l(e,t){e.serializedCommands?new n.CanvasSequence(e.serializedCommands).execute(t):t.drawImage(e,0,0)}const c="function"==typeof OffscreenCanvas,d=r.n(a)();c?(i=(e,t)=>new OffscreenCanvas(e,t),o=window.createImageBitmap||self.createImageBitmap,s=window.ImageBitmap||self.ImageBitmap):d?(i=(...e)=>nodeCreateCanvas(...e),o=async e=>{const t=e.toDataURL(),r=new nodeImage;return new Promise(((e,n)=>{r.onload=()=>{e(r)},r.onerror=n,r.src=t}))}):(i=(e,t)=>{const r=new n.CanvasSequence;return{width:e,height:t,getContext:()=>r}},o=async e=>{const t=e.getContext("2d");return{height:e.height,width:e.width,serializedCommands:t.toJSON(),containsNoTransferables:!0}},s=String)},20166:(e,t,r)=>{"use strict";r.d(t,{Kp:()=>d,R1:()=>c,Yo:()=>s,pB:()=>o,zm:()=>l});var n=r(89592),a=r(3862);class i extends Error{}function o(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw l()}}async function s(e){await new Promise((e=>setTimeout(e,1))),o(e)}function l(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");const e=new i("aborted");return e.code="ERR_ABORTED",e}function c(e){return e?(0,a.R)(e,"abort"):new n.c}function d(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!/\b(aborted|aborterror)\b/i.test(e.message))}},20195:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(99546),a=r(51414),i=r(68446),o=r(75785),s=r(67112),l=r(9236),c=r(10424),d=r.n(c),u=r(69500);function p({source:e}){return(0,u.jsxs)(l.A,{children:[e.color?(0,u.jsx)("div",{style:{width:10,height:10,backgroundColor:e.color}}):null,(0,u.jsx)(s.SanitizedHTML,{html:Object.entries(e).filter((([e,t])=>"color"!==e&&"HP"!==e&&"name"!==e&&"id"!==e&&void 0!==t)).map((([e,t])=>`${e}:${d()(`${t}`)}`)).join("<br/>")})]})}const g=(0,o.n9)()({rel:{position:"relative"},cursor:{pointerEvents:"none",zIndex:800,position:"absolute"},color:{width:10,height:10}}),h=(0,i.observer)((function({mouseX:e,mouseY:t,model:r}){const{classes:i}=g(),o=(0,a.A)(),{hoveredGenotype:s,height:l,scrollTop:c,sourceMap:d}=r,{width:h}=(0,n.getContainingView)(r),f=s?d?.[s.name]:void 0,m=t-c;return(0,u.jsxs)("div",{className:i.rel,children:[(0,u.jsxs)("svg",{className:i.cursor,width:h,height:l,style:{top:c},children:[(0,u.jsx)("line",{x1:0,x2:h,y1:m,y2:m,stroke:o.palette.text.primary}),(0,u.jsx)("line",{x1:e,x2:e,y1:0,y2:l,stroke:o.palette.text.primary})]}),f?(0,u.jsx)(p,{source:{...f,...s}}):null]})}))},21311:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(75785),a=r(69500);const i=(0,n.n9)()((e=>({bg:{padding:4,margin:4,overflow:"auto",maxHeight:200,background:"dark"===e.palette.mode?"#833":"#f88",border:`1px solid ${e.palette.divider}`}})));function o({children:e}){const{classes:t}=i();return(0,a.jsx)("div",{className:t.bg,children:e})}},21479:(e,t,r)=>{"use strict";r.d(t,{OX:()=>s,W7:()=>o,bf:()=>l});var n=r(99546),a=r(91468),i=r(36422);function o(e){return Math.floor(e/1e6)>0?`${Number.parseFloat((e/1e6).toPrecision(3))} Mb`:Math.floor(e/1e3)>0?`${Number.parseFloat((e/1e3).toPrecision(3))} Kb`:`${Math.floor(e)} bytes`}function s(e,t){const r="undefined"==typeof jest;return["clip",r?e:"jest",t,r?Math.random():""].filter((e=>!!e)).join("-")}async function l(e){const t=(0,n.getContainingView)(e).staticBlocks.contentBlocks,{rpcManager:r}=(0,n.getSession)(e),{adapterConfig:o}=e;if(!o)return{};const s=(0,a.getRpcSessionId)(e);return r.call(s,"CoreGetFeatureDensityStats",{sessionId:s,regions:t,adapterConfig:o,statusCallback:t=>{(0,i.isAlive)(e)&&e.setMessage(t)}})}},23550:(e,t,r)=>{"use strict";r.r(t),r.d(t,{getDefaultValue:()=>s,getEnumerationValues:()=>l,getPropertyType:()=>o,getSubType:()=>a,getUnionSubTypes:()=>i,resolveLateType:()=>c});var n=r(36422);function a(e){let t;if((0,n.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,n.isArrayType)(e)&&!(0,n.isMapType)(e)){if("function"==typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function i(e){if(!(0,n.isUnionType)(e))throw new TypeError("not an MST union type");const t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function o(e,t){return e.properties[t]}function s(e){if(!(0,n.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function l(e){return i(e).map((e=>e.value))}function c(e){return(0,n.isUnionType)(e)||(0,n.isArrayType)(e)||!(0,n.isLateType)(e)?e:e.getSubType()}},25889:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(68446),a=r(69500);const i=(0,n.observer)((function({html:e,RenderingComponent:t,...r}){return(0,a.jsx)(t,{...r})}))},26257:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(99546);function a(e,t="",r=5e3){const a=[e];for(;a.length;){const e=a.pop();for(const[i,o]of Object.entries(e)){if(t.length>r)return(0,n.hashCode)(t);"object"==typeof o&&null!==o?a.push(o):t+=`${i}-${o}`}}return`adp-${(0,n.hashCode)(t)}`}},26612:(e,t,r)=>{"use strict";r.d(t,{m:()=>a});var n=r(99546);function a(e,t,r){return(0,n.sum)(e.map((e=>e.displays[0].height+(["none","left"].includes(r)?0:t))))}},27087:(e,t,r)=>{"use strict";r.d(t,{aF:()=>Ie,N5:()=>de,Ay:()=>Ke,ww:()=>W});var n=r(12678),a=r(7552),i=r(67736),o=r(68584);const s=(0,o.ConfigurationSchema)("AlignmentsFeatureWidget",{});var l=r(9342),c=r(36422);function d(e){return c.types.compose((0,l.n)(e),c.types.model("AlignmentsFeatureWidget",{type:c.types.literal("AlignmentsFeatureWidget")}))}function u(e){e.addWidgetType((()=>new i.A({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:s,stateModel:d(e),ReactComponent:(0,a.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6386),r.e(1475),r.e(4144),r.e(5132)]).then(r.bind(r,55132))))})))}var p=r(58273),g=r(1622),h=r(58921);function f(e){e.addTrackType((()=>{const t=(r=e,(0,o.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:(0,h.createBaseTrackConfig)(r)}));var r;const n=new p.A({name:"AlignmentsTrack",displayName:"Alignments track",configSchema:t,stateModel:(0,g.createBaseTrackModel)(e,"AlignmentsTrack",t)}),a=e.getDisplayType("LinearAlignmentsDisplay");return n.addDisplayType(a),n}))}var m=r(47369);const y=(0,o.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,o.ConfigurationSchema)("BamIndex",{indexType:{model:c.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",description:"size to fetch in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:5e6},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bamLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.bai`,baseUri:e.baseUri}}}:e});function b(e){e.addAdapterType((()=>new m.A({name:"BamAdapter",displayName:"BAM adapter",configSchema:y,getAdapterClass:()=>Promise.all([r.e(1794),r.e(4770)]).then(r.bind(r,94770)).then((e=>e.default))})))}const w=(0,o.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",description:"size in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:{type:"frozen",description:"sequence data adapter",defaultValue:null}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,cramLocation:{uri:e.uri,baseUri:e.baseUri},craiLocation:{uri:`${e.uri}.crai`,baseUri:e.baseUri}}:e});function v(e){e.addAdapterType((()=>new m.A({name:"CramAdapter",displayName:"CRAM adapter",configSchema:w,getAdapterClass:()=>Promise.all([r.e(4808),r.e(6391)]).then(r.bind(r,78369)).then((e=>e.default))})))}var S=r(99546),C=r(91468);function x(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,C.getFileName)(t),i=r&&(0,C.getFileName)(r);return(0,S.testAdapter)(a,/\.bam$/i,n,"BamAdapter")?{type:"BamAdapter",bamLocation:t,index:{location:r||(0,C.makeIndex)(t,".bai"),indexType:(0,C.makeIndexType)(i,"CSI","BAI")}}:(0,S.testAdapter)(a,/\.cram$/i,n,"CramAdapter")?{type:"CramAdapter",cramLocation:t,craiLocation:r||(0,C.makeIndex)(t,".crai")}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t)))}const k=(0,o.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",description:"the base URL to fetch from",defaultValue:""},htsgetTrackId:{type:"string",description:"the trackId, which is appended to the base URL",defaultValue:""},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0});function T(e){e.addAdapterType((()=>new m.A({name:"HtsgetBamAdapter",displayName:"Htsget BAM adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:k,getAdapterClass:()=>Promise.all([r.e(1794),r.e(6823)]).then(r.bind(r,6823)).then((e=>e.default))})))}var A=r(56328),M=r(67112),P=r(68446),R=r(75785),L=r(69500);const I=(0,R.n9)()({resizeHandle:{height:5,position:"absolute",zIndex:2}}),F=(0,P.observer)((function({model:e}){const{PileupDisplay:t,SNPCoverageDisplay:r}=e,{classes:n}=I();if(!r)return null;const a=r.height??100;return(0,L.jsxs)("div",{"data-testid":`display-${(0,o.getConf)(e,"displayId")}`,style:{position:"relative"},children:[(0,L.jsx)("div",{"data-testid":"Blockset-snpcoverage",children:(0,L.jsx)(r.RenderingComponent,{model:r})}),(0,L.jsx)(M.ResizeHandle,{onDrag:e=>(r.setHeight(r.height+e),e),className:n.resizeHandle,style:{top:a-4}}),(0,L.jsx)("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:a},children:(0,L.jsx)(t.RenderingComponent,{model:t})})]})})),N=F;var D=r(97486),B=r(41365),V=r.n(B),j=r(42489);function E(e){return e.getDisplayElements().filter((e=>"LinearAlignmentsDisplay"===e.subDisplay?.type)).filter((e=>e.subDisplay?.lowerPanel))}function z(e){const{PileupDisplay:t,SNPCoverageDisplay:r}=e;return t||(0,c.isAlive)(t)||r||(0,c.isAlive)(r)}const O=function(e,t){return c.types.compose("LinearAlignmentsDisplay",g.BaseDisplay,function(e,t){return c.types.model({PileupDisplay:c.types.maybe(c.types.union(...E(e).map((e=>e.stateModel)))),SNPCoverageDisplay:c.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:c.types.literal("LinearAlignmentsDisplay"),configuration:(0,o.ConfigurationReference)(t),heightPreConfig:c.types.maybe(c.types.number),userFeatureScreenDensity:c.types.maybe(c.types.number),lowerPanelType:"LinearPileupDisplay"})}(e,t)).volatile((()=>({scrollTop:0}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setSNPCoverageHeight(t){e.snpCovHeight=t}}))).views((e=>({get height(){return e.heightPreConfig??(0,o.getConf)(e,"height")},get featureIdUnderMouse(){return e.PileupDisplay.featureIdUnderMouse||e.SNPCoverageDisplay.featureIdUnderMouse}}))).views((e=>({get pileupConf(){return{...(0,o.getConf)(e,"pileupDisplay"),type:e.lowerPanelType,displayId:`${e.configuration.displayId}_${e.lowerPanelType}_xyz`}},getFeatureByID:(t,r)=>e.PileupDisplay.getFeatureByID(t,r),searchFeatureByID:t=>e.PileupDisplay.searchFeatureByID?.(t),get features(){return e.PileupDisplay.features},get DisplayBlurb(){return e.PileupDisplay?.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get coverageConf(){return{...(0,o.getConf)(e,"snpCoverageDisplay"),displayId:`${e.configuration.displayId}_snpcoverage_xyz`}}}))).actions((e=>({setSNPCoverageDisplay(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setFeatureDensityStatsLimit(t){e.PileupDisplay.setFeatureDensityStatsLimit(t),e.SNPCoverageDisplay.setFeatureDensityStatsLimit(t)},setPileupDisplay(t){e.PileupDisplay={type:t.type||"LinearPileupDisplay",configuration:t}},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.heightPreConfig),setFilterBy(t){e.PileupDisplay.setFilterBy(t),e.SNPCoverageDisplay.setFilterBy(t)},setLowerPanelType(t){e.lowerPanelType=t},resizeHeight(t){const r=e.height;return this.setHeight(e.height+t)-r}}))).actions((e=>({afterAttach(){(0,c.addDisposer)(e,(0,j.autorun)((()=>{const{SNPCoverageDisplay:t,PileupDisplay:r,coverageConf:n,pileupConf:a}=e;t?V()(n,(0,c.getSnapshot)(t.configuration))||(t.setHeight(e.snpCovHeight),t.setConfig(e.coverageConf)):e.setSNPCoverageDisplay(n),r&&e.lowerPanelType===r.type?V()(a,(0,c.getSnapshot)(r.configuration))||r.setConfig(e.pileupConf):e.setPileupDisplay(a),function(e){const{PileupDisplay:t,SNPCoverageDisplay:r}=e;z(e)&&t.colorBy&&(V()(t.colorBy,r.colorBy)||r.setColorScheme({...t.colorBy}))}(e),function(e){const{PileupDisplay:t,SNPCoverageDisplay:r}=e;z(e)&&t.filterBy&&(V()(t.filterBy,r.filterBy)||r.setFilterBy({...t.filterBy}))}(e)}))),(0,c.addDisposer)(e,(0,j.autorun)((()=>{e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)}))),(0,c.addDisposer)(e,(0,j.autorun)((()=>{e.PileupDisplay.setHeight(e.height-e.SNPCoverageDisplay.height)})))},async renderSvg(t){const r=e.height-e.SNPCoverageDisplay.height;return await(0,j.when)((()=>!e.PileupDisplay.renderProps().notReady&&!e.SNPCoverageDisplay.renderProps().notReady)),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("g",{children:await e.SNPCoverageDisplay.renderSvg(t)}),(0,L.jsx)("g",{transform:`translate(0 ${e.SNPCoverageDisplay.height})`,children:await e.PileupDisplay.renderSvg({...t,overrideHeight:r})})]})}}))).views((t=>{const{trackMenuItems:r}=t;return{trackMenuItems(){if(!t.PileupDisplay)return[];const n=E(e).map((e=>({type:"radio",label:e.displayName,checked:e.name===t.PileupDisplay.type,onClick:()=>{t.setLowerPanelType(e.name)}})));return[...r(),{type:"subMenu",label:"Pileup settings",subMenu:t.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:t.SNPCoverageDisplay.trackMenuItems()},{type:"subMenu",label:"Replace lower panel with...",subMenu:n}]}}})).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...r}=e;return{heightPreConfig:t,...r}}))};function H(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:e.getDisplayType("LinearPileupDisplay").configSchema,snpCoverageDisplay:e.getDisplayType("LinearSNPCoverageDisplay").configSchema,height:{type:"number",defaultValue:250}},{baseConfiguration:D.Ki,explicitlyTyped:!0})}(e);return new A.A({name:"LinearAlignmentsDisplay",displayName:"Alignments display (combination)",configSchema:t,stateModel:O(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:N})}))}var G=r(91476);const W=function(e){return(0,o.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:c.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:e.getRendererType("PileupRenderer").configSchema}),maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:G.JD}},{baseConfiguration:(0,D.lw)(e),explicitlyTyped:!0})};var $=r(23063),U=r(84038),q=r(20482),_=r(15480),J=r(93100),X=r(90542),Y=r(98670),K=r(28129),Q=r(31409),Z=r.n(Q),ee=r(86576),te=r(61282);const re=(0,P.observer)((function({model:e}){const{sortedBy:t}=e;return t?(0,L.jsx)("div",{"data-testid":`blurb-${t}`,children:(0,L.jsx)(te.A,{color:"secondary",variant:"caption",children:`Sorted by ${t.tag??t.type} at ${t.refName}:${t.pos}`})}):null})),ne=re;var ae=r(80256);const ie=(0,a.lazy)((()=>r.e(130).then(r.bind(r,40130)))),oe=(0,a.lazy)((()=>r.e(8424).then(r.bind(r,8424)))),se=(0,a.lazy)((()=>r.e(5369).then(r.bind(r,55369)))),le=(0,a.lazy)((()=>r.e(9589).then(r.bind(r,49589)))),ce=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]);function de(e){return c.types.compose(D.Lr,c.types.model({configuration:(0,o.ConfigurationReference)(e),featureHeight:c.types.maybe(c.types.number),noSpacing:c.types.maybe(c.types.boolean),fadeLikelihood:c.types.maybe(c.types.boolean),trackMaxHeight:c.types.maybe(c.types.number),colorBySetting:c.types.frozen(),filterBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[]),hideSmallIndelsSetting:c.types.maybe(c.types.boolean)})).volatile((()=>({colorTagMap:j.observable.map({}),featureUnderMouseVolatile:void 0,tagsReady:!1}))).views((e=>({get colorBy(){return e.colorBySetting??(0,o.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,o.getConf)(e,"filterBy")}}))).views((e=>({get autorunReady(){return(0,S.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge},get hideSmallIndels(){return e.hideSmallIndelsSetting}}))).actions((e=>({setTagsReady(t){e.tagsReady=t},setMaxHeight(t){e.trackMaxHeight=t},setFeatureHeight(t){e.featureHeight=t},setNoSpacing(t){e.noSpacing=t},setColorScheme(t){e.colorTagMap=j.observable.map({}),e.colorBySetting={...t},t.tag&&(e.tagsReady=!1)},updateColorTagMap(t){const r=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];for(const n of t)if(!e.colorTagMap.has(n)){const t=[...e.colorTagMap.keys()].length;e.colorTagMap.set(n,r[t])}},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},selectFeature(t){const r=(0,S.getSession)(e);if((0,S.isSessionModelWithWidgets)(r)){const n=r.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,S.getContainingView)(e),track:(0,S.getContainingTrack)(e)});r.showWidget(n)}r.setSelection(t)},copyFeatureToClipboard(t){const{uniqueId:r,...n}=t.toJSON(),a=(0,S.getSession)(e);Z()(JSON.stringify(n,null,4)),a.notify("Copied to clipboard","success")},setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)},setHideSmallIndels(t){e.hideSmallIndelsSetting=t}}))).views((e=>({get rendererConfig(){const{featureHeight:t,noSpacing:r,hideSmallIndels:n,trackMaxHeight:a,rendererTypeName:i}=e,s=(0,o.getConf)(e,["renderers",i])||{};return e.rendererType.configSchema.create({...s,...void 0!==n?{hideSmallIndels:n}:{},...void 0!==t?{height:t}:{},...void 0!==r?{noSpacing:r}:{},...void 0!==a?{maxHeight:a}:{}},(0,S.getEnv)(e))}}))).views((e=>({get maxHeight(){return(0,o.readConfObject)(e.rendererConfig,"maxHeight")},get featureHeightSetting(){return(0,o.readConfObject)(e.rendererConfig,"height")},get featureUnderMouse(){return e.featureUnderMouseVolatile},renderReady:()=>e.tagsReady,get filters(){return new J.A({filters:e.jexlFilters})}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{get rendererTypeName(){const t=(0,o.getConf)(e,"defaultRendering"),r=ce.get(t);if(!r)throw new Error(`unknown alignments view name ${t}`);return r},contextMenuItems(){const t=e.contextMenuFeature;return t?[{label:"Open feature details",icon:K.A,onClick:()=>{e.clearFeatureSelection(),e.selectFeature(t).catch((t=>{(0,S.getSession)(e).notifyError(`${t}`,t)}))}},{label:"Copy info to clipboard",icon:X.PM,onClick:()=>{e.copyFeatureToClipboard(t)}}]:[]},get DisplayBlurb(){return ne},renderPropsPre(){const{colorTagMap:t,colorBy:n,filterBy:a,rpcDriverName:i}=e,o=r();return{...o,notReady:o.notReady||!e.renderReady(),rpcDriverName:i,displayModel:e,colorBy:n,filterBy:a,filters:e.filters,colorTagMap:Object.fromEntries(t.toJSON()),config:e.rendererConfig,async onFeatureClick(t,r){const n=(0,S.getSession)(e),{rpcManager:a}=n;try{const t=r||e.featureIdUnderMouse;if(t){const r=(0,C.getRpcSessionId)(e),{feature:n}=await a.call(r,"CoreGetFeatureDetails",{featureId:t,sessionId:r,layoutId:(0,S.getContainingTrack)(e).id,rendererType:"PileupRenderer"});(0,c.isAlive)(e)&&n&&await e.selectFeature(new S.SimpleFeature(n))}else e.clearFeatureSelection()}catch(e){console.error(e),n.notifyError(`${e}`,e)}},onClick(){e.clearFeatureSelection()},async onFeatureContextMenu(t,r){const n=(0,S.getSession)(e),{rpcManager:a}=n;try{const t=r||e.featureIdUnderMouse;if(t){const r=(0,C.getRpcSessionId)(e),{feature:n}=await a.call(r,"CoreGetFeatureDetails",{featureId:t,sessionId:r,layoutId:(0,S.getContainingTrack)(e).id,rendererType:"PileupRenderer"});n&&e.setContextMenuFeature(new S.SimpleFeature(n))}else e.clearFeatureSelection()}catch(e){console.error(e),n.notifyError(`${e}`,e)}}}},colorSchemeSubMenuItems:()=>[{label:"Normal",onClick:()=>{e.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:()=>{e.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:()=>{e.setColorScheme({type:"strand"})}},{label:"Per-base quality",onClick:()=>{e.setColorScheme({type:"perBaseQuality"})}},{label:"Per-base lettering",onClick:()=>{e.setColorScheme({type:"perBaseLettering"})}},{label:"First-of-pair strand",onClick:()=>{e.setColorScheme({type:"stranded"})}},{label:"Color by tag...",onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[oe,{model:e,handleClose:t}]))}}],trackMenuItems:()=>[...t(),{label:"Set feature height...",priority:1,subMenu:[{label:"Normal",onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",onClick:()=>{e.setFeatureHeight(2),e.setNoSpacing(!0)}},{label:"Manually set height",onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[se,{model:e,handleClose:t}]))}}]},{label:"Hide small indels (<10bp)",priority:-1,type:"checkbox",checked:e.hideSmallIndels,onClick:()=>{e.setHideSmallIndels(!e.hideSmallIndels)}},{label:"Set max height...",priority:-1,onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[le,{model:e,handleClose:t}]))}},{label:"Filter by...",icon:Y.A,onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[ie,{model:e,handleClose:t}]))}}]}})).views((e=>({renderProps:()=>e.renderPropsPre()}))).actions((e=>({afterAttach(){(0,ee.vi)(e,(async()=>{const t=(0,S.getContainingView)(e);if(!e.autorunReady)return;const{colorBy:r,tagsReady:n}=e,{staticBlocks:a}=t;if(r?.tag&&!n){const t=await(0,ae.X)({self:e,tag:r.tag,blocks:a});(0,c.isAlive)(e)&&(e.updateColorTagMap(t),e.setTagsReady(!0))}else e.setTagsReady(!0)}),{delay:1e3}),(0,c.addDisposer)(e,(0,j.autorun)((async()=>{const t=(0,S.getSession)(e);try{const r=e.featureIdUnderMouse;if(e.featureUnderMouse?.id()!==r)if(r){const n=(0,C.getRpcSessionId)(e),{feature:a}=await t.rpcManager.call(n,"CoreGetFeatureDetails",{featureId:r,sessionId:n,layoutId:(0,S.getContainingTrack)(e).id,rendererType:"PileupRenderer"});(0,c.isAlive)(e)&&a&&e.featureIdUnderMouse===a.uniqueId&&e.setFeatureUnderMouse(new S.SimpleFeature(a))}else e.setFeatureUnderMouse(void 0)}catch(e){console.error(e),t.notifyError(`${e}`,e)}})))}}))).preProcessSnapshot((e=>{if(e){const{colorBy:t,colorBySetting:r,filterBySetting:n,filterBy:a,...i}=e;return{...i,filterBySetting:n||a,colorBySetting:r||t}}return e}))}const ue=(0,a.lazy)((()=>r.e(2697).then(r.bind(r,32697)))),pe=(0,a.lazy)((()=>r.e(4806).then(r.bind(r,74806)))),ge=function(e){return c.types.compose("LinearPileupDisplay",de(e),c.types.model({type:c.types.literal("LinearPileupDisplay"),configuration:(0,o.ConfigurationReference)(e),showSoftClipping:!1,mismatchAlpha:c.types.maybe(c.types.boolean),sortedBy:c.types.frozen()})).volatile((()=>({sortReady:!1,currSortBpPerPx:0,visibleModifications:j.observable.map({}),modificationsReady:!1}))).actions((e=>({setCurrSortBpPerPx(t){e.currSortBpPerPx=t},updateVisibleModifications(t){for(const r of t)e.visibleModifications.has(r.type)||e.visibleModifications.set(r.type,{...r,color:(0,ee.rT)(r.type)})},setModificationsReady(t){e.modificationsReady=t},setSortReady(t){e.sortReady=t},clearSelected(){e.sortedBy=void 0},toggleSoftClipping(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha(){e.mismatchAlpha=!e.mismatchAlpha},setSortedBy(t,r){const{centerLineInfo:n}=(0,S.getContainingView)(e);if(!n)return;const{refName:a,assemblyName:i,offset:o}=n,s=Math.round(o)+1;s<0||!a||(e.sortReady=!1,e.sortedBy={type:t,pos:s,refName:a,assemblyName:i,tag:r})},setFeatureHeight(t){e.sortReady=!1,e.featureHeight=t}}))).actions((e=>{const t=e.reload;return{reload(){e.clearSelected(),t()}}})).views((e=>({get visibleModificationTypes(){return[...e.visibleModifications.keys()]},get rendererConfig(){const{featureHeight:t,noSpacing:r,trackMaxHeight:n,mismatchAlpha:a,rendererTypeName:i,hideSmallIndels:s}=e,l=(0,o.getConf)(e,["renderers",i])||{};return e.rendererType.configSchema.create({...l,...void 0!==t?{height:t}:{},...void 0!==s?{hideSmallIndels:s}:{},...void 0!==r?{noSpacing:r}:{},...void 0!==a?{mismatchAlpha:a}:{},...void 0!==n?{maxHeight:n}:{}},(0,S.getEnv)(e))}}))).views((e=>{const{renderReady:t}=e;return{get mismatchAlphaSetting(){return(0,o.readConfObject)(e.rendererConfig,"mismatchAlpha")},renderReady(){const r=(0,S.getContainingView)(e);return e.modificationsReady&&e.currSortBpPerPx===r.bpPerPx&&t()}}})).views((e=>{const{trackMenuItems:t,renderPropsPre:r,renderProps:n,colorSchemeSubMenuItems:a}=e;return{renderPropsPre(){const{sortedBy:t,showSoftClipping:n,visibleModifications:a}=e;return{...r(),showSoftClip:n,sortedBy:t,visibleModifications:Object.fromEntries(a.toJSON())}},renderProps(){const{sortReady:t}=e,r=n();return{...r,notReady:r.notReady||!t}},trackMenuItems:()=>[...t(),{label:"Sort by...",icon:U.A,disabled:e.showSoftClipping,subMenu:[...["Start location","Read strand","Base pair"].map((t=>({label:t,onClick:()=>{e.setSortedBy(t)}}))),{label:"Sort by tag...",onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[ue,{model:e,handleClose:t}]))}},{label:"Clear sort",onClick:()=>{e.clearSelected()}}]},{label:"Color by...",icon:$.A,subMenu:[{label:"Pair orientation",onClick:()=>{e.setColorScheme({type:"pairOrientation"})}},{label:"Modifications",type:"subMenu",subMenu:e.modificationsReady?[{label:"All modifications",onClick:()=>{e.setColorScheme({type:"modifications"})}},...e.visibleModificationTypes.map((t=>({label:`Show only ${ee.Rs[t]?.name||t}`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t}})}}))),{type:"divider"},{label:"All modifications (<50% prob colored blue)",onClick:()=>{e.setColorScheme({type:"modifications",modifications:{twoColor:!0}})}},...e.visibleModificationTypes.map((t=>({label:`Show only ${ee.Rs[t]?.name||t} (<50% prob colored blue)`,onClick:()=>{e.setColorScheme({type:"modifications",modifications:{isolatedModification:t,twoColor:!0}})}}))),{type:"divider"},{label:"All reference CpGs",onClick:()=>{e.setColorScheme({type:"methylation"})}}]:[{label:"Loading modifications...",onClick:()=>{}}]},{label:"Insert size",onClick:()=>{e.setColorScheme({type:"insertSize"})}},...a()]},{label:"Group by...",icon:_.A,onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[pe,{model:e,handleClose:t}]))}},{label:"Show soft clipping",icon:q.A,type:"checkbox",checked:e.showSoftClipping,onClick:()=>{e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:()=>{e.toggleMismatchAlpha()}}]}})).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(7796).then(r.bind(r,85415));t(e)}catch(t){(0,S.getSession)(e).notifyError(`${t}`,t),console.error(t)}})()}})))};function he(e){e.addDisplayType((()=>{const t=W(e);return new A.A({name:"LinearPileupDisplay",displayName:"Pileup display",configSchema:t,stateModel:ge(t),subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:D.GQ})}))}var fe=r(48747);const me=(0,a.lazy)((()=>r.e(130).then(r.bind(r,40130)))),ye=function(e){return c.types.compose("LinearReadArcsDisplay",h.BaseDisplay,(0,D._e)(),(0,D.e6)(),c.types.model({type:c.types.literal("LinearReadArcsDisplay"),configuration:(0,o.ConfigurationReference)(e),lineWidth:c.types.maybe(c.types.number),jitter:c.types.maybe(c.types.number),colorBySetting:c.types.frozen(),filterBySetting:c.types.frozen(),drawInter:!0,drawLongRange:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).views((e=>({get colorBy(){return e.colorBySetting??(0,o.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,o.getConf)(e,"filterBy")}}))).actions((e=>({setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBySetting={...t}},setChainData(t){e.chainData=t},setDrawInter(t){e.drawInter=t},setDrawLongRange(t){e.drawLongRange=t},setFilterBy(t){e.filterBySetting={...t}},setLineWidth(t){e.lineWidth=t},setJitter(t){e.jitter=t}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx},get lineWidthSetting(){return e.lineWidth??(0,o.getConf)(e,"lineWidth")},get jitterVal(){return e.jitter??(0,o.getConf)(e,"jitter")}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Filter by",icon:Y.A,onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[me,{model:e,handleClose:t}]))}},{label:"Line width",subMenu:[{label:"Thin",onClick:()=>{e.setLineWidth(1)}},{label:"Bold",onClick:()=>{e.setLineWidth(2)}},{label:"Extra bold",onClick:()=>{e.setLineWidth(5)}}]},{label:"Jitter x-positions",subMenu:[{type:"checkbox",checked:0===e.jitterVal,label:"None",onClick:()=>{e.setJitter(0)}},{type:"checkbox",checked:2===e.jitterVal,label:"Small",onClick:()=>{e.setJitter(2)}},{type:"checkbox",checked:10===e.jitterVal,label:"Large",onClick:()=>{e.setJitter(10)}}]},{label:"Draw inter-region vertical lines",type:"checkbox",checked:e.drawInter,onClick:()=>{e.setDrawInter(!e.drawInter)}},{label:"Draw long range connections",type:"checkbox",checked:e.drawLongRange,onClick:()=>{e.setDrawLongRange(!e.drawLongRange)}},{label:"Color scheme",icon:fe.A,subMenu:[{label:"Insert size ± 3σ and orientation",onClick:()=>{e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size ± 3σ",onClick:()=>{e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:()=>{e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:()=>{e.setColorScheme({type:"gradient"})}}]}]}})).views((e=>({async renderSvg(t){const{renderSvg:n}=await r.e(9584).then(r.bind(r,59584)),{drawFeats:a}=await r.e(3304).then(r.bind(r,63304));return n(e,t,a)}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(9070).then(r.bind(r,9070)),{drawFeats:n}=await r.e(3304).then(r.bind(r,63304));t(e,n)}catch(t){console.error(t),e.setError(t)}})()}})))};function be(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearReadArcsDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},lineWidth:{type:"number",description:"set arc line width",defaultValue:1},jitter:{type:"number",description:"jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them",defaultValue:0},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}},filterBy:{type:"frozen",defaultValue:G.JD}},{baseConfiguration:(0,D.lw)(e),explicitlyTyped:!0})}(e);return new A.A({name:"LinearReadArcsDisplay",displayName:"Arc display",configSchema:t,stateModel:ye(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,a.lazy)((()=>r.e(2424).then(r.bind(r,52424))))})}))}const we=(0,a.lazy)((()=>r.e(130).then(r.bind(r,40130)))),ve=function(e){return c.types.compose("LinearReadCloudDisplay",h.BaseDisplay,(0,D._e)(),(0,D.e6)(),c.types.model({type:c.types.literal("LinearReadCloudDisplay"),configuration:(0,o.ConfigurationReference)(e),filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen(),drawSingletons:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).views((e=>({get colorBy(){return e.colorBySetting??(0,o.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,o.getConf)(e,"filterBy")}}))).actions((e=>({setDrawSingletons(t){e.drawSingletons=t},setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBySetting={...t}},setChainData(t){e.chainData=t},setFilterBy(t){e.filterBySetting={...t}}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx}}))).views((e=>{const{trackMenuItems:t,renderProps:n}=e;return{renderProps:()=>({...n(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Draw singletons",type:"checkbox",checked:e.drawSingletons,onClick:()=>{e.setDrawSingletons(!e.drawSingletons)}},{label:"Filter by",icon:Y.A,onClick:()=>{(0,S.getSession)(e).queueDialog((t=>[we,{model:e,handleClose:t}]))}},{label:"Color scheme",icon:fe.A,subMenu:[{label:"Insert size ± 3σ and orientation",onClick:()=>{e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size ± 3σ",onClick:()=>{e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:()=>{e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:()=>{e.setColorScheme({type:"gradient"})}}]}],async renderSvg(t){const{renderSvg:n}=await r.e(9584).then(r.bind(r,59584)),{drawFeats:a}=await r.e(6946).then(r.bind(r,26946));return n(e,t,a)}}})).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(9070).then(r.bind(r,9070)),{drawFeats:n}=await r.e(6946).then(r.bind(r,26946));t(e,n)}catch(t){console.error(t),e.setError(t)}})()}})))};function Se(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearReadCloudDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},featureHeight:{type:"number",defaultValue:7},colorBy:{type:"frozen",defaultValue:{type:"insertSizeAndOrientation"}}},{baseConfiguration:(0,D.lw)(e),explicitlyTyped:!0})}(e);return new A.A({name:"LinearReadCloudDisplay",displayName:"Read cloud display",configSchema:t,stateModel:ve(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:(0,a.lazy)((()=>r.e(8408).then(r.bind(r,48408))))})}))}var Ce=r(11210),xe=r(99412);const ke=(0,a.lazy)((()=>r.e(489).then(r.bind(r,80489)))),Te=new Map([["snpcoverage","SNPCoverageRenderer"]]),Ae=function(e,t){return c.types.compose("LinearSNPCoverageDisplay",(0,Ce._i)(e,t),c.types.model({type:c.types.literal("LinearSNPCoverageDisplay"),showInterbaseCounts:c.types.maybe(c.types.boolean),showInterbaseIndicators:c.types.maybe(c.types.boolean),showArcs:c.types.maybe(c.types.boolean),filterBySetting:c.types.frozen(),colorBySetting:c.types.frozen(),jexlFilters:c.types.optional(c.types.array(c.types.string),[])})).volatile((()=>({visibleModifications:j.observable.map({}),modificationsReady:!1}))).views((e=>({get colorBy(){return e.colorBySetting??(0,o.getConf)(e,"colorBy")},get filterBy(){return e.filterBySetting??(0,o.getConf)(e,"filterBy")}}))).actions((e=>({setConfig(t){e.configuration=t},setFilterBy(t){e.filterBySetting={...t}},setColorScheme(t){e.colorBySetting=t?{...t}:void 0},setJexlFilters(t){e.jexlFilters=(0,c.cast)(t)},updateVisibleModifications(t){for(const r of t)e.visibleModifications.has(r.type)||e.visibleModifications.set(r.type,{...r,color:(0,ee.rT)(r.type)})}}))).views((e=>{const{adapterProps:t}=e;return{get rendererConfig(){const t=(0,o.getConf)(e,["renderers",e.rendererTypeName])||{},{showArcs:r,showInterbaseCounts:n,showInterbaseIndicators:a}=e;return e.rendererType.configSchema.create({...t,showInterbaseCounts:n??t.showInterbaseCounts,showInterbaseIndicators:a??t.showInterbaseIndicators,showArcs:r??t.showArcs},(0,c.getEnv)(e))},get showArcsSetting(){return e.showArcs??(0,o.readConfObject)(this.rendererConfig,"showArcs")},get showInterbaseCountsSetting(){return e.showInterbaseCounts??(0,o.readConfObject)(this.rendererConfig,"showInterbaseCounts")},get showInterbaseIndicatorsSetting(){return e.showInterbaseIndicators??(0,o.readConfObject)(this.rendererConfig,"showInterbaseIndicators")},get autorunReady(){return(0,S.getContainingView)(e).initialized&&e.statsReadyAndRegionNotTooLarge&&!e.error},adapterProps(){const r=t(),{filters:n,filterBy:a}=e;return{...r,filters:n,filterBy:a}}}})).actions((e=>({setModificationsReady(t){e.modificationsReady=t},setShowInterbaseIndicators(t){e.showInterbaseIndicators=t},setShowInterbaseCounts(t){e.showInterbaseCounts=t},setShowArcs(t){e.showArcs=t}}))).actions((e=>({afterAttach(){(0,ee.vi)(e,(async()=>{if(e.setModificationsReady(!1),!e.autorunReady)return;const t=(0,S.getContainingView)(e),{staticBlocks:r}=t,{colorBy:n}=e;if("modifications"===n?.type){const t=await(0,xe.D)({model:e,adapterConfig:(0,o.getConf)(e.parentTrack,"adapter"),blocks:r});(0,c.isAlive)(e)&&(e.updateVisibleModifications(t),e.setModificationsReady(!0))}else e.setModificationsReady(!0)}),{delay:1e3})}}))).views((e=>{const{renderProps:t,trackMenuItems:r}=e;return{get renderReady(){return!t().notReady&&e.modificationsReady},get ready(){return this.renderReady},renderProps(){const{colorBy:r,visibleModifications:n}=e;return{...t(),notReady:!this.ready,colorBy:r,visibleModifications:Object.fromEntries(n.toJSON())}},get TooltipComponent(){return ke},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:(0,o.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return Te.get("snpcoverage")},get graphType(){return!0},contextMenuItems:()=>[],trackMenuItems:()=>[...r(),{label:"Show insertion/clipping indicators",icon:q.A,type:"checkbox",checked:e.showInterbaseIndicatorsSetting,onClick:()=>{e.setShowInterbaseIndicators(!e.showInterbaseIndicatorsSetting)}},{label:"Show insertion/clipping counts",icon:q.A,type:"checkbox",checked:e.showInterbaseCountsSetting,onClick:()=>{e.setShowInterbaseCounts(!e.showInterbaseCountsSetting)}},{label:"Show arcs",icon:q.A,type:"checkbox",checked:e.showArcsSetting,onClick:()=>{e.setShowArcs(!e.showArcsSetting)}}],get filters(){return new J.A({filters:e.jexlFilters})}}}))};function Me(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:c.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:c.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:e.getRendererType("SNPCoverageRenderer").configSchema}),colorBy:{type:"frozen",description:"color scheme to use",defaultValue:{type:"normal"}},filterBy:{type:"frozen",description:"default filters to use",defaultValue:G.JD}},{baseConfiguration:D.Ki,explicitlyTyped:!0})}(e);return new A.A({name:"LinearSNPCoverageDisplay",displayName:"SNPCoverage display",configSchema:t,stateModel:Ae(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Ce.r})}))}var Pe=r(3496),Re=r(44728),Le=r(82088),Ie=r(95805),Fe=r(2406);class Ne extends Fe.A{async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r?.session?.assemblyManager;if(!n)throw new Error("no assembly manager available");const a=await(0,S.renameRegionsIfNeeded)(n,e);return super.serializeArguments(a,t)}}class De extends Ne{name="PileupGetReducedFeatures";async execute(e,t){const r=await this.deserializeArguments(e,t),{adapterConfig:n,sessionId:a,regions:i}=r,o=(await(0,Pe.cK)(this.pluginManager,a,n)).dataAdapter,s=await(0,Re._)(o.getFeaturesInMultipleRegions(i,r).pipe((0,Le.$)())),l=(0,S.dedupe)(s.map((e=>({id:e.id(),refName:e.get("refName"),name:e.get("name"),start:e.get("start"),strand:e.get("strand"),end:e.get("end"),flags:e.get("flags"),tlen:e.get("template_length"),pair_orientation:e.get("pair_orientation"),next_ref:e.get("next_ref"),next_pos:e.get("next_pos"),clipPos:(0,Ie.getClip)(e.get("CIGAR"),e.get("strand")),SA:e.get("tags")?.SA}))),(e=>e.id)),c=l.filter((e=>2&e.flags&&!(256&e.flags)&&!(2048&e.flags))),d=c.length?function(e){const t=e.map((e=>Math.abs(e.tlen))),r=t.reduce(((e,t)=>e+t),0),n=t.map((e=>e*e)).reduce(((e,t)=>e+t),0),a=t.length,i=r/a,o=Math.sqrt((a*n-r*r)/(a*a));return{upper:i+4*o,lower:i-3*o,avg:i,sd:o}}(c):void 0,u=(0,S.groupBy)(l,(e=>e.name));return{chains:Object.values(u),stats:d,hasPaired:!!d,containsNoTransferables:!0}}}var Be=r(93092);class Ve extends Ne{name="PileupGetVisibleModifications";async execute(e,t){const r=await this.deserializeArguments(e,t),{adapterConfig:n,sessionId:a,regions:i}=r,o=(await(0,Pe.cK)(this.pluginManager,a,n)).dataAdapter,s=await(0,Re._)(o.getFeaturesInMultipleRegions(i,r).pipe((0,Le.$)())),l=new Map;for(const e of s)for(const t of(0,Be.eV)((0,ee.c$)(e,"MM","Mm")||""))l.has(t.type)||l.set(t.type,t);return[...l.values()]}}class je extends Ne{name="PileupGetGlobalValueForTag";async execute(e,t){const r=await this.deserializeArguments(e,t),{adapterConfig:n,sessionId:a,regions:i,tag:o}=r,s=(await(0,Pe.cK)(this.pluginManager,a,n)).dataAdapter.getFeaturesInMultipleRegions(i,r),l=await(0,Re._)(s.pipe((0,Le.$)()));return[...new Set(l.map((e=>e.get("tags")?.[o])).filter((e=>void 0!==e)).map((e=>`${e}`)))]}}function Ee(e){e.addRpcMethod((()=>new je(e))),e.addRpcMethod((()=>new Ve(e))),e.addRpcMethod((()=>new De(e)))}var ze=r(98111),Oe=r(31415);class He extends Oe.h{constructor(e){super(e),this.props=e}update(e){return super.update(e),this.props=e,this}cachedLayoutIsValid(e){return super.cachedLayoutIsValid(e)&&this.props.showSoftClip===e.props.showSoftClip&&V()(this.props.sortedBy,e.props.sortedBy)&&V()(this.props.filterBy,e.props.filterBy)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),props:this.props}),this.cachedLayout.layout}}class Ge extends ze.default{supportsSVG=!0;async fetchSequence(e,t){const{sessionId:r,adapterConfig:n}=e,{sequenceAdapter:a}=n;if(!a)return;const{dataAdapter:i}=await(0,Pe.cK)(this.pluginManager,r,a);return(0,ee.Iw)({...t,start:Math.max(0,t.start-1),end:t.end+1},i)}getExpandedRegion(e,t){const{config:r,showSoftClip:n}=t,{start:a,end:i}=e,s=(0,o.readConfObject)(r,"maxClippingSize"),l=n?Math.round(s):0;return{...e,start:Math.floor(Math.max(a-l,0)),end:Math.ceil(i+l)}}async render(e){const t=await this.getFeatures(e),n=this.createLayoutInWorker(e),{statusCallback:a=()=>{},colorBy:i,regions:s,bpPerPx:l}=e,c=s[0],d=(c.end-c.start)/l,{layoutRecords:u,height:p}=await(0,S.updateStatus)("Creating layout",a,(()=>function(e){const{layout:t,features:r,sortedBy:n,config:a,bpPerPx:i,showSoftClip:s,regions:l}=e,c=l[0],d=n?.type&&c.start===n.pos?((e,t)=>{const r=Array.from(e.values()),n=[],a=[],{pos:i,type:o}=t;for(const e of r){const t=e,r=t.get("start"),o=t.get("end");(0,S.doesIntersect2)(i-1,i,r,o)?n.push(e):a.push(e)}const s=!!r.length&&r[0].get("tags");switch(o){case"Start location":n.sort(((e,t)=>e.get("start")-t.get("start")));break;case"tag":{const e=t.tag,r=(e,t)=>s?e.get("tags")[t]:e.get(t);n[0]&&"string"==typeof r(n[0],e)?n.sort(((t,n)=>r(n,e).localeCompare(r(t,e)))):n.sort(((t,n)=>(r(n,e)||0)-(r(t,e)||0)));break}case"Base pair":{const e=[];for(const t of n){const r=t.get("mismatches");for(const n of r){const r=t.get("start")+n.start+1,a="insertion"===n.type||"softclip"===n.type?0:n.length;i>=r&&i<r+a&&e.push([t.id(),n])}}const t=new Map(e);n.sort(((e,r)=>{const n=t.get(e.id()),a=t.get(r.id()),i=a?.base.toUpperCase(),o=n?.base.toUpperCase();return i===o&&"*"===i?n.length-a.length:(i?i.charCodeAt(0):0)-(o?o.charCodeAt(0):0)}));break}case"Read strand":n.sort(((e,t)=>e.get("strand")<=t.get("strand")?1:-1))}return new Map([...n,...a].map((e=>[e.id(),e])))})(r,n):r,u=(0,o.readConfObject)(a,"height"),p=(0,o.readConfObject)(a,"displayMode"),g=(0,S.iterMap)(d.values(),(e=>function({feature:e,layout:t,bpPerPx:r,region:n,showSoftClip:a,heightPx:i,displayMode:o}){let s=0,l=0;if(a){const t=e.get("mismatches");if(e.get("seq"))for(const{type:e,start:r,cliplen:n=0}of t)"softclip"===e&&(0===r?s=n:l=n)}const[c,d]=(0,S.bpSpanPx)(e.get("start")-s,e.get("end")+l,n,r);if("compact"===o&&(i/=3),e.get("refName")!==n.refName)throw new Error(`feature ${e.id()} is not on the current region's reference sequence ${n.refName}`);const u=t.addRect(e.id(),e.get("start")-s,e.get("end")+l,i,e);return null===u?null:{feature:e,leftPx:c,rightPx:d,topPx:"collapse"===o?0:u,heightPx:i}}({feature:e,layout:t,bpPerPx:i,region:c,showSoftClip:s,heightPx:u,displayMode:p})),d.size).filter(S.notEmpty);return{layoutRecords:g,height:Math.max(t.getTotalHeight(),1)}}({...e,features:t,layout:n}))),g=await(0,S.updateStatus)("Rendering alignments",a,(async()=>{const a="methylation"===i?.type&&t.size?await this.fetchSequence(e,c):void 0,{makeImageData:o}=await r.e(4060).then(r.bind(r,24060));return(0,S.renderToAbstractCanvas)(d,p,e,(r=>{o({ctx:r,layoutRecords:u,canvasWidth:d,renderArgs:{...e,layout:n,features:t,regionSequence:a}})}))}));return{...await super.render({...e,...g,features:t,layout:n,height:p,width:d}),...g,features:new Map,layout:n,height:p,width:d,maxHeightReached:n.maxHeightReached,containsNoTransferables:!0}}createLayoutSession(e){return new He(e)}}const We=(0,P.observer)((function(e){const{onMouseMove:t,blockKey:r,displayModel:n,width:i,height:o,regions:s,bpPerPx:l,sortedBy:c,colorBy:d,filterBy:u}=e,{selectedFeatureId:p,featureIdUnderMouse:g,contextMenuFeature:h}=n||{},[f,m]=(0,a.useState)(!1);(0,a.useEffect)((()=>{m(!0)}),[]);const y=s[0],b=(0,a.useRef)(null),[w,v]=(0,a.useState)(!1),[C,x]=(0,a.useState)(!1),k=p?n?.getFeatureByID(r,p):void 0,T=g||h?.id(),A=T?n?.getFeatureByID(r,T):void 0;function P(e,t=2){const[r,n,a,i]=e,[o,s]=(0,S.bpSpanPx)(r,a,y,l);return{left:o-t,top:Math.round(n)-t,width:s-o,height:Math.round(i-n)}}const R=k?P(k):void 0,I=A?P(A,0):void 0;function F(t,r){const n=e[`onFeature${t}`],a=e[`on${t}`];n&&g?n(r,g):a&&a(r,g)}const N=Math.ceil(i);return(0,L.jsxs)("div",{ref:b,"data-testid":["pileup-overlay",c?.type,d?.type,d?.tag,u?.tagFilter?.tag].filter((e=>!!e)).join("-"),style:{position:"relative",width:N,height:o},onMouseDown:e=>{!function(e){v(!0),x(!1),F("MouseDown",e)}(e)},onMouseEnter:e=>{!function(e){F("MouseEnter",e)}(e)},onMouseOut:e=>{!function(e){F("MouseOut",e),F("MouseLeave",e)}(e)},onMouseOver:e=>{!function(e){F("MouseOver",e)}(e)},onMouseUp:e=>{!function(e){v(!1),F("MouseUp",e)}(e)},onMouseLeave:e=>{!function(e){F("MouseOut",e),F("MouseLeave",e)}(e)},onMouseMove:e=>{!function(e){if(!b.current)return;w&&x(!0);const a=b.current.getBoundingClientRect(),o=e.clientX-a.left,s=e.clientY-a.top,c=y.reversed?i-o:o,d=y.start+l*c;t?.(e,n?.getFeatureOverlapping(r,d,s))}(e)},onClick:e=>{!function(e){C||F("Click",e)}(e)},onContextMenu:e=>{!function(e){F("ContextMenu",e)}(e)},onFocus:()=>{},onBlur:()=>{},children:[(0,L.jsx)(M.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:0}}),f&&I?(0,L.jsx)("div",{style:{position:"absolute",backgroundColor:"#0003",pointerEvents:"none",...I}}):null,f&&R?(0,L.jsx)("div",{style:{position:"absolute",border:"2px solid #00b8ff",boxSizing:"content-box",pointerEvents:"none",...R}}):null]})})),$e=(0,o.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:c.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orientation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:c.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:1},hideSmallIndels:{type:"boolean",description:"Hides small indels, sometimes occurring in long read sequencing",defaultValue:!1},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function Ue(e){e.addRendererType((()=>new Ge({name:"PileupRenderer",displayName:"Pileup renderer",ReactComponent:We,configSchema:$e,pluginManager:e})))}const qe=(0,o.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0});function _e(e){e.addAdapterType((()=>new m.A({name:"SNPCoverageAdapter",displayName:"SNPCoverage adapter",adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(2947).then(r.bind(r,52947)).then((e=>e.default)),configSchema:qe})))}class Je extends Ce.er{async draw(e,t){const{statusCallback:n=()=>{}}=t,{makeImage:a}=await r.e(7192).then(r.bind(r,37192));await(0,S.updateStatus)("Rendering coverage",n,(()=>a(e,t)))}}const Xe=(0,o.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},showArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},showInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},showInterbaseIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0},color:{type:"color",description:"Background color for the SNPCoverage renderer",defaultValue:"#d3d3d3"}},{explicitlyTyped:!0});function Ye(e){e.addRendererType((()=>new Je({name:"SNPCoverageRenderer",ReactComponent:Ce.Ep,configSchema:Xe,pluginManager:e})))}class Ke extends n.A{name="AlignmentsPlugin";install(e){[b,v,he,Me,f,_e,T,Ue,Ee,Ye,be,Se,H,u,x].map((t=>{t(e)}))}}},27703:(e,t,r)=>{"use strict";r.d(t,{CU:()=>s,Cz:()=>o,H2:()=>i,H4:()=>l,i3:()=>a});var n=r(99546);function a(e,t,r){const n=t*(e=Math.abs(e));let a=10**Number.parseInt(Number(n).toExponential().split(/e/i)[1],10);for(;a<n&&(a*=2,!(a>=n));)a*=2.5;a=Math.max(a,5);const i=a/e;let o=0;return!(a%10)&&i/10>=r?o=a/10:!(a%5)&&i/5>=r?o=a/5:!(a%2)&&i/2>=r&&(o=a/2),{majorPitch:a,minorPitch:o}}function i(e,t,r,n=!0,i=!0){const o=a(r,60,15);let s=e,l=t;r<0&&([s,l]=[l,s]),s-=Math.abs(20*r)-1,l+=Math.abs(20*r)+1;const c=o.minorPitch||o.majorPitch;let d=0;const u=[];for(let e=Math.floor(s/c)*c;e<Math.ceil(l/c)*c+1;e+=c)i&&e%(2*o.majorPitch)?(u.push({type:"minor",base:e-1,index:d}),d+=1):!n||e%(2*o.majorPitch)||(u.push({type:"major",base:e-1,index:d}),d+=1);return u}async function o({regions:e,assemblyManager:t,assemblyName:r,grow:n}){return Promise.all(e.map((async e=>{const a=e.assemblyName||r;if(!a)throw new Error("no assembly provided");const i=await t.waitForAssembly(a),{refName:o}=e;if(!i)throw new Error(`assembly ${a} not found`);const{regions:s}=i;if(!s)throw new Error(`regions not loaded yet for ${a}`);const l=i.getCanonicalRefName(e.refName);if(!l)throw new Error(`Could not find refName ${o} in ${i.name}`);const c=s.find((e=>e.refName===l));if(!c)throw new Error(`Could not find refName ${o} in ${a}`);const{start:d,end:u}=e;if(n&&d&&u){const t=(u-d)*n;return{...e,start:Math.max(0,d-t),end:u+t,assemblyName:a,parentRegion:c}}return{...e,assemblyName:a,parentRegion:c}})))}function s(e,t,r){const a=e.split(/(\s+)/).map((e=>e.trim())).filter((e=>!!e));try{return a.map((e=>(0,n.parseLocString)(e,(e=>r(e,t)))))}catch(e){const[i,o,s]=a;if(/Unknown reference sequence/.exec(`${e}`)&&Number.isInteger(+o)&&Number.isInteger(+s))return[(0,n.parseLocString)(`${i}:${o}..${s}`,(e=>r(e,t)))];throw e}}function l(e){if(e.length){const t=e.every((t=>t.assemblyName===e[0].assemblyName));return e.map((e=>(0,n.assembleLocString)({...e,start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))).join(" ")}return""}},31415:(e,t,r)=>{"use strict";r.d(t,{h:()=>l});var n=r(41365),a=r.n(n),i=r(68584),o=r(85012),s=r(2265);class l{constructor(e){this.props=e}update(e){return this.props=e,this}makeLayout(){return new s.A(o.A,{maxHeight:(0,i.readConfObject)(this.props.config,"maxHeight"),displayMode:(0,i.readConfObject)(this.props.config,"displayMode"),pitchX:this.props.bpPerPx,pitchY:(0,i.readConfObject)(this.props.config,"noSpacing")?1:3})}cachedLayoutIsValid(e){return e.props.bpPerPx===this.props.bpPerPx&&a()((0,i.readConfObject)(this.props.config),(0,i.readConfObject)(e.props.config))&&a()(this.props.filters,e.props.filters)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),props:this.props}),this.cachedLayout.layout}}},31673:(e,t,r)=>{"use strict";function n(e){const t=new FileReader;return new Promise(((r,n)=>{t.onload=e=>{e.target?r(e.target.result):n(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)}))}r.d(t,{y:()=>n})},31756:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(58921),a=r(68584),i=r(1622);const o=(0,a.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:i.baseConnectionConfig,preProcessSnapshot:e=>e.uri?{...e,hubTxtLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var s=r(36422);function l(e){return s.types.compose("UCSCTrackHubConnection",(0,i.BaseConnectionModelFactory)(e),s.types.model({configuration:(0,a.ConfigurationReference)(o),type:s.types.literal("UCSCTrackHubConnection")})).actions((e=>({async connect(){const{doConnect:t}=await r.e(908).then(r.bind(r,908));t(e)}})))}function c(e){e.addConnectionType((()=>new n.ConnectionType({name:"UCSCTrackHubConnection",configSchema:o,stateModel:l(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"https://genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})))}},32474:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(99546),a=r(51414),i=r(62266),o=r(68446),s=r(76239),l=r(69500);const c=(0,o.observer)((function({model:e,overview:t,useOffset:r=!0}){const o=(0,a.A)(),c=Number(r),{interRegionPaddingWidth:d,offsetPx:u,dynamicBlocks:p,cytobandOffset:g}=e,{contentBlocks:h,totalWidthPxWithoutBorders:f}=p,m=o.palette.tertiary.light;if(!h.length)return null;const y=h.at(0),b=h.at(-1),w=(t.bpToPx({...y,coord:y.reversed?y.end:y.start})||0)+g*c,v=(t.bpToPx({...b,coord:b.reversed?b.start:b.end})||0)+g*c,S=Math.max(0,-u),C=S+f+h.length*d/2,x=[[S,s.Ij],[C,s.Ij],[v,0],[w,0]];return(0,l.jsx)("polygon",{points:x.toString(),...(0,n.getFillProps)((0,i.X4)(m,.3)),...(0,n.getStrokeProps)((0,i.X4)(m,.8))})}))},32595:(e,t,r)=>{"use strict";function n(e,t,r,n){return t>r&&e<n&&n-r&&t-e?e>r?t<n?[e,t]:[e,n]:t<n?[r,t]:[r,n]:[]}function a(e,t,r,n){return t>r&&e<n}function i(e,t,r,n){return r<=e&&n>=t}r.d(t,{R6:()=>a,Xx:()=>i,ky:()=>n})},32761:(e,t,r)=>{"use strict";r.d(t,{Ak:()=>n});const n=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"")},32767:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel}}},33935:(e,t,r)=>{"use strict";r.d(t,{L$:()=>C,qe:()=>k,RI:()=>S});var n=r(7552),a=r(67112),i=r(76218),o=r(30698),s=r(69092),l=r(68446),c=r(36422),d=r(7946),u=r(22762),p=r(75785),g=r(69500);const h=(0,p.n9)()({block:{display:"block"}});function f({checked:e,disabled:t,label:r,onChange:n}){const{classes:a}=h();return(0,g.jsx)(d.A,{disabled:t,className:a.block,control:(0,g.jsx)(u.A,{checked:e,onChange:n}),label:r})}var m=r(99546),y=r(350);function b({feature:e,assembly:t}){const r=e.get("ALT")?.[0],n=r?(0,y.h)(r):void 0,a=e.get("start"),i=e.get("refName"),o=e=>t.getCanonicalRefName(e)||e;if("<TRA>"===r){const t=e.get("INFO");return{pos:a,refName:o(i),mateRefName:o(t.CHR2[0]),matePos:t.END[0]-1}}if(n?.MatePosition){const e=n.MatePosition.split(":");return{pos:a,refName:o(i),mateRefName:o(e[0]),matePos:+e[1]-1}}if(e.get("mate")){const t=e.get("mate");return{pos:a,refName:o(i),mateRefName:o(t.refName),matePos:t.start}}return{pos:a,refName:o(i),mateRefName:o(i),matePos:e.get("end")}}function w(e){return e.map((({id:e,displays:t,...r})=>({...r,displays:t.map((({id:e,...t})=>t))})))}function v(e){return`${e.get("name")||e.get("id")||"breakend"} split detail`}async function S({stableViewId:e,feature:t,assemblyName:r,session:n,mirror:a,tracks:i=[]}){const{assemblyManager:o}=n,s=await o.waitForAssembly(r);if(!s)throw new Error(`assembly ${r} not found`);const{refName:l,pos:c,mateRefName:d,matePos:u}=b({feature:t,assembly:s});let p=n.views.find((t=>t.id===e));p||(p=n.addView("BreakpointSplitView",{id:e,type:"BreakpointSplitView",displayName:v(t),views:[{type:"LinearGenomeView",hideHeader:!0,tracks:w(i)},{type:"LinearGenomeView",hideHeader:!0,tracks:w(a?[...i].reverse():i)}]})),p.setDisplayName(v(t));const g=s.regions.find((e=>e.refName===l)),h=s.regions.find((e=>e.refName===d));if(!g||!h)throw new Error("can't find regions");await Promise.all([p.views[0].navToLocations([{refName:l,start:g.start,end:c,assemblyName:r},{refName:l,start:c+1,end:g.end,assemblyName:r}]),p.views[1].navToLocations([{refName:d,start:h.start,end:u,assemblyName:r},{refName:d,start:u+1,end:h.end,assemblyName:r}])]),await(0,m.when)((()=>p.views[1].initialized&&p.views[0].initialized)),p.views[1].zoomTo(10),p.views[0].zoomTo(10),p.views[1].centerAt(u,d),p.views[0].centerAt(c,l)}const C=(0,l.observer)((function({session:e,handleClose:t,feature:r,assemblyName:l,stableViewId:d,view:u}){const[p,h]=(0,n.useState)(!0),[m,y]=(0,n.useState)(!0);return(0,g.jsxs)(a.Dialog,{open:!0,onClose:t,title:"Multi-level breakpoint split view options",children:[(0,g.jsxs)(i.A,{children:[(0,g.jsx)("div",{children:"Launch multi-level breakpoint split view"}),u?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(f,{checked:p,label:"Copy tracks into the new view",onChange:e=>{h(e.target.checked)}}),p?(0,g.jsx)(f,{checked:m,disabled:!p,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:e=>{y(e.target.checked)}}):null]}):null]}),(0,g.jsxs)(o.A,{children:[(0,g.jsx)(s.A,{onClick:()=>{(async()=>{try{await S({stableViewId:d,session:e,tracks:p&&u?(0,c.getSnapshot)(u.tracks):[],mirror:m,feature:r,assemblyName:l})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,g.jsx)(s.A,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})}));var x=r(93062);const k=(0,l.observer)((function({session:e,handleClose:t,feature:r,stableViewId:l,assemblyName:d,view:u}){const[p,h]=(0,n.useState)(!0),[y,S]=(0,n.useState)(!0),[C,k]=(0,m.useLocalStorage)("breakpointWindowSize","5000");return(0,g.jsxs)(a.Dialog,{open:!0,onClose:t,title:"Single-level breakpoint split view options",children:[(0,g.jsxs)(i.A,{children:[u?(0,g.jsx)(f,{checked:p,label:"Copy tracks into the new view",onChange:e=>{h(e.target.checked)}}):null,(0,g.jsx)(f,{checked:p,label:"Focus on breakends",onChange:e=>{S(e.target.checked)}}),(0,g.jsx)(x.A,{label:"Window size (bp)",value:C,onChange:e=>{k(e.target.value)}})]}),(0,g.jsxs)(o.A,{children:[(0,g.jsx)(s.A,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e;if(!await t.waitForAssembly(d))throw new Error(`assembly ${d} not found`);await async function({stableViewId:e,feature:t,assemblyName:r,session:n,tracks:a,windowSize:i=0,focusOnBreakends:o}){const{snap:s,coverage:l}=o?function({feature:e,session:t,assemblyName:r,windowSize:n=0}){const{assemblyManager:a}=t,i=a.get(r);if(!i)throw new Error(`assembly ${r} not found`);if(!i.regions)throw new Error(`assembly ${r} regions not loaded`);const o=b({feature:e,assembly:i}),{refName:s,mateRefName:l}=o,c=i.regions.find((e=>e.refName===s)),d=i.regions.find((e=>e.refName===l));return{coverage:o,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,m.gatherOverlaps)([{...c,end:o.pos+n,assemblyName:r},{...d,start:o.matePos-n,assemblyName:r}])}],displayName:v(e)}}}({feature:t,assemblyName:r,session:n,windowSize:i}):function({feature:e,session:t,assemblyName:r}){const{assemblyManager:n}=t,a=n.get(r);if(!a)throw new Error(`assembly ${r} not found`);if(!a.regions)throw new Error(`assembly ${r} regions not loaded`);const i=b({feature:e,assembly:a}),{refName:o,mateRefName:s}=i,l=a.regions.find((e=>e.refName===o)),c=a.regions.find((e=>e.refName===s));return{coverage:i,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,m.gatherOverlaps)([{...l,assemblyName:r},{...c,assemblyName:r}])}],displayName:v(e)}}}({feature:t,assemblyName:r,session:n}),{refName:d,pos:u,mateRefName:p,matePos:g}=l;let h=n.views.find((t=>t.id===e));h?(h.views[0]?.setDisplayedRegions(s.views[0].displayedRegions),h.setDisplayName(s.displayName)):h=n.addView("BreakpointSplitView",{...s,views:[{...s.views[0],tracks:a?w((0,c.getSnapshot)(a)):[]}]});const f=h.views[0];await(0,m.when)((()=>f.initialized));const y=f.bpToPx({coord:Math.max(0,u-i),refName:d}),S=f.bpToPx({coord:g+i,refName:p});y&&S?f.moveTo({...y,offset:y.offsetPx},{...S,offset:S.offsetPx}):(0,m.getSession)(f).notify("Unable to navigate to breakpoint")}({feature:r,assemblyName:d,focusOnBreakends:y,session:e,stableViewId:l,tracks:u?.tracks,windowSize:+C||0})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,g.jsx)(s.A,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})}))},34819:(e,t,r)=>{"use strict";r.d(t,{A:()=>Da});var n=r(27087),a=r(12678),i=r(40898),o=r(92880);class s extends o.default{}var l=r(7552),c=r(68584),d=r(99546),u=r(68446),p=r(69500);const g=(0,l.lazy)((()=>r.e(2241).then(r.bind(r,72241))));function h({selectedFeatureId:e,region:t,bpPerPx:r,config:n,height:a,feature:i,onFeatureClick:o}){const[s,u]=(0,l.useState)(!1),[h,f]=(0,d.bpSpanPx)(i.get("start"),i.get("end"),t,r),m=i.id(),y=e&&String(e)===String(i.id()),b=y?"red":(0,c.readConfObject)(n,"color",{feature:i}),w=y?"red":"black",v=(0,c.readConfObject)(n,"label",{feature:i}),S=(0,c.readConfObject)(n,"caption",{feature:i}),C=(0,c.readConfObject)(n,"thickness",{feature:i})||2,x=Math.min((0,c.readConfObject)(n,"height",{feature:i})||100,a),k=(0,l.useRef)(null),T=.5*x*.75+.375*x;return(0,p.jsxs)("g",{children:[(0,p.jsx)("path",{ref:k,...(0,d.getStrokeProps)(b),d:`M ${h} 0 C ${h} ${x}, ${f} ${x}, ${f} 0`,strokeWidth:C,fill:"transparent",onClick:e=>{o(e,m)},onMouseOver:()=>{u(!0)},onMouseLeave:()=>{u(!1)},pointerEvents:"stroke"}),s?(0,p.jsx)(l.Suspense,{fallback:null,children:(0,p.jsx)(g,{contents:S})}):null,(0,p.jsx)("text",{x:h+(f-h)/2,y:T+3,stroke:"white",strokeWidth:"0.6em",children:v}),(0,p.jsx)("text",{x:h+(f-h)/2,y:T+3,stroke:w,children:v})]})}function f(e,t,r,n){const a=(n-90)*Math.PI/180;return{x:e+r*Math.cos(a),y:t+r*Math.sin(a)}}function m(e,t,r,n,a){const i=f(e,t,r,a),o=f(e,t,r,n),s=a-n<=180?"0":"1";return["M",i.x,i.y,"A",r,r,0,s,0,o.x,o.y].join(" ")}function y({selectedFeatureId:e,region:t,bpPerPx:r,config:n,onFeatureClick:a,feature:i}){const[o,s]=(0,l.useState)(!1),[u,h]=(0,d.bpSpanPx)(i.get("start"),i.get("end"),t,r),f=i.id(),y=e&&String(e)===String(i.id()),b=y?"red":(0,c.readConfObject)(n,"color",{feature:i}),w=y?"red":"black",v=(0,c.readConfObject)(n,"label",{feature:i}),S=(0,c.readConfObject)(n,"caption",{feature:i}),C=(0,c.readConfObject)(n,"thickness",{feature:i})||2,x=(0,l.useRef)(null),k=(h-u)/2;return(0,p.jsxs)("g",{children:[(0,p.jsx)("path",{d:m(u+(h-u)/2,0,(h-u)/2,90,270),...(0,d.getStrokeProps)(b),strokeWidth:C,fill:"transparent",onClick:e=>{a(e,f)},onMouseOver:()=>{s(!0)},onMouseLeave:()=>{s(!1)},ref:x,pointerEvents:"stroke"}),o?(0,p.jsx)(g,{contents:S}):null,(0,p.jsx)("text",{x:u+(h-u)/2,y:k+3,stroke:"white",strokeWidth:"0.6em",children:v}),(0,p.jsx)("text",{x:u+(h-u)/2,y:k+3,stroke:w,children:v})]})}function b({exportSVG:e,width:t,height:r,children:n}){return e?n:(0,p.jsx)("svg",{width:t,height:r,children:n})}const w=(0,u.observer)((function({features:e,config:t,regions:r,bpPerPx:n,height:a,exportSVG:i,displayModel:o,onFeatureClick:s}){const l=r[0],d=(l.end-l.start)/n,u="semicircles"===(0,c.readConfObject)(t,"displayMode"),{selectedFeatureId:g}=o||{};return(0,p.jsx)(b,{exportSVG:i,width:d,height:a,children:[...e.values()].map((e=>u?(0,p.jsx)(y,{config:t,region:l,bpPerPx:n,selectedFeatureId:g,onFeatureClick:s,feature:e},e.id()):(0,p.jsx)(h,{height:a,config:t,region:l,bpPerPx:n,selectedFeatureId:g,onFeatureClick:s,feature:e},e.id())))})}));var v=r(36422);const S=(0,c.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue",contextVariable:["feature"]},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')",contextVariable:["feature"]},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50",contextVariable:["feature"]},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},displayMode:{type:"enum",defaultValue:"arcs",model:v.types.enumeration("DisplayMode",["arcs","semicircles"]),description:"render semi-circles instead of arcs"}},{explicitlyTyped:!0});var C=r(58921),x=r(97486);function k(e){return v.types.compose("LinearArcDisplay",x.Lr,v.types.model({type:v.types.literal("LinearArcDisplay"),configuration:(0,c.ConfigurationReference)(e),displayMode:v.types.maybe(v.types.string)})).views((e=>({get blockType(){return"staticBlocks"},get renderDelay(){return 500},get rendererTypeName(){return e.configuration.renderer.type}}))).views((e=>({get displayModeSetting(){return e.displayMode??(0,c.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,c.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,displayMode:e.displayModeSetting},(0,d.getEnv)(e))}}))).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.rendererConfig,height:e.height})}})).actions((e=>({setDisplayMode(t){e.displayMode=t}}))).views((e=>{const t=e.trackMenuItems;return{trackMenuItems:()=>[...t(),{label:"Display mode",subMenu:[{type:"radio",label:"Arcs",onClick:()=>{e.setDisplayMode("arcs")},checked:"arcs"===e.displayMode},{type:"radio",label:"Semi-circles",onClick:()=>{e.setDisplayMode("semicircles")},checked:"semicircles"===e.displayMode}]}]}}))}function T(e){return v.types.compose("LinearPairedArcDisplay",C.BaseDisplay,(0,x._e)(),(0,x.e6)(),v.types.model({type:v.types.literal("LinearPairedArcDisplay"),configuration:(0,c.ConfigurationReference)(e),displayMode:v.types.maybe(v.types.string)})).volatile((()=>({lastDrawnOffsetPx:0,features:void 0,loading:!1,drawn:!0}))).views((e=>({get displayModeSetting(){return e.displayMode??(0,c.getConf)(e,["renderer","displayMode"])}}))).actions((e=>({selectFeature(t){const r=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(r)){const n=r.addWidget("VariantFeatureWidget","variantFeature",{view:(0,d.getContainingView)(e),track:(0,d.getContainingTrack)(e),featureData:t.toJSON()});r.showWidget(n)}(0,d.isSelectionContainer)(r)&&r.setSelection(t)},setLoading(t){e.loading=t},setFeatures(t){e.features=t},setDisplayMode(t){e.displayMode=t}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(3497).then(r.bind(r,93497));t(e)}catch(t){console.error(t),e.setError(t)}})()},async renderSvg(t){const{renderArcSvg:n}=await r.e(4345).then(r.bind(r,44345));return n(e,t)}})))}class A extends a.A{name="ArcRenderer";install(e){!function(e){e.addRendererType((()=>new s({name:"ArcRenderer",ReactComponent:w,configSchema:S,pluginManager:e})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearArcDisplay",{renderer:v.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:x.Ki,explicitlyTyped:!0})}(e);return new C.DisplayType({name:"LinearArcDisplay",displayName:"Arc display",configSchema:t,stateModel:k(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:x.GQ})}))}(e),function(e){e.addDisplayType((()=>{const e=(0,c.ConfigurationSchema)("LinearPairedArcDisplay",{color:{type:"color",description:"the color of the arcs",defaultValue:"jexl:defaultPairedArcColor(feature,alt)",contextVariable:["feature","alt"]}},{baseConfiguration:x.Ki,explicitlyTyped:!0});return new C.DisplayType({name:"LinearPairedArcDisplay",displayName:"Arc display",configSchema:e,stateModel:T(e),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,l.lazy)((()=>r.e(7126).then(r.bind(r,87126))))})}))}(e),e.jexl.addFunction("logThickness",((e,t)=>Math.log(e.get(t)+1))),e.jexl.addFunction("defaultPairedArcColor",((e,t)=>t?.startsWith("<DEL")?i.set1[0]:t?.startsWith("<DUP")?i.set1[1]:t?.startsWith("<INV")?i.set1[2]:t?.startsWith("<TRA")?i.set1[3]:t?.startsWith("<CNV")?i.set1[4]:i.set1[6]))}}var M=r(92070),P=r(1622);const R=(0,c.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},state:{description:"optional state for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint. can be 'token' or 'code'",type:"string",defaultValue:"code"}},{baseConfiguration:P.BaseInternetAccountConfig,explicitlyTyped:!0}),L=(0,c.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]}},{baseConfiguration:R,explicitlyTyped:!0});function I(e){return e.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}function F(e,t){try{const r=JSON.parse(e);return"invalid_grant"===r.error&&t(),r?.error_description??e}catch(e){}return e}function N(e,t){return e.refresh_token&&t(e.refresh_token),e.access_token}async function D({response:e,reason:t,statusText:r}){return[`HTTP ${e.status}`,t,r??await B(e)].filter((e=>!!e)).join(" - ")}async function B(e){try{return await e.text()}catch(t){return e.statusText}}const V=e=>P.InternetAccount.named("OAuthInternetAccount").props({type:v.types.literal("OAuthInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((()=>{let e;return{get codeVerifierPKCE(){if(!e){const t=new Uint8Array(32);globalThis.crypto.getRandomValues(t),e=I(function(e){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(String.fromCharCode(e[r]));return btoa(t.join(""))}(t))}return e}}})).views((e=>({get authEndpoint(){return(0,c.getConf)(e,"authEndpoint")},get tokenEndpoint(){return(0,c.getConf)(e,"tokenEndpoint")},get needsPKCE(){return(0,c.getConf)(e,"needsPKCE")},get clientId(){return(0,c.getConf)(e,"clientId")},get scopes(){return(0,c.getConf)(e,"scopes")},state:()=>(0,c.getConf)(e,"state"),get responseType(){return(0,c.getConf)(e,"responseType")},get refreshTokenKey(){return`${e.internetAccountId}-refreshToken`}}))).actions((e=>({storeRefreshToken(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:()=>localStorage.getItem(e.refreshTokenKey),async exchangeAuthorizationForAccessToken(t,r){const n=new URLSearchParams(Object.entries({code:t,grant_type:"authorization_code",client_id:e.clientId,redirect_uri:r,...e.needsPKCE?{code_verifier:e.codeVerifierPKCE}:{}})),a=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()});if(!a.ok)throw new Error(await D({response:a,reason:"Failed to obtain token"}));return N(await a.json(),(e=>{this.storeRefreshToken(e)}))},async exchangeRefreshForAccessToken(t){const r=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Object.entries({grant_type:"refresh_token",refresh_token:t,client_id:e.clientId})).toString()});if(!r.ok){e.removeToken();const t=await r.text();throw new Error(await D({response:r,statusText:F(t,(()=>{this.removeRefreshToken()}))}))}return N(await r.json(),(e=>{this.storeRefreshToken(e)}))}}))).actions((e=>{let t,n;return{addMessageChannel(e,r){t=t=>{this.finishOAuthWindow(t,e,r)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},async finishOAuthWindow(t,r,n){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return void this.deleteMessageChannel();const a=t.data.redirectUri,i=a.replace("#","?"),o=new URL(i),s=o.search,l=new URLSearchParams(s);if(l.has("access_token")){const t=l.get("access_token");return t?(e.storeToken(t),void r(t)):void n(new Error("Error with token endpoint"))}if(l.has("code")){const t=l.get("code");if(!t)return void n(new Error("Error with authorization endpoint"));try{const n=await e.exchangeAuthorizationForAccessToken(t,o.origin+o.pathname);return e.storeToken(n),void r(n)}catch(e){return void(e instanceof Error?n(e):n(new Error(String(e))))}}a.includes("access_denied")?n(new Error("OAuth flow was cancelled")):a.includes("error")?n(new Error(`OAuth flow error: ${s}`)):this.deleteMessageChannel()},async useEndpointForAuthorization(t,n){const a=d.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,i={client_id:e.clientId,redirect_uri:a,response_type:e.responseType,token_access_type:"offline"};e.state()&&(i.state=e.state()),e.scopes&&(i.scope=e.scopes),e.needsPKCE&&(i.code_challenge=await async function(e){const t=await Promise.all([r.e(7753),r.e(6043)]).then(r.t.bind(r,27181,23)).then((e=>e.default));return I((await Promise.all([r.e(7753),r.e(6435)]).then(r.t.bind(r,29038,23))).stringify(t(e)))}(e.codeVerifierPKCE),i.code_challenge_method="S256");const o=new URLSearchParams(Object.entries(i)),s=new URL(e.authEndpoint);s.search=o.toString();const l=`JBrowseAuthWindow-${e.internetAccountId}`;if(d.isElectron){const{ipcRenderer:r}=window.require("electron"),a=await r.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:i,url:s.toString()}),o=new MessageEvent("message",{data:{name:l,redirectUri:a}});this.finishOAuthWindow(o,t,n)}else window.open(s,l,"width=500,height=600,left=0,top=0")},async getTokenFromUser(t,r){const n=e.retrieveRefreshToken();let a=!0;if(n)try{t(await e.exchangeRefreshForAccessToken(n)),a=!1}catch(t){console.error(t),e.removeRefreshToken()}a&&(this.addMessageChannel(t,r),this.useEndpointForAuthorization(t,r))},async validateToken(t,r){const a=e.addAuthHeaderToInit({method:"HEAD"},t),i=await fetch(r.uri,a);if(!i.ok){e.removeToken();const t=e.retrieveRefreshToken();if(t)try{n||(n=e.exchangeRefreshForAccessToken(t));const r=await n;return n=void 0,r}catch(e){console.error("Token could not be refreshed",e)}throw new Error(await D({response:i,reason:"Error validating token"}))}return t}}})).actions((e=>{const t=e.getFetcher;return{getFetcher(r){const n=t(r);return async(t,a)=>(r&&await e.validateToken(await e.getToken(r),r),n(t,a))}}}));var j=r(94874);function E(e){return(0,p.jsx)(j.A,{...e,children:(0,p.jsx)("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"})})}const z={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};async function O(e,t){let r="";try{const t=JSON.parse(await e.text()).error[".tag"];r=z[t]||t}catch(e){}return D({response:e,reason:t,statusText:r})}const H=e=>V(R).named("DropboxOAuthInternetAccount").props({type:v.types.literal("DropboxOAuthInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return(0,p.jsx)(E,{})},get selectorLabel(){return"Enter Dropbox share link"}}))).actions((e=>({getFetcher:t=>async(r,n)=>{const a=await e.getToken(t),i=e.addAuthHeaderToInit({...n,method:"POST"},a);i.headers.append("Dropbox-API-Arg",JSON.stringify({url:r}));const o=await fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",i);if(!o.ok)throw new Error(await O(o));return o},async validateToken(t,r){const n=await fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({url:r.uri})});if(!n.ok){const t=e.retrieveRefreshToken();if(t){e.removeRefreshToken();const n=await e.exchangeRefreshForAccessToken(t);return this.validateToken(n,r)}throw new Error(await O(n,"Token could not be validated"))}return t}}))),G=(0,c.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:P.BaseInternetAccountConfig,explicitlyTyped:!0});var W=r(67112),$=r(76218),U=r(93062),q=r(30698),_=r(69092);const J=({internetAccountId:e,handleClose:t})=>{const[r,n]=(0,l.useState)("");return(0,p.jsxs)(W.Dialog,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",onClose:()=>{t()},title:`Enter token for ${e}`,children:[(0,p.jsx)($.A,{style:{display:"flex",flexDirection:"column"},children:(0,p.jsx)(U.A,{required:!0,label:"Enter Token",variant:"outlined",onChange:e=>{n(e.target.value)},margin:"dense",slotProps:{htmlInput:{"data-testid":"entry-externalToken"}}})}),(0,p.jsxs)(q.A,{children:[(0,p.jsx)(_.A,{variant:"contained",color:"primary",type:"submit",disabled:!r,onClick:()=>{r&&t(r)},children:"Add"}),(0,p.jsx)(_.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})},X=e=>P.InternetAccount.named("ExternalTokenInternetAccount").props({type:v.types.literal("ExternalTokenInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,c.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,r){const{session:n}=(0,v.getRoot)(e);n.queueDialog((n=>[J,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):r(new Error("user cancelled entry")),n()}}]))},async validateToken(t,r){if(!e.validateWithHEAD)return t;const n=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(r.uri,n);if(!a.ok){let e;try{e=await a.text()}catch(t){e=""}throw new Error(`Token could not be validated — ${a.status} ${e?` (${e})`:""}`)}return t}}))),Y=(0,c.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:R,explicitlyTyped:!0});var K=r(99834);class Q extends K.RemoteFileWithRangeCache{constructor(e,t){super(e,t),this.statsPromise=this.fetch(e,{metadataOnly:!0}).then((e=>e.json()))}async fetch(e,t){return super.fetch(e,t)}async stat(){return this.statsPromise}}function Z(e){return(0,p.jsx)(j.A,{...e,children:(0,p.jsx)("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"})})}async function ee(e,t){let r="";try{r=JSON.parse(await e.text()).error.message}catch(e){}return D({response:e,reason:t,statusText:r})}function te(e){return`https://www.googleapis.com/drive/v3/files/${/[-\w]{25,}/.exec(e)}`}function re(e){return V(R).named("GoogleDriveOAuthInternetAccount").props({type:v.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return(0,p.jsx)(Z,{})},get selectorLabel(){return"Enter Google Drive share link"}}))).actions((e=>({getFetcher:t=>async(r,n)=>{const a=new URL(te(String(r))),i=new URLSearchParams;n?.metadataOnly?i.append("fields","size"):i.append("alt","media"),a.search=i.toString();const o=await e.getToken(t),s=await fetch(a,e.addAuthHeaderToInit({...n,method:"GET",credentials:"same-origin"},o));if(!s.ok)throw new Error(await ee(s));return s},openLocation(e){return new Q(e.uri,{fetch:this.getFetcher(e)})},async validateToken(e,t){const r=await fetch(te(t.uri),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"}});if(!r.ok)throw new Error(await ee(r,"Token could not be validated"));return e}})))}const ne=(0,c.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:P.BaseInternetAccountConfig,explicitlyTyped:!0});function ae({internetAccountId:e,handleClose:t}){const[r,n]=(0,l.useState)(""),[a,i]=(0,l.useState)("");return(0,p.jsx)(W.Dialog,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",title:`Log in for ${e}`,onClose:()=>{t()},children:(0,p.jsxs)("form",{onSubmit:e=>{r&&a?t(btoa(`${r}:${a}`)):t(),e.preventDefault()},children:[(0,p.jsxs)($.A,{style:{display:"flex",flexDirection:"column"},children:[(0,p.jsx)(U.A,{required:!0,label:"Username",variant:"outlined",onChange:e=>{n(e.target.value)},margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-username"}}}),(0,p.jsx)(U.A,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",onChange:e=>{i(e.target.value)},margin:"dense",slotProps:{htmlInput:{"data-testid":"login-httpbasic-password"}}})]}),(0,p.jsxs)(q.A,{children:[(0,p.jsx)(_.A,{variant:"contained",color:"primary",type:"submit",children:"Submit"}),(0,p.jsx)(_.A,{variant:"contained",color:"secondary",type:"submit",onClick:()=>{t()},children:"Cancel"})]})]})})}const ie=e=>P.InternetAccount.named("HTTPBasicInternetAccount").props({type:v.types.literal("HTTPBasicInternetAccount"),configuration:(0,c.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,c.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,r){const{session:n}=(0,v.getRoot)(e);n.queueDialog((n=>[ae,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):r(new Error("User cancelled entry")),n()}}]))},async validateToken(t,r){if(!e.validateWithHEAD)return t;const n=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(r.uri,n);if(!a.ok)throw new Error(await D({response:a,reason:"Error validating token"}));return t}})));class oe extends a.A{name="AuthenticationPlugin";exports={OAuthConfigSchema:R,OAuthInternetAccountModelFactory:V,ExternalTokenConfigSchema:G,ExternalTokenInternetAccountModelFactory:X,HTTPBasicConfigSchema:ne,HTTPBasicInternetAccountModelFactory:ie,DropboxOAuthConfigSchema:L,DropboxOAuthInternetAccountModelFactory:H,GoogleDriveOAuthConfigSchema:Y,GoogleDriveOAuthInternetAccountModelFactory:re};install(e){e.addInternetAccountType((()=>new M.A({name:"OAuthInternetAccount",configSchema:R,stateModel:V(R)}))),e.addInternetAccountType((()=>new M.A({name:"ExternalTokenInternetAccount",configSchema:G,stateModel:X(G)}))),e.addInternetAccountType((()=>new M.A({name:"HTTPBasicInternetAccount",configSchema:ne,stateModel:ie(ne)}))),e.addInternetAccountType((()=>new M.A({name:"DropboxOAuthInternetAccount",configSchema:L,stateModel:H(L)}))),e.addInternetAccountType((()=>new M.A({name:"GoogleDriveOAuthInternetAccount",configSchema:Y,stateModel:re(Y)})))}}var se=r(47369);const le=(0,c.ConfigurationSchema)("BedAdapter",{bedLocation:{type:"fileLocation",description:"path to bed file, also allows gzipped bed",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),ce=(0,c.ConfigurationSchema)("BedGraphAdapter",{bedGraphLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGraphLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),de=(0,c.ConfigurationSchema)("BedGraphTabixAdapter",{bedGraphGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedgraph",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("VcfIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGraphGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e}),ue=(0,c.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e}),pe=(0,c.ConfigurationSchema)("BedpeAdapter",{bedpeLocation:{type:"fileLocation",description:"can be plaintext or gzipped, not indexed so loaded into memory on startup",defaultValue:{uri:"/path/to/my.bedpe.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bedpeLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),ge=(0,c.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},aggregateField:{type:"string",description:"An attribute to aggregate features with",defaultValue:"geneName2"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,bigBedLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var he=r(91468);class fe extends a.A{name="BedPlugin";install(e){!function(e){e.addAdapterType((()=>new se.A({name:"BigBedAdapter",displayName:"BigBed adapter",configSchema:ge,getAdapterClass:()=>Promise.all([r.e(972),r.e(7260),r.e(6834)]).then(r.bind(r,6834)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"BedAdapter",displayName:"BED adapter",configSchema:le,getAdapterClass:()=>Promise.all([r.e(2598),r.e(972),r.e(4864)]).then(r.bind(r,34864)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"BedpeAdapter",displayName:"BEDPE adapter",configSchema:pe,getAdapterClass:()=>Promise.all([r.e(2598),r.e(8738)]).then(r.bind(r,28738)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"BedTabixAdapter",displayName:"BED tabix adapter",configSchema:ue,getAdapterClass:()=>Promise.all([r.e(3085),r.e(972),r.e(6214)]).then(r.bind(r,86214)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"BedGraphAdapter",displayName:"BedGraph adapter",configSchema:ce,getAdapterClass:()=>Promise.all([r.e(2598),r.e(4058)]).then(r.bind(r,54058)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"BedGraphTabixAdapter",displayName:"BedGraphTabix adapter",configSchema:de,getAdapterClass:()=>Promise.all([r.e(3085),r.e(6800)]).then(r.bind(r,96800)).then((e=>e.default))})))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,he.getFileName)(t),i=r&&(0,he.getFileName)(r);return(0,d.testAdapter)(a,/\.bedpe(\.gz)?$/i,n,"BedpeAdapter")?{type:"BedpeAdapter",bedpeLocation:t}:(0,d.testAdapter)(a,/\.bb$/i,n,"BigBedAdapter")||(0,d.testAdapter)(a,/\.bigBed?$/i,n,"BigBedAdapter")?{type:"BigBedAdapter",bigBedLocation:t}:(0,d.testAdapter)(a,/\.bed$/i,n,"BedAdapter")?{type:"BedAdapter",bedLocation:t}:(0,d.testAdapter)(a,/\.bg$/i,n,"BedGraphAdapter")?{type:"BedGraphAdapter",bedGraphLocation:t}:(0,d.testAdapter)(a,/\.bg(\.gz)?$/i,n,"BedGraphTabixAdapter")?{type:"BedGraphTabixAdapter",bedGraphGzLocation:t,index:{location:r||(0,he.makeIndex)(t,".tbi"),indexType:(0,he.makeIndexType)(i,"CSI","TBI")}}:(0,d.testAdapter)(a,/\.bed\.gz$/i,n,"BedTabixAdapter")?{type:"BedTabixAdapter",bedGzLocation:t,index:{location:r||(0,he.makeIndex)(t,".tbi"),indexType:(0,he.makeIndexType)(i,"CSI","TBI")}}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>({BedpeAdapter:"VariantTrack",BedGraphAdapter:"QuantitativeTrack",BedGraphTabixAdapter:"QuantitativeTrack"}[t]||e(t))))}(e)}}var me=r(8832);const ye=(0,c.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),be=v.types.model("BreakpointAlignmentsWidget",{id:me.ElementId,type:v.types.literal("BreakpointAlignmentsWidget"),featureData:v.types.frozen()}).actions((e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}})));var we=r(27614),ve=r(34727),Se=r(45465),Ce=r(42489),xe=r(49473);const ke=(0,l.lazy)((()=>r.e(7790).then(r.bind(r,47790))));function Te(e){return v.types.compose("BreakpointSplitView",P.BaseViewModel,v.types.model({type:v.types.literal("BreakpointSplitView"),height:v.types.optional(v.types.refinement("viewHeight",v.types.number,(e=>e>=40)),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactiveOverlay:!0,views:v.types.array(e.getViewType("LinearGenomeView").stateModel)})).volatile((()=>({width:800,matchedTrackFeatures:{}}))).views((e=>({async exportSvg(t={}){const{renderToSvg:n}=await Promise.all([r.e(5727),r.e(5668)]).then(r.bind(r,95668)),a=await n(e,t),i=new Blob([a],{type:"image/svg+xml"});(0,Se.saveAs)(i,t.filename||"image.svg")}}))).views((e=>({get matchedTracks(){return 1===e.views.length?e.views[0].tracks:(0,xe.y$)((e=>e.configuration.trackId),...e.views.map((e=>e.tracks)))},getMatchedTracks:t=>e.views.map((e=>e.getTrack(t))).filter((e=>!!e)),hasTranslocations(e){return[...this.getTrackFeatures(e).values()].find((e=>"translocation"===e.get("type")))},hasPairedFeatures(e){return[...this.getTrackFeatures(e).values()].find((e=>"paired_feature"===e.get("type")))},getTrackFeatures:t=>new Map(e.matchedTrackFeatures[t]?.flat().map((e=>[e.id(),e]))),getMatchedFeaturesInLayout(e,t){const r=this.getMatchedTracks(e);return t.map((e=>e.map((e=>{const t=r.findIndex((t=>(0,xe._u)(t,e)));return-1!==t?{feature:e,layout:(0,xe._u)(r[t],e),level:t,clipPos:(0,xe.NI)(e.get("CIGAR"),e.get("strand"))}:void 0})).filter(d.notEmpty)))}}))).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,v.onAction)(e,(({name:t,path:r,args:n})=>{e.linkViews&&["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(t)&&r&&this.onSubviewAction(t,r,n)})))},onSubviewAction(t,r,n){for(const a of e.views)(0,v.getPath)(a).endsWith(r)||a[t](n?.[0])},setWidth(t){e.width=t;for(const r of e.views)r.setWidth(t)},setInteractiveOverlay(t){e.interactiveOverlay=t},setShowIntraviewLinks(t){e.showIntraviewLinks=t},setLinkViews(t){e.linkViews=t},setMatchedTrackFeatures(t){e.matchedTrackFeatures=t},reverseViewOrder(){e.views.reverse()}}))).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,Ce.autorun)((async()=>{try{if(!e.views.every((e=>e.initialized)))return;e.setMatchedTrackFeatures(Object.fromEntries(await Promise.all(e.matchedTracks.map((async t=>[t.configuration.trackId,await(0,xe.JV)(e,t)])))))}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}})))},menuItems:()=>[...e.views.map(((e,t)=>[t,e.menuItems()])).map((e=>({label:`Row ${e[0]+1} view menu`,subMenu:e[1]}))),...e.views.length>1?[{label:"Reverse view order",onClick:()=>{e.reverseViewOrder()}}]:[],{label:"Show intra-view links",type:"checkbox",checked:e.showIntraviewLinks,onClick:()=>{e.setShowIntraviewLinks(!e.showIntraviewLinks)}},{label:"Allow clicking alignment squiggles?",type:"checkbox",checked:e.interactiveOverlay,onClick:()=>{e.setInteractiveOverlay(!e.interactiveOverlay)}},{label:"Link views",type:"checkbox",icon:we.A,checked:e.linkViews,onClick:()=>{e.setLinkViews(!e.linkViews)}},{label:"Export SVG",icon:ve.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[ke,{model:e,handleClose:t}]))}}]})))}class Ae extends a.A{name="BreakpointSplitViewPlugin";install(e){!function(e){e.addViewType((()=>new C.ViewType({name:"BreakpointSplitView",displayName:"Breakpoint split view",stateModel:Te(e),ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(5727),r.e(7348)]).then(r.bind(r,67348))))})))}(e),function(e){e.addWidgetType((()=>new C.WidgetType({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:ye,stateModel:be,ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6386),r.e(1475),r.e(4144),r.e(439)]).then(r.bind(r,90439))))})))}(e)}configure(){}}var Me=r(48133);const Pe=(0,c.ConfigurationSchema)("BlastTabularAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Query assembly is the first value in the array, target assembly is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},blastTableLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/blastTable.tsv",locationType:"UriLocation"}},columns:{type:"string",description:"Optional space-separated column name list. If custom columns were used in outfmt, enter them here exactly as specified in the command. At least qseqid, sseqid, qstart, qend, sstart, and send are required",defaultValue:"qseqid sseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore"}},{explicitlyTyped:!0}),Re=(0,c.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,chainLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Le=["PAFAdapter","ChainAdapter","DeltaAdapter","BlastTabularAdapter","MashMapAdapter","MCScanAnchorsAdapter","MCScanSimpleAnchorsAdapter","PairwiseIndexedPAFAdapter"],Ie=["PAFAdapter","ChainAdapter","DeltaAdapter","MashMapAdapter","BlastTabularAdapter","PairwiseIndexedPAFAdapter"],Fe=["MCScanAnchorsAdapter","MCScanSimpleAnchorsAdapter"],Ne=(0,l.lazy)((()=>r.e(2819).then(r.bind(r,22819)))),De=(0,c.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,deltaLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Be=(0,l.lazy)((()=>r.e(4141).then(r.bind(r,34141)))),Ve=(0,c.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri&&e.bed1&&e.bed2?{...e,mcscanAnchorsLocation:{uri:e.uri,baseUri:e.baseUri},bed1Location:{uri:e.bed1,baseUri:e.baseUri},bed2Location:{uri:e.bed2,baseUri:e.baseUri}}:e}),je=(0,c.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri&&e.bed1&&e.bed2?{...e,mcscanSimpleAnchorsLocation:{uri:e.uri,baseUri:e.baseUri},bed1Location:{uri:e.bed1,baseUri:e.baseUri},bed2Location:{uri:e.bed2,baseUri:e.baseUri}}:e}),Ee=(0,c.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,outLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),ze=(0,c.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,pafLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Oe=(0,c.ConfigurationSchema)("PairwiseIndexedPAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The query assembly name is the first value in the array, target assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pifGzLocation:{type:"fileLocation",description:"location of pairwise tabix indexed PAF (pif)",defaultValue:{uri:"/path/to/data/file.pif.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.paf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,pifGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});class He extends a.A{name="ComparativeAdaptersPlugin";install(e){!function(e){e.addAdapterType((()=>new se.A({name:"PAFAdapter",displayName:"PAF adapter",configSchema:ze,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>r.e(5904).then(r.bind(r,35904)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"PairwiseIndexedPAFAdapter",displayName:"Pairwise indexed PAF adapter",configSchema:Oe,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>Promise.all([r.e(3085),r.e(3167)]).then(r.bind(r,23167)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"DeltaAdapter",displayName:"MUMmer delta adapter",configSchema:De,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>r.e(2820).then(r.bind(r,12820)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"ChainAdapter",displayName:"Liftover chain adapter",configSchema:Re,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>r.e(8929).then(r.bind(r,98929)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"MCScanAnchorsAdapter",displayName:"MCScan anchors adapter",configSchema:Ve,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>r.e(8965).then(r.bind(r,28965)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"MCScanSimpleAnchorsAdapter",displayName:"MCScan anchors.simple adapter",configSchema:je,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>r.e(9409).then(r.bind(r,69409)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"MashMapAdapter",displayName:"MashMap adapter",configSchema:Ee,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>r.e(9449).then(r.bind(r,29449)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"BlastTabularAdapter",displayName:"Tabular BLAST output adapter",configSchema:Pe,adapterMetadata:{category:"Synteny adapters"},getAdapterClass:()=>r.e(7439).then(r.bind(r,67439)).then((e=>e.default))})))}(e),function(e){e.addToExtensionPoint("Core-addTrackComponent",((e,{model:t})=>Ie.includes(t.trackAdapterType)?Ne:e))}(e),function(e){e.addToExtensionPoint("Core-addTrackComponent",((e,{model:t})=>Fe.includes(t.trackAdapterType)?Be:e))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,he.getFileName)(t),i=r&&(0,he.getFileName)(r);return(0,d.testAdapter)(a,/\.paf(.gz)?/i,n,"PAFAdapter")?{type:"PAFAdapter",pafLocation:t}:"BlastTabularAdapter"===n?{type:"BlastTabularAdapter",blastTableLocation:t}:(0,d.testAdapter)(a,/\.anchors.simple(.gz)?/i,n,"MCScanSimpleAnchorsAdapter")?{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:t}:(0,d.testAdapter)(a,/\.anchors(.gz)?/i,n,"MCScanAnchorsAdapter")?{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:t}:(0,d.testAdapter)(a,/\.delta(.gz)?/i,n,"DeltaAdapter")?{type:"DeltaAdapter",deltaLocation:t}:(0,d.testAdapter)(a,/\.chain(.gz)?/i,n,"ChainAdapter")?{type:"ChainAdapter",chainLocation:t}:(0,d.testAdapter)(a,/\.out(.gz)?/i,n,"MashMapAdapter")?{type:"MashMapAdapter",outLocation:t}:(0,d.testAdapter)(a,/\.pif\.gz/i,n,"PairwiseIndexedPAFAdapter")?{type:"PairwiseIndexedPAFAdapter",pifGzLocation:t,index:{location:r||(0,he.makeIndex)(t,".tbi"),indexType:(0,he.makeIndexType)(i,"CSI","TBI")}}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>Le.includes(t)?"SyntenyTrack":e(t)))}(e)}}var Ge=r(59099),We=r(16574),$e=r(64669),Ue=r(2406),qe=r(37347);class _e extends Ue.A{name="ComparativeRender";async renameRegionsIfNeeded(e,t){return t.renameRegionsIfNeeded(e)}getRenderer(e){return this.pluginManager.getRendererType(e)}async serializeArguments(e,t){const{rendererType:r}=e,n=this.getRenderer(r),a=await super.serializeArguments(e,t),i=await this.renameRegionsIfNeeded(a,n);return"MainThreadRpcDriver"===t?i:n.serializeArgsInClient(i)}async execute(e,t){let r=e;"MainThreadRpcDriver"!==t&&(r=await this.deserializeArguments(e,t));const{sessionId:n,rendererType:a,stopToken:i}=r;if(!n)throw new Error("must pass a unique session id");(0,qe.SW)(i);const o=this.getRenderer(a);return"MainThreadRpcDriver"===t?o.render(r):o.renderInWorker(r)}async deserializeReturn(e,t,r){const n=await super.deserializeReturn(e,t,r);return"MainThreadRpcDriver"===r?n:this.getRenderer(t.rendererType).deserializeResultsInClient(n,t)}}var Je=r(56328);const Xe=(0,u.observer)((function(e){const{model:t,children:r}=e,{offsetX:n=0,offsetY:a=0}=t.data||{},i=(0,d.getContainingView)(t),o=i.vview.offsetPx-a,s=-(i.hview.offsetPx-n);return(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsx)(t.ReactComponent2,{...e,style:{position:"absolute",top:o,left:s}}),r]})})),Ye=Xe;var Ke=r(61282),Qe=r(75785);const Ze=(0,Qe.n9)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{backgroundColor:t,padding:"10px"},blockError:{backgroundColor:t,padding:"10px",color:"red"}}}));function et(){const[e,t]=(0,l.useState)(!1),{classes:r}=Ze();return(0,l.useEffect)((()=>{const e=setTimeout((()=>{t(!0)}),300);return()=>{clearTimeout(e)}}),[]),e?(0,p.jsx)("div",{className:r.loading,children:(0,p.jsx)(W.LoadingEllipses,{})}):null}function tt({messageText:e}){const{classes:t}=Ze();return(0,p.jsx)("div",{className:t.blockMessage,children:(0,p.jsx)(Ke.A,{children:e})})}function rt({error:e}){const{classes:t}=Ze();return(0,p.jsx)("div",{className:t.blockError,children:(0,p.jsx)(Ke.A,{children:`${e}`})})}const nt=(0,u.observer)((function({model:e,style:t}){return e.error?(0,p.jsx)(rt,{error:e.error,"data-testid":"reload_button"}):e.message?(0,p.jsx)(tt,{messageText:e.message}):e.filled?e.shouldDisplay?(0,p.jsx)("div",{style:t,children:e.reactElement}):null:(0,p.jsx)(et,{})})),at=nt;function it(e){const{rpcManager:t}=(0,d.getSession)(e),{rendererType:r}=e,{adapterConfig:n}=e,a=(0,d.getContainingView)(e);if((0,c.readConfObject)(e.configuration),(0,v.getSnapshot)(a),a.initialized){const{viewWidth:i,viewHeight:o,borderSize:s,borderX:l,borderY:c}=a;return{rendererType:r,rpcManager:t,renderProps:{...e.renderProps(),view:structuredClone((0,v.getSnapshot)(a)),width:i,height:o,borderSize:s,borderX:l,borderY:c,adapterConfig:n,rendererType:r.name,sessionId:(0,he.getRpcSessionId)(e),timeout:1e6}}}}function ot(e){return v.types.compose("DotplotDisplay",P.BaseDisplay,v.types.model({type:v.types.literal("DotplotDisplay"),configuration:(0,c.ConfigurationReference)(e)}).volatile((()=>({stopToken:void 0,warnings:[],filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:at})))).views((e=>({get shouldDisplay(){const{vview:t,hview:r}=(0,d.getContainingView)(e);return t.bpPerPx===e.data.bpPerPxY&&r.bpPerPx===e.data.bpPerPxX},get rendererTypeName(){return(0,c.getConf)(e,["renderer","type"])},renderProps:()=>({...(0,he.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}))).views((e=>({async renderSvg(t){const r=it(e);if(!r)return null;const{rendererType:n,rpcManager:a,renderProps:i}=r,o=await n.renderInClient(a,{...i,exportSVG:t,theme:t.theme||i.theme}),{hview:s,vview:l}=(0,d.getContainingView)(e),c=-s.offsetPx+o.offsetX,u=-l.offsetPx+o.offsetY;return(0,p.jsx)("g",{transform:`translate(${c} ${-u})`,children:(0,p.jsx)(d.ReactRendering,{rendering:o})})}}))).actions((e=>({afterAttach(){(0,d.makeAbortableReaction)(e,(()=>it(e)),(e=>async function(e){if(!e)return;const{rendererType:t,rpcManager:r,renderProps:n}=e,{reactElement:a,...i}=await t.renderInClient(r,n);return{reactElement:a,data:i,renderingComponent:t.ReactComponent}}(e)),{name:`${e.type} ${e.id} rendering`,delay:500,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading(t){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,e.stopToken=t},setMessage(t){e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,e.stopToken=void 0},setRendered(t){if(void 0===t)return;const{data:r,reactElement:n,renderingComponent:a}=t;e.warnings=r.warnings,e.filled=!0,e.message=void 0,e.reactElement=n,e.data=r,e.error=void 0,e.renderingComponent=a,e.stopToken=void 0},setError(t){console.error(t),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0,e.stopToken=void 0}})))}var st=r(18423);const{featurizeSA:lt,getClip:ct,getLength:dt,getLengthSansClipping:ut}=n.aF;var pt=r(57027),gt=r(7772),ht=r(90542),ft=r(41718),mt=r(97884),yt=r(93707);const bt=mt.A.extend((e=>{const t=Ce.observable.box(1);return{views:{get dynamicBlocks(){return(0,yt.A)(e,!1,!1)},get scaleFactor(){return t.get()},get maxBpPerPx(){return e.totalBp/(e.width-50)},get minBpPerPx(){return.02},get maxOffset(){return e.displayedRegionsTotalPx-.2*e.width},get minOffset(){return.8*-e.width}},actions:{setScaleFactor(e){t.set(e)},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(t-e.width/2)}}}})),wt=bt.extend((e=>({views:{get width(){return(0,v.getParent)(e).viewWidth}}}))),vt=bt.extend((e=>({views:{get width(){return(0,v.getParent)(e).viewHeight}}})));var St=r(90257);const Ct=(0,l.lazy)((()=>r.e(8859).then(r.bind(r,78859)))),xt=(0,l.lazy)((()=>r.e(7686).then(r.bind(r,87686))));function kt(e){return(0,d.measureText)(e.slice(0,30))}function Tt(e,t,r){return(0,d.max)([...e.filter((e=>!r.has(e.key))).map((e=>kt(e.refName))),...e.filter((e=>!r.has(e.key))).map((e=>kt((0,d.getTickDisplayStr)(e.end,t))))])}class At extends pt.A{supportsSVG=!0;async renameRegionsIfNeeded(e){const t=this.pluginManager,r=t.rootModel?.session?.assemblyManager,{view:n,sessionId:a,adapterConfig:i}=e;async function o(e){if(!r)throw new Error("No assembly manager provided");return(await(0,d.renameRegionsIfNeeded)(r,{sessionId:a,adapterConfig:i,regions:e})).regions}return n.hview.displayedRegions=await o(n.hview.displayedRegions),n.vview.displayedRegions=await o(n.vview.displayedRegions),e}async render(e){const{width:t,height:n,view:{hview:a,vview:i}}=e,o=[t,n],s=[a,i].map(((e,t)=>{const r=bt.create(e);return r.setVolatileWidth(o[t]),r})),l=s[0],c=await this.getFeatures({...e,regions:l.dynamicBlocks.contentBlocks});l.setFeatures(c);const{drawDotplot:u}=await r.e(1752).then(r.bind(r,31752)),p=await(0,d.renderToAbstractCanvas)(t,n,e,(t=>u(t,{...e,views:s})));return{...await super.render({...e,...p,height:n,width:t}),...p,height:n,width:t,offsetX:s[0].dynamicBlocks.blocks[0]?.offsetPx||0,offsetY:s[1].dynamicBlocks.blocks[0]?.offsetPx||0,bpPerPxX:s[0].bpPerPx,bpPerPxY:s[1].bpPerPx}}}const Mt=(0,u.observer)((function(e){return(0,p.jsx)(W.PrerenderedCanvas,{...e})})),Pt=(0,c.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"blue"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:v.types.enumeration("colorBy",["identity","meanQueryIdentity","mappingQuality","strand","default"]),description:'Color by options:<br/>\n<ul>\n  <li>"identity" - the identity of the particular hit, similar to D-GENIES, use the other config slots \'thresholds\' and \'thresholdsPalette\' to define colors for this setting</li>\n  <li>"meanQueryIdentity" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>"mappingQuality" - uses mapping quality from PAF, some adapters don\'t have this setting</li>\n  <li>"strand" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>"default" - uses the \'color\' config slot</li>\n</ul>',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0});var Rt=r(63589);function Lt(e,t,r){try{e.showTrack(t)}catch(e){if(!/Could not resolve identifier/.exec(`${e}`))throw e;r.push(t)}}class It extends a.A{name="DotplotPlugin";install(e){var t;!function(e){e.addViewType((()=>{return new Rt.A({name:"DotplotView",displayName:"Dotplot view",stateModel:(t=e,v.types.compose("DotplotView",gt.A,v.types.model({id:me.ElementId,type:v.types.literal("DotplotView"),height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:v.types.array(v.types.string),drawCigar:!0,hview:v.types.optional(wt,{}),vview:v.types.optional(vt,{}),tracks:v.types.array(t.pluggableMstType("track","stateModel")),viewTrackConfigs:v.types.array(t.pluggableConfigSchemaType("track"))})).volatile((()=>({volatileWidth:void 0,volatileError:void 0,cursorMode:(0,d.localStorageGetItem)("dotplot-cursorMode")||"crosshair",showPanButtons:(0,d.localStorageGetBoolean)("dotplot-showPanbuttons",!0),wheelMode:(0,d.localStorageGetItem)("dotplot-wheelMode")||"zoom",borderX:100,borderY:100,importFormSyntenyTrackSelections:Ce.observable.array()}))).actions((e=>({importFormRemoveRow(t){e.importFormSyntenyTrackSelections.splice(t,1)},clearImportFormSyntenyTracks(){e.importFormSyntenyTrackSelections.clear()},setImportFormSyntenyTrack(t,r){e.importFormSyntenyTrackSelections[t]=r}}))).views((e=>({get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}))).views((e=>({get assemblyErrors(){const{assemblyManager:t}=(0,d.getSession)(e);return e.assemblyNames.map((e=>t.get(e)?.error)).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,d.getSession)(e);return e.assemblyNames.every((e=>t.get(e)?.initialized??!0))}}))).views((e=>({get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){const{hview:t}=e,{dynamicBlocks:r,staticBlocks:n,bpPerPx:a}=t;return r.contentBlocks.length>5?[]:(0,St.H2)(n.contentBlocks,a)},get vticks(){const{vview:t}=e,{dynamicBlocks:r,staticBlocks:n,bpPerPx:a}=t;return r.contentBlocks.length>5?[]:(0,St.H2)(n.contentBlocks,a)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps(){const t=(0,d.getSession)(e);return{...(0,he.getParentRenderProps)(e),drawCigar:e.drawCigar,highResolutionScaling:(0,c.getConf)(t,"highResolutionScaling")}}}))).actions((e=>({setShowPanButtons(t){e.showPanButtons=t},setWheelMode(t){e.wheelMode=t},setCursorMode(t){e.cursorMode=t},setDrawCigar(t){e.drawCigar=t},clearView(){e.hview.setDisplayedRegions([]),e.vview.setDisplayedRegions([]),e.assemblyNames=(0,v.cast)([]),e.tracks.clear()},setBorderX(t){e.borderX=t},setBorderY(t){e.borderY=t},setWidth:t=>(e.volatileWidth=t,e.volatileWidth),setHeight:t=>(e.height=t,e.height),setError(t){e.volatileError=t},zoomOut(){e.hview.zoomOut(),e.vview.zoomOut()},zoomIn(){e.hview.zoomIn(),e.vview.zoomIn()},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(t)){const r=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(r),r}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},showTrack(r,n={}){const a=t.pluggableConfigSchemaType("track"),i=(0,v.resolveIdentifier)(a,(0,v.getRoot)(e),r),o=t.getTrackType(i.type);if(!o)throw new Error(`unknown track type ${i.type}`);const s=t.getViewType(e.type),l=i.displays.find((e=>s.displayTypes.find((t=>t.name===e.type))));if(!l)throw new Error(`could not find a compatible display for view type ${e.type}`);const c=o.stateModel.create({...n,type:i.type,configuration:i,displays:[{type:l.type,configuration:l}]});e.tracks.push(c)},hideTrack(r){const n=t.pluggableConfigSchemaType("track"),a=(0,v.resolveIdentifier)(n,(0,v.getRoot)(e),r),i=e.tracks.filter((e=>e.configuration===a));return(0,Ce.transaction)((()=>{for(const t of i)e.tracks.remove(t)})),i.length},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setAssemblyNames(t,r){e.assemblyNames=(0,v.cast)([t,r])},setViews(t){e.hview=(0,v.cast)(t[0]),e.vview=(0,v.cast)(t[1])},getCoords(t,r){const[n,a]=(0,d.minmax)(r[0],t[0]),[i,o]=(0,d.minmax)(r[1],t[1]);return Math.abs(a-n)>3&&Math.abs(o-i)>3?[e.hview.pxToBp(n),e.hview.pxToBp(a),e.vview.pxToBp(e.viewHeight-i),e.vview.pxToBp(e.viewHeight-o)]:void 0},zoomInToMouseCoords(t,r){const n=this.getCoords(t,r);if(n){const[t,r,a,i]=n;e.hview.moveTo(t,r),e.vview.moveTo(i,a)}},showAllRegions(){e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx),e.vview.center(),e.hview.center()},onDotplotView(t,r){const n=this.getCoords(t,r);if(n){const[t,r,a,i]=n,o=(0,d.getSession)(e),s=bt.create({...(0,v.getSnapshot)(e.hview),minimumBlockWidth:0,interRegionPaddingWidth:0}),l=bt.create({...(0,v.getSnapshot)(e.vview),minimumBlockWidth:0,interRegionPaddingWidth:0});s.setVolatileWidth(e.hview.width),l.setVolatileWidth(e.vview.width),s.moveTo(t,r),l.moveTo(i,a),s.zoomTo(s.bpPerPx/(e.width/e.hview.width),0),l.zoomTo(l.bpPerPx/(e.width/e.vview.width),0);const c=e.tracks.map((e=>e.configuration.displays.find((e=>"LinearSyntenyDisplay"===e.type)))).filter((e=>!!e)).map((e=>{const t=(0,v.getParent)(e,2);return{type:t.type,configuration:t,displays:[{type:e.type,configuration:e}]}})),{id:u,...p}=(0,v.getSnapshot)(s),{id:g,...h}=(0,v.getSnapshot)(l),f={type:"LinearSyntenyView",views:[{type:"LinearGenomeView",tracks:[],hideHeader:!0,...p},{type:"LinearGenomeView",tracks:[],hideHeader:!0,...h}],tracks:c};o.addView("LinearSyntenyView",f)}}}))).actions((e=>({async exportSvg(t={}){const{renderToSvg:n}=await r.e(1266).then(r.bind(r,11266)),a=await n(e,t),i=new Blob([a],{type:"image/svg+xml"});(0,Se.saveAs)(i,t.filename||"image.svg")},beforeDestroy(){const t=(0,d.getSession)(e);for(const r of e.assemblyNames)t.removeTemporaryAssembly?.(r)},afterAttach(){(0,v.addDisposer)(e,(0,Ce.autorun)((()=>{const{showPanButtons:t,wheelMode:r,cursorMode:n}=e;var a;"undefined"!=typeof localStorage&&(localStorage.setItem("dotplot-showPanbuttons",(a=t,JSON.stringify(a))),localStorage.setItem("dotplot-cursorMode",n),localStorage.setItem("dotplot-wheelMode",r))}))),(0,v.addDisposer)(e,(0,Ce.autorun)((()=>{const t=(0,d.getSession)(e);if(void 0===e.volatileWidth||!e.assembliesInitialized)return;if(e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0)return;const r=[e.hview,e.vview];(0,Ce.transaction)((()=>{for(const[n,a]of e.assemblyNames.entries()){const e=t.assemblyManager.get(a);r[n].setDisplayedRegions(e?.regions||[])}e.showAllRegions()}))}),{delay:1e3})),(0,v.addDisposer)(e,(0,Ce.autorun)((function(){if(void 0===e.volatileWidth)return;const{vview:t,hview:r,viewHeight:n,viewWidth:a}=e,i=t.dynamicBlocks.contentBlocks,o=r.dynamicBlocks.contentBlocks,s=r.offsetPx,l=t.offsetPx,c=(0,St.rQ)(i,n,l),d=(0,St.rQ)(o,a,s),u=Tt(o,t.bpPerPx,d),p=Tt(i,r.bpPerPx,c);e.setBorderY(Math.max(u+40,50)),e.setBorderX(Math.max(p+40,50))})))},squareView(){const{hview:t,vview:r}=e,n=(t.bpPerPx+r.bpPerPx)/2,a=t.pxToBp(t.width/2),i=r.pxToBp(r.width/2);t.setBpPerPx(n),t.centerAt(a.coord,a.refName,a.index),r.setBpPerPx(n),r.centerAt(i.coord,i.refName,i.index)},squareViewProportional(){const{hview:t,vview:r}=e,n=t.width/r.width,a=(t.bpPerPx+r.bpPerPx)/2,i=t.pxToBp(t.width/2),o=r.pxToBp(r.width/2);t.setBpPerPx(a/n),t.centerAt(i.coord,i.refName,i.index),r.setBpPerPx(a),r.centerAt(o.coord,o.refName,o.index)}}))).views((e=>({menuItems(){const t=(0,d.getSession)(e);return[{label:"Return to import form",icon:ft.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[xt,{model:e,handleClose:t}]))}},{label:"Export SVG",icon:ve.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Ct,{model:e,handleClose:t}]))}},...(0,d.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:ht.xU}]:[]]},get error(){return e.volatileError||e.assemblyErrors}})))),ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(2826),r.e(8560),r.e(8072)]).then(r.bind(r,18072))))});var t}))}(e),(t=e).addDisplayType((()=>{const e=function(e){return(0,c.ConfigurationSchema)("DotplotDisplay",{renderer:v.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(t);return new Je.A({name:"DotplotDisplay",displayName:"Dotplot display",configSchema:e,stateModel:ot(e),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:Ye})})),function(e){e.addRendererType((()=>new At({name:"DotplotRenderer",configSchema:Pt,ReactComponent:Mt,pluginManager:e})))}(e),function(e){e.addToExtensionPoint("LaunchView-DotplotView",(async({session:e,views:t,tracks:r=[]})=>{try{const n=e.addView("DotplotView",{}),a=t.map((e=>e.assembly));(0,Ce.transaction)((()=>{n.setViews([{bpPerPx:.1,offsetPx:0},{bpPerPx:.1,offsetPx:0}]),n.setAssemblyNames(a[0],a[1])}));const i=[];for(const e of r)Lt(n,e,i);if(i.length)throw new Error(`Could not resolve identifiers: ${i.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}}))}(e),function(e){e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearPileupDisplay"===e.name){const{stateModel:t}=e,r=t.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const r=e.contextMenuFeature;return[...t(),...r?[{label:"Dotplot of read vs ref",icon:st.A,onClick:()=>{!function(e,t){const r=(0,d.getSession)(t);try{const n=e.get("CIGAR"),a=ct(n,1),i=e.get("flags"),o=e.get("strand"),s=e.get("name"),l=`${s}_assembly_${Date.now()}`,{parentTrack:u}=t,[p]=(0,c.getConf)(u,"assemblyNames"),g=[p,l],h=`track-${Date.now()}`,f=`${s}_vs_${p}`,m=e.get("tags")?.SA,y=lt(m,e.id(),o,s,!0),b=dt(2048&i?y[0].CIGAR:n),w=[{...e.toJSON(),strand:1,mate:{refName:s,start:a,end:a+ut(n)}},...y].sort(((e,t)=>e.clipPos-t.clipPos));r.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:(0,d.sum)(w.map((e=>e.end-e.start)))/800,displayedRegions:(0,d.gatherOverlaps)(w.map(((e,t)=>{const{start:r,end:n,refName:a}=e;return{start:r,end:n,refName:a,index:t,assemblyName:p}})))},vview:{offsetPx:0,bpPerPx:b/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:l,start:0,end:b,refName:s}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:g,adapter:{type:"FromConfigAdapter",features:w},trackId:h,name:f}],assemblyNames:g,tracks:[{configuration:h,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:`${h}-DotplotDisplay`}]}],displayName:`${s} vs ${p}`})}catch(e){console.error(e),r.notifyError(`${e}`,e)}}(r,e)}}]:[]]}}}}));e.stateModel=r}return e}))}(e),e.addRpcMethod((()=>new _e(e)))}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:$e.A,onClick:e=>{e.addView("DotplotView",{})}})}}var Ft=r(58273);var Nt=r(11210);const Dt=(0,l.lazy)((()=>r.e(3384).then(r.bind(r,93384))));function Bt(e,t){return v.types.compose("SharedGCContentModel",(0,Nt._i)(e,t),v.types.model({windowSize:v.types.maybe(v.types.number),windowDelta:v.types.maybe(v.types.number)})).actions((e=>({setGCContentParams({windowSize:t,windowDelta:r}){e.windowSize=t,e.windowDelta=r}}))).views((e=>({get windowSizeSetting(){return e.windowSize??(0,c.getConf)(e,"windowSize")},get windowDeltaSetting(){return e.windowDelta??(0,c.getConf)(e,"windowDelta")}}))).views((e=>{const{trackMenuItems:t,adapterProps:r}=e;return{trackMenuItems:()=>[...t(),{label:"Change GC parameters",onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Dt,{model:e,handleClose:t}]))}}],adapterProps(){const t=(0,c.getConf)(e.parentTrack,"adapter");return{...r(),adapterConfig:{type:"GCContentAdapter",sequenceAdapter:t,windowSize:e.windowSizeSetting,windowDelta:e.windowDeltaSetting}}}}}))}class Vt extends a.A{name="GCContentPlugin";install(e){var t;!function(e){e.addAdapterType((()=>new se.A({name:"GCContentAdapter",displayName:"GC content adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:(0,c.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:{type:"frozen",defaultValue:null},windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{explicitlyTyped:!0}),getAdapterClass:()=>r.e(9756).then(r.bind(r,49756)).then((e=>e.default))})))}(e),(t=e).addTrackType((()=>{const e=(e=>(0,c.ConfigurationSchema)("GCContentTrack",{},{baseConfiguration:(0,C.createBaseTrackConfig)(e)}))(t);return new Ft.A({name:"GCContentTrack",displayName:"GCContent track",configSchema:e,stateModel:(0,P.createBaseTrackModel)(t,"GCContentTrack",e)})})),function(e){e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearGCContentDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),r=function(e,t){return v.types.compose("LinearGCContentDisplay",Bt(e,t),v.types.model({type:v.types.literal("LinearGCContentDisplay")}))}(e,t);return new C.DisplayType({name:"LinearGCContentDisplay",configSchema:t,stateModel:r,displayName:"GC content display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:Nt.r})})),e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearGCContentTrackDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),r=function(e,t){return v.types.compose("LinearGCContentTrackDisplay",Bt(e,t),v.types.model({type:v.types.literal("LinearGCContentTrackDisplay")}))}(e,t);return new C.DisplayType({name:"LinearGCContentTrackDisplay",configSchema:t,stateModel:r,displayName:"GC content display",trackType:"GCContentTrack",viewType:"LinearGenomeView",ReactComponent:Nt.r})}))}(e)}}const jt=(0,c.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gffLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),Et=(0,c.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:v.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region","contig"]}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gffGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});class zt extends a.A{name="GFF3Plugin";install(e){!function(e){e.addAdapterType((()=>new C.AdapterType({name:"Gff3TabixAdapter",displayName:"GFF3 tabix adapter",configSchema:Et,getAdapterClass:()=>Promise.all([r.e(3085),r.e(2645),r.e(7409)]).then(r.bind(r,27409)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new C.AdapterType({name:"Gff3Adapter",displayName:"GFF3 adapter",configSchema:jt,getAdapterClass:()=>Promise.all([r.e(2598),r.e(2645),r.e(7809)]).then(r.bind(r,37809)).then((e=>e.default))})))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,he.getFileName)(t),i=r&&(0,he.getFileName)(r);return(0,d.testAdapter)(a,/\.gff3?\.b?gz$/i,n,"Gff3TabixAdapter")?{type:"Gff3TabixAdapter",bamLocation:t,gffGzLocation:t,index:{location:r||(0,he.makeIndex)(t,".tbi"),indexType:(0,he.makeIndexType)(i,"CSI","TBI")}}:(0,d.testAdapter)(a,/\.gff3?$/i,n,"Gff3Adapter")?{type:"Gff3Adapter",gffLocation:t}:e(t,r,n)}))}(e)}}var Ot=r(21230),Ht=r(30501),Gt=r(9152),Wt=r(41562),$t=r(23758),Ut=r(87485),qt=r(37962);const _t=(0,Qe.n9)()({bookmarkButton:{overflow:"hidden",position:"absolute",zIndex:800},highlight:{overflow:"hidden",height:"100%",position:"absolute"}}),Jt=(0,u.observer)((function({model:e}){const{classes:t}=_t(),r=(0,d.getSession)(e),{assemblyManager:n}=r,{bookmarkHighlightsVisible:a,bookmarkLabelsVisible:i}=e,o=r.widgets.get("GridBookmark");(0,l.useEffect)((()=>{o||r.addWidget("GridBookmarkWidget","GridBookmark")}),[r,o]);const s=new Set(e.assemblyNames);return a&&o?.bookmarks?o.bookmarks.filter((e=>s.has(e.assemblyName))).map((t=>{const r=n.get(t.assemblyName),a=r?.getCanonicalRefName(t.refName)??t.refName,i=e.bpToPx({refName:a,coord:t.start}),o=e.bpToPx({refName:a,coord:t.end});return i&&o?{width:Math.max(Math.abs(o.offsetPx-i.offsetPx),3),left:Math.min(i.offsetPx,o.offsetPx)-e.offsetPx,highlight:t.highlight,label:t.label,bookmark:t}:void 0})).filter(d.notEmpty).map((({left:e,width:n,highlight:a,label:s,bookmark:c},d)=>(0,p.jsxs)(l.Fragment,{children:[(0,p.jsx)("div",{className:t.highlight,id:"highlight",style:{left:e,width:n,background:a}}),i&&n>20?(0,p.jsx)("div",{className:t.bookmarkButton,style:{left:e},children:(0,p.jsx)($t.A,{menuItems:[{label:"Open bookmark widget",onClick:()=>{r.showWidget(o)}},{label:"Turn off highlights",onClick:()=>{o.setBookmarkHighlightsVisible(!1)}},{label:"Remove bookmark",onClick:()=>{o.removeBookmarkObject(c)}}],children:(0,p.jsx)(qt.A,{title:s,arrow:!0,children:(0,p.jsx)(Ot.A,{fontSize:"small",sx:{color:0!==(0,Ut.M)(a).alpha()?(0,Ut.M)(a).alpha(.8).toRgbString():(0,Ut.M)(a).alpha(0).toRgbString()}})})})}):null]},`${e}_${n}_${d}`))):null})),Xt=Jt,Yt=(0,Qe.n9)()({highlight:{height:"100%",position:"absolute"}}),Kt=(0,u.observer)((function({model:e,overview:t}){const{cytobandOffset:r}=e,n=(0,d.getSession)(e),{classes:a}=Yt(),{assemblyManager:i}=n,{bookmarkHighlightsVisible:o,bookmarkLabelsVisible:s}=e,c=n.widgets.get("GridBookmark");(0,l.useEffect)((()=>{c||n.addWidget("GridBookmarkWidget","GridBookmark")}),[n,c]);const u=new Set(e.assemblyNames);return o&&c?.bookmarks?c.bookmarks.filter((e=>u.has(e.assemblyName))).map((e=>{const n=i.get(e.assemblyName),a=n?.getCanonicalRefName(e.refName)??e.refName,o=e.reversed,s=t.bpToPx({refName:a,coord:o?e.end:e.start}),l=t.bpToPx({refName:a,coord:o?e.start:e.end});return void 0!==s&&void 0!==l?{width:Math.abs(l-s),left:s+r,highlight:e.highlight,label:e.label}:void 0})).filter(d.notEmpty).map(((e,t)=>{const{left:r,width:n,highlight:i,label:o}=e;return(0,p.jsx)(qt.A,{title:s?o:"",arrow:!0,children:(0,p.jsx)("div",{className:a.highlight,style:{left:r,width:n,background:i,borderLeft:`1px solid ${i}`,borderRight:`1px solid ${i}`}})},`${JSON.stringify(e)}-${t}`)})):null})),Qt=Kt,Zt=v.types.compose(me.Region,v.types.model("Label",{label:v.types.optional(v.types.string,""),highlight:v.types.optional(v.types.string,"rgba(247, 129, 192, 0.35)")})).actions((e=>({setLabel(t){e.label=t},setHighlight(t){e.highlight=t}}))),er=v.types.model("SharedBookmarksModel",{sharedBookmarks:v.types.maybe(v.types.array(Zt))}),tr=()=>"undefined"!=typeof window?`bookmarks-${[window.location.host+window.location.pathname].join("-")}`:"empty",rr=(0,c.ConfigurationSchema)("GridBookmarkWidget",{});class nr extends a.A{name="GridBookmarkPlugin";install(e){(function(e){e.addWidgetType((()=>new C.WidgetType({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:rr,stateModel:v.types.model("GridBookmarkModel",{id:me.ElementId,type:v.types.literal("GridBookmarkWidget"),bookmarks:v.types.optional(v.types.array(Zt),(()=>JSON.parse((0,d.localStorageGetItem)(tr())||"[]")))}).volatile((()=>({selectedBookmarks:[],selectedAssembliesPre:void 0}))).views((e=>({get bookmarkAssemblies(){return[...new Set(e.bookmarks.map((e=>e.assemblyName)))]},get validAssemblies(){const{assemblyManager:t}=(0,d.getSession)(e);return new Set(this.bookmarkAssemblies.filter((e=>t.get(e))))},get areBookmarksHighlightedOnAllOpenViews(){const{views:t}=(0,d.getSession)(e);return t.every((e=>!("bookmarkHighlightsVisible"in e)||e.bookmarkHighlightsVisible))},get areBookmarksHighlightLabelsOnAllOpenViews(){const{views:t}=(0,d.getSession)(e);return t.every((e=>!("bookmarkLabelsVisible"in e)||e.bookmarkLabelsVisible))}}))).views((e=>({get bookmarksWithValidAssemblies(){return e.bookmarks.filter((t=>e.validAssemblies.has(t.assemblyName)))}}))).views((e=>({get sharedBookmarksModel(){return er.create({sharedBookmarks:JSON.parse(JSON.stringify(e.selectedBookmarks))})},get allBookmarksModel(){return er.create({sharedBookmarks:JSON.parse(JSON.stringify(e.bookmarksWithValidAssemblies))})}}))).actions((e=>({setSelectedAssemblies(t){e.selectedAssembliesPre=t}}))).views((e=>({get selectedAssemblies(){return e.selectedAssembliesPre?.filter((t=>e.validAssemblies.has(t)))??[...e.validAssemblies]}}))).actions((e=>({importBookmarks(t){e.bookmarks=(0,v.cast)([...e.bookmarks,...t])},addBookmark(t){e.bookmarks.push(t)},removeBookmark(t){e.bookmarks.splice(t,1)},updateBookmarkLabel(e,t){e.correspondingObj.setLabel(t)},updateBookmarkHighlight(e,t){e.correspondingObj.setHighlight(t)},updateBulkBookmarkHighlights(t){for(const r of e.selectedBookmarks)this.updateBookmarkHighlight(r,t)},setSelectedBookmarks(t){e.selectedBookmarks=t},setBookmarkedRegions(t){e.bookmarks=(0,v.cast)(t)},setBookmarkHighlightsVisible(t){const{views:r}=(0,d.getSession)(e);for(const e of r)e.setBookmarkHighlightsVisible?.(t),e.views?.map((e=>{e.setBookmarkHighlightsVisible?.(t)}))},setBookmarkLabelsVisible(t){const{views:r}=(0,d.getSession)(e);for(const e of r)e.setBookmarkLabelsVisible?.(t),e.views?.map((e=>{e.setBookmarkHighlightsVisible?.(t)}))}}))).actions((e=>({clearAllBookmarks(){e.setBookmarkedRegions(e.bookmarks.filter((t=>!e.validAssemblies.has(t.assemblyName))))},clearSelectedBookmarks(){for(const t of e.selectedBookmarks)e.bookmarks.remove(t.correspondingObj);e.selectedBookmarks=[]},removeBookmarkObject(t){e.bookmarks.remove(t)}}))).actions((e=>({afterAttach(){const t=tr();function r(r){if(r.key===t){const r=JSON.parse((0,d.localStorageGetItem)(t)||"[]");e.setBookmarkedRegions(r)}}window.addEventListener("storage",r),(0,v.addDisposer)(e,(()=>{window.removeEventListener("storage",r)})),(0,v.addDisposer)(e,(0,Ce.autorun)((()=>{(0,d.localStorageSetItem)(t,JSON.stringify(e.bookmarks))})))}}))).postProcessSnapshot((e=>{const{bookmarks:t,...r}=e;return r})),ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(7343),r.e(6395),r.e(3199)]).then(r.bind(r,53199))))}))),function(e){e.addToExtensionPoint("LinearGenomeView-TracksContainerComponent",((e,{model:t})=>[...e||[],(0,p.jsx)(Xt,{model:t},"highlight_grid_bookmark")])),e.addToExtensionPoint("LinearGenomeView-OverviewScalebarComponent",((e,{model:t,overview:r})=>[...e||[],(0,p.jsx)(Qt,{model:t,overview:r},"overview_highlight_grid_bookmark")]))}(e)})(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,r=t.props({bookmarkHighlightsVisible:!0,bookmarkLabelsVisible:!0}).actions((e=>({setBookmarkHighlightsVisible(t){e.bookmarkHighlightsVisible=t},setBookmarkLabelsVisible(t){e.bookmarkLabelsVisible=t},activateBookmarkWidget(){const t=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(t)){let e=t.widgets.get("GridBookmark");return e||(e=t.addWidget("GridBookmarkWidget","GridBookmark")),t.showWidget(e),t.widgets.get("GridBookmark")}throw new Error("Could not open bookmark widget")}}))).actions((e=>({navigateNewestBookmark(){const t=(0,d.getSession)(e),r=e.activateBookmarkWidget();r.bookmarks.length?e.navTo(r.bookmarks.at(-1)):t.notify("There are no recent bookmarks to navigate to.","info")},bookmarkCurrentRegion(){if(e.id===(0,d.getSession)(e).focusedViewId){const t=e.getSelectedRegions(void 0,void 0),r=e.activateBookmarkWidget();if(!t.length)throw new Error("no region selected");r.addBookmark(t[0])}}}))).views((e=>{const t=e.menuItems,r=e.rubberBandMenuItems;return{menuItems:()=>[...t(),{type:"divider"},{label:"Bookmarks",icon:Ht.A,subMenu:[{label:"Open bookmark widget",icon:Ht.A,onClick:()=>e.activateBookmarkWidget()},{label:"Bookmark current region",icon:Ot.A,onClick:()=>{e.bookmarkCurrentRegion()}},{label:"Toggle bookmark highlights",icon:Gt.A,type:"checkbox",checked:e.bookmarkHighlightsVisible,onClick:()=>{e.setBookmarkHighlightsVisible(!e.bookmarkHighlightsVisible)}},{label:"Toggle bookmark labels",icon:Wt.A,type:"checkbox",checked:e.bookmarkLabelsVisible,onClick:()=>{e.setBookmarkLabelsVisible(!e.bookmarkLabelsVisible)}}]}],rubberBandMenuItems:()=>[...r(),{label:"Bookmark region",icon:Ot.A,onClick:()=>{const{leftOffset:t,rightOffset:r}=e,n=e.getSelectedRegions(t,r),a=e.activateBookmarkWidget();if(!n.length)throw new Error("no regions selected");a.addBookmark(n[0])}}]}})).actions((e=>({afterCreate(){document.addEventListener("keydown",(t=>{const r=(t.ctrlKey||t.metaKey)&&t.shiftKey;r&&"KeyD"===t.code&&(t.preventDefault(),e.activateBookmarkWidget(),e.bookmarkCurrentRegion(),(0,d.getSession)(e).notify("Bookmark created.","success")),r&&"KeyM"===t.code&&(t.preventDefault(),e.navigateNewestBookmark())}))}})));e.stateModel=r}return e}))}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Bookmarks",icon:Ht.A,onClick:e=>{let t=e.widgets.get("GridBookmark");t||(t=e.addWidget("GridBookmarkWidget","GridBookmark")),e.showWidget(t)}})}}const ar=(0,c.ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",description:"path to gtf file, also allows for gzipped gtf",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}},aggregateField:{type:"string",description:"field used to aggregate multiple transcripts into a single parent gene feature",defaultValue:"gene_name"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,gtfLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class ir extends a.A{name="GTFPlugin";install(e){!function(e){e.addAdapterType((()=>new C.AdapterType({name:"GtfAdapter",displayName:"GTF adapter",configSchema:ar,getAdapterClass:()=>Promise.all([r.e(2598),r.e(1503)]).then(r.bind(r,61503)).then((e=>e.default))})))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,he.getFileName)(t);return(0,d.testAdapter)(a,/\.gtf(\.gz)?$/i,n,"GtfAdapter")?{type:"GtfAdapter",gtfLocation:t}:e(t,r,n)}))}(e)}}const or=(0,c.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}},resolutionMultiplier:{type:"number",defaultValue:1,description:"Initial resolution multiplier"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,hicLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var sr=r(3496),lr=r(198),cr=r(98506),dr=r(44728),ur=r(82088);class pr extends lr.default{supportsSVG=!0;async render(e){const{displayHeight:t,regions:n,bpPerPx:a}=e,i=n[0],o=(i.end-i.start)/a,s=o/2,l=t??s,c=await this.getFeatures(e),{makeImageData:d}=await r.e(9088).then(r.bind(r,49088)),u=await(0,cr.u1)(o,l,e,(t=>d(t,{...e,yScalar:l/Math.max(l,s),features:c,pluginManager:this.pluginManager})));return{...await super.render({...e,...u,features:c,region:e.regions[0],height:l,width:o}),...u,height:l,width:o}}async getFeatures(e){const{regions:t,sessionId:r,adapterConfig:n}=e,{dataAdapter:a}=await(0,sr.cK)(this.pluginManager,r,n);return await(0,dr._)(a.getFeatures(t[0],e).pipe((0,ur.$)()))}}const gr=(0,u.observer)((function(e){const{width:t,height:r}=e,n=Math.ceil(t);return(0,p.jsx)("div",{style:{position:"relative",width:n,height:r},children:(0,p.jsx)(W.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:0}})})})),hr=(0,c.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:interpolate(count,scale)",contextVariable:["count","maxScore","baseColor","scale"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0});function fr(e){return v.types.compose("LinearHicDisplay",x.Lr,v.types.model({type:v.types.literal("LinearHicDisplay"),configuration:(0,c.ConfigurationReference)(e),resolution:v.types.optional(v.types.number,1),useLogScale:!1,colorScheme:v.types.maybe(v.types.string),activeNormalization:"KR",mode:"triangular"})).volatile((()=>({availableNormalizations:void 0}))).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps(){const r=e.rendererType.configSchema.create({...(0,c.getConf)(e,"renderer"),...e.colorScheme?{color:"jexl:interpolate(count,scale)"}:{}},(0,v.getEnv)(e));return{...t(),config:r,displayHeight:"adjust"===e.mode?e.height:void 0,normalization:e.activeNormalization,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution,useLogScale:e.useLogScale,colorScheme:e.colorScheme}}}})).actions((e=>({setResolution(t){e.resolution=t},setUseLogScale(t){e.useLogScale=t},setColorScheme(t){e.colorScheme=t},setActiveNormalization(t){e.activeNormalization=t},setAvailableNormalizations(t){e.availableNormalizations=t},setMode(t){e.mode=t}}))).views((e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Use log scale",type:"checkbox",checked:e.useLogScale,onClick:()=>{e.setUseLogScale(!e.useLogScale)}},{label:"Rendering mode",type:"subMenu",subMenu:[{label:"Triangular",type:"radio",checked:"triangular"===e.mode,onClick:()=>{e.setMode("triangular")}},{label:"Adjust to height of display",type:"radio",checked:"adjust"===e.mode,onClick:()=>{e.setMode("adjust")}}]},{label:"Color scheme",type:"subMenu",subMenu:[{label:"Fall",type:"radio",checked:"fall"===e.colorScheme,onClick:()=>{e.setColorScheme("fall")}},{label:"Viridis",type:"radio",checked:"viridis"===e.colorScheme,onClick:()=>{e.setColorScheme("viridis")}},{label:"Juicebox",type:"radio",checked:"juicebox"===e.colorScheme,onClick:()=>{e.setColorScheme("juicebox")}},{label:"Default",type:"radio",checked:void 0===e.colorScheme,onClick:()=>{e.setColorScheme(void 0)}}]},{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/2)}}]},...e.availableNormalizations?[{label:"Normalization scheme",subMenu:e.availableNormalizations.map((t=>({label:t,type:"radio",checked:t===e.activeNormalization,onClick:()=>{e.setActiveNormalization(t)}})))}]:[]]}})).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,Ce.autorun)((async()=>{try{const{rpcManager:t}=(0,d.getSession)(e),r=(0,d.getContainingTrack)(e),n=(0,c.getConf)(r,"adapter"),{norms:a}=await t.call((0,c.getConf)(r,"trackId"),"CoreGetInfo",{adapterConfig:n});a&&e.setAvailableNormalizations(a)}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}})))}})))}class mr extends a.A{name="HicPlugin";install(e){!function(e){e.addAdapterType((()=>new C.AdapterType({name:"HicAdapter",displayName:"Hi-C adapter",configSchema:or,getAdapterClass:()=>Promise.all([r.e(6514),r.e(5312)]).then(r.bind(r,75312)).then((e=>e.default))})))}(e),function(e){e.addRendererType((()=>new pr({name:"HicRenderer",ReactComponent:gr,configSchema:hr,pluginManager:e})))}(e),function(e){e.addTrackType((()=>{const t=(e=>(0,c.ConfigurationSchema)("HicTrack",{},{baseConfiguration:(0,C.createBaseTrackConfig)(e)}))(e);return new Ft.A({name:"HicTrack",displayName:"Hi-C track",configSchema:t,stateModel:(0,P.createBaseTrackModel)(e,"HicTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const t=(e=>(0,c.ConfigurationSchema)("LinearHicDisplay",{renderer:e.getRendererType("HicRenderer").configSchema},{baseConfiguration:x.Ki,explicitlyTyped:!0}))(e);return new C.DisplayType({name:"LinearHicDisplay",displayName:"Hi-C contact matrix display",configSchema:t,stateModel:fr(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:x.GQ})}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,he.getFileName)(t);return/\.hic$/i.test(a)&&!n||"HicAdapter"===n?{type:"HicAdapter",hicLocation:t}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"HicAdapter"===t?"HicTrack":e(t)))}(e)}configure(e){const{jexl:t}=e;t.addFunction("alpha",((e,t)=>e.alpha(t))),t.addFunction("hsl",(e=>(0,Ut.M)(e.toHsl()))),t.addFunction("colorString",(e=>e.toHex())),t.addFunction("interpolate",((e,t)=>t(e)))}}const yr=v.types.model("Job",{name:v.types.string,statusMessage:v.types.maybe(v.types.string),progressPct:v.types.number}).volatile((()=>({cancelCallback(){}}))).actions((e=>({setCancelCallback(t){e.cancelCallback=t},setStatusMessage(t){e.statusMessage=t},setProgressPct(t){e.progressPct=t}}))),br=(0,c.ConfigurationSchema)("JobsListWidget",{});class wr extends a.A{name="JobsManagementPlugin";install(e){!function(e){e.addWidgetType((()=>new C.WidgetType({name:"JobsListWidget",heading:"Jobs list",configSchema:br,stateModel:v.types.model("JobsListModel",{id:me.ElementId,type:v.types.literal("JobsListWidget"),jobs:v.types.array(yr),finished:v.types.array(yr),queued:v.types.array(yr),aborted:v.types.array(yr)}).actions((e=>({addJob(t){const{cancelCallback:r,name:n}=t,a=e.jobs.find((e=>e.name===n));if(a)return a;const i=e.jobs.push(t),o=e.jobs[i-1];return o.setCancelCallback(r),o},removeJob(t){const r=e.jobs.findIndex((e=>e.name===t));if(-1!==r)return e.jobs.splice(r,1)[0]},addFinishedJob(t){const r=e.finished.find((e=>e.name===t.name));if(r)return r;const n=e.finished.push(t);return e.finished[n-1]},addQueuedJob(t){const r=e.queued.find((e=>e.name===t.name));if(r)return r;const n=e.queued.push(t);return e.queued[n-1]},addAbortedJob(t){const r=e.aborted.find((e=>e.name===t.name));if(r)return r;const n=e.aborted.push(t);return e.aborted[n-1]},removeQueuedJob(t){const r=e.queued.findIndex((e=>e.name===t));if(-1!==r)return e.queued.splice(r,1)[0]},updateJobStatusMessage(t,r){const n=e.jobs.find((e=>e.name===t));if(!n)throw new Error(`No job found with name ${t}`);n.setStatusMessage(r)},updateJobProgressPct(t,r){const n=e.jobs.find((e=>e.name===t));if(!n)throw new Error(`No job found with name ${t}`);n.setProgressPct(r)}}))),ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(6386),r.e(9168)]).then(r.bind(r,29168))))})))}(e)}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Jobs list",icon:ht.jT,onClick:e=>{if((0,d.isSessionModelWithWidgets)(e)){const{widgets:t}=e;let r=t.get("JobsList");r||(r=e.addWidget("JobsListWidget","JobsList")),e.showWidget(r)}}})}}var vr=r(91612);const Sr=(0,c.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:P.baseConnectionConfig});function Cr(e){return v.types.compose("JBrowse1Connection",(0,P.BaseConnectionModelFactory)(e),v.types.model({configuration:(0,c.ConfigurationReference)(Sr),type:v.types.literal("JBrowse1Connection")})).actions((e=>({async connect(){const t=(0,d.getSession)(e);try{const n=(0,c.getConf)(e,"dataDirLocation"),{fetchJb1:a}=await r.e(7911).then(r.bind(r,77911)),{convertTrackConfig:i}=await r.e(5998).then(r.bind(r,55998)),o=await a(n),s=(0,c.getConf)(e,"assemblyNames")[0];if(!s)throw new Error("assembly name required for JBrowse 1 connection");const l=t.assemblies.find((e=>(0,c.readConfObject)(e,"name")===s));if(!l)throw new Error(`Assembly "${s}" not found`);const d=(0,c.readConfObject)(l,["sequence","adapter"]),u=o.tracks?.map((e=>({...i(e,o.dataRoot||"",d),assemblyNames:[s]})));e.setTrackConfs(u)}catch(r){console.error(r),t.notifyError(`There was a problem connecting to the JBrowse 1 data directory "${e.name}". Please make sure you have entered a valid location. The error that was thrown is: "${r}"`,r),t.breakConnection?.(e.configuration)}}})))}var xr=r(8024);const kr=(0,c.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),Tr=(0,c.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0});class Ar extends a.A{name="LegacyJBrowsePlugin";install(e){!function(e){e.addAdapterType((()=>new C.AdapterType({name:"NCListAdapter",displayName:"NCList adapter",configSchema:Tr,adapterMetadata:{category:"Uncommon"},getAdapterClass:()=>r.e(7645).then(r.bind(r,47645)).then((e=>e.default))})))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,he.getFileName)(t);return/trackData.jsonz?$/i.test(a)&&!n||"NCListAdapter"===n?{type:"NCListAdapter",rootUrlTemplate:t}:e(t,r,n)}))}(e),function(e){e.addTextSearchAdapterType((()=>new xr.A({name:"JBrowse1TextSearchAdapter",configSchema:kr,description:"A JBrowse 1 text search adapter",getAdapterClass:()=>Promise.all([r.e(7097),r.e(8797)]).then(r.bind(r,58797)).then((e=>e.default))})))}(e),function(e){e.addConnectionType((()=>new vr.A({name:"JBrowse1Connection",configSchema:Sr,stateModel:Cr(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})))}(e)}}var Mr=r(71331);const Pr=(0,l.lazy)((()=>r.e(3301).then(r.bind(r,33301))));const Rr=function(e){return(0,c.ConfigurationSchema)("LinearComparativeDisplay",{},{explicitlyTyped:!0,explicitIdentifier:"displayId"})};function Lr(e){const{rpcManager:t}=(0,d.getSession)(e),r=e;(0,c.readConfObject)(e.configuration);const{level:n,adapterConfig:a}=e,i=(0,d.getContainingView)(e),o=(0,he.getRpcSessionId)(e);return(0,v.getSnapshot)(i),i.initialized?{rpcManager:t,renderProps:{...r.renderProps(),level:n,view:i,adapterConfig:a,sessionId:o,timeout:1e6,self:e}}:void 0}async function Ir(e){if(!e)return;const{rpcManager:t,renderProps:r}=e,{adapterConfig:n,level:a}=r,i=r.view.views[a],o=await t.call("getFeats","CoreGetFeatures",{regions:i.staticBlocks.contentBlocks,sessionId:"getFeats",adapterConfig:n});return{features:(0,d.dedupe)(o,(e=>e.id()))}}const Fr=function(e){return v.types.compose("LinearComparativeDisplay",P.BaseDisplay,v.types.model({type:v.types.literal("LinearComparativeDisplay"),configuration:(0,c.ConfigurationReference)(e)})).volatile((()=>({renderInProgress:void 0,features:void 0,message:void 0}))).views((e=>({get level(){return(0,v.getParent)(e,4).level},get height(){return(0,v.getParent)(e,4).height},renderProps:()=>({rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2})}))).actions((e=>{let t;return{setLoading(r){e.message=void 0,e.error=void 0,t=r},setMessage(r){e.message=r,e.error=void 0,t=void 0},setRendered(r){if(!r)return;const{features:n}=r,a=e.features||[],i=new Set(a.map((e=>e.id()))),o=new Set(n.map((e=>e.id())));let s=!1,l=!1;for(const e of n)if(!i.has(e.id())){s=!0;break}for(const e of a)if(!o.has(e.id())){l=!0;break}e.message=void 0,e.error=void 0,t=void 0,(s||l||!e.features)&&(e.features=n)},setError(r){console.error(r),void 0!==t&&(0,qe.CF)(t),e.message=void 0,e.error=r,t=void 0}}})).actions((e=>({afterAttach(){(0,d.makeAbortableReaction)(e,Lr,Ir,{name:`${e.type} ${e.id} rendering`,delay:1e3,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)}})))},Nr=(0,l.lazy)((()=>r.e(7686).then(r.bind(r,87686)))),Dr=function(e){const t=e.getViewType("LinearSyntenyViewHelper")?.stateModel;return v.types.compose("LinearComparativeView",gt.A,v.types.model({id:me.ElementId,type:v.types.literal("LinearComparativeView"),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactiveOverlay:!1,levels:v.types.array(t),views:v.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:v.types.array(e.pluggableConfigSchemaType("track"))})).volatile((()=>({width:void 0}))).views((e=>({get initialized(){return void 0!==e.width&&e.views.length>0&&e.views.every((e=>e.initialized))},get refNames(){return e.views.map((e=>[...new Set(e.staticBlocks.map((e=>e.refName)))]))},get assemblyNames(){return[...new Set(e.views.flatMap((e=>e.assemblyNames)))]}}))).actions((e=>({afterAttach(){const t=new Set(["horizontalScroll","zoomTo","setScaleFactor"]);(0,v.addDisposer)(e,(0,v.onAction)(e,(r=>{if(e.linkViews){const{name:e,path:n,args:a}=r;t.has(e)&&n&&this.onSubviewAction(e,n,a)}})))},beforeDestroy(){const t=(0,d.getSession)(e);for(const r of e.assemblyNames)t.removeTemporaryAssembly?.(r)},onSubviewAction(t,r,n){for(const a of e.views)(0,v.getPath)(a).endsWith(r)||a[t](n?.[0])},setWidth(t){e.width=t},setViews(t){e.views=(0,v.cast)(t);const r=[];for(let e=0;e<t.length-1;e++)r.push({level:e});e.levels=(0,v.cast)(r)},removeView(t){e.views.remove(t)},setLevelHeight(t,r=0){const n=e.levels[r];return n.setHeight(t),n.height},setLinkViews(t){e.linkViews=t},activateTrackSelector(t){if("hierarchical"===e.trackSelectorType){const r=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(r)){const n=r.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e.levels[t]});return r.showWidget(n),n}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},toggleTrack(t,r=0){e.levels[r]?.toggleTrack(t)},showTrack(t,r=0,n={}){e.levels[r]||(e.levels[r]=(0,v.cast)({level:r})),e.levels[r].showTrack(t,n)},hideTrack(t,r=0){e.levels[r]?.hideTrack(t)},squareView(){const t=(0,d.avg)(e.views.map((e=>e.bpPerPx)));for(const r of e.views){const e=r.pxToBp(r.width/2);r.setNewView(t,r.offsetPx),e.refName&&r.centerAt(e.coord,e.refName,e.index)}},clearView(){e.views=(0,v.cast)([]),e.levels=(0,v.cast)([])}}))).views((()=>({headerMenuItems:()=>[]}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Nr,{model:e,handleClose:t}]))},icon:ft.A}],rubberBandMenuItems:()=>[{label:"Zoom to region(s)",onClick:()=>{for(const t of e.views){const{leftOffset:e,rightOffset:r}=t;e&&r&&t.moveTo(e,r)}}}]}))).actions((e=>({afterAttach(){(0,v.addDisposer)(e,(0,Ce.autorun)((()=>{if(e.width)for(const t of e.views)t.setWidth(e.width)})))}}))).preProcessSnapshot((e=>{const{tracks:t,levels:r=[{tracks:t,level:0}],...n}=e||{};return{...n,levels:r}}))},Br=(0,l.lazy)((()=>r.e(3416).then(r.bind(r,3416)))),Vr=function(e){return v.types.compose("LinearSyntenyDisplay",Fr(e),v.types.model({type:v.types.literal("LinearSyntenyDisplay"),configuration:(0,c.ConfigurationReference)(e)})).volatile((()=>({mainCanvas:null,clickMapCanvas:null,cigarClickMapCanvas:null,mouseoverCanvas:null,featPositions:[],mouseoverId:void 0,clickId:void 0,cigarMouseoverId:-1}))).actions((e=>({setFeatPositions(t){e.featPositions=t},setMainCanvasRef(t){e.mainCanvas=t},setClickMapCanvasRef(t){e.clickMapCanvas=t},setCigarClickMapCanvasRef(t){e.cigarClickMapCanvas=t},setMouseoverCanvasRef(t){e.mouseoverCanvas=t},setMouseoverId(t){e.mouseoverId=t},setCigarMouseoverId(t){e.cigarMouseoverId=t},setClickId(t){e.clickId=t}}))).views((e=>({get adapterConfig(){return{name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,c.getConf)(e,"assemblyNames"),...(0,c.getConf)(e.parentTrack,"adapter")}},get trackIds(){return(0,c.getConf)(e,"trackIds")},get numFeats(){return e.featPositions.length},get ready(){return this.numFeats>0},get featMap(){return Object.fromEntries(e.featPositions.map((e=>[e.f.id(),e])))}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(8856).then(r.bind(r,28856));t(e)}catch(t){console.error(t),e.setError(t)}})()}})))};var jr=r(1618),Er=r(20482);function zr(e){return(0,p.jsx)(j.A,{...e,children:(0,p.jsx)("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"})})}const Or=(0,l.lazy)((()=>r.e(8869).then(r.bind(r,78869))));function Hr(e){return v.types.compose("LinearSyntenyView",Dr(e),v.types.model({type:v.types.literal("LinearSyntenyView"),drawCIGAR:!0,drawCurves:!1})).volatile((()=>({importFormSyntenyTrackSelections:Ce.observable.array()}))).actions((e=>({importFormRemoveRow(t){e.importFormSyntenyTrackSelections.splice(t,1)},clearImportFormSyntenyTracks(){e.importFormSyntenyTrackSelections.clear()},setImportFormSyntenyTrack(t,r){e.importFormSyntenyTrackSelections[t]=r},setDrawCurves(t){e.drawCurves=t},setDrawCIGAR(t){e.drawCIGAR=t},showAllRegions(){(0,Ce.transaction)((()=>{for(const t of e.views)t.showAllRegionsInAssembly()}))}}))).actions((e=>({async exportSvg(t){const{renderToSvg:n}=await r.e(3047).then(r.bind(r,93047)),a=await n(e,t),i=new Blob([a],{type:"image/svg+xml"});(0,Se.saveAs)(i,t.filename||"image.svg")}}))).views((e=>{const t=e.headerMenuItems,r=e.menuItems;return{headerMenuItems:()=>[...t(),{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:jr.A},{label:"Show all regions",onClick:e.showAllRegions,description:"Show entire genome assemblies",icon:Er.A},{label:"Draw CIGAR",checked:e.drawCIGAR,type:"checkbox",description:"Draws per-base CIGAR level alignments",onClick:()=>{e.setDrawCIGAR(!e.drawCIGAR)}},{label:"Link views",type:"checkbox",checked:e.linkViews,icon:we.A,onClick:()=>{e.setLinkViews(!e.linkViews)}},{label:"Use curved lines",type:"checkbox",checked:e.drawCurves,icon:zr,onClick:()=>{e.setDrawCurves(!e.drawCurves)}},{label:"Export SVG",icon:ve.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Or,{model:e,handleClose:t}]))}}],menuItems:()=>[...r(),{label:"Export SVG",icon:ve.A,onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Or,{model:e,handleClose:t}]))}}]}}))}function Gr(e){return v.types.model("LinearSyntenyViewHelper",{id:me.ElementId,type:"LinearSyntenyViewHelper",tracks:v.types.array(e.pluggableMstType("track","stateModel")),height:100,level:v.types.number}).actions((t=>({setHeight:e=>(t.height=e,t.height),showTrack(r,n={}){const a=e.pluggableConfigSchemaType("track"),i=(0,v.resolveIdentifier)(a,(0,v.getRoot)(t),r);if(!i)throw new Error(`track not found ${r}`);const o=e.getTrackType(i.type);if(!o)throw new Error(`unknown track type ${i.type}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=i.displays.find((e=>l.has(e.type)));if(!c)throw new Error(`could not find a compatible display for view type ${t.type}`);t.tracks.push(o.stateModel.create({...n,type:i.type,configuration:i,displays:[{type:c.type,configuration:c}]}))},hideTrack(r){const n=e.pluggableConfigSchemaType("track"),a=(0,v.resolveIdentifier)(n,(0,v.getRoot)(t),r),i=t.tracks.filter((e=>e.configuration===a));return(0,Ce.transaction)((()=>{for(const e of i)t.tracks.remove(e)})),i.length},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)}}))).views((e=>({get assemblyNames(){const t=(0,v.getParent)(e,2);return[t.views[e.level].assemblyNames[0],t.views[e.level+1].assemblyNames[0]]}})))}function Wr(){return(0,p.jsx)("div",{})}var $r=r(9342),Ur=r(67736);const qr=(0,c.ConfigurationSchema)("SyntenyFeatureWidget",{});function _r(e){return v.types.compose((0,$r.n)(e),v.types.model("SyntenyFeatureWidget",{type:v.types.literal("SyntenyFeatureWidget"),level:v.types.maybe(v.types.number)}))}class Jr extends a.A{name="LinearComparativeViewPlugin";install(e){!function(e){e.addViewType((()=>new Rt.A({name:"LinearSyntenyViewHelper",displayName:"Linear synteny view (helper)",viewMetadata:{hiddenFromGUI:!0},stateModel:Gr(e),ReactComponent:Wr})))}(e),function(e){e.addViewType((()=>new Rt.A({name:"LinearComparativeView",viewMetadata:{hiddenFromGUI:!0},displayName:"Linear comparative view",stateModel:Dr(e),ReactComponent:(0,l.lazy)((()=>r.e(8142).then(r.bind(r,78142))))})))}(e),function(e){e.addViewType((()=>new Rt.A({name:"LinearSyntenyView",displayName:"Linear synteny view",stateModel:Hr(e),ReactComponent:(0,l.lazy)((()=>r.e(3795).then(r.bind(r,13795))))})))}(e),function(e){e.addDisplayType((()=>{const e=Rr();return new Je.A({name:"LinearComparativeDisplay",configSchema:e,stateModel:Fr(e),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:()=>null})}))}(e),function(e){e.addDisplayType((()=>{const e=(0,c.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:Rr(),explicitlyTyped:!0});return new Je.A({name:"LinearSyntenyDisplay",configSchema:e,stateModel:Vr(e),trackType:"SyntenyTrack",viewType:"LinearSyntenyViewHelper",ReactComponent:(0,l.lazy)((()=>r.e(4753).then(r.bind(r,44753))))})}))}(e),function(e){e.addWidgetType((()=>new Ur.A({name:"SyntenyFeatureWidget",heading:"Synteny feature details",configSchema:qr,stateModel:_r(e),ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6386),r.e(1475),r.e(4144),r.e(4700)]).then(r.bind(r,64700))))})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return e.jexl.addFunction("lgvSyntenyTooltip",(e=>{const t=e.get("mate");return[e.get("name")||e.get("id"),t?.name||t?.id].filter((e=>!!e)).join("<br/>")})),(0,c.ConfigurationSchema)("LGVSyntenyDisplay",{mouseover:{type:"string",defaultValue:"jexl:lgvSyntenyTooltip(feature)"}},{baseConfiguration:(0,n.ww)(e),explicitlyTyped:!0})}(e),r=(a=t,v.types.compose("LGVSyntenyDisplay",(0,n.N5)(a),v.types.model({type:v.types.literal("LGVSyntenyDisplay"),configuration:(0,c.ConfigurationReference)(a)})).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=e.contextMenuFeature;return[...t(),...r?[{label:"Launch synteny view for this position",onClick:()=>{(0,d.getSession)(e).queueDialog((t=>[Pr,{view:(0,d.getContainingView)(e),trackId:(0,c.getConf)((0,d.getContainingTrack)(e),"trackId"),handleClose:t,session:(0,d.getSession)(e),feature:r}]))}}]:[]]}}})).views((e=>{const{trackMenuItems:t,colorSchemeSubMenuItems:r}=e;return{trackMenuItems:()=>[...t(),{label:"Color scheme",subMenu:[...r()]}]}})).actions((e=>({selectFeature(t){const r=(0,d.getSession)(e);if((0,d.isSessionModelWithWidgets)(r)){let n=(0,d.getContainingView)(e);try{n=(0,d.getContainingView)(n)}catch(e){}const a=r.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:t.toJSON(),view:n,track:(0,d.getContainingTrack)(e)});r.showWidget(a)}r.setSelection(t)},afterCreate(){e.colorBySetting||"normal"!==e.colorBy.type||e.setColorScheme({type:"strand"})}}))));var a;return new Je.A({name:"LGVSyntenyDisplay",configSchema:t,stateModel:r,trackType:"SyntenyTrack",viewType:"LinearGenomeView",ReactComponent:x.GQ})}))}(e),function(e){e.addToExtensionPoint("LaunchView-LinearSyntenyView",(async({session:e,views:t,tracks:r=[]})=>{try{const{assemblyManager:a}=e,i=e.addView("LinearSyntenyView",{});await(0,Ce.when)((()=>!!i.width)),i.setViews(await Promise.all(t.map((async e=>{const t=await a.waitForAssembly(e.assembly);if(!t)throw new Error(`Assembly ${e.assembly} failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:t.regions}})))),await Promise.all(i.views.map((e=>(0,Ce.when)((()=>e.initialized)))));let o=[];if(await Promise.all(t.map((async(e,t)=>{const r=i.views[t],{assembly:n,loc:s,tracks:l=[]}=e,c=await a.waitForAssembly(n);if(!c)throw new Error(`Assembly ${e.assembly} failed to load`);await r.navToSearchString({input:s,assembly:c}),o=[...o,...l.map((e=>function({model:e,trackId:t}){try{e.showTrack(t)}catch(e){if(/Could not resolve identifier/.exec(`${e}`)||/track not found/.exec(`${e}`))return t;throw e}}({model:r,trackId:e})))]}))),o=[...o,...(n=r,Array.isArray(n[0])?n:[n]).flatMap(((e,t)=>e.map((e=>function({model:e,trackId:t,level:r}){try{e.showTrack(t,r)}catch(e){if(/Could not resolve identifier/.exec(`${e}`)||/track not found/.exec(`${e}`))return t;throw e}}({model:i,trackId:e,level:t})))))],o.filter(d.notEmpty).length)throw new Error(`Could not resolve identifiers: ${o.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}var n}))}(e),function(e){e.addTrackType((()=>{const t=(e=>(0,c.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:(0,P.createBaseTrackConfig)(e)}))(e);return new Ft.A({name:"SyntenyTrack",configSchema:t,stateModel:(0,P.createBaseTrackModel)(e,"SyntenyTrack",t)})}))}(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>("LinearPileupDisplay"!==e.name||(e.stateModel=e.stateModel.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const r=e.contextMenuFeature,n=(0,d.getContainingTrack)(e);return[...t(),...r?[{label:"Linear read vs ref",icon:st.A,onClick:()=>{(0,d.getSession)(e).queueDialog((e=>[Br,{track:n,feature:r,handleClose:e}]))}}]:[]]}}}}))),e)))}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:Mr.A,onClick:e=>{e.addView("LinearSyntenyView",{})}})}}function Xr(e){return v.types.compose("LinearLollipopDisplay",x.Lr,v.types.model({type:v.types.literal("LinearLollipopDisplay"),configuration:(0,c.ConfigurationReference)(e)})).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}}))}var Yr=r(98111),Kr=r(31415),Qr=r(88217),Zr=r(32595);class en{totalHeight=0;rectangles=new Map;constructor({width:e}){if(!e)throw new Error("width required to make a new FloatingLayout");this.width=e}discardRange(){this.items=[],this.layout=new Map,this.totalHeight=0}items=[];layout=new Map;add(e,t,r,n,a){this.items.push({uniqueId:e,anchorLocation:t,width:r,height:n,data:a})}getLayout(e){if(!e)return this.layout;const t=(0,c.readConfObject)(e,"minStickLength"),r=this.items.sort(((e,t)=>e.data.score-t.data.score));let n=0;const a=new Array(r.length);for(const[e,i]of r.entries()){const r=i,{anchorLocation:o,width:s,height:l}=r,c=o-s/2,d=c+s;let u=t,p=u+l;for(let t=0;t<e;t+=1){const[,e]=a[t],{x:r,y:n,width:i,height:o}=e,s=r+i,g=n+o;(0,Zr.R6)(r,s,c,d)&&(0,Zr.R6)(n,g,u,p)&&(u=g,p=u+l,t=-1)}a[e]=[r.uniqueId,{...r,x:c,y:u}],p>n&&(n=p)}return this.totalHeight=n,this.layout=new Map(a),this.layout}getTotalHeight(){return this.totalHeight}serializeRegion(){return this.toJSON()}toJSON(){return{pairs:[...this.getLayout()],totalHeight:this.getTotalHeight()}}static fromJSON(){throw new Error("not supported")}}class tn{constructor({pairs:e,totalHeight:t}){this.layout=new Map(e),this.totalHeight=t}add(e){if(!this.layout.has(e))throw new Error(`layout error, precomputed layout is missing ${e}`)}getLayout(){return this.layout}getTotalHeight(){return this.totalHeight}discardRange(){}static fromJSON(e){return new tn(e)}}class rn extends Kr.h{makeLayout(){const{end:e,start:t}=this.props.regions[0],r=(e-t)/this.props.bpPerPx;return new Qr.MultiLayout(en,{width:r})}layoutIsValid(){return!1}}class nn extends Yr.default{createLayoutSession(e){return new rn(e)}deserializeLayoutInClient(e){return new tn(e)}}var an=r(80208);function on({feature:e,config:t,layoutRecord:{y:r,data:{anchorX:n,radiusPx:a,score:i}}}){const o=(0,c.readConfObject)(t,"innerColor",{feature:e}),s=String(i),l=2*a/s.length*1.1;return l<12?null:(0,p.jsx)("text",{style:{pointerEvents:"none",fontSize:l,fill:(0,an.contrastingTextColor)(o)},x:n,y:r+a-l/2.4,textAnchor:"middle",dominantBaseline:"hanging",children:s})}const sn=(0,u.observer)((function(e){const{feature:t,config:r,layoutRecord:n,selectedFeatureId:a}=e,{anchorLocation:i,y:o,data:{radiusPx:s}}=n,l={fill:(0,c.readConfObject)(r,"strokeColor",{feature:t})};String(a)===String(t.id())&&(l.fill="red");const d={fill:(0,c.readConfObject)(r,"innerColor",{feature:t})},u=(0,c.readConfObject)(r,"strokeWidth",{feature:t});return(0,p.jsxs)("g",{"data-testid":t.id(),children:[(0,p.jsx)("title",{children:(0,c.readConfObject)(r,"caption",{feature:t})}),(0,p.jsx)("circle",{cx:i,cy:o+s,r:s,style:l,onMouseDown:t=>{const{onFeatureMouseDown:r,feature:n}=e;return r?.(t,n.id())},onMouseEnter:t=>{const{onFeatureMouseEnter:r,feature:n}=e;return r?.(t,n.id())},onMouseOut:t=>{const{onFeatureMouseOut:r,feature:n}=e;return r?.(t,n.id())},onMouseOver:t=>{const{onFeatureMouseOver:r,feature:n}=e;return r?.(t,n.id())},onMouseUp:t=>{const{onFeatureMouseUp:r,feature:n}=e;return r?.(t,n.id())},onMouseLeave:t=>{const{onFeatureMouseLeave:r,feature:n}=e;return r?.(t,n.id())},onMouseMove:t=>{const{onFeatureMouseMove:r,feature:n}=e;return r?.(t,n.id())},onClick:t=>{const{onFeatureClick:r,feature:n}=e;return t.stopPropagation(),r?.(t,n.id())},onFocus:t=>{const{onFeatureMouseOver:r,feature:n}=e;return r?.(t,n.id())},onBlur:t=>{const{onFeatureMouseOut:r,feature:n}=e;return r?.(t,n.id())}}),s-u<=2?null:(0,p.jsx)("circle",{cx:i,cy:o+s,r:s-u,style:d,onMouseDown:t=>{const{onFeatureMouseDown:r,feature:n}=e;return r?.(t,n.id())},onMouseEnter:t=>{const{onFeatureMouseEnter:r,feature:n}=e;return r?.(t,n.id())},onMouseOut:t=>{const{onFeatureMouseOut:r,feature:n}=e;return r?.(t,n.id())},onMouseOver:t=>{const{onFeatureMouseOver:r,feature:n}=e;return r?.(t,n.id())},onMouseUp:t=>{const{onFeatureMouseUp:r,feature:n}=e;return r?.(t,n.id())},onMouseLeave:t=>{const{onFeatureMouseLeave:r,feature:n}=e;return r?.(t,n.id())},onMouseMove:t=>{const{onFeatureMouseMove:r,feature:n}=e;return r?.(t,n.id())},onClick:t=>{const{onFeatureClick:r,feature:n}=e;return t.stopPropagation(),r?.(t,n.id())},onFocus:t=>{const{onFeatureMouseOver:r,feature:n}=e;return r?.(t,n.id())},onBlur:t=>{const{onFeatureMouseOut:r,feature:n}=e;return r?.(t,n.id())}}),(0,p.jsx)(on,{feature:t,config:r,layoutRecord:n})]})})),ln=(0,u.observer)((function({feature:e,config:t,layoutRecord:{anchorLocation:r,y:n,data:{radiusPx:a}}}){return(0,p.jsx)("line",{x1:r,y1:0,x2:r,y2:n+2*a,stroke:(0,c.readConfObject)(t,"stickColor",{feature:e}),strokeWidth:(0,c.readConfObject)(t,"stickWidth",{feature:e})})}));function cn(e){const{feature:t,bpPerPx:r,config:n,region:a,layout:i}=e,o=Math.abs(t.get("end")+t.get("start"))/2,s=(0,d.bpToPx)(o,a,r),l=(0,c.readConfObject)(n,"radius",{feature:t});l||console.error(new Error(`lollipop radius ${l} configured for feature ${t.id()}`)),i.add(t.id(),s,2*l,2*l,{featureId:t.id(),anchorX:s,radiusPx:l,score:(0,c.readConfObject)(e.config,"score",{feature:t})})}const dn=(0,u.observer)((function(e){const t=t=>{const{onMouseEnter:r}=e;return r?.(t)},r=t=>{const{onMouseLeave:r}=e;return r?.(t)},[n,a]=(0,l.useState)(!1);(0,l.useEffect)((()=>{a(!0)}),[]);const{regions:i,bpPerPx:o,layout:s,config:c,features:d=new Map,displayModel:u={}}=e,{selectedFeatureId:g}=u,h=i[0];for(const e of d.values())cn({feature:e,bpPerPx:o,region:h,config:c,layout:s});const f=(h.end-h.start)/o,m=[...s.getLayout(c).values()],y=s.getTotalHeight();return(0,p.jsx)("svg",{width:f,height:y,style:{position:"relative"},onMouseDown:t=>{const{onMouseDown:r}=e;return r?.(t)},onMouseUp:t=>{const{onMouseUp:r}=e;return r?.(t)},onMouseEnter:t,onMouseLeave:r,onMouseOver:t=>{const{onMouseOver:r}=e;return r?.(t)},onMouseOut:t=>{const{onMouseOut:r}=e;return r?.(t)},onFocus:t,onBlur:r,onClick:t=>{const{onClick:r}=e;return r?.(t)},children:n?(0,p.jsx)(p.Fragment,{children:m.map((t=>{const r=d.get(t.data.featureId);return(0,p.jsxs)(l.Fragment,{children:[(0,p.jsx)(ln,{...e,config:c,layoutRecord:t,feature:r},`stick-${r.id()}`),(0,p.jsx)(sn,{...e,layoutRecord:t,feature:r,selectedFeatureId:g},`body-${r.id()}`)]},r.id())}))}):null})})),un=(0,c.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0});class pn extends a.A{name="LollipopPlugin";install(e){!function(e){e.addRendererType((()=>new nn({name:"LollipopRenderer",ReactComponent:dn,configSchema:un,pluginManager:e})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:x.Ki,explicitlyTyped:!0})}(e);return new C.DisplayType({name:"LinearLollipopDisplay",configSchema:t,stateModel:Xr(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:x.GQ})}))}(e)}}var gn=r(15897),hn=r(77538);const fn=(0,c.ConfigurationSchema)("AboutWidget",{}),mn=v.types.model("AboutWidget",{id:me.ElementId,type:v.types.literal("AboutWidget")}),yn=(0,c.ConfigurationSchema)("HelpWidget",{}),bn=v.types.model("HelpWidget",{id:me.ElementId,type:v.types.literal("HelpWidget")}),wn=(0,c.ConfigurationSchema)("ImportSessionWidget",{}),vn=v.types.model("ImportSessionWidget",{id:me.ElementId,type:v.types.literal("ImportSessionWidget")}),Sn=(0,c.ConfigurationSchema)("SessionManager",{}),Cn=v.types.model("SessionManager",{id:me.ElementId,type:v.types.literal("SessionManager")});class xn extends a.A{name="MenusPlugin";install(e){!function(e){e.addWidgetType((()=>new C.WidgetType({name:"AboutWidget",heading:"About",configSchema:fn,stateModel:mn,ReactComponent:(0,l.lazy)((()=>r.e(9032).then(r.bind(r,99032))))})))}(e),function(e){e.addWidgetType((()=>new C.WidgetType({name:"HelpWidget",heading:"Help",configSchema:yn,stateModel:bn,ReactComponent:(0,l.lazy)((()=>r.e(4974).then(r.bind(r,74974))))})))}(e),function(e){e.addWidgetType((()=>new C.WidgetType({name:"ImportSessionWidget",heading:"Import session",configSchema:wn,stateModel:vn,ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(7605),r.e(7389)]).then(r.bind(r,67389))))})))}(e),function(e){e.addWidgetType((()=>new C.WidgetType({name:"SessionManager",heading:"Recent sessions",configSchema:Sn,stateModel:Cn,ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6342),r.e(5183)]).then(r.bind(r,83662))))})))}(e)}configure(e){(0,d.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:hn.A,onClick:e=>{const t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:gn.A,onClick:e=>{const t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}}const kn=(0,c.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0});class Tn extends a.A{name="RdfPlugin";install(e){!function(e){e.addAdapterType((()=>new C.AdapterType({name:"SPARQLAdapter",displayName:"SPARQL adapter",configSchema:kn,adapterMetadata:{category:"Uncommon"},getAdapterClass:()=>r.e(5813).then(r.bind(r,75813)).then((e=>e.default))})))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="SPARQLAdapter",i=(0,he.getFileName)(t);return/\/sparql$/i.test(i)||n===a?{type:a,endpoint:t}:e(t,r,n)}))}}const An=(0,c.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri},faiLocation:{uri:`${e.uri}.fai`,baseUri:e.baseUri},gziLocation:{uri:`${e.uri}.gzi`,baseUri:e.baseUri}}:e}),Mn=(0,c.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,chromSizesLocation:{uri:e.uri,baseUri:e.baseUri}}:e});function Pn({codonTable:e,seq:t,frame:r,width:n,bpPerPx:a,colorByCDS:i,region:o,seqStart:s,height:c,y:u,reverse:g=!1,theme:h}){const f=(Math.abs(r)-1-s%3+3)%3,m=t.length-f,y=m-m%3,b=t.slice(f,f+y),w=[];for(let t=0;t<b.length;t+=3){const r=b.slice(t,t+3),n=g?(0,d.revcom)(r):r,a=e[n]||"";w.push({letter:a,codon:n.toUpperCase()})}const v=1/a*3,S=1/a>=12,C=f/a-(o.start-s)/a,x=i?h?.palette.framesCDS.at(r)?.main:h?.palette.frames.at(r)?.main;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("rect",{x:0,y:u,width:n,height:c,fill:x}),w.map(((e,t)=>{const r=o.reversed?n-(t+1)*v-C:v*t+C,{letter:a,codon:i}=e,s=d.defaultStarts.includes(i)?h?.palette.startCodon:d.defaultStops.includes(i)?h?.palette.stopCodon:void 0;return S||s?(0,p.jsxs)(l.Fragment,{children:[(0,p.jsx)("rect",{x:r,y:u,width:S?v:v+.7,height:c,stroke:S?"#555":"none",fill:s||"none"}),S?(0,p.jsx)("text",{x:r+v/2,fontSize:c-2,y:u+c/2,dominantBaseline:"middle",textAnchor:"middle",children:a}):null]},`${t}-${a}`):null}))]})}function Rn({bpPerPx:e,region:t,feature:r,sequenceType:n,theme:a,height:i,seq:o,y:s}){const c=1/e>=12,u=r.get("start"),g=r.get("end"),[h,f]=(0,d.bpSpanPx)(u,g,t,e),m=t.reversed,y=g-u,b=Math.max((f-h)/y,.8);return(0,p.jsx)(p.Fragment,{children:o.split("").map(((e,t)=>{const r="dna"===n?a.palette.bases[e.toUpperCase()]:void 0,o=m?f-(t+1)*b:h+t*b;return(0,p.jsxs)(l.Fragment,{children:[(0,p.jsx)("rect",{x:o,y:s,width:b,height:i,fill:r?r.main:"#aaa",stroke:c?"#555":"none"}),c?(0,p.jsx)("text",{x:o+b/2,y:s+i/2,dominantBaseline:"middle",textAnchor:"middle",fontSize:i-2,fill:r?a.palette.getContrastText(r.main):"black",children:e}):null]},`${e}-${t}`)}))})}function Ln({regions:e,width:t,theme:r,colorByCDS:n,features:a=new Map,showReverse:i=!0,showForward:o=!0,showTranslation:s=!0,sequenceType:l="dna",bpPerPx:c,rowHeight:u}){const g=e[0],h=(0,W.createJBrowseTheme)(r),f=(0,d.generateCodonTable)(d.defaultCodonTable),[m]=[...a.values()];if(!m)return null;const y=m.get("seq");if(!y)return null;let b=-u;const w=c<=1,v=s&&o?[3,2,1]:[],S=s&&i?[-1,-2,-3]:[],[C,x]=g.reversed?[S.toReversed(),v.toReversed()]:[v,S];return(0,p.jsxs)(p.Fragment,{children:[C.map((e=>(0,p.jsx)(Pn,{width:t,colorByCDS:n,seq:y,y:b+=u,codonTable:f,frame:e,bpPerPx:c,region:g,seqStart:m.get("start"),theme:h,height:u,reverse:g.reversed},`translation-${e}`))),o&&w?(0,p.jsx)(Rn,{height:u,sequenceType:l,y:b+=u,feature:m,region:g,seq:g.reversed?(0,d.complement)(y):y,bpPerPx:c,theme:h}):null,i&&w?(0,p.jsx)(Rn,{height:u,sequenceType:l,y:b+=u,feature:m,region:g,seq:g.reversed?y:(0,d.complement)(y),bpPerPx:c,theme:h}):null,x.map((e=>(0,p.jsx)(Pn,{width:t,colorByCDS:n,seq:y,y:b+=u,codonTable:f,frame:e,bpPerPx:c,region:g,seqStart:m.get("start"),theme:h,height:u,reverse:!g.reversed},`rev-translation-${e}`)))]})}function In({exportSVG:e,width:t,totalHeight:r,children:n}){return e?n:(0,p.jsx)("svg",{"data-testid":"sequence_track",width:t,height:r,style:{display:"block",width:t,height:r,userSelect:"none"},children:n})}const Fn=(0,u.observer)((function({exportSVG:e,features:t,regions:r,colorByCDS:n,bpPerPx:a,rowHeight:i,sequenceHeight:o,theme:s,showForward:l,showReverse:c,showTranslation:d}){const u=r[0],g=Math.ceil((u.end-u.start)/a);return(0,p.jsx)(In,{exportSVG:e,totalHeight:o,width:g,children:(0,p.jsx)(Ln,{width:g,showReverse:c,showForward:l,theme:s,showTranslation:d,colorByCDS:n,bpPerPx:a,rowHeight:i,features:t,regions:r})})})),Nn=(0,c.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0});class Dn extends o.default{supportsSVG=!0;getExpandedRegion(e){return{...e,start:Math.max(e.start-3,0),end:e.end+3}}}const Bn=(0,c.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri},faiLocation:{uri:`${e.uri}.fai`,baseUri:e.baseUri}}:e}),Vn=(0,c.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:Nn},{explicitIdentifier:"displayId",explicitlyTyped:!0});const jn=(0,c.ConfigurationSchema)("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0}),En=(0,c.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,twoBitLocation:{uri:e.uri,baseUri:e.baseUri},...e.chromSizes?{chromSizesLocation:{uri:e.chromSizes,baseUri:e.baseUri}}:{}}:e}),zn=(0,c.ConfigurationSchema)("UnindexedFastaAdapter",{rewriteRefNames:{type:"string",defaultValue:"",contextVariable:["refName"]},fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,fastaLocation:{uri:e.uri,baseUri:e.baseUri}}:e});class On extends a.A{name="SequencePlugin";install(e){!function(e){e.addRendererType((()=>new Dn({name:"DivSequenceRenderer",ReactComponent:Fn,configSchema:Nn,pluginManager:e})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"TwoBitAdapter",displayName:"TwoBit adapter",configSchema:En,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(2930).then(r.bind(r,82930)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"BgzipFastaAdapter",displayName:"Bgzip-indexed FASTA adapter",configSchema:An,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(9206).then(r.bind(r,79206)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"ChromSizesAdapter",displayName:"Chrom sizes adapter",configSchema:Mn,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(7842).then(r.bind(r,57842)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"IndexedFastaAdapter",displayName:"Indexed FASTA adapter",configSchema:Bn,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(9870).then(r.bind(r,69870)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"UnindexedFastaAdapter",displayName:"Unindexed FASTA adapter",configSchema:zn,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(3578).then(r.bind(r,93578)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new se.A({name:"SequenceSearchAdapter",displayName:"Sequence search adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:jn,getAdapterClass:()=>r.e(946).then(r.bind(r,90946)).then((e=>e.default))})))}(e),function(e){e.addTrackType((()=>{const t=function(e){return(0,c.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:v.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:'optional track name, otherwise uses the "Reference sequence (assemblyName)"',defaultValue:""},sequenceType:{type:"string",description:"either dna or pep",defaultValue:"dna"},description:{description:"a description of the track",type:"string",defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},formatAbout:(0,c.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const r=JSON.parse(JSON.stringify(t)),n=new Set,{displays:a=[]}=r;if("placeholderId"!==r.trackId){for(const e of a)e&&n.add(e.type);const t=e.getTrackType(r.type);for(const e of t?.displayTypes||[])n.has(e.name)||a.push({displayId:`${r.trackId}-${e.name}`,type:e.name})}return{...r,displays:a}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:r}=t;if(!r)throw new Error(`unknown display type ${r}`);const n=e.displays.find((e=>e&&e.displayId===t.displayId));if(n)return n;const a=e.displays.push(t);return e.displays[a-1]}})})}(e);return new Ft.A({name:"ReferenceSequenceTrack",displayName:"Reference sequence track",configSchema:t,stateModel:(0,P.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const e=function(e){return v.types.compose("LinearReferenceSequenceDisplay",x.Lr,v.types.model({type:v.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,c.ConfigurationReference)(e),showForward:!0,showReverse:!0,showTranslation:!0})).volatile((()=>({rowHeight:15}))).views((e=>({get sequenceType(){return(0,c.getConf)((0,d.getContainingTrack)(e),"sequenceType")},get showForwardActual(){return e.showForward},get showReverseActual(){return"dna"===this.sequenceType&&e.showReverse},get showTranslationActual(){return"dna"===this.sequenceType&&e.showTranslation}}))).views((e=>({get sequenceHeight(){const{rowHeight:t,showTranslationActual:r,showReverseActual:n,showForwardActual:a}=e;return(n&&r?3*t:0)+(a&&r?3*t:0)+(n?t:0)+(a?t:0)}}))).views((e=>{const{renderProps:t}=e;return{renderProps(){const{rpcDriverName:r,showForwardActual:n,showReverseActual:a,showTranslationActual:i,rowHeight:o,sequenceHeight:s,sequenceType:l}=e;return{...t(),...(0,he.getParentRenderProps)(e),config:e.configuration.renderer,rpcDriverName:r,showForward:n,showReverse:a,showTranslation:i,sequenceType:l,rowHeight:o,sequenceHeight:s}}}})).views((e=>({regionCannotBeRendered:()=>(0,d.getContainingView)(e).bpPerPx>3?"Zoom in to see sequence":void 0,get rendererTypeName(){return e.configuration.renderer.type}}))).actions((e=>({toggleShowForward(){e.showForward=!e.showForward},toggleShowReverse(){e.showReverse=!e.showReverse},toggleShowTranslation(){e.showTranslation=!e.showTranslation},afterAttach(){(0,v.addDisposer)(e,(0,Ce.autorun)((()=>{(0,d.getContainingView)(e).bpPerPx>3?e.setHeight(50):e.setHeight(e.sequenceHeight)})))}}))).views((e=>({trackMenuItems:()=>[..."dna"===e.sequenceType?[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:()=>{e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:()=>{e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:()=>{e.toggleShowTranslation()}}]:[]]})))}(Vn);return new C.DisplayType({name:"LinearReferenceSequenceDisplay",configSchema:Vn,stateModel:e,displayName:"Reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:x.GQ})}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="TwoBitAdapter",i=(0,he.getFileName)(t),o={type:a,twoBitLocation:t};return/\.2bit$/i.test(i)&&!n||n===a?o:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="IndexedFastaAdapter",i=(0,he.getFileName)(t),o={type:a,fastaLocation:t,faiLocation:r||(0,he.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(i)&&!n||n===a?o:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BgzipFastaAdapter",i=(0,he.getFileName)(t),o={type:a,faiLocation:(0,he.makeIndex)(t,".fai"),gziLocation:(0,he.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(i)&&!n||n===a?o:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t)))}(e)}}var Hn=r(34027);const Gn=["VCF","BED","BEDPE","STAR-Fusion"],Wn={VCF:()=>r.e(9314).then(r.bind(r,99314)).then((e=>e.parseVcfBuffer)),BED:()=>r.e(6310).then(r.bind(r,6310)).then((e=>e.parseBedBuffer)),BEDPE:()=>r.e(3025).then(r.bind(r,3025)).then((e=>e.parseBedPEBuffer)),"STAR-Fusion":()=>r.e(759).then(r.bind(r,759)).then((e=>e.parseSTARFusionBuffer))};function $n(e){return e.vcfLocation||e.vcfGzLocation?"VCF":e.bedLocation||e.bedGzLocation?"BED":e.bedpeLocation?"BEDPE":void 0}const Un=new RegExp(`\\.(${Gn.join("|")})(\\.gz)?$`,"i");var qn=r(65895);function _n({assemblyName:e,session:t,locString:r,spreadsheetViewId:n}){const a=`${n}_${e}`;let i=t.views.find((e=>e.id===a));return i||(i=t.addView("LinearGenomeView",{id:a})),i.navToLocString(r,e)}var Jn=r(61968);const Xn=(0,l.lazy)((()=>r.e(3331).then(r.bind(r,3331)))),Yn=(0,l.lazy)((()=>r.e(2130).then(r.bind(r,42130))));function Kn({assemblyName:e,session:t,spreadsheetViewId:r,feature:n}){return(0,p.jsx)($t.A,{menuItems:[{label:"Open in linear genome view",onClick:async()=>{try{await _n({spreadsheetViewId:r,assemblyName:e,session:t,locString:(0,d.assembleLocStringFast)(n)})}catch(e){console.error(e),t.notifyError(`${e}`,e)}}},{label:"Open in single-level split view",onClick:async()=>{const{pluginManager:a}=(0,v.getEnv)(t),i=a.getViewType("BreakpointSplitView");t.queueDialog((a=>[Yn,{handleClose:a,session:t,stableViewId:`${r}_${e}_breakpointsplitview_singlelevel`,feature:new d.SimpleFeature(n),viewType:i,assemblyName:e}]))}},{label:"Open in multi-level split view",onClick:async()=>{const{pluginManager:a}=(0,v.getEnv)(t),i=a.getViewType("BreakpointSplitView");t.queueDialog((a=>[Xn,{handleClose:a,session:t,stableViewId:`${r}_${e}_breakpointsplitview_multilevel`,feature:new d.SimpleFeature(n),viewType:i,assemblyName:e}]))}}],children:(0,p.jsx)(Jn.A,{})})}function Qn({model:e,feature:t}){return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(Kn,{session:(0,d.getSession)(e),spreadsheetViewId:(0,v.getParent)(e).id,assemblyName:e.assemblyName,feature:t}),(0,p.jsx)(qn.A,{href:"#",onClick:async r=>{try{r.preventDefault(),await _n({spreadsheetViewId:(0,v.getParent)(e).id,session:(0,d.getSession)(e),locString:(0,d.assembleLocString)(t),assemblyName:e.assemblyName})}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}},children:(0,d.assembleLocString)(t)})]})}function Zn(){const e=v.types.model("SpreadsheetImportWizard",{fileType:v.types.optional(v.types.enumeration(Gn),"VCF"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:v.types.maybe(v.types.string),cachedFileLocation:v.types.frozen()}).volatile((()=>({fileTypes:Gn,fileSource:void 0,error:void 0,loading:!1}))).views((e=>({get isReadyToOpen(){return e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName(t,r){const{assemblyManager:n}=(0,d.getSession)(e);return!!r&&n.isValidRefName(t,r)},tracksForAssembly(t){const r=(0,d.getSession)(e),{tracks:n=[],sessionTracks:a=[]}=r;return[...n,...a].map((e=>{const n=(0,c.readConfObject)(e,"assemblyNames"),a=(0,c.readConfObject)(e,"adapter"),i=(0,c.readConfObject)(e,"category").join(","),o=function(e){return e.vcfLocation||e.vcfGzLocation||e.bedLocation||e.bedGzLocation||e.bedpeLocation}(a);return n.includes(t)&&o?{track:e,label:[i?`[${i}]`:"",(0,he.getTrackName)(e,r)].filter((e=>!!e)).join(" "),assemblyNames:n,type:$n(a)||"UNKNOWN",loc:o}:void 0})).filter((e=>!!e)).sort(((e,t)=>e.label.localeCompare(t.label)))}}))).actions((e=>({setSelectedAssemblyName(t){e.selectedAssemblyName=t},setFileSource(t){if(e.fileSource=t,e.error=void 0,e.fileSource){const t=e.fileName;if(t){const r=Un.exec(t)?.[1];r&&(e.fileType="tsv"===r&&t.includes("star-fusion")?"STAR-Fusion":r.toUpperCase())}}},setColumnNameLineNumber(t){t>0&&(e.columnNameLineNumber=t)},setFileType(t){e.fileType=t},setError(t){e.error=t},setLoading(t){e.loading=t},cancelButton(){e.error=void 0,(0,v.getParent)(e).setDisplayMode()},setCachedFileHandle(t){e.cachedFileLocation=t}}))).actions((e=>({async import(t){if(!e.fileSource)return;e.selectedAssemblyName=t;const n=e.fileType,a=await Wn[n](),{fetchAndMaybeUnzip:i}=await Promise.resolve().then(r.bind(r,99546)),{pluginManager:o}=(0,d.getEnv)(e),s=(0,K.openLocation)(e.fileSource,o);e.setLoading(!0);try{if((await s.stat()).size>1e8)return void e.setError(`File is too big. Tabular files are limited to at most ${1e5.toLocaleString()}kb.`)}catch(e){console.warn(e)}finally{e.setLoading(!1)}e.setLoading(!0);try{e.fileSource.uri&&e.setCachedFileHandle({uri:e.fileSource.uri,baseUri:e.fileSource.baseUri,locationType:"UriLocation"});const r=await i(s);(0,v.getParent)(e).displaySpreadsheet({...a(r),assemblyName:t})}catch(t){console.error(t),e.setError(t)}finally{e.setLoading(!1)}}}))).actions((e=>({afterAttach(){(async()=>{try{e.cachedFileLocation&&e.selectedAssemblyName&&(e.setFileSource(e.cachedFileLocation),await e.import(e.selectedAssemblyName))}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}})()}})));return v.types.compose(P.BaseViewModel,v.types.model("SpreadsheetView",{type:v.types.literal("SpreadsheetView"),offsetPx:0,height:v.types.optional(v.types.number,440),hideVerticalResizeHandle:!1,hideFilterControls:!1,importWizard:v.types.optional(e,(()=>e.create())),spreadsheet:v.types.maybe(v.types.model("Spreadsheet",{rowSet:v.types.frozen(),columns:v.types.frozen(),assemblyName:v.types.maybe(v.types.string),visibleColumns:v.types.frozen()}).volatile((()=>({visibleRowFlags:void 0}))).views((e=>({get rows(){return e.rowSet?.rows.map(((t,r)=>({id:r,feature:t.feature,...Object.fromEntries(e.columns.map(((e,r)=>[e.name,t.cellData?.[e.name]??t.cells?.[r]?.text])))})))},get initialized(){const t=(0,d.getSession)(e),r=e.assemblyName;return e.rowSet&&!!r&&t.assemblyManager.get(r)?.initialized}}))).views((e=>({get dataGridColumns(){const{rows:t}=e;return t?[{field:"Location",width:(0,d.measureGridWidth)(t.map((e=>e.feature?(0,d.assembleLocStringFast)(e.feature):0)))+40,renderCell:({row:t})=>{const{feature:r}=t;return r?(0,p.jsx)(Qn,{model:e,feature:r}):"N/A"}},{field:"Length",type:"number",width:(0,d.measureGridWidth)(t.map((e=>{const{feature:t}=e;return t?t.end-t.start:0}))),valueGetter:(e,t)=>{const{feature:r}=t;return r?r.end-r.start:void 0},valueFormatter:e=>(0,d.toLocale)(e)},...e.columns.map((e=>({field:e.name,width:(0,d.measureGridWidth)([...t.map((t=>t[e.name])),e.name],{minWidth:20}),type:"number"==typeof t[0][e.name]?"number":void 0})))]:void 0}}))).views((e=>({get visibleRows(){const{visibleRowFlags:t}=e;return t?e.rows?.filter(((e,r)=>!!t[r])):e.rows}}))).actions((e=>({setVisibleRows(t){e.visibleRowFlags=t},setVisibleColumns(t){e.visibleColumns=t}}))).preProcessSnapshot((e=>e?{...e,columns:e.columns.filter((e=>!e.isDerived)),rowSet:e.rowSet?{...e.rowSet,rows:e.rowSet.rows.map((e=>({...e,feature:e.feature??e.extendedData?.vcfFeature})))}:void 0}:e)))}).volatile((()=>({width:400,rowMenuItems:[]}))).views((e=>({get assembly(){const t=e.spreadsheet?.assemblyName;return t?(0,d.getSession)(e).assemblyManager.get(t)?.configuration:void 0}}))).actions((e=>({setRowMenuItems(t){e.rowMenuItems=t},setWidth:t=>(e.width=t,e.width),setHeight:t=>(e.height=Math.max(t,40),e.height),resizeHeight(t){const r=e.height;return this.setHeight(e.height+t)-r},resizeWidth(t){const r=e.width;return this.setWidth(e.width+t)-r},displaySpreadsheet(t){e.spreadsheet=(0,v.cast)(t)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",icon:ft.A,onClick:()=>{e.displaySpreadsheet(void 0)}}]})))).postProcessSnapshot((e=>{const{importWizard:t,spreadsheet:r}=e;if(t.cachedFileLocation&&r){const{rowSet:t,...n}=r;return{...e,spreadsheet:n}}if(r){const{rowSet:t,...n}=r;return t&&JSON.stringify(t).length>1e6?{...e,spreadsheet:n}:e}return e}))}class ea extends a.A{name="SpreadsheetViewPlugin";install(e){!function(e){e.addViewType((()=>new C.ViewType({name:"SpreadsheetView",displayName:"Spreadsheet view",stateModel:Zn(),ReactComponent:(0,l.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(553)]).then(r.bind(r,76633))))})))}(e),function(e){e.addToExtensionPoint("LaunchView-SpreadsheetView",(async({session:e,assembly:t,uri:r,fileType:n})=>{const a=e.addView("SpreadsheetView"),i=r.split(".");let o=i.pop()?.toUpperCase();"GZ"===o&&(o=i.pop()?.toUpperCase()),a.importWizard.setFileType(n||o||""),a.importWizard.setSelectedAssemblyName(t),a.importWizard.setFileSource({uri:r,locationType:"UriLocation"}),await a.importWizard.import(t)}))}(e)}configure(e){const{rootModel:t}=e;(0,d.isAbstractMenuManager)(t)&&t.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:Hn.A,onClick:e=>{e.addView("SpreadsheetView",{})}})}}var ta=r(92516),ra=r(1182),na=r(33935);function aa(e,t){(async()=>{const r=(0,d.getSession)(t);try{r.setSelection(e);const n=(0,d.getContainingView)(t),a=`${(0,v.getParent)(n).id}_spawned`;await(0,na.RI)({assemblyName:n.assemblyNames[0],session:r,stableViewId:a,feature:e})}catch(e){console.error(e),r.notifyError(`${e}`,e)}})()}class ia extends a.A{name="SvInspectorViewPlugin";install(e){!function(e){e.jexl.addFunction("defaultOnChordClick",aa),e.addViewType((()=>{const t=function(e){const t=e.getViewType("SpreadsheetView"),r=e.getViewType("CircularView"),n=t.stateModel,a=r.stateModel;return v.types.compose("SvInspectorView",P.BaseViewModel,v.types.model({id:me.ElementId,type:v.types.literal("SvInspectorView"),height:v.types.optional(v.types.number,550),onlyDisplayRelevantRegionsInCircularView:!1,spreadsheetView:v.types.optional(n,(()=>n.create({type:"SpreadsheetView",hideVerticalResizeHandle:!0}))),circularView:v.types.optional(a,(()=>a.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})))})).volatile((()=>({width:800,SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:r.ReactComponent,circularViewOptionsBarHeight:52}))).views((e=>({get assemblyName(){const{assembly:t}=e.spreadsheetView;return t?(0,c.readConfObject)(t,"name"):void 0},get showCircularView(){return!!e.spreadsheetView.spreadsheet?.rowSet},get features(){return structuredClone(e.spreadsheetView.spreadsheet?.visibleRows)?.map((e=>e.feature)).filter((e=>!!e))||[]},get featuresAdapterConfigSnapshot(){return{type:"FromConfigAdapter",features:this.features}},get featureRefNames(){return[...new Set([...this.features.map((e=>e.refName)),...this.features.flatMap((e=>e.INFO?.CHR2)),...this.features.flatMap((e=>e.mate?.refName))].filter((e=>!!e)))]},get currentAssembly(){const{assemblyManager:t}=(0,d.getSession)(e);return this.assemblyName?t.get(this.assemblyName):void 0},get canonicalFeatureRefNameSet(){const e=this.currentAssembly;return new Set(e?.initialized?this.featureRefNames.map((t=>e.getCanonicalRefName(t)||t)):[])},get featuresCircularTrackConfiguration(){return{type:"VariantTrack",trackId:`sv-inspector-variant-track-${e.id}`,name:"features from tabular data",adapter:this.featuresAdapterConfigSnapshot,assemblyNames:[this.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:`sv-inspector-variant-track-chord-display-${e.id}`,onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}))).actions((e=>({setWidth(t){e.width=t},setHeight:t=>(e.height=Math.max(t,400),e.height),setDisplayedRegions(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",icon:ft.A,onClick:()=>{e.spreadsheetView.displaySpreadsheet(void 0)}}]}))).actions((e=>({resizeHeight(t){const r=e.height;return e.setHeight(e.height+t)-r},afterAttach(){(0,v.addDisposer)(e,(0,Ce.autorun)((()=>{if(e.showCircularView){const t=Math.round(.66*e.width),r=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(r)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),(0,v.addDisposer)(e,(0,Ce.autorun)((()=>{e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),(0,v.addDisposer)(e,(0,Ce.autorun)((async()=>{const{onlyDisplayRelevantRegionsInCircularView:t,circularView:r,canonicalFeatureRefNameSet:n,currentAssembly:a}=e;if(r.initialized&&a?.regions)if(t){if(1===r.tracks.length)try{r.setDisplayedRegions(structuredClone(a.regions.filter((e=>n.has(e.refName)))))}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}}else r.setDisplayedRegions(a.regions)}),{name:"SvInspectorView displayed regions bind"})),(0,v.addDisposer)(e,(0,Ce.reaction)((()=>({generatedTrackConf:e.featuresCircularTrackConfiguration,assemblyName:e.assemblyName})),(t=>{if(!t)return;const{assemblyName:r,generatedTrackConf:n}=t,{circularView:a}=e;for(const e of a.tracks)a.hideTrack(e.configuration.trackId);r&&a.addTrackConf(n,{assemblyName:r})}),{name:"SvInspectorView track configuration binding",fireImmediately:!0}))}}))).postProcessSnapshot((e=>{const{circularView:t,...r}=e;return r}))}(e);return new Rt.A({name:"SvInspectorView",displayName:"SV inspector",stateModel:t,ReactComponent:(0,l.lazy)((()=>r.e(1915).then(r.bind(r,51915))))})}))}(e),function(e){e.addToExtensionPoint("LaunchView-SvInspectorView",(async({session:e,assembly:t,uri:r,fileType:n})=>{const a=e.addView("SvInspectorView"),i=r.split(".");let o=i.pop()?.toUpperCase();"GZ"===o&&(o=i.pop()?.toUpperCase()),a.spreadsheetView.importWizard.setFileType(n||o||""),a.spreadsheetView.importWizard.setSelectedAssemblyName(t),a.spreadsheetView.importWizard.setFileSource({uri:r,locationType:"UriLocation"}),await a.spreadsheetView.importWizard.import(t)}))}(e)}configure(e){(0,ta.Nh)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:ra.A,onClick:e=>{e.addView("SvInspectorView",{})}})}}var oa=r(51414);const sa=(0,u.observer)((function({text:e,x:t,y:r,region:n,reversed:a,bpPerPx:i,exportSVG:o,feature:s,viewParams:c,color:u="black",fontHeight:g=11,featureWidth:h=0,allowedWidthExpansion:f=0,displayModel:m={}}){const y=h+f,b=(0,d.measureText)(e,g),w=(0,v.isStateTreeNode)(m)&&(0,v.isAlive)(m)&&!o?(0,d.getViewParams)(m):c,S=a?w.end:w.start,[C,x]=(0,l.useState)(o),k=(0,oa.A)();if((0,l.useEffect)((()=>{x(!0)}),[]),(0,v.isStateTreeNode)(n)&&!(0,v.isAlive)(n))return null;const T=n.start,A=n.end,M=s.get("start"),P=s.get("end"),R=b*i;return S<A&&S>T&&M<S&&S+R<P?t=w.offsetPx:M<S&&S+R<P&&S+R>T&&S+R<A&&(t=w.offsetPx1),C?(0,p.jsx)("text",{x:t,y:r+g,fill:"#f0f"===u?(0,d.stripAlpha)(k.palette.text.primary):u,fontSize:g,children:b>y?`${e.slice(0,y/(.6*g))}...`:e}):null})),la=sa,ca=(0,u.observer)((function(e){const{feature:t,rootLayout:r,config:n,name:a,description:i,shouldShowName:o,shouldShowDescription:s}=e,l=r.getSubRecord(String(t.id()));if(!l)return null;const{GlyphComponent:d}=l.data||{};return(0,p.jsxs)("g",{children:[(0,p.jsx)(d,{featureLayout:l,...e}),o?(0,p.jsx)(la,{text:a,x:r.getSubRecord("nameLabel")?.absolute.left||0,y:r.getSubRecord("nameLabel")?.absolute.top||0,color:(0,c.readConfObject)(n,["labels","nameColor"],{feature:t}),featureWidth:l.width,...e}):null,s?(0,p.jsx)(la,{text:i,x:r.getSubRecord("descriptionLabel")?.absolute.left||0,y:r.getSubRecord("descriptionLabel")?.absolute.top||0,color:(0,c.readConfObject)(n,["labels","descriptionColor"],{feature:t}),featureWidth:l.width,...e}):null]})}));function da({rect:e,region:t,bpPerPx:r,...n}){if(!e)return null;const[a,i,o,s]=e,[l,c]=(0,d.bpSpanPx)(a,o,t,r),u=Math.round(i),g=(t.end-t.start)/r,h=Math.round(s-i),f=c-l;if(l+f<0)return null;const m=Math.max(l,0),y=m-l,b=Math.max(1,Math.min(f-y,g));return(0,p.jsx)("rect",{x:m-2,y:u-2,width:b+4,height:h+4,...n})}const ua=(0,u.observer)((function({displayModel:e={},blockKey:t,region:r,bpPerPx:n,movedDuringLastMouseDown:a,...i}){const{selectedFeatureId:o,featureIdUnderMouse:s,contextMenuFeature:c}=e,d=s||c?.id(),[u,g]=(0,l.useState)(!1);function h(e){const{onFeatureMouseOut:t}=i;t&&d&&t(e,d)}function f(e){const{onFeatureMouseOver:t}=i;t&&d&&t(e,d)}return(0,l.useEffect)((()=>{g(!0)}),[]),u?(0,p.jsxs)(p.Fragment,{children:[d?(0,p.jsx)(da,{rect:e.getFeatureByID?.(t,d),region:r,bpPerPx:n,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){const{onFeatureMouseDown:t}=i;t&&d&&t(e,d)},onMouseEnter:function(e){const{onFeatureMouseEnter:t}=i;t&&d&&t(e,d)},onMouseOut:h,onMouseOver:f,onMouseUp:function(e){const{onFeatureMouseUp:t}=i;t&&d&&t(e,d)},onMouseLeave:function(e){const{onFeatureMouseLeave:t}=i;t&&d&&t(e,d)},onMouseMove:function(e){const{onFeatureMouseMove:t}=i;t&&d&&t(e,d)},onClick:function(e){if(a)return;const{onFeatureClick:t}=i;t&&d&&(e.stopPropagation(),t(e,d))},onContextMenu:function(e){const{onFeatureContextMenu:t}=i;t&&d&&t(e,d)},onFocus:f,onBlur:h,"data-testid":d}):null,o?(0,p.jsx)(da,{rect:e.getFeatureByID?.(t,o),region:r,bpPerPx:n,stroke:"#00b8ff",fill:"none"}):null]}):null})),pa=(0,u.observer)((function({feature:e,featureLayout:t,config:r,region:n}){const a=e.get("strand"),i=n.reversed?-1:1,o=7*a*i,{left:s=0,top:l=0,width:u=0,height:g=0}=t.absolute,h=(0,c.readConfObject)(r,"color2",{feature:e}),f=(0,oa.A)(),m="#f0f"===h?(0,d.stripAlpha)(f.palette.text.secondary):h,y=a*i==-1?s:a*i==1?s+u:null,b=l+g/2;return y?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("line",{x1:y,x2:y+o,y1:b,y2:b,stroke:m}),(0,p.jsx)("polygon",{points:[[y+o/2,b-2.5],[y+o/2,b+2.5],[y+o,b]].toString(),stroke:m,fill:m})]}):null})),ga=(0,u.observer)((function(e){const t=(0,oa.A)(),{colorByCDS:r,feature:n,region:a,config:i,featureLayout:o,bpPerPx:s,topLevel:l}=e,{start:u,end:g}=a,h=Math.ceil((g-u)/s),f=n.get("start"),m=n.get("end"),y=n.get("type"),b=n.get("strand"),w=n.get("phase"),v=(m-f)/s,{left:S=0}=o.absolute;let{top:C=0,height:x=0}=o.absolute;if(S+v<0)return null;ka(n)&&(C+=.175*x,x*=.65);const k=Math.max(S,0),T=k-S,A=Math.max(2,Math.min(v-T,h));let M=ka(n)?(0,c.readConfObject)(i,"color3",{feature:n}):(0,c.readConfObject)(i,"color1",{feature:n});if(r&&"CDS"===y&&void 0!==b&&void 0!==w){const e=(0,d.getFrame)(f,m,b,w),r=t.palette.framesCDS.at(e)?.main;r&&(M=r)}return n.parent()&&"intron"===y?null:(0,p.jsxs)(p.Fragment,{children:[l?(0,p.jsx)(pa,{...e}):null,(0,p.jsx)("rect",{"data-testid":`box-${n.id()}`,x:k,y:C,width:A,height:x,fill:M,stroke:(0,c.readConfObject)(i,"outline",{feature:n})})]})})),ha=(0,u.observer)((function(e){const{feature:t,featureLayout:r,selected:n,config:a,subfeatures:i=t.get("subfeatures")}=e,o=(0,oa.A)(),s=(0,c.readConfObject)(a,"color2",{feature:t}),l="#f0f"===s?(0,d.stripAlpha)(o.palette.text.secondary):s,{left:u=0,top:g=0,width:h=0,height:f=0}=r.absolute,m=g+f/2;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("line",{"data-testid":t.id(),x1:u,y1:m,y2:m,x2:u+h,stroke:l}),i?.map((t=>{const a=String(t.id()),i=r.getSubRecord(a);if(!i)return null;const{GlyphComponent:o}=i.data||{};return(0,p.jsx)(o,{...e,feature:t,topLevel:!1,featureLayout:i,selected:n},`glyph-${a}`)})),(0,p.jsx)(pa,{...e})]})}));function fa(e,t){let r=e.get("subfeatures");if(!r||0===r.length)return[];const n=r.some((e=>ka(e))),a=["mRNA","transcript"].includes(e.get("type"));return(!n&&a||(0,c.readConfObject)(t,"impliedUTRs"))&&(r=function(e,t){const r=[...t];let n,a,i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=[];for(const t of r){const r=t.get("type");/^cds/i.test(r)?(i>t.get("start")&&(i=t.get("start")),o<t.get("end")&&(o=t.get("end"))):/exon/i.test(r)?s.push(t):ka(t)&&(n=t.get("start")===e.get("start"),a=t.get("end")===e.get("end"))}if(!(s.length&&i<Number.POSITIVE_INFINITY&&o>Number.NEGATIVE_INFINITY))return r;s.sort(((e,t)=>e.get("start")-t.get("start")));const l=e.get("strand");let c,u;if(!n)for(const[t,n]of s.entries()){if(c=n.get("start"),c>=i)break;u=Math.min(i,n.get("end"));const a=l>=0?"five_prime_UTR":"three_prime_UTR";r.unshift(new d.SimpleFeature({parent:e,id:`${e.id()}_${a}_${t}`,data:{start:c,end:u,strand:l,type:a}}))}if(!a)for(let t=s.length-1;t>=0&&(u=s[t].get("end"),!(u<=o));t--){c=Math.max(o,s[t].get("start"));const n=l>=0?"three_prime_UTR":"five_prime_UTR";r.push(new d.SimpleFeature({parent:e,id:`${e.id()}_${n}_${t}`,data:{start:c,end:u,strand:l,type:n}}))}return r}(e,r)),r.filter((e=>function(e,t){return function(e,t){const r=(0,c.readConfObject)(t,"subParts"),n="string"==typeof r?r.split(/\s*,\s*/):r;return e=>n.map((e=>e.toLowerCase())).includes(e.get("type").toLowerCase())}(0,t)(e)}(e,t)))}const ma=(0,u.observer)((function(e){const{feature:t,config:r}=e,n=fa(t,r);return(0,p.jsx)(ha,{...e,subfeatures:n})}));ma.layOut=({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:i})=>{const o=Ca({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:i});return xa({layout:o,subfeatures:fa(t,a),bpPerPx:r,reversed:n,config:a,extraGlyphs:i}),o};const ya=ma,ba=(0,u.observer)((function(e){const{feature:t,featureLayout:r,selected:n}=e;return t.get("subfeatures")?.map((t=>{const a=String(t.id()),i=r.getSubRecord(a);if(!i)return null;const{GlyphComponent:o}=i.data||{};return(0,p.jsx)(o,{...e,feature:t,featureLayout:i,selected:n},`glyph-${a}`)}))}));ba.layOut=({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:i})=>{const o=Ca({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:i}),s=(0,c.readConfObject)(a,"displayMode");if("reducedRepresentation"!==s){let e=0;const l=t.get("subfeatures");if(l)for(const t of l){const l=va({feature:t,extraGlyphs:i,config:a}),d=(0,c.readConfObject)(a,"height",{feature:t});(l.layOut||Sa)({layout:o,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:i}).move(0,e),e+="collapse"===s?0:("compact"===s?d/3:d)+2}}return o};const wa=ba;function va({feature:e,extraGlyphs:t,config:r}){const n=e.get("type"),a=e.get("subfeatures"),i=(0,c.readConfObject)(r,"transcriptTypes"),o=(0,c.readConfObject)(r,"containerTypes");if(a?.length&&"CDS"!==n){const t=a.some((e=>e.get("subfeatures")?.length)),r=a.some((e=>"CDS"===e.get("type")));return i.includes(n)&&r?ya:!e.parent()&&t||o.includes(n)?wa:ha}return t?.find((t=>t.validator(e)))?.glyph||ga}function Sa({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:i}){const o=(0,c.readConfObject)(a,"displayMode"),s=Ca({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:i});return"reducedRepresentation"!==o&&xa({layout:s,subfeatures:t.get("subfeatures")||[],bpPerPx:r,reversed:n,config:a,extraGlyphs:i}),s}function Ca(e){const{layout:t,feature:r,bpPerPx:n,reversed:a,config:i,extraGlyphs:o}=e,s=(0,c.readConfObject)(i,"displayMode"),l="reducedRepresentation"===s?ga:va({feature:r,extraGlyphs:o,config:i}),d=r.parent();let u=0;d&&(u=(a?d.get("end")-r.get("end"):r.get("start")-d.get("start"))/n);const p=(0,c.readConfObject)(i,"height",{feature:r}),g=(r.get("end")-r.get("start"))/n,h=t.parent,f=h?h.top:0;return t.addChild(String(r.id()),u,"collapse"===s?0:f,Math.max(g,1),"compact"===s?p/2:p,{GlyphComponent:l})}function xa(e){const{layout:t,subfeatures:r,bpPerPx:n,reversed:a,config:i,extraGlyphs:o}=e;for(const e of r)(va({feature:e,extraGlyphs:o,config:i}).layOut||Sa)({layout:t,feature:e,bpPerPx:n,reversed:a,config:i,extraGlyphs:o})}function ka(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/i.test(e.get("type")||"")}function Ta(e){const{feature:t,detectRerender:r,bpPerPx:n,region:a,config:i,displayMode:o,layout:s,extraGlyphs:l}=e;r?.();const{reversed:u}=a,g=t.get(u?"end":"start"),h=(0,d.bpToPx)(g,a,n),f="collapsed"!==o,m=new Qr.SceneGraph("root",0,0,0,0),y=(va({config:i,feature:t,extraGlyphs:l}).layOut||Sa)({layout:m,feature:t,bpPerPx:n,reversed:u,config:i,extraGlyphs:l});let b=!1,w=!1,v="",S="",C=0,x=0;if(f){const e=(0,c.readConfObject)(i,"showLabels"),r=(0,c.readConfObject)(i,"showDescriptions");C=(0,c.readConfObject)(i,["labels","fontSize"],{feature:t}),x=(0,c.readConfObject)(i,"maxFeatureGlyphExpansion")||0,v=String((0,c.readConfObject)(i,["labels","name"],{feature:t})||""),b=/\S/.test(v)&&e;const n=e=>{const t=m.width+x,r=(0,d.measureText)(e,C);return Math.round(Math.min(r,t))};if(S=String((0,c.readConfObject)(i,["labels","description"],{feature:t})||""),w=/\S/.test(S)&&r,b&&m.addChild("nameLabel",0,y.bottom,n(v),C),w){const e=b?m.getSubRecord("nameLabel"):y;if(!e)throw new Error("failed to layout nameLabel");m.addChild("descriptionLabel",0,e.bottom,n(S),C)}}const k=s.addRect(t.id(),t.get("start"),t.get("start")+m.width*n+3*n,m.height+5);return null===k?null:(m.move(h,k),(0,p.jsx)(ca,{rootLayout:m,name:v,shouldShowName:b,description:S,shouldShowDescription:w,fontHeight:C,allowedWidthExpansion:x,reversed:a.reversed,topLevel:!0,...e}))}const Aa=(0,u.observer)((function(e){const{features:t=new Map,isFeatureDisplayed:r}=e;return(0,p.jsx)(p.Fragment,{children:[...t.values()].filter((e=>!r||r(e))).map((t=>(0,p.jsx)(Ta,{feature:t,...e},t.id())))})})),Ma=(0,u.observer)((function(e){const{layout:t,blockKey:r,regions:n=[],bpPerPx:a,config:i,displayModel:o={},exportSVG:s,featureDisplayHandler:d,onMouseOut:u,onMouseDown:g,onMouseLeave:h,onMouseEnter:f,onMouseOver:m,onMouseMove:y,onMouseUp:b,onClick:w}=e,v=n[0],S=(v.end-v.start)/a,C=(0,c.readConfObject)(i,"displayMode"),x=(0,c.readConfObject)(i,"maxHeight"),k=(0,l.useRef)(null),[T,A]=(0,l.useState)(!1),[M,P]=(0,l.useState)(x),[R,L]=(0,l.useState)(!1),[I,F]=(0,l.useState)(),N=(0,l.useCallback)((e=>(A(!0),L(!1),F({x:e.clientX,y:e.clientY}),g?.(e))),[g]),D=(0,l.useCallback)((e=>(A(!1),F(void 0),b?.(e))),[b]),B=(0,l.useCallback)((e=>{if(!k.current)return;if(T&&I){const t=e.clientX-I.x,r=e.clientY-I.y;(Math.abs(t)>8||Math.abs(r)>8)&&L(!0)}const{left:t,top:n}=k.current.getBoundingClientRect(),i=e.clientX-t,s=e.clientY-n,l=v.reversed?S-i:i,c=v.start+a*l,d=o.getFeatureOverlapping?.(r,c,s);y&&y(e,d)}),[I,r,a,T,y,v.reversed,v.start,o,S]),V=(0,l.useCallback)((e=>{R||w?.(e)}),[R,w]);return(0,l.useEffect)((()=>{P(t.getTotalHeight())}),[t]),s?(0,p.jsx)(Aa,{displayMode:C,isFeatureDisplayed:d,region:v,...e}):(0,p.jsxs)("svg",{ref:k,"data-testid":"svgfeatures",width:S,height:M+100,style:{display:"block"},onMouseDown:N,onMouseUp:D,onMouseEnter:f,onMouseLeave:h,onMouseOver:m,onMouseOut:u,onMouseMove:B,onClick:V,children:[(0,p.jsx)(Aa,{displayMode:C,region:v,movedDuringLastMouseDown:R,isFeatureDisplayed:d,...e}),(0,p.jsx)(ua,{...e,region:v,movedDuringLastMouseDown:R})]})})),Pa=(0,c.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"#f0f",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:(0,c.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"#f0f",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:12,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:v.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:1200},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1},transcriptTypes:{type:"stringArray",defaultValue:["mRNA","transcript","primary_transcript"]},containerTypes:{type:"stringArray",defaultValue:["proteoform_orf"]}},{explicitlyTyped:!0});class Ra extends Yr.default{supportsSVG=!0}class La extends a.A{name="SVGPlugin";install(e){e.addRendererType((()=>new Ra({name:"SvgFeatureRenderer",ReactComponent:Ma,configSchema:Pa,pluginManager:e})))}}const Ia=(0,c.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"}},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"}},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"}},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId",preProcessSnapshot:e=>e.uri?{...e,ixFilePath:{uri:e.uri,baseUri:e.baseUri},ixxFilePath:{uri:`${e.uri}x`,baseUri:e.baseUri}}:e});class Fa extends a.A{name="TrixPlugin";install(e){e.addTextSearchAdapterType((()=>new xr.A({name:"TrixTextSearchAdapter",displayName:"Trix text search adapter",configSchema:Ia,description:"Trix text search adapter",getAdapterClass:()=>r.e(8397).then(r.bind(r,18397)).then((e=>e.default))})))}}var Na=r(49854);const Da=[La,x.Ay,n.Ay,oe,fe,Me.Ay,Ge.A,We.A,It,ir,zt,wr,Ar,Jr,pn,xn,Tn,On,Na.A,Nt.Ay,Vt,ea,ia,Ae,mr,Fa,nr,He,A]},35254:(e,t,r)=>{"use strict";r.d(t,{C$:()=>l,FI:()=>o,JC:()=>s,QZ:()=>i,Rg:()=>u,oG:()=>c,wo:()=>d});var n=r(36422),a=r(23550);function i(e,t,r={}){if(!t)return structuredClone((0,n.getSnapshot)(e));if("string"!=typeof t){if(Array.isArray(t)){const a=t[0];if(t.length>1){const o=t.slice(1);let s=e[a];return!s&&(0,n.isStateTreeNode)(e)&&(0,n.isMapType)((0,n.getType)(e))&&(s=e.get(a)),s?i(s,o,r):void 0}return i(e,a,r)}throw new TypeError("slotPath must be a string or array")}{let a=e[t];if(!a&&(0,n.isStateTreeNode)(e)&&(0,n.isMapType)((0,n.getType)(e))&&(a=e.get(t)),a){const e=a.expr?a.expr.evalSync(r):a;return(0,n.isStateTreeNode)(e)?JSON.parse(JSON.stringify((0,n.getSnapshot)(e))):e}}}function o(e,t,r){const{configuration:n}=e;if(d(n))return i(n,t,r);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if((0,n.isType)(e)&&(e=(0,a.resolveLateType)(e),(0,n.isUnionType)(e))){const t=[];for(let r of(0,a.getUnionSubTypes)(e)){r=(0,a.resolveLateType)(r);let e=s(r);if(e.length||(e=[(0,a.getDefaultValue)(r).type]),!e[0])throw new Error(`invalid config schema type ${r}`);t.push(...e)}return t}return[]}function l(e){if((0,n.isType)(e)){if((0,n.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,n.isLateType)(e))return!0}return!1}function c(e){return!!(0,n.isType)(e)&&(!!l(e)||((0,n.isUnionType)(e)?(0,a.getUnionSubTypes)(e).every((e=>c(e)||"undefined"===e.name)):!(!(0,n.isOptionalType)(e)||!c((0,a.getSubType)(e)))||!(!(0,n.isArrayType)(e)||!c((0,a.getSubType)(e)))||!(!(0,n.isMapType)(e)||!c((0,a.getSubType)(e)))))}function d(e){return(0,n.isStateTreeNode)(e)&&c((0,n.getType)(e))}function u(e){return"object"==typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},35470:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});class n{constructor(e){this.name=e?.name||"UNKNOWN",this.maybeDisplayName=e?.displayName}get displayName(){return this.maybeDisplayName||this.name}}},37205:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(28194),a=r(37962),i=r(75785),o=r(69500);const s=(0,i.n9)()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"}});function l({message:e,severity:t,action:r}){const{classes:i}=s();return(0,o.jsx)(n.A,{severity:t,action:r,classes:{message:i.ellipses},onMouseDown:e=>{e.stopPropagation()},children:(0,o.jsx)(a.A,{title:e,children:(0,o.jsx)("div",{children:e})})})}},37347:(e,t,r)=>{"use strict";function n(){return URL.createObjectURL?.(new Blob)||`${Math.random()}`}function a(e){URL.revokeObjectURL?.(e)}function i(e){if("undefined"==typeof jest&&void 0!==e&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){const t=new XMLHttpRequest;t.open("GET",e,!1);try{t.send(null)}catch(e){throw new Error("aborted")}}}r.d(t,{CF:()=>a,SW:()=>i,y5:()=>n})},37565:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(61282),a=r(73329),i=r(75785),o=r(69500);const s=(0,i.n9)()({dots:{"&::after":{display:"inline-block",content:'""',width:"1em",textAlign:"left",animation:`${a.i7`
      0% {
        content: '';
      }
      25% {
          content: '.';
      }
      50% {
        content: '..';
      }
      75% {
        content: '...';
      }
      `} 1.2s infinite ease-in-out`}}});function l({message:e,variant:t="body2",...r}){const{cx:a,classes:i}=s();return(0,o.jsx)(n.A,{className:a(i.dots,r.className),...r,variant:t,children:e||"Loading"})}},37934:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(7552),a=r(99546),i=r(62266),o=r(61282),s=r(75785),l=r(87770),c=r(69500);const d=(0,s.n9)()((e=>({popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)}})));function u({anchorEl:e,side:t,text:r}){const{classes:n}=d();return(0,c.jsx)(l.Ay,{className:n.popover,classes:{paper:n.paper},open:!0,anchorEl:e,anchorOrigin:{vertical:"top",horizontal:"left"===t?"left":"right"},transformOrigin:{vertical:"bottom",horizontal:"left"===t?"right":"left"},keepMounted:!0,disableRestoreFocus:!0,children:(0,c.jsx)(o.A,{children:r})})}const p=(0,s.n9)()((e=>{const{tertiary:t}=e.palette;return{rubberband:{height:"100%",background:(0,i.X4)(t.light,.7),position:"absolute",zIndex:830,textAlign:"center"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:e.palette.tertiary.contrastText}}}));function g({leftBpOffset:e,rightBpOffset:t,numOfBpSelected:r,left:i,width:s,top:l=0,sticky:d=!1}){const{classes:g}=p(),[h,f]=(0,n.useState)(null);return(0,c.jsxs)(c.Fragment,{children:[h?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(u,{side:"left",anchorEl:h,text:(0,a.stringify)(e)}),(0,c.jsx)(u,{side:"right",anchorEl:h,text:(0,a.stringify)(t)})]}):null,(0,c.jsx)("div",{className:g.rubberband,style:{left:i,width:s},children:r?(0,c.jsx)(o.A,{ref:e=>{f(e)},variant:"h6",className:g.rubberbandText,style:{top:l,position:d?"sticky":void 0},children:(0,a.getBpDisplayStr)(r)}):null})]})}},37957:(e,t,r)=>{"use strict";r.d(t,{WD:()=>o,Yv:()=>l,qn:()=>s});var n=r(44728),a=r(69652);function i(e,t,r,n=!1){if(0===r)return 0;let a;return n?a=t/r-e*e/(r*r):(a=t-e*e/r,r>1&&(a/=r-1)),a<0?0:Math.sqrt(a)}function o(e){return{...e,scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:i(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered}}async function s(e,t){const{start:r,end:i}=e,s={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0};let l=!1;const{scoreMin:c,scoreMax:d,scoreSum:u,scoreSumSquares:p,featureCount:g}=await(0,n._)(t.pipe((0,a.T)(((e,t)=>{const r=t.get("score"),n=t.get("summary"),{scoreMax:a,scoreMin:i}=e;return e.scoreMax=Math.max(a,n?t.get("maxScore"):r),e.scoreMin=Math.min(i,n?t.get("minScore"):r),e.scoreSum+=r,e.scoreSumSquares+=r*r,e.featureCount+=1,l=!0,e}),s)));return l?o({scoreMax:d,scoreMin:c,scoreSum:u,scoreSumSquares:p,featureCount:g,basesCovered:i-r+1}):{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}function l(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},40085:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(7552);function a(){const e=(0,n.useRef)(null),[t,r]=(0,n.useState)({width:void 0,height:void 0});return(0,n.useEffect)((()=>{if(!e.current)return;const t="undefined"!=typeof window&&"ResizeObserver"in window?window.ResizeObserver:void 0;if(!t)return;const n=new t((e=>{r({width:e[0].contentRect.width,height:e[0].contentRect.height})}));return n.observe(e.current),()=>{n.disconnect()}}),[]),[e,t]}},40898:(e,t,r)=>{"use strict";r.r(t),r.d(t,{category10:()=>n,dark2:()=>a,ggplot2Colors3:()=>u,ggplot2Colors4:()=>d,ggplot2Colors5:()=>c,ggplot2Colors6:()=>l,set1:()=>i,set2:()=>o,tableau10:()=>s});const n=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],i=["#377eb8","#e41a1c","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],o=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],s=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],l=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"],c=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"],d=["#F8766D","#7CAE00","#00BFC4","#C77CFF"],u=["#F8766D","#00BA38","#619CFF"]},42498:(e,t,r)=>{"use strict";r.d(t,{A:()=>y,S:()=>m});var n=r(36422),a=r(99546),i=r(43283),o=r(8832);const s={stringArray:n.types.array(n.types.string),stringArrayMap:n.types.map(n.types.array(n.types.string)),numberMap:n.types.map(n.types.number),boolean:n.types.boolean,color:n.types.refinement("Color",n.types.string,(function(){return!0})),integer:n.types.integer,number:n.types.number,string:n.types.string,text:n.types.string,fileLocation:o.FileLocation,frozen:n.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},c=e=>({views:{get valueJSON(){return e.value}}}),d=e=>({views:{get valueJSON(){return JSON.stringify(e.value)}}}),u={fileLocation:d,number:c,integer:c,boolean:c,frozen:d,stringArray:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t){e.value.push(t)},removeAtIndex(t){e.value.splice(t,1)},setAtIndex(t,r){e.value[t]=r}}}),stringArrayMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,r){e.value.set(t,r)},remove(t){e.value.delete(t)},addToKey(t,r){const n=e.value.get(t);if(!n)throw new Error(`${t} not found`);n.push(r)},removeAtKeyIndex(t,r){const n=e.value.get(t);if(!n)throw new Error(`${t} not found`);n.splice(r,1)},setAtKeyIndex(t,r,n){const a=e.value.get(t);if(!a)throw new Error(`${t} not found`);a[r]=n}}}),numberMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,r){e.value.set(t,r)},remove(t){e.value.delete(t)}}})},p=n.types.refinement("JexlString",n.types.string,(e=>e.startsWith("jexl:")));function g(e,{description:t="",model:r,type:o,defaultValue:c,contextVariable:d=[]}){if(!o)throw new Error("type name required");if(r||(r=s[o]),!r)throw new Error(`no builtin config slot type "${o}", and no 'model' param provided`);if(void 0===c)throw new Error("no 'defaultValue' provided");const g=`${e.charAt(0).toUpperCase()}${e.slice(1)}ConfigSlot`;let h=n.types.model(g,{name:n.types.literal(e),description:n.types.literal(t),type:n.types.literal(o),value:n.types.optional(n.types.union(p,r),c)}).volatile((()=>({contextVariable:d}))).views((e=>({get isCallback(){return String(e.value).startsWith("jexl:")}}))).views((e=>({get expr(){if(e.isCallback){const{pluginManager:t}=(0,a.getEnv)(e);return t||"undefined"!=typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,i.A)(String(e.value),t?.jexl)}return{evalSync:()=>e.value}},get valueJSON(){var t;if(!e.isCallback)return t=e.value,t?.toJSON?t.toJSON():`"${t}"`}}))).preProcessSnapshot((r=>"object"==typeof r&&r.name===e?r:{name:e,description:t,type:o,value:r})).postProcessSnapshot((e=>"object"==typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0)).actions((e=>({set(t){e.value=t},reset(){e.value=c},convertToCallback(){e.isCallback||(e.value=`jexl:${e.valueJSON||"''"}`)},convertToValue(){if(e.isCallback){try{const t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(e){}if(e.value=c,!(o in l))throw new Error(`no fallbackDefault defined for type ${o}`);e.value=l[o]}}})));u[o]&&(h=h.extend(u[o]));const f=n.types.optional(h,{name:e,type:o,description:t,value:c});return Object.defineProperty(f,"isJBrowseConfigurationSlot",{value:!0}),f}var h=r(35254);function f(e){return Array.isArray(e)&&0===e.length}function m(e,t,r){const{schemaDefinition:a,options:i}=function(e,t,r={}){if("string"!=typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");let n=t,a=r;return r.baseConfiguration?.jbrowseSchemaDefinition&&(n={...r.baseConfiguration.jbrowseSchemaDefinition,...n},a={...r.baseConfiguration.jbrowseSchemaOptions,...r},a.baseConfiguration=void 0),{schemaDefinition:n,options:a}}(e,t,r),s=function(e,t,r){const a={};let i;if(r.explicitlyTyped&&(a.type=n.types.optional(n.types.literal(e),e)),r.explicitIdentifier&&r.implicitIdentifier)throw new Error(`Cannot have both explicit and implicit identifiers in ${e}`);r.explicitIdentifier?"string"==typeof r.explicitIdentifier?(a[r.explicitIdentifier]=n.types.identifier,i=r.explicitIdentifier):(a.id=n.types.identifier,i="id"):r.implicitIdentifier&&("string"==typeof r.implicitIdentifier?(a[r.implicitIdentifier]=o.ElementId,i=r.implicitIdentifier):(a.id=o.ElementId,i="id"));const s={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:r}};for(const[r,i]of Object.entries(t))if((0,n.isType)(i)&&(0,n.isLateType)(i)||(0,h.oG)(i))a[r]=i;else if("string"==typeof i||"number"==typeof i)s[r]=i;else{if("object"!=typeof i)throw new Error(`invalid configuration schema definition, "${r}" must be either a valid configuration slot definition, a constant, or a nested configuration schema`);if(!i.type)throw new Error(`no type set for config slot ${e}.${r}`);try{a[r]=g(r,i)}catch(t){throw new Error(`invalid config slot definition for ${e}.${r}: ${t}`)}}let l=n.types.model(`${e}ConfigurationSchema`,a).actions((e=>({setSubschema(t,r){if(!(0,h.oG)(a[t]))throw new Error(`${t} is not a subschema, cannot replace`);const i=(0,n.isStateTreeNode)(r)?r:a[t].create(r);return e[t]=i,i}})));Object.keys(s).length&&(l=l.volatile((()=>s))),r.actions&&(l=l.actions(r.actions)),r.views&&(l=l.views(r.views)),r.extend&&(l=l.extend(r.extend));const c=i?{[i]:"placeholderId"}:{},d=r.explicitlyTyped?{type:e,...c}:c,u=(0,n.getSnapshot)(l.create(d));return l=l.postProcessSnapshot((e=>{const t={};let r=!0;for(const[a,i]of Object.entries(e))r&&("object"==typeof u[a]&&"object"==typeof i?JSON.stringify(u[a])!==JSON.stringify(i)&&(r=!1):u[a]!==i&&(r=!1)),void 0!==i&&void 0===s[a]&&("object"!=typeof(n=i)||Array.isArray(n)||null===n||0!==Object.keys(n).length)&&!f(i)&&(t[a]=i);var n;return r?{}:t})),r.preProcessSnapshot&&(l=l.preProcessSnapshot(r.preProcessSnapshot)),n.types.optional(l,d)}(e,a,i);return s.isJBrowseConfigurationSchema=!0,s.jbrowseSchemaDefinition=a,s.jbrowseSchemaOptions=i,s}function y(e){return n.types.union(n.types.reference(e),e)}},42752:(e,t,r)=>{"use strict";r.d(t,{$G:()=>s,Db:()=>l,fK:()=>c});var n=r(68446),a=r(75785),i=r(69500);const o=(0,a.n9)()((e=>({contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.disabled},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}))),s=(0,n.observer)((function({block:e,children:t}){const{classes:r}=o(),{widthPx:n}=e;return(0,i.jsx)("div",{style:{width:n},className:r.contentBlock,children:t})}));function l({width:e}){const{classes:t}=o();return(0,i.jsx)("div",{className:t.elidedBlock,style:{width:e}})}function c({boundary:e,width:t,style:r={}}){const{classes:n}=o();return(0,i.jsx)("div",{style:{...r,width:t},className:e?n.boundaryPaddingBlock:n.interRegionPaddingBlock})}},43283:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(53085);const a={};function i(e,t){const r=`nosig|${e}`;if(!a[r]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");const i=e.split("jexl:")[1],o=t?t.compile(i):(0,n.A)().compile(i);a[r]=o}return a[r]}},43550:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var n=r(28097),a=r(91818),i=r(69092),o=r(61282),s=r(75785),l=r(99546),c=r(91468),d=r(69500);function u(e){return"blobId"in e}const p=(0,s.n9)()((e=>({filename:{marginLeft:e.spacing(1)}}))),g=function({location:e,setLocation:t}){const{classes:r}=p(),s=e&&(u(e)&&e.name||"localPath"in e&&e.localPath),g=e&&u(e)&&!(0,c.getBlob)(e.blobId);return(0,d.jsxs)(n.A,{display:"flex",flexDirection:"row",alignItems:"center",children:[(0,d.jsx)(n.A,{children:(0,d.jsx)(a.A,{fullWidth:!0,children:(0,d.jsxs)(i.A,{variant:"outlined",component:"label",children:["Choose File",(0,d.jsx)("input",{type:"file",hidden:!0,onChange:({target:e})=>{const r=e.files?.[0];if(r)if(l.isElectron){const{webUtils:e}=window.require("electron");t({localPath:e.getPathForFile(r),locationType:"LocalPathLocation"})}else t((0,c.storeBlobLocation)({blob:r}))}})]})})}),(0,d.jsxs)(n.A,{children:[(0,d.jsx)(o.A,{component:"span",className:r.filename,color:s?"initial":"textSecondary",children:s||"No file chosen"}),g?(0,d.jsx)(o.A,{color:"error",children:"(need to reload)"}):null]})]})}},44278:(e,t,r)=>{"use strict";r.d(t,{A:()=>ae});var n=r(7552),a=r.t(n,2),i=r(51414),o=r(62266),s=r(18457),l=r(67485),c=r(90864),d=r(9767),u=r(51097),p=r(72568),g=r(42489),h=r(68446),f=r(36422),m=r(69500),y=r.t(m,2),b=r(28485),w=r.t(b,2),v=r(81886),S=r.t(v,2),C=r(75785),x=r(12678),k=r(68584),T=r(46377),A=r(58921);function M(e,t=""){return Object.fromEntries(Object.entries(e).map((([e,r])=>function(e,t){const r=(0,n.forwardRef)(((e,r)=>(0,m.jsx)(n.Suspense,{fallback:null,children:(0,m.jsx)(t,{...e,ref:r})})));return r.displayName=e,[e,r]}(`${t}${e}`,r))))}const P=M({Attributes:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6430)]).then(r.bind(r,35300)))),FeatureDetails:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6386),r.e(1475),r.e(4144)]).then(r.bind(r,84144)))),BaseCard:(0,n.lazy)((()=>Promise.all([r.e(6386),r.e(7083)]).then(r.bind(r,87083)))),BaseAttributes:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6386),r.e(9912)]).then(r.bind(r,71610)))),BaseCoreDetails:(0,n.lazy)((()=>Promise.all([r.e(6386),r.e(4788)]).then(r.bind(r,94788))))},"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail/"),R={DataGrid:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.DataGrid}))))),GridActionsCellItem:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridActionsCellItem}))))),GridAddIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridAddIcon}))))),GridArrowDownwardIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridArrowDownwardIcon}))))),GridArrowUpwardIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridArrowUpwardIcon}))))),GridCellCheckboxForwardRef:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridCellCheckboxForwardRef}))))),GridCellCheckboxRenderer:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridCellCheckboxRenderer}))))),GridCheckCircleIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridCheckCircleIcon}))))),GridCheckIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridCheckIcon}))))),GridCloseIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridCloseIcon}))))),GridColumnHeaderSeparator:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridColumnHeaderSeparator}))))),GridColumnHeaderSortIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridColumnHeaderSortIcon}))))),GridColumnIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridColumnIcon}))))),GridColumnMenu:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridColumnMenu}))))),GridColumnMenuContainer:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridColumnMenuContainer}))))),GridDragIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridDragIcon}))))),GridExpandMoreIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridExpandMoreIcon}))))),GridFilterAltIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridFilterAltIcon}))))),GridFilterForm:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridFilterForm}))))),GridFilterListIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridFilterListIcon}))))),GridFilterPanel:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridFilterPanel}))))),GridFooter:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridFooter}))))),GridFooterContainer:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridFooterContainer}))))),GridHeader:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridHeader}))))),GridHeaderCheckbox:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridHeaderCheckbox}))))),GridKeyboardArrowRight:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridKeyboardArrowRight}))))),GridLoadIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridLoadIcon}))))),GridLoadingOverlay:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridLoadingOverlay}))))),GridMenuIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridMenuIcon}))))),GridMoreVertIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridMoreVertIcon}))))),GridNoRowsOverlay:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridNoRowsOverlay}))))),GridOverlay:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridOverlay}))))),GridPagination:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridPagination}))))),GridPanel:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridPanel}))))),GridPanelWrapper:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridPanelWrapper}))))),GridRemoveIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridRemoveIcon}))))),GridRoot:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridRoot}))))),GridRowCount:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridRowCount}))))),GridSearchIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridSearchIcon}))))),GridSelectedRowCount:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridSelectedRowCount}))))),GridSeparatorIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridSeparatorIcon}))))),GridTableRowsIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridTableRowsIcon}))))),GridToolbarExportContainer:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridToolbarExportContainer}))))),GridTripleDotsVerticalIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridTripleDotsVerticalIcon}))))),GridViewHeadlineIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridViewHeadlineIcon}))))),GridViewStreamIcon:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6864),r.e(679)]).then(r.bind(r,71839)).then((e=>({default:e.GridViewStreamIcon})))))},L={Accordion:(0,n.lazy)((()=>Promise.all([r.e(6386),r.e(1768)]).then(r.bind(r,81768)))),AccordionActions:(0,n.lazy)((()=>r.e(4781).then(r.bind(r,34781)))),AccordionDetails:(0,n.lazy)((()=>r.e(3106).then(r.bind(r,83106)))),AccordionSummary:(0,n.lazy)((()=>r.e(6192).then(r.bind(r,26192)))),Alert:(0,n.lazy)((()=>r.e(6336).then(r.bind(r,36336)))),AlertTitle:(0,n.lazy)((()=>r.e(5214).then(r.bind(r,5214)))),Autocomplete:(0,n.lazy)((()=>r.e(3766).then(r.bind(r,43766)))),Avatar:(0,n.lazy)((()=>r.e(5703).then(r.bind(r,5703)))),AvatarGroup:(0,n.lazy)((()=>r.e(2901).then(r.bind(r,62901)))),Backdrop:(0,n.lazy)((()=>r.e(2648).then(r.bind(r,2648)))),Badge:(0,n.lazy)((()=>r.e(2969).then(r.bind(r,22969)))),Box:(0,n.lazy)((()=>r.e(6219).then(r.bind(r,56219)))),Breadcrumbs:(0,n.lazy)((()=>r.e(2655).then(r.bind(r,2655)))),Button:(0,n.lazy)((()=>r.e(4646).then(r.bind(r,74646)))),ButtonGroup:(0,n.lazy)((()=>r.e(3669).then(r.bind(r,33669)))),Card:(0,n.lazy)((()=>r.e(9712).then(r.bind(r,9712)))),CardActions:(0,n.lazy)((()=>r.e(1247).then(r.bind(r,71247)))),CardActionArea:(0,n.lazy)((()=>r.e(9883).then(r.bind(r,59883)))),CardContent:(0,n.lazy)((()=>r.e(8853).then(r.bind(r,38853)))),CardHeader:(0,n.lazy)((()=>r.e(7621).then(r.bind(r,97621)))),CardMedia:(0,n.lazy)((()=>r.e(8172).then(r.bind(r,68172)))),CircularProgress:(0,n.lazy)((()=>r.e(1728).then(r.bind(r,1728)))),Collapse:(0,n.lazy)((()=>r.e(1181).then(r.bind(r,71181)))),ClickAwayListener:(0,n.lazy)((()=>r.e(6832).then(r.bind(r,76832)))),Chip:(0,n.lazy)((()=>r.e(6936).then(r.bind(r,16936)))),Checkbox:(0,n.lazy)((()=>r.e(219).then(r.bind(r,80219)))),Container:(0,n.lazy)((()=>r.e(7037).then(r.bind(r,87037)))),Dialog:(0,n.lazy)((()=>r.e(678).then(r.bind(r,30678)))),DialogActions:(0,n.lazy)((()=>r.e(5913).then(r.bind(r,55913)))),DialogTitle:(0,n.lazy)((()=>r.e(5412).then(r.bind(r,85412)))),DialogContent:(0,n.lazy)((()=>r.e(9383).then(r.bind(r,79383)))),DialogContentText:(0,n.lazy)((()=>r.e(8660).then(r.bind(r,88660)))),Divider:(0,n.lazy)((()=>r.e(1035).then(r.bind(r,31035)))),Drawer:(0,n.lazy)((()=>r.e(9421).then(r.bind(r,49421)))),Fab:(0,n.lazy)((()=>r.e(7419).then(r.bind(r,37419)))),Fade:(0,n.lazy)((()=>r.e(2836).then(r.bind(r,92836)))),FilledInput:(0,n.lazy)((()=>r.e(9598).then(r.bind(r,59598)))),FormLabel:(0,n.lazy)((()=>r.e(4446).then(r.bind(r,64446)))),FormControl:(0,n.lazy)((()=>r.e(1).then(r.bind(r,10001)))),FormControlLabel:(0,n.lazy)((()=>r.e(8921).then(r.bind(r,78921)))),FormHelperText:(0,n.lazy)((()=>r.e(6535).then(r.bind(r,6535)))),FormGroup:(0,n.lazy)((()=>r.e(5867).then(r.bind(r,75867)))),Grid:(0,n.lazy)((()=>Promise.all([r.e(2826),r.e(6294)]).then(r.bind(r,46294)))),Grid2:(0,n.lazy)((()=>Promise.all([r.e(2826),r.e(6294)]).then(r.bind(r,46294)))),Grow:(0,n.lazy)((()=>r.e(525).then(r.bind(r,30525)))),Icon:(0,n.lazy)((()=>r.e(4757).then(r.bind(r,84757)))),IconButton:(0,n.lazy)((()=>r.e(7715).then(r.bind(r,87715)))),Input:(0,n.lazy)((()=>r.e(9154).then(r.bind(r,79154)))),InputBase:(0,n.lazy)((()=>r.e(9783).then(r.bind(r,19783)))),InputLabel:(0,n.lazy)((()=>r.e(7924).then(r.bind(r,27924)))),InputAdornment:(0,n.lazy)((()=>r.e(9512).then(r.bind(r,49512)))),Link:(0,n.lazy)((()=>r.e(4542).then(r.bind(r,14542)))),LinearProgress:(0,n.lazy)((()=>r.e(2020).then(r.bind(r,32020)))),List:(0,n.lazy)((()=>r.e(6698).then(r.bind(r,6698)))),ListItem:(0,n.lazy)((()=>r.e(8669).then(r.bind(r,18669)))),ListItemAvatar:(0,n.lazy)((()=>r.e(769).then(r.bind(r,30769)))),ListItemSecondaryAction:(0,n.lazy)((()=>r.e(5831).then(r.bind(r,25831)))),ListItemIcon:(0,n.lazy)((()=>r.e(2336).then(r.bind(r,99955)))),ListSubheader:(0,n.lazy)((()=>r.e(5105).then(r.bind(r,15105)))),ListItemText:(0,n.lazy)((()=>r.e(4370).then(r.bind(r,14370)))),Menu:(0,n.lazy)((()=>r.e(1370).then(r.bind(r,48989)))),MenuItem:(0,n.lazy)((()=>r.e(1386).then(r.bind(r,61386)))),MenuList:(0,n.lazy)((()=>r.e(5438).then(r.bind(r,89409)))),Modal:(0,n.lazy)((()=>r.e(6775).then(r.bind(r,16775)))),NativeSelect:(0,n.lazy)((()=>r.e(9074).then(r.bind(r,9074)))),OutlinedInput:(0,n.lazy)((()=>r.e(7596).then(r.bind(r,17596)))),Pagination:(0,n.lazy)((()=>r.e(1244).then(r.bind(r,11244)))),PaginationItem:(0,n.lazy)((()=>r.e(9689).then(r.bind(r,19689)))),Paper:(0,n.lazy)((()=>r.e(3052).then(r.bind(r,53052)))),Popover:(0,n.lazy)((()=>r.e(7983).then(r.bind(r,77983)))),Popper:(0,n.lazy)((()=>r.e(2464).then(r.bind(r,42464)))),Portal:(0,n.lazy)((()=>r.e(8848).then(r.bind(r,68848)))),Radio:(0,n.lazy)((()=>r.e(8249).then(r.bind(r,58249)))),RadioGroup:(0,n.lazy)((()=>r.e(6352).then(r.bind(r,6352)))),Rating:(0,n.lazy)((()=>r.e(2319).then(r.bind(r,62319)))),ScopedCssBaseline:(0,n.lazy)((()=>r.e(3046).then(r.bind(r,43046)))),Select:(0,n.lazy)((()=>r.e(7182).then(r.bind(r,27182)))),Skeleton:(0,n.lazy)((()=>r.e(1889).then(r.bind(r,81889)))),Slider:(0,n.lazy)((()=>r.e(3091).then(r.bind(r,63091)))),Snackbar:(0,n.lazy)((()=>Promise.all([r.e(2524),r.e(8557)]).then(r.bind(r,98557)))),SnackbarContent:(0,n.lazy)((()=>r.e(1038).then(r.bind(r,61038)))),SpeedDial:(0,n.lazy)((()=>r.e(8405).then(r.bind(r,48405)))),SpeedDialAction:(0,n.lazy)((()=>r.e(4832).then(r.bind(r,24832)))),SpeedDialIcon:(0,n.lazy)((()=>r.e(4350).then(r.bind(r,4350)))),Stack:(0,n.lazy)((()=>r.e(9822).then(r.bind(r,49822)))),Step:(0,n.lazy)((()=>r.e(9680).then(r.bind(r,49680)))),StepButton:(0,n.lazy)((()=>r.e(7565).then(r.bind(r,67565)))),StepConnector:(0,n.lazy)((()=>r.e(5415).then(r.bind(r,25415)))),StepLabel:(0,n.lazy)((()=>r.e(5402).then(r.bind(r,35402)))),StepIcon:(0,n.lazy)((()=>r.e(7857).then(r.bind(r,7857)))),Stepper:(0,n.lazy)((()=>r.e(6563).then(r.bind(r,46563)))),SvgIcon:(0,n.lazy)((()=>r.e(4353).then(r.bind(r,14353)))),Switch:(0,n.lazy)((()=>r.e(2814).then(r.bind(r,22814)))),Tab:(0,n.lazy)((()=>r.e(361).then(r.bind(r,30361)))),Table:(0,n.lazy)((()=>r.e(4418).then(r.bind(r,34418)))),TableBody:(0,n.lazy)((()=>r.e(462).then(r.bind(r,40462)))),TableCell:(0,n.lazy)((()=>r.e(1874).then(r.bind(r,91874)))),TableContainer:(0,n.lazy)((()=>r.e(6381).then(r.bind(r,66381)))),TableFooter:(0,n.lazy)((()=>r.e(7979).then(r.bind(r,27979)))),TableHead:(0,n.lazy)((()=>r.e(4288).then(r.bind(r,54288)))),TablePagination:(0,n.lazy)((()=>Promise.all([r.e(238),r.e(1741)]).then(r.bind(r,70818)))),TableRow:(0,n.lazy)((()=>r.e(6038).then(r.bind(r,66038)))),TableSortLabel:(0,n.lazy)((()=>r.e(5050).then(r.bind(r,25050)))),Tabs:(0,n.lazy)((()=>r.e(6764).then(r.bind(r,36764)))),TextField:(0,n.lazy)((()=>r.e(6631).then(r.bind(r,66631)))),TextareaAutosize:(0,n.lazy)((()=>r.e(7898).then(r.bind(r,77898)))),ToggleButton:(0,n.lazy)((()=>r.e(8782).then(r.bind(r,38782)))),ToggleButtonGroup:(0,n.lazy)((()=>r.e(8821).then(r.bind(r,41202)))),Toolbar:(0,n.lazy)((()=>r.e(8945).then(r.bind(r,78945)))),Tooltip:(0,n.lazy)((()=>r.e(1113).then(r.bind(r,81113)))),Typography:(0,n.lazy)((()=>r.e(3503).then(r.bind(r,13503))))},I=["mobx","mobx-state-tree","react","react/jsx-runtime","react-dom","react-dom/client","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react/mui","@material-ui/core","@mui/material","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/AccordionSummary","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grid2","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/AccordionSummary","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grid2","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/ui/theme","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"];var F=r(47369),N=r(56328),D=r(58273),B=r(63589),V=r(67736),j=r(1622),E=r(98111),z=r(94318),O=r(92880),H=r(95742),G=r(198),W=r(67112),$=r(75397),U=r(99546),q=r(97884),_=r(80208),J=r(99834),X=r(88217),Y=r(23550),K=r(66885),Q=r(91468),Z=r(8832);const ee={mobx:g,"mobx-state-tree":f,react:a,"react/jsx-runtime":y,"react-dom":w,"react-dom/client":S,"mobx-react":h,"@mui/x-data-grid":{useGridApiContext:d.h,useGridApiRef:u.b,useGridRootProps:p.A,...M(R,"@mui/x-data-grid/")},"@mui/material/utils":c,"@material-ui/core/utils":c,"tss-react/mui":{makeStyles:C.n9},"@material-ui/core":{...M(L),useTheme:i.A,alpha:o.X4,makeStyles:e=>{const t=(0,C.n9)()(e);return()=>t().classes}},"@mui/material":{...M(L),alpha:o.X4,useTheme:i.A,createTheme:s.A},...M(L,"@mui/material/"),...M(L,"@material-ui/core/"),"@mui/material/styles":{...l,makeStyles:e=>{const t=(0,C.n9)()(e);return()=>t().classes}},"@material-ui/core/styles":{...l,makeStyles:e=>{const t=(0,C.n9)()(e);return()=>t().classes}},"@material-ui/lab/ToggleButton":L.ToggleButton,"@material-ui/lab/ToggleButtonGroup":L.ToggleButtonGroup,"@material-ui/lab/Autocomplete":L.Autocomplete,"@material-ui/lab/Alert":L.Alert,"@material-ui/lab":{Alert:L.Alert,Autocomplete:L.Autocomplete,ToggleButton:L.ToggleButton,ToggleButtonGroup:L.ToggleButtonGroup},"@jbrowse/core/Plugin":x.A,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":H,"@jbrowse/core/configuration":k,"@jbrowse/core/util/types/mst":Z,"@jbrowse/core/ui":W,"@jbrowse/core/ui/theme":$,"@jbrowse/core/util":U,"@jbrowse/core/util/color":_,"@jbrowse/core/util/layouts":X,"@jbrowse/core/util/tracks":Q,"@jbrowse/core/util/Base1DViewModel":q.A,"@jbrowse/core/util/io":J,"@jbrowse/core/util/mst-reflection":Y,"@jbrowse/core/util/rxjs":K,"@jbrowse/core/pluggableElementTypes":A,"@jbrowse/core/pluggableElementTypes/ViewType":B.A,"@jbrowse/core/pluggableElementTypes/AdapterType":F.A,"@jbrowse/core/pluggableElementTypes/DisplayType":N.A,"@jbrowse/core/pluggableElementTypes/TrackType":D.A,"@jbrowse/core/pluggableElementTypes/WidgetType":V.A,"@jbrowse/core/pluggableElementTypes/models":j,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":G,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":z.A,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":E,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":O,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":P,"@jbrowse/core/data_adapters/BaseAdapter":T},te=Object.keys(ee),re=te.filter((e=>!I.includes(e)));if(re.length>0)throw new Error(`The following modules are in the modules libs, but not the re-exports list: ${re.join(", ")}`);const ne=I.filter((e=>!te.includes(e)));if(ne.length)throw new Error(`The following modules are in the re-exports list, but not the modules libs: ${ne.join(", ")}`);const ae=ee},46377:(e,t,r)=>{"use strict";function n(e){return"getRegions"in e&&"getFeatures"in e}function a(e){return"getRegions"in e}function i(e){return"getFeatures"in e}function o(e){return"getRefNameAliases"in e}function s(e){return"searchIndex"in e}r.r(t),r.d(t,{BaseAdapter:()=>p,BaseFeatureDataAdapter:()=>v,BaseSequenceAdapter:()=>S,isFeatureAdapter:()=>i,isRefNameAliasAdapter:()=>o,isRegionsAdapter:()=>a,isSequenceAdapter:()=>n,isTextSearchAdapter:()=>s});var l=r(36422),c=r(68584),d=r(26257);const u=(0,c.ConfigurationSchema)("empty",{});class p{static capabilities=[];constructor(e=u.create(),t,r){if(this.config=e,this.getSubAdapter=t,this.pluginManager=r,"undefined"==typeof jest){const t=(0,l.isStateTreeNode)(e)?(0,l.getSnapshot)(e):e;this.id=`${(0,d.A)(t)}`}else this.id="test"}getConf(e){return(0,c.readConfObject)(this.config,e)}freeResources(e){}}var g=r(62718),h=r(44728),f=r(82088),m=r(99546),y=r(66885),b=r(37957),w=r(37347);class v extends p{async getHeader(e){return null}async getMetadata(e){return null}getFeaturesInRegion(e,t={}){return(0,y.ObservableCreate)((async r=>{const n=await this.hasDataForRefName(e.refName,t);(0,w.SW)(t.stopToken),n?this.getFeatures(e,t).subscribe(r):r.complete()}))}getFeaturesInMultipleRegions(e,t={}){return(0,g.h)(...e.map((e=>this.getFeaturesInRegion(e,t))))}async hasDataForRefName(e,t={}){return(await this.getRefNames(t)).includes(e)}async getRegionQuantitativeStats(e,t){const r=this.getFeatures(e,t);return(0,b.qn)(e,r)}async getMultiRegionQuantitativeStats(e=[],t){if(!e.length)return(0,b.Yv)();const r=await Promise.all(e.map((e=>this.getRegionQuantitativeStats(e,t)))),n=(0,m.max)(r.map((e=>e.scoreMax))),a=(0,m.min)(r.map((e=>e.scoreMin))),i=(0,m.sum)(r.map((e=>e.scoreSum))),o=(0,m.sum)(r.map((e=>e.scoreSumSquares))),s=(0,m.sum)(r.map((e=>e.featureCount))),l=(0,m.sum)(r.map((e=>e.basesCovered)));return(0,b.WD)({scoreMin:a,scoreMax:n,featureCount:s,basesCovered:l,scoreSumSquares:o,scoreSum:i})}getRegionFeatureDensityStats(e,t){let r=+Date.now();const n=async(r,n)=>{const{start:i,end:o}=e,s=.75*i+.25*o,l=await(0,h._)(this.getFeatures({...e,start:Math.max(0,Math.round(s-r/2)),end:Math.min(Math.round(s+r/2),o)},t).pipe((0,f.$)()));return a({interval:r,statsSampleFeatures:l.length,expansionTime:n,stats:{featureDensity:l.length/r}})},a=async({interval:t,stats:a,statsSampleFeatures:i,expansionTime:o})=>{const s=e.end-e.start;if(i>=70||2*t>s)return a;if(o<=5e3){const e=+Date.now();return o+=e-r,r=e,n(2*t,o)}return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:Number.POSITIVE_INFINITY}};return n(1e3,0)}async getMultiRegionFeatureDensityStats(e,t){if(!e.length)throw new Error("No regions supplied");return this.getRegionFeatureDensityStats(e[0],t)}async getSources(e){const t=await(0,h._)(this.getFeaturesInMultipleRegions(e).pipe((0,f.$)())),r=new Set;for(const e of t)r.add(e.get("source"));return[...r].map((e=>({name:e})))}}class S extends v{async getMultiRegionFeatureDensityStats(){return{featureDensity:0}}}},47369:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{constructor(e){super(e),this.getAdapterClass="AdapterClass"in e?async()=>e.AdapterClass:e.getAdapterClass,this.configSchema=e.configSchema,this.adapterCapabilities=e.adapterCapabilities||[],this.adapterMetadata=e.adapterMetadata}}},48133:(e,t,r)=>{"use strict";r.d(t,{DO:()=>R,dg:()=>D,kO:()=>I,Ay:()=>B});var n=r(12678),a=r(99546),i=r(53683),o=r(7552),s=r(63589),l=r(68584),c=r(1622),d=r(90542),u=r(41718),p=r(34727),g=r(45465),h=r(42489),f=r(36422);function m(e,t,r,n,a){const i=Math.abs(e-r);if(i>n)return;i===n&&a.push([t,e]);const o=Math.sqrt(n*n-i*i);a.push([t-o,e],[t+o,e])}function y(e,t,r,n,a){const i=Math.abs(e-t);if(i>n)return;i===n&&a.push([e,r]);const o=Math.sqrt(n*n-i*i);a.push([e,r-o],[e,r+o])}function b(e,t){const r=Math.sqrt(e*e+t*t);if(0===r)return[0,0];const n=function(e,t){let r=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?r+=Math.PI:r-=Math.PI),r}(e,t);return[r,n]}const w=2*Math.PI;class v{constructor(e,t,r,n){this.region=t,this.offsetRadians=r,this.radianWidth=n;const{bpPerRadian:i}=e;this.key="regions"in t?JSON.stringify(t.regions):(0,a.assembleLocString)(t),this.bpPerRadian=i,this.flipped=!1,this.startRadians=r,this.endRadians=t.widthBp/this.bpPerRadian+r,Object.freeze(this)}bpToXY(e,t){let r;r=this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start;const n=r/this.bpPerRadian+this.offsetRadians;return(0,a.polarToCartesian)(t,n)}toJSON(){return Object.fromEntries(Object.entries(this))}}const S=(0,o.lazy)((()=>r.e(5243).then(r.bind(r,15243)))),C=function(e){return f.types.compose("CircularView",c.BaseViewModel,f.types.model({type:f.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:200,tracks:f.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:f.types.optional(f.types.number,400),displayedRegions:f.types.optional(f.types.frozen(),[]),scrollX:0,scrollY:0,minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,trackSelectorType:"hierarchical"})).volatile((()=>({volatileWidth:void 0,error:void 0}))).views((e=>({get width(){if(void 0===e.volatileWidth)throw new Error("wait for view to be initialized first before accessing width");return e.volatileWidth},get visibleSection(){const{scrollX:t,scrollY:r,width:n,height:a}=e;return function(e,t,r){let[n,a,i,o]=e;const[s,l]=t;if(n-=s,a-=s,i-=l,o-=l,n<0&&a>0&&i<0&&o>0){const e=[[n,i],[a,i],[n,o],[a,o]];let t=Number.NEGATIVE_INFINITY;for(const[r,n]of e){const e=Math.sqrt(r*r+n*n);e>t&&(t=e)}return{rho:[0,Math.min(r,t)],theta:[0,2*Math.PI]}}const c=[[n,i],[a,i],[n,o],[a,o]];y(n,0,0,r,c),y(a,0,0,r,c),m(i,0,0,r,c),m(o,0,0,r,c),-n<r&&c.push([n,0]),a<r&&c.push([a,0]),-i<r&&c.push([0,i]),o<r&&c.push([0,o]);const d=n>=0?-1:1;let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(const[e,t]of c)if(e>=n&&e<=a&&t>=i&&t<=o){const[n,a]=b(e*d,t*d);n<=r+.001&&(a<g&&n>1e-4&&(g=a),a>h&&n>1e-4&&(h=a),n<u&&(u=n),n>p&&(p=n))}return-1===d&&(g+=Math.PI,h+=Math.PI),g>2*Math.PI&&h>2*Math.PI&&(g-=2*Math.PI,h-=2*Math.PI),{rho:[u,Math.min(r,p)],theta:[g,h]}}([t,t+n,r,r+a],this.centerXY,this.radiusPx)},get circumferencePx(){let t=0;for(const e of this.elidedRegions)t+=e.widthBp;return t/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){let t=0;for(const r of e.displayedRegions)t+=r.end-r.start;return t},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){const t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){const e=2*Math.PI*this.maximumRadiusPx;return(0,a.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){const t=[];for(const r of e.displayedRegions){const n=r.end-r.start;if(n/e.bpPerPx<e.minVisibleWidth){const e=t.at(-1);e?.elided?(e.regions.push({...r}),e.widthBp+=n):t.push({elided:!0,widthBp:n,regions:[{...r}]})}else t.push({...r,widthBp:n,elided:!1})}for(let e=0;e<t.length;e+=1){const r=t[e];r.elided&&1===r.regions.length&&(t[e]={...r,...r.regions[0],elided:!1})}return t},get assemblyNames(){const t=[];for(const r of e.displayedRegions)t.includes(r.assemblyName)||t.push(r.assemblyName);return t},get initialized(){const{assemblyManager:t}=(0,a.getSession)(e);return void 0!==e.volatileWidth&&this.assemblyNames.every((e=>t.get(e)?.initialized))}}))).views((e=>({get staticSlices(){return function(e){const t=[];let r=0;const{bpPerRadian:n,spacingPx:a,pxPerRadian:i}=e;for(const o of e.elidedRegions){const s=o.widthBp/n+a/i;t.push(new v(e,o,r,s)),r+=s}return t}(e)}}))).views((e=>({get visibleStaticSlices(){return e.staticSlices.filter((t=>function(e,t){const{theta:[r,n]}=e.visibleSection;return a=t.offsetRadians+e.offsetRadians,o=r,s=n-r,!((i=t.radianWidth)<=0||s<=0)&&(i+1e-4>=w||s+1e-4>=w||(a=(a%w+w)%w+w)<(o=(o%w+w)%w+w)+s&&a+i>o||a<(o-=w)+s&&a+i>o||a<(o+=w+w)+s&&a+i>o);var a,i,o,s}(e,t)))}}))).actions((t=>({setWidth:e=>(t.volatileWidth=Math.max(e,100),t.volatileWidth),setHeight:e=>(t.height=Math.max(e,40),t.height),resizeHeight(e){const r=t.height,n=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),n-r},resizeWidth(e){const r=t.width,n=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),n-r},rotateClockwiseButton(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise(e=.17){t.offsetRadians+=e},rotateCounterClockwise(e=.17){t.offsetRadians-=e},zoomInButton(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx(e){t.bpPerPx=(0,a.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},setDisplayedRegions(e){const r=0===t.displayedRegions.length;t.displayedRegions=(0,f.cast)(e),r?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector(){if("hierarchical"===t.trackSelectorType){const e=(0,a.getSession)(t);if((0,a.isSessionModelWithWidgets)(e)){const r=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(r),r}}throw new Error(`invalid track selector type ${t.trackSelectorType}`)},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setError(e){t.error=e},showTrack(r,n={}){const a=e.pluggableConfigSchemaType("track"),i=(0,f.resolveIdentifier)(a,(0,f.getRoot)(t),r),o=e.getTrackType(i.type);if(!o)throw new Error(`unknown track type ${i.type}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=i.displays.find((e=>l.has(e.type))),d=o.stateModel.create({...n,type:i.type,configuration:i,displays:[{type:c.type,configuration:c}]});t.tracks.push(d)},addTrackConf(r,n={}){const{type:a}=r,i=(0,l.readConfObject)(r,"name"),o=e.getTrackType(a);if(!o)throw new Error(`unknown track type ${a}`);const s=e.getViewType(t.type),c=new Set(s.displayTypes.map((e=>e.name))),d=r.displays.find((e=>c.has(e.type)));t.tracks.push(o.stateModel.create({...n,name:i,type:a,configuration:r,displays:[{type:d.type,configuration:d}]}))},hideTrack(r){const n=e.pluggableConfigSchemaType("track"),a=(0,f.resolveIdentifier)(n,(0,f.getRoot)(t),r),i=t.tracks.filter((e=>e.configuration===a));return(0,h.transaction)((()=>{for(const e of i)t.tracks.remove(e)})),i.length},toggleFitToWindowLock(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow},async exportSvg(e={}){const{renderToSvg:n}=await r.e(311).then(r.bind(r,60311)),a=await n(t,e),i=new Blob([a],{type:"image/svg+xml"});(0,g.saveAs)(i,e.filename||"image.svg")}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>{e.setDisplayedRegions([])},icon:u.A},{label:"Export SVG",icon:p.A,onClick:()=>{(0,a.getSession)(e).queueDialog((t=>[S,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:d.xU}]})))};var x=r(68446),k=r(69500);const T=(0,x.observer)((function({model:e}){const{renderProps:{radius:t},error:r}=e;return(0,k.jsxs)("g",{children:[(0,k.jsx)("defs",{children:(0,k.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,k.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}})})}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"#ffb4b4"}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),(0,k.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:String(r)})]})})),A=T,M=(0,r(75785).n9)()((e=>{const{primary:t,secondary:r,tertiary:n,quaternary:a}=e.palette;return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash 1.4s ease-in-out infinite, $colors 5.6s ease-in-out infinite"},"@keyframes colors":{"0%":{stroke:t.light},"25%":{stroke:r.light},"50%":{stroke:n.light},"75%":{stroke:a.light},"100%":{stroke:t.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}})),P=(0,x.observer)((function({model:{renderProps:{radius:e}}}){const{classes:t}=M(),[r,n]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const e=setTimeout((()=>{n(!0)}),400);return()=>{clearTimeout(e)}})),r?(0,k.jsxs)("g",{children:[(0,k.jsx)("defs",{children:(0,k.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,k.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}})})}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:e,fill:"#f1f1f1"}),(0,k.jsx)("circle",{cx:"0",cy:"0",r:e,fill:"url(#diagonalHatch)"}),(0,k.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:"Loading…"}),(0,k.jsx)("circle",{className:t.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})]}):null})),R=(0,x.observer)((function({display:e}){return e.error?(0,k.jsx)(A,{model:e}):e.filled?e.reactElement:(0,k.jsx)(P,{model:e})}));var L=r(91468);const I=(0,l.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"});function F(e){const t=(0,a.getContainingView)(e),{rendererType:r}=e,{rpcManager:n}=(0,a.getSession)(t);return{rendererType:r,rpcManager:n,renderProps:e.renderProps(),renderArgs:{assemblyName:t.displayedRegions[0].assemblyName,adapterConfig:structuredClone(e.adapterConfig),rendererType:r.name,regions:structuredClone(t.displayedRegions),blockDefinitions:e.blockDefinitions,sessionId:(0,L.getRpcSessionId)(e),timeout:1e6}}}async function N(e,t){if(!e)throw new Error("cannot render with no props");const{rendererType:r,rpcManager:n,cannotBeRenderedReason:a,renderArgs:i,renderProps:o,exportSVG:s}=e;if(a)return{message:a};if(!o.radius||!i.regions?.length)return{message:"Skipping render"};const{html:l,...c}=await r.renderInClient(n,{...i,...o,exportSVG:s,stopToken:t});return{html:l,data:c,reactElement:c.reactElement,renderingComponent:r.ReactComponent}}const D=f.types.compose("BaseChordDisplay",c.BaseDisplay,f.types.model({bezierRadiusRatio:.1,assemblyName:f.types.maybe(f.types.string),configuration:(0,l.ConfigurationReference)(I)})).volatile((()=>({filled:!1,reactElement:void 0,data:void 0,html:void 0,message:"",renderingComponent:void 0,refNameMap:void 0}))).actions((e=>{const{pluginManager:t}=(0,a.getEnv)(e),r=e;return{onChordClick(n){(0,l.getConf)(e,"onChordClick",{feature:n,track:r,pluginManager:t})}}})).views((e=>({get blockDefinitions(){const t=(0,a.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;const r=structuredClone(t);for(const t of r){const r=t.region.elided?t.region.regions:[t.region];for(const t of r){const r=e.refNameMap[t.refName];r&&t.refName!==r&&(t.refName=r)}}return r},renderProps(){const t=(0,a.getContainingView)(e);return{...(0,L.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick}},get rendererType(){return(0,a.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName)},get selectedFeatureId(){if(!(0,f.isAlive)(e))return;const{selection:t}=(0,a.getSession)(e);return(0,a.isFeature)(t)?t.id():void 0}}))).actions((e=>({renderStarted(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess({message:t,data:r,reactElement:n,html:a,renderingComponent:i}){t?(e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=n,e.data=r,e.html=a,e.error=void 0,e.renderingComponent=i)},renderError(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.html=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap(t){e.refNameMap=t}}))).actions((e=>({afterAttach(){(0,a.makeAbortableReaction)(e,F,N,{name:`${e.type} ${e.id} rendering`,fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,a.makeAbortableReaction)(e,(()=>({assemblyNames:(0,L.getTrackAssemblyNames)(e.parentTrack),adapter:(0,l.getConf)((0,f.getParent)(e,2),"adapter"),assemblyManager:(0,a.getSession)(e).assemblyManager})),(async(t,r)=>t?t.assemblyManager.getRefNameMapForAdapter(t.adapter,t.assemblyNames[0],{stopToken:r,sessionId:(0,L.getRpcSessionId)(e)}):void 0),{name:`${e.type} ${e.id} getting refNames`,fireImmediately:!0},(()=>{}),(t=>{t&&e.setRefNameMap(t)}),(t=>{console.error(t),e.setError(t)}))}}))).views((e=>({async renderSvg(t){const r=F(e),n=await N({...r,exportSVG:t,theme:t.theme||r.renderProps.theme});return(0,k.jsx)(a.ReactRendering,{rendering:n})}})));class B extends n.A{name="CircularViewPlugin";install(e){!function(e){e.addViewType((()=>new s.A({ReactComponent:(0,o.lazy)((()=>Promise.all([r.e(2826),r.e(7363)]).then(r.bind(r,37363)))),stateModel:C(e),name:"CircularView",displayName:"Circular view"})))}(e),function(e){e.addToExtensionPoint("LaunchView-CircularView",(async({session:e,assembly:t,tracks:r=[]})=>{const{assemblyManager:n}=e,a=e.addView("CircularView",{});if(await(0,h.when)((()=>a.initialized)),!t)throw new Error("No assembly provided when launching circular genome view");const i=await n.waitForAssembly(t);if(!i)throw new Error(`Assembly "${t}" not found when launching circular genome view`);a.setDisplayedRegions(i.regions||[]);for(const e of r)a.showTrack(e)}))}(e)}configure(e){(0,a.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:i.A,onClick:e=>{e.addView("CircularView",{})}})}}},49256:(e,t,r)=>{"use strict";function n(e,t){let r=0,n=0,a=0;const i=[];for(let o=0;o<e.length&&a<t.length;o+=2){const s=+e[o],l=e[o+1];if("S"===l||"I"===l){for(let e=0;e<s&&a<t.length;e++)t[a]===r+e&&a++;r+=s}else if("D"===l||"N"===l)n+=s;else if("M"===l||"X"===l||"="===l){for(let e=0;e<s&&a<t.length;e++)t[a]===r+e&&(i.push({ref:n+e,idx:a}),a++);r+=s,n+=s}}return i}r.d(t,{h:()=>n})},49473:(e,t,r)=>{"use strict";r.d(t,{E6:()=>u,Ec:()=>d,JV:()=>y,NI:()=>f,Tp:()=>c,_u:()=>m,eW:()=>l,y$:()=>p});var n=r(7552),a=r(68584),i=r(99546);const[,o,,s]=[0,1,2,3];function l(e,t,r,n){return n?n(t,r):e[r].trackRefs[t]?.getBoundingClientRect().top||0}function c(e,t,r){return(e.bpToPx({refName:t,coord:r})?.offsetPx||0)-e.offsetPx}function d(e,t,r,n,a,c){const d=n[t].displays[0],u=d.height;let p=0;const{SNPCoverageDisplay:g}=d;g&&(p=g.height);const h=c?0:d.scrollTop;return(0,i.clamp)(a[o]-h+((f=a)[s]-f[o])/2+p,0,u)+l(r,e,t,c)+d.scrollTop;var f}const u=e=>{const[,t]=(0,n.useState)();(0,n.useEffect)((()=>{t(e)}),[e])};function p(e,t=[],r=[],...n){const a=new Set(r.map((t=>e(t)))),i=t.filter((t=>a.has(e(t))));return 0===n.length?i:p(e,i,...n)}const g=new RegExp(/(\d+)[SH]$/),h=new RegExp(/^(\d+)([SH])/);function f(e,t){return-1===t?+(g.exec(e)||[])[1]||0:+(h.exec(e)||[])[1]||0}function m(e,t){return e.displays[0].searchFeatureByID?.(t.id())}async function y(e,t){const{views:r}=e,{rpcManager:n,assemblyManager:o}=(0,i.getSession)(e),s=e.views[0]?.assemblyNames[0];if(!s)return;if(!await o.waitForAssembly(s))return;const l=t.configuration.trackId;return Promise.all(r.map((async e=>(await n.call(l,"CoreGetFeatures",{adapterConfig:(0,a.getConf)(t,["adapter"]),sessionId:l,regions:e.staticBlocks.contentBlocks})).flat())))}},49854:(e,t,r)=>{"use strict";r.d(t,{_:()=>Te.A,A:()=>Ae});var n=r(12678),a=r(56328),i=r(48133),o=r(68584),s=r(36422);var l=r(99546),c=r(91468);var d=r(97486);function u(e){return s.types.compose("LinearVariantDisplay",(0,d.bN)(e),s.types.model({type:s.types.literal("LinearVariantDisplay"),configuration:(0,o.ConfigurationReference)(e)})).actions((e=>({async selectFeature(t){const r=(0,l.getSession)(e);if((0,l.isSessionModelWithWidgets)(r)){const{rpcManager:n}=r,a=(0,c.getRpcSessionId)(e),i=(0,l.getContainingTrack)(e),s=(0,l.getContainingView)(e),d=(0,o.getConf)(i,"adapter"),u=await n.call(a,"CoreGetMetadata",{adapterConfig:d});r.showWidget(r.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:s,track:i,descriptions:u}))}r.setSelection(t)}})))}var p=r(7552),g=r(93100),h=r(37347),f=r(18662),m=r(39928),y=r(85857),b=r(71736),w=r(20482),v=r(41365),S=r.n(v);function C({sources:e,layout:t=e,renderingMode:r,sampleInfo:n}){const a=[],i=Object.fromEntries(e.map((e=>[e.name,e])));for(const e of t)if("phased"===r){const t=n?.[e.name];if(t?.isPhased){const r=t.maxPloidy;for(let t=0;t<r;t++){const r=`${e.name} HP${t}`;a.push({...i[e.name],...e,label:r,HP:t,id:r})}}}else a.push({...i[e.name],...e,label:e.name,id:e.name});return a}const x=(0,p.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(3100),r.e(6395),r.e(8751)]).then(r.bind(r,38751)))),k=(0,p.lazy)((()=>r.e(8407).then(r.bind(r,38407)))),T=(0,p.lazy)((()=>r.e(7239).then(r.bind(r,87239)))),A=(0,p.lazy)((()=>r.e(551).then(r.bind(r,90551)))),M=(0,p.lazy)((()=>r.e(1204).then(r.bind(r,21204))));function P(e){return s.types.compose("LinearVariantMatrixDisplay",(0,d.Gx)(e),s.types.model({type:s.types.literal("LinearVariantMatrixDisplay"),layout:s.types.optional(s.types.frozen(),[]),configuration:(0,o.ConfigurationReference)(e),minorAlleleFrequencyFilter:s.types.optional(s.types.number,0),showSidebarLabelsSetting:!0,renderingMode:s.types.optional(s.types.string,"alleleCount"),rowHeightSetting:s.types.optional(s.types.number,8),autoHeight:!0,lengthCutoffFilter:Number.MAX_SAFE_INTEGER,jexlFilters:s.types.maybe(s.types.array(s.types.string)),referenceDrawingMode:"skip"})).volatile((()=>({sourcesLoadingStopToken:void 0,simplifiedFeaturesStopToken:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0,featuresVolatile:void 0,hasPhased:!1,sampleInfo:void 0,hoveredGenotype:void 0}))).actions((e=>({setJexlFilters(t){e.jexlFilters=(0,s.cast)(t)},setRowHeight(t){e.rowHeightSetting=t},setHoveredGenotype(t){e.hoveredGenotype=t},setFeatures(t){e.featuresVolatile=t},setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSourcesLoading(t){e.sourcesLoadingStopToken&&(0,h.CF)(e.sourcesLoadingStopToken),e.sourcesLoadingStopToken=t},setSimplifiedFeaturesLoading(t){e.simplifiedFeaturesStopToken&&(0,h.CF)(e.simplifiedFeaturesStopToken),e.simplifiedFeaturesStopToken=t},setSources(t){S()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setMafFilter(t){e.minorAlleleFrequencyFilter=t},setShowSidebarLabels(t){e.showSidebarLabelsSetting=t},setPhasedMode(t){e.renderingMode=t},setAutoHeight(t){e.autoHeight=t},setHasPhased(t){e.hasPhased=t},setSampleInfo(t){S()(t,e.sampleInfo)||(e.sampleInfo=t)},setReferenceDrawingMode(t){e.referenceDrawingMode=t}}))).views((e=>({get activeFilters(){return e.jexlFilters??(0,o.getConf)(e,"jexlFilters").map((e=>`jexl:${e}`))},get preSources(){return e.layout.length?e.layout:e.sourcesVolatile},get sourcesWithoutLayout(){return e.sourcesVolatile?C({sources:e.sourcesVolatile,renderingMode:e.renderingMode,sampleInfo:e.sampleInfo}):void 0},get sources(){const t=e.layout.length?e.layout:e.sourcesVolatile;return t?C({sources:t,renderingMode:e.renderingMode,sampleInfo:e.sampleInfo}):void 0}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{get sourceMap(){return e.sources?Object.fromEntries(e.sources.map((e=>[e.name,e]))):void 0},get rowHeight(){const{sources:t,autoHeight:r,rowHeightSetting:n,height:a}=e;return r?a/(t?.length||1):n},adapterProps:()=>({...r(),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig}),trackMenuItems:()=>[...t(),{label:"Show sidebar labels",icon:w.A,type:"checkbox",checked:e.showSidebarLabelsSetting,onClick:()=>{e.setShowSidebarLabels(!e.showSidebarLabelsSetting)}},{label:"Row height",icon:y.A,subMenu:[{label:"Manually set row height",disabled:e.autoHeight,onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[M,{model:e,handleClose:t}]))}},{label:"Auto-adjust to display height",type:"checkbox",checked:e.autoHeight,onClick:()=>{e.setAutoHeight(!e.autoHeight)}}]},{label:"Rendering mode",icon:b.A,subMenu:[{label:"Allele count",type:"radio",checked:"alleleCount"===e.renderingMode,onClick:()=>{e.setPhasedMode("alleleCount")}},{label:"Phased"+(e.hasPhased?"":" (disabled, no phased variants found)"),disabled:!e.hasPhased,checked:"phased"===e.renderingMode,type:"radio",onClick:()=>{e.setPhasedMode("phased")}}]},{label:"Reference mode",type:"subMenu",subMenu:[{label:"Fill background grey, skip reference allele mouseovers (helps with large overlapping SVs)",type:"radio",checked:"skip"===e.referenceDrawingMode,onClick:()=>{e.setReferenceDrawingMode("skip")}},{label:"Don't fill background grey, only draw actual reference alleles as grey",type:"radio",checked:"draw"===e.referenceDrawingMode,onClick:()=>{e.setReferenceDrawingMode("draw")}}]},{label:"Filter by",icon:m.A,subMenu:[{label:"Minor allele frequency",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[k,{model:e,handleClose:t}]))}},{label:"Edit filters",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[T,{model:e,handleClose:t}]))}}]},{label:"Cluster by genotype",icon:f.A,onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[A,{model:e,handleClose:t}]))}},{label:"Edit group colors/arrangement...",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[x,{model:e,handleClose:t}]))}}]}})).views((e=>({get canDisplayLabels(){return e.rowHeight>=8&&e.showSidebarLabelsSetting},get totalHeight(){return e.rowHeight*(e.sources?.length||1)},get featuresReady(){return!!e.featuresVolatile}}))).views((e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.featuresReady,height:e.height,totalHeight:e.totalHeight,renderingMode:e.renderingMode,minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,lengthCutoffFilter:e.lengthCutoffFilter,rowHeight:e.rowHeight,sources:e.sources,scrollTop:e.scrollTop,referenceDrawingMode:e.referenceDrawingMode,filters:new g.A({filters:e.activeFilters})}}})))}const R=function(e){return s.types.compose("MultiLinearVariantDisplay",P(e),s.types.model({type:s.types.literal("MultiLinearVariantDisplay"),rowHeightSetting:s.types.optional(s.types.number,11),minorAlleleFrequencyFilter:s.types.optional(s.types.number,0)})).views((()=>({get rendererTypeName(){return"MultiVariantRenderer"}}))).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){(async()=>{try{const{getMultiVariantSourcesAutorun:t}=await r.e(9222).then(r.bind(r,9222)),{getMultiVariantFeaturesAutorun:n}=await r.e(2303).then(r.bind(r,12303));t(e),n(e)}catch(t){(0,s.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(n){const{renderSvg:a}=await r.e(8178).then(r.bind(r,88178));return a(e,n,t)}}}))};var L=r(68446),I=r(73716),F=r(20195),N=r(9669),D=r(69500);const B=(0,L.observer)((function(e){const{model:t}=e,{lineZoneHeight:r}=t,n=(0,p.useRef)(null),[a,i]=(0,p.useState)(),[o,s]=(0,p.useState)();return(0,D.jsxs)("div",{ref:n,onMouseMove:e=>{const t=n.current?.getBoundingClientRect(),r=t?.top||0,a=t?.left||0;i(e.clientY-r),s(e.clientX-a)},onMouseLeave:()=>{i(void 0),s(void 0)},children:[(0,D.jsxs)("div",{style:{position:"relative"},children:[(0,D.jsx)(I.A,{model:t}),(0,D.jsxs)("div",{style:{position:"absolute",top:r},children:[(0,D.jsx)(N.A,{model:t}),(0,D.jsx)(d.GQ,{...e})]})]}),o&&a&&a>r?(0,D.jsx)(F.A,{mouseX:o,mouseY:a,model:t}):null]})})),V=B,j=(0,o.ConfigurationSchema)("LinearVariantMatrixRenderer",{},{explicitlyTyped:!0});function E(e){return(0,o.ConfigurationSchema)("LinearVariantMatrixDisplay",{renderer:j,height:{type:"number",defaultValue:250}},{baseConfiguration:(0,d.lw)(e),explicitlyTyped:!0})}function z(e){return s.types.compose("LinearVariantMatrixDisplay",P(e),s.types.model({type:s.types.literal("LinearVariantMatrixDisplay"),rowHeightSetting:s.types.optional(s.types.number,1),lineZoneHeight:20})).views((e=>({get nrow(){return e.sources?.length||1},get blockType(){return"dynamicBlocks"},get totalHeight(){return e.autoHeight?e.height-e.lineZoneHeight:this.nrow*e.rowHeightSetting},get rowHeight(){return e.autoHeight?e.totalHeight/this.nrow:e.rowHeightSetting},get featuresReady(){return!!e.featuresVolatile}}))).views((e=>({renderProps(){const t=e.adapterProps();return{...t,notReady:t.notReady||!e.sources||!e.featuresReady,renderingMode:e.renderingMode,minorAlleleFrequencyFilter:e.minorAlleleFrequencyFilter,lengthCutoffFilter:e.lengthCutoffFilter,height:e.totalHeight,sources:e.sources}},get canDisplayLabels(){return e.rowHeight>8&&e.showSidebarLabelsSetting}}))).actions((e=>({setLineZoneHeight:t=>(e.lineZoneHeight=(0,l.clamp)(t,10,1e3),e.lineZoneHeight)}))).actions((e=>{const{renderSvg:t}=e;return{setLineZoneHeight:t=>(e.lineZoneHeight=(0,l.clamp)(t,10,1e3),e.lineZoneHeight),afterAttach(){(async()=>{try{const{getMultiVariantSourcesAutorun:t}=await r.e(9222).then(r.bind(r,9222)),{getMultiVariantFeaturesAutorun:n}=await r.e(2303).then(r.bind(r,12303));t(e),n(e)}catch(t){(0,s.isAlive)(e)&&(console.error(t),(0,l.getSession)(e).notifyError(`${t}`,t))}})()},async renderSvg(n){const{renderSvg:a}=await r.e(9875).then(r.bind(r,59875));return a(e,n,t)}}}))}var O=r(98111);class H extends O.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:n,sources:a,regions:i,bpPerPx:o}=e,s=i[0],{end:c,start:d}=s,u=(c-d)/o,{makeImageData:p}=await r.e(2367).then(r.bind(r,22367)),{mafs:g,...h}=await(0,l.renderToAbstractCanvas)(u,n,e,(r=>p({ctx:r,canvasWidth:u,canvasHeight:n,renderArgs:{...e,features:t,sources:a}})));return{...await super.render({...e,...h,features:t,height:n,width:u}),...h,features:new Map,simplifiedFeatures:g.map((({feature:e})=>new l.SimpleFeature({id:e.id(),data:{start:e.get("start"),end:e.get("end"),refName:e.get("refName")}}))),height:n,width:u}}}var G=r(67112);const W=(0,L.observer)((function(e){const{arr:t,width:r,height:n,displayModel:a}=e,i=(0,p.useRef)(null);return(0,D.jsx)("div",{ref:i,onMouseMove:e=>{a.setHoveredGenotype(function(e,o){if(!i.current)return;const s=i.current.getBoundingClientRect(),l=e-s.left,c=o-s.top,d=t.length,u=t[0]?.length||0,p=a.sources[Math.floor(c/n*u)]?.name,g=t[Math.floor(l/r*d)]?.[Math.floor(c/n*u)];return g&&p?{name:p,genotype:g}:void 0}(e.clientX,e.clientY))},onMouseLeave:()=>{a.setHoveredGenotype(void 0)},onMouseOut:()=>{a.setHoveredGenotype(void 0)},style:{overflow:"visible",position:"relative",height:n},children:(0,D.jsx)(G.PrerenderedCanvas,{...e})})}));var $=r(92880);class U extends $.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:n,referenceDrawingMode:a,regions:i,bpPerPx:o}=e,s=i[0],c=(s.end-s.start)/o,{makeImageData:d}=await r.e(9978).then(r.bind(r,99978)),u=await(0,l.renderToAbstractCanvas)(c,n,e,(r=>("skip"===a&&(r.fillStyle="#ccc",r.fillRect(0,0,c,n)),d(r,{...e,features:t}))));return{...await super.render({...e,...u,features:t,height:n,width:c}),...u,features:new Map,height:n,width:c,containsNoTransferables:!0}}}var q=r(22593),_=r.n(q),J=r(69566);const X=(0,L.observer)((function(e){const{featureGenotypeMap:t,totalHeight:r,scrollTop:n}=e,{rbush:a,displayModel:i}=e,o=(0,p.useRef)(null),s=(0,p.useMemo)((()=>(new(_())).fromJSON(a)),[a]);return(0,D.jsx)("div",{ref:o,onMouseMove:e=>i.setHoveredGenotype?.(function(e,r){let n=0,a=0;if(o.current){const t=o.current.getBoundingClientRect();n=e-t.left,a=r-t.top-(i?.scrollTop||0)}const c=s.search({minX:n,maxX:n+1,minY:a,maxY:a+1});if(c.length){const{minX:e,minY:r,maxX:n,maxY:a,genotype:i,featureId:o,...s}=function(e){let t,r=1/0;for(const a of e){const e=(n=a).maxX-n.minX;e<r&&(r=e,t=a)}var n;return t}(c),d=t[o];if(d){const{ref:e,alt:t,name:r,description:n,length:a}=d;return{...s,genotype:i,alleles:(0,J.Fm)(i,e,t),featureName:r,description:t.length>=3?"multiple ALT alleles":n,length:(0,l.getBpDisplayStr)(a)}}}}(e.clientX,e.clientY)),onMouseLeave:()=>{i.setHoveredGenotype?.(void 0)},onMouseOut:()=>{i.setHoveredGenotype?.(void 0)},style:{overflow:"visible",position:"relative",height:r},children:(0,D.jsx)(G.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:n}})})})),Y=(0,o.ConfigurationSchema)("MultiVariantRenderer",{},{explicitlyTyped:!0});var K=r(47369);const Q=(0,o.ConfigurationSchema)("SplitVcfTabixAdapter",{vcfGzLocationMap:{type:"frozen",defaultValue:{}},indexLocationMap:{type:"frozen",defaultValue:{}},indexType:{type:"string",defaultValue:"TBI"},samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:'tsv with header like "name\tpopulation\tetc" where the first column is required, and corresponds to the sample names in the VCF files',locationType:"UriLocation"}}},{explicitlyTyped:!0});var Z=r(94318),ee=r(350);function te(e,t){const r=e.region.elided?0:e.region.start,n=e.region.elided?0:e.region.end;return(e.flipped?n-t:t-r)/e.bpPerRadian+e.startRadians}const re=(0,L.observer)((function({feature:e,blocksForRefs:t,radius:r,config:n,bezierRadius:a,selected:i,onClick:s}){const[c,d]=(0,p.useState)(!1),u=t[e.get("refName")];if(!u)return null;let g,h,f;e.get("INFO")?[g]=e.get("INFO").SVTYPE||[]:e.get("mate")&&(g="mate");const m=e.get("ALT")?.[0],y=m&&(0,ee.h)(m),b=e.get("start");if(y){const e=y.MatePosition.split(":");h=+e[1],f=t[e[0]]}else if("<TRA>"===m){const r=e.get("INFO")?.CHR2?.[0],n=e.get("INFO")?.END?.[0];h=Number.parseInt(n,10),f=t[r]}else if("mate"===g){const r=e.get("mate"),n=r.refName;h=r.start,f=t[n]}else f=u,h=e.get("end");if(f){const t=te(u,b),p=te(f,h),g=(0,l.polarToCartesian)(r,t),m=(0,l.polarToCartesian)(r,p),y=(0,l.polarToCartesian)(a,(p+t)/2),w=i?(0,o.readConfObject)(n,"strokeColorSelected",{feature:e}):(0,o.readConfObject)(n,"strokeColor",{feature:e}),v=(0,o.readConfObject)(n,"strokeColorHover",{feature:e});return(0,D.jsx)("path",{"data-testid":`chord-${e.id()}`,cursor:"crosshair",fill:"none",d:["M",...g,"Q",...y,...m].join(" "),...(0,l.getStrokeProps)(c?v:w),strokeWidth:c?3:1,onClick:t=>{s(e,u.region,f.region,t)},onMouseOver:()=>{i||d(!0)},onMouseOut:()=>{i||d(!1)}})}return null})),ne=(0,L.observer)((function({features:e,config:t,blockDefinitions:r,radius:n,bezierRadius:a,displayModel:i,onChordClick:o}){const{selectedFeatureId:s}=i||{},l=(0,p.useMemo)((()=>{const e={};for(const t of r){const r=t.region.elided?t.region.regions:[t.region];for(const n of r)e[n.refName]=t}return e}),[r]);return(0,D.jsx)("g",{"data-testid":"structuralVariantChordRenderer",children:[...e.values()].map((e=>{const r=e.id(),i=String(s)===String(r);return(0,D.jsx)(re,{feature:e,config:t,radius:n,bezierRadius:a,blocksForRefs:l,selected:i,onClick:o},r)}))})})),ae=(0,o.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});var ie=r(67736);const oe=(0,o.ConfigurationSchema)("VariantFeatureWidget",{});var se=r(9342);function le(e){const t=(0,se.n)(e);return s.types.compose(t,s.types.model("VariantFeatureWidget",{type:s.types.literal("VariantFeatureWidget"),descriptions:s.types.frozen()}))}var ce=r(14129),de=r(53996),ue=r(3496),pe=r(44728),ge=r(82088),he=r(85497);async function fe({pluginManager:e,args:t}){const{sources:r,minorAlleleFrequencyFilter:n,regions:a,adapterConfig:i,sessionId:o,lengthCutoffFilter:s,stopToken:c}=t,d=(await(0,ue.cK)(e,o,i)).dataAdapter,u=new Set,p=(0,he.Cg)({minorAlleleFrequencyFilter:n,lengthCutoffFilter:s,stopToken:c,features:await(0,pe._)(d.getFeaturesInMultipleRegions(a,t).pipe((0,ge.$)()))});for(const{alleleCounts:e}of p)for(const t of Object.keys(e))u.add(t);const g={},h={};return(0,l.forEachWithStopTokenCheck)(p,c,(({feature:e})=>{const t=e.get("genotypes");for(const{name:e}of r){g[e]||(g[e]=[]);const r=t[e];let n;h[r]?n=h[r]:(n=r.split(/[/|]/),h[r]=n);let a=0,i=0,o=0;for(const e of n)"."===e?o++:"0"!==e&&i++;a=o===n.length?-1:0===i?0:i===n.length?2:1,g[e].push(a)}})),g}class me extends ce.A{name="MultiVariantClusterGenotypeMatrix";async execute(e,t){const r=await this.deserializeArguments(e,t),n=await fe({pluginManager:this.pluginManager,args:r});return(0,de.DV)({data:Object.values(n),stopToken:r.stopToken,onProgress:e=>{r.statusCallback(e)}})}}class ye extends ce.A{name="MultiVariantGetGenotypeMatrix";async execute(e,t){return fe({pluginManager:this.pluginManager,args:await this.deserializeArguments(e,t)})}}class be extends ce.A{name="MultiVariantGetSimplifiedFeatures";async execute(e,t){const r=await this.deserializeArguments(e,t),{lengthCutoffFilter:n,minorAlleleFrequencyFilter:a,regions:i,adapterConfig:o,stopToken:s,sessionId:c}=r,{dataAdapter:d}=await(0,ue.cK)(this.pluginManager,c,o),u=(0,he.Cg)({minorAlleleFrequencyFilter:a,lengthCutoffFilter:n,stopToken:s,features:await(0,pe._)(d.getFeaturesInMultipleRegions(i,r).pipe((0,ge.$)()))}),p={};let g=!1;return(0,l.forEachWithStopTokenCheck)(u,s,(({feature:e})=>{const t=e.get("genotypes");for(const[e,r]of Object.entries(t)){const t=r.includes("|");g||=t,p[e]={maxPloidy:Math.max(p[e]?.maxPloidy||0,r.split("|").length),isPhased:p[e]?.isPhased||t}}})),{hasPhased:g,sampleInfo:p,features:u.map((({feature:e})=>({id:e.id(),data:{start:e.get("start"),end:e.get("end"),refName:e.get("refName"),name:e.get("name")}})))}}}class we extends ce.A{name="MultiVariantGetSources";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{regions:a,adapterConfig:i,sessionId:o}=n,{dataAdapter:s}=await(0,ue.cK)(r,o,i);return s.getSources(a,n)}}var ve=r(58273),Se=r(1622),Ce=r(58921);const xe=(0,o.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}},samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:"tsv with header like name\tpopulation\tetc. where the first column is required, and is the sample names",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,vcfLocation:{uri:e.uri,baseUri:e.baseUri}}:e}),ke=(0,o.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,o.ConfigurationSchema)("VcfIndex",{indexType:{model:s.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}}),samplesTsvLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/samples.tsv",description:"tsv with header like name\tpopulation\tetc. where the first column is required, and is the sample names",locationType:"UriLocation"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,vcfGzLocation:{uri:e.uri,baseUri:e.baseUri},index:{location:{uri:`${e.uri}.tbi`,baseUri:e.baseUri}}}:e});var Te=r(95600);class Ae extends n.A{name="VariantsPlugin";install(e){var t;!function(e){e.addAdapterType((()=>new K.A({name:"VcfAdapter",displayName:"VCF adapter",configSchema:xe,getAdapterClass:()=>Promise.all([r.e(2598),r.e(8343)]).then(r.bind(r,98343)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new K.A({name:"VcfTabixAdapter",displayName:"VCF tabix adapter",configSchema:ke,getAdapterClass:()=>Promise.all([r.e(3085),r.e(6621)]).then(r.bind(r,66621)).then((e=>e.default))})))}(e),function(e){e.addAdapterType((()=>new K.A({name:"SplitVcfTabixAdapter",displayName:"VCF tabix adapter (split across multiple files)",configSchema:Q,getAdapterClass:()=>Promise.all([r.e(3085),r.e(5472)]).then(r.bind(r,85472)).then((e=>e.default))})))}(e),function(e){e.addWidgetType((()=>new ie.A({name:"VariantFeatureWidget",heading:"Feature details",configSchema:oe,stateModel:le(e),ReactComponent:(0,p.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6386),r.e(1475),r.e(4144),r.e(5064)]).then(r.bind(r,65064))))})))}(e),(t=e).addTrackType((()=>{const e=(r=t,(0,o.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:(0,Ce.createBaseTrackConfig)(r)}));var r;return new ve.A({name:"VariantTrack",displayName:"Variant track",configSchema:e,stateModel:(0,Se.createBaseTrackModel)(t,"VariantTrack",e)})})),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a=(0,c.getFileName)(t),i=r&&(0,c.getFileName)(r);return(0,l.testAdapter)(a,/\.vcf\.b?gz$/i,n,"VcfTabixAdapter")?{type:"VcfTabixAdapter",vcfGzLocation:t,index:{location:r||(0,c.makeIndex)(t,".tbi"),indexType:(0,c.makeIndexType)(i,"CSI","TBI")}}:(0,l.testAdapter)(a,/\.vcf(\.gz)?$/i,n,"VcfAdapter")?{type:"VcfAdapter",vcfLocation:t}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>["VcfTabixAdapter","VcfAdapter"].includes(t)?"VariantTrack":e(t)))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:(0,d.lw)(e),explicitlyTyped:!0})}(e);return new a.A({name:"LinearVariantDisplay",displayName:"Variant display",configSchema:t,stateModel:u(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:d.GQ})}))}(e),function(e){e.addDisplayType((()=>{const t=E(e);return new a.A({name:"LinearVariantMatrixDisplay",displayName:"Multi-sample variant display (matrix)",configSchema:t,stateModel:z(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:V})}))}(e),function(e){e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("MultiVariantRenderer").configSchema;return(0,o.ConfigurationSchema)("MultiLinearVariantDisplay",{defaultRendering:{type:"stringEnum",model:s.types.enumeration("Rendering",["multivariant"]),defaultValue:"multivariant"},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{MultiVariantRenderer:t}),height:{type:"number",defaultValue:200}},{baseConfiguration:(0,o.ConfigurationSchema)("SharedVariantDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:s.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:s.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:d.Ki,explicitlyTyped:!0}),explicitlyTyped:!0})}(e);return new a.A({name:"MultiLinearVariantDisplay",displayName:"Multi-sample variant display (regular)",configSchema:t,stateModel:R(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,p.lazy)((()=>r.e(4699).then(r.bind(r,94699))))})}))}(e),function(e){e.addRendererType((()=>new U({name:"MultiVariantRenderer",ReactComponent:X,configSchema:Y,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new H({name:"LinearVariantMatrixRenderer",displayName:"Linear variant matrix renderer",ReactComponent:W,configSchema:j,pluginManager:e})))}(e),function(e){e.addRendererType((()=>new Z.A({name:"StructuralVariantChordRenderer",displayName:"SV chord renderer",ReactComponent:ne,configSchema:ae,pluginManager:e})))}(e),function(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("ChordVariantDisplay",{renderer:s.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:i.kO,explicitlyTyped:!0})}(e),r=(e=>s.types.compose("ChordVariantDisplay",i.dg,s.types.model({type:s.types.literal("ChordVariantDisplay"),configuration:(0,o.ConfigurationReference)(e)})).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},renderProps(){const t=(0,l.getContainingView)(e);return{...(0,c.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:e.blockDefinitions,config:e.configuration.renderer,onChordClick:t=>{e.onChordClick(t)}}}}))))(t);return new a.A({name:"ChordVariantDisplay",displayName:"Chord variant display",configSchema:t,stateModel:r,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:i.DO})}))}(e),e.addRpcMethod((()=>new we(e))),e.addRpcMethod((()=>new ye(e))),e.addRpcMethod((()=>new me(e))),e.addRpcMethod((()=>new be(e)))}}},50574:(e,t,r)=>{"use strict";r.d(t,{Jf:()=>i,Pn:()=>o,S5:()=>s});var n=r(8656),a=r(99546);async function i({queryString:e,searchType:t,searchScope:r,rankSearchResults:i,textSearchManager:o,assembly:s}){o||console.warn("No text search manager");const l=await(o?.search({queryString:e,searchType:t},r,i))||[],c=s?.allRefNames?.filter((t=>t.toLowerCase().startsWith(e.toLowerCase()))).slice(0,10).map((e=>new n.A({label:e})))||[];return(0,a.dedupe)([...c,...l],(e=>e.getId()))}function o(e,t){return e.clientX-(t?.getBoundingClientRect().left||0)}function s(e,t){return e?.cytobands?.map((t=>({refName:e.getCanonicalRefName(t.get("refName"))||t.get("refName"),start:t.get("start"),end:t.get("end"),type:t.get("gieStain"),name:t.get("name")}))).filter((e=>e.refName===t))||[]}},52119:(e,t,r)=>{"use strict";r.d(t,{A:()=>w,s:()=>v});var n=r(68584),a=r(99546),i=r(37347),o=r(91468),s=r(92516),l=r(36422),c=r(7552),d=r(68446),u=r(67112),p=r(75785),g=r(69500);const h=(0,p.n9)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}})),f=(0,d.observer)((function({model:e}){const{classes:t}=h(),{status:r}=e,{message:n}=(0,l.getParent)(e,2),a=n||r;return(0,g.jsx)("div",{className:t.loading,children:(0,g.jsx)(u.LoadingEllipses,{message:a})})}));var m=r(37205);const y=(0,c.lazy)((()=>Promise.all([r.e(1631),r.e(6839)]).then(r.bind(r,46839)))),b=(0,d.observer)((function({model:e}){return e.error?(0,g.jsx)(c.Suspense,{fallback:null,children:(0,g.jsx)(y,{model:e})}):e.message?(0,c.isValidElement)(e.message)?e.message:(0,g.jsx)(m.A,{message:`${e.message}`,severity:"info"}):e.filled?e.reactElement:(0,g.jsx)(f,{model:e})})),w=l.types.model("BlockState",{key:l.types.string,region:l.types.frozen(),reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((()=>({stopToken:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:b,renderProps:void 0}))).actions((e=>({doReload(){e.reloadFlag=e.reloadFlag+1},afterAttach(){const t=(0,a.getContainingDisplay)(e);setTimeout((()=>{(0,l.isAlive)(e)&&(0,a.makeAbortableReaction)(e,v,S,{name:`${t.id}/${(0,a.assembleLocString)(e.region)} rendering`,delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)}),t.renderDelay)},setStatus(t){e.status=t},setLoading(t){void 0!==e.stopToken&&(0,i.CF)(e.stopToken),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,e.stopToken=t},setMessage(t){void 0!==e.stopToken&&(0,i.CF)(e.stopToken),e.filled=!1,e.message=t,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,e.stopToken=void 0},setRendered(t){if(!t)return;const{reactElement:r,features:n,layout:a,maxHeightReached:i,renderProps:o}=t;e.filled=!0,e.message=void 0,e.reactElement=r,e.features=n,e.layout=a,e.error=void 0,e.maxHeightReached=i,e.renderProps=o,e.stopToken=void 0},setError(t){console.error(t),void 0!==e.stopToken&&(0,i.CF)(e.stopToken),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=t,e.renderProps=void 0,e.stopToken=void 0,(0,s.yH)(t)&&this.reload()},reload(){e.stopToken=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=b,e.renderProps=void 0,(0,l.getParent)(e,2).reload()},beforeDestroy(){(async()=>{try{void 0!==e.stopToken&&(0,i.CF)(e.stopToken);const t=(0,a.getContainingDisplay)(e),{rpcManager:r}=(0,a.getSession)(e),{rendererType:n}=t,{renderArgs:o}=v((0,l.cast)(e));o&&await n.freeResourcesInClient(r,JSON.parse(JSON.stringify(o)))}catch(e){console.error("Error while destroying block",e)}})()}})));function v(e,t){try{const r=t||(0,a.getContainingDisplay)(e),{assemblyManager:i,rpcManager:s}=(0,a.getSession)(r),{adapterConfig:c,rendererType:d,error:u,parentTrack:p}=r,g=(0,o.getTrackAssemblyNames)(p),h=e.region.assemblyName;if(!g.includes(h)&&!g.some((e=>i.get(e)?.hasName(h))))throw new Error(`region assembly (${h}) does not match track assemblies (${g})`);const f=r.renderProps(),{config:m}=f;(0,n.readConfObject)(m);const y=(0,o.getRpcSessionId)(r),b=(0,a.getContainingTrack)(r).id;return{rendererType:d,rpcManager:s,renderProps:f,cannotBeRenderedReason:r.regionCannotBeRendered(e.region),displayError:u,renderArgs:{statusCallback:t=>{(0,l.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:c,rendererType:d.name,sessionId:y,layoutId:b,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(e){return{displayError:e}}}async function S(e,t,r){if(!e)return;const{rendererType:n,renderProps:i,rpcManager:o,renderArgs:s,cannotBeRenderedReason:c,displayError:d}=e;if((0,l.isAlive)(r)){if(d)return void r.setError(d);if(c)return void r.setMessage(c);if(i.notReady)return;{const{reactElement:e,features:l,layout:c,maxHeightReached:d}=await n.renderInClient(o,{...s,...i,viewParams:(0,a.getViewParams)(r),stopToken:t});return{reactElement:e,features:l,layout:c,maxHeightReached:d,renderProps:i}}}}},53085:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(26400),a=r.n(n);function i(){const e=new(a().Jexl);return e.addFunction("get",((e,t)=>e.get(t))),e.addFunction("parent",(e=>e.parent())),e.addFunction("id",(e=>e.id())),e.addFunction("cast",(e=>e)),e.addFunction("log",(e=>(console.log(e),e))),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",((e,t)=>e.split(t))),e.addFunction("charAt",((e,t)=>e.charAt(t))),e.addFunction("charCodeAt",((e,t)=>e.charCodeAt(t))),e.addFunction("codePointAt",((e,t)=>e.codePointAt(t))),e.addFunction("startsWith",((e,t,r)=>e.startsWith(t,r))),e.addFunction("endsWith",((e,t,r)=>e.endsWith(t,r))),e.addFunction("padEnd",((e,t,r)=>e.padEnd(t,r))),e.addFunction("padStart",((e,t,r)=>e.padStart(t,r))),e.addFunction("repeat",((e,t)=>e.repeat(t))),e.addFunction("replace",((e,t,r)=>e.replace(t,r))),e.addFunction("replaceAll",((e,t,r)=>e.replaceAll(t,r))),e.addFunction("slice",((e,t,r)=>e.slice(t,r))),e.addFunction("startsWith",((e,t,r)=>e.startsWith(t,r))),e.addFunction("substring",((e,t,r)=>e.substring(t,r))),e.addFunction("toLowerCase",(e=>e.toLowerCase())),e.addFunction("toUpperCase",(e=>e.toUpperCase())),e.addFunction("jsonParse",(e=>JSON.parse(e))),e.addFunction("trim",(e=>e.trim())),e.addFunction("trimEnd",(e=>e.trimEnd())),e.addFunction("trimStart",(e=>e.trimStart())),e.addFunction("getTag",((e,t)=>{const r=e.get("tags");return r?r[t]:e.get(t)})),e.addBinaryOp("&",15,((e,t)=>e&t)),e}},53996:(e,t,r)=>{"use strict";r.d(t,{DV:()=>s});var n=r(37347);function a(e){return Number.parseFloat((100*e).toFixed(1))}function i(e,t){const r=Math.min(e.length,t.length);let n=0;for(let a=0;a<r;a++)n+=(e[a]-t[a])*(e[a]-t[a]);return Math.sqrt(n)}function o(e,t,r){let n=0;const a=e.length,i=t.length;for(let o=0;o<a;o++)for(let a=0;a<i;a++)n+=r[e[o]][t[a]];return n/e.length/t.length}function s({data:e,distance:t=i,linkage:r=o,onProgress:s,stopToken:l}){let c=performance.now();const d=[];for(let r=0;r<e.length;r++){performance.now()-c>400&&((0,n.SW)(l),c=performance.now()),s&&s(`Making distance matrix: ${a(r/(e.length-1))}%`);const i=[];for(let n=0;n<e.length;n++)i.push(t(e[r],e[n]));d.push(i)}const u=e.map(((e,t)=>({height:0,indexes:[Number(t)]})));let p=[];c=performance.now();for(let t=0;t<e.length&&(performance.now()-c>400&&((0,n.SW)(l),c=performance.now()),s&&s(`Clustering: ${a((t+1)/e.length)}%`),p.push(u.map((e=>e.indexes))),!(t>=e.length-1));t++){let e=1/0,t=0,n=0;for(let a=0;a<u.length;a++)for(let i=a+1;i<u.length;i++){const o=r(u[a].indexes,u[i].indexes,d);o<e&&(e=o,t=a,n=i)}const a={indexes:[...u[t].indexes,...u[n].indexes],height:e,children:[u[t],u[n]]};u.splice(Math.max(t,n),1),u.splice(Math.min(t,n),1),u.push(a)}return p=[[],...p.reverse()],{clusters:u[0],distances:d,order:u[0].indexes,clustersGivenK:p}}},56133:(e,t,r)=>{"use strict";r.d(t,{I:()=>s});var n=r(42489),a=r(36422),i=r(20166),o=r(37347);function s(e,t,r,s,l,c,d){let u;function p(t){(0,i.Kp)(t)||(console.error(t),(0,a.isAlive)(e)&&d(t))}(0,a.addDisposer)(e,(0,n.reaction)((()=>{try{return t(e)}catch(e){return void p(e)}}),(async(t,n)=>{if(u&&(0,o.CF)(u),(0,a.isAlive)(e)){u=(0,o.y5)(),l(u);try{const i=await r(t,u,e,n);(0,a.isAlive)(e)&&c(i)}catch(e){p(e)}}}),s)),(0,a.addDisposer)(e,(()=>{u&&(0,o.CF)(u)}))}},56174:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var n=r(7552),a=r(69092),i=r(48768),o=r(59130),s=r(76218),l=r(30698),c=r(38033),d=r(69941),u=r(69500);const p=({onFactoryReset:e,resetButtonText:t})=>{const[r,i]=(0,n.useState)(!1);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.A,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:()=>{i(!0)},children:t}),(0,u.jsx)(d.default,{onClose:()=>{i(!1)},open:r,onFactoryReset:e})]})};function g({componentStack:e,error:t="No error message provided",onFactoryReset:r,resetButtonText:n="Factory Reset"}){return(0,u.jsxs)(i.A,{maxWidth:"xl",open:!0,children:[(0,u.jsx)(o.A,{children:"Fatal error"}),(0,u.jsxs)(s.A,{children:[(0,u.jsx)(c.A,{error:t}),(0,u.jsx)("pre",{children:e})]}),(0,u.jsxs)(l.A,{children:[(0,u.jsx)(a.A,{color:"secondary",variant:"contained",onClick:()=>{window.location.reload()},children:"Refresh"}),(0,u.jsx)(p,{onFactoryReset:r,resetButtonText:n})]})]})}},56328:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{constructor(e){super(e),this.stateModel=e.stateModel,this.subDisplay=e.subDisplay,this.configSchema=e.configSchema,this.ReactComponent=e.ReactComponent,this.trackType=e.trackType,this.viewType=e.viewType}}},57027:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(44728),a=r(27570),i=r(82088),o=r(198),s=r(3496),l=r(99546);class c extends o.default{async renameRegionsIfNeeded(e){return e}serializeArgsInClient(e){const t={...e,displayModel:void 0};return super.serializeArgsInClient(t)}deserializeResultsInClient(e,t){return{...super.deserializeResultsInClient(e,t),blockKey:t.blockKey}}async renderInClient(e,t){const r=await e.call(t.sessionId,"ComparativeRender",t);return"canvasRecordedData"in r&&(r.html=await(0,l.getSerializedSvg)(r),r.reactElement=void 0),r}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async getFeatures(e){const t=this.pluginManager,{regions:r,sessionId:o,adapterConfig:c}=e,{dataAdapter:d}=await(0,s.cK)(t,o,c),u=r.map((e=>{const t={...e};return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),p=await(0,n._)(d.getFeaturesInMultipleRegions(u,e).pipe((0,a.p)((t=>this.featurePassesFilters(e,t))),(0,i.$)()));return(0,l.dedupe)(p,(e=>e.id()))}}},57266:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Tooltip:()=>i.A,default:()=>d});var n=r(7552),a=r(68446),i=r(88262),o=r(75429),s=r(69500);const l=e=>e.toLocaleString("en-US"),c=(0,n.forwardRef)((function({feature:e},t){const r=e.get("start")+1,n=e.get("end"),a=[e.get("refName"),e.get("name"),r===n?l(r):`${l(r)}..${l(n)}`].filter((e=>!!e)).join(":");return void 0!==e.get("summary")?(0,s.jsxs)("div",{ref:t,children:[a,(0,s.jsx)("br",{}),"Max: ",(0,o.toP)(e.get("maxScore")),(0,s.jsx)("br",{}),"Avg: ",(0,o.toP)(e.get("score")),(0,s.jsx)("br",{}),"Min: ",(0,o.toP)(e.get("minScore"))]}):(0,s.jsxs)("div",{ref:t,children:[a,(0,s.jsx)("br",{}),`${(0,o.toP)(e.get("score"))}`]})})),d=(0,a.observer)((function(e){return(0,s.jsx)(i.A,{TooltipContents:c,...e})}))},57468:(e,t,r)=>{"use strict";r.d(t,{t:()=>i});var n=r(7552),a=r(69500);class i extends n.Component{constructor(e){super(e),this.state={error:void 0}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e})}render(){return this.state.error?(0,a.jsx)(this.props.FallbackComponent,{error:this.state.error}):this.props.children}}},58273:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{displayTypes=[];constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}addDisplayType(e){this.displayTypes.push(e)}}},58921:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AdapterType:()=>u.A,AddTrackWorkflowType:()=>w.A,BaseConnectionModelFactory:()=>d.BaseConnectionModelFactory,BaseDisplay:()=>d.BaseDisplay,BaseInternetAccountConfig:()=>d.BaseInternetAccountConfig,BaseViewModel:()=>d.BaseViewModel,BoxRendererType:()=>n.default,CircularChordRendererType:()=>i.A,ComparativeServerSideRendererType:()=>a.A,ConnectionType:()=>p.A,DisplayType:()=>m.A,FeatureRendererType:()=>s.default,InternetAccount:()=>d.InternetAccount,InternetAccountType:()=>y.A,RendererType:()=>o.default,RpcMethodType:()=>b.A,ServerSideRenderedContent:()=>l.A,ServerSideRendererType:()=>c.default,TextSearchAdapterType:()=>v.A,TrackType:()=>g.A,ViewType:()=>f.A,WidgetType:()=>h.A,baseConnectionConfig:()=>d.baseConnectionConfig,createBaseTrackConfig:()=>d.createBaseTrackConfig,createBaseTrackModel:()=>d.createBaseTrackModel});var n=r(98111),a=r(57027),i=r(94318),o=r(95742),s=r(92880),l=r(25889),c=r(198),d=r(1622),u=r(47369),p=r(91612),g=r(58273),h=r(67736),f=r(63589),m=r(56328),y=r(92070),b=r(2406),w=r(32767),v=r(8024)},59099:(e,t,r)=>{"use strict";r.d(t,{S:()=>v,A:()=>S});var n=r(7552),a=r(12678),i=r(68584),o=r(58921),s=r(68446),l=r(36422),c=r(69500);const d=(0,s.observer)((function({model:e}){if(e?.target){if(e.target.type)return`${e.target.type} settings`;if((0,l.isStateTreeNode)(e.target)){const t=(0,l.getType)(e.target);if(t.name)return`${t.name.replace("ConfigurationSchema","")} settings`}}return(0,c.jsx)(c.Fragment,{children:"Settings"})}));var u=r(8832);function p(e){return l.types.model("ConfigurationEditorWidget",{id:u.ElementId,type:l.types.literal("ConfigurationEditorWidget"),target:l.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((e=>({setTarget(t){e.target=t}})))}const g=(0,i.ConfigurationSchema)("ConfigurationEditorWidget",{}),h=(0,n.lazy)((()=>Promise.all([r.e(6386),r.e(6511),r.e(6395),r.e(7874)]).then(r.bind(r,57874)))),f=(0,i.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),m=(0,i.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),y=(0,i.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),b=(0,i.ConfigurationSchema)("NcbiSequenceReportAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/sequence_report.tsv",locationType:"UriLocation"}},useNameOverride:{type:"boolean",defaultValue:!0,description:"forces usage of the UCSC names over the NCBI style names from a FASTA"}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,location:{uri:e.uri,baseUri:e.baseUri}}:e}),w=(0,i.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0},refNameColumnHeaderName:{type:"string",description:"alternative to refNameColumn, instead looks at header (starts with # and finds column name)",defaultValue:""}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,location:{uri:e.uri,baseUri:e.baseUri}}:e}),v=(0,n.lazy)((()=>Promise.all([r.e(6386),r.e(6511),r.e(6395),r.e(7874)]).then(r.bind(r,57874))));class S extends a.A{name="ConfigurationPlugin";install(e){!function(e){e.addAdapterType((()=>new o.AdapterType({name:"FromConfigAdapter",configSchema:f,getAdapterClass:()=>r.e(6833).then(r.bind(r,86833)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addAdapterType((()=>new o.AdapterType({name:"FromConfigRegionsAdapter",configSchema:m,getAdapterClass:()=>r.e(491).then(r.bind(r,80491)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addAdapterType((()=>new o.AdapterType({name:"FromConfigSequenceAdapter",configSchema:y,getAdapterClass:()=>r.e(7013).then(r.bind(r,97013)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addAdapterType((()=>new o.AdapterType({name:"RefNameAliasAdapter",configSchema:w,getAdapterClass:()=>r.e(2249).then(r.bind(r,92249)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e),function(e){e.addWidgetType((()=>new o.WidgetType({name:"ConfigurationEditorWidget",HeadingComponent:d,configSchema:g,stateModel:p(e),ReactComponent:h})))}(e),function(e){e.addAdapterType((()=>new o.AdapterType({name:"NcbiSequenceReportAliasAdapter",configSchema:b,getAdapterClass:()=>r.e(3175).then(r.bind(r,43175)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))}(e)}}},62367:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var n=r(7552),a=r(68584),i=r(58921),o=r(99546),s=r(91468),l=r(8832),c=r(35068),d=r.n(c),u=r(36422);function p(e=""){try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function g(e){return u.types.model("AddTrackModel",{id:l.ElementId,type:u.types.literal("AddTrackWidget"),view:u.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((()=>({trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0,mixinData:{}}))).actions((e=>({setMixinData(t){e.mixinData=t},setAdapterHint(t){e.adapterHint=t},setTrackSource(t){e.trackSource=t},setTextIndexingConf(t){e.textIndexingConf=t},setTextIndexTrack(t){e.textIndexTrack=t},setTrackData(t){e.trackData=t},setIndexTrackData(t){e.indexTrackData=t},setAssembly(t){e.altAssemblyName=t},setTrackName(t){e.altTrackName=t},setTrackType(t){e.altTrackType=t},clearData(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0,e.textIndexingConf=void 0,e.textIndexTrack=!0}}))).views((e=>({get trackAdapter(){const{trackData:t,indexTrackData:r,adapterHint:n}=e;return t?(0,s.guessAdapter)(t,r,n,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,s.getFileName)(e.trackData):"")},get isFtp(){const{trackData:t,indexTrackData:r}=e;return!(!r?.uri?.startsWith("ftp://")&&!t?.uri?.startsWith("ftp://"))},get isRelativeTrackUrl(){const t=e.trackData?.uri;return!!t&&!p(t)},get isRelativeIndexUrl(){const t=e.indexTrackData?.uri;return!!t&&!p(t)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){return e.trackData?.uri?.startsWith("http://")},get indexHttp(){return e.indexTrackData?.uri?.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){return this.trackAdapter?.type===s.UNSUPPORTED},get assembly(){return e.altAssemblyName||e.view.assemblyNames?.[0]},get trackAdapterType(){return this.trackAdapter?.type},get trackType(){return e.altTrackType||(this.trackAdapterType?(0,s.guessTrackType)(this.trackAdapterType,e):"")}}))).views((e=>({getTrackConfig(t){const r=(0,o.getSession)(e),n=r.assemblyManager.get(e.assembly);return n&&e.trackAdapter&&"UNKNOWN"!==e.trackAdapter.type?d()({trackId:[`${e.trackName.toLowerCase().replaceAll(" ","_")}-${t}`,r.adminMode?"":"-sessionTrack"].join(""),type:e.trackType,name:e.trackName,assemblyNames:[e.assembly],adapter:{...e.trackAdapter,sequenceAdapter:(0,a.getConf)(n,["sequence","adapter"])}},e.mixinData):void 0},get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}})))}const h=(0,a.ConfigurationSchema)("AddTrackWidget",{});function f(e){e.addWidgetType((()=>new i.WidgetType({name:"AddTrackWidget",heading:"Add a track",configSchema:h,stateModel:g(e),ReactComponent:(0,n.lazy)((()=>Promise.all([r.e(9721),r.e(4850),r.e(2724)]).then(r.bind(r,72724))))})))}},63589:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{displayTypes=[];viewMetadata={};constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.viewMetadata=e.viewMetadata||{},this.stateModel=e.stateModel,this.extendedName=e.extendedName}addDisplayType(e){this.displayTypes.push(e)}}},65193:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>we});var n=r(7552),a=r(67112),i=r(68446),o=r(99546),s=r(95054),l=r(75785),c=r(57468),d=r(36422),u=r(42752),p=r(27703),g=r(69500);const h=(0,l.n9)()((e=>({verticalGuidesZoomContainer:{position:"absolute",top:0,height:"100%",width:"100%",pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.action.disabled},minorTick:{background:e.palette.divider}})));function f({block:e,bpPerPx:t}){const{classes:r,cx:n}=h(),a=(0,p.H2)(e.start,e.end,t);return(0,g.jsx)(u.$G,{block:e,children:a.map((({type:a,base:i})=>{const o=(e.reversed?e.end-i:i-e.start)/t;return(0,g.jsx)("div",{className:n(r.tick,"major"===a||"labeledMajor"===a?r.majorTick:r.minorTick),style:{left:o}},i)}))})}const m=(0,i.observer)((({model:e})=>{const{staticBlocks:t,bpPerPx:r}=e;return(0,g.jsx)(g.Fragment,{children:t.map(((e,t)=>{const n=`${e.key}-${t}`;return"ContentBlock"===e.type?(0,g.jsx)(f,{block:e,bpPerPx:r},n):"ElidedBlock"===e.type?(0,g.jsx)(u.Db,{width:e.widthPx},n):"InterRegionPaddingBlock"===e.type?(0,g.jsx)(u.fK,{width:e.widthPx,boundary:"boundary"===e.variant},n):null}))})})),y=(0,i.observer)((function({model:e,offset:t=0}){const{classes:r}=h(),n=e.staticBlocks.offsetPx-e.offsetPx;return(0,g.jsx)("div",{className:r.verticalGuidesZoomContainer,style:{transform:1!==e.scaleFactor?`scaleX(${e.scaleFactor})`:void 0},children:(0,g.jsx)("div",{className:r.verticalGuidesContainer,style:{left:n-t,width:e.staticBlocks.totalWidthPx},children:(0,g.jsx)(m,{model:e})})})}));var b=r(68584),w=r(91468),v=r(84340),S=r(62266),C=r(89870),x=r(61282),k=r(67555);const T=(0,l.n9)()({dragHandle:{cursor:"grab"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"}}),A=function({trackId:e,view:t,track:r}){const{classes:n}=T();return(0,g.jsx)("span",{draggable:!0,className:n.dragHandle,onDragStart:e=>{const n=e.currentTarget;if(n.parentNode){const a=n.parentNode;e.dataTransfer.setDragImage(a,20,20),t.setDraggingTrackId(r.id)}},onDragEnd:()=>{t.setDraggingTrackId(void 0)},"data-testid":`dragHandle-${t.id}-${e}`,children:(0,g.jsx)(k.A,{className:n.dragHandleIcon,fontSize:"small"})})};var M=r(23758),P=r(18423),R=r(5986),L=r(85179),I=r(85161),F=r(11496),N=r(71098),D=r(2020),B=r(80255);const V=(0,i.observer)((function({track:e}){const t=(0,o.getContainingView)(e),r=(0,o.getSession)(e),n=e.configuration,a=e.minimized,i=e.pinned;let s;try{(0,o.getContainingView)(t),s=!0}catch(e){s=!1}const l=[...s?[]:[{label:i?"Unpin track":"Pin track",icon:B.A,onClick:()=>{e.setPinned(!i)}}],{label:"Track order",type:"subMenu",priority:2e3,subMenu:[{label:a?"Restore track":"Minimize track",icon:a?P.A:N.A,onClick:()=>{e.setMinimized(!a)}},...t.tracks.length>2?[{label:"Move track to top",icon:F.A,onClick:()=>{t.moveTrackToTop(e.id)}}]:[],{label:"Move track up",icon:L.A,onClick:()=>{t.moveTrackUp(e.id)}},{label:"Move track down",icon:R.A,onClick:()=>{t.moveTrackDown(e.id)}},...t.tracks.length>2?[{label:"Move track to bottom",icon:I.A,onClick:()=>{t.moveTrackToBottom(e.id)}}]:[]]},...r.getTrackActionMenuItems?.(n)||[],...e.trackMenuItems()].sort(((e,t)=>(t?.priority||0)-(e?.priority||0)));return(0,g.jsx)(M.A,{menuItems:l,"data-testid":"track_menu_icon",children:(0,g.jsx)(D.A,{fontSize:"small"})})})),j=(0,l.n9)()((e=>({root:{background:(0,S.X4)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper}},trackName:{fontSize:"0.8rem"},iconButton:{padding:e.spacing(1)}}))),E=(0,i.observer)((0,n.forwardRef)((function({track:e,className:t},r){const{classes:n,cx:i}=j(),l=(0,o.getContainingView)(e),c=(0,o.getSession)(e),d=e.configuration,{minimized:u}=e,p=(0,b.getConf)(e,"trackId"),h=(0,w.getTrackName)(d,c);return(0,g.jsxs)(s.A,{ref:r,className:i(t,n.root),onClick:e=>{e.stopPropagation()},children:[(0,g.jsx)(A,{track:e,trackId:p,view:l}),(0,g.jsx)(C.A,{onClick:()=>l.hideTrack(p),className:n.iconButton,title:"close this track",children:(0,g.jsx)(v.A,{fontSize:"small"})}),(0,g.jsx)(x.A,{variant:"body1",component:"span",className:n.trackName,onMouseDown:e=>{e.stopPropagation()},children:(0,g.jsx)(a.SanitizedHTML,{html:[h,u?"(minimized)":""].filter((e=>!!e)).join(" ")})}),(0,g.jsx)(V,{track:e})]})}))),z=(0,l.n9)()({trackLabel:{zIndex:2},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"}}),O=(0,i.observer)((function({track:e,view:t}){const{classes:r,cx:n}=z(),a=e.displays[0],{trackLabel:i,trackLabelOverlap:o,trackLabelOffset:s}=r,l="overlapping"!==t.trackLabelsSetting||a.prefersOffset?s:o;return"hidden"!==t.trackLabelsSetting?(0,g.jsx)(E,{track:e,className:n(i,l)}):null})),H=(0,l.n9)()({renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none"}}),G=(0,i.observer)((function({model:e,track:t,onDragEnter:r}){const{classes:i}=H(),o=t.displays[0],{height:s,RenderingComponent:l,DisplayBlurb:c}=o,{trackRefs:d,id:u,scaleFactor:p}=e,h=(0,b.getConf)(t,"trackId"),f=(0,n.useRef)(null),m=t.minimized;return(0,n.useEffect)((()=>(f.current&&(d[h]=f.current),()=>{delete d[h]})),[d,h]),(0,g.jsx)("div",{className:i.trackRenderingContainer,style:{height:m?20:s},onScroll:e=>o.setScrollTop(e.currentTarget.scrollTop),onDragEnter:r,"data-testid":`trackRenderingContainer-${u}-${h}`,children:m?null:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{ref:f,className:i.renderingComponentContainer,style:{transform:1!==p?`scaleX(${p})`:void 0},children:(0,g.jsx)(n.Suspense,{fallback:(0,g.jsx)(a.LoadingEllipses,{}),children:(0,g.jsx)(l,{model:o,onHorizontalScroll:e.horizontalScroll})})}),c?(0,g.jsx)("div",{style:{position:"absolute",left:0,top:o.height-20},children:(0,g.jsx)(c,{model:o})}):null]})})})),W=(0,l.n9)()({root:{marginTop:2,overflow:"hidden",position:"relative"},unpinnedTrack:{background:"none"},resizeHandle:{height:3,boxSizing:"border-box",position:"relative"}}),$=(0,i.observer)((function({model:e,track:t}){const{classes:r,cx:i}=W(),o=t.displays[0],{draggingTrackId:l,showTrackOutlines:u}=e,p=(0,n.useRef)(null);return(0,g.jsxs)(s.A,{ref:p,className:i(r.root,t.pinned?null:r.unpinnedTrack),variant:u?"outlined":void 0,elevation:u?void 0:0,onClick:r=>{if(2===r.detail&&!t.displays[0].featureIdUnderMouse){const t=p.current?.getBoundingClientRect().left||0;e.zoomTo(e.bpPerPx/2,r.clientX-t,!0)}},children:[t.pinned?(0,g.jsx)(y,{model:e,offset:1}):null,(0,g.jsx)(O,{track:t,view:e}),(0,g.jsx)(c.t,{FallbackComponent:e=>(0,g.jsx)(a.ErrorMessage,{error:e.error}),children:(0,g.jsx)(G,{model:e,track:t,onDragEnter:()=>{(0,d.isAlive)(o)&&void 0!==l&&l!==o.id&&e.moveTrack(l,t.id)}})}),(0,g.jsx)(a.ResizeHandle,{onDrag:o.resizeHeight,className:r.resizeHandle})]})}));var U=r(37934),q=r(37962);const _=(0,l.n9)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",background:"red",zIndex:1001},tooltipTarget:{position:"sticky",width:1}}),J=(0,i.observer)((function({model:e,coordX:t}){const{classes:r}=_(),{stickyViewHeaders:n,rubberbandTop:a}=e;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(q.A,{open:!0,placement:"top",title:(0,o.stringify)(e.pxToBp(t)),arrow:!0,children:(0,g.jsx)("div",{className:r.tooltipTarget,style:{left:t+6,top:a,position:n?"sticky":void 0}})}),(0,g.jsx)("div",{className:r.guide,style:{left:t}})]})}));var X=r(50574);function Y(e,t,r){const[a,i]=(0,n.useState)(),[o,s]=(0,n.useState)(),[l,c]=(0,n.useState)(),[d,u]=(0,n.useState)(),p=void 0!==a&&void 0===l;function g(t){if(r&&!t.shiftKey)return;t.preventDefault(),t.stopPropagation();const n=(0,X.Pn)(t,e.current);i(n),s(n)}function h(t){r?t.shiftKey?u((0,X.Pn)(t,e.current)):u(void 0):u((0,X.Pn)(t,e.current))}function f(){u(void 0),t.setOffsets(void 0,void 0)}function m(){c(void 0),i(void 0),s(void 0)}function y(e,t){t(),m()}(0,n.useEffect)((()=>{function r(t){if(e.current&&p){const r=(0,X.Pn)(t,e.current);s(r)}}function n(r){if(void 0!==a&&e.current){const{clientX:n,clientY:i}=r,o=(0,X.Pn)(r,e.current);c({offsetX:o,clientX:n,clientY:i});const s=function(e){if(void 0===a)return;const r=Math.min(a,e),n=Math.max(a,e);return{leftOffset:t.pxToBp(r),rightOffset:t.pxToBp(n)}}(o);s&&t.setOffsets(s.leftOffset,s.rightOffset),u(void 0)}}return p?(window.addEventListener("mousemove",r),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",n)}):()=>{}}),[a,p,t,e]),(0,n.useEffect)((()=>{!p&&void 0!==o&&void 0!==a&&Math.abs(o-a)<=3&&m()}),[p,o,a]);const b=Boolean(l);if(void 0===a)return{open:b,guideX:d,mouseDown:g,mouseMove:h,mouseOut:f,handleMenuItemClick:y};const w=l?l.offsetX:o||0,v=Math.min(w,a),S=Math.abs(w-a);return{open:b,rubberbandOn:!0,mouseDown:g,mouseMove:h,mouseOut:f,handleClose:m,handleMenuItemClick:y,leftBpOffset:t.pxToBp(v),rightBpOffset:t.pxToBp(v+S),anchorPosition:l,numOfBpSelected:Math.ceil(S*t.bpPerPx),width:S,left:v}}const K=(0,l.n9)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8,zIndex:825}}),Q=(0,i.observer)((function({model:e,ControlComponent:t=(0,g.jsx)("div",{})}){const r=(0,n.useRef)(null),{classes:i}=K(),{stickyViewHeaders:o,rubberbandTop:s}=e,{guideX:l,rubberbandOn:c,leftBpOffset:d,rightBpOffset:u,numOfBpSelected:p,width:h,left:f,anchorPosition:m,open:y,handleMenuItemClick:b,handleClose:w,mouseMove:v,mouseDown:S,mouseOut:C}=Y(r,e);return(0,g.jsxs)(g.Fragment,{children:[void 0!==l?(0,g.jsx)(J,{model:e,coordX:l}):c?(0,g.jsx)(U.default,{leftBpOffset:d,rightBpOffset:u,numOfBpSelected:p,width:h,left:f,top:s,sticky:o}):null,m?(0,g.jsx)(a.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:m.clientX,top:m.clientY},onMenuItemClick:b,open:y,onClose:w,menuItems:e.rubberBandMenuItems()}):null,(0,g.jsx)("div",{"data-testid":"rubberband_controls",className:i.rubberbandControl,style:{top:s,position:o?"sticky":void 0},ref:r,onMouseDown:S,onMouseMove:v,onMouseOut:C,children:t})]})})),Z=(0,l.n9)()((e=>({majorTickLabel:{fontSize:11,zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"}}))),ee=function({block:e,bpPerPx:t}){const{classes:r}=Z(),{reversed:n,start:a,end:i}=e,s=(0,p.H2)(a,i,t,!0,!1);return(0,g.jsx)(u.$G,{block:e,children:s.map((({type:e,base:s})=>{if("major"===e){const e=(n?i-s:s-a)/t,l=s+1;return(0,g.jsx)("div",{className:r.tick,style:{left:e},children:l?(0,g.jsx)(x.A,{className:r.majorTickLabel,children:(0,o.getTickDisplayStr)(l,t)}):null},s)}return null}))})},te=(0,i.observer)((function({model:e}){const{staticBlocks:t,bpPerPx:r}=e;return(0,g.jsx)(g.Fragment,{children:t.map(((e,t)=>{const{key:n,widthPx:a}=e,i=`${n}-${t}`;return"ContentBlock"===e.type?(0,g.jsx)(ee,{block:e,bpPerPx:r},i):"ElidedBlock"===e.type?(0,g.jsx)(u.Db,{width:a},i):"InterRegionPaddingBlock"===e.type?(0,g.jsx)(u.fK,{width:a,style:{background:"none"},boundary:"boundary"===e.variant},i):null}))})})),re=(0,l.n9)()((e=>({refLabel:{fontSize:11,position:"absolute",left:2,top:-1,fontWeight:"bold",lineHeight:"normal",zIndex:1,background:e.palette.background.paper},b0:{left:0,zIndex:100}}))),ne=(0,i.observer)((function({model:e}){const{classes:t,cx:r}=re(),{staticBlocks:n,offsetPx:a,scaleBarDisplayPrefix:i}=e;let o=0;n.forEach(((e,t)=>{e.offsetPx-a<0&&(o=t)}));const s=i(),l=n.blocks[0];return(0,g.jsxs)(g.Fragment,{children:["ContentBlock"!==l?.type&&s?(0,g.jsx)(x.A,{className:r(t.b0,t.refLabel),children:s}):null,n.map(((e,r)=>{const{offsetPx:n,isLeftEndOfDisplayedRegion:i,key:l,type:c,refName:d}=e,u=r===o;return"ContentBlock"===c&&(i||u)?(0,g.jsxs)(x.A,{style:{left:u?Math.max(0,-a):n-a-1,paddingLeft:u?0:1},className:t.refLabel,"data-testid":`refLabel-${d}`,children:[u&&s?`${s}:`:"",d]},`refLabel-${l}-${r}`):null}))]})})),ae=(0,l.n9)()({container:{overflow:"hidden",position:"relative"},zoomContainer:{position:"relative"},scalebar:{position:"absolute",display:"flex",pointerEvents:"none"}}),ie=(0,i.observer)((0,n.forwardRef)((function({model:e,style:t,className:r,...n},a){const{classes:i,cx:o}=ae(),{staticBlocks:l,offsetPx:c,scaleFactor:d}=e,u=l.offsetPx-c;return(0,g.jsxs)(s.A,{"data-resizer":"true",className:o(i.container,r),variant:"outlined",ref:a,style:t,...n,children:[(0,g.jsx)(y,{model:e,offset:1}),(0,g.jsx)("div",{className:i.zoomContainer,style:{transform:1!==d?`scaleX(${d})`:void 0},children:(0,g.jsx)("div",{className:i.scalebar,style:{left:u-1,width:l.totalWidthPx,...t},children:(0,g.jsx)(te,{model:e})})}),(0,g.jsx)(ne,{model:e})]})})));var oe=r(76239);const se=(0,n.lazy)((()=>r.e(4895).then(r.bind(r,24895)))),le=(0,n.lazy)((()=>r.e(3656).then(r.bind(r,63656)))),ce=(0,n.lazy)((()=>Promise.resolve().then(r.bind(r,37934)))),de=(0,l.n9)()({tracksContainer:{position:"relative"}}),ue=(0,i.observer)((function({children:e,model:t}){const{classes:r}=de(),{pluginManager:i}=(0,o.getEnv)(t),{mouseDown:s,mouseUp:l}=function(e){const[t,r]=(0,n.useState)(!1),a=(0,n.useRef)(!1),i=(0,n.useRef)(0);return(0,n.useEffect)((()=>{let n=()=>{};function o(t){t.preventDefault();const r=t.clientX-i.current;r&&(a.current||(a.current=!0,window.requestAnimationFrame((()=>{e.horizontalScroll(-r),a.current=!1,i.current=t.clientX}))))}function s(){i.current=0,t&&r(!1)}return t&&(window.addEventListener("mousemove",o,!0),window.addEventListener("mouseup",s,!0),n=()=>{window.removeEventListener("mousemove",o,!0),window.removeEventListener("mouseup",s,!0)}),n}),[e,t]),{mouseDown:function(e){if(e.shiftKey)return;const t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(i.current=e.clientX,r(!0))},mouseUp:function(e){e.preventDefault(),r(!1)}}}(t),{stickyViewHeaders:c,rubberbandTop:d,showGridlines:u,showCenterLine:p}=t,h=(0,n.useRef)(null),{guideX:f,rubberbandOn:m,leftBpOffset:b,rightBpOffset:w,numOfBpSelected:v,width:S,left:C,anchorPosition:x,open:k,handleMenuItemClick:T,handleClose:A,mouseMove:M,mouseDown:P}=Y(h,t,!0);!function(e,t){const r=(0,n.useRef)(0),a=(0,n.useRef)(null),i=(0,n.useRef)(!1);(0,n.useEffect)((()=>{let n=[];const s=e.current;function l(e){if(e.ctrlKey){e.preventDefault(),n.push(e.deltaY);const i=Math.abs((0,o.sum)(n))/n.length,l=i<6?25:i>30?i>150?500:150:75;r.current+=e.deltaY/l,t.setScaleFactor(r.current<0?1-r.current:1/(1+r.current)),a.current&&clearTimeout(a.current),a.current=setTimeout((()=>{t.setScaleFactor(1),t.zoomTo(r.current>0?t.bpPerPx*(1+r.current):t.bpPerPx/(1-r.current),e.clientX-(s?.getBoundingClientRect().left||0)),r.current=0,n=[]}),300)}else Math.abs(e.deltaX)>Math.abs(2*e.deltaY)&&e.preventDefault(),r.current+=e.deltaX,i.current||(i.current=!0,window.requestAnimationFrame((()=>{t.horizontalScroll(r.current),r.current=0,i.current=!1})))}return s?(s.addEventListener("wheel",l),()=>{s.removeEventListener("wheel",l)}):()=>{}}),[t,e])}(h,t);const R=i.evaluateExtensionPoint("LinearGenomeView-TracksContainerComponent",void 0,{model:t});return(0,g.jsxs)("div",{ref:h,"data-testid":"tracksContainer",className:r.tracksContainer,onMouseDown:e=>{s(e),P(e)},onMouseMove:M,onMouseUp:l,children:[u?(0,g.jsx)(y,{model:t}):null,(0,g.jsx)(n.Suspense,{fallback:null,children:p?(0,g.jsx)(se,{model:t}):null}),void 0!==f?(0,g.jsx)(J,{model:t,coordX:f}):m?(0,g.jsx)(n.Suspense,{fallback:null,children:(0,g.jsx)(ce,{leftBpOffset:b,rightBpOffset:w,numOfBpSelected:v,width:S,left:C,top:d,sticky:c})}):null,x?(0,g.jsx)(a.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:x.clientX,top:x.clientY},onMenuItemClick:T,open:k,onClose:A,menuItems:t.rubberBandMenuItems()}):null,(0,g.jsx)(Q,{model:t,ControlComponent:(0,g.jsx)(ie,{model:t,style:{height:oe.jE,boxSizing:"border-box"}})}),(0,g.jsx)(pe,{model:t}),R,e]})})),pe=(0,i.observer)((function({model:e}){return e.highlight.length?(0,g.jsx)(n.Suspense,{fallback:null,children:e.highlight.map(((t,r)=>(0,g.jsx)(le,{model:e,highlight:t},`${JSON.stringify(t)}-${r}`)))}):null})),ge=ue,he=(0,n.lazy)((()=>r.e(1189).then(r.bind(r,21189)))),fe=(0,l.n9)()((e=>({header:{background:e.palette.background.paper,top:a.VIEW_HEADER_HEIGHT,zIndex:850},pinnedTracks:{position:"sticky",zIndex:3},rel:{position:"relative"}}))),me=(0,i.observer)((function({model:e}){const{pinnedTracks:t,stickyViewHeaders:r,pinnedTracksTop:a,tracks:i,unpinnedTracks:l}=e,{classes:c}=fe(),d=(0,o.getSession)(e),u=(0,n.useRef)(null),p=e.MiniControlsComponent(),h=e.HeaderComponent();return(0,n.useEffect)((()=>{function t(t){t.target instanceof Element&&u.current?.contains(t.target)&&d.setFocusedViewId?.(e.id)}return document.addEventListener("mousedown",t),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",t)}}),[d,e]),(0,g.jsxs)("div",{className:c.rel,ref:u,onMouseLeave:()=>{d.setHovered(void 0)},onMouseMove:t=>{const r=u.current;if(!r)return;const{tracks:n}=e,a=t.clientX-r.getBoundingClientRect().left,i=e.pxToBp(a),o=n.find((e=>e.displays[0].featureUnderMouse));d.setHovered({hoverPosition:i,hoverFeature:o})},children:[(0,g.jsxs)("div",{className:c.header,style:{position:r?"sticky":void 0},children:[(0,g.jsx)(h,{model:e}),(0,g.jsx)(p,{model:e})]}),(0,g.jsx)(ge,{model:e,children:i.length?(0,g.jsxs)(g.Fragment,{children:[t.length?(0,g.jsx)(s.A,{elevation:6,className:c.pinnedTracks,style:{top:a},children:t.map((t=>(0,g.jsx)($,{model:e,track:t},t.id)))}):null,l.map((t=>(0,g.jsx)($,{model:e,track:t},t.id)))]}):(0,g.jsx)(n.Suspense,{fallback:null,children:(0,g.jsx)(he,{model:e})})})]})})),ye=me,be=(0,n.lazy)((()=>Promise.all([r.e(2826),r.e(9372)]).then(r.bind(r,29372)))),we=(0,i.observer)((function({model:e}){const{error:t,initialized:r,hasDisplayedRegions:n}=e;return r||t?!n||t?(0,g.jsx)(be,{model:e}):(0,g.jsx)(ye,{model:e}):(0,g.jsx)(a.LoadingEllipses,{variant:"h6"})}))},66885:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ObservableCreate:()=>i});var n=r(89592),a=r(37347);function i(e,t){return(0,a.SW)(t),new n.c((t=>{try{const r=e(t);r?.catch&&r.catch((e=>{t.error(e)}))}catch(e){t.error(e)}}))}},67736:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{constructor(e){super(e),this.heading=e.heading,this.HeadingComponent=e.HeadingComponent,this.configSchema=e.configSchema,this.stateModel=e.stateModel,this.ReactComponent=e.ReactComponent}}},68384:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>R});var n=r(7552),a=r(58921),i=r(68584);const o=(0,i.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{});var s=r(99546),l=r(8832),c=r(42489),d=r(36422),u=r(91468),p=r(6842);function g(e,t,r){return e.filter((e=>t.map((t=>r(t,e))).filter((e=>!!e)).length>5))}function h(e=[],t=[]){if(e[0]===t[0])return!0;{const r=new Set(e);return t.some((e=>r.has(e)))}}function f(e,t,r){const n=(0,i.readConfObject)(t,"category")||[],a=e.toLowerCase();return(0,u.getTrackName)(t,r).toLowerCase().includes(a)||!!n.filter((e=>e.toLowerCase().includes(a))).length}function m(e,t,r=0){let n=!1;for(const a of e)a.children.length?m(a.children,t,r+1)&&r>0&&t.push(a.id):n=!0;return n}function y(e,t){for(const r of e)r.children.length&&t.push(r.id)}const b=["category","adapter","description"];function w(e,t){const{assemblyManager:r}=(0,s.getSession)(t),{pluginManager:n}=(0,s.getEnv)(t),{view:a}=t;if(!a)return[];const o=t.assemblyNames.map((e=>r.get(e))).filter(s.notEmpty);return e.filter((e=>{const t=(0,i.readConfObject)(e,"assemblyNames"),n=t?.map((e=>r.get(e))).filter(s.notEmpty);return a.trackSelectorAnyOverlap?h(n,o):function(e=[],t=[]){const r=new Set(e);return t.every((e=>r.has(e)))}(n,o)})).filter((e=>{const{displayTypes:t}=n.getViewType(a.type);return h(t.map((e=>e.name)),e.displays.map((e=>e.type)))}))}function v({model:e,trackConfs:t,extra:r,noCategories:n,menuItems:a}){const o={children:[]},{collapsed:l,filterText:c,activeSortTrackNames:d,activeSortCategories:p,view:g}=e;if(!g)return[];const h=(0,s.getSession)(e),m=g.tracks,y=t.filter((e=>f(c,e,h)));for(const e of function(e,t,r){const n=e.map((e=>[e,(0,i.readConfObject)(e,"name"),(0,i.readConfObject)(e,"category")?.[0]||"",(0,i.readConfObject)(e,"category")?.[1]||"",(0,i.readConfObject)(e,"category")?.[2]||""]));return t&&n.sort(((e,t)=>e[1].localeCompare(t[1]))),r&&n.sort(((e,t)=>e[2]!==t[2]?e[2].localeCompare(t[2]):e[3]!==t[3]?e[3].localeCompare(t[3]):e[4]!==t[4]?e[4].localeCompare(t[4]):0)),n.map((e=>e[0]))}(y,d,p)){const t=[...(0,i.readConfObject)(e,"category")||[]];e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");let s=o;if(!n)for(let e=0;e<t.length;e++){const n=t[e],i=s.children.find((e=>e.name===n)),o=[r,t.slice(0,e+1).join(",")].filter((e=>!!e)).join("-");if(i)s=i;else{const e={children:[],name:n,id:o,isOpenByDefault:!l.get(o),menuItems:a,type:"category"};s.children.push(e),s=e}}const c=s.children.findIndex((e=>e.children.length)),d=-1===c?s.children.length:c;s.children.splice(d,0,{id:[r,e.trackId].filter((e=>!!e)).join(","),trackId:e.trackId,name:(0,u.getTrackName)(e,h),conf:e,checked:m.some((t=>t.configuration===e)),children:[],type:"track"})}return o.children}function S(){return"undefined"!=typeof window?[window.location.pathname,new URLSearchParams(window.location.search).get("config")].filter((e=>!!e)).join("-"):"empty"}function C(e){return["recentlyUsedTracks",S(),e.join(",")].filter((e=>!!e)).join("-")}function x(){return`favoriteTracks-${S()}}`}function k(e,t){return["collapsedCategories",S(),e.join(","),t].join("-")}function T(e,t){const r=(0,s.localStorageGetItem)(e);return null!=r&&r?JSON.parse(r):t}function A(e,t){null!=t&&(0,s.localStorageSetItem)(e,JSON.stringify(t))}const M=10;function P(e){return d.types.model("HierarchicalTrackSelectorWidget",{id:l.ElementId,type:d.types.literal("HierarchicalTrackSelectorWidget"),view:d.types.safeReference(e.pluggableMstType("view","stateModel")),faceted:d.types.optional(d.types.model("FacetedModel",{filterText:d.types.optional(d.types.string,""),showSparse:d.types.optional(d.types.boolean,(()=>(0,s.localStorageGetBoolean)("facet-showSparse",!1))),showFilters:d.types.optional(d.types.boolean,(()=>(0,s.localStorageGetBoolean)("facet-showFilters",!0))),showOptions:d.types.optional(d.types.boolean,(()=>(0,s.localStorageGetBoolean)("facet-showTableOptions",!1))),panelWidth:d.types.optional(d.types.number,(()=>(0,s.localStorageGetNumber)("facet-panelWidth",400)))}).volatile((()=>({visible:{},useShoppingCart:!1,filters:c.observable.map()}))).actions((e=>({setFilter(t,r){e.filters.set(t,r)},setPanelWidth:t=>(e.panelWidth=t,e.panelWidth),setUseShoppingCart(t){e.useShoppingCart=t},setFilterText(t){e.filterText=t},setShowSparse(t){e.showSparse=t},setShowOptions(t){e.showOptions=t},setShowFilters(t){e.showFilters=t}}))).views((e=>({get allTrackConfigurations(){return(0,d.getParent)(e).allTrackConfigurations}}))).views((e=>({get rows(){const t=(0,s.getSession)(e),{allTrackConfigurations:r,filterText:n}=e;return r.filter((e=>f(n,e,t))).map((e=>({id:e.trackId,conf:e,name:(0,u.getTrackName)(e,t),category:(0,i.readConfObject)(e,"category")?.join(", "),adapter:(0,i.readConfObject)(e,"adapter")?.type,description:(0,i.readConfObject)(e,"description"),metadata:(0,i.readConfObject)(e,"metadata")})))}}))).views((e=>({get filteredNonMetadataKeys(){return e.showSparse?b:g(b,e.rows,((e,t)=>e[t]))},get metadataKeys(){return[...new Set(e.rows.flatMap((e=>{return t=e.metadata,Object.entries(t).map((([e,t])=>"string"==typeof t?e:"")).filter((e=>!!e));var t})))]},get filteredMetadataKeys(){return e.showSparse?this.metadataKeys:g(this.metadataKeys,e.rows,((e,t)=>e.metadata[t]))},get fields(){return["name",...this.filteredNonMetadataKeys,...this.filteredMetadataKeys.map((e=>`metadata.${e}`))]},get filteredRows(){const t=[...e.filters.entries()].filter((e=>e[1].length>0)).map((([e,t])=>[e,new Set(t)]));return e.rows.filter((e=>t.every((([t,r])=>r.has((0,p.a)(t,e))))))}}))).actions((e=>({setVisible(t){e.visible=t},afterAttach(){(0,d.addDisposer)(e,(0,c.autorun)((()=>{this.setVisible(Object.fromEntries(e.fields.map((e=>[e,!0]))))})))}}))),{})}).volatile((()=>({favorites:T(x(),[]),recentlyUsed:[],selection:[],sortTrackNames:T("sortTrackNames",void 0),sortCategories:T("sortCategories",void 0),collapsed:c.observable.map(),filterText:"",recentlyUsedCounter:0,favoritesCounter:0}))).views((e=>({get shownTrackIds(){return new Set(e.view?.tracks?.map((e=>e.configuration.trackId)))},get selectionSet(){return new Set(e.selection)},get favoritesSet(){return new Set(e.favorites)},get recentlyUsedSet(){return new Set(e.recentlyUsed)},get assemblyNames(){return e.view?.assemblyNames||[]}}))).actions((e=>({setSortTrackNames(t){e.sortTrackNames=t},setSortCategories(t){e.sortCategories=t},setSelection(t){e.selection=t},addToSelection(t){e.selection=(0,s.dedupe)([...e.selection,...t],(e=>e.trackId))},removeFromSelection(t){const r=new Set(t);e.selection=e.selection.filter((e=>!r.has(e)))},clearSelection(){e.selection=[]},addToFavorites(t){e.favoritesCounter+=1,e.favorites=[...e.favorites,t]},removeFromFavorites(t){e.favorites=e.favorites.filter((e=>e!==t))},clearFavorites(){e.favorites=[]},setRecentlyUsedCounter(t){e.recentlyUsedCounter=t},setRecentlyUsed(t){e.recentlyUsed=t},setFavorites(t){e.favorites=t},setFavoritesCounter(t){e.favoritesCounter=t},addToRecentlyUsed(t){e.recentlyUsed.includes(t)||(e.recentlyUsedCounter=Math.min(e.recentlyUsedCounter+1,M),e.recentlyUsed=e.recentlyUsed.length>=M?[...e.recentlyUsed.slice(1),t]:[...e.recentlyUsed,t])},clearRecentlyUsed(){e.recentlyUsed=[]},setView(t){e.view=t},toggleCategory(t){e.collapsed.set(t,!e.collapsed.get(t))},setCategoryCollapsed(t,r){e.collapsed.set(t,r)},expandAllCategories(){e.collapsed.clear()},setCollapsedCategories(t){e.collapsed.replace(t)},clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}}))).views((t=>({isSelected:e=>t.selectionSet.has(e),isFavorite:e=>t.favoritesSet.has(e),isRecentlyUsed:e=>t.recentlyUsedSet.has(e),getRefSeqTrackConf(r){const{assemblyManager:n}=(0,s.getSession)(t),a=n.get(r),i=a?.configuration.sequence,o=e.getViewType(t.view.type);if(i)for(const e of i.displays)if(o.displayTypes.some((t=>t.name===e.type)))return i}}))).views((e=>({get activeSortTrackNames(){return e.sortTrackNames??(0,i.getConf)((0,s.getSession)(e),["hierarchical","sort","trackNames"])},get activeSortCategories(){return e.sortCategories??(0,i.getConf)((0,s.getSession)(e),["hierarchical","sort","categories"])},get configAndSessionTrackConfigurations(){return[...e.assemblyNames.map((t=>e.getRefSeqTrackConf(t))),...w((0,s.getSession)(e).tracks,e)].filter(s.notEmpty)},get allTrackConfigurations(){const{connectionInstances:t=[]}=(0,s.getSession)(e);return[...this.configAndSessionTrackConfigurations,...t.flatMap((e=>e.tracks))]},get allTrackConfigurationTrackIdSet(){return new Map(this.allTrackConfigurations.map((e=>[e.trackId,e])))}}))).views((e=>({get favoriteTracks(){return e.favorites.filter((t=>e.allTrackConfigurationTrackIdSet.has(t))).map((t=>e.allTrackConfigurationTrackIdSet.get(t)))},get recentlyUsedTracks(){return e.recentlyUsed.filter((t=>e.allTrackConfigurationTrackIdSet.has(t))).map((t=>e.allTrackConfigurationTrackIdSet.get(t)))}}))).views((e=>({get allTracks(){const{connectionInstances:t=[]}=(0,s.getSession)(e);return[{group:"Tracks",tracks:e.configAndSessionTrackConfigurations,noCategories:!1,menuItems:[]},...t.flatMap((e=>({group:(0,i.getConf)(e,"name"),tracks:e.tracks,noCategories:!1,menuItems:[]})))]}}))).views((e=>({get hierarchy(){return{name:"Root",id:"Root",isOpenByDefault:!0,type:"category",children:e.allTracks.map((t=>({name:t.group,id:t.group,type:"category",isOpenByDefault:!e.collapsed.get(t.group),menuItems:t.menuItems,children:v({model:e,trackConfs:t.tracks,extra:t.group,noCategories:t.noCategories})})))}}}))).actions((e=>({collapseSubCategories(){const t=[];m(e.hierarchy.children,t);for(const r of t)e.setCategoryCollapsed(r,!0)},collapseTopLevelCategories(){const t=[];for(const r of e.hierarchy.children)r.children.length&&y(r.children,t);for(const r of t)e.setCategoryCollapsed(r,!0)}}))).views((e=>({get hasAnySubcategories(){return e.allTracks.some((e=>e.tracks.some((e=>(0,i.readConfObject)(e,"category")?.length>1))))}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,c.autorun)((()=>{const{assemblyNames:t,view:r}=e;if(e.setRecentlyUsed(T(C(t),[])),r){const n=T(k(t,r.type),void 0),a=["hierarchical","defaultCollapsed"],o=(0,s.getSession)(e);if(n)e.setCollapsedCategories(n);else{e.expandAllCategories(),(0,i.getConf)(o,[...a,"topLevelCategories"])&&e.collapseTopLevelCategories(),(0,i.getConf)(o,[...a,"subCategories"])&&e.collapseSubCategories();for(const t of(0,i.getConf)(o,[...a,"categoryNames"]))e.setCategoryCollapsed(`Tracks-${t}`,!0)}}}))),(0,d.addDisposer)(e,(0,c.autorun)((()=>{const{sortTrackNames:t,sortCategories:r,favorites:n,recentlyUsed:a,assemblyNames:i,collapsed:o,view:s}=e;A(C(i),a),A(x(),n),A("sortTrackNames",t),A("sortCategories",r),s&&A(k(i,s.type),o)})))}})))}function R(e){e.addWidgetType((()=>new a.WidgetType({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:o,stateModel:P(e),ReactComponent:(0,n.lazy)((()=>Promise.all([r.e(8989),r.e(5331)]).then(r.bind(r,25331))))})))}},69426:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(7552),a=r(68584),i=r(58921),o=r(8832),s=r(36422);const l=s.types.model("AddConnectionModel",{id:o.ElementId,type:s.types.literal("AddConnectionWidget")}),c=(0,a.ConfigurationSchema)("AddConnectionWidget",{});function d(e){e.addWidgetType((()=>new i.WidgetType({name:"AddConnectionWidget",heading:"Add a connection",configSchema:c,stateModel:l,ReactComponent:(0,n.lazy)((()=>Promise.all([r.e(9721),r.e(5649)]).then(r.bind(r,45649))))})))}},69566:(e,t,r)=>{"use strict";r.d(t,{Fm:()=>u,M_:()=>o,bC:()=>c});var n=r(350),a=r(99546);const i={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted_duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};function o(e,t,r){if(!t||0===t.length)return["remark","no alternative alleles"];const n=new Set;let a=new Set;for(const i of t){let[t,o]=s(i,r);t||([t,o]=l(e,i)),t&&o&&(n.add(t),a.add(o))}if(a.size>1){const e=[...a],t=new Set(e.map((e=>{const t=e.split("->");return t[1]?t[0]:e})).filter((e=>!!e)));a=new Set([...t].map((e=>e.trim())).map((t=>{const r=e.map((e=>e.split("->").map((e=>e.trim())))).map((e=>e[1]&&e[0]===t?e[1]:"")).filter((e=>!!e));return r.length?`${t} -> ${r.join(",")}`:t})))}return n.size?[[...n].join(","),[...a].join(",")]:[]}function s(e,t){if("string"==typeof e&&!e.startsWith("<"))return[];let r=i[e];if(!r&&t.getMetadata("ALT",e)&&(r="sequence_variant"),r)return[r,e];const n=e.split(":");return n.length>1?s(`<${n.slice(0,-1).join(":")}>`,t):[]}function l(e,t){if((0,n.h)(t))return["breakend",t];if(1===e.length&&1===t.length)return["SNV",d("SNV",e,t)];if("<INS>"===t)return["insertion",t];if("<DEL>"===t)return["deletion",t];if("<DUP>"===t)return["duplication",t];if("<CNV>"===t)return["cnv",t];if("<INV>"===t)return["inversion",t];if("<TRA>"===t)return["translocation",t];if(t.includes("<"))return["sv",t];if(e.length===t.length){const r=e.length,n=t.length;if(r>5||n>5){const i=(0,a.getBpDisplayStr)(r),o=(0,a.getBpDisplayStr)(n);return e.split("").reverse().join("")===t?["inverson",d("inv",i,o)]:["substitution",d("substitution",i,o)]}return e.split("").reverse().join("")===t?["inversion",d("inv",e,t)]:["substitution",d("substitution",e,t)]}if(e.length<=t.length){const r=t.length-e.length,n=t.length,i=e.length,o=(0,a.getBpDisplayStr)(r);return["insertion",i>5||n>5?`${o} INS`:d("insertion",r>5?o:e,t)]}if(e.length>t.length){const r=e.length,n=t.length,i=(0,a.getBpDisplayStr)(r-n);return["deletion",r>5||n>5?`${i} DEL`:d("deletion",e,t)]}return["indel",d("indel",e,t)]}function c(e,t){if((0,n.h)(t))return t;if(1===e.length&&1===t.length)return t;if("<INS>"===t)return t;if("<DEL>"===t)return t;if("<DUP>"===t)return t;if("<CNV>"===t)return t;if("<INV>"===t)return t;if("<TRA>"===t)return t;if(t.includes("<"))return t;if(e.length===t.length){const r=e.length,n=t.length;if(r>5||n>5){const i=(0,a.getBpDisplayStr)(r),o=(0,a.getBpDisplayStr)(n);return e.split("").reverse().join("")===t?d("inv",i,o):d("substitution",i,o)}return e.split("").reverse().join("")===t?d("inv",e,t):d("substitution",e,t)}if(e.length<=t.length){const r=t.length-e.length,n=t.length,i=e.length,o=(0,a.getBpDisplayStr)(r);return i>5||n>5?`${o} INS`:d("insertion",r>5?o:e,t)}if(e.length>t.length){const r=e.length,n=t.length,i=(0,a.getBpDisplayStr)(r-n);return r>5||n>5?`${i} DEL`:d("deletion",e,t)}return d("indel",e,t)}function d(e,t,r){return`${e} ${[t,r].join(" -> ")}`}function u(e,t,r){return e.split(/[/|]/).map((e=>"."===e?".":0==+e?`ref(${t.length<10?t:(0,a.getBpDisplayStr)(t.length)})`:c(t,r[+e-1]||""))).join(e.includes("|")?"|":"/")}},70129:(e,t,r)=>{"use strict";r.d(t,{A:()=>G});var n={};r.r(n),r.d(n,{CoreFreeResources:()=>A,CoreGetFeatureDensityStats:()=>M,CoreGetFeatureDetails:()=>y,CoreGetFeatures:()=>x,CoreGetFileInfo:()=>w,CoreGetMetadata:()=>b,CoreGetRefNames:()=>f,CoreRender:()=>T});var a=r(36422),i=r(7552),o=r(9342),s=r(12678),l=r(68584);const c=(0,l.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0,preProcessSnapshot:e=>e.uri?{...e,cytobandLocation:{uri:e.uri,baseUri:e.baseUri}}:e});var d=r(58921),u=r(67736),p=r(46377),g=r(3496),h=r(2406);class f extends h.A{name="CoreGetRefNames";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:i}=n,{dataAdapter:o}=await(0,g.cK)(r,a,i);return(0,p.isFeatureAdapter)(o)?o.getRefNames(n):[]}}var m=r(99546);class y extends h.A{name="CoreGetFeatureDetails";async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,m.renameRegionsIfNeeded)(n,e),i=await super.serializeArguments(a,t);if("MainThreadRpcDriver"===t)return i;const{rendererType:o}=e;return this.pluginManager.getRendererType(o).serializeArgsInClient(i)}async execute(e,t){let r=e;"MainThreadRpcDriver"!==t&&(r=await this.deserializeArguments(e,t));const{rendererType:n,featureId:a}=r,i=this.pluginManager.getRendererType(n);return{feature:i.getLayoutSession(e)?.cachedLayout.layout.getDataByID(a)?.toJSON()}}}class b extends h.A{name="CoreGetMetadata";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:i}=n,{dataAdapter:o}=await(0,g.cK)(r,a,i);return(0,p.isFeatureAdapter)(o)?o.getMetadata(n):null}}class w extends h.A{name="CoreGetInfo";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:i}=n,{dataAdapter:o}=await(0,g.cK)(r,a,i);return(0,p.isFeatureAdapter)(o)?o.getHeader(n):null}}var v=r(44728),S=r(82088),C=r(6434);class x extends h.A{name="CoreGetFeatures";async deserializeReturn(e,t,r){return(await super.deserializeReturn(e,t,r)).map((e=>new C.A(e)))}async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,m.renameRegionsIfNeeded)(n,e);return super.serializeArguments(a,t)}async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{stopToken:a,sessionId:i,adapterConfig:o,regions:s,opts:l}=n,{dataAdapter:c}=await(0,g.cK)(r,i,o);if(!(0,p.isFeatureAdapter)(c))throw new Error("Adapter does not support retrieving features");const d=c.getFeaturesInMultipleRegions(s,{...l,stopToken:a});return(await(0,v._)(d.pipe((0,S.$)()))).map((e=>e.toJSON()))}}function k(e,t){if(!t.ReactComponent)throw new Error(`renderer ${e} has no ReactComponent, it may not be completely implemented yet`);return t}class T extends h.A{name="CoreRender";async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,m.renameRegionsIfNeeded)(n,e),i=await super.serializeArguments(a,t);return"MainThreadRpcDriver"===t?i:k(e.rendererType,this.pluginManager.getRendererType(e.rendererType)).serializeArgsInClient(i)}async execute(e,t){let r=e;"MainThreadRpcDriver"!==t&&(r=await this.deserializeArguments(e,t));const{sessionId:n,rendererType:a}=r;if(!n)throw new Error("must pass a unique session id");const i=k(a,this.pluginManager.getRendererType(a));return"MainThreadRpcDriver"===t?await i.render(r):await i.renderInWorker(r)}async deserializeReturn(e,t,r){const n=await super.deserializeReturn(e,t,r);return"MainThreadRpcDriver"===r?n:k(t.rendererType,this.pluginManager.getRendererType(t.rendererType)).deserializeResultsInClient(n,t)}}class A extends h.A{name="CoreFreeResources";async execute(e){(0,g.pZ)(e);for(const t of this.pluginManager.getRendererTypes())t.freeResources(e)}async serializeArguments(e,t){return e}}class M extends h.A{name="CoreGetFeatureDensityStats";async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,m.renameRegionsIfNeeded)(n,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(a,t)}async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:i,regions:o}=n,{dataAdapter:s}=await(0,g.cK)(r,i,a);if(!(0,p.isFeatureAdapter)(s))throw new Error("Adapter does not support retrieving features");return s.getMultiRegionFeatureDensityStats(o,n)}}class P extends s.A{name="CorePlugin";install(e){for(const t of Object.values(n))e.addRpcMethod((()=>new t(e)));!function(e){e.addAdapterType((()=>new d.AdapterType({name:"CytobandAdapter",configSchema:c,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(4284).then(r.bind(r,94284)).then((e=>e.default))})))}(e),e.addWidgetType((()=>new u.A({name:"BaseFeatureWidget",heading:"Feature details",configSchema:o.Q,stateModel:(0,o.n)(e),ReactComponent:(0,i.lazy)((()=>Promise.all([r.e(238),r.e(6275),r.e(6386),r.e(1475),r.e(4144),r.e(3300)]).then(r.bind(r,93300))))})))}}var R=r(44278),L=r(47369),I=r(32767),F=r(91612),N=r(56328),D=r(92070),B=r(8024),V=r(58273),j=r(63589),E=r(95742),z=r(53085);class O{phaseCallbacks=new Map;phaseOrder=[];constructor(...e){this.phaseOrder=e}add(e,t){if(!this.phaseOrder.includes(e))throw new Error(`unknown phase ${e}`);let r=this.phaseCallbacks.get(e);r||(r=[],this.phaseCallbacks.set(e,r)),r.push(t)}run(){for(const e of this.phaseOrder)for(const t of this.phaseCallbacks.get(e)||[])t()}}class H{registeredTypes={};constructor(e,t){this.typeName=e,this.baseClass=t}add(e,t){this.registeredTypes[e]=t}has(e){return e in this.registeredTypes}get(e){if(!this.has(e))throw new Error(`${this.typeName} '${e}' not found, perhaps its plugin is not loaded or its plugin has not added it.`);return this.registeredTypes[e]}all(){return Object.values(this.registeredTypes)}}class G{plugins=[];jexl=(0,z.A)();pluginMetadata={};runtimePluginDefinitions=[];elementCreationSchedule=new O("renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account","add track workflow");rendererTypes=new H("RendererType",E.default);adapterTypes=new H("AdapterType",L.A);textSearchAdapterTypes=new H("TextSearchAdapterType",B.A);trackTypes=new H("TrackType",V.A);displayTypes=new H("DisplayType",N.A);connectionTypes=new H("ConnectionType",F.A);viewTypes=new H("ViewType",j.A);widgetTypes=new H("WidgetType",u.A);rpcMethods=new H("RpcMethodType",h.A);addTrackWidgets=new H("AddTrackWorkflow",I.A);internetAccountTypes=new H("InternetAccountType",D.A);configured=!1;extensionPoints=new Map;constructor(e=[]){this.addPlugin({plugin:new P,metadata:{isCore:!0}});for(const t of e)this.addPlugin(t)}pluginConfigurationSchemas(){const e={};for(const t of this.plugins)t.configurationSchema&&(e[t.name]=t.configurationSchema);return e}addPlugin(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");const[t,r={}]="install"in e&&"configure"in e?[e,{}]:[e.plugin,e.metadata];if(this.plugins.includes(t))throw new Error("plugin already installed");return this.pluginMetadata[t.name]=r,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),t.install(this),this.plugins.push(t),this}getPlugin(e){return this.plugins.find((t=>t.name===e))}hasPlugin(e){return void 0!==this.getPlugin(e)}createPluggableElements(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),this.elementCreationSchedule=void 0),this}setRootModel(e){return this.rootModel=e,this}configure(){if(this.configured)throw new Error("already configured");for(const e of this.plugins)e.configure(this);return this.configured=!0,this}getElementTypeRecord(e){switch(e){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;case"add track workflow":return this.addTrackWidgets;default:throw new Error(`invalid element type '${e}'`)}}addElementType(e,t){if("function"!=typeof t)throw new Error("must provide a callback function that returns the new type object");const r=this.getElementTypeRecord(e);return this.elementCreationSchedule?.add(e,(()=>{const n=t(this);if(!n.name)throw new Error(`cannot add a ${e} with no name`);r.has(n.name)?console.warn(`${e} ${n.name} already registered, cannot register it again`):r.add(n.name,this.evaluateExtensionPoint("Core-extendPluggableElement",n))})),this}getElementType(e,t){return this.getElementTypeRecord(e).get(t)}getElementTypesInGroup(e){return this.getElementTypeRecord(e).all()}getViewElements(){return this.getElementTypesInGroup("view")}getTrackElements(){return this.getElementTypesInGroup("track")}getConnectionElements(){return this.getElementTypesInGroup("connection")}getAddTrackWorkflowElements(){return this.getElementTypesInGroup("add track workflow")}getRpcElements(){return this.getElementTypesInGroup("rpc method")}getDisplayElements(){return this.getElementTypesInGroup("display")}getAdapterElements(){return this.getElementTypesInGroup("adapter")}pluggableMstType(e,t,r=a.types.maybe(a.types.null)){const n=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,a.isType)(e)&&(0,a.isModelType)(e)));return 0===n.length&&"undefined"==typeof jest?(console.warn(`No pluggable types found matching ('${e}','${t}')`),r):a.types.union(...n)}pluggableConfigSchemaType(e,t="configSchema"){const r=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,l.isBareConfigurationSchemaType)(e)));return 0===r.length&&r.push((0,l.ConfigurationSchema)("Null",{})),a.types.union(...r)}jbrequireCache=new Map;lib=R.A;load=e=>(this.jbrequireCache.has(e)||this.jbrequireCache.set(e,e(this)),this.jbrequireCache.get(e));jbrequire=e=>{if("string"==typeof e){const t=this.lib[e];if(!t)throw new TypeError(`No jbrequire re-export defined for package '${e}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`);return t}if("function"==typeof e)return this.load(e);if(e.default)return console.warn("initiated jbrequire on a {default:Function}"),this.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")};getRendererType(e){return this.rendererTypes.get(e)}getRendererTypes(){return this.rendererTypes.all()}getAdapterType(e){return this.adapterTypes.get(e)}getTextSearchAdapterType(e){return this.textSearchAdapterTypes.get(e)}getTrackType(e){return this.trackTypes.get(e)}getDisplayType(e){return this.displayTypes.get(e)}getViewType(e){return this.viewTypes.get(e)}getAddTrackWorkflow(e){return this.addTrackWidgets.get(e)}getWidgetType(e){return this.widgetTypes.get(e)}getConnectionType(e){return this.connectionTypes.get(e)}getRpcMethodType(e){return this.rpcMethods.get(e)}getInternetAccountType(e){return this.internetAccountTypes.get(e)}addRendererType(e){return this.addElementType("renderer",e)}addAdapterType(e){return this.addElementType("adapter",e)}addTextSearchAdapterType(e){return this.addElementType("text search adapter",e)}addTrackType(e){return this.addElementType("track",(()=>{const t=e(this),r=this.getElementTypesInGroup("display");for(const e of r)e.trackType!==t.name||t.displayTypes.includes(e)||t.addDisplayType(e);return t}))}addDisplayType(e){return this.addElementType("display",e)}addViewType(e){return this.addElementType("view",(()=>{const t=e(this),r=this.getElementTypesInGroup("display");for(const e of r)e.viewType!==t.name&&e.viewType!==t.extendedName||t.displayTypes.includes(e)||t.addDisplayType(e);return t}))}addWidgetType(e){return this.addElementType("widget",e)}addConnectionType(e){return this.addElementType("connection",e)}addRpcMethod(e){return this.addElementType("rpc method",e)}addInternetAccountType(e){return this.addElementType("internet account",e)}addAddTrackWorkflowType(e){return this.addElementType("add track workflow",e)}addToExtensionPoint(e,t){let r=this.extensionPoints.get(e);r||(r=[],this.extensionPoints.set(e,r)),r.push(t)}evaluateExtensionPoint(e,t,r){const n=this.extensionPoints.get(e);let a=t;if(n)for(const e of n)try{a=e(a,r)}catch(e){console.error(e)}return a}async evaluateAsyncExtensionPoint(e,t,r){const n=this.extensionPoints.get(e);let a=t;if(n)for(const e of n)try{a=await e(a,r)}catch(e){console.error(e)}return a}}},73716:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var n=r(7552),a=r(67112),i=r(9236),o=r(99546),s=r(68446),l=r(75785),c=r(69500);const d=(0,l.n9)()({resizeHandle:{height:4,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}),u=(0,s.observer)((function({children:e,model:t,exportSVG:r}){const{height:n}=t,{width:a,offsetPx:i}=(0,o.getContainingView)(t),s=Math.max(0,-i);return r?(0,c.jsx)("g",{transform:`translate(${s})`,children:e}):(0,c.jsx)("svg",{style:{position:"absolute",top:0,left:s,height:n,width:a},children:e})})),p=(0,s.observer)((function({model:e,exportSVG:t}){const{classes:r}=d(),{assemblyManager:i}=(0,o.getSession)(e),s=(0,o.getContainingView)(e),[l,p]=(0,n.useState)(),{lineZoneHeight:g,featuresVolatile:m}=e,{assemblyNames:y,dynamicBlocks:b}=s,w=i.get(y[0]),v=(b.contentBlocks[0]?.widthPx||0)/(m?.length||1);return w&&m?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(u,{exportSVG:t,model:e,children:[(0,c.jsx)(f,{model:e,setMouseOverLine:p}),l?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("line",{stroke:"#f00c",strokeWidth:2,style:{pointerEvents:"none"},x1:l.idx*v+v/2,x2:l.c,y1:g,y2:0,onMouseLeave:()=>{p(void 0)}}),(0,c.jsx)(h,{contents:l.f.get("name")})]}):null]}),t?null:(0,c.jsx)(a.ResizeHandle,{style:{position:"absolute",top:g-4},onDrag:t=>e.setLineZoneHeight(g+t),className:r.resizeHandle})]}):null})),g=(0,n.forwardRef)((function({message:e},t){return(0,c.jsx)("div",{ref:t,children:(0,n.isValidElement)(e)?e:e?(0,c.jsx)(a.SanitizedHTML,{html:String(e)}):null})})),h=(0,s.observer)((function({contents:e}){return e?(0,c.jsx)(i.A,{children:(0,c.jsx)(g,{message:e})}):null})),f=(0,s.observer)((function({model:e,setMouseOverLine:t}){const{assemblyManager:r}=(0,o.getSession)(e),n=(0,o.getContainingView)(e),{lineZoneHeight:a,featuresVolatile:i}=e,{offsetPx:s,assemblyNames:l,dynamicBlocks:d}=n,u=r.get(l[0]),p=(d.contentBlocks[0]?.widthPx||0)/(i?.length||1),g=Math.max(s,0);return u&&i?(0,c.jsx)(c.Fragment,{children:i.map(((e,r)=>{const i=e.get("refName"),o=(n.bpToPx({refName:u.getCanonicalRefName(i)||i,coord:e.get("start")})?.offsetPx||0)-g;return(0,c.jsx)("line",{stroke:"#0004",strokeWidth:1,x1:r*p+p/2,x2:o,y1:a,y2:0,onMouseEnter:()=>{t({f:e,idx:r,c:o})},onMouseLeave:()=>{t(void 0)}},e.id())}))}):null})),m=p},75429:(e,t,r)=>{"use strict";r.r(t),r.d(t,{YSCALEBAR_LABEL_OFFSET:()=>o,fillRectCtx:()=>p,getNiceDomain:()=>c,getOrigin:()=>l,getScale:()=>s,round:()=>u,toP:()=>d});var n=r(45824),a=r(35873),i=r(6754);const o=5;function s({domain:e=[],range:t=[],scaleType:r,pivotValue:o,inverted:s}){let l;const[c,d]=e;if(void 0===c||void 0===d)throw new Error("invalid domain");if("linear"===r)l=(0,n.A)();else if("log"===r)l=(0,a.A)().base(2);else{if("quantize"!==r)throw new Error("undefined scaleType");l=(0,i.A)()}l.domain(void 0!==o?[c,o,d]:[c,d]),l.nice();const[u,p]=t;if(void 0===u||void 0===p)throw new Error("invalid range");return l.range(s?t.slice().reverse():t),l}function l(e){return"log"===e?1:0}function c({scaleType:e,domain:t,bounds:r}){const[o,s]=r;let[l,c]=t;"linear"===e&&(c<0&&(c=0),l>0&&(l=0)),"log"===e&&l>=0&&c>1&&(l=1),void 0!==o&&o!==Number.MIN_VALUE&&(l=o),void 0!==s&&s!==Number.MAX_VALUE&&(c=s);const d=(e=>{if("linear"===e)return(0,n.A)();if("log"===e){const e=(0,a.A)();return e.base(2),e}if("quantize"===e)return(0,i.A)();throw new Error(`undefined scaleType ${e}`)})(e);return d.domain([l,c]),d.nice(),d.domain()}function d(e=0){return+(+e).toPrecision(6)}function u(e){return Math.round(1e5*e)/1e5}function p(e,t,r,n,a,i){r<0&&(e+=r,r=-r),n<0&&(t+=n,n=-n),i&&(a.fillStyle=i),a.fillRect(e,t,r,n)}},75762:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(22593),a=r.n(n);class i{constructor({rectangles:e,totalHeight:t,maxHeightReached:r}){this.rectangles=new Map(Object.entries(e)),this.totalHeight=t,this.maxHeightReached=r,this.rbush=new(a());for(const[t,r]of Object.entries(e))this.rbush.insert({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],name:t})}addRect(e){const t=this.rectangles.get(e);if(!t)throw new Error(`id ${e} not found in precomputed feature layout`);return t[1]}getRectangles(){return this.rectangles}getTotalHeight(){return this.totalHeight}collides(e,t){throw new Error("Method not implemented.")}getByCoord(e,t){const r={minX:e,minY:t,maxX:e+1,maxY:t+1};return this.rbush.collides(r)?this.rbush.search(r)[0].name:void 0}getByID(e){return this.rectangles.get(e)}addRectToBitmap(e,t){throw new Error("Method not implemented.")}discardRange(e,t){throw new Error("Method not implemented.")}serializeRegion(e){throw new Error("Method not implemented.")}toJSON(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}},76239:(e,t,r)=>{"use strict";r.d(t,{Es:()=>l,Gu:()=>a,Ij:()=>n,P5:()=>c,Rd:()=>s,i3:()=>o,jE:()=>i});const n=48,a=20,i=17,o=3,s=2,l=7,c=32},76530:(e,t,r)=>{"use strict";r.d(t,{$G:()=>o,Db:()=>s,fK:()=>l,mh:()=>a});var n=r(99546);class a{constructor(e=[]){this.blocks=e}push(e){if("ElidedBlock"===e.type&&this.blocks.length>0){const t=this.blocks.at(-1);if("ElidedBlock"===t?.type)return void t.push(e)}this.blocks.push(e)}getBlocks(){return this.blocks}getRegions(){return this.blocks.map((e=>e.toRegion()))}map(e,t){return this.blocks.map(e,t)}forEach(e,t){this.blocks.forEach(e,t)}get length(){return this.blocks.length}get totalWidthPx(){return this.blocks.length>0?(0,n.sum)(this.blocks.map((e=>e.widthPx))):0}get totalWidthPxWithoutBorders(){return this.blocks.length>0?(0,n.sum)(this.blocks.filter((e=>"boundary"!==e.variant)).map((e=>e.widthPx))):0}get offsetPx(){return this.blocks.length>0?this.blocks[0].offsetPx:0}get contentBlocks(){return this.blocks.filter((e=>"ContentBlock"===e.type))}get totalBp(){return(0,n.sum)(this.contentBlocks.map((e=>e.end-e.start)))}}class i{type="BaseBlock";widthPx=0;constructor(e){Object.assign(this,e),this.assemblyName=e.assemblyName,this.refName=e.refName,this.start=e.start,this.end=e.end,this.key=e.key,this.offsetPx=e.offsetPx}toRegion(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}class o extends i{type="ContentBlock"}class s extends i{type="ElidedBlock";elidedBlockCount=0;constructor(e){super(e),this.widthPx=e.widthPx}push(e){this.elidedBlockCount+=1,this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx}}class l extends i{type="InterRegionPaddingBlock"}},80208:(e,t,r)=>{"use strict";r.r(t),r.d(t,{contrastingTextColor:()=>s,emphasize:()=>c,isNamedColor:()=>o,makeContrasting:()=>d,namedColorToHex:()=>i});var n=r(62266);const a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(e){return a[e]}function o(e){return!!a[e]}function s(e){return l(e)>.5?"black":"white"}function l(e){const t=i(e);return(0,n.J1)(t||e)}function c(e,t=.15){const r=i(e);return(0,n.tL)(r||e,t)}function d(e,t="white",r=3){let a=i(e)||e;const o=i(t)||t,s=l(o);let c=(0,n.eM)(a,o);const d=a;let u=.05;for(;c<r;)a=s>.5?(0,n.e$)(d,u):(0,n.a)(d,u),u+=.05,c=(0,n.eM)(a,o);return a}},80256:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var n=r(99546),a=r(91468);async function i({self:e,tag:t,blocks:r,opts:i}){const{rpcManager:o}=(0,n.getSession)(e),{adapterConfig:s}=e,l=(0,a.getRpcSessionId)(e);return await o.call((0,a.getRpcSessionId)(e),"PileupGetGlobalValueForTag",{adapterConfig:s,tag:t,sessionId:l,regions:r.contentBlocks,...i})}},80703:(e,t,r)=>{"use strict";r.d(t,{L:()=>a});var n=r(26257);function a(e={}){return`${(0,n.A)(e)}`}},83059:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(69481),a=r(68584),i=r(43334);class o{adapterCache=new i.A({maxSize:15});constructor(e){this.pluginManager=e}loadTextSearchAdapters(e){return Promise.all(this.relevantAdapters(e).map((async e=>{const t=(0,a.readConfObject)(e,"textSearchAdapterId"),r=this.adapterCache.get(t);if(r)return r;{const r=this.pluginManager.getTextSearchAdapterType(e.type),n=new(await r.getAdapterClass())(e,void 0,this.pluginManager);return this.adapterCache.set(t,n),n}})))}relevantAdapters(e){const t=this.pluginManager.rootModel,{aggregateTextSearchAdapters:r}=t?.jbrowse,{tracks:n}=t?.session,{assemblyName:a}=e;return[...this.getAdaptersWithAssembly(a,r),...this.getTrackAdaptersWithAssembly(a,n)]}getAdaptersWithAssembly(e,t){return t.filter((t=>(0,a.readConfObject)(t,"assemblyNames")?.includes(e)))}getTrackAdaptersWithAssembly(e,t){return t.filter((t=>(0,a.readConfObject)(t,["textSearching","textSearchAdapter","assemblyNames"])?.includes(e))).map((e=>e.textSearching.textSearchAdapter))}async search(e,t,r){return this.search2({args:e,searchScope:t,rankFn:r})}async search2({args:e,searchScope:t,rankFn:r}){const n=await this.loadTextSearchAdapters(t),a=await Promise.all(n.map((t=>t.searchIndex(e))));return this.sortResults2({args:e,results:a.flat(),rankFn:r})}sortResults2({results:e,rankFn:t,args:r}){const a=new n.A({}),i=e.map((e=>e.getDisplayString())),o=r.queryString,s=a.filter(i,o),l=[];if(null!=s&&s.length>0){const t=a.info(s,i,o),r=a.sort(t,i,o);for(const n of r)l.push(e[t.idx[n]])}return t(l)}}},84481:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var n=r(99546),a=r(68446),i=r(50574),o=r(76239),s=r(69500);function l(e,t,r,n,a){return`M${e},${t}h${r-a}a${a},${a} 0 0 1 ${a},${a}v${n-2*a}a${a},${a} 0 0 1 ${-a},${a}h${a-r}z`}function c(e,t,r,n){return[[e,0],[e+r,n/2],[e,n]].toString()}function d(e,t,r,n){return[[e,n/2],[e+r,0],[e+r,n]].toString()}const u={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},p=(0,a.observer)((function({overview:e,block:t,assembly:r}){const{offsetPx:a,reversed:p}=t,g=(0,i.S5)(r,t.refName),h=p?g.length-1:0,f=p?0:g.length-1,m=o.Gu;let y=!1,b="",w=0;return(0,s.jsx)("g",{transform:`translate(-${a})`,children:g.map(((t,r)=>{const a=JSON.stringify(t),{refName:i,name:o,type:g,start:v,end:S}=t,C=e.bpToPx({refName:i,coord:v})||0,x=e.bpToPx({refName:i,coord:S})||0,k=Math.min(C,x),T=Math.abs(x-C);if("n/a"===g){const e=o?.match(/^(\d+)([A-Za-z])/),t=e[1]+e[2];t&&t!==b&&(b=t,w++)}const A="n/a"===g?w%2?"black":"#a77":u[g]||"black";return"acen"!==g||y?"acen"===g&&y?(0,s.jsx)("polygon",{points:p?c(C-T,0,T,m):d(C,0,T,m),...(0,n.getFillProps)(A)},a):h===r?(0,s.jsx)("path",{d:(M=k,P=T,R=m,`M${M+8},0h${P-8}v${R}h${8-P}a8,8 0 0 1 -8,-8v${16-R}a8,8 0 0 1 8,-8z`),...(0,n.getFillProps)(A)},a):f===r?(0,s.jsx)("path",{d:l(k,0,T,m,8),...(0,n.getFillProps)(A)},a):(0,s.jsx)("rect",{x:k,y:0,width:T,height:m,...(0,n.getFillProps)(A)},a):(y=!0,(0,s.jsx)("polygon",{points:p?d(C-T,0,T,m):c(C,0,T,m),...(0,n.getFillProps)(A)},a));var M,P,R}))})}))},85012:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});const n=1e4;function a(e,t,r,n){return t>=r&&n>=e}class i{padding=1;widthLimit=1e6;setAllFilled(e){this.allFilled=e}getItemAt(e){return this.allFilled?this.allFilled:void 0===this.rowState?.min||e<this.rowState.min||e>=this.rowState.max?void 0:this.rowState.bits[e-this.rowState.offset]}isRangeClear(e,t){if(this.allFilled)return!1;if(void 0===this.rowState||t<=this.rowState.min||e>=this.rowState.max)return!0;const{min:r,max:n,offset:a,bits:i}=this.rowState,o=Math.min(n,t)-a;let s=!0;for(let t=Math.max(r,e)-a;t<o&&s;t++)s=void 0===i[t];return s}initialize(e,t){const r=t-e;return{offset:e-r,min:e,max:t,bits:Array.from({length:3*r})}}addRect(e,t){const r=e.l,n=e.r+this.padding;this.rowState||(this.rowState=this.initialize(r,n));let a=r-this.rowState.offset,i=n-this.rowState.offset;const o=this.rowState.bits.length;if(i>=this.rowState.bits.length){const e=i+1;this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(r,n)):e>0&&(this.rowState.bits=[...this.rowState.bits,...Array.from({length:e})])}if(r<this.rowState.offset){const e=Math.min(o-a,this.rowState.offset);this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(r,n)):(this.rowState.bits=[...Array.from({length:e}),...this.rowState.bits],this.rowState.offset-=e)}i=n-this.rowState.offset,a=r-this.rowState.offset;const s=i-a;s>2e4&&console.warn(`Layout X pitch set too low, feature spans ${s} bits in a single row.`,e,t);for(let e=a;e<i;e+=1)this.rowState.bits[e]=t;r<this.rowState.min&&(this.rowState.min=r),n>this.rowState.max&&(this.rowState.max=n)}discardRange(e,t){if(this.allFilled)return;if(!this.rowState)return;if(t<=this.rowState.min||e>=this.rowState.max)return;if(e<=this.rowState.min&&t>=this.rowState.max)return void(this.rowState=void 0);if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-n&&this.rowState.bits.length>this.rowState.max+n-this.rowState.offset){const e=this.rowState.min-this.rowState.offset,t=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(e,this.rowState.bits.length-t),this.rowState.offset+=e}else if(this.rowState.offset<this.rowState.min-n){const e=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,e),this.rowState.offset+=e}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+n){const e=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=e}const r=Math.max(this.rowState.min,e)-this.rowState.offset,a=Math.min(t,this.rowState.max)-this.rowState.offset;for(let e=r;e>=0&&e<a;e+=1)this.rowState.bits[e]=void 0}}class o{constructor({pitchX:e=10,pitchY:t=10,maxHeight:r=1e4,hardRowLimit:n=1e4,displayMode:a="normal"}={}){this.pitchX=e,this.pitchY=t,this.hardRowLimit=n,this.maxHeightReached=!1,this.displayMode=a,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(r/this.pitchY),this.pTotalHeight=0}addRect(e,t,r,n,a){const i=this.rectangles.get(e);if(i)return null===i.top?null:(this.addRectToBitmap(i),i.top*this.pitchY);const o=Math.floor(t/this.pitchX),s=Math.floor(r/this.pitchX),l=Math.ceil(n/this.pitchY),c={id:e,l:o,r:s,top:null,h:l,originalHeight:n,data:a},d=this.maxHeight-l;let u=0;if("collapse"!==this.displayMode){for(;u<=d&&this.collides(c,u);u+=1);if(u>d)return c.top=null,this.rectangles.set(e,c),this.maxHeightReached=!0,null}return c.top=u,this.addRectToBitmap(c),this.rectangles.set(e,c),this.pTotalHeight=Math.max(this.pTotalHeight||0,u+l),u*this.pitchY}collides(e,t){const{bitmap:r}=this,n=t+e.h;for(let a=t;a<n;a+=1){const t=r[a];if(void 0!==t&&!t.isRangeClear(e.l,e.r))return!0}return!1}autovivifyRow(e,t){let r=e[t];if(!r){if(t>this.hardRowLimit)throw new Error(`layout hard limit (${this.hardRowLimit*this.pitchY}px) exceeded, aborting layout`);r=new i,e[t]=r}return r}addRectToBitmap(e){if(null===e.top)return;const t=e.id,r=e.top+e.h;if(e.r-e.l>2e4)for(let n=e.top;n<r;n+=1)this.autovivifyRow(this.bitmap,n).setAllFilled(t);else for(let n=e.top;n<r;n+=1)this.autovivifyRow(this.bitmap,n).addRect(e,t)}discardRange(e,t){const r=Math.floor(e/this.pitchX),n=Math.floor(t/this.pitchX),{bitmap:a}=this;for(const e of a)e.discardRange(r,n)}hasSeen(e){return this.rectangles.has(e)}getByCoord(e,t){const r=Math.floor(t/this.pitchY),n=this.bitmap[r];if(!n)return;const a=Math.floor(e/this.pitchX);return n.getItemAt(a)}getByID(e){const t=this.rectangles.get(e);if(t){const e=t.top*this.pitchY;return[t.l*this.pitchX,e,t.r*this.pitchX,e+t.originalHeight]}}getDataByID(e){return this.rectangles.get(e)?.data}cleanup(){}getTotalHeight(){return this.pTotalHeight*this.pitchY}get totalHeight(){return this.getTotalHeight()}getRectangles(){return new Map([...this.rectangles.entries()].map((([e,t])=>{const{l:r,r:n,originalHeight:a,top:i}=t,o=(i||0)*this.pitchY,s=o+a;return[e,[r*this.pitchX,o,n*this.pitchX,s]]})))}serializeRegion(e){const t={};let r=!1;for(const[n,i]of this.rectangles.entries()){const{l:o,r:s,originalHeight:l,top:c}=i;if(null===i.top)r=!0;else{const r=(c||0)*this.pitchY,i=r+l,d=o*this.pitchX,u=s*this.pitchX;a(e.start,e.end,d-this.pitchX,u+this.pitchX)&&(t[n]=[d,r,u,i])}}return{rectangles:t,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:r}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}},85497:(e,t,r)=>{"use strict";r.d(t,{Cg:()=>i});var n=r(99546);function a(e){let t,r=0;for(const[n,a]of Object.entries(e))"."!==n&&"0"!==n&&a>r&&(t=n,r=a);return t}function i({features:e,minorAlleleFrequencyFilter:t,lengthCutoffFilter:r,stopToken:i}){const o=[];return(0,n.forEachWithStopTokenCheck)(e,i,(e=>{if(e.get("end")-e.get("start")<=r){const r=function(e){const t=e.get("genotypes"),r={0:0,1:0,".":0},n={},a=Object.values(t),i=a.length;for(let e=0;e<i;e++){const t=a[e],i=n[t]||(n[t]=t.split(/[/|]/));for(let e=0,t=i.length;e<t;e++){const t=i[e];r[t]=(r[t]??0)+1}}return r}(e);(function(e){return function(e){let t=0,r=0;for(const n of e)n>t?(r=t,t=n):n>r&&n!==t&&(r=n);return r}(Object.values(e))/((0,n.sum)(Object.values(e))||1)})(r)>=t&&o.push({feature:e,mostFrequentAlt:a(r),alleleCounts:r})}})),o}},86576:(e,t,r)=>{"use strict";r.d(t,{Iw:()=>d,Rs:()=>u,c$:()=>s,il:()=>l,rT:()=>g,rr:()=>c,vi:()=>p});var n=r(42489),a=r(36422),i=r(44728),o=r(82088);function s(e,t,r){const n=e.get("tags");return n[t]??n[r]}const l={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}},c={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"};async function d(e,t){const{start:r,end:n,originalRefName:a,refName:s}=e,l=await(0,i._)(t.getFeatures({...e,refName:a||s,end:n,start:r}).pipe((0,o.$)()));return l[0]?.get("seq")}const u={m:{color:"rgb(255,0,0)",name:"5mC"},h:{color:"rgb(255,0,255)",name:"5hmC"},o:{color:"rgb(111, 78, 129)",name:"8oxoG"},f:{color:"rgb(246, 200, 95)",name:"5fC"},c:{color:"rgb(157, 216, 102)",name:"5cac"},g:{color:"rgb(255, 160, 86)",name:"5hmu"},e:{color:"rgb(141, 221, 208)",name:"5fU"},b:{color:"rgb(0,100,47)",name:"5caU"},a:{color:"rgb(51,0,111)",name:"6mA"},17082:{color:"rgb(51,153,255)",name:"pseU"},17596:{color:"rgb(102,153,0)",name:"inosine"},21839:{color:"rgb(153,0,153)",name:"4mC"}};function p(e,t,r){(0,a.addDisposer)(e,(0,n.autorun)((async()=>{try{await t()}catch(t){(0,a.isAlive)(e)&&e.setError(t)}}),r))}function g(e){return u[e]?.color||function(e){let t=0;for(let r=0;r<e.length;r++)t+=e.charCodeAt(r);return`hsl(${10*t}, 20%, 50%)`}(e)}},87485:(e,t,r)=>{"use strict";r.d(t,{M:()=>n.Mj});var n=r(76958),a=r(8145),i=r(81687);(0,n.X$)([a.A,i.A])},88217:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GranularRectLayout:()=>n.A,MultiLayout:()=>a.A,PrecomputedLayout:()=>i.A,PrecomputedMultiLayout:()=>s,SceneGraph:()=>l});var n=r(85012),a=r(2265),i=r(75762);class o{constructor(){throw new Error("invalid layout name")}}class s extends a.A{constructor(e){super(o);for(const[t,r]of Object.entries(e))this.subLayouts.set(t,new i.A(r))}}class l{constructor(e,t,r,n,a,i){this.name=e,this.left=t,this.top=r,this.width=n,this.height=a,this.data=i,this.children=new Map,this.absoluteCache={dirty:!0}}addChild(e,t,r,n,a,i){const o=e instanceof l?e:new l(e,t,r,n,a,i);if(!(o instanceof l))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(o.name))throw new Error(`child named "${o.name}" already exists`);o.parent=this;const{left:s,right:c,top:d,bottom:u}=o.absolute;return void 0!==s&&void 0!==c&&void 0!==d&&void 0!==u&&(this.expand(s,c,d,u),this.children.set(o.name,o)),o}getSubRecord(e){return this.children.get(e)}expand(e,t,r,n){const{left:a,right:i,top:o,bottom:s}=this.absolute;if(void 0!==a&&e<a){const t=a-e;this.width+=t,this.left-=t}if(void 0!==i&&t>i&&(this.width+=t-i),void 0!==o&&r<o){const e=o-r;this.height+=e,this.top-=e}void 0!==s&&n>s&&(this.height+=n-s),this.parent&&this.parent.expand(e,t,r,n),this.absoluteCache.dirty=!0}get bottom(){return this.top+this.height}get right(){return this.left+this.width}walkParents(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}walkChildren(e){for(const t of this.children.values())e(t),t.walkChildren(e)}get absolute(){if(this.absoluteCache.dirty){let e=0,t=0;this.walkParents((r=>{e+=r.left,t+=r.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}move(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((e=>{e.absoluteCache.dirty=!0}));const{left:r,right:n,top:a,bottom:i}=this.absolute;void 0!==r&&void 0!==n&&void 0!==a&&void 0!==i&&this.expand(r,n,a,i)}}},88262:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(7552),a=r(9236),i=r(68446),o=r(75785),s=r(75429),l=r(69500);const c=(0,o.n9)()({hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:s.YSCALEBAR_LABEL_OFFSET,cursor:"default",position:"absolute",pointerEvents:"none"}}),d=(0,i.observer)((function({model:e,height:t,clientMouseCoord:r,offsetMouseCoord:i,clientRect:o,TooltipContents:d,useClientY:u}){const{featureUnderMouse:p}=e,{classes:g}=c(),h=r[0]+5,f=u?r[1]:o?.top||0;return p?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.Suspense,{fallback:null,children:(0,l.jsx)(a.A,{clientPoint:{x:h,y:f},children:(0,l.jsx)(d,{model:e,feature:p})})}),(0,l.jsx)("div",{className:g.hoverVertical,style:{left:i[0],height:t-2*s.YSCALEBAR_LABEL_OFFSET}})]}):null}))},88530:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(36422),a=r(99546),i=r(76530);function o(e,t=!0,r=!0,o=0,s=800){const{offsetPx:l,displayedRegions:c,bpPerPx:d,minimumBlockWidth:u,interRegionPaddingWidth:p,width:g}=e,h=l*d,f=(l+g)*d,m=s,y=Math.ceil(m*d);let b=0;const w=new i.mh;for(let e=0;e<c.length;e++){const l=c[e],{assemblyName:g,refName:m,start:v,end:S,reversed:C}=l,x=Math.ceil((S-v)/y),k=(0,n.isStateTreeNode)(l)?(0,n.getSnapshot)(l):l;let T=Math.floor((f-b)/y)+o;T>=x&&(T=x-1);let A=Math.floor((h-b)/y)-o;A<0&&(A=0);const M=(S-v)/d;for(let n=A;n<=T;n+=1){let o,l,h,f;C?(o=Math.max(v,S-(n+1)*y),l=S-n*y,h=l===S,f=o===v):(o=v+n*y,l=Math.min(S,v+(n+1)*y),h=o===v,f=l===S);const x={assemblyName:g,refName:m,start:o,end:l,reversed:C,offsetPx:(b+n*y)/d,parentRegion:k,regionNumber:e,widthPx:(l-o)/d,isLeftEndOfDisplayedRegion:h,isRightEndOfDisplayedRegion:f,key:""};x.key=`${(0,a.assembleLocStringFast)(x)}-${e}${C?"-reversed":""}`,t&&0===e&&0===n&&w.push(new i.fK({key:`${x.key}-beforeFirstRegion`,widthPx:s,offsetPx:x.offsetPx-s,variant:"boundary"})),r&&M<u?w.push(new i.Db(x)):w.push(new i.$G(x)),t&&(M>=u&&x.isRightEndOfDisplayedRegion&&e<c.length-1&&(b+=p*d,w.push(new i.fK({key:`${x.key}-rightpad`,widthPx:p,offsetPx:x.offsetPx+x.widthPx}))),e===c.length-1&&x.isRightEndOfDisplayedRegion&&(b+=p*d,w.push(new i.fK({key:`${x.key}-afterLastRegion`,widthPx:s,offsetPx:x.offsetPx+x.widthPx,variant:"boundary"}))))}b+=S-v}return w}},90257:(e,t,r)=>{"use strict";function n(e,t,r=!0){const{assemblyName:n,refName:a,start:i,offset:o,oob:s}=t.pxToBp(e),l=Math.floor(i+o);return s?"out of bounds":`${r?`{${n}}`:""}${a}:${l.toLocaleString("en-US")}`}function a(e,t,r){const n=new Set,a=[...e].sort(((e,t)=>{const r=e.end-e.start;return t.end-t.start-r})),i=Array.from({length:Math.round(t)});for(const{key:e,offsetPx:o}of a){const a=Math.round(t-o+r),s=[Math.max(a-12,0),a];0===a||i.slice(...s).some(Boolean)?n.add(e):i.fill(!0,...s)}return n}function i(e,t,r=!0,n=!0){const a=[],i=function(e){const t=60*(e=Math.abs(e));let r=10**+Number(t).toExponential().split(/e/i)[1];for(;r<t&&(r*=2,!(r>=t));)r*=2.5;r=Math.max(r,5);const n=r/e;let a=0;return!(r%10)&&n/10>=15?a=r/10:!(r%5)&&n/5>=15?a=r/5:!(r%2)&&n/2>=15&&(a=r/2),{majorPitch:r,minorPitch:a}}(t),o=i.minorPitch||i.majorPitch;for(const{start:t,end:s,refName:l}of e){let e=0;const c=t,d=s;for(let s=Math.floor(c/o)*o;s<Math.ceil(d/o)*o+1;s+=o)n&&s%i.majorPitch?(a.push({type:"minor",base:s-1,index:e,refName:l}),e+=1):r&&Math.abs(s-t)>i.minorPitch&&(a.push({type:"major",base:s-1,index:e,refName:l}),e+=1)}return a}r.d(t,{H2:()=>i,rQ:()=>a,wJ:()=>n})},90461:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(51414),a=r(68446),i=r(77126),o=r(69500);const s=(0,a.observer)((function({model:e,orientation:t}){const{ticks:r}=e,a=(0,n.A)();return r?(0,o.jsx)(i.Axis,{...r,shadow:2,format:e=>e,style:{orient:"left"===t?i.LEFT:i.RIGHT},bg:a.palette.background.default,fg:a.palette.text.primary}):null}))},91476:(e,t,r)=>{"use strict";r.d(t,{Ar:()=>l,CQ:()=>s,JD:()=>o,Kl:()=>u,Kt:()=>c,dv:()=>a,lE:()=>d,yr:()=>i});var n=r(87485);function a(e){for(const t of e.chains.values())if(1&t[0].flags)return!0;return!1}function i(e,t){return 1!==t?(0,n.M)(e).alpha(Math.min(1,t*t+.1)).toHslString():e}const o={flagInclude:0,flagExclude:1540},s={flagInclude:16,flagExclude:1540},l={flagInclude:0,flagExclude:1556};function c(e,t){const r=Object.getOwnPropertyDescriptor(e.prototype,t).get;Object.defineProperty(e.prototype,t,{get(){const e=r.call(this);return Object.defineProperty(this,t,{value:e}),e}})}function d(e,t,r){return(e&t)!==t||!!(e&r)}function u(e,t){return"*"===t?void 0===e:`${e}`!=`${t}`}},91612:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema,this.description=e.description,this.url=e.url,this.configEditorComponent=e.configEditorComponent}}},92070:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(35470);class a extends n.A{constructor(e){super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema}}},92516:(e,t,r)=>{"use strict";r.d(t,{BY:()=>u,C1:()=>C,DW:()=>i,EO:()=>b,EV:()=>x,J_:()=>A,Nh:()=>S,QW:()=>l,Tl:()=>f,Uy:()=>y,Y$:()=>o,ZL:()=>M,_u:()=>T,bV:()=>w,gx:()=>p,lL:()=>v,lO:()=>d,mY:()=>h,rF:()=>k,rz:()=>a.A,u3:()=>s,xU:()=>m,xv:()=>c,yH:()=>P,zA:()=>g});var n=r(36422),a=r(83059);function i(e){return(0,n.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function o(e){return"object"==typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function s(e){return o(e)&&"editConfiguration"in e}function l(e){return o(e)&&"addTrackConf"in e&&!e.disableAddTracks}function c(e){return o(e)&&"shareURL"in e&&!!e.shareURL}function d(e){return o(e)&&"widgets"in e}function u(e){return o(e)&&"makeConnection"in e}function p(e){return o(e)&&"addConnectionConf"in e}function g(e){return o(e)&&"sessionPlugins"in e}function h(e){return"object"==typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function f(e){return"object"==typeof e&&null!==e&&"width"in e&&"setWidth"in e}function m(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function y(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function b(e){return"object"==typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function w(e){return"object"==typeof e&&null!==e&&"findAppropriateInternetAccount"in e}function v(e){return"object"==typeof e&&null!==e&&"internetAccounts"in e&&"findAppropriateInternetAccount"in e}function S(e){return"object"==typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}function C(e){return"object"==typeof e&&null!==e&&"uri"in e&&!!e.uri}function x(e){return"object"==typeof e&&null!==e&&"localPath"in e&&!!e.localPath}function k(e){return"object"==typeof e&&null!==e&&"blobId"in e&&!!e.blobId}class T extends Error{constructor(e,t){super(e),this.message=e,this.url=t,this.name="AuthNeededError",Object.setPrototypeOf(this,T.prototype)}}class A extends Error{constructor(e,t){super(e),this.message=e,this.internetAccountId=t,this.name="RetryError"}}function M(e){return e instanceof Error&&("AuthNeededError"===e.name||void 0!==e.url)}function P(e){return"RetryError"===e.name||void 0!==e.internetAccountId}},92880:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(44728),a=r(82088),i=r(198),o=r(46377),s=r(3496),l=r(99546),c=r(6434),d=r(37347);class u extends i.default{serializeArgsInClient(e){return super.serializeArgsInClient({...e,displayModel:void 0,regions:structuredClone(e.regions)})}deserializeResultsInClient(e,t){const r=new Map(e.features.map((e=>c.A.fromJSON(e))).map((e=>[e.id(),e])));return{...super.deserializeResultsInClient({...e,features:r},t),blockKey:t.blockKey,features:r}}serializeResultsInWorker(e,t){const r=super.serializeResultsInWorker(e,t),{features:n}=e;return{...r,features:(0,l.iterMap)(n.values(),(e=>e.toJSON()),n.size)}}getExpandedRegion(e,t){return e}async getFeatures(e){const t=this.pluginManager,{stopToken:r,regions:i,sessionId:l,adapterConfig:c}=e,{dataAdapter:u}=await(0,s.cK)(t,l,c);if(!(0,o.isFeatureAdapter)(u))throw new Error("Adapter does not support retrieving features");(0,d.SW)(r);const p=i.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)}))),g=p[0],h=1===p.length?u.getFeatures(this.getExpandedRegion(g,e),e):u.getFeaturesInMultipleRegions(p,e),f=await(0,n._)(h.pipe((0,a.$)()));return(0,d.SW)(r),new Map(f.filter((t=>this.featurePassesFilters(e,t))).map((e=>[e.id(),e])))}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async render(e){const t=e.features||await this.getFeatures(e);return{...await super.render({...e,features:t}),features:t}}}},93092:(e,t,r)=>{"use strict";r.d(t,{Ps:()=>d,Yj:()=>s,Z1:()=>l,eV:()=>c});var n=r(99546),a=r(49256),i=r(86576);const o=new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/);function s(e){const t=(0,i.c$)(e,"ML","Ml")||[];return t?("string"==typeof t?t.split(",").map((e=>+e)):t).map((e=>e/255)):(0,i.c$)(e,"MP","Mp")?.split("").map((e=>e.charCodeAt(0)-33)).map((e=>Math.min(1,e/50)))}function l(e,t,r){const a=-1===r?(0,n.revcom)(t):t,i=e.split(";").filter((e=>!!e)),s=[];for(const e of i){const[t,...n]=e.split(","),i=o.exec(t);if(!i)throw new Error("bad format for MM tag");const[,l,c,d]=i,u=d.split(/(\d+|.)/).filter((e=>!!e));"-"===c&&(console.warn("unsupported negative strand modifications"),s.push({type:"unsupported",positions:[],base:l,strand:c}));for(const e of u){let t=0;const i=[];for(const e of n){let n=+e;do{"N"!==l&&l!==a[t]||n--,t++}while(n>=0&&t<a.length);if(-1===r){const e=a.length-t;e>=0&&i.unshift(e)}else i.push(t-1)}s.push({type:e,base:l,strand:c,positions:i})}}return s}function c(e){return e.split(";").filter((e=>!!e)).flatMap((e=>{const t=e.split(",")[0],r=o.exec(t);if(!r)throw new Error("bad format for MM tag");const[,n,a,i]=r;return i.split(/(\d+|.)/).filter((e=>!!e)).map((e=>({type:e,base:n,strand:a})))}))}function d(e,t){const r=e.get("start"),n=e.get("end"),o=e.get("strand"),c=n-r,d=(0,i.c$)(e,"MM","Mm")||"",u=[],p=[],g=[],h=[],f=e.get("seq");if(f){const r=s(e),n=l(d,f,o);let i=0;for(const{type:e,positions:s}of n){for(const{ref:n,idx:l}of(0,a.h)(t,s)){const t=i+(-1===o?s.length-1-l:l),a=r?.[t]||0;"m"===e?n>=0&&n<c&&(u[n]=1,g[n]=a):"h"===e&&n>=0&&n<c&&(p[n]=1,h[n]=a)}i+=s.length}}return{methBins:u,hydroxyMethBins:p,methProbs:g,hydroxyMethProbs:h}}},93100:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(43283);class a{constructor({filters:e=[]}){this.filterChain=e.map((e=>e.trim())).filter((e=>!!e)).map((e=>{if("string"==typeof e)return{expr:(0,n.A)(e),string:e};throw new Error(`invalid inputFilter string "${e}"`)}))}passes(...e){for(const t of this.filterChain)if(!t.expr.evalSync({feature:e[0]}))return!1;return!0}toJSON(){return{filters:this.filterChain.map((e=>e.string))}}static fromJSON(e){return new a(e)}}},93707:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(36422),a=r(99546),i=r(76530),o=r(32595);function s(e,t=!0,r=!0){const{offsetPx:s,displayedRegions:l,bpPerPx:c,width:d,minimumBlockWidth:u,interRegionPaddingWidth:p}=e;if(!d)throw new Error("view has no width, cannot calculate displayed blocks");const g=new i.mh;let h=0;const f=s,m=f+d;for(let e=0;e<l.length;e++){const y=l[e],{assemblyName:b,refName:w,start:v,end:S,reversed:C}=y,x=h+(S-v)/c,k=(S-v)/c,T=(0,n.isStateTreeNode)(y)?(0,n.getSnapshot)(y):y,[A,M]=(0,o.ky)(f,m,h,x);if(void 0!==A&&void 0!==M){let n,o,f,m,y;C?(n=Math.max(v,S-(M-h)*c),o=S-(A-h)*c,f=o===S,m=n===v,y=h+(S-o)/c):(n=(A-h)*c+v,o=Math.min(S,(M-h)*c+v),f=n===v,m=o===S,y=h+(n-v)/c);const x={assemblyName:b,refName:w,start:n,end:o,reversed:C,offsetPx:y,parentRegion:T,regionNumber:e,widthPx:(o-n)/c,isLeftEndOfDisplayedRegion:f,isRightEndOfDisplayedRegion:m,key:""};x.key=`${(0,a.assembleLocStringFast)(x)}-${e}${C?"-reversed":""}`,t&&0===g.length&&f&&g.push(new i.fK({key:`${x.key}-beforeFirstRegion`,widthPx:-s,offsetPx:x.offsetPx+s,variant:"boundary"})),r&&k<u?g.push(new i.Db(x)):g.push(new i.$G(x)),t&&(k>=u&&x.isRightEndOfDisplayedRegion&&e<l.length-1&&(g.push(new i.fK({key:`${x.key}-rightpad`,widthPx:p,offsetPx:x.offsetPx+x.widthPx})),h+=p),e===l.length-1&&x.isRightEndOfDisplayedRegion&&(y=x.offsetPx+x.widthPx,g.push(new i.fK({key:`${x.key}-afterLastRegion`,widthPx:d-y+s,offsetPx:y,variant:"boundary"}))))}h+=(S-v)/c}return g}},94318:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(92880),a=r(68446),i=r(69500);const o=(0,a.observer)((function(e){const{html:t,RenderingComponent:r,...n}=e;return(0,i.jsx)(r,{...n})}));var s=r(99546);class l extends n.default{supportsSVG=!0;deserializeResultsInClient(e,t){const r=new Map(e.features.map((e=>s.SimpleFeature.fromJSON(e))).map((e=>[e.id(),e])));return t.exportSVG?{...e,features:r,blockKey:"circularChord",html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,features:r,blockKey:"circularChord",reactElement:(0,i.jsx)(o,{...t,...e,features:r,RenderingComponent:this.ReactComponent})}}}},95095:(e,t,r)=>{"use strict";function n(e,t,r){if(!t||!r)return;const{width:n,interRegionPaddingWidth:a,displayedRegions:i,bpPerPx:o,minimumBlockWidth:s}=e,l=function(e,t,r){let n=0;const{displayedRegions:a}=e;if(t.index===r.index)n+=r.offset-t.offset;else{const e=a[t.index];if(n+=e.end-e.start-t.offset,r.index-t.index>=2)for(let e=t.index+1;e<r.index;e++){const t=a[e];n+=t.end-t.start}n+=r.offset}return n}(e,t,r);let c=0;for(let e=t.index;e<r.index;e++){const t=i[e];(t.end-t.start)/o>s&&c++}const d=l/(n-a*c),u=e.zoomTo(d);let p=0;d<u&&(p=(u-d)*e.width/2);let g=-p;for(let r=0;r<e.displayedRegions.length;r++){const n=e.displayedRegions[r];if(t.index===r){g+=t.offset;break}g+=n.end-n.start}e.scrollTo(Math.round(g/e.bpPerPx))}function a(e,t){return Math.floor(e.reversed?e.end-t:e.start+t)+1}function i(e,t){let r=0;const{bpPerPx:n,offsetPx:i,displayedRegions:o,interRegionPaddingWidth:s,staticBlocks:l}=e,c=l.contentBlocks,d=(i+t)*n;if(d<0){const e=o[0];return{...e,oob:!0,coord:a(e,d),offset:d,index:0}}const u=s*n;let p=0;for(let e=0;e<o.length;e++){const t=o[e],n=t.end-t.start,i=d-r;if(n+r>d&&r<=d)return{...t,oob:!1,offset:i,coord:a(t,i),index:e};c[p]?.regionNumber===e?(r+=n+u,p++):r+=n}if(d>=r&&o.length>0){const e=o.at(-1),t=d-r+(e.end-e.start);return{...e,oob:!0,offset:t,coord:a(e,t),index:o.length-1}}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}function o({refName:e,coord:t,regionNumber:r,self:n}){let a=0;const{interRegionPaddingWidth:i,bpPerPx:o,displayedRegions:s,staticBlocks:l}=n,c=l.contentBlocks,d=i*o;let u=0,p=0;for(;p<s.length;p++){const n=s[p],i=n.end-n.start;if(e===n.refName&&t>=n.start&&t<=n.end&&(!r||r===p)){a+=n.reversed?n.end-t:t-n.start;break}c[u]?.regionNumber===p?(a+=i+d,u++):a+=i}if(s[p])return{index:p,offsetPx:Math.round(a/o)}}r.d(t,{Ii:()=>i,eB:()=>o,tw:()=>n})},95397:()=>{},95600:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(69566);function a(e){const{POS:t,REF:r="",ALT:n}=e,a=n?.includes("<TRA>"),i=t-1,o=n?.some((e=>e.includes("<")));if(o){const t=e.INFO;if(t.END&&!a)return+t.END[0]}return i+r.length}class i{constructor(e){this.variant=e.variant,this.parser=e.parser,this.data=function(e,t){const{REF:r="",ALT:i,POS:o,CHROM:s,ID:l}=e,c=o-1,[d,u]=(0,n.M_)(r,i,t);return{refName:s,start:c,end:a(e),description:u,type:d,name:l?.join(",")}}(this.variant,this.parser),this._id=e.id}get(e){return"samples"===e?this.variant.SAMPLES():"genotypes"===e?this.variant.GENOTYPES():this.data[e]??this.variant[e]}parent(){}children(){}id(){return this._id}toJSON(){const{SAMPLES:e,GENOTYPES:t,...r}=this.variant;return{uniqueId:this._id,...r,...this.data,samples:this.variant.SAMPLES()}}}},95742:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var n=r(35470),a=r(69500);class i extends n.A{supportsSVG=!0;constructor(e){super(e),this.ReactComponent=e.ReactComponent,this.configSchema=e.configSchema,this.pluginManager=e.pluginManager}async render(e){return{reactElement:(0,a.jsx)(this.ReactComponent,{...e})}}freeResources(e){}}},95805:(e,t,r)=>{"use strict";function n(e,t,r,n){let a=0,i=0;const o=[],s=r&&t;for(let l=0;l<e.length;l+=2){const c=+e[l],d=e[l+1];if("M"===d||"="===d||"E"===d){if(s)for(let e=0;e<c;e++)t[i+e].toUpperCase()!==r[a+e].toUpperCase()&&o.push({start:a+e,type:"mismatch",base:t[i+e],altbase:r[a+e],length:1});i+=c}if("I"===d)o.push({start:a,type:"insertion",base:`${c}`,length:0}),i+=c;else if("D"===d)o.push({start:a,type:"deletion",base:"*",length:c});else if("N"===d)o.push({start:a,type:"skip",base:"N",length:c});else if("X"===d){const e=t?.slice(i,i+c)||[],r=n?.subarray(i,i+c)||[];for(let t=0;t<c;t++)o.push({start:a+t,type:"mismatch",base:e[t]||"X",qual:r[t],length:1});i+=c}else"H"===d?o.push({start:a,type:"hardclip",base:`H${c}`,cliplen:c,length:1}):"S"===d&&(o.push({start:a,type:"softclip",base:`S${c}`,cliplen:c,length:1}),i+=c);"I"!==d&&"S"!==d&&"H"!==d&&(a+=c)}return o}r.r(t),r.d(t,{featurizeSA:()=>b,getClip:()=>m,getLength:()=>h,getLengthOnRef:()=>g,getLengthSansClipping:()=>f,getMismatches:()=>d,getNextRefPos:()=>i.h,getOrientedCigar:()=>u,getOrientedMismatches:()=>p,getTag:()=>y,parseCigar:()=>c});const a=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi);var i=r(49256);const o=new RegExp(/([MIDNSHPX=])/),s=new RegExp(/(\d+)[SH]$/),l=new RegExp(/^(\d+)([SH])/);function c(e=""){return e.split(o).slice(0,-1)}function d(e,t,r,i,o){let s=[];const l=c(e);return e&&(s=s.concat(n(l,r,i,o))),t&&r&&(s=s.concat(function(e,t,r,n,i){let o={start:0,base:"",length:0,type:"mismatch"},s=0,l=0,c=0,d=0;const u=[],p=r.filter((e=>"skip"===e.type));function g(e){let r=l,n=c;for(let a=s;a<t.length&&n<=e;a+=2,s=a){const e=+t[a],i=t[a+1];"S"===i||"I"===i?r+=e:"D"===i||"P"===i||"N"===i?n+=e:"H"!==i&&(r+=e,n+=e)}return l=r,c=n,r-(n-e)}const h=e.match(a)||[];for(const e of h){const t=+e;if(Number.isNaN(t))if(e.startsWith("^"))o.start+=e.length-1;else for(let t=0;t<e.length;t+=1){for(o.length=1;d<p.length;){const e=p[d];if(!(o.start>=e.start))break;o.start+=e.length,d++}const t=g(o.start);o.base=n[t]||"X",o.qual=i?.[t],o.altbase=e,u.push(o),o={start:o.start+o.length,length:0,base:"",type:"mismatch"}}else o.start+=t}return u}(t,l,s,r,o))),s}function u(e,t){if(e){const e=[];for(let r=0;r<t.length;r+=2){const n=t[r];let a=t[r+1];"D"===a?a="I":"I"===a&&(a="D"),e.push(n,a)}return e}return t}function p(e,t){const r=c(t);return n(e?u(e,r):r)}function g(e){const t=c(e);let r=0;for(let e=0;e<t.length;e+=2){const n=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"I"!==a&&(r+=n)}return r}function h(e){const t=c(e);let r=0;for(let e=0;e<t.length;e+=2){const n=+t[e],a=t[e+1];"D"!==a&&"N"!==a&&(r+=n)}return r}function f(e){const t=c(e);let r=0;for(let e=0;e<t.length;e+=2){const n=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"D"!==a&&"N"!==a&&(r+=n)}return r}function m(e,t){return-1===t?+(s.exec(e)||[])[1]||0:+(l.exec(e)||[])[1]||0}function y(e,t){return e.get("tags")[t]}function b(e,t,r,n,a){return e?.split(";").filter((e=>!!e)).map(((e,i)=>{const o=e.split(","),s=o[0],l=o[1],c=o[2],d=o[3],u=g(d),p=h(d),y=f(d),b="-"===c?-1:1,w=m(d,(a?r:1)*b),v=+l-1;return{refName:s,start:v,end:v+u,seqLength:p,clipPos:w,CIGAR:d,strand:(a?r:1)*b,uniqueId:`${t}_SA${i}`,mate:{start:w,end:w+y,refName:n}}}))||[]}},96480:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var n=r(7552),a=r(8656),i=r(99546),o=r(77888),s=r(68446),l=r(93062),c=r(69500);function d({TextFieldProps:e,inputBoxVal:t,params:r,setInputValue:n,setCurrentSearch:a}){const{helperText:i,slotProps:o={}}=e;return(0,c.jsx)(l.A,{onBlur:()=>{n(t)},...r,...e,size:"small",helperText:i,slotProps:{input:{...r.InputProps,...o.input}},placeholder:"Search for location",onChange:e=>{a(e.target.value)}})}const u=(0,s.observer)((function({model:e,onSelect:t,assemblyName:r,style:s,fetchResults:l,onChange:u,value:p,minWidth:g=200,maxWidth:h=550,TextFieldProps:f={}}){const m=(0,i.getSession)(e),{assemblyManager:y}=m,[b,w]=(0,n.useState)(!1),[v,S]=(0,n.useState)(!0),[C,x]=(0,n.useState)(""),[k,T]=(0,n.useState)(""),[A,M]=(0,n.useState)(),P=(0,i.useDebounce)(C,300),R=r?y.get(r):void 0,{coarseVisibleLocStrings:L,hasDisplayedRegions:I}=e;(0,n.useEffect)((()=>{(async()=>{try{if(""===P||!r)return;S(!1),M((e=await l(P),Object.entries(function(e){const t={};for(const r of e){const e=r.getDisplayString();t[e]||(t[e]=[]),t[e].push(r)}return t}(e)).map((([e,t])=>1===t.length?{result:t[0]}:{result:new a.A({displayString:e,results:t,label:e})}))))}catch(e){console.error(e),m.notifyError(`${e}`,e)}finally{S(!0)}var e})()}),[r,l,P,m]);const F=L||p||"",N=R?.regions,D=N?.map((e=>({result:new a.S({refName:e.refName,label:e.refName,displayString:e.refName,matchedAttribute:"refName"})})))||[];return(0,c.jsx)(o.A,{"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!r,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:{...s,width:Math.min(Math.max((0,i.measureText)(F,14)+100,g),h)},value:F,loading:!v,inputValue:k,onInputChange:(e,t)=>{T(t),u?.(t)},loadingText:"loading results",open:b,onOpen:()=>{w(!0)},onClose:()=>{w(!1),S(!0),I&&(x(""),M(void 0))},onChange:(e,n)=>{n&&r&&(t?.("string"==typeof n?new a.A({label:n}):n.result),T(F))},options:A?.length?A:D,getOptionDisabled:e=>"limitOption"===e.group,filterOptions:(e,{inputValue:t})=>function(e,t){const r=(n=e,i=t.toLocaleLowerCase(),n.filter((({result:e})=>e.getLabel().toLowerCase().includes(i)||e.matchedObject)));var n,i;return[...r.slice(0,100),...r.length>100?[{group:"limitOption",result:new a.A({label:"keep typing for more results"})}]:[]]}(e,t),renderInput:e=>(0,c.jsx)(d,{params:e,inputBoxVal:F,TextFieldProps:f,setCurrentSearch:x,setInputValue:T}),getOptionLabel:e=>"string"==typeof e?e:e.result.getDisplayString()})}))},97486:(e,t,r)=>{"use strict";r.d(t,{Lr:()=>P,GQ:()=>z,LW:()=>w.A,e6:()=>x,$m:()=>Tt.$,zh:()=>Tt.z,Gd:()=>ht,_e:()=>T,Ki:()=>l,Ay:()=>Nt,Gx:()=>$,lw:()=>U,bN:()=>Y,mJ:()=>Ft.m});var n=r(12678),a=r(68584),i=r(99546),o=r(97539),s=r(36422);const l=(0,a.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"},height:{type:"number",defaultValue:100,description:"default height for the track"},mouseover:{type:"string",description:"text to display when the cursor hovers over a feature",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},jexlFilters:{type:"stringArray",description:"default set of jexl filters to apply to a track. note: these do not use the jexl prefix because they have a deferred evaluation system",defaultValue:[]}},{explicitIdentifier:"displayId"});var c=r(7552),d=r(1622);class u{constructor(e){this.submaps=e}has(e){for(const t of this.submaps.values())if(t.has(e))return!0;return!1}get(e){for(const t of this.submaps.values())if(t.has(e))return t.get(e)}*values(){for(const e of this.keys())yield this.get(e)}*keys(){const e=new Set;for(const t of this.submaps.values())for(const r of t.keys())e.add(r);for(const t of e)yield t}find(e){for(const t of this.submaps.values())for(const r of t.values())if(e(r))return r}*[Symbol.iterator](){for(const e of this.keys())yield[e,this.get(e)]}*entries(){for(const e of this.keys())yield[e,this.get(e)]}}var p=r(91468),g=r(12196),h=r(28129),f=r(42489),m=r(21479),y=r(69092),b=r(68446),w=r(37205),v=r(69500);const S=(0,b.observer)((function({model:e}){const{regionTooLargeReason:t}=e;return(0,v.jsx)(w.A,{severity:"warning",action:(0,v.jsx)(y.A,{onClick:()=>{(0,s.isAlive)(e)&&(e.setFeatureDensityStatsLimit(e.featureDensityStats),e.reload())},children:"Force load"}),message:[t,"Zoom in to see features or force load (may be slow)"].filter((e=>!!e)).join(". ")})})),C=S;function x(){return s.types.model({userBpPerPxLimit:s.types.maybe(s.types.number),userByteSizeLimit:s.types.maybe(s.types.number)}).volatile((()=>({featureDensityStatsP:void 0,featureDensityStats:void 0,currStatsBpPerPx:0}))).views((e=>({get currentBytesRequested(){return e.featureDensityStats?.bytes||0},get currentFeatureScreenDensity(){const t=(0,i.getContainingView)(e);return(e.featureDensityStats?.featureDensity||0)*t.bpPerPx},get maxFeatureScreenDensity(){return(0,a.getConf)(e,"maxFeatureScreenDensity")},get featureDensityStatsReady(){const t=(0,i.getContainingView)(e);return!(e.currStatsBpPerPx!==t.bpPerPx||!e.featureDensityStats&&!e.userBpPerPxLimit)},get maxAllowableBytes(){return e.userByteSizeLimit||e.featureDensityStats?.fetchSizeLimit||(0,a.getConf)(e,"fetchSizeLimit")}}))).actions((e=>({afterAttach(){(0,s.addDisposer)(e,(0,f.autorun)((()=>async function(e){try{const t=(0,i.getContainingView)(e);if(!t.initialized||!t.staticBlocks.contentBlocks.length||t.bpPerPx===e.currStatsBpPerPx||e.error)return;if(void 0!==e.featureDensityStats?.featureDensity)return void e.setCurrStatsBpPerPx(t.bpPerPx);e.clearFeatureDensityStats(),e.setCurrStatsBpPerPx(t.bpPerPx);const r=await e.getFeatureDensityStats();(0,s.isAlive)(e)&&e.setFeatureDensityStats(r)}catch(t){console.error(t),(0,s.isAlive)(e)&&!(0,i.isAbortException)(t)&&e.setError(t)}}(e))))}}))).actions((e=>({setCurrStatsBpPerPx(t){e.currStatsBpPerPx=t},setFeatureDensityStatsLimit(t){const r=(0,i.getContainingView)(e);t?.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=r.bpPerPx},getFeatureDensityStats(){return e.featureDensityStatsP||(e.featureDensityStatsP=(0,m.bf)(e).catch((t=>{throw(0,s.isAlive)(e)&&this.setFeatureDensityStatsP(void 0),t}))),e.featureDensityStatsP},setFeatureDensityStatsP(t){e.featureDensityStatsP=t},setFeatureDensityStats(t){e.featureDensityStats=t},clearFeatureDensityStats(){e.featureDensityStatsP=void 0,e.featureDensityStats=void 0}}))).views((e=>({get regionTooLarge(){const t=(0,i.getContainingView)(e);return!(!e.featureDensityStatsReady||t.dynamicBlocks.totalBp<2e4)&&(e.currentBytesRequested>e.maxAllowableBytes||(e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity))},get regionTooLargeReason(){const t=e.currentBytesRequested,r=e.maxAllowableBytes;return t&&t>r?`Requested too much data (${(0,m.W7)(t)})`:""}}))).views((e=>({get statsReadyAndRegionNotTooLarge(){return e.featureDensityStatsReady&&!e.regionTooLarge},regionCannotBeRenderedText:t=>e.regionTooLarge?"Force load to see features":"",regionCannotBeRendered:t=>e.regionTooLarge?(0,v.jsx)(C,{model:e}):null})))}const k=20;function T(){return s.types.model({heightPreConfig:s.types.maybe(s.types.refinement("displayHeight",s.types.number,(e=>e>=k)))}).volatile((()=>({scrollTop:0}))).views((e=>({get height(){return e.heightPreConfig??(0,a.getConf)(e,"height")}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,k),e.height),resizeHeight(t){const r=e.height;return this.setHeight(e.height+t)-r}})))}var A=r(52119);const M=(0,c.lazy)((()=>Promise.resolve().then(r.bind(r,2286)))),P=s.types.compose("BaseLinearDisplay",d.BaseDisplay,T(),x(),s.types.model({blockState:s.types.map(A.A),configuration:(0,a.ConfigurationReference)(l)})).volatile((()=>({featureIdUnderMouse:void 0,contextMenuFeature:void 0}))).views((e=>({get DisplayMessageComponent(){},get blockType(){return"staticBlocks"},get blockDefinitions(){const t=(0,i.getContainingView)(e);if(!t.initialized)throw new Error("view not initialized yet");return t[this.blockType]}}))).views((e=>({get renderDelay(){return 50},get TooltipComponent(){return M},get selectedFeatureId(){if((0,s.isAlive)(e)){const{selection:t}=(0,i.getSession)(e);if((0,i.isFeature)(t))return t.id()}}}))).views((e=>({get features(){const t=[];for(const r of e.blockState.values())r.features&&t.push(r.features);return new u(t)},get featureUnderMouse(){const t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping:(t,r,n)=>e.blockState.get(t)?.layout?.getByCoord(r,n),getFeatureByID:(t,r)=>e.blockState.get(t)?.layout?.getByID(r),searchFeatureByID(t){let r;for(const n of e.blockState.values()){const e=n.layout?.getByID(t);e&&(r=e)}return r}}))).actions((e=>({addBlock(t,r){e.blockState.set(t,A.A.create({key:t,region:r.toRegion()}))},deleteBlock(t){e.blockState.delete(t)},async selectFeature(t){const r=(0,i.getSession)(e);if((0,i.isSessionModelWithWidgets)(r)){const{rpcManager:n}=r,o=(0,p.getRpcSessionId)(e),s=(0,i.getContainingTrack)(e),l=(0,i.getContainingView)(e),c=(0,a.getConf)(s,"adapter"),d=await n.call(o,"CoreGetMetadata",{adapterConfig:c});r.showWidget(r.addWidget("BaseFeatureWidget","baseFeature",{featureData:t.toJSON(),view:l,track:s,descriptions:d}))}(0,i.isSelectionContainer)(r)&&r.setSelection(t)},navToFeature(t){(0,i.getContainingView)(e).navTo({refName:t.get("refName"),start:t.get("start"),end:t.get("end")})},clearFeatureSelection(){(0,i.getSession)(e).clearSelection()},setFeatureIdUnderMouse(t){e.featureIdUnderMouse=t},setContextMenuFeature(t){e.contextMenuFeature=t}}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),e.setCurrStatsBpPerPx(0),e.clearFeatureDensityStats();for(const t of e.blockState.values())t.doReload();t()}}})).views((e=>({trackMenuItems:()=>[],contextMenuItems:()=>[...e.contextMenuFeature?[{label:"Open feature details",icon:h.A,onClick:()=>{e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature).catch((e=>{(0,i.getSession)(e).notifyError(`${e}`,e)}))}},{label:"Zoom to feature",icon:g.A,onClick:()=>{e.contextMenuFeature&&e.navToFeature(e.contextMenuFeature)}}]:[]],renderProps:()=>({...(0,p.getParentRenderProps)(e),notReady:!e.featureDensityStatsReady,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick(t,r){const n=r||e.featureIdUnderMouse;if(n){const t=e.features.get(n);t&&e.selectFeature(t).catch((e=>{(0,i.getSession)(e).notifyError(`${e}`,e)}))}else e.clearFeatureSelection()},onClick(){e.clearFeatureSelection()},onFeatureContextMenu(t,r){const n=r||e.featureIdUnderMouse;n?e.setContextMenuFeature(e.features.get(n)):e.clearFeatureSelection()},onMouseMove(t,r){e.setFeatureIdUnderMouse(r)},onMouseLeave(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})}))).actions((e=>({async renderSvg(t){const{renderBaseLinearDisplaySvg:n}=await r.e(3311).then(r.bind(r,23311));return n(e,t)},afterAttach(){(0,s.addDisposer)(e,(0,f.autorun)((()=>{const t={};if((0,i.getContainingView)(e).initialized){for(const r of e.blockDefinitions.contentBlocks)t[r.key]=!0,e.blockState.has(r.key)||e.addBlock(r.key,r);for(const r of e.blockState.keys())t[r]||e.deleteBlock(r)}})))}}))).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...r}=e;return{heightPreConfig:t,...r}})).postProcessSnapshot((e=>{const t=e,{blockState:r,...n}=t;return n}));var R=r(67112),L=r(51414),I=r(75785),F=r(42752);const N=(0,I.n9)()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:999,boxSizing:"border-box"}}),D=(0,b.observer)((function({model:e}){const{classes:t}=N(),{blockDefinitions:r,blockState:n}=e;return(0,v.jsx)(v.Fragment,{children:r.map((r=>{const a=`${e.id}-${r.key}`;if("ContentBlock"===r.type){const e=n.get(r.key);return(0,v.jsxs)(F.$G,{block:r,children:[e?.ReactComponent?(0,v.jsx)(e.ReactComponent,{model:e}):null,e?.maxHeightReached?(0,v.jsx)("div",{className:t.heightOverflowed,style:{top:e.layout.getTotalHeight()-16,pointerEvents:"none",height:16},children:"Max height reached"}):null]},a)}if("ElidedBlock"===r.type)return(0,v.jsx)(F.Db,{width:r.widthPx},a);if("InterRegionPaddingBlock"===r.type)return(0,v.jsx)(F.fK,{width:r.widthPx,style:{background:"none"},boundary:"boundary"===r.variant},a);throw new Error(`invalid block type ${JSON.stringify(r)}`)}))})})),B=(0,b.observer)((function({model:e}){const{classes:t}=N(),{blockDefinitions:r}=e,n=(0,i.getContainingView)(e);return(0,v.jsx)("div",{className:t.linearBlocks,style:{left:r.offsetPx-n.offsetPx},children:(0,v.jsx)(D,{model:e})})})),V=B;r(2286);const j=(0,I.n9)()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),E=(0,b.observer)((function(e){const{classes:t}=j(),r=(0,L.A)(),n=(0,c.useRef)(null),[i,o]=(0,c.useState)(),[s,l]=(0,c.useState)([0,0]),[d,u]=(0,c.useState)([0,0]),[p,g]=(0,c.useState)(),{model:h,children:f}=e,{TooltipComponent:m,DisplayMessageComponent:y,height:b}=h,w=h.contextMenuItems();return(0,v.jsxs)("div",{ref:n,"data-testid":`display-${(0,a.getConf)(h,"displayId")}`,className:t.display,onContextMenu:e=>{e.preventDefault(),p?g(void 0):n.current&&g([e.clientX,e.clientY])},onMouseMove:e=>{if(!n.current)return;const t=n.current.getBoundingClientRect(),{left:r,top:a}=t;l([e.clientX-r,e.clientY-a]),u([e.clientX,e.clientY]),o(t)},children:[y?(0,v.jsx)(y,{model:h}):(0,v.jsx)(V,{...e}),f,(0,v.jsx)(c.Suspense,{fallback:null,children:(0,v.jsx)(m,{model:h,height:b,offsetMouseCoord:s,clientMouseCoord:d,clientRect:i,mouseCoord:s})}),(0,v.jsx)(R.Menu,{open:Boolean(p)&&w.length>0,onMenuItemClick:(e,t)=>{t(),g(void 0)},onClose:()=>{g(void 0),h.setContextMenuFeature(void 0)},slotProps:{transition:{onExit:()=>{g(void 0),h.setContextMenuFeature(void 0)}}},anchorReference:"anchorPosition",anchorPosition:p?{top:p[1],left:p[0]}:void 0,style:{zIndex:r.zIndex.tooltip},menuItems:w})]})})),z=E;var O=r(58921);var H=r(6184);function G(e,t,r){try{e.showTrack(t)}catch(e){if(!/Could not resolve identifier/.exec(`${e}`))throw e;r.push(t)}}function W(e){return(0,a.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})}function $(e){return s.types.compose("LinearBareDisplay",P,s.types.model({type:s.types.literal("LinearBareDisplay"),configuration:(0,a.ConfigurationReference)(e)})).views((e=>({get rendererConfig(){const t=(0,a.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create(t,(0,i.getEnv)(e))},get rendererTypeName(){return(0,a.getConf)(e,["renderer","type"])}}))).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),...(0,p.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,config:e.rendererConfig})}}))}const U=function(e){return(0,a.ConfigurationSchema)("LinearBasicDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})};var q=r(93100),_=r(20482);const J=(0,c.lazy)((()=>r.e(4033).then(r.bind(r,34033)))),X=(0,c.lazy)((()=>r.e(2412).then(r.bind(r,92412)))),Y=function(e){return s.types.compose("LinearBasicDisplay",P,s.types.model({type:s.types.literal("LinearBasicDisplay"),trackShowLabels:s.types.maybe(s.types.boolean),trackShowDescriptions:s.types.maybe(s.types.boolean),trackDisplayMode:s.types.maybe(s.types.string),trackMaxHeight:s.types.maybe(s.types.number),configuration:(0,a.ConfigurationReference)(e),jexlFilters:s.types.maybe(s.types.array(s.types.string))})).views((e=>({get activeFilters(){return e.jexlFilters??(0,a.getConf)(e,"jexlFilters").map((e=>`jexl:${e}`))},get rendererTypeName(){return(0,a.getConf)(e,["renderer","type"])},get showLabels(){return e.trackShowLabels??(0,a.getConf)(e,["renderer","showLabels"])},get showDescriptions(){return e.trackShowDescriptions??(0,a.getConf)(e,["renderer","showDescriptions"])},get maxHeight(){return e.trackMaxHeight??(0,a.getConf)(e,["renderer","maxHeight"])},get displayMode(){return e.trackDisplayMode??(0,a.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,a.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,showLabels:e.showLabels,showDescriptions:e.showDescriptions,displayMode:e.displayMode,maxHeight:e.maxHeight},(0,s.getEnv)(e))}}))).actions((e=>({setJexlFilters(t){e.jexlFilters=(0,s.cast)(t)},toggleShowLabels(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode(t){e.trackDisplayMode=t},setMaxHeight(t){e.trackMaxHeight=t}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),config:e.rendererConfig,filters:new q.A({filters:e.activeFilters})}),trackMenuItems:()=>[...t(),{label:"Show labels",icon:_.A,type:"checkbox",checked:e.showLabels,onClick:()=>{e.toggleShowLabels()}},{label:"Show descriptions",icon:_.A,type:"checkbox",checked:e.showDescriptions,onClick:()=>{e.toggleShowDescriptions()}},{label:"Display mode",icon:_.A,subMenu:["compact","reducedRepresentation","normal","collapse"].map((t=>({label:t,onClick:()=>{e.setDisplayMode(t)}})))},{label:"Set max height",onClick:()=>{(0,i.getSession)(e).queueDialog((t=>[J,{model:e,handleClose:t}]))}},{label:"Edit filters",onClick:()=>{(0,i.getSession)(e).queueDialog((t=>[X,{model:e,handleClose:t}]))}}]}}))};var K=r(90542),Q=r(95095),Z=r(97884),ee=r(93707),te=r(88530),re=r(8832),ne=r(83567),ae=r(41718),ie=r(41562),oe=r(48747),se=r(34727),le=r(31294),ce=r(66670),de=r(17914),ue=r(45465),pe=r(36866),ge=r(12818),he=r(52988),fe=r(62266),me=r(76239);const ye=(0,I.n9)()((e=>({panButton:{background:(0,fe.X4)(e.palette.background.paper,.8),color:e.palette.text.primary,margin:me.Es},buttonSpacer:{marginRight:e.spacing(2)}})));function be({model:e}){const{classes:t}=ye();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(y.A,{variant:"outlined",className:t.panButton,onClick:()=>{e.slide(-.9)},children:(0,v.jsx)(ge.A,{})}),(0,v.jsx)(y.A,{variant:"outlined",className:t.panButton,onClick:()=>{e.slide(.9)},children:(0,v.jsx)(he.A,{})})]})}var we=r(61282);const ve=(0,I.n9)()({bp:{display:"flex",alignItems:"center",marginLeft:5,cursor:"pointer"}}),Se=(0,b.observer)((function({model:e}){const{classes:t}=ve(),{coarseTotalBp:r}=e;return(0,v.jsx)(we.A,{variant:"body2",color:"textSecondary",className:t.bp,children:(0,i.getBpDisplayStr)(r)})})),Ce=Se;var xe=r(89870);const ke=(0,I.n9)()((e=>({toggleButton:{height:44,border:"none",marginLeft:e.spacing(4)}}))),Te=(0,b.observer)((function({model:e}){const{classes:t}=ke();return(0,v.jsx)(xe.A,{onClick:e.activateTrackSelector,className:t.toggleButton,title:"Open track selector",value:"track_select",children:(0,v.jsx)(K.xU,{})})})),Ae=Te;var Me=r(23758),Pe=r(2020),Re=r(1485),Le=r(37962),Ie=r(14332);const Fe=(0,c.lazy)((()=>r.e(3448).then(r.bind(r,27419)))),Ne=(0,I.n9)()((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:100,color:e.palette.text.secondary}})));function De(e){const{children:t,open:r,value:n}=e;return(0,v.jsx)(Le.A,{open:r,enterTouchDelay:0,placement:"top",title:n,arrow:!0,children:t})}const Be=(0,b.observer)((function({model:e}){const{classes:t}=Ne(),{width:r,maxBpPerPx:n,minBpPerPx:a,bpPerPx:o}=e,[s,l]=(0,c.useState)(100*-Math.log2(o));(0,c.useEffect)((()=>{l(100*-Math.log2(o))}),[o]);const d=o<=a+1e-4,u=o>=n-1e-4;return(0,v.jsxs)("div",{className:t.container,children:[(0,v.jsx)(Le.A,{title:"Zoom out 2x",children:(0,v.jsx)("span",{children:(0,v.jsx)(xe.A,{"data-testid":"zoom_out",disabled:u,onClick:()=>{e.zoom(2*o)},children:(0,v.jsx)(Re.A,{})})})}),(0,v.jsx)(Ie.Ay,{size:"small",className:t.slider,value:s,min:100*-Math.log2(n),max:100*-Math.log2(a),onChangeCommitted:()=>e.zoomTo(2**(-s/100)),valueLabelDisplay:"auto",valueLabelFormat:e=>`Window size: ${(0,i.getBpDisplayStr)(2**(-e/100)*r)}`,slots:{valueLabel:De},onChange:(e,t)=>{l(t)}}),(0,v.jsx)(Le.A,{title:"Zoom in 2x",children:(0,v.jsx)("span",{children:(0,v.jsx)(xe.A,{"data-testid":"zoom_in",disabled:d,onClick:()=>{e.zoom(e.bpPerPx/2)},children:(0,v.jsx)(de.A,{})})})}),(0,v.jsx)(Me.A,{menuItems:[...[100,50,10].map((t=>({label:`Zoom in ${t}x`,onClick:()=>{e.zoom(e.bpPerPx/t)}}))),...[10,50,100].map((t=>({label:`Zoom out ${t}x`,onClick:()=>{e.zoom(e.bpPerPx*t)}}))),{label:"Custom zoom",onClick:()=>{(0,i.getSession)(e).queueDialog((t=>[Fe,{model:e,handleClose:t}]))}}],children:(0,v.jsx)(Pe.A,{})})]})})),Ve=Be;var je=r(84481),Ee=r(87485);const ze=(0,I.n9)()((e=>({highlight:{height:"100%",position:"absolute",background:(0,Ee.M)(e.palette.highlight.main).alpha(.35).toRgbString(),borderLeft:`1px solid ${e.palette.highlight.main}`,borderRight:`1px solid ${e.palette.highlight.main}`}}))),Oe=(0,b.observer)((function({model:e,overview:t}){const{classes:r}=ze(),{highlight:n,cytobandOffset:a}=e,o=(0,i.getSession)(e),{assemblyManager:s}=o;return n.map((e=>{const r=s.get(e.assemblyName),n=r?.getCanonicalRefName(e.refName)??e.refName,i=t.bpToPx({...e,refName:n,coord:e.start}),o=t.bpToPx({...e,refName:n,coord:e.end});return void 0!==i&&void 0!==o?{width:Math.abs(o-i),left:i+a}:void 0})).filter(i.notEmpty).map((({left:e,width:t},n)=>(0,v.jsx)("div",{className:r.highlight,style:{width:t,left:e}},`${e}_${t}_${n}`)))})),He=Oe,Ge=(0,I.n9)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute"}}),We=(0,b.observer)((function({model:e,open:t,guideX:r,overview:n}){const{classes:a}=Ge(),{cytobandOffset:o}=e,{assemblyManager:s}=(0,i.getSession)(e),l=n.pxToBp(r-o),c=s.get(l.assemblyName),d=c?.cytobands?.find((e=>l.coord>e.get("start")&&l.coord<e.get("end")&&l.refName===c.getCanonicalRefName(e.get("refName"))));return(0,v.jsx)(Le.A,{open:t,placement:"top",title:[(0,i.stringify)(l),d?.get("name"),d?.get("type")].join(" "),arrow:!0,children:(0,v.jsx)("div",{className:a.guide,style:{left:r}})})})),$e=We;var Ue=r(37934),qe=r(50574);const _e=(0,I.n9)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rel:{position:"relative"}}),Je=(0,b.observer)((function({model:e,overview:t,ControlComponent:r=(0,v.jsx)("div",{})}){const{cytobandOffset:n}=e,[a,o]=(0,c.useState)(),[s,l]=(0,c.useState)(),[d,u]=(0,c.useState)(),p=(0,c.useRef)(null),{classes:g}=_e(),h=void 0!==a;function f(e){e.preventDefault(),e.stopPropagation(),o((0,qe.Pn)(e,p.current))}function m(e){u((0,qe.Pn)(e,p.current))}function y(){u(void 0)}if((0,c.useEffect)((()=>{function r(e){const t=p.current;t&&h&&l((0,qe.Pn)(e,t))}function c(){if(void 0!==a&&void 0!==s&&Math.abs(s-a)>3){const r=Math.min(a,s),i=Math.max(a,s);e.moveTo(t.pxToBp(r-n),t.pxToBp(i-n))}if(void 0!==a&&void 0===s){const r=t.pxToBp(a-n);r.refName?e.centerAt(Math.round(r.coord),r.refName,r.index):((0,i.getSession)(e).notify("unknown position clicked"),console.error("unknown position clicked",r))}o(void 0),l(void 0),void 0!==a&&u(void 0)}function d(e){"Escape"===e.key&&(o(void 0),l(void 0))}return h?(window.addEventListener("mousemove",r,!0),window.addEventListener("mouseup",c,!0),window.addEventListener("keydown",d,!0),()=>{window.removeEventListener("mousemove",r,!0),window.removeEventListener("mouseup",c,!0),window.removeEventListener("keydown",d,!0)}):()=>{}}),[h,s,a,e,t,n]),void 0===a)return(0,v.jsxs)("div",{className:g.rel,children:[void 0!==d?(0,v.jsx)($e,{model:e,open:!h,overview:t,guideX:d}):null,(0,v.jsx)("div",{className:g.rubberbandControl,ref:p,onMouseDown:f,onMouseOut:y,onMouseMove:m,children:r})]});let b,w,S=a||0,C=0;return void 0!==s&&(S=Math.min(s,a),C=s-a),a&&(b=t.pxToBp(a-n),w=t.pxToBp(a+C-n),void 0!==s&&s<a&&([b,w]=[w,b])),(0,v.jsxs)("div",{className:g.rel,children:[b&&w?(0,v.jsx)(Ue.default,{leftBpOffset:b,rightBpOffset:w,width:Math.abs(C),left:S}):null,(0,v.jsx)("div",{"data-testid":"rubberband_controls",className:g.rubberbandControl,ref:p,onMouseDown:f,onMouseOut:y,onMouseMove:m,children:r})]})})),Xe=Je;var Ye=r(32474),Ke=r(27703);const Qe=(0,I.n9)()({scalebarLabel:{height:me.Gu,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"}}),Ze=(0,b.observer)((function({block:e,scale:t,overview:r,model:n}){const{classes:a}=Qe(),{start:o,end:s,reversed:l,refName:c,assemblyName:d}=e,{majorPitch:u}=(0,Ke.i3)(t,120,15),{assemblyManager:p}=(0,i.getSession)(n),g=p.get(d),h=g?.getRefNameColor(c),f=[];for(let e=0;e<Math.floor((s-o)/u);e++){const t=(e+1)*u;f.push(l?s-t:o+t)}return f.map(((n,o)=>(0,v.jsx)(we.A,{className:a.scalebarLabel,variant:"body2",style:{left:(o+1)*u/t,pointerEvents:"none",color:h},children:(0,i.getTickDisplayStr)(n,r.bpPerPx)},`${JSON.stringify(e)}-${n}-${o}`)))})),et=Ze,tt=(0,I.n9)()((e=>({scalebar:{height:me.Gu},scalebarBorder:{border:"1px solid"},scalebarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:me.Gu,overflow:"hidden"},scalebarContigForward:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarContigReverse:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scalebarVisibleRegion:{position:"absolute",height:me.Gu,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:me.Ij,position:"relative"},overviewSvg:{pointerEvents:"none",width:"100%",position:"absolute"}}))),rt=(0,b.observer)((function({scale:e,model:t,block:r,overview:n}){const{classes:a,cx:o}=tt(),s=(0,L.A)(),{cytobandOffset:l,showCytobands:c}=t,{reversed:d,refName:u,assemblyName:p}=r,{assemblyManager:g}=(0,i.getSession)(t),h=g.get(p),f=h?.getRefNameColor(u),m=c&&(0,qe.S5)(h,r.refName).length;return(0,v.jsxs)("div",{children:[(0,v.jsx)(we.A,{style:{left:r.offsetPx+3,color:m?s.palette.text.primary:f},className:a.scalebarRefName,children:u}),(0,v.jsx)("div",{className:o(a.scalebarContig,m?void 0:d?a.scalebarContigReverse:a.scalebarContigForward,m?void 0:a.scalebarBorder),style:{left:r.offsetPx+l,width:r.widthPx,borderColor:f},children:m?(0,v.jsx)("svg",{style:{width:"100%"},children:(0,v.jsx)(je.A,{overview:n,assembly:h,block:r})}):(0,v.jsx)(et,{model:t,overview:n,scale:e,block:r})})]})})),nt=(0,b.observer)((function({model:e,scale:t,overview:r}){const{classes:n}=tt(),a=(0,L.A)(),{dynamicBlocks:o,showCytobands:s,cytobandOffset:l}=e,{pluginManager:c}=(0,i.getEnv)(e),d=o.contentBlocks,u=r.dynamicBlocks,p=a.palette.tertiary.light;if(!d.length)return null;const g=d.at(0),h=d.at(-1),f=r.bpToPx({...g,coord:g.reversed?g.end:g.start})||0,m=r.bpToPx({...h,coord:h.reversed?h.start:h.end})||0,y=s?"#f00":p,b=s?.1:.3,w=c.evaluateExtensionPoint("LinearGenomeView-OverviewScalebarComponent",void 0,{model:e,overview:r});return(0,v.jsxs)("div",{className:n.scalebar,children:[(0,v.jsx)("div",{className:n.scalebarVisibleRegion,style:{width:m-f,left:f+l,background:(0,fe.X4)(y,b),borderColor:y}}),u.map(((a,i)=>"ContentBlock"!==a.type?(0,v.jsx)("div",{className:n.scalebarContig,style:{width:a.widthPx,left:a.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}},`${JSON.stringify(a)}-${i}`):(0,v.jsx)(rt,{scale:t,block:a,model:e,overview:r},`${JSON.stringify(a)}-${i}`))),(0,v.jsx)(He,{model:e,overview:r}),w]})})),at=(0,b.observer)((function({model:e,children:t}){const{classes:r}=tt(),{minimumBlockWidth:n,totalBp:a,width:i,cytobandOffset:o,displayedRegions:s}=e,l=i-o,d=JSON.stringify(s),u=(0,c.useMemo)((()=>{const e=Z.A.create({displayedRegions:JSON.parse(d),interRegionPaddingWidth:0,minimumBlockWidth:n});return e.setVolatileWidth(l),e.showAllRegions(),e}),[d,n,l]),p=a/(l-2*(s.length-1));return(0,v.jsxs)("div",{children:[(0,v.jsx)(Xe,{model:e,overview:u,ControlComponent:(0,v.jsx)(nt,{model:e,overview:u,scale:p})}),(0,v.jsxs)("div",{className:r.overview,children:[(0,v.jsx)("svg",{height:me.Ij,className:r.overviewSvg,children:(0,v.jsx)(Ye.A,{model:e,overview:u})}),t]})]})})),it=at;var ot=r(96480),st=r(15897),lt=r(33896);const ct=(0,c.lazy)((()=>r.e(9374).then(r.bind(r,39374))));function dt(){const[e,t]=(0,c.useState)(!1);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(xe.A,{onClick:()=>{t(!0)},size:"small",children:(0,v.jsx)(st.A,{fontSize:"small"})}),e?(0,v.jsx)(c.Suspense,{fallback:null,children:(0,v.jsx)(ct,{handleClose:()=>{t(!1)}})}):null]})}function ut({showHelp:e}){return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(lt.A,{position:"end",style:{marginRight:7},children:[(0,v.jsx)(le.A,{fontSize:"small"}),e?(0,v.jsx)(dt,{}):null]})})}const pt=(0,I.n9)()({headerRefName:{minWidth:100}}),gt=(0,b.observer)((function({model:e,showHelp:t=!0}){const{classes:r}=pt(),n=(0,L.A)(),a=(0,i.getSession)(e),{textSearchManager:o,assemblyManager:s}=a,{assemblyNames:l,rankSearchResults:c}=e,d=l[0],u=s.get(d),p=e.searchScope(d);return(0,v.jsx)(ot.A,{onSelect:async t=>{try{await async function({option:e,model:t,assemblyName:r}){const{assemblyManager:n}=(0,i.getSession)(t),a=n.get(r);e.hasLocation()?await(0,H.Kd)({option:e,model:t,assemblyName:r}):e.results?.length?t.setSearchResults(e.results,e.getLabel()):a&&await(0,H.cm)({input:e.getLabel(),assembly:a,model:t})}({model:e,assemblyName:d,option:t})}catch(t){console.error(t),(0,i.getSession)(e).notify(`${t}`,"warning")}},assemblyName:d,fetchResults:e=>(0,qe.Jf)({queryString:e,searchScope:p,rankSearchResults:c,textSearchManager:o,assembly:u}),model:e,minWidth:175,TextFieldProps:{variant:"outlined",className:r.headerRefName,style:{margin:me.Es},slotProps:{input:{style:{padding:0,height:me.P5,background:(0,fe.X4)(n.palette.background.paper,.8)},endAdornment:(0,v.jsx)(ut,{showHelp:t})}}}})})),ht=gt,ft=(0,I.n9)()({headerBar:{display:"flex",height:me.Ij},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1}}),mt=function({model:e}){const{classes:t}=ft();return(0,v.jsxs)("div",{className:t.headerBar,children:[(0,v.jsx)(Ae,{model:e}),(0,v.jsx)("div",{className:t.spacer}),(0,v.jsxs)(pe.A,{row:!0,className:t.headerForm,children:[(0,v.jsx)(be,{model:e}),(0,v.jsx)(ht,{model:e})]}),(0,v.jsx)(Ce,{model:e}),(0,v.jsx)(Ve,{model:e}),(0,v.jsx)("div",{className:t.spacer})]})},yt=(0,b.observer)((function({model:e}){const{hideHeader:t,hideHeaderOverview:r}=e;return t?null:r?(0,v.jsx)(mt,{model:e}):(0,v.jsx)(it,{model:e,children:(0,v.jsx)(mt,{model:e})})})),bt=yt;var wt=r(5986),vt=r(95054);const St=(0,I.n9)()((e=>({background:{position:"absolute",right:0,background:e.palette.background.paper},focusedBackground:{background:(0,fe.X4)(e.palette.secondary.light,.2)}}))),Ct=(0,b.observer)((function({model:e}){const{classes:t}=St(),{id:r,bpPerPx:n,maxBpPerPx:a,minBpPerPx:o,scaleFactor:s,hideHeader:l}=e,{focusedViewId:c}=(0,i.getSession)(e);return l?(0,v.jsx)(vt.A,{className:t.background,children:(0,v.jsxs)(vt.A,{className:c===r?t.focusedBackground:void 0,children:[(0,v.jsx)(Me.A,{menuItems:e.menuItems(),children:(0,v.jsx)(wt.A,{fontSize:"small"})}),(0,v.jsx)(xe.A,{"data-testid":"zoom_out",onClick:()=>{e.zoom(2*n)},disabled:n>=a-1e-4||1!==s,children:(0,v.jsx)(Re.A,{fontSize:"small"})}),(0,v.jsx)(xe.A,{"data-testid":"zoom_in",onClick:()=>{e.zoom(n/2)},disabled:n<=o+1e-4||1!==s,children:(0,v.jsx)(de.A,{fontSize:"small"})})]})}):null})),xt=Ct;var kt=r(65193),Tt=r(98753);const At=(0,c.lazy)((()=>r.e(7686).then(r.bind(r,87686)))),Mt=(0,c.lazy)((()=>r.e(1281).then(r.bind(r,61281)))),Pt=(0,c.lazy)((()=>r.e(8528).then(r.bind(r,98528)))),Rt=(0,c.lazy)((()=>r.e(7761).then(r.bind(r,77761)))),Lt=(0,c.lazy)((()=>r.e(9067).then(r.bind(r,79067))));function It(e){return s.types.compose("LinearGenomeView",d.BaseViewModel,s.types.model({id:re.ElementId,type:s.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:s.types.optional(s.types.frozen(),[]),tracks:s.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:s.types.optional(s.types.enumeration(["hierarchical"]),"hierarchical"),showCenterLine:s.types.optional(s.types.boolean,(()=>(0,i.localStorageGetBoolean)("lgv-showCenterLine",!1))),showCytobandsSetting:s.types.optional(s.types.boolean,(()=>(0,i.localStorageGetBoolean)("lgv-showCytobands",!0))),trackLabels:s.types.optional(s.types.string,(()=>(0,i.localStorageGetItem)("lgv-trackLabels")||"")),showGridlines:!0,highlight:s.types.optional(s.types.array(s.types.frozen()),[]),colorByCDS:s.types.optional(s.types.boolean,(()=>(0,i.localStorageGetBoolean)("lgv-colorByCDS",!1))),showTrackOutlines:s.types.optional(s.types.boolean,(()=>(0,i.localStorageGetBoolean)("lgv-showTrackOutlines",!0))),init:s.types.frozen()})).volatile((()=>({volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0}))).views((e=>({get pinnedTracks(){return e.tracks.filter((e=>e.pinned))},get unpinnedTracks(){return e.tracks.filter((e=>!e.pinned))},get trackLabelsSetting(){const t=(0,a.getConf)((0,i.getSession)(e),["LinearGenomeViewPlugin","trackLabels"]);return e.trackLabels||t},get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return me.Rd},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]},get stickyViewHeaders(){const t=(0,i.getSession)(e);return!!(0,ne.X)(t)&&t.stickyViewHeaders},get rubberbandTop(){let t=0;return this.stickyViewHeaders&&(t=R.VIEW_HEADER_HEIGHT,e.hideHeader||(t+=me.Ij,e.hideHeaderOverview||(t+=me.Gu))),t},get pinnedTracksTop(){return this.rubberbandTop+me.jE}}))).views((e=>({scaleBarDisplayPrefix:()=>"LinearSyntenyView"===(0,s.getParent)(e,2).type?e.assemblyNames[0]:"",MiniControlsComponent:()=>xt,HeaderComponent:()=>bt,get assembliesNotFound(){const{assemblyManager:t}=(0,i.getSession)(e),r=e.assemblyNames.map((e=>t.get(e)?void 0:e)).filter((e=>!!e)).join(",");return r?`Assemblies ${r} not found`:void 0},get assemblyErrors(){const{assemblyManager:t}=(0,i.getSession)(e);return e.assemblyNames.map((e=>t.get(e)?.error)).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,i.getSession)(e);return e.assemblyNames.every((e=>t.get(e)?.initialized))},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get scaleBarHeight(){return me.jE+me.i3},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?me.Ij:me.Ij+me.Gu},get trackHeights(){return(0,i.sum)(e.tracks.map((e=>e.displays[0].height)))},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*me.i3},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return(0,i.sum)(e.displayedRegions.map((e=>e.end-e.start)))},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors||this.assembliesNotFound},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:()=>({...(0,p.getParentRenderProps)(e),bpPerPx:e.bpPerPx,colorByCDS:e.colorByCDS}),searchScope:t=>({assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}),getTrack:t=>e.tracks.find((e=>e.configuration.trackId===t)),rankSearchResults:e=>e,rewriteOnClicks(t,r){for(const n of r)if("subMenu"in n&&this.rewriteOnClicks(t,n.subMenu),"onClick"in n){const r=n.onClick;n.onClick=(...n)=>{for(const a of e.tracks)a.type===t&&r.apply(a,[a,...n])}}},get trackTypeActions(){const t=new Map;for(const r of e.tracks)if(!t.get(r.type)){const e=structuredClone(r.viewMenuActions);this.rewriteOnClicks(r.type,e),t.set(r.type,e)}return t}}))).actions((t=>({setShowTrackOutlines(e){t.showTrackOutlines=e},setColorByCDS(e){t.colorByCDS=e},setShowCytobands(e){t.showCytobandsSetting=e},setWidth(e){t.volatileWidth=e},setError(e){t.volatileError=e},setHideHeader(e){t.hideHeader=e},setHideHeaderOverview(e){t.hideHeaderOverview=e},setHideNoTracksActive(e){t.hideNoTracksActive=e},setShowGridlines(e){t.showGridlines=e},addToHighlights(e){t.highlight.push(e)},setHighlight(e){t.highlight=(0,s.cast)(e)},removeHighlight(e){t.highlight.remove(e)},scrollTo(e){const r=(0,i.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=r,r},zoomTo(e,r=t.width/2,n=!1){const a=(0,i.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(a===t.bpPerPx)return a;const o=t.bpPerPx;return Math.abs(o-a)<1e-6?(console.warn("zoomTo bpPerPx rounding error"),o):(t.bpPerPx=a,this.scrollTo(Math.round((t.offsetPx+r)*o/a-(n?t.width/2:r))),a)},setOffsets(e,r){t.leftOffset=e,t.rightOffset=r},setSearchResults(e,r,n){(0,i.getSession)(t).queueDialog((a=>[Lt,{model:t,searchResults:e,searchQuery:r,handleClose:a,assemblyName:n}]))},setNewView(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip(){t.displayedRegions=(0,s.cast)([...t.displayedRegions].reverse().map((e=>({...e,reversed:!e.reversed})))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack(r,n={},a={}){const i=e.pluggableConfigSchemaType("track"),o=(0,s.resolveIdentifier)(i,(0,s.getRoot)(t),r);if(!o)throw new Error(`Could not resolve identifier "${r}"`);const l=e.getTrackType(o?.type);if(!l)throw new Error(`Unknown track type ${o.type}`);const c=e.getViewType(t.type),d=new Set(c.displayTypes.map((e=>e.name))),u=o.displays.find((e=>d.has(e.type)));if(!u)throw new Error(`Could not find a compatible display for view type ${t.type}`);const p=t.tracks.filter((e=>e.configuration===o));if(0===p.length){const e=l.stateModel.create({...n,type:o.type,configuration:o,displays:[{type:u.type,configuration:u,...a}]});return t.tracks.push(e),e}return p[0]},hideTrack(r){const n=e.pluggableConfigSchemaType("track"),a=(0,s.resolveIdentifier)(n,(0,s.getRoot)(t),r),i=t.tracks.filter((e=>e.configuration===a));return(0,f.transaction)((()=>{for(const e of i)t.tracks.remove(e)})),i.length}}))).actions((e=>({moveTrackDown(t){const r=e.tracks.findIndex((e=>e.id===t));-1!==r&&-1!==r&&r<e.tracks.length-1&&e.tracks.splice(r,2,e.tracks[r+1],e.tracks[r])},moveTrackUp(t){const r=e.tracks.findIndex((e=>e.id===t));r>0&&e.tracks.splice(r-1,2,e.tracks[r],e.tracks[r-1])},moveTrackToTop(t){const r=e.tracks.findIndex((e=>e.id===t));e.tracks=(0,s.cast)([e.tracks[r],...e.tracks.filter((e=>e.id!==t))])},moveTrackToBottom(t){const r=e.tracks.findIndex((e=>e.id===t));e.tracks=(0,s.cast)([...e.tracks.filter((e=>e.id!==t)),e.tracks[r]])},moveTrack(t,r){const n=e.tracks.findIndex((e=>e.id===t));if(-1===n)throw new Error(`Track ID ${t} not found`);const a=e.tracks.findIndex((e=>e.id===r));if(-1===a)throw new Error(`Track ID ${r} not found`);const i=e.tracks.filter(((e,t)=>t!==n));i.splice(a,0,e.tracks[n]),e.tracks=(0,s.cast)(i)},toggleTrack:t=>!e.hideTrack(t)&&(e.showTrack(t),!0),setTrackLabels(t){localStorage.setItem("lgv-trackLabels",t),e.trackLabels=t},setShowCenterLine(t){e.showCenterLine=t},setDisplayedRegions(t){e.displayedRegions=(0,s.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,i.getSession)(e);if((0,i.isSessionModelWithWidgets)(t)){const r=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(r),r}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},getSelectedRegions(t,r){const n=(0,s.getSnapshot)(e),a=Z.A.create({...n,interRegionPaddingWidth:e.interRegionPaddingWidth});return a.setVolatileWidth(e.width),a.moveTo(t,r),a.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},afterDisplayedRegionsSet(t){e.afterDisplayedRegionsSetCallbacks.push(t)},horizontalScroll(t){const r=e.offsetPx;return e.scrollTo(e.offsetPx+t)-r},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(Math.round(t-e.width/2))},showAllRegions(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly(t){const r=(0,i.getSession)(e),{assemblyManager:n}=r;if(!t){const n=new Set(e.displayedRegions.map((e=>e.assemblyName)));if(n.size>1)return void r.notify("Can't perform operation with multiple assemblies currently");[t]=[...n]}const a=n.get(t);if(a){const{regions:t}=a;t&&(this.setDisplayedRegions(t),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId(t){e.draggingTrackId=t},setScaleFactor(t){e.scaleFactor=t},clearView(){this.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setInit(t){e.init=t},async exportSvg(t={}){const{renderToSvg:n}=await Promise.resolve().then(r.bind(r,98753)),a=await n(e,t),i=new Blob([a],{type:"image/svg+xml"});(0,ue.saveAs)(i,t.filename||"image.svg")}}))).actions((e=>{let t=()=>{};return{slide:function(r){const[n,a]=(0,i.springAnimate)(e.offsetPx,e.offsetPx+e.width*r,e.scrollTo,void 0,void 0,200);t(),t=a,n()}}})).actions((e=>{let t=()=>{};return{zoom:function(r){if(e.zoomTo(e.bpPerPx),r<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||r>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)return;const n=e.bpPerPx/r,[a,o]=(0,i.springAnimate)(1,n,e.setScaleFactor,(()=>{e.zoomTo(r),e.setScaleFactor(1)}));t(),t=o,a()}}})).views((e=>({get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){const{assemblyManager:t}=(0,i.getSession)(e);return e.assemblyNames.some((e=>t.get(e)?.cytobands?.length))},get cytobandOffset(){return this.showCytobands?(0,i.measureText)(e.displayedRegions[0]?.refName||"",12)+15:0}}))).views((e=>({menuItems(){const{canShowCytobands:t,showCytobands:r}=e,n=(0,i.getSession)(e),a=[{label:"Return to import form",onClick:()=>{(0,i.getSession)(e).queueDialog((t=>[At,{model:e,handleClose:t}]))},icon:ae.A},...(0,i.isSessionWithAddTracks)(n)?[{label:"Sequence search",icon:le.A,onClick:()=>{(0,i.getSession)(e).queueDialog((t=>[Mt,{model:e,handleClose:t}]))}}]:[],{label:"Export SVG",icon:se.A,onClick:()=>{(0,i.getSession)(e).queueDialog((t=>[Pt,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:K.xU},{label:"Horizontally flip",icon:ce.A,onClick:e.horizontallyFlip},{label:"Color by CDS",type:"checkbox",checked:e.colorByCDS,icon:oe.A,onClick:()=>{e.setColorByCDS(!e.colorByCDS)}},{label:"Show...",icon:_.A,subMenu:[{label:"Show all regions in assembly",onClick:e.showAllRegionsInAssembly},{label:"Show center line",type:"checkbox",checked:e.showCenterLine,onClick:()=>{e.setShowCenterLine(!e.showCenterLine)}},{label:"Show header",type:"checkbox",checked:!e.hideHeader,onClick:()=>{e.setHideHeader(!e.hideHeader)}},{label:"Show track outlines",type:"checkbox",checked:e.showTrackOutlines,onClick:()=>{e.setShowTrackOutlines(!e.showTrackOutlines)}},{label:"Show header overview",type:"checkbox",checked:!e.hideHeaderOverview,onClick:()=>{e.setHideHeaderOverview(!e.hideHeaderOverview)},disabled:e.hideHeader},{label:"Show no tracks active button",type:"checkbox",checked:!e.hideNoTracksActive,onClick:()=>{e.setHideNoTracksActive(!e.hideNoTracksActive)}},{label:"Show guidelines",type:"checkbox",checked:e.showGridlines,onClick:()=>{e.setShowGridlines(!e.showGridlines)}},...t?[{label:"Show ideogram",type:"checkbox",checked:e.showCytobands,onClick:()=>{e.setShowCytobands(!r)}}]:[]]},{label:"Track labels",icon:ie.A,subMenu:[{label:"Overlapping",icon:_.A,type:"radio",checked:"overlapping"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("overlapping")}},{label:"Offset",icon:_.A,type:"radio",checked:"offset"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("offset")}},{label:"Hidden",icon:_.A,type:"radio",checked:"hidden"===e.trackLabelsSetting,onClick:()=>{e.setTrackLabels("hidden")}}]}];for(const[t,r]of e.trackTypeActions.entries())if(r.length){a.push({type:"divider"},{type:"subHeader",label:t});for(const e of r)a.push(e)}return a}}))).views((e=>{let t,r="";return{get staticBlocks(){const n=(0,te.A)(e),a=JSON.stringify(n);return r!==a&&(t=n,r=a),t},get dynamicBlocks(){return(0,ee.A)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},get visibleLocStrings(){return(0,Ke.H4)(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return(0,Ke.H4)(e.coarseDynamicBlocks)}}})).actions((e=>({setCoarseDynamicBlocks(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp}}))).actions((e=>({moveTo(t,r){(0,Q.tw)(e,t,r)},async navToLocString(t,r,n){const{assemblyNames:a}=e,{assemblyManager:o}=(0,i.getSession)(e),s=r||a[0];return s&&await o.waitForAssembly(s),this.navToLocations((0,Ke.CU)(t,s,((e,t)=>o.isValidRefName(e,t))),s,n)},async navToSearchString({input:t,assembly:r}){await(0,H.cm)({input:t,assembly:r,model:e})},async navToLocation(e,t,r){return this.navToLocations([e],t,r)},async navToLocations(t,r,n){const{assemblyManager:a}=(0,i.getSession)(e);await(0,f.when)((()=>void 0!==e.volatileWidth));const o=await(0,Ke.Cz)({regions:t,assemblyManager:a,assemblyName:r,grow:n});if(1===o.length){const t=o[0],{reversed:r,parentRegion:n,start:a,end:s}=t;e.setDisplayedRegions([{reversed:r,...n}]),this.navTo({...t,start:(0,i.clamp)(a??0,0,n.end),end:(0,i.clamp)(s??n.end,0,n.end)})}else e.setDisplayedRegions(o.map((e=>void 0===e.start?e.parentRegion:e))),e.showAllRegions()},navTo(e){this.navToMultiple([e])},navToMultiple(t){if(t.some((e=>void 0!==e.start&&void 0!==e.end&&e.start>e.end)))throw new Error("found start greater than end");const r=t.at(0),n=t.at(-1);if(!r||!n)return;const a=e.assemblyNames[0],{assemblyManager:o}=(0,i.getSession)(e),s=o.get(r.assemblyName||a),l=o.get(n.assemblyName||a),c=s?.getCanonicalRefName(r.refName)||r.refName,d=l?.getCanonicalRefName(n.refName)||n.refName,u=e.displayedRegions.find((e=>e.refName===c)),p=(0,i.findLast)(e.displayedRegions,(e=>e.refName===d));if(!u)throw new Error(`could not find a region with refName "${c}"`);if(!p)throw new Error(`could not find a region with refName "${d}"`);const g=void 0===r.start?u.start:r.start,h=void 0===r.end?u.end:r.end,f=void 0===n.start?p.start:n.start,m=void 0===n.end?p.end:n.end,y=e.displayedRegions.findIndex((e=>c===e.refName&&g>=e.start&&g<=e.end&&h<=e.end&&h>=e.start)),b=e.displayedRegions.findIndex((e=>d===e.refName&&f>=e.start&&f<=e.end&&m<=e.end&&m>=e.start));if(-1===y||-1===b)throw new Error(`could not find a region that contained "${t.map((e=>(0,i.assembleLocString)(e)))}"`);const w=e.displayedRegions[y],v=e.displayedRegions[b];this.moveTo({index:y,offset:w.reversed?w.end-h:g-w.start},{index:b,offset:v.reversed?v.end-f:m-v.start})}}))).views((e=>({rubberBandMenuItems:()=>[{label:"Zoom to region",icon:de.A,onClick:()=>{e.moveTo(e.leftOffset,e.rightOffset)}},{label:"Get sequence",icon:h.A,onClick:()=>{(0,i.getSession)(e).queueDialog((t=>[Rt,{model:e,handleClose:t}]))}}],bpToPx:({refName:t,coord:r,regionNumber:n})=>(0,Q.eB)({refName:t,coord:r,regionNumber:n,self:e}),centerAt(t,r,n){const a=this.bpToPx({refName:r,coord:t,regionNumber:n});void 0!==a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},pxToBp:t=>(0,Q.Ii)(e,t),get centerLineInfo(){return e.displayedRegions.length>0?this.pxToBp(e.width/2):void 0}}))).actions((e=>({afterCreate(){function t(t){(0,i.getSession)(e).focusedViewId===e.id&&(t.ctrlKey||t.metaKey)&&("ArrowLeft"===t.code?(t.preventDefault(),e.slide(-.9)):"ArrowRight"===t.code?(t.preventDefault(),e.slide(.9)):"ArrowUp"===t.code&&1===e.scaleFactor?(t.preventDefault(),e.zoom(e.bpPerPx/2)):"ArrowDown"===t.code&&1===e.scaleFactor&&(t.preventDefault(),e.zoom(2*e.bpPerPx)))}document.addEventListener("keydown",t),(0,s.addDisposer)(e,(()=>{document.removeEventListener("keydown",t)}))},afterAttach(){(0,s.addDisposer)(e,(0,f.autorun)((()=>{const{init:t}=e;t&&(e.navToLocString(t.loc,t.assembly).catch((t=>{(0,i.getSession)(e).notifyError(`${t}`,t)})),t.tracks?.map((t=>e.showTrack(t))),e.setInit(void 0))}))),(0,s.addDisposer)(e,(0,f.autorun)((()=>{e.initialized&&e.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150})),(0,s.addDisposer)(e,(0,f.autorun)((()=>{const t=e=>JSON.stringify(e),{showCytobandsSetting:r,showCenterLine:n,colorByCDS:a}=e;(0,i.localStorageSetItem)("lgv-showCytobands",t(r)),(0,i.localStorageSetItem)("lgv-showCenterLine",t(n)),(0,i.localStorageSetItem)("lgv-colorByCDS",t(a))})))}}))).preProcessSnapshot((e=>{if(!e)return e;const{highlight:t,...r}=e;return{highlight:Array.isArray(t)||void 0===t?t:[t],...r}})).postProcessSnapshot((e=>{if(e){const{init:t,...r}=e;return r}return e}))}var Ft=r(26612);class Nt extends n.A{name="LinearGenomeViewPlugin";exports={BaseLinearDisplayComponent:z,BaseLinearDisplay:P,baseLinearDisplayConfigSchema:l,SearchBox:ht,ZoomControls:Ve,LinearGenomeView:kt.default};configurationSchema=(0,a.ConfigurationSchema)("LinearGenomeViewConfigSchema",{trackLabels:{type:"string",defaultValue:"overlapping",model:s.types.enumeration("trackLabelOptions",["offset","overlapping","hidden"])}});install(e){var t;(t=e).addTrackType((()=>{const e=(e=>(0,a.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:(0,O.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(t);return new O.TrackType({name:"FeatureTrack",displayName:"Feature track",configSchema:e,stateModel:(0,O.createBaseTrackModel)(t,"FeatureTrack",e)})})),function(e){e.addTrackType((()=>{const t=(e=>(0,a.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:(0,O.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(e);return new O.TrackType({name:"BasicTrack",configSchema:t,stateModel:(0,O.createBaseTrackModel)(e,"BasicTrack",t)})}))}(e),function(e){e.addDisplayType((()=>{const t=U(e);return new O.DisplayType({name:"LinearBasicDisplay",displayName:"Basic feature display",configSchema:t,stateModel:Y(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:z})}))}(e),function(e){e.addViewType((()=>new O.ViewType({name:"LinearGenomeView",displayName:"Linear genome view",stateModel:It(e),ReactComponent:(0,c.lazy)((()=>Promise.resolve().then(r.bind(r,65193))))})))}(e),function(e){e.addDisplayType((()=>{const t=W(e);return new O.DisplayType({name:"LinearBareDisplay",configSchema:t,displayName:"Bare feature display",stateModel:$(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:z})}))}(e),function(e){e.addToExtensionPoint("LaunchView-LinearGenomeView",(async({session:e,assembly:t,loc:r,tracks:n=[],tracklist:a,nav:o,highlight:s})=>{try{const{assemblyManager:l}=e,c=e.addView("LinearGenomeView",{});if(await(0,i.when)((()=>!!c.volatileWidth)),!t)throw new Error("No assembly provided when launching linear genome view");const d=await l.waitForAssembly(t);if(!d)throw new Error(`Assembly "${t}" not found when launching linear genome view`);if(a&&c.activateTrackSelector(),void 0!==o&&c.setHideHeader(!o),void 0!==s)for(const e of s){const r=(0,i.parseLocString)(e,(e=>l.isValidRefName(e,t))),{start:n,end:a}=r;void 0!==n&&void 0!==a&&c.addToHighlights({...r,start:n,end:a,assemblyName:t})}await(0,H.cm)({input:r,model:c,assembly:d});const u=[];for(const e of n)G(c,e,u);if(u.length)throw new Error(`Could not resolve identifiers: ${u.join(",")}`)}catch(t){throw e.notifyError(`${t}`,t),t}}))}(e)}configure(e){(0,i.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:o.A,onClick:e=>{e.addView("LinearGenomeView",{})}})}}},97884:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(36422),a=r(95095),i=r(93707),o=r(88530),s=r(99546),l=r(8832);const c=n.types.model("Base1DView",{id:l.ElementId,displayedRegions:n.types.optional(n.types.frozen(),[]),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:n.types.optional(n.types.number,0),minimumBlockWidth:n.types.optional(n.types.number,0)}).volatile((()=>({features:void 0,volatileWidth:0}))).actions((e=>({setDisplayedRegions(t){e.displayedRegions=(0,n.cast)(t)},setBpPerPx(t){e.bpPerPx=t},setVolatileWidth(t){e.volatileWidth=t}}))).views((e=>({get width(){return e.volatileWidth},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return(0,s.sum)(e.displayedRegions.map((e=>e.end-e.start)))}}))).views((e=>({get dynamicBlocks(){return(0,i.A)(e)},get staticBlocks(){return(0,o.A)(e)},get currBp(){return(0,s.sum)(this.dynamicBlocks.map((e=>e.end-e.start)))}}))).views((e=>({pxToBp:t=>(0,a.Ii)(e,t),bpToPx:({refName:t,coord:r,regionNumber:n})=>(0,a.eB)({refName:t,coord:r,regionNumber:n,self:e})?.offsetPx}))).actions((e=>({setFeatures(t){e.features=t},showAllRegions(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut(){this.zoomTo(2*e.bpPerPx)},zoomIn(){this.zoomTo(e.bpPerPx/2)},zoomTo(t,r=e.width/2){const n=(0,s.clamp)(t,"minBpPerPx"in e?e.minBpPerPx:0,"maxBpPerPx"in e?e.maxBpPerPx:Number.POSITIVE_INFINITY),a=e.bpPerPx;return Math.abs(a-n)<1e-6?a:(e.bpPerPx=n,e.offsetPx=(0,s.clamp)(Math.round((e.offsetPx+r)*a/n-r),e.minOffset,e.maxOffset),e.bpPerPx)},scrollTo(t){const r=(0,s.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=r,r},centerAt(t,r,n){if(!r)return;const a=e.bpToPx({refName:r,coord:t,regionNumber:n});a&&this.scrollTo(Math.round(a-e.width/2))},scroll(t){const r=e.offsetPx,n=(0,s.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=n,n-r}}))).actions((e=>({moveTo(t,r){(0,a.tw)(e,t,r)}})))},98111:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(92880),a=r(31415),i=r(68584),o=r(99546),s=r(75762);class l extends n.default{layoutSessions={};createLayoutSession(e){return new a.h(e)}getLayoutSession(e){return this.layoutSessions[(0,o.getLayoutId)(e)]}getWorkerSession(e){const t=(0,o.getLayoutId)(e);return this.layoutSessions[t]||(this.layoutSessions[t]=this.createLayoutSession(e)),this.layoutSessions[t].update(e)}getExpandedRegion(e,t){const{bpPerPx:r,config:n}=t,a=(0,i.readConfObject)(n,"maxFeatureGlyphExpansion")||0,o=Math.round(a*r);return{...e,start:Math.floor(Math.max(e.start-o,0)),end:Math.ceil(e.end+o)}}freeResources(e){this.freeResourcesInWorker(e)}freeResourcesInWorker(e){const{regions:t}=e,r=(0,o.getLayoutId)(e),n=this.layoutSessions[r];if(n){const e=t[0];n.layout.discardRange(e.refName,e.start,e.end)}}async freeResourcesInClient(e,t){const{regions:r}=t,n=(0,o.getLayoutId)(t),a=this.layoutSessions[n];if(a){const e=r[0];a.layout.discardRange(e.refName,e.start,e.end)}return super.freeResourcesInClient(e,t)}deserializeLayoutInClient(e){return new s.A(e)}deserializeResultsInClient(e,t){const r=this.deserializeLayoutInClient(e.layout);return super.deserializeResultsInClient({...e,layout:r},t)}createLayoutInWorker(e){const{regions:t}=e,{layout:r}=this.getWorkerSession(e);return r.getSublayout(t[0].refName)}serializeResultsInWorker(e,t){const{features:r,...n}=super.serializeResultsInWorker(e,t),a=t.regions[0],i=e.layout.serializeRegion(this.getExpandedRegion(a,t));return{...n,layout:i,maxHeightReached:i.maxHeightReached,features:void 0!==i.rectangles?r.filter((e=>!!i.rectangles[e.uniqueId])):r}}async render(e){const t=e.layout||this.createLayoutInWorker(e);return{...await super.render({...e,layout:t}),layout:t}}}},98506:(e,t,r)=>{"use strict";r.d(t,{Jy:()=>c,aE:()=>d,u1:()=>l});var n=r(7552),a=r(13862),i=r(31673),o=r(18010),s=r(69500);async function l(e,t,r,n){const{exportSVG:l,highResolutionScaling:c=1}=r;if(l){if(l.rasterizeLayers){const r=l.scale||c,a=(0,o.Nw)(Math.ceil(e*r),t*r),d=a.getContext("2d");if(!d)throw new Error("2d canvas rendering not supported on this platform");return d.scale(r,r),{...await n(d),reactElement:(0,s.jsx)("image",{width:e,height:t,xlinkHref:"convertToBlob"in a?await(0,i.y)(await a.convertToBlob({type:"image/png"})):a.toDataURL("image/png")})}}{const e=new a.CanvasSequence;return{...await n(e),canvasRecordedData:e.toJSON()}}}{const r=c,a=(0,o.Nw)(Math.ceil(e*r),t*r),i=a.getContext("2d");if(!i)throw new Error("2d canvas rendering not supported on this platform");return i.scale(r,r),{...await n(i),imageData:await(0,o.T9)(a)}}}async function c(e){const{width:t,height:n,canvasRecordedData:i}=e,o=new((await r.e(3109).then(r.t.bind(r,63109,23))).default)(t,n);return new a.CanvasSequence(i).execute(o),o.getSvg().innerHTML}function d({rendering:e}){return(0,n.isValidElement)(e.reactElement)?e.reactElement:(0,s.jsx)("g",{dangerouslySetInnerHTML:{__html:e.html||""}})}},98753:(e,t,r)=>{"use strict";r.d(t,{$:()=>f,z:()=>C,renderToSvg:()=>k});var n=r(67112),a=r(99546),i=r(91468),o=r(91063),s=r(42489),l=r(51414),c=r(69500);function d({width:e,height:t,shift:r}){const n=(0,l.A)();return(0,c.jsx)("rect",{width:e+2*r,height:t,fill:(0,a.stripAlpha)(n.palette.background.default)})}var u=r(97884),p=r(27703);function g({model:e,height:t}){const{dynamicBlocks:r,offsetPx:n,interRegionPaddingWidth:a}=e;return(0,c.jsx)(c.Fragment,{children:r.contentBlocks.slice(1).map((e=>(0,c.jsx)("rect",{x:e.offsetPx-n-a,width:a,y:0,height:t,fill:"grey"},e.key)))})}function h({start:e,end:t,bpPerPx:r,reversed:n=!1,major:i=!0,minor:o=!0,hideText:s=!1}){const d=(0,p.H2)(e,t,r,i,o),u=(0,l.A)(),g=(0,a.stripAlpha)(u.palette.text.secondary);return(0,c.jsxs)(c.Fragment,{children:[d.map((a=>{const i=(n?t-a.base:a.base-e)/r;return(0,c.jsx)("line",{x1:i,x2:i,y1:0,y2:"major"===a.type?6:4,strokeWidth:1,stroke:g},`tick-${a.base}`)})),s?null:d.filter((e=>"major"===e.type)).map((i=>{const o=(n?t-i.base:i.base-e)/r;return(0,c.jsx)("text",{x:o-3,y:18,fontSize:11,fill:g,children:(0,a.getTickDisplayStr)(i.base+1,r)},`label-${i.base}`)}))]})}function f({model:e,fontSize:t}){const{dynamicBlocks:{contentBlocks:r},offsetPx:n,bpPerPx:i}=e,o=r.length<5,s=(0,l.A)(),d=(0,a.stripAlpha)(s.palette.text.primary);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(g,{model:e,height:30}),r.map((e=>{const{start:r,end:a,key:s,reversed:l,offsetPx:u,refName:p,widthPx:g}=e,f=u-n,m=`clip-${s}`;return(0,c.jsxs)("g",{children:[(0,c.jsx)("defs",{children:(0,c.jsx)("clipPath",{id:m,children:(0,c.jsx)("rect",{x:0,y:0,width:g,height:100})})}),(0,c.jsx)("g",{transform:`translate(${f} 0)`,children:(0,c.jsxs)("g",{clipPath:`url(#${m})`,children:[(0,c.jsx)("text",{x:4,y:t,fontSize:t,fill:d,children:p}),(0,c.jsx)("g",{transform:"translate(0 20)",children:(0,c.jsx)(h,{hideText:!o,start:r,end:a,bpPerPx:i,reversed:l})})]})})]},s)}))]})}function m({model:e,fontSize:t}){const{offsetPx:r,dynamicBlocks:{totalWidthPxWithoutBorders:n,totalBp:i}}=e,o=(0,l.A)(),s=(0,a.getBpDisplayStr)(i),d=Math.max(-r,0),u=d+n,p=(0,a.stripAlpha)(o.palette.text.secondary),g=d+(u-d)/2,h=t;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("line",{x1:d,x2:u,y1:10,y2:10,stroke:p}),(0,c.jsx)("line",{x1:d,x2:d,y1:5,y2:15,stroke:p}),(0,c.jsx)("line",{x1:u,x2:u,y1:5,y2:15,stroke:p}),(0,c.jsx)("text",{x:g,y:h,textAnchor:"middle",dominantBaseline:"hanging",fontSize:t,fill:p,children:s})]})}var y=r(84481),b=r(32474),w=r(76239);function v({model:e,fontSize:t,cytobandHeight:r,rulerHeight:n}){const{width:i,assemblyNames:o,showCytobands:s,displayedRegions:d}=e,{assemblyManager:p}=(0,a.getSession)(e),g=o.length>1?"":o[0],h=p.get(g),v=(0,l.A)(),S=(0,a.stripAlpha)(v.palette.text.primary),C=u.A.create({displayedRegions:JSON.parse(JSON.stringify(d)),interRegionPaddingWidth:0,minimumBlockWidth:e.minimumBlockWidth}),x=e.dynamicBlocks.contentBlocks;if(!x.length)return null;C.setVolatileWidth(i),C.showAllRegions();const k=C.dynamicBlocks.contentBlocks[0],T=x.at(0),A=x.at(-1),M=C.bpToPx({...T,coord:T.reversed?T.end:T.start})||0,P=C.bpToPx({...A,coord:A.reversed?A.start:A.end})||0,R=+s*r;return(0,c.jsxs)("g",{id:"header",children:[(0,c.jsx)("text",{x:0,y:0,dominantBaseline:"hanging",fontSize:t,fill:S,children:g}),s?(0,c.jsxs)("g",{transform:`translate(0 ${n})`,children:[(0,c.jsx)(y.A,{overview:C,assembly:h,block:k}),(0,c.jsx)("rect",{stroke:"red",fill:"rgb(255,0,0)",fillOpacity:.1,width:Math.max(P-M,.5),height:w.Gu-1,x:M,y:.5}),(0,c.jsx)("g",{transform:`translate(0,${w.Gu})`,children:(0,c.jsx)(b.A,{overview:C,model:e,useOffset:!1})})]}):null,(0,c.jsx)("g",{transform:`translate(0 ${t+R})`,children:(0,c.jsx)(m,{model:e,fontSize:t})}),(0,c.jsx)("g",{transform:`translate(0 ${n+R})`,children:(0,c.jsx)(f,{model:e,fontSize:t})})]})}function S({trackLabels:e,trackName:t,fontSize:r,trackLabelOffset:n,x:i}){const o=(0,l.A)(),s=(0,a.stripAlpha)(o.palette.text.primary),d="overlay"===e?5:0,u="offset"===e?5:0,p=(0,a.coarseStripHTML)(t);return"none"!==e?(0,c.jsx)("g",{children:"left"===e?(0,c.jsx)("text",{x:n-40,y:20,fill:s,fontSize:r,dominantBaseline:"hanging",textAnchor:"end",children:p}):(0,c.jsx)("text",{x:i+d,y:u,fill:s,fontSize:r,dominantBaseline:"hanging",children:p})}):null}function C({displayResults:e,model:t,textHeight:r,fontSize:n,trackLabels:o="offset",trackLabelOffset:s=0}){const l=(0,a.getSession)(t),d="offset"===o?r:0;return(0,c.jsx)(c.Fragment,{children:e.reduce((({prevOffset:e,reactElements:r},{track:a,result:u})=>{const p=a.configuration,h=(0,i.getTrackName)(p,l),f=a.displays[0],m=Math.max(-t.offsetPx,0);return{prevOffset:e+f.height+d,reactElements:[...r,(0,c.jsxs)("g",{transform:`translate(0 ${e})`,children:[(0,c.jsxs)("g",{transform:`translate(${s} ${d})`,children:[(0,c.jsx)(g,{model:t,height:f.height}),u]}),(0,c.jsx)(S,{trackName:h,fontSize:n,trackLabels:o,trackLabelOffset:s,x:m})]},p.trackId)]}}),{prevOffset:0,reactElements:[]}).reactElements})}var x=r(26612);async function k(e,t){await(0,s.when)((()=>e.initialized));const{textHeight:r=18,headerHeight:l=40,rulerHeight:u=50,fontSize:p=13,cytobandHeight:g=100,trackLabels:h="offset",themeName:f="default",Wrapper:m=({children:e})=>e}=t,y=(0,a.getSession)(e),{allThemes:b}=y,w=b?.()[f],{width:S,pinnedTracks:k,unpinnedTracks:T,tracks:A,showCytobands:M}=e,P=l+u+ +M*g+10,R=(0,x.m)(A,r,h)+P+100,L=await Promise.all([...k,...T].map((async e=>{const r=e.displays[0];return await(0,s.when)((()=>!r.renderProps().notReady)),{track:e,result:await r.renderSvg({...t,theme:w})}}))),I=(0,a.max)(A.map((e=>(0,a.measureText)((0,i.getTrackName)(e.configuration,y),p))),0)+40,F="left"===h?I:0,N=S+F;return(0,a.renderToStaticMarkup)((0,c.jsx)(o.A,{theme:(0,n.createJBrowseTheme)(w),children:(0,c.jsx)(m,{children:(0,c.jsxs)("svg",{width:N,height:R,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,N+100,R].toString(),children:[(0,c.jsx)(d,{width:N,height:R,shift:50}),(0,c.jsxs)("g",{transform:"translate(50 0)",children:[(0,c.jsx)("g",{transform:`translate(${F})`,children:(0,c.jsx)(v,{model:e,fontSize:p,rulerHeight:u,cytobandHeight:g})}),(0,c.jsx)("g",{transform:`translate(0 ${P})`,children:(0,c.jsx)(C,{textHeight:r,fontSize:p,model:e,displayResults:L,trackLabels:h,trackLabelOffset:F})})]})]})})}))}},98911:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(68584),a=r(99546),i=r(97486),o=r(68446),s=r(90461),l=r(69500);const c=(0,o.observer)((function(e){const{model:t}=e,{stats:r,height:o,graphType:c}=t,{trackLabels:d}=(0,a.getContainingView)(t),u=(0,a.getContainingTrack)(t);return(0,l.jsxs)("div",{children:[(0,l.jsx)(i.GQ,{...e}),r&&c?(0,l.jsx)("svg",{style:{position:"absolute",top:0,left:"overlapping"===d?(0,a.measureText)((0,n.getConf)(u,"name"),12.8)+100:50,pointerEvents:"none",height:o,width:50},children:(0,l.jsx)(s.A,{model:t})}):null]})}))},99412:(e,t,r)=>{"use strict";r.d(t,{D:()=>o});var n=r(99546),a=r(91468),i=r(36422);async function o({model:e,adapterConfig:t,blocks:r,opts:o}){const{rpcManager:s}=(0,n.getSession)(e),l=(0,a.getRpcSessionId)(e);return await s.call(l,"PileupGetVisibleModifications",{adapterConfig:t,sessionId:l,regions:r.contentBlocks,statusCallback:t=>{(0,i.isAlive)(e)&&e.setMessage(t)},...o})}},99834:(e,t,r)=>{"use strict";r.r(t),r.d(t,{RemoteFileWithRangeCache:()=>c,getFetcher:()=>f,openLocation:()=>h,resolveUriLocation:()=>g});var n=r(70777),a=r.n(n),i=r(44688),o=r(1520);const s={},l=new o.j({fetch:function(e,t,r,n={}){const a=s[e];if(!a)throw new Error(`fetch not registered for ${e}`);return a(e,t,r,n)},size:524288e3,chunkSize:131072,maxFetchSize:104857600,minimumTTL:864e5});class c extends i.Tx{async fetch(e,t){const r=String(e);s[r]||(s[r]=this.fetchBinaryRange.bind(this));const n=new Headers(t?.headers).get("range");if(n){const t=/bytes=(\d+)-(\d+)/.exec(n);if(t){const[,r,n]=t,a=Number.parseInt(r,10),i=Number.parseInt(n,10)-a,{buffer:o,headers:s}=await l.getRange(`${e}`,a,i+1);return new Response(o,{status:206,headers:s})}}return super.fetch(e,t)}async fetchBinaryRange(e,t,r,n={}){const a=new Date,i=await super.fetch(e,{...n,headers:{...n.headers,range:`bytes=${t}-${r}`}}),o=new Date;if(!i.ok){const n=`HTTP ${i.status} fetching ${e} bytes ${t}-${r}`,a=" (should be 206 for range requests)";throw new Error(`${n}${200===i.status?a:""}`)}const s={};for(const[e,t]of i.headers.entries())s[e]=t;const l=await i.arrayBuffer();return{headers:s,requestDate:a,responseDate:o,buffer:new Uint8Array(l)}}}var d=r(99546),u=r(91468),p=r(92516);function g(e){return e.baseUri?{...e,uri:new URL(e.uri,e.baseUri).href}:e}function h(e,t){if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(a()||d.isElectron)return new i.EY(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){const t=(0,u.getBlob)(e.blobId);if(!t)throw new Error(`file ("${e.name}") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);return new i.Ki(t)}if((0,p.C1)(e)){if(!e.uri)throw new Error("No URI provided");const r=g(e);if(t){const n=m(e,t);if(n)return n.openLocation(r)}return new c(r.uri,{fetch:y})}throw new Error("invalid fileLocation")}function f(e,t){if(!(0,p.C1)(e))throw new Error(`Not a valid UriLocation: ${JSON.stringify(e)}`);if(t){const r=m(e,t);if(r)return r.getFetcher(e)}return y}function m(e,t){const{rootModel:r}=t;if(r&&(0,p.lL)(r))return r.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}async function y(e,t){const r=await fetch(e,t);if(401===r.status&&r.headers.get("WWW-Authenticate")?.includes("Basic"))throw new p._u("Accessing HTTPBasic resource without authentication",e.toString());return r}}}]);
//# sourceMappingURL=9945.82ab3251.chunk.js.map