"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8982],{8982(t,e,a){a.d(e,{executeRenderLinearReadCloudDisplay:()=>S});var s=a(95548),i=a(23886),n=a(1259),o=a(40907),r=a(23638),c=a(89147),l=a(64152),d=a(31508),h=a(29458),u=a(10533),g=a(88068),f=a(90013),p=a(64833),m=a(57385),w=a(8655);function b(t,e,a,s){const i=new w.A({featureHeight:e,spacing:a?0:2,maxHeight:s}),n=new Map;for(const{id:a,minX:s,maxX:o}of t){const t=i.addRect(a,s,o,e);null!==t&&n.set(a,t)}return{chainYOffsets:n,layoutHeight:i.getTotalHeight()}}var x=a(19996);async function S({pluginManager:t,args:e}){const{sessionId:a,view:w,adapterConfig:S,sequenceAdapter:k,config:y,theme:C,featureHeight:M,noSpacing:P,drawCloud:v,colorBy:H,drawSingletons:B,drawProperPairs:R,flipStrandLongReadChains:A,trackMaxHeight:F,cloudModeHeight:I,highResolutionScaling:N,exportSVG:L,statusCallback:O=()=>{},stopToken:T,visibleModifications:_,hideSmallIndels:q,hideMismatches:W,hideLargeIndels:j,showOutline:D}=e,V=(0,h.jL)(T),X=l.A.create(w);w.width&&X.setVolatileWidth(w.width);const{bpPerPx:Y,offsetPx:E}=X,G=X.staticBlocks.totalWidthPx,$=X.staticBlocks.contentBlocks;if(!X.assemblyNames[0])throw new Error("No assembly name found in view");const z={...(0,u.getSnapshot)(X),width:X.width,staticBlocks:X.staticBlocks,bpToPx(t){const e=(0,c.eB)({self:this,refName:t.refName,coord:t.coord});return void 0!==e?{offsetPx:e.offsetPx,index:e.index}:void 0}},K=(await(0,s.cK)(t,a,S)).dataAdapter;k&&!K.sequenceAdapterConfig&&K.setSequenceAdapterConfig(k);const Q=await(0,i.updateStatus)("Fetching alignments",O,()=>(0,g._)(K.getFeaturesInMultipleRegions($,e).pipe((0,f.$)())));(0,h.As)(V);const Z=(0,n.Q)(Q,t=>t.id()),{chains:J,stats:U}=await(0,i.updateStatus)("Processing alignments",O,async()=>{const t=[];for(const e of Z){const a=e.get("flags");if(2&a&&!(256&a)&&!(2048&a)){const a=e.get("template_length");0===a||Number.isNaN(a)||t.push(Math.abs(a))}}let e;return t.length>0&&(e={...(0,x.W)(t),max:(0,i.max)(t),min:(0,i.min)(t)}),{chains:Object.values((0,i.groupBy)(Z,t=>t.get("name"))),stats:e}}),tt={chains:J,stats:U};(0,h.As)(V);const{computedChains:et}=await(0,i.updateStatus)("Calculating layout",O,async()=>{const t=(0,m.$B)(J,B,R,H.type||"insertSizeAndOrientation",tt),e=(0,m.wi)(t,z);return(0,m.ie)(e),{filteredChains:t,computedChains:e}});let at;if(v){if(void 0===I)throw new Error("cloudModeHeight is required when drawCloud is true");at=I}else at=b(et,M,P,F??1200).layoutHeight;const st={highResolutionScaling:N,exportSVG:L},it=await(0,i.updateStatus)("Rendering alignments",O,()=>(0,o.u)(G,at,st,async t=>{const{layoutHeight:e,cloudMaxDistance:a,featuresForFlatbush:s,mismatchFlatbush:i,mismatchItems:n}=(0,m.ZR)({ctx:t,params:{chainData:tt,featureHeight:M,canvasWidth:G,noSpacing:P,colorBy:H,drawSingletons:B,drawProperPairs:R,flipStrandLongReadChains:A,trackMaxHeight:F,config:y,theme:C,regions:$,bpPerPx:Y,stopTokenCheck:V,visibleModifications:_,hideSmallIndels:q,hideMismatches:W,hideLargeIndels:j,showOutline:D},view:z,calculateYOffsets:t=>v?(0,p.VY)(t,at):b(t,M,P,F??1200)});return{layoutHeight:e,cloudMaxDistance:a,featuresForFlatbush:s,mismatchFlatbush:i,mismatchItems:n}})),nt={...it,offsetPx:E};return(0,d.lk)(nt,(0,r.X)(it))}},19996(t,e,a){a.d(e,{W:()=>i});var s=a(23886);function i(t){const e=t.length,a=(0,s.sum)(t);let i=0;for(let a=0;a<e;a++){const e=t[a];i+=e*e}const n=a/e,o=Math.sqrt((e*i-a*a)/(e*e));return{upper:n+3*o,lower:n-3*o,avg:n,sd:o}}}}]);
//# sourceMappingURL=8982.09f6ca91.chunk.js.map