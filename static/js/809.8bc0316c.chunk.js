"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[809],{5690:(e,t,s)=>{s.d(t,{A:()=>m});var n=s(7552),i=s(93878),l=s(75100),o=s(80317),a=s(21928),r=s(50864),c=s(69112),d=s(69500);const h=(0,o.Ay)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,!s.disableGutters&&t.gutters,t[s.variant]]}})((0,a.A)((({theme:e})=>({position:"relative",display:"flex",alignItems:"center",variants:[{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}}},{props:{variant:"dense"},style:{minHeight:48}},{props:{variant:"regular"},style:e.mixins.toolbar}]})))),m=n.forwardRef((function(e,t){const s=(0,r.b)({props:e,name:"MuiToolbar"}),{className:n,component:o="div",disableGutters:a=!1,variant:m="regular",...u}=s,p={...s,component:o,disableGutters:a,variant:m},f=(e=>{const{classes:t,disableGutters:s,variant:n}=e,i={root:["root",!s&&"gutters",n]};return(0,l.A)(i,c.U,t)})(p);return(0,d.jsx)(h,{as:o,className:(0,i.A)(f.root,n),ref:t,ownerState:p,...u})}))},11158:(e,t,s)=>{s.r(t),s.d(t,{default:()=>E});var n=s(67112),i=s(76218),l=s(68446),o=s(13476),a=s(75785),r=s(7552),c=s(99546),d=s(18423),h=s(8193),m=s(71098),u=s(37962),p=s(89870),f=s(91818),g=s(61282),x=s(21049),w=s(69500);const v=(0,a.n9)()((e=>({facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}})));function j({onClick:e}){return(0,w.jsx)(u.A,{title:"Clear selection on this facet filter",children:(0,w.jsx)(p.A,{onClick:()=>{e()},size:"small",children:(0,w.jsx)(h.A,{})})})}function b({visible:e,onClick:t}){return(0,w.jsx)(u.A,{title:"Minimize/expand this facet filter",children:(0,w.jsx)(p.A,{onClick:()=>{t()},size:"small",children:e?(0,w.jsx)(m.A,{}):(0,w.jsx)(d.A,{})})})}const k=(0,l.observer)((function({column:e,vals:t,model:s}){const{classes:n}=v(),[i,l]=(0,r.useState)(!0),{faceted:o}=s,{filters:a}=o,{field:d}=e;return(0,w.jsxs)(f.A,{className:n.facet,fullWidth:!0,children:[(0,w.jsxs)("div",{children:[(0,w.jsx)(g.A,{component:"span",children:d}),(0,w.jsx)(j,{onClick:()=>{o.setFilter(d,[])}}),(0,w.jsx)(b,{visible:i,onClick:()=>{l(!i)}})]}),i?(0,w.jsx)(x.A,{multiple:!0,native:!0,className:n.select,value:a.get(e.field)||[],onChange:t=>{o.setFilter(e.field,[...t.target.options].filter((e=>e.selected)).map((e=>e.value)))},children:t.sort(((e,t)=>e[0].localeCompare(t[0]))).map((([e,t])=>(0,w.jsxs)("option",{value:e,children:[(0,c.coarseStripHTML)(e)," (",t,")"]},e)))}):null]})}));var C=s(6842);const A=(0,l.observer)((function({rows:e,columns:t,model:s}){const{faceted:n}=s,{filters:i}=n,l=t.slice(1),o=new Map(t.slice(1).map((e=>[e.field,new Map]))),a=n.filters.keys(),r=l.map((e=>e.field)),c=new Set;for(const e of a)i.get(e)?.length&&c.add(e);for(const e of r)c.add(e);let d=e;for(const e of c){const t=o.get(e);if(t)for(const s of d){const n=(0,C.a)(e,s),i=t.get(n);n&&(void 0===i?t.set(n,1):t.set(n,i+1))}const s=i.get(e)?.length?new Set(i.get(e)):void 0;d=d.filter((t=>void 0===s||s.has((0,C.a)(e,t))))}return(0,w.jsx)("div",{children:l.map((e=>(0,w.jsx)(k,{vals:[...o.get(e.field)],column:e,model:s},e.field)))})}));var S=s(46275),y=s(42489),M=s(36422);const T=(0,l.observer)((function({model:e,columns:t,shownTrackIds:s,selection:n}){const{pluginManager:i}=(0,c.getEnv)(e),{view:l,faceted:o}=e,{rows:a,useShoppingCart:d,showOptions:h,filteredRows:m,filteredNonMetadataKeys:u,filteredMetadataKeys:p,visible:f}=o,[g,x]=(0,r.useState)({name:(0,c.measureGridWidth)(a.map((e=>e.name)),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(u.filter((e=>f[e])).map((e=>[e,(0,c.measureGridWidth)(a.map((t=>t[e])),{maxWidth:400,stripHTML:!0})]))),...Object.fromEntries(p.filter((e=>f[`metadata.${e}`])).map((e=>[`metadata.${e}`,(0,c.measureGridWidth)(a.map((t=>t.metadata[e])),{maxWidth:400,stripHTML:!0})])))});return(0,w.jsx)(S.z,{rowHeight:25,columnHeaderHeight:35,checkboxSelection:!0,keepNonExistentRowsSelected:!0,rows:m,columnVisibilityModel:f,showToolbar:h,onColumnWidthChange:e=>{x({...g,[e.colDef.field]:e.width})},onColumnVisibilityModelChange:t=>{e.faceted.setVisible(t)},onRowSelectionModelChange:t=>{if(d){const s=(0,M.getRoot)(e),n=i.pluggableConfigSchemaType("track");e.setSelection([...t.ids].map((e=>(0,M.resolveIdentifier)(n,s,e))))}else{const n=s,i=t.ids;(0,y.transaction)((()=>{[...n].filter((e=>!i.has(e))).map((e=>l.hideTrack(e))),[...i].filter((e=>!n.has(e))).map((t=>{l.showTrack(t),e.addToRecentlyUsed(t)}))}))}},rowSelectionModel:{type:"include",ids:new Set(d?n.map((e=>e.trackId)):[...s])},columns:t.map((e=>({...e,width:g[e.field]})))})}));var H=s(2020),W=s(92826),N=s(93062),F=s(33896),R=s(9469);function I({model:e}){const{faceted:t}=e,[s,i]=(0,r.useState)(null),{showOptions:l,showFilters:o,showSparse:a,useShoppingCart:c}=t;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(W.A,{container:!0,spacing:4,alignItems:"center",children:[(0,w.jsx)(N.A,{label:"Search...",value:t.filterText,onChange:e=>{t.setFilterText(e.target.value)},slotProps:{input:{endAdornment:(0,w.jsx)(F.A,{position:"end",children:(0,w.jsx)(p.A,{onClick:()=>{t.setFilterText("")},children:(0,w.jsx)(h.A,{})})})}}}),(0,w.jsx)(p.A,{onClick:e=>{i(e.currentTarget)},children:(0,w.jsx)(H.A,{})}),(0,w.jsx)(R.A,{model:e})]}),(0,w.jsx)(n.Menu,{anchorEl:s,open:!!s,onClose:()=>{i(null)},onMenuItemClick:(e,t)=>{t(),i(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{t.setUseShoppingCart(!c)},type:"checkbox",checked:c},{label:"Show sparse metadata columns",onClick:()=>{t.setShowSparse(!a)},checked:a,type:"checkbox"},{label:"Show facet filters",onClick:()=>{t.setShowFilters(!o)},checked:o,type:"checkbox"},{label:"Show extra table options",onClick:()=>{t.setShowOptions(!l)},checked:l,type:"checkbox"}]})]})}var G=s(26027);const L=(0,a.n9)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),z=.75,O=(0,l.observer)((function({model:e}){const{classes:t}=L(),{selection:s,shownTrackIds:i,faceted:l}=e,{rows:a,panelWidth:r,showFilters:c,filteredNonMetadataKeys:d,filteredMetadataKeys:h}=l,m=[{field:"name",hideable:!1,renderCell:s=>{const{value:n,row:i}=s,{id:l,conf:a}=i;return(0,w.jsxs)("div",{className:t.cell,children:[(0,w.jsx)(o.A,{html:n}),(0,w.jsx)(G.A,{id:l,conf:a,trackId:l,model:e})]})}},...d.map((e=>({field:e,renderCell:e=>{const s=e.value;return s?(0,w.jsx)(o.A,{className:t.cell,html:s}):""}}))),...h.map((e=>({field:`metadata.${e}`,headerName:["name",...d].includes(e)?`${e} (from metadata)`:e,valueGetter:(t,s)=>`${s.metadata[e]??""}`,renderCell:e=>{const s=e.value;return s?(0,w.jsx)(o.A,{className:t.cell,html:s}):""}})))];return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(I,{model:e}),(0,w.jsxs)("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*z,width:window.innerWidth*z},children:[(0,w.jsx)("div",{style:{height:window.innerHeight*z,width:window.innerWidth*z-(c?r:0)},children:(0,w.jsx)(T,{model:e,columns:m,shownTrackIds:i,selection:s})}),c?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(n.ResizeHandle,{vertical:!0,onDrag:e=>l.setPanelWidth(r-e),className:t.resizeHandle}),(0,w.jsx)("div",{style:{width:r,overflow:"auto"},children:(0,w.jsx)(A,{model:e,rows:a,columns:m})})]}):null]})]})})),E=(0,l.observer)((function(e){const{handleClose:t}=e;return(0,w.jsx)(n.Dialog,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector",children:(0,w.jsx)(i.A,{children:(0,w.jsx)(O,{...e})})})}))},69112:(e,t,s)=>{s.d(t,{A:()=>o,U:()=>l});var n=s(51062),i=s(2958);function l(e){return(0,i.Ay)("MuiToolbar",e)}const o=(0,n.A)("MuiToolbar",["root","gutters","regular","dense"])}}]);
//# sourceMappingURL=809.8bc0316c.chunk.js.map