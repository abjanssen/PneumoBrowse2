"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1853,3046,7258],{3046(e,t,n){n.r(t),n.d(t,{default:()=>y});var r=n(30936),s=n(42918),o=n(71547),i=n(77251),a=n(10525),l=n(57141),c=n(10070),d=n(64074),u=n(81325),h=n(89198),f=n(15391),m=n(86470),x=n(32118);function p(e){const t=(0,r.c)(26),{hoveredFeatureData:n,hasSupplementary:s,mousePosition:a}=e;let l;t[0]!==n?(l=function(e){switch((0,f.en)({type:"insertSizeAndOrientation",f:{refName:e.refName,next_ref:e.next_ref,pair_orientation:e.pair_orientation,tlen:e.tlen,flags:e.flags}})){case f.J8.LONG_INSERT:return"Long insert size (colored red)";case f.J8.SHORT_INSERT:return"Short insert size (colored blue)";case f.J8.INTER_CHROM:return e.next_ref?`Inter-chromosomal (mate on ${e.next_ref})`:void 0;case f.J8.UNMAPPED_MATE:return"Unmapped mate";case f.J8.ABNORMAL_ORIENTATION:{const t=m.il.fr[e.pair_orientation||""]||"";return"RR"===t?"Both mates reverse strand":"RL"===t?"Outward facing pair":"LL"===t?"Both mates forward strand":`Abnormal orientation ${e.pair_orientation||""}`}default:return}}(n),t[0]=n,t[1]=l):l=t[1];const c=l,d=a.y+20;let u,h,p,g,b,v,j,y,w;return t[2]!==a.x||t[3]!==d?(u={x:a.x,y:d},t[2]=a.x,t[3]=d,t[4]=u):u=t[4],t[5]!==n.name?(h=(0,x.jsx)("div",{children:(0,x.jsx)("strong",{children:n.name})}),t[5]=n.name,t[6]=h):h=t[6],t[7]!==n?(p=(0,i.assembleLocString)(n),t[7]=n,t[8]=p):p=t[8],t[9]!==p?(g=(0,x.jsx)("div",{children:p}),t[9]=p,t[10]=g):g=t[10],t[11]!==n.tlen?(b=0!==n.tlen?(0,x.jsxs)("div",{children:["Template length: ",(0,i.toLocale)(n.tlen)]}):null,t[11]=n.tlen,t[12]=b):b=t[12],t[13]!==c?(v=c?(0,x.jsx)("div",{children:c}):null,t[13]=c,t[14]=v):v=t[14],t[15]!==s?(j=s?(0,x.jsx)("div",{children:"Has supplementary/split alignments"}):null,t[15]=s,t[16]=j):j=t[16],t[17]!==h||t[18]!==g||t[19]!==b||t[20]!==v||t[21]!==j?(y=(0,x.jsxs)("div",{children:[h,g,b,v,j]}),t[17]=h,t[18]=g,t[19]=b,t[20]=v,t[21]=j,t[22]=y):y=t[22],t[23]!==y||t[24]!==u?(w=(0,x.jsx)(o.A,{clientPoint:u,placement:"bottom-start",children:y}),t[23]=y,t[24]=u,t[25]=w):w=t[25],w}function g(e){const t=(0,r.c)(17),{mismatchData:n,mousePosition:s}=e,a=s.y+20;let l,c,d;t[0]!==s.x||t[1]!==a?(l={x:s.x,y:a},t[0]=s.x,t[1]=a,t[2]=l):l=t[2],t[3]!==n?(c=(0,h.F)(n),t[3]=n,t[4]=c):c=t[4],t[5]!==c?(d=(0,x.jsx)("div",{children:c}),t[5]=c,t[6]=d):d=t[6];const u=n.start+1;let f,m,p,g;return t[7]!==u?(f=(0,i.toLocale)(u),t[7]=u,t[8]=f):f=t[8],t[9]!==f?(m=(0,x.jsxs)("div",{children:["Position: ",f]}),t[9]=f,t[10]=m):m=t[10],t[11]!==d||t[12]!==m?(p=(0,x.jsxs)("div",{children:[d,m]}),t[11]=d,t[12]=m,t[13]=p):p=t[13],t[14]!==l||t[15]!==p?(g=(0,x.jsx)(o.A,{clientPoint:l,placement:"bottom-start",children:p}),t[14]=l,t[15]=p,t[16]=g):g=t[16],g}const b=(0,d.observer)(function({selectedFeatureBounds:e,hoveredFeature:t}){return(0,x.jsxs)(x.Fragment,{children:[e?(0,x.jsx)("div",{style:{position:"absolute",left:e.x,top:e.y,width:e.width,height:e.height,border:"2px solid #00b8ff",boxSizing:"border-box",pointerEvents:"none"}}):null,t?(0,x.jsx)("div",{style:{position:"absolute",left:t.x,top:t.y,width:t.width,height:t.height,backgroundColor:"rgba(0, 0, 0, 0.2)",pointerEvents:"none"}}):null]})}),v=(0,d.observer)(function({model:e,width:t,height:n}){const r=(0,s.useCallback)(t=>{e.setRef(t)},[e,t,n]),o=(0,s.useCallback)(t=>{e.setMouseoverRef(t)},[e,t,n]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("canvas",{"data-testid":e.dataTestId,ref:r,style:{width:t,height:n,position:"absolute",left:0,top:0},width:2*t,height:2*n}),(0,x.jsx)("canvas",{"data-testid":"cloud-mouseover-canvas",ref:o,style:{width:t,height:n,position:"absolute",left:0,top:0,pointerEvents:"none"},width:2*t,height:2*n})]})}),j=(0,d.observer)(function({model:e}){const t=(0,i.getContainingView)(e),n=Math.round(t.dynamicBlocks.totalWidthPx),r=e.drawCloud?e.height:e.layoutHeight,o=(0,s.useRef)(null),[c,d]=(0,s.useState)(),[u,f]=(0,s.useState)(),[m,j]=(0,s.useState)(!1),[y,w]=(0,s.useState)(),[k,$]=(0,s.useState)(),A=(0,s.useMemo)(()=>e.featureLayout?l.A.from(e.featureLayout.data):null,[e.featureLayout]),C=(0,s.useMemo)(()=>e.mismatchLayout?l.A.from(e.mismatchLayout.data):null,[e.mismatchLayout]),F=(0,s.useMemo)(()=>{if(!e.selectedFeatureId)return null;const t=e.featuresForFlatbush.find(t=>t.chainId===e.selectedFeatureId);return t?{x:t.chainMinX,y:t.y1,width:t.chainMaxX-t.chainMinX,height:t.y2-t.y1}:null},[e.selectedFeatureId,e.featuresForFlatbush]),S=(0,s.useCallback)(t=>{if(!o.current||!A)return{feature:void 0,position:void 0};const n=o.current.getBoundingClientRect(),r=t.clientX-n.left,s=t.clientY-n.top,i=A.search(r,s,r+1,s+1);if(i.length>0){const n=i[0];return{feature:e.featuresForFlatbush[n],position:{x:t.clientX,y:t.clientY}}}return{feature:void 0,position:void 0}},[o,A,e.featuresForFlatbush]),M=(0,s.useCallback)(t=>{if(!o.current||!C)return;const n=o.current.getBoundingClientRect(),r=t.clientX-n.left,s=t.clientY-n.top,i=C.search(r,s,r+1,s+1);if(i.length>0){const t=i[0];return e.mismatchItems[t]}},[o,C,e.mismatchItems]),I=(0,s.useCallback)(e=>{const t=M(e);if(t)return w(t),d(void 0),f(void 0),j(!1),void $({x:e.clientX,y:e.clientY});const{feature:n,position:r}=S(e);w(void 0),n?(d({x:n.chainMinX,y:n.y1,width:n.chainMaxX-n.chainMinX,height:n.y2-n.y1}),f(n.data),j(n.hasSupplementary),$(r)):(d(void 0),f(void 0),j(!1),$(void 0))},[M,S]),L=(0,s.useCallback)(()=>{d(void 0),f(void 0),j(!1),w(void 0),$(void 0)},[]),R=(0,s.useCallback)(n=>{const r=M(n);if(r){const s=(0,i.getSession)(e),o=t.dynamicBlocks.contentBlocks,l=o[0]?.refName||"",{feature:c}=S(n),d=c?.data.name;if((0,a.lO)(s)){const n=s.addWidget("BaseFeatureWidget","baseFeature",{featureData:(0,h.u)(r,l,d),view:t,track:(0,i.getContainingTrack)(e)});s.showWidget(n)}return}const{feature:s}=S(n);s?(e.selectFeature(s.chain),e.setSelectedFeatureId(s.chainId)):e.setSelectedFeatureId(void 0)},[M,S,e,t]),T=y||u;return(0,x.jsxs)("div",{ref:o,style:{position:"relative",width:n,height:r,cursor:T?"pointer":void 0},onMouseMove:I,onMouseLeave:L,onClick:R,children:[(0,x.jsx)(v,{model:e,width:n,height:r}),(0,x.jsx)(b,{selectedFeatureBounds:F,hoveredFeature:c}),y&&k?(0,x.jsx)(g,{mismatchData:y,mousePosition:k}):u&&k?(0,x.jsx)(p,{hoveredFeatureData:u,hasSupplementary:m,mousePosition:k}):null]})}),y=(0,d.observer)(function({model:e}){return(0,x.jsxs)("div",{children:[(0,x.jsx)(c.A,{model:e,children:(0,x.jsx)(j,{model:e})}),e.drawCloud&&e.cloudTicks?(0,x.jsx)("svg",{style:{position:"absolute",top:0,left:50,pointerEvents:"none",height:e.cloudTicks.height,width:50},children:(0,x.jsx)("g",{transform:"translate(45, 0)",children:(0,x.jsx)(u.A,{model:e,orientation:"left"})})}):null]})})},10070(e,t,n){n.d(t,{A:()=>m}),n(42918);var r=n(87574),s=n(77251),o=n(65045),i=n(64074),a=n(91853),l=n(85376),c=n(32118);const d=(0,o.n)()({loading:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.15)",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(0, 0, 0, 0.05) 8px, rgba(0, 0, 0, 0.05) 16px)",pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},loadingMessage:{zIndex:2,pointerEvents:"none"}}),u=(0,i.observer)(function({model:e,children:t}){const{error:n,regionTooLarge:r}=e;return n?(0,c.jsx)(a.default,{model:e}):r?e.regionCannotBeRendered():(0,c.jsx)(h,{model:e,children:t})}),h=(0,i.observer)(function({model:e,children:t}){const{drawn:n,loading:r,showLegend:o,legendItems:i,lastDrawnBpPerPx:a}=e,d=(0,s.getContainingView)(e),u=i?.()??[],h=void 0!==a&&a!==d.bpPerPx,m=h?0:(e.lastDrawnOffsetPx??0)-d.offsetPx;return(0,c.jsxs)("div",{"data-testid":`drawn-${n}`,children:[(0,c.jsx)("div",{style:{position:"absolute",left:m,visibility:h?"hidden":void 0},children:t}),o&&u.length>0?(0,c.jsx)(l.A,{items:u}):null,h||0!==m||r?(0,c.jsx)(f,{model:e}):null]})}),f=(0,i.observer)(function({model:e}){const{classes:t}=d(),{statusMessage:n}=e;return(0,c.jsx)("div",{className:t.loading,children:(0,c.jsx)("div",{className:t.loadingMessage,children:(0,c.jsx)(r.A,{message:n})})})}),m=u},81325(e,t,n){n.d(t,{A:()=>a});var r=n(38715),s=n(64074),o=n(32118);function i(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(0)}k`:`${e}`}const a=(0,s.observer)(function({model:e,orientation:t}){const n=(0,r.A)(),s=e.cloudTicks;if(!s)return null;const{ticks:a,height:l}=s,c=n.palette.background.default,d=n.palette.text.primary,u="left"===t,h=u?-1:1;return(0,o.jsxs)("g",{fill:"none",fontSize:10,fontFamily:"sans-serif",textAnchor:u?"end":"start",strokeWidth:1,children:[(0,o.jsx)("path",{stroke:d,d:`M${6*h},0H0.5V${l}H${6*h}`}),a.map(({value:e,y:t})=>(0,o.jsxs)("g",{transform:`translate(0,${t})`,children:[(0,o.jsx)("line",{stroke:d,x2:6*h,y1:.5,y2:.5}),(0,o.jsx)("text",{stroke:c,strokeWidth:2.5,paintOrder:"stroke",fill:d,dy:"0.32em",x:9*h,y:.5,children:i(e)})]},e)),(0,o.jsx)("text",{stroke:c,strokeWidth:2.5,paintOrder:"stroke",fill:d,fontSize:10,textAnchor:"middle",transform:`translate(${u?-30:30}, ${l/2}) rotate(-90)`,children:"Insert size (bp)"})]})})},87258(e,t,n){n.r(t),n.d(t,{default:()=>F});var r=n(42918),s=n(1184),o=n(98373),i=n(66919),a=n(87),l=n(99367),c=n(8039),d=n(70885),u=n(29011),h=n(30936),f=n(52061),m=n(41031),x=n(84830),p=n(65045),g=n(32118);const b="jbrowse2@berkeley.edu",v=(0,p.n)()(e=>({pre:{background:(0,f.X4)(e.palette.error.main,.2),border:`1px solid ${e.palette.divider}`,overflow:"auto",margin:20,maxHeight:300}}));function j(e){const t=(0,h.c)(18),{text:n,extra:r}=e,{classes:s}=v();let o;t[0]!==r?(o=r?`supporting data: ${JSON.stringify(r,null,2)}`:"",t[0]=r,t[1]=o):o=t[1];const i=o;let a;t[2]!==i||t[3]!==n?(a=[n,i].filter(Boolean),t[2]=i,t[3]=n,t[4]=a):a=t[4];const l=a.join("\n"),c=encodeURIComponent(`I got this error from JBrowse, here is the stack trace:\n\n\`\`\`\n${n}\n\`\`\`\n${i}\n`),d=`https://github.com/GMOD/jbrowse-components/issues/new?labels=bug&title=JBrowse+issue&body=${c}`,u=`mailto:${b}?subject=JBrowse%202%20error&body=${c}`;let f,p,j,y,w;return t[5]!==d?(f=(0,g.jsx)(x.A,{href:d,children:"GitHub"}),t[5]=d,t[6]=f):f=t[6],t[7]!==u?(p=(0,g.jsx)(x.A,{href:u,children:b}),t[7]=u,t[8]=p):p=t[8],t[9]!==f||t[10]!==p?(j=(0,g.jsxs)(m.A,{children:["Post a new issue at"," ",f," or send an email to ",p]}),t[9]=f,t[10]=p,t[11]=j):j=t[11],t[12]!==s.pre||t[13]!==l?(y=(0,g.jsx)("pre",{className:s.pre,children:l}),t[12]=s.pre,t[13]=l,t[14]=y):y=t[14],t[15]!==j||t[16]!==y?(w=(0,g.jsxs)(g.Fragment,{children:[j,y]}),t[15]=j,t[16]=y,t[17]=w):w=t[17],w}var y=n(87574);async function w(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status} fetching ${e}: ${await t.text()}`);return t.text()}const k={},$=/\/\/# sourceMappingURL=(.*)/,A=/(.*)((?:https?|file):\/\/.*):(\d+):(\d+)/;async function C(e){if(k[e])return k[e];const t=new URL(e).search,n=await w(e),r=$.exec(n)?.[1]??"",s=await async function(e){return JSON.parse(await w(e))}(new URL(r,e).href+t),o=new u.SourceMapConsumer(s);return k[e]=o,o}function F({error:e,onClose:t,extra:u}){const[h,f]=(0,r.useState)(),[m,x]=(0,r.useState)(),[p,b]=(0,r.useState)(!1),v=e?`${e}`:"",w=function(e,t){return e.startsWith("Error:")?e.slice(`${t}`.length):e}(function(e){return"object"==typeof e&&null!==e&&"stack"in e?`${e.stack}`:""}(e),v);(0,r.useEffect)(()=>{(async()=>{try{f(await async function(e){const t=[];for(const n of e.split("\n")){const e=A.exec(n);if(!e){t.push(n);continue}const r=e[2],s=(await C(r)).originalPositionFor({line:+e[3],column:+e[4]});s.source&&s.line&&s.column?t.push(`${s.source}:${s.line}:${s.column+1} (${e[1].trim()})`):t.push(n)}return t.join("\n")}(w))}catch(e){console.error(e),f(w),x(e)}})()},[w]);const k=window.JBrowseSession?.version,$=[m?"Error loading source map, showing raw stack trace below:":"",v.length>1e4?`${v.slice(0,1e4)}...`:v,h||"No stack trace available",k?`JBrowse ${k}`:""].filter(Boolean).join("\n");return(0,g.jsxs)(o.A,{open:!0,onClose:t,maxWidth:"xl",children:[(0,g.jsxs)(i.A,{children:["Stack trace",(0,g.jsx)(a.A,{onClick:t,sx:{position:"absolute",right:8,top:8},children:(0,g.jsx)(s.A,{})})]}),(0,g.jsx)(l.A,{children:void 0===h?(0,g.jsx)(y.A,{variant:"h6"}):(0,g.jsx)(j,{text:$,extra:u})}),(0,g.jsxs)(c.A,{children:[(0,g.jsx)(d.A,{variant:"contained",color:"secondary",onClick:async()=>{const{default:e}=await n.e(8284).then(n.t.bind(n,88284,23));e($),b(!0),setTimeout(()=>{b(!1)},1e3)},children:p?"Copied!":"Copy stack trace to clipboard"}),(0,g.jsx)(d.A,{variant:"contained",color:"primary",onClick:t,children:"Close"})]})]})}},89198(e,t,n){function r(e){switch(e.type){case"insertion":return e.sequence&&e.sequence.length<=10?`Insertion: ${e.sequence}`:`Insertion: ${e.length}bp`;case"deletion":return`Deletion: ${e.length}bp`;case"softclip":return`Soft clip: ${e.length}bp`;case"hardclip":return`Hard clip: ${e.length}bp`;case"modification":{const t=e.mismatch?`\nMismatch: ${e.mismatch}`:"";return e.info+t}case"mismatch":return`Mismatch: ${e.base}`}}function s(e,t,n){const r={uniqueId:`${e.type}-${e.start}`,type:e.type,refName:t,sourceRead:n};switch(e.type){case"insertion":return{...r,start:e.start,end:e.start+1,...e.sequence?{sequence:e.sequence}:{},insertionLength:e.length};case"deletion":return{...r,start:e.start,end:e.start+e.length};case"softclip":case"hardclip":return{...r,start:e.start,end:e.start+1,clipLength:e.length};case"modification":return{...r,start:e.start,end:e.start+1,info:e.info,modType:e.modType,probability:e.probability.toFixed(3),...e.mismatch?{mismatch:e.mismatch}:{}};case"mismatch":return{...r,start:e.start,end:e.start+1,base:e.base}}}n.d(t,{F:()=>r,u:()=>s})},91853(e,t,n){n.r(t),n.d(t,{default:()=>h});var r=n(87258),s=n(77251),o=n(20611),i=n(3136),a=n(7623),l=n(87),c=n(64074),d=n(82947),u=n(32118);const h=(0,c.observer)(function({model:e}){return(0,u.jsx)(d.A,{message:`${e.error}`,severity:"error",action:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.A,{title:"Reload track",children:(0,u.jsx)(l.A,{"data-testid":"reload_button",onClick:()=>{e.reload()},children:(0,u.jsx)(o.A,{})})}),(0,u.jsx)(a.A,{title:"Show stack trace",children:(0,u.jsx)(l.A,{onClick:()=>{(0,s.getSession)(e).queueDialog(t=>[r.default,{onClose:t,error:e.error}])},children:(0,u.jsx)(i.A,{})})})]})})})}}]);
//# sourceMappingURL=3046.5975460e.chunk.js.map