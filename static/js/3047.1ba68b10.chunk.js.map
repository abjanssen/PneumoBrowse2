{"version":3,"file":"static/js/3047.1ba68b10.chunk.js","mappings":"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","sources":["../../../plugins/linear-comparative-view/src/LinearSyntenyView/svgcomponents/SVGBackground.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyView/svgcomponents/SVGLinearGenomeView.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyView/svgcomponents/SVGLinearSyntenyView.tsx"],"sourcesContent":["import { stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nexport default function SVGBackground({\n  width,\n  height,\n  shift,\n}: {\n  width: number\n  height: number\n  shift: number\n}) {\n  const theme = useTheme()\n  return (\n    <rect\n      width={width + shift * 2}\n      height={height}\n      fill={stripAlpha(theme.palette.background.default)}\n    />\n  )\n}\n","import { getFillProps } from '@jbrowse/core/util'\nimport { SVGRuler, SVGTracks } from '@jbrowse/plugin-linear-genome-view'\nimport { useTheme } from '@mui/material'\n\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport default function SVGLinearGenomeView({\n  trackLabelOffset,\n  fontSize,\n  textHeight,\n  trackLabels,\n  view,\n  displayResults,\n  rulerHeight,\n  shift,\n}: {\n  textHeight: number\n  trackLabels: string\n  trackLabelOffset: number\n  fontSize: number\n  view: LinearGenomeViewModel\n\n  displayResults: any\n  rulerHeight: number\n  shift: number\n}) {\n  const theme = useTheme()\n  return (\n    <g transform={`translate(${shift} ${fontSize})`}>\n      <g transform={`translate(${trackLabelOffset})`}>\n        <text\n          x={0}\n          fontSize={fontSize}\n          {...getFillProps(theme.palette.text.primary)}\n        >\n          {view.assemblyNames.join(', ')}\n        </text>\n        <SVGRuler model={displayResults.view} fontSize={fontSize} />\n      </g>\n      <g transform={`translate(0 ${rulerHeight + fontSize})`}>\n        <SVGTracks\n          textHeight={textHeight}\n          trackLabels={trackLabels}\n          fontSize={fontSize}\n          model={displayResults.view}\n          displayResults={displayResults.data}\n          trackLabelOffset={trackLabelOffset}\n        />\n      </g>\n    </g>\n  )\n}\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport {\n  ReactRendering,\n  getSerializedSvg,\n  getSession,\n  max,\n  measureText,\n  renderToAbstractCanvas,\n  renderToStaticMarkup,\n  sum,\n} from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { totalHeight } from '@jbrowse/plugin-linear-genome-view'\nimport { ThemeProvider } from '@mui/material'\nimport { when } from 'mobx'\n\nimport SVGBackground from './SVGBackground'\nimport SVGLinearGenomeView from './SVGLinearGenomeView'\nimport { drawRef } from '../../LinearSyntenyDisplay/drawSynteny'\n\nimport type { LinearSyntenyViewModel } from '../model'\nimport type { ExportSvgOptions } from '../types'\n\n// render LGV to SVG\nexport async function renderToSvg(\n  model: LinearSyntenyViewModel,\n  opts: ExportSvgOptions,\n) {\n  await when(() => model.initialized)\n  const {\n    textHeight = 18,\n    rulerHeight = 30,\n    fontSize = 13,\n    trackLabels = 'offset',\n    Wrapper = ({ children }) => children,\n    themeName = 'default',\n  } = opts\n  const session = getSession(model)\n  const themeVar = session.allThemes?.()[themeName]\n  const { width, views, levels } = model\n  const shift = 50\n  const offset = rulerHeight\n\n  const heights = views.map(\n    v => totalHeight(v.tracks, textHeight, trackLabels) + offset,\n  )\n  const totalHeightSvg = sum(heights) + sum(levels.map(l => l.height)) + 100\n\n  const displayResults = await Promise.all(\n    views.map(\n      async view =>\n        ({\n          view,\n          data: await Promise.all(\n            view.tracks.map(async track => {\n              const d = track.displays[0]\n              await when(() => (d.ready !== undefined ? d.ready : true))\n              return {\n                track,\n                result: await d.renderSvg({ ...opts, theme: themeVar }),\n              }\n            }),\n          ),\n        }) as const,\n    ),\n  )\n\n  const renderings = await Promise.all(\n    levels.map(\n      async level =>\n        await Promise.all(\n          level.tracks.map(async track => {\n            const d = track.displays[0]\n            await when(() => (d.ready !== undefined ? d.ready : true))\n            const r = await renderToAbstractCanvas(\n              width,\n              level.height,\n              { exportSVG: opts },\n              ctx => {\n                drawRef(d, ctx)\n                return undefined\n              },\n            )\n\n            if ('imageData' in r) {\n              throw new Error('found a canvas in svg export, probably a bug')\n            } else if ('canvasRecordedData' in r) {\n              return {\n                html: await getSerializedSvg({\n                  ...r,\n                  width,\n                  height: level.height,\n                }),\n              }\n            } else {\n              return r\n            }\n          }),\n        ),\n    ),\n  )\n\n  const trackLabelMaxLen =\n    max(\n      views.flatMap(view =>\n        view.tracks.map(track =>\n          measureText(getTrackName(track.configuration, session), fontSize),\n        ),\n      ),\n      0,\n    ) + 40\n  const trackLabelOffset = trackLabels === 'left' ? trackLabelMaxLen : 0\n  const w = width + trackLabelOffset\n  const theme = createJBrowseTheme(themeVar)\n  const RenderList = [\n    <SVGLinearGenomeView\n      rulerHeight={rulerHeight}\n      trackLabelOffset={trackLabelOffset}\n      shift={shift}\n      textHeight={textHeight}\n      trackLabels={trackLabels}\n      displayResults={displayResults[0]}\n      key={views[0]!.id}\n      view={views[0]!}\n      fontSize={fontSize}\n    />,\n  ] as React.ReactNode[]\n  let currOffset = heights[0]! + fontSize + rulerHeight\n  for (let i = 1; i < views.length; i++) {\n    const view = views[i]!\n    const level = levels[i - 1]!\n    const rendering = renderings[i - 1]\n    const height = heights[i]!\n    const levelHeight = level.height || 0\n    RenderList.push(\n      <g key={view.id} transform={`translate(0 ${currOffset})`}>\n        {levelHeight ? (\n          <defs>\n            <clipPath id={`synclip-${i}`}>\n              <rect x={0} y={0} width={width} height={levelHeight} />\n            </clipPath>\n          </defs>\n        ) : null}\n        <g\n          transform={`translate(${shift + trackLabelOffset} ${fontSize})`}\n          clipPath={`url(#synclip-${i})`}\n        >\n          {rendering?.map((r, i) => (\n            <ReactRendering key={i} rendering={r} />\n          ))}\n        </g>\n        <g transform={`translate(0 ${levelHeight})`}>\n          <SVGLinearGenomeView\n            rulerHeight={rulerHeight}\n            shift={shift}\n            trackLabelOffset={trackLabelOffset}\n            textHeight={textHeight}\n            trackLabels={trackLabels}\n            displayResults={displayResults[i]}\n            key={view.id}\n            view={view}\n            fontSize={fontSize}\n          />\n        </g>\n      </g>,\n    )\n    currOffset += height + fontSize + rulerHeight + levelHeight\n  }\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <ThemeProvider theme={theme}>\n      <Wrapper>\n        <svg\n          width={width}\n          height={totalHeightSvg}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n          viewBox={[0, 0, w + shift * 2, totalHeightSvg].toString()}\n        >\n          <SVGBackground width={w} height={totalHeightSvg} shift={shift} />\n          {RenderList}\n        </svg>\n      </Wrapper>\n    </ThemeProvider>,\n  )\n}\n"],"names":["SVGBackground","t0","$","_c","width","height","shift","theme","useTheme","t1","t2","t3","palette","background","default","stripAlpha","_jsx","fill","SVGLinearGenomeView","trackLabelOffset","fontSize","textHeight","trackLabels","view","displayResults","rulerHeight","t4","t5","t6","t7","text","primary","getFillProps","assemblyNames","join","x","children","SVGRuler","model","_jsxs","transform","t8","t9","t10","t11","data","SVGTracks","async","renderToSvg","opts","when","initialized","Wrapper","themeName","session","getSession","themeVar","allThemes","views","levels","offset","heights","map","v","totalHeight","tracks","totalHeightSvg","sum","l","Promise","all","d","track","displays","undefined","ready","result","renderSvg","renderings","level","r","renderToAbstractCanvas","exportSVG","ctx","drawRef","Error","html","getSerializedSvg","trackLabelMaxLen","max","flatMap","measureText","getTrackName","configuration","w","createJBrowseTheme","RenderList","id","currOffset","i","length","rendering","levelHeight","push","y","clipPath","ReactRendering","renderToStaticMarkup","ThemeProvider","xmlns","xmlnsXlink","viewBox","toString"],"sourceRoot":""}