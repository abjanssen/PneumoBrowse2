"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[307],{307:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var s=n(7552),i=n(49823),r=n(99546),o=n(91468),l=n(29499),a=n(36715),c=n(5401),u=n(33371),p=n(32808),d=n(1343),h=n(58507),g=n(31409),x=n.n(g),m=n(45465),j=n(36422),y=n(75785),f=n(69500);const b=(0,y.n9)()((e=>({textAreaFont:{fontFamily:"Courier New"},mgap:{display:"flex",flexDirection:"column",gap:e.spacing(4)}})));function w({model:e,handleClose:t}){const{classes:n}=b(),[g,y]=(0,s.useState)(),[w,A]=(0,s.useState)(),[C,v]=(0,s.useState)(""),[k,R]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{(async()=>{try{A(void 0);const t=(0,r.getContainingView)(e);if(!t.initialized)return;const{rpcManager:n}=(0,r.getSession)(e),{sources:s,minorAlleleFrequencyFilter:i,adapterConfig:l}=e,a=(0,o.getRpcSessionId)(e),c=await n.call(a,"MultiVariantGetGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:s,minorAlleleFrequencyFilter:i,sessionId:a,adapterConfig:l}),u=Object.values(c),p=Object.keys(c),d=k?"complete":"single",h=`try(library(fastcluster), silent=TRUE)\ninputMatrix<-matrix(c(${u.map((e=>e.genotypes.join(","))).join(",\n")}\n),nrow=${u.length},byrow=TRUE)\nrownames(inputMatrix)<-c(${p.map((e=>`'${e}'`)).join(",")})\nresultClusters<-hclust(dist(inputMatrix), method='${d}')\ncat(resultClusters$order,sep='\\n')`;y(h)}catch(t){!(0,r.isAbortException)(t)&&(0,j.isAlive)(e)&&(console.error(t),A(t))}})()}),[e,k]),(0,f.jsxs)(i.Dialog,{open:!0,title:"Cluster by genotype",onClose:t,children:[(0,f.jsx)(l.A,{children:(0,f.jsxs)("div",{className:n.mgap,children:[(0,f.jsx)(a.A,{children:"This page will produce an R script that will perform hierarchical clustering on the visible genotype data using `hclust`."}),(0,f.jsx)(a.A,{children:"You can then paste the results in this form to specify the row ordering."}),g?(0,f.jsx)("div",{children:(0,f.jsxs)("div",{children:["Step 1:"," ",(0,f.jsx)(c.A,{variant:"contained",onClick:()=>{(0,m.saveAs)(new Blob([g||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,f.jsx)(c.A,{variant:"contained",onClick:()=>{x()(g||"")},children:"Copy Rscript to clipboard"}),(0,f.jsx)(u.A,{control:(0,f.jsx)(p.A,{checked:k,onChange:e=>{R(e.target.checked)}}),label:"Use 'complete' linkage method instead of 'single'"}),(0,f.jsx)("div",{children:(0,f.jsx)(d.A,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Step 2. Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:C,onChange:e=>{v(e.target.value)},slotProps:{input:{classes:{input:n.textAreaFont}}}})})]})}):(0,f.jsx)(i.LoadingEllipses,{variant:"h6",title:"Generating genotype matrix"}),w?(0,f.jsx)(i.ErrorMessage,{error:w}):null]})}),(0,f.jsxs)(h.A,{children:[(0,f.jsx)(c.A,{disabled:!g,variant:"contained",onClick:()=>{const{sources:n}=e;if(n)try{e.setLayout(C.split("\n").map((e=>e.trim())).filter((e=>!!e)).map((e=>+e)).map((e=>{const t=n[e-1];if(!t)throw new Error(`out of bounds at ${e}`);return t})))}catch(e){console.error(e),A(e)}t()},children:"Apply clustering"}),(0,f.jsx)(c.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})}}}]);
//# sourceMappingURL=307.53d81b0b.chunk.js.map