"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4552],{34552(e,t,r){r.d(t,{default:()=>p});var n=r(66601),a=r(49964),s=r(48455),i=r(77251),o=r(25978),c=r(53155),u=r(33624),d=r(86618),f=r(96852),m=r(10596),l=r(50268);class p extends s.L{async configurePre(e){const t=this.pluginManager,r=new n.CQ({filehandle:(0,u.openLocation)(this.getConf("bigBedLocation"),t)}),s=await r.getHeader(e);return{bigbed:r,header:s,parser:new a.A({autoSql:s.autoSql})}}async configure(e){return this.cachedP||(this.cachedP=this.configurePre(e).catch(e=>{throw this.cachedP=void 0,e})),this.cachedP}async getRefNames(e){const{header:t}=await this.configure(e);return Object.keys(t.refsByName)}async getRefNameAliases(e){const{header:t}=await this.configure(e);return(await Promise.all(Object.keys(t.refsByName).map(async e=>(await(0,f._)(this.getFeatures({assemblyName:"",refName:e,start:0,end:1}).pipe((0,m.$)())))[0]))).map(e=>e.toJSON()).map(e=>({refName:e.ucsc,aliases:[e.ncbi,e.refseq,e.genbank],override:!0}))}async getData(){const e=await this.getRefNames(),t=[];for(const r of e){const e=await(0,f._)(this.getFeatures({assemblyName:"unknown",refName:r,start:0,end:Number.MAX_SAFE_INTEGER}).pipe((0,m.$)()));t.push(e)}return t.flat()}async getHeader(e){const{parser:t,header:r}=await this.configure(e),{version:n,fileType:a}=r,{fields:s,...i}=t.autoSql;return{version:n,fileType:a,autoSql:i,fields:await this.getMetadata(e)}}async getMetadata(e){const{parser:t}=await this.configure(e),{fields:r}=t.autoSql;return Object.fromEntries(r.map(({name:e,comment:t})=>[e,t]))}async getFeaturesHelper({query:e,opts:t,observer:r,allowRedispatch:n,originalQuery:a=e}){const{statusCallback:s=()=>{}}=t,u=this.getConf("scoreColumn"),d=this.getConf("aggregateField"),{parser:f,bigbed:m}=await(0,i.updateStatus)("Downloading header",s,()=>this.configure(t)),p=await(0,i.updateStatus)("Downloading features",s,()=>m.getFeatures(e.refName,e.start,e.end,{basesPerSpan:e.end-e.start}));await(0,i.updateStatus)("Processing features",s,async()=>{const s={},m=[];if(p.some(e=>void 0===e.uniqueId))throw new Error("found uniqueId undefined");for(const t of p){const n=[e.refName,`${t.start}`,`${t.end}`,...t.rest?.split("\t")||[]],i=f.parseLine(n,{uniqueId:t.uniqueId}),p=i[d],h=p&&"none"!==p;h&&!s[p]&&(s[p]=[]);const{uniqueId:b,type:k,chrom:N,chromStart:g,chromEnd:S,description:_,chromStarts:y,blockStarts:q,blockSizes:I,score:w,blockCount:C,thickStart:v,thickEnd:E,strand:R,...T}=i,F=(0,l.np)({...T,scoreColumn:u,splitLine:n,parser:f,uniqueId:b,start:t.start,end:t.end,refName:e.refName});h?(s[p].push(F),m.push(F)):(0,o.R6)(F.start,F.end,a.start,a.end)&&r.next(new c.A({id:`${this.id}-${b}`,data:F}))}if(n&&m.length){let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(const e of m)e.start<n&&(n=e.start),e.end>a&&(a=e.end);if(a>e.end||n<e.start)return void await this.getFeaturesHelper({query:{...e,start:n-5e5,end:a+5e5},opts:t,observer:r,allowRedispatch:!1,originalQuery:e})}Object.entries(s).map(([t,n])=>{const s=(0,i.min)(n.map(e=>e.start)),u=(0,i.max)(n.map(e=>e.end));if((0,o.R6)(s,u,a.start,a.end)){const a=n.sort((e,t)=>e.uniqueId.localeCompare(t.uniqueId));if(a.some((e,t)=>a.some((r,n)=>t!==n&&(0,o.R6)(e.start,e.end,r.start,r.end))))r.next(new c.A({id:`${this.id}-${a[0]?.uniqueId}-parent`,data:{type:"gene",subfeatures:a,strand:a[0]?.strand||1,name:t,start:s,end:u,refName:e.refName}}));else for(const n of a)r.next(new c.A({id:`${this.id}-${n.uniqueId}-parent`,data:{type:"gene",subfeatures:[n],strand:a[0]?.strand||1,name:t,start:n.start,end:n.end,refName:e.refName}}))}})}),r.complete()}getFeatures(e,t={}){return(0,d.ObservableCreate)(async r=>{try{await this.getFeaturesHelper({query:{...e,start:e.start,end:e.end},opts:t,observer:r,allowRedispatch:!0})}catch(e){r.error(e)}},t.stopToken)}}},50268(e,t,r){function n(e){const t=e?.trim().split(" ");return[0,1,2,3,5,6].every(e=>void 0!==t?.[e]&&!Number.isNaN(+t[e]))}function a(e){if(n(e)){const[t,r,n,a,s,i,o,c,u,d,f,m,l,p,h]=e.trim().split(" ");return{bitsw_score:t,percent_div:r,percent_del:n,percent_ins:a,query_chr:s,query_begin:i,query_end:o,query_remaining:c,orientation:u,matching_repeat_name:d,matching_repeat_class:f,matching_repeat_begin:m,matching_repeat_end:l,matching_repeat_remaining:p,repeat_id:h}}return{description:e}}function s(e){return(3-e)%3}function i({line:e,colRef:t,colStart:r,colEnd:n,scoreColumn:a,parser:s,uniqueId:i,names:c}){const u=e.split("\t");return o({splitLine:u,refName:u[t],start:Number.parseInt(u[r],10),end:Number.parseInt(u[n],10)+(r===n?1:0),parser:s,uniqueId:i,scoreColumn:a,names:c})}function o({splitLine:e,refName:t,start:r,end:i,parser:o,uniqueId:u,scoreColumn:d,names:f}){const m=f?function(e,t){const r={};let n=!1;for(const[a,s]of t.entries()){const t=e[a];t&&(r[t]=s,"blockCount"===t&&(n=!0))}if(n){const{blockStarts:e,blockCount:t,chromStarts:n,thickEnd:a,thickStart:s,blockSizes:i,...o}=r;return{...o,blockStarts:c(e),chromStarts:c(n),blockSizes:c(i),thickStart:s?+s:void 0,thickEnd:a?+a:void 0,blockCount:t?+t:void 0}}return r}(f,e):o.parseLine(e,{uniqueId:u}),{strand:l,score:p,chrom:h,chromStart:b,chromEnd:k,...N}=m,g=d?+m[d]:p?+p:void 0,S=function(e){return"-"===e||-1===e?-1:"+"===e||1===e?1:0}(l),_=N.blockCount?function({start:e,uniqueId:t,refName:r,chromStarts:n,blockCount:a,blockSizes:s,blockStarts:i}){const o=[],c=n??i??[];for(let n=0;n<a;n++){const a=(c[n]??0)+e,i=s?.[n];i&&i>0&&o.push({uniqueId:`${t}-${n}`,start:a,end:a+i,refName:r,type:"block"})}return o}({start:r,uniqueId:u,refName:t,chromStarts:N.chromStarts,blockCount:N.blockCount,blockSizes:N.blockSizes,blockStarts:N.blockStarts}):void 0;if(function({splitLine:e,start:t,end:r}){return+(e[6]||0)===t&&+(e[7]||0)===r&&[9,10,11,12,13,14,15,16,17].every(t=>e[t]&&!Number.isNaN(+e[t]))}({splitLine:e,start:r,end:i}))return function({splitLine:e,uniqueId:t,refName:r,start:n,end:a}){const[,,,s,,i,,,o,c,u,d,f,m,l,p,h,b]=e;return{uniqueId:t,refName:r,start:n,end:a,code:s,score:+u||0,strand:i,color:o,source:s,n_valid_cov:c,fraction_modified:u,n_mod:d,n_canonical:f,n_other_mod:m,n_delete:l,n_fail:p,n_diff:h,n_nocall:b}}({splitLine:e,uniqueId:u,refName:t,start:r,end:i});if(n(N.description)){const{chromStarts:e,blockSizes:n,blockStarts:s,blockCount:o,thickStart:c,thickEnd:d,description:f,...m}=N;return function({uniqueId:e,refName:t,start:r,end:n,description:s,...i}){const{subfeatures:o,...c}=i;return{...c,...a(s),uniqueId:e,refName:t,start:r,end:n}}({...m,description:f,uniqueId:u,score:g,start:r,end:i,strand:S,refName:t,subfeatures:_})}return _&&function({thickStart:e,blockCount:t,strand:r}){return e&&t&&0!==r}({strand:S,blockCount:N.blockCount,thickStart:N.thickStart})?function(e){const{strand:t=0,uniqueId:r,start:n,end:a,...i}=e,{subfeatures:o,thickStart:c,thickEnd:u,refName:d,chrom:f,chromStart:m,chromEnd:l,chromStarts:p,blockStarts:h,blockSizes:b,blockCount:k,...N}=i,g=N.exonFrames??N._exonFrames,S=o.filter(e=>"block"===e.type).sort((e,t)=>e.start-t.start),_=t>0?"five_prime_UTR":"three_prime_UTR",y=t>0?"three_prime_UTR":"five_prime_UTR",{cdsEndStat:q,cdsStartStat:I}=N;if("none"===I&&"none"===q)return{...N,uniqueId:r,strand:t,type:"transcript",refName:d,start:n,end:a,subfeatures:S.map(e=>({...e,type:"exon"}))};let w;if(!g){const e=[];for(const t of S){const{start:r,end:n}=t;c<n&&u>r&&e.push({start:Math.max(r,c),end:Math.min(n,u)})}w=function(e,t){const r=[...e].sort((e,r)=>t>0?e.start-r.start:r.start-e.start),n=new Map;let a=0;for(const e of r){const t=(3-a%3)%3;n.set(e.start,t),a+=e.end-e.start}return n}(e,t)}const C=[];for(const[e,t]of S.entries()){const r=t,{start:n,end:a}=r;if(c>=a)C.push({type:_,start:n,end:a,refName:d});else if(u<=n)C.push({type:y,start:n,end:a,refName:d});else{n<c&&C.push({type:_,start:n,end:c,refName:d});const t=Math.max(n,c),r=Math.min(a,u);let i=0;if(g){const t=g[e];void 0!==t&&t>=0&&(i=s(t))}else w&&(i=w.get(t)??0);C.push({type:"CDS",phase:i,start:t,end:r,refName:d}),a>u&&C.push({type:y,start:u,end:a,refName:d})}}return{...N,uniqueId:r,strand:t,type:"mRNA",refName:d,start:n,end:a,subfeatures:C}}({...N,score:g,start:r,end:i,strand:S,refName:t,uniqueId:u,subfeatures:_,thickStart:N.thickStart,thickEnd:N.thickEnd}):{...N,uniqueId:u,score:g,start:r,end:i,strand:S,refName:t,subfeatures:_}}function c(e){if(void 0!==e)return"string"==typeof e?e.split(",").map(e=>+e):e}r.d(t,{dE:()=>i,np:()=>o})}}]);
//# sourceMappingURL=4552.2ecf08e7.chunk.js.map