{"version":3,"file":"static/js/6386.74046d3e.chunk.js","mappings":"gQAqCOA,eAAeC,EACpBC,EACAC,GAEA,MAAMC,GAAOC,EAAAA,EAAAA,mBAAkBH,GACzBI,GAAUC,EAAAA,EAAAA,YAAWL,IACrB,WAAEM,GAAeF,EACjBG,EAASN,EAAKO,gBAAkBR,EAAKO,QAErC,SACJE,EAAQ,WACRC,EAAU,cACVC,EAAa,kBACbC,EAAiB,eACjBC,EAAc,oBACdC,EAAmB,SACnBC,GACEf,GACE,QAAEgB,EAAO,cAAEC,GAAkBf,EAC7BgB,EAAUD,EAAcE,cAE9B,IAAKD,EAAQE,OACX,OAAO,KAGT,MAAMC,EAAcrB,EAAKqB,cAEnBC,GAAeC,EAAAA,EAAAA,iBAAgBvB,GAC/BwB,QAAmBlB,EAAWmB,KAAKH,EAAc,aAAc,CACnEI,UAAWJ,EACXK,aAAc,aACdT,QAAS,IAAIA,GACbP,gBACAK,aACGK,EACHO,UAAW3B,IAGP4B,QAAuBC,EAAAA,EAAAA,IAC3BN,EACAtB,EAAK6B,aAAaC,aAClBzB,GAGI0B,EAAe/B,EAAKgC,MACpBC,EAAS,QAAQnC,EAAKoC,SAGtBC,EAAoBxB,EAAiB,EACrCyB,EAAqBzB,EAAiB,EAE5C,OACE0B,EAAAA,EAAAA,MAAAC,EAAAA,SAAA,CAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,QAAAD,UACEC,EAAAA,EAAAA,KAAA,YAAUN,GAAID,EAAOM,UACnBC,EAAAA,EAAAA,KAAA,QAAMC,EAAG,EAAGC,EAAG,EAAGV,MAAOD,EAAc1B,OAAQA,SAGnDgC,EAAAA,EAAAA,MAAA,KAAGM,SAAU,QAAQV,KAAUM,SAAA,EAC7BC,EAAAA,EAAAA,KAAA,KACEI,UAAW,aAAaC,KAAKC,IAAI,GAAI9C,EAAK+C,aAAapC,KAAkB4B,UAEzEC,EAAAA,EAAAA,KAACQ,EAAAA,GAAc,CAAC1B,UAAWK,MAE5Bf,GACC4B,EAAAA,EAAAA,KAACS,EAAAA,EAAO,CAACC,MAAOpD,EAAM4B,WAAS,EAAAa,UAC7BC,EAAAA,EAAAA,KAACW,EAAAA,EAAa,CAACD,MAAOpD,OAGxB0C,EAAAA,EAAAA,KAACY,EAAAA,EAAsC,CAACF,MAAOpD,EAAM4B,WAAS,IAG/DhB,GAAqBY,EAAU+B,eAC9BhB,EAAAA,EAAAA,MAAA,KAAGO,UAAW,eAAeR,KAAsBG,SAAA,EACjDC,EAAAA,EAAAA,KAACc,EAAAA,EAAkB,CACjBD,cAAe/B,EAAU+B,cACzBrB,MAAOD,EACP1B,OAAQ8B,EACRT,WAAS,EACTd,oBAAqBA,EACrB2C,YAAavC,EAAQ,IAAIwC,MACzB1C,QAASA,KAEX0B,EAAAA,EAAAA,KAACiB,EAAAA,EAAsB,CACrBpD,OAAQ8B,EACRuB,SAAUb,KAAKC,OAAOxB,EAAU+B,cAAcM,OAAQ,IACtDjC,WAAS,OAGX,QAELlB,GACCgC,EAAAA,EAAAA,KAACoB,EAAAA,GAAgB,CACfrD,SAAUA,EACVyB,MAAOD,EACPlB,SAAUA,IAEV,OAGV,C","sources":["webpack://@jbrowse/web/../../plugins/variants/src/LDDisplay/renderSvg.tsx"],"sourcesContent":["import type React from 'react'\n\nimport {\n  getContainingView,\n  getRpcSessionId,\n  getSession,\n} from '@jbrowse/core/util'\nimport {\n  ReactRendering,\n  renderingToSvg,\n} from '@jbrowse/core/util/offscreenCanvasUtils'\n\nimport { LDSVGColorLegend } from './components/LDColorLegend.tsx'\nimport LinesConnectingMatrixToGenomicPosition from './components/LinesConnectingMatrixToGenomicPosition.tsx'\nimport VariantLabels from './components/VariantLabels.tsx'\nimport Wrapper from './components/Wrapper.tsx'\nimport RecombinationTrack from '../shared/components/RecombinationTrack.tsx'\nimport RecombinationYScaleBar from '../shared/components/RecombinationYScaleBar.tsx'\n\nimport type { SharedLDModel } from './shared.ts'\nimport type {\n  ExportSvgDisplayOptions,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\ninterface RenderingResult {\n  reactElement?: React.ReactNode\n  html?: string\n  canvasRecordedData?: unknown\n  recombination?: {\n    values: number[]\n    positions: number[]\n  }\n}\n\nexport async function renderSvg(\n  self: SharedLDModel,\n  opts: ExportSvgDisplayOptions,\n) {\n  const view = getContainingView(self) as LGV\n  const session = getSession(self)\n  const { rpcManager } = session\n  const height = opts.overrideHeight ?? self.height\n\n  const {\n    ldMetric,\n    showLegend,\n    adapterConfig,\n    showRecombination,\n    lineZoneHeight,\n    useGenomicPositions,\n    signedLD,\n  } = self\n  const { bpPerPx, dynamicBlocks } = view\n  const regions = dynamicBlocks.contentBlocks\n\n  if (!regions.length) {\n    return null\n  }\n\n  const renderProps = self.renderProps()\n\n  const rpcSessionId = getRpcSessionId(self)\n  const rendering = (await rpcManager.call(rpcSessionId, 'CoreRender', {\n    sessionId: rpcSessionId,\n    rendererType: 'LDRenderer',\n    regions: [...regions],\n    adapterConfig,\n    bpPerPx,\n    ...renderProps,\n    exportSVG: opts,\n  })) as RenderingResult\n\n  const finalRendering = await renderingToSvg(\n    rendering,\n    view.staticBlocks.totalWidthPx,\n    height,\n  )\n\n  const visibleWidth = view.width\n  const clipId = `clip-${self.id}-svg`\n\n  // Recombination track is overlaid at the bottom half of the line zone\n  const recombTrackHeight = lineZoneHeight / 2\n  const recombTrackYOffset = lineZoneHeight / 2\n\n  return (\n    <>\n      <defs>\n        <clipPath id={clipId}>\n          <rect x={0} y={0} width={visibleWidth} height={height} />\n        </clipPath>\n      </defs>\n      <g clipPath={`url(#${clipId})`}>\n        <g\n          transform={`translate(${Math.max(0, -view.offsetPx)} ${lineZoneHeight})`}\n        >\n          <ReactRendering rendering={finalRendering} />\n        </g>\n        {useGenomicPositions ? (\n          <Wrapper model={self} exportSVG>\n            <VariantLabels model={self} />\n          </Wrapper>\n        ) : (\n          <LinesConnectingMatrixToGenomicPosition model={self} exportSVG />\n        )}\n        {/* Recombination track overlaid at bottom of line zone */}\n        {showRecombination && rendering.recombination ? (\n          <g transform={`translate(0 ${recombTrackYOffset})`}>\n            <RecombinationTrack\n              recombination={rendering.recombination}\n              width={visibleWidth}\n              height={recombTrackHeight}\n              exportSVG\n              useGenomicPositions={useGenomicPositions}\n              regionStart={regions[0]?.start}\n              bpPerPx={bpPerPx}\n            />\n            <RecombinationYScaleBar\n              height={recombTrackHeight}\n              maxValue={Math.max(...rendering.recombination.values, 0.1)}\n              exportSVG\n            />\n          </g>\n        ) : null}\n      </g>\n      {showLegend ? (\n        <LDSVGColorLegend\n          ldMetric={ldMetric}\n          width={visibleWidth}\n          signedLD={signedLD}\n        />\n      ) : null}\n    </>\n  )\n}\n"],"names":["async","renderSvg","self","opts","view","getContainingView","session","getSession","rpcManager","height","overrideHeight","ldMetric","showLegend","adapterConfig","showRecombination","lineZoneHeight","useGenomicPositions","signedLD","bpPerPx","dynamicBlocks","regions","contentBlocks","length","renderProps","rpcSessionId","getRpcSessionId","rendering","call","sessionId","rendererType","exportSVG","finalRendering","renderingToSvg","staticBlocks","totalWidthPx","visibleWidth","width","clipId","id","recombTrackHeight","recombTrackYOffset","_jsxs","_Fragment","children","_jsx","x","y","clipPath","transform","Math","max","offsetPx","ReactRendering","Wrapper","model","VariantLabels","LinesConnectingMatrixToGenomicPosition","recombination","RecombinationTrack","regionStart","start","RecombinationYScaleBar","maxValue","values","LDSVGColorLegend"],"sourceRoot":""}