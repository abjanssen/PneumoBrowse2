{"version":3,"file":"static/js/2303.f4b9e13d.chunk.js","mappings":"6OAgBO,SAASA,EAA+BC,IAe7CC,EAAAA,EAAAA,aACED,GACAE,EAAAA,EAAAA,SACEC,UACE,IACE,MAAMC,GAAOC,EAAAA,EAAAA,mBAAkBL,GAC/B,IAAKI,EAAKE,cAAgBN,EAAKO,+BAC7B,OAGF,MAAMC,GAAYC,EAAAA,EAAAA,MAClBT,EAAKU,6BAA6BF,GAClC,MAAM,WAAEG,IAAeC,EAAAA,EAAAA,YAAWZ,IAC5B,mBACJa,EAAkB,QAClBC,EAAO,2BACPC,EAA0B,cAC1BC,GACEhB,EACJ,GAAIc,EAAS,CACX,MAAMG,GAAYC,EAAAA,EAAAA,iBAAgBlB,IAC5B,WAAEmB,EAAU,UAAEC,EAAS,SAAEC,SAAoBV,EAAWW,KAC5DL,EACA,oCACA,CACEM,QAASnB,EAAKoB,cAAcC,cAC5BX,UACAC,6BACAF,qBACAI,YACAD,gBACAR,eAOAkB,EAAAA,EAAAA,SAAQ1B,KACVA,EAAK2B,aAAaP,GAClBpB,EAAK4B,cAAcT,GACnBnB,EAAK6B,YAAYR,EAASS,IAAIC,GAAK,IAAIC,EAAAA,cAAcD,KAEzD,CACF,CAAE,MAAOE,GACPC,QAAQC,MAAMF,KACTG,EAAAA,EAAAA,IAAiBH,KAAMP,EAAAA,EAAAA,SAAQ1B,KAClCY,EAAAA,EAAAA,YAAWZ,GAAMqC,YAAY,GAAGJ,IAAKA,EAEzC,GAEF,CACEK,MAAO,MAIf,C","sources":["../../../plugins/variants/src/getMultiVariantFeaturesAutorun.ts"],"sourcesContent":["import {\n  SimpleFeature,\n  getContainingView,\n  getSession,\n} from '@jbrowse/core/util'\nimport { isAbortException } from '@jbrowse/core/util/aborting'\nimport { createStopToken } from '@jbrowse/core/util/stopToken'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { autorun } from 'mobx'\nimport { addDisposer, isAlive } from 'mobx-state-tree'\n\nimport type { SampleInfo, Source } from './shared/types'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { Feature, SimpleFeatureSerialized } from '@jbrowse/core/util'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nexport function getMultiVariantFeaturesAutorun(self: {\n  configuration: AnyConfigurationModel\n  adapterConfig: AnyConfigurationModel\n  sources?: Source[]\n  minorAlleleFrequencyFilter: number\n  lengthCutoffFilter: number\n  statsReadyAndRegionNotTooLarge: boolean\n  adapterProps: () => Record<string, unknown>\n  setError: (error: unknown) => void\n  setFeatures: (f: Feature[]) => void\n  setMessage: (str: string) => void\n  setHasPhased: (arg: boolean) => void\n  setSampleInfo: (arg: Record<string, SampleInfo>) => void\n  setSimplifiedFeaturesLoading: (arg: string) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      async () => {\n        try {\n          const view = getContainingView(self) as LinearGenomeViewModel\n          if (!view.initialized || !self.statsReadyAndRegionNotTooLarge) {\n            return\n          }\n\n          const stopToken = createStopToken()\n          self.setSimplifiedFeaturesLoading(stopToken)\n          const { rpcManager } = getSession(self)\n          const {\n            lengthCutoffFilter,\n            sources,\n            minorAlleleFrequencyFilter,\n            adapterConfig,\n          } = self\n          if (sources) {\n            const sessionId = getRpcSessionId(self)\n            const { sampleInfo, hasPhased, features } = (await rpcManager.call(\n              sessionId,\n              'MultiVariantGetSimplifiedFeatures',\n              {\n                regions: view.dynamicBlocks.contentBlocks,\n                sources,\n                minorAlleleFrequencyFilter,\n                lengthCutoffFilter,\n                sessionId,\n                adapterConfig,\n                stopToken,\n              },\n            )) as {\n              sampleInfo: Record<string, SampleInfo>\n              hasPhased: boolean\n              features: SimpleFeatureSerialized[]\n            }\n            if (isAlive(self)) {\n              self.setHasPhased(hasPhased)\n              self.setSampleInfo(sampleInfo)\n              self.setFeatures(features.map(f => new SimpleFeature(f)))\n            }\n          }\n        } catch (e) {\n          console.error(e)\n          if (!isAbortException(e) && isAlive(self)) {\n            getSession(self).notifyError(`${e}`, e)\n          }\n        }\n      },\n      {\n        delay: 1000,\n      },\n    ),\n  )\n}\n"],"names":["getMultiVariantFeaturesAutorun","self","addDisposer","autorun","async","view","getContainingView","initialized","statsReadyAndRegionNotTooLarge","stopToken","createStopToken","setSimplifiedFeaturesLoading","rpcManager","getSession","lengthCutoffFilter","sources","minorAlleleFrequencyFilter","adapterConfig","sessionId","getRpcSessionId","sampleInfo","hasPhased","features","call","regions","dynamicBlocks","contentBlocks","isAlive","setHasPhased","setSampleInfo","setFeatures","map","f","SimpleFeature","e","console","error","isAbortException","notifyError","delay"],"sourceRoot":""}