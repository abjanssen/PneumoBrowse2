"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7757],{7757(e,t,o){o.d(t,{renderMultiRowXYPlot:()=>u});var s=o(77251),r=o(83640),a=o(52901),l=o(16876),c=o(26931),n=o(21206),i=o(27535);async function u(e,t){const{sources:o,height:u,regions:g,bpPerPx:f,stopToken:h,statusCallback:m=()=>{}}=e,d=g[0],p=(d.end-d.start)/f,M=u/o.length,x=(0,a.jL)(h),{reducedFeatures:b,...v}=await(0,s.updateStatus)("Rendering plot",m,()=>(0,r.u)(p,u,e,r=>{const a=(0,s.groupBy)(t,e=>e.get("source"));let l=[];r.save();for(const t of o){const{reducedFeatures:o}=(0,n.u)(r,{...e,features:a[t.name]||[],height:M,colorCallback:()=>t.color||"blue",lastCheck:x});l=l.concat(o),r.strokeStyle="rgba(200,200,200,0.8)",r.beginPath(),r.moveTo(0,M),r.lineTo(p,M),r.stroke(),r.translate(0,M)}return r.restore(),{reducedFeatures:l}})),k={...v,features:b.map(i.serializeWiggleFeature),height:u,width:p};return(0,l.lk)(k,(0,c.X)(v))}},21206(e,t,o){o.d(t,{u:()=>g});var s=o(11259),r=o(77251),a=o(19598),l=o(52901),c=o(27535);function n(e,t){const o=e.toHsl(),s=o.l*(1+t);return(0,a.M)({...o,l:(0,r.clamp)(s,0,100)})}function i(e,t){const o=e.toHsl(),s=o.l*(1-t);return(0,a.M)({...o,l:(0,r.clamp)(s,0,100)})}const u=.3;function g(e,t){const{features:o,bpPerPx:g,regions:f,scaleOpts:h,height:m,config:d,ticks:p,displayCrossHatches:M,offset:x=0,colorCallback:b,inverted:v,stopToken:k,lastCheck:C=(0,l.jL)(k)}=t,y=f[0],S=(y.end-y.start)/g,T=y.start,w=y.end,R=y.reversed,P=m-2*x,A=(0,s.QZ)(d,"filled"),F=(0,s.QZ)(d,"clipColor"),H=(0,s.QZ)(d,"summaryScoreMode"),Q=(0,s.QZ)(d,"bicolorPivotValue"),Z=(0,s.QZ)(d,"minSize"),_=(0,c.getScale)({...h,range:[0,P],inverted:v}),j=(0,c.getOrigin)(h.scaleType),I=_.domain(),N=I[0],z=I[1],E="log"===h.scaleType,L=Math.log(2),O=z-N,V=0!==O?P/O:0,W=E?Math.log(N)/L:0,X=(E?Math.log(z)/L:0)-W,Y=0!==X?P/X:0,B=(v?[P,0]:[0,P])[0]===P,G=E?e=>{const t=(Math.log(e)/L-W)*Y,o=B?t:P-t;return(0,r.clamp)(o,0,P)+x}:e=>{const t=(e-N)*V,o=B?t:P-t;return(0,r.clamp)(o,0,P)+x},q=e=>A?(e=>G(j)-G(e))(e):Math.max(Z,1),D=1/g;let J=!1,K=Number.NEGATIVE_INFINITY;const U=[],$=N<Q&&z>Q;if("whiskers"===H){let t,s;for(const r of o.values()){(0,l.As)(C);const o=r.get("start"),i=r.get("end"),g=R?(w-i)*D:(o-T)*D,f=R?(w-o)*D:(i-T)*D;if(r.get("summary")){const o=Math.max(f-g+u,Z),l=r.get("maxScore"),i=b(r,l),h=$?i:i===t?s:s=n((0,a.M)(i),.4).toHex();(0,c.fillRectCtx)(g,G(l),o,q(l),e,h),t=i}}s=void 0,t=void 0;for(const r of o.values()){(0,l.As)(C);const o=r.get("start"),n=r.get("end"),i=R?(w-n)*D:(o-T)*D,g=R?(w-o)*D:(n-T)*D,f=r.get("score"),h=r.get("maxScore"),m=r.get("minScore"),d=r.get("summary"),p=b(r,f),M=$&&d?p===t?s:s=(0,a.M)(b(r,h)).mix((0,a.M)(b(r,m))).toString():p,x=Math.max(g-i+u,Z);(Math.floor(i)!==Math.floor(K)||g-i>1)&&(U.push(r),K=i),J=J||f<N||f>z,(0,c.fillRectCtx)(i,G(f),x,q(f),e,M),t=p}s=void 0,t=void 0;for(const r of o.values()){(0,l.As)(C);const o=r.get("start"),n=r.get("end"),g=R?(w-n)*D:(o-T)*D,f=R?(w-o)*D:(n-T)*D;if(r.get("summary")){const o=r.get("minScore"),l=b(r,o),n=Math.max(f-g+u,Z),h=$?l:l===t?s:s=i((0,a.M)(l),.4).toHex();(0,c.fillRectCtx)(g,G(o),n,q(o),e,h),t=l}}}else for(const t of o.values()){(0,l.As)(C);const o=t.get("start"),s=t.get("end"),r=R?(w-s)*D:(o-T)*D,a=R?(w-o)*D:(s-T)*D;(Math.floor(r)!==Math.floor(K)||a-r>1)&&(U.push(t),K=r);const n=t.get("score"),i=b(t,n);J=J||n<N||n>z;const g=Math.max(a-r+u,Z);if("max"===H){const o=t.get("summary")?t.get("maxScore"):n;(0,c.fillRectCtx)(r,G(o),g,q(o),e,i)}else if("min"===H){const o=t.get("summary")?t.get("minScore"):n;(0,c.fillRectCtx)(r,G(o),g,q(o),e,i)}else(0,c.fillRectCtx)(r,G(n),g,q(n),e,i)}if(e.save(),J){e.fillStyle=F;for(const t of o.values()){(0,l.As)(C);const o=t.get("start"),s=t.get("end"),r=R?(w-s)*D:(o-T)*D,a=(R?(w-o)*D:(s-T)*D)-r+u,n=t.get("score");n>z?(0,c.fillRectCtx)(r,x,a,2,e):n<N&&"log"!==h.scaleType&&(0,c.fillRectCtx)(r,m,a,2,e)}}if(e.restore(),M){e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)";for(const t of p.values)e.beginPath(),e.moveTo(0,Math.round(G(t))),e.lineTo(S,Math.round(G(t))),e.stroke()}return{reducedFeatures:U}}}}]);
//# sourceMappingURL=7757.5a715277.chunk.js.map