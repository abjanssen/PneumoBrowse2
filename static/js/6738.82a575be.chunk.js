"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6738],{11158:(e,t,s)=>{s.r(t),s.d(t,{default:()=>$});var n=s(49823),l=s(29499),i=s(68446),o=s(13476),a=s(75785),r=s(7552),c=s(99546),d=s(374),h=s(31892),m=s(16217),u=s(89003),p=s(61723),f=s(48171),g=s(36715),x=s(98360),w=s(69500);const v=(0,a.n9)()((e=>({facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}})));function b({onClick:e}){return(0,w.jsx)(u.A,{title:"Clear selection on this facet filter",children:(0,w.jsx)(p.A,{onClick:()=>{e()},size:"small",children:(0,w.jsx)(h.A,{})})})}function j({visible:e,onClick:t}){return(0,w.jsx)(u.A,{title:"Minimize/expand this facet filter",children:(0,w.jsx)(p.A,{onClick:()=>{t()},size:"small",children:e?(0,w.jsx)(m.A,{}):(0,w.jsx)(d.A,{})})})}const k=(0,i.observer)((function({column:e,vals:t,model:s}){const{classes:n}=v(),[l,i]=(0,r.useState)(!0),{faceted:o}=s,{filters:a}=o,{field:d}=e;return(0,w.jsxs)(f.A,{className:n.facet,fullWidth:!0,children:[(0,w.jsxs)("div",{children:[(0,w.jsx)(g.A,{component:"span",children:d}),(0,w.jsx)(b,{onClick:()=>{o.setFilter(d,[])}}),(0,w.jsx)(j,{visible:l,onClick:()=>{i(!l)}})]}),l?(0,w.jsx)(x.A,{multiple:!0,native:!0,className:n.select,value:a.get(e.field)||[],onChange:t=>{o.setFilter(e.field,[...t.target.options].filter((e=>e.selected)).map((e=>e.value)))},children:t.sort(((e,t)=>e[0].localeCompare(t[0]))).map((([e,t])=>(0,w.jsxs)("option",{value:e,children:[(0,c.coarseStripHTML)(e)," (",t,")"]},e)))}):null]})}));var C=s(6842);const A=(0,i.observer)((function({rows:e,columns:t,model:s}){const{faceted:n}=s,{filters:l}=n,i=t.slice(1),o=new Map(t.slice(1).map((e=>[e.field,new Map]))),a=n.filters.keys(),r=i.map((e=>e.field)),c=new Set;for(const e of a)l.get(e)?.length&&c.add(e);for(const e of r)c.add(e);let d=e;for(const e of c){const t=o.get(e);if(t)for(const s of d){const n=(0,C.a)(e,s),l=t.get(n);n&&(void 0===l?t.set(n,1):t.set(n,l+1))}const s=l.get(e)?.length?new Set(l.get(e)):void 0;d=d.filter((t=>void 0===s||s.has((0,C.a)(e,t))))}return(0,w.jsx)("div",{children:i.map((e=>(0,w.jsx)(k,{vals:[...o.get(e.field)],column:e,model:s},e.field)))})}));var S=s(36793),y=s(76157),M=s(42489),T=s(36422);const H=(0,i.observer)((function({model:e,columns:t,shownTrackIds:s,selection:n}){const{pluginManager:l}=(0,c.getEnv)(e),{view:i,faceted:o}=e,{rows:a,useShoppingCart:d,showOptions:h,filteredRows:m,filteredNonMetadataKeys:u,filteredMetadataKeys:p,visible:f}=o,[g,x]=(0,r.useState)({name:(0,c.measureGridWidth)(a.map((e=>e.name)),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(u.filter((e=>f[e])).map((e=>[e,(0,c.measureGridWidth)(a.map((t=>t[e])),{maxWidth:400,stripHTML:!0})]))),...Object.fromEntries(p.filter((e=>f[`metadata.${e}`])).map((e=>[`metadata.${e}`,(0,c.measureGridWidth)(a.map((t=>t.metadata[e])),{maxWidth:400,stripHTML:!0})])))});return(0,w.jsx)(S.z,{rows:m,onColumnWidthChange:e=>{x({...g,[e.colDef.field]:e.width})},columnVisibilityModel:f,onColumnVisibilityModelChange:t=>{e.faceted.setVisible(t)},columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:t=>{if(d){const s=(0,T.getRoot)(e),n=l.pluggableConfigSchemaType("track");e.setSelection(t.map((e=>(0,T.resolveIdentifier)(n,s,e))))}else{const n=s,l=new Set(t);(0,M.transaction)((()=>{[...n].filter((e=>!l.has(e))).map((e=>i.hideTrack(e))),[...l].filter((e=>!n.has(e))).map((t=>{i.showTrack(t),e.addToRecentlyUsed(t)}))}))}},rowSelectionModel:d?n.map((e=>e.trackId)):[...s],slots:{toolbar:h?y.O:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:t.map((e=>({...e,width:g[e.field]}))),rowHeight:25})}));var W=s(17307),N=s(91819),R=s(1343),F=s(93117),I=s(9469);function G({model:e}){const{faceted:t}=e,[s,l]=(0,r.useState)(null),{showOptions:i,showFilters:o,showSparse:a,useShoppingCart:c}=t;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(N.A,{container:!0,spacing:4,alignItems:"center",children:[(0,w.jsx)(R.A,{label:"Search...",value:t.filterText,onChange:e=>{t.setFilterText(e.target.value)},slotProps:{input:{endAdornment:(0,w.jsx)(F.A,{position:"end",children:(0,w.jsx)(p.A,{onClick:()=>{t.setFilterText("")},children:(0,w.jsx)(h.A,{})})})}}}),(0,w.jsx)(p.A,{onClick:e=>{l(e.currentTarget)},children:(0,w.jsx)(W.A,{})}),(0,w.jsx)(I.A,{model:e})]}),(0,w.jsx)(n.Menu,{anchorEl:s,open:!!s,onClose:()=>{l(null)},onMenuItemClick:(e,t)=>{t(),l(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{t.setUseShoppingCart(!c)},type:"checkbox",checked:c},{label:"Show sparse metadata columns",onClick:()=>{t.setShowSparse(!a)},checked:a,type:"checkbox"},{label:"Show facet filters",onClick:()=>{t.setShowFilters(!o)},checked:o,type:"checkbox"},{label:"Show extra table options",onClick:()=>{t.setShowOptions(!i)},checked:i,type:"checkbox"}]})]})}var O=s(26027);const L=(0,a.n9)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),z=.75,E=(0,i.observer)((function({model:e}){const{classes:t}=L(),{selection:s,shownTrackIds:l,faceted:i}=e,{rows:a,panelWidth:r,showFilters:c,filteredNonMetadataKeys:d,filteredMetadataKeys:h}=i,m=[{field:"name",hideable:!1,renderCell:s=>{const{value:n,row:l}=s,{id:i,conf:a}=l;return(0,w.jsxs)("div",{className:t.cell,children:[(0,w.jsx)(o.A,{html:n}),(0,w.jsx)(O.A,{id:i,conf:a,trackId:i,model:e})]})}},...d.map((e=>({field:e,renderCell:e=>{const s=e.value;return s?(0,w.jsx)(o.A,{className:t.cell,html:s}):""}}))),...h.map((e=>({field:`metadata.${e}`,headerName:["name",...d].includes(e)?`${e} (from metadata)`:e,valueGetter:(t,s)=>`${s.metadata[e]??""}`,renderCell:e=>{const s=e.value;return s?(0,w.jsx)(o.A,{className:t.cell,html:s}):""}})))];return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(G,{model:e}),(0,w.jsxs)("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*z,width:window.innerWidth*z},children:[(0,w.jsx)("div",{style:{height:window.innerHeight*z,width:window.innerWidth*z-(c?r:0)},children:(0,w.jsx)(H,{model:e,columns:m,shownTrackIds:l,selection:s})}),c?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(n.ResizeHandle,{vertical:!0,onDrag:e=>i.setPanelWidth(r-e),className:t.resizeHandle}),(0,w.jsx)("div",{style:{width:r,overflow:"auto"},children:(0,w.jsx)(A,{model:e,rows:a,columns:m})})]}):null]})]})})),$=(0,i.observer)((function(e){const{handleClose:t}=e;return(0,w.jsx)(n.Dialog,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector",children:(0,w.jsx)(l.A,{children:(0,w.jsx)(E,{...e})})})}))},17515:(e,t,s)=>{s.d(t,{A:()=>m});var n=s(7552),l=s(93878),i=s(70799),o=s(51148),a=s(84893),r=s(4785),c=s(89663),d=s(69500);const h=(0,o.Ay)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,!s.disableGutters&&t.gutters,t[s.variant]]}})((0,a.A)((({theme:e})=>({position:"relative",display:"flex",alignItems:"center",variants:[{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}}},{props:{variant:"dense"},style:{minHeight:48}},{props:{variant:"regular"},style:e.mixins.toolbar}]})))),m=n.forwardRef((function(e,t){const s=(0,r.b)({props:e,name:"MuiToolbar"}),{className:n,component:o="div",disableGutters:a=!1,variant:m="regular",...u}=s,p={...s,component:o,disableGutters:a,variant:m},f=(e=>{const{classes:t,disableGutters:s,variant:n}=e,l={root:["root",!s&&"gutters",n]};return(0,i.A)(l,c.U,t)})(p);return(0,d.jsx)(h,{as:o,className:(0,l.A)(f.root,n),ref:t,ownerState:p,...u})}))},89663:(e,t,s)=>{s.d(t,{A:()=>o,U:()=>i});var n=s(33761),l=s(85693);function i(e){return(0,l.Ay)("MuiToolbar",e)}const o=(0,n.A)("MuiToolbar",["root","gutters","regular","dense"])}}]);
//# sourceMappingURL=6738.82a575be.chunk.js.map