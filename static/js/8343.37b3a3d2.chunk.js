"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8343],{98343:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(32598),r=a(9502),n=a(46377),c=a(99546),i=a(99834),o=a(66885),l=a(54702);class u extends n.BaseFeatureDataAdapter{calculatedIntervalTreeMap={};static capabilities=["getFeatures","getRefNames"];async getHeader(){const{header:e}=await this.setup();return e}async getMetadata(){const{header:e}=await this.setup();return new r.A({header:e}).getMetadata()}async setupP(e){const{statusCallback:t=()=>{}}=e||{},a=(0,i.openLocation)(this.getConf("vcfLocation"),this.pluginManager),n=await(0,c.fetchAndMaybeUnzip)(a,e),o=[],u={};let h=0;const d=new TextDecoder("utf8");let p=0;for(;h<n.length;){const e=n.indexOf("\n",h),a=-1===e?n.subarray(h):n.subarray(h,e),s=d.decode(a).trim();if(s)if(s.startsWith("#"))o.push(s);else{const e=s.indexOf("\t"),t=s.slice(0,e);u[t]||(u[t]=[]),u[t].push(s)}p++%1e4==0&&t(`Loading ${Math.floor(h/1e6).toLocaleString("en-US")}/${Math.floor(n.length/1e6).toLocaleString("en-US")} MB`),h=e+1}const f=o.join("\n"),g=new r.A({header:f});return{header:f,intervalTreeMap:Object.fromEntries(Object.entries(u).map((([e,t])=>[e,a=>{if(!this.calculatedIntervalTreeMap[e]){a?.("Parsing VCF data");let r=0;const n=new s.Ay;for(const a of t){const t=new l.A({variant:g.parseLine(a),parser:g,id:`${this.id}-${e}-${r++}`});n.insert([t.get("start"),t.get("end")],t)}this.calculatedIntervalTreeMap[e]=n}return this.calculatedIntervalTreeMap[e]}])))}}async setup(){return this.vcfFeatures||(this.vcfFeatures=this.setupP().catch((e=>{throw this.vcfFeatures=void 0,e}))),this.vcfFeatures}async getRefNames(e={}){const{intervalTreeMap:t}=await this.setup();return Object.keys(t)}getFeatures(e,t={}){return(0,o.ObservableCreate)((async a=>{try{const{start:s,end:r,refName:n}=e,{intervalTreeMap:c}=await this.setup();c[n]?.(t.statusCallback).search([s,r]).forEach((e=>{a.next(e)})),a.complete()}catch(e){a.error(e)}}),t.stopToken)}freeResources(){}}}}]);
//# sourceMappingURL=8343.37b3a3d2.chunk.js.map