"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8207],{21206(t,e,o){o.d(e,{u:()=>u});var s=o(11259),a=o(77251),r=o(19598),l=o(52901),c=o(27535);function n(t,e){const o=t.toHsl(),s=o.l*(1+e);return(0,r.M)({...o,l:(0,a.clamp)(s,0,100)})}function i(t,e){const o=t.toHsl(),s=o.l*(1-e);return(0,r.M)({...o,l:(0,a.clamp)(s,0,100)})}const g=.3;function u(t,e){const{features:o,bpPerPx:u,regions:f,scaleOpts:m,height:h,config:d,ticks:x,displayCrossHatches:M,offset:p=0,colorCallback:b,inverted:v,stopToken:C,lastCheck:k=(0,l.jL)(C)}=e,y=f[0],S=(y.end-y.start)/u,T=y.start,w=y.end,R=y.reversed,P=h-2*p,A=(0,s.QZ)(d,"filled"),H=(0,s.QZ)(d,"clipColor"),Q=(0,s.QZ)(d,"summaryScoreMode"),Z=(0,s.QZ)(d,"bicolorPivotValue"),_=(0,s.QZ)(d,"minSize"),F=(0,c.getScale)({...m,range:[0,P],inverted:v}),I=(0,c.getOrigin)(m.scaleType),N=F.domain(),j=N[0],z=N[1],E="log"===m.scaleType,O=Math.log(2),V=z-j,W=0!==V?P/V:0,X=E?Math.log(j)/O:0,Y=(E?Math.log(z)/O:0)-X,G=0!==Y?P/Y:0,L=(v?[P,0]:[0,P])[0]===P,q=E?t=>{const e=(Math.log(t)/O-X)*G,o=L?e:P-e;return(0,a.clamp)(o,0,P)+p}:t=>{const e=(t-j)*W,o=L?e:P-e;return(0,a.clamp)(o,0,P)+p},B=t=>A?(t=>q(I)-q(t))(t):Math.max(_,1),D=1/u;let J=!1,K=Number.NEGATIVE_INFINITY;const U=[],$=j<Z&&z>Z;if("whiskers"===Q){let e,s;for(const a of o.values()){(0,l.As)(k);const o=a.get("start"),i=a.get("end"),u=R?(w-i)*D:(o-T)*D,f=R?(w-o)*D:(i-T)*D;if(a.get("summary")){const o=Math.max(f-u+g,_),l=a.get("maxScore"),i=b(a,l),m=$?i:i===e?s:s=n((0,r.M)(i),.4).toHex();(0,c.fillRectCtx)(u,q(l),o,B(l),t,m),e=i}}s=void 0,e=void 0;for(const a of o.values()){(0,l.As)(k);const o=a.get("start"),n=a.get("end"),i=R?(w-n)*D:(o-T)*D,u=R?(w-o)*D:(n-T)*D,f=a.get("score"),m=a.get("maxScore"),h=a.get("minScore"),d=a.get("summary"),x=b(a,f),M=$&&d?x===e?s:s=(0,r.M)(b(a,m)).mix((0,r.M)(b(a,h))).toString():x,p=Math.max(u-i+g,_);(Math.floor(i)!==Math.floor(K)||u-i>1)&&(U.push(a),K=i),J=J||f<j||f>z,(0,c.fillRectCtx)(i,q(f),p,B(f),t,M),e=x}s=void 0,e=void 0;for(const a of o.values()){(0,l.As)(k);const o=a.get("start"),n=a.get("end"),u=R?(w-n)*D:(o-T)*D,f=R?(w-o)*D:(n-T)*D;if(a.get("summary")){const o=a.get("minScore"),l=b(a,o),n=Math.max(f-u+g,_),m=$?l:l===e?s:s=i((0,r.M)(l),.4).toHex();(0,c.fillRectCtx)(u,q(o),n,B(o),t,m),e=l}}}else for(const e of o.values()){(0,l.As)(k);const o=e.get("start"),s=e.get("end"),a=R?(w-s)*D:(o-T)*D,r=R?(w-o)*D:(s-T)*D;(Math.floor(a)!==Math.floor(K)||r-a>1)&&(U.push(e),K=a);const n=e.get("score"),i=b(e,n);J=J||n<j||n>z;const u=Math.max(r-a+g,_);if("max"===Q){const o=e.get("summary")?e.get("maxScore"):n;(0,c.fillRectCtx)(a,q(o),u,B(o),t,i)}else if("min"===Q){const o=e.get("summary")?e.get("minScore"):n;(0,c.fillRectCtx)(a,q(o),u,B(o),t,i)}else(0,c.fillRectCtx)(a,q(n),u,B(n),t,i)}if(t.save(),J){t.fillStyle=H;for(const e of o.values()){(0,l.As)(k);const o=e.get("start"),s=e.get("end"),a=R?(w-s)*D:(o-T)*D,r=(R?(w-o)*D:(s-T)*D)-a+g,n=e.get("score");n>z?(0,c.fillRectCtx)(a,p,r,2,t):n<j&&"log"!==m.scaleType&&(0,c.fillRectCtx)(a,h,r,2,t)}}if(t.restore(),M){t.lineWidth=1,t.strokeStyle="rgba(200,200,200,0.5)";for(const e of x.values)t.beginPath(),t.moveTo(0,Math.round(q(e))),t.lineTo(S,Math.round(q(e))),t.stroke()}return{reducedFeatures:U}}},98207(t,e,o){o.d(e,{renderXYPlot:()=>i});var s=o(77251),a=o(83640),r=o(16876),l=o(26931),c=o(21206),n=o(27535);async function i(t,e){const{config:o,height:i,regions:g,bpPerPx:u,statusCallback:f=()=>{}}=t,m=g[0],h=(m.end-m.start)/u,d=(0,n.getColorCallback)(o),{reducedFeatures:x,...M}=await(0,s.updateStatus)("Rendering plot",f,()=>(0,a.u)(h,i,t,o=>(0,c.u)(o,{...t,colorCallback:d,features:e}))),p={...M,features:x.map(n.serializeWiggleFeature),height:i,width:h};return(0,r.lk)(p,(0,l.X)(M))}}}]);
//# sourceMappingURL=8207.9fd7b271.chunk.js.map