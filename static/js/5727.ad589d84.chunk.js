"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5727],{95727:(e,t,r)=>{r.d(t,{A:()=>F});var n=r(68446),o=r(7552),a=r(99546),s=r(51414),i=r(36422),l=r(350);function c(e,t){const r=e.get("ALT");if(r)return new Map(r.map(e=>(0,l.h)(e)).filter(a.notEmpty).map(e=>[e.MatePosition,e])).get(`${t.get("refName")}:${t.get("start")+1}`)}var u=r(49473),d=r(62266);const g={F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},f={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"},p={color_fwd_strand_not_proper:(0,d.X4)("#CA6767",.8),color_rev_strand_not_proper:(0,d.X4)("#7272AA",.8),color_fwd_strand:(0,d.X4)("#DC2A2A",.8),color_rev_strand:(0,d.X4)("#4141BA",.8),color_fwd_missing_mate:(0,d.X4)("#921111",.8),color_rev_missing_mate:(0,d.X4)("#111192",.8),color_fwd_diff_chr:(0,d.X4)("#000000",.8),color_rev_diff_chr:(0,d.X4)("#696969",.8),color_pair_lr:(0,d.X4)("#8C8C8C",.8),color_pair_rr:(0,d.X4)("#00005A",.8),color_pair_rl:(0,d.X4)("#005A5A",.8),color_pair_ll:(0,d.X4)("#005A00",.8),color_nostrand:(0,d.X4)("#8C8C8C",.8),color_interchrom:(0,d.X4)("#5A005A",.8),color_longinsert:(0,d.X4)("#B30000",.8),color_shortinsert:(0,d.X4)("#FF3A5C",.8),color_unknown:(0,d.X4)("#555",.8)},h=p.color_unknown;function v(e,t){return-1===e&&1===t?p.color_pair_rr:1===e&&-1===t?p.color_pair_ll:p.color_unknown}function m(e,t){return-1===e&&1===t||1===e&&-1===t}function _(e){return"LR"!==g[e.pair_orientation||""]}function k(e){return function(e){const t=g[e.pair_orientation||""];return"LR"===t?void 0:p[f[t]]}(e)||h}var w=r(69500);const[R,,T]=[0,1,2,3],M=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:l,views:c,showIntraviewLinks:d}=e,g=(0,s.A)(),f=(0,a.getSession)(e),p=(0,i.getSnapshot)(e),{assemblyManager:h}=f,M=c[0],N=M?h.get(M.assemblyNames[0]):void 0;(0,u.E6)(p);const S=e.getTrackFeatures(t),y=(0,o.useMemo)(()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(S),[S]),L=(0,o.useMemo)(()=>{const r=e.getMatchedFeaturesInLayout(t,y?function(e){const t=new Map,r=new Set,n=new Set;for(const o of e.values()){const e=o.get("flags"),s=o.id(),i=(0,a.assembleLocStringFast)({refName:o.get("refName"),start:o.get("start"),end:o.get("end")}),l=4&e,c=2&e;if(!(r.has(s)||n.has(i)||c||l)){const e=o.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(o)}r.add(o.id()),n.add(i)}return[...t.values()].filter(e=>e.length>1)}(S):function(e){const t=new Map,r=new Set;for(const n of e.values()){const e=n.id(),o=4&n.get("flags"),a=!!n.get("tags")?.SA;if(!r.has(e)&&!o&&a){const e=n.get("name");let r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}r.add(n.id())}return[...t.values()].filter(e=>e.length>1)}(S));if(!y)for(const e of r)e.sort((e,t)=>e.clipPos-t.clipPos);return r},[S,t,y,e]),[b,O]=(0,o.useState)();let C=0;if(r.current){const e=r.current.getBoundingClientRect();C=e.top}return N?(0,w.jsx)("g",{fill:"none","data-testid":L.length?`${t}-loaded`:t,children:L.map(e=>{const r=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:i,level:p}=e[o],{layout:h,feature:M,level:L}=e[o+1];if(!s||!h)return console.warn("received null layout for a overlay feature"),null;if(!d&&p===L)return null;const F=N.getCanonicalRefName(i.get("refName")),A=N.getCanonicalRefName(M.get("refName"));if(!F||!A)throw new Error(`unable to find ref for ${F||A}`);const W={pair_orientation:i.get("pair_orientation")},E=i.get("strand"),x=M.get("strand");let j="",X=!1;F===A&&(y?(j=k(W),X=_(W)):(j=v(E,x),X=m(E,x)));const B=s[-1===E?R:T],$=-1===x,J=y?h[$?R:T]:h[$?T:R],I=(0,u.Tp)(c[p],F,B),P=(0,u.Tp)(c[L],A,J),D=c[p].pxToBp(I).reversed?-1:1,V=c[L].pxToBp(P).reversed?-1:1,Y=c.map(e=>e.getTrack(t)),H=(0,u.Ec)(t,p,c,Y,s,n)-C,q=(0,u.Ec)(t,L,c,Y,h,n)-C,z=p===L&&X,G=z?Y[p].displays[0].height:0,K=y?-1:1,Q=(0,u.eW)(c,t,p,n),U=["M",I,H,"C",I+200*i.get("strand")*D,z?Math.min(Q-C+G,H+G):H,P-200*M.get("strand")*V*K,z?Math.min(Q-C+G,q+G):q,P,q].join(" "),Z=`${i.id()}-${M.id()}`;r.push((0,w.jsx)("path",{d:U,"data-testid":"r1",pointerEvents:l?"auto":void 0,strokeWidth:b===Z?5:1,...(0,a.getStrokeProps)(j||g.palette.text.disabled),onClick:()=>{const e=f.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(S.get(i.id())||{toJSON:()=>{}}).toJSON(),feature2:(S.get(M.id())||{toJSON:()=>{}}).toJSON()}});f.showWidget?.(e)},onMouseOver:()=>{O(Z)},onMouseOut:()=>{O(void 0)}},Z))}return r})}):null}),[N]=[0,1,2,3],S=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:s,views:d}=e,g=(0,a.getSession)(e),{assemblyManager:f}=g,p=e.getTrackFeatures(t),h=(0,o.useMemo)(()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"breakend"===n.get("type")){const e=n.get("ALT");if(e)for(const r of e){const e=`${n.get("refName")}:${n.get("start")+1}`,o=(0,l.h)(r);if(o){const r=t.get(e);r?r.push(n):t.set(o.MatePosition||"none",[n])}}}r.add(n.id())}return[...t.values()].filter(e=>e.length>1)}(p)),[p,t,e]),[v,m]=(0,o.useState)(),_=(0,i.getSnapshot)(e);(0,u.E6)(_);const k=f.get(d[0].assemblyNames[0]);if(!k)return null;let R=0;if(r.current){const e=r.current.getBoundingClientRect();R=e.top}return(0,w.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":h.length?`${t}-loaded`:t,children:h.map(e=>{const r=[];for(let o=0;o<e.length-1;o+=1){const{layout:a,feature:i,level:l}=e[o],{layout:f,feature:h,level:_}=e[o+1],T=i.id(),M=c(i,h);if(!a||!f)return null;const S=i.get("refName"),y=h.get("refName"),L=k.getCanonicalRefName(S),b=k.getCanonicalRefName(y);if(!L||!b)throw new Error(`unable to find ref for ${L||b}`);const O=(0,u.Tp)(d[l],L,a[N]),C=(0,u.Tp)(d[_],b,f[N]),F=d[l].pxToBp(O).reversed,A=d[_].pxToBp(C).reversed,W=d.map(e=>e.getTrack(t)),E=(0,u.Ec)(t,l,d,W,a,n)-R,x=(0,u.Ec)(t,_,d,W,f,n)-R;if(M){const e=["M",O-20*("left"===M.Join?-1:1)*(F?-1:1),E,"L",O,E,"L",C,x,"L",C-20*("left"===M.MateDirection?1:-1)*(A?-1:1),x].join(" ");r.push((0,w.jsx)("path",{d:e,"data-testid":"r2",pointerEvents:s?"auto":void 0,strokeWidth:T===v?10:5,onClick:()=>{const e=g.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:p.get(T)?.toJSON()});g.showWidget?.(e)},onMouseOver:()=>{m(T)},onMouseOut:()=>{m(void 0)}},JSON.stringify(e)))}else console.warn("the relevant ALT allele was not found, cannot render")}return r})})}),[y]=[0,1,2,3],L=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:s,views:l}=e,c=(0,a.getSession)(e),{assemblyManager:d}=c,g=e.getTrackFeatures(t),f=(0,o.useMemo)(()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,r=new Set;for(const n of e.values()){if(!r.has(n.id())&&"paired_feature"===n.get("type")){const e=n.id().replace("-r1",""),r=n.id().replace("-r2","");n.id().endsWith("-r1")?(t.get(e)||t.set(e,[]),t.get(e).push(n)):n.id().endsWith("-r2")&&(t.get(r)||t.set(r,[]),t.get(r).push(n))}r.add(n.id())}return[...t.values()].filter(e=>e.length>1)}(g)),[g,t,e]),[p,h]=(0,o.useState)(),v=(0,i.getSnapshot)(e);(0,u.E6)(v);const m=d.get(l[0].assemblyNames[0]);if(!m)return null;let _=0;if(r.current){const e=r.current.getBoundingClientRect();_=e.top}return(0,w.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":f.length?`${t}-loaded`:t,children:f.map(e=>{const r=[];for(let o=0;o<e.length-1;o+=1){const{layout:a,feature:i,level:d}=e[o],{layout:f,feature:v,level:k}=e[o+1],R=i.id();if(!a||!f)return null;const T=i.get("refName"),M=v.get("refName"),N=m.getCanonicalRefName(T),S=m.getCanonicalRefName(M);if(!N||!S)throw new Error(`unable to find ref for ${N||S}`);const L=(0,u.Tp)(l[d],N,a[y]),b=(0,u.Tp)(l[k],S,f[y]),O=l.map(e=>e.getTrack(t)),C=["M",L,(0,u.Ec)(t,d,l,O,a,n)-_,"L",b,(0,u.Ec)(t,k,l,O,f,n)-_].join(" ");r.push((0,w.jsx)("path",{d:C,"data-testid":"r2",pointerEvents:s?"auto":void 0,strokeWidth:R===p?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:g.get(R)?.toJSON()});c.showWidget?.(e)},onMouseOver:()=>{h(R)},onMouseOut:()=>{h(void 0)}},JSON.stringify(C)))}return r})})}),[b]=[0,1,2,3];function O(e){return"+"===e?1:"-"===e?-1:0}const C=(0,n.observer)(function({model:e,trackId:t,parentRef:r,getTrackYPosOverride:n}){const{interactiveOverlay:s,views:l}=e,c=(0,a.getSession)(e),{assemblyManager:d}=c,g=e.getTrackFeatures(t),f=(0,o.useMemo)(()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],r=new Set;for(const n of e.values())r.has(n.id())||"<TRA>"!==n.get("ALT")[0]||t.push([n]),r.add(n.id());return t}(g)),[g,t,e]),[p,h]=(0,o.useState)(),v=(0,i.getSnapshot)(e);if((0,u.E6)(v),!d.get(l[0].assemblyNames[0]))return null;let m=0;if(r.current){const e=r.current.getBoundingClientRect();m=e.top}return l.length<2?null:(0,w.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":f.length?`${t}-loaded`:t,children:f.map(e=>{const r=[];for(const{layout:o,feature:a,level:i}of e){const e=0===i?1:0,d=a.id();if(!o)return null;const f=a.get("INFO"),v=f.CHR2[0],_=f.END[0],k=f.STRANDS?.[0]?.split(""),[R,T]=k??[".","."],M=(0,u.Tp)(l[e],v,_);if(M){const f=[M,0,M+1,0],v=(0,u.Tp)(l[i],a.get("refName"),o[b]),_=M,k=l[i].pxToBp(v).reversed,N=l[e].pxToBp(_).reversed,S=l.map(e=>e.getTrack(t)),y=(0,u.Ec)(t,i,l,S,o,n)-m,L=(0,u.Ec)(t,e,l,S,f,n)-m,C=["M",v-20*O(R)*(k?-1:1),y,"L",v,y,"L",_,L,"L",_-20*O(T)*(N?-1:1),L].join(" ");r.push((0,w.jsx)("path",{d:C,pointerEvents:s?"auto":void 0,strokeWidth:d===p?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(g.get(d)||{toJSON:()=>{}}).toJSON()});c.showWidget?.(e)},onMouseOver:()=>{h(d)},onMouseOut:()=>{h(void 0)}},JSON.stringify(C)))}}return r})})}),F=(0,n.observer)(function(e){const{model:t,trackId:r}=e,n=t.getMatchedTracks(r),o=n[0]?.type;return"AlignmentsTrack"===o?(0,w.jsx)(M,{...e}):"VariantTrack"===o?t.hasTranslocations(r)?(0,w.jsx)(C,{...e}):t.hasPairedFeatures(r)?(0,w.jsx)(L,{...e}):(0,w.jsx)(S,{...e}):null})}}]);
//# sourceMappingURL=5727.ad589d84.chunk.js.map