{"version":3,"file":"static/js/8261.f6735c92.chunk.js","mappings":"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","sources":["../../../packages/app-core/src/DockviewLayout/index.ts","../../../packages/product-core/src/Session/BaseSession.ts","../../../packages/core/src/PluginLoader.ts","useQueryParam.ts","../../../packages/product-core/src/Session/Connections.ts","util.ts","../../../plugins/data-management/src/index.ts","sessionSharing.ts","../../../packages/core/src/ui/Icons.tsx","../../../packages/product-core/src/Session/MultipleViews.ts","../../../packages/product-core/src/Session/DrawerWidgets.ts","../../../packages/core/src/util/index.ts","../../../packages/core/src/ui/Snackbar.tsx","../../../packages/app-core/src/ui/App/AppFab.tsx","../../../packages/core/src/ui/AppLogo.tsx","../../../packages/core/src/ui/DropDownMenu.tsx","../../../packages/app-core/src/ui/App/AppToolbar.tsx","../../../packages/app-core/src/ui/App/DialogQueue.tsx","../../../packages/app-core/src/ui/App/ViewsContainer.tsx","../../../packages/app-core/src/ui/App/App.tsx","components/FileHandleRestoreBanner.tsx","components/ShareButton.tsx","components/JBrowse.tsx","checkPlugins.ts","SessionLoader.ts","loadSessionSpec.ts","../../../packages/core/src/util/TimeTraveller.ts","../../../packages/app-core/src/menus.ts","../../../packages/core/src/rpc/BaseRpcDriver.ts","../../../packages/core/src/rpc/MainThreadRpcDriver.ts","../../../packages/core/src/rpc/WebWorkerRpcDriver.ts","../../../packages/core/src/rpc/baseRpcConfig.ts","../../../packages/core/src/rpc/mainThreadRpcConfig.ts","../../../packages/core/src/rpc/webWorkerRpcConfig.ts","../../../packages/core/src/rpc/configSchema.ts","../../../packages/core/src/rpc/RpcManager.ts","../../../packages/core/src/assemblyManager/assembly.ts","../../../packages/app-core/src/JBrowseConfig/RootConfiguration.ts","../../../packages/product-core/src/RootModel/FormatDetails.ts","../../../packages/product-core/src/RootModel/FormatAbout.ts","../../../packages/product-core/src/RootModel/HierarchicalConfig.ts","makeWorkerInstance.ts","jbrowseModel.ts","rootModel/rootModel.ts","../../../packages/core/src/assemblyManager/assemblyConfigSchema.ts","../../../packages/app-core/src/JBrowseModel/index.ts","../../../packages/app-core/src/JBrowseConfig/index.ts","../../../packages/product-core/src/RootModel/BaseRootModel.ts","../../../packages/core/src/assemblyManager/assemblyManager.ts","../../../packages/product-core/src/RootModel/InternetAccounts.ts","../../../packages/app-core/src/HistoryManagement/index.ts","../../../packages/app-core/src/RootMenu/index.ts","../../../packages/core/src/ui/SnackbarModel.tsx","../../../packages/product-core/src/Session/ReferenceManagement.ts","../../../packages/web-core/src/BaseWebSession/index.ts","../../../packages/product-core/src/Session/DialogQueue.ts","../../../packages/product-core/src/Session/Themes.ts","../../../packages/product-core/src/Session/SessionTracks.ts","../../../packages/product-core/src/Session/Tracks.ts","../../../packages/app-core/src/Assemblies/SessionAssembliesMixin.ts","../../../packages/app-core/src/Assemblies/TemporaryAssembliesMixin.ts","../../../packages/web-core/src/SessionConnections.ts","../../../packages/app-core/src/AppFocus/index.ts","sessionModel/index.ts","createPluginManager.ts","loadHubSpec.ts","../../../packages/core/src/util/analytics.ts","components/Loader.tsx","factoryReset.ts"],"sourcesContent":["import { types } from '@jbrowse/mobx-state-tree'\n\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\nimport type { SerializedDockview } from 'dockview-react'\n\n/**\n * Nested layout structure for initializing dockview.\n * A node is either a panel (has viewIds) or a container (has children).\n */\nexport interface DockviewLayoutNode {\n  // Panel node - view IDs to display stacked vertically\n  viewIds?: string[]\n  // Container node - arranges children in a direction\n  direction?: 'horizontal' | 'vertical'\n  children?: DockviewLayoutNode[]\n  // Size as percentage (0-100) of the parent container\n  size?: number\n}\n\n/**\n * #stateModel DockviewLayoutMixin\n * Session mixin that persists dockview layout state.\n * Each dockview panel can contain multiple views stacked vertically.\n */\nexport function DockviewLayoutMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       * Serialized dockview layout state\n       */\n      dockviewLayout: types.maybe(types.frozen<SerializedDockview>()),\n      /**\n       * #property\n       * Maps panel IDs to arrays of view IDs (for stacking views within a panel)\n       */\n      panelViewAssignments: types.optional(\n        types.map(types.array(types.string)),\n        {},\n      ),\n      /**\n       * #property\n       * Initial layout configuration from URL params. Processed once then cleared.\n       */\n      init: types.frozen<DockviewLayoutNode | undefined>(),\n      /**\n       * #property\n       * The currently active panel ID in dockview\n       */\n      activePanelId: types.maybe(types.string),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       * Get view IDs for a specific panel\n       */\n      getViewIdsForPanel(panelId: string) {\n        return self.panelViewAssignments.get(panelId) ?? []\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * Save the current dockview layout\n       */\n      setDockviewLayout(layout: SerializedDockview | undefined) {\n        self.dockviewLayout = layout\n      },\n\n      /**\n       * #action\n       * Set the active panel ID\n       */\n      setActivePanelId(panelId: string | undefined) {\n        self.activePanelId = panelId\n      },\n\n      /**\n       * #action\n       * Set the initial layout configuration (from URL params)\n       */\n      setInit(init: DockviewLayoutNode | undefined) {\n        self.init = init\n      },\n\n      /**\n       * #action\n       * Assign a view to a panel (adds to the panel's view stack)\n       */\n      assignViewToPanel(panelId: string, viewId: string) {\n        const existing = self.panelViewAssignments.get(panelId)\n        if (existing) {\n          if (!existing.includes(viewId)) {\n            existing.push(viewId)\n          }\n        } else {\n          self.panelViewAssignments.set(panelId, [viewId])\n        }\n      },\n\n      /**\n       * #action\n       * Remove a view from its panel\n       */\n      removeViewFromPanel(viewId: string) {\n        for (const [panelId, viewIds] of self.panelViewAssignments.entries()) {\n          const idx = viewIds.indexOf(viewId)\n          if (idx !== -1) {\n            viewIds.splice(idx, 1)\n            if (viewIds.length === 0) {\n              self.panelViewAssignments.delete(panelId)\n            }\n            break\n          }\n        }\n      },\n\n      /**\n       * #action\n       * Remove a panel and all its view assignments\n       */\n      removePanel(panelId: string) {\n        self.panelViewAssignments.delete(panelId)\n      },\n\n      /**\n       * #action\n       * Move a view up within its panel's view stack\n       */\n      moveViewUpInPanel(viewId: string) {\n        for (const viewIds of self.panelViewAssignments.values()) {\n          const idx = viewIds.indexOf(viewId)\n          if (idx > 0) {\n            const temp = viewIds[idx - 1]!\n            viewIds[idx - 1] = viewIds[idx]!\n            viewIds[idx] = temp\n            break\n          }\n        }\n      },\n\n      /**\n       * #action\n       * Move a view down within its panel's view stack\n       */\n      moveViewDownInPanel(viewId: string) {\n        for (const viewIds of self.panelViewAssignments.values()) {\n          const idx = viewIds.indexOf(viewId)\n          if (idx !== -1 && idx < viewIds.length - 1) {\n            const temp = viewIds[idx + 1]!\n            viewIds[idx + 1] = viewIds[idx]!\n            viewIds[idx] = temp\n            break\n          }\n        }\n      },\n\n      /**\n       * #action\n       * Move a view to the top of its panel's view stack\n       */\n      moveViewToTopInPanel(viewId: string) {\n        for (const viewIds of self.panelViewAssignments.values()) {\n          const idx = viewIds.indexOf(viewId)\n          if (idx > 0) {\n            viewIds.splice(idx, 1)\n            viewIds.unshift(viewId)\n            break\n          }\n        }\n      },\n\n      /**\n       * #action\n       * Move a view to the bottom of its panel's view stack\n       */\n      moveViewToBottomInPanel(viewId: string) {\n        for (const viewIds of self.panelViewAssignments.values()) {\n          const idx = viewIds.indexOf(viewId)\n          if (idx !== -1 && idx < viewIds.length - 1) {\n            viewIds.splice(idx, 1)\n            viewIds.push(viewId)\n            break\n          }\n        }\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const {\n        dockviewLayout,\n        panelViewAssignments,\n        init: _init,\n        activePanelId,\n        ...rest\n      } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        ...(dockviewLayout !== undefined ? { dockviewLayout } : {}),\n        // mst types wrong, nullish needed\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        ...(panelViewAssignments && Object.keys(panelViewAssignments).length\n          ? { panelViewAssignments }\n          : {}),\n        ...(activePanelId !== undefined ? { activePanelId } : {}),\n      } as typeof snap\n    })\n}\n\nexport type DockviewLayoutMixinType = ReturnType<typeof DockviewLayoutMixin>\nexport type SessionWithDockviewLayout = Instance<DockviewLayoutMixinType>\n\nexport function isSessionWithDockviewLayout(\n  session: IAnyStateTreeNode,\n): session is SessionWithDockviewLayout {\n  return 'dockviewLayout' in session && 'setDockviewLayout' in session\n}\n","import { ElementId } from '@jbrowse/core/util/types/mst'\nimport { getParent, isStateTreeNode, types } from '@jbrowse/mobx-state-tree'\n\nimport type { BaseRootModelType } from '../RootModel/BaseRootModel.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel BaseSessionModel\n *\n * base session shared by all JBrowse products. Be careful what you include\n * here, everything will use it.\n */\nexport function BaseSessionModel<\n  ROOT_MODEL_TYPE extends BaseRootModelType,\n  JB_CONFIG_SCHEMA extends AnyConfigurationSchemaType,\n>(_pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      name: types.string,\n      /**\n       * #property\n       */\n      margin: 0,\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       * this is the globally \"selected\" object. can be anything. code that\n       * wants to deal with this should examine it to see what kind of thing it\n       * is.\n       */\n      selection: undefined as unknown,\n      /**\n       * #volatile\n       * this is the globally \"hovered\" object. can be anything. code that\n       * wants to deal with this should examine it to see what kind of thing it\n       * is.\n       */\n      hovered: undefined as unknown,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get root() {\n        return getParent<ROOT_MODEL_TYPE>(self)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get jbrowse() {\n        return self.root.jbrowse\n      },\n      /**\n       * #getter\n       */\n      get rpcManager() {\n        return self.root.rpcManager\n      },\n      /**\n       * #getter\n       */\n      get configuration(): Instance<JB_CONFIG_SCHEMA> {\n        return this.jbrowse.configuration\n      },\n      /**\n       * #getter\n       */\n      get adminMode() {\n        return self.root.adminMode\n      },\n\n      /**\n       * #getter\n       */\n      get textSearchManager() {\n        return self.root.textSearchManager\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblies(): Instance<BaseAssemblyConfigSchema>[] {\n        return self.jbrowse.assemblies\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * set the global selection, i.e. the globally-selected object. can be a\n       * feature, a view, just about anything\n       */\n      setSelection(thing: unknown) {\n        self.selection = thing\n      },\n\n      /**\n       * #action\n       * clears the global selection\n       */\n      clearSelection() {\n        self.selection = undefined\n      },\n      /**\n       * #action\n       */\n      setHovered(thing: unknown) {\n        self.hovered = thing\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { margin, ...rest } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        ...(margin ? { margin } : {}),\n      } as typeof snap\n    })\n}\n\n/** Session mixin MST type for the most basic session */\nexport type BaseSessionType = ReturnType<typeof BaseSessionModel>\n\n/** Instance of the most basic possible session */\nexport type BaseSession = Instance<BaseSessionType>\n\n/** Type guard for BaseSession */\nexport function isBaseSession(thing: IAnyStateTreeNode): thing is BaseSession {\n  return 'id' in thing && 'name' in thing && 'root' in thing\n}\n\n/** Type guard for whether a thing is JBrowse session */\nexport function isSession(thing: unknown): thing is BaseSession {\n  return isStateTreeNode(thing) && isBaseSession(thing)\n}\n","import Plugin from './Plugin.ts'\nimport ReExports from './ReExports/index.ts'\nimport { isElectron } from './util/index.ts'\n\nimport type { PluginConstructor } from './Plugin.ts'\n\nexport interface UMDLocPluginDefinition {\n  umdLoc: {\n    uri: string\n    baseUri?: string\n  }\n  name: string\n}\n\nexport interface UMDUrlPluginDefinition {\n  umdUrl: string\n  name: string\n}\n\nexport interface LegacyUMDPluginDefinition {\n  url: string\n  name: string\n}\n\ntype UMDPluginDefinition = UMDLocPluginDefinition | UMDUrlPluginDefinition\n\nexport function isUMDPluginDefinition(\n  def: PluginDefinition,\n): def is UMDPluginDefinition | LegacyUMDPluginDefinition {\n  return (\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    ((def as UMDUrlPluginDefinition).umdUrl !== undefined ||\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      (def as LegacyUMDPluginDefinition).url !== undefined ||\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      (def as UMDLocPluginDefinition).umdLoc !== undefined) &&\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    (def as LegacyUMDPluginDefinition | UMDPluginDefinition).name !== undefined\n  )\n}\n\nexport interface ESMLocPluginDefinition {\n  esmLoc: {\n    uri: string\n    baseUri?: string\n  }\n}\nexport interface ESMUrlPluginDefinition {\n  esmUrl: string\n}\n\nexport type ESMPluginDefinition =\n  | ESMLocPluginDefinition\n  | ESMUrlPluginDefinition\n\nexport function isESMPluginDefinition(\n  def: PluginDefinition,\n): def is ESMPluginDefinition {\n  return (\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    (def as ESMUrlPluginDefinition).esmUrl !== undefined ||\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    (def as ESMLocPluginDefinition).esmLoc !== undefined\n  )\n}\n\nexport interface CJSPluginDefinition {\n  cjsUrl: string\n}\n\nfunction promisifiedLoadScript(src: string) {\n  return new Promise<string>((resolve, reject) => {\n    const script = document.createElement('script')\n    script.type = 'text/javascript'\n    script.async = true\n    script.src = src\n    script.onload = () => {\n      resolve(script.src)\n    }\n    script.onerror = () => {\n      reject(new Error(`Failed to load script: ${src}`))\n    }\n    document.head.append(script)\n  })\n}\n\nasync function loadScript(scriptUrl: string) {\n  if (!isInWebWorker()) {\n    return promisifiedLoadScript(scriptUrl)\n  }\n\n  // @ts-expect-error\n  if (globalThis.importScripts) {\n    // @ts-expect-error\n    await globalThis.importScripts(scriptUrl)\n    return\n  }\n  throw new Error(\n    'cannot figure out how to load external JS scripts in this environment',\n  )\n}\n\nexport function isCJSPluginDefinition(\n  def: PluginDefinition,\n): def is CJSPluginDefinition {\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  return (def as CJSPluginDefinition).cjsUrl !== undefined\n}\n\nexport type PluginDefinition =\n  | UMDUrlPluginDefinition\n  | UMDLocPluginDefinition\n  | LegacyUMDPluginDefinition\n  | ESMLocPluginDefinition\n  | ESMUrlPluginDefinition\n  | CJSPluginDefinition\n\nexport interface PluginRecord {\n  plugin: PluginConstructor\n  definition: PluginDefinition\n}\n\nexport interface LoadedPlugin {\n  default: PluginConstructor\n}\n\nexport function pluginDescriptionString(d: PluginDefinition) {\n  if (isUMDPluginDefinition(d)) {\n    return `UMD plugin ${d.name}`\n  } else if (isESMPluginDefinition(d)) {\n    return `ESM plugin ${\n      (d as ESMUrlPluginDefinition).esmUrl ||\n      (d as ESMLocPluginDefinition).esmLoc.uri\n    }`\n  } else if (isCJSPluginDefinition(d)) {\n    return `CJS plugin ${d.cjsUrl}`\n  } else {\n    return 'unknown plugin'\n  }\n}\nexport function pluginUrl(d: PluginDefinition) {\n  if (isUMDPluginDefinition(d)) {\n    // @ts-expect-error\n    return d.url ?? d.umdLoc?.uri ?? d.umdUrl\n  } else if (isESMPluginDefinition(d)) {\n    // @ts-expect-error\n    return d.esmUrl ?? d.esmUri ?? d.esmLoc?.uri\n  } else if (isCJSPluginDefinition(d)) {\n    // @ts-expect-error\n    return d.cjsUrl || d.cjsLoc.uri\n  } else {\n    return 'unknown url'\n  }\n}\n\nfunction isInWebWorker() {\n  return 'WorkerGlobalScope' in globalThis\n}\n\nfunction addCacheBuster(url: string) {\n  // @ts-expect-error\n  if (!globalThis.__jbrowseCacheBuster) {\n    return url\n  }\n  const u = new URL(url)\n  u.searchParams.set('_cb', Date.now().toString())\n  return u.href\n}\n\nexport default class PluginLoader {\n  definitions: PluginDefinition[] = []\n\n  fetchESM?: (url: string) => Promise<LoadedPlugin>\n  fetchCJS?: (url: string) => Promise<LoadedPlugin>\n\n  constructor(\n    defs: PluginDefinition[] = [],\n    args?: {\n      fetchESM?: (url: string) => Promise<LoadedPlugin>\n      fetchCJS?: (url: string) => Promise<LoadedPlugin>\n    },\n  ) {\n    this.fetchESM = args?.fetchESM\n    this.fetchCJS = args?.fetchCJS\n    this.definitions = JSON.parse(JSON.stringify(defs))\n  }\n\n  async loadCJSPlugin(def: CJSPluginDefinition, baseUri?: string) {\n    const parsedUrl = new URL(def.cjsUrl, baseUri)\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `Cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n    if (!this.fetchCJS) {\n      throw new Error('No fetchCJS callback provided')\n    }\n\n    return this.fetchCJS(parsedUrl.href)\n  }\n\n  async loadESMPlugin(def: ESMPluginDefinition, baseUri?: string) {\n    const parsedUrl =\n      'esmUrl' in def\n        ? new URL(def.esmUrl, baseUri)\n        : new URL(def.esmLoc.uri, def.esmLoc.baseUri)\n\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n\n    if (!this.fetchESM) {\n      throw new Error('No ESM fetcher installed')\n    }\n    const plugin = await this.fetchESM(addCacheBuster(parsedUrl.href))\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    if (!plugin) {\n      throw new Error(`Could not load ESM plugin: ${parsedUrl}`)\n    }\n    return plugin\n  }\n\n  async loadUMDPlugin(\n    def: UMDPluginDefinition | LegacyUMDPluginDefinition,\n    baseUri?: string,\n  ) {\n    const parsedUrl =\n      'url' in def\n        ? new URL(def.url, baseUri)\n        : 'umdUrl' in def\n          ? new URL(def.umdUrl, baseUri)\n          : new URL(def.umdLoc.uri, def.umdLoc.baseUri)\n\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n    const moduleName = def.name\n    const umdName = `JBrowsePlugin${moduleName}`\n    if (typeof jest === 'undefined') {\n      await loadScript(addCacheBuster(parsedUrl.href))\n    } else {\n      // @ts-expect-error\n      globalThis[umdName] = { default: Plugin }\n    }\n\n    // @ts-expect-error\n    const plugin = globalThis[umdName] as\n      | { default: PluginConstructor }\n      | undefined\n    if (!plugin) {\n      throw new Error(\n        `Failed to load UMD bundle for ${moduleName}, ${umdName} is undefined`,\n      )\n    }\n    return plugin\n  }\n\n  async loadPlugin(def: PluginDefinition, baseUri?: string) {\n    let plugin: LoadedPlugin\n    if (isElectron && isCJSPluginDefinition(def)) {\n      plugin = await this.loadCJSPlugin(def, baseUri)\n    } else if (isESMPluginDefinition(def)) {\n      plugin = await this.loadESMPlugin(def, baseUri)\n    } else if (isUMDPluginDefinition(def)) {\n      plugin = await this.loadUMDPlugin(def, baseUri)\n    } else if (!isElectron && isCJSPluginDefinition(def)) {\n      throw new Error(\n        `CommonJS plugin found, but not in a NodeJS environment: ${JSON.stringify(\n          def,\n        )}`,\n      )\n    } else {\n      throw new Error(`Could not determine plugin type: ${JSON.stringify(def)}`)\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    if (!plugin.default) {\n      throw new Error(\n        `${pluginDescriptionString(\n          def,\n        )} does not have a default export, cannot load`,\n      )\n    }\n    return plugin.default\n  }\n\n  installGlobalReExports(target: WindowOrWorkerGlobalScope) {\n    // @ts-expect-error\n    target.JBrowseExports = Object.fromEntries(\n      Object.entries(ReExports).map(([moduleName, module]) => {\n        return [moduleName, module]\n      }),\n    )\n    return this\n  }\n\n  async load(baseUri?: string) {\n    return Promise.all(\n      this.definitions.map(async definition => ({\n        plugin: await this.loadPlugin(definition, baseUri),\n        definition,\n      })),\n    )\n  }\n}\n","import { useCallback, useSyncExternalStore } from 'react'\n\nfunction getSearchParams() {\n  return new URLSearchParams(window.location.search)\n}\n\nfunction subscribe(callback: () => void) {\n  window.addEventListener('popstate', callback)\n  return () => {\n    window.removeEventListener('popstate', callback)\n  }\n}\n\nfunction updateUrl(params: URLSearchParams) {\n  const newSearch = params.toString()\n  const newUrl = newSearch\n    ? `${window.location.pathname}?${newSearch}`\n    : window.location.pathname\n  window.history.replaceState(null, '', newUrl)\n}\n\nexport function readQueryParams<T extends string>(keys: T[]) {\n  const params = getSearchParams()\n  const result = {} as Record<T, string | undefined>\n  for (const key of keys) {\n    result[key] = params.get(key) ?? undefined\n  }\n  return result\n}\n\nexport function useQueryParam(key: string) {\n  const value = useSyncExternalStore(\n    subscribe,\n    () => getSearchParams().get(key),\n    () => null,\n  )\n\n  const setValue = useCallback(\n    (newValue: string | undefined) => {\n      const params = getSearchParams()\n      if (newValue === undefined) {\n        params.delete(key)\n      } else {\n        params.set(key, newValue)\n      }\n      updateUrl(params)\n    },\n    [key],\n  )\n\n  return [value ?? undefined, setValue] as const\n}\n\nexport function deleteQueryParams(keys: string[]) {\n  const params = getSearchParams()\n  for (const key of keys) {\n    params.delete(key)\n  }\n  updateUrl(params)\n}\n\nexport function setQueryParams(values: Record<string, string | undefined>) {\n  const params = getSearchParams()\n  for (const [key, value] of Object.entries(values)) {\n    if (value === undefined) {\n      params.delete(key)\n    } else {\n      params.set(key, value)\n    }\n  }\n  updateUrl(params)\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { types } from '@jbrowse/mobx-state-tree'\n\nimport { isBaseSession } from './BaseSession.ts'\n\nimport type { SessionWithReferenceManagementType } from './ReferenceManagement.ts'\nimport type { BaseRootModelType } from '../RootModel/BaseRootModel.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel ConnectionManagementSessionMixin\n */\nexport function ConnectionManagementSessionMixin(pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      connectionInstances: types.array(\n        pluginManager.pluggableMstType('connection', 'stateModel'),\n      ),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get connections(): BaseConnectionConfigModel[] {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.connections\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      makeConnection(\n        configuration: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const type = configuration.type as string\n        if (!type) {\n          throw new Error('track configuration has no `type` listed')\n        }\n        const name = readConfObject(configuration, 'name')\n        const connectionType = pluginManager.getConnectionType(type)\n        if (!connectionType) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connectionInstances.push({\n          ...initialSnapshot,\n          name,\n          type,\n          configuration,\n        })\n        return self.connectionInstances[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      prepareToBreakConnection(configuration: AnyConfigurationModel) {\n        const root = self as typeof self &\n          Instance<SessionWithReferenceManagementType>\n        const callbacksToDeref: (() => void)[] = []\n        const derefTypeCount: Record<string, number> = {}\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          return undefined\n        }\n        for (const track of connection.tracks) {\n          const ref = root.getReferring(track)\n          root.removeReferring(ref, track, callbacksToDeref, derefTypeCount)\n        }\n        return [\n          () => {\n            for (const cb of callbacksToDeref) {\n              cb()\n            }\n            this.breakConnection(configuration)\n          },\n          derefTypeCount,\n        ]\n      },\n\n      /**\n       * #action\n       */\n      breakConnection(configuration: AnyConfigurationModel) {\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          throw new Error(`no connection found with name ${name}`)\n        }\n        self.connectionInstances.remove(connection)\n      },\n\n      /**\n       * #action\n       */\n      deleteConnection(configuration: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.deleteConnectionConf(configuration)\n      },\n\n      /**\n       * #action\n       */\n      addConnectionConf(connectionConf: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.addConnectionConf(connectionConf)\n      },\n\n      /**\n       * #action\n       */\n      clearConnections() {\n        self.connectionInstances.clear()\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      // mst types wrong, nullish needed\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { connectionInstances, ...rest } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        // mst types wrong, nullish needed\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        ...(connectionInstances?.length ? { connectionInstances } : {}),\n      } as typeof snap\n    })\n}\n\n/** Session mixin MST type for a session that has connections */\nexport type SessionWithConnectionsType = ReturnType<\n  typeof ConnectionManagementSessionMixin\n>\n\n/** Instance of a session that has connections: `connectionInstances`,\n * `makeConnection()`, etc. */\nexport type SessionWithConnections = Instance<SessionWithConnectionsType>\n\n/** Type guard for SessionWithConnections */\nexport function isSessionWithConnections(\n  session: IAnyStateTreeNode,\n): session is SessionWithConnections {\n  return isBaseSession(session) && 'connectionInstances' in session\n}\n","import {\n  getChildType,\n  getPropertyMembers,\n  isArrayType,\n  isMapType,\n  isModelType,\n  isReferenceType,\n  isValidReference,\n} from '@jbrowse/mobx-state-tree'\n\nimport type {\n  IAnyStateTreeNode,\n  IAnyType,\n  Instance,\n  types,\n} from '@jbrowse/mobx-state-tree'\n\n/**\n * Pad the end of a base64 string with \"=\" to make it valid\n * @param b64 - unpadded b64 string\n */\nexport function b64PadSuffix(b64: string): string {\n  let num = 0\n  const mo = b64.length % 4\n  switch (mo) {\n    case 3:\n      num = 1\n      break\n    case 2:\n      num = 2\n      break\n    case 0:\n      num = 0\n      break\n    default:\n      throw new Error('base64 not a valid length')\n  }\n  return b64 + '='.repeat(num)\n}\n\n/**\n * Decode and inflate a url-safe base64 to a string\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param b64 - a base64 string to decode and inflate\n */\nexport async function fromUrlSafeB64(b64: string) {\n  const originalB64 = b64PadSuffix(\n    b64.replaceAll('-', '+').replaceAll('_', '/'),\n  )\n  const { toByteArray } = await import('base64-js')\n  const { inflate } = await import('pako-esm2')\n  const bytes = toByteArray(originalB64)\n  const inflated = inflate(bytes, undefined)\n  const decoder = new TextDecoder('utf8')\n  return decoder.decode(inflated)\n}\n\n/**\n * Compress and encode a string as url-safe base64\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param str-  a string to compress and encode\n */\nexport async function toUrlSafeB64(str: string) {\n  const bytes = new TextEncoder().encode(str)\n  const { deflate } = await import('pako-esm2')\n  const { fromByteArray } = await import('base64-js')\n  const deflated = deflate(bytes, undefined)\n  const encoded = fromByteArray(deflated)\n  const pos = encoded.indexOf('=')\n  return pos > 0\n    ? encoded.slice(0, pos).replaceAll('+', '-').replaceAll('/', '_')\n    : encoded.replaceAll('+', '-').replaceAll('/', '_')\n}\n\ntype MSTArray = Instance<ReturnType<typeof types.array>>\ntype MSTMap = Instance<ReturnType<typeof types.map>>\n\n// attempts to remove undefined references from the given MST model. can only\n// actually remove them from arrays and maps. throws MST undefined ref error if\n// it encounters undefined refs in model properties\nexport function filterSessionInPlace(node: IAnyStateTreeNode, type: IAnyType) {\n  // makes it work with session sharing\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (node === undefined) {\n    return\n  }\n  if (isArrayType(type)) {\n    const array = node as MSTArray\n    const childType = getChildType(node)\n    if (isReferenceType(childType)) {\n      // filter array elements\n      for (let i = 0; i < array.length; ) {\n        if (!isValidReference(() => array[i])) {\n          array.splice(i, 1)\n        } else {\n          i += 1\n        }\n      }\n    }\n    // eslint-disable-next-line unicorn/no-array-for-each\n    array.forEach(el => {\n      filterSessionInPlace(el, childType)\n    })\n  } else if (isMapType(type)) {\n    const map = node as MSTMap\n    const childType = getChildType(map)\n    if (isReferenceType(childType)) {\n      // filter the map members\n      for (const key in map.keys()) {\n        if (!isValidReference(() => map.get(key))) {\n          map.delete(key)\n        }\n      }\n    }\n    // eslint-disable-next-line unicorn/no-array-for-each\n    map.forEach(child => {\n      filterSessionInPlace(child, childType)\n    })\n  } else if (isModelType(type)) {\n    // iterate over children\n    const { properties } = getPropertyMembers(node)\n\n    // eslint-disable-next-line unicorn/no-array-for-each\n    Object.entries(properties).forEach(([pname, ptype]) => {\n      filterSessionInPlace(node[pname], ptype)\n    })\n  }\n}\n\nexport function addRelativeUris(\n  config: Record<string, unknown> | null,\n  base: URL,\n) {\n  if (typeof config === 'object' && config !== null) {\n    for (const key of Object.keys(config)) {\n      if (typeof config[key] === 'object' && config[key] !== null) {\n        addRelativeUris(config[key] as Record<string, unknown>, base)\n      } else if (key === 'uri') {\n        config.baseUri = config.baseUri ?? base.href\n      }\n    }\n  }\n}\n\nexport interface Root {\n  configuration?: Record<string, unknown>\n}\n\n// raw readConf alternative for before conf is initialized\nexport function readConf({ configuration }: Root, attr: string, def: string) {\n  return configuration?.[attr] || def\n}\n\nexport { checkPlugins, fetchPlugins } from './checkPlugins.ts'\n\nexport function removeAttr(obj: Record<string, unknown>, attr: string) {\n  for (const prop in obj) {\n    if (prop === attr) {\n      delete obj[prop]\n    } else if (typeof obj[prop] === 'object') {\n      removeAttr(obj[prop] as Record<string, unknown>, attr)\n    }\n  }\n  return obj\n}\n","import { lazy } from 'react'\n\nimport Plugin from '@jbrowse/core/Plugin'\n\nimport AddConnectionWidgetF from './AddConnectionWidget/index.ts'\nimport AddTrackWidgetF from './AddTrackWidget/index.ts'\nimport HierarchicalTrackSelectorWidgetF from './HierarchicalTrackSelectorWidget/index.ts'\nimport JB2TrackHubConnectionF from './JB2TrackHubConnection/index.ts'\nimport PluginStoreWidgetF from './PluginStoreWidget/index.ts'\nimport UCSCTrackHubConnectionF from './UCSCTrackHubConnection/index.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst AssemblyManager = lazy(() => import('./AssemblyManager/index.ts'))\n\nexport default class DataManagementPlugin extends Plugin {\n  name = 'DataManagementPlugin'\n\n  exports = {\n    AssemblyManager,\n  }\n\n  install(pluginManager: PluginManager) {\n    UCSCTrackHubConnectionF(pluginManager)\n    JB2TrackHubConnectionF(pluginManager)\n    AddTrackWidgetF(pluginManager)\n    HierarchicalTrackSelectorWidgetF(pluginManager)\n    AddConnectionWidgetF(pluginManager)\n    PluginStoreWidgetF(pluginManager)\n  }\n\n  configure(_pluginManager: PluginManager) {}\n}\n\nexport { AssemblyManager }\n\nexport type { AddTrackModel } from './AddTrackWidget/model.ts'\nexport type { HierarchicalTrackSelectorModel } from './HierarchicalTrackSelectorWidget/index.ts'\n","import { aesDecrypt, aesEncrypt } from '@jbrowse/core/util'\n\nimport { toUrlSafeB64 } from './util.ts'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      [...window.crypto.getRandomValues(new Uint8Array(length * 2))]\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replaceAll(/[+/]/g, '')\n    .slice(0, length)\n}\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: unknown,\n  url: string,\n  referer: string,\n) {\n  const sess = await toUrlSafeB64(JSON.stringify(session))\n  const password = generateUID(5)\n  const encryptedSession = await aesEncrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n  signal?: AbortSignal,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]!\n  const url = `${baseUrl}?sessionId=${encodeURIComponent(sessionId)}`\n  const response = await fetch(url, {\n    signal,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n\n  const json = await response.json()\n  return aesDecrypt(json.session, password)\n}\n","import SvgIcon from '@mui/material/SvgIcon'\n\nimport type { SvgIconProps } from '@mui/material/SvgIcon'\n\n// https://materialdesignicons.com/ text-search icon\nexport function Indexing(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19.31 18.9L22.39 22L21 23.39L17.88 20.32C17.19 20.75 16.37 21 15.5 21C13 21 11 19 11 16.5C11 14 13 12 15.5 12C18 12 20 14 20 16.5C20 17.38 19.75 18.21 19.31 18.9M15.5 19C16.88 19 18 17.88 18 16.5C18 15.12 16.88 14 15.5 14C14.12 14 13 15.12 13 16.5C13 17.88 14.12 19 15.5 19M21 4V6H3V4H21M3 16V14H9V16H3M3 11V9H21V11H18.97C17.96 10.37 16.77 10 15.5 10C14.23 10 13.04 10.37 12.03 11H3Z\" />\n    </SvgIcon>\n  )\n}\n\n//  format-list-checkbox from https://materialdesignicons.com/\nexport function TrackSelector(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z\" />\n    </SvgIcon>\n  )\n}\n\n//  dna from https://materialdesignicons.com/\nexport function DNA(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M4,2H6V4C6,5.44 6.68,6.61 7.88,7.78C8.74,8.61 9.89,9.41 11.09,10.2L9.26,11.39C8.27,10.72 7.31,10 6.5,9.21C5.07,7.82 4,6.1 4,4V2M18,2H20V4C20,6.1 18.93,7.82 17.5,9.21C16.09,10.59 14.29,11.73 12.54,12.84C10.79,13.96 9.09,15.05 7.88,16.22C6.68,17.39 6,18.56 6,20V22H4V20C4,17.9 5.07,16.18 6.5,14.79C7.91,13.41 9.71,12.27 11.46,11.16C13.21,10.04 14.91,8.95 16.12,7.78C17.32,6.61 18,5.44 18,4V2M14.74,12.61C15.73,13.28 16.69,14 17.5,14.79C18.93,16.18 20,17.9 20,20V22H18V20C18,18.56 17.32,17.39 16.12,16.22C15.26,15.39 14.11,14.59 12.91,13.8L14.74,12.61M7,3H17V4L16.94,4.5H7.06L7,4V3M7.68,6H16.32C16.08,6.34 15.8,6.69 15.42,7.06L14.91,7.5H9.07L8.58,7.06C8.2,6.69 7.92,6.34 7.68,6M9.09,16.5H14.93L15.42,16.94C15.8,17.31 16.08,17.66 16.32,18H7.68C7.92,17.66 8.2,17.31 8.58,16.94L9.09,16.5M7.06,19.5H16.94L17,20V21H7V20L7.06,19.5Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function Cable(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z\" />\n    </SvgIcon>\n  )\n}\n","import {\n  localStorageGetBoolean,\n  localStorageSetBoolean,\n} from '@jbrowse/core/util'\nimport { addDisposer, cast, types } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport { BaseSessionModel, isBaseSession } from './BaseSession.ts'\nimport { DrawerWidgetSessionMixin } from './DrawerWidgets.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { IBaseViewModel } from '@jbrowse/core/pluggableElementTypes'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel MultipleViewsSessionMixin\n * composed of\n * - [BaseSessionModel](../basesessionmodel)\n * - [DrawerWidgetSessionMixin](../drawerwidgetsessionmixin)\n */\nexport function MultipleViewsSessionMixin(pluginManager: PluginManager) {\n  return types\n    .compose(\n      BaseSessionModel(pluginManager),\n      DrawerWidgetSessionMixin(pluginManager),\n      types.model({\n        /**\n         * #property\n         */\n        views: types.array(\n          pluginManager.pluggableMstType('view', 'stateModel'),\n        ),\n        /**\n         * #property\n         */\n        stickyViewHeaders: types.optional(types.boolean, () =>\n          localStorageGetBoolean('stickyViewHeaders', true),\n        ),\n        /**\n         * #property\n         * enables the dockview-based tabbed/tiled workspace layout\n         */\n        useWorkspaces: types.optional(types.boolean, () =>\n          localStorageGetBoolean('useWorkspaces', false),\n        ),\n      }),\n    )\n    .actions(self => ({\n      /**\n       * #action\n       */\n      moveViewDown(id: string) {\n        const idx = self.views.findIndex(v => v.id === id)\n        if (idx !== -1 && idx < self.views.length - 1) {\n          self.views.splice(idx, 2, self.views[idx + 1], self.views[idx])\n        }\n      },\n      /**\n       * #action\n       */\n      moveViewUp(id: string) {\n        const idx = self.views.findIndex(view => view.id === id)\n        if (idx > 0) {\n          self.views.splice(idx - 1, 2, self.views[idx], self.views[idx - 1])\n        }\n      },\n      /**\n       * #action\n       */\n      moveViewToTop(id: string) {\n        const idx = self.views.findIndex(view => view.id === id)\n        self.views = cast([\n          self.views[idx],\n          ...self.views.filter(view => view.id !== id),\n        ])\n      },\n\n      /**\n       * #action\n       */\n      moveViewToBottom(id: string) {\n        const idx = self.views.findIndex(view => view.id === id)\n        self.views = cast([\n          ...self.views.filter(view => view.id !== id),\n          self.views[idx],\n        ])\n      },\n\n      /**\n       * #action\n       */\n      addView(typeName: string, initialState = {}) {\n        const typeDefinition = pluginManager.getElementType('view', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown view type ${typeName}`)\n        }\n\n        const length = self.views.push({\n          ...initialState,\n          type: typeName,\n        })\n        return self.views[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      removeView(view: IBaseViewModel) {\n        for (const [, widget] of self.activeWidgets) {\n          if (widget.view?.id === view.id) {\n            self.hideWidget(widget)\n          }\n        }\n        self.views.remove(view)\n      },\n\n      /**\n       * #action\n       */\n      setStickyViewHeaders(sticky: boolean) {\n        self.stickyViewHeaders = sticky\n      },\n\n      /**\n       * #action\n       */\n      setUseWorkspaces(useWorkspaces: boolean) {\n        self.useWorkspaces = useWorkspaces\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            function stickyViewHeadersAutorun() {\n              localStorageSetBoolean(\n                'stickyViewHeaders',\n                self.stickyViewHeaders,\n              )\n            },\n            { name: 'StickyViewHeaders' },\n          ),\n        )\n        addDisposer(\n          self,\n          autorun(\n            function useWorkspacesAutorun() {\n              localStorageSetBoolean('useWorkspaces', self.useWorkspaces)\n            },\n            { name: 'UseWorkspaces' },\n          ),\n        )\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { stickyViewHeaders, useWorkspaces, ...rest } = snap as Omit<\n        typeof snap,\n        symbol\n      >\n      return {\n        ...rest,\n        ...(!stickyViewHeaders ? { stickyViewHeaders } : {}),\n        ...(useWorkspaces ? { useWorkspaces } : {}),\n      } as typeof snap\n    })\n}\n\n/** Session mixin MST type for a session that manages multiple views */\nexport type SessionWithMultipleViewsType = ReturnType<\n  typeof MultipleViewsSessionMixin\n>\n\n/** Instance of a session with multiple views */\nexport type SessionWithMultipleViews = Instance<SessionWithMultipleViewsType>\n\n/** Type guard for SessionWithMultipleViews */\nexport function isSessionWithMultipleViews(\n  session: IAnyStateTreeNode,\n): session is SessionWithMultipleViews {\n  return isBaseSession(session) && 'views' in session\n}\n","import { isConfigurationModel } from '@jbrowse/core/configuration'\nimport { localStorageGetItem, localStorageSetItem } from '@jbrowse/core/util'\nimport {\n  addDisposer,\n  getEnv,\n  isAlive,\n  isStateTreeNode,\n  types,\n} from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport { isBaseSession } from './BaseSession.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\nconst minDrawerWidth = 128\n\n/**\n * #stateModel DrawerWidgetSessionMixin\n */\nexport function DrawerWidgetSessionMixin(pluginManager: PluginManager) {\n  const widgetStateModelType = pluginManager.pluggableMstType(\n    'widget',\n    'stateModel',\n  )\n  type WidgetStateModel = Instance<typeof widgetStateModelType>\n  return types\n    .model({\n      /**\n       * #property\n       */\n      drawerPosition: types.optional(\n        types.string,\n        () => localStorageGetItem('drawerPosition') || 'right',\n      ),\n      /**\n       * #property\n       */\n      drawerWidth: types.optional(\n        types.refinement(types.integer, width => width >= minDrawerWidth),\n        384,\n      ),\n      /**\n       * #property\n       */\n      widgets: types.map(widgetStateModelType),\n      /**\n       * #property\n       */\n      activeWidgets: types.map(types.safeReference(widgetStateModelType)),\n\n      /**\n       * #property\n       */\n      minimized: types.optional(types.boolean, false),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get visibleWidget() {\n        if (isAlive(self)) {\n          // returns most recently added item in active widgets\n          return [...self.activeWidgets.values()][self.activeWidgets.size - 1]\n        }\n        return undefined\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setDrawerPosition(arg: string) {\n        self.drawerPosition = arg\n        localStorage.setItem('drawerPosition', arg)\n      },\n\n      /**\n       * #action\n       */\n      updateDrawerWidth(drawerWidth: number) {\n        if (drawerWidth === self.drawerWidth) {\n          return self.drawerWidth\n        }\n        let newDrawerWidth = drawerWidth\n        if (newDrawerWidth < minDrawerWidth) {\n          newDrawerWidth = minDrawerWidth\n        }\n        self.drawerWidth = newDrawerWidth\n        return newDrawerWidth\n      },\n\n      /**\n       * #action\n       */\n      resizeDrawer(distance: number) {\n        if (self.drawerPosition === 'left') {\n          distance *= -1\n        }\n        const oldDrawerWidth = self.drawerWidth\n        const newDrawerWidth = this.updateDrawerWidth(oldDrawerWidth - distance)\n        return oldDrawerWidth - newDrawerWidth\n      },\n\n      /**\n       * #action\n       */\n      addWidget(\n        typeName: string,\n        id: string,\n        initialState = {},\n        conf?: unknown,\n      ) {\n        const typeDefinition = pluginManager.getElementType('widget', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown widget type ${typeName}`)\n        }\n        const data = {\n          ...initialState,\n          id,\n          type: typeName,\n          configuration: conf || { type: typeName },\n        }\n        self.widgets.set(id, data)\n        return self.widgets.get(id)\n      },\n\n      /**\n       * #action\n       */\n      showWidget(widget: WidgetStateModel) {\n        if (self.activeWidgets.has(widget.id)) {\n          self.activeWidgets.delete(widget.id)\n        }\n        self.activeWidgets.set(widget.id, widget)\n        self.minimized = false\n      },\n\n      /**\n       * #action\n       */\n      hasWidget(widget: WidgetStateModel) {\n        return self.activeWidgets.has(widget.id)\n      },\n\n      /**\n       * #action\n       */\n      hideWidget(widget: WidgetStateModel) {\n        self.activeWidgets.delete(widget.id)\n      },\n\n      /**\n       * #action\n       */\n      minimizeWidgetDrawer() {\n        self.minimized = true\n      },\n      /**\n       * #action\n       */\n      showWidgetDrawer() {\n        self.minimized = false\n      },\n      /**\n       * #action\n       */\n      hideAllWidgets() {\n        self.activeWidgets.clear()\n      },\n\n      /**\n       * #action\n       * opens a configuration editor to configure the given thing,\n       * and sets the current task to be configuring it\n       * @param configuration - can be an MST model or a frozen/plain object with trackId\n       */\n      editConfiguration(\n        configuration: AnyConfigurationModel | { trackId: string },\n      ) {\n        let targetConfig: AnyConfigurationModel\n\n        if (\n          isStateTreeNode(configuration) &&\n          isConfigurationModel(configuration)\n        ) {\n          // Already an MST model (e.g., from track.configuration), use directly\n          targetConfig = configuration\n        } else if ('trackId' in configuration) {\n          // Frozen/plain object - create a temporary MST model for editing\n          const trackSchema = pluginManager.pluggableConfigSchemaType('track')\n          targetConfig = trackSchema.create(configuration, getEnv(self))\n        } else {\n          throw new Error(\n            'must pass a configuration model or frozen config with trackId to editConfiguration',\n          )\n        }\n\n        const editor = this.addWidget(\n          'ConfigurationEditorWidget',\n          'configEditor',\n          {},\n        )\n        // Set target via action since it's now volatile\n        editor.setTarget(targetConfig)\n        this.showWidget(editor)\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            function drawerPositionAutorun() {\n              localStorageSetItem('drawerPosition', self.drawerPosition)\n            },\n            { name: 'DrawerPosition' },\n          ),\n        )\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const {\n        drawerPosition,\n        drawerWidth,\n        widgets,\n        activeWidgets,\n        minimized,\n        ...rest\n      } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        ...(drawerPosition !== 'right' ? { drawerPosition } : {}),\n        ...(drawerWidth !== 384 ? { drawerWidth } : {}),\n        // mst types wrong, nullish needed\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        ...(Object.keys(widgets ?? {}).length ? { widgets } : {}),\n        // mst types wrong, nullish needed\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        ...(Object.keys(activeWidgets ?? {}).length ? { activeWidgets } : {}),\n        ...(minimized ? { minimized } : {}),\n      } as typeof snap\n    })\n}\n\n/** Session mixin MST type for a session that manages drawer widgets */\nexport type SessionWithDrawerWidgetsType = ReturnType<\n  typeof DrawerWidgetSessionMixin\n>\n\n/** Instance of a session that manages drawer widgets */\nexport type SessionWithDrawerWidgets = Instance<SessionWithDrawerWidgetsType>\n\n/** Type guard for SessionWithDrawerWidgets */\nexport function isSessionWithDrawerWidgets(\n  session: IAnyStateTreeNode,\n): session is SessionWithDrawerWidgets {\n  return (\n    isBaseSession(session) &&\n    'widgets' in session &&\n    'drawerPosition' in session\n  )\n}\n","import type React from 'react'\nimport { useEffect, useRef, useState } from 'react'\n\nimport { unzip } from '@gmod/bgzf-filehandle'\nimport useMeasure from '@jbrowse/core/util/useMeasure'\nimport {\n  getEnv as getEnvMST,\n  getParent,\n  getSnapshot,\n  hasParent,\n  isAlive,\n  isStateTreeNode,\n} from '@jbrowse/mobx-state-tree'\nimport { flushSync } from 'react-dom'\nimport { createRoot } from 'react-dom/client'\n\nimport { coarseStripHTML } from './coarseStripHTML.ts'\nimport { colord } from './colord.ts'\nimport { parseLocString } from './locString.ts'\nimport { checkStopToken } from './stopToken.ts'\nimport {\n  isDisplayModel,\n  isSessionModel,\n  isTrackModel,\n  isUriLocation,\n  isViewModel,\n} from './types/index.ts'\n\nimport type { ParsedLocString } from './locString.ts'\nimport type PluginManager from '../PluginManager.ts'\nimport type { BaseBlock } from './blockTypes.ts'\nimport type { Feature } from './simpleFeature.ts'\nimport type { StopToken } from './stopToken.ts'\nimport type {\n  AbstractDisplayModel,\n  AbstractSessionModel,\n  AbstractTrackModel,\n  AbstractViewModel,\n  AssemblyManager,\n  Region,\n  TypeTestedByPredicate,\n} from './types/index.ts'\nimport type { Region as MUIRegion } from './types/mst.ts'\nimport type { BaseOptions } from '../data_adapters/BaseAdapter/index.ts'\nimport type {\n  IAnyStateTreeNode,\n  IStateTreeNode,\n  Instance,\n} from '@jbrowse/mobx-state-tree'\nimport type { GenericFilehandle } from 'generic-filehandle2'\n\nexport * from './types/index.ts'\nexport * from './when.ts'\nexport * from './range.ts'\nexport * from './dedupe.ts'\nexport * from './coarseStripHTML.ts'\n\nexport * from './offscreenCanvasPonyfill.tsx'\nexport * from './offscreenCanvasUtils.tsx'\nexport * from './rpc.ts'\nexport * from './crypto.ts'\n\n// WeakMap caches for containing model lookups to avoid repeated tree traversal\nconst containingDisplayCache = new WeakMap<\n  IAnyStateTreeNode,\n  AbstractDisplayModel\n>()\nconst containingTrackCache = new WeakMap<\n  IAnyStateTreeNode,\n  AbstractTrackModel\n>()\nconst containingViewCache = new WeakMap<IAnyStateTreeNode, AbstractViewModel>()\nconst sessionCache = new WeakMap<IAnyStateTreeNode, AbstractSessionModel>()\n\nexport function useDebounce<T>(value: T, delay: number) {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(() => {\n    const handle = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n    return () => {\n      clearTimeout(handle)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n\n// used in ViewContainer files to get the width\nexport function useWidthSetter(\n  view: { setWidth: (arg: number) => void },\n  padding: string,\n) {\n  const [ref, { width }] = useMeasure()\n  useEffect(() => {\n    let token: ReturnType<typeof requestAnimationFrame>\n    if (width && isAlive(view)) {\n      // sets after a requestAnimationFrame\n      // https://stackoverflow.com/a/58701523/2129219\n      // avoids ResizeObserver loop error being shown during development\n      token = requestAnimationFrame(() => {\n        view.setWidth(width)\n      })\n    }\n\n    return () => {\n      if (token) {\n        cancelAnimationFrame(token)\n      }\n    }\n  }, [padding, view, width])\n  return ref\n}\n\ntype Timer = ReturnType<typeof setTimeout>\n\n// https://stackoverflow.com/questions/56283920/\nexport function useDebouncedCallback<T>(\n  callback: (...args: T[]) => void,\n  wait = 400,\n) {\n  // track args & timeout handle between calls\n  const argsRef = useRef<T[]>(null)\n  const timeout = useRef<Timer>(null)\n\n  // make sure our timeout gets cleared if our consuming component gets\n  // unmounted\n  useEffect(() => {\n    if (timeout.current) {\n      clearTimeout(timeout.current)\n    }\n  }, [])\n\n  return function debouncedCallback(...args: T[]) {\n    // capture latest args\n    argsRef.current = args\n\n    // clear debounce timer\n    if (timeout.current) {\n      clearTimeout(timeout.current)\n    }\n\n    // start waiting again\n    timeout.current = setTimeout(() => {\n      if (argsRef.current) {\n        callback(...argsRef.current)\n      }\n    }, wait)\n  }\n}\n\n/**\n * find the first node in the hierarchy that matches the given predicate\n */\nexport function findParentThat(\n  node: IAnyStateTreeNode,\n  predicate: (thing: IAnyStateTreeNode) => boolean,\n) {\n  if (!hasParent(node)) {\n    throw new Error('node does not have parent')\n  }\n  let currentNode = getParent<IAnyStateTreeNode>(node)\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  while (currentNode && isAlive(currentNode)) {\n    if (predicate(currentNode)) {\n      return currentNode\n    }\n    if (hasParent(currentNode)) {\n      currentNode = getParent<any>(currentNode)\n    } else {\n      break\n    }\n  }\n  throw new Error('no matching node found')\n}\n\ninterface Animation {\n  lastPosition: number\n  lastTime?: number\n  lastVelocity?: number\n}\n\n// based on https://github.com/react-spring/react-spring/blob/cd5548a987383b8023efd620f3726a981f9e18ea/src/animated/FrameLoop.ts\nexport function springAnimate(\n  fromValue: number,\n  toValue: number,\n  setValue: (value: number) => void,\n  onFinish = () => {},\n  precision = 0,\n  tension = 400,\n  friction = 20,\n  clamp = true,\n) {\n  const mass = 1\n  if (!precision) {\n    precision = Math.abs(toValue - fromValue) / 1000\n  }\n\n  let animationFrameId: number\n\n  function update(animation: Animation) {\n    const time = performance.now()\n    let position = animation.lastPosition\n    let lastTime = animation.lastTime || time\n    let velocity = animation.lastVelocity || 0\n    // If we lost a lot of frames just jump to the end.\n    if (time > lastTime + 64) {\n      lastTime = time\n    }\n    // http://gafferongames.com/game-physics/fix-your-timestep/\n    const numSteps = Math.floor(time - lastTime)\n    for (let i = 0; i < numSteps; ++i) {\n      const force = -tension * (position - toValue)\n      const damping = -friction * velocity\n      const acceleration = (force + damping) / mass\n      velocity += (acceleration * 1) / 1000\n      position += (velocity * 1) / 1000\n    }\n    const isVelocity = Math.abs(velocity) <= precision\n    const isDisplacement =\n      tension !== 0 ? Math.abs(toValue - position) <= precision : true\n    const isOvershooting =\n      clamp && tension !== 0\n        ? fromValue < toValue\n          ? position > toValue\n          : position < toValue\n        : false\n    const endOfAnimation = isOvershooting || (isVelocity && isDisplacement)\n    if (endOfAnimation) {\n      setValue(toValue)\n      onFinish()\n    } else {\n      setValue(position)\n      animationFrameId = requestAnimationFrame(() => {\n        update({\n          lastPosition: position,\n          lastTime: time,\n          lastVelocity: velocity,\n        })\n      })\n    }\n  }\n\n  return [\n    () => {\n      update({ lastPosition: fromValue })\n    },\n    () => {\n      cancelAnimationFrame(animationFrameId)\n    },\n  ]\n}\n\n/**\n * find the first node in the hierarchy that matches the given 'is' typescript\n * type guard predicate\n */\nexport function findParentThatIs<T extends (a: IAnyStateTreeNode) => boolean>(\n  node: IAnyStateTreeNode,\n  predicate: T,\n) {\n  return findParentThat(node, predicate) as TypeTestedByPredicate<T>\n}\n\n/**\n * get the current JBrowse session model, starting at any node in the state\n * tree. Results are cached for performance.\n */\nexport function getSession(node: IAnyStateTreeNode): AbstractSessionModel {\n  const cached = sessionCache.get(node)\n  if (cached && isAlive(cached)) {\n    return cached\n  }\n  try {\n    const result = findParentThatIs(node, isSessionModel)\n    sessionCache.set(node, result)\n    return result\n  } catch (e) {\n    throw new Error('no session model found!')\n  }\n}\n\n/**\n * get the state model of the view in the state tree that contains the given\n * node. Results are cached for performance.\n */\nexport function getContainingView(node: IAnyStateTreeNode): AbstractViewModel {\n  const cached = containingViewCache.get(node)\n  // Validate cached result is still alive (handles re-parenting edge cases)\n  if (cached && isAlive(cached)) {\n    return cached\n  }\n  try {\n    const result = findParentThatIs(node, isViewModel)\n    containingViewCache.set(node, result)\n    return result\n  } catch (e) {\n    throw new Error('no containing view found')\n  }\n}\n\n/**\n * get the state model of the track in the state tree that contains the given\n * node. Results are cached for performance.\n */\nexport function getContainingTrack(\n  node: IAnyStateTreeNode,\n): AbstractTrackModel {\n  const cached = containingTrackCache.get(node)\n  // Validate cached result is still alive (handles re-parenting edge cases)\n  if (cached && isAlive(cached)) {\n    return cached\n  }\n  try {\n    const result = findParentThatIs(node, isTrackModel)\n    containingTrackCache.set(node, result)\n    return result\n  } catch (e) {\n    throw new Error('no containing track found')\n  }\n}\n\n/**\n * get the state model of the display in the state tree that contains the given\n * node. Results are cached for performance.\n */\nexport function getContainingDisplay(\n  node: IAnyStateTreeNode,\n): AbstractDisplayModel {\n  const cached = containingDisplayCache.get(node)\n  // Validate cached result is still alive (handles re-parenting edge cases)\n  if (cached && isAlive(cached)) {\n    return cached\n  }\n  try {\n    const result = findParentThatIs(node, isDisplayModel)\n    containingDisplayCache.set(node, result)\n    return result\n  } catch (e) {\n    throw new Error('no containing display found')\n  }\n}\n\n/**\n * Assemble a 1-based \"locString\" from an interbase genomic location\n * @param region - Region\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 })\n * //  '{hg19}chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1' })\n * //  'chr1'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0 })\n * //  'chr1:1..'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 1 })\n * //  'chr1:1'\n * ```\n */\nexport function assembleLocString(region: ParsedLocString) {\n  return assembleLocStringFast(region, toLocale)\n}\n\n// same as assembleLocString above, but does not perform toLocaleString which\n// can slow down the speed of block calculations which use assembleLocString\n// for block.key\nexport function assembleLocStringFast(\n  region: ParsedLocString,\n  cb = (n: number): string | number => n,\n) {\n  const { assemblyName, refName, start, end, reversed } = region\n  const assemblyNameString = assemblyName ? `{${assemblyName}}` : ''\n  let startString: string\n  if (start !== undefined) {\n    startString = `:${cb(start + 1)}`\n  } else if (end !== undefined) {\n    startString = ':1'\n  } else {\n    startString = ''\n  }\n  let endString: string\n  if (end !== undefined) {\n    endString = start !== undefined && start + 1 === end ? '' : `..${cb(end)}`\n  } else {\n    endString = start !== undefined ? '..' : ''\n  }\n  let rev = ''\n  if (reversed) {\n    rev = '[rev]'\n  }\n  return `${assemblyNameString}${refName}${startString}${endString}${rev}`\n}\nexport function compareLocs(locA: ParsedLocString, locB: ParsedLocString) {\n  const assemblyComp =\n    locA.assemblyName || locB.assemblyName\n      ? (locA.assemblyName || '').localeCompare(locB.assemblyName || '')\n      : 0\n  if (assemblyComp) {\n    return assemblyComp\n  }\n\n  const refComp =\n    locA.refName || locB.refName\n      ? (locA.refName || '').localeCompare(locB.refName || '')\n      : 0\n  if (refComp) {\n    return refComp\n  }\n\n  if (locA.start !== undefined && locB.start !== undefined) {\n    const startComp = locA.start - locB.start\n    if (startComp) {\n      return startComp\n    }\n  }\n  if (locA.end !== undefined && locB.end !== undefined) {\n    const endComp = locA.end - locB.end\n    if (endComp) {\n      return endComp\n    }\n  }\n  return 0\n}\n\nexport function compareLocStrings(\n  a: string,\n  b: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const locA = parseLocString(a, isValidRefName)\n  const locB = parseLocString(b, isValidRefName)\n  return compareLocs(locA, locB)\n}\n\n/**\n * Ensure that a number is at least min and at most max.\n *\n * @param num -\n * @param min -\n * @param  max -\n */\nexport function clamp(num: number, min: number, max: number) {\n  if (num < min) {\n    return min\n  }\n  if (num > max) {\n    return max\n  }\n  return num\n}\n\nfunction roundToNearestPointOne(num: number) {\n  return Math.round(num * 10) / 10\n}\n\n/**\n * @param bp -\n * @param region -\n * @param bpPerPx -\n */\nexport function bpToPx(\n  bp: number,\n  {\n    reversed,\n    end = 0,\n    start = 0,\n  }: { start?: number; end?: number; reversed?: boolean },\n  bpPerPx: number,\n) {\n  return roundToNearestPointOne((reversed ? end - bp : bp - start) / bpPerPx)\n}\n\nconst oneEightyOverPi = 180 / Math.PI\nconst piOverOneEighty = Math.PI / 180\nexport function radToDeg(radians: number) {\n  return (radians * oneEightyOverPi) % 360\n}\nexport function degToRad(degrees: number) {\n  return (degrees * piOverOneEighty) % (2 * Math.PI)\n}\n\n/**\n * @returns [x, y]\n */\nexport function polarToCartesian(rho: number, theta: number) {\n  return [rho * Math.cos(theta), rho * Math.sin(theta)] as [number, number]\n}\n\n/**\n * @param x - the x\n * @param y - the y\n * @returns [rho, theta]\n */\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  const theta = Math.atan(y / x)\n  return [rho, theta] as [number, number]\n}\ninterface MinimalRegion {\n  start: number\n  end: number\n  reversed?: boolean\n}\n\nexport function featureSpanPx(\n  feature: Feature,\n  region: MinimalRegion,\n  bpPerPx: number,\n) {\n  return bpSpanPx(feature.get('start'), feature.get('end'), region, bpPerPx)\n}\n\nexport function bpSpanPx(\n  leftBp: number,\n  rightBp: number,\n  region: MinimalRegion,\n  bpPerPx: number,\n) {\n  const start = bpToPx(leftBp, region, bpPerPx)\n  const end = bpToPx(rightBp, region, bpPerPx)\n  return region.reversed ? ([end, start] as const) : ([start, end] as const)\n}\n\n/**\n * Calculate layout bounds for a feature, accounting for reversed regions.\n *\n * When labels are wider than features, the layout needs extra space:\n * - Normal: extend towards higher genomic coords (visual right)\n * - Reversed: extend towards lower genomic coords (visual right when reversed)\n *\n * This ensures labels always extend towards visual right of the feature.\n *\n * @param featureStart - Feature's genomic start coordinate\n * @param featureEnd - Feature's genomic end coordinate\n * @param layoutWidthBp - Total layout width in base pairs (may include label space)\n * @param reversed - Whether the region is reversed\n * @returns [layoutStart, layoutEnd] in genomic coordinates\n */\nexport function calculateLayoutBounds(\n  featureStart: number,\n  featureEnd: number,\n  layoutWidthBp: number,\n  reversed?: boolean,\n): [number, number] {\n  const featureWidthBp = featureEnd - featureStart\n  const labelOverhangBp = Math.max(0, layoutWidthBp - featureWidthBp)\n\n  // When reversed, extend towards lower genomic coords (visual right when reversed)\n  // When normal, extend towards higher genomic coords (visual right when normal)\n  return reversed\n    ? [featureStart - labelOverhangBp, featureEnd]\n    : [featureStart, featureStart + layoutWidthBp]\n}\n\n// do an array map of an iterable\nexport function iterMap<T, U>(\n  iter: Iterable<T>,\n  func: (arg: T) => U,\n  sizeHint?: number,\n) {\n  const results = Array.from<U>({ length: sizeHint || 0 })\n  let counter = 0\n  for (const item of iter) {\n    results[counter] = func(item)\n    counter += 1\n  }\n  return results\n}\n\n/**\n * Returns the index of the last element in the array where predicate is true,\n * and -1 otherwise. Based on https://stackoverflow.com/a/53187807\n *\n * @param array - The source array to search in\n *\n * @param predicate - find calls predicate once for each element of the array, in\n * descending order, until it finds one where predicate returns true.\n *\n * @returns findLastIndex returns element index where predicate is true.\n * Otherwise, findLastIndex returns -1.\n */\nexport function findLastIndex<T>(\n  array: T[],\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n) {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l]!, l, array)) {\n      return l\n    }\n  }\n  return -1\n}\n\nexport function findLast<T>(\n  array: T[],\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n) {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l]!, l, array)) {\n      return array[l]\n    }\n  }\n  return undefined\n}\n\nexport function renameRegionIfNeeded(\n  refNameMap: Record<string, string> | undefined,\n  region: Region | Instance<typeof MUIRegion>,\n): Region & { originalRefName?: string } {\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return region\n  }\n\n  if (refNameMap?.[region.refName]) {\n    // clone the region so we don't modify it\n    region = isStateTreeNode(region)\n      ? { ...getSnapshot(region) }\n      : { ...region }\n\n    // modify it directly in the container\n    const newRef = refNameMap[region.refName]\n    if (newRef) {\n      return {\n        ...region,\n        refName: newRef,\n        originalRefName: region.refName,\n      }\n    }\n  }\n  return region\n}\n\nexport async function renameRegionsIfNeeded<\n  ARGTYPE extends {\n    assemblyName?: string\n    regions?: Region[]\n    stopToken?: string\n    adapterConfig: Record<string, unknown>\n    sessionId: string\n    statusCallback?: (arg: string) => void\n  },\n>(assemblyManager: AssemblyManager, args: ARGTYPE) {\n  const { regions = [], adapterConfig } = args\n  if (!args.sessionId) {\n    throw new Error('sessionId is required')\n  }\n\n  const assemblyNames = regions.map(region => region.assemblyName)\n  const assemblyMaps = Object.fromEntries(\n    await Promise.all(\n      [...new Set(assemblyNames)].map(async assemblyName => {\n        return [\n          assemblyName,\n          await assemblyManager.getRefNameMapForAdapter(\n            adapterConfig,\n            assemblyName,\n            args,\n          ),\n        ]\n      }),\n    ),\n  )\n\n  return {\n    ...args,\n    regions: regions.map((region, i) =>\n      // note: uses assemblyNames defined above since region could be dead now\n      renameRegionIfNeeded(assemblyMaps[assemblyNames[i]!], region),\n    ),\n  }\n}\n\nexport function minmax(a: number, b: number) {\n  return [Math.min(a, b), Math.max(a, b)] as const\n}\n\nexport function shorten(name: string, max = 70, short = 30) {\n  return name.length > max\n    ? `${name.slice(0, short)}...${name.slice(-short)}`\n    : name\n}\n\nexport function shorten2(name: string, max = 70) {\n  return name.length > max ? `${name.slice(0, max)}...` : name\n}\n\nexport function stringify(\n  {\n    refName,\n    coord,\n    assemblyName,\n    oob,\n  }: {\n    assemblyName?: string\n    coord: number\n    refName?: string\n    oob?: boolean\n  },\n  useAssemblyName?: boolean,\n) {\n  return [\n    assemblyName && useAssemblyName ? `{${assemblyName}}` : '',\n    refName\n      ? `${shorten(refName)}:${toLocale(coord)}${oob ? ' (out of bounds)' : ''}`\n      : '',\n  ].join('')\n}\n\n// this is recommended in a later comment in\n// https://github.com/electron/electron/issues/2288 for detecting electron in a\n// renderer process, which is the one that has node enabled for us\n//\n// const isElectron = process.versions.electron\n// const i2 = process.versions.hasOwnProperty('electron')\nexport const isElectron = /electron/i.test(\n  typeof navigator !== 'undefined' ? navigator.userAgent : '',\n)\n\n// from bioperl: tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/\n// generated with:\n// perl -MJSON -E '@l = split \"\",\"acgtrymkswhbvdnxACGTRYMKSWHBVDNX\"; print to_json({ map { my $in = $_; tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/; $in => $_ } @l})'\nexport const complementTable = {\n  S: 'S',\n  w: 'w',\n  T: 'A',\n  r: 'y',\n  a: 't',\n  N: 'N',\n  K: 'M',\n  x: 'x',\n  d: 'h',\n  Y: 'R',\n  V: 'B',\n  y: 'r',\n  M: 'K',\n  h: 'd',\n  k: 'm',\n  C: 'G',\n  g: 'c',\n  t: 'a',\n  A: 'T',\n  n: 'n',\n  W: 'W',\n  X: 'X',\n  m: 'k',\n  v: 'b',\n  B: 'V',\n  s: 's',\n  H: 'D',\n  c: 'g',\n  D: 'H',\n  b: 'v',\n  R: 'Y',\n  G: 'C',\n} as Record<string, string>\n\nexport function revcom(str: string) {\n  const revcomped = []\n  for (let i = str.length - 1; i >= 0; i--) {\n    revcomped.push(complementTable[str[i]!] ?? str[i])\n  }\n  return revcomped.join('')\n}\n\nexport function reverse(str: string) {\n  const reversed = []\n  for (let i = str.length - 1; i >= 0; i--) {\n    reversed.push(str[i]!)\n  }\n  return reversed.join('')\n}\n\nexport function complement(str: string) {\n  const comp = []\n  for (let i = 0, l = str.length; i < l; i++) {\n    comp.push(complementTable[str[i]!] ?? str[i]!)\n  }\n  return comp.join('')\n}\n\n// requires immediate execution in jest environment, because (hypothesis) it\n// otherwise listens for prerendered_canvas but reads empty pixels, and doesn't\n// get the contents of the canvas\nexport const rIC =\n  typeof jest === 'undefined'\n    ? // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      typeof window !== 'undefined' && window.requestIdleCallback\n      ? window.requestIdleCallback\n      : (cb: () => void) =>\n          setTimeout(() => {\n            cb()\n          }, 1)\n    : (cb: () => void) => {\n        cb()\n      }\n\n// prettier-ignore\nconst widths = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2796875,0.2765625,0.3546875,0.5546875,0.5546875,0.8890625,0.665625,0.190625,0.3328125,0.3328125,0.3890625,0.5828125,0.2765625,0.3328125,0.2765625,0.3015625,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.2765625,0.2765625,0.584375,0.5828125,0.584375,0.5546875,1.0140625,0.665625,0.665625,0.721875,0.721875,0.665625,0.609375,0.7765625,0.721875,0.2765625,0.5,0.665625,0.5546875,0.8328125,0.721875,0.7765625,0.665625,0.7765625,0.721875,0.665625,0.609375,0.721875,0.665625,0.94375,0.665625,0.665625,0.609375,0.2765625,0.3546875,0.2765625,0.4765625,0.5546875,0.3328125,0.5546875,0.5546875,0.5,0.5546875,0.5546875,0.2765625,0.5546875,0.5546875,0.221875,0.240625,0.5,0.221875,0.8328125,0.5546875,0.5546875,0.5546875,0.5546875,0.3328125,0.5,0.2765625,0.5546875,0.5,0.721875,0.5,0.5,0.5,0.3546875,0.259375,0.353125,0.5890625]\nconst avgWidth = 0.5279276315789471\n\n// xref https://gist.github.com/tophtucker/62f93a4658387bb61e4510c37e2e97cf\nexport function measureText(str: unknown, fontSize = 10) {\n  const s = String(str)\n  let total = 0\n  for (let i = 0, l = s.length; i < l; i++) {\n    total += widths[s.charCodeAt(i)] ?? avgWidth\n  }\n  return total * fontSize\n}\n\nexport type Frame = 1 | 2 | 3 | -1 | -2 | -3\n\nexport function getFrame(\n  start: number,\n  end: number,\n  strand: 1 | -1,\n  phase: 0 | 1 | 2,\n): Frame {\n  return strand === 1\n    ? ((((start + phase) % 3) + 1) as 1 | 2 | 3)\n    : ((-1 * ((end - phase) % 3) - 1) as -1 | -2 | -3)\n}\n\nexport const defaultStarts = ['ATG']\nexport const defaultStops = ['TAA', 'TAG', 'TGA']\nexport const defaultCodonTable = {\n  TCA: 'S',\n  TCC: 'S',\n  TCG: 'S',\n  TCT: 'S',\n  TTC: 'F',\n  TTT: 'F',\n  TTA: 'L',\n  TTG: 'L',\n  TAC: 'Y',\n  TAT: 'Y',\n  TAA: '*',\n  TAG: '*',\n  TGC: 'C',\n  TGT: 'C',\n  TGA: '*',\n  TGG: 'W',\n  CTA: 'L',\n  CTC: 'L',\n  CTG: 'L',\n  CTT: 'L',\n  CCA: 'P',\n  CCC: 'P',\n  CCG: 'P',\n  CCT: 'P',\n  CAC: 'H',\n  CAT: 'H',\n  CAA: 'Q',\n  CAG: 'Q',\n  CGA: 'R',\n  CGC: 'R',\n  CGG: 'R',\n  CGT: 'R',\n  ATA: 'I',\n  ATC: 'I',\n  ATT: 'I',\n  ATG: 'M',\n  ACA: 'T',\n  ACC: 'T',\n  ACG: 'T',\n  ACT: 'T',\n  AAC: 'N',\n  AAT: 'N',\n  AAA: 'K',\n  AAG: 'K',\n  AGC: 'S',\n  AGT: 'S',\n  AGA: 'R',\n  AGG: 'R',\n  GTA: 'V',\n  GTC: 'V',\n  GTG: 'V',\n  GTT: 'V',\n  GCA: 'A',\n  GCC: 'A',\n  GCG: 'A',\n  GCT: 'A',\n  GAC: 'D',\n  GAT: 'D',\n  GAA: 'E',\n  GAG: 'E',\n  GGA: 'G',\n  GGC: 'G',\n  GGG: 'G',\n  GGT: 'G',\n}\n\n/**\n * take CodonTable above and generate larger codon table that includes all\n * permutations of upper and lower case nucleotides\n */\nexport function generateCodonTable(table: any) {\n  const tempCodonTable: Record<string, string> = {}\n  for (const codon of Object.keys(table)) {\n    const aa = table[codon]\n    const nucs: string[][] = []\n    for (let i = 0; i < 3; i++) {\n      const nuc = codon.charAt(i)\n      nucs[i] = []\n      nucs[i]![0] = nuc.toUpperCase()\n      nucs[i]![1] = nuc.toLowerCase()\n    }\n    for (let i = 0; i < 2; i++) {\n      const n0 = nucs[0]![i]!\n      for (let j = 0; j < 2; j++) {\n        const n1 = nucs[1]![j]!\n        for (let k = 0; k < 2; k++) {\n          const n2 = nucs[2]![k]!\n          const triplet = n0 + n1 + n2\n          tempCodonTable[triplet] = aa\n        }\n      }\n    }\n  }\n  return tempCodonTable\n}\n\n// call statusCallback with current status and clear when finished\nexport async function updateStatus<U>(\n  msg: string,\n  cb: ((arg: string) => void) | undefined,\n  fn: () => U | Promise<U>,\n) {\n  cb?.(msg)\n  const res = await fn()\n  cb?.('')\n  return res\n}\n\n// call statusCallback with current status and clear when finished, and check\n// stopToken afterwards\nexport async function updateStatus2<U>(\n  msg: string,\n  cb: (arg: string) => void,\n  stopToken: StopToken | undefined,\n  fn: () => U | Promise<U>,\n) {\n  cb(msg)\n  const res = await fn()\n  checkStopToken(stopToken)\n  cb('')\n  return res\n}\n\nexport function hashCode(str: string) {\n  let hash = 0\n  if (str.length === 0) {\n    return hash\n  }\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i)\n    hash = (hash << 5) - hash + chr\n    hash |= 0 // Convert to 32bit integer\n  }\n  return hash\n}\n\nexport function objectHash(obj: Record<string, any>) {\n  return `${hashCode(JSON.stringify(obj))}`\n}\n\ninterface VirtualOffset {\n  blockPosition: number\n}\n\ninterface Block {\n  minv: VirtualOffset\n  maxv: VirtualOffset\n}\n\nexport async function bytesForRegions(\n  regions: Region[],\n  index: {\n    blocksForRange: (\n      ref: string,\n      start: number,\n      end: number,\n    ) => Promise<Block[]>\n  },\n) {\n  const blockResults = await Promise.all(\n    regions.map(r => index.blocksForRange(r.refName, r.start, r.end)),\n  )\n\n  return sum(\n    blockResults\n      .flat()\n      .map(\n        block => block.maxv.blockPosition + 65535 - block.minv.blockPosition,\n      ),\n  )\n}\n\nexport interface ViewSnap {\n  bpPerPx: number\n  interRegionPaddingWidth: number\n  minimumBlockWidth: number\n  width: number\n  offsetPx: number\n  staticBlocks: { contentBlocks: BaseBlock[]; blocks: BaseBlock[] }\n  displayedRegions: (IStateTreeNode & {\n    start: number\n    end: number\n    refName: string\n    reversed?: boolean\n    assemblyName: string\n  })[]\n}\n\n// Supported adapter types by text indexer ensure that this matches the method\n// found in @jbrowse/text-indexing/util\nexport function isSupportedIndexingAdapter(type = '') {\n  return [\n    'Gff3TabixAdapter',\n    'VcfTabixAdapter',\n    'Gff3Adapter',\n    'VcfAdapter',\n  ].includes(type)\n}\n\nexport function getBpDisplayStr(total: number) {\n  if (Math.floor(total / 1_000_000) > 0) {\n    return `${reducePrecision(total / 1_000_000)}Mbp`\n  } else if (Math.floor(total / 1_000) > 0) {\n    return `${reducePrecision(total / 1_000)}Kbp`\n  } else {\n    return `${Math.floor(total)}bp`\n  }\n}\n\nexport function reducePrecision(s: number, n = 3) {\n  return toLocale(Number.parseFloat(s.toPrecision(n)))\n}\n\nexport function getProgressDisplayStr(current: number, total: number) {\n  if (Math.floor(total / 1_000_000) > 0) {\n    return `${reducePrecision(current / 1_000_000)}/${reducePrecision(total / 1_000_000)}Mb`\n  } else if (Math.floor(total / 1_000) > 0) {\n    return `${reducePrecision(current / 1_000)}/${reducePrecision(total / 1_000)}Kb`\n  } else {\n    return `${reducePrecision(current)}/${reducePrecision(total)} bytes`\n  }\n}\n\n// Fast number formatter with thousand separators\n// Benchmarked at 5-67x faster than toLocaleString('en-US')\nexport function toLocale(n: number) {\n  if (n < 1000) {\n    return String(n)\n  }\n  const str = String(n)\n  const len = str.length\n  let result = ''\n  for (let i = 0; i < len; i++) {\n    if (i > 0 && (len - i) % 3 === 0) {\n      result += ','\n    }\n    result += str[i]\n  }\n  return result\n}\n\nexport function getTickDisplayStr(totalBp: number, bpPerPx: number) {\n  return Math.floor(bpPerPx / 1_000) > 0\n    ? `${toLocale(Number.parseFloat((totalBp / 1_000_000).toFixed(2)))}M`\n    : toLocale(Math.floor(totalBp))\n}\n\nexport function getLayoutId({\n  sessionId,\n  trackInstanceId,\n}: {\n  sessionId: string\n  trackInstanceId: string\n}) {\n  return `${sessionId}-${trackInstanceId}`\n}\n\nexport function getStatsId({\n  sessionId,\n  trackInstanceId,\n}: {\n  sessionId: string\n  trackInstanceId: string\n}) {\n  return `${sessionId}-${trackInstanceId}`\n}\n\n// Hook from https://usehooks.com/useLocalStorage/\nexport function useLocalStorage<T>(\n  key: string,\n  initialValue: T,\n  enabled = true,\n) {\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    if (typeof window === 'undefined' || !enabled) {\n      return initialValue\n    }\n    try {\n      const item = window.localStorage.getItem(key)\n      return item ? JSON.parse(item) : initialValue\n    } catch (error) {\n      console.error(error)\n      return initialValue\n    }\n  })\n  const setValue = (value: T | ((val: T) => T)) => {\n    try {\n      const valueToStore =\n        // eslint-disable-next-line unicorn/no-instanceof-builtins\n        value instanceof Function ? value(storedValue) : value\n      setStoredValue(valueToStore)\n      if (typeof window !== 'undefined' && enabled) {\n        window.localStorage.setItem(key, JSON.stringify(valueToStore))\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  }\n  return [storedValue, setValue] as const\n}\n\nexport function getUriLink(value: { uri: string; baseUri?: string }) {\n  const { uri, baseUri = '' } = value\n  let href: string\n  try {\n    href = new URL(uri, baseUri).href\n  } catch (e) {\n    href = uri\n  }\n  return href\n}\n\nexport function getStr(obj: unknown) {\n  return isObject(obj)\n    ? isUriLocation(obj)\n      ? getUriLink(obj)\n      : JSON.stringify(obj)\n    : String(obj)\n}\n\n// based on autolink-js, license MIT\n// https://github.com/bryanwoods/autolink-js/blob/1418049970152c56ced73d43dcc62d80b320fb71/autolink.js#L9\nexport function linkify(s: string) {\n  const pattern =\n    /(^|[\\s\\n]|<[A-Za-z]*\\/?>)((?:https?|ftp):\\/\\/[-A-Z0-9+\\u0026\\u2019@#/%?=()~_|!:,.;]*[-A-Z0-9+\\u0026@#/%=~()_|])/gi\n  return s.replaceAll(pattern, '$1<a href=\\'$2\\' target=\"_blank\">$2</a>')\n}\n\n// heuristic measurement for a column of a @mui/x-data-grid, pass in\n// values from a column\nexport function measureGridWidth(\n  elements: unknown[],\n  args?: {\n    minWidth?: number\n    fontSize?: number\n    maxWidth?: number\n    padding?: number\n    stripHTML?: boolean\n  },\n) {\n  const {\n    padding = 30,\n    minWidth = 80,\n    fontSize = 12,\n    maxWidth = 1000,\n    stripHTML = false,\n  } = args || {}\n  return max(\n    elements\n      .map(element => getStr(element))\n      .map(str => (stripHTML ? coarseStripHTML(str) : str))\n      .map(str => measureText(str, fontSize))\n      .map(n => Math.min(Math.max(n + padding, minWidth), maxWidth)),\n  )\n}\n\nexport function getEnv(obj: any) {\n  return getEnvMST<{ pluginManager: PluginManager }>(obj)\n}\n\nexport function localStorageGetItem(item: string) {\n  return typeof localStorage !== 'undefined'\n    ? localStorage.getItem(item)\n    : undefined\n}\n\nexport function localStorageSetItem(str: string, item: string) {\n  if (typeof localStorage !== 'undefined') {\n    localStorage.setItem(str, item)\n  }\n}\n\nexport function max(arr: Iterable<number>, init = Number.NEGATIVE_INFINITY) {\n  let max = init\n  for (const entry of arr) {\n    max = Math.max(entry, max)\n  }\n  return max\n}\n\nexport function min(arr: Iterable<number>, init = Number.POSITIVE_INFINITY) {\n  let min = init\n  for (const entry of arr) {\n    min = Math.min(entry, min)\n  }\n  return min\n}\n\nexport function sum(arr: Iterable<number>) {\n  let sum = 0\n  for (const entry of arr) {\n    sum += entry\n  }\n  return sum\n}\n\nexport function avg(arr: number[]) {\n  return sum(arr) / arr.length\n}\n\nexport function groupBy<T>(array: Iterable<T>, predicate: (v: T) => string) {\n  const result = {} as Record<string, T[]>\n  for (const value of array) {\n    const t = predicate(value)\n    if (!result[t]) {\n      result[t] = []\n    }\n    result[t].push(value)\n  }\n  return result\n}\n\nexport function notEmpty<T>(value: T | null | undefined): value is T {\n  return value !== null && value !== undefined\n}\n\nexport function mergeIntervals<T extends { start: number; end: number }>(\n  intervals: T[],\n  w = 5000,\n) {\n  // test if there are at least 2 intervals\n  if (intervals.length <= 1) {\n    return intervals\n  }\n\n  const stack = [] as T[]\n  let top = null\n\n  // sort the intervals based on their start values\n  intervals = intervals.sort((a, b) => a.start - b.start)\n\n  // push the 1st interval into the stack\n  stack.push(intervals[0]!)\n\n  // start from the next interval and merge if needed\n  for (let i = 1; i < intervals.length; i++) {\n    // get the top element\n    top = stack.at(-1)!\n\n    // if the current interval doesn't overlap with the\n    // stack top element, push it to the stack\n    if (top.end + w < intervals[i]!.start - w) {\n      stack.push(intervals[i]!)\n    }\n    // otherwise update the end value of the top element\n    // if end of current interval is higher\n    else if (top.end < intervals[i]!.end) {\n      top.end = Math.max(top.end, intervals[i]!.end)\n      stack.pop()\n      stack.push(top)\n    }\n  }\n\n  return stack\n}\n\nexport interface BasicFeature {\n  end: number\n  start: number\n  refName: string\n}\n\n// returns new array non-overlapping features\nexport function gatherOverlaps<T extends BasicFeature>(regions: T[], w = 5000) {\n  const memo = {} as Record<string, T[]>\n  for (const x of regions) {\n    if (!memo[x.refName]) {\n      memo[x.refName] = []\n    }\n    memo[x.refName]!.push(x)\n  }\n\n  return Object.values(memo).flatMap(group =>\n    mergeIntervals(\n      group.sort((a, b) => a.start - b.start),\n      w,\n    ),\n  )\n}\n\nexport function stripAlpha(str: string) {\n  return colord(str).alpha(1).toHex()\n}\n\nexport function getStrokeProps(str: string) {\n  if (str) {\n    const c = colord(str)\n    return {\n      strokeOpacity: c.alpha(),\n      stroke: c.alpha(1).toHex(),\n    }\n  } else {\n    return {}\n  }\n}\n\nexport function getFillProps(str: string) {\n  if (str) {\n    const c = colord(str)\n    return {\n      fillOpacity: c.alpha(),\n      fill: c.alpha(1).toHex(),\n    }\n  } else {\n    return {}\n  }\n}\n\n// https://react.dev/reference/react-dom/server/renderToString#removing-rendertostring-from-the-client-code\nexport function renderToStaticMarkup(node: React.ReactElement) {\n  const div = document.createElement('div')\n  flushSync(() => {\n    createRoot(div).render(node)\n  })\n  return div.innerHTML.replaceAll(/\\brgba\\((.+?),[^,]+?\\)/g, 'rgb($1)')\n}\n\nexport function isGzip(buf: Uint8Array) {\n  return buf[0] === 31 && buf[1] === 139 && buf[2] === 8\n}\n\nexport async function fetchAndMaybeUnzip(\n  loc: GenericFilehandle,\n  opts: BaseOptions = {},\n) {\n  const { statusCallback = () => {} } = opts\n  const buf = await updateStatus(\n    'Downloading file',\n    statusCallback,\n    () => loc.readFile(opts) as Promise<Uint8Array>,\n  )\n  return isGzip(buf)\n    ? await updateStatus('Unzipping', statusCallback, () => unzip(buf))\n    : buf\n}\n\nexport async function fetchAndMaybeUnzipText(\n  loc: GenericFilehandle,\n  opts?: BaseOptions,\n) {\n  const buffer = await fetchAndMaybeUnzip(loc, opts)\n  // 512MB  max chrome string length is 512MB\n  if (buffer.length > 536_870_888) {\n    throw new Error('Data exceeds maximum string length (512MB)')\n  }\n  return new TextDecoder('utf8', { fatal: true }).decode(buffer)\n}\n\n// MIT https://github.com/inspect-js/is-object\nexport function isObject(\n  x: unknown,\n): x is Record<string | symbol | number, unknown> {\n  return typeof x === 'object' && x !== null\n}\n\nexport function localStorageGetNumber(key: string, defaultVal: number) {\n  return +(localStorageGetItem(key) ?? defaultVal)\n}\n\nexport function localStorageGetBoolean(key: string, defaultVal: boolean) {\n  return Boolean(\n    JSON.parse(localStorageGetItem(key) || JSON.stringify(defaultVal)),\n  )\n}\n\nexport function localStorageSetBoolean(key: string, value: boolean) {\n  localStorageSetItem(key, JSON.stringify(value))\n}\n\nexport function testAdapter(\n  fileName: string,\n  regex: RegExp,\n  adapterHint: string | undefined,\n  expected: string,\n) {\n  return (regex.test(fileName) && !adapterHint) || adapterHint === expected\n}\n\nexport {\n  type Feature,\n  type SimpleFeatureSerialized,\n  type SimpleFeatureSerializedNoId,\n  default as SimpleFeature,\n  isFeature,\n} from './simpleFeature.ts'\n\nexport { blobToDataURL } from './blobToDataURL.ts'\nexport { makeAbortableReaction } from './makeAbortableReaction.ts'\nexport * from './aborting.ts'\nexport * from './linkify.ts'\nexport * from './locString.ts'\nexport * from './stopToken.ts'\nexport * from './tracks.ts'\nexport * from './fileHandleStore.ts'\nexport { IntervalTree } from './IntervalTree.ts'\n","import { Suspense, lazy } from 'react'\n\nimport { observer } from 'mobx-react'\n\nimport type { SnackbarMessage } from './SnackbarModel.tsx'\nimport type { AbstractSessionModel } from '../util/index.ts'\n\nconst SnackbarContents = lazy(() => import('./SnackbarContents.tsx'))\n\ninterface SnackbarSession extends AbstractSessionModel {\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => void\n}\n\nconst Snackbar = observer(function Snackbar({\n  session,\n}: {\n  session: SnackbarSession\n}) {\n  const { snackbarMessages } = session\n  const latestMessage = snackbarMessages.at(-1)\n\n  return latestMessage ? (\n    <Suspense fallback={null}>\n      <SnackbarContents\n        onClose={(_event, reason) => {\n          if (reason !== 'clickaway') {\n            session.popSnackbarMessage()\n          }\n        }}\n        contents={latestMessage}\n      />\n    </Suspense>\n  ) : null\n})\n\nexport default Snackbar\n","import { makeStyles } from '@jbrowse/core/util/tss-react'\nimport LaunchIcon from '@mui/icons-material/Launch'\nimport { Fab, Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { SessionWithDrawerWidgets } from '@jbrowse/core/util'\n\nconst useStyles = makeStyles()(theme => ({\n  left: {\n    zIndex: 10000,\n    position: 'fixed',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2),\n  },\n  right: {\n    zIndex: 10000,\n    position: 'fixed',\n    bottom: theme.spacing(2),\n    right: theme.spacing(2),\n  },\n}))\n\nconst AppFab = observer(function AppFab({\n  session,\n}: {\n  session: SessionWithDrawerWidgets\n}) {\n  const { minimized, activeWidgets, drawerPosition } = session\n  const { classes } = useStyles()\n\n  return activeWidgets.size > 0 && minimized ? (\n    <Tooltip title=\"Open drawer widget\">\n      <Fab\n        className={drawerPosition === 'right' ? classes.right : classes.left}\n        color=\"primary\"\n        data-testid=\"drawer-maximize\"\n        onClick={() => {\n          session.showWidgetDrawer()\n        }}\n      >\n        <LaunchIcon />\n      </Fab>\n    </Tooltip>\n  ) : null\n})\n\nexport default AppFab\n","import { observer } from 'mobx-react'\n\nimport { LogoFull } from './Logo.tsx'\nimport { readConfObject } from '../configuration/index.ts'\n\nimport type { AnyConfigurationModel } from '../configuration/index.ts'\n\nconst Logo = observer(function Logo({\n  session,\n}: {\n  session: { configuration: AnyConfigurationModel }\n}) {\n  const { configuration } = session\n  const logoPath = readConfObject(configuration, 'logoPath')\n  return logoPath?.uri ? (\n    <img src={logoPath.uri} alt=\"Custom logo\" />\n  ) : (\n    <LogoFull variant=\"white\" />\n  )\n})\n\nexport default Logo\n","import { makeStyles } from '@jbrowse/core/util/tss-react'\nimport ArrowDropDown from '@mui/icons-material/ArrowDropDown'\nimport { Button, alpha } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport CascadingMenuButton from './CascadingMenuButton.tsx'\n\nimport type { MenuItem } from './Menu.tsx'\nimport type { ButtonProps } from '@mui/material'\n\nconst useStyles = makeStyles()(theme => ({\n  buttonRoot: {\n    '&:hover': {\n      backgroundColor: alpha(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nfunction ButtonComponent(props: ButtonProps) {\n  const { classes } = useStyles()\n  return (\n    <Button {...props} className={classes.buttonRoot}>\n      {props.children}\n    </Button>\n  )\n}\n\nconst DropDownMenu = observer(function DropDownMenu({\n  menuTitle,\n  menuItems,\n}: {\n  menuTitle: string\n  menuItems: MenuItem[] | (() => MenuItem[])\n}) {\n  return (\n    <CascadingMenuButton\n      menuItems={menuItems}\n      color=\"inherit\"\n      ButtonComponent={ButtonComponent}\n    >\n      {menuTitle}\n      <ArrowDropDown />\n    </CascadingMenuButton>\n  )\n})\n\nexport default DropDownMenu\n","import AppLogo from '@jbrowse/core/ui/AppLogo'\nimport DropDownMenu from '@jbrowse/core/ui/DropDownMenu'\nimport EditableTypography from '@jbrowse/core/ui/EditableTypography'\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { Toolbar, Tooltip } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { MenuItem as JBMenuItem } from '@jbrowse/core/ui/Menu'\nimport type { SnackbarMessage } from '@jbrowse/core/ui/SnackbarModel'\nimport type { SessionWithDrawerWidgets } from '@jbrowse/core/util'\n\nconst useStyles = makeStyles()(theme => ({\n  grow: {\n    flexGrow: 1,\n  },\n  inputBase: {\n    color: theme.palette.primary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.primary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.secondary.main,\n    backgroundColor: theme.palette.primary.light,\n  },\n}))\n\ninterface Menu {\n  label: string\n  menuItems: JBMenuItem[] | (() => JBMenuItem[])\n}\n\ntype AppSession = SessionWithDrawerWidgets & {\n  menus: () => Menu[]\n  snackbarMessages: SnackbarMessage[]\n  renameCurrentSession: (arg: string) => void\n  popSnackbarMessage: () => unknown\n}\n\nfunction wrapMenuItems(items: JBMenuItem[], session: AppSession): JBMenuItem[] {\n  return items.map(item => ({\n    ...item,\n    ...('onClick' in item\n      ? {\n          onClick: () => {\n            item.onClick(session)\n          },\n        }\n      : {}),\n    ...('subMenu' in item\n      ? { subMenu: wrapMenuItems(item.subMenu, session) }\n      : {}),\n  }))\n}\n\nconst AppToolbar = observer(function AppToolbar({\n  session,\n  HeaderButtons = <div />,\n}: {\n  HeaderButtons?: React.ReactElement\n  session: AppSession\n}) {\n  const { classes } = useStyles()\n  const { name, menus } = session\n\n  return (\n    <Toolbar>\n      {menus().map(menu => (\n        <DropDownMenu\n          key={menu.label}\n          menuTitle={menu.label}\n          menuItems={() => {\n            const items =\n              typeof menu.menuItems === 'function'\n                ? menu.menuItems()\n                : menu.menuItems\n            return wrapMenuItems(items, session)\n          }}\n        />\n      ))}\n      <div className={classes.grow} />\n      <Tooltip title=\"Rename session\" arrow>\n        <EditableTypography\n          value={name}\n          variant=\"body1\"\n          classes={{\n            inputBase: classes.inputBase,\n            inputRoot: classes.inputRoot,\n            inputFocused: classes.inputFocused,\n          }}\n          setValue={newName => {\n            session.renameCurrentSession(newName)\n          }}\n        />\n      </Tooltip>\n      {HeaderButtons}\n      <div className={classes.grow} />\n      <div\n        style={{\n          width: 150,\n          maxHeight: 48,\n        }}\n      >\n        <AppLogo session={session} />\n      </div>\n    </Toolbar>\n  )\n})\n\nexport default AppToolbar\n","import { Suspense } from 'react'\n\nimport { observer } from 'mobx-react'\n\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nconst DialogQueue = observer(function DialogQueue({\n  session,\n}: {\n  session: AbstractSessionModel\n}) {\n  const { DialogComponent, DialogProps } = session\n  return DialogComponent ? (\n    <Suspense fallback={null}>\n      <DialogComponent {...DialogProps} />\n    </Suspense>\n  ) : null\n})\n\nexport default DialogQueue\n","import { Suspense, lazy } from 'react'\n\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { observer } from 'mobx-react'\n\nimport type { SnackbarMessage } from '@jbrowse/core/ui/SnackbarModel'\nimport type {\n  AbstractViewContainer,\n  SessionWithFocusedViewAndDrawerWidgets,\n} from '@jbrowse/core/util'\n\nconst ClassicViewsContainer = lazy(() => import('./ClassicViewsContainer.tsx'))\nconst TiledViewsContainer = lazy(() => import('./TiledViewsContainer.tsx'))\nconst ViewLauncher = lazy(() => import('./ViewLauncher.tsx'))\n\nconst useStyles = makeStyles()({\n  viewsContainer: {\n    gridRow: 'components',\n    overflow: 'hidden',\n  },\n})\n\ninterface Props {\n  HeaderButtons?: React.ReactElement\n  session: SessionWithFocusedViewAndDrawerWidgets &\n    AbstractViewContainer & {\n      renameCurrentSession: (arg: string) => void\n      snackbarMessages: SnackbarMessage[]\n      popSnackbarMessage: () => unknown\n    }\n}\n\nconst ViewsContainer = observer(function ViewsContainer(props: Props) {\n  const { session } = props\n  const { views } = session\n  const { classes } = useStyles()\n\n  // Check if useWorkspaces property exists and is true (defaults to true if property exists)\n  const useWorkspaces =\n    'useWorkspaces' in session ? (session.useWorkspaces as boolean) : true\n\n  return (\n    <div className={classes.viewsContainer}>\n      {views.length > 0 ? (\n        <Suspense fallback={null}>\n          {useWorkspaces ? (\n            <TiledViewsContainer session={session} />\n          ) : (\n            <ClassicViewsContainer session={session} />\n          )}\n        </Suspense>\n      ) : (\n        <Suspense fallback={null}>\n          <ViewLauncher {...props} />\n        </Suspense>\n      )}\n    </div>\n  )\n})\n\nexport default ViewsContainer\n","import { Suspense, lazy } from 'react'\n\nimport Snackbar from '@jbrowse/core/ui/Snackbar'\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport { AppBar } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport AppFab from './AppFab.tsx'\nimport AppToolbar from './AppToolbar.tsx'\nimport DialogQueue from './DialogQueue.tsx'\nimport ViewsContainer from './ViewsContainer.tsx'\n\nimport type { MenuItem as JBMenuItem } from '@jbrowse/core/ui'\nimport type { SnackbarMessage } from '@jbrowse/core/ui/SnackbarModel'\nimport type { SessionWithFocusedViewAndDrawerWidgets } from '@jbrowse/core/util'\n\n// lazies\nconst DrawerWidget = lazy(() => import('./DrawerWidget.tsx'))\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    display: 'grid',\n    height: '100vh',\n    width: '100%',\n    colorScheme: theme.palette.mode,\n  },\n  appContainer: {\n    gridColumn: 'main',\n    display: 'grid',\n    gridTemplateRows: '[menubar] min-content [components] auto',\n    height: '100vh',\n  },\n\n  appBar: {\n    flexGrow: 1,\n    gridRow: 'menubar',\n  },\n}))\n\ninterface Menu {\n  label: string\n  menuItems: JBMenuItem[]\n}\n\ninterface Props {\n  HeaderButtons?: React.ReactElement\n  session: SessionWithFocusedViewAndDrawerWidgets & {\n    menus: () => Menu[]\n    snackbarMessages: SnackbarMessage[]\n    renameCurrentSession: (arg: string) => void\n    popSnackbarMessage: () => unknown\n  }\n}\n\nconst LazyDrawerWidget = observer(function LazyDrawerWidget(props: Props) {\n  const { session } = props\n  return (\n    <Suspense fallback={null}>\n      <DrawerWidget session={session} />\n    </Suspense>\n  )\n})\n\nconst App = observer(function App(props: Props) {\n  const { session } = props\n  const { classes } = useStyles()\n  const { minimized, visibleWidget, drawerWidth, drawerPosition } = session\n  const drawerVisible = visibleWidget && !minimized\n  const d = drawerVisible ? `[drawer] ${drawerWidth}px` : undefined\n  const grid =\n    drawerPosition === 'right' ? ['[main] 1fr', d] : [d, '[main] 1fr']\n\n  return (\n    <div\n      className={classes.root}\n      style={{ gridTemplateColumns: grid.filter(f => !!f).join(' ') }}\n    >\n      {drawerVisible && drawerPosition === 'left' ? (\n        <LazyDrawerWidget session={session} />\n      ) : null}\n      <DialogQueue session={session} />\n      <div className={classes.appContainer}>\n        <AppBar className={classes.appBar} position=\"static\">\n          <AppToolbar {...props} />\n        </AppBar>\n        <ViewsContainer {...props} />\n      </div>\n      <AppFab session={session} />\n\n      {drawerVisible && drawerPosition === 'right' ? (\n        <LazyDrawerWidget session={session} />\n      ) : null}\n\n      <Snackbar session={session} />\n    </div>\n  )\n})\n\nexport { App }\n","import { useEffect, useState } from 'react'\n\nimport {\n  getPendingFileHandleIds,\n  restorePendingFileHandles,\n} from '@jbrowse/core/util/tracks'\nimport { Alert, Button } from '@mui/material'\n\nexport default function FileHandleRestoreBanner() {\n  const [pendingCount, setPendingCount] = useState(0)\n  const [restoring, setRestoring] = useState(false)\n\n  useEffect(() => {\n    const checkPending = () => {\n      const ids = getPendingFileHandleIds()\n      setPendingCount(ids.length)\n    }\n    checkPending()\n    const interval = setInterval(checkPending, 1000)\n    return () => {\n      clearInterval(interval)\n    }\n  }, [])\n\n  const handleRestore = async () => {\n    setRestoring(true)\n    try {\n      const results = await restorePendingFileHandles()\n      const successCount = results.filter(r => r.success).length\n      const stillPending = getPendingFileHandleIds().length\n      setPendingCount(stillPending)\n\n      if (successCount > 0) {\n        // Reload to re-render tracks with restored files\n        window.location.reload()\n      }\n    } catch (e) {\n      console.error('Error restoring file handles:', e)\n    } finally {\n      setRestoring(false)\n    }\n  }\n\n  if (pendingCount === 0) {\n    return null\n  }\n\n  return (\n    <Alert\n      severity=\"warning\"\n      action={\n        <Button\n          color=\"inherit\"\n          size=\"small\"\n          onClick={handleRestore}\n          disabled={restoring}\n        >\n          {restoring ? 'Restoring...' : 'Restore access'}\n        </Button>\n      }\n    >\n      {pendingCount} local file{pendingCount > 1 ? 's' : ''} need\n      {pendingCount === 1 ? 's' : ''} permission to be restored.\n    </Alert>\n  )\n}\n","import { Suspense, lazy, useState } from 'react'\n\nimport { makeStyles } from '@jbrowse/core/util/tss-react'\nimport ShareIcon from '@mui/icons-material/Share'\nimport { Button, alpha } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\n\nconst useStyles = makeStyles()(theme => ({\n  shareDiv: {\n    textAlign: 'center',\n    paddingLeft: '2px',\n  },\n  shareButton: {\n    backgroundColor: alpha(\n      theme.palette.primary.contrastText,\n      theme.palette.action.hoverOpacity,\n    ),\n    '&:hover': {\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nconst ShareDialog = lazy(() => import('./ShareDialog.tsx'))\n\nconst ShareButton = observer(function ShareButton(props: {\n  session: AbstractSessionModel & { shareURL: string }\n}) {\n  const [open, setOpen] = useState(false)\n  const { session } = props\n  const { classes } = useStyles()\n\n  return (\n    <div className={classes.shareDiv}>\n      <Button\n        size=\"small\"\n        color=\"inherit\"\n        startIcon={<ShareIcon />}\n        classes={{ root: classes.shareButton }}\n        onClick={async () => {\n          setOpen(true)\n        }}\n      >\n        Share\n      </Button>\n      {open ? (\n        <Suspense fallback={null}>\n          <ShareDialog\n            session={session}\n            handleClose={() => {\n              setOpen(false)\n            }}\n          />\n        </Suspense>\n      ) : null}\n    </div>\n  )\n})\n\nexport default ShareButton\n","import { useEffect } from 'react'\n\nimport { App } from '@jbrowse/app-core'\nimport { onSnapshot } from '@jbrowse/mobx-state-tree'\nimport { CssBaseline, ThemeProvider } from '@mui/material'\nimport { observer } from 'mobx-react'\n\nimport FileHandleRestoreBanner from './FileHandleRestoreBanner.tsx'\nimport ShareButton from './ShareButton.tsx'\nimport { readQueryParams, setQueryParams } from '../useQueryParam.ts'\n\nimport type { WebSessionModel } from '../sessionModel/index.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst JBrowse = observer(function JBrowse({\n  pluginManager,\n}: {\n  pluginManager: PluginManager\n}) {\n  const {\n    adminKey,\n    adminServer,\n    config: configPath,\n  } = readQueryParams(['adminKey', 'adminServer', 'config'])\n  const { rootModel } = pluginManager\n  const { error, jbrowse, session: s } = rootModel!\n  const session = s as WebSessionModel\n  const { id, theme } = session\n\n  useEffect(() => {\n    setQueryParams({ session: `local-${id}` })\n    // @ts-expect-error\n    window.JBrowseRootModel = rootModel\n    // @ts-expect-error\n    window.JBrowseSession = session\n  }, [id, rootModel, session])\n\n  useEffect(() => {\n    return adminKey\n      ? onSnapshot(jbrowse, async snapshot => {\n          try {\n            const response = await fetch(adminServer || '/updateConfig', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                adminKey,\n                configPath,\n                config: snapshot,\n              }),\n            })\n            if (!response.ok) {\n              const message = await response.text()\n              throw new Error(`HTTP ${response.status} (${message})`)\n            }\n          } catch (e) {\n            session.notify(`Admin server error: ${e}`)\n          }\n        })\n      : undefined\n  }, [jbrowse, session, adminKey, adminServer, configPath])\n\n  if (error) {\n    // eslint-disable-next-line @typescript-eslint/only-throw-error\n    throw error\n  }\n\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <FileHandleRestoreBanner />\n      {/* key={id} forces React to remount App when session changes (e.g.\n          duplicate session) preventing stale references to old session views */}\n      <App\n        key={id}\n        // @ts-expect-error\n        session={session}\n        HeaderButtons={<ShareButton session={session} />}\n      />\n    </ThemeProvider>\n  )\n})\n\nexport default JBrowse\n","import {\n  isCJSPluginDefinition,\n  isESMPluginDefinition,\n  isUMDPluginDefinition,\n  pluginUrl,\n} from '@jbrowse/core/PluginLoader'\n\nimport type { PluginDefinition } from '@jbrowse/core/PluginLoader'\n\nexport const TRUSTED_PLUGIN_URL_PREFIXES = ['https://jbrowse.org/plugins/']\n\nexport async function fetchPlugins() {\n  const response = await fetch('https://jbrowse.org/plugin-store/plugins.json')\n  if (!response.ok) {\n    throw new Error(\n      `HTTP ${response.status} ${response.statusText} fetching plugins`,\n    )\n  }\n  return response.json() as Promise<{ plugins: PluginDefinition[] }>\n}\n\nfunction isTrustedUrl(url: string) {\n  return TRUSTED_PLUGIN_URL_PREFIXES.some(prefix => url.startsWith(prefix))\n}\n\nfunction isPluginInStore(\n  p: PluginDefinition,\n  storePlugins: { plugins: PluginDefinition[] },\n) {\n  const url = pluginUrl(p)\n  if (isUMDPluginDefinition(p)) {\n    return storePlugins.plugins.some(\n      pp => isUMDPluginDefinition(pp) && pluginUrl(pp) === url,\n    )\n  }\n  if (isESMPluginDefinition(p)) {\n    return storePlugins.plugins.some(\n      pp => isESMPluginDefinition(pp) && pluginUrl(pp) === url,\n    )\n  }\n  if (isCJSPluginDefinition(p)) {\n    return storePlugins.plugins.some(\n      pp => isCJSPluginDefinition(pp) && pluginUrl(pp) === url,\n    )\n  }\n  return false\n}\n\nexport async function checkPlugins(pluginsToCheck: PluginDefinition[]) {\n  if (pluginsToCheck.length === 0) {\n    return true\n  }\n  const storePlugins = await fetchPlugins()\n  return pluginsToCheck.every(\n    p => isTrustedUrl(pluginUrl(p)) || isPluginInStore(p, storePlugins),\n  )\n}\n\nexport function checkPluginsAgainstStore(\n  pluginsToCheck: PluginDefinition[],\n  storePlugins: { plugins: PluginDefinition[] },\n) {\n  if (pluginsToCheck.length === 0) {\n    return true\n  }\n  return pluginsToCheck.every(\n    p => isTrustedUrl(pluginUrl(p)) || isPluginInStore(p, storePlugins),\n  )\n}\n","import PluginLoader from '@jbrowse/core/PluginLoader'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { createElementId } from '@jbrowse/core/util/types/mst'\nimport { addDisposer, types } from '@jbrowse/mobx-state-tree'\nimport { openDB } from 'idb'\nimport { autorun } from 'mobx'\n\nimport { readSessionFromDynamo } from './sessionSharing.ts'\nimport {\n  addRelativeUris,\n  checkPlugins,\n  fromUrlSafeB64,\n  readConf,\n} from './util.ts'\n\nimport type { SessionDB, SessionTriagedInfo } from './types.ts'\nimport type { PluginDefinition, PluginRecord } from '@jbrowse/core/PluginLoader'\nimport type { Instance } from '@jbrowse/mobx-state-tree'\n\nconst SessionLoader = types\n  .model({\n    /**\n     * #property\n     */\n    configPath: types.maybe(types.string),\n    /**\n     * #property\n     */\n    sessionQuery: types.maybe(types.string),\n    /**\n     * #property\n     */\n    password: types.maybe(types.string),\n    /**\n     * #property\n     */\n    adminKey: types.maybe(types.string),\n    /**\n     * #property\n     */\n    loc: types.maybe(types.string),\n    /**\n     * #property\n     */\n    sessionTracks: types.maybe(types.string),\n    /**\n     * #property\n     */\n    assembly: types.maybe(types.string),\n    /**\n     * #property\n     */\n    tracks: types.maybe(types.string),\n    /**\n     * #property\n     */\n    tracklist: types.maybe(types.boolean),\n    /**\n     * #property\n     */\n    highlight: types.maybe(types.string),\n    /**\n     * #property\n     */\n    nav: types.maybe(types.boolean),\n    /**\n     * #property\n     */\n    sessionName: types.maybe(types.string),\n    /**\n     * #property\n     */\n    initialTimestamp: types.number,\n\n    /**\n     * #property\n     */\n    hubURL: types.maybe(types.array(types.string)),\n    /**\n     * #property\n     */\n    configSnapshot: types.frozen<Record<string, unknown> | undefined>(\n      undefined,\n    ),\n    /**\n     * #property\n     */\n    sessionSnapshot: types.frozen<Record<string, unknown> | undefined>(\n      undefined,\n    ),\n  })\n  .volatile(() => ({\n    /**\n     * #volatile\n     */\n    sessionTriaged: undefined as SessionTriagedInfo | undefined,\n    /**\n     * #volatile\n     */\n    sessionSpec: undefined as Record<string, unknown> | undefined,\n    /**\n     * #volatile\n     */\n    hubSpec: undefined as Record<string, unknown> | undefined,\n    /**\n     * #volatile\n     */\n    blankSession: false,\n    /**\n     * #volatile\n     */\n    runtimePlugins: undefined as PluginRecord[] | undefined,\n    /**\n     * #volatile\n     */\n    sessionPlugins: undefined as PluginRecord[] | undefined,\n    /**\n     * #volatile\n     */\n    sessionError: undefined as unknown,\n    /**\n     * #volatile\n     */\n    configError: undefined as unknown,\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get isSharedSession() {\n      return !!self.sessionQuery?.startsWith('share-')\n    },\n    /**\n     * #getter\n     */\n    get isSpecSession() {\n      return !!self.sessionQuery?.startsWith('spec-')\n    },\n    /**\n     * #getter\n     */\n    get isHubSession() {\n      return !!self.hubURL\n    },\n    /**\n     * #getter\n     */\n    get isJb1StyleSession() {\n      return !!(self.loc || self.assembly)\n    },\n\n    /**\n     * #getter\n     */\n    get isEncodedSession() {\n      return !!self.sessionQuery?.startsWith('encoded-')\n    },\n    /**\n     * #getter\n     */\n    get isJsonSession() {\n      return !!self.sessionQuery?.startsWith('json-')\n    },\n    /**\n     * #getter\n     */\n    get isLocalSession() {\n      return !!self.sessionQuery?.startsWith('local-')\n    },\n    /**\n     * #getter\n     */\n    get ready(): boolean {\n      return this.isSessionLoaded && !self.configError && this.pluginsLoaded\n    },\n    /**\n     * #getter\n     */\n    get error() {\n      return self.configError || self.sessionError\n    },\n    /**\n     * #getter\n     */\n    get pluginsLoaded() {\n      if (self.sessionError || self.blankSession || self.sessionSpec) {\n        // don't need session plugins for these cases\n        return Boolean(self.runtimePlugins)\n      }\n      return Boolean(self.runtimePlugins && self.sessionPlugins)\n    },\n    /**\n     * #getter\n     */\n    get isSessionLoaded() {\n      return Boolean(\n        self.sessionError ||\n        self.sessionSnapshot ||\n        self.blankSession ||\n        self.sessionSpec,\n      )\n    },\n    /**\n     * #getter\n     */\n    get isConfigLoaded() {\n      return Boolean(self.configError || self.configSnapshot)\n    },\n    /**\n     * #getter\n     */\n    get sessionTracksParsed() {\n      return self.sessionTracks ? JSON.parse(self.sessionTracks) : []\n    },\n    /**\n     * #getter\n     */\n    get resolvedConfigPath() {\n      // @ts-expect-error\n      const path = window.__jbrowseConfigPath as string | undefined\n      return self.configPath || path || 'config.json'\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setConfigError(error: unknown) {\n      self.configError = error\n    },\n    /**\n     * #action\n     */\n    setSessionError(error: unknown) {\n      self.sessionError = error\n    },\n    /**\n     * #action\n     */\n    setRuntimePlugins(plugins: PluginRecord[]) {\n      self.runtimePlugins = plugins\n    },\n    /**\n     * #action\n     */\n    setSessionPlugins(plugins: PluginRecord[]) {\n      self.sessionPlugins = plugins\n    },\n    /**\n     * #action\n     */\n    setConfigSnapshot(snap: Record<string, unknown>) {\n      self.configSnapshot = snap\n    },\n    /**\n     * #action\n     */\n    setBlankSession(flag: boolean) {\n      self.blankSession = flag\n    },\n    /**\n     * #action\n     */\n    setSessionTriaged(args?: SessionTriagedInfo) {\n      self.sessionTriaged = args\n    },\n    /**\n     * #action\n     */\n    setSessionSnapshot(snap: Record<string, unknown>) {\n      self.sessionSnapshot = snap\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    async fetchPlugins(config: { plugins?: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(config.plugins || [], {\n          fetchESM: url => import(/* webpackIgnore:true */ url),\n        })\n        pluginLoader.installGlobalReExports(window)\n        const runtimePlugins = await pluginLoader.load(window.location.href)\n        self.setRuntimePlugins([...runtimePlugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n    /**\n     * #action\n     */\n    async fetchSessionPlugins(snap: { sessionPlugins?: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(snap.sessionPlugins || [], {\n          fetchESM: url => import(/* webpackIgnore:true */ url),\n        }).installGlobalReExports(window)\n        const plugins = await pluginLoader.load(window.location.href)\n        self.setSessionPlugins([...plugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n\n    /**\n     * #action\n     */\n    async loadSession(\n      snap: { sessionPlugins?: PluginDefinition[]; id: string },\n      userAcceptedConfirmation?: boolean,\n    ) {\n      try {\n        const { sessionPlugins = [] } = snap\n        const sessionPluginsAllowed = await checkPlugins(sessionPlugins)\n        if (sessionPluginsAllowed || userAcceptedConfirmation) {\n          await this.fetchSessionPlugins(snap)\n          self.setSessionSnapshot(snap)\n        } else {\n          self.setSessionTriaged({\n            snap,\n            origin: 'session',\n            reason: sessionPlugins,\n          })\n        }\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n    /**\n     * #action\n     */\n    async fetchConfig() {\n      const configPath = self.resolvedConfigPath\n      const shouldFetchConfig = configPath !== 'none'\n\n      // if ?config=none then we will not load the config, which is useful for\n      // ?hubURL which may not need a config\n      //\n      // however, in the rare case that you want hubs and a config (e.g. your\n      // config has plugins to load) then you can still have this too\n      if (shouldFetchConfig) {\n        const text = await openLocation({\n          uri:\n            configPath +\n            // @ts-expect-error\n            (window.__jbrowseCacheBuster ? `?rand=${Math.random()}` : ''),\n          locationType: 'UriLocation',\n        }).readFile('utf8')\n        const config = JSON.parse(text)\n        const configUri = new URL(configPath, window.location.href)\n        addRelativeUris(config, configUri)\n\n        // cross origin config check\n        if (configUri.hostname !== window.location.hostname) {\n          const configPlugins = config.plugins || []\n          const configPluginsAllowed = await checkPlugins(configPlugins)\n          if (!configPluginsAllowed) {\n            self.setSessionTriaged({\n              snap: config,\n              origin: 'config',\n              reason: configPlugins,\n            })\n            return\n          }\n        }\n        await this.fetchPlugins(config)\n        self.setConfigSnapshot(config)\n      } else {\n        self.setConfigSnapshot({})\n      }\n    },\n    /**\n     * #action\n     * Called when configSnapshot already exists (e.g., from HMR or plugin reload)\n     */\n    async setUpConfig() {\n      const configPath = self.resolvedConfigPath\n      const configUri = new URL(configPath, window.location.href)\n      // configSnapshot is guaranteed to exist when this method is called\n      const config = structuredClone(self.configSnapshot) as Record<\n        string,\n        unknown\n      >\n      addRelativeUris(config, configUri)\n      self.setConfigSnapshot(config)\n      await this.fetchPlugins(config)\n    },\n    /**\n     * #action\n     */\n    async fetchSessionFromSessionStorage(query: string) {\n      const sessionStr = sessionStorage.getItem('current')\n      if (sessionStr) {\n        const sessionSnap = JSON.parse(sessionStr).session || {}\n        if (query === sessionSnap.id) {\n          // Assign new ID to avoid conflicts when same session is opened in\n          // multiple tabs (each tab gets its own copy with unique ID)\n          await this.loadDecodedSession(sessionSnap)\n          return true\n        }\n      }\n      return false\n    },\n    /**\n     * #action\n     */\n    async fetchSessionFromIndexedDB(query: string) {\n      try {\n        const sessionDB = await openDB<SessionDB>('sessionsDB', 2, {\n          upgrade(db) {\n            db.createObjectStore('metadata')\n            db.createObjectStore('sessions')\n          },\n        })\n        const sessionSnap = await sessionDB.get('sessions', query)\n        if (sessionSnap) {\n          // Assign new ID to avoid conflicts when same session is opened in\n          // multiple tabs (each tab gets its own copy with unique ID)\n          await this.loadDecodedSession(sessionSnap)\n          return true\n        }\n      } catch (e) {\n        console.error(e)\n      }\n      return false\n    },\n    /**\n     * #action\n     * Tries to load a local session from multiple sources in order:\n     * 1. sessionStorage (current session)\n     * 2. IndexedDB (autosaved sessions)\n     */\n    async fetchLocalSession() {\n      const query = self.sessionQuery!.replace('local-', '')\n\n      if (await this.fetchSessionFromSessionStorage(query)) {\n        return\n      }\n      if (await this.fetchSessionFromIndexedDB(query)) {\n        return\n      }\n      throw new Error('Local session not found')\n    },\n    /**\n     * #action\n     * When sessionSnapshot is provided during .create() (e.g., from HMR or\n     * plugin reload), plugins haven't been loaded yet. This loads them.\n     */\n    async loadSessionPluginsIfNeeded(sessionSnapshot: Record<string, unknown>) {\n      if (!self.sessionPlugins) {\n        // @ts-expect-error\n        await this.loadSession(sessionSnapshot)\n      }\n    },\n    /**\n     * #action\n     * Helper to load a decoded session with a fresh ID\n     */\n    async loadDecodedSession(session: Record<string, unknown>) {\n      await this.loadSession({\n        ...session,\n        id: createElementId(),\n      })\n    },\n    /**\n     * #action\n     */\n    async fetchSharedSession() {\n      const defaultURL = 'https://share.jbrowse.org/api/v1/'\n      const decryptedSession = await readSessionFromDynamo(\n        // @ts-expect-error\n        `${readConf(self.configSnapshot, 'shareURL', defaultURL)}load`,\n        self.sessionQuery || '',\n        self.password || '',\n      )\n\n      const session = JSON.parse(await fromUrlSafeB64(decryptedSession))\n      await this.loadDecodedSession(session)\n    },\n    /**\n     * #action\n     */\n    async decodeEncodedUrlSession() {\n      // sessionQuery is guaranteed to exist when isEncodedSession is true\n      const session = JSON.parse(\n        await fromUrlSafeB64(self.sessionQuery!.replace('encoded-', '')),\n      )\n      await this.loadDecodedSession(session)\n    },\n    /**\n     * #action\n     */\n    decodeSessionSpec() {\n      // sessionQuery is guaranteed to exist when isSpecSession is true\n      self.sessionSpec = JSON.parse(self.sessionQuery!.replace('spec-', ''))\n    },\n    /**\n     * #action\n     * Called when isJb1StyleSession is true (loc or assembly exists)\n     */\n    decodeJb1StyleSession() {\n      const {\n        loc,\n        tracks,\n        assembly,\n        tracklist,\n        nav,\n        highlight,\n        sessionTracksParsed: sessionTracks,\n      } = self\n      self.sessionSpec = {\n        sessionTracks,\n        views: [\n          {\n            type: 'LinearGenomeView',\n            tracks: tracks?.split(','),\n            sessionTracks,\n            loc,\n            assembly,\n            tracklist,\n            nav,\n            highlight: highlight?.split(' '),\n          },\n        ],\n      }\n    },\n\n    /**\n     * #action\n     */\n    decodeHubSpec() {\n      const { hubURL, sessionTracksParsed: sessionTracks } = self\n\n      self.hubSpec = {\n        sessionTracks,\n        hubURL,\n      }\n    },\n    /**\n     * #action\n     */\n    async decodeJsonUrlSession() {\n      // sessionQuery is guaranteed to exist when isJsonSession is true\n      const { session } = JSON.parse(self.sessionQuery!.replace(/^json-/, ''))\n      await this.loadDecodedSession(session)\n    },\n    /**\n     * #aftercreate\n     */\n    afterCreate() {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      ;(async () => {\n        try {\n          await (self.configSnapshot ? this.setUpConfig() : this.fetchConfig())\n\n          addDisposer(\n            self,\n            autorun(async () => {\n              try {\n                const {\n                  isLocalSession,\n                  isEncodedSession,\n                  isSpecSession,\n                  isSharedSession,\n                  isJsonSession,\n                  isJb1StyleSession,\n                  isHubSession,\n                  sessionSnapshot,\n                  configSnapshot,\n                } = self\n                if (!configSnapshot) {\n                  return\n                }\n\n                if (sessionSnapshot) {\n                  await this.loadSessionPluginsIfNeeded(sessionSnapshot)\n                } else if (isSharedSession) {\n                  await this.fetchSharedSession()\n                } else if (isSpecSession) {\n                  this.decodeSessionSpec()\n                } else if (isJb1StyleSession) {\n                  this.decodeJb1StyleSession()\n                } else if (isEncodedSession) {\n                  await this.decodeEncodedUrlSession()\n                } else if (isJsonSession) {\n                  await this.decodeJsonUrlSession()\n                } else if (isLocalSession) {\n                  await this.fetchLocalSession()\n                } else if (isHubSession) {\n                  // this is later in the list: prioritize local session over\n                  // \"hub spec\" since hub is left in URL even when there may be\n                  // a local session\n                  this.decodeHubSpec()\n                  self.setBlankSession(true)\n                } else if (self.sessionQuery) {\n                  // if there was a sessionQuery and we don't recognize it\n                  throw new Error(\n                    `Unrecognized URL session format: \"${self.sessionQuery}\"`,\n                  )\n                } else {\n                  // placeholder for session loaded, but none found\n                  self.setBlankSession(true)\n                }\n              } catch (e) {\n                console.error(e)\n                self.setSessionError(e)\n              }\n            }),\n          )\n        } catch (e) {\n          console.error(e)\n          self.setConfigError(e)\n        }\n      })()\n    },\n  }))\n\nexport type SessionLoaderModel = Instance<typeof SessionLoader>\n\nexport default SessionLoader\n","import type { LayoutNode, ViewSpec } from './types.ts'\nimport type { DockviewLayoutNode } from '@jbrowse/app-core'\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n// Convert LayoutNode (with view indices) to DockviewLayoutNode (with view IDs)\nfunction convertLayoutNode(\n  node: LayoutNode,\n  views: { id: string }[],\n): DockviewLayoutNode {\n  if (node.views !== undefined) {\n    // Panel node - convert view indices to view IDs\n    const viewIds = node.views\n      .map(idx => views[idx]?.id)\n      .filter((id): id is string => id !== undefined)\n    return { viewIds, size: node.size }\n  }\n  if (node.children) {\n    // Container node - recursively convert children\n    return {\n      direction: node.direction,\n      children: node.children.map(child => convertLayoutNode(child, views)),\n      size: node.size,\n    }\n  }\n  return {}\n}\n\n// use extension point named e.g. LaunchView-LinearGenomeView to initialize an\n// LGV session\nexport async function loadSessionSpec(\n  {\n    views,\n    sessionTracks = [],\n    layout,\n    sessionName,\n  }: {\n    views: ViewSpec[]\n    sessionTracks?: Record<string, unknown>[]\n    layout?: LayoutNode\n    sessionName?: string\n  },\n  pluginManager: PluginManager,\n) {\n  const rootModel = pluginManager.rootModel!\n\n  try {\n    // @ts-expect-error\n    rootModel.setSession({\n      name: sessionName ?? `New session ${new Date().toLocaleString()}`,\n    })\n\n    for (const track of sessionTracks) {\n      // @ts-expect-error\n      rootModel.session.addTrackConf(track)\n    }\n\n    await Promise.all(\n      views.map(view =>\n        pluginManager.evaluateAsyncExtensionPoint(`LaunchView-${view.type}`, {\n          ...view,\n          session: rootModel.session,\n        }),\n      ),\n    )\n\n    // Apply layout if specified\n    if (layout) {\n      // Cast through unknown since AbstractSessionModel doesn't include workspace types\n      const session = rootModel.session as unknown as {\n        views: { id: string }[]\n        useWorkspaces: boolean\n        setUseWorkspaces: (value: boolean) => void\n        setInit: (init: DockviewLayoutNode | undefined) => void\n      }\n\n      // Enable workspaces mode\n      session.setUseWorkspaces(true)\n\n      // Convert layout from view indices to view IDs and set init\n      session.setInit(convertLayoutNode(layout, session.views))\n    }\n  } catch (e) {\n    console.error(e)\n    rootModel.session?.notifyError(`${e}`, e)\n  }\n}\n","// adapted from https://github.com/mobxjs/mobx-state-tree/blob/master/packages/mst-middlewares/src/time-traveller.ts\nimport {\n  applySnapshot,\n  getEnv,\n  getSnapshot,\n  onSnapshot,\n  resolvePath,\n  types,\n} from '@jbrowse/mobx-state-tree'\n\nimport type { IAnyStateTreeNode, IDisposer } from '@jbrowse/mobx-state-tree'\n\nconst MAX_HISTORY_LENGTH = 20\n\nconst TimeTraveller = types\n  .model('TimeTraveller', {\n    undoIdx: -1,\n    targetPath: '',\n  })\n  .volatile(() => ({\n    history: [] as unknown[],\n    notTrackingUndo: false,\n  }))\n  .views(self => ({\n    get canUndo() {\n      return self.undoIdx > 0 && !self.notTrackingUndo\n    },\n    get canRedo() {\n      return self.undoIdx < self.history.length - 1 && !self.notTrackingUndo\n    },\n  }))\n  .actions(self => {\n    let targetStore: IAnyStateTreeNode | undefined\n    let snapshotDisposer: IDisposer\n    let skipNextUndoState = false\n    let debounceTimer: ReturnType<typeof setTimeout> | undefined\n    let pendingSnapshot: unknown\n\n    return {\n      stopTrackingUndo() {\n        self.notTrackingUndo = true\n      },\n      resumeTrackingUndo() {\n        self.notTrackingUndo = false\n      },\n      addUndoState(snapshot: unknown) {\n        if (self.notTrackingUndo) {\n          return\n        }\n        if (skipNextUndoState) {\n          skipNextUndoState = false\n          return\n        }\n        self.history.splice(self.undoIdx + 1)\n        self.history.push(snapshot)\n        if (self.history.length > MAX_HISTORY_LENGTH) {\n          self.history.shift()\n        }\n        self.undoIdx = self.history.length - 1\n      },\n\n      beforeDestroy() {\n        snapshotDisposer()\n        if (debounceTimer) {\n          clearTimeout(debounceTimer)\n        }\n      },\n      initialize() {\n        targetStore = self.targetPath\n          ? resolvePath(self, self.targetPath)\n          : getEnv(self).targetStore\n\n        if (!targetStore) {\n          throw new Error(\n            'Failed to find target store for TimeTraveller. Please provide `targetPath` property, or a `targetStore` in the environment',\n          )\n        }\n\n        snapshotDisposer = onSnapshot(targetStore, snapshot => {\n          // Early exit if not tracking - avoid timer operations entirely\n          if (self.notTrackingUndo || skipNextUndoState) {\n            return\n          }\n\n          // Store latest snapshot for when timer fires\n          pendingSnapshot = snapshot\n\n          // Debounce: reset timer on each change to wait for inactivity\n          if (debounceTimer) {\n            clearTimeout(debounceTimer)\n          }\n          debounceTimer = setTimeout(() => {\n            debounceTimer = undefined\n            this.addUndoState(pendingSnapshot)\n          }, 300)\n        })\n\n        if (self.history.length === 0) {\n          this.addUndoState(getSnapshot(targetStore))\n        }\n      },\n      undo() {\n        self.undoIdx--\n        skipNextUndoState = true\n        if (targetStore) {\n          applySnapshot(targetStore, self.history[self.undoIdx])\n        }\n      },\n      redo() {\n        self.undoIdx++\n        skipNextUndoState = true\n        if (targetStore) {\n          applySnapshot(targetStore, self.history[self.undoIdx])\n        }\n      },\n    }\n  })\n\nexport default TimeTraveller\n","import type { MenuItem } from '@jbrowse/core/ui'\n\ninterface InsertInSubMenuAction {\n  type: 'insertInSubMenu'\n  menuPath: string[]\n  menuItem: MenuItem\n  position: number\n}\ninterface InsertInMenuAction {\n  type: 'insertInMenu'\n  menuName: string\n  menuItem: MenuItem\n  position: number\n}\ninterface AppendToMenuAction {\n  type: 'appendToMenu'\n  menuName: string\n  menuItem: MenuItem\n}\ninterface AppendToSubMenuAction {\n  type: 'appendToSubMenu'\n  menuPath: string[]\n  menuItem: MenuItem\n}\ninterface AppendMenuAction {\n  type: 'appendMenu'\n  menuName: string\n}\ninterface InsertMenuAction {\n  type: 'insertMenu'\n  menuName: string\n  position: number\n}\ninterface SetMenusAction {\n  type: 'setMenus'\n  newMenus: Menu[]\n}\n\nexport type MenuAction =\n  | InsertMenuAction\n  | AppendMenuAction\n  | AppendToSubMenuAction\n  | AppendToMenuAction\n  | InsertInMenuAction\n  | InsertInSubMenuAction\n  | SetMenusAction\n\nexport interface Menu {\n  label: string\n  menuItems: MenuItem[]\n}\n\n/**\n * #action\n * Add a top-level menu\n *\n * @param menuName - Name of the menu to insert.\n *\n * @returns The new length of the top-level menus array\n */\nexport function appendMenu({\n  menus,\n  menuName,\n}: {\n  menus: Menu[]\n  menuName: string\n}) {\n  return menus.push({ label: menuName, menuItems: [] })\n}\n/**\n * #action\n * Insert a top-level menu\n *\n * @param menuName - Name of the menu to insert.\n *\n * @param position - Position to insert menu. If negative, counts from th\n * end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the\n * second-to-last one.\n *\n * @returns The new length of the top-level menus array\n */\nexport function insertMenu({\n  menus,\n  menuName,\n  position,\n}: {\n  menus: Menu[]\n  menuName: string\n  position: number\n}) {\n  menus.splice((position < 0 ? menus.length : 0) + position, 0, {\n    label: menuName,\n    menuItems: [],\n  })\n  return menus.length\n}\n/**\n * #action\n * Add a menu item to a top-level menu\n *\n * @param menuName - Name of the top-level menu to append to.\n *\n * @param menuItem - Menu item to append.\n *\n * @returns The new length of the menu\n */\nexport function appendToMenu({\n  menus,\n  menuName,\n  menuItem,\n}: {\n  menus: Menu[]\n  menuName: string\n  menuItem: MenuItem\n}) {\n  const menu = menus.find(m => m.label === menuName)\n  if (!menu) {\n    menus.push({ label: menuName, menuItems: [menuItem] })\n    return 1\n  }\n  return menu.menuItems.push(menuItem)\n}\n/**\n * #action\n * Insert a menu item into a top-level menu\n *\n * @param menuName - Name of the top-level menu to insert into\n *\n * @param menuItem - Menu item to insert\n *\n * @param position - Position to insert menu item. If negative, counts\n * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n * the second-to-last one.\n *\n * @returns The new length of the menu\n */\nexport function insertInMenu({\n  menus,\n  menuName,\n  menuItem,\n  position,\n}: {\n  menus: Menu[]\n  menuName: string\n  menuItem: MenuItem\n  position: number\n}) {\n  const menu = menus.find(m => m.label === menuName)\n  if (!menu) {\n    menus.push({ label: menuName, menuItems: [menuItem] })\n    return 1\n  }\n  const insertPosition =\n    position < 0 ? menu.menuItems.length + position : position\n  menu.menuItems.splice(insertPosition, 0, menuItem)\n  return menu.menuItems.length\n}\n/**\n * #action\n * Add a menu item to a sub-menu\n *\n * @param menuPath - Path to the sub-menu to add to, starting with the\n * top-level menu (e.g. `['File', 'Insert']`).\n *\n * @param menuItem - Menu item to append.\n *\n * @returns The new length of the sub-menu\n */\nexport function appendToSubMenu({\n  menus,\n  menuPath,\n  menuItem,\n}: {\n  menus: Menu[]\n  menuPath: string[]\n  menuItem: MenuItem\n}) {\n  let topMenu = menus.find(m => m.label === menuPath[0])\n  if (!topMenu) {\n    const idx = appendMenu({ menus, menuName: menuPath[0]! })\n    topMenu = menus[idx - 1]!\n  }\n  let { menuItems: subMenu } = topMenu\n  const pathSoFar = [menuPath[0]]\n  for (const menuName of menuPath.slice(1)) {\n    pathSoFar.push(menuName)\n    let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n    if (!sm) {\n      const idx = subMenu.push({ label: menuName, subMenu: [] })\n      sm = subMenu[idx - 1]!\n    }\n    if (!('subMenu' in sm)) {\n      throw new Error(`\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`)\n    }\n    subMenu = sm.subMenu\n  }\n  return subMenu.push(menuItem)\n}\n/**\n * #action\n * Insert a menu item into a sub-menu\n *\n * @param menuPath - Path to the sub-menu to add to, starting with the\n * top-level menu (e.g. `['File', 'Insert']`).\n *\n * @param menuItem - Menu item to insert.\n *\n * @param position - Position to insert menu item. If negative, counts\n * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n * the second-to-last one.\n *\n * @returns The new length of the sub-menu\n */\nexport function insertInSubMenu({\n  menus,\n  menuPath,\n  menuItem,\n  position,\n}: {\n  menus: Menu[]\n  menuPath: string[]\n  menuItem: MenuItem\n  position: number\n}) {\n  let topMenu = menus.find(m => m.label === menuPath[0])\n  if (!topMenu) {\n    const idx = appendMenu({ menus, menuName: menuPath[0]! })\n    topMenu = menus[idx - 1]!\n  }\n  let { menuItems: subMenu } = topMenu\n  const pathSoFar = [menuPath[0]]\n  for (const menuName of menuPath.slice(1)) {\n    pathSoFar.push(menuName)\n    let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n    if (!sm) {\n      const idx = subMenu.push({ label: menuName, subMenu: [] })\n      sm = subMenu[idx - 1]!\n    }\n    if (!('subMenu' in sm)) {\n      throw new Error(`\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`)\n    }\n    subMenu = sm.subMenu\n  }\n  subMenu.splice(position, 0, menuItem)\n  return subMenu.length\n}\n\nexport function processMutableMenuActions(ret: Menu[], actions: MenuAction[]) {\n  for (const action of actions) {\n    if (action.type === 'setMenus') {\n      ret = action.newMenus\n    } else if (action.type === 'appendMenu') {\n      appendMenu({ menus: ret, ...action })\n    } else if (action.type === 'insertMenu') {\n      insertMenu({ menus: ret, ...action })\n    } else if (action.type === 'insertInSubMenu') {\n      insertInSubMenu({ menus: ret, ...action })\n    } else if (action.type === 'appendToSubMenu') {\n      appendToSubMenu({ menus: ret, ...action })\n    } else if (action.type === 'appendToMenu') {\n      appendToMenu({ menus: ret, ...action })\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    } else if (action.type === 'insertInMenu') {\n      insertInMenu({ menus: ret, ...action })\n    }\n  }\n  return ret\n}\n","import { isAlive, isStateTreeNode } from '@jbrowse/mobx-state-tree'\n\nimport { readConfObject } from '../configuration/index.ts'\nimport { clamp } from '../util/index.ts'\n\nimport type PluginManager from '../PluginManager.ts'\nimport type { AnyConfigurationModel } from '../configuration/index.ts'\n\nexport interface WorkerHandle {\n  status?: string\n  error?: unknown\n  on?: (channel: string, callback: (message: unknown) => void) => void\n  off?: (channel: string, callback: (message: unknown) => void) => void\n  destroy(): void\n  call(\n    functionName: string,\n    args?: unknown,\n    options?: {\n      statusCallback?(message: string): void\n      rpcDriverClassName: string\n    },\n  ): Promise<unknown>\n}\n\nexport interface RpcDriverConstructorArgs {\n  config: AnyConfigurationModel\n}\n\nfunction isCloneable(thing: unknown) {\n  return !(typeof thing === 'function') && !(thing instanceof Error)\n}\n\nfunction detectHardwareConcurrency() {\n  const mainThread = typeof window !== 'undefined'\n  const canDetect = mainThread && 'hardwareConcurrency' in window.navigator\n  return mainThread && canDetect ? window.navigator.hardwareConcurrency : 1\n}\nclass LazyWorker {\n  workerP?: Promise<WorkerHandle> | undefined\n\n  constructor(public driver: BaseRpcDriver) {}\n\n  async getWorker() {\n    if (!this.workerP) {\n      this.workerP = this.driver.makeWorker().catch((e: unknown) => {\n        this.workerP = undefined\n        throw e\n      })\n    }\n    return this.workerP\n  }\n}\n\nexport default abstract class BaseRpcDriver {\n  abstract name: string\n\n  private lastWorkerAssignment = -1\n\n  // sessionId -> worker number\n  private workerAssignments = new Map<string, number>()\n\n  abstract makeWorker(): Promise<WorkerHandle>\n\n  private workerPool?: LazyWorker[]\n\n  config: AnyConfigurationModel\n\n  constructor(args: RpcDriverConstructorArgs) {\n    this.config = args.config\n  }\n\n  // filter the given object and just remove any non-cloneable things from it\n  filterArgs<THING_TYPE>(thing: THING_TYPE, sessionId: string): THING_TYPE {\n    // Fast path for primitives (most common case)\n    if (thing === null || thing === undefined) {\n      return thing\n    }\n    const type = typeof thing\n    if (type === 'string' || type === 'number' || type === 'boolean') {\n      return thing\n    }\n    if (type !== 'object') {\n      // functions and other non-cloneables\n      return undefined as unknown as THING_TYPE\n    }\n\n    // Object cases\n    if (Array.isArray(thing)) {\n      return thing\n        .filter(thing => isCloneable(thing))\n        .map(t => this.filterArgs(t, sessionId)) as unknown as THING_TYPE\n    } else if (isStateTreeNode(thing) && !isAlive(thing)) {\n      throw new Error('dead state tree node passed to RPC call')\n    } else if (thing instanceof File) {\n      return thing\n    } else {\n      return Object.fromEntries(\n        Object.entries(thing)\n          .filter(e => isCloneable(e[1]))\n          .map(([k, v]) => [k, this.filterArgs(v, sessionId)]),\n      ) as THING_TYPE\n    }\n  }\n\n  async remoteAbort(\n    sessionId: string,\n    functionName: string,\n    stopTokenId: number,\n  ) {\n    const worker = await this.getWorker(sessionId)\n    await worker.call(\n      functionName,\n      { stopTokenId },\n      { rpcDriverClassName: this.name },\n    )\n  }\n\n  createWorkerPool(): LazyWorker[] {\n    const hardwareConcurrency = detectHardwareConcurrency()\n\n    const workerCount =\n      readConfObject(this.config, 'workerCount') ||\n      clamp(1, Math.max(1, hardwareConcurrency - 1), 5)\n\n    const workers = []\n    for (let i = 0; i < workerCount; i++) {\n      workers.push(new LazyWorker(this))\n    }\n    return workers\n  }\n\n  getWorkerPool() {\n    if (!this.workerPool) {\n      const res = this.createWorkerPool()\n      this.workerPool = res\n      return res // making this several steps makes TS happy\n    }\n    return this.workerPool\n  }\n\n  async getWorker(sessionId: string): Promise<WorkerHandle> {\n    const workers = this.getWorkerPool()\n    let workerNumber = this.workerAssignments.get(sessionId)\n    if (workerNumber === undefined) {\n      const workerAssignment = (this.lastWorkerAssignment + 1) % workers.length\n      this.workerAssignments.set(sessionId, workerAssignment)\n      this.lastWorkerAssignment = workerAssignment\n      workerNumber = workerAssignment\n    }\n\n    return workers[workerNumber]!.getWorker()\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: {\n      statusCallback?: (message: unknown) => void\n    },\n    options = {},\n  ) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n\n    // // eslint-disable-next-line no-console\n    // console.log(`[RPC] ${this.name}: ${functionName} (worker)`)\n\n    const unextendedWorker = await this.getWorker(sessionId)\n    const worker = pluginManager.evaluateExtensionPoint(\n      'Core-extendWorker',\n      unextendedWorker,\n    ) as WorkerHandle\n    const rpcMethod = pluginManager.getRpcMethodType(functionName)\n    if (!rpcMethod) {\n      throw new Error(`unknown RPC method ${functionName}`)\n    }\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const filteredAndSerializedArgs = this.filterArgs(serializedArgs, sessionId)\n\n    // now actually call the worker\n    const call = await worker.call(functionName, filteredAndSerializedArgs, {\n      statusCallback: args.statusCallback,\n      rpcDriverClassName: this.name,\n      ...options,\n    })\n\n    return rpcMethod.deserializeReturn(call, args, this.name)\n  }\n}\n","import BaseRpcDriver from './BaseRpcDriver.ts'\n\nimport type { RpcDriverConstructorArgs } from './BaseRpcDriver.ts'\nimport type PluginManager from '../PluginManager.ts'\n\nclass DummyHandle {\n  destroy(): void {}\n\n  async call(\n    _functionName: string,\n    _filteredArgs?: Record<string, unknown>,\n    _options = {},\n  ): Promise<unknown> {\n    return undefined\n  }\n}\n\n/**\n * RPC driver that runs RPC functions in-band in the main thread.\n * Supports direct execution for methods that implement executeDirect(),\n * bypassing serialization overhead entirely.\n */\nexport default class MainThreadRpcDriver extends BaseRpcDriver {\n  name = 'MainThreadRpcDriver'\n\n  makeWorker: () => Promise<DummyHandle>\n\n  constructor(args: RpcDriverConstructorArgs) {\n    super(args)\n    this.makeWorker = async (): Promise<DummyHandle> => new DummyHandle()\n  }\n\n  async call(\n    pm: PluginManager,\n    sessionId: string,\n    funcName: string,\n    args: Record<string, unknown>,\n  ) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    const rpcMethod = pm.getRpcMethodType(funcName)\n    if (!rpcMethod) {\n      throw new Error(`unknown RPC method ${funcName}`)\n    }\n\n    // Use direct execution if the method supports it (avoids serialization)\n    if (rpcMethod.supportsDirectExecution()) {\n      const result = await rpcMethod.executeDirect(args)\n      if (result !== undefined) {\n        // // eslint-disable-next-line no-console\n        // console.log(\n        //   `[RPC] MainThreadRpcDriver: ${funcName} (direct, no serialization)`,\n        // )\n        return result\n      }\n      // Fall through to serialized path if executeDirect returns undefined\n    }\n\n    // // eslint-disable-next-line no-console\n    // console.log(`[RPC] MainThreadRpcDriver: ${funcName} (serialized)`)\n\n    // Fallback to serialized execution\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const result = await rpcMethod.execute(serializedArgs, this.name)\n    return rpcMethod.deserializeReturn(result, args, this.name)\n  }\n}\n","import BaseRpcDriver from './BaseRpcDriver.ts'\nimport { RpcClient, deserializeError } from '../util/librpc.ts'\nimport { nanoid } from '../util/nanoid.ts'\n\nimport type { RpcDriverConstructorArgs } from './BaseRpcDriver.ts'\nimport type { PluginDefinition } from '../PluginLoader.ts'\n\ninterface WebWorkerRpcDriverConstructorArgs extends RpcDriverConstructorArgs {\n  makeWorkerInstance: () => Worker\n}\n\ninterface Options {\n  statusCallback?: (arg0: unknown) => void\n  rpcDriverClassName: string\n}\n\nclass WebWorkerHandle {\n  private client: RpcClient\n\n  constructor(public worker: Worker) {\n    this.client = new RpcClient(worker)\n    // Listen for worker errors that might not be caught by RpcClient\n    this.client.on('error', error => {\n      console.error('[WebWorker RPC Error]', error)\n    })\n  }\n\n  destroy() {\n    this.worker.terminate()\n  }\n\n  async call(funcName: string, args: Record<string, unknown>, opts: Options) {\n    const { statusCallback, rpcDriverClassName } = opts\n    const channel = `message-${nanoid()}`\n    const listener = (message: unknown) => {\n      statusCallback?.(message)\n    }\n    this.client.on(channel, listener)\n    try {\n      const result = await this.client.call(funcName, {\n        ...args,\n        channel,\n        rpcDriverClassName,\n      })\n      return result\n    } finally {\n      this.client.off(channel, listener)\n    }\n  }\n}\n\nexport default class WebWorkerRpcDriver extends BaseRpcDriver {\n  name = 'WebWorkerRpcDriver'\n\n  makeWorkerInstance: () => Worker\n\n  constructor(\n    args: WebWorkerRpcDriverConstructorArgs,\n    public workerBootConfiguration: {\n      plugins: PluginDefinition[]\n      windowHref: string\n    },\n  ) {\n    super(args)\n    this.makeWorkerInstance = args.makeWorkerInstance\n  }\n\n  async makeWorker() {\n    // note that we are making a Rpc.Client connection with a worker pool of\n    // one for each worker, because we want to do our own state-group-aware\n    // load balancing rather than using librpc's builtin round-robin\n    const instance = this.makeWorkerInstance()\n    const handle = new WebWorkerHandle(instance)\n    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\n    if (isSafari) {\n      // xref https://github.com/GMOD/jbrowse-components/issues/3245\n      // eslint-disable-next-line no-console\n      console.log(\n        'console logging the webworker handle avoids the track going into an infinite loading state, this is a hacky workaround for safari',\n        instance,\n      )\n    }\n\n    // send the worker its boot configuration using info from the pluginManager\n    return new Promise((resolve: (w: WebWorkerHandle) => void, reject) => {\n      const listener = (e: MessageEvent) => {\n        switch (e.data.message) {\n          case 'ready': {\n            resolve(handle)\n            instance.removeEventListener('message', listener)\n            break\n          }\n          case 'readyForConfig': {\n            instance.postMessage({\n              message: 'config',\n              config: this.workerBootConfiguration,\n            })\n            break\n          }\n          case 'error': {\n            reject(deserializeError(e.data.error))\n            break\n          }\n          // No default\n        }\n      }\n      instance.addEventListener('message', listener)\n    })\n  }\n}\n","import { ConfigurationSchema } from '../configuration/index.ts'\n\n/**\n * #config BaseRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseRpcDriverConfigSchema = ConfigurationSchema(\n  'BaseRpcDriver',\n  {\n    /**\n     * #slot\n     */\n    workerCount: {\n      type: 'number',\n      description:\n        'The number of workers to use. If 0 (the default) JBrowse will decide how many workers to use.',\n      defaultValue: 0,\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BaseRpcDriverConfigSchema\n","import BaseRpcDriverConfigSchema from './baseRpcConfig.ts'\nimport { ConfigurationSchema } from '../configuration/index.ts'\n\n/**\n * #config MainThreadRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MainThreadRpcDriverConfigSchema = ConfigurationSchema(\n  'MainThreadRpcDriver',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseRpcDriverConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default MainThreadRpcDriverConfigSchema\n","import BaseRpcDriverConfigSchema from './baseRpcConfig.ts'\nimport { ConfigurationSchema } from '../configuration/index.ts'\n\n/**\n * #config WebWorkerRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst WebWorkerRpcDriverConfigSchema = ConfigurationSchema(\n  'WebWorkerRpcDriver',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseRpcDriverConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default WebWorkerRpcDriverConfigSchema\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport MainThreadRpcDriverConfigSchema from './mainThreadRpcConfig.ts'\nimport WebWorkerRpcDriverConfigSchema from './webWorkerRpcConfig.ts'\nimport { ConfigurationSchema } from '../configuration/index.ts'\n\n/**\n * #config RpcOptions\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'RpcOptions',\n  {\n    /**\n     * #slot\n     */\n    defaultDriver: {\n      type: 'string',\n      description:\n        'the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend',\n      defaultValue: 'MainThreadRpcDriver',\n    },\n    /**\n     * #slot\n     */\n    drivers: types.optional(\n      types.map(\n        types.union(\n          MainThreadRpcDriverConfigSchema,\n          WebWorkerRpcDriverConfigSchema,\n        ),\n      ),\n      {\n        MainThreadRpcDriver: { type: 'MainThreadRpcDriver' },\n        WebWorkerRpcDriver: { type: 'WebWorkerRpcDriver' },\n      },\n    ),\n  },\n  {\n    actions: (self: any) => ({\n      addDriverConfig(configName: string, configSnapshot: { type: string }) {\n        self.drivers.set(configName, configSnapshot)\n      },\n    }),\n  },\n)\n","import MainThreadRpcDriver from './MainThreadRpcDriver.ts'\nimport WebWorkerRpcDriver from './WebWorkerRpcDriver.ts'\nimport rpcConfigSchema from './configSchema.ts'\nimport { readConfObject } from '../configuration/index.ts'\n\nimport type BaseRpcDriver from './BaseRpcDriver.ts'\nimport type PluginManager from '../PluginManager.ts'\nimport type { AnyConfigurationModel } from '../configuration/index.ts'\n\ntype DriverClass = BaseRpcDriver\n\ninterface BackendConfigurations {\n  WebWorkerRpcDriver?: Omit<\n    ConstructorParameters<typeof WebWorkerRpcDriver>[0],\n    'config'\n  >\n  MainThreadRpcDriver?: Omit<\n    ConstructorParameters<typeof MainThreadRpcDriver>[0],\n    'config'\n  >\n  [key: string]: unknown\n}\n\nexport type RpcDriverFactory = (\n  config: AnyConfigurationModel,\n  backendConfig: unknown,\n  pluginManager: PluginManager,\n) => BaseRpcDriver\n\nexport default class RpcManager {\n  static configSchema = rpcConfigSchema\n\n  driverObjects: Map<string, DriverClass>\n  driverFactories: Map<string, RpcDriverFactory>\n\n  constructor(\n    public pluginManager: PluginManager,\n    public mainConfiguration: AnyConfigurationModel,\n    public backendConfigurations: BackendConfigurations,\n  ) {\n    this.driverObjects = new Map()\n    this.driverFactories = new Map()\n\n    // Register built-in drivers\n    this.registerDriverFactory(\n      'MainThreadRpcDriver',\n      (config, backendConfig) =>\n        new MainThreadRpcDriver({\n          ...(backendConfig as ConstructorParameters<\n            typeof MainThreadRpcDriver\n          >[0]),\n          config,\n        }),\n    )\n    this.registerDriverFactory(\n      'WebWorkerRpcDriver',\n      (config, backendConfig, pm) =>\n        new WebWorkerRpcDriver(\n          {\n            ...(backendConfig as ConstructorParameters<\n              typeof WebWorkerRpcDriver\n            >[0]),\n            config,\n          },\n          {\n            plugins: pm.runtimePluginDefinitions,\n            windowHref:\n              typeof window !== 'undefined' ? window.location.href : '',\n          },\n        ),\n    )\n  }\n\n  registerDriverFactory(name: string, factory: RpcDriverFactory) {\n    this.driverFactories.set(name, factory)\n  }\n\n  getDriver(backendName: string) {\n    const existingDriver = this.driverObjects.get(backendName)\n    if (existingDriver) {\n      return existingDriver\n    }\n\n    const factory = this.driverFactories.get(backendName)\n    if (!factory) {\n      throw new Error(`RPC driver \"${backendName}\" is not registered`)\n    }\n\n    const backendConfig = this.backendConfigurations[backendName]\n    if (!backendConfig) {\n      throw new Error(`RPC driver \"${backendName}\" is missing configuration`)\n    }\n\n    const config = this.mainConfiguration.drivers.get('WebWorkerRpcDriver')\n    const newDriver = factory(config, backendConfig, this.pluginManager)\n    this.driverObjects.set(backendName, newDriver)\n    return newDriver\n  }\n\n  async getDriverForCall(\n    _sessionId: string,\n    _functionName: string,\n    args: { rpcDriverName?: string },\n  ) {\n    const backendName =\n      args.rpcDriverName ||\n      readConfObject(this.mainConfiguration, 'defaultDriver')\n\n    return this.getDriver(backendName)\n  }\n\n  async call(\n    sessionId: string,\n    functionName: string,\n    args: Record<string, unknown>,\n    opts = {},\n  ) {\n    if (!sessionId) {\n      throw new Error('sessionId is required')\n    }\n    const driverForCall = await this.getDriverForCall(\n      sessionId,\n      functionName,\n      args,\n    )\n    return driverForCall.call(\n      this.pluginManager,\n      sessionId,\n      functionName,\n      args,\n      opts,\n    )\n  }\n}\n","import AbortablePromiseCache from '@gmod/abortable-promise-cache'\nimport {\n  addDisposer,\n  getParent,\n  getSnapshot,\n  types,\n} from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport { getConf } from '../configuration/index.ts'\nimport { adapterConfigCacheKey } from '../data_adapters/util.ts'\nimport QuickLRU from '../util/QuickLRU/index.ts'\nimport { when } from '../util/index.ts'\n\nimport type PluginManager from '../PluginManager.ts'\nimport type { AnyConfigurationModel } from '../configuration/index.ts'\nimport type {\n  BaseOptions,\n  BaseRefNameAliasAdapter,\n  RegionsAdapter,\n} from '../data_adapters/BaseAdapter/index.ts'\nimport type RpcManager from '../rpc/RpcManager.ts'\nimport type { Feature, Region } from '../util/index.ts'\nimport type { IAnyType, Instance } from '@jbrowse/mobx-state-tree'\n\ntype AdapterConf = Record<string, unknown>\n\n/* biome-ignore lint/complexity/useRegexLiterals: */\nconst refNameRegex = new RegExp(\n  '[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*',\n)\n\n// Based on the UCSC Genome Browser chromosome color palette:\n// https://github.com/ucscGenomeBrowser/kent/blob/a50ed53aff81d6fb3e34e6913ce18578292bc24e/src/hg/inc/chromColors.h\n// Some colors darkened to have at least a 3:1 contrast ratio on a white\n// background\nconst refNameColors = [\n  'rgb(153, 102, 0)',\n  'rgb(102, 102, 0)',\n  'rgb(153, 153, 30)',\n  'rgb(204, 0, 0)',\n  'rgb(255, 0, 0)',\n  'rgb(255, 0, 204)',\n  'rgb(165, 132, 132)', // originally 'rgb(255, 204, 204)'\n  'rgb(204, 122, 0)', // originally rgb(255, 153, 0)'\n  'rgb(178, 142, 0)', // originally 'rgb(255, 204, 0)'\n  'rgb(153, 153, 0)', // originally 'rgb(255, 255, 0)'\n  'rgb(122, 153, 0)', // originally 'rgb(204, 255, 0)'\n  'rgb(0, 165, 0)', // originally 'rgb(0, 255, 0)'\n  'rgb(53, 128, 0)',\n  'rgb(0, 0, 204)',\n  'rgb(96, 145, 242)', // originally 'rgb(102, 153, 255)'\n  'rgb(107, 142, 178)', // originally 'rgb(153, 204, 255)'\n  'rgb(0, 165, 165)', // originally 'rgb(0, 255, 255)'\n  'rgb(122, 153, 153)', // originally 'rgb(204, 255, 255)'\n  'rgb(153, 0, 204)',\n  'rgb(204, 51, 255)',\n  'rgb(173, 130, 216)', // originally 'rgb(204, 153, 255)'\n  'rgb(102, 102, 102)',\n  'rgb(145, 145, 145)', // originally 'rgb(153, 153, 153)'\n  'rgb(142, 142, 142)', // originally 'rgb(204, 204, 204)'\n  'rgb(142, 142, 107)', // originally 'rgb(204, 204, 153)'\n  'rgb(96, 163, 48)', // originally 'rgb(121, 204, 61)'\n]\n\nasync function loadRefNameMap(\n  assembly: Assembly,\n  adapterConfig: unknown,\n  options: BaseOptions & { sequenceAdapter?: unknown },\n  stopToken?: string,\n) {\n  const { sessionId, sequenceAdapter } = options\n  await when(() => !!(assembly.regions && assembly.refNameAliases), {\n    name: 'when assembly ready',\n  })\n\n  const refNames = (await assembly.rpcManager.call(\n    sessionId || 'assemblyRpc',\n    'CoreGetRefNames',\n    {\n      adapterConfig,\n      sequenceAdapter,\n      stopToken,\n      ...options,\n    },\n    { timeout: 1000000 },\n  )) as string[]\n\n  const { refNameAliases } = assembly\n  if (!refNameAliases) {\n    throw new Error(`error loading assembly ${assembly.name}'s refNameAliases`)\n  }\n\n  const refNameMap = Object.fromEntries(\n    refNames.map(name => {\n      checkRefName(name)\n      return [assembly.getCanonicalRefName(name), name]\n    }),\n  )\n\n  return {\n    forwardMap: refNameMap,\n    reverseMap: Object.fromEntries(\n      Object.entries(refNameMap).map(([canonicalName, adapterName]) => [\n        adapterName,\n        canonicalName,\n      ]),\n    ),\n  }\n}\n\n// Valid refName pattern from https://samtools.github.io/hts-specs/SAMv1.pdf\nfunction checkRefName(refName: string) {\n  if (!refNameRegex.test(refName)) {\n    throw new Error(`Encountered invalid refName: \"${refName}\"`)\n  }\n}\n\ntype RefNameAliases = Record<string, string>\n\ninterface CacheData {\n  adapterConf: unknown\n  self: Assembly\n  sessionId: string\n  options: BaseOptions\n}\n\nexport interface RefNameMap {\n  forwardMap: RefNameAliases\n  reverseMap: RefNameAliases\n}\n\nexport interface BasicRegion {\n  start: number\n  end: number\n  refName: string\n  assemblyName: string\n}\n\n/**\n * #stateModel Assembly\n */\nexport default function assemblyFactory(\n  assemblyConfigType: IAnyType,\n  pluginManager: PluginManager,\n) {\n  const adapterLoads = new AbortablePromiseCache<CacheData, RefNameMap>({\n    cache: new QuickLRU({ maxSize: 1000 }),\n\n    // @ts-expect-error\n    // TODO:ABORT (possible? desirable??)\n    async fill(\n      args: CacheData,\n      _stopToken?: string,\n      statusCallback?: (arg: string) => void,\n    ) {\n      const { adapterConf, self, options } = args\n      // pass the assembly's sequence adapter config so BAM/CRAM adapters can\n      // cache it for later use when fetching features\n      let sequenceAdapter\n      try {\n        const adapterConfig = self.configuration?.sequence?.adapter\n        // Convert to snapshot since MST objects can't be assigned elsewhere\n        sequenceAdapter = adapterConfig ? getSnapshot(adapterConfig) : undefined\n      } catch (e) {\n        // configuration might not be fully loaded yet\n      }\n      return loadRefNameMap(self, adapterConf, {\n        ...options,\n        statusCallback,\n        sequenceAdapter,\n      })\n    },\n  })\n  return types\n    .model({\n      /**\n       * #property\n       */\n      configuration: types.safeReference(assemblyConfigType),\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      error: undefined as unknown,\n      /**\n       * #volatile\n       */\n      loadingP: undefined as Promise<void> | undefined,\n      /**\n       * #volatile\n       */\n      volatileRegions: undefined as BasicRegion[] | undefined,\n      /**\n       * #volatile\n       */\n      refNameAliases: undefined as RefNameAliases | undefined,\n\n      /**\n       * #volatile\n       * Maps canonical refName -> sequence adapter refName (in FASTA).\n       * These may differ when refNameAliases with override:true remap names.\n       */\n      canonicalToSeqAdapterRefNames: undefined as\n        | Record<string, string>\n        | undefined,\n\n      /**\n       * #volatile\n       */\n      cytobands: undefined as Feature[] | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      getConf(arg: string) {\n        return self.configuration ? getConf(self, arg) : undefined\n      },\n      /**\n       * #getter\n       */\n      get lowerCaseRefNameAliases() {\n        return self.refNameAliases\n          ? Object.fromEntries(\n              Object.entries(self.refNameAliases).map(([key, val]) => {\n                return [key.toLowerCase(), val]\n              }),\n            )\n          : undefined\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * this is a getter with a side effect of loading the data. not the best\n       * practice, but it helps to lazy load the assembly\n       */\n      get initialized() {\n        // @ts-expect-error\n        self.load()\n        return !!self.refNameAliases\n      },\n\n      /**\n       * #getter\n       */\n      get name(): string {\n        return self.getConf('name') || ''\n      },\n\n      /**\n       * #getter\n       */\n      get regions() {\n        // @ts-expect-error\n        self.load()\n        return self.volatileRegions\n      },\n\n      /**\n       * #getter\n       */\n      get aliases(): string[] {\n        return self.getConf('aliases') || []\n      },\n\n      /**\n       * #getter\n       */\n      get displayName(): string {\n        return self.getConf('displayName') || self.getConf('name') || ''\n      },\n      /**\n       * #method\n       */\n      hasName(name: string) {\n        return this.allAliases.includes(name)\n      },\n\n      /**\n       * #getter\n       */\n      get allAliases() {\n        return [this.name, ...this.aliases]\n      },\n\n      /**\n       * #getter\n       * note: lowerCaseRefNameAliases not included here: this allows the list\n       * of refnames to be just the \"normal casing\", but things like\n       * getCanonicalRefName can resolve a lower-case name if needed\n       */\n      get allRefNames() {\n        return !self.refNameAliases\n          ? undefined\n          : Object.keys(self.refNameAliases)\n      },\n      /**\n       * #getter\n       */\n      get lowerCaseRefNames() {\n        return !self.lowerCaseRefNameAliases\n          ? undefined\n          : Object.keys(self.lowerCaseRefNameAliases)\n      },\n\n      /**\n       * #getter\n       */\n      get allRefNamesWithLowerCase() {\n        return this.allRefNames && this.lowerCaseRefNames\n          ? [...new Set([...this.allRefNames, ...this.lowerCaseRefNames])]\n          : undefined\n      },\n      /**\n       * #getter\n       */\n      get rpcManager(): RpcManager {\n        return getParent<any>(self, 2).rpcManager\n      },\n      /**\n       * #getter\n       */\n      get refNameColors() {\n        const colors: string[] = self.getConf('refNameColors') || []\n        return colors.length === 0 ? refNameColors : colors\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get refNames() {\n        return self.regions?.map(region => region.refName)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * Returns the canonical refName for a given alias or refName.\n       * Note: The canonical name may differ from what's in the FASTA file when\n       * refNameAliases with override:true are configured. To get the name that\n       * matches the FASTA file, use getSeqAdapterRefName().\n       */\n      getCanonicalRefName(refName: string) {\n        if (!self.refNameAliases || !self.lowerCaseRefNameAliases) {\n          throw new Error(\n            'aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called',\n          )\n        }\n\n        return (\n          self.refNameAliases[refName] || self.lowerCaseRefNameAliases[refName]\n        )\n      },\n      /**\n       * #method\n       * Returns canonical refName, falling back to input if not found.\n       * See getCanonicalRefName() for details.\n       */\n      getCanonicalRefName2(refName: string) {\n        return this.getCanonicalRefName(refName) || refName\n      },\n      /**\n       * #method\n       */\n      getRefNameColor(refName: string) {\n        if (!self.refNames) {\n          return undefined\n        }\n        const idx = self.refNames.indexOf(refName)\n        return idx === -1\n          ? undefined\n          : self.refNameColors[idx % self.refNameColors.length]\n      },\n      /**\n       * #method\n       */\n      isValidRefName(refName: string) {\n        if (!self.refNameAliases) {\n          throw new Error(\n            'isValidRefName cannot be called yet, the assembly has not finished loading',\n          )\n        }\n        return !!this.getCanonicalRefName(refName)\n      },\n      /**\n       * #method\n       * Given a canonical refName, returns the refName used by the sequence\n       * adapter (what's in the FASTA file). Falls back to the input if no\n       * mapping exists.\n       */\n      getSeqAdapterRefName(canonicalRefName: string) {\n        return (\n          self.canonicalToSeqAdapterRefNames?.[canonicalRefName] ??\n          canonicalRefName\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setLoaded({\n        regions,\n        refNameAliases,\n        cytobands,\n      }: {\n        regions: Region[]\n        refNameAliases: RefNameAliases\n        cytobands: Feature[]\n      }) {\n        this.setRegions(regions)\n        this.setRefNameAliases(refNameAliases)\n        this.setCytobands(cytobands)\n      },\n      /**\n       * #action\n       */\n      setError(e: unknown) {\n        self.error = e\n      },\n      /**\n       * #action\n       */\n      setRegions(regions: Region[]) {\n        self.volatileRegions = regions\n      },\n      /**\n       * #action\n       */\n      setRefNameAliases(aliases: RefNameAliases) {\n        self.refNameAliases = aliases\n      },\n      /**\n       * #action\n       */\n      setCytobands(cytobands: Feature[]) {\n        self.cytobands = cytobands\n      },\n      /**\n       * #action\n       */\n      setCanonicalToSeqAdapterRefNames(map: Record<string, string>) {\n        self.canonicalToSeqAdapterRefNames = map\n      },\n      /**\n       * #action\n       */\n      setLoadingP(p?: Promise<void>) {\n        self.loadingP = p\n      },\n      /**\n       * #action\n       */\n      load() {\n        if (!self.loadingP) {\n          self.loadingP = this.loadPre().catch((e: unknown) => {\n            this.setLoadingP(undefined)\n            this.setError(e)\n          })\n        }\n        return self.loadingP\n      },\n      /**\n       * #action\n       */\n      async loadPre() {\n        const conf = self.configuration\n        const refNameAliasesAdapterConf = conf?.refNameAliases?.adapter\n        const cytobandAdapterConf = conf?.cytobands?.adapter\n        const sequenceAdapterConf = conf?.sequence.adapter\n        const assemblyName = self.name\n\n        const regions = await getAssemblyRegions({\n          config: sequenceAdapterConf,\n          pluginManager,\n        })\n\n        for (const r of regions) {\n          checkRefName(r.refName)\n        }\n        const refNameAliases = {} as Record<string, string>\n\n        const refNameAliasCollection = await getRefNameAliases({\n          config: refNameAliasesAdapterConf,\n          pluginManager,\n        })\n\n        for (const { refName, aliases, override } of refNameAliasCollection) {\n          for (const alias of aliases) {\n            checkRefName(alias)\n            refNameAliases[alias] = refName\n          }\n          // the override field is supplied by a RefNameAliasAdapter to make\n          // the refName field returned by the adapter to be used as the\n          // primary names for this assembly\n          if (override) {\n            refNameAliases[refName] = refName\n          }\n        }\n        // add identity to the refNameAliases list\n        for (const region of regions) {\n          // this ||= means that if the refNameAliasAdapter already set a\n          // mapping for the primary region to be an alias\n          refNameAliases[region.refName] ||= region.refName\n        }\n\n        // Build sparse mapping from canonical names to sequence adapter names.\n        // Only stores entries where the names differ (for performance with large\n        // assemblies). getSeqAdapterRefName() falls back to input if not found.\n        const canonicalToSeqAdapterRefNames = {} as Record<string, string>\n        for (const region of regions) {\n          const canonicalName = refNameAliases[region.refName] || region.refName\n          if (canonicalName !== region.refName) {\n            canonicalToSeqAdapterRefNames[canonicalName] = region.refName\n          }\n        }\n        this.setCanonicalToSeqAdapterRefNames(canonicalToSeqAdapterRefNames)\n\n        this.setLoaded({\n          refNameAliases,\n          regions: regions.map(r => ({\n            ...r,\n            refName: refNameAliases[r.refName] || r.refName,\n            assemblyName,\n          })),\n          cytobands: await getCytobands({\n            config: cytobandAdapterConf,\n            pluginManager,\n          }),\n        })\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      getAdapterMapEntry(adapterConf: AdapterConf, options: BaseOptions) {\n        const { stopToken, statusCallback, ...rest } = options\n        if (!options.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        return adapterLoads.get(\n          adapterConfigCacheKey(adapterConf),\n          {\n            adapterConf,\n            self,\n            options: rest,\n          } as CacheData,\n\n          // stopToken intentionally not passed here, fixes issues like #2221.\n          // alternative fix #2540 was proposed but non-working currently\n          undefined,\n          statusCallback,\n        )\n      },\n\n      /**\n       * #method\n       * get Map of `canonical-name -> adapter-specific-name`\n       */\n      async getRefNameMapForAdapter(\n        adapterConf: AdapterConf,\n        opts: BaseOptions,\n      ) {\n        if (!opts.sessionId) {\n          throw new Error('sessionId is required')\n        }\n\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.forwardMap\n      },\n\n      /**\n       * #method\n       * get Map of `adapter-specific-name -> canonical-name`\n       */\n      async getReverseRefNameMapForAdapter(\n        adapterConf: AdapterConf,\n        opts: BaseOptions,\n      ) {\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.reverseMap\n      },\n      afterCreate() {\n        addDisposer(\n          self,\n          autorun(\n            function assemblyRefNamesAutorun() {\n              // force getter not to go stale. helps with very fragmented\n              // assemblies e.g. 1,000,000 scaffolds to avoid recomputing\n              //\n              // xref solution https://github.com/mobxjs/mobx/issues/266#issuecomment-222007278\n              // xref problem https://github.com/GMOD/react-msaview/issues/75\n              // eslint-disable-next-line  @typescript-eslint/no-unused-expressions\n              self.allRefNamesWithLowerCase\n            },\n            {\n              name: 'AssemblyRefNames',\n            },\n          ),\n        )\n      },\n    }))\n}\n\nasync function getRefNameAliases({\n  config,\n  pluginManager,\n  stopToken,\n}: {\n  config: AnyConfigurationModel\n  pluginManager: PluginManager\n  stopToken?: string\n}) {\n  const type = pluginManager.getAdapterType(config.type)!\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(\n    config,\n    undefined,\n    pluginManager,\n  ) as BaseRefNameAliasAdapter\n  return adapter.getRefNameAliases({ stopToken })\n}\n\nasync function getCytobands({\n  config,\n  pluginManager,\n}: {\n  config: AnyConfigurationModel\n  pluginManager: PluginManager\n}) {\n  const type = pluginManager.getAdapterType(config.type)!\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pluginManager)\n\n  // @ts-expect-error\n  return adapter.getData()\n}\n\nasync function getAssemblyRegions({\n  config,\n  pluginManager,\n  stopToken,\n}: {\n  config: AnyConfigurationModel\n  pluginManager: PluginManager\n  stopToken?: string\n}) {\n  const type = pluginManager.getAdapterType(config.type)!\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pluginManager) as RegionsAdapter\n  return adapter.getRegions({ stopToken })\n}\n\nexport type AssemblyModel = ReturnType<typeof assemblyFactory>\nexport type Assembly = Instance<AssemblyModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport {\n  FormatAboutConfigSchemaFactory,\n  FormatDetailsConfigSchemaFactory,\n  HierarchicalConfigSchemaFactory,\n} from '@jbrowse/product-core'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config JBrowseConfiguration\n * this is the entry under the `configuration` key\n * e.g.\n * ```json\n * {\n *   assemblies,\n *   tracks,\n *   configuration: { these entries here  }\n * }\n * ```\n */\nexport default function RootConfiguration({\n  pluginManager,\n}: {\n  pluginManager: PluginManager\n}) {\n  return ConfigurationSchema('Root', {\n    /**\n     * #slot configuration.rpc\n     */\n    rpc: RpcManager.configSchema,\n\n    /**\n     * #slot configuration.highResolutionScaling\n     */\n    highResolutionScaling: {\n      type: 'number',\n      defaultValue: 2,\n    },\n\n    formatDetails: FormatDetailsConfigSchemaFactory(),\n    formatAbout: FormatAboutConfigSchemaFactory(),\n\n    /*\n     * #slot configuration.shareURL\n     */\n    shareURL: {\n      type: 'string',\n      defaultValue: 'https://share.jbrowse.org/api/v1/',\n    },\n    /**\n     * #slot configuration.disableAnalytics\n     */\n    disableAnalytics: {\n      type: 'boolean',\n      defaultValue: false,\n    },\n\n    hierarchical: HierarchicalConfigSchemaFactory(),\n    /**\n     * #slot configuration.theme\n     */\n    theme: {\n      type: 'frozen',\n      defaultValue: {},\n    },\n    /**\n     * #slot configuration.extraThemes\n     */\n    extraThemes: {\n      type: 'frozen',\n      defaultValue: {},\n    },\n    /**\n     * #slot configuration.logoPath\n     */\n    logoPath: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slotAnnot\n     * this is a collection of 'namespaced' configs e.g. configuration.YourPlugin.slot\n     */\n    ...pluginManager.pluginConfigurationNamespacedSchemas(),\n    /**\n     * #slotAnnot\n     * this is a collection of 'unnamespaced' configs e.g. configuration.slot\n     */\n    ...pluginManager.pluginConfigurationUnnamespacedSchemas(),\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FormatDetails\n * generally exists on the tracks in the config.json or as a 'session' config as\n * configuration.formatDetails\n */\nexport function FormatDetailsConfigSchemaFactory() {\n  return ConfigurationSchema('FormatDetails', {\n    /**\n     * #slot configuration.formatDetails.feature\n     */\n    feature: {\n      type: 'frozen',\n      description: 'adds extra fields to the feature details',\n      defaultValue: {},\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot configuration.formatDetails.subfeatures\n     */\n    subfeatures: {\n      type: 'frozen',\n      description: 'adds extra fields to the subfeatures of a feature',\n      defaultValue: {},\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot configuration.formatDetails.depth\n     */\n    depth: {\n      type: 'number',\n      defaultValue: 2,\n      description:\n        'depth to iterate the formatDetails->subfeatures callback on subfeatures (used for example to only apply the callback to the first layer of subfeatures)',\n    },\n    /**\n     * #slot configuration.formatDetails.maxDepth\n     */\n    maxDepth: {\n      type: 'number',\n      defaultValue: 10000,\n      description: 'hide subfeatures greater than a certain depth',\n    },\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FormatAbout\n * generally exists on the config.json or root config as configuration.formatAbout\n */\nexport function FormatAboutConfigSchemaFactory() {\n  return ConfigurationSchema('FormatAbout', {\n    /**\n     * #slot configuration.formatAbout.config\n     */\n    config: {\n      type: 'frozen',\n      description: 'formats configuration object in about dialog',\n      defaultValue: {},\n      contextVariable: ['config'],\n    },\n    /**\n     * #slot configuration.formatAbout.hideUris\n     */\n\n    hideUris: {\n      type: 'boolean',\n      defaultValue: false,\n    },\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HierarchicalConfigSchema\n * generally exists on the config.json or root config as configuration.hierarchical\n */\nexport function HierarchicalConfigSchemaFactory() {\n  return ConfigurationSchema('hierarchical', {\n    sort: ConfigurationSchema('hierarchicalSort', {\n      /**\n       * #slot configuration.hierarchical.sort.trackNames\n       */\n      trackNames: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n      /**\n       * #slot configuration.hierarchical.sort.categories\n       */\n      categories: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n    }),\n    defaultCollapsed: ConfigurationSchema('defaultCollapsed', {\n      /**\n       * #slot configuration.hierarchical.defaultCollapsed.categoryNames\n       */\n      categoryNames: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      /**\n       * #slot configuration.hierarchical.defaultCollapsed.topLevelCategories\n       */\n      topLevelCategories: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n      /**\n       * #slot configuration.hierarchical.defaultCollapsed.subCategories\n       */\n      subCategories: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n    }),\n  })\n}\n","// this is in a separate module here so it can be mocked out by jest. the\n// import.meta.url is not well recognized by jest and we use MainThreadRpc in\n// tests anyways right now\n//\n// note: this uses webpack 5 native worker modules\n//\n// see https://github.com/cmdcolin/cra-webpack5-web-worker-example for simple example\n// and docs https://webpack.js.org/guides/web-workers/\n//\n// also note: the craco config for webpack publicPath: 'auto' is needed for\n// these workers\nexport default function makeWorkerInstance() {\n  return new Worker(new URL('./rpcWorker', import.meta.url))\n}\n","import { JBrowseModelF } from '@jbrowse/app-core'\nimport { getSnapshot, resolveIdentifier, types } from '@jbrowse/mobx-state-tree'\n\nimport { removeAttr } from './util.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n// poke some things for testing (this stuff will eventually be removed)\n// @ts-expect-error\nwindow.getSnapshot = getSnapshot\n// @ts-expect-error\nwindow.resolveIdentifier = resolveIdentifier\n\n/**\n * #stateModel JBrowseWebConfigModel\n * #category root\n * the rootModel.jbrowse state model for JBrowse Web\n */\nexport default function JBrowseWeb({\n  pluginManager,\n  assemblyConfigSchema,\n  adminMode,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: AnyConfigurationSchemaType\n  adminMode: boolean\n}) {\n  return types.snapshotProcessor(\n    JBrowseModelF({\n      pluginManager,\n      assemblyConfigSchema,\n      adminMode,\n    }),\n    {\n      postProcessor(snapshot: Record<string, any>) {\n        return removeAttr(structuredClone(snapshot), 'baseUri')\n      },\n    },\n  )\n}\n","import { lazy } from 'react'\n\nimport {\n  HistoryManagementMixin,\n  RootAppMenuMixin,\n  processMutableMenuActions,\n} from '@jbrowse/app-core'\nimport TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\nimport assemblyConfigSchemaFactory from '@jbrowse/core/assemblyManager/assemblyConfigSchema'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport { Cable, DNA } from '@jbrowse/core/ui/Icons'\nimport {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getType,\n  isAlive,\n  types,\n} from '@jbrowse/mobx-state-tree'\nimport { AssemblyManager } from '@jbrowse/plugin-data-management'\nimport {\n  BaseRootModelFactory,\n  InternetAccountsRootModelMixin,\n} from '@jbrowse/product-core'\nimport AddIcon from '@mui/icons-material/Add'\nimport ExtensionIcon from '@mui/icons-material/Extension'\nimport FileCopyIcon from '@mui/icons-material/FileCopy'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport GetAppIcon from '@mui/icons-material/GetApp'\nimport PublishIcon from '@mui/icons-material/Publish'\nimport RedoIcon from '@mui/icons-material/Redo'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport SpaceDashboardIcon from '@mui/icons-material/SpaceDashboard'\nimport StarIcon from '@mui/icons-material/Star'\nimport StorageIcon from '@mui/icons-material/Storage'\nimport UndoIcon from '@mui/icons-material/Undo'\nimport { formatDistanceToNow } from 'date-fns'\nimport { openDB } from 'idb'\nimport { autorun } from 'mobx'\n\nimport packageJSON from '../../package.json' with { type: 'json' }\nimport jbrowseWebFactory from '../jbrowseModel.ts'\nimport makeWorkerInstance from '../makeWorkerInstance.ts'\nimport { filterSessionInPlace } from '../util.ts'\n\nimport type { SessionDB, SessionMetadata } from '../types.ts'\nimport type { Menu } from '@jbrowse/app-core'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util'\nimport type { IAnyType, Instance, SnapshotIn } from '@jbrowse/mobx-state-tree'\nimport type { BaseSessionType, SessionWithDialogs } from '@jbrowse/product-core'\nimport type { IDBPDatabase } from 'idb'\n\n// lazies\nconst SetDefaultSession = lazy(\n  () => import('../components/SetDefaultSession.tsx'),\n)\nconst PreferencesDialog = lazy(\n  () => import('../components/PreferencesDialog.tsx'),\n)\n\ntype AssemblyConfig = ReturnType<typeof assemblyConfigSchemaFactory>\ntype SessionModelFactory = (args: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: AssemblyConfig\n}) => IAnyType\n\n/**\n * #stateModel JBrowseWebRootModel\n *\n * composed of\n * - [BaseRootModel](../baserootmodel)\n * - [InternetAccountsMixin](../internetaccountsmixin)\n * - [HistoryManagementMixin](../historymanagementmixin)\n * - [RootAppMenuMixin](../rootappmenumixin)\n *\n * note: many properties of the root model are available through the session,\n * and we generally prefer using the session model (via e.g. getSession) over\n * the root model (via e.g. getRoot) in plugin code\n */\nexport default function RootModel({\n  pluginManager,\n  sessionModelFactory,\n  adminMode = false,\n}: {\n  pluginManager: PluginManager\n  sessionModelFactory: SessionModelFactory\n  adminMode?: boolean\n}) {\n  const assemblyConfigSchema = assemblyConfigSchemaFactory(pluginManager)\n  const jbrowseModelType = jbrowseWebFactory({\n    adminMode,\n    pluginManager,\n    assemblyConfigSchema,\n  })\n  const sessionModelType = sessionModelFactory({\n    pluginManager,\n    assemblyConfigSchema,\n  })\n  return types\n    .compose(\n      BaseRootModelFactory({\n        pluginManager,\n        jbrowseModelType,\n        sessionModelType,\n        assemblyConfigSchema,\n      }),\n      InternetAccountsRootModelMixin(pluginManager),\n      HistoryManagementMixin(),\n      RootAppMenuMixin(),\n    )\n    .props({\n      /**\n       * #property\n       */\n      configPath: types.maybe(types.string),\n    })\n    .volatile(self => ({\n      /**\n       * #volatile\n       */\n      adminMode,\n      /**\n       * #volatile\n       */\n      sessionDB: undefined as IDBPDatabase<SessionDB> | undefined,\n      /**\n       * #volatile\n       */\n      version: packageJSON.version,\n      /**\n       * #volatile\n       */\n      pluginsUpdated: false,\n      /**\n       * #volatile\n       */\n      rpcManager: new RpcManager(\n        pluginManager,\n        self.jbrowse.configuration.rpc,\n        {\n          WebWorkerRpcDriver: { makeWorkerInstance },\n          MainThreadRpcDriver: {},\n        },\n      ),\n      /**\n       * #volatile\n       */\n      savedSessionMetadata: undefined as SessionMetadata[] | undefined,\n      /**\n       * #volatile\n       */\n      textSearchManager: new TextSearchManager(pluginManager),\n      /**\n       * #volatile\n       */\n      error: undefined as unknown,\n      /**\n       * #volatile\n       */\n      reloadPluginManagerCallback: (\n        _configSnapshot: Record<string, unknown>,\n        _sessionSnapshot: Record<string, unknown>,\n      ) => {\n        console.error('reloadPluginManagerCallback unimplemented')\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSavedSessionMetadata(sessions: SessionMetadata[]) {\n        self.savedSessionMetadata = sessions\n      },\n\n      /**\n       * #action\n       */\n      async fetchSessionMetadata() {\n        if (self.sessionDB) {\n          const ret = await self.sessionDB.getAll('metadata')\n          this.setSavedSessionMetadata(\n            ret\n              .filter(f => f.configPath === (self.configPath || ''))\n              .sort((a, b) => +b.createdAt - +a.createdAt),\n          )\n        }\n      },\n      /**\n       * #action\n       */\n      setSessionDB(sessionDB: IDBPDatabase<SessionDB>) {\n        self.sessionDB = sessionDB\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #aftercreate\n       */\n      afterCreate() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          // IndexedDB setup for session persistence\n          if (typeof indexedDB !== 'undefined') {\n            try {\n              const sessionDB = await openDB<SessionDB>('sessionsDB', 2, {\n                upgrade(db) {\n                  db.createObjectStore('metadata')\n                  db.createObjectStore('sessions')\n                },\n              })\n              self.setSessionDB(sessionDB)\n\n              addDisposer(\n                self,\n                autorun(\n                  async () => {\n                    if (self.session) {\n                      try {\n                        // careful not to access self.savedSessionMetadata in\n                        // here, or else it can create an infinite loop\n                        const s = self.session\n\n                        // step 1. update the idb data according to whatever\n                        // triggered the autorun\n                        if (self.sessionDB) {\n                          await sessionDB.put('sessions', getSnapshot(s), s.id)\n                          if (!isAlive(self)) {\n                            return\n                          }\n\n                          const ret = await self.sessionDB.get('metadata', s.id)\n                          await sessionDB.put(\n                            'metadata',\n                            {\n                              ...ret,\n                              favorite: ret?.favorite || false,\n                              name: s.name,\n                              id: s.id,\n                              createdAt: new Date(),\n                              configPath: self.configPath || '',\n                            },\n                            s.id,\n                          )\n                        }\n                        // step 2. refetch the metadata\n                        await self.fetchSessionMetadata()\n                      } catch (e) {\n                        console.error(e)\n                        self.session?.notifyError(`${e}`, e)\n                      }\n                    }\n                  },\n                  { delay: 400 },\n                ),\n              )\n            } catch (e) {\n              console.error(e)\n              self.session?.notifyError(`${e}`, e)\n            }\n          }\n\n          let savingFailed = false\n          addDisposer(\n            self,\n            autorun(\n              () => {\n                if (self.session) {\n                  const s = self.session as AbstractSessionModel\n                  const sessionSnap = getSnapshot(s)\n                  try {\n                    sessionStorage.setItem(\n                      'current',\n                      JSON.stringify({\n                        session: sessionSnap,\n                        createdAt: new Date(),\n                      }),\n                    )\n                    if (savingFailed) {\n                      savingFailed = false\n                      s.notify('Auto-saving restored', 'info')\n                    }\n\n                    // this check is not able to be modularized into it's own\n                    // autorun at current time because it depends on session\n                    // storage snapshot being set above\n                    if (self.pluginsUpdated) {\n                      self.reloadPluginManagerCallback(\n                        structuredClone(getSnapshot(self.jbrowse)),\n                        structuredClone(sessionSnap),\n                      )\n                    }\n                  } catch (e) {\n                    console.error(e)\n                    const msg = `${e}`\n                    if (!savingFailed) {\n                      savingFailed = true\n                      if (msg.includes('quota')) {\n                        s.notifyError(\n                          'Unable to auto-save session, exceeded sessionStorage quota. This may be because a very large feature was stored in session',\n                          e,\n                        )\n                      } else {\n                        s.notifyError(msg, e)\n                      }\n                    }\n                  }\n                }\n              },\n              { delay: 400 },\n            ),\n          )\n        })()\n      },\n      /**\n       * #action\n       */\n      setSession(sessionSnapshot: SnapshotIn<BaseSessionType>) {\n        const oldSession = self.session\n        self.session = cast(sessionSnapshot)\n        if (self.session) {\n          // validate all references in the session snapshot\n          try {\n            filterSessionInPlace(self.session, getType(self.session))\n          } catch (error) {\n            // throws error if session filtering failed\n            self.session = oldSession\n            throw error\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setPluginsUpdated(flag: boolean) {\n        self.pluginsUpdated = flag\n      },\n      /**\n       * #action\n       */\n      setReloadPluginManagerCallback(\n        callback: (\n          configSnapshot: Record<string, unknown>,\n          sessionSnapshot: Record<string, unknown>,\n        ) => void,\n      ) {\n        self.reloadPluginManagerCallback = callback\n      },\n      /**\n       * #action\n       */\n      setDefaultSession() {\n        const { defaultSession } = self.jbrowse\n        this.setSession({\n          ...defaultSession,\n          name: `${defaultSession.name || 'New session'} ${new Date().toLocaleString()}`,\n        })\n      },\n      /**\n       * #action\n       */\n      async activateSession(id: string) {\n        const ret = await self.sessionDB?.get('sessions', id)\n        if (ret) {\n          this.setSession(ret)\n        } else {\n          self.session?.notifyError('Session not found')\n        }\n      },\n      /**\n       * #action\n       */\n      async favoriteSavedSession(id: string) {\n        if (self.sessionDB) {\n          const ret = self.savedSessionMetadata!.find(f => f.id === id)\n          if (ret) {\n            await self.sessionDB.put(\n              'metadata',\n              {\n                ...ret,\n                favorite: true,\n              },\n              ret.id,\n            )\n            await self.fetchSessionMetadata()\n          }\n        }\n      },\n      /**\n       * #action\n       */\n      async unfavoriteSavedSession(id: string) {\n        if (self.sessionDB) {\n          const ret = self.savedSessionMetadata!.find(f => f.id === id)\n          if (ret) {\n            await self.sessionDB.put(\n              'metadata',\n              {\n                ...ret,\n                favorite: false,\n              },\n              ret.id,\n            )\n          }\n          await self.fetchSessionMetadata()\n        }\n      },\n      /**\n       * #action\n       */\n      async deleteSavedSession(id: string) {\n        if (self.sessionDB) {\n          await self.sessionDB.delete('metadata', id)\n          await self.sessionDB.delete('sessions', id)\n          await self.fetchSessionMetadata()\n        }\n      },\n      /**\n       * #action\n       */\n      renameCurrentSession(sessionName: string) {\n        this.setSession({\n          ...getSnapshot(self.session),\n          name: sessionName,\n        })\n      },\n\n      /**\n       * #action\n       */\n      setError(error?: unknown) {\n        self.error = error\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menus() {\n        const preConfiguredSessions = readConfObject(\n          self.jbrowse,\n          'preConfiguredSessions',\n        )\n\n        const ret = [\n          {\n            label: 'File',\n            menuItems: () => {\n              const favs = self.savedSessionMetadata\n                ?.filter(f => f.favorite)\n                .slice(0, 5)\n              const rest = self.savedSessionMetadata\n                ?.filter(f => !f.favorite)\n                .slice(0, 5)\n\n              return [\n                {\n                  label: 'New session',\n                  icon: AddIcon,\n                  onClick: () => {\n                    self.setDefaultSession()\n                  },\n                },\n                {\n                  label: 'Import session...',\n                  icon: PublishIcon,\n                  onClick: () => {\n                    const widget = self.session?.addWidget(\n                      'ImportSessionWidget',\n                      'importSessionWidget',\n                    )\n                    if (widget) {\n                      self.session?.showWidget(widget)\n                    }\n                  },\n                },\n                {\n                  label: 'Export session',\n                  icon: GetAppIcon,\n                  onClick: async () => {\n                    if (self.session) {\n                      // eslint-disable-next-line @typescript-eslint/no-deprecated\n                      const { saveAs } = await import('file-saver-es')\n\n                      saveAs(\n                        new Blob(\n                          [\n                            JSON.stringify(\n                              { session: getSnapshot(self.session) },\n                              null,\n                              2,\n                            ),\n                          ],\n                          { type: 'text/plain;charset=utf-8' },\n                        ),\n                        'session.json',\n                        { autoBom: false },\n                      )\n                    }\n                  },\n                },\n                {\n                  label: 'Duplicate session',\n                  icon: FileCopyIcon,\n                  onClick: () => {\n                    if (self.session) {\n                      // @ts-expect-error\n                      const { id, ...rest } = getSnapshot(self.session)\n                      self.setSession(rest)\n                    }\n                  },\n                },\n                ...(preConfiguredSessions?.length\n                  ? [\n                      {\n                        label: 'Pre-configured sessions...',\n                        subMenu: preConfiguredSessions.map(\n                          (r: { name: string }) => ({\n                            label: r.name,\n                            onClick: () => {\n                              self.setSession(r)\n                            },\n                          }),\n                        ),\n                      },\n                    ]\n                  : []),\n                ...(favs?.length\n                  ? [\n                      {\n                        label: 'Favorite sessions...',\n                        subMenu: [\n                          ...favs.slice(0, 5).map(r => ({\n                            label: `${r.name} (${r.id === self.session?.id ? 'current' : formatDistanceToNow(r.createdAt, { addSuffix: true })})`,\n                            disabled: r.id === self.session?.id,\n                            icon: StarIcon,\n                            onClick: () => {\n                              // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                              ;(async () => {\n                                try {\n                                  await self.activateSession(r.id)\n                                } catch (e) {\n                                  self.session?.notifyError(`${e}`, e)\n                                }\n                              })()\n                            },\n                          })),\n                          {\n                            label: 'More...',\n                            icon: FolderOpenIcon,\n                            onClick: () => {\n                              const widget = self.session?.addWidget(\n                                'SessionManager',\n                                'sessionManager',\n                              )\n                              if (widget) {\n                                self.session?.showWidget(widget)\n                              }\n                            },\n                          },\n                        ],\n                      },\n                    ]\n                  : []),\n                {\n                  label: 'Recent sessions...',\n                  type: 'subMenu',\n                  subMenu: rest?.length\n                    ? [\n                        ...rest.map(r => ({\n                          label: `${r.name} (${r.id === self.session?.id ? 'current' : formatDistanceToNow(r.createdAt, { addSuffix: true })})`,\n                          disabled: r.id === self.session?.id,\n                          onClick: () => {\n                            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                            ;(async () => {\n                              try {\n                                await self.activateSession(r.id)\n                              } catch (e) {\n                                self.session?.notifyError(`${e}`, e)\n                              }\n                            })()\n                          },\n                        })),\n                        {\n                          label: 'More...',\n                          icon: FolderOpenIcon,\n                          onClick: () => {\n                            const widget = self.session?.addWidget(\n                              'SessionManager',\n                              'sessionManager',\n                            )\n                            if (widget) {\n                              self.session?.showWidget(widget)\n                            }\n                          },\n                        },\n                      ]\n                    : [{ label: 'No autosaves found', onClick: () => {} }],\n                },\n                { type: 'divider' },\n                {\n                  label: 'Open track...',\n                  icon: StorageIcon,\n                  onClick: () => {\n                    if (self.session) {\n                      if (self.session.views.length === 0) {\n                        self.session.notify(\n                          'Please open a view to add a track first',\n                        )\n                      } else {\n                        const widget = self.session.addWidget(\n                          'AddTrackWidget',\n                          'addTrackWidget',\n                          { view: self.session.views[0]!.id },\n                        )\n                        self.session.showWidget(widget)\n                        if (self.session.views.length > 1) {\n                          self.session.notify(\n                            'This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right',\n                          )\n                        }\n                      }\n                    }\n                  },\n                },\n                {\n                  label: 'Open connection...',\n                  icon: Cable,\n                  onClick: () => {\n                    const widget = self.session?.addWidget(\n                      'AddConnectionWidget',\n                      'addConnectionWidget',\n                    )\n                    if (widget) {\n                      self.session?.showWidget(widget)\n                    }\n                  },\n                },\n              ]\n            },\n          },\n          ...(adminMode\n            ? [\n                {\n                  label: 'Admin',\n                  menuItems: [\n                    {\n                      label: 'Set default session',\n                      onClick: () => {\n                        self.session?.queueDialog((onClose: () => void) => [\n                          SetDefaultSession,\n                          {\n                            rootModel: self,\n                            onClose,\n                          },\n                        ])\n                      },\n                    },\n                  ],\n                },\n              ]\n            : []),\n          {\n            label: 'Add',\n            menuItems: [],\n          },\n          {\n            label: 'Tools',\n            menuItems: [\n              {\n                label: 'Undo',\n                icon: UndoIcon,\n                onClick: () => {\n                  if (self.history.canUndo) {\n                    self.history.undo()\n                  }\n                },\n              },\n              {\n                label: 'Redo',\n                icon: RedoIcon,\n                onClick: () => {\n                  if (self.history.canRedo) {\n                    self.history.redo()\n                  }\n                },\n              },\n              { type: 'divider' },\n              {\n                label: 'Plugin store',\n                icon: ExtensionIcon,\n                onClick: () => {\n                  if (self.session) {\n                    self.session.showWidget(\n                      self.session.addWidget(\n                        'PluginStoreWidget',\n                        'pluginStoreWidget',\n                      ),\n                    )\n                  }\n                },\n              },\n              {\n                label: 'Assembly manager',\n                icon: DNA,\n                onClick: () => {\n                  self.session?.queueDialog((onClose: () => void) => [\n                    AssemblyManager,\n                    {\n                      onClose,\n                      session: self.session,\n                      rootModel: self,\n                    },\n                  ])\n                },\n              },\n\n              {\n                label: 'Preferences',\n                icon: SettingsIcon,\n                onClick: () => {\n                  if (self.session) {\n                    ;(self.session as SessionWithDialogs).queueDialog(\n                      handleClose => [\n                        PreferencesDialog,\n                        {\n                          session: self.session,\n                          handleClose,\n                        },\n                      ],\n                    )\n                  }\n                },\n              },\n              {\n                label: 'Use workspaces',\n                icon: SpaceDashboardIcon,\n                type: 'checkbox',\n                checked: self.session?.useWorkspaces ?? false,\n                helpText:\n                  'Workspaces allow you to organize views into tabs and tiles. There are a variety of unique features, for instance, you can drag views between tabs or split them side-by-side. Try clicking and dragging the tab header to create a new split',\n                onClick: () => {\n                  self.session?.setUseWorkspaces(!self.session.useWorkspaces)\n                },\n              },\n            ],\n          },\n        ] as Menu[]\n\n        return processMutableMenuActions(ret, self.mutableMenuActions)\n      },\n    }))\n}\n\nexport type WebRootModelType = ReturnType<typeof RootModel>\nexport type WebRootModel = Instance<WebRootModelType>\n","import { ConfigurationSchema } from '../configuration/index.ts'\n\nimport type PluginManager from '../PluginManager.ts'\n\n/**\n * #config BaseAssembly\n * #category assemblyManagement\n * This corresponds to the assemblies section of the config\n */\nfunction assemblyConfigSchema(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseAssembly',\n    {\n      /**\n       * #slot\n       * aliases are \"reference name aliases\" e.g. aliases for hg38 might be\n       * \"GRCh38\"\n       */\n      aliases: {\n        type: 'stringArray',\n        defaultValue: [],\n        description: 'Other possible names for the assembly',\n      },\n\n      /**\n       * #slot\n       * sequence refers to a reference sequence track that has an adapter\n       * containing, importantly, a sequence adapter such as\n       * IndexedFastaAdapter\n       */\n      sequence: pluginManager.getTrackType('ReferenceSequenceTrack')!\n        .configSchema,\n\n      /**\n       * #slot\n       */\n      refNameColors: {\n        type: 'stringArray',\n        defaultValue: [],\n        description:\n          'Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence.',\n      },\n\n      refNameAliases: ConfigurationSchema(\n        'RefNameAliases',\n        {\n          /**\n           * #slot refNameAliases.adapter\n           * refNameAliases help resolve e.g. chr1 and 1 as the same entity the\n           * data for refNameAliases are fetched from an adapter, that is\n           * commonly a tsv like chromAliases.txt from UCSC or similar\n           */\n          adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n        },\n        {\n          preProcessSnapshot: snap => {\n            // allow refNameAliases to be unspecified\n            return !snap.adapter\n              ? {\n                  adapter: {\n                    type: 'RefNameAliasAdapter',\n                  },\n                }\n              : snap\n          },\n        },\n      ),\n      cytobands: ConfigurationSchema(\n        'Cytoband',\n        {\n          /**\n           * #slot cytobands.adapter\n           * cytoband data is fetched from an adapter, and can be displayed by\n           * a view type as ideograms\n           */\n          adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n        },\n        {\n          preProcessSnapshot: snap => {\n            // allow cytoBand to be unspecified\n            return !snap.adapter\n              ? {\n                  adapter: {\n                    type: 'CytobandAdapter',\n                  },\n                }\n              : snap\n          },\n        },\n      ),\n\n      /**\n       * #slot\n       */\n      displayName: {\n        type: 'string',\n        defaultValue: '',\n        description:\n          'A human readable display name for the assembly e.g. \"Homo sapiens (hg38)\" while the assembly name may just be \"hg38\"',\n      },\n    },\n    {\n      /**\n       * #identifier name\n       * the name acts as a unique identifier in the config, so it cannot be\n       * duplicated. it usually a short human readable \"id\" like hg38, but you\n       * can also optionally customize the assembly \"displayName\" config slot\n       */\n      explicitIdentifier: 'name',\n    },\n  )\n}\n\nexport default assemblyConfigSchema\nexport type BaseAssemblyConfigSchema = ReturnType<typeof assemblyConfigSchema>\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { cast, getParent, getSnapshot } from '@jbrowse/mobx-state-tree'\nimport { toJS } from 'mobx'\n\nimport { JBrowseConfigF } from '../JBrowseConfig/index.ts'\n\nimport type { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type RpcManager from '@jbrowse/core/rpc/RpcManager'\n\n/**\n * #stateModel AppCoreJBrowseModel\n * note that JBrowseRootConfig is a config model, but config models are MST\n * trees themselves, which is why this stateModel is allowed to extend it\n *\n * the AppCoreJBrowseModel is generally on a property named rootModel.jbrowse\n *\n * extends\n * - [JBrowseRootConfig](/docs/config/jbrowserootconfig)\n\n */\nexport function JBrowseModelF({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  adminMode?: boolean\n  pluginManager: PluginManager\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  return JBrowseConfigF({ pluginManager, assemblyConfigSchema })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblyNames(): string[] {\n        return self.assemblies.map(assembly => readConfObject(assembly, 'name'))\n      },\n      /**\n       * #getter\n       */\n      get rpcManager(): RpcManager {\n        return getParent<any>(self).rpcManager\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addAssemblyConf(conf: AnyConfigurationModel) {\n        const { name } = conf\n        if (!name) {\n          throw new Error('Can\\'t add assembly with no \"name\"')\n        }\n        if (self.assemblyNames.includes(name)) {\n          throw new Error(\n            `Can't add assembly with name \"${name}\", an assembly with that name already exists`,\n          )\n        }\n        const length = self.assemblies.push({\n          ...conf,\n          sequence: {\n            type: 'ReferenceSequenceTrack',\n            trackId: `${name}-${Date.now()}`,\n            ...conf.sequence,\n          },\n        })\n        return self.assemblies[length - 1]\n      },\n      /**\n       * #action\n       */\n      removeAssemblyConf(assemblyName: string) {\n        const toRemove = self.assemblies.find(a => a.name === assemblyName)\n        if (toRemove) {\n          self.assemblies.remove(toRemove)\n        }\n      },\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: { trackId: string; type: string }) {\n        const { type } = trackConf\n        if (!type) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        self.tracks = [...self.tracks, trackConf]\n        return self.tracks.at(-1)\n      },\n      /**\n       * #action\n       */\n      addConnectionConf(connectionConf: AnyConfigurationModel) {\n        const { type } = connectionConf\n        if (!type) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connections.push(connectionConf)\n        return self.connections[length - 1]\n      },\n      /**\n       * #action\n       */\n      deleteConnectionConf(configuration: AnyConfigurationModel) {\n        const elt = self.connections.find(conn => conn.id === configuration.id)\n        return self.connections.remove(elt)\n      },\n      /**\n       * #action\n       */\n      deleteTrackConf(trackConf: AnyConfigurationModel | { trackId: string }) {\n        const trackId = trackConf.trackId\n        self.tracks = self.tracks.filter(t => t.trackId !== trackId)\n      },\n      /**\n       * #action\n       * Updates an existing track configuration. Used to sync editable configs\n       * back to the frozen tracks array.\n       */\n      updateTrackConf(trackConf: { trackId: string; [key: string]: unknown }) {\n        const { trackId } = trackConf\n        const idx = self.tracks.findIndex(t => t.trackId === trackId)\n        if (idx !== -1) {\n          // Replace the track at that index\n          const newTracks = [...self.tracks]\n          newTracks[idx] = trackConf\n          self.tracks = newTracks\n        }\n      },\n      /**\n       * #action\n       */\n      addPlugin(pluginDefinition: PluginDefinition) {\n        self.plugins.push(pluginDefinition)\n\n        const rootModel = getParent<any>(self)\n        rootModel.setPluginsUpdated(true)\n      },\n      /**\n       * #action\n       */\n      removePlugin(pluginDefinition: PluginDefinition) {\n        self.plugins = cast(\n          self.plugins.filter(\n            plugin =>\n              // @ts-expect-error\n              plugin.url !== pluginDefinition.url ||\n              // @ts-expect-error\n              plugin.umdUrl !== pluginDefinition.umdUrl ||\n              // @ts-expect-error\n              plugin.cjsUrl !== pluginDefinition.cjsUrl ||\n              // @ts-expect-error\n              plugin.esmUrl !== pluginDefinition.esmUrl,\n          ),\n        )\n\n        getParent<any>(self).setPluginsUpdated(true)\n      },\n\n      /**\n       * #action\n       */\n      setDefaultSessionConf(sessionConf: AnyConfigurationModel) {\n        const newDefault =\n          getParent<any>(self).session.name === sessionConf.name\n            ? getSnapshot(sessionConf)\n            : toJS(sessionConf)\n\n        if (!newDefault.name) {\n          throw new Error(`unable to set default session to ${newDefault.name}`)\n        }\n\n        self.defaultSession = cast(newDefault)\n      },\n      /**\n       * #action\n       */\n      addInternetAccountConf(internetAccountConf: AnyConfigurationModel) {\n        const { type } = internetAccountConf\n        if (!type) {\n          throw new Error(`unknown internetAccount type ${type}`)\n        }\n        const length = self.internetAccounts.push(internetAccountConf)\n        return self.internetAccounts[length - 1]\n      },\n      /**\n       * #action\n       */\n      deleteInternetAccountConf(configuration: AnyConfigurationModel) {\n        const elt = self.internetAccounts.find(a => a.id === configuration.id)\n        return self.internetAccounts.remove(elt)\n      },\n    }))\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport RootConfiguration from './RootConfiguration.ts'\n\nimport type { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #config JBrowseRootConfig\n * #category root\n *\n * this is a config model representing a config.json (for jbrowse-web) or\n * somefile.jbrowse (for jbrowse-desktop, where configs have the .jbrowse\n * extension)\n *\n * also includes any pluginManager.pluginConfigurationSchemas(), so plugins\n * that have a configurationSchema field on their class are mixed into this\n * object\n */\nexport function JBrowseConfigF({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: AnyConfigurationSchemaType\n  adminMode?: boolean\n}) {\n  return types.model('JBrowseConfig', {\n    configuration: RootConfiguration({\n      pluginManager,\n    }),\n    /**\n     * #slot\n     * defines plugins of the format\n     * ```typescript\n     * type PluginDefinition=\n     *    { umdUrl: string, name:string } |\n     *    { url: string, name: string } |\n     *    { esmUrl: string } |\n     *    { cjsUrl: string } |\n     *    { umdLoc: { uri: string } } |\n     *    { esmLoc: { uri: string } } |\n     * ```\n     */\n    plugins: types.array(types.frozen<PluginDefinition>()),\n    /**\n     * #slot\n     * configuration of the assemblies in the instance, see BaseAssembly\n     */\n    assemblies: types.array(assemblyConfigSchema),\n    /**\n     * #slot\n     * track configuration is an array of track config schemas. multiple\n     * instances of a track can exist that use the same configuration.\n     * Always uses frozen for performance - editing creates temporary MST models.\n     */\n    tracks: types.frozen([] as { trackId: string; [key: string]: unknown }[]),\n    /**\n     * #slot\n     * configuration for internet accounts, see InternetAccounts\n     */\n    internetAccounts: types.array(\n      pluginManager.pluggableConfigSchemaType('internet account'),\n    ),\n    /**\n     * #slot\n     * configuration for aggregate text search adapters (created by e.g.\n     * jbrowse text-index, but can be a pluggable TextSearchAdapter type)\n     */\n    aggregateTextSearchAdapters: types.array(\n      pluginManager.pluggableConfigSchemaType('text search adapter'),\n    ),\n\n    /**\n     * #slot\n     * configuration for connections\n     */\n    connections: types.array(\n      pluginManager.pluggableConfigSchemaType('connection'),\n    ),\n\n    /**\n     * #slot\n     */\n    defaultSession: types.optional(types.frozen(), {\n      name: 'New Session',\n    }),\n\n    /**\n     * #slot\n     */\n    preConfiguredSessions: types.array(types.frozen()),\n\n    ...pluginManager.pluginConfigurationRootSchemas(),\n  })\n}\n","import TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\nimport assemblyManagerFactory from '@jbrowse/core/assemblyManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport {\n  cast,\n  getSnapshot,\n  isStateTreeNode,\n  types,\n} from '@jbrowse/mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport type { IAnyType, Instance, SnapshotIn } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel BaseRootModel\n * #category root\n * factory function for the Base-level root model shared by all products\n */\nexport function BaseRootModelFactory({\n  pluginManager,\n  jbrowseModelType,\n  sessionModelType,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  jbrowseModelType: IAnyType\n  sessionModelType: IAnyType\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  return types\n    .model('BaseRootModel', {\n      /**\n       * #property\n       * `jbrowse` is a mapping of the config.json into the in-memory state\n       * tree\n       */\n      jbrowse: jbrowseModelType,\n\n      /**\n       * #property\n       * `session` encompasses the currently active state of the app, including\n       * views open, tracks open in those views, etc.\n       */\n      session: types.maybe(sessionModelType),\n      /**\n       * #property\n       */\n      sessionPath: types.optional(types.string, ''),\n\n      /**\n       * #property\n       */\n      assemblyManager: types.optional(\n        assemblyManagerFactory(assemblyConfigSchema, pluginManager),\n        {},\n      ),\n    })\n    .volatile(self => ({\n      /**\n       * #volatile\n       */\n      rpcManager: new RpcManager(\n        pluginManager,\n        self.jbrowse.configuration.rpc,\n        {\n          MainThreadRpcDriver: {},\n        },\n      ),\n\n      /**\n       * #volatile\n       */\n      adminMode: false,\n      /**\n       * #volatile\n       */\n      error: undefined as unknown,\n      /**\n       * #volatile\n       */\n      textSearchManager: new TextSearchManager(pluginManager),\n      /**\n       * #volatile\n       */\n      pluginManager,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        self.error = error\n      },\n      /**\n       * #action\n       */\n      setSession(sessionSnapshot?: SnapshotIn<IAnyType>) {\n        self.session = cast(sessionSnapshot)\n      },\n      /**\n       * #action\n       */\n      setDefaultSession() {\n        this.setSession(self.jbrowse.defaultSession)\n      },\n      /**\n       * #action\n       */\n      setSessionPath(path: string) {\n        self.sessionPath = path\n      },\n      /**\n       * #action\n       */\n      renameCurrentSession(newName: string) {\n        if (self.session) {\n          this.setSession({\n            ...getSnapshot(self.session),\n            name: newName,\n          })\n        }\n      },\n    }))\n}\n\nexport type BaseRootModelType = ReturnType<typeof BaseRootModelFactory>\nexport type BaseRootModel = Instance<BaseRootModelType>\n\n/** Type guard for checking if something is a JB root model */\nexport function isRootModel(thing: unknown): thing is BaseRootModelType {\n  return (\n    isStateTreeNode(thing) &&\n    'session' in thing &&\n    'jbrowse' in thing &&\n    'assemblyManager' in thing\n  )\n}\n","import { addDisposer, getParent, types } from '@jbrowse/mobx-state-tree'\nimport { reaction } from 'mobx'\n\nimport assemblyFactory from './assembly.ts'\nimport { readConfObject } from '../configuration/index.ts'\nimport { when } from '../util/index.ts'\n\nimport type { Assembly } from './assembly.ts'\nimport type PluginManager from '../PluginManager.ts'\nimport type { AnyConfigurationModel } from '../configuration/index.ts'\nimport type RpcManager from '../rpc/RpcManager.ts'\nimport type { StopToken } from '../util/stopToken.ts'\nimport type { IAnyType, Instance } from '@jbrowse/mobx-state-tree'\n\ntype AdapterConf = Record<string, unknown>\n\nexport interface AssemblyBaseOpts {\n  stopToken?: StopToken\n  sessionId: string\n  statusCallback?: (arg: string) => void\n}\n\n/**\n * #stateModel AssemblyManager\n */\nfunction assemblyManagerFactory(conf: IAnyType, pm: PluginManager) {\n  type Conf = Instance<typeof conf> // this is type any, try to narrow...\n  return types\n    .model({\n      /**\n       * #property\n       * this is automatically managed by an autorun which looks in the parent\n       * session.assemblies, session.sessionAssemblies, and\n       * session.temporaryAssemblies\n       */\n      assemblies: types.array(assemblyFactory(conf, pm)),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblyNameMap() {\n        const obj = {} as Record<string, Assembly>\n        for (const assembly of self.assemblies) {\n          for (const name of assembly.allAliases) {\n            obj[name] = assembly\n          }\n        }\n        return obj\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      getCanonicalAssemblyName(asmName: string) {\n        return self.assemblyNameMap[asmName]?.name\n      },\n      /**\n       * #method\n       */\n      getCanonicalAssemblyName2(asmName: string) {\n        return self.assemblyNameMap[asmName]?.name || asmName\n      },\n      /**\n       * #method\n       */\n      get(asmName: string) {\n        if (asmName) {\n          const assembly = self.assemblyNameMap[asmName]\n          if (assembly) {\n            return assembly\n          } else if (!this.assemblyNamesList.includes(asmName)) {\n            // Extension point for loading unrecognized assemblies. Allows\n            // plugins to provide custom logic for assembly resolution\n            //\n            // Note: this does not return any particular value. however, it can\n            // trigger things like like adding connections, that will\n            // eventually trigger assemblies to be loaded and new evaluations\n            // via observable behavior\n            pm.evaluateExtensionPoint(\n              'Core-handleUnrecognizedAssembly',\n              undefined,\n              {\n                assemblyName: asmName,\n                session: getParent<any>(self).session,\n              },\n            )\n          }\n        }\n\n        return undefined\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNamesList() {\n        return this.assemblyList.map(asm => asm.name)\n      },\n\n      /**\n       * #getter\n       * combined jbrowse.assemblies, session.sessionAssemblies, and\n       * session.temporaryAssemblies\n       */\n      get assemblyList() {\n        const {\n          jbrowse: { assemblies },\n          session: { sessionAssemblies = [], temporaryAssemblies = [] } = {},\n        } = getParent<any>(self)\n        return [\n          ...assemblies,\n          ...sessionAssemblies,\n          ...temporaryAssemblies,\n        ] as AnyConfigurationModel[]\n      },\n\n      get rpcManager(): RpcManager {\n        return getParent<any>(self).rpcManager\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * use this method instead of assemblyManager.get(assemblyName) to get an\n       * assembly with regions loaded\n       */\n      async waitForAssembly(assemblyName: string) {\n        if (!assemblyName) {\n          throw new Error('no assembly name supplied to waitForAssembly')\n        }\n        let assembly = self.get(assemblyName)\n        if (!assembly) {\n          try {\n            await when(() => Boolean(self.get(assemblyName)), {\n              timeout: 10000,\n            })\n            assembly = self.get(assemblyName)\n          } catch (e) {\n            // ignore\n          }\n        }\n\n        if (!assembly) {\n          return undefined\n        }\n        await assembly.load()\n        await when(\n          () =>\n            !!(assembly.regions && assembly.refNameAliases) || !!assembly.error,\n        )\n        if (assembly.error) {\n          // eslint-disable-next-line @typescript-eslint/only-throw-error\n          throw assembly.error\n        }\n        return assembly\n      },\n\n      /**\n       * #method\n       */\n      async getRefNameMapForAdapter(\n        adapterConf: AdapterConf,\n        assemblyName: string | undefined,\n        opts: AssemblyBaseOpts,\n      ) {\n        if (assemblyName) {\n          const asm = await this.waitForAssembly(assemblyName)\n          return asm?.getRefNameMapForAdapter(adapterConf, opts)\n        }\n        return {}\n      },\n\n      /**\n       * #method\n       */\n      async getReverseRefNameMapForAdapter(\n        adapterConf: AdapterConf,\n        assemblyName: string | undefined,\n        opts: AssemblyBaseOpts,\n      ) {\n        if (assemblyName) {\n          const asm = await this.waitForAssembly(assemblyName)\n          return asm?.getReverseRefNameMapForAdapter(adapterConf, opts)\n        }\n        return {}\n      },\n\n      /**\n       * #method\n       */\n      isValidRefName(refName: string, assemblyName: string) {\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          return assembly.isValidRefName(refName)\n        }\n        throw new Error(\n          `Failed to look up refName:${refName} on assemblyName:${assemblyName} (assembly does not exist)`,\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          reaction(\n            () => self.assemblyList,\n            assemblyConfs => {\n              for (const asm of self.assemblies) {\n                if (!asm.configuration) {\n                  this.removeAssembly(asm)\n                }\n              }\n              for (const conf of assemblyConfs) {\n                const name = readConfObject(conf, 'name')\n                if (!self.assemblies.some(a => a.name === name)) {\n                  this.addAssembly(conf)\n                }\n              }\n            },\n            { fireImmediately: true, name: 'assemblyManagerAfterAttach' },\n          ),\n        )\n      },\n\n      /**\n       * #action\n       * private: you would generally want to add to manipulate\n       * jbrowse.assemblies, session.sessionAssemblies, or\n       * session.temporaryAssemblies instead of using this directly\n       */\n      removeAssembly(asm: Assembly) {\n        self.assemblies.remove(asm)\n      },\n\n      /**\n       * #action\n       * private: you would generally want to add to manipulate\n       * jbrowse.assemblies, session.sessionAssemblies, or\n       * session.temporaryAssemblies instead of using this directly\n       *\n       * this can take an active instance of an assembly, in which case it is\n       * referred to, or it can take an identifier e.g. assembly name, which is\n       * used as a reference. snapshots cannot be used\n       */\n      addAssembly(configuration: Conf) {\n        self.assemblies.push({ configuration })\n      },\n    }))\n}\n\nexport default assemblyManagerFactory\n","import { addDisposer, types } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type { BaseRootModel } from './BaseRootModel.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { UriLocation } from '@jbrowse/core/util'\nimport type { Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel InternetAccountsMixin\n * #category root\n */\nexport function InternetAccountsRootModelMixin(pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      internetAccounts: types.array(\n        pluginManager.pluggableMstType('internet account', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      initializeInternetAccount(\n        internetAccountConfig: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const internetAccountType = pluginManager.getInternetAccountType(\n          internetAccountConfig.type,\n        )\n        if (!internetAccountType) {\n          throw new Error(\n            `unknown internet account type ${internetAccountConfig.type}`,\n          )\n        }\n\n        const length = self.internetAccounts.push({\n          ...initialSnapshot,\n          type: internetAccountConfig.type,\n          configuration: internetAccountConfig,\n        })\n        return self.internetAccounts[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      createEphemeralInternetAccount(\n        internetAccountId: string,\n        initialSnapshot: Record<string, unknown>,\n        url: string,\n      ) {\n        let hostUri: string | undefined\n\n        try {\n          hostUri = new URL(url).origin\n        } catch (e) {\n          // ignore\n        }\n        const internetAccountSplit = internetAccountId.split('-')\n        const configuration = {\n          type: internetAccountSplit[0]!,\n          internetAccountId: internetAccountId,\n          name: internetAccountSplit.slice(1).join('-'),\n          description: '',\n          domains: hostUri ? [hostUri] : [],\n        }\n        const type = pluginManager.getInternetAccountType(configuration.type)!\n        const internetAccount = type.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n        self.internetAccounts.push(internetAccount)\n        return internetAccount\n      },\n      /**\n       * #action\n       */\n      findAppropriateInternetAccount(location: UriLocation) {\n        // find the existing account selected from menu\n        const selectedId = location.internetAccountId\n        if (selectedId) {\n          const selectedAccount = self.internetAccounts.find(account => {\n            return account.internetAccountId === selectedId\n          })\n          if (selectedAccount) {\n            return selectedAccount\n          }\n        }\n\n        // if no existing account or not found, try to find working account\n        for (const account of self.internetAccounts) {\n          const handleResult = account.handlesLocation(location)\n          if (handleResult) {\n            return account\n          }\n        }\n\n        // if still no existing account, create ephemeral config to use\n        return selectedId\n          ? this.createEphemeralInternetAccount(selectedId, {}, location.uri)\n          : null\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        addDisposer(\n          self,\n          autorun(\n            function internetAccountsAutorun() {\n              const { jbrowse } = self as typeof self & BaseRootModel\n              for (const internetAccount of jbrowse.internetAccounts) {\n                self.initializeInternetAccount(internetAccount)\n              }\n            },\n            { name: 'InternetAccounts' },\n          ),\n        )\n      },\n    }))\n}\n\nexport type RootModelWithInternetAccountsType = ReturnType<\n  typeof InternetAccountsRootModelMixin\n>\nexport type RootModelWithInternetAccounts =\n  Instance<RootModelWithInternetAccountsType>\n","import TimeTraveller from '@jbrowse/core/util/TimeTraveller'\nimport { addDisposer, types } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type { BaseRootModel } from '@jbrowse/product-core'\n\n/**\n * #stateModel HistoryManagementMixin\n * #category root\n */\nexport function HistoryManagementMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       * used for undo/redo\n       */\n      history: types.optional(TimeTraveller, { targetPath: '../session' }),\n    })\n    .actions(self => {\n      const keydownListener = (e: KeyboardEvent) => {\n        if (\n          self.history.canRedo &&\n          // ctrl+shift+z or cmd+shift+z\n          (((e.ctrlKey || e.metaKey) && e.shiftKey && e.code === 'KeyZ') ||\n            // ctrl+y\n            (e.ctrlKey && !e.shiftKey && e.code === 'KeyY')) &&\n          document.activeElement?.tagName.toUpperCase() !== 'INPUT'\n        ) {\n          self.history.redo()\n        }\n        if (\n          self.history.canUndo &&\n          // ctrl+z or cmd+z\n          (e.ctrlKey || e.metaKey) &&\n          !e.shiftKey &&\n          e.code === 'KeyZ' &&\n          document.activeElement?.tagName.toUpperCase() !== 'INPUT'\n        ) {\n          self.history.undo()\n        }\n      }\n      return {\n        afterCreate() {\n          document.addEventListener('keydown', keydownListener)\n          addDisposer(\n            self,\n            autorun(\n              function historyInitAutorun() {\n                const { session } = self as typeof self & BaseRootModel\n                if (session) {\n                  // we use a specific initialization routine after session is\n                  // created to get it to start tracking itself sort of related\n                  // issue here\n                  // https://github.com/mobxjs/mobx-state-tree/issues/1089#issuecomment-441207911\n                  self.history.initialize()\n                }\n              },\n              { name: 'HistoryInit' },\n            ),\n          )\n        },\n        beforeDestroy() {\n          document.removeEventListener('keydown', keydownListener)\n        },\n      }\n    })\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport type { Menu, MenuAction } from '../menus.ts'\nimport type { MenuItem } from '@jbrowse/core/ui/Menu'\n\n/**\n * #stateModel RootAppMenuMixin\n */\nexport function RootAppMenuMixin() {\n  return types\n    .model({})\n    .volatile(() => ({\n      mutableMenuActions: [] as MenuAction[],\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setMenus(newMenus: Menu[]) {\n        self.mutableMenuActions = [\n          ...self.mutableMenuActions,\n          { type: 'setMenus', newMenus },\n        ]\n      },\n      /**\n       * #action\n       * Add a top-level menu\n       *\n       * @param menuName - Name of the menu to insert.\n       *\n       */\n      appendMenu(menuName: string) {\n        self.mutableMenuActions = [\n          ...self.mutableMenuActions,\n          { type: 'appendMenu', menuName },\n        ]\n      },\n      /**\n       * #action\n       * Insert a top-level menu\n       *\n       * @param menuName - Name of the menu to insert.\n       *\n       * @param position - Position to insert menu. If negative, counts from th\n       * end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the\n       * second-to-last one.\n       *\n       */\n      insertMenu(menuName: string, position: number) {\n        self.mutableMenuActions = [\n          ...self.mutableMenuActions,\n          {\n            type: 'insertMenu',\n            menuName,\n            position,\n          },\n        ]\n      },\n      /**\n       * #action\n       * Add a menu item to a top-level menu\n       *\n       * @param menuName - Name of the top-level menu to append to.\n       *\n       * @param menuItem - Menu item to append.\n       */\n      appendToMenu(menuName: string, menuItem: MenuItem) {\n        self.mutableMenuActions = [\n          ...self.mutableMenuActions,\n          {\n            type: 'appendToMenu',\n            menuName,\n            menuItem,\n          },\n        ]\n      },\n      /**\n       * #action\n       * Insert a menu item into a top-level menu\n       *\n       * @param menuName - Name of the top-level menu to insert into\n       *\n       * @param menuItem - Menu item to insert\n       *\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       */\n      insertInMenu(menuName: string, menuItem: MenuItem, position: number) {\n        self.mutableMenuActions.push({\n          type: 'insertInMenu',\n          menuName,\n          menuItem,\n          position,\n        })\n      },\n      /**\n       * #action\n       * Add a menu item to a sub-menu\n       *\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       *\n       * @param menuItem - Menu item to append.\n       *\n       * @returns The new length of the sub-menu\n       */\n      appendToSubMenu(menuPath: string[], menuItem: MenuItem) {\n        self.mutableMenuActions = [\n          ...self.mutableMenuActions,\n          {\n            type: 'appendToSubMenu',\n            menuPath,\n            menuItem,\n          },\n        ]\n      },\n      /**\n       * #action\n       * Insert a menu item into a sub-menu\n       *\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       *\n       * @param menuItem - Menu item to insert.\n       *\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       */\n      insertInSubMenu(\n        menuPath: string[],\n        menuItem: MenuItem,\n        position: number,\n      ) {\n        self.mutableMenuActions = [\n          ...self.mutableMenuActions,\n          {\n            type: 'insertInSubMenu',\n            menuPath,\n            menuItem,\n            position,\n          },\n        ]\n      },\n    }))\n}\n","import { lazy } from 'react'\n\nimport { types } from '@jbrowse/mobx-state-tree'\nimport { observable } from 'mobx'\n\nimport type { NotificationLevel, SnackAction } from '../util/types/index.ts'\n\n// lazies\nconst ErrorMessageStackTraceDialog = lazy(\n  () => import('./ErrorMessageStackTraceDialog.tsx'),\n)\n\nexport interface SnackbarMessage {\n  message: string\n  level?: NotificationLevel\n  actions?: SnackAction[]\n}\n\n/**\n * #stateModel SnackbarModel\n * #category session\n */\nexport default function SnackbarModel() {\n  return types\n    .model({})\n    .volatile(() => ({\n      /**\n       * #volatile\n       */\n      snackbarMessages: observable.array<SnackbarMessage>(),\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get snackbarMessageSet() {\n        return new Map(self.snackbarMessages.map(s => [s.message, s]))\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      notify(\n        message: string,\n        level?: NotificationLevel,\n        action?: SnackAction | SnackAction[],\n      ) {\n        const actions = action\n          ? Array.isArray(action)\n            ? action\n            : [action]\n          : undefined\n        this.pushSnackbarMessage(message, level, actions)\n        if (level === 'info' || level === 'success') {\n          setTimeout(() => {\n            this.removeSnackbarMessage(message)\n          }, 5000)\n        }\n      },\n\n      /**\n       * #action\n       */\n      notifyError(\n        errorMessage: string,\n        error?: unknown,\n        extra?: unknown,\n        action?: SnackAction,\n      ) {\n        const reportAction: SnackAction = {\n          name: 'report',\n          onClick: () => {\n            // @ts-expect-error\n            self.queueDialog((onClose: () => void) => [\n              ErrorMessageStackTraceDialog,\n              {\n                onClose,\n                error,\n                extra,\n              },\n            ])\n          },\n        }\n        const actions = action ? [reportAction, action] : [reportAction]\n        this.pushSnackbarMessage(errorMessage, 'error', actions)\n      },\n      /**\n       * #action\n       */\n      pushSnackbarMessage(\n        message: string,\n        level?: NotificationLevel,\n        actions?: SnackAction[],\n      ) {\n        if (actions?.length || !self.snackbarMessageSet.has(message)) {\n          self.snackbarMessages.push({\n            message,\n            level,\n            actions,\n          })\n        }\n      },\n      /**\n       * #action\n       */\n      popSnackbarMessage() {\n        return self.snackbarMessages.pop()\n      },\n      /**\n       * #action\n       */\n      removeSnackbarMessage(message: string) {\n        const element = self.snackbarMessageSet.get(message)\n        if (element !== undefined) {\n          self.snackbarMessages.remove(element)\n        }\n      },\n    }))\n}\n","/** MST props, views, actions, etc related to managing connections */\n\nimport {\n  getContainingView,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport {\n  getMembers,\n  getParent,\n  getSnapshot,\n  getType,\n  isModelType,\n  isReferenceType,\n  types,\n  walk,\n} from '@jbrowse/mobx-state-tree'\n\nimport { isBaseSession } from './BaseSession.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport type { TrackViewModel } from '@jbrowse/core/util'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\nexport interface ReferringNode {\n  node: IAnyStateTreeNode\n  key: string\n}\n\n/**\n * #stateModel ReferenceManagementSessionMixin\n */\nexport function ReferenceManagementSessionMixin(_pluginManager: PluginManager) {\n  return types\n    .model('ReferenceManagementSessionMixin', {})\n    .views(self => ({\n      /**\n       * #method\n       * See if any MST nodes currently have a types.reference to this object.\n       *\n       * @param object - object\n       * @returns An array where the first element is the node referring\n       * to the object and the second element is they property name the node is\n       * using to refer to the object\n       */\n      getReferring(object: IAnyStateTreeNode) {\n        const refs: ReferringNode[] = []\n        // For frozen tracks, compare by trackId instead of object identity\n        const targetTrackId = (object as { trackId?: string }).trackId\n        walk(getParent(self), node => {\n          if (isModelType(getType(node))) {\n            const members = getMembers(node)\n            for (const [key, value] of Object.entries(members.properties)) {\n              if (isReferenceType(value)) {\n                const ref = node[key]\n                // Compare by trackId for track configurations, fall back to identity\n                const refTrackId = ref?.trackId\n                if (\n                  ref === object ||\n                  (targetTrackId && refTrackId && refTrackId === targetTrackId)\n                ) {\n                  refs.push({ node, key })\n                }\n              }\n            }\n          }\n        })\n        return refs\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      removeReferring(\n        referring: ReferringNode[],\n        track: BaseTrackConfig,\n        callbacks: ((arg: string) => void)[],\n        dereferenceTypeCount: Record<string, number>,\n      ) {\n        for (const { node } of referring) {\n          let dereferenced = false\n          try {\n            // If a view is referring to the track config, remove the track\n            // from the view\n            const type = 'open track(s)'\n            const view = getContainingView(node) as TrackViewModel\n            callbacks.push(() => {\n              view.hideTrack(track.trackId)\n            })\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          } catch (err1) {\n            // ignore\n          }\n\n          if (isSessionModelWithWidgets(self) && self.widgets.has(node.id)) {\n            // If a configuration editor widget has the track config\n            // open, close the widget\n            const type = 'configuration editor widget(s)'\n            if (isSessionModelWithWidgets(self)) {\n              callbacks.push(() => {\n                self.hideWidget(node)\n              })\n            }\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          }\n          if (!dereferenced) {\n            throw new Error(\n              `Error when closing this connection, the following node is still referring to a track configuration: ${JSON.stringify(\n                getSnapshot(node),\n              )}`,\n            )\n          }\n        }\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that manages multiple views */\nexport type SessionWithReferenceManagementType = ReturnType<\n  typeof ReferenceManagementSessionMixin\n>\n\n/** Instance of a session with MST reference management (`getReferring()`, `removeReferring()`)  */\nexport type SessionWithReferenceManagement =\n  Instance<SessionWithReferenceManagementType>\n\n/** Type guard for SessionWithReferenceManagement */\nexport function isSessionWithReferenceManagement(\n  thing: IAnyStateTreeNode,\n): thing is SessionWithReferenceManagement {\n  return (\n    isBaseSession(thing) &&\n    'getReferring' in thing &&\n    typeof thing.getReferring === 'function' &&\n    'removeReferring' in thing &&\n    typeof thing.removeReferring === 'function'\n  )\n}\n","import { lazy } from 'react'\n\nimport {\n  AppFocusMixin,\n  DockviewLayoutMixin,\n  SessionAssembliesMixin,\n  TemporaryAssembliesMixin,\n} from '@jbrowse/app-core'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport SnackbarModel from '@jbrowse/core/ui/SnackbarModel'\nimport { localStorageGetItem, localStorageSetItem } from '@jbrowse/core/util'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  getSnapshot,\n  isStateTreeNode,\n  types,\n} from '@jbrowse/mobx-state-tree'\nimport {\n  DialogQueueSessionMixin,\n  DrawerWidgetSessionMixin,\n  MultipleViewsSessionMixin,\n  ReferenceManagementSessionMixin,\n  SessionTracksManagerSessionMixin,\n  ThemeManagerSessionMixin,\n} from '@jbrowse/product-core'\nimport DeleteIcon from '@mui/icons-material/Delete'\nimport CopyIcon from '@mui/icons-material/FileCopy'\nimport InfoIcon from '@mui/icons-material/Info'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport { autorun } from 'mobx'\n\nimport { WebSessionConnectionsMixin } from '../SessionConnections.ts'\n\nimport type { Menu } from '@jbrowse/app-core'\nimport type { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\nimport type { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport type {\n  AnyConfiguration,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport type { BaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport type { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\nimport type { MenuItem } from '@jbrowse/core/ui'\nimport type { AssemblyManager } from '@jbrowse/core/util/types'\nimport type { Instance, SnapshotIn } from '@jbrowse/mobx-state-tree'\n\n// lazies\nconst AboutDialog = lazy(() => import('./AboutDialog.tsx'))\n\ninterface Display {\n  displayId: string\n}\n\n/**\n * #stateModel BaseWebSession\n * used for \"web based\" products, including jbrowse-web and react-app\n * composed of\n * - [ReferenceManagementSessionMixin](../referencemanagementsessionmixin)\n * - [DrawerWidgetSessionMixin](../drawerwidgetsessionmixin)\n * - [DialogQueueSessionMixin](../dialogqueuesessionmixin)\n * - [ThemeManagerSessionMixin](../thememanagersessionmixin)\n * - [MultipleViewsSessionMixin](../multipleviewssessionmixin)\n * - [SessionTracksManagerSessionMixin](../sessiontracksmanagersessionmixin)\n * - [SessionAssembliesMixin](../sessionassembliesmixin)\n * - [TemporaryAssembliesMixin](../temporaryassembliesmixin)\n * - [WebSessionConnectionsMixin](../websessionconnectionsmixin)\n * - [AppFocusMixin](../appfocusmixin)\n */\nexport function BaseWebSession({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  const sessionModel = types\n    .compose(\n      'WebCoreSessionModel',\n      types.compose(\n        'WebCoreSessionModelGroupA',\n        ReferenceManagementSessionMixin(pluginManager),\n        DrawerWidgetSessionMixin(pluginManager),\n        DialogQueueSessionMixin(pluginManager),\n        ThemeManagerSessionMixin(pluginManager),\n        MultipleViewsSessionMixin(pluginManager),\n      ),\n      types.compose(\n        'WebCoreSessionModelGroupB',\n        SessionTracksManagerSessionMixin(pluginManager),\n        SessionAssembliesMixin(pluginManager, assemblyConfigSchema),\n        TemporaryAssembliesMixin(pluginManager, assemblyConfigSchema),\n        WebSessionConnectionsMixin(pluginManager),\n        DockviewLayoutMixin(),\n        AppFocusMixin(),\n        SnackbarModel(),\n      ),\n    )\n    .props({\n      /**\n       * #property\n       */\n      margin: 0,\n      /**\n       * #property\n       */\n      sessionPlugins: types.array(\n        types.frozen<PluginDefinition & { name: string }>(),\n      ),\n    })\n    .volatile((/* self */) => ({\n      /**\n       * #volatile\n       */\n      sessionThemeName: localStorageGetItem('themeName') || 'default',\n      /**\n       * #volatile\n       * this is the current \"task\" that is being performed in the UI. this is\n       * usually an object of the form\n       *\n       * `{ taskName: \"configure\", target: thing_being_configured }`\n       */\n      task: undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get tracks(): AnyConfigurationModel[] {\n        return [...self.sessionTracks, ...self.jbrowse.tracks]\n      },\n      /**\n       * #getter\n       */\n      get root() {\n        return getParent<any>(self)\n      },\n      /**\n       * #getter\n       * list of sessionAssemblies and jbrowse config assemblies, does not\n       * include temporaryAssemblies. basically the list to be displayed in a\n       * AssemblySelector dropdown\n       */\n      get assemblies(): (Instance<BaseAssemblyConfigSchema> & {\n        sequence: { trackId: string }\n      })[] {\n        return [...self.jbrowse.assemblies, ...self.sessionAssemblies]\n      },\n      /**\n       * #getter\n       * list of config connections and session connections\n       */\n      get connections(): BaseConnectionConfigModel[] {\n        return [...self.jbrowse.connections, ...self.sessionConnections]\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setName(str: string) {\n        self.name = str\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       * list of sessionAssemblies and jbrowse config assemblies, does not\n       * include temporaryAssemblies. basically the list to be displayed in a\n       * AssemblySelector dropdown\n       */\n      get assemblyNames() {\n        return self.assemblies.map(f => readConfObject(f, 'name') as string)\n      },\n      /**\n       * #getter\n       */\n      get version() {\n        return self.root.version\n      },\n      /**\n       * #getter\n       */\n      get shareURL() {\n        return getConf(self.jbrowse, 'shareURL')\n      },\n      /**\n       * #getter\n       */\n      get textSearchManager(): TextSearchManager {\n        return self.root.textSearchManager\n      },\n      /**\n       * #getter\n       */\n      get assemblyManager(): AssemblyManager {\n        return self.root.assemblyManager\n      },\n      /**\n       * #getter\n       */\n      get savedSessionMetadata() {\n        return self.root.savedSessionMetadata\n      },\n      /**\n       * #getter\n       */\n      get previousAutosaveId() {\n        return self.root.previousAutosaveId\n      },\n\n      /**\n       * #getter\n       */\n      get history() {\n        return self.root.history\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          theme: self.theme,\n          highResolutionScaling: getConf(self, 'highResolutionScaling'),\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addAssemblyConf(conf: AnyConfiguration) {\n        self.jbrowse.addAssemblyConf(conf)\n      },\n      /**\n       * #action\n       */\n      addSessionPlugin(plugin: PluginDefinition & { name: string }) {\n        if (self.sessionPlugins.some(p => p.name === plugin.name)) {\n          throw new Error('session plugin cannot be installed twice')\n        }\n        self.sessionPlugins.push(plugin)\n        self.root.setPluginsUpdated(true)\n      },\n\n      /**\n       * #action\n       */\n      removeSessionPlugin(pluginDefinition: PluginDefinition) {\n        type PluginUrls = Partial<{\n          url: string\n          umdUrl: string\n          cjsUrl: string\n          esmUrl: string\n        }>\n        const def = pluginDefinition as PluginUrls\n        self.sessionPlugins = cast(\n          self.sessionPlugins.filter(plugin => {\n            const p = plugin as PluginUrls\n            return (\n              p.url !== def.url ||\n              p.umdUrl !== def.umdUrl ||\n              p.cjsUrl !== def.cjsUrl ||\n              p.esmUrl !== def.esmUrl\n            )\n          }),\n        )\n        getParent<any>(self).setPluginsUpdated(true)\n      },\n\n      /**\n       * #action\n       */\n      addSavedSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return self.root.addSavedSession(sessionSnapshot)\n      },\n\n      /**\n       * #action\n       */\n      deleteSavedSession(id: string) {\n        return self.root.deleteSavedSession(id)\n      },\n\n      /**\n       * #action\n       */\n      favoriteSavedSession(id: string) {\n        return self.root.favoriteSavedSession(id)\n      },\n\n      /**\n       * #action\n       */\n      unfavoriteSavedSession(id: string) {\n        return self.root.unfavoriteSavedSession(id)\n      },\n      /**\n       * #action\n       */\n      renameCurrentSession(sessionName: string) {\n        return self.root.renameCurrentSession(sessionName)\n      },\n\n      /**\n       * #action\n       */\n      duplicateCurrentSession() {\n        return self.root.duplicateCurrentSession()\n      },\n      /**\n       * #action\n       */\n      activateSession(sessionName: string) {\n        return self.root.activateSession(sessionName)\n      },\n\n      /**\n       * #action\n       */\n      setDefaultSession() {\n        return self.root.setDefaultSession()\n      },\n\n      /**\n       * #action\n       */\n      saveSessionToLocalStorage() {\n        return self.root.saveSessionToLocalStorage()\n      },\n\n      /**\n       * #action\n       */\n      loadAutosaveSession() {\n        return self.root.loadAutosaveSession()\n      },\n\n      /**\n       * #action\n       */\n      setSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return self.root.setSession(sessionSnapshot)\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      editTrackConfiguration(\n        configuration: AnyConfigurationModel | { trackId: string },\n      ) {\n        const { adminMode, sessionTracks } = self\n        const trackId = configuration.trackId\n        const isSessionTrack = sessionTracks.some(t => t.trackId === trackId)\n        if (!adminMode && !isSessionTrack) {\n          throw new Error(\"Can't edit the configuration of a non-session track\")\n        }\n        self.editConfiguration(configuration)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * raw track actions (Settings, Copy, Delete) without submenu wrapper\n       */\n      getTrackActions(config: BaseTrackConfig): MenuItem[] {\n        const { adminMode, sessionTracks } = self\n        const canEdit =\n          adminMode || sessionTracks.find(t => t.trackId === config.trackId)\n        const isRefSeq = config.type === 'ReferenceSequenceTrack'\n        return [\n          {\n            label: 'Settings',\n            disabled: !canEdit,\n            icon: SettingsIcon,\n            onClick: () => {\n              self.editTrackConfiguration(config)\n            },\n          },\n          {\n            label: 'Copy track',\n            disabled: isRefSeq,\n            onClick: () => {\n              const snap = structuredClone(\n                isStateTreeNode(config) ? getSnapshot(config) : config,\n              ) as {\n                [key: string]: unknown\n                displays?: Display[]\n              }\n              const now = Date.now()\n              snap.trackId += `-${now}`\n              if (snap.displays) {\n                for (const display of snap.displays) {\n                  display.displayId += `-${now}`\n                }\n              }\n              // the -sessionTrack suffix to trackId is used as metadata for\n              // the track selector to store the track in a special category,\n              // and default category is also cleared\n              if (!self.adminMode) {\n                snap.trackId += '-sessionTrack'\n                snap.category = undefined\n              }\n              snap.name += ' (copy)'\n              self.addTrackConf(snap)\n            },\n            icon: CopyIcon,\n          },\n          {\n            label: 'Delete track',\n            disabled: !canEdit || isRefSeq,\n            icon: DeleteIcon,\n            onClick: () => {\n              self.deleteTrackConf(config)\n            },\n          },\n        ]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * flattened menu items for use in hierarchical track selector\n       */\n      getTrackListMenuItems(config: BaseTrackConfig): MenuItem[] {\n        return [\n          {\n            label: 'About track',\n            onClick: () => {\n              self.queueDialog(handleClose => [\n                AboutDialog,\n                {\n                  config,\n                  handleClose,\n                  session: self,\n                },\n              ])\n            },\n            icon: InfoIcon,\n          },\n          ...self.getTrackActions(config),\n        ]\n      },\n\n      /**\n       * #method\n       * @param config - track configuration\n       * @param extraTrackActions - additional items to merge into \"Track actions\" submenu\n       */\n      getTrackActionMenuItems(\n        config: BaseTrackConfig,\n        extraTrackActions?: MenuItem[],\n      ): MenuItem[] {\n        return [\n          {\n            label: 'About track',\n            priority: 1002,\n            onClick: () => {\n              self.queueDialog(handleClose => [\n                AboutDialog,\n                {\n                  config,\n                  handleClose,\n                  session: self,\n                },\n              ])\n            },\n            icon: InfoIcon,\n          },\n          {\n            type: 'subMenu' as const,\n            label: 'Track actions',\n            priority: 1001,\n            subMenu: [\n              ...self.getTrackActions(config),\n              ...(extraTrackActions || []),\n            ],\n          },\n          { type: 'divider' as const },\n        ]\n      },\n\n      /**\n       * #method\n       */\n      menus(): Menu[] {\n        return self.root.menus()\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            function sessionLocalStorageAutorun() {\n              localStorageSetItem('drawerPosition', self.drawerPosition)\n              localStorageSetItem('themeName', self.themeName)\n            },\n            { name: 'SessionLocalStorage' },\n          ),\n        )\n      },\n    }))\n\n  const extendedSessionModel = pluginManager.evaluateExtensionPoint(\n    'Core-extendSession',\n    sessionModel,\n  ) as typeof sessionModel\n\n  return types.snapshotProcessor(extendedSessionModel, {\n    preProcessor(\n      snapshot: SnapshotIn<typeof extendedSessionModel> & {\n        connectionInstances?: unknown\n      },\n    ) {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      const { connectionInstances, ...rest } = snapshot || {}\n\n      // connectionInstances schema changed from object to an array, so any old\n      // connectionInstances as object is in snapshot, filter it out\n      // xref https://github.com/GMOD/jbrowse-components/issues/1903\n      return !Array.isArray(connectionInstances) ? rest : snapshot\n    },\n  })\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport { isBaseSession } from './BaseSession.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { DialogComponentType } from '@jbrowse/core/util'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel DialogQueueSessionMixin\n */\nexport function DialogQueueSessionMixin(_pluginManager: PluginManager) {\n  return types\n    .model('DialogQueueSessionMixin', {})\n    .volatile(() => ({\n      queueOfDialogs: [] as [DialogComponentType, unknown][],\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get DialogComponent() {\n        return self.queueOfDialogs[0]?.[0]\n      },\n      /**\n       * #getter\n       */\n      get DialogProps() {\n        return self.queueOfDialogs[0]?.[1]\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      removeActiveDialog() {\n        self.queueOfDialogs = self.queueOfDialogs.slice(1)\n      },\n      /**\n       * #action\n       */\n      queueDialog(\n        cb: (doneCallback: () => void) => [DialogComponentType, unknown],\n      ) {\n        const [component, props] = cb(() => {\n          this.removeActiveDialog()\n        })\n        self.queueOfDialogs = [...self.queueOfDialogs, [component, props]]\n      },\n    }))\n}\n\nexport type SessionWithDialogsType = ReturnType<typeof DialogQueueSessionMixin>\nexport type SessionWithDialogs = Instance<SessionWithDialogsType>\n\nexport function isSessionWithDialogs(\n  session: IAnyStateTreeNode,\n): session is SessionWithDialogs {\n  return isBaseSession(session) && 'queueOfDialogs' in session\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { createJBrowseTheme, defaultThemes } from '@jbrowse/core/ui'\nimport { localStorageGetItem, localStorageSetItem } from '@jbrowse/core/util'\nimport { addDisposer, types } from '@jbrowse/mobx-state-tree'\nimport { autorun } from 'mobx'\n\nimport type { BaseSession } from './BaseSession.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\nimport type { ThemeOptions } from '@mui/material'\n\ntype ThemeMap = Record<string, ThemeOptions>\n\n/**\n * #stateModel ThemeManagerSessionMixin\n */\nexport function ThemeManagerSessionMixin(_pluginManager: PluginManager) {\n  return types\n    .model({})\n    .volatile(() => ({\n      sessionThemeName: localStorageGetItem('themeName') || 'default',\n    }))\n    .views(s => ({\n      /**\n       * #method\n       */\n      allThemes(): ThemeMap {\n        const self = s as typeof s & BaseSession\n        const extraThemes = getConf(self.jbrowse, 'extraThemes')\n        return { ...defaultThemes, ...extraThemes }\n      },\n      /**\n       * #getter\n       */\n      get themeName() {\n        const { sessionThemeName } = s\n        const all = this.allThemes()\n        return all[sessionThemeName] ? sessionThemeName : 'default'\n      },\n      /**\n       * #getter\n       */\n      get theme() {\n        const self = s as typeof s & BaseSession\n        const configTheme = getConf(self.jbrowse, 'theme')\n        const all = this.allThemes()\n        return createJBrowseTheme(configTheme, all, this.themeName)\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setThemeName(name: string) {\n        self.sessionThemeName = name\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            function themeNameAutorun() {\n              localStorageSetItem('themeName', self.themeName)\n            },\n            { name: 'ThemeName' },\n          ),\n        )\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that supports theming */\nexport type SessionWithThemesType = ReturnType<typeof ThemeManagerSessionMixin>\n\n/** Instance of a session that has theming support */\nexport type SessionWithThemes = Instance<SessionWithThemesType>\n\n/** Type guard for SessionWithThemes */\nexport function isSessionWithThemes(\n  session: IAnyStateTreeNode,\n): session is SessionWithThemes {\n  return 'theme' in session\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport { isBaseSession } from './BaseSession.ts'\nimport { TracksManagerSessionMixin } from './Tracks.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AnyConfiguration,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel SessionTracksManagerSessionMixin\n */\nexport function SessionTracksManagerSessionMixin(pluginManager: PluginManager) {\n  return TracksManagerSessionMixin(pluginManager)\n    .named('SessionTracksManagerSessionMixin')\n    .props({\n      /**\n       * #property\n       */\n      sessionTracks: types.array(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get tracks(): AnyConfigurationModel[] {\n        return [...self.sessionTracks, ...self.jbrowse.tracks]\n      },\n    }))\n    .actions(self => {\n      const {\n        addTrackConf: superAddTrackConf,\n        deleteTrackConf: superDeleteTrackConf,\n      } = self\n      return {\n        /**\n         * #action\n         */\n        addTrackConf(trackConf: AnyConfiguration) {\n          if (self.adminMode) {\n            return superAddTrackConf(trackConf)\n          }\n\n          const { trackId, type } = trackConf as {\n            type: string\n            trackId: string\n          }\n          if (!type) {\n            throw new Error(`unknown track type ${type}`)\n          }\n          const track = self.sessionTracks.find(t => t.trackId === trackId)\n          if (track) {\n            return track\n          }\n          const length = self.sessionTracks.push(trackConf)\n          return self.sessionTracks[length - 1]\n        },\n\n        /**\n         * #action\n         */\n        deleteTrackConf(trackConf: AnyConfigurationModel) {\n          // try to delete it in the main config if in admin mode\n          const found = superDeleteTrackConf(trackConf)\n          if (found) {\n            return found\n          }\n          // if not found or not in admin mode, try to delete it in the\n          // sessionTracks\n          const { trackId } = trackConf\n          const idx = self.sessionTracks.findIndex(t => t.trackId === trackId)\n          if (idx === -1) {\n            return undefined\n          }\n          return self.sessionTracks.splice(idx, 1)\n        },\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { sessionTracks, ...rest } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        // mst types wrong, nullish needed\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        ...(sessionTracks?.length ? { sessionTracks } : {}),\n      } as typeof snap\n    })\n}\n\n/** Session mixin MST type for a session that has `sessionTracks` */\nexport type SessionWithSessionTracksType = ReturnType<\n  typeof SessionTracksManagerSessionMixin\n>\n\n/** Instance of a session that has `sessionTracks` */\nexport type SessionWithSessionTracks = Instance<SessionWithSessionTracksType>\n\n/** Type guard for SessionWithSessionTracks */\nexport function isSessionWithSessionTracks(\n  thing: IAnyStateTreeNode,\n): thing is SessionWithSessionTracks {\n  return isBaseSession(thing) && 'sessionTracks' in thing\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport { BaseSessionModel, isBaseSession } from './BaseSession.ts'\nimport { ReferenceManagementSessionMixin } from './ReferenceManagement.ts'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type {\n  AnyConfiguration,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport type { IAnyStateTreeNode, Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel TracksManagerSessionMixin\n * composed of\n * - BaseSessionModel\n * - ReferenceManagementSessionMixin\n */\nexport function TracksManagerSessionMixin(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'TracksManagerSessionMixin',\n      BaseSessionModel(pluginManager),\n      ReferenceManagementSessionMixin(pluginManager),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get tracks(): AnyConfigurationModel[] {\n        return self.jbrowse.tracks\n      },\n\n      /**\n       * #getter\n       * Base assemblies from jbrowse config. Child sessions can override\n       * to include additional assemblies (e.g. sessionAssemblies).\n       */\n      get assemblies(): { sequence: { trackId: string } }[] {\n        return self.jbrowse.assemblies\n      },\n\n      /**\n       * #method\n       * Method to get tracks by ID. Includes tracks from connections if present.\n       */\n      getTracksById(): Record<string, AnyConfigurationModel> {\n        const temporaryAssemblies =\n          'temporaryAssemblies' in self\n            ? (self.temporaryAssemblies as { sequence: { trackId: string } }[])\n            : []\n\n        const connectionInstances =\n          'connectionInstances' in self\n            ? (self.connectionInstances as {\n                tracks: AnyConfigurationModel[]\n              }[])\n            : []\n\n        return Object.fromEntries([\n          ...this.tracks.map(t => [t.trackId, t]),\n          // Include assembly sequence tracks so they can be resolved by trackId\n          ...this.assemblies.map(a => [a.sequence.trackId, a.sequence]),\n          // Include temporary assembly sequence tracks\n          ...temporaryAssemblies.map(a => [a.sequence.trackId, a.sequence]),\n          // Include connection tracks\n          ...connectionInstances.flatMap(c =>\n            c.tracks.map(t => [t.trackId, t]),\n          ),\n        ])\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: AnyConfiguration) {\n        return self.jbrowse.addTrackConf(trackConf)\n      },\n\n      /**\n       * #action\n       */\n      deleteTrackConf(trackConf: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: (() => void)[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const referring = self.getReferring(trackConf)\n        self.removeReferring(\n          referring,\n          trackConf,\n          callbacksToDereferenceTrack,\n          dereferenceTypeCount,\n        )\n        for (const cb of callbacksToDereferenceTrack) {\n          cb()\n        }\n        if (self.adminMode) {\n          return self.jbrowse.deleteTrackConf(trackConf)\n        }\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that has tracks */\nexport type SessionWithTracksType = ReturnType<typeof TracksManagerSessionMixin>\n\n/** Instance of a session that has tracks */\nexport type SessionWithTracks = Instance<SessionWithTracksType>\n\n/** Type guard for SessionWithTracks */\nexport function isSessionWithTracks(\n  thing: IAnyStateTreeNode,\n): thing is SessionWithTracks {\n  return isBaseSession(thing) && 'tracks' in thing\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport type { AnyConfiguration } from '@jbrowse/core/configuration'\nimport type { BaseSession } from '@jbrowse/product-core'\n\n/**\n * #stateModel SessionAssembliesMixin\n * #category root\n */\nexport function SessionAssembliesMixin(\n  pluginManager: PluginManager,\n  assemblyConfigSchemasType: BaseAssemblyConfigSchema,\n) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      sessionAssemblies: types.array(assemblyConfigSchemasType),\n    })\n    .actions(s => {\n      const self = s as typeof s & BaseSession\n      return {\n        /**\n         * #action\n         */\n        addSessionAssembly(conf: AnyConfiguration) {\n          const asm = self.sessionAssemblies.find(f => f.name === conf.name)\n          if (asm) {\n            console.warn(`Assembly ${conf.name} already exists`)\n            return asm\n          }\n          const length = self.sessionAssemblies.push(conf)\n          return self.sessionAssemblies[length - 1]\n        },\n\n        /**\n         * #action\n         */\n        addAssembly(conf: AnyConfiguration) {\n          if (self.adminMode) {\n            self.jbrowse.addAssemblyConf(conf)\n          } else {\n            this.addSessionAssembly(conf)\n          }\n        },\n\n        /**\n         * #action\n         */\n        removeAssembly(name: string) {\n          if (self.adminMode) {\n            self.jbrowse.removeAssemblyConf(name)\n          } else {\n            this.removeSessionAssembly(name)\n          }\n        },\n\n        /**\n         * #action\n         */\n        removeSessionAssembly(assemblyName: string) {\n          const elt = self.sessionAssemblies.find(a => a.name === assemblyName)\n          if (elt) {\n            self.sessionAssemblies.remove(elt)\n          }\n        },\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { sessionAssemblies, ...rest } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        ...(sessionAssemblies.length ? { sessionAssemblies } : {}),\n      } as typeof snap\n    })\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfiguration } from '@jbrowse/core/configuration'\nimport type { BaseSession } from '@jbrowse/product-core'\n\n/**\n * #stateModel TemporaryAssembliesMixin\n * #category root\n */\nexport function TemporaryAssembliesMixin(\n  pluginManager: PluginManager,\n  assemblyConfigSchemasType = types.frozen(),\n) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      temporaryAssemblies: types.array(assemblyConfigSchemasType),\n    })\n\n    .actions(s => {\n      const self = s as typeof s & BaseSession\n      return {\n        /**\n         * #action\n         * used for read vs ref type assemblies.\n         */\n        addTemporaryAssembly(conf: AnyConfiguration) {\n          const asm = self.temporaryAssemblies.find(f => f.name === conf.name)\n          if (asm) {\n            console.warn(`Assembly ${conf.name} was already existing`)\n            return asm\n          }\n          const length = self.temporaryAssemblies.push(conf)\n          return self.temporaryAssemblies[length - 1]\n        },\n\n        /**\n         * #action\n         */\n        removeTemporaryAssembly(name: string) {\n          const elt = self.temporaryAssemblies.find(a => a.name === name)\n          if (elt) {\n            self.temporaryAssemblies.remove(elt)\n          }\n        },\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { temporaryAssemblies, ...rest } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        ...(temporaryAssemblies.length ? { temporaryAssemblies } : {}),\n      } as typeof snap\n    })\n}\n","import { types } from '@jbrowse/mobx-state-tree'\nimport { ConnectionManagementSessionMixin } from '@jbrowse/product-core'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\nimport type {\n  BaseSession,\n  SessionWithSessionTracks,\n} from '@jbrowse/product-core'\n\n/**\n * #stateModel WebSessionConnectionsMixin\n * #category session\n */\nexport function WebSessionConnectionsMixin(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'SessionConnectionsManagement',\n      ConnectionManagementSessionMixin(pluginManager),\n      types.model({\n        /**\n         * #property\n         */\n        sessionConnections: types.array(\n          pluginManager.pluggableConfigSchemaType('connection'),\n        ),\n      }),\n    )\n    .actions(s => {\n      const self = s as typeof s & BaseSession & SessionWithSessionTracks\n      const superDeleteConnection = self.deleteConnection\n      const superAddConnectionConf = self.addConnectionConf\n      return {\n        /**\n         * #action\n         */\n        addConnectionConf(connectionConf: BaseConnectionConfigModel) {\n          if (self.adminMode) {\n            return superAddConnectionConf(connectionConf)\n          } else {\n            const { connectionId, type } = connectionConf\n            if (!type) {\n              throw new Error(`unknown connection type \"${type}\"`)\n            }\n            const connection = self.sessionConnections.find(\n              c => c.connectionId === connectionId,\n            )\n            if (connection) {\n              return connection\n            } else {\n              const length = self.sessionConnections.push(connectionConf)\n              return self.sessionConnections[length - 1]\n            }\n          }\n        },\n\n        /**\n         * #action\n         */\n        deleteConnection(configuration: AnyConfigurationModel) {\n          if (self.adminMode) {\n            return superDeleteConnection(configuration)\n          } else {\n            const { connectionId } = configuration\n            const idx = self.sessionConnections.findIndex(\n              c => c.connectionId === connectionId,\n            )\n            return idx === -1\n              ? undefined\n              : self.sessionConnections.splice(idx, 1)\n          }\n        },\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!snap) {\n        return snap\n      }\n      const { sessionConnections, ...rest } = snap as Omit<typeof snap, symbol>\n      return {\n        ...rest,\n        ...(sessionConnections.length ? { sessionConnections } : {}),\n      } as typeof snap\n    })\n}\n","import { types } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel AppFocusMixin\n * #category session\n */\nexport function AppFocusMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       * used to keep track of which view is in focus\n       */\n      focusedViewId: types.maybe(types.string),\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFocusedViewId(viewId: string) {\n        self.focusedViewId = viewId\n      },\n    }))\n}\n","import { BaseWebSession } from '@jbrowse/web-core'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport type { AbstractSessionModel } from '@jbrowse/core/util/types'\nimport type { Instance } from '@jbrowse/mobx-state-tree'\n\n/**\n * #stateModel JBrowseWebSessionModel\n * extends [BaseWebSession](../basewebsession)\n */\nexport default function sessionModelFactory({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  return BaseWebSession({ pluginManager, assemblyConfigSchema })\n}\n\nexport type WebSessionModelType = ReturnType<typeof sessionModelFactory>\nexport type WebSessionModel = Instance<WebSessionModelType>\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction z(x: Instance<WebSessionModelType>): AbstractSessionModel {\n  // this function's sole purpose is to get typescript to check\n  // that the session model implements all of AbstractSessionModel\n  return x\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { doAnalytics } from '@jbrowse/core/util/analytics'\nimport {\n  restoreFileHandlesFromSnapshot,\n  setPendingFileHandleIds,\n} from '@jbrowse/core/util/tracks'\n\nimport corePlugins from './corePlugins.ts'\nimport { loadHubSpec } from './loadHubSpec.ts'\nimport { loadSessionSpec } from './loadSessionSpec.ts'\nimport JBrowseRootModelFactory from './rootModel/rootModel.ts'\nimport sessionModelFactory from './sessionModel/index.ts'\n\nimport type { SessionLoaderModel } from './SessionLoader.ts'\n\nexport function createPluginManager(\n  model: SessionLoaderModel,\n  reloadPluginManagerCallback: (\n    configSnapshot: Record<string, unknown>,\n    sessionSnapshot: Record<string, unknown>,\n  ) => void,\n) {\n  // it is ready when a session has loaded and when there is no config error\n  //\n  // Assuming that the query changes model.sessionError or\n  // model.sessionSnapshot or model.blankSession\n  const pluginManager = new PluginManager([\n    ...corePlugins.map(P => ({\n      plugin: new P(),\n      metadata: { isCore: true },\n    })),\n    ...(model.runtimePlugins ?? []).map(({ plugin: P, definition }) => ({\n      plugin: new P(),\n      definition,\n      metadata: {\n        // @ts-expect-error\n        url: definition.url,\n      },\n    })),\n    ...(model.sessionPlugins ?? []).map(({ plugin: P, definition }) => ({\n      plugin: new P(),\n      definition,\n      metadata: {\n        // @ts-expect-error\n        url: definition.url,\n      },\n    })),\n  ]).createPluggableElements()\n\n  const RootModel = JBrowseRootModelFactory({\n    pluginManager,\n    sessionModelFactory,\n    adminMode: !!model.adminKey,\n  })\n\n  if (model.configSnapshot) {\n    const rootModel = RootModel.create(\n      {\n        jbrowse: model.configSnapshot,\n        configPath: model.configPath,\n      },\n      { pluginManager },\n    )\n\n    rootModel.setReloadPluginManagerCallback(reloadPluginManagerCallback)\n\n    // @ts-expect-error\n    if (!model.configSnapshot.configuration?.rpc?.defaultDriver) {\n      rootModel.jbrowse.configuration.rpc.defaultDriver.set(\n        'WebWorkerRpcDriver',\n      )\n    }\n\n    let afterInitializedCb = () => {}\n\n    // in order: saves the previous autosave for recovery, tries to load the\n    // local session if session in query, or loads the default session\n    try {\n      const {\n        sessionError,\n        sessionSpec,\n        sessionSnapshot,\n        hubSpec,\n        sessionName,\n      } = model\n      if (sessionError) {\n        // eslint-disable-next-line @typescript-eslint/only-throw-error\n        throw sessionError\n      } else if (sessionSnapshot) {\n        // Attempt to restore file handles from the session snapshot\n        // This is async but we kick it off before setting the session\n        // If permission is already granted (persisted), files will be available\n        // If not, user will need to click to grant permission\n        restoreFileHandlesFromSnapshot(sessionSnapshot, false)\n          .then(results => {\n            const failed = results.filter(r => !r.success)\n            if (failed.length > 0) {\n              const failedIds = failed.map(f => f.handleId)\n              console.warn(\n                '[createPluginManager] Some file handles could not be restored (need user gesture):',\n                failedIds,\n              )\n              // Track failed handles so UI can prompt user\n              setPendingFileHandleIds(failedIds)\n            }\n          })\n          .catch((err: unknown) => {\n            console.error(\n              '[createPluginManager] Error restoring file handles:',\n              err,\n            )\n          })\n        rootModel.setSession(sessionSnapshot)\n      } else if (hubSpec) {\n        afterInitializedCb = () =>\n          // @ts-expect-error\n          loadHubSpec({ ...hubSpec, sessionName }, pluginManager)\n      } else if (sessionSpec) {\n        afterInitializedCb = () =>\n          // @ts-expect-error\n          loadSessionSpec({ ...sessionSpec, sessionName }, pluginManager)\n      } else {\n        rootModel.setDefaultSession()\n        if (sessionName) {\n          rootModel.renameCurrentSession(sessionName)\n        }\n      }\n    } catch (e) {\n      rootModel.setDefaultSession()\n      const str = `${e}`\n      const m = str\n        .replace('[@jbrowse/mobx-state-tree] ', '')\n        .replace(/\\(.+/, '')\n      const r =\n        m.length > 1000 ? `${m.slice(0, 1000)}...see more in console` : m\n      const s = r.startsWith('Error:') ? r : `Error: ${r}`\n      rootModel.session?.notifyError(\n        `${s}. If you received this URL from another user, request that they send you a session generated with the \"Share\" button instead of copying and pasting their URL`,\n        model.sessionError,\n        model.sessionSnapshot,\n      )\n      console.error(e)\n    }\n\n    // send analytics\n    doAnalytics(rootModel, model.initialTimestamp, model.sessionQuery)\n\n    pluginManager.setRootModel(rootModel)\n    pluginManager.configure()\n    afterInitializedCb()\n    return pluginManager\n  } else {\n    return undefined\n  }\n}\n","import type PluginManager from '@jbrowse/core/PluginManager'\n\n// load a UCSC hub\nexport async function loadHubSpec(\n  {\n    hubURL,\n    sessionName,\n    // sessionTracks = [],\n  }: {\n    hubURL: string[]\n    sessionTracks: Record<string, unknown>[]\n    sessionName?: string\n  },\n  pluginManager: PluginManager,\n) {\n  const rootModel = pluginManager.rootModel!\n\n  try {\n    const res = await fetch(hubURL[0]!)\n    if (!res.ok) {\n      throw new Error(`HTTP ${res.status} fetching ${hubURL[0]}`)\n    }\n    const d = await res.text()\n    const sessionLabel = d\n      .split('\\n')\n      .find(d => d.startsWith('shortLabel'))\n      ?.replace('shortLabel', '')\n      .trim()\n\n    // @ts-expect-error\n    rootModel.setSession({\n      name: sessionName ?? sessionLabel ?? hubURL[0],\n      sessionConnections: hubURL.map(r => ({\n        type: 'UCSCTrackHubConnection',\n        connectionId: r,\n        name: r,\n        hubTxtLocation: {\n          uri: r,\n          locationType: 'UriLocation',\n        },\n      })),\n    })\n    const { session } = rootModel\n    // @ts-expect-error\n    session.makeConnection(session.sessionConnections[0])\n  } catch (e) {\n    console.error(e)\n    rootModel.session?.notifyError(`${e}`, e)\n  }\n}\n","import { readConfObject } from '../configuration/index.ts'\nimport { isElectron } from '../util/index.ts'\n\ntype AnalyticsObj = Record<string, any>\n\ninterface Track {\n  type: string\n}\n\nexport async function writeAWSAnalytics(\n  rootModel: any,\n  initialTimeStamp: number,\n  sessionQuery?: string | null,\n) {\n  try {\n    const url = 'https://analytics.jbrowse.org/api/v1'\n\n    const multiAssemblyTracks = rootModel.jbrowse.tracks.filter(\n      (track: any) => (readConfObject(track, 'assemblyNames') || []).length > 1,\n    ).length\n\n    const savedSessionCount = Object.keys(localStorage).filter(name =>\n      name.includes('localSaved-'),\n    ).length\n\n    const { jbrowse: config, session, version: ver } = rootModel\n    const { tracks, assemblies, plugins } = config\n\n    // stats to be recorded in db\n    const stats: AnalyticsObj = {\n      ver,\n      'plugins-count': plugins?.length || 0,\n      'plugin-names': plugins?.map((p: any) => p.name).join(','),\n      'assemblies-count': assemblies.length,\n      'tracks-count': tracks.length,\n      'session-tracks-count': session?.sessionTracks.length || 0,\n      'open-views': session?.views.length || 0,\n      'synteny-tracks-count': multiAssemblyTracks,\n      'saved-sessions-count': savedSessionCount,\n\n      // field if existing session param in query before autogenerated param\n      'existing-session-param-type': sessionQuery?.split('-')[0] || 'none',\n\n      // screen geometry\n      'scn-h': window.screen.height,\n      'scn-w': window.screen.width,\n\n      // window geometry\n      'win-h': window.innerHeight,\n      'win-w': window.innerWidth,\n\n      electron: isElectron,\n      loadTime: (Date.now() - initialTimeStamp) / 1000,\n      jb2: true,\n    }\n\n    // stringifies the track type counts, gets processed in lambda\n    // eslint-disable-next-line unicorn/no-array-for-each\n    tracks.forEach((track: Track) => {\n      const key = `track-types-${track.type}`\n      stats[key] = stats[key] + 1 || 1\n    })\n\n    // stringifies the session track type counts, gets processed in lambda\n    // eslint-disable-next-line unicorn/no-array-for-each\n    session?.sessionTracks.forEach((track: Track) => {\n      const key = `sessionTrack-types-${track.type}`\n      stats[key] = stats[key] + 1 || 1\n    })\n\n    // put stats into a query string for get request\n    const qs = Object.keys(stats)\n      .map(key => `${key}=${stats[key]}`)\n      .join('&')\n\n    await fetch(`${url}?${qs}`)\n  } catch (e) {\n    console.error('Failed to write analytics to AWS.', e)\n  }\n}\n\nexport async function writeGAAnalytics(\n  rootModel: any,\n  initialTimestamp: number,\n) {\n  const jbrowseUser = 'UA-7115575-5'\n  const stats: AnalyticsObj = {\n    'tracks-count': rootModel.jbrowse.tracks.length, // this is all possible tracks\n    ver: rootModel.version,\n    electron: isElectron,\n    loadTime: Date.now() - initialTimestamp,\n    pluginNames:\n      rootModel.jbrowse.plugins?.map((plugin: any) => plugin.name) || '',\n  }\n\n  // create script\n  let analyticsScript =\n    \"(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\"\n  analyticsScript +=\n    '(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),'\n  analyticsScript +=\n    'm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)'\n  analyticsScript +=\n    \"})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\"\n  analyticsScript += `ga('create', '${jbrowseUser}', 'auto', 'jbrowseTracker');`\n\n  const gaData: AnalyticsObj = {}\n  const googleDimensions = 'tracks-count ver electron loadTime pluginNames'\n\n  for (const [index, key] of googleDimensions.split(/\\s+/).entries()) {\n    gaData[`dimension${index + 1}`] = stats[key]\n  }\n\n  gaData.metric1 = Math.round(stats.loadTime)\n\n  analyticsScript += `ga('jbrowseTracker.send', 'pageview',${JSON.stringify(\n    gaData,\n  )});`\n\n  const analyticsScriptNode = document.createElement('script')\n  analyticsScriptNode.innerHTML = analyticsScript\n\n  document.getElementsByTagName('head')[0]!.append(analyticsScriptNode)\n}\n\nexport function doAnalytics(\n  rootModel: any,\n  initialTimestamp: number,\n  initialSessionQuery: string | null | undefined,\n) {\n  if (\n    rootModel &&\n    !readConfObject(rootModel.jbrowse.configuration, 'disableAnalytics')\n  ) {\n    // ok if these are unhandled\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    writeAWSAnalytics(rootModel, initialTimestamp, initialSessionQuery)\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    writeGAAnalytics(rootModel, initialTimestamp)\n  }\n}\n","/**\n * The pluginManager/rootModel can be destroyed and recreated without a full\n * page reload. Plugin install passes the session explicitly via the\n * reloadPluginManager callback. HMR uses a different mechanism: the useEffect\n * cleanup saves the current session to the loader before destroying, so\n * createPluginManager can restore it.\n */\nimport { Suspense, lazy, useCallback, useEffect, useRef, useState } from 'react'\n\nimport { FatalErrorDialog } from '@jbrowse/core/ui'\nimport { ErrorBoundary } from '@jbrowse/core/ui/ErrorBoundary'\nimport { destroy, getSnapshot, isAlive } from '@jbrowse/mobx-state-tree'\nimport { observer } from 'mobx-react'\n\nimport '@fontsource/roboto'\n\nimport JBrowse from './JBrowse.tsx'\nimport Loading from './Loading.tsx'\nimport SessionLoader from '../SessionLoader.ts'\nimport { createPluginManager } from '../createPluginManager.ts'\nimport factoryReset from '../factoryReset.ts'\nimport { deleteQueryParams, readQueryParams } from '../useQueryParam.ts'\n\nimport type { SessionLoaderModel } from '../SessionLoader.ts'\nimport type PluginManager from '@jbrowse/core/PluginManager'\n\nconst SessionTriaged = lazy(() => import('./SessionTriaged.tsx'))\nconst StartScreenErrorMessage = lazy(\n  () => import('./StartScreenErrorMessage.tsx'),\n)\n\nconst paramsToDelete = [\n  'loc',\n  'tracks',\n  'assembly',\n  'password',\n  'sessionTracks',\n  'hubURL',\n  'tracklist',\n  'nav',\n  'highlight',\n  'sessionName',\n] as const\n\nexport function Loader({\n  initialTimestamp: initialTimestampProp,\n}: {\n  initialTimestamp?: number\n}) {\n  const [initialTimestamp] = useState(() => initialTimestampProp ?? Date.now())\n\n  const [loader] = useState(() => {\n    const {\n      config,\n      session,\n      adminKey,\n      password,\n      loc,\n      assembly,\n      tracks,\n      sessionTracks,\n      tracklist,\n      highlight,\n      nav,\n      hubURL,\n      sessionName,\n    } = readQueryParams([\n      'config',\n      'session',\n      'adminKey',\n      'password',\n      'loc',\n      'assembly',\n      'tracks',\n      'sessionTracks',\n      'tracklist',\n      'highlight',\n      'nav',\n      'hubURL',\n      'sessionName',\n    ])\n\n    return SessionLoader.create({\n      configPath: config,\n      sessionQuery: session,\n      password,\n      adminKey,\n      loc,\n      assembly,\n      tracks,\n      sessionTracks,\n      tracklist: JSON.parse(tracklist || 'false'),\n      highlight,\n      nav: JSON.parse(nav || 'true'),\n      hubURL: hubURL?.split(','),\n      sessionName,\n      initialTimestamp,\n    })\n  })\n\n  useEffect(() => {\n    deleteQueryParams([...paramsToDelete])\n  }, [])\n\n  return <Renderer loader={loader} />\n}\n\nconst Renderer = observer(function Renderer({\n  loader: firstLoader,\n}: {\n  loader: SessionLoaderModel\n}) {\n  // Store loader in state so reloadPluginManager can replace it\n  const [loader, setLoader] = useState(firstLoader)\n  const pluginManager = useRef<PluginManager | undefined>(undefined)\n  const [pluginManagerCreated, setPluginManagerCreated] = useState(false)\n\n  // Called by rootModel when plugins are installed/removed. Creates a new\n  // loader with the updated config and current session, triggering a full\n  // pluginManager recreation.\n  const reloadPluginManager = useCallback(\n    (\n      configSnapshot: Record<string, unknown>,\n      sessionSnapshot: Record<string, unknown>,\n    ) => {\n      const newLoader = SessionLoader.create({\n        configPath: loader.configPath,\n        sessionQuery: loader.sessionQuery,\n        password: loader.password,\n        adminKey: loader.adminKey,\n        loc: loader.loc,\n        assembly: loader.assembly,\n        tracks: loader.tracks,\n        sessionTracks: loader.sessionTracks,\n        tracklist: loader.tracklist,\n        highlight: loader.highlight,\n        nav: loader.nav,\n        hubURL: loader.hubURL,\n        sessionName: loader.sessionName,\n        initialTimestamp: Date.now(),\n        configSnapshot,\n        sessionSnapshot,\n      })\n      setLoader(newLoader)\n      setPluginManagerCreated(false)\n    },\n    [loader],\n  )\n  const { configError, ready, sessionTriaged } = loader\n  const [error, setError] = useState<unknown>()\n\n  useEffect(() => {\n    // Skip destroy in Jest since it interferes with test cleanup\n    const isJest = typeof jest !== 'undefined'\n    if (ready) {\n      try {\n        if (pluginManager.current?.rootModel && !isJest) {\n          destroy(pluginManager.current.rootModel)\n        }\n        pluginManager.current = createPluginManager(loader, reloadPluginManager)\n        setPluginManagerCreated(true)\n      } catch (e) {\n        console.error(e)\n        setError(e)\n      }\n    }\n    return () => {\n      if (pluginManager.current?.rootModel && !isJest) {\n        const rootModel = pluginManager.current.rootModel\n        const session = rootModel.session\n        // Note: isAlive check crucial because if not a 'dead' session is\n        // snapshotted and the safeReference in activeWidgets is stripped from\n        // the snapshot (xref #5414)\n        if (session && isAlive(session)) {\n          // Save session before destroying so it can be restored on next\n          // effect run. This is essential for HMR where the same loader is\n          // reused. For plugin reload via reloadPluginManagerCallback, this\n          // writes to the old loader (captured in this closure) which is\n          // discarded - the new loader already has sessionSnapshot pre-set.\n          loader.setSessionSnapshot(getSnapshot(session))\n        }\n        destroy(pluginManager.current.rootModel)\n      }\n    }\n  }, [ready, loader, reloadPluginManager])\n\n  const err = configError || error\n  if (err) {\n    return (\n      <Suspense fallback={null}>\n        <StartScreenErrorMessage error={err} />\n      </Suspense>\n    )\n  } else if (sessionTriaged) {\n    return <SessionTriaged loader={loader} sessionTriaged={sessionTriaged} />\n  } else if (pluginManagerCreated && pluginManager.current) {\n    return <JBrowse pluginManager={pluginManager.current} />\n  } else {\n    return <Loading />\n  }\n})\n\nfunction LoaderWrapper({ initialTimestamp }: { initialTimestamp: number }) {\n  return (\n    <ErrorBoundary\n      FallbackComponent={props => (\n        <FatalErrorDialog\n          {...props}\n          resetButtonText=\"Reset Session\"\n          onFactoryReset={factoryReset}\n        />\n      )}\n    >\n      <Loader initialTimestamp={initialTimestamp} />\n    </ErrorBoundary>\n  )\n}\n\nexport default LoaderWrapper\n","export default async function factoryReset() {\n  // @ts-expect-error\n  window.location = window.location.pathname\n}\n"],"names":["DockviewLayoutMixin","types","model","dockviewLayout","maybe","frozen","panelViewAssignments","optional","map","array","string","init","activePanelId","views","self","getViewIdsForPanel","panelId","get","actions","setDockviewLayout","layout","setActivePanelId","setInit","assignViewToPanel","viewId","existing","includes","push","set","removeViewFromPanel","viewIds","entries","idx","indexOf","splice","length","delete","removePanel","moveViewUpInPanel","values","temp","moveViewDownInPanel","moveViewToTopInPanel","unshift","moveViewToBottomInPanel","postProcessSnapshot","snap","_init","rest","undefined","Object","keys","isSessionWithDockviewLayout","session","BaseSessionModel","_pluginManager","id","ElementId","name","margin","volatile","selection","hovered","root","getParent","jbrowse","rpcManager","configuration","this","adminMode","textSearchManager","assemblies","setSelection","thing","clearSelection","setHovered","isBaseSession","isUMDPluginDefinition","def","umdUrl","url","umdLoc","isESMPluginDefinition","esmUrl","esmLoc","isCJSPluginDefinition","cjsUrl","pluginDescriptionString","d","uri","pluginUrl","esmUri","cjsLoc","addCacheBuster","globalThis","__jbrowseCacheBuster","u","URL","searchParams","Date","now","toString","href","PluginLoader","definitions","constructor","defs","args","fetchESM","fetchCJS","JSON","parse","stringify","loadCJSPlugin","baseUri","parsedUrl","protocol","Error","loadESMPlugin","plugin","loadUMDPlugin","moduleName","umdName","jest","async","scriptUrl","src","Promise","resolve","reject","script","document","createElement","type","onload","onerror","head","append","importScripts","loadScript","default","Plugin","loadPlugin","isElectron","installGlobalReExports","target","JBrowseExports","fromEntries","ReExports","module","load","all","definition","getSearchParams","URLSearchParams","window","location","search","updateUrl","params","newSearch","newUrl","pathname","history","replaceState","readQueryParams","result","key","deleteQueryParams","setQueryParams","value","ConnectionManagementSessionMixin","pluginManager","connectionInstances","pluggableMstType","connections","makeConnection","initialSnapshot","readConfObject","getConnectionType","prepareToBreakConnection","callbacksToDeref","derefTypeCount","connection","find","c","track","tracks","ref","getReferring","removeReferring","cb","breakConnection","remove","deleteConnection","deleteConnectionConf","addConnectionConf","connectionConf","clearConnections","clear","isSessionWithConnections","fromUrlSafeB64","b64","originalB64","num","repeat","b64PadSuffix","replaceAll","toByteArray","inflate","inflated","TextDecoder","decode","toUrlSafeB64","str","bytes","TextEncoder","encode","deflate","fromByteArray","encoded","pos","slice","filterSessionInPlace","node","isArrayType","childType","getChildType","isReferenceType","i","isValidReference","forEach","el","isMapType","child","isModelType","properties","getPropertyMembers","pname","ptype","addRelativeUris","config","base","readConf","attr","removeAttr","obj","prop","AssemblyManager","lazy","DataManagementPlugin","exports","install","UCSCTrackHubConnectionF","JB2TrackHubConnectionF","AddTrackWidgetF","HierarchicalTrackSelectorWidgetF","AddConnectionWidgetF","PluginStoreWidgetF","configure","getErrorMsg","err","message","e","shareSessionToDynamo","referer","sess","password","btoa","crypto","getRandomValues","Uint8Array","b","String","fromCharCode","join","encryptedSession","aesEncrypt","data","FormData","response","fetch","method","mode","body","ok","text","json","readSessionFromDynamo","baseUrl","sessionQueryParam","signal","sessionId","split","encodeURIComponent","aesDecrypt","Indexing","props","$","_c","t0","t1","Symbol","for","_jsx","SvgIcon","children","TrackSelector","DNA","fill","Cable","MultipleViewsSessionMixin","compose","DrawerWidgetSessionMixin","stickyViewHeaders","boolean","localStorageGetBoolean","useWorkspaces","moveViewDown","findIndex","v","moveViewUp","view","moveViewToTop","cast","filter","moveViewToBottom","addView","typeName","initialState","getElementType","removeView","widget","activeWidgets","hideWidget","setStickyViewHeaders","sticky","setUseWorkspaces","afterAttach","addDisposer","autorun","localStorageSetBoolean","isSessionWithMultipleViews","widgetStateModelType","drawerPosition","localStorageGetItem","drawerWidth","refinement","integer","width","widgets","safeReference","minimized","visibleWidget","isAlive","size","setDrawerPosition","arg","localStorage","setItem","updateDrawerWidth","newDrawerWidth","resizeDrawer","distance","oldDrawerWidth","addWidget","conf","showWidget","has","hasWidget","minimizeWidgetDrawer","showWidgetDrawer","hideAllWidgets","editConfiguration","targetConfig","isStateTreeNode","isConfigurationModel","pluggableConfigSchemaType","create","getEnv","editor","setTarget","localStorageSetItem","containingDisplayCache","WeakMap","containingTrackCache","containingViewCache","sessionCache","useDebounce","delay","debouncedValue","setDebouncedValue","useState","handle","setTimeout","clearTimeout","useEffect","useWidthSetter","padding","useMeasure","t2","token","requestAnimationFrame","setWidth","cancelAnimationFrame","useDebouncedCallback","callback","wait","argsRef","useRef","timeout","t3","current","t4","findParentThat","predicate","hasParent","currentNode","springAnimate","fromValue","toValue","setValue","onFinish","precision","tension","friction","clamp","animationFrameId","update","animation","time","performance","position","lastPosition","lastTime","velocity","lastVelocity","numSteps","Math","floor","isVelocity","abs","isDisplacement","findParentThatIs","getSession","cached","isSessionModel","getContainingView","isViewModel","getContainingTrack","isTrackModel","getContainingDisplay","isDisplayModel","assembleLocString","region","assembleLocStringFast","toLocale","n","assemblyName","refName","start","end","reversed","assemblyNameString","startString","endString","rev","compareLocs","locA","locB","assemblyComp","localeCompare","refComp","startComp","endComp","compareLocStrings","a","isValidRefName","parseLocString","min","max","bpToPx","bp","bpPerPx","round","oneEightyOverPi","PI","piOverOneEighty","radToDeg","radians","degToRad","degrees","polarToCartesian","rho","theta","cos","sin","cartesianToPolar","x","y","sqrt","atan","featureSpanPx","feature","bpSpanPx","leftBp","rightBp","calculateLayoutBounds","featureStart","featureEnd","layoutWidthBp","featureWidthBp","labelOverhangBp","iterMap","iter","func","sizeHint","results","Array","from","counter","item","findLastIndex","l","findLast","renameRegionIfNeeded","refNameMap","newRef","getSnapshot","originalRefName","renameRegionsIfNeeded","assemblyManager","regions","adapterConfig","assemblyNames","assemblyMaps","Set","getRefNameMapForAdapter","minmax","shorten","short","shorten2","coord","oob","useAssemblyName","test","navigator","userAgent","complementTable","S","w","T","r","N","K","Y","V","M","h","k","C","g","t","A","W","X","m","B","s","H","D","R","G","revcom","revcomped","reverse","complement","comp","rIC","requestIdleCallback","widths","measureText","fontSize","total","charCodeAt","getFrame","strand","phase","defaultStarts","defaultStops","defaultCodonTable","TCA","TCC","TCG","TCT","TTC","TTT","TTA","TTG","TAC","TAT","TAA","TAG","TGC","TGT","TGA","TGG","CTA","CTC","CTG","CTT","CCA","CCC","CCG","CCT","CAC","CAT","CAA","CAG","CGA","CGC","CGG","CGT","ATA","ATC","ATT","ATG","ACA","ACC","ACG","ACT","AAC","AAT","AAA","AAG","AGC","AGT","AGA","AGG","GTA","GTC","GTG","GTT","GCA","GCC","GCG","GCT","GAC","GAT","GAA","GAG","GGA","GGC","GGG","GGT","generateCodonTable","table","tempCodonTable","codon","aa","nucs","nuc","charAt","toUpperCase","toLowerCase","n0","j","n1","updateStatus","msg","fn","res","updateStatus2","stopToken","checkStopToken","hashCode","hash","objectHash","bytesForRegions","index","sum","blocksForRange","flat","block","maxv","blockPosition","minv","isSupportedIndexingAdapter","getBpDisplayStr","reducePrecision","Number","parseFloat","toPrecision","getProgressDisplayStr","len","getTickDisplayStr","totalBp","toFixed","getLayoutId","trackInstanceId","getStatsId","useLocalStorage","initialValue","enabled","storedValue","setStoredValue","getItem","error","console","valueToStore","Function","getUriLink","getStr","isObject","isUriLocation","linkify","measureGridWidth","elements","minWidth","maxWidth","stripHTML","element","coarseStripHTML","getEnvMST","arr","NEGATIVE_INFINITY","entry","POSITIVE_INFINITY","avg","groupBy","notEmpty","mergeIntervals","intervals","stack","top","sort","at","pop","gatherOverlaps","memo","flatMap","group","stripAlpha","colord","alpha","toHex","getStrokeProps","strokeOpacity","stroke","getFillProps","fillOpacity","renderToStaticMarkup","div","flushSync","createRoot","render","innerHTML","isGzip","buf","fetchAndMaybeUnzip","loc","opts","statusCallback","readFile","unzip","fetchAndMaybeUnzipText","buffer","fatal","localStorageGetNumber","defaultVal","Boolean","testAdapter","fileName","regex","adapterHint","expected","SnackbarContents","observer","snackbarMessages","latestMessage","Suspense","fallback","onClose","_event","reason","popSnackbarMessage","contents","useStyles","makeStyles","theme","left","zIndex","bottom","spacing","right","classes","Tooltip","title","Fab","className","color","onClick","LaunchIcon","logoPath","alt","LogoFull","variant","buttonRoot","backgroundColor","palette","primary","contrastText","action","hoverOpacity","ButtonComponent","Button","menuTitle","menuItems","_jsxs","CascadingMenuButton","ArrowDropDown","grow","flexGrow","inputBase","inputRoot","light","inputFocused","borderColor","secondary","main","wrapMenuItems","items","subMenu","HeaderButtons","menus","Toolbar","menu","DropDownMenu","label","arrow","EditableTypography","newName","renameCurrentSession","style","maxHeight","AppLogo","DialogComponent","DialogProps","ClassicViewsContainer","TiledViewsContainer","ViewLauncher","viewsContainer","gridRow","overflow","DrawerWidget","display","height","colorScheme","appContainer","gridColumn","gridTemplateRows","appBar","LazyDrawerWidget","App","drawerVisible","grid","gridTemplateColumns","f","DialogQueue","AppBar","AppToolbar","ViewsContainer","AppFab","Snackbar","FileHandleRestoreBanner","pendingCount","setPendingCount","restoring","setRestoring","checkPending","ids","getPendingFileHandleIds","interval","setInterval","clearInterval","Alert","severity","successCount","restorePendingFileHandles","success","stillPending","reload","disabled","shareDiv","textAlign","paddingLeft","shareButton","ShareDialog","open","setOpen","startIcon","ShareIcon","handleClose","JBrowse","adminKey","adminServer","configPath","rootModel","JBrowseRootModel","JBrowseSession","onSnapshot","headers","snapshot","status","notify","ThemeProvider","CssBaseline","ShareButton","TRUSTED_PLUGIN_URL_PREFIXES","checkPlugins","pluginsToCheck","storePlugins","statusText","fetchPlugins","every","p","isTrustedUrl","some","prefix","startsWith","plugins","pp","isPluginInStore","SessionLoader","sessionQuery","sessionTracks","assembly","tracklist","highlight","nav","sessionName","initialTimestamp","number","hubURL","configSnapshot","sessionSnapshot","sessionTriaged","sessionSpec","hubSpec","blankSession","runtimePlugins","sessionPlugins","sessionError","configError","isSharedSession","isSpecSession","isHubSession","isJb1StyleSession","isEncodedSession","isJsonSession","isLocalSession","ready","isSessionLoaded","pluginsLoaded","isConfigLoaded","sessionTracksParsed","resolvedConfigPath","path","__jbrowseConfigPath","setConfigError","setSessionError","setRuntimePlugins","setSessionPlugins","setConfigSnapshot","setBlankSession","flag","setSessionTriaged","setSessionSnapshot","pluginLoader","import","fetchSessionPlugins","loadSession","userAcceptedConfirmation","origin","fetchConfig","openLocation","random","locationType","configUri","hostname","configPlugins","setUpConfig","structuredClone","fetchSessionFromSessionStorage","query","sessionStr","sessionStorage","sessionSnap","loadDecodedSession","fetchSessionFromIndexedDB","sessionDB","openDB","upgrade","db","createObjectStore","fetchLocalSession","replace","loadSessionPluginsIfNeeded","createElementId","fetchSharedSession","decryptedSession","decodeEncodedUrlSession","decodeSessionSpec","decodeJb1StyleSession","decodeHubSpec","decodeJsonUrlSession","afterCreate","convertLayoutNode","direction","loadSessionSpec","setSession","toLocaleString","addTrackConf","evaluateAsyncExtensionPoint","notifyError","undoIdx","targetPath","notTrackingUndo","canUndo","canRedo","targetStore","snapshotDisposer","debounceTimer","pendingSnapshot","skipNextUndoState","stopTrackingUndo","resumeTrackingUndo","addUndoState","shift","beforeDestroy","initialize","resolvePath","undo","applySnapshot","redo","appendMenu","menuName","insertMenu","appendToMenu","menuItem","insertInMenu","insertPosition","appendToSubMenu","menuPath","topMenu","pathSoFar","sm","mi","insertInSubMenu","isCloneable","LazyWorker","driver","getWorker","workerP","makeWorker","catch","BaseRpcDriver","lastWorkerAssignment","workerAssignments","Map","filterArgs","isArray","File","remoteAbort","functionName","stopTokenId","worker","call","rpcDriverClassName","createWorkerPool","hardwareConcurrency","mainThread","canDetect","detectHardwareConcurrency","workerCount","workers","getWorkerPool","workerPool","workerNumber","workerAssignment","options","TypeError","unextendedWorker","evaluateExtensionPoint","rpcMethod","getRpcMethodType","serializedArgs","serializeArguments","filteredAndSerializedArgs","deserializeReturn","DummyHandle","destroy","_functionName","_filteredArgs","_options","MainThreadRpcDriver","super","pm","funcName","supportsDirectExecution","executeDirect","execute","WebWorkerHandle","client","RpcClient","on","terminate","channel","nanoid","listener","off","WebWorkerRpcDriver","workerBootConfiguration","makeWorkerInstance","instance","log","removeEventListener","postMessage","deserializeError","addEventListener","ConfigurationSchema","description","defaultValue","explicitlyTyped","baseConfiguration","BaseRpcDriverConfigSchema","defaultDriver","drivers","union","MainThreadRpcDriverConfigSchema","WebWorkerRpcDriverConfigSchema","addDriverConfig","configName","RpcManager","static","rpcConfigSchema","mainConfiguration","backendConfigurations","driverObjects","driverFactories","registerDriverFactory","backendConfig","runtimePluginDefinitions","windowHref","factory","getDriver","backendName","existingDriver","newDriver","getDriverForCall","_sessionId","rpcDriverName","refNameRegex","RegExp","refNameColors","checkRefName","assemblyFactory","assemblyConfigType","adapterLoads","AbortablePromiseCache","cache","QuickLRU","maxSize","_stopToken","adapterConf","sequenceAdapter","sequence","adapter","when","refNameAliases","refNames","loadRefNameMap","getCanonicalRefName","forwardMap","reverseMap","canonicalName","adapterName","loadingP","volatileRegions","canonicalToSeqAdapterRefNames","cytobands","getConf","lowerCaseRefNameAliases","val","initialized","aliases","displayName","hasName","allAliases","allRefNames","lowerCaseRefNames","allRefNamesWithLowerCase","colors","getCanonicalRefName2","getRefNameColor","getSeqAdapterRefName","canonicalRefName","setLoaded","setRegions","setRefNameAliases","setCytobands","setError","setCanonicalToSeqAdapterRefNames","setLoadingP","loadPre","refNameAliasesAdapterConf","cytobandAdapterConf","sequenceAdapterConf","getAdapterType","getAdapterClass","getRegions","getAssemblyRegions","refNameAliasCollection","getRefNameAliases","override","alias","getCytobands","getAdapterMapEntry","adapterConfigCacheKey","getReverseRefNameMapForAdapter","getData","RootConfiguration","rpc","configSchema","highResolutionScaling","formatDetails","contextVariable","subfeatures","depth","maxDepth","formatAbout","hideUris","shareURL","disableAnalytics","hierarchical","trackNames","categories","defaultCollapsed","categoryNames","topLevelCategories","subCategories","extraThemes","pluginConfigurationNamespacedSchemas","pluginConfigurationUnnamespacedSchemas","Worker","resolveIdentifier","SetDefaultSession","PreferencesDialog","RootModel","sessionModelFactory","assemblyConfigSchema","getTrackType","preProcessSnapshot","explicitIdentifier","assemblyConfigSchemaFactory","jbrowseModelType","snapshotProcessor","internetAccounts","aggregateTextSearchAdapters","defaultSession","preConfiguredSessions","pluginConfigurationRootSchemas","JBrowseConfigF","addAssemblyConf","trackId","removeAssemblyConf","toRemove","trackConf","elt","conn","deleteTrackConf","updateTrackConf","newTracks","addPlugin","pluginDefinition","setPluginsUpdated","removePlugin","setDefaultSessionConf","sessionConf","newDefault","toJS","addInternetAccountConf","internetAccountConf","deleteInternetAccountConf","JBrowseModelF","postProcessor","jbrowseWebFactory","sessionModelType","sessionPath","assemblyNameMap","getCanonicalAssemblyName","asmName","getCanonicalAssemblyName2","assemblyNamesList","assemblyList","asm","sessionAssemblies","temporaryAssemblies","waitForAssembly","reaction","assemblyConfs","removeAssembly","addAssembly","fireImmediately","TextSearchManager","setDefaultSession","setSessionPath","BaseRootModelFactory","initializeInternetAccount","internetAccountConfig","getInternetAccountType","createEphemeralInternetAccount","internetAccountId","hostUri","internetAccountSplit","domains","internetAccount","stateModel","findAppropriateInternetAccount","selectedId","selectedAccount","account","handlesLocation","InternetAccountsRootModelMixin","TimeTraveller","keydownListener","ctrlKey","metaKey","shiftKey","code","activeElement","tagName","mutableMenuActions","setMenus","newMenus","version","pluginsUpdated","savedSessionMetadata","reloadPluginManagerCallback","_configSnapshot","_sessionSnapshot","setSavedSessionMetadata","sessions","fetchSessionMetadata","ret","getAll","createdAt","setSessionDB","indexedDB","put","favorite","savingFailed","oldSession","getType","setReloadPluginManagerCallback","activateSession","favoriteSavedSession","unfavoriteSavedSession","deleteSavedSession","processMutableMenuActions","favs","icon","AddIcon","PublishIcon","GetAppIcon","saveAs","Blob","autoBom","FileCopyIcon","formatDistanceToNow","addSuffix","StarIcon","FolderOpenIcon","StorageIcon","queueDialog","UndoIcon","RedoIcon","ExtensionIcon","SettingsIcon","SpaceDashboardIcon","checked","helpText","ErrorMessageStackTraceDialog","ReferenceManagementSessionMixin","object","refs","targetTrackId","walk","members","getMembers","refTrackId","referring","callbacks","dereferenceTypeCount","dereferenced","hideTrack","err1","isSessionModelWithWidgets","AboutDialog","BaseWebSession","sessionModel","queueOfDialogs","removeActiveDialog","component","sessionThemeName","allThemes","defaultThemes","themeName","configTheme","createJBrowseTheme","setThemeName","getTracksById","callbacksToDereferenceTrack","TracksManagerSessionMixin","named","superAddTrackConf","superDeleteTrackConf","found","SessionTracksManagerSessionMixin","assemblyConfigSchemasType","addSessionAssembly","warn","removeSessionAssembly","addTemporaryAssembly","removeTemporaryAssembly","TemporaryAssembliesMixin","sessionConnections","superDeleteConnection","superAddConnectionConf","connectionId","WebSessionConnectionsMixin","focusedViewId","setFocusedViewId","observable","snackbarMessageSet","level","pushSnackbarMessage","removeSnackbarMessage","errorMessage","extra","reportAction","task","setName","previousAutosaveId","renderProps","addSessionPlugin","removeSessionPlugin","addSavedSession","duplicateCurrentSession","saveSessionToLocalStorage","loadAutosaveSession","editTrackConfiguration","isSessionTrack","getTrackActions","canEdit","isRefSeq","displays","displayId","category","CopyIcon","DeleteIcon","getTrackListMenuItems","InfoIcon","getTrackActionMenuItems","extraTrackActions","priority","extendedSessionModel","preProcessor","createPluginManager","PluginManager","corePlugins","P","metadata","isCore","createPluggableElements","JBrowseRootModelFactory","afterInitializedCb","restoreFileHandlesFromSnapshot","then","failed","failedIds","handleId","setPendingFileHandleIds","sessionLabel","trim","hubTxtLocation","loadHubSpec","initialSessionQuery","initialTimeStamp","multiAssemblyTracks","savedSessionCount","ver","stats","screen","innerHeight","innerWidth","electron","loadTime","jb2","qs","writeAWSAnalytics","pluginNames","analyticsScript","gaData","metric1","analyticsScriptNode","getElementsByTagName","writeGAAnalytics","doAnalytics","setRootModel","SessionTriaged","StartScreenErrorMessage","paramsToDelete","Loader","initialTimestampProp","loader","_temp","Renderer","firstLoader","setLoader","pluginManagerCreated","setPluginManagerCreated","reloadPluginManager","useCallback","newLoader","isJest","Loading","_temp2","FatalErrorDialog","resetButtonText","factoryReset","ErrorBoundary","FallbackComponent"],"ignoreList":[],"sourceRoot":""}