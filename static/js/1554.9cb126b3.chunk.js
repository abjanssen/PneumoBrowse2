"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[1554],{11554(e,s,o){o.r(s),o.d(s,{default:()=>g});var r=o(30128),a=o(28910),t=o(62088),n=o(23886),i=o(16640),l=o(46625),c=o(10533),d=o(1373),h=o(63209),w=o(43754),p=o(57081),f=o(54825),m=o(23149),k=o(44641),u=o(35703),b=o(69566),x=o(77429),j=o(44460);const y=(0,l.n)()(()=>({flexItem:{margin:5},content:{display:"flex",flexFlow:"column",gap:"5px"}})),g=(0,b.observer)(function({onClose:e,model:s}){const{classes:l}=y(),[b,g]=(0,r.useState)(""),[S,A]=(0,r.useState)(),[C,U]=(0,r.useState)(!0),R=(0,n.getSession)(s),{selectedBookmarks:v}=s,I=0===v.length,L=0===v.length?s.allBookmarksModel:s.sharedBookmarksModel;return(0,r.useEffect)(()=>{(async()=>{try{if(!(0,i.xv)(R))throw new Error("No shareURL configured");U(!0);const e=(0,c.getSnapshot)(L),s=new URL(window.location.href),o=await(0,x.J)(e,R.shareURL,s.href),r=new URLSearchParams(s.search);r.set("bookmarks",`share-${o.json.sessionId}`),r.set("password",o.password),s.search=r.toString(),g(s.href),U(!1)}catch(e){A(e)}finally{U(!1)}})()},[L,R]),(0,j.jsxs)(a.A,{open:!0,onClose:e,title:"Share bookmarks",children:[(0,j.jsxs)(h.A,{className:l.content,children:[(0,j.jsx)(w.A,{severity:"info",children:I?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("span",{children:"All bookmarks will be shared."}),(0,j.jsx)("br",{}),(0,j.jsx)("span",{children:"Use the checkboxes to select individual bookmarks to share."})]}):"Only selected bookmarks will be shared."}),(0,j.jsx)(p.A,{children:"Copy the URL below to share your bookmarks."}),S?(0,j.jsx)(t.A,{error:S}):C?(0,j.jsx)(f.A,{children:"Generating short URL..."}):(0,j.jsx)(m.A,{label:"URL",value:b,slotProps:{input:{readOnly:!0}},variant:"filled",fullWidth:!0,onClick:e=>{e.target.select()}}),(0,j.jsx)(p.A,{children:'The URL should be pasted into the "Import from share link" field in the "Import" form found in the "Bookmarked regions" drawer.'})]}),(0,j.jsx)(k.A,{children:(0,j.jsx)(u.A,{className:l.flexItem,"data-testid":"dialogShare",variant:"contained",color:"primary",disabled:C,startIcon:(0,j.jsx)(d.A,{}),onClick:async()=>{const{default:s}=await o.e(2899).then(o.t.bind(o,72899,23));s(b),R.notify("Copied to clipboard","success"),e()},children:"Copy share link"})})]})})},77429(e,s,o){o.d(s,{J:()=>n,Z:()=>i});var r=o(15773),a=o(81104);function t(e){try{return JSON.parse(e).message}catch(s){return e}}async function n(e,s,o){const n=await(0,a.eW)(JSON.stringify(e)),i=window.btoa([...window.crypto.getRandomValues(new Uint8Array(10))].map(e=>String.fromCharCode(e)).join("")).replaceAll(/[+/]/g,"").slice(0,5);const l=await(0,r.ff)(n,i),c=new FormData;c.append("session",l),c.append("dateShared",`${Date.now()}`),c.append("referer",o);const d=await fetch(`${s}share`,{method:"POST",mode:"cors",body:c});if(!d.ok){const e=await d.text();throw new Error(t(e))}return{json:await d.json(),encryptedSession:l,password:i}}async function i(e,s,o){const a=s.split("share-")[1],n=`${e}?sessionId=${encodeURIComponent(a)}`,i=await fetch(n);if(!i.ok)throw new Error(t(await i.text()));const l=await i.json();return(0,r.F6)(l.session,o)}}}]);
//# sourceMappingURL=1554.9cb126b3.chunk.js.map