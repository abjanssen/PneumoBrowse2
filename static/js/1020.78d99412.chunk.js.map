{"version":3,"file":"static/js/1020.78d99412.chunk.js","mappings":"8MAiBO,SAASA,EAAcC,IAkB5BC,EAAAA,EAAAA,IACED,EACAE,UACE,IAAKF,EAAMG,aACT,OAEF,MAAMC,GAAOC,EAAAA,EAAAA,mBAAkBL,GAC/BA,EAAMM,mBAAmBF,EAAKG,UAEhC,CACEC,MAAO,IACPC,KAAM,iBAGVR,EAAAA,EAAAA,IACED,EACAE,UACE,IAAKF,EAAMG,aACT,OAEF,MAAM,WAAEO,IAAeC,EAAAA,EAAAA,YAAWX,GAC5BI,GAAOC,EAAAA,EAAAA,mBAAkBL,IACzB,SAAEY,EAAQ,cAAEC,EAAa,aAAEC,EAAY,UAAEC,GAAcf,GACvD,QAAEO,GAAYH,EAEpB,GAAIQ,KAAcG,GAAaf,EAAMgB,kBAAoBZ,EAAKG,SAAU,CACtE,MAAM,IAAEU,EAAG,QAAEC,EAAO,aAAEC,GAAiBP,QAGjCZ,EAAMc,aAAaM,eAAeV,EAAY,CAClDS,eACAE,QAAS,CACP,CACEC,MAAOL,EACPM,IAAKN,EAAM,EACXC,UACAC,iBAGJN,gBACAC,aAAcA,EAAaL,KAC3Be,WAAWC,EAAAA,EAAAA,iBAAgBzB,GAC3B0B,iBAAiBC,EAAAA,EAAAA,oBAAmB3B,GAAO4B,GAC3CC,QAAS,IACTC,eAAiBC,KACXC,EAAAA,EAAAA,SAAQhC,IACVA,EAAMiC,iBAAiBF,OAGxB/B,EAAMkC,qBACTC,eAAgBnC,EAAMmC,kBAE1B,EACIH,EAAAA,EAAAA,SAAQhC,KACVA,EAAMM,mBAAmBC,GACzBP,EAAMoC,cAAa,KAGvB,CACE5B,MAAO,IACPC,KAAM,eAIV4B,EAAAA,EAAAA,GAA0BrC,EAAO,IAAMA,EAAMG,aAC/C,C,gFC/EO,SAASkC,EACdrC,EACAsC,IAEArC,EAAAA,EAAAA,IACED,EACAE,UACE,IAAKoC,IACH,OAEF,MAAMlC,GAAOC,EAAAA,EAAAA,mBAAkBL,IACzB,cAAEa,GAAkBb,GACpB,aAAEuC,GAAiBnC,GACnB,cAAEoC,EAAa,qBAAEC,SACfC,EAAAA,EAAAA,GAAuB,CAC3B1C,QACAa,gBACA8B,OAAQJ,KAERP,EAAAA,EAAAA,SAAQhC,KACVA,EAAM4C,2BAA2BJ,GACjCxC,EAAM6C,wBAAwBJ,GAC9BzC,EAAM8C,uBAAsB,KAGhC,CACEtC,MAAO,IACPC,KAAM,cAGZ,C","sources":["webpack://@jbrowse/web/../../plugins/alignments/src/LinearPileupDisplay/doAfterAttach.ts","webpack://@jbrowse/web/../../plugins/alignments/src/shared/setupModificationsAutorun.ts"],"sourcesContent":["import {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { isAlive } from '@jbrowse/mobx-state-tree'\n\nimport { setupModificationsAutorun } from '../shared/setupModificationsAutorun.ts'\nimport { createAutorun } from '../util.ts'\n\nimport type { ModificationType, SortedBy } from '../shared/types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nexport function doAfterAttach(model: {\n  autorunReady: boolean\n  sortedBy?: SortedBy\n  adapterConfig: AnyConfigurationModel\n  rendererType: { name: string }\n  sortReady: boolean\n  currSortBpPerPx: number\n  parentTrack: any\n  adapterRenderProps: () => Record<string, unknown>\n  renderingProps: () => Record<string, unknown>\n  setCurrSortBpPerPx: (arg: number) => void\n  setError: (arg: unknown) => void\n  updateVisibleModifications: (arg: ModificationType[]) => void\n  setSimplexModifications: (arg: string[]) => void\n  setModificationsReady: (arg: boolean) => void\n  setSortReady: (arg: boolean) => void\n  setStatusMessage: (arg: string) => void\n}) {\n  createAutorun(\n    model,\n    async () => {\n      if (!model.autorunReady) {\n        return\n      }\n      const view = getContainingView(model) as LGV\n      model.setCurrSortBpPerPx(view.bpPerPx)\n    },\n    {\n      delay: 1000,\n      name: 'CurrBpPerPx',\n    },\n  )\n  createAutorun(\n    model,\n    async () => {\n      if (!model.autorunReady) {\n        return\n      }\n      const { rpcManager } = getSession(model)\n      const view = getContainingView(model) as LGV\n      const { sortedBy, adapterConfig, rendererType, sortReady } = model\n      const { bpPerPx } = view\n\n      if (sortedBy && (!sortReady || model.currSortBpPerPx === view.bpPerPx)) {\n        const { pos, refName, assemblyName } = sortedBy\n        // render just the sorted region first\n        // @ts-expect-error\n        await model.rendererType.renderInClient(rpcManager, {\n          assemblyName,\n          regions: [\n            {\n              start: pos,\n              end: pos + 1,\n              refName,\n              assemblyName,\n            },\n          ],\n          adapterConfig,\n          rendererType: rendererType.name,\n          sessionId: getRpcSessionId(model),\n          trackInstanceId: getContainingTrack(model).id,\n          timeout: 1_000_000,\n          statusCallback: (arg: string) => {\n            if (isAlive(model)) {\n              model.setStatusMessage(arg)\n            }\n          },\n          ...model.adapterRenderProps(),\n          renderingProps: model.renderingProps(),\n        })\n      }\n      if (isAlive(model)) {\n        model.setCurrSortBpPerPx(bpPerPx)\n        model.setSortReady(true)\n      }\n    },\n    {\n      delay: 1000,\n      name: 'SortReads',\n    },\n  )\n\n  setupModificationsAutorun(model, () => model.autorunReady)\n}\n","import { getContainingView } from '@jbrowse/core/util'\nimport { isAlive } from '@jbrowse/mobx-state-tree'\n\nimport { getUniqueModifications } from './getUniqueModifications.ts'\nimport { createAutorun } from '../util.ts'\n\nimport type { ModificationType } from './types.ts'\nimport type { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport type { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nexport interface ModificationsAutorunModel {\n  adapterConfig: AnyConfigurationModel\n  updateVisibleModifications: (arg: ModificationType[]) => void\n  setSimplexModifications: (arg: string[]) => void\n  setModificationsReady: (arg: boolean) => void\n  setStatusMessage: (arg: string) => void\n  effectiveRpcDriverName?: string\n}\n\nexport function setupModificationsAutorun(\n  model: ModificationsAutorunModel,\n  isReady: () => boolean,\n) {\n  createAutorun(\n    model,\n    async () => {\n      if (!isReady()) {\n        return\n      }\n      const view = getContainingView(model) as LGV\n      const { adapterConfig } = model\n      const { staticBlocks } = view\n      const { modifications, simplexModifications } =\n        await getUniqueModifications({\n          model,\n          adapterConfig,\n          blocks: staticBlocks,\n        })\n      if (isAlive(model)) {\n        model.updateVisibleModifications(modifications)\n        model.setSimplexModifications(simplexModifications)\n        model.setModificationsReady(true)\n      }\n    },\n    {\n      delay: 1000,\n      name: 'GetModInfo',\n    },\n  )\n}\n"],"names":["doAfterAttach","model","createAutorun","async","autorunReady","view","getContainingView","setCurrSortBpPerPx","bpPerPx","delay","name","rpcManager","getSession","sortedBy","adapterConfig","rendererType","sortReady","currSortBpPerPx","pos","refName","assemblyName","renderInClient","regions","start","end","sessionId","getRpcSessionId","trackInstanceId","getContainingTrack","id","timeout","statusCallback","arg","isAlive","setStatusMessage","adapterRenderProps","renderingProps","setSortReady","setupModificationsAutorun","isReady","staticBlocks","modifications","simplexModifications","getUniqueModifications","blocks","updateVisibleModifications","setSimplexModifications","setModificationsReady"],"sourceRoot":""}