"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[36],{70036(e,t,s){s.d(t,{default:()=>g});var a=s(66601),r=s(48455),n=s(24644),i=s(12644),o=s(77251),u=s(33624),c=s(86618);class g extends r.L{static capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];async setupPre(e){const{statusCallback:t=()=>{}}=e||{},s=this.pluginManager,r=new a.Ct({filehandle:(0,u.openLocation)(this.getConf("bigWigLocation"),s)});return{bigwig:r,header:await(0,o.updateStatus)("Downloading bigwig header",t,()=>r.getHeader(e))}}async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async getRefNames(e){const{header:t}=await this.setup(e);return Object.keys(t.refsByName)}async refIdToName(e){const{header:t}=await this.setup();return t.refsByNumber[e]?.name}async getGlobalStats(e){const{header:t}=await this.setup(e);return(0,i.WD)(t.totalSummary)}getFeatures(e,t={}){const{refName:s,start:r,end:n}=e,{bpPerPx:i=0,resolution:u=1,stopToken:g,statusCallback:l=()=>{}}=t,h=this.getConf("source"),b=this.getConf("resolutionMultiplier");return(0,c.ObservableCreate)(async e=>{const{bigwig:c}=await this.setup(t),g=await(0,o.updateStatus)("Downloading bigwig data",l,()=>c.getFeaturesAsArrays(s,r,n,{...t,basesPerSpan:i/u*b})),d=new a.Hp(g,h,s);for(let t=0;t<d.length;t++){const a=d.id(t),r=t;e.next({get:e=>d.get(r,e),id:()=>a,toJSON:()=>({start:d.start(r),end:d.end(r),score:d.score(r),refName:s,source:h,uniqueId:a,summary:d.isSummary,minScore:d.minScore(r),maxScore:d.maxScore(r)})})}e.complete()},g)}async getArrayFeatureView(e,t={}){const{refName:s,start:r,end:n}=e,{bpPerPx:i=0,resolution:u=1,statusCallback:c=()=>{}}=t,g=this.getConf("resolutionMultiplier"),l=this.getConf("source"),{bigwig:h}=await this.setup(t),b=await(0,o.updateStatus)("Downloading bigwig data",c,()=>h.getFeaturesAsArrays(s,r,n,{...t,basesPerSpan:i/u*g}));return new a.Hp(b,l,s)}async getRegionQuantitativeStats(e,t){const{start:s,end:a}=e;return function(e,t,s){const a=e.length;if(0===a)return{scoreMin:0,scoreMax:0,scoreSum:0,scoreSumSquares:0,scoreMean:0,scoreStdDev:0,featureCount:0,basesCovered:s-t,featureDensity:0};let r=Number.MAX_VALUE,n=Number.MIN_VALUE,i=0,o=0,u=0;for(let c=0;c<a;c++){const a=e.start(c);if(e.end(c)<=t||a>=s)continue;const g=e.score(c),l=e.minScore(c)??g,h=e.maxScore(c)??g;r=Math.min(r,l),n=Math.max(n,h),i+=g,o+=g*g,u++}if(0===u)return{scoreMin:0,scoreMax:0,scoreSum:0,scoreSumSquares:0,scoreMean:0,scoreStdDev:0,featureCount:0,basesCovered:s-t,featureDensity:0};const c=i/u;return{scoreMin:r,scoreMax:n,scoreSum:i,scoreSumSquares:o,scoreMean:c,scoreStdDev:Math.sqrt(o/u-c*c),featureCount:u,basesCovered:s-t,featureDensity:u/(s-t)}}(await this.getArrayFeatureView(e,{...t,bpPerPx:(a-s)/1e3}),s,a)}async getMultiRegionFeatureDensityStats(e){return{featureDensity:0}}async getMultiRegionQuantitativeStats(e=[],t={}){if(!e.length)return(0,i.Yv)();const s=await Promise.all(e.map(e=>this.getRegionQuantitativeStats(e,t)));return(0,n.iz)(s)}}}}]);
//# sourceMappingURL=36.38534e8f.chunk.js.map